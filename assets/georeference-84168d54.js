import{by as P,hj as v,hk as m,gT as F,hl as q,hm as E,hn as h,eb as N,fr as $,d_ as b,aG as W,ho as T,hp as D,cE as d,cr as L,hq as S,hr as k,hs as y,ht as H,hu as I,cD as J,hv as K,hw as Q,hx as X,hy as Y,hz as Z,bT as U,hA as V,hB as nn,hC as en}from"./index-71d9419a.js";import{m as tn}from"./MeshGeoreferencedRelativeVertexSpace-f62a2618.js";import{m as rn,p as on}from"./MeshLocalVertexSpace-69085e30.js";import{N as an}from"./MeshTransform-1ca39bdb.js";function z(n,t){return n.isGeographic||n.isWebMercator&&((t==null?void 0:t.geographic)??!0)}function bn(n,t,e){const r=!n.isGeoreferenced;(e==null?void 0:e.geographic)!=null&&e.geographic!==r&&P.getLogger(t).warnOnce(`Specifying the 'geographic' parameter (${e.geographic}) for a Mesh vertex space of type "${n.type}" is not supported. This parameter will be ignored.`)}function A(n,t,e){return z(t.spatialReference,e)?fn(n,t,e):un(n,t,e)}function O(n,t,e,r){const{position:a,normal:o,tangent:i}=n;if(!t.isRelative)return{position:a,normal:o,tangent:i};const l=(e==null?void 0:e.localMatrix)??m;return A({position:h(new Float64Array(a.length),a,l),normal:o!=null?nn(o,new Float32Array(o.length),l):null,tangent:i!=null?en(i,new Float32Array(i.length),l):null},t.getOriginPoint(r),{geographic:!t.isGeoreferenced})}function sn(n,t,e){if(e!=null&&e.useTransform){const{position:r,normal:a,tangent:o}=n,{x:i,y:l,z:c}=t,s=L(i,l,c??0);return{vertexAttributes:{position:r,normal:a,tangent:o},vertexSpace:e.geographic??1?new rn({origin:s}):new tn({origin:s}),transform:new an}}return{vertexAttributes:A(n,t,e),vertexSpace:new on,transform:null}}function w(n,t,e){return z(t.spatialReference,e)?mn(n,t,e):_(n,t,e)}function ln(n,t,e,r,a){if(!t.isRelative)return w(n,r,a);const{spatialReference:o}=r,i=O(n,t,e,o);return r.equals(t.getOriginPoint(o))?_(i,r,a):w(i,r,a)}function cn({positions:n,transform:t,vertexSpace:e,inSpatialReference:r,outSpatialReference:a,outPositions:o,local:i}){const l=e.isRelative?e.origin:v,c=e.isRelative?(t==null?void 0:t.localMatrix)??m:m;if(e.isGeoreferenced){const u=o??F(n.length);if(q(c,m)?E(u,n):h(u,n,c),!N(l,v)){const[G,B,C]=l;for(let p=0;p<u.length;p+=3)u[p]+=G,u[p+1]+=B,u[p+2]+=C}return $(u,r,0,u,a,0,u.length/3),u}const s=b(r),x=!i&&W(r,s)?s:r;T(r,l,f,x),D(f,f,c);const g=o??F(n.length);return h(g,n,f),$(g,x,0,g,a,0,g.length/3),g}function un(n,t,e){const r=new Float64Array(n.position.length),a=n.position,o=t.x,i=t.y,l=t.z??0,c=R(e?e.unit:null,t.spatialReference);for(let s=0;s<a.length;s+=3)r[s]=a[s]*c+o,r[s+1]=a[s+1]*c+i,r[s+2]=a[s+2]*c+l;return{position:r,normal:n.normal,tangent:n.tangent}}function fn(n,t,e){const r=t.spatialReference,a=j(t,e,f),o=new Float64Array(n.position.length),i=gn(n.position,a,r,o),l=S(M,a);return{position:i,normal:pn(i,o,n.normal,l,r),tangent:hn(i,o,n.tangent,l,r)}}function gn(n,t,e,r){h(r,n,t);const a=new Float64Array(n.length);return k(r,a,e)}function pn(n,t,e,r,a){if(e==null)return null;const o=new Float32Array(e.length);return y(o,e,r),H(o,n,t,a,o),o}function hn(n,t,e,r,a){if(e==null)return null;const o=new Float32Array(e.length);y(o,e,r,4);for(let i=3;i<o.length;i+=4)o[i]=e[i];return I(o,n,t,a,o),o}function _(n,t,e){const r=new Float64Array(n.position.length),a=n.position,o=t.x,i=t.y,l=t.z??0,c=R(e?e.unit:null,t.spatialReference);for(let s=0;s<a.length;s+=3)r[s]=(a[s]-o)/c,r[s+1]=(a[s+1]-i)/c,r[s+2]=(a[s+2]-l)/c;return{position:r,normal:n.normal,tangent:n.tangent}}function mn(n,t,e){const r=t.spatialReference;j(t,e,f);const a=J(Rn,f),o=new Float64Array(n.position.length),i=yn(n.position,r,a,o),l=S(M,a);return{position:i,normal:wn(n.normal,n.position,o,r,l),tangent:An(n.tangent,n.position,o,r,l)}}function j(n,t,e){T(n.spatialReference,[n.x,n.y,n.z??0],e,b(n.spatialReference));const r=R(t?t.unit:null,n.spatialReference);return K(e,e,[r,r,r]),e}function yn(n,t,e,r){const a=Q(n,t,r),o=new Float64Array(a.length);return h(o,a,e),o}function wn(n,t,e,r,a){if(n==null)return null;const o=X(n,t,e,r,new Float32Array(n.length));return y(o,o,a),o}function An(n,t,e,r,a){if(n==null)return null;const o=Y(n,t,e,r,new Float32Array(n.length));return y(o,o,a,4),o}function R(n,t){if(n==null)return 1;const e=Z(t);return 1/U(e,"meters",n)}const f=d(),Rn=d(),M=V(),Tn=Object.freeze(Object.defineProperty({__proto__:null,georeference:A,georeferenceApplyTransform:O,georeferenceByTransform:sn,project:cn,ungeoreference:w,ungeoreferenceByTransform:ln},Symbol.toStringTag,{value:"Module"}));export{w as D,ln as E,cn as I,A as O,O as T,Tn as g,bn as o,sn as q,z as r};
