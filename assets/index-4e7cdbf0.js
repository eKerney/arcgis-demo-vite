function TYe(t,e){for(var r=0;r<e.length;r++){const i=e[r];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in t)){const s=Object.getOwnPropertyDescriptor(i,n);s&&Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();function CAe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function EYe(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function i(){if(this instanceof i){var n=[null];n.push.apply(n,arguments);var s=Function.bind.apply(e,n);return new s}return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}var RAe={exports:{}},eG={},OAe={exports:{}},vi={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var S4=Symbol.for("react.element"),CYe=Symbol.for("react.portal"),RYe=Symbol.for("react.fragment"),OYe=Symbol.for("react.strict_mode"),AYe=Symbol.for("react.profiler"),PYe=Symbol.for("react.provider"),MYe=Symbol.for("react.context"),$Ye=Symbol.for("react.forward_ref"),IYe=Symbol.for("react.suspense"),LYe=Symbol.for("react.memo"),DYe=Symbol.for("react.lazy"),Gme=Symbol.iterator;function NYe(t){return t===null||typeof t!="object"?null:(t=Gme&&t[Gme]||t["@@iterator"],typeof t=="function"?t:null)}var AAe={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},PAe=Object.assign,MAe={};function p3(t,e,r){this.props=t,this.context=e,this.refs=MAe,this.updater=r||AAe}p3.prototype.isReactComponent={};p3.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};p3.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function $Ae(){}$Ae.prototype=p3.prototype;function cae(t,e,r){this.props=t,this.context=e,this.refs=MAe,this.updater=r||AAe}var uae=cae.prototype=new $Ae;uae.constructor=cae;PAe(uae,p3.prototype);uae.isPureReactComponent=!0;var Hme=Array.isArray,IAe=Object.prototype.hasOwnProperty,dae={current:null},LAe={key:!0,ref:!0,__self:!0,__source:!0};function DAe(t,e,r){var i,n={},s=null,o=null;if(e!=null)for(i in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)IAe.call(e,i)&&!LAe.hasOwnProperty(i)&&(n[i]=e[i]);var a=arguments.length-2;if(a===1)n.children=r;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];n.children=l}if(t&&t.defaultProps)for(i in a=t.defaultProps,a)n[i]===void 0&&(n[i]=a[i]);return{$$typeof:S4,type:t,key:s,ref:o,props:n,_owner:dae.current}}function FYe(t,e){return{$$typeof:S4,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function hae(t){return typeof t=="object"&&t!==null&&t.$$typeof===S4}function kYe(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var qme=/\/+/g;function nW(t,e){return typeof t=="object"&&t!==null&&t.key!=null?kYe(""+t.key):e.toString(36)}function t8(t,e,r,i,n){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case S4:case CYe:o=!0}}if(o)return o=t,n=n(o),t=i===""?"."+nW(o,0):i,Hme(n)?(r="",t!=null&&(r=t.replace(qme,"$&/")+"/"),t8(n,e,r,"",function(c){return c})):n!=null&&(hae(n)&&(n=FYe(n,r+(!n.key||o&&o.key===n.key?"":(""+n.key).replace(qme,"$&/")+"/")+t)),e.push(n)),1;if(o=0,i=i===""?".":i+":",Hme(t))for(var a=0;a<t.length;a++){s=t[a];var l=i+nW(s,a);o+=t8(s,e,r,l,n)}else if(l=NYe(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=i+nW(s,a++),o+=t8(s,e,r,l,n);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function o5(t,e,r){if(t==null)return t;var i=[],n=0;return t8(t,i,"","",function(s){return e.call(r,s,n++)}),i}function UYe(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var gu={current:null},r8={transition:null},zYe={ReactCurrentDispatcher:gu,ReactCurrentBatchConfig:r8,ReactCurrentOwner:dae};vi.Children={map:o5,forEach:function(t,e,r){o5(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return o5(t,function(){e++}),e},toArray:function(t){return o5(t,function(e){return e})||[]},only:function(t){if(!hae(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};vi.Component=p3;vi.Fragment=RYe;vi.Profiler=AYe;vi.PureComponent=cae;vi.StrictMode=OYe;vi.Suspense=IYe;vi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zYe;vi.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var i=PAe({},t.props),n=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=dae.current),e.key!==void 0&&(n=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)IAe.call(e,l)&&!LAe.hasOwnProperty(l)&&(i[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)i.children=r;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];i.children=a}return{$$typeof:S4,type:t.type,key:n,ref:s,props:i,_owner:o}};vi.createContext=function(t){return t={$$typeof:MYe,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:PYe,_context:t},t.Consumer=t};vi.createElement=DAe;vi.createFactory=function(t){var e=DAe.bind(null,t);return e.type=t,e};vi.createRef=function(){return{current:null}};vi.forwardRef=function(t){return{$$typeof:$Ye,render:t}};vi.isValidElement=hae;vi.lazy=function(t){return{$$typeof:DYe,_payload:{_status:-1,_result:t},_init:UYe}};vi.memo=function(t,e){return{$$typeof:LYe,type:t,compare:e===void 0?null:e}};vi.startTransition=function(t){var e=r8.transition;r8.transition={};try{t()}finally{r8.transition=e}};vi.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};vi.useCallback=function(t,e){return gu.current.useCallback(t,e)};vi.useContext=function(t){return gu.current.useContext(t)};vi.useDebugValue=function(){};vi.useDeferredValue=function(t){return gu.current.useDeferredValue(t)};vi.useEffect=function(t,e){return gu.current.useEffect(t,e)};vi.useId=function(){return gu.current.useId()};vi.useImperativeHandle=function(t,e,r){return gu.current.useImperativeHandle(t,e,r)};vi.useInsertionEffect=function(t,e){return gu.current.useInsertionEffect(t,e)};vi.useLayoutEffect=function(t,e){return gu.current.useLayoutEffect(t,e)};vi.useMemo=function(t,e){return gu.current.useMemo(t,e)};vi.useReducer=function(t,e,r){return gu.current.useReducer(t,e,r)};vi.useRef=function(t){return gu.current.useRef(t)};vi.useState=function(t){return gu.current.useState(t)};vi.useSyncExternalStore=function(t,e,r){return gu.current.useSyncExternalStore(t,e,r)};vi.useTransition=function(){return gu.current.useTransition()};vi.version="18.2.0";OAe.exports=vi;var U=OAe.exports;const Ml=CAe(U),JJ=TYe({__proto__:null,default:Ml},[U]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var VYe=U,BYe=Symbol.for("react.element"),jYe=Symbol.for("react.fragment"),GYe=Object.prototype.hasOwnProperty,HYe=VYe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,qYe={key:!0,ref:!0,__self:!0,__source:!0};function NAe(t,e,r){var i,n={},s=null,o=null;r!==void 0&&(s=""+r),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)GYe.call(e,i)&&!qYe.hasOwnProperty(i)&&(n[i]=e[i]);if(t&&t.defaultProps)for(i in e=t.defaultProps,e)n[i]===void 0&&(n[i]=e[i]);return{$$typeof:BYe,type:t,key:s,ref:o,props:n,_owner:HYe.current}}eG.Fragment=jYe;eG.jsx=NAe;eG.jsxs=NAe;RAe.exports=eG;var F=RAe.exports,KJ={},FAe={exports:{}},$h={},kAe={exports:{}},UAe={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e($,N){var j=$.length;$.push(N);e:for(;0<j;){var J=j-1>>>1,K=$[J];if(0<n(K,N))$[J]=N,$[j]=K,j=J;else break e}}function r($){return $.length===0?null:$[0]}function i($){if($.length===0)return null;var N=$[0],j=$.pop();if(j!==N){$[0]=j;e:for(var J=0,K=$.length,te=K>>>1;J<te;){var ae=2*(J+1)-1,be=$[ae],Ee=ae+1,Je=$[Ee];if(0>n(be,j))Ee<K&&0>n(Je,be)?($[J]=Je,$[Ee]=j,J=Ee):($[J]=be,$[ae]=j,J=ae);else if(Ee<K&&0>n(Je,j))$[J]=Je,$[Ee]=j,J=Ee;else break e}}return N}function n($,N){var j=$.sortIndex-N.sortIndex;return j!==0?j:$.id-N.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,m=!1,g=!1,y=!1,_=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function x($){for(var N=r(c);N!==null;){if(N.callback===null)i(c);else if(N.startTime<=$)i(c),N.sortIndex=N.expirationTime,e(l,N);else break;N=r(c)}}function S($){if(y=!1,x($),!g)if(r(l)!==null)g=!0,Z(C);else{var N=r(c);N!==null&&M(S,N.startTime-$)}}function C($,N){g=!1,y&&(y=!1,b(P),P=-1),m=!0;var j=f;try{for(x(N),h=r(l);h!==null&&(!(h.expirationTime>N)||$&&!k());){var J=h.callback;if(typeof J=="function"){h.callback=null,f=h.priorityLevel;var K=J(h.expirationTime<=N);N=t.unstable_now(),typeof K=="function"?h.callback=K:h===r(l)&&i(l),x(N)}else i(l);h=r(l)}if(h!==null)var te=!0;else{var ae=r(c);ae!==null&&M(S,ae.startTime-N),te=!1}return te}finally{h=null,f=j,m=!1}}var E=!1,R=null,P=-1,D=5,L=-1;function k(){return!(t.unstable_now()-L<D)}function V(){if(R!==null){var $=t.unstable_now();L=$;var N=!0;try{N=R(!0,$)}finally{N?W():(E=!1,R=null)}}else E=!1}var W;if(typeof w=="function")W=function(){w(V)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,B=G.port2;G.port1.onmessage=V,W=function(){B.postMessage(null)}}else W=function(){_(V,0)};function Z($){R=$,E||(E=!0,W())}function M($,N){P=_(function(){$(t.unstable_now())},N)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function($){$.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,Z(C))},t.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<$?Math.floor(1e3/$):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(l)},t.unstable_next=function($){switch(f){case 1:case 2:case 3:var N=3;break;default:N=f}var j=f;f=N;try{return $()}finally{f=j}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function($,N){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var j=f;f=$;try{return N()}finally{f=j}},t.unstable_scheduleCallback=function($,N,j){var J=t.unstable_now();switch(typeof j=="object"&&j!==null?(j=j.delay,j=typeof j=="number"&&0<j?J+j:J):j=J,$){case 1:var K=-1;break;case 2:K=250;break;case 5:K=1073741823;break;case 4:K=1e4;break;default:K=5e3}return K=j+K,$={id:u++,callback:N,priorityLevel:$,startTime:j,expirationTime:K,sortIndex:-1},j>J?($.sortIndex=j,e(c,$),r(l)===null&&$===r(c)&&(y?(b(P),P=-1):y=!0,M(S,j-J))):($.sortIndex=K,e(l,$),g||m||(g=!0,Z(C))),$},t.unstable_shouldYield=k,t.unstable_wrapCallback=function($){var N=f;return function(){var j=f;f=N;try{return $.apply(this,arguments)}finally{f=j}}}})(UAe);kAe.exports=UAe;var WYe=kAe.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zAe=U,xh=WYe;function rt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var VAe=new Set,HD={};function OE(t,e){ZA(t,e),ZA(t+"Capture",e)}function ZA(t,e){for(HD[t]=e,t=0;t<e.length;t++)VAe.add(e[t])}var g_=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),QJ=Object.prototype.hasOwnProperty,XYe=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Wme={},Xme={};function YYe(t){return QJ.call(Xme,t)?!0:QJ.call(Wme,t)?!1:XYe.test(t)?Xme[t]=!0:(Wme[t]=!0,!1)}function ZYe(t,e,r,i){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function JYe(t,e,r,i){if(e===null||typeof e>"u"||ZYe(t,e,r,i))return!0;if(i)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function yu(t,e,r,i,n,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=n,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Fl={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Fl[t]=new yu(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Fl[e]=new yu(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Fl[t]=new yu(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Fl[t]=new yu(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Fl[t]=new yu(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Fl[t]=new yu(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Fl[t]=new yu(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Fl[t]=new yu(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Fl[t]=new yu(t,5,!1,t.toLowerCase(),null,!1,!1)});var pae=/[\-:]([a-z])/g;function fae(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(pae,fae);Fl[e]=new yu(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(pae,fae);Fl[e]=new yu(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(pae,fae);Fl[e]=new yu(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Fl[t]=new yu(t,1,!1,t.toLowerCase(),null,!1,!1)});Fl.xlinkHref=new yu("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Fl[t]=new yu(t,1,!1,t.toLowerCase(),null,!0,!0)});function mae(t,e,r,i){var n=Fl.hasOwnProperty(e)?Fl[e]:null;(n!==null?n.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(JYe(e,r,n,i)&&(r=null),i||n===null?YYe(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):n.mustUseProperty?t[n.propertyName]=r===null?n.type===3?!1:"":r:(e=n.attributeName,i=n.attributeNamespace,r===null?t.removeAttribute(e):(n=n.type,r=n===3||n===4&&r===!0?"":""+r,i?t.setAttributeNS(i,e,r):t.setAttribute(e,r))))}var j_=zAe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,a5=Symbol.for("react.element"),CO=Symbol.for("react.portal"),RO=Symbol.for("react.fragment"),gae=Symbol.for("react.strict_mode"),eK=Symbol.for("react.profiler"),BAe=Symbol.for("react.provider"),jAe=Symbol.for("react.context"),yae=Symbol.for("react.forward_ref"),tK=Symbol.for("react.suspense"),rK=Symbol.for("react.suspense_list"),vae=Symbol.for("react.memo"),Db=Symbol.for("react.lazy"),GAe=Symbol.for("react.offscreen"),Yme=Symbol.iterator;function cM(t){return t===null||typeof t!="object"?null:(t=Yme&&t[Yme]||t["@@iterator"],typeof t=="function"?t:null)}var Zs=Object.assign,sW;function j$(t){if(sW===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);sW=e&&e[1]||""}return`
`+sW+t}var oW=!1;function aW(t,e){if(!t||oW)return"";oW=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var i=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){i=c}t.call(e.prototype)}else{try{throw Error()}catch(c){i=c}t()}}catch(c){if(c&&i&&typeof c.stack=="string"){for(var n=c.stack.split(`
`),s=i.stack.split(`
`),o=n.length-1,a=s.length-1;1<=o&&0<=a&&n[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(n[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||n[o]!==s[a]){var l=`
`+n[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{oW=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?j$(t):""}function KYe(t){switch(t.tag){case 5:return j$(t.type);case 16:return j$("Lazy");case 13:return j$("Suspense");case 19:return j$("SuspenseList");case 0:case 2:case 15:return t=aW(t.type,!1),t;case 11:return t=aW(t.type.render,!1),t;case 1:return t=aW(t.type,!0),t;default:return""}}function iK(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case RO:return"Fragment";case CO:return"Portal";case eK:return"Profiler";case gae:return"StrictMode";case tK:return"Suspense";case rK:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case jAe:return(t.displayName||"Context")+".Consumer";case BAe:return(t._context.displayName||"Context")+".Provider";case yae:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case vae:return e=t.displayName||null,e!==null?e:iK(t.type)||"Memo";case Db:e=t._payload,t=t._init;try{return iK(t(e))}catch{}}return null}function QYe(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return iK(e);case 8:return e===gae?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function jw(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function HAe(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eZe(t){var e=HAe(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),i=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var n=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return n.call(this)},set:function(o){i=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return i},setValue:function(o){i=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function l5(t){t._valueTracker||(t._valueTracker=eZe(t))}function qAe(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),i="";return t&&(i=HAe(t)?t.checked?"true":"false":t.value),t=i,t!==r?(e.setValue(t),!0):!1}function M9(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function nK(t,e){var r=e.checked;return Zs({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function Zme(t,e){var r=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;r=jw(e.value!=null?e.value:r),t._wrapperState={initialChecked:i,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function WAe(t,e){e=e.checked,e!=null&&mae(t,"checked",e,!1)}function sK(t,e){WAe(t,e);var r=jw(e.value),i=e.type;if(r!=null)i==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(i==="submit"||i==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?oK(t,e.type,r):e.hasOwnProperty("defaultValue")&&oK(t,e.type,jw(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Jme(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function oK(t,e,r){(e!=="number"||M9(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var G$=Array.isArray;function cA(t,e,r,i){if(t=t.options,e){e={};for(var n=0;n<r.length;n++)e["$"+r[n]]=!0;for(r=0;r<t.length;r++)n=e.hasOwnProperty("$"+t[r].value),t[r].selected!==n&&(t[r].selected=n),n&&i&&(t[r].defaultSelected=!0)}else{for(r=""+jw(r),e=null,n=0;n<t.length;n++){if(t[n].value===r){t[n].selected=!0,i&&(t[n].defaultSelected=!0);return}e!==null||t[n].disabled||(e=t[n])}e!==null&&(e.selected=!0)}}function aK(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(rt(91));return Zs({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Kme(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(rt(92));if(G$(r)){if(1<r.length)throw Error(rt(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:jw(r)}}function XAe(t,e){var r=jw(e.value),i=jw(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),i!=null&&(t.defaultValue=""+i)}function Qme(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function YAe(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lK(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?YAe(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var c5,ZAe=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,i,n){MSApp.execUnsafeLocalFunction(function(){return t(e,r,i,n)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(c5=c5||document.createElement("div"),c5.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=c5.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function qD(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var IL={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tZe=["Webkit","ms","Moz","O"];Object.keys(IL).forEach(function(t){tZe.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),IL[e]=IL[t]})});function JAe(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||IL.hasOwnProperty(t)&&IL[t]?(""+e).trim():e+"px"}function KAe(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var i=r.indexOf("--")===0,n=JAe(r,e[r],i);r==="float"&&(r="cssFloat"),i?t.setProperty(r,n):t[r]=n}}var rZe=Zs({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function cK(t,e){if(e){if(rZe[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(rt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(rt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(rt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(rt(62))}}function uK(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dK=null;function _ae(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var hK=null,uA=null,dA=null;function ege(t){if(t=C4(t)){if(typeof hK!="function")throw Error(rt(280));var e=t.stateNode;e&&(e=sG(e),hK(t.stateNode,t.type,e))}}function QAe(t){uA?dA?dA.push(t):dA=[t]:uA=t}function ePe(){if(uA){var t=uA,e=dA;if(dA=uA=null,ege(t),e)for(t=0;t<e.length;t++)ege(e[t])}}function tPe(t,e){return t(e)}function rPe(){}var lW=!1;function iPe(t,e,r){if(lW)return t(e,r);lW=!0;try{return tPe(t,e,r)}finally{lW=!1,(uA!==null||dA!==null)&&(rPe(),ePe())}}function WD(t,e){var r=t.stateNode;if(r===null)return null;var i=sG(r);if(i===null)return null;r=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(t=t.type,i=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!i;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(rt(231,e,typeof r));return r}var pK=!1;if(g_)try{var uM={};Object.defineProperty(uM,"passive",{get:function(){pK=!0}}),window.addEventListener("test",uM,uM),window.removeEventListener("test",uM,uM)}catch{pK=!1}function iZe(t,e,r,i,n,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(r,c)}catch(u){this.onError(u)}}var LL=!1,$9=null,I9=!1,fK=null,nZe={onError:function(t){LL=!0,$9=t}};function sZe(t,e,r,i,n,s,o,a,l){LL=!1,$9=null,iZe.apply(nZe,arguments)}function oZe(t,e,r,i,n,s,o,a,l){if(sZe.apply(this,arguments),LL){if(LL){var c=$9;LL=!1,$9=null}else throw Error(rt(198));I9||(I9=!0,fK=c)}}function AE(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function nPe(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function tge(t){if(AE(t)!==t)throw Error(rt(188))}function aZe(t){var e=t.alternate;if(!e){if(e=AE(t),e===null)throw Error(rt(188));return e!==t?null:t}for(var r=t,i=e;;){var n=r.return;if(n===null)break;var s=n.alternate;if(s===null){if(i=n.return,i!==null){r=i;continue}break}if(n.child===s.child){for(s=n.child;s;){if(s===r)return tge(n),t;if(s===i)return tge(n),e;s=s.sibling}throw Error(rt(188))}if(r.return!==i.return)r=n,i=s;else{for(var o=!1,a=n.child;a;){if(a===r){o=!0,r=n,i=s;break}if(a===i){o=!0,i=n,r=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===r){o=!0,r=s,i=n;break}if(a===i){o=!0,i=s,r=n;break}a=a.sibling}if(!o)throw Error(rt(189))}}if(r.alternate!==i)throw Error(rt(190))}if(r.tag!==3)throw Error(rt(188));return r.stateNode.current===r?t:e}function sPe(t){return t=aZe(t),t!==null?oPe(t):null}function oPe(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=oPe(t);if(e!==null)return e;t=t.sibling}return null}var aPe=xh.unstable_scheduleCallback,rge=xh.unstable_cancelCallback,lZe=xh.unstable_shouldYield,cZe=xh.unstable_requestPaint,Fo=xh.unstable_now,uZe=xh.unstable_getCurrentPriorityLevel,bae=xh.unstable_ImmediatePriority,lPe=xh.unstable_UserBlockingPriority,L9=xh.unstable_NormalPriority,dZe=xh.unstable_LowPriority,cPe=xh.unstable_IdlePriority,tG=null,zy=null;function hZe(t){if(zy&&typeof zy.onCommitFiberRoot=="function")try{zy.onCommitFiberRoot(tG,t,void 0,(t.current.flags&128)===128)}catch{}}var qm=Math.clz32?Math.clz32:mZe,pZe=Math.log,fZe=Math.LN2;function mZe(t){return t>>>=0,t===0?32:31-(pZe(t)/fZe|0)|0}var u5=64,d5=4194304;function H$(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function D9(t,e){var r=t.pendingLanes;if(r===0)return 0;var i=0,n=t.suspendedLanes,s=t.pingedLanes,o=r&268435455;if(o!==0){var a=o&~n;a!==0?i=H$(a):(s&=o,s!==0&&(i=H$(s)))}else o=r&~n,o!==0?i=H$(o):s!==0&&(i=H$(s));if(i===0)return 0;if(e!==0&&e!==i&&!(e&n)&&(n=i&-i,s=e&-e,n>=s||n===16&&(s&4194240)!==0))return e;if(i&4&&(i|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=i;0<e;)r=31-qm(e),n=1<<r,i|=t[r],e&=~n;return i}function gZe(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yZe(t,e){for(var r=t.suspendedLanes,i=t.pingedLanes,n=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-qm(s),a=1<<o,l=n[o];l===-1?(!(a&r)||a&i)&&(n[o]=gZe(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function mK(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function uPe(){var t=u5;return u5<<=1,!(u5&4194240)&&(u5=64),t}function cW(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function T4(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-qm(e),t[e]=r}function vZe(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var i=t.eventTimes;for(t=t.expirationTimes;0<r;){var n=31-qm(r),s=1<<n;e[n]=0,i[n]=-1,t[n]=-1,r&=~s}}function wae(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var i=31-qm(r),n=1<<i;n&e|t[i]&e&&(t[i]|=e),r&=~n}}var En=0;function dPe(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var hPe,xae,pPe,fPe,mPe,gK=!1,h5=[],Rw=null,Ow=null,Aw=null,XD=new Map,YD=new Map,Xb=[],_Ze="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ige(t,e){switch(t){case"focusin":case"focusout":Rw=null;break;case"dragenter":case"dragleave":Ow=null;break;case"mouseover":case"mouseout":Aw=null;break;case"pointerover":case"pointerout":XD.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":YD.delete(e.pointerId)}}function dM(t,e,r,i,n,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:i,nativeEvent:s,targetContainers:[n]},e!==null&&(e=C4(e),e!==null&&xae(e)),t):(t.eventSystemFlags|=i,e=t.targetContainers,n!==null&&e.indexOf(n)===-1&&e.push(n),t)}function bZe(t,e,r,i,n){switch(e){case"focusin":return Rw=dM(Rw,t,e,r,i,n),!0;case"dragenter":return Ow=dM(Ow,t,e,r,i,n),!0;case"mouseover":return Aw=dM(Aw,t,e,r,i,n),!0;case"pointerover":var s=n.pointerId;return XD.set(s,dM(XD.get(s)||null,t,e,r,i,n)),!0;case"gotpointercapture":return s=n.pointerId,YD.set(s,dM(YD.get(s)||null,t,e,r,i,n)),!0}return!1}function gPe(t){var e=e2(t.target);if(e!==null){var r=AE(e);if(r!==null){if(e=r.tag,e===13){if(e=nPe(r),e!==null){t.blockedOn=e,mPe(t.priority,function(){pPe(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function i8(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=yK(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var i=new r.constructor(r.type,r);dK=i,r.target.dispatchEvent(i),dK=null}else return e=C4(r),e!==null&&xae(e),t.blockedOn=r,!1;e.shift()}return!0}function nge(t,e,r){i8(t)&&r.delete(e)}function wZe(){gK=!1,Rw!==null&&i8(Rw)&&(Rw=null),Ow!==null&&i8(Ow)&&(Ow=null),Aw!==null&&i8(Aw)&&(Aw=null),XD.forEach(nge),YD.forEach(nge)}function hM(t,e){t.blockedOn===e&&(t.blockedOn=null,gK||(gK=!0,xh.unstable_scheduleCallback(xh.unstable_NormalPriority,wZe)))}function ZD(t){function e(n){return hM(n,t)}if(0<h5.length){hM(h5[0],t);for(var r=1;r<h5.length;r++){var i=h5[r];i.blockedOn===t&&(i.blockedOn=null)}}for(Rw!==null&&hM(Rw,t),Ow!==null&&hM(Ow,t),Aw!==null&&hM(Aw,t),XD.forEach(e),YD.forEach(e),r=0;r<Xb.length;r++)i=Xb[r],i.blockedOn===t&&(i.blockedOn=null);for(;0<Xb.length&&(r=Xb[0],r.blockedOn===null);)gPe(r),r.blockedOn===null&&Xb.shift()}var hA=j_.ReactCurrentBatchConfig,N9=!0;function xZe(t,e,r,i){var n=En,s=hA.transition;hA.transition=null;try{En=1,Sae(t,e,r,i)}finally{En=n,hA.transition=s}}function SZe(t,e,r,i){var n=En,s=hA.transition;hA.transition=null;try{En=4,Sae(t,e,r,i)}finally{En=n,hA.transition=s}}function Sae(t,e,r,i){if(N9){var n=yK(t,e,r,i);if(n===null)_W(t,e,i,F9,r),ige(t,i);else if(bZe(n,t,e,r,i))i.stopPropagation();else if(ige(t,i),e&4&&-1<_Ze.indexOf(t)){for(;n!==null;){var s=C4(n);if(s!==null&&hPe(s),s=yK(t,e,r,i),s===null&&_W(t,e,i,F9,r),s===n)break;n=s}n!==null&&i.stopPropagation()}else _W(t,e,i,null,r)}}var F9=null;function yK(t,e,r,i){if(F9=null,t=_ae(i),t=e2(t),t!==null)if(e=AE(t),e===null)t=null;else if(r=e.tag,r===13){if(t=nPe(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return F9=t,null}function yPe(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uZe()){case bae:return 1;case lPe:return 4;case L9:case dZe:return 16;case cPe:return 536870912;default:return 16}default:return 16}}var sw=null,Tae=null,n8=null;function vPe(){if(n8)return n8;var t,e=Tae,r=e.length,i,n="value"in sw?sw.value:sw.textContent,s=n.length;for(t=0;t<r&&e[t]===n[t];t++);var o=r-t;for(i=1;i<=o&&e[r-i]===n[s-i];i++);return n8=n.slice(t,1<i?1-i:void 0)}function s8(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function p5(){return!0}function sge(){return!1}function Ih(t){function e(r,i,n,s,o){this._reactName=r,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?p5:sge,this.isPropagationStopped=sge,this}return Zs(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=p5)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=p5)},persist:function(){},isPersistent:p5}),e}var f3={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Eae=Ih(f3),E4=Zs({},f3,{view:0,detail:0}),TZe=Ih(E4),uW,dW,pM,rG=Zs({},E4,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cae,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==pM&&(pM&&t.type==="mousemove"?(uW=t.screenX-pM.screenX,dW=t.screenY-pM.screenY):dW=uW=0,pM=t),uW)},movementY:function(t){return"movementY"in t?t.movementY:dW}}),oge=Ih(rG),EZe=Zs({},rG,{dataTransfer:0}),CZe=Ih(EZe),RZe=Zs({},E4,{relatedTarget:0}),hW=Ih(RZe),OZe=Zs({},f3,{animationName:0,elapsedTime:0,pseudoElement:0}),AZe=Ih(OZe),PZe=Zs({},f3,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),MZe=Ih(PZe),$Ze=Zs({},f3,{data:0}),age=Ih($Ze),IZe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},LZe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},DZe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function NZe(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=DZe[t])?!!e[t]:!1}function Cae(){return NZe}var FZe=Zs({},E4,{key:function(t){if(t.key){var e=IZe[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=s8(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?LZe[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cae,charCode:function(t){return t.type==="keypress"?s8(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?s8(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),kZe=Ih(FZe),UZe=Zs({},rG,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),lge=Ih(UZe),zZe=Zs({},E4,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cae}),VZe=Ih(zZe),BZe=Zs({},f3,{propertyName:0,elapsedTime:0,pseudoElement:0}),jZe=Ih(BZe),GZe=Zs({},rG,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),HZe=Ih(GZe),qZe=[9,13,27,32],Rae=g_&&"CompositionEvent"in window,DL=null;g_&&"documentMode"in document&&(DL=document.documentMode);var WZe=g_&&"TextEvent"in window&&!DL,_Pe=g_&&(!Rae||DL&&8<DL&&11>=DL),cge=String.fromCharCode(32),uge=!1;function bPe(t,e){switch(t){case"keyup":return qZe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function wPe(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var OO=!1;function XZe(t,e){switch(t){case"compositionend":return wPe(e);case"keypress":return e.which!==32?null:(uge=!0,cge);case"textInput":return t=e.data,t===cge&&uge?null:t;default:return null}}function YZe(t,e){if(OO)return t==="compositionend"||!Rae&&bPe(t,e)?(t=vPe(),n8=Tae=sw=null,OO=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return _Pe&&e.locale!=="ko"?null:e.data;default:return null}}var ZZe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dge(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!ZZe[t.type]:e==="textarea"}function xPe(t,e,r,i){QAe(i),e=k9(e,"onChange"),0<e.length&&(r=new Eae("onChange","change",null,r,i),t.push({event:r,listeners:e}))}var NL=null,JD=null;function JZe(t){IPe(t,0)}function iG(t){var e=MO(t);if(qAe(e))return t}function KZe(t,e){if(t==="change")return e}var SPe=!1;if(g_){var pW;if(g_){var fW="oninput"in document;if(!fW){var hge=document.createElement("div");hge.setAttribute("oninput","return;"),fW=typeof hge.oninput=="function"}pW=fW}else pW=!1;SPe=pW&&(!document.documentMode||9<document.documentMode)}function pge(){NL&&(NL.detachEvent("onpropertychange",TPe),JD=NL=null)}function TPe(t){if(t.propertyName==="value"&&iG(JD)){var e=[];xPe(e,JD,t,_ae(t)),iPe(JZe,e)}}function QZe(t,e,r){t==="focusin"?(pge(),NL=e,JD=r,NL.attachEvent("onpropertychange",TPe)):t==="focusout"&&pge()}function eJe(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return iG(JD)}function tJe(t,e){if(t==="click")return iG(e)}function rJe(t,e){if(t==="input"||t==="change")return iG(e)}function iJe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var rg=typeof Object.is=="function"?Object.is:iJe;function KD(t,e){if(rg(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(i=0;i<r.length;i++){var n=r[i];if(!QJ.call(e,n)||!rg(t[n],e[n]))return!1}return!0}function fge(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function mge(t,e){var r=fge(t);t=0;for(var i;r;){if(r.nodeType===3){if(i=t+r.textContent.length,t<=e&&i>=e)return{node:r,offset:e-t};t=i}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=fge(r)}}function EPe(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?EPe(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function CPe(){for(var t=window,e=M9();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=M9(t.document)}return e}function Oae(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function nJe(t){var e=CPe(),r=t.focusedElem,i=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&EPe(r.ownerDocument.documentElement,r)){if(i!==null&&Oae(r)){if(e=i.start,t=i.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var n=r.textContent.length,s=Math.min(i.start,n);i=i.end===void 0?s:Math.min(i.end,n),!t.extend&&s>i&&(n=i,i=s,s=n),n=mge(r,s);var o=mge(r,i);n&&o&&(t.rangeCount!==1||t.anchorNode!==n.node||t.anchorOffset!==n.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(n.node,n.offset),t.removeAllRanges(),s>i?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var sJe=g_&&"documentMode"in document&&11>=document.documentMode,AO=null,vK=null,FL=null,_K=!1;function gge(t,e,r){var i=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;_K||AO==null||AO!==M9(i)||(i=AO,"selectionStart"in i&&Oae(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),FL&&KD(FL,i)||(FL=i,i=k9(vK,"onSelect"),0<i.length&&(e=new Eae("onSelect","select",null,e,r),t.push({event:e,listeners:i}),e.target=AO)))}function f5(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var PO={animationend:f5("Animation","AnimationEnd"),animationiteration:f5("Animation","AnimationIteration"),animationstart:f5("Animation","AnimationStart"),transitionend:f5("Transition","TransitionEnd")},mW={},RPe={};g_&&(RPe=document.createElement("div").style,"AnimationEvent"in window||(delete PO.animationend.animation,delete PO.animationiteration.animation,delete PO.animationstart.animation),"TransitionEvent"in window||delete PO.transitionend.transition);function nG(t){if(mW[t])return mW[t];if(!PO[t])return t;var e=PO[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in RPe)return mW[t]=e[r];return t}var OPe=nG("animationend"),APe=nG("animationiteration"),PPe=nG("animationstart"),MPe=nG("transitionend"),$Pe=new Map,yge="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _x(t,e){$Pe.set(t,e),OE(e,[t])}for(var gW=0;gW<yge.length;gW++){var yW=yge[gW],oJe=yW.toLowerCase(),aJe=yW[0].toUpperCase()+yW.slice(1);_x(oJe,"on"+aJe)}_x(OPe,"onAnimationEnd");_x(APe,"onAnimationIteration");_x(PPe,"onAnimationStart");_x("dblclick","onDoubleClick");_x("focusin","onFocus");_x("focusout","onBlur");_x(MPe,"onTransitionEnd");ZA("onMouseEnter",["mouseout","mouseover"]);ZA("onMouseLeave",["mouseout","mouseover"]);ZA("onPointerEnter",["pointerout","pointerover"]);ZA("onPointerLeave",["pointerout","pointerover"]);OE("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));OE("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));OE("onBeforeInput",["compositionend","keypress","textInput","paste"]);OE("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));OE("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));OE("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var q$="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lJe=new Set("cancel close invalid load scroll toggle".split(" ").concat(q$));function vge(t,e,r){var i=t.type||"unknown-event";t.currentTarget=r,oZe(i,e,void 0,t),t.currentTarget=null}function IPe(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var i=t[r],n=i.event;i=i.listeners;e:{var s=void 0;if(e)for(var o=i.length-1;0<=o;o--){var a=i[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&n.isPropagationStopped())break e;vge(n,a,c),s=l}else for(o=0;o<i.length;o++){if(a=i[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&n.isPropagationStopped())break e;vge(n,a,c),s=l}}}if(I9)throw t=fK,I9=!1,fK=null,t}function ds(t,e){var r=e[TK];r===void 0&&(r=e[TK]=new Set);var i=t+"__bubble";r.has(i)||(LPe(e,t,2,!1),r.add(i))}function vW(t,e,r){var i=0;e&&(i|=4),LPe(r,t,i,e)}var m5="_reactListening"+Math.random().toString(36).slice(2);function QD(t){if(!t[m5]){t[m5]=!0,VAe.forEach(function(r){r!=="selectionchange"&&(lJe.has(r)||vW(r,!1,t),vW(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[m5]||(e[m5]=!0,vW("selectionchange",!1,e))}}function LPe(t,e,r,i){switch(yPe(e)){case 1:var n=xZe;break;case 4:n=SZe;break;default:n=Sae}r=n.bind(null,e,r,t),n=void 0,!pK||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(n=!0),i?n!==void 0?t.addEventListener(e,r,{capture:!0,passive:n}):t.addEventListener(e,r,!0):n!==void 0?t.addEventListener(e,r,{passive:n}):t.addEventListener(e,r,!1)}function _W(t,e,r,i,n){var s=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var o=i.tag;if(o===3||o===4){var a=i.stateNode.containerInfo;if(a===n||a.nodeType===8&&a.parentNode===n)break;if(o===4)for(o=i.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===n||l.nodeType===8&&l.parentNode===n))return;o=o.return}for(;a!==null;){if(o=e2(a),o===null)return;if(l=o.tag,l===5||l===6){i=s=o;continue e}a=a.parentNode}}i=i.return}iPe(function(){var c=s,u=_ae(r),h=[];e:{var f=$Pe.get(t);if(f!==void 0){var m=Eae,g=t;switch(t){case"keypress":if(s8(r)===0)break e;case"keydown":case"keyup":m=kZe;break;case"focusin":g="focus",m=hW;break;case"focusout":g="blur",m=hW;break;case"beforeblur":case"afterblur":m=hW;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=oge;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=CZe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=VZe;break;case OPe:case APe:case PPe:m=AZe;break;case MPe:m=jZe;break;case"scroll":m=TZe;break;case"wheel":m=HZe;break;case"copy":case"cut":case"paste":m=MZe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=lge}var y=(e&4)!==0,_=!y&&t==="scroll",b=y?f!==null?f+"Capture":null:f;y=[];for(var w=c,x;w!==null;){x=w;var S=x.stateNode;if(x.tag===5&&S!==null&&(x=S,b!==null&&(S=WD(w,b),S!=null&&y.push(eN(w,S,x)))),_)break;w=w.return}0<y.length&&(f=new m(f,g,null,r,u),h.push({event:f,listeners:y}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&r!==dK&&(g=r.relatedTarget||r.fromElement)&&(e2(g)||g[y_]))break e;if((m||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,m?(g=r.relatedTarget||r.toElement,m=c,g=g?e2(g):null,g!==null&&(_=AE(g),g!==_||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(y=oge,S="onMouseLeave",b="onMouseEnter",w="mouse",(t==="pointerout"||t==="pointerover")&&(y=lge,S="onPointerLeave",b="onPointerEnter",w="pointer"),_=m==null?f:MO(m),x=g==null?f:MO(g),f=new y(S,w+"leave",m,r,u),f.target=_,f.relatedTarget=x,S=null,e2(u)===c&&(y=new y(b,w+"enter",g,r,u),y.target=x,y.relatedTarget=_,S=y),_=S,m&&g)t:{for(y=m,b=g,w=0,x=y;x;x=QE(x))w++;for(x=0,S=b;S;S=QE(S))x++;for(;0<w-x;)y=QE(y),w--;for(;0<x-w;)b=QE(b),x--;for(;w--;){if(y===b||b!==null&&y===b.alternate)break t;y=QE(y),b=QE(b)}y=null}else y=null;m!==null&&_ge(h,f,m,y,!1),g!==null&&_!==null&&_ge(h,_,g,y,!0)}}e:{if(f=c?MO(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var C=KZe;else if(dge(f))if(SPe)C=rJe;else{C=eJe;var E=QZe}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=tJe);if(C&&(C=C(t,c))){xPe(h,C,r,u);break e}E&&E(t,f,c),t==="focusout"&&(E=f._wrapperState)&&E.controlled&&f.type==="number"&&oK(f,"number",f.value)}switch(E=c?MO(c):window,t){case"focusin":(dge(E)||E.contentEditable==="true")&&(AO=E,vK=c,FL=null);break;case"focusout":FL=vK=AO=null;break;case"mousedown":_K=!0;break;case"contextmenu":case"mouseup":case"dragend":_K=!1,gge(h,r,u);break;case"selectionchange":if(sJe)break;case"keydown":case"keyup":gge(h,r,u)}var R;if(Rae)e:{switch(t){case"compositionstart":var P="onCompositionStart";break e;case"compositionend":P="onCompositionEnd";break e;case"compositionupdate":P="onCompositionUpdate";break e}P=void 0}else OO?bPe(t,r)&&(P="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(P="onCompositionStart");P&&(_Pe&&r.locale!=="ko"&&(OO||P!=="onCompositionStart"?P==="onCompositionEnd"&&OO&&(R=vPe()):(sw=u,Tae="value"in sw?sw.value:sw.textContent,OO=!0)),E=k9(c,P),0<E.length&&(P=new age(P,t,null,r,u),h.push({event:P,listeners:E}),R?P.data=R:(R=wPe(r),R!==null&&(P.data=R)))),(R=WZe?XZe(t,r):YZe(t,r))&&(c=k9(c,"onBeforeInput"),0<c.length&&(u=new age("onBeforeInput","beforeinput",null,r,u),h.push({event:u,listeners:c}),u.data=R))}IPe(h,e)})}function eN(t,e,r){return{instance:t,listener:e,currentTarget:r}}function k9(t,e){for(var r=e+"Capture",i=[];t!==null;){var n=t,s=n.stateNode;n.tag===5&&s!==null&&(n=s,s=WD(t,r),s!=null&&i.unshift(eN(t,s,n)),s=WD(t,e),s!=null&&i.push(eN(t,s,n))),t=t.return}return i}function QE(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function _ge(t,e,r,i,n){for(var s=e._reactName,o=[];r!==null&&r!==i;){var a=r,l=a.alternate,c=a.stateNode;if(l!==null&&l===i)break;a.tag===5&&c!==null&&(a=c,n?(l=WD(r,s),l!=null&&o.unshift(eN(r,l,a))):n||(l=WD(r,s),l!=null&&o.push(eN(r,l,a)))),r=r.return}o.length!==0&&t.push({event:e,listeners:o})}var cJe=/\r\n?/g,uJe=/\u0000|\uFFFD/g;function bge(t){return(typeof t=="string"?t:""+t).replace(cJe,`
`).replace(uJe,"")}function g5(t,e,r){if(e=bge(e),bge(t)!==e&&r)throw Error(rt(425))}function U9(){}var bK=null,wK=null;function xK(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var SK=typeof setTimeout=="function"?setTimeout:void 0,dJe=typeof clearTimeout=="function"?clearTimeout:void 0,wge=typeof Promise=="function"?Promise:void 0,hJe=typeof queueMicrotask=="function"?queueMicrotask:typeof wge<"u"?function(t){return wge.resolve(null).then(t).catch(pJe)}:SK;function pJe(t){setTimeout(function(){throw t})}function bW(t,e){var r=e,i=0;do{var n=r.nextSibling;if(t.removeChild(r),n&&n.nodeType===8)if(r=n.data,r==="/$"){if(i===0){t.removeChild(n),ZD(e);return}i--}else r!=="$"&&r!=="$?"&&r!=="$!"||i++;r=n}while(r);ZD(e)}function Pw(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function xge(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var m3=Math.random().toString(36).slice(2),Ey="__reactFiber$"+m3,tN="__reactProps$"+m3,y_="__reactContainer$"+m3,TK="__reactEvents$"+m3,fJe="__reactListeners$"+m3,mJe="__reactHandles$"+m3;function e2(t){var e=t[Ey];if(e)return e;for(var r=t.parentNode;r;){if(e=r[y_]||r[Ey]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=xge(t);t!==null;){if(r=t[Ey])return r;t=xge(t)}return e}t=r,r=t.parentNode}return null}function C4(t){return t=t[Ey]||t[y_],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function MO(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(rt(33))}function sG(t){return t[tN]||null}var EK=[],$O=-1;function bx(t){return{current:t}}function Ss(t){0>$O||(t.current=EK[$O],EK[$O]=null,$O--)}function ss(t,e){$O++,EK[$O]=t.current,t.current=e}var Gw={},Cc=bx(Gw),cd=bx(!1),N2=Gw;function JA(t,e){var r=t.type.contextTypes;if(!r)return Gw;var i=t.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var n={},s;for(s in r)n[s]=e[s];return i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=n),n}function ud(t){return t=t.childContextTypes,t!=null}function z9(){Ss(cd),Ss(Cc)}function Sge(t,e,r){if(Cc.current!==Gw)throw Error(rt(168));ss(Cc,e),ss(cd,r)}function DPe(t,e,r){var i=t.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return r;i=i.getChildContext();for(var n in i)if(!(n in e))throw Error(rt(108,QYe(t)||"Unknown",n));return Zs({},r,i)}function V9(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Gw,N2=Cc.current,ss(Cc,t),ss(cd,cd.current),!0}function Tge(t,e,r){var i=t.stateNode;if(!i)throw Error(rt(169));r?(t=DPe(t,e,N2),i.__reactInternalMemoizedMergedChildContext=t,Ss(cd),Ss(Cc),ss(Cc,t)):Ss(cd),ss(cd,r)}var Lv=null,oG=!1,wW=!1;function NPe(t){Lv===null?Lv=[t]:Lv.push(t)}function gJe(t){oG=!0,NPe(t)}function wx(){if(!wW&&Lv!==null){wW=!0;var t=0,e=En;try{var r=Lv;for(En=1;t<r.length;t++){var i=r[t];do i=i(!0);while(i!==null)}Lv=null,oG=!1}catch(n){throw Lv!==null&&(Lv=Lv.slice(t+1)),aPe(bae,wx),n}finally{En=e,wW=!1}}return null}var IO=[],LO=0,B9=null,j9=0,Cp=[],Rp=0,F2=null,Bv=1,jv="";function SS(t,e){IO[LO++]=j9,IO[LO++]=B9,B9=t,j9=e}function FPe(t,e,r){Cp[Rp++]=Bv,Cp[Rp++]=jv,Cp[Rp++]=F2,F2=t;var i=Bv;t=jv;var n=32-qm(i)-1;i&=~(1<<n),r+=1;var s=32-qm(e)+n;if(30<s){var o=n-n%5;s=(i&(1<<o)-1).toString(32),i>>=o,n-=o,Bv=1<<32-qm(e)+n|r<<n|i,jv=s+t}else Bv=1<<s|r<<n|i,jv=t}function Aae(t){t.return!==null&&(SS(t,1),FPe(t,1,0))}function Pae(t){for(;t===B9;)B9=IO[--LO],IO[LO]=null,j9=IO[--LO],IO[LO]=null;for(;t===F2;)F2=Cp[--Rp],Cp[Rp]=null,jv=Cp[--Rp],Cp[Rp]=null,Bv=Cp[--Rp],Cp[Rp]=null}var fh=null,dh=null,Ls=!1,Em=null;function kPe(t,e){var r=kp(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function Ege(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,fh=t,dh=Pw(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,fh=t,dh=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=F2!==null?{id:Bv,overflow:jv}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=kp(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,fh=t,dh=null,!0):!1;default:return!1}}function CK(t){return(t.mode&1)!==0&&(t.flags&128)===0}function RK(t){if(Ls){var e=dh;if(e){var r=e;if(!Ege(t,e)){if(CK(t))throw Error(rt(418));e=Pw(r.nextSibling);var i=fh;e&&Ege(t,e)?kPe(i,r):(t.flags=t.flags&-4097|2,Ls=!1,fh=t)}}else{if(CK(t))throw Error(rt(418));t.flags=t.flags&-4097|2,Ls=!1,fh=t}}}function Cge(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;fh=t}function y5(t){if(t!==fh)return!1;if(!Ls)return Cge(t),Ls=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!xK(t.type,t.memoizedProps)),e&&(e=dh)){if(CK(t))throw UPe(),Error(rt(418));for(;e;)kPe(t,e),e=Pw(e.nextSibling)}if(Cge(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(rt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){dh=Pw(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}dh=null}}else dh=fh?Pw(t.stateNode.nextSibling):null;return!0}function UPe(){for(var t=dh;t;)t=Pw(t.nextSibling)}function KA(){dh=fh=null,Ls=!1}function Mae(t){Em===null?Em=[t]:Em.push(t)}var yJe=j_.ReactCurrentBatchConfig;function gm(t,e){if(t&&t.defaultProps){e=Zs({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}var G9=bx(null),H9=null,DO=null,$ae=null;function Iae(){$ae=DO=H9=null}function Lae(t){var e=G9.current;Ss(G9),t._currentValue=e}function OK(t,e,r){for(;t!==null;){var i=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),t===r)break;t=t.return}}function pA(t,e){H9=t,$ae=DO=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(td=!0),t.firstContext=null)}function Kp(t){var e=t._currentValue;if($ae!==t)if(t={context:t,memoizedValue:e,next:null},DO===null){if(H9===null)throw Error(rt(308));DO=t,H9.dependencies={lanes:0,firstContext:t}}else DO=DO.next=t;return e}var t2=null;function Dae(t){t2===null?t2=[t]:t2.push(t)}function zPe(t,e,r,i){var n=e.interleaved;return n===null?(r.next=r,Dae(e)):(r.next=n.next,n.next=r),e.interleaved=r,v_(t,i)}function v_(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Nb=!1;function Nae(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function VPe(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Jv(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Mw(t,e,r){var i=t.updateQueue;if(i===null)return null;if(i=i.shared,ji&2){var n=i.pending;return n===null?e.next=e:(e.next=n.next,n.next=e),i.pending=e,v_(t,r)}return n=i.interleaved,n===null?(e.next=e,Dae(i)):(e.next=n.next,n.next=e),i.interleaved=e,v_(t,r)}function o8(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,wae(t,r)}}function Rge(t,e){var r=t.updateQueue,i=t.alternate;if(i!==null&&(i=i.updateQueue,r===i)){var n=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?n=s=o:s=s.next=o,r=r.next}while(r!==null);s===null?n=s=e:s=s.next=e}else n=s=e;r={baseState:i.baseState,firstBaseUpdate:n,lastBaseUpdate:s,shared:i.shared,effects:i.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function q9(t,e,r,i){var n=t.updateQueue;Nb=!1;var s=n.firstBaseUpdate,o=n.lastBaseUpdate,a=n.shared.pending;if(a!==null){n.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=n.baseState;o=0,u=c=l=null,a=s;do{var f=a.lane,m=a.eventTime;if((i&f)===f){u!==null&&(u=u.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,y=a;switch(f=e,m=r,y.tag){case 1:if(g=y.payload,typeof g=="function"){h=g.call(m,h,f);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,f=typeof g=="function"?g.call(m,h,f):g,f==null)break e;h=Zs({},h,f);break e;case 2:Nb=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=n.effects,f===null?n.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=m,l=h):u=u.next=m,o|=f;if(a=a.next,a===null){if(a=n.shared.pending,a===null)break;f=a,a=f.next,f.next=null,n.lastBaseUpdate=f,n.shared.pending=null}}while(1);if(u===null&&(l=h),n.baseState=l,n.firstBaseUpdate=c,n.lastBaseUpdate=u,e=n.shared.interleaved,e!==null){n=e;do o|=n.lane,n=n.next;while(n!==e)}else s===null&&(n.shared.lanes=0);U2|=o,t.lanes=o,t.memoizedState=h}}function Oge(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var i=t[e],n=i.callback;if(n!==null){if(i.callback=null,i=r,typeof n!="function")throw Error(rt(191,n));n.call(i)}}}var BPe=new zAe.Component().refs;function AK(t,e,r,i){e=t.memoizedState,r=r(i,e),r=r==null?e:Zs({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var aG={isMounted:function(t){return(t=t._reactInternals)?AE(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var i=su(),n=Iw(t),s=Jv(i,n);s.payload=e,r!=null&&(s.callback=r),e=Mw(t,s,n),e!==null&&(Wm(e,t,n,i),o8(e,t,n))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var i=su(),n=Iw(t),s=Jv(i,n);s.tag=1,s.payload=e,r!=null&&(s.callback=r),e=Mw(t,s,n),e!==null&&(Wm(e,t,n,i),o8(e,t,n))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=su(),i=Iw(t),n=Jv(r,i);n.tag=2,e!=null&&(n.callback=e),e=Mw(t,n,i),e!==null&&(Wm(e,t,i,r),o8(e,t,i))}};function Age(t,e,r,i,n,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(i,s,o):e.prototype&&e.prototype.isPureReactComponent?!KD(r,i)||!KD(n,s):!0}function jPe(t,e,r){var i=!1,n=Gw,s=e.contextType;return typeof s=="object"&&s!==null?s=Kp(s):(n=ud(e)?N2:Cc.current,i=e.contextTypes,s=(i=i!=null)?JA(t,n):Gw),e=new e(r,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=aG,t.stateNode=e,e._reactInternals=t,i&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=s),e}function Pge(t,e,r,i){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,i),e.state!==t&&aG.enqueueReplaceState(e,e.state,null)}function PK(t,e,r,i){var n=t.stateNode;n.props=r,n.state=t.memoizedState,n.refs=BPe,Nae(t);var s=e.contextType;typeof s=="object"&&s!==null?n.context=Kp(s):(s=ud(e)?N2:Cc.current,n.context=JA(t,s)),n.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(AK(t,e,s,r),n.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(e=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),e!==n.state&&aG.enqueueReplaceState(n,n.state,null),q9(t,r,n,i),n.state=t.memoizedState),typeof n.componentDidMount=="function"&&(t.flags|=4194308)}function fM(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(rt(309));var i=r.stateNode}if(!i)throw Error(rt(147,t));var n=i,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=n.refs;a===BPe&&(a=n.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(rt(284));if(!r._owner)throw Error(rt(290,t))}return t}function v5(t,e){throw t=Object.prototype.toString.call(e),Error(rt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Mge(t){var e=t._init;return e(t._payload)}function GPe(t){function e(b,w){if(t){var x=b.deletions;x===null?(b.deletions=[w],b.flags|=16):x.push(w)}}function r(b,w){if(!t)return null;for(;w!==null;)e(b,w),w=w.sibling;return null}function i(b,w){for(b=new Map;w!==null;)w.key!==null?b.set(w.key,w):b.set(w.index,w),w=w.sibling;return b}function n(b,w){return b=Lw(b,w),b.index=0,b.sibling=null,b}function s(b,w,x){return b.index=x,t?(x=b.alternate,x!==null?(x=x.index,x<w?(b.flags|=2,w):x):(b.flags|=2,w)):(b.flags|=1048576,w)}function o(b){return t&&b.alternate===null&&(b.flags|=2),b}function a(b,w,x,S){return w===null||w.tag!==6?(w=OW(x,b.mode,S),w.return=b,w):(w=n(w,x),w.return=b,w)}function l(b,w,x,S){var C=x.type;return C===RO?u(b,w,x.props.children,S,x.key):w!==null&&(w.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Db&&Mge(C)===w.type)?(S=n(w,x.props),S.ref=fM(b,w,x),S.return=b,S):(S=h8(x.type,x.key,x.props,null,b.mode,S),S.ref=fM(b,w,x),S.return=b,S)}function c(b,w,x,S){return w===null||w.tag!==4||w.stateNode.containerInfo!==x.containerInfo||w.stateNode.implementation!==x.implementation?(w=AW(x,b.mode,S),w.return=b,w):(w=n(w,x.children||[]),w.return=b,w)}function u(b,w,x,S,C){return w===null||w.tag!==7?(w=m2(x,b.mode,S,C),w.return=b,w):(w=n(w,x),w.return=b,w)}function h(b,w,x){if(typeof w=="string"&&w!==""||typeof w=="number")return w=OW(""+w,b.mode,x),w.return=b,w;if(typeof w=="object"&&w!==null){switch(w.$$typeof){case a5:return x=h8(w.type,w.key,w.props,null,b.mode,x),x.ref=fM(b,null,w),x.return=b,x;case CO:return w=AW(w,b.mode,x),w.return=b,w;case Db:var S=w._init;return h(b,S(w._payload),x)}if(G$(w)||cM(w))return w=m2(w,b.mode,x,null),w.return=b,w;v5(b,w)}return null}function f(b,w,x,S){var C=w!==null?w.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return C!==null?null:a(b,w,""+x,S);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case a5:return x.key===C?l(b,w,x,S):null;case CO:return x.key===C?c(b,w,x,S):null;case Db:return C=x._init,f(b,w,C(x._payload),S)}if(G$(x)||cM(x))return C!==null?null:u(b,w,x,S,null);v5(b,x)}return null}function m(b,w,x,S,C){if(typeof S=="string"&&S!==""||typeof S=="number")return b=b.get(x)||null,a(w,b,""+S,C);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case a5:return b=b.get(S.key===null?x:S.key)||null,l(w,b,S,C);case CO:return b=b.get(S.key===null?x:S.key)||null,c(w,b,S,C);case Db:var E=S._init;return m(b,w,x,E(S._payload),C)}if(G$(S)||cM(S))return b=b.get(x)||null,u(w,b,S,C,null);v5(w,S)}return null}function g(b,w,x,S){for(var C=null,E=null,R=w,P=w=0,D=null;R!==null&&P<x.length;P++){R.index>P?(D=R,R=null):D=R.sibling;var L=f(b,R,x[P],S);if(L===null){R===null&&(R=D);break}t&&R&&L.alternate===null&&e(b,R),w=s(L,w,P),E===null?C=L:E.sibling=L,E=L,R=D}if(P===x.length)return r(b,R),Ls&&SS(b,P),C;if(R===null){for(;P<x.length;P++)R=h(b,x[P],S),R!==null&&(w=s(R,w,P),E===null?C=R:E.sibling=R,E=R);return Ls&&SS(b,P),C}for(R=i(b,R);P<x.length;P++)D=m(R,b,P,x[P],S),D!==null&&(t&&D.alternate!==null&&R.delete(D.key===null?P:D.key),w=s(D,w,P),E===null?C=D:E.sibling=D,E=D);return t&&R.forEach(function(k){return e(b,k)}),Ls&&SS(b,P),C}function y(b,w,x,S){var C=cM(x);if(typeof C!="function")throw Error(rt(150));if(x=C.call(x),x==null)throw Error(rt(151));for(var E=C=null,R=w,P=w=0,D=null,L=x.next();R!==null&&!L.done;P++,L=x.next()){R.index>P?(D=R,R=null):D=R.sibling;var k=f(b,R,L.value,S);if(k===null){R===null&&(R=D);break}t&&R&&k.alternate===null&&e(b,R),w=s(k,w,P),E===null?C=k:E.sibling=k,E=k,R=D}if(L.done)return r(b,R),Ls&&SS(b,P),C;if(R===null){for(;!L.done;P++,L=x.next())L=h(b,L.value,S),L!==null&&(w=s(L,w,P),E===null?C=L:E.sibling=L,E=L);return Ls&&SS(b,P),C}for(R=i(b,R);!L.done;P++,L=x.next())L=m(R,b,P,L.value,S),L!==null&&(t&&L.alternate!==null&&R.delete(L.key===null?P:L.key),w=s(L,w,P),E===null?C=L:E.sibling=L,E=L);return t&&R.forEach(function(V){return e(b,V)}),Ls&&SS(b,P),C}function _(b,w,x,S){if(typeof x=="object"&&x!==null&&x.type===RO&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case a5:e:{for(var C=x.key,E=w;E!==null;){if(E.key===C){if(C=x.type,C===RO){if(E.tag===7){r(b,E.sibling),w=n(E,x.props.children),w.return=b,b=w;break e}}else if(E.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Db&&Mge(C)===E.type){r(b,E.sibling),w=n(E,x.props),w.ref=fM(b,E,x),w.return=b,b=w;break e}r(b,E);break}else e(b,E);E=E.sibling}x.type===RO?(w=m2(x.props.children,b.mode,S,x.key),w.return=b,b=w):(S=h8(x.type,x.key,x.props,null,b.mode,S),S.ref=fM(b,w,x),S.return=b,b=S)}return o(b);case CO:e:{for(E=x.key;w!==null;){if(w.key===E)if(w.tag===4&&w.stateNode.containerInfo===x.containerInfo&&w.stateNode.implementation===x.implementation){r(b,w.sibling),w=n(w,x.children||[]),w.return=b,b=w;break e}else{r(b,w);break}else e(b,w);w=w.sibling}w=AW(x,b.mode,S),w.return=b,b=w}return o(b);case Db:return E=x._init,_(b,w,E(x._payload),S)}if(G$(x))return g(b,w,x,S);if(cM(x))return y(b,w,x,S);v5(b,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,w!==null&&w.tag===6?(r(b,w.sibling),w=n(w,x),w.return=b,b=w):(r(b,w),w=OW(x,b.mode,S),w.return=b,b=w),o(b)):r(b,w)}return _}var QA=GPe(!0),HPe=GPe(!1),R4={},Vy=bx(R4),rN=bx(R4),iN=bx(R4);function r2(t){if(t===R4)throw Error(rt(174));return t}function Fae(t,e){switch(ss(iN,e),ss(rN,t),ss(Vy,R4),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:lK(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=lK(e,t)}Ss(Vy),ss(Vy,e)}function eP(){Ss(Vy),Ss(rN),Ss(iN)}function qPe(t){r2(iN.current);var e=r2(Vy.current),r=lK(e,t.type);e!==r&&(ss(rN,t),ss(Vy,r))}function kae(t){rN.current===t&&(Ss(Vy),Ss(rN))}var Ws=bx(0);function W9(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xW=[];function Uae(){for(var t=0;t<xW.length;t++)xW[t]._workInProgressVersionPrimary=null;xW.length=0}var a8=j_.ReactCurrentDispatcher,SW=j_.ReactCurrentBatchConfig,k2=0,Xs=null,Ca=null,Ka=null,X9=!1,kL=!1,nN=0,vJe=0;function ql(){throw Error(rt(321))}function zae(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!rg(t[r],e[r]))return!1;return!0}function Vae(t,e,r,i,n,s){if(k2=s,Xs=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,a8.current=t===null||t.memoizedState===null?xJe:SJe,t=r(i,n),kL){s=0;do{if(kL=!1,nN=0,25<=s)throw Error(rt(301));s+=1,Ka=Ca=null,e.updateQueue=null,a8.current=TJe,t=r(i,n)}while(kL)}if(a8.current=Y9,e=Ca!==null&&Ca.next!==null,k2=0,Ka=Ca=Xs=null,X9=!1,e)throw Error(rt(300));return t}function Bae(){var t=nN!==0;return nN=0,t}function gy(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ka===null?Xs.memoizedState=Ka=t:Ka=Ka.next=t,Ka}function Qp(){if(Ca===null){var t=Xs.alternate;t=t!==null?t.memoizedState:null}else t=Ca.next;var e=Ka===null?Xs.memoizedState:Ka.next;if(e!==null)Ka=e,Ca=t;else{if(t===null)throw Error(rt(310));Ca=t,t={memoizedState:Ca.memoizedState,baseState:Ca.baseState,baseQueue:Ca.baseQueue,queue:Ca.queue,next:null},Ka===null?Xs.memoizedState=Ka=t:Ka=Ka.next=t}return Ka}function sN(t,e){return typeof e=="function"?e(t):e}function TW(t){var e=Qp(),r=e.queue;if(r===null)throw Error(rt(311));r.lastRenderedReducer=t;var i=Ca,n=i.baseQueue,s=r.pending;if(s!==null){if(n!==null){var o=n.next;n.next=s.next,s.next=o}i.baseQueue=n=s,r.pending=null}if(n!==null){s=n.next,i=i.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((k2&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),i=c.hasEagerState?c.eagerState:t(i,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=i):l=l.next=h,Xs.lanes|=u,U2|=u}c=c.next}while(c!==null&&c!==s);l===null?o=i:l.next=a,rg(i,e.memoizedState)||(td=!0),e.memoizedState=i,e.baseState=o,e.baseQueue=l,r.lastRenderedState=i}if(t=r.interleaved,t!==null){n=t;do s=n.lane,Xs.lanes|=s,U2|=s,n=n.next;while(n!==t)}else n===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function EW(t){var e=Qp(),r=e.queue;if(r===null)throw Error(rt(311));r.lastRenderedReducer=t;var i=r.dispatch,n=r.pending,s=e.memoizedState;if(n!==null){r.pending=null;var o=n=n.next;do s=t(s,o.action),o=o.next;while(o!==n);rg(s,e.memoizedState)||(td=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),r.lastRenderedState=s}return[s,i]}function WPe(){}function XPe(t,e){var r=Xs,i=Qp(),n=e(),s=!rg(i.memoizedState,n);if(s&&(i.memoizedState=n,td=!0),i=i.queue,jae(JPe.bind(null,r,i,t),[t]),i.getSnapshot!==e||s||Ka!==null&&Ka.memoizedState.tag&1){if(r.flags|=2048,oN(9,ZPe.bind(null,r,i,n,e),void 0,null),al===null)throw Error(rt(349));k2&30||YPe(r,e,n)}return n}function YPe(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Xs.updateQueue,e===null?(e={lastEffect:null,stores:null},Xs.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function ZPe(t,e,r,i){e.value=r,e.getSnapshot=i,KPe(e)&&QPe(t)}function JPe(t,e,r){return r(function(){KPe(e)&&QPe(t)})}function KPe(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!rg(t,r)}catch{return!0}}function QPe(t){var e=v_(t,1);e!==null&&Wm(e,t,1,-1)}function $ge(t){var e=gy();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sN,lastRenderedState:t},e.queue=t,t=t.dispatch=wJe.bind(null,Xs,t),[e.memoizedState,t]}function oN(t,e,r,i){return t={tag:t,create:e,destroy:r,deps:i,next:null},e=Xs.updateQueue,e===null?(e={lastEffect:null,stores:null},Xs.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(i=r.next,r.next=t,t.next=i,e.lastEffect=t)),t}function e3e(){return Qp().memoizedState}function l8(t,e,r,i){var n=gy();Xs.flags|=t,n.memoizedState=oN(1|e,r,void 0,i===void 0?null:i)}function lG(t,e,r,i){var n=Qp();i=i===void 0?null:i;var s=void 0;if(Ca!==null){var o=Ca.memoizedState;if(s=o.destroy,i!==null&&zae(i,o.deps)){n.memoizedState=oN(e,r,s,i);return}}Xs.flags|=t,n.memoizedState=oN(1|e,r,s,i)}function Ige(t,e){return l8(8390656,8,t,e)}function jae(t,e){return lG(2048,8,t,e)}function t3e(t,e){return lG(4,2,t,e)}function r3e(t,e){return lG(4,4,t,e)}function i3e(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function n3e(t,e,r){return r=r!=null?r.concat([t]):null,lG(4,4,i3e.bind(null,e,t),r)}function Gae(){}function s3e(t,e){var r=Qp();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&zae(e,i[1])?i[0]:(r.memoizedState=[t,e],t)}function o3e(t,e){var r=Qp();e=e===void 0?null:e;var i=r.memoizedState;return i!==null&&e!==null&&zae(e,i[1])?i[0]:(t=t(),r.memoizedState=[t,e],t)}function a3e(t,e,r){return k2&21?(rg(r,e)||(r=uPe(),Xs.lanes|=r,U2|=r,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,td=!0),t.memoizedState=r)}function _Je(t,e){var r=En;En=r!==0&&4>r?r:4,t(!0);var i=SW.transition;SW.transition={};try{t(!1),e()}finally{En=r,SW.transition=i}}function l3e(){return Qp().memoizedState}function bJe(t,e,r){var i=Iw(t);if(r={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null},c3e(t))u3e(e,r);else if(r=zPe(t,e,r,i),r!==null){var n=su();Wm(r,t,i,n),d3e(r,e,i)}}function wJe(t,e,r){var i=Iw(t),n={lane:i,action:r,hasEagerState:!1,eagerState:null,next:null};if(c3e(t))u3e(e,n);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,r);if(n.hasEagerState=!0,n.eagerState=a,rg(a,o)){var l=e.interleaved;l===null?(n.next=n,Dae(e)):(n.next=l.next,l.next=n),e.interleaved=n;return}}catch{}finally{}r=zPe(t,e,n,i),r!==null&&(n=su(),Wm(r,t,i,n),d3e(r,e,i))}}function c3e(t){var e=t.alternate;return t===Xs||e!==null&&e===Xs}function u3e(t,e){kL=X9=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function d3e(t,e,r){if(r&4194240){var i=e.lanes;i&=t.pendingLanes,r|=i,e.lanes=r,wae(t,r)}}var Y9={readContext:Kp,useCallback:ql,useContext:ql,useEffect:ql,useImperativeHandle:ql,useInsertionEffect:ql,useLayoutEffect:ql,useMemo:ql,useReducer:ql,useRef:ql,useState:ql,useDebugValue:ql,useDeferredValue:ql,useTransition:ql,useMutableSource:ql,useSyncExternalStore:ql,useId:ql,unstable_isNewReconciler:!1},xJe={readContext:Kp,useCallback:function(t,e){return gy().memoizedState=[t,e===void 0?null:e],t},useContext:Kp,useEffect:Ige,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,l8(4194308,4,i3e.bind(null,e,t),r)},useLayoutEffect:function(t,e){return l8(4194308,4,t,e)},useInsertionEffect:function(t,e){return l8(4,2,t,e)},useMemo:function(t,e){var r=gy();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var i=gy();return e=r!==void 0?r(e):e,i.memoizedState=i.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},i.queue=t,t=t.dispatch=bJe.bind(null,Xs,t),[i.memoizedState,t]},useRef:function(t){var e=gy();return t={current:t},e.memoizedState=t},useState:$ge,useDebugValue:Gae,useDeferredValue:function(t){return gy().memoizedState=t},useTransition:function(){var t=$ge(!1),e=t[0];return t=_Je.bind(null,t[1]),gy().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var i=Xs,n=gy();if(Ls){if(r===void 0)throw Error(rt(407));r=r()}else{if(r=e(),al===null)throw Error(rt(349));k2&30||YPe(i,e,r)}n.memoizedState=r;var s={value:r,getSnapshot:e};return n.queue=s,Ige(JPe.bind(null,i,s,t),[t]),i.flags|=2048,oN(9,ZPe.bind(null,i,s,r,e),void 0,null),r},useId:function(){var t=gy(),e=al.identifierPrefix;if(Ls){var r=jv,i=Bv;r=(i&~(1<<32-qm(i)-1)).toString(32)+r,e=":"+e+"R"+r,r=nN++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=vJe++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},SJe={readContext:Kp,useCallback:s3e,useContext:Kp,useEffect:jae,useImperativeHandle:n3e,useInsertionEffect:t3e,useLayoutEffect:r3e,useMemo:o3e,useReducer:TW,useRef:e3e,useState:function(){return TW(sN)},useDebugValue:Gae,useDeferredValue:function(t){var e=Qp();return a3e(e,Ca.memoizedState,t)},useTransition:function(){var t=TW(sN)[0],e=Qp().memoizedState;return[t,e]},useMutableSource:WPe,useSyncExternalStore:XPe,useId:l3e,unstable_isNewReconciler:!1},TJe={readContext:Kp,useCallback:s3e,useContext:Kp,useEffect:jae,useImperativeHandle:n3e,useInsertionEffect:t3e,useLayoutEffect:r3e,useMemo:o3e,useReducer:EW,useRef:e3e,useState:function(){return EW(sN)},useDebugValue:Gae,useDeferredValue:function(t){var e=Qp();return Ca===null?e.memoizedState=t:a3e(e,Ca.memoizedState,t)},useTransition:function(){var t=EW(sN)[0],e=Qp().memoizedState;return[t,e]},useMutableSource:WPe,useSyncExternalStore:XPe,useId:l3e,unstable_isNewReconciler:!1};function tP(t,e){try{var r="",i=e;do r+=KYe(i),i=i.return;while(i);var n=r}catch(s){n=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:n,digest:null}}function CW(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function MK(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var EJe=typeof WeakMap=="function"?WeakMap:Map;function h3e(t,e,r){r=Jv(-1,r),r.tag=3,r.payload={element:null};var i=e.value;return r.callback=function(){J9||(J9=!0,VK=i),MK(t,e)},r}function p3e(t,e,r){r=Jv(-1,r),r.tag=3;var i=t.type.getDerivedStateFromError;if(typeof i=="function"){var n=e.value;r.payload=function(){return i(n)},r.callback=function(){MK(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){MK(t,e),typeof i!="function"&&($w===null?$w=new Set([this]):$w.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),r}function Lge(t,e,r){var i=t.pingCache;if(i===null){i=t.pingCache=new EJe;var n=new Set;i.set(e,n)}else n=i.get(e),n===void 0&&(n=new Set,i.set(e,n));n.has(r)||(n.add(r),t=UJe.bind(null,t,e,r),e.then(t,t))}function Dge(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Nge(t,e,r,i,n){return t.mode&1?(t.flags|=65536,t.lanes=n,t):(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Jv(-1,1),e.tag=2,Mw(r,e,1))),r.lanes|=1),t)}var CJe=j_.ReactCurrentOwner,td=!1;function Jc(t,e,r,i){e.child=t===null?HPe(e,null,r,i):QA(e,t.child,r,i)}function Fge(t,e,r,i,n){r=r.render;var s=e.ref;return pA(e,n),i=Vae(t,e,r,i,s,n),r=Bae(),t!==null&&!td?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,__(t,e,n)):(Ls&&r&&Aae(e),e.flags|=1,Jc(t,e,i,n),e.child)}function kge(t,e,r,i,n){if(t===null){var s=r.type;return typeof s=="function"&&!Kae(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=s,f3e(t,e,s,i,n)):(t=h8(r.type,null,i,e,e.mode,n),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&n)){var o=s.memoizedProps;if(r=r.compare,r=r!==null?r:KD,r(o,i)&&t.ref===e.ref)return __(t,e,n)}return e.flags|=1,t=Lw(s,i),t.ref=e.ref,t.return=e,e.child=t}function f3e(t,e,r,i,n){if(t!==null){var s=t.memoizedProps;if(KD(s,i)&&t.ref===e.ref)if(td=!1,e.pendingProps=i=s,(t.lanes&n)!==0)t.flags&131072&&(td=!0);else return e.lanes=t.lanes,__(t,e,n)}return $K(t,e,r,i,n)}function m3e(t,e,r){var i=e.pendingProps,n=i.children,s=t!==null?t.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ss(FO,Zd),Zd|=r;else{if(!(r&1073741824))return t=s!==null?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ss(FO,Zd),Zd|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=s!==null?s.baseLanes:r,ss(FO,Zd),Zd|=i}else s!==null?(i=s.baseLanes|r,e.memoizedState=null):i=r,ss(FO,Zd),Zd|=i;return Jc(t,e,n,r),e.child}function g3e(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function $K(t,e,r,i,n){var s=ud(r)?N2:Cc.current;return s=JA(e,s),pA(e,n),r=Vae(t,e,r,i,s,n),i=Bae(),t!==null&&!td?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~n,__(t,e,n)):(Ls&&i&&Aae(e),e.flags|=1,Jc(t,e,r,n),e.child)}function Uge(t,e,r,i,n){if(ud(r)){var s=!0;V9(e)}else s=!1;if(pA(e,n),e.stateNode===null)c8(t,e),jPe(e,r,i),PK(e,r,i,n),i=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=r.contextType;typeof c=="object"&&c!==null?c=Kp(c):(c=ud(r)?N2:Cc.current,c=JA(e,c));var u=r.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==i||l!==c)&&Pge(e,o,i,c),Nb=!1;var f=e.memoizedState;o.state=f,q9(e,i,o,n),l=e.memoizedState,a!==i||f!==l||cd.current||Nb?(typeof u=="function"&&(AK(e,r,u,i),l=e.memoizedState),(a=Nb||Age(e,r,a,i,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=l),o.props=i,o.state=l,o.context=c,i=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{o=e.stateNode,VPe(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:gm(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=Kp(l):(l=ud(r)?N2:Cc.current,l=JA(e,l));var m=r.getDerivedStateFromProps;(u=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&Pge(e,o,i,l),Nb=!1,f=e.memoizedState,o.state=f,q9(e,i,o,n);var g=e.memoizedState;a!==h||f!==g||cd.current||Nb?(typeof m=="function"&&(AK(e,r,m,i),g=e.memoizedState),(c=Nb||Age(e,r,c,i,f,g,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(i,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(i,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=g),o.props=i,o.state=g,o.context=l,i=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),i=!1)}return IK(t,e,r,i,s,n)}function IK(t,e,r,i,n,s){g3e(t,e);var o=(e.flags&128)!==0;if(!i&&!o)return n&&Tge(e,r,!1),__(t,e,s);i=e.stateNode,CJe.current=e;var a=o&&typeof r.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,t!==null&&o?(e.child=QA(e,t.child,null,s),e.child=QA(e,null,a,s)):Jc(t,e,a,s),e.memoizedState=i.state,n&&Tge(e,r,!0),e.child}function y3e(t){var e=t.stateNode;e.pendingContext?Sge(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Sge(t,e.context,!1),Fae(t,e.containerInfo)}function zge(t,e,r,i,n){return KA(),Mae(n),e.flags|=256,Jc(t,e,r,i),e.child}var LK={dehydrated:null,treeContext:null,retryLane:0};function DK(t){return{baseLanes:t,cachePool:null,transitions:null}}function v3e(t,e,r){var i=e.pendingProps,n=Ws.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(n&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(n|=1),ss(Ws,n&1),t===null)return RK(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=i.children,t=i.fallback,s?(i=e.mode,s=e.child,o={mode:"hidden",children:o},!(i&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=dG(o,i,0,null),t=m2(t,i,r,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=DK(r),e.memoizedState=LK,t):Hae(e,o));if(n=t.memoizedState,n!==null&&(a=n.dehydrated,a!==null))return RJe(t,e,o,i,a,n,r);if(s){s=i.fallback,o=e.mode,n=t.child,a=n.sibling;var l={mode:"hidden",children:i.children};return!(o&1)&&e.child!==n?(i=e.child,i.childLanes=0,i.pendingProps=l,e.deletions=null):(i=Lw(n,l),i.subtreeFlags=n.subtreeFlags&14680064),a!==null?s=Lw(a,s):(s=m2(s,o,r,null),s.flags|=2),s.return=e,i.return=e,i.sibling=s,e.child=i,i=s,s=e.child,o=t.child.memoizedState,o=o===null?DK(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~r,e.memoizedState=LK,i}return s=t.child,t=s.sibling,i=Lw(s,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=r),i.return=e,i.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=i,e.memoizedState=null,i}function Hae(t,e){return e=dG({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function _5(t,e,r,i){return i!==null&&Mae(i),QA(e,t.child,null,r),t=Hae(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function RJe(t,e,r,i,n,s,o){if(r)return e.flags&256?(e.flags&=-257,i=CW(Error(rt(422))),_5(t,e,o,i)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=i.fallback,n=e.mode,i=dG({mode:"visible",children:i.children},n,0,null),s=m2(s,n,o,null),s.flags|=2,i.return=e,s.return=e,i.sibling=s,e.child=i,e.mode&1&&QA(e,t.child,null,o),e.child.memoizedState=DK(o),e.memoizedState=LK,s);if(!(e.mode&1))return _5(t,e,o,null);if(n.data==="$!"){if(i=n.nextSibling&&n.nextSibling.dataset,i)var a=i.dgst;return i=a,s=Error(rt(419)),i=CW(s,i,void 0),_5(t,e,o,i)}if(a=(o&t.childLanes)!==0,td||a){if(i=al,i!==null){switch(o&-o){case 4:n=2;break;case 16:n=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:n=32;break;case 536870912:n=268435456;break;default:n=0}n=n&(i.suspendedLanes|o)?0:n,n!==0&&n!==s.retryLane&&(s.retryLane=n,v_(t,n),Wm(i,t,n,-1))}return Jae(),i=CW(Error(rt(421))),_5(t,e,o,i)}return n.data==="$?"?(e.flags|=128,e.child=t.child,e=zJe.bind(null,t),n._reactRetry=e,null):(t=s.treeContext,dh=Pw(n.nextSibling),fh=e,Ls=!0,Em=null,t!==null&&(Cp[Rp++]=Bv,Cp[Rp++]=jv,Cp[Rp++]=F2,Bv=t.id,jv=t.overflow,F2=e),e=Hae(e,i.children),e.flags|=4096,e)}function Vge(t,e,r){t.lanes|=e;var i=t.alternate;i!==null&&(i.lanes|=e),OK(t.return,e,r)}function RW(t,e,r,i,n){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:r,tailMode:n}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=i,s.tail=r,s.tailMode=n)}function _3e(t,e,r){var i=e.pendingProps,n=i.revealOrder,s=i.tail;if(Jc(t,e,i.children,r),i=Ws.current,i&2)i=i&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Vge(t,r,e);else if(t.tag===19)Vge(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}i&=1}if(ss(Ws,i),!(e.mode&1))e.memoizedState=null;else switch(n){case"forwards":for(r=e.child,n=null;r!==null;)t=r.alternate,t!==null&&W9(t)===null&&(n=r),r=r.sibling;r=n,r===null?(n=e.child,e.child=null):(n=r.sibling,r.sibling=null),RW(e,!1,n,r,s);break;case"backwards":for(r=null,n=e.child,e.child=null;n!==null;){if(t=n.alternate,t!==null&&W9(t)===null){e.child=n;break}t=n.sibling,n.sibling=r,r=n,n=t}RW(e,!0,r,null,s);break;case"together":RW(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function c8(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function __(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),U2|=e.lanes,!(r&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(rt(153));if(e.child!==null){for(t=e.child,r=Lw(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Lw(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function OJe(t,e,r){switch(e.tag){case 3:y3e(e),KA();break;case 5:qPe(e);break;case 1:ud(e.type)&&V9(e);break;case 4:Fae(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,n=e.memoizedProps.value;ss(G9,i._currentValue),i._currentValue=n;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(ss(Ws,Ws.current&1),e.flags|=128,null):r&e.child.childLanes?v3e(t,e,r):(ss(Ws,Ws.current&1),t=__(t,e,r),t!==null?t.sibling:null);ss(Ws,Ws.current&1);break;case 19:if(i=(r&e.childLanes)!==0,t.flags&128){if(i)return _3e(t,e,r);e.flags|=128}if(n=e.memoizedState,n!==null&&(n.rendering=null,n.tail=null,n.lastEffect=null),ss(Ws,Ws.current),i)break;return null;case 22:case 23:return e.lanes=0,m3e(t,e,r)}return __(t,e,r)}var b3e,NK,w3e,x3e;b3e=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};NK=function(){};w3e=function(t,e,r,i){var n=t.memoizedProps;if(n!==i){t=e.stateNode,r2(Vy.current);var s=null;switch(r){case"input":n=nK(t,n),i=nK(t,i),s=[];break;case"select":n=Zs({},n,{value:void 0}),i=Zs({},i,{value:void 0}),s=[];break;case"textarea":n=aK(t,n),i=aK(t,i),s=[];break;default:typeof n.onClick!="function"&&typeof i.onClick=="function"&&(t.onclick=U9)}cK(r,i);var o;r=null;for(c in n)if(!i.hasOwnProperty(c)&&n.hasOwnProperty(c)&&n[c]!=null)if(c==="style"){var a=n[c];for(o in a)a.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(HD.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in i){var l=i[c];if(a=n!=null?n[c]:void 0,i.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(s||(s=[]),s.push(c,r)),r=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(HD.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ds("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}r&&(s=s||[]).push("style",r);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};x3e=function(t,e,r,i){r!==i&&(e.flags|=4)};function mM(t,e){if(!Ls)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var i=null;r!==null;)r.alternate!==null&&(i=r),r=r.sibling;i===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:i.sibling=null}}function Wl(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,i=0;if(e)for(var n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags&14680064,i|=n.flags&14680064,n.return=t,n=n.sibling;else for(n=t.child;n!==null;)r|=n.lanes|n.childLanes,i|=n.subtreeFlags,i|=n.flags,n.return=t,n=n.sibling;return t.subtreeFlags|=i,t.childLanes=r,e}function AJe(t,e,r){var i=e.pendingProps;switch(Pae(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wl(e),null;case 1:return ud(e.type)&&z9(),Wl(e),null;case 3:return i=e.stateNode,eP(),Ss(cd),Ss(Cc),Uae(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(t===null||t.child===null)&&(y5(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Em!==null&&(GK(Em),Em=null))),NK(t,e),Wl(e),null;case 5:kae(e);var n=r2(iN.current);if(r=e.type,t!==null&&e.stateNode!=null)w3e(t,e,r,i,n),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(rt(166));return Wl(e),null}if(t=r2(Vy.current),y5(e)){i=e.stateNode,r=e.type;var s=e.memoizedProps;switch(i[Ey]=e,i[tN]=s,t=(e.mode&1)!==0,r){case"dialog":ds("cancel",i),ds("close",i);break;case"iframe":case"object":case"embed":ds("load",i);break;case"video":case"audio":for(n=0;n<q$.length;n++)ds(q$[n],i);break;case"source":ds("error",i);break;case"img":case"image":case"link":ds("error",i),ds("load",i);break;case"details":ds("toggle",i);break;case"input":Zme(i,s),ds("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!s.multiple},ds("invalid",i);break;case"textarea":Kme(i,s),ds("invalid",i)}cK(r,s),n=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?i.textContent!==a&&(s.suppressHydrationWarning!==!0&&g5(i.textContent,a,t),n=["children",a]):typeof a=="number"&&i.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&g5(i.textContent,a,t),n=["children",""+a]):HD.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ds("scroll",i)}switch(r){case"input":l5(i),Jme(i,s,!0);break;case"textarea":l5(i),Qme(i);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(i.onclick=U9)}i=n,e.updateQueue=i,i!==null&&(e.flags|=4)}else{o=n.nodeType===9?n:n.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=YAe(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof i.is=="string"?t=o.createElement(r,{is:i.is}):(t=o.createElement(r),r==="select"&&(o=t,i.multiple?o.multiple=!0:i.size&&(o.size=i.size))):t=o.createElementNS(t,r),t[Ey]=e,t[tN]=i,b3e(t,e,!1,!1),e.stateNode=t;e:{switch(o=uK(r,i),r){case"dialog":ds("cancel",t),ds("close",t),n=i;break;case"iframe":case"object":case"embed":ds("load",t),n=i;break;case"video":case"audio":for(n=0;n<q$.length;n++)ds(q$[n],t);n=i;break;case"source":ds("error",t),n=i;break;case"img":case"image":case"link":ds("error",t),ds("load",t),n=i;break;case"details":ds("toggle",t),n=i;break;case"input":Zme(t,i),n=nK(t,i),ds("invalid",t);break;case"option":n=i;break;case"select":t._wrapperState={wasMultiple:!!i.multiple},n=Zs({},i,{value:void 0}),ds("invalid",t);break;case"textarea":Kme(t,i),n=aK(t,i),ds("invalid",t);break;default:n=i}cK(r,n),a=n;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?KAe(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&ZAe(t,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&qD(t,l):typeof l=="number"&&qD(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(HD.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ds("scroll",t):l!=null&&mae(t,s,l,o))}switch(r){case"input":l5(t),Jme(t,i,!1);break;case"textarea":l5(t),Qme(t);break;case"option":i.value!=null&&t.setAttribute("value",""+jw(i.value));break;case"select":t.multiple=!!i.multiple,s=i.value,s!=null?cA(t,!!i.multiple,s,!1):i.defaultValue!=null&&cA(t,!!i.multiple,i.defaultValue,!0);break;default:typeof n.onClick=="function"&&(t.onclick=U9)}switch(r){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Wl(e),null;case 6:if(t&&e.stateNode!=null)x3e(t,e,t.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(rt(166));if(r=r2(iN.current),r2(Vy.current),y5(e)){if(i=e.stateNode,r=e.memoizedProps,i[Ey]=e,(s=i.nodeValue!==r)&&(t=fh,t!==null))switch(t.tag){case 3:g5(i.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&g5(i.nodeValue,r,(t.mode&1)!==0)}s&&(e.flags|=4)}else i=(r.nodeType===9?r:r.ownerDocument).createTextNode(i),i[Ey]=e,e.stateNode=i}return Wl(e),null;case 13:if(Ss(Ws),i=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ls&&dh!==null&&e.mode&1&&!(e.flags&128))UPe(),KA(),e.flags|=98560,s=!1;else if(s=y5(e),i!==null&&i.dehydrated!==null){if(t===null){if(!s)throw Error(rt(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(rt(317));s[Ey]=e}else KA(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Wl(e),s=!1}else Em!==null&&(GK(Em),Em=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=r,e):(i=i!==null,i!==(t!==null&&t.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(t===null||Ws.current&1?$a===0&&($a=3):Jae())),e.updateQueue!==null&&(e.flags|=4),Wl(e),null);case 4:return eP(),NK(t,e),t===null&&QD(e.stateNode.containerInfo),Wl(e),null;case 10:return Lae(e.type._context),Wl(e),null;case 17:return ud(e.type)&&z9(),Wl(e),null;case 19:if(Ss(Ws),s=e.memoizedState,s===null)return Wl(e),null;if(i=(e.flags&128)!==0,o=s.rendering,o===null)if(i)mM(s,!1);else{if($a!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=W9(t),o!==null){for(e.flags|=128,mM(s,!1),i=o.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=r,r=e.child;r!==null;)s=r,t=i,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return ss(Ws,Ws.current&1|2),e.child}t=t.sibling}s.tail!==null&&Fo()>rP&&(e.flags|=128,i=!0,mM(s,!1),e.lanes=4194304)}else{if(!i)if(t=W9(o),t!==null){if(e.flags|=128,i=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),mM(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Ls)return Wl(e),null}else 2*Fo()-s.renderingStartTime>rP&&r!==1073741824&&(e.flags|=128,i=!0,mM(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(r=s.last,r!==null?r.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Fo(),e.sibling=null,r=Ws.current,ss(Ws,i?r&1|2:r&1),e):(Wl(e),null);case 22:case 23:return Zae(),i=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Zd&1073741824&&(Wl(e),e.subtreeFlags&6&&(e.flags|=8192)):Wl(e),null;case 24:return null;case 25:return null}throw Error(rt(156,e.tag))}function PJe(t,e){switch(Pae(e),e.tag){case 1:return ud(e.type)&&z9(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return eP(),Ss(cd),Ss(Cc),Uae(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return kae(e),null;case 13:if(Ss(Ws),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(rt(340));KA()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ss(Ws),null;case 4:return eP(),null;case 10:return Lae(e.type._context),null;case 22:case 23:return Zae(),null;case 24:return null;default:return null}}var b5=!1,yc=!1,MJe=typeof WeakSet=="function"?WeakSet:Set,jt=null;function NO(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(i){fo(t,e,i)}else r.current=null}function FK(t,e,r){try{r()}catch(i){fo(t,e,i)}}var Bge=!1;function $Je(t,e){if(bK=N9,t=CPe(),Oae(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var i=r.getSelection&&r.getSelection();if(i&&i.rangeCount!==0){r=i.anchorNode;var n=i.anchorOffset,s=i.focusNode;i=i.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=t,f=null;t:for(;;){for(var m;h!==r||n!==0&&h.nodeType!==3||(a=o+n),h!==s||i!==0&&h.nodeType!==3||(l=o+i),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===t)break t;if(f===r&&++c===n&&(a=o),f===s&&++u===i&&(l=o),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(wK={focusedElem:t,selectionRange:r},N9=!1,jt=e;jt!==null;)if(e=jt,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,jt=t;else for(;jt!==null;){e=jt;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var y=g.memoizedProps,_=g.memoizedState,b=e.stateNode,w=b.getSnapshotBeforeUpdate(e.elementType===e.type?y:gm(e.type,y),_);b.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var x=e.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(rt(163))}}catch(S){fo(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,jt=t;break}jt=e.return}return g=Bge,Bge=!1,g}function UL(t,e,r){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var n=i=i.next;do{if((n.tag&t)===t){var s=n.destroy;n.destroy=void 0,s!==void 0&&FK(e,r,s)}n=n.next}while(n!==i)}}function cG(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var i=r.create;r.destroy=i()}r=r.next}while(r!==e)}}function kK(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function S3e(t){var e=t.alternate;e!==null&&(t.alternate=null,S3e(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ey],delete e[tN],delete e[TK],delete e[fJe],delete e[mJe])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function T3e(t){return t.tag===5||t.tag===3||t.tag===4}function jge(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||T3e(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function UK(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=U9));else if(i!==4&&(t=t.child,t!==null))for(UK(t,e,r),t=t.sibling;t!==null;)UK(t,e,r),t=t.sibling}function zK(t,e,r){var i=t.tag;if(i===5||i===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(i!==4&&(t=t.child,t!==null))for(zK(t,e,r),t=t.sibling;t!==null;)zK(t,e,r),t=t.sibling}var xl=null,_m=!1;function p1(t,e,r){for(r=r.child;r!==null;)E3e(t,e,r),r=r.sibling}function E3e(t,e,r){if(zy&&typeof zy.onCommitFiberUnmount=="function")try{zy.onCommitFiberUnmount(tG,r)}catch{}switch(r.tag){case 5:yc||NO(r,e);case 6:var i=xl,n=_m;xl=null,p1(t,e,r),xl=i,_m=n,xl!==null&&(_m?(t=xl,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):xl.removeChild(r.stateNode));break;case 18:xl!==null&&(_m?(t=xl,r=r.stateNode,t.nodeType===8?bW(t.parentNode,r):t.nodeType===1&&bW(t,r),ZD(t)):bW(xl,r.stateNode));break;case 4:i=xl,n=_m,xl=r.stateNode.containerInfo,_m=!0,p1(t,e,r),xl=i,_m=n;break;case 0:case 11:case 14:case 15:if(!yc&&(i=r.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){n=i=i.next;do{var s=n,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&FK(r,e,o),n=n.next}while(n!==i)}p1(t,e,r);break;case 1:if(!yc&&(NO(r,e),i=r.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=r.memoizedProps,i.state=r.memoizedState,i.componentWillUnmount()}catch(a){fo(r,e,a)}p1(t,e,r);break;case 21:p1(t,e,r);break;case 22:r.mode&1?(yc=(i=yc)||r.memoizedState!==null,p1(t,e,r),yc=i):p1(t,e,r);break;default:p1(t,e,r)}}function Gge(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new MJe),e.forEach(function(i){var n=VJe.bind(null,t,i);r.has(i)||(r.add(i),i.then(n,n))})}}function Cf(t,e){var r=e.deletions;if(r!==null)for(var i=0;i<r.length;i++){var n=r[i];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:xl=a.stateNode,_m=!1;break e;case 3:xl=a.stateNode.containerInfo,_m=!0;break e;case 4:xl=a.stateNode.containerInfo,_m=!0;break e}a=a.return}if(xl===null)throw Error(rt(160));E3e(s,o,n),xl=null,_m=!1;var l=n.alternate;l!==null&&(l.return=null),n.return=null}catch(c){fo(n,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)C3e(e,t),e=e.sibling}function C3e(t,e){var r=t.alternate,i=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Cf(e,t),Tg(t),i&4){try{UL(3,t,t.return),cG(3,t)}catch(y){fo(t,t.return,y)}try{UL(5,t,t.return)}catch(y){fo(t,t.return,y)}}break;case 1:Cf(e,t),Tg(t),i&512&&r!==null&&NO(r,r.return);break;case 5:if(Cf(e,t),Tg(t),i&512&&r!==null&&NO(r,r.return),t.flags&32){var n=t.stateNode;try{qD(n,"")}catch(y){fo(t,t.return,y)}}if(i&4&&(n=t.stateNode,n!=null)){var s=t.memoizedProps,o=r!==null?r.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&WAe(n,s),uK(a,o);var c=uK(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?KAe(n,h):u==="dangerouslySetInnerHTML"?ZAe(n,h):u==="children"?qD(n,h):mae(n,u,h,c)}switch(a){case"input":sK(n,s);break;case"textarea":XAe(n,s);break;case"select":var f=n._wrapperState.wasMultiple;n._wrapperState.wasMultiple=!!s.multiple;var m=s.value;m!=null?cA(n,!!s.multiple,m,!1):f!==!!s.multiple&&(s.defaultValue!=null?cA(n,!!s.multiple,s.defaultValue,!0):cA(n,!!s.multiple,s.multiple?[]:"",!1))}n[tN]=s}catch(y){fo(t,t.return,y)}}break;case 6:if(Cf(e,t),Tg(t),i&4){if(t.stateNode===null)throw Error(rt(162));n=t.stateNode,s=t.memoizedProps;try{n.nodeValue=s}catch(y){fo(t,t.return,y)}}break;case 3:if(Cf(e,t),Tg(t),i&4&&r!==null&&r.memoizedState.isDehydrated)try{ZD(e.containerInfo)}catch(y){fo(t,t.return,y)}break;case 4:Cf(e,t),Tg(t);break;case 13:Cf(e,t),Tg(t),n=t.child,n.flags&8192&&(s=n.memoizedState!==null,n.stateNode.isHidden=s,!s||n.alternate!==null&&n.alternate.memoizedState!==null||(Xae=Fo())),i&4&&Gge(t);break;case 22:if(u=r!==null&&r.memoizedState!==null,t.mode&1?(yc=(c=yc)||u,Cf(e,t),yc=c):Cf(e,t),Tg(t),i&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(jt=t,u=t.child;u!==null;){for(h=jt=u;jt!==null;){switch(f=jt,m=f.child,f.tag){case 0:case 11:case 14:case 15:UL(4,f,f.return);break;case 1:NO(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){i=f,r=f.return;try{e=i,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(y){fo(i,r,y)}}break;case 5:NO(f,f.return);break;case 22:if(f.memoizedState!==null){qge(h);continue}}m!==null?(m.return=f,jt=m):qge(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{n=h.stateNode,c?(s=n.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=JAe("display",o))}catch(y){fo(t,t.return,y)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(y){fo(t,t.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Cf(e,t),Tg(t),i&4&&Gge(t);break;case 21:break;default:Cf(e,t),Tg(t)}}function Tg(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(T3e(r)){var i=r;break e}r=r.return}throw Error(rt(160))}switch(i.tag){case 5:var n=i.stateNode;i.flags&32&&(qD(n,""),i.flags&=-33);var s=jge(t);zK(t,s,n);break;case 3:case 4:var o=i.stateNode.containerInfo,a=jge(t);UK(t,a,o);break;default:throw Error(rt(161))}}catch(l){fo(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function IJe(t,e,r){jt=t,R3e(t)}function R3e(t,e,r){for(var i=(t.mode&1)!==0;jt!==null;){var n=jt,s=n.child;if(n.tag===22&&i){var o=n.memoizedState!==null||b5;if(!o){var a=n.alternate,l=a!==null&&a.memoizedState!==null||yc;a=b5;var c=yc;if(b5=o,(yc=l)&&!c)for(jt=n;jt!==null;)o=jt,l=o.child,o.tag===22&&o.memoizedState!==null?Wge(n):l!==null?(l.return=o,jt=l):Wge(n);for(;s!==null;)jt=s,R3e(s),s=s.sibling;jt=n,b5=a,yc=c}Hge(t)}else n.subtreeFlags&8772&&s!==null?(s.return=n,jt=s):Hge(t)}}function Hge(t){for(;jt!==null;){var e=jt;if(e.flags&8772){var r=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:yc||cG(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!yc)if(r===null)i.componentDidMount();else{var n=e.elementType===e.type?r.memoizedProps:gm(e.type,r.memoizedProps);i.componentDidUpdate(n,r.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Oge(e,s,i);break;case 3:var o=e.updateQueue;if(o!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}Oge(e,o,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&ZD(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(rt(163))}yc||e.flags&512&&kK(e)}catch(f){fo(e,e.return,f)}}if(e===t){jt=null;break}if(r=e.sibling,r!==null){r.return=e.return,jt=r;break}jt=e.return}}function qge(t){for(;jt!==null;){var e=jt;if(e===t){jt=null;break}var r=e.sibling;if(r!==null){r.return=e.return,jt=r;break}jt=e.return}}function Wge(t){for(;jt!==null;){var e=jt;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{cG(4,e)}catch(l){fo(e,r,l)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var n=e.return;try{i.componentDidMount()}catch(l){fo(e,n,l)}}var s=e.return;try{kK(e)}catch(l){fo(e,s,l)}break;case 5:var o=e.return;try{kK(e)}catch(l){fo(e,o,l)}}}catch(l){fo(e,e.return,l)}if(e===t){jt=null;break}var a=e.sibling;if(a!==null){a.return=e.return,jt=a;break}jt=e.return}}var LJe=Math.ceil,Z9=j_.ReactCurrentDispatcher,qae=j_.ReactCurrentOwner,jp=j_.ReactCurrentBatchConfig,ji=0,al=null,aa=null,Il=0,Zd=0,FO=bx(0),$a=0,aN=null,U2=0,uG=0,Wae=0,zL=null,Ju=null,Xae=0,rP=1/0,Rv=null,J9=!1,VK=null,$w=null,w5=!1,ow=null,K9=0,VL=0,BK=null,u8=-1,d8=0;function su(){return ji&6?Fo():u8!==-1?u8:u8=Fo()}function Iw(t){return t.mode&1?ji&2&&Il!==0?Il&-Il:yJe.transition!==null?(d8===0&&(d8=uPe()),d8):(t=En,t!==0||(t=window.event,t=t===void 0?16:yPe(t.type)),t):1}function Wm(t,e,r,i){if(50<VL)throw VL=0,BK=null,Error(rt(185));T4(t,r,i),(!(ji&2)||t!==al)&&(t===al&&(!(ji&2)&&(uG|=r),$a===4&&Yb(t,Il)),dd(t,i),r===1&&ji===0&&!(e.mode&1)&&(rP=Fo()+500,oG&&wx()))}function dd(t,e){var r=t.callbackNode;yZe(t,e);var i=D9(t,t===al?Il:0);if(i===0)r!==null&&rge(r),t.callbackNode=null,t.callbackPriority=0;else if(e=i&-i,t.callbackPriority!==e){if(r!=null&&rge(r),e===1)t.tag===0?gJe(Xge.bind(null,t)):NPe(Xge.bind(null,t)),hJe(function(){!(ji&6)&&wx()}),r=null;else{switch(dPe(i)){case 1:r=bae;break;case 4:r=lPe;break;case 16:r=L9;break;case 536870912:r=cPe;break;default:r=L9}r=D3e(r,O3e.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function O3e(t,e){if(u8=-1,d8=0,ji&6)throw Error(rt(327));var r=t.callbackNode;if(fA()&&t.callbackNode!==r)return null;var i=D9(t,t===al?Il:0);if(i===0)return null;if(i&30||i&t.expiredLanes||e)e=Q9(t,i);else{e=i;var n=ji;ji|=2;var s=P3e();(al!==t||Il!==e)&&(Rv=null,rP=Fo()+500,f2(t,e));do try{FJe();break}catch(a){A3e(t,a)}while(1);Iae(),Z9.current=s,ji=n,aa!==null?e=0:(al=null,Il=0,e=$a)}if(e!==0){if(e===2&&(n=mK(t),n!==0&&(i=n,e=jK(t,n))),e===1)throw r=aN,f2(t,0),Yb(t,i),dd(t,Fo()),r;if(e===6)Yb(t,i);else{if(n=t.current.alternate,!(i&30)&&!DJe(n)&&(e=Q9(t,i),e===2&&(s=mK(t),s!==0&&(i=s,e=jK(t,s))),e===1))throw r=aN,f2(t,0),Yb(t,i),dd(t,Fo()),r;switch(t.finishedWork=n,t.finishedLanes=i,e){case 0:case 1:throw Error(rt(345));case 2:TS(t,Ju,Rv);break;case 3:if(Yb(t,i),(i&130023424)===i&&(e=Xae+500-Fo(),10<e)){if(D9(t,0)!==0)break;if(n=t.suspendedLanes,(n&i)!==i){su(),t.pingedLanes|=t.suspendedLanes&n;break}t.timeoutHandle=SK(TS.bind(null,t,Ju,Rv),e);break}TS(t,Ju,Rv);break;case 4:if(Yb(t,i),(i&4194240)===i)break;for(e=t.eventTimes,n=-1;0<i;){var o=31-qm(i);s=1<<o,o=e[o],o>n&&(n=o),i&=~s}if(i=n,i=Fo()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*LJe(i/1960))-i,10<i){t.timeoutHandle=SK(TS.bind(null,t,Ju,Rv),i);break}TS(t,Ju,Rv);break;case 5:TS(t,Ju,Rv);break;default:throw Error(rt(329))}}}return dd(t,Fo()),t.callbackNode===r?O3e.bind(null,t):null}function jK(t,e){var r=zL;return t.current.memoizedState.isDehydrated&&(f2(t,e).flags|=256),t=Q9(t,e),t!==2&&(e=Ju,Ju=r,e!==null&&GK(e)),t}function GK(t){Ju===null?Ju=t:Ju.push.apply(Ju,t)}function DJe(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var i=0;i<r.length;i++){var n=r[i],s=n.getSnapshot;n=n.value;try{if(!rg(s(),n))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Yb(t,e){for(e&=~Wae,e&=~uG,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-qm(e),i=1<<r;t[r]=-1,e&=~i}}function Xge(t){if(ji&6)throw Error(rt(327));fA();var e=D9(t,0);if(!(e&1))return dd(t,Fo()),null;var r=Q9(t,e);if(t.tag!==0&&r===2){var i=mK(t);i!==0&&(e=i,r=jK(t,i))}if(r===1)throw r=aN,f2(t,0),Yb(t,e),dd(t,Fo()),r;if(r===6)throw Error(rt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,TS(t,Ju,Rv),dd(t,Fo()),null}function Yae(t,e){var r=ji;ji|=1;try{return t(e)}finally{ji=r,ji===0&&(rP=Fo()+500,oG&&wx())}}function z2(t){ow!==null&&ow.tag===0&&!(ji&6)&&fA();var e=ji;ji|=1;var r=jp.transition,i=En;try{if(jp.transition=null,En=1,t)return t()}finally{En=i,jp.transition=r,ji=e,!(ji&6)&&wx()}}function Zae(){Zd=FO.current,Ss(FO)}function f2(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,dJe(r)),aa!==null)for(r=aa.return;r!==null;){var i=r;switch(Pae(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&z9();break;case 3:eP(),Ss(cd),Ss(Cc),Uae();break;case 5:kae(i);break;case 4:eP();break;case 13:Ss(Ws);break;case 19:Ss(Ws);break;case 10:Lae(i.type._context);break;case 22:case 23:Zae()}r=r.return}if(al=t,aa=t=Lw(t.current,null),Il=Zd=e,$a=0,aN=null,Wae=uG=U2=0,Ju=zL=null,t2!==null){for(e=0;e<t2.length;e++)if(r=t2[e],i=r.interleaved,i!==null){r.interleaved=null;var n=i.next,s=r.pending;if(s!==null){var o=s.next;s.next=n,i.next=o}r.pending=i}t2=null}return t}function A3e(t,e){do{var r=aa;try{if(Iae(),a8.current=Y9,X9){for(var i=Xs.memoizedState;i!==null;){var n=i.queue;n!==null&&(n.pending=null),i=i.next}X9=!1}if(k2=0,Ka=Ca=Xs=null,kL=!1,nN=0,qae.current=null,r===null||r.return===null){$a=1,aN=e,aa=null;break}e:{var s=t,o=r.return,a=r,l=e;if(e=Il,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=Dge(o);if(m!==null){m.flags&=-257,Nge(m,o,a,s,e),m.mode&1&&Lge(s,c,e),e=m,l=c;var g=e.updateQueue;if(g===null){var y=new Set;y.add(l),e.updateQueue=y}else g.add(l);break e}else{if(!(e&1)){Lge(s,c,e),Jae();break e}l=Error(rt(426))}}else if(Ls&&a.mode&1){var _=Dge(o);if(_!==null){!(_.flags&65536)&&(_.flags|=256),Nge(_,o,a,s,e),Mae(tP(l,a));break e}}s=l=tP(l,a),$a!==4&&($a=2),zL===null?zL=[s]:zL.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var b=h3e(s,l,e);Rge(s,b);break e;case 1:a=l;var w=s.type,x=s.stateNode;if(!(s.flags&128)&&(typeof w.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&($w===null||!$w.has(x)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=p3e(s,a,e);Rge(s,S);break e}}s=s.return}while(s!==null)}$3e(r)}catch(C){e=C,aa===r&&r!==null&&(aa=r=r.return);continue}break}while(1)}function P3e(){var t=Z9.current;return Z9.current=Y9,t===null?Y9:t}function Jae(){($a===0||$a===3||$a===2)&&($a=4),al===null||!(U2&268435455)&&!(uG&268435455)||Yb(al,Il)}function Q9(t,e){var r=ji;ji|=2;var i=P3e();(al!==t||Il!==e)&&(Rv=null,f2(t,e));do try{NJe();break}catch(n){A3e(t,n)}while(1);if(Iae(),ji=r,Z9.current=i,aa!==null)throw Error(rt(261));return al=null,Il=0,$a}function NJe(){for(;aa!==null;)M3e(aa)}function FJe(){for(;aa!==null&&!lZe();)M3e(aa)}function M3e(t){var e=L3e(t.alternate,t,Zd);t.memoizedProps=t.pendingProps,e===null?$3e(t):aa=e,qae.current=null}function $3e(t){var e=t;do{var r=e.alternate;if(t=e.return,e.flags&32768){if(r=PJe(r,e),r!==null){r.flags&=32767,aa=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{$a=6,aa=null;return}}else if(r=AJe(r,e,Zd),r!==null){aa=r;return}if(e=e.sibling,e!==null){aa=e;return}aa=e=t}while(e!==null);$a===0&&($a=5)}function TS(t,e,r){var i=En,n=jp.transition;try{jp.transition=null,En=1,kJe(t,e,r,i)}finally{jp.transition=n,En=i}return null}function kJe(t,e,r,i){do fA();while(ow!==null);if(ji&6)throw Error(rt(327));r=t.finishedWork;var n=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(rt(177));t.callbackNode=null,t.callbackPriority=0;var s=r.lanes|r.childLanes;if(vZe(t,s),t===al&&(aa=al=null,Il=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||w5||(w5=!0,D3e(L9,function(){return fA(),null})),s=(r.flags&15990)!==0,r.subtreeFlags&15990||s){s=jp.transition,jp.transition=null;var o=En;En=1;var a=ji;ji|=4,qae.current=null,$Je(t,r),C3e(r,t),nJe(wK),N9=!!bK,wK=bK=null,t.current=r,IJe(r),cZe(),ji=a,En=o,jp.transition=s}else t.current=r;if(w5&&(w5=!1,ow=t,K9=n),s=t.pendingLanes,s===0&&($w=null),hZe(r.stateNode),dd(t,Fo()),e!==null)for(i=t.onRecoverableError,r=0;r<e.length;r++)n=e[r],i(n.value,{componentStack:n.stack,digest:n.digest});if(J9)throw J9=!1,t=VK,VK=null,t;return K9&1&&t.tag!==0&&fA(),s=t.pendingLanes,s&1?t===BK?VL++:(VL=0,BK=t):VL=0,wx(),null}function fA(){if(ow!==null){var t=dPe(K9),e=jp.transition,r=En;try{if(jp.transition=null,En=16>t?16:t,ow===null)var i=!1;else{if(t=ow,ow=null,K9=0,ji&6)throw Error(rt(331));var n=ji;for(ji|=4,jt=t.current;jt!==null;){var s=jt,o=s.child;if(jt.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(jt=c;jt!==null;){var u=jt;switch(u.tag){case 0:case 11:case 15:UL(8,u,s)}var h=u.child;if(h!==null)h.return=u,jt=h;else for(;jt!==null;){u=jt;var f=u.sibling,m=u.return;if(S3e(u),u===c){jt=null;break}if(f!==null){f.return=m,jt=f;break}jt=m}}}var g=s.alternate;if(g!==null){var y=g.child;if(y!==null){g.child=null;do{var _=y.sibling;y.sibling=null,y=_}while(y!==null)}}jt=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,jt=o;else e:for(;jt!==null;){if(s=jt,s.flags&2048)switch(s.tag){case 0:case 11:case 15:UL(9,s,s.return)}var b=s.sibling;if(b!==null){b.return=s.return,jt=b;break e}jt=s.return}}var w=t.current;for(jt=w;jt!==null;){o=jt;var x=o.child;if(o.subtreeFlags&2064&&x!==null)x.return=o,jt=x;else e:for(o=w;jt!==null;){if(a=jt,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:cG(9,a)}}catch(C){fo(a,a.return,C)}if(a===o){jt=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,jt=S;break e}jt=a.return}}if(ji=n,wx(),zy&&typeof zy.onPostCommitFiberRoot=="function")try{zy.onPostCommitFiberRoot(tG,t)}catch{}i=!0}return i}finally{En=r,jp.transition=e}}return!1}function Yge(t,e,r){e=tP(r,e),e=h3e(t,e,1),t=Mw(t,e,1),e=su(),t!==null&&(T4(t,1,e),dd(t,e))}function fo(t,e,r){if(t.tag===3)Yge(t,t,r);else for(;e!==null;){if(e.tag===3){Yge(e,t,r);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&($w===null||!$w.has(i))){t=tP(r,t),t=p3e(e,t,1),e=Mw(e,t,1),t=su(),e!==null&&(T4(e,1,t),dd(e,t));break}}e=e.return}}function UJe(t,e,r){var i=t.pingCache;i!==null&&i.delete(e),e=su(),t.pingedLanes|=t.suspendedLanes&r,al===t&&(Il&r)===r&&($a===4||$a===3&&(Il&130023424)===Il&&500>Fo()-Xae?f2(t,0):Wae|=r),dd(t,e)}function I3e(t,e){e===0&&(t.mode&1?(e=d5,d5<<=1,!(d5&130023424)&&(d5=4194304)):e=1);var r=su();t=v_(t,e),t!==null&&(T4(t,e,r),dd(t,r))}function zJe(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),I3e(t,r)}function VJe(t,e){var r=0;switch(t.tag){case 13:var i=t.stateNode,n=t.memoizedState;n!==null&&(r=n.retryLane);break;case 19:i=t.stateNode;break;default:throw Error(rt(314))}i!==null&&i.delete(e),I3e(t,r)}var L3e;L3e=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||cd.current)td=!0;else{if(!(t.lanes&r)&&!(e.flags&128))return td=!1,OJe(t,e,r);td=!!(t.flags&131072)}else td=!1,Ls&&e.flags&1048576&&FPe(e,j9,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;c8(t,e),t=e.pendingProps;var n=JA(e,Cc.current);pA(e,r),n=Vae(null,e,i,t,n,r);var s=Bae();return e.flags|=1,typeof n=="object"&&n!==null&&typeof n.render=="function"&&n.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ud(i)?(s=!0,V9(e)):s=!1,e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,Nae(e),n.updater=aG,e.stateNode=n,n._reactInternals=e,PK(e,i,t,r),e=IK(null,e,i,!0,s,r)):(e.tag=0,Ls&&s&&Aae(e),Jc(null,e,n,r),e=e.child),e;case 16:i=e.elementType;e:{switch(c8(t,e),t=e.pendingProps,n=i._init,i=n(i._payload),e.type=i,n=e.tag=jJe(i),t=gm(i,t),n){case 0:e=$K(null,e,i,t,r);break e;case 1:e=Uge(null,e,i,t,r);break e;case 11:e=Fge(null,e,i,t,r);break e;case 14:e=kge(null,e,i,gm(i.type,t),r);break e}throw Error(rt(306,i,""))}return e;case 0:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:gm(i,n),$K(t,e,i,n,r);case 1:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:gm(i,n),Uge(t,e,i,n,r);case 3:e:{if(y3e(e),t===null)throw Error(rt(387));i=e.pendingProps,s=e.memoizedState,n=s.element,VPe(t,e),q9(e,i,null,r);var o=e.memoizedState;if(i=o.element,s.isDehydrated)if(s={element:i,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){n=tP(Error(rt(423)),e),e=zge(t,e,i,r,n);break e}else if(i!==n){n=tP(Error(rt(424)),e),e=zge(t,e,i,r,n);break e}else for(dh=Pw(e.stateNode.containerInfo.firstChild),fh=e,Ls=!0,Em=null,r=HPe(e,null,i,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(KA(),i===n){e=__(t,e,r);break e}Jc(t,e,i,r)}e=e.child}return e;case 5:return qPe(e),t===null&&RK(e),i=e.type,n=e.pendingProps,s=t!==null?t.memoizedProps:null,o=n.children,xK(i,n)?o=null:s!==null&&xK(i,s)&&(e.flags|=32),g3e(t,e),Jc(t,e,o,r),e.child;case 6:return t===null&&RK(e),null;case 13:return v3e(t,e,r);case 4:return Fae(e,e.stateNode.containerInfo),i=e.pendingProps,t===null?e.child=QA(e,null,i,r):Jc(t,e,i,r),e.child;case 11:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:gm(i,n),Fge(t,e,i,n,r);case 7:return Jc(t,e,e.pendingProps,r),e.child;case 8:return Jc(t,e,e.pendingProps.children,r),e.child;case 12:return Jc(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(i=e.type._context,n=e.pendingProps,s=e.memoizedProps,o=n.value,ss(G9,i._currentValue),i._currentValue=o,s!==null)if(rg(s.value,o)){if(s.children===n.children&&!cd.current){e=__(t,e,r);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===i){if(s.tag===1){l=Jv(-1,r&-r),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),OK(s.return,r,e),a.lanes|=r;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(rt(341));o.lanes|=r,a=o.alternate,a!==null&&(a.lanes|=r),OK(o,r,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Jc(t,e,n.children,r),e=e.child}return e;case 9:return n=e.type,i=e.pendingProps.children,pA(e,r),n=Kp(n),i=i(n),e.flags|=1,Jc(t,e,i,r),e.child;case 14:return i=e.type,n=gm(i,e.pendingProps),n=gm(i.type,n),kge(t,e,i,n,r);case 15:return f3e(t,e,e.type,e.pendingProps,r);case 17:return i=e.type,n=e.pendingProps,n=e.elementType===i?n:gm(i,n),c8(t,e),e.tag=1,ud(i)?(t=!0,V9(e)):t=!1,pA(e,r),jPe(e,i,n),PK(e,i,n,r),IK(null,e,i,!0,t,r);case 19:return _3e(t,e,r);case 22:return m3e(t,e,r)}throw Error(rt(156,e.tag))};function D3e(t,e){return aPe(t,e)}function BJe(t,e,r,i){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kp(t,e,r,i){return new BJe(t,e,r,i)}function Kae(t){return t=t.prototype,!(!t||!t.isReactComponent)}function jJe(t){if(typeof t=="function")return Kae(t)?1:0;if(t!=null){if(t=t.$$typeof,t===yae)return 11;if(t===vae)return 14}return 2}function Lw(t,e){var r=t.alternate;return r===null?(r=kp(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function h8(t,e,r,i,n,s){var o=2;if(i=t,typeof t=="function")Kae(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case RO:return m2(r.children,n,s,e);case gae:o=8,n|=8;break;case eK:return t=kp(12,r,e,n|2),t.elementType=eK,t.lanes=s,t;case tK:return t=kp(13,r,e,n),t.elementType=tK,t.lanes=s,t;case rK:return t=kp(19,r,e,n),t.elementType=rK,t.lanes=s,t;case GAe:return dG(r,n,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case BAe:o=10;break e;case jAe:o=9;break e;case yae:o=11;break e;case vae:o=14;break e;case Db:o=16,i=null;break e}throw Error(rt(130,t==null?t:typeof t,""))}return e=kp(o,r,e,n),e.elementType=t,e.type=i,e.lanes=s,e}function m2(t,e,r,i){return t=kp(7,t,i,e),t.lanes=r,t}function dG(t,e,r,i){return t=kp(22,t,i,e),t.elementType=GAe,t.lanes=r,t.stateNode={isHidden:!1},t}function OW(t,e,r){return t=kp(6,t,null,e),t.lanes=r,t}function AW(t,e,r){return e=kp(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function GJe(t,e,r,i,n){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cW(0),this.expirationTimes=cW(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cW(0),this.identifierPrefix=i,this.onRecoverableError=n,this.mutableSourceEagerHydrationData=null}function Qae(t,e,r,i,n,s,o,a,l){return t=new GJe(t,e,r,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=kp(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:i,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Nae(s),t}function HJe(t,e,r){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:CO,key:i==null?null:""+i,children:t,containerInfo:e,implementation:r}}function N3e(t){if(!t)return Gw;t=t._reactInternals;e:{if(AE(t)!==t||t.tag!==1)throw Error(rt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ud(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(rt(171))}if(t.tag===1){var r=t.type;if(ud(r))return DPe(t,r,e)}return e}function F3e(t,e,r,i,n,s,o,a,l){return t=Qae(r,i,!0,t,n,s,o,a,l),t.context=N3e(null),r=t.current,i=su(),n=Iw(r),s=Jv(i,n),s.callback=e??null,Mw(r,s,n),t.current.lanes=n,T4(t,n,i),dd(t,i),t}function hG(t,e,r,i){var n=e.current,s=su(),o=Iw(n);return r=N3e(r),e.context===null?e.context=r:e.pendingContext=r,e=Jv(s,o),e.payload={element:t},i=i===void 0?null:i,i!==null&&(e.callback=i),t=Mw(n,e,o),t!==null&&(Wm(t,n,o,s),o8(t,n,o)),o}function eV(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Zge(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function ele(t,e){Zge(t,e),(t=t.alternate)&&Zge(t,e)}function qJe(){return null}var k3e=typeof reportError=="function"?reportError:function(t){console.error(t)};function tle(t){this._internalRoot=t}pG.prototype.render=tle.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(rt(409));hG(t,e,null,null)};pG.prototype.unmount=tle.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;z2(function(){hG(null,t,null,null)}),e[y_]=null}};function pG(t){this._internalRoot=t}pG.prototype.unstable_scheduleHydration=function(t){if(t){var e=fPe();t={blockedOn:null,target:t,priority:e};for(var r=0;r<Xb.length&&e!==0&&e<Xb[r].priority;r++);Xb.splice(r,0,t),r===0&&gPe(t)}};function rle(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function fG(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Jge(){}function WJe(t,e,r,i,n){if(n){if(typeof i=="function"){var s=i;i=function(){var c=eV(o);s.call(c)}}var o=F3e(e,i,t,0,null,!1,!1,"",Jge);return t._reactRootContainer=o,t[y_]=o.current,QD(t.nodeType===8?t.parentNode:t),z2(),o}for(;n=t.lastChild;)t.removeChild(n);if(typeof i=="function"){var a=i;i=function(){var c=eV(l);a.call(c)}}var l=Qae(t,0,!1,null,null,!1,!1,"",Jge);return t._reactRootContainer=l,t[y_]=l.current,QD(t.nodeType===8?t.parentNode:t),z2(function(){hG(e,l,r,i)}),l}function mG(t,e,r,i,n){var s=r._reactRootContainer;if(s){var o=s;if(typeof n=="function"){var a=n;n=function(){var l=eV(o);a.call(l)}}hG(e,o,t,n)}else o=WJe(r,e,t,n,i);return eV(o)}hPe=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=H$(e.pendingLanes);r!==0&&(wae(e,r|1),dd(e,Fo()),!(ji&6)&&(rP=Fo()+500,wx()))}break;case 13:z2(function(){var i=v_(t,1);if(i!==null){var n=su();Wm(i,t,1,n)}}),ele(t,1)}};xae=function(t){if(t.tag===13){var e=v_(t,134217728);if(e!==null){var r=su();Wm(e,t,134217728,r)}ele(t,134217728)}};pPe=function(t){if(t.tag===13){var e=Iw(t),r=v_(t,e);if(r!==null){var i=su();Wm(r,t,e,i)}ele(t,e)}};fPe=function(){return En};mPe=function(t,e){var r=En;try{return En=t,e()}finally{En=r}};hK=function(t,e,r){switch(e){case"input":if(sK(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var i=r[e];if(i!==t&&i.form===t.form){var n=sG(i);if(!n)throw Error(rt(90));qAe(i),sK(i,n)}}}break;case"textarea":XAe(t,r);break;case"select":e=r.value,e!=null&&cA(t,!!r.multiple,e,!1)}};tPe=Yae;rPe=z2;var XJe={usingClientEntryPoint:!1,Events:[C4,MO,sG,QAe,ePe,Yae]},gM={findFiberByHostInstance:e2,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},YJe={bundleType:gM.bundleType,version:gM.version,rendererPackageName:gM.rendererPackageName,rendererConfig:gM.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:j_.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=sPe(t),t===null?null:t.stateNode},findFiberByHostInstance:gM.findFiberByHostInstance||qJe,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var x5=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!x5.isDisabled&&x5.supportsFiber)try{tG=x5.inject(YJe),zy=x5}catch{}}$h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XJe;$h.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!rle(e))throw Error(rt(200));return HJe(t,e,null,r)};$h.createRoot=function(t,e){if(!rle(t))throw Error(rt(299));var r=!1,i="",n=k3e;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(n=e.onRecoverableError)),e=Qae(t,1,!1,null,null,r,!1,i,n),t[y_]=e.current,QD(t.nodeType===8?t.parentNode:t),new tle(e)};$h.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(rt(188)):(t=Object.keys(t).join(","),Error(rt(268,t)));return t=sPe(e),t=t===null?null:t.stateNode,t};$h.flushSync=function(t){return z2(t)};$h.hydrate=function(t,e,r){if(!fG(e))throw Error(rt(200));return mG(null,t,e,!0,r)};$h.hydrateRoot=function(t,e,r){if(!rle(t))throw Error(rt(405));var i=r!=null&&r.hydratedSources||null,n=!1,s="",o=k3e;if(r!=null&&(r.unstable_strictMode===!0&&(n=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),e=F3e(e,null,t,1,r??null,n,!1,s,o),t[y_]=e.current,QD(t),i)for(t=0;t<i.length;t++)r=i[t],n=r._getVersion,n=n(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,n]:e.mutableSourceEagerHydrationData.push(r,n);return new pG(e)};$h.render=function(t,e,r){if(!fG(e))throw Error(rt(200));return mG(null,t,e,!1,r)};$h.unmountComponentAtNode=function(t){if(!fG(t))throw Error(rt(40));return t._reactRootContainer?(z2(function(){mG(null,null,t,!1,function(){t._reactRootContainer=null,t[y_]=null})}),!0):!1};$h.unstable_batchedUpdates=Yae;$h.unstable_renderSubtreeIntoContainer=function(t,e,r,i){if(!fG(r))throw Error(rt(200));if(t==null||t._reactInternals===void 0)throw Error(rt(38));return mG(t,e,r,!1,i)};$h.version="18.2.0-next-9e3b772b8-20220608";function U3e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(U3e)}catch(t){console.error(t)}}U3e(),FAe.exports=$h;var gG=FAe.exports;const S5=CAe(gG);var Kge=gG;KJ.createRoot=Kge.createRoot,KJ.hydrateRoot=Kge.hydrateRoot;function Y(){return Y=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t},Y.apply(this,arguments)}function Ut(t,e){if(t==null)return{};var r={},i=Object.keys(t),n,s;for(s=0;s<i.length;s++)n=i[s],!(e.indexOf(n)>=0)&&(r[n]=t[n]);return r}function z3e(t){var e,r,i="";if(typeof t=="string"||typeof t=="number")i+=t;else if(typeof t=="object")if(Array.isArray(t))for(e=0;e<t.length;e++)t[e]&&(r=z3e(t[e]))&&(i&&(i+=" "),i+=r);else for(e in t)t[e]&&(i&&(i+=" "),i+=e);return i}function Pt(){for(var t,e,r=0,i="";r<arguments.length;)(t=arguments[r++])&&(e=z3e(t))&&(i&&(i+=" "),i+=e);return i}function IT(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function V3e(t){if(!IT(t))return t;const e={};return Object.keys(t).forEach(r=>{e[r]=V3e(t[r])}),e}function Gp(t,e,r={clone:!0}){const i=r.clone?Y({},t):t;return IT(t)&&IT(e)&&Object.keys(e).forEach(n=>{n!=="__proto__"&&(IT(e[n])&&n in t&&IT(t[n])?i[n]=Gp(t[n],e[n],r):r.clone?i[n]=IT(e[n])?V3e(e[n]):e[n]:i[n]=e[n])}),i}function Hw(t){let e="https://mui.com/production-error/?code="+t;for(let r=1;r<arguments.length;r+=1)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified MUI error #"+t+"; visit "+e+" for the full message."}var Fn={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ile=Symbol.for("react.element"),nle=Symbol.for("react.portal"),yG=Symbol.for("react.fragment"),vG=Symbol.for("react.strict_mode"),_G=Symbol.for("react.profiler"),bG=Symbol.for("react.provider"),wG=Symbol.for("react.context"),ZJe=Symbol.for("react.server_context"),xG=Symbol.for("react.forward_ref"),SG=Symbol.for("react.suspense"),TG=Symbol.for("react.suspense_list"),EG=Symbol.for("react.memo"),CG=Symbol.for("react.lazy"),JJe=Symbol.for("react.offscreen"),B3e;B3e=Symbol.for("react.module.reference");function yf(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case ile:switch(t=t.type,t){case yG:case _G:case vG:case SG:case TG:return t;default:switch(t=t&&t.$$typeof,t){case ZJe:case wG:case xG:case CG:case EG:case bG:return t;default:return e}}case nle:return e}}}Fn.ContextConsumer=wG;Fn.ContextProvider=bG;Fn.Element=ile;Fn.ForwardRef=xG;Fn.Fragment=yG;Fn.Lazy=CG;Fn.Memo=EG;Fn.Portal=nle;Fn.Profiler=_G;Fn.StrictMode=vG;Fn.Suspense=SG;Fn.SuspenseList=TG;Fn.isAsyncMode=function(){return!1};Fn.isConcurrentMode=function(){return!1};Fn.isContextConsumer=function(t){return yf(t)===wG};Fn.isContextProvider=function(t){return yf(t)===bG};Fn.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===ile};Fn.isForwardRef=function(t){return yf(t)===xG};Fn.isFragment=function(t){return yf(t)===yG};Fn.isLazy=function(t){return yf(t)===CG};Fn.isMemo=function(t){return yf(t)===EG};Fn.isPortal=function(t){return yf(t)===nle};Fn.isProfiler=function(t){return yf(t)===_G};Fn.isStrictMode=function(t){return yf(t)===vG};Fn.isSuspense=function(t){return yf(t)===SG};Fn.isSuspenseList=function(t){return yf(t)===TG};Fn.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===yG||t===_G||t===vG||t===SG||t===TG||t===JJe||typeof t=="object"&&t!==null&&(t.$$typeof===CG||t.$$typeof===EG||t.$$typeof===bG||t.$$typeof===wG||t.$$typeof===xG||t.$$typeof===B3e||t.getModuleId!==void 0)};Fn.typeOf=yf;function zt(t){if(typeof t!="string")throw new Error(Hw(7));return t.charAt(0).toUpperCase()+t.slice(1)}function HK(...t){return t.reduce((e,r)=>r==null?e:function(...n){e.apply(this,n),r.apply(this,n)},()=>{})}function V2(t,e=166){let r;function i(...n){const s=()=>{t.apply(this,n)};clearTimeout(r),r=setTimeout(s,e)}return i.clear=()=>{clearTimeout(r)},i}function KJe(t,e){return()=>null}function BL(t,e){return U.isValidElement(t)&&e.indexOf(t.type.muiName)!==-1}function Ll(t){return t&&t.ownerDocument||document}function ef(t){return Ll(t).defaultView||window}function QJe(t,e){return()=>null}function tV(t,e){typeof t=="function"?t(e):t&&(t.current=e)}const eKe=typeof window<"u"?U.useLayoutEffect:U.useEffect,Sh=eKe;let Qge=0;function tKe(t){const[e,r]=U.useState(t),i=t||e;return U.useEffect(()=>{e==null&&(Qge+=1,r(`mui-${Qge}`))},[e]),i}const eye=JJ["useId".toString()];function sle(t){if(eye!==void 0){const e=eye();return t??e}return tKe(t)}function rKe(t,e,r,i,n){return null}function rV({controlled:t,default:e,name:r,state:i="value"}){const{current:n}=U.useRef(t!==void 0),[s,o]=U.useState(e),a=n?t:s,l=U.useCallback(c=>{n||o(c)},[]);return[a,l]}function $m(t){const e=U.useRef(t);return Sh(()=>{e.current=t}),U.useCallback((...r)=>(0,e.current)(...r),[])}function Js(...t){return U.useMemo(()=>t.every(e=>e==null)?null:e=>{t.forEach(r=>{tV(r,e)})},t)}let RG=!0,qK=!1,tye;const iKe={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function nKe(t){const{type:e,tagName:r}=t;return!!(r==="INPUT"&&iKe[e]&&!t.readOnly||r==="TEXTAREA"&&!t.readOnly||t.isContentEditable)}function sKe(t){t.metaKey||t.altKey||t.ctrlKey||(RG=!0)}function PW(){RG=!1}function oKe(){this.visibilityState==="hidden"&&qK&&(RG=!0)}function aKe(t){t.addEventListener("keydown",sKe,!0),t.addEventListener("mousedown",PW,!0),t.addEventListener("pointerdown",PW,!0),t.addEventListener("touchstart",PW,!0),t.addEventListener("visibilitychange",oKe,!0)}function lKe(t){const{target:e}=t;try{return e.matches(":focus-visible")}catch{}return RG||nKe(e)}function ole(){const t=U.useCallback(n=>{n!=null&&aKe(n.ownerDocument)},[]),e=U.useRef(!1);function r(){return e.current?(qK=!0,window.clearTimeout(tye),tye=window.setTimeout(()=>{qK=!1},100),e.current=!1,!0):!1}function i(n){return lKe(n)?(e.current=!0,!0):!1}return{isFocusVisibleRef:e,onFocus:i,onBlur:r,ref:t}}function j3e(t){const e=t.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}let eC;function G3e(){if(eC)return eC;const t=document.createElement("div"),e=document.createElement("div");return e.style.width="10px",e.style.height="1px",t.appendChild(e),t.dir="rtl",t.style.fontSize="14px",t.style.width="4px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.overflow="scroll",document.body.appendChild(t),eC="reverse",t.scrollLeft>0?eC="default":(t.scrollLeft=1,t.scrollLeft===0&&(eC="negative")),document.body.removeChild(t),eC}function rye(t,e){const r=t.scrollLeft;if(e!=="rtl")return r;switch(G3e()){case"negative":return t.scrollWidth-t.clientWidth+r;case"reverse":return t.scrollWidth-t.clientWidth-r;default:return r}}function ale(t,e){const r=Y({},e);return Object.keys(t).forEach(i=>{if(i.toString().match(/^(components|slots)$/))r[i]=Y({},t[i],r[i]);else if(i.toString().match(/^(componentsProps|slotProps)$/)){const n=t[i]||{},s=e[i];r[i]={},!s||!Object.keys(s)?r[i]=n:!n||!Object.keys(n)?r[i]=s:(r[i]=Y({},s),Object.keys(n).forEach(o=>{r[i][o]=ale(n[o],s[o])}))}else r[i]===void 0&&(r[i]=t[i])}),r}function ui(t,e,r=void 0){const i={};return Object.keys(t).forEach(n=>{i[n]=t[n].reduce((s,o)=>{if(o){const a=e(o);a!==""&&s.push(a),r&&r[o]&&s.push(r[o])}return s},[]).join(" ")}),i}const iye=t=>t,cKe=()=>{let t=iye;return{configure(e){t=e},generate(e){return t(e)},reset(){t=iye}}},uKe=cKe(),lle=uKe,dKe={active:"active",checked:"checked",completed:"completed",disabled:"disabled",readOnly:"readOnly",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",required:"required",selected:"selected"};function ii(t,e,r="Mui"){const i=dKe[e];return i?`${r}-${i}`:`${lle.generate(t)}-${e}`}function Zr(t,e,r="Mui"){const i={};return e.forEach(n=>{i[n]=ii(t,n,r)}),i}function B2(t){return typeof t=="string"}function W$(t,e,r){return t===void 0||B2(t)?e:Y({},e,{ownerState:Y({},e.ownerState,r)})}const hKe={disableDefaultClasses:!1},pKe=U.createContext(hKe);function H3e(t){const{disableDefaultClasses:e}=U.useContext(pKe);return r=>e?"":t(r)}function fKe(t,e=[]){if(t===void 0)return{};const r={};return Object.keys(t).filter(i=>i.match(/^on[A-Z]/)&&typeof t[i]=="function"&&!e.includes(i)).forEach(i=>{r[i]=t[i]}),r}function WK(t,e,r){return typeof t=="function"?t(e,r):t}function nye(t){if(t===void 0)return{};const e={};return Object.keys(t).filter(r=>!(r.match(/^on[A-Z]/)&&typeof t[r]=="function")).forEach(r=>{e[r]=t[r]}),e}function mKe(t){const{getSlotProps:e,additionalProps:r,externalSlotProps:i,externalForwardedProps:n,className:s}=t;if(!e){const m=Pt(n==null?void 0:n.className,i==null?void 0:i.className,s,r==null?void 0:r.className),g=Y({},r==null?void 0:r.style,n==null?void 0:n.style,i==null?void 0:i.style),y=Y({},r,n,i);return m.length>0&&(y.className=m),Object.keys(g).length>0&&(y.style=g),{props:y,internalRef:void 0}}const o=fKe(Y({},n,i)),a=nye(i),l=nye(n),c=e(o),u=Pt(c==null?void 0:c.className,r==null?void 0:r.className,s,n==null?void 0:n.className,i==null?void 0:i.className),h=Y({},c==null?void 0:c.style,r==null?void 0:r.style,n==null?void 0:n.style,i==null?void 0:i.style),f=Y({},c,r,l,a);return u.length>0&&(f.className=u),Object.keys(h).length>0&&(f.style=h),{props:f,internalRef:c.ref}}const gKe=["elementType","externalSlotProps","ownerState","skipResolvingSlotProps"];function b_(t){var e;const{elementType:r,externalSlotProps:i,ownerState:n,skipResolvingSlotProps:s=!1}=t,o=Ut(t,gKe),a=s?{}:WK(i,n),{props:l,internalRef:c}=mKe(Y({},o,{externalSlotProps:a})),u=Js(c,a==null?void 0:a.ref,(e=t.additionalProps)==null?void 0:e.ref);return W$(r,Y({},l,{ref:u}),n)}const yKe=["input","select","textarea","a[href]","button","[tabindex]","audio[controls]","video[controls]",'[contenteditable]:not([contenteditable="false"])'].join(",");function vKe(t){const e=parseInt(t.getAttribute("tabindex")||"",10);return Number.isNaN(e)?t.contentEditable==="true"||(t.nodeName==="AUDIO"||t.nodeName==="VIDEO"||t.nodeName==="DETAILS")&&t.getAttribute("tabindex")===null?0:t.tabIndex:e}function _Ke(t){if(t.tagName!=="INPUT"||t.type!=="radio"||!t.name)return!1;const e=i=>t.ownerDocument.querySelector(`input[type="radio"]${i}`);let r=e(`[name="${t.name}"]:checked`);return r||(r=e(`[name="${t.name}"]`)),r!==t}function bKe(t){return!(t.disabled||t.tagName==="INPUT"&&t.type==="hidden"||_Ke(t))}function wKe(t){const e=[],r=[];return Array.from(t.querySelectorAll(yKe)).forEach((i,n)=>{const s=vKe(i);s===-1||!bKe(i)||(s===0?e.push(i):r.push({documentOrder:n,tabIndex:s,node:i}))}),r.sort((i,n)=>i.tabIndex===n.tabIndex?i.documentOrder-n.documentOrder:i.tabIndex-n.tabIndex).map(i=>i.node).concat(e)}function xKe(){return!0}function SKe(t){const{children:e,disableAutoFocus:r=!1,disableEnforceFocus:i=!1,disableRestoreFocus:n=!1,getTabbable:s=wKe,isEnabled:o=xKe,open:a}=t,l=U.useRef(!1),c=U.useRef(null),u=U.useRef(null),h=U.useRef(null),f=U.useRef(null),m=U.useRef(!1),g=U.useRef(null),y=Js(e.ref,g),_=U.useRef(null);U.useEffect(()=>{!a||!g.current||(m.current=!r)},[r,a]),U.useEffect(()=>{if(!a||!g.current)return;const x=Ll(g.current);return g.current.contains(x.activeElement)||(g.current.hasAttribute("tabIndex")||g.current.setAttribute("tabIndex","-1"),m.current&&g.current.focus()),()=>{n||(h.current&&h.current.focus&&(l.current=!0,h.current.focus()),h.current=null)}},[a]),U.useEffect(()=>{if(!a||!g.current)return;const x=Ll(g.current),S=R=>{const{current:P}=g;if(P!==null){if(!x.hasFocus()||i||!o()||l.current){l.current=!1;return}if(!P.contains(x.activeElement)){if(R&&f.current!==R.target||x.activeElement!==f.current)f.current=null;else if(f.current!==null)return;if(!m.current)return;let k=[];if((x.activeElement===c.current||x.activeElement===u.current)&&(k=s(g.current)),k.length>0){var D,L;const V=!!((D=_.current)!=null&&D.shiftKey&&((L=_.current)==null?void 0:L.key)==="Tab"),W=k[0],G=k[k.length-1];typeof W!="string"&&typeof G!="string"&&(V?G.focus():W.focus())}else P.focus()}}},C=R=>{_.current=R,!(i||!o()||R.key!=="Tab")&&x.activeElement===g.current&&R.shiftKey&&(l.current=!0,u.current&&u.current.focus())};x.addEventListener("focusin",S),x.addEventListener("keydown",C,!0);const E=setInterval(()=>{x.activeElement&&x.activeElement.tagName==="BODY"&&S(null)},50);return()=>{clearInterval(E),x.removeEventListener("focusin",S),x.removeEventListener("keydown",C,!0)}},[r,i,n,o,a,s]);const b=x=>{h.current===null&&(h.current=x.relatedTarget),m.current=!0,f.current=x.target;const S=e.props.onFocus;S&&S(x)},w=x=>{h.current===null&&(h.current=x.relatedTarget),m.current=!0};return F.jsxs(U.Fragment,{children:[F.jsx("div",{tabIndex:a?0:-1,onFocus:w,ref:c,"data-testid":"sentinelStart"}),U.cloneElement(e,{ref:y,onFocus:b}),F.jsx("div",{tabIndex:a?0:-1,onFocus:w,ref:u,"data-testid":"sentinelEnd"})]})}var hd="top",tf="bottom",rf="right",pd="left",cle="auto",O4=[hd,tf,rf,pd],iP="start",lN="end",TKe="clippingParents",q3e="viewport",yM="popper",EKe="reference",sye=O4.reduce(function(t,e){return t.concat([e+"-"+iP,e+"-"+lN])},[]),W3e=[].concat(O4,[cle]).reduce(function(t,e){return t.concat([e,e+"-"+iP,e+"-"+lN])},[]),CKe="beforeRead",RKe="read",OKe="afterRead",AKe="beforeMain",PKe="main",MKe="afterMain",$Ke="beforeWrite",IKe="write",LKe="afterWrite",DKe=[CKe,RKe,OKe,AKe,PKe,MKe,$Ke,IKe,LKe];function n0(t){return t?(t.nodeName||"").toLowerCase():null}function Th(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function j2(t){var e=Th(t).Element;return t instanceof e||t instanceof Element}function Hp(t){var e=Th(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function ule(t){if(typeof ShadowRoot>"u")return!1;var e=Th(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function NKe(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var i=e.styles[r]||{},n=e.attributes[r]||{},s=e.elements[r];!Hp(s)||!n0(s)||(Object.assign(s.style,i),Object.keys(n).forEach(function(o){var a=n[o];a===!1?s.removeAttribute(o):s.setAttribute(o,a===!0?"":a)}))})}function FKe(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(i){var n=e.elements[i],s=e.attributes[i]||{},o=Object.keys(e.styles.hasOwnProperty(i)?e.styles[i]:r[i]),a=o.reduce(function(l,c){return l[c]="",l},{});!Hp(n)||!n0(n)||(Object.assign(n.style,a),Object.keys(s).forEach(function(l){n.removeAttribute(l)}))})}}const kKe={name:"applyStyles",enabled:!0,phase:"write",fn:NKe,effect:FKe,requires:["computeStyles"]};function By(t){return t.split("-")[0]}var g2=Math.max,iV=Math.min,nP=Math.round;function XK(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function X3e(){return!/^((?!chrome|android).)*safari/i.test(XK())}function sP(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var i=t.getBoundingClientRect(),n=1,s=1;e&&Hp(t)&&(n=t.offsetWidth>0&&nP(i.width)/t.offsetWidth||1,s=t.offsetHeight>0&&nP(i.height)/t.offsetHeight||1);var o=j2(t)?Th(t):window,a=o.visualViewport,l=!X3e()&&r,c=(i.left+(l&&a?a.offsetLeft:0))/n,u=(i.top+(l&&a?a.offsetTop:0))/s,h=i.width/n,f=i.height/s;return{width:h,height:f,top:u,right:c+h,bottom:u+f,left:c,x:c,y:u}}function dle(t){var e=sP(t),r=t.offsetWidth,i=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-i)<=1&&(i=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:i}}function Y3e(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&ule(r)){var i=e;do{if(i&&t.isSameNode(i))return!0;i=i.parentNode||i.host}while(i)}return!1}function w_(t){return Th(t).getComputedStyle(t)}function UKe(t){return["table","td","th"].indexOf(n0(t))>=0}function xx(t){return((j2(t)?t.ownerDocument:t.document)||window.document).documentElement}function OG(t){return n0(t)==="html"?t:t.assignedSlot||t.parentNode||(ule(t)?t.host:null)||xx(t)}function oye(t){return!Hp(t)||w_(t).position==="fixed"?null:t.offsetParent}function zKe(t){var e=/firefox/i.test(XK()),r=/Trident/i.test(XK());if(r&&Hp(t)){var i=w_(t);if(i.position==="fixed")return null}var n=OG(t);for(ule(n)&&(n=n.host);Hp(n)&&["html","body"].indexOf(n0(n))<0;){var s=w_(n);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return n;n=n.parentNode}return null}function A4(t){for(var e=Th(t),r=oye(t);r&&UKe(r)&&w_(r).position==="static";)r=oye(r);return r&&(n0(r)==="html"||n0(r)==="body"&&w_(r).position==="static")?e:r||zKe(t)||e}function hle(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function jL(t,e,r){return g2(t,iV(e,r))}function VKe(t,e,r){var i=jL(t,e,r);return i>r?r:i}function Z3e(){return{top:0,right:0,bottom:0,left:0}}function J3e(t){return Object.assign({},Z3e(),t)}function K3e(t,e){return e.reduce(function(r,i){return r[i]=t,r},{})}var BKe=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,J3e(typeof e!="number"?e:K3e(e,O4))};function jKe(t){var e,r=t.state,i=t.name,n=t.options,s=r.elements.arrow,o=r.modifiersData.popperOffsets,a=By(r.placement),l=hle(a),c=[pd,rf].indexOf(a)>=0,u=c?"height":"width";if(!(!s||!o)){var h=BKe(n.padding,r),f=dle(s),m=l==="y"?hd:pd,g=l==="y"?tf:rf,y=r.rects.reference[u]+r.rects.reference[l]-o[l]-r.rects.popper[u],_=o[l]-r.rects.reference[l],b=A4(s),w=b?l==="y"?b.clientHeight||0:b.clientWidth||0:0,x=y/2-_/2,S=h[m],C=w-f[u]-h[g],E=w/2-f[u]/2+x,R=jL(S,E,C),P=l;r.modifiersData[i]=(e={},e[P]=R,e.centerOffset=R-E,e)}}function GKe(t){var e=t.state,r=t.options,i=r.element,n=i===void 0?"[data-popper-arrow]":i;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Y3e(e.elements.popper,n)&&(e.elements.arrow=n))}const HKe={name:"arrow",enabled:!0,phase:"main",fn:jKe,effect:GKe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function oP(t){return t.split("-")[1]}var qKe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function WKe(t,e){var r=t.x,i=t.y,n=e.devicePixelRatio||1;return{x:nP(r*n)/n||0,y:nP(i*n)/n||0}}function aye(t){var e,r=t.popper,i=t.popperRect,n=t.placement,s=t.variation,o=t.offsets,a=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,h=t.isFixed,f=o.x,m=f===void 0?0:f,g=o.y,y=g===void 0?0:g,_=typeof u=="function"?u({x:m,y}):{x:m,y};m=_.x,y=_.y;var b=o.hasOwnProperty("x"),w=o.hasOwnProperty("y"),x=pd,S=hd,C=window;if(c){var E=A4(r),R="clientHeight",P="clientWidth";if(E===Th(r)&&(E=xx(r),w_(E).position!=="static"&&a==="absolute"&&(R="scrollHeight",P="scrollWidth")),E=E,n===hd||(n===pd||n===rf)&&s===lN){S=tf;var D=h&&E===C&&C.visualViewport?C.visualViewport.height:E[R];y-=D-i.height,y*=l?1:-1}if(n===pd||(n===hd||n===tf)&&s===lN){x=rf;var L=h&&E===C&&C.visualViewport?C.visualViewport.width:E[P];m-=L-i.width,m*=l?1:-1}}var k=Object.assign({position:a},c&&qKe),V=u===!0?WKe({x:m,y},Th(r)):{x:m,y};if(m=V.x,y=V.y,l){var W;return Object.assign({},k,(W={},W[S]=w?"0":"",W[x]=b?"0":"",W.transform=(C.devicePixelRatio||1)<=1?"translate("+m+"px, "+y+"px)":"translate3d("+m+"px, "+y+"px, 0)",W))}return Object.assign({},k,(e={},e[S]=w?y+"px":"",e[x]=b?m+"px":"",e.transform="",e))}function XKe(t){var e=t.state,r=t.options,i=r.gpuAcceleration,n=i===void 0?!0:i,s=r.adaptive,o=s===void 0?!0:s,a=r.roundOffsets,l=a===void 0?!0:a,c={placement:By(e.placement),variation:oP(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,aye(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,aye(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const YKe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:XKe,data:{}};var T5={passive:!0};function ZKe(t){var e=t.state,r=t.instance,i=t.options,n=i.scroll,s=n===void 0?!0:n,o=i.resize,a=o===void 0?!0:o,l=Th(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&c.forEach(function(u){u.addEventListener("scroll",r.update,T5)}),a&&l.addEventListener("resize",r.update,T5),function(){s&&c.forEach(function(u){u.removeEventListener("scroll",r.update,T5)}),a&&l.removeEventListener("resize",r.update,T5)}}const JKe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:ZKe,data:{}};var KKe={left:"right",right:"left",bottom:"top",top:"bottom"};function p8(t){return t.replace(/left|right|bottom|top/g,function(e){return KKe[e]})}var QKe={start:"end",end:"start"};function lye(t){return t.replace(/start|end/g,function(e){return QKe[e]})}function ple(t){var e=Th(t),r=e.pageXOffset,i=e.pageYOffset;return{scrollLeft:r,scrollTop:i}}function fle(t){return sP(xx(t)).left+ple(t).scrollLeft}function eQe(t,e){var r=Th(t),i=xx(t),n=r.visualViewport,s=i.clientWidth,o=i.clientHeight,a=0,l=0;if(n){s=n.width,o=n.height;var c=X3e();(c||!c&&e==="fixed")&&(a=n.offsetLeft,l=n.offsetTop)}return{width:s,height:o,x:a+fle(t),y:l}}function tQe(t){var e,r=xx(t),i=ple(t),n=(e=t.ownerDocument)==null?void 0:e.body,s=g2(r.scrollWidth,r.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),o=g2(r.scrollHeight,r.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),a=-i.scrollLeft+fle(t),l=-i.scrollTop;return w_(n||r).direction==="rtl"&&(a+=g2(r.clientWidth,n?n.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}function mle(t){var e=w_(t),r=e.overflow,i=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+n+i)}function Q3e(t){return["html","body","#document"].indexOf(n0(t))>=0?t.ownerDocument.body:Hp(t)&&mle(t)?t:Q3e(OG(t))}function GL(t,e){var r;e===void 0&&(e=[]);var i=Q3e(t),n=i===((r=t.ownerDocument)==null?void 0:r.body),s=Th(i),o=n?[s].concat(s.visualViewport||[],mle(i)?i:[]):i,a=e.concat(o);return n?a:a.concat(GL(OG(o)))}function YK(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function rQe(t,e){var r=sP(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function cye(t,e,r){return e===q3e?YK(eQe(t,r)):j2(e)?rQe(e,r):YK(tQe(xx(t)))}function iQe(t){var e=GL(OG(t)),r=["absolute","fixed"].indexOf(w_(t).position)>=0,i=r&&Hp(t)?A4(t):t;return j2(i)?e.filter(function(n){return j2(n)&&Y3e(n,i)&&n0(n)!=="body"}):[]}function nQe(t,e,r,i){var n=e==="clippingParents"?iQe(t):[].concat(e),s=[].concat(n,[r]),o=s[0],a=s.reduce(function(l,c){var u=cye(t,c,i);return l.top=g2(u.top,l.top),l.right=iV(u.right,l.right),l.bottom=iV(u.bottom,l.bottom),l.left=g2(u.left,l.left),l},cye(t,o,i));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function eMe(t){var e=t.reference,r=t.element,i=t.placement,n=i?By(i):null,s=i?oP(i):null,o=e.x+e.width/2-r.width/2,a=e.y+e.height/2-r.height/2,l;switch(n){case hd:l={x:o,y:e.y-r.height};break;case tf:l={x:o,y:e.y+e.height};break;case rf:l={x:e.x+e.width,y:a};break;case pd:l={x:e.x-r.width,y:a};break;default:l={x:e.x,y:e.y}}var c=n?hle(n):null;if(c!=null){var u=c==="y"?"height":"width";switch(s){case iP:l[c]=l[c]-(e[u]/2-r[u]/2);break;case lN:l[c]=l[c]+(e[u]/2-r[u]/2);break}}return l}function cN(t,e){e===void 0&&(e={});var r=e,i=r.placement,n=i===void 0?t.placement:i,s=r.strategy,o=s===void 0?t.strategy:s,a=r.boundary,l=a===void 0?TKe:a,c=r.rootBoundary,u=c===void 0?q3e:c,h=r.elementContext,f=h===void 0?yM:h,m=r.altBoundary,g=m===void 0?!1:m,y=r.padding,_=y===void 0?0:y,b=J3e(typeof _!="number"?_:K3e(_,O4)),w=f===yM?EKe:yM,x=t.rects.popper,S=t.elements[g?w:f],C=nQe(j2(S)?S:S.contextElement||xx(t.elements.popper),l,u,o),E=sP(t.elements.reference),R=eMe({reference:E,element:x,strategy:"absolute",placement:n}),P=YK(Object.assign({},x,R)),D=f===yM?P:E,L={top:C.top-D.top+b.top,bottom:D.bottom-C.bottom+b.bottom,left:C.left-D.left+b.left,right:D.right-C.right+b.right},k=t.modifiersData.offset;if(f===yM&&k){var V=k[n];Object.keys(L).forEach(function(W){var G=[rf,tf].indexOf(W)>=0?1:-1,B=[hd,tf].indexOf(W)>=0?"y":"x";L[W]+=V[B]*G})}return L}function sQe(t,e){e===void 0&&(e={});var r=e,i=r.placement,n=r.boundary,s=r.rootBoundary,o=r.padding,a=r.flipVariations,l=r.allowedAutoPlacements,c=l===void 0?W3e:l,u=oP(i),h=u?a?sye:sye.filter(function(g){return oP(g)===u}):O4,f=h.filter(function(g){return c.indexOf(g)>=0});f.length===0&&(f=h);var m=f.reduce(function(g,y){return g[y]=cN(t,{placement:y,boundary:n,rootBoundary:s,padding:o})[By(y)],g},{});return Object.keys(m).sort(function(g,y){return m[g]-m[y]})}function oQe(t){if(By(t)===cle)return[];var e=p8(t);return[lye(t),e,lye(e)]}function aQe(t){var e=t.state,r=t.options,i=t.name;if(!e.modifiersData[i]._skip){for(var n=r.mainAxis,s=n===void 0?!0:n,o=r.altAxis,a=o===void 0?!0:o,l=r.fallbackPlacements,c=r.padding,u=r.boundary,h=r.rootBoundary,f=r.altBoundary,m=r.flipVariations,g=m===void 0?!0:m,y=r.allowedAutoPlacements,_=e.options.placement,b=By(_),w=b===_,x=l||(w||!g?[p8(_)]:oQe(_)),S=[_].concat(x).reduce(function(ae,be){return ae.concat(By(be)===cle?sQe(e,{placement:be,boundary:u,rootBoundary:h,padding:c,flipVariations:g,allowedAutoPlacements:y}):be)},[]),C=e.rects.reference,E=e.rects.popper,R=new Map,P=!0,D=S[0],L=0;L<S.length;L++){var k=S[L],V=By(k),W=oP(k)===iP,G=[hd,tf].indexOf(V)>=0,B=G?"width":"height",Z=cN(e,{placement:k,boundary:u,rootBoundary:h,altBoundary:f,padding:c}),M=G?W?rf:pd:W?tf:hd;C[B]>E[B]&&(M=p8(M));var $=p8(M),N=[];if(s&&N.push(Z[V]<=0),a&&N.push(Z[M]<=0,Z[$]<=0),N.every(function(ae){return ae})){D=k,P=!1;break}R.set(k,N)}if(P)for(var j=g?3:1,J=function(be){var Ee=S.find(function(Je){var ze=R.get(Je);if(ze)return ze.slice(0,be).every(function(Ge){return Ge})});if(Ee)return D=Ee,"break"},K=j;K>0;K--){var te=J(K);if(te==="break")break}e.placement!==D&&(e.modifiersData[i]._skip=!0,e.placement=D,e.reset=!0)}}const lQe={name:"flip",enabled:!0,phase:"main",fn:aQe,requiresIfExists:["offset"],data:{_skip:!1}};function uye(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function dye(t){return[hd,rf,tf,pd].some(function(e){return t[e]>=0})}function cQe(t){var e=t.state,r=t.name,i=e.rects.reference,n=e.rects.popper,s=e.modifiersData.preventOverflow,o=cN(e,{elementContext:"reference"}),a=cN(e,{altBoundary:!0}),l=uye(o,i),c=uye(a,n,s),u=dye(l),h=dye(c);e.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:h},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":h})}const uQe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:cQe};function dQe(t,e,r){var i=By(t),n=[pd,hd].indexOf(i)>=0?-1:1,s=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,o=s[0],a=s[1];return o=o||0,a=(a||0)*n,[pd,rf].indexOf(i)>=0?{x:a,y:o}:{x:o,y:a}}function hQe(t){var e=t.state,r=t.options,i=t.name,n=r.offset,s=n===void 0?[0,0]:n,o=W3e.reduce(function(u,h){return u[h]=dQe(h,e.rects,s),u},{}),a=o[e.placement],l=a.x,c=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[i]=o}const pQe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:hQe};function fQe(t){var e=t.state,r=t.name;e.modifiersData[r]=eMe({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const mQe={name:"popperOffsets",enabled:!0,phase:"read",fn:fQe,data:{}};function gQe(t){return t==="x"?"y":"x"}function yQe(t){var e=t.state,r=t.options,i=t.name,n=r.mainAxis,s=n===void 0?!0:n,o=r.altAxis,a=o===void 0?!1:o,l=r.boundary,c=r.rootBoundary,u=r.altBoundary,h=r.padding,f=r.tether,m=f===void 0?!0:f,g=r.tetherOffset,y=g===void 0?0:g,_=cN(e,{boundary:l,rootBoundary:c,padding:h,altBoundary:u}),b=By(e.placement),w=oP(e.placement),x=!w,S=hle(b),C=gQe(S),E=e.modifiersData.popperOffsets,R=e.rects.reference,P=e.rects.popper,D=typeof y=="function"?y(Object.assign({},e.rects,{placement:e.placement})):y,L=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),k=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,V={x:0,y:0};if(E){if(s){var W,G=S==="y"?hd:pd,B=S==="y"?tf:rf,Z=S==="y"?"height":"width",M=E[S],$=M+_[G],N=M-_[B],j=m?-P[Z]/2:0,J=w===iP?R[Z]:P[Z],K=w===iP?-P[Z]:-R[Z],te=e.elements.arrow,ae=m&&te?dle(te):{width:0,height:0},be=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Z3e(),Ee=be[G],Je=be[B],ze=jL(0,R[Z],ae[Z]),Ge=x?R[Z]/2-j-ze-Ee-L.mainAxis:J-ze-Ee-L.mainAxis,Le=x?-R[Z]/2+j+ze+Je+L.mainAxis:K+ze+Je+L.mainAxis,de=e.elements.arrow&&A4(e.elements.arrow),$e=de?S==="y"?de.clientTop||0:de.clientLeft||0:0,Be=(W=k==null?void 0:k[S])!=null?W:0,we=M+Ge-Be-$e,Ie=M+Le-Be,je=jL(m?iV($,we):$,M,m?g2(N,Ie):N);E[S]=je,V[S]=je-M}if(a){var fe,Ae=S==="x"?hd:pd,gt=S==="x"?tf:rf,Re=E[C],He=C==="y"?"height":"width",Dt=Re+_[Ae],Fe=Re-_[gt],nt=[hd,pd].indexOf(b)!==-1,Ke=(fe=k==null?void 0:k[C])!=null?fe:0,mt=nt?Dt:Re-R[He]-P[He]-Ke+L.altAxis,wt=nt?Re+R[He]+P[He]-Ke-L.altAxis:Fe,xt=m&&nt?VKe(mt,Re,wt):jL(m?mt:Dt,Re,m?wt:Fe);E[C]=xt,V[C]=xt-Re}e.modifiersData[i]=V}}const vQe={name:"preventOverflow",enabled:!0,phase:"main",fn:yQe,requiresIfExists:["offset"]};function _Qe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function bQe(t){return t===Th(t)||!Hp(t)?ple(t):_Qe(t)}function wQe(t){var e=t.getBoundingClientRect(),r=nP(e.width)/t.offsetWidth||1,i=nP(e.height)/t.offsetHeight||1;return r!==1||i!==1}function xQe(t,e,r){r===void 0&&(r=!1);var i=Hp(e),n=Hp(e)&&wQe(e),s=xx(e),o=sP(t,n,r),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(i||!i&&!r)&&((n0(e)!=="body"||mle(s))&&(a=bQe(e)),Hp(e)?(l=sP(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=fle(s))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function SQe(t){var e=new Map,r=new Set,i=[];t.forEach(function(s){e.set(s.name,s)});function n(s){r.add(s.name);var o=[].concat(s.requires||[],s.requiresIfExists||[]);o.forEach(function(a){if(!r.has(a)){var l=e.get(a);l&&n(l)}}),i.push(s)}return t.forEach(function(s){r.has(s.name)||n(s)}),i}function TQe(t){var e=SQe(t);return DKe.reduce(function(r,i){return r.concat(e.filter(function(n){return n.phase===i}))},[])}function EQe(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function CQe(t){var e=t.reduce(function(r,i){var n=r[i.name];return r[i.name]=n?Object.assign({},n,i,{options:Object.assign({},n.options,i.options),data:Object.assign({},n.data,i.data)}):i,r},{});return Object.keys(e).map(function(r){return e[r]})}var hye={placement:"bottom",modifiers:[],strategy:"absolute"};function pye(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(i){return!(i&&typeof i.getBoundingClientRect=="function")})}function RQe(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,i=r===void 0?[]:r,n=e.defaultOptions,s=n===void 0?hye:n;return function(a,l,c){c===void 0&&(c=s);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},hye,s),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},h=[],f=!1,m={state:u,setOptions:function(b){var w=typeof b=="function"?b(u.options):b;y(),u.options=Object.assign({},s,u.options,w),u.scrollParents={reference:j2(a)?GL(a):a.contextElement?GL(a.contextElement):[],popper:GL(l)};var x=TQe(CQe([].concat(i,u.options.modifiers)));return u.orderedModifiers=x.filter(function(S){return S.enabled}),g(),m.update()},forceUpdate:function(){if(!f){var b=u.elements,w=b.reference,x=b.popper;if(pye(w,x)){u.rects={reference:xQe(w,A4(x),u.options.strategy==="fixed"),popper:dle(x)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(L){return u.modifiersData[L.name]=Object.assign({},L.data)});for(var S=0;S<u.orderedModifiers.length;S++){if(u.reset===!0){u.reset=!1,S=-1;continue}var C=u.orderedModifiers[S],E=C.fn,R=C.options,P=R===void 0?{}:R,D=C.name;typeof E=="function"&&(u=E({state:u,options:P,name:D,instance:m})||u)}}}},update:EQe(function(){return new Promise(function(_){m.forceUpdate(),_(u)})}),destroy:function(){y(),f=!0}};if(!pye(a,l))return m;m.setOptions(c).then(function(_){!f&&c.onFirstUpdate&&c.onFirstUpdate(_)});function g(){u.orderedModifiers.forEach(function(_){var b=_.name,w=_.options,x=w===void 0?{}:w,S=_.effect;if(typeof S=="function"){var C=S({state:u,name:b,instance:m,options:x}),E=function(){};h.push(C||E)}})}function y(){h.forEach(function(_){return _()}),h=[]}return m}}var OQe=[JKe,mQe,YKe,kKe,pQe,lQe,vQe,HKe,uQe],AQe=RQe({defaultModifiers:OQe});function PQe(t){return typeof t=="function"?t():t}const MQe=U.forwardRef(function(e,r){const{children:i,container:n,disablePortal:s=!1}=e,[o,a]=U.useState(null),l=Js(U.isValidElement(i)?i.ref:null,r);if(Sh(()=>{s||a(PQe(n)||document.body)},[n,s]),Sh(()=>{if(o&&!s)return tV(r,o),()=>{tV(r,null)}},[r,o,s]),s){if(U.isValidElement(i)){const c={ref:l};return U.cloneElement(i,c)}return F.jsx(U.Fragment,{children:i})}return F.jsx(U.Fragment,{children:o&&gG.createPortal(i,o)})}),tMe=MQe;function $Qe(t){return ii("MuiPopper",t)}Zr("MuiPopper",["root"]);const IQe=["anchorEl","children","direction","disablePortal","modifiers","open","placement","popperOptions","popperRef","slotProps","slots","TransitionProps","ownerState"],LQe=["anchorEl","children","container","direction","disablePortal","keepMounted","modifiers","open","placement","popperOptions","popperRef","style","transition","slotProps","slots"];function DQe(t,e){if(e==="ltr")return t;switch(t){case"bottom-end":return"bottom-start";case"bottom-start":return"bottom-end";case"top-end":return"top-start";case"top-start":return"top-end";default:return t}}function ZK(t){return typeof t=="function"?t():t}function NQe(t){return t.nodeType!==void 0}const FQe=()=>ui({root:["root"]},H3e($Qe)),kQe={},UQe=U.forwardRef(function(e,r){var i;const{anchorEl:n,children:s,direction:o,disablePortal:a,modifiers:l,open:c,placement:u,popperOptions:h,popperRef:f,slotProps:m={},slots:g={},TransitionProps:y}=e,_=Ut(e,IQe),b=U.useRef(null),w=Js(b,r),x=U.useRef(null),S=Js(x,f),C=U.useRef(S);Sh(()=>{C.current=S},[S]),U.useImperativeHandle(f,()=>x.current,[]);const E=DQe(u,o),[R,P]=U.useState(E),[D,L]=U.useState(ZK(n));U.useEffect(()=>{x.current&&x.current.forceUpdate()}),U.useEffect(()=>{n&&L(ZK(n))},[n]),Sh(()=>{if(!D||!c)return;const B=$=>{P($.placement)};let Z=[{name:"preventOverflow",options:{altBoundary:a}},{name:"flip",options:{altBoundary:a}},{name:"onUpdate",enabled:!0,phase:"afterWrite",fn:({state:$})=>{B($)}}];l!=null&&(Z=Z.concat(l)),h&&h.modifiers!=null&&(Z=Z.concat(h.modifiers));const M=AQe(D,b.current,Y({placement:E},h,{modifiers:Z}));return C.current(M),()=>{M.destroy(),C.current(null)}},[D,a,l,c,h,E]);const k={placement:R};y!==null&&(k.TransitionProps=y);const V=FQe(),W=(i=g.root)!=null?i:"div",G=b_({elementType:W,externalSlotProps:m.root,externalForwardedProps:_,additionalProps:{role:"tooltip",ref:w},ownerState:e,className:V.root});return F.jsx(W,Y({},G,{children:typeof s=="function"?s(k):s}))}),zQe=U.forwardRef(function(e,r){const{anchorEl:i,children:n,container:s,direction:o="ltr",disablePortal:a=!1,keepMounted:l=!1,modifiers:c,open:u,placement:h="bottom",popperOptions:f=kQe,popperRef:m,style:g,transition:y=!1,slotProps:_={},slots:b={}}=e,w=Ut(e,LQe),[x,S]=U.useState(!0),C=()=>{S(!1)},E=()=>{S(!0)};if(!l&&!u&&(!y||x))return null;let R;if(s)R=s;else if(i){const L=ZK(i);R=L&&NQe(L)?Ll(L).body:Ll(null).body}const P=!u&&l&&(!y||x)?"none":void 0,D=y?{in:u,onEnter:C,onExited:E}:void 0;return F.jsx(tMe,{disablePortal:a,container:R,children:F.jsx(UQe,Y({anchorEl:i,direction:o,disablePortal:a,modifiers:c,ref:r,open:y?!x:u,placement:h,popperOptions:f,popperRef:m,slotProps:_,slots:b},w,{style:Y({position:"fixed",top:0,left:0,display:P},g),TransitionProps:D,children:n}))})}),VQe=zQe;function BQe(t){const e=Ll(t);return e.body===t?ef(t).innerWidth>e.documentElement.clientWidth:t.scrollHeight>t.clientHeight}function HL(t,e){e?t.setAttribute("aria-hidden","true"):t.removeAttribute("aria-hidden")}function fye(t){return parseInt(ef(t).getComputedStyle(t).paddingRight,10)||0}function jQe(t){const r=["TEMPLATE","SCRIPT","STYLE","LINK","MAP","META","NOSCRIPT","PICTURE","COL","COLGROUP","PARAM","SLOT","SOURCE","TRACK"].indexOf(t.tagName)!==-1,i=t.tagName==="INPUT"&&t.getAttribute("type")==="hidden";return r||i}function mye(t,e,r,i,n){const s=[e,r,...i];[].forEach.call(t.children,o=>{const a=s.indexOf(o)===-1,l=!jQe(o);a&&l&&HL(o,n)})}function MW(t,e){let r=-1;return t.some((i,n)=>e(i)?(r=n,!0):!1),r}function GQe(t,e){const r=[],i=t.container;if(!e.disableScrollLock){if(BQe(i)){const o=j3e(Ll(i));r.push({value:i.style.paddingRight,property:"padding-right",el:i}),i.style.paddingRight=`${fye(i)+o}px`;const a=Ll(i).querySelectorAll(".mui-fixed");[].forEach.call(a,l=>{r.push({value:l.style.paddingRight,property:"padding-right",el:l}),l.style.paddingRight=`${fye(l)+o}px`})}let s;if(i.parentNode instanceof DocumentFragment)s=Ll(i).body;else{const o=i.parentElement,a=ef(i);s=(o==null?void 0:o.nodeName)==="HTML"&&a.getComputedStyle(o).overflowY==="scroll"?o:i}r.push({value:s.style.overflow,property:"overflow",el:s},{value:s.style.overflowX,property:"overflow-x",el:s},{value:s.style.overflowY,property:"overflow-y",el:s}),s.style.overflow="hidden"}return()=>{r.forEach(({value:s,el:o,property:a})=>{s?o.style.setProperty(a,s):o.style.removeProperty(a)})}}function HQe(t){const e=[];return[].forEach.call(t.children,r=>{r.getAttribute("aria-hidden")==="true"&&e.push(r)}),e}class qQe{constructor(){this.containers=void 0,this.modals=void 0,this.modals=[],this.containers=[]}add(e,r){let i=this.modals.indexOf(e);if(i!==-1)return i;i=this.modals.length,this.modals.push(e),e.modalRef&&HL(e.modalRef,!1);const n=HQe(r);mye(r,e.mount,e.modalRef,n,!0);const s=MW(this.containers,o=>o.container===r);return s!==-1?(this.containers[s].modals.push(e),i):(this.containers.push({modals:[e],container:r,restore:null,hiddenSiblings:n}),i)}mount(e,r){const i=MW(this.containers,s=>s.modals.indexOf(e)!==-1),n=this.containers[i];n.restore||(n.restore=GQe(n,r))}remove(e,r=!0){const i=this.modals.indexOf(e);if(i===-1)return i;const n=MW(this.containers,o=>o.modals.indexOf(e)!==-1),s=this.containers[n];if(s.modals.splice(s.modals.indexOf(e),1),this.modals.splice(i,1),s.modals.length===0)s.restore&&s.restore(),e.modalRef&&HL(e.modalRef,r),mye(s.container,e.mount,e.modalRef,s.hiddenSiblings,!1),this.containers.splice(n,1);else{const o=s.modals[s.modals.length-1];o.modalRef&&HL(o.modalRef,!1)}return i}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}}function WQe(t){return ii("MuiModal",t)}Zr("MuiModal",["root","hidden","backdrop"]);const XQe=["children","closeAfterTransition","container","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onKeyDown","open","onTransitionEnter","onTransitionExited","slotProps","slots"],YQe=t=>{const{open:e,exited:r}=t;return ui({root:["root",!e&&r&&"hidden"],backdrop:["backdrop"]},H3e(WQe))};function ZQe(t){return typeof t=="function"?t():t}function JQe(t){return t?t.props.hasOwnProperty("in"):!1}const KQe=new qQe,QQe=U.forwardRef(function(e,r){var i,n;const{children:s,closeAfterTransition:o=!1,container:a,disableAutoFocus:l=!1,disableEnforceFocus:c=!1,disableEscapeKeyDown:u=!1,disablePortal:h=!1,disableRestoreFocus:f=!1,disableScrollLock:m=!1,hideBackdrop:g=!1,keepMounted:y=!1,manager:_=KQe,onBackdropClick:b,onClose:w,onKeyDown:x,open:S,onTransitionEnter:C,onTransitionExited:E,slotProps:R={},slots:P={}}=e,D=Ut(e,XQe),L=_,[k,V]=U.useState(!S),W=U.useRef({}),G=U.useRef(null),B=U.useRef(null),Z=Js(B,r),M=JQe(s),$=(i=e["aria-hidden"])!=null?i:!0,N=()=>Ll(G.current),j=()=>(W.current.modalRef=B.current,W.current.mountNode=G.current,W.current),J=()=>{L.mount(j(),{disableScrollLock:m}),B.current&&(B.current.scrollTop=0)},K=$m(()=>{const fe=ZQe(a)||N().body;L.add(j(),fe),B.current&&J()}),te=U.useCallback(()=>L.isTopModal(j()),[L]),ae=$m(fe=>{G.current=fe,!(!fe||!B.current)&&(S&&te()?J():HL(B.current,$))}),be=U.useCallback(()=>{L.remove(j(),$)},[L,$]);U.useEffect(()=>()=>{be()},[be]),U.useEffect(()=>{S?K():(!M||!o)&&be()},[S,be,M,o,K]);const Ee=Y({},e,{closeAfterTransition:o,disableAutoFocus:l,disableEnforceFocus:c,disableEscapeKeyDown:u,disablePortal:h,disableRestoreFocus:f,disableScrollLock:m,exited:k,hideBackdrop:g,keepMounted:y}),Je=YQe(Ee),ze=()=>{V(!1),C&&C()},Ge=()=>{V(!0),E&&E(),o&&be()},Le=fe=>{fe.target===fe.currentTarget&&(b&&b(fe),w&&w(fe,"backdropClick"))},de=fe=>{x&&x(fe),!(fe.key!=="Escape"||!te())&&(u||(fe.stopPropagation(),w&&w(fe,"escapeKeyDown")))},$e={};s.props.tabIndex===void 0&&($e.tabIndex="-1"),M&&($e.onEnter=HK(ze,s.props.onEnter),$e.onExited=HK(Ge,s.props.onExited));const Be=(n=P.root)!=null?n:"div",we=b_({elementType:Be,externalSlotProps:R.root,externalForwardedProps:D,additionalProps:{ref:Z,role:"presentation",onKeyDown:de},className:Je.root,ownerState:Ee}),Ie=P.backdrop,je=b_({elementType:Ie,externalSlotProps:R.backdrop,additionalProps:{"aria-hidden":!0,onClick:Le,open:S},className:Je.backdrop,ownerState:Ee});return!y&&!S&&(!M||k)?null:F.jsx(tMe,{ref:ae,container:a,disablePortal:h,children:F.jsxs(Be,Y({},we,{children:[!g&&Ie?F.jsx(Ie,Y({},je)):null,F.jsx(SKe,{disableEnforceFocus:c,disableAutoFocus:l,disableRestoreFocus:f,isEnabled:te,open:S,children:U.cloneElement(s,$e)})]}))})}),eet=QQe,tet=["onChange","maxRows","minRows","style","value"];function E5(t){return parseInt(t,10)||0}const ret={shadow:{visibility:"hidden",position:"absolute",overflow:"hidden",height:0,top:0,left:0,transform:"translateZ(0)"}};function gye(t){return t==null||Object.keys(t).length===0||t.outerHeightStyle===0&&!t.overflow}const iet=U.forwardRef(function(e,r){const{onChange:i,maxRows:n,minRows:s=1,style:o,value:a}=e,l=Ut(e,tet),{current:c}=U.useRef(a!=null),u=U.useRef(null),h=Js(r,u),f=U.useRef(null),m=U.useRef(0),[g,y]=U.useState({outerHeightStyle:0}),_=U.useCallback(()=>{const C=u.current,R=ef(C).getComputedStyle(C);if(R.width==="0px")return{outerHeightStyle:0};const P=f.current;P.style.width=R.width,P.value=C.value||e.placeholder||"x",P.value.slice(-1)===`
`&&(P.value+=" ");const D=R.boxSizing,L=E5(R.paddingBottom)+E5(R.paddingTop),k=E5(R.borderBottomWidth)+E5(R.borderTopWidth),V=P.scrollHeight;P.value="x";const W=P.scrollHeight;let G=V;s&&(G=Math.max(Number(s)*W,G)),n&&(G=Math.min(Number(n)*W,G)),G=Math.max(G,W);const B=G+(D==="border-box"?L+k:0),Z=Math.abs(G-V)<=1;return{outerHeightStyle:B,overflow:Z}},[n,s,e.placeholder]),b=(C,E)=>{const{outerHeightStyle:R,overflow:P}=E;return m.current<20&&(R>0&&Math.abs((C.outerHeightStyle||0)-R)>1||C.overflow!==P)?(m.current+=1,{overflow:P,outerHeightStyle:R}):C},w=U.useCallback(()=>{const C=_();gye(C)||y(E=>b(E,C))},[_]),x=()=>{const C=_();gye(C)||gG.flushSync(()=>{y(E=>b(E,C))})};U.useEffect(()=>{const C=V2(()=>{m.current=0,u.current&&x()});let E;const R=u.current,P=ef(R);return P.addEventListener("resize",C),typeof ResizeObserver<"u"&&(E=new ResizeObserver(C),E.observe(R)),()=>{C.clear(),P.removeEventListener("resize",C),E&&E.disconnect()}}),Sh(()=>{w()}),U.useEffect(()=>{m.current=0},[a]);const S=C=>{m.current=0,c||w(),i&&i(C)};return F.jsxs(U.Fragment,{children:[F.jsx("textarea",Y({value:a,onChange:S,ref:h,rows:s,style:Y({height:g.outerHeightStyle,overflow:g.overflow?"hidden":void 0},o)},l)),F.jsx("textarea",{"aria-hidden":!0,className:e.className,readOnly:!0,ref:f,tabIndex:-1,style:Y({},ret.shadow,o,{paddingTop:0,paddingBottom:0})})]})}),net=iet;function rMe(t){var e=Object.create(null);return function(r){return e[r]===void 0&&(e[r]=t(r)),e[r]}}var set=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,oet=rMe(function(t){return set.test(t)||t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)<91});function aet(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}function cet(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),t.nonce!==void 0&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}var uet=function(){function t(r){var i=this;this._insertTag=function(n){var s;i.tags.length===0?i.insertionPoint?s=i.insertionPoint.nextSibling:i.prepend?s=i.container.firstChild:s=i.before:s=i.tags[i.tags.length-1].nextSibling,i.container.insertBefore(n,s),i.tags.push(n)},this.isSpeedy=r.speedy===void 0?!0:r.speedy,this.tags=[],this.ctr=0,this.nonce=r.nonce,this.key=r.key,this.container=r.container,this.prepend=r.prepend,this.insertionPoint=r.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(i){i.forEach(this._insertTag)},e.insert=function(i){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(cet(this));var n=this.tags[this.tags.length-1];if(this.isSpeedy){var s=aet(n);try{s.insertRule(i,s.cssRules.length)}catch{}}else n.appendChild(document.createTextNode(i));this.ctr++},e.flush=function(){this.tags.forEach(function(i){return i.parentNode&&i.parentNode.removeChild(i)}),this.tags=[],this.ctr=0},t}(),tc="-ms-",nV="-moz-",sn="-webkit-",iMe="comm",gle="rule",yle="decl",det="@import",nMe="@keyframes",het="@layer",pet=Math.abs,AG=String.fromCharCode,fet=Object.assign;function met(t,e){return El(t,0)^45?(((e<<2^El(t,0))<<2^El(t,1))<<2^El(t,2))<<2^El(t,3):0}function sMe(t){return t.trim()}function get(t,e){return(t=e.exec(t))?t[0]:t}function an(t,e,r){return t.replace(e,r)}function JK(t,e){return t.indexOf(e)}function El(t,e){return t.charCodeAt(e)|0}function uN(t,e,r){return t.slice(e,r)}function Sy(t){return t.length}function vle(t){return t.length}function C5(t,e){return e.push(t),t}function yet(t,e){return t.map(e).join("")}var PG=1,aP=1,oMe=0,_d=0,sa=0,g3="";function MG(t,e,r,i,n,s,o){return{value:t,root:e,parent:r,type:i,props:n,children:s,line:PG,column:aP,length:o,return:""}}function vM(t,e){return fet(MG("",null,null,"",null,null,0),t,{length:-t.length},e)}function vet(){return sa}function _et(){return sa=_d>0?El(g3,--_d):0,aP--,sa===10&&(aP=1,PG--),sa}function mh(){return sa=_d<oMe?El(g3,_d++):0,aP++,sa===10&&(aP=1,PG++),sa}function jy(){return El(g3,_d)}function f8(){return _d}function P4(t,e){return uN(g3,t,e)}function dN(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function aMe(t){return PG=aP=1,oMe=Sy(g3=t),_d=0,[]}function lMe(t){return g3="",t}function m8(t){return sMe(P4(_d-1,KK(t===91?t+2:t===40?t+1:t)))}function bet(t){for(;(sa=jy())&&sa<33;)mh();return dN(t)>2||dN(sa)>3?"":" "}function wet(t,e){for(;--e&&mh()&&!(sa<48||sa>102||sa>57&&sa<65||sa>70&&sa<97););return P4(t,f8()+(e<6&&jy()==32&&mh()==32))}function KK(t){for(;mh();)switch(sa){case t:return _d;case 34:case 39:t!==34&&t!==39&&KK(sa);break;case 40:t===41&&KK(t);break;case 92:mh();break}return _d}function xet(t,e){for(;mh()&&t+sa!==47+10;)if(t+sa===42+42&&jy()===47)break;return"/*"+P4(e,_d-1)+"*"+AG(t===47?t:mh())}function Tet(t){for(;!dN(jy());)mh();return P4(t,_d)}function Eet(t){return lMe(g8("",null,null,null,[""],t=aMe(t),0,[0],t))}function g8(t,e,r,i,n,s,o,a,l){for(var c=0,u=0,h=o,f=0,m=0,g=0,y=1,_=1,b=1,w=0,x="",S=n,C=s,E=i,R=x;_;)switch(g=w,w=mh()){case 40:if(g!=108&&El(R,h-1)==58){JK(R+=an(m8(w),"&","&\f"),"&\f")!=-1&&(b=-1);break}case 34:case 39:case 91:R+=m8(w);break;case 9:case 10:case 13:case 32:R+=bet(g);break;case 92:R+=wet(f8()-1,7);continue;case 47:switch(jy()){case 42:case 47:C5(Cet(xet(mh(),f8()),e,r),l);break;default:R+="/"}break;case 123*y:a[c++]=Sy(R)*b;case 125*y:case 59:case 0:switch(w){case 0:case 125:_=0;case 59+u:b==-1&&(R=an(R,/\f/g,"")),m>0&&Sy(R)-h&&C5(m>32?vye(R+";",i,r,h-1):vye(an(R," ","")+";",i,r,h-2),l);break;case 59:R+=";";default:if(C5(E=yye(R,e,r,c,u,n,a,x,S=[],C=[],h),s),w===123)if(u===0)g8(R,e,E,E,S,s,h,a,C);else switch(f===99&&El(R,3)===110?100:f){case 100:case 108:case 109:case 115:g8(t,E,E,i&&C5(yye(t,E,E,0,0,n,a,x,n,S=[],h),C),n,C,h,a,i?S:C);break;default:g8(R,E,E,E,[""],C,0,a,C)}}c=u=m=0,y=b=1,x=R="",h=o;break;case 58:h=1+Sy(R),m=g;default:if(y<1){if(w==123)--y;else if(w==125&&y++==0&&_et()==125)continue}switch(R+=AG(w),w*y){case 38:b=u>0?1:(R+="\f",-1);break;case 44:a[c++]=(Sy(R)-1)*b,b=1;break;case 64:jy()===45&&(R+=m8(mh())),f=jy(),u=h=Sy(x=R+=Tet(f8())),w++;break;case 45:g===45&&Sy(R)==2&&(y=0)}}return s}function yye(t,e,r,i,n,s,o,a,l,c,u){for(var h=n-1,f=n===0?s:[""],m=vle(f),g=0,y=0,_=0;g<i;++g)for(var b=0,w=uN(t,h+1,h=pet(y=o[g])),x=t;b<m;++b)(x=sMe(y>0?f[b]+" "+w:an(w,/&\f/g,f[b])))&&(l[_++]=x);return MG(t,e,r,n===0?gle:a,l,c,u)}function Cet(t,e,r){return MG(t,e,r,iMe,AG(vet()),uN(t,2,-2),0)}function vye(t,e,r,i){return MG(t,e,r,yle,uN(t,0,i),uN(t,i+1,-1),i)}function mA(t,e){for(var r="",i=vle(t),n=0;n<i;n++)r+=e(t[n],n,t,e)||"";return r}function Ret(t,e,r,i){switch(t.type){case het:if(t.children.length)break;case det:case yle:return t.return=t.return||t.value;case iMe:return"";case nMe:return t.return=t.value+"{"+mA(t.children,i)+"}";case gle:t.value=t.props.join(",")}return Sy(r=mA(t.children,i))?t.return=t.value+"{"+r+"}":""}function Oet(t){var e=vle(t);return function(r,i,n,s){for(var o="",a=0;a<e;a++)o+=t[a](r,i,n,s)||"";return o}}function Aet(t){return function(e){e.root||(e=e.return)&&t(e)}}var Pet=function(e,r,i){for(var n=0,s=0;n=s,s=jy(),n===38&&s===12&&(r[i]=1),!dN(s);)mh();return P4(e,_d)},Met=function(e,r){var i=-1,n=44;do switch(dN(n)){case 0:n===38&&jy()===12&&(r[i]=1),e[i]+=Pet(_d-1,r,i);break;case 2:e[i]+=m8(n);break;case 4:if(n===44){e[++i]=jy()===58?"&\f":"",r[i]=e[i].length;break}default:e[i]+=AG(n)}while(n=mh());return e},$et=function(e,r){return lMe(Met(aMe(e),r))},_ye=new WeakMap,Iet=function(e){if(!(e.type!=="rule"||!e.parent||e.length<1)){for(var r=e.value,i=e.parent,n=e.column===i.column&&e.line===i.line;i.type!=="rule";)if(i=i.parent,!i)return;if(!(e.props.length===1&&r.charCodeAt(0)!==58&&!_ye.get(i))&&!n){_ye.set(e,!0);for(var s=[],o=$et(r,s),a=i.props,l=0,c=0;l<o.length;l++)for(var u=0;u<a.length;u++,c++)e.props[c]=s[l]?o[l].replace(/&\f/g,a[u]):a[u]+" "+o[l]}}},Let=function(e){if(e.type==="decl"){var r=e.value;r.charCodeAt(0)===108&&r.charCodeAt(2)===98&&(e.return="",e.value="")}};function cMe(t,e){switch(met(t,e)){case 5103:return sn+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return sn+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return sn+t+nV+t+tc+t+t;case 6828:case 4268:return sn+t+tc+t+t;case 6165:return sn+t+tc+"flex-"+t+t;case 5187:return sn+t+an(t,/(\w+).+(:[^]+)/,sn+"box-$1$2"+tc+"flex-$1$2")+t;case 5443:return sn+t+tc+"flex-item-"+an(t,/flex-|-self/,"")+t;case 4675:return sn+t+tc+"flex-line-pack"+an(t,/align-content|flex-|-self/,"")+t;case 5548:return sn+t+tc+an(t,"shrink","negative")+t;case 5292:return sn+t+tc+an(t,"basis","preferred-size")+t;case 6060:return sn+"box-"+an(t,"-grow","")+sn+t+tc+an(t,"grow","positive")+t;case 4554:return sn+an(t,/([^-])(transform)/g,"$1"+sn+"$2")+t;case 6187:return an(an(an(t,/(zoom-|grab)/,sn+"$1"),/(image-set)/,sn+"$1"),t,"")+t;case 5495:case 3959:return an(t,/(image-set\([^]*)/,sn+"$1$`$1");case 4968:return an(an(t,/(.+:)(flex-)?(.*)/,sn+"box-pack:$3"+tc+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+sn+t+t;case 4095:case 3583:case 4068:case 2532:return an(t,/(.+)-inline(.+)/,sn+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Sy(t)-1-e>6)switch(El(t,e+1)){case 109:if(El(t,e+4)!==45)break;case 102:return an(t,/(.+:)(.+)-([^]+)/,"$1"+sn+"$2-$3$1"+nV+(El(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~JK(t,"stretch")?cMe(an(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(El(t,e+1)!==115)break;case 6444:switch(El(t,Sy(t)-3-(~JK(t,"!important")&&10))){case 107:return an(t,":",":"+sn)+t;case 101:return an(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+sn+(El(t,14)===45?"inline-":"")+"box$3$1"+sn+"$2$3$1"+tc+"$2box$3")+t}break;case 5936:switch(El(t,e+11)){case 114:return sn+t+tc+an(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return sn+t+tc+an(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return sn+t+tc+an(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return sn+t+tc+t+t}return t}var Det=function(e,r,i,n){if(e.length>-1&&!e.return)switch(e.type){case yle:e.return=cMe(e.value,e.length);break;case nMe:return mA([vM(e,{value:an(e.value,"@","@"+sn)})],n);case gle:if(e.length)return yet(e.props,function(s){switch(get(s,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return mA([vM(e,{props:[an(s,/:(read-\w+)/,":"+nV+"$1")]})],n);case"::placeholder":return mA([vM(e,{props:[an(s,/:(plac\w+)/,":"+sn+"input-$1")]}),vM(e,{props:[an(s,/:(plac\w+)/,":"+nV+"$1")]}),vM(e,{props:[an(s,/:(plac\w+)/,tc+"input-$1")]})],n)}return""})}},Net=[Det],Fet=function(e){var r=e.key;if(r==="css"){var i=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(i,function(y){var _=y.getAttribute("data-emotion");_.indexOf(" ")!==-1&&(document.head.appendChild(y),y.setAttribute("data-s",""))})}var n=e.stylisPlugins||Net,s={},o,a=[];o=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+r+' "]'),function(y){for(var _=y.getAttribute("data-emotion").split(" "),b=1;b<_.length;b++)s[_[b]]=!0;a.push(y)});var l,c=[Iet,Let];{var u,h=[Ret,Aet(function(y){u.insert(y)})],f=Oet(c.concat(n,h)),m=function(_){return mA(Eet(_),f)};l=function(_,b,w,x){u=w,m(_?_+"{"+b.styles+"}":b.styles),x&&(g.inserted[b.name]=!0)}}var g={key:r,sheet:new uet({key:r,container:o,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:s,registered:{},insert:l};return g.sheet.hydrate(a),g},uMe={exports:{}},Cn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dl=typeof Symbol=="function"&&Symbol.for,_le=dl?Symbol.for("react.element"):60103,ble=dl?Symbol.for("react.portal"):60106,$G=dl?Symbol.for("react.fragment"):60107,IG=dl?Symbol.for("react.strict_mode"):60108,LG=dl?Symbol.for("react.profiler"):60114,DG=dl?Symbol.for("react.provider"):60109,NG=dl?Symbol.for("react.context"):60110,wle=dl?Symbol.for("react.async_mode"):60111,FG=dl?Symbol.for("react.concurrent_mode"):60111,kG=dl?Symbol.for("react.forward_ref"):60112,UG=dl?Symbol.for("react.suspense"):60113,ket=dl?Symbol.for("react.suspense_list"):60120,zG=dl?Symbol.for("react.memo"):60115,VG=dl?Symbol.for("react.lazy"):60116,Uet=dl?Symbol.for("react.block"):60121,zet=dl?Symbol.for("react.fundamental"):60117,Vet=dl?Symbol.for("react.responder"):60118,Bet=dl?Symbol.for("react.scope"):60119;function Lh(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case _le:switch(t=t.type,t){case wle:case FG:case $G:case LG:case IG:case UG:return t;default:switch(t=t&&t.$$typeof,t){case NG:case kG:case VG:case zG:case DG:return t;default:return e}}case ble:return e}}}function dMe(t){return Lh(t)===FG}Cn.AsyncMode=wle;Cn.ConcurrentMode=FG;Cn.ContextConsumer=NG;Cn.ContextProvider=DG;Cn.Element=_le;Cn.ForwardRef=kG;Cn.Fragment=$G;Cn.Lazy=VG;Cn.Memo=zG;Cn.Portal=ble;Cn.Profiler=LG;Cn.StrictMode=IG;Cn.Suspense=UG;Cn.isAsyncMode=function(t){return dMe(t)||Lh(t)===wle};Cn.isConcurrentMode=dMe;Cn.isContextConsumer=function(t){return Lh(t)===NG};Cn.isContextProvider=function(t){return Lh(t)===DG};Cn.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===_le};Cn.isForwardRef=function(t){return Lh(t)===kG};Cn.isFragment=function(t){return Lh(t)===$G};Cn.isLazy=function(t){return Lh(t)===VG};Cn.isMemo=function(t){return Lh(t)===zG};Cn.isPortal=function(t){return Lh(t)===ble};Cn.isProfiler=function(t){return Lh(t)===LG};Cn.isStrictMode=function(t){return Lh(t)===IG};Cn.isSuspense=function(t){return Lh(t)===UG};Cn.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===$G||t===FG||t===LG||t===IG||t===UG||t===ket||typeof t=="object"&&t!==null&&(t.$$typeof===VG||t.$$typeof===zG||t.$$typeof===DG||t.$$typeof===NG||t.$$typeof===kG||t.$$typeof===zet||t.$$typeof===Vet||t.$$typeof===Bet||t.$$typeof===Uet)};Cn.typeOf=Lh;uMe.exports=Cn;var jet=uMe.exports,hMe=jet,Get={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Het={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},pMe={};pMe[hMe.ForwardRef]=Get;pMe[hMe.Memo]=Het;var qet=!0;function Wet(t,e,r){var i="";return r.split(" ").forEach(function(n){t[n]!==void 0?e.push(t[n]+";"):i+=n+" "}),i}var fMe=function(e,r,i){var n=e.key+"-"+r.name;(i===!1||qet===!1)&&e.registered[n]===void 0&&(e.registered[n]=r.styles)},mMe=function(e,r,i){fMe(e,r,i);var n=e.key+"-"+r.name;if(e.inserted[r.name]===void 0){var s=r;do e.insert(r===s?"."+n:"",s,e.sheet,!0),s=s.next;while(s!==void 0)}};function Xet(t){for(var e=0,r,i=0,n=t.length;n>=4;++i,n-=4)r=t.charCodeAt(i)&255|(t.charCodeAt(++i)&255)<<8|(t.charCodeAt(++i)&255)<<16|(t.charCodeAt(++i)&255)<<24,r=(r&65535)*1540483477+((r>>>16)*59797<<16),r^=r>>>24,e=(r&65535)*1540483477+((r>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(n){case 3:e^=(t.charCodeAt(i+2)&255)<<16;case 2:e^=(t.charCodeAt(i+1)&255)<<8;case 1:e^=t.charCodeAt(i)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}var Yet={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Zet=/[A-Z]|^ms/g,Jet=/_EMO_([^_]+?)_([^]*?)_EMO_/g,gMe=function(e){return e.charCodeAt(1)===45},bye=function(e){return e!=null&&typeof e!="boolean"},$W=rMe(function(t){return gMe(t)?t:t.replace(Zet,"-$&").toLowerCase()}),wye=function(e,r){switch(e){case"animation":case"animationName":if(typeof r=="string")return r.replace(Jet,function(i,n,s){return Ty={name:n,styles:s,next:Ty},n})}return Yet[e]!==1&&!gMe(e)&&typeof r=="number"&&r!==0?r+"px":r};function hN(t,e,r){if(r==null)return"";if(r.__emotion_styles!==void 0)return r;switch(typeof r){case"boolean":return"";case"object":{if(r.anim===1)return Ty={name:r.name,styles:r.styles,next:Ty},r.name;if(r.styles!==void 0){var i=r.next;if(i!==void 0)for(;i!==void 0;)Ty={name:i.name,styles:i.styles,next:Ty},i=i.next;var n=r.styles+";";return n}return Ket(t,e,r)}case"function":{if(t!==void 0){var s=Ty,o=r(t);return Ty=s,hN(t,e,o)}break}}if(e==null)return r;var a=e[r];return a!==void 0?a:r}function Ket(t,e,r){var i="";if(Array.isArray(r))for(var n=0;n<r.length;n++)i+=hN(t,e,r[n])+";";else for(var s in r){var o=r[s];if(typeof o!="object")e!=null&&e[o]!==void 0?i+=s+"{"+e[o]+"}":bye(o)&&(i+=$W(s)+":"+wye(s,o)+";");else if(Array.isArray(o)&&typeof o[0]=="string"&&(e==null||e[o[0]]===void 0))for(var a=0;a<o.length;a++)bye(o[a])&&(i+=$W(s)+":"+wye(s,o[a])+";");else{var l=hN(t,e,o);switch(s){case"animation":case"animationName":{i+=$W(s)+":"+l+";";break}default:i+=s+"{"+l+"}"}}}return i}var xye=/label:\s*([^\s;\n{]+)\s*(;|$)/g,Ty,xle=function(e,r,i){if(e.length===1&&typeof e[0]=="object"&&e[0]!==null&&e[0].styles!==void 0)return e[0];var n=!0,s="";Ty=void 0;var o=e[0];o==null||o.raw===void 0?(n=!1,s+=hN(i,r,o)):s+=o[0];for(var a=1;a<e.length;a++)s+=hN(i,r,e[a]),n&&(s+=o[a]);xye.lastIndex=0;for(var l="",c;(c=xye.exec(s))!==null;)l+="-"+c[1];var u=Xet(s)+l;return{name:u,styles:s,next:Ty}},Qet=function(e){return e()},yMe=JJ["useInsertionEffect"]?JJ["useInsertionEffect"]:!1,ett=yMe||Qet,Sye=yMe||U.useLayoutEffect,vMe=U.createContext(typeof HTMLElement<"u"?Fet({key:"css"}):null);vMe.Provider;var _Me=function(e){return U.forwardRef(function(r,i){var n=U.useContext(vMe);return e(r,n,i)})},BG=U.createContext({}),ttt=_Me(function(t,e){var r=t.styles,i=xle([r],void 0,U.useContext(BG)),n=U.useRef();return Sye(function(){var s=e.key+"-global",o=new e.sheet.constructor({key:s,nonce:e.sheet.nonce,container:e.sheet.container,speedy:e.sheet.isSpeedy}),a=!1,l=document.querySelector('style[data-emotion="'+s+" "+i.name+'"]');return e.sheet.tags.length&&(o.before=e.sheet.tags[0]),l!==null&&(a=!0,l.setAttribute("data-emotion",s),o.hydrate([l])),n.current=[o,a],function(){o.flush()}},[e]),Sye(function(){var s=n.current,o=s[0],a=s[1];if(a){s[1]=!1;return}if(i.next!==void 0&&mMe(e,i.next,!0),o.tags.length){var l=o.tags[o.tags.length-1].nextElementSibling;o.before=l,o.flush()}e.insert("",i,o,!1)},[e,i.name]),null});function rtt(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return xle(e)}var Sle=function(){var e=rtt.apply(void 0,arguments),r="animation-"+e.name;return{name:r,styles:"@keyframes "+r+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}},itt=oet,ntt=function(e){return e!=="theme"},Tye=function(e){return typeof e=="string"&&e.charCodeAt(0)>96?itt:ntt},Eye=function(e,r,i){var n;if(r){var s=r.shouldForwardProp;n=e.__emotion_forwardProp&&s?function(o){return e.__emotion_forwardProp(o)&&s(o)}:s}return typeof n!="function"&&i&&(n=e.__emotion_forwardProp),n},stt=function(e){var r=e.cache,i=e.serialized,n=e.isStringTag;return fMe(r,i,n),ett(function(){return mMe(r,i,n)}),null},ott=function t(e,r){var i=e.__emotion_real===e,n=i&&e.__emotion_base||e,s,o;r!==void 0&&(s=r.label,o=r.target);var a=Eye(e,r,i),l=a||Tye(n),c=!l("as");return function(){var u=arguments,h=i&&e.__emotion_styles!==void 0?e.__emotion_styles.slice(0):[];if(s!==void 0&&h.push("label:"+s+";"),u[0]==null||u[0].raw===void 0)h.push.apply(h,u);else{h.push(u[0][0]);for(var f=u.length,m=1;m<f;m++)h.push(u[m],u[0][m])}var g=_Me(function(y,_,b){var w=c&&y.as||n,x="",S=[],C=y;if(y.theme==null){C={};for(var E in y)C[E]=y[E];C.theme=U.useContext(BG)}typeof y.className=="string"?x=Wet(_.registered,S,y.className):y.className!=null&&(x=y.className+" ");var R=xle(h.concat(S),_.registered,C);x+=_.key+"-"+R.name,o!==void 0&&(x+=" "+o);var P=c&&a===void 0?Tye(w):l,D={};for(var L in y)c&&L==="as"||P(L)&&(D[L]=y[L]);return D.className=x,D.ref=b,U.createElement(U.Fragment,null,U.createElement(stt,{cache:_,serialized:R,isStringTag:typeof w=="string"}),U.createElement(w,D))});return g.displayName=s!==void 0?s:"Styled("+(typeof n=="string"?n:n.displayName||n.name||"Component")+")",g.defaultProps=e.defaultProps,g.__emotion_real=g,g.__emotion_base=n,g.__emotion_styles=h,g.__emotion_forwardProp=a,Object.defineProperty(g,"toString",{value:function(){return"."+o}}),g.withComponent=function(y,_){return t(y,Y({},r,_,{shouldForwardProp:Eye(g,_,!0)})).apply(void 0,h)},g}},att=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],QK=ott.bind();att.forEach(function(t){QK[t]=QK(t)});function ltt(t){return t==null||Object.keys(t).length===0}function ctt(t){const{styles:e,defaultTheme:r={}}=t,i=typeof e=="function"?n=>e(ltt(n)?r:n):e;return F.jsx(ttt,{styles:i})}/**
 * @mui/styled-engine v5.13.2
 *
 * @license MIT
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */function bMe(t,e){return QK(t,e)}const utt=(t,e)=>{Array.isArray(t.__emotion_styles)&&(t.__emotion_styles=e(t.__emotion_styles))},dtt=["values","unit","step"],htt=t=>{const e=Object.keys(t).map(r=>({key:r,val:t[r]}))||[];return e.sort((r,i)=>r.val-i.val),e.reduce((r,i)=>Y({},r,{[i.key]:i.val}),{})};function ptt(t){const{values:e={xs:0,sm:600,md:900,lg:1200,xl:1536},unit:r="px",step:i=5}=t,n=Ut(t,dtt),s=htt(e),o=Object.keys(s);function a(f){return`@media (min-width:${typeof e[f]=="number"?e[f]:f}${r})`}function l(f){return`@media (max-width:${(typeof e[f]=="number"?e[f]:f)-i/100}${r})`}function c(f,m){const g=o.indexOf(m);return`@media (min-width:${typeof e[f]=="number"?e[f]:f}${r}) and (max-width:${(g!==-1&&typeof e[o[g]]=="number"?e[o[g]]:m)-i/100}${r})`}function u(f){return o.indexOf(f)+1<o.length?c(f,o[o.indexOf(f)+1]):a(f)}function h(f){const m=o.indexOf(f);return m===0?a(o[1]):m===o.length-1?l(o[m]):c(f,o[o.indexOf(f)+1]).replace("@media","@media not all and")}return Y({keys:o,values:s,up:a,down:l,between:c,only:u,not:h,unit:r},n)}const ftt={borderRadius:4},mtt=ftt;function qL(t,e){return e?Gp(t,e,{clone:!1}):t}const Tle={xs:0,sm:600,md:900,lg:1200,xl:1536},Cye={keys:["xs","sm","md","lg","xl"],up:t=>`@media (min-width:${Tle[t]}px)`};function x_(t,e,r){const i=t.theme||{};if(Array.isArray(e)){const s=i.breakpoints||Cye;return e.reduce((o,a,l)=>(o[s.up(s.keys[l])]=r(e[l]),o),{})}if(typeof e=="object"){const s=i.breakpoints||Cye;return Object.keys(e).reduce((o,a)=>{if(Object.keys(s.values||Tle).indexOf(a)!==-1){const l=s.up(a);o[l]=r(e[a],a)}else{const l=a;o[l]=e[l]}return o},{})}return r(e)}function gtt(t={}){var e;return((e=t.keys)==null?void 0:e.reduce((i,n)=>{const s=t.up(n);return i[s]={},i},{}))||{}}function ytt(t,e){return t.reduce((r,i)=>{const n=r[i];return(!n||Object.keys(n).length===0)&&delete r[i],r},e)}function jG(t,e,r=!0){if(!e||typeof e!="string")return null;if(t&&t.vars&&r){const i=`vars.${e}`.split(".").reduce((n,s)=>n&&n[s]?n[s]:null,t);if(i!=null)return i}return e.split(".").reduce((i,n)=>i&&i[n]!=null?i[n]:null,t)}function sV(t,e,r,i=r){let n;return typeof t=="function"?n=t(r):Array.isArray(t)?n=t[r]||i:n=jG(t,r)||i,e&&(n=e(n,i,t)),n}function _n(t){const{prop:e,cssProperty:r=t.prop,themeKey:i,transform:n}=t,s=o=>{if(o[e]==null)return null;const a=o[e],l=o.theme,c=jG(l,i)||{};return x_(o,a,h=>{let f=sV(c,n,h);return h===f&&typeof h=="string"&&(f=sV(c,n,`${e}${h==="default"?"":zt(h)}`,h)),r===!1?f:{[r]:f}})};return s.propTypes={},s.filterProps=[e],s}function vtt(t){const e={};return r=>(e[r]===void 0&&(e[r]=t(r)),e[r])}const _tt={m:"margin",p:"padding"},btt={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},Rye={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},wtt=vtt(t=>{if(t.length>2)if(Rye[t])t=Rye[t];else return[t];const[e,r]=t.split(""),i=_tt[e],n=btt[r]||"";return Array.isArray(n)?n.map(s=>i+s):[i+n]}),Ele=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],Cle=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"];[...Ele,...Cle];function M4(t,e,r,i){var n;const s=(n=jG(t,e,!1))!=null?n:r;return typeof s=="number"?o=>typeof o=="string"?o:s*o:Array.isArray(s)?o=>typeof o=="string"?o:s[o]:typeof s=="function"?s:()=>{}}function wMe(t){return M4(t,"spacing",8)}function $4(t,e){if(typeof e=="string"||e==null)return e;const r=Math.abs(e),i=t(r);return e>=0?i:typeof i=="number"?-i:`-${i}`}function xtt(t,e){return r=>t.reduce((i,n)=>(i[n]=$4(e,r),i),{})}function Stt(t,e,r,i){if(e.indexOf(r)===-1)return null;const n=wtt(r),s=xtt(n,i),o=t[r];return x_(t,o,s)}function xMe(t,e){const r=wMe(t.theme);return Object.keys(t).map(i=>Stt(t,e,i,r)).reduce(qL,{})}function lo(t){return xMe(t,Ele)}lo.propTypes={};lo.filterProps=Ele;function co(t){return xMe(t,Cle)}co.propTypes={};co.filterProps=Cle;function Ttt(t=8){if(t.mui)return t;const e=wMe({spacing:t}),r=(...i)=>(i.length===0?[1]:i).map(s=>{const o=e(s);return typeof o=="number"?`${o}px`:o}).join(" ");return r.mui=!0,r}function GG(...t){const e=t.reduce((i,n)=>(n.filterProps.forEach(s=>{i[s]=n}),i),{}),r=i=>Object.keys(i).reduce((n,s)=>e[s]?qL(n,e[s](i)):n,{});return r.propTypes={},r.filterProps=t.reduce((i,n)=>i.concat(n.filterProps),[]),r}function Cy(t){return typeof t!="number"?t:`${t}px solid`}const Ett=_n({prop:"border",themeKey:"borders",transform:Cy}),Ctt=_n({prop:"borderTop",themeKey:"borders",transform:Cy}),Rtt=_n({prop:"borderRight",themeKey:"borders",transform:Cy}),Ott=_n({prop:"borderBottom",themeKey:"borders",transform:Cy}),Att=_n({prop:"borderLeft",themeKey:"borders",transform:Cy}),Ptt=_n({prop:"borderColor",themeKey:"palette"}),Mtt=_n({prop:"borderTopColor",themeKey:"palette"}),$tt=_n({prop:"borderRightColor",themeKey:"palette"}),Itt=_n({prop:"borderBottomColor",themeKey:"palette"}),Ltt=_n({prop:"borderLeftColor",themeKey:"palette"}),HG=t=>{if(t.borderRadius!==void 0&&t.borderRadius!==null){const e=M4(t.theme,"shape.borderRadius",4),r=i=>({borderRadius:$4(e,i)});return x_(t,t.borderRadius,r)}return null};HG.propTypes={};HG.filterProps=["borderRadius"];GG(Ett,Ctt,Rtt,Ott,Att,Ptt,Mtt,$tt,Itt,Ltt,HG);const qG=t=>{if(t.gap!==void 0&&t.gap!==null){const e=M4(t.theme,"spacing",8),r=i=>({gap:$4(e,i)});return x_(t,t.gap,r)}return null};qG.propTypes={};qG.filterProps=["gap"];const WG=t=>{if(t.columnGap!==void 0&&t.columnGap!==null){const e=M4(t.theme,"spacing",8),r=i=>({columnGap:$4(e,i)});return x_(t,t.columnGap,r)}return null};WG.propTypes={};WG.filterProps=["columnGap"];const XG=t=>{if(t.rowGap!==void 0&&t.rowGap!==null){const e=M4(t.theme,"spacing",8),r=i=>({rowGap:$4(e,i)});return x_(t,t.rowGap,r)}return null};XG.propTypes={};XG.filterProps=["rowGap"];const Dtt=_n({prop:"gridColumn"}),Ntt=_n({prop:"gridRow"}),Ftt=_n({prop:"gridAutoFlow"}),ktt=_n({prop:"gridAutoColumns"}),Utt=_n({prop:"gridAutoRows"}),ztt=_n({prop:"gridTemplateColumns"}),Vtt=_n({prop:"gridTemplateRows"}),Btt=_n({prop:"gridTemplateAreas"}),jtt=_n({prop:"gridArea"});GG(qG,WG,XG,Dtt,Ntt,Ftt,ktt,Utt,ztt,Vtt,Btt,jtt);function gA(t,e){return e==="grey"?e:t}const Gtt=_n({prop:"color",themeKey:"palette",transform:gA}),Htt=_n({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette",transform:gA}),qtt=_n({prop:"backgroundColor",themeKey:"palette",transform:gA});GG(Gtt,Htt,qtt);function oh(t){return t<=1&&t!==0?`${t*100}%`:t}const Wtt=_n({prop:"width",transform:oh}),Rle=t=>{if(t.maxWidth!==void 0&&t.maxWidth!==null){const e=r=>{var i,n,s;return{maxWidth:((i=t.theme)==null||(n=i.breakpoints)==null||(s=n.values)==null?void 0:s[r])||Tle[r]||oh(r)}};return x_(t,t.maxWidth,e)}return null};Rle.filterProps=["maxWidth"];const Xtt=_n({prop:"minWidth",transform:oh}),Ytt=_n({prop:"height",transform:oh}),Ztt=_n({prop:"maxHeight",transform:oh}),Jtt=_n({prop:"minHeight",transform:oh});_n({prop:"size",cssProperty:"width",transform:oh});_n({prop:"size",cssProperty:"height",transform:oh});const Ktt=_n({prop:"boxSizing"});GG(Wtt,Rle,Xtt,Ytt,Ztt,Jtt,Ktt);const Qtt={border:{themeKey:"borders",transform:Cy},borderTop:{themeKey:"borders",transform:Cy},borderRight:{themeKey:"borders",transform:Cy},borderBottom:{themeKey:"borders",transform:Cy},borderLeft:{themeKey:"borders",transform:Cy},borderColor:{themeKey:"palette"},borderTopColor:{themeKey:"palette"},borderRightColor:{themeKey:"palette"},borderBottomColor:{themeKey:"palette"},borderLeftColor:{themeKey:"palette"},borderRadius:{themeKey:"shape.borderRadius",style:HG},color:{themeKey:"palette",transform:gA},bgcolor:{themeKey:"palette",cssProperty:"backgroundColor",transform:gA},backgroundColor:{themeKey:"palette",transform:gA},p:{style:co},pt:{style:co},pr:{style:co},pb:{style:co},pl:{style:co},px:{style:co},py:{style:co},padding:{style:co},paddingTop:{style:co},paddingRight:{style:co},paddingBottom:{style:co},paddingLeft:{style:co},paddingX:{style:co},paddingY:{style:co},paddingInline:{style:co},paddingInlineStart:{style:co},paddingInlineEnd:{style:co},paddingBlock:{style:co},paddingBlockStart:{style:co},paddingBlockEnd:{style:co},m:{style:lo},mt:{style:lo},mr:{style:lo},mb:{style:lo},ml:{style:lo},mx:{style:lo},my:{style:lo},margin:{style:lo},marginTop:{style:lo},marginRight:{style:lo},marginBottom:{style:lo},marginLeft:{style:lo},marginX:{style:lo},marginY:{style:lo},marginInline:{style:lo},marginInlineStart:{style:lo},marginInlineEnd:{style:lo},marginBlock:{style:lo},marginBlockStart:{style:lo},marginBlockEnd:{style:lo},displayPrint:{cssProperty:!1,transform:t=>({"@media print":{display:t}})},display:{},overflow:{},textOverflow:{},visibility:{},whiteSpace:{},flexBasis:{},flexDirection:{},flexWrap:{},justifyContent:{},alignItems:{},alignContent:{},order:{},flex:{},flexGrow:{},flexShrink:{},alignSelf:{},justifyItems:{},justifySelf:{},gap:{style:qG},rowGap:{style:XG},columnGap:{style:WG},gridColumn:{},gridRow:{},gridAutoFlow:{},gridAutoColumns:{},gridAutoRows:{},gridTemplateColumns:{},gridTemplateRows:{},gridTemplateAreas:{},gridArea:{},position:{},zIndex:{themeKey:"zIndex"},top:{},right:{},bottom:{},left:{},boxShadow:{themeKey:"shadows"},width:{transform:oh},maxWidth:{style:Rle},minWidth:{transform:oh},height:{transform:oh},maxHeight:{transform:oh},minHeight:{transform:oh},boxSizing:{},fontFamily:{themeKey:"typography"},fontSize:{themeKey:"typography"},fontStyle:{themeKey:"typography"},fontWeight:{themeKey:"typography"},letterSpacing:{},textTransform:{},lineHeight:{},textAlign:{},typography:{cssProperty:!1,themeKey:"typography"}},YG=Qtt;function ert(...t){const e=t.reduce((i,n)=>i.concat(Object.keys(n)),[]),r=new Set(e);return t.every(i=>r.size===Object.keys(i).length)}function trt(t,e){return typeof t=="function"?t(e):t}function rrt(){function t(r,i,n,s){const o={[r]:i,theme:n},a=s[r];if(!a)return{[r]:i};const{cssProperty:l=r,themeKey:c,transform:u,style:h}=a;if(i==null)return null;if(c==="typography"&&i==="inherit")return{[r]:i};const f=jG(n,c)||{};return h?h(o):x_(o,i,g=>{let y=sV(f,u,g);return g===y&&typeof g=="string"&&(y=sV(f,u,`${r}${g==="default"?"":zt(g)}`,g)),l===!1?y:{[l]:y}})}function e(r){var i;const{sx:n,theme:s={}}=r||{};if(!n)return null;const o=(i=s.unstable_sxConfig)!=null?i:YG;function a(l){let c=l;if(typeof l=="function")c=l(s);else if(typeof l!="object")return l;if(!c)return null;const u=gtt(s.breakpoints),h=Object.keys(u);let f=u;return Object.keys(c).forEach(m=>{const g=trt(c[m],s);if(g!=null)if(typeof g=="object")if(o[m])f=qL(f,t(m,g,s,o));else{const y=x_({theme:s},g,_=>({[m]:_}));ert(y,g)?f[m]=e({sx:g,theme:s}):f=qL(f,y)}else f=qL(f,t(m,g,s,o))}),ytt(h,f)}return Array.isArray(n)?n.map(a):a(n)}return e}const SMe=rrt();SMe.filterProps=["sx"];const ZG=SMe,irt=["breakpoints","palette","spacing","shape"];function Ole(t={},...e){const{breakpoints:r={},palette:i={},spacing:n,shape:s={}}=t,o=Ut(t,irt),a=ptt(r),l=Ttt(n);let c=Gp({breakpoints:a,direction:"ltr",components:{},palette:Y({mode:"light"},i),spacing:l,shape:Y({},mtt,s)},o);return c=e.reduce((u,h)=>Gp(u,h),c),c.unstable_sxConfig=Y({},YG,o==null?void 0:o.unstable_sxConfig),c.unstable_sx=function(h){return ZG({sx:h,theme:this})},c}function nrt(t){return Object.keys(t).length===0}function Ale(t=null){const e=U.useContext(BG);return!e||nrt(e)?t:e}const srt=Ole();function JG(t=srt){return Ale(t)}function ort({styles:t,themeId:e,defaultTheme:r={}}){const i=JG(r),n=typeof t=="function"?t(e&&i[e]||i):t;return F.jsx(ctt,{styles:n})}const art=["sx"],lrt=t=>{var e,r;const i={systemProps:{},otherProps:{}},n=(e=t==null||(r=t.theme)==null?void 0:r.unstable_sxConfig)!=null?e:YG;return Object.keys(t).forEach(s=>{n[s]?i.systemProps[s]=t[s]:i.otherProps[s]=t[s]}),i};function TMe(t){const{sx:e}=t,r=Ut(t,art),{systemProps:i,otherProps:n}=lrt(r);let s;return Array.isArray(e)?s=[i,...e]:typeof e=="function"?s=(...o)=>{const a=e(...o);return IT(a)?Y({},i,a):i}:s=Y({},i,e),Y({},n,{sx:s})}const crt=["className","component"];function EMe(t={}){const{themeId:e,defaultTheme:r,defaultClassName:i="MuiBox-root",generateClassName:n}=t,s=bMe("div",{shouldForwardProp:a=>a!=="theme"&&a!=="sx"&&a!=="as"})(ZG);return U.forwardRef(function(l,c){const u=JG(r),h=TMe(l),{className:f,component:m="div"}=h,g=Ut(h,crt);return F.jsx(s,Y({as:m,ref:c,className:Pt(f,n?n(i):i),theme:e&&u[e]||u},g))})}const urt=EMe(),drt=urt,hrt=["variant"];function Oye(t){return t.length===0}function CMe(t){const{variant:e}=t,r=Ut(t,hrt);let i=e||"";return Object.keys(r).sort().forEach(n=>{n==="color"?i+=Oye(i)?t[n]:zt(t[n]):i+=`${Oye(i)?n:zt(n)}${zt(t[n].toString())}`}),i}const prt=["name","slot","skipVariantsResolver","skipSx","overridesResolver"];function frt(t){return Object.keys(t).length===0}function mrt(t){return typeof t=="string"&&t.charCodeAt(0)>96}const grt=(t,e)=>e.components&&e.components[t]&&e.components[t].styleOverrides?e.components[t].styleOverrides:null,yrt=(t,e)=>{let r=[];e&&e.components&&e.components[t]&&e.components[t].variants&&(r=e.components[t].variants);const i={};return r.forEach(n=>{const s=CMe(n.props);i[s]=n.style}),i},vrt=(t,e,r,i)=>{var n,s;const{ownerState:o={}}=t,a=[],l=r==null||(n=r.components)==null||(s=n[i])==null?void 0:s.variants;return l&&l.forEach(c=>{let u=!0;Object.keys(c.props).forEach(h=>{o[h]!==c.props[h]&&t[h]!==c.props[h]&&(u=!1)}),u&&a.push(e[CMe(c.props)])}),a};function WL(t){return t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"}const _rt=Ole();function _M({defaultTheme:t,theme:e,themeId:r}){return frt(e)?t:e[r]||e}function brt(t={}){const{themeId:e,defaultTheme:r=_rt,rootShouldForwardProp:i=WL,slotShouldForwardProp:n=WL}=t,s=o=>ZG(Y({},o,{theme:_M(Y({},o,{defaultTheme:r,themeId:e}))}));return s.__mui_systemSx=!0,(o,a={})=>{utt(o,S=>S.filter(C=>!(C!=null&&C.__mui_systemSx)));const{name:l,slot:c,skipVariantsResolver:u,skipSx:h,overridesResolver:f}=a,m=Ut(a,prt),g=u!==void 0?u:c&&c!=="Root"||!1,y=h||!1;let _,b=WL;c==="Root"?b=i:c?b=n:mrt(o)&&(b=void 0);const w=bMe(o,Y({shouldForwardProp:b,label:_},m)),x=(S,...C)=>{const E=C?C.map(L=>typeof L=="function"&&L.__emotion_real!==L?k=>L(Y({},k,{theme:_M(Y({},k,{defaultTheme:r,themeId:e}))})):L):[];let R=S;l&&f&&E.push(L=>{const k=_M(Y({},L,{defaultTheme:r,themeId:e})),V=grt(l,k);if(V){const W={};return Object.entries(V).forEach(([G,B])=>{W[G]=typeof B=="function"?B(Y({},L,{theme:k})):B}),f(L,W)}return null}),l&&!g&&E.push(L=>{const k=_M(Y({},L,{defaultTheme:r,themeId:e}));return vrt(L,yrt(l,k),k,l)}),y||E.push(s);const P=E.length-C.length;if(Array.isArray(S)&&P>0){const L=new Array(P).fill("");R=[...S,...L],R.raw=[...S.raw,...L]}else typeof S=="function"&&S.__emotion_real!==S&&(R=L=>S(Y({},L,{theme:_M(Y({},L,{defaultTheme:r,themeId:e}))})));const D=w(R,...E);return o.muiName&&(D.muiName=o.muiName),D};return w.withConfig&&(x.withConfig=w.withConfig),x}}function wrt(t){const{theme:e,name:r,props:i}=t;return!e||!e.components||!e.components[r]||!e.components[r].defaultProps?i:ale(e.components[r].defaultProps,i)}function xrt({props:t,name:e,defaultTheme:r,themeId:i}){let n=JG(r);return i&&(n=n[i]||n),wrt({theme:n,name:e,props:t})}function Ple(t,e=0,r=1){return Math.min(Math.max(e,t),r)}function Srt(t){t=t.slice(1);const e=new RegExp(`.{1,${t.length>=6?2:1}}`,"g");let r=t.match(e);return r&&r[0].length===1&&(r=r.map(i=>i+i)),r?`rgb${r.length===4?"a":""}(${r.map((i,n)=>n<3?parseInt(i,16):Math.round(parseInt(i,16)/255*1e3)/1e3).join(", ")})`:""}function G2(t){if(t.type)return t;if(t.charAt(0)==="#")return G2(Srt(t));const e=t.indexOf("("),r=t.substring(0,e);if(["rgb","rgba","hsl","hsla","color"].indexOf(r)===-1)throw new Error(Hw(9,t));let i=t.substring(e+1,t.length-1),n;if(r==="color"){if(i=i.split(" "),n=i.shift(),i.length===4&&i[3].charAt(0)==="/"&&(i[3]=i[3].slice(1)),["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(n)===-1)throw new Error(Hw(10,n))}else i=i.split(",");return i=i.map(s=>parseFloat(s)),{type:r,values:i,colorSpace:n}}function KG(t){const{type:e,colorSpace:r}=t;let{values:i}=t;return e.indexOf("rgb")!==-1?i=i.map((n,s)=>s<3?parseInt(n,10):n):e.indexOf("hsl")!==-1&&(i[1]=`${i[1]}%`,i[2]=`${i[2]}%`),e.indexOf("color")!==-1?i=`${r} ${i.join(" ")}`:i=`${i.join(", ")}`,`${e}(${i})`}function Trt(t){t=G2(t);const{values:e}=t,r=e[0],i=e[1]/100,n=e[2]/100,s=i*Math.min(n,1-n),o=(c,u=(c+r/30)%12)=>n-s*Math.max(Math.min(u-3,9-u,1),-1);let a="rgb";const l=[Math.round(o(0)*255),Math.round(o(8)*255),Math.round(o(4)*255)];return t.type==="hsla"&&(a+="a",l.push(e[3])),KG({type:a,values:l})}function Aye(t){t=G2(t);let e=t.type==="hsl"||t.type==="hsla"?G2(Trt(t)).values:t.values;return e=e.map(r=>(t.type!=="color"&&(r/=255),r<=.03928?r/12.92:((r+.055)/1.055)**2.4)),Number((.2126*e[0]+.7152*e[1]+.0722*e[2]).toFixed(3))}function Ert(t,e){const r=Aye(t),i=Aye(e);return(Math.max(r,i)+.05)/(Math.min(r,i)+.05)}function cn(t,e){return t=G2(t),e=Ple(e),(t.type==="rgb"||t.type==="hsl")&&(t.type+="a"),t.type==="color"?t.values[3]=`/${e}`:t.values[3]=e,KG(t)}function Crt(t,e){if(t=G2(t),e=Ple(e),t.type.indexOf("hsl")!==-1)t.values[2]*=1-e;else if(t.type.indexOf("rgb")!==-1||t.type.indexOf("color")!==-1)for(let r=0;r<3;r+=1)t.values[r]*=1-e;return KG(t)}function Rrt(t,e){if(t=G2(t),e=Ple(e),t.type.indexOf("hsl")!==-1)t.values[2]+=(100-t.values[2])*e;else if(t.type.indexOf("rgb")!==-1)for(let r=0;r<3;r+=1)t.values[r]+=(255-t.values[r])*e;else if(t.type.indexOf("color")!==-1)for(let r=0;r<3;r+=1)t.values[r]+=(1-t.values[r])*e;return KG(t)}const Ort=U.createContext(null),RMe=Ort;function OMe(){return U.useContext(RMe)}const Art=typeof Symbol=="function"&&Symbol.for,Prt=Art?Symbol.for("mui.nested"):"__THEME_NESTED__";function Mrt(t,e){return typeof e=="function"?e(t):Y({},t,e)}function $rt(t){const{children:e,theme:r}=t,i=OMe(),n=U.useMemo(()=>{const s=i===null?r:Mrt(i,r);return s!=null&&(s[Prt]=i!==null),s},[r,i]);return F.jsx(RMe.Provider,{value:n,children:e})}const Pye={};function Mye(t,e,r,i=!1){return U.useMemo(()=>{const n=t&&e[t]||e;if(typeof r=="function"){const s=r(n),o=t?Y({},e,{[t]:s}):s;return i?()=>o:o}return t?Y({},e,{[t]:r}):Y({},e,r)},[t,e,r,i])}function Irt(t){const{children:e,theme:r,themeId:i}=t,n=Ale(Pye),s=OMe()||Pye,o=Mye(i,n,r),a=Mye(i,s,r,!0);return F.jsx($rt,{theme:a,children:F.jsx(BG.Provider,{value:o,children:e})})}function Lrt(t,e){return Y({toolbar:{minHeight:56,[t.up("xs")]:{"@media (orientation: landscape)":{minHeight:48}},[t.up("sm")]:{minHeight:64}}},e)}const Drt={black:"#000",white:"#fff"},pN=Drt,Nrt={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},Frt=Nrt,krt={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},tC=krt,Urt={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},rC=Urt,zrt={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},bM=zrt,Vrt={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},iC=Vrt,Brt={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},nC=Brt,jrt={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},sC=jrt,Grt=["mode","contrastThreshold","tonalOffset"],$ye={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:pN.white,default:pN.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},IW={text:{primary:pN.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:pN.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function Iye(t,e,r,i){const n=i.light||i,s=i.dark||i*1.5;t[e]||(t.hasOwnProperty(r)?t[e]=t[r]:e==="light"?t.light=Rrt(t.main,n):e==="dark"&&(t.dark=Crt(t.main,s)))}function Hrt(t="light"){return t==="dark"?{main:iC[200],light:iC[50],dark:iC[400]}:{main:iC[700],light:iC[400],dark:iC[800]}}function qrt(t="light"){return t==="dark"?{main:tC[200],light:tC[50],dark:tC[400]}:{main:tC[500],light:tC[300],dark:tC[700]}}function Wrt(t="light"){return t==="dark"?{main:rC[500],light:rC[300],dark:rC[700]}:{main:rC[700],light:rC[400],dark:rC[800]}}function Xrt(t="light"){return t==="dark"?{main:nC[400],light:nC[300],dark:nC[700]}:{main:nC[700],light:nC[500],dark:nC[900]}}function Yrt(t="light"){return t==="dark"?{main:sC[400],light:sC[300],dark:sC[700]}:{main:sC[800],light:sC[500],dark:sC[900]}}function Zrt(t="light"){return t==="dark"?{main:bM[400],light:bM[300],dark:bM[700]}:{main:"#ed6c02",light:bM[500],dark:bM[900]}}function Jrt(t){const{mode:e="light",contrastThreshold:r=3,tonalOffset:i=.2}=t,n=Ut(t,Grt),s=t.primary||Hrt(e),o=t.secondary||qrt(e),a=t.error||Wrt(e),l=t.info||Xrt(e),c=t.success||Yrt(e),u=t.warning||Zrt(e);function h(y){return Ert(y,IW.text.primary)>=r?IW.text.primary:$ye.text.primary}const f=({color:y,name:_,mainShade:b=500,lightShade:w=300,darkShade:x=700})=>{if(y=Y({},y),!y.main&&y[b]&&(y.main=y[b]),!y.hasOwnProperty("main"))throw new Error(Hw(11,_?` (${_})`:"",b));if(typeof y.main!="string")throw new Error(Hw(12,_?` (${_})`:"",JSON.stringify(y.main)));return Iye(y,"light",w,i),Iye(y,"dark",x,i),y.contrastText||(y.contrastText=h(y.main)),y},m={dark:IW,light:$ye};return Gp(Y({common:Y({},pN),mode:e,primary:f({color:s,name:"primary"}),secondary:f({color:o,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:f({color:a,name:"error"}),warning:f({color:u,name:"warning"}),info:f({color:l,name:"info"}),success:f({color:c,name:"success"}),grey:Frt,contrastThreshold:r,getContrastText:h,augmentColor:f,tonalOffset:i},m[e]),n)}const Krt=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];function Qrt(t){return Math.round(t*1e5)/1e5}const Lye={textTransform:"uppercase"},Dye='"Roboto", "Helvetica", "Arial", sans-serif';function eit(t,e){const r=typeof e=="function"?e(t):e,{fontFamily:i=Dye,fontSize:n=14,fontWeightLight:s=300,fontWeightRegular:o=400,fontWeightMedium:a=500,fontWeightBold:l=700,htmlFontSize:c=16,allVariants:u,pxToRem:h}=r,f=Ut(r,Krt),m=n/14,g=h||(b=>`${b/c*m}rem`),y=(b,w,x,S,C)=>Y({fontFamily:i,fontWeight:b,fontSize:g(w),lineHeight:x},i===Dye?{letterSpacing:`${Qrt(S/w)}em`}:{},C,u),_={h1:y(s,96,1.167,-1.5),h2:y(s,60,1.2,-.5),h3:y(o,48,1.167,0),h4:y(o,34,1.235,.25),h5:y(o,24,1.334,0),h6:y(a,20,1.6,.15),subtitle1:y(o,16,1.75,.15),subtitle2:y(a,14,1.57,.1),body1:y(o,16,1.5,.15),body2:y(o,14,1.43,.15),button:y(a,14,1.75,.4,Lye),caption:y(o,12,1.66,.4),overline:y(o,12,2.66,1,Lye),inherit:{fontFamily:"inherit",fontWeight:"inherit",fontSize:"inherit",lineHeight:"inherit",letterSpacing:"inherit"}};return Gp(Y({htmlFontSize:c,pxToRem:g,fontFamily:i,fontSize:n,fontWeightLight:s,fontWeightRegular:o,fontWeightMedium:a,fontWeightBold:l},_),f,{clone:!1})}const tit=.2,rit=.14,iit=.12;function Os(...t){return[`${t[0]}px ${t[1]}px ${t[2]}px ${t[3]}px rgba(0,0,0,${tit})`,`${t[4]}px ${t[5]}px ${t[6]}px ${t[7]}px rgba(0,0,0,${rit})`,`${t[8]}px ${t[9]}px ${t[10]}px ${t[11]}px rgba(0,0,0,${iit})`].join(",")}const nit=["none",Os(0,2,1,-1,0,1,1,0,0,1,3,0),Os(0,3,1,-2,0,2,2,0,0,1,5,0),Os(0,3,3,-2,0,3,4,0,0,1,8,0),Os(0,2,4,-1,0,4,5,0,0,1,10,0),Os(0,3,5,-1,0,5,8,0,0,1,14,0),Os(0,3,5,-1,0,6,10,0,0,1,18,0),Os(0,4,5,-2,0,7,10,1,0,2,16,1),Os(0,5,5,-3,0,8,10,1,0,3,14,2),Os(0,5,6,-3,0,9,12,1,0,3,16,2),Os(0,6,6,-3,0,10,14,1,0,4,18,3),Os(0,6,7,-4,0,11,15,1,0,4,20,3),Os(0,7,8,-4,0,12,17,2,0,5,22,4),Os(0,7,8,-4,0,13,19,2,0,5,24,4),Os(0,7,9,-4,0,14,21,2,0,5,26,4),Os(0,8,9,-5,0,15,22,2,0,6,28,5),Os(0,8,10,-5,0,16,24,2,0,6,30,5),Os(0,8,11,-5,0,17,26,2,0,6,32,5),Os(0,9,11,-5,0,18,28,2,0,7,34,6),Os(0,9,12,-6,0,19,29,2,0,7,36,6),Os(0,10,13,-6,0,20,31,3,0,8,38,7),Os(0,10,13,-6,0,21,33,3,0,8,40,7),Os(0,10,14,-6,0,22,35,3,0,8,42,7),Os(0,11,14,-7,0,23,36,3,0,9,44,8),Os(0,11,15,-7,0,24,38,3,0,9,46,8)],sit=nit,oit=["duration","easing","delay"],ait={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},lit={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function Nye(t){return`${Math.round(t)}ms`}function cit(t){if(!t)return 0;const e=t/36;return Math.round((4+15*e**.25+e/5)*10)}function uit(t){const e=Y({},ait,t.easing),r=Y({},lit,t.duration);return Y({getAutoHeightDuration:cit,create:(n=["all"],s={})=>{const{duration:o=r.standard,easing:a=e.easeInOut,delay:l=0}=s;return Ut(s,oit),(Array.isArray(n)?n:[n]).map(c=>`${c} ${typeof o=="string"?o:Nye(o)} ${a} ${typeof l=="string"?l:Nye(l)}`).join(",")}},t,{easing:e,duration:r})}const dit={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},hit=dit,pit=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function Mle(t={},...e){const{mixins:r={},palette:i={},transitions:n={},typography:s={}}=t,o=Ut(t,pit);if(t.vars)throw new Error(Hw(18));const a=Jrt(i),l=Ole(t);let c=Gp(l,{mixins:Lrt(l.breakpoints,r),palette:a,shadows:sit.slice(),typography:eit(a,s),transitions:uit(n),zIndex:Y({},hit)});return c=Gp(c,o),c=e.reduce((u,h)=>Gp(u,h),c),c.unstable_sxConfig=Y({},YG,o==null?void 0:o.unstable_sxConfig),c.unstable_sx=function(h){return ZG({sx:h,theme:this})},c}const fit=Mle(),QG=fit,H2="$$material",vf=t=>WL(t)&&t!=="classes",mit=WL,git=brt({themeId:H2,defaultTheme:QG,rootShouldForwardProp:vf}),Ot=git;function ni({props:t,name:e}){return xrt({props:t,name:e,defaultTheme:QG,themeId:H2})}const yit=t=>{let e;return t<1?e=5.11916*t**2:e=4.5*Math.log(t+1)+2,(e/100).toFixed(2)},Fye=yit;function _f(){const t=JG(QG);return t[H2]||t}function vit(t){return ii("MuiPaper",t)}Zr("MuiPaper",["root","rounded","outlined","elevation","elevation0","elevation1","elevation2","elevation3","elevation4","elevation5","elevation6","elevation7","elevation8","elevation9","elevation10","elevation11","elevation12","elevation13","elevation14","elevation15","elevation16","elevation17","elevation18","elevation19","elevation20","elevation21","elevation22","elevation23","elevation24"]);const _it=["className","component","elevation","square","variant"],bit=t=>{const{square:e,elevation:r,variant:i,classes:n}=t,s={root:["root",i,!e&&"rounded",i==="elevation"&&`elevation${r}`]};return ui(s,vit,n)},wit=Ot("div",{name:"MuiPaper",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.variant],!r.square&&e.rounded,r.variant==="elevation"&&e[`elevation${r.elevation}`]]}})(({theme:t,ownerState:e})=>{var r;return Y({backgroundColor:(t.vars||t).palette.background.paper,color:(t.vars||t).palette.text.primary,transition:t.transitions.create("box-shadow")},!e.square&&{borderRadius:t.shape.borderRadius},e.variant==="outlined"&&{border:`1px solid ${(t.vars||t).palette.divider}`},e.variant==="elevation"&&Y({boxShadow:(t.vars||t).shadows[e.elevation]},!t.vars&&t.palette.mode==="dark"&&{backgroundImage:`linear-gradient(${cn("#fff",Fye(e.elevation))}, ${cn("#fff",Fye(e.elevation))})`},t.vars&&{backgroundImage:(r=t.vars.overlays)==null?void 0:r[e.elevation]}))}),xit=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiPaper"}),{className:n,component:s="div",elevation:o=1,square:a=!1,variant:l="elevation"}=i,c=Ut(i,_it),u=Y({},i,{component:s,elevation:o,square:a,variant:l}),h=bit(u);return F.jsx(wit,Y({as:s,ownerState:u,className:Pt(h.root,n),ref:r},c))}),$le=xit;function Sit(t){return ii("MuiCard",t)}Zr("MuiCard",["root"]);const Tit=["className","raised"],Eit=t=>{const{classes:e}=t;return ui({root:["root"]},Sit,e)},Cit=Ot($le,{name:"MuiCard",slot:"Root",overridesResolver:(t,e)=>e.root})(()=>({overflow:"hidden"})),Rit=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiCard"}),{className:n,raised:s=!1}=i,o=Ut(i,Tit),a=Y({},i,{raised:s}),l=Eit(a);return F.jsx(Cit,Y({className:Pt(l.root,n),elevation:s?8:void 0,ref:r,ownerState:a},o))}),Oit=Rit;function Ait(t){return ii("MuiCardContent",t)}Zr("MuiCardContent",["root"]);const Pit=["className","component"],Mit=t=>{const{classes:e}=t;return ui({root:["root"]},Ait,e)},$it=Ot("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(t,e)=>e.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),Iit=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiCardContent"}),{className:n,component:s="div"}=i,o=Ut(i,Pit),a=Y({},i,{component:s}),l=Mit(a);return F.jsx($it,Y({as:s,className:Pt(l.root,n),ownerState:a,ref:r},o))}),Lit=Iit;function Dit(t){return ii("MuiCardMedia",t)}Zr("MuiCardMedia",["root","media","img"]);const Nit=["children","className","component","image","src","style"],Fit=t=>{const{classes:e,isMediaComponent:r,isImageComponent:i}=t;return ui({root:["root",r&&"media",i&&"img"]},Dit,e)},kit=Ot("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t,{isMediaComponent:i,isImageComponent:n}=r;return[e.root,i&&e.media,n&&e.img]}})(({ownerState:t})=>Y({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},t.isMediaComponent&&{width:"100%"},t.isImageComponent&&{objectFit:"cover"})),Uit=["video","audio","picture","iframe","img"],zit=["picture","img"],Vit=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiCardMedia"}),{children:n,className:s,component:o="div",image:a,src:l,style:c}=i,u=Ut(i,Nit),h=Uit.indexOf(o)!==-1,f=!h&&a?Y({backgroundImage:`url("${a}")`},c):c,m=Y({},i,{component:o,isMediaComponent:h,isImageComponent:zit.indexOf(o)!==-1}),g=Fit(m);return F.jsx(kit,Y({className:Pt(g.root,s),as:o,role:!h&&a?"img":void 0,ref:r,style:f,ownerState:m,src:h?a||l:void 0},u,{children:n}))}),Bit=Vit;function jit(t){return ii("MuiTypography",t)}Zr("MuiTypography",["root","h1","h2","h3","h4","h5","h6","subtitle1","subtitle2","body1","body2","inherit","button","caption","overline","alignLeft","alignRight","alignCenter","alignJustify","noWrap","gutterBottom","paragraph"]);const Git=["align","className","component","gutterBottom","noWrap","paragraph","variant","variantMapping"],Hit=t=>{const{align:e,gutterBottom:r,noWrap:i,paragraph:n,variant:s,classes:o}=t,a={root:["root",s,t.align!=="inherit"&&`align${zt(e)}`,r&&"gutterBottom",i&&"noWrap",n&&"paragraph"]};return ui(a,jit,o)},qit=Ot("span",{name:"MuiTypography",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.variant&&e[r.variant],r.align!=="inherit"&&e[`align${zt(r.align)}`],r.noWrap&&e.noWrap,r.gutterBottom&&e.gutterBottom,r.paragraph&&e.paragraph]}})(({theme:t,ownerState:e})=>Y({margin:0},e.variant&&t.typography[e.variant],e.align!=="inherit"&&{textAlign:e.align},e.noWrap&&{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},e.gutterBottom&&{marginBottom:"0.35em"},e.paragraph&&{marginBottom:16})),kye={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p",inherit:"p"},Wit={primary:"primary.main",textPrimary:"text.primary",secondary:"secondary.main",textSecondary:"text.secondary",error:"error.main"},Xit=t=>Wit[t]||t,Yit=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiTypography"}),n=Xit(i.color),s=TMe(Y({},i,{color:n})),{align:o="inherit",className:a,component:l,gutterBottom:c=!1,noWrap:u=!1,paragraph:h=!1,variant:f="body1",variantMapping:m=kye}=s,g=Ut(s,Git),y=Y({},s,{align:o,color:n,className:a,component:l,gutterBottom:c,noWrap:u,paragraph:h,variant:f,variantMapping:m}),_=l||(h?"p":m[f]||kye[f])||"span",b=Hit(y);return F.jsx(qit,Y({as:_,ref:r,ownerState:y,className:Pt(b.root,a)},g))}),eQ=Yit,Zit=["theme"];function Jit(t){let{theme:e}=t,r=Ut(t,Zit);const i=e[H2];return F.jsx(Irt,Y({},r,{themeId:i?H2:void 0,theme:i||e}))}function Kit(t){return ii("MuiSvgIcon",t)}Zr("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);const Qit=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],ent=t=>{const{color:e,fontSize:r,classes:i}=t,n={root:["root",e!=="inherit"&&`color${zt(e)}`,`fontSize${zt(r)}`]};return ui(n,Kit,i)},tnt=Ot("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.color!=="inherit"&&e[`color${zt(r.color)}`],e[`fontSize${zt(r.fontSize)}`]]}})(({theme:t,ownerState:e})=>{var r,i,n,s,o,a,l,c,u,h,f,m,g,y,_,b,w;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:e.hasSvgAsChild?void 0:"currentColor",flexShrink:0,transition:(r=t.transitions)==null||(i=r.create)==null?void 0:i.call(r,"fill",{duration:(n=t.transitions)==null||(s=n.duration)==null?void 0:s.shorter}),fontSize:{inherit:"inherit",small:((o=t.typography)==null||(a=o.pxToRem)==null?void 0:a.call(o,20))||"1.25rem",medium:((l=t.typography)==null||(c=l.pxToRem)==null?void 0:c.call(l,24))||"1.5rem",large:((u=t.typography)==null||(h=u.pxToRem)==null?void 0:h.call(u,35))||"2.1875rem"}[e.fontSize],color:(f=(m=(t.vars||t).palette)==null||(g=m[e.color])==null?void 0:g.main)!=null?f:{action:(y=(t.vars||t).palette)==null||(_=y.action)==null?void 0:_.active,disabled:(b=(t.vars||t).palette)==null||(w=b.action)==null?void 0:w.disabled,inherit:void 0}[e.color]}}),AMe=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiSvgIcon"}),{children:n,className:s,color:o="inherit",component:a="svg",fontSize:l="medium",htmlColor:c,inheritViewBox:u=!1,titleAccess:h,viewBox:f="0 0 24 24"}=i,m=Ut(i,Qit),g=U.isValidElement(n)&&n.type==="svg",y=Y({},i,{color:o,component:a,fontSize:l,instanceFontSize:e.fontSize,inheritViewBox:u,viewBox:f,hasSvgAsChild:g}),_={};u||(_.viewBox=f);const b=ent(y);return F.jsxs(tnt,Y({as:a,className:Pt(b.root,s),focusable:"false",color:c,"aria-hidden":h?void 0:!0,role:h?"img":void 0,ref:r},_,m,g&&n.props,{ownerState:y,children:[g?n.props.children:n,h?F.jsx("title",{children:h}):null]}))});AMe.muiName="SvgIcon";const Uye=AMe;function I4(t,e){function r(i,n){return F.jsx(Uye,Y({"data-testid":`${e}Icon`,ref:n},i,{children:t}))}return r.muiName=Uye.muiName,U.memo(U.forwardRef(r))}const rnt={configure:t=>{lle.configure(t)}},int=Object.freeze(Object.defineProperty({__proto__:null,capitalize:zt,createChainedFunction:HK,createSvgIcon:I4,debounce:V2,deprecatedPropType:KJe,isMuiElement:BL,ownerDocument:Ll,ownerWindow:ef,requirePropFactory:QJe,setRef:tV,unstable_ClassNameGenerator:rnt,unstable_useEnhancedEffect:Sh,unstable_useId:sle,unsupportedProp:rKe,useControlled:rV,useEventCallback:$m,useForkRef:Js,useIsFocusVisible:ole},Symbol.toStringTag,{value:"Module"}));function tQ(t,e){return tQ=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},tQ(t,e)}function PMe(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,tQ(t,e)}const zye={disabled:!1},oV=Ml.createContext(null);var nnt=function(e){return e.scrollTop},X$="unmounted",ES="exited",CS="entering",vR="entered",rQ="exiting",G_=function(t){PMe(e,t);function e(i,n){var s;s=t.call(this,i,n)||this;var o=n,a=o&&!o.isMounting?i.enter:i.appear,l;return s.appearStatus=null,i.in?a?(l=ES,s.appearStatus=CS):l=vR:i.unmountOnExit||i.mountOnEnter?l=X$:l=ES,s.state={status:l},s.nextCallback=null,s}e.getDerivedStateFromProps=function(n,s){var o=n.in;return o&&s.status===X$?{status:ES}:null};var r=e.prototype;return r.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},r.componentDidUpdate=function(n){var s=null;if(n!==this.props){var o=this.state.status;this.props.in?o!==CS&&o!==vR&&(s=CS):(o===CS||o===vR)&&(s=rQ)}this.updateStatus(!1,s)},r.componentWillUnmount=function(){this.cancelNextCallback()},r.getTimeouts=function(){var n=this.props.timeout,s,o,a;return s=o=a=n,n!=null&&typeof n!="number"&&(s=n.exit,o=n.enter,a=n.appear!==void 0?n.appear:o),{exit:s,enter:o,appear:a}},r.updateStatus=function(n,s){if(n===void 0&&(n=!1),s!==null)if(this.cancelNextCallback(),s===CS){if(this.props.unmountOnExit||this.props.mountOnEnter){var o=this.props.nodeRef?this.props.nodeRef.current:S5.findDOMNode(this);o&&nnt(o)}this.performEnter(n)}else this.performExit();else this.props.unmountOnExit&&this.state.status===ES&&this.setState({status:X$})},r.performEnter=function(n){var s=this,o=this.props.enter,a=this.context?this.context.isMounting:n,l=this.props.nodeRef?[a]:[S5.findDOMNode(this),a],c=l[0],u=l[1],h=this.getTimeouts(),f=a?h.appear:h.enter;if(!n&&!o||zye.disabled){this.safeSetState({status:vR},function(){s.props.onEntered(c)});return}this.props.onEnter(c,u),this.safeSetState({status:CS},function(){s.props.onEntering(c,u),s.onTransitionEnd(f,function(){s.safeSetState({status:vR},function(){s.props.onEntered(c,u)})})})},r.performExit=function(){var n=this,s=this.props.exit,o=this.getTimeouts(),a=this.props.nodeRef?void 0:S5.findDOMNode(this);if(!s||zye.disabled){this.safeSetState({status:ES},function(){n.props.onExited(a)});return}this.props.onExit(a),this.safeSetState({status:rQ},function(){n.props.onExiting(a),n.onTransitionEnd(o.exit,function(){n.safeSetState({status:ES},function(){n.props.onExited(a)})})})},r.cancelNextCallback=function(){this.nextCallback!==null&&(this.nextCallback.cancel(),this.nextCallback=null)},r.safeSetState=function(n,s){s=this.setNextCallback(s),this.setState(n,s)},r.setNextCallback=function(n){var s=this,o=!0;return this.nextCallback=function(a){o&&(o=!1,s.nextCallback=null,n(a))},this.nextCallback.cancel=function(){o=!1},this.nextCallback},r.onTransitionEnd=function(n,s){this.setNextCallback(s);var o=this.props.nodeRef?this.props.nodeRef.current:S5.findDOMNode(this),a=n==null&&!this.props.addEndListener;if(!o||a){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var l=this.props.nodeRef?[this.nextCallback]:[o,this.nextCallback],c=l[0],u=l[1];this.props.addEndListener(c,u)}n!=null&&setTimeout(this.nextCallback,n)},r.render=function(){var n=this.state.status;if(n===X$)return null;var s=this.props,o=s.children;s.in,s.mountOnEnter,s.unmountOnExit,s.appear,s.enter,s.exit,s.timeout,s.addEndListener,s.onEnter,s.onEntering,s.onEntered,s.onExit,s.onExiting,s.onExited,s.nodeRef;var a=Ut(s,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]);return Ml.createElement(oV.Provider,{value:null},typeof o=="function"?o(n,a):Ml.cloneElement(Ml.Children.only(o),a))},e}(Ml.Component);G_.contextType=oV;G_.propTypes={};function oC(){}G_.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:oC,onEntering:oC,onEntered:oC,onExit:oC,onExiting:oC,onExited:oC};G_.UNMOUNTED=X$;G_.EXITED=ES;G_.ENTERING=CS;G_.ENTERED=vR;G_.EXITING=rQ;const Ile=G_;function snt(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Lle(t,e){var r=function(s){return e&&U.isValidElement(s)?e(s):s},i=Object.create(null);return t&&U.Children.map(t,function(n){return n}).forEach(function(n){i[n.key]=r(n)}),i}function ont(t,e){t=t||{},e=e||{};function r(u){return u in e?e[u]:t[u]}var i=Object.create(null),n=[];for(var s in t)s in e?n.length&&(i[s]=n,n=[]):n.push(s);var o,a={};for(var l in e){if(i[l])for(o=0;o<i[l].length;o++){var c=i[l][o];a[i[l][o]]=r(c)}a[l]=r(l)}for(o=0;o<n.length;o++)a[n[o]]=r(n[o]);return a}function i2(t,e,r){return r[e]!=null?r[e]:t.props[e]}function ant(t,e){return Lle(t.children,function(r){return U.cloneElement(r,{onExited:e.bind(null,r),in:!0,appear:i2(r,"appear",t),enter:i2(r,"enter",t),exit:i2(r,"exit",t)})})}function lnt(t,e,r){var i=Lle(t.children),n=ont(e,i);return Object.keys(n).forEach(function(s){var o=n[s];if(U.isValidElement(o)){var a=s in e,l=s in i,c=e[s],u=U.isValidElement(c)&&!c.props.in;l&&(!a||u)?n[s]=U.cloneElement(o,{onExited:r.bind(null,o),in:!0,exit:i2(o,"exit",t),enter:i2(o,"enter",t)}):!l&&a&&!u?n[s]=U.cloneElement(o,{in:!1}):l&&a&&U.isValidElement(c)&&(n[s]=U.cloneElement(o,{onExited:r.bind(null,o),in:c.props.in,exit:i2(o,"exit",t),enter:i2(o,"enter",t)}))}}),n}var cnt=Object.values||function(t){return Object.keys(t).map(function(e){return t[e]})},unt={component:"div",childFactory:function(e){return e}},Dle=function(t){PMe(e,t);function e(i,n){var s;s=t.call(this,i,n)||this;var o=s.handleExited.bind(snt(s));return s.state={contextValue:{isMounting:!0},handleExited:o,firstRender:!0},s}var r=e.prototype;return r.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},r.componentWillUnmount=function(){this.mounted=!1},e.getDerivedStateFromProps=function(n,s){var o=s.children,a=s.handleExited,l=s.firstRender;return{children:l?ant(n,a):lnt(n,o,a),firstRender:!1}},r.handleExited=function(n,s){var o=Lle(this.props.children);n.key in o||(n.props.onExited&&n.props.onExited(s),this.mounted&&this.setState(function(a){var l=Y({},a.children);return delete l[n.key],{children:l}}))},r.render=function(){var n=this.props,s=n.component,o=n.childFactory,a=Ut(n,["component","childFactory"]),l=this.state.contextValue,c=cnt(this.state.children).map(o);return delete a.appear,delete a.enter,delete a.exit,s===null?Ml.createElement(oV.Provider,{value:l},c):Ml.createElement(oV.Provider,{value:l},Ml.createElement(s,a,c))},e}(Ml.Component);Dle.propTypes={};Dle.defaultProps=unt;const dnt=Dle,Nle=t=>t.scrollTop;function lP(t,e){var r,i;const{timeout:n,easing:s,style:o={}}=t;return{duration:(r=o.transitionDuration)!=null?r:typeof n=="number"?n:n[e.mode]||0,easing:(i=o.transitionTimingFunction)!=null?i:typeof s=="object"?s[e.mode]:s,delay:o.transitionDelay}}function hnt(t){const{className:e,classes:r,pulsate:i=!1,rippleX:n,rippleY:s,rippleSize:o,in:a,onExited:l,timeout:c}=t,[u,h]=U.useState(!1),f=Pt(e,r.ripple,r.rippleVisible,i&&r.ripplePulsate),m={width:o,height:o,top:-(o/2)+s,left:-(o/2)+n},g=Pt(r.child,u&&r.childLeaving,i&&r.childPulsate);return!a&&!u&&h(!0),U.useEffect(()=>{if(!a&&l!=null){const y=setTimeout(l,c);return()=>{clearTimeout(y)}}},[l,a,c]),F.jsx("span",{className:f,style:m,children:F.jsx("span",{className:g})})}const pnt=Zr("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Sp=pnt,fnt=["center","classes","className"];let e7=t=>t,Vye,Bye,jye,Gye;const iQ=550,mnt=80,gnt=Sle(Vye||(Vye=e7`
  0% {
    transform: scale(0);
    opacity: 0.1;
  }

  100% {
    transform: scale(1);
    opacity: 0.3;
  }
`)),ynt=Sle(Bye||(Bye=e7`
  0% {
    opacity: 1;
  }

  100% {
    opacity: 0;
  }
`)),vnt=Sle(jye||(jye=e7`
  0% {
    transform: scale(1);
  }

  50% {
    transform: scale(0.92);
  }

  100% {
    transform: scale(1);
  }
`)),_nt=Ot("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),bnt=Ot(hnt,{name:"MuiTouchRipple",slot:"Ripple"})(Gye||(Gye=e7`
  opacity: 0;
  position: absolute;

  &.${0} {
    opacity: 0.3;
    transform: scale(1);
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  &.${0} {
    animation-duration: ${0}ms;
  }

  & .${0} {
    opacity: 1;
    display: block;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background-color: currentColor;
  }

  & .${0} {
    opacity: 0;
    animation-name: ${0};
    animation-duration: ${0}ms;
    animation-timing-function: ${0};
  }

  & .${0} {
    position: absolute;
    /* @noflip */
    left: 0px;
    top: 0;
    animation-name: ${0};
    animation-duration: 2500ms;
    animation-timing-function: ${0};
    animation-iteration-count: infinite;
    animation-delay: 200ms;
  }
`),Sp.rippleVisible,gnt,iQ,({theme:t})=>t.transitions.easing.easeInOut,Sp.ripplePulsate,({theme:t})=>t.transitions.duration.shorter,Sp.child,Sp.childLeaving,ynt,iQ,({theme:t})=>t.transitions.easing.easeInOut,Sp.childPulsate,vnt,({theme:t})=>t.transitions.easing.easeInOut),wnt=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiTouchRipple"}),{center:n=!1,classes:s={},className:o}=i,a=Ut(i,fnt),[l,c]=U.useState([]),u=U.useRef(0),h=U.useRef(null);U.useEffect(()=>{h.current&&(h.current(),h.current=null)},[l]);const f=U.useRef(!1),m=U.useRef(0),g=U.useRef(null),y=U.useRef(null);U.useEffect(()=>()=>{m.current&&clearTimeout(m.current)},[]);const _=U.useCallback(S=>{const{pulsate:C,rippleX:E,rippleY:R,rippleSize:P,cb:D}=S;c(L=>[...L,F.jsx(bnt,{classes:{ripple:Pt(s.ripple,Sp.ripple),rippleVisible:Pt(s.rippleVisible,Sp.rippleVisible),ripplePulsate:Pt(s.ripplePulsate,Sp.ripplePulsate),child:Pt(s.child,Sp.child),childLeaving:Pt(s.childLeaving,Sp.childLeaving),childPulsate:Pt(s.childPulsate,Sp.childPulsate)},timeout:iQ,pulsate:C,rippleX:E,rippleY:R,rippleSize:P},u.current)]),u.current+=1,h.current=D},[s]),b=U.useCallback((S={},C={},E=()=>{})=>{const{pulsate:R=!1,center:P=n||C.pulsate,fakeElement:D=!1}=C;if((S==null?void 0:S.type)==="mousedown"&&f.current){f.current=!1;return}(S==null?void 0:S.type)==="touchstart"&&(f.current=!0);const L=D?null:y.current,k=L?L.getBoundingClientRect():{width:0,height:0,left:0,top:0};let V,W,G;if(P||S===void 0||S.clientX===0&&S.clientY===0||!S.clientX&&!S.touches)V=Math.round(k.width/2),W=Math.round(k.height/2);else{const{clientX:B,clientY:Z}=S.touches&&S.touches.length>0?S.touches[0]:S;V=Math.round(B-k.left),W=Math.round(Z-k.top)}if(P)G=Math.sqrt((2*k.width**2+k.height**2)/3),G%2===0&&(G+=1);else{const B=Math.max(Math.abs((L?L.clientWidth:0)-V),V)*2+2,Z=Math.max(Math.abs((L?L.clientHeight:0)-W),W)*2+2;G=Math.sqrt(B**2+Z**2)}S!=null&&S.touches?g.current===null&&(g.current=()=>{_({pulsate:R,rippleX:V,rippleY:W,rippleSize:G,cb:E})},m.current=setTimeout(()=>{g.current&&(g.current(),g.current=null)},mnt)):_({pulsate:R,rippleX:V,rippleY:W,rippleSize:G,cb:E})},[n,_]),w=U.useCallback(()=>{b({},{pulsate:!0})},[b]),x=U.useCallback((S,C)=>{if(clearTimeout(m.current),(S==null?void 0:S.type)==="touchend"&&g.current){g.current(),g.current=null,m.current=setTimeout(()=>{x(S,C)});return}g.current=null,c(E=>E.length>0?E.slice(1):E),h.current=C},[]);return U.useImperativeHandle(r,()=>({pulsate:w,start:b,stop:x}),[w,b,x]),F.jsx(_nt,Y({className:Pt(Sp.root,s.root,o),ref:y},a,{children:F.jsx(dnt,{component:null,exit:!0,children:l})}))}),xnt=wnt;function Snt(t){return ii("MuiButtonBase",t)}const Tnt=Zr("MuiButtonBase",["root","disabled","focusVisible"]),Ent=Tnt,Cnt=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],Rnt=t=>{const{disabled:e,focusVisible:r,focusVisibleClassName:i,classes:n}=t,o=ui({root:["root",e&&"disabled",r&&"focusVisible"]},Snt,n);return r&&i&&(o.root+=` ${i}`),o},Ont=Ot("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:(t,e)=>e.root})({display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},[`&.${Ent.disabled}`]:{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}}),Ant=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiButtonBase"}),{action:n,centerRipple:s=!1,children:o,className:a,component:l="button",disabled:c=!1,disableRipple:u=!1,disableTouchRipple:h=!1,focusRipple:f=!1,LinkComponent:m="a",onBlur:g,onClick:y,onContextMenu:_,onDragLeave:b,onFocus:w,onFocusVisible:x,onKeyDown:S,onKeyUp:C,onMouseDown:E,onMouseLeave:R,onMouseUp:P,onTouchEnd:D,onTouchMove:L,onTouchStart:k,tabIndex:V=0,TouchRippleProps:W,touchRippleRef:G,type:B}=i,Z=Ut(i,Cnt),M=U.useRef(null),$=U.useRef(null),N=Js($,G),{isFocusVisibleRef:j,onFocus:J,onBlur:K,ref:te}=ole(),[ae,be]=U.useState(!1);c&&ae&&be(!1),U.useImperativeHandle(n,()=>({focusVisible:()=>{be(!0),M.current.focus()}}),[]);const[Ee,Je]=U.useState(!1);U.useEffect(()=>{Je(!0)},[]);const ze=Ee&&!u&&!c;U.useEffect(()=>{ae&&f&&!u&&Ee&&$.current.pulsate()},[u,f,ae,Ee]);function Ge(st,Xe,it=h){return $m(Oe=>(Xe&&Xe(Oe),!it&&$.current&&$.current[st](Oe),!0))}const Le=Ge("start",E),de=Ge("stop",_),$e=Ge("stop",b),Be=Ge("stop",P),we=Ge("stop",st=>{ae&&st.preventDefault(),R&&R(st)}),Ie=Ge("start",k),je=Ge("stop",D),fe=Ge("stop",L),Ae=Ge("stop",st=>{K(st),j.current===!1&&be(!1),g&&g(st)},!1),gt=$m(st=>{M.current||(M.current=st.currentTarget),J(st),j.current===!0&&(be(!0),x&&x(st)),w&&w(st)}),Re=()=>{const st=M.current;return l&&l!=="button"&&!(st.tagName==="A"&&st.href)},He=U.useRef(!1),Dt=$m(st=>{f&&!He.current&&ae&&$.current&&st.key===" "&&(He.current=!0,$.current.stop(st,()=>{$.current.start(st)})),st.target===st.currentTarget&&Re()&&st.key===" "&&st.preventDefault(),S&&S(st),st.target===st.currentTarget&&Re()&&st.key==="Enter"&&!c&&(st.preventDefault(),y&&y(st))}),Fe=$m(st=>{f&&st.key===" "&&$.current&&ae&&!st.defaultPrevented&&(He.current=!1,$.current.stop(st,()=>{$.current.pulsate(st)})),C&&C(st),y&&st.target===st.currentTarget&&Re()&&st.key===" "&&!st.defaultPrevented&&y(st)});let nt=l;nt==="button"&&(Z.href||Z.to)&&(nt=m);const Ke={};nt==="button"?(Ke.type=B===void 0?"button":B,Ke.disabled=c):(!Z.href&&!Z.to&&(Ke.role="button"),c&&(Ke["aria-disabled"]=c));const mt=Js(r,te,M),wt=Y({},i,{centerRipple:s,component:l,disabled:c,disableRipple:u,disableTouchRipple:h,focusRipple:f,tabIndex:V,focusVisible:ae}),xt=Rnt(wt);return F.jsxs(Ont,Y({as:nt,className:Pt(xt.root,a),ownerState:wt,onBlur:Ae,onClick:y,onContextMenu:de,onFocus:gt,onKeyDown:Dt,onKeyUp:Fe,onMouseDown:Le,onMouseLeave:we,onMouseUp:Be,onDragLeave:$e,onTouchEnd:je,onTouchMove:fe,onTouchStart:Ie,ref:mt,tabIndex:c?-1:V,type:B},Ke,Z,{children:[o,ze?F.jsx(xnt,Y({ref:N,center:s},W)):null]}))}),S_=Ant,Pnt=["anchorEl","component","components","componentsProps","container","disablePortal","keepMounted","modifiers","open","placement","popperOptions","popperRef","transition","slots","slotProps"],Mnt=Ot(VQe,{name:"MuiPopper",slot:"Root",overridesResolver:(t,e)=>e.root})({}),$nt=U.forwardRef(function(e,r){var i;const n=Ale(),s=ni({props:e,name:"MuiPopper"}),{anchorEl:o,component:a,components:l,componentsProps:c,container:u,disablePortal:h,keepMounted:f,modifiers:m,open:g,placement:y,popperOptions:_,popperRef:b,transition:w,slots:x,slotProps:S}=s,C=Ut(s,Pnt),E=(i=x==null?void 0:x.root)!=null?i:l==null?void 0:l.Root,R=Y({anchorEl:o,container:u,disablePortal:h,keepMounted:f,modifiers:m,open:g,placement:y,popperOptions:_,popperRef:b,transition:w},C);return F.jsx(Mnt,Y({as:a,direction:n==null?void 0:n.direction,slots:{root:E},slotProps:S??c},R,{ref:r}))}),MMe=$nt,Int=I4(F.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel");function Lnt(t){return ii("MuiChip",t)}const Dnt=Zr("MuiChip",["root","sizeSmall","sizeMedium","colorError","colorInfo","colorPrimary","colorSecondary","colorSuccess","colorWarning","disabled","clickable","clickableColorPrimary","clickableColorSecondary","deletable","deletableColorPrimary","deletableColorSecondary","outlined","filled","outlinedPrimary","outlinedSecondary","filledPrimary","filledSecondary","avatar","avatarSmall","avatarMedium","avatarColorPrimary","avatarColorSecondary","icon","iconSmall","iconMedium","iconColorPrimary","iconColorSecondary","label","labelSmall","labelMedium","deleteIcon","deleteIconSmall","deleteIconMedium","deleteIconColorPrimary","deleteIconColorSecondary","deleteIconOutlinedColorPrimary","deleteIconOutlinedColorSecondary","deleteIconFilledColorPrimary","deleteIconFilledColorSecondary","focusVisible"]),Yi=Dnt,Nnt=["avatar","className","clickable","color","component","deleteIcon","disabled","icon","label","onClick","onDelete","onKeyDown","onKeyUp","size","variant","tabIndex","skipFocusWhenDisabled"],Fnt=t=>{const{classes:e,disabled:r,size:i,color:n,iconColor:s,onDelete:o,clickable:a,variant:l}=t,c={root:["root",l,r&&"disabled",`size${zt(i)}`,`color${zt(n)}`,a&&"clickable",a&&`clickableColor${zt(n)}`,o&&"deletable",o&&`deletableColor${zt(n)}`,`${l}${zt(n)}`],label:["label",`label${zt(i)}`],avatar:["avatar",`avatar${zt(i)}`,`avatarColor${zt(n)}`],icon:["icon",`icon${zt(i)}`,`iconColor${zt(s)}`],deleteIcon:["deleteIcon",`deleteIcon${zt(i)}`,`deleteIconColor${zt(n)}`,`deleteIcon${zt(l)}Color${zt(n)}`]};return ui(c,Lnt,e)},knt=Ot("div",{name:"MuiChip",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t,{color:i,iconColor:n,clickable:s,onDelete:o,size:a,variant:l}=r;return[{[`& .${Yi.avatar}`]:e.avatar},{[`& .${Yi.avatar}`]:e[`avatar${zt(a)}`]},{[`& .${Yi.avatar}`]:e[`avatarColor${zt(i)}`]},{[`& .${Yi.icon}`]:e.icon},{[`& .${Yi.icon}`]:e[`icon${zt(a)}`]},{[`& .${Yi.icon}`]:e[`iconColor${zt(n)}`]},{[`& .${Yi.deleteIcon}`]:e.deleteIcon},{[`& .${Yi.deleteIcon}`]:e[`deleteIcon${zt(a)}`]},{[`& .${Yi.deleteIcon}`]:e[`deleteIconColor${zt(i)}`]},{[`& .${Yi.deleteIcon}`]:e[`deleteIcon${zt(l)}Color${zt(i)}`]},e.root,e[`size${zt(a)}`],e[`color${zt(i)}`],s&&e.clickable,s&&i!=="default"&&e[`clickableColor${zt(i)})`],o&&e.deletable,o&&i!=="default"&&e[`deletableColor${zt(i)}`],e[l],e[`${l}${zt(i)}`]]}})(({theme:t,ownerState:e})=>{const r=t.palette.mode==="light"?t.palette.grey[700]:t.palette.grey[300];return Y({maxWidth:"100%",fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(13),display:"inline-flex",alignItems:"center",justifyContent:"center",height:32,color:(t.vars||t).palette.text.primary,backgroundColor:(t.vars||t).palette.action.selected,borderRadius:32/2,whiteSpace:"nowrap",transition:t.transitions.create(["background-color","box-shadow"]),cursor:"default",outline:0,textDecoration:"none",border:0,padding:0,verticalAlign:"middle",boxSizing:"border-box",[`&.${Yi.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity,pointerEvents:"none"},[`& .${Yi.avatar}`]:{marginLeft:5,marginRight:-6,width:24,height:24,color:t.vars?t.vars.palette.Chip.defaultAvatarColor:r,fontSize:t.typography.pxToRem(12)},[`& .${Yi.avatarColorPrimary}`]:{color:(t.vars||t).palette.primary.contrastText,backgroundColor:(t.vars||t).palette.primary.dark},[`& .${Yi.avatarColorSecondary}`]:{color:(t.vars||t).palette.secondary.contrastText,backgroundColor:(t.vars||t).palette.secondary.dark},[`& .${Yi.avatarSmall}`]:{marginLeft:4,marginRight:-4,width:18,height:18,fontSize:t.typography.pxToRem(10)},[`& .${Yi.icon}`]:Y({marginLeft:5,marginRight:-6},e.size==="small"&&{fontSize:18,marginLeft:4,marginRight:-4},e.iconColor===e.color&&Y({color:t.vars?t.vars.palette.Chip.defaultIconColor:r},e.color!=="default"&&{color:"inherit"})),[`& .${Yi.deleteIcon}`]:Y({WebkitTapHighlightColor:"transparent",color:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.26)`:cn(t.palette.text.primary,.26),fontSize:22,cursor:"pointer",margin:"0 5px 0 -6px","&:hover":{color:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.4)`:cn(t.palette.text.primary,.4)}},e.size==="small"&&{fontSize:16,marginRight:4,marginLeft:-4},e.color!=="default"&&{color:t.vars?`rgba(${t.vars.palette[e.color].contrastTextChannel} / 0.7)`:cn(t.palette[e.color].contrastText,.7),"&:hover, &:active":{color:(t.vars||t).palette[e.color].contrastText}})},e.size==="small"&&{height:24},e.color!=="default"&&{backgroundColor:(t.vars||t).palette[e.color].main,color:(t.vars||t).palette[e.color].contrastText},e.onDelete&&{[`&.${Yi.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:cn(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},e.onDelete&&e.color!=="default"&&{[`&.${Yi.focusVisible}`]:{backgroundColor:(t.vars||t).palette[e.color].dark}})},({theme:t,ownerState:e})=>Y({},e.clickable&&{userSelect:"none",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:cn(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity)},[`&.${Yi.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.action.selectedChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:cn(t.palette.action.selected,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)},"&:active":{boxShadow:(t.vars||t).shadows[1]}},e.clickable&&e.color!=="default"&&{[`&:hover, &.${Yi.focusVisible}`]:{backgroundColor:(t.vars||t).palette[e.color].dark}}),({theme:t,ownerState:e})=>Y({},e.variant==="outlined"&&{backgroundColor:"transparent",border:t.vars?`1px solid ${t.vars.palette.Chip.defaultBorder}`:`1px solid ${t.palette.mode==="light"?t.palette.grey[400]:t.palette.grey[700]}`,[`&.${Yi.clickable}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${Yi.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`& .${Yi.avatar}`]:{marginLeft:4},[`& .${Yi.avatarSmall}`]:{marginLeft:2},[`& .${Yi.icon}`]:{marginLeft:4},[`& .${Yi.iconSmall}`]:{marginLeft:2},[`& .${Yi.deleteIcon}`]:{marginRight:5},[`& .${Yi.deleteIconSmall}`]:{marginRight:3}},e.variant==="outlined"&&e.color!=="default"&&{color:(t.vars||t).palette[e.color].main,border:`1px solid ${t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / 0.7)`:cn(t.palette[e.color].main,.7)}`,[`&.${Yi.clickable}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:cn(t.palette[e.color].main,t.palette.action.hoverOpacity)},[`&.${Yi.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / ${t.vars.palette.action.focusOpacity})`:cn(t.palette[e.color].main,t.palette.action.focusOpacity)},[`& .${Yi.deleteIcon}`]:{color:t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / 0.7)`:cn(t.palette[e.color].main,.7),"&:hover, &:active":{color:(t.vars||t).palette[e.color].main}}})),Unt=Ot("span",{name:"MuiChip",slot:"Label",overridesResolver:(t,e)=>{const{ownerState:r}=t,{size:i}=r;return[e.label,e[`label${zt(i)}`]]}})(({ownerState:t})=>Y({overflow:"hidden",textOverflow:"ellipsis",paddingLeft:12,paddingRight:12,whiteSpace:"nowrap"},t.size==="small"&&{paddingLeft:8,paddingRight:8}));function Hye(t){return t.key==="Backspace"||t.key==="Delete"}const znt=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiChip"}),{avatar:n,className:s,clickable:o,color:a="default",component:l,deleteIcon:c,disabled:u=!1,icon:h,label:f,onClick:m,onDelete:g,onKeyDown:y,onKeyUp:_,size:b="medium",variant:w="filled",tabIndex:x,skipFocusWhenDisabled:S=!1}=i,C=Ut(i,Nnt),E=U.useRef(null),R=Js(E,r),P=N=>{N.stopPropagation(),g&&g(N)},D=N=>{N.currentTarget===N.target&&Hye(N)&&N.preventDefault(),y&&y(N)},L=N=>{N.currentTarget===N.target&&(g&&Hye(N)?g(N):N.key==="Escape"&&E.current&&E.current.blur()),_&&_(N)},k=o!==!1&&m?!0:o,V=k||g?S_:l||"div",W=Y({},i,{component:V,disabled:u,size:b,color:a,iconColor:U.isValidElement(h)&&h.props.color||a,onDelete:!!g,clickable:k,variant:w}),G=Fnt(W),B=V===S_?Y({component:l||"div",focusVisibleClassName:G.focusVisible},g&&{disableRipple:!0}):{};let Z=null;g&&(Z=c&&U.isValidElement(c)?U.cloneElement(c,{className:Pt(c.props.className,G.deleteIcon),onClick:P}):F.jsx(Int,{className:Pt(G.deleteIcon),onClick:P}));let M=null;n&&U.isValidElement(n)&&(M=U.cloneElement(n,{className:Pt(G.avatar,n.props.className)}));let $=null;return h&&U.isValidElement(h)&&($=U.cloneElement(h,{className:Pt(G.icon,h.props.className)})),F.jsxs(knt,Y({as:V,className:Pt(G.root,s),disabled:k&&u?!0:void 0,onClick:m,onKeyDown:D,onKeyUp:L,ref:R,tabIndex:S&&u?-1:x,ownerState:W},B,C,{children:[M||$,F.jsx(Unt,{className:Pt(G.label),ownerState:W,children:f}),Z]}))}),L4=znt;function y3({props:t,states:e,muiFormControl:r}){return e.reduce((i,n)=>(i[n]=t[n],r&&typeof t[n]>"u"&&(i[n]=r[n]),i),{})}const Vnt=U.createContext(void 0),Fle=Vnt;function v3(){return U.useContext(Fle)}function $Me(t){return F.jsx(ort,Y({},t,{defaultTheme:QG,themeId:H2}))}function qye(t){return t!=null&&!(Array.isArray(t)&&t.length===0)}function aV(t,e=!1){return t&&(qye(t.value)&&t.value!==""||e&&qye(t.defaultValue)&&t.defaultValue!=="")}function Bnt(t){return t.startAdornment}function jnt(t){return ii("MuiInputBase",t)}const Gnt=Zr("MuiInputBase",["root","formControl","focused","disabled","adornedStart","adornedEnd","error","sizeSmall","multiline","colorSecondary","fullWidth","hiddenLabel","readOnly","input","inputSizeSmall","inputMultiline","inputTypeSearch","inputAdornedStart","inputAdornedEnd","inputHiddenLabel"]),cP=Gnt,Hnt=["aria-describedby","autoComplete","autoFocus","className","color","components","componentsProps","defaultValue","disabled","disableInjectingGlobalStyles","endAdornment","error","fullWidth","id","inputComponent","inputProps","inputRef","margin","maxRows","minRows","multiline","name","onBlur","onChange","onClick","onFocus","onKeyDown","onKeyUp","placeholder","readOnly","renderSuffix","rows","size","slotProps","slots","startAdornment","type","value"],t7=(t,e)=>{const{ownerState:r}=t;return[e.root,r.formControl&&e.formControl,r.startAdornment&&e.adornedStart,r.endAdornment&&e.adornedEnd,r.error&&e.error,r.size==="small"&&e.sizeSmall,r.multiline&&e.multiline,r.color&&e[`color${zt(r.color)}`],r.fullWidth&&e.fullWidth,r.hiddenLabel&&e.hiddenLabel]},r7=(t,e)=>{const{ownerState:r}=t;return[e.input,r.size==="small"&&e.inputSizeSmall,r.multiline&&e.inputMultiline,r.type==="search"&&e.inputTypeSearch,r.startAdornment&&e.inputAdornedStart,r.endAdornment&&e.inputAdornedEnd,r.hiddenLabel&&e.inputHiddenLabel]},qnt=t=>{const{classes:e,color:r,disabled:i,error:n,endAdornment:s,focused:o,formControl:a,fullWidth:l,hiddenLabel:c,multiline:u,readOnly:h,size:f,startAdornment:m,type:g}=t,y={root:["root",`color${zt(r)}`,i&&"disabled",n&&"error",l&&"fullWidth",o&&"focused",a&&"formControl",f==="small"&&"sizeSmall",u&&"multiline",m&&"adornedStart",s&&"adornedEnd",c&&"hiddenLabel",h&&"readOnly"],input:["input",i&&"disabled",g==="search"&&"inputTypeSearch",u&&"inputMultiline",f==="small"&&"inputSizeSmall",c&&"inputHiddenLabel",m&&"inputAdornedStart",s&&"inputAdornedEnd",h&&"readOnly"]};return ui(y,jnt,e)},i7=Ot("div",{name:"MuiInputBase",slot:"Root",overridesResolver:t7})(({theme:t,ownerState:e})=>Y({},t.typography.body1,{color:(t.vars||t).palette.text.primary,lineHeight:"1.4375em",boxSizing:"border-box",position:"relative",cursor:"text",display:"inline-flex",alignItems:"center",[`&.${cP.disabled}`]:{color:(t.vars||t).palette.text.disabled,cursor:"default"}},e.multiline&&Y({padding:"4px 0 5px"},e.size==="small"&&{paddingTop:1}),e.fullWidth&&{width:"100%"})),n7=Ot("input",{name:"MuiInputBase",slot:"Input",overridesResolver:r7})(({theme:t,ownerState:e})=>{const r=t.palette.mode==="light",i=Y({color:"currentColor"},t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:r?.42:.5},{transition:t.transitions.create("opacity",{duration:t.transitions.duration.shorter})}),n={opacity:"0 !important"},s=t.vars?{opacity:t.vars.opacity.inputPlaceholder}:{opacity:r?.42:.5};return Y({font:"inherit",letterSpacing:"inherit",color:"currentColor",padding:"4px 0 5px",border:0,boxSizing:"content-box",background:"none",height:"1.4375em",margin:0,WebkitTapHighlightColor:"transparent",display:"block",minWidth:0,width:"100%",animationName:"mui-auto-fill-cancel",animationDuration:"10ms","&::-webkit-input-placeholder":i,"&::-moz-placeholder":i,"&:-ms-input-placeholder":i,"&::-ms-input-placeholder":i,"&:focus":{outline:0},"&:invalid":{boxShadow:"none"},"&::-webkit-search-decoration":{WebkitAppearance:"none"},[`label[data-shrink=false] + .${cP.formControl} &`]:{"&::-webkit-input-placeholder":n,"&::-moz-placeholder":n,"&:-ms-input-placeholder":n,"&::-ms-input-placeholder":n,"&:focus::-webkit-input-placeholder":s,"&:focus::-moz-placeholder":s,"&:focus:-ms-input-placeholder":s,"&:focus::-ms-input-placeholder":s},[`&.${cP.disabled}`]:{opacity:1,WebkitTextFillColor:(t.vars||t).palette.text.disabled},"&:-webkit-autofill":{animationDuration:"5000s",animationName:"mui-auto-fill"}},e.size==="small"&&{paddingTop:1},e.multiline&&{height:"auto",resize:"none",padding:0,paddingTop:0},e.type==="search"&&{MozAppearance:"textfield"})}),Wnt=F.jsx($Me,{styles:{"@keyframes mui-auto-fill":{from:{display:"block"}},"@keyframes mui-auto-fill-cancel":{from:{display:"block"}}}}),Xnt=U.forwardRef(function(e,r){var i;const n=ni({props:e,name:"MuiInputBase"}),{"aria-describedby":s,autoComplete:o,autoFocus:a,className:l,components:c={},componentsProps:u={},defaultValue:h,disabled:f,disableInjectingGlobalStyles:m,endAdornment:g,fullWidth:y=!1,id:_,inputComponent:b="input",inputProps:w={},inputRef:x,maxRows:S,minRows:C,multiline:E=!1,name:R,onBlur:P,onChange:D,onClick:L,onFocus:k,onKeyDown:V,onKeyUp:W,placeholder:G,readOnly:B,renderSuffix:Z,rows:M,slotProps:$={},slots:N={},startAdornment:j,type:J="text",value:K}=n,te=Ut(n,Hnt),ae=w.value!=null?w.value:K,{current:be}=U.useRef(ae!=null),Ee=U.useRef(),Je=U.useCallback(xt=>{},[]),ze=Js(Ee,x,w.ref,Je),[Ge,Le]=U.useState(!1),de=v3(),$e=y3({props:n,muiFormControl:de,states:["color","disabled","error","hiddenLabel","size","required","filled"]});$e.focused=de?de.focused:Ge,U.useEffect(()=>{!de&&f&&Ge&&(Le(!1),P&&P())},[de,f,Ge,P]);const Be=de&&de.onFilled,we=de&&de.onEmpty,Ie=U.useCallback(xt=>{aV(xt)?Be&&Be():we&&we()},[Be,we]);Sh(()=>{be&&Ie({value:ae})},[ae,Ie,be]);const je=xt=>{if($e.disabled){xt.stopPropagation();return}k&&k(xt),w.onFocus&&w.onFocus(xt),de&&de.onFocus?de.onFocus(xt):Le(!0)},fe=xt=>{P&&P(xt),w.onBlur&&w.onBlur(xt),de&&de.onBlur?de.onBlur(xt):Le(!1)},Ae=(xt,...st)=>{if(!be){const Xe=xt.target||Ee.current;if(Xe==null)throw new Error(Hw(1));Ie({value:Xe.value})}w.onChange&&w.onChange(xt,...st),D&&D(xt,...st)};U.useEffect(()=>{Ie(Ee.current)},[]);const gt=xt=>{Ee.current&&xt.currentTarget===xt.target&&Ee.current.focus(),L&&!$e.disabled&&L(xt)};let Re=b,He=w;E&&Re==="input"&&(M?He=Y({type:void 0,minRows:M,maxRows:M},He):He=Y({type:void 0,maxRows:S,minRows:C},He),Re=net);const Dt=xt=>{Ie(xt.animationName==="mui-auto-fill-cancel"?Ee.current:{value:"x"})};U.useEffect(()=>{de&&de.setAdornedStart(!!j)},[de,j]);const Fe=Y({},n,{color:$e.color||"primary",disabled:$e.disabled,endAdornment:g,error:$e.error,focused:$e.focused,formControl:de,fullWidth:y,hiddenLabel:$e.hiddenLabel,multiline:E,size:$e.size,startAdornment:j,type:J}),nt=qnt(Fe),Ke=N.root||c.Root||i7,mt=$.root||u.root||{},wt=N.input||c.Input||n7;return He=Y({},He,(i=$.input)!=null?i:u.input),F.jsxs(U.Fragment,{children:[!m&&Wnt,F.jsxs(Ke,Y({},mt,!B2(Ke)&&{ownerState:Y({},Fe,mt.ownerState)},{ref:r,onClick:gt},te,{className:Pt(nt.root,mt.className,l,B&&"MuiInputBase-readOnly"),children:[j,F.jsx(Fle.Provider,{value:null,children:F.jsx(wt,Y({ownerState:Fe,"aria-invalid":$e.error,"aria-describedby":s,autoComplete:o,autoFocus:a,defaultValue:h,disabled:$e.disabled,id:_,onAnimationStart:Dt,name:R,placeholder:G,readOnly:B,required:$e.required,rows:M,value:ae,onKeyDown:V,onKeyUp:W,type:J},He,!B2(wt)&&{as:Re,ownerState:Y({},Fe,He.ownerState)},{ref:ze,className:Pt(nt.input,He.className,B&&"MuiInputBase-readOnly"),onBlur:fe,onChange:Ae,onFocus:je}))}),g,Z?Z(Y({},$e,{startAdornment:j})):null]}))]})}),kle=Xnt;function Ynt(t){return ii("MuiInput",t)}const Znt=Y({},cP,Zr("MuiInput",["root","underline","input"])),wM=Znt;function Jnt(t){return ii("MuiOutlinedInput",t)}const Knt=Y({},cP,Zr("MuiOutlinedInput",["root","notchedOutline","input"])),f1=Knt;function Qnt(t){return ii("MuiFilledInput",t)}const est=Y({},cP,Zr("MuiFilledInput",["root","underline","input"])),kx=est,tst=I4(F.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),rst=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],ist={entering:{opacity:1},entered:{opacity:1}},nst=U.forwardRef(function(e,r){const i=_f(),n={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{addEndListener:s,appear:o=!0,children:a,easing:l,in:c,onEnter:u,onEntered:h,onEntering:f,onExit:m,onExited:g,onExiting:y,style:_,timeout:b=n,TransitionComponent:w=Ile}=e,x=Ut(e,rst),S=U.useRef(null),C=Js(S,a.ref,r),E=G=>B=>{if(G){const Z=S.current;B===void 0?G(Z):G(Z,B)}},R=E(f),P=E((G,B)=>{Nle(G);const Z=lP({style:_,timeout:b,easing:l},{mode:"enter"});G.style.webkitTransition=i.transitions.create("opacity",Z),G.style.transition=i.transitions.create("opacity",Z),u&&u(G,B)}),D=E(h),L=E(y),k=E(G=>{const B=lP({style:_,timeout:b,easing:l},{mode:"exit"});G.style.webkitTransition=i.transitions.create("opacity",B),G.style.transition=i.transitions.create("opacity",B),m&&m(G)}),V=E(g),W=G=>{s&&s(S.current,G)};return F.jsx(w,Y({appear:o,in:c,nodeRef:S,onEnter:P,onEntered:D,onEntering:R,onExit:k,onExited:V,onExiting:L,addEndListener:W,timeout:b},x,{children:(G,B)=>U.cloneElement(a,Y({style:Y({opacity:0,visibility:G==="exited"&&!c?"hidden":void 0},ist[G],_,a.props.style),ref:C},B))}))}),sst=nst;function ost(t){return ii("MuiBackdrop",t)}Zr("MuiBackdrop",["root","invisible"]);const ast=["children","className","component","components","componentsProps","invisible","open","slotProps","slots","TransitionComponent","transitionDuration"],lst=t=>{const{classes:e,invisible:r}=t;return ui({root:["root",r&&"invisible"]},ost,e)},cst=Ot("div",{name:"MuiBackdrop",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.invisible&&e.invisible]}})(({ownerState:t})=>Y({position:"fixed",display:"flex",alignItems:"center",justifyContent:"center",right:0,bottom:0,top:0,left:0,backgroundColor:"rgba(0, 0, 0, 0.5)",WebkitTapHighlightColor:"transparent"},t.invisible&&{backgroundColor:"transparent"})),ust=U.forwardRef(function(e,r){var i,n,s;const o=ni({props:e,name:"MuiBackdrop"}),{children:a,className:l,component:c="div",components:u={},componentsProps:h={},invisible:f=!1,open:m,slotProps:g={},slots:y={},TransitionComponent:_=sst,transitionDuration:b}=o,w=Ut(o,ast),x=Y({},o,{component:c,invisible:f}),S=lst(x),C=(i=g.root)!=null?i:h.root;return F.jsx(_,Y({in:m,timeout:b},w,{children:F.jsx(cst,Y({"aria-hidden":!0},C,{as:(n=(s=y.root)!=null?s:u.Root)!=null?n:c,className:Pt(S.root,l,C==null?void 0:C.className),ownerState:Y({},x,C==null?void 0:C.ownerState),classes:S,ref:r,children:a}))}))}),dst=ust,hst=Mle(),pst=EMe({themeId:H2,defaultTheme:hst,defaultClassName:"MuiBox-root",generateClassName:lle.generate}),cl=pst;function fst(t){return ii("MuiButton",t)}const mst=Zr("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]),R5=mst,gst=U.createContext({}),yst=gst,vst=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],_st=t=>{const{color:e,disableElevation:r,fullWidth:i,size:n,variant:s,classes:o}=t,a={root:["root",s,`${s}${zt(e)}`,`size${zt(n)}`,`${s}Size${zt(n)}`,e==="inherit"&&"colorInherit",r&&"disableElevation",i&&"fullWidth"],label:["label"],startIcon:["startIcon",`iconSize${zt(n)}`],endIcon:["endIcon",`iconSize${zt(n)}`]},l=ui(a,fst,o);return Y({},o,l)},IMe=t=>Y({},t.size==="small"&&{"& > *:nth-of-type(1)":{fontSize:18}},t.size==="medium"&&{"& > *:nth-of-type(1)":{fontSize:20}},t.size==="large"&&{"& > *:nth-of-type(1)":{fontSize:22}}),bst=Ot(S_,{shouldForwardProp:t=>vf(t)||t==="classes",name:"MuiButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,e[r.variant],e[`${r.variant}${zt(r.color)}`],e[`size${zt(r.size)}`],e[`${r.variant}Size${zt(r.size)}`],r.color==="inherit"&&e.colorInherit,r.disableElevation&&e.disableElevation,r.fullWidth&&e.fullWidth]}})(({theme:t,ownerState:e})=>{var r,i;const n=t.palette.mode==="light"?t.palette.grey[300]:t.palette.grey[800],s=t.palette.mode==="light"?t.palette.grey.A100:t.palette.grey[700];return Y({},t.typography.button,{minWidth:64,padding:"6px 16px",borderRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create(["background-color","box-shadow","border-color","color"],{duration:t.transitions.duration.short}),"&:hover":Y({textDecoration:"none",backgroundColor:t.vars?`rgba(${t.vars.palette.text.primaryChannel} / ${t.vars.palette.action.hoverOpacity})`:cn(t.palette.text.primary,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},e.variant==="text"&&e.color!=="inherit"&&{backgroundColor:t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:cn(t.palette[e.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},e.variant==="outlined"&&e.color!=="inherit"&&{border:`1px solid ${(t.vars||t).palette[e.color].main}`,backgroundColor:t.vars?`rgba(${t.vars.palette[e.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:cn(t.palette[e.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},e.variant==="contained"&&{backgroundColor:t.vars?t.vars.palette.Button.inheritContainedHoverBg:s,boxShadow:(t.vars||t).shadows[4],"@media (hover: none)":{boxShadow:(t.vars||t).shadows[2],backgroundColor:(t.vars||t).palette.grey[300]}},e.variant==="contained"&&e.color!=="inherit"&&{backgroundColor:(t.vars||t).palette[e.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[e.color].main}}),"&:active":Y({},e.variant==="contained"&&{boxShadow:(t.vars||t).shadows[8]}),[`&.${R5.focusVisible}`]:Y({},e.variant==="contained"&&{boxShadow:(t.vars||t).shadows[6]}),[`&.${R5.disabled}`]:Y({color:(t.vars||t).palette.action.disabled},e.variant==="outlined"&&{border:`1px solid ${(t.vars||t).palette.action.disabledBackground}`},e.variant==="contained"&&{color:(t.vars||t).palette.action.disabled,boxShadow:(t.vars||t).shadows[0],backgroundColor:(t.vars||t).palette.action.disabledBackground})},e.variant==="text"&&{padding:"6px 8px"},e.variant==="text"&&e.color!=="inherit"&&{color:(t.vars||t).palette[e.color].main},e.variant==="outlined"&&{padding:"5px 15px",border:"1px solid currentColor"},e.variant==="outlined"&&e.color!=="inherit"&&{color:(t.vars||t).palette[e.color].main,border:t.vars?`1px solid rgba(${t.vars.palette[e.color].mainChannel} / 0.5)`:`1px solid ${cn(t.palette[e.color].main,.5)}`},e.variant==="contained"&&{color:t.vars?t.vars.palette.text.primary:(r=(i=t.palette).getContrastText)==null?void 0:r.call(i,t.palette.grey[300]),backgroundColor:t.vars?t.vars.palette.Button.inheritContainedBg:n,boxShadow:(t.vars||t).shadows[2]},e.variant==="contained"&&e.color!=="inherit"&&{color:(t.vars||t).palette[e.color].contrastText,backgroundColor:(t.vars||t).palette[e.color].main},e.color==="inherit"&&{color:"inherit",borderColor:"currentColor"},e.size==="small"&&e.variant==="text"&&{padding:"4px 5px",fontSize:t.typography.pxToRem(13)},e.size==="large"&&e.variant==="text"&&{padding:"8px 11px",fontSize:t.typography.pxToRem(15)},e.size==="small"&&e.variant==="outlined"&&{padding:"3px 9px",fontSize:t.typography.pxToRem(13)},e.size==="large"&&e.variant==="outlined"&&{padding:"7px 21px",fontSize:t.typography.pxToRem(15)},e.size==="small"&&e.variant==="contained"&&{padding:"4px 10px",fontSize:t.typography.pxToRem(13)},e.size==="large"&&e.variant==="contained"&&{padding:"8px 22px",fontSize:t.typography.pxToRem(15)},e.fullWidth&&{width:"100%"})},({ownerState:t})=>t.disableElevation&&{boxShadow:"none","&:hover":{boxShadow:"none"},[`&.${R5.focusVisible}`]:{boxShadow:"none"},"&:active":{boxShadow:"none"},[`&.${R5.disabled}`]:{boxShadow:"none"}}),wst=Ot("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.startIcon,e[`iconSize${zt(r.size)}`]]}})(({ownerState:t})=>Y({display:"inherit",marginRight:8,marginLeft:-4},t.size==="small"&&{marginLeft:-2},IMe(t))),xst=Ot("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.endIcon,e[`iconSize${zt(r.size)}`]]}})(({ownerState:t})=>Y({display:"inherit",marginRight:-4,marginLeft:8},t.size==="small"&&{marginRight:-2},IMe(t))),Sst=U.forwardRef(function(e,r){const i=U.useContext(yst),n=ale(i,e),s=ni({props:n,name:"MuiButton"}),{children:o,color:a="primary",component:l="button",className:c,disabled:u=!1,disableElevation:h=!1,disableFocusRipple:f=!1,endIcon:m,focusVisibleClassName:g,fullWidth:y=!1,size:_="medium",startIcon:b,type:w,variant:x="text"}=s,S=Ut(s,vst),C=Y({},s,{color:a,component:l,disabled:u,disableElevation:h,disableFocusRipple:f,fullWidth:y,size:_,type:w,variant:x}),E=_st(C),R=b&&F.jsx(wst,{className:E.startIcon,ownerState:C,children:b}),P=m&&F.jsx(xst,{className:E.endIcon,ownerState:C,children:m});return F.jsxs(bst,Y({ownerState:C,className:Pt(i.className,E.root,c),component:l,disabled:u,focusRipple:!f,focusVisibleClassName:Pt(E.focusVisible,g),ref:r,type:w},S,{classes:E,children:[R,o,P]}))}),D4=Sst;function Tst(t){return ii("MuiCardActionArea",t)}const Est=Zr("MuiCardActionArea",["root","focusVisible","focusHighlight"]),LW=Est,Cst=["children","className","focusVisibleClassName"],Rst=t=>{const{classes:e}=t;return ui({root:["root"],focusHighlight:["focusHighlight"]},Tst,e)},Ost=Ot(S_,{name:"MuiCardActionArea",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t})=>({display:"block",textAlign:"inherit",borderRadius:"inherit",width:"100%",[`&:hover .${LW.focusHighlight}`]:{opacity:(t.vars||t).palette.action.hoverOpacity,"@media (hover: none)":{opacity:0}},[`&.${LW.focusVisible} .${LW.focusHighlight}`]:{opacity:(t.vars||t).palette.action.focusOpacity}})),Ast=Ot("span",{name:"MuiCardActionArea",slot:"FocusHighlight",overridesResolver:(t,e)=>e.focusHighlight})(({theme:t})=>({overflow:"hidden",pointerEvents:"none",position:"absolute",top:0,right:0,bottom:0,left:0,borderRadius:"inherit",opacity:0,backgroundColor:"currentcolor",transition:t.transitions.create("opacity",{duration:t.transitions.duration.short})})),Pst=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiCardActionArea"}),{children:n,className:s,focusVisibleClassName:o}=i,a=Ut(i,Cst),l=i,c=Rst(l);return F.jsxs(Ost,Y({className:Pt(c.root,s),focusVisibleClassName:Pt(o,c.focusVisible),ref:r,ownerState:l},a,{children:[n,F.jsx(Ast,{className:c.focusHighlight,ownerState:l})]}))}),Mst=Pst,$st=(t,e)=>Y({WebkitFontSmoothing:"antialiased",MozOsxFontSmoothing:"grayscale",boxSizing:"border-box",WebkitTextSizeAdjust:"100%"},e&&!t.vars&&{colorScheme:t.palette.mode}),Ist=t=>Y({color:(t.vars||t).palette.text.primary},t.typography.body1,{backgroundColor:(t.vars||t).palette.background.default,"@media print":{backgroundColor:(t.vars||t).palette.common.white}}),Lst=(t,e=!1)=>{var r,i;const n={};e&&t.colorSchemes&&Object.entries(t.colorSchemes).forEach(([a,l])=>{var c;n[t.getColorSchemeSelector(a).replace(/\s*&/,"")]={colorScheme:(c=l.palette)==null?void 0:c.mode}});let s=Y({html:$st(t,e),"*, *::before, *::after":{boxSizing:"inherit"},"strong, b":{fontWeight:t.typography.fontWeightBold},body:Y({margin:0},Ist(t),{"&::backdrop":{backgroundColor:(t.vars||t).palette.background.default}})},n);const o=(r=t.components)==null||(i=r.MuiCssBaseline)==null?void 0:i.styleOverrides;return o&&(s=[s,o]),s};function LMe(t){const e=ni({props:t,name:"MuiCssBaseline"}),{children:r,enableColorScheme:i=!1}=e;return F.jsxs(U.Fragment,{children:[F.jsx($Me,{styles:n=>Lst(n,i)}),r]})}const Dst=["BackdropComponent","BackdropProps","classes","className","closeAfterTransition","children","container","component","components","componentsProps","disableAutoFocus","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","onBackdropClick","onClose","open","slotProps","slots","theme"],Nst=Ot("div",{name:"MuiModal",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.open&&r.exited&&e.hidden]}})(({theme:t,ownerState:e})=>Y({position:"fixed",zIndex:(t.vars||t).zIndex.modal,right:0,bottom:0,top:0,left:0},!e.open&&e.exited&&{visibility:"hidden"})),Fst=Ot(dst,{name:"MuiModal",slot:"Backdrop",overridesResolver:(t,e)=>e.backdrop})({zIndex:-1}),kst=U.forwardRef(function(e,r){var i,n,s,o,a,l;const c=ni({name:"MuiModal",props:e}),{BackdropComponent:u=Fst,BackdropProps:h,classes:f,className:m,closeAfterTransition:g=!1,children:y,container:_,component:b,components:w={},componentsProps:x={},disableAutoFocus:S=!1,disableEnforceFocus:C=!1,disableEscapeKeyDown:E=!1,disablePortal:R=!1,disableRestoreFocus:P=!1,disableScrollLock:D=!1,hideBackdrop:L=!1,keepMounted:k=!1,onBackdropClick:V,onClose:W,open:G,slotProps:B,slots:Z,theme:M}=c,$=Ut(c,Dst),[N,j]=U.useState(!0),J={container:_,closeAfterTransition:g,disableAutoFocus:S,disableEnforceFocus:C,disableEscapeKeyDown:E,disablePortal:R,disableRestoreFocus:P,disableScrollLock:D,hideBackdrop:L,keepMounted:k,onBackdropClick:V,onClose:W,open:G},K=Y({},c,J,{exited:N}),te=(i=(n=Z==null?void 0:Z.root)!=null?n:w.Root)!=null?i:Nst,ae=(s=(o=Z==null?void 0:Z.backdrop)!=null?o:w.Backdrop)!=null?s:u,be=(a=B==null?void 0:B.root)!=null?a:x.root,Ee=(l=B==null?void 0:B.backdrop)!=null?l:x.backdrop;return F.jsx(eet,Y({slots:{root:te,backdrop:ae},slotProps:{root:()=>Y({},WK(be,K),!B2(te)&&{as:b,theme:M},{className:Pt(m,be==null?void 0:be.className,f==null?void 0:f.root,!K.open&&K.exited&&(f==null?void 0:f.hidden))}),backdrop:()=>Y({},h,WK(Ee,K),{className:Pt(Ee==null?void 0:Ee.className,h==null?void 0:h.className,f==null?void 0:f.backdrop)})},onTransitionEnter:()=>j(!1),onTransitionExited:()=>j(!0),ref:r},$,J,{children:y}))}),DMe=kst;function Ust(t){return ii("MuiDivider",t)}const zst=Zr("MuiDivider",["root","absolute","fullWidth","inset","middle","flexItem","light","vertical","withChildren","withChildrenVertical","textAlignRight","textAlignLeft","wrapper","wrapperVertical"]),Wye=zst,Vst=["absolute","children","className","component","flexItem","light","orientation","role","textAlign","variant"],Bst=t=>{const{absolute:e,children:r,classes:i,flexItem:n,light:s,orientation:o,textAlign:a,variant:l}=t;return ui({root:["root",e&&"absolute",l,s&&"light",o==="vertical"&&"vertical",n&&"flexItem",r&&"withChildren",r&&o==="vertical"&&"withChildrenVertical",a==="right"&&o!=="vertical"&&"textAlignRight",a==="left"&&o!=="vertical"&&"textAlignLeft"],wrapper:["wrapper",o==="vertical"&&"wrapperVertical"]},Ust,i)},jst=Ot("div",{name:"MuiDivider",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.absolute&&e.absolute,e[r.variant],r.light&&e.light,r.orientation==="vertical"&&e.vertical,r.flexItem&&e.flexItem,r.children&&e.withChildren,r.children&&r.orientation==="vertical"&&e.withChildrenVertical,r.textAlign==="right"&&r.orientation!=="vertical"&&e.textAlignRight,r.textAlign==="left"&&r.orientation!=="vertical"&&e.textAlignLeft]}})(({theme:t,ownerState:e})=>Y({margin:0,flexShrink:0,borderWidth:0,borderStyle:"solid",borderColor:(t.vars||t).palette.divider,borderBottomWidth:"thin"},e.absolute&&{position:"absolute",bottom:0,left:0,width:"100%"},e.light&&{borderColor:t.vars?`rgba(${t.vars.palette.dividerChannel} / 0.08)`:cn(t.palette.divider,.08)},e.variant==="inset"&&{marginLeft:72},e.variant==="middle"&&e.orientation==="horizontal"&&{marginLeft:t.spacing(2),marginRight:t.spacing(2)},e.variant==="middle"&&e.orientation==="vertical"&&{marginTop:t.spacing(1),marginBottom:t.spacing(1)},e.orientation==="vertical"&&{height:"100%",borderBottomWidth:0,borderRightWidth:"thin"},e.flexItem&&{alignSelf:"stretch",height:"auto"}),({ownerState:t})=>Y({},t.children&&{display:"flex",whiteSpace:"nowrap",textAlign:"center",border:0,"&::before, &::after":{content:'""',alignSelf:"center"}}),({theme:t,ownerState:e})=>Y({},e.children&&e.orientation!=="vertical"&&{"&::before, &::after":{width:"100%",borderTop:`thin solid ${(t.vars||t).palette.divider}`}}),({theme:t,ownerState:e})=>Y({},e.children&&e.orientation==="vertical"&&{flexDirection:"column","&::before, &::after":{height:"100%",borderLeft:`thin solid ${(t.vars||t).palette.divider}`}}),({ownerState:t})=>Y({},t.textAlign==="right"&&t.orientation!=="vertical"&&{"&::before":{width:"90%"},"&::after":{width:"10%"}},t.textAlign==="left"&&t.orientation!=="vertical"&&{"&::before":{width:"10%"},"&::after":{width:"90%"}})),Gst=Ot("span",{name:"MuiDivider",slot:"Wrapper",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.wrapper,r.orientation==="vertical"&&e.wrapperVertical]}})(({theme:t,ownerState:e})=>Y({display:"inline-block",paddingLeft:`calc(${t.spacing(1)} * 1.2)`,paddingRight:`calc(${t.spacing(1)} * 1.2)`},e.orientation==="vertical"&&{paddingTop:`calc(${t.spacing(1)} * 1.2)`,paddingBottom:`calc(${t.spacing(1)} * 1.2)`})),Hst=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiDivider"}),{absolute:n=!1,children:s,className:o,component:a=s?"div":"hr",flexItem:l=!1,light:c=!1,orientation:u="horizontal",role:h=a!=="hr"?"separator":void 0,textAlign:f="center",variant:m="fullWidth"}=i,g=Ut(i,Vst),y=Y({},i,{absolute:n,component:a,flexItem:l,light:c,orientation:u,role:h,textAlign:f,variant:m}),_=Bst(y);return F.jsx(jst,Y({as:a,className:Pt(_.root,o),role:h,ref:r,ownerState:y},g,{children:s?F.jsx(Gst,{className:_.wrapper,ownerState:y,children:s}):null}))}),qst=Hst,Wst=["addEndListener","appear","children","container","direction","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function Xst(t,e,r){const i=e.getBoundingClientRect(),n=r&&r.getBoundingClientRect(),s=ef(e);let o;if(e.fakeTransform)o=e.fakeTransform;else{const c=s.getComputedStyle(e);o=c.getPropertyValue("-webkit-transform")||c.getPropertyValue("transform")}let a=0,l=0;if(o&&o!=="none"&&typeof o=="string"){const c=o.split("(")[1].split(")")[0].split(",");a=parseInt(c[4],10),l=parseInt(c[5],10)}return t==="left"?n?`translateX(${n.right+a-i.left}px)`:`translateX(${s.innerWidth+a-i.left}px)`:t==="right"?n?`translateX(-${i.right-n.left-a}px)`:`translateX(-${i.left+i.width-a}px)`:t==="up"?n?`translateY(${n.bottom+l-i.top}px)`:`translateY(${s.innerHeight+l-i.top}px)`:n?`translateY(-${i.top-n.top+i.height-l}px)`:`translateY(-${i.top+i.height-l}px)`}function Yst(t){return typeof t=="function"?t():t}function O5(t,e,r){const i=Yst(r),n=Xst(t,e,i);n&&(e.style.webkitTransform=n,e.style.transform=n)}const Zst=U.forwardRef(function(e,r){const i=_f(),n={enter:i.transitions.easing.easeOut,exit:i.transitions.easing.sharp},s={enter:i.transitions.duration.enteringScreen,exit:i.transitions.duration.leavingScreen},{addEndListener:o,appear:a=!0,children:l,container:c,direction:u="down",easing:h=n,in:f,onEnter:m,onEntered:g,onEntering:y,onExit:_,onExited:b,onExiting:w,style:x,timeout:S=s,TransitionComponent:C=Ile}=e,E=Ut(e,Wst),R=U.useRef(null),P=Js(l.ref,R,r),D=$=>N=>{$&&(N===void 0?$(R.current):$(R.current,N))},L=D(($,N)=>{O5(u,$,c),Nle($),m&&m($,N)}),k=D(($,N)=>{const j=lP({timeout:S,style:x,easing:h},{mode:"enter"});$.style.webkitTransition=i.transitions.create("-webkit-transform",Y({},j)),$.style.transition=i.transitions.create("transform",Y({},j)),$.style.webkitTransform="none",$.style.transform="none",y&&y($,N)}),V=D(g),W=D(w),G=D($=>{const N=lP({timeout:S,style:x,easing:h},{mode:"exit"});$.style.webkitTransition=i.transitions.create("-webkit-transform",N),$.style.transition=i.transitions.create("transform",N),O5(u,$,c),_&&_($)}),B=D($=>{$.style.webkitTransition="",$.style.transition="",b&&b($)}),Z=$=>{o&&o(R.current,$)},M=U.useCallback(()=>{R.current&&O5(u,R.current,c)},[u,c]);return U.useEffect(()=>{if(f||u==="down"||u==="right")return;const $=V2(()=>{R.current&&O5(u,R.current,c)}),N=ef(R.current);return N.addEventListener("resize",$),()=>{$.clear(),N.removeEventListener("resize",$)}},[u,f,c]),U.useEffect(()=>{f||M()},[f,M]),F.jsx(C,Y({nodeRef:R,onEnter:L,onEntered:V,onEntering:k,onExit:G,onExited:B,onExiting:W,addEndListener:Z,appear:a,in:f,timeout:S},E,{children:($,N)=>U.cloneElement(l,Y({ref:P,style:Y({visibility:$==="exited"&&!f?"hidden":void 0},x,l.props.style)},N))}))}),Jst=Zst;function Kst(t){return ii("MuiDrawer",t)}Zr("MuiDrawer",["root","docked","paper","paperAnchorLeft","paperAnchorRight","paperAnchorTop","paperAnchorBottom","paperAnchorDockedLeft","paperAnchorDockedRight","paperAnchorDockedTop","paperAnchorDockedBottom","modal"]);const Qst=["BackdropProps"],eot=["anchor","BackdropProps","children","className","elevation","hideBackdrop","ModalProps","onClose","open","PaperProps","SlideProps","TransitionComponent","transitionDuration","variant"],NMe=(t,e)=>{const{ownerState:r}=t;return[e.root,(r.variant==="permanent"||r.variant==="persistent")&&e.docked,e.modal]},tot=t=>{const{classes:e,anchor:r,variant:i}=t,n={root:["root"],docked:[(i==="permanent"||i==="persistent")&&"docked"],modal:["modal"],paper:["paper",`paperAnchor${zt(r)}`,i!=="temporary"&&`paperAnchorDocked${zt(r)}`]};return ui(n,Kst,e)},rot=Ot(DMe,{name:"MuiDrawer",slot:"Root",overridesResolver:NMe})(({theme:t})=>({zIndex:(t.vars||t).zIndex.drawer})),Xye=Ot("div",{shouldForwardProp:vf,name:"MuiDrawer",slot:"Docked",skipVariantsResolver:!1,overridesResolver:NMe})({flex:"0 0 auto"}),iot=Ot($le,{name:"MuiDrawer",slot:"Paper",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.paper,e[`paperAnchor${zt(r.anchor)}`],r.variant!=="temporary"&&e[`paperAnchorDocked${zt(r.anchor)}`]]}})(({theme:t,ownerState:e})=>Y({overflowY:"auto",display:"flex",flexDirection:"column",height:"100%",flex:"1 0 auto",zIndex:(t.vars||t).zIndex.drawer,WebkitOverflowScrolling:"touch",position:"fixed",top:0,outline:0},e.anchor==="left"&&{left:0},e.anchor==="top"&&{top:0,left:0,right:0,height:"auto",maxHeight:"100%"},e.anchor==="right"&&{right:0},e.anchor==="bottom"&&{top:"auto",left:0,bottom:0,right:0,height:"auto",maxHeight:"100%"},e.anchor==="left"&&e.variant!=="temporary"&&{borderRight:`1px solid ${(t.vars||t).palette.divider}`},e.anchor==="top"&&e.variant!=="temporary"&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`},e.anchor==="right"&&e.variant!=="temporary"&&{borderLeft:`1px solid ${(t.vars||t).palette.divider}`},e.anchor==="bottom"&&e.variant!=="temporary"&&{borderTop:`1px solid ${(t.vars||t).palette.divider}`})),FMe={left:"right",right:"left",top:"down",bottom:"up"};function not(t){return["left","right"].indexOf(t)!==-1}function sot(t,e){return t.direction==="rtl"&&not(e)?FMe[e]:e}const oot=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiDrawer"}),n=_f(),s={enter:n.transitions.duration.enteringScreen,exit:n.transitions.duration.leavingScreen},{anchor:o="left",BackdropProps:a,children:l,className:c,elevation:u=16,hideBackdrop:h=!1,ModalProps:{BackdropProps:f}={},onClose:m,open:g=!1,PaperProps:y={},SlideProps:_,TransitionComponent:b=Jst,transitionDuration:w=s,variant:x="temporary"}=i,S=Ut(i.ModalProps,Qst),C=Ut(i,eot),E=U.useRef(!1);U.useEffect(()=>{E.current=!0},[]);const R=sot(n,o),D=Y({},i,{anchor:o,elevation:u,open:g,variant:x},C),L=tot(D),k=F.jsx(iot,Y({elevation:x==="temporary"?u:0,square:!0},y,{className:Pt(L.paper,y.className),ownerState:D,children:l}));if(x==="permanent")return F.jsx(Xye,Y({className:Pt(L.root,L.docked,c),ownerState:D,ref:r},C,{children:k}));const V=F.jsx(b,Y({in:g,direction:FMe[R],timeout:w,appear:E.current},_,{children:k}));return x==="persistent"?F.jsx(Xye,Y({className:Pt(L.root,L.docked,c),ownerState:D,ref:r},C,{children:V})):F.jsx(rot,Y({BackdropProps:Y({},a,f,{transitionDuration:w}),className:Pt(L.root,L.modal,c),open:g,ownerState:D,onClose:m,hideBackdrop:h,ref:r},C,S,{children:V}))}),aot=oot,lot=["disableUnderline","components","componentsProps","fullWidth","hiddenLabel","inputComponent","multiline","slotProps","slots","type"],cot=t=>{const{classes:e,disableUnderline:r}=t,n=ui({root:["root",!r&&"underline"],input:["input"]},Qnt,e);return Y({},e,n)},uot=Ot(i7,{shouldForwardProp:t=>vf(t)||t==="classes",name:"MuiFilledInput",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[...t7(t,e),!r.disableUnderline&&e.underline]}})(({theme:t,ownerState:e})=>{var r;const i=t.palette.mode==="light",n=i?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",s=i?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",o=i?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",a=i?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return Y({position:"relative",backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s,borderTopLeftRadius:(t.vars||t).shape.borderRadius,borderTopRightRadius:(t.vars||t).shape.borderRadius,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),"&:hover":{backgroundColor:t.vars?t.vars.palette.FilledInput.hoverBg:o,"@media (hover: none)":{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s}},[`&.${kx.focused}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.bg:s},[`&.${kx.disabled}`]:{backgroundColor:t.vars?t.vars.palette.FilledInput.disabledBg:a}},!e.disableUnderline&&{"&:after":{borderBottom:`2px solid ${(r=(t.vars||t).palette[e.color||"primary"])==null?void 0:r.main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${kx.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${kx.error}`]:{"&:before, &:after":{borderBottomColor:(t.vars||t).palette.error.main}},"&:before":{borderBottom:`1px solid ${t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`:n}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${kx.disabled}, .${kx.error}):before`]:{borderBottom:`1px solid ${(t.vars||t).palette.text.primary}`},[`&.${kx.disabled}:before`]:{borderBottomStyle:"dotted"}},e.startAdornment&&{paddingLeft:12},e.endAdornment&&{paddingRight:12},e.multiline&&Y({padding:"25px 12px 8px"},e.size==="small"&&{paddingTop:21,paddingBottom:4},e.hiddenLabel&&{paddingTop:16,paddingBottom:17}))}),dot=Ot(n7,{name:"MuiFilledInput",slot:"Input",overridesResolver:r7})(({theme:t,ownerState:e})=>Y({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderTopLeftRadius:"inherit",borderTopRightRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},e.size==="small"&&{paddingTop:21,paddingBottom:4},e.hiddenLabel&&{paddingTop:16,paddingBottom:17},e.multiline&&{paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0},e.startAdornment&&{paddingLeft:0},e.endAdornment&&{paddingRight:0},e.hiddenLabel&&e.size==="small"&&{paddingTop:8,paddingBottom:9})),kMe=U.forwardRef(function(e,r){var i,n,s,o;const a=ni({props:e,name:"MuiFilledInput"}),{components:l={},componentsProps:c,fullWidth:u=!1,inputComponent:h="input",multiline:f=!1,slotProps:m,slots:g={},type:y="text"}=a,_=Ut(a,lot),b=Y({},a,{fullWidth:u,inputComponent:h,multiline:f,type:y}),w=cot(a),x={root:{ownerState:b},input:{ownerState:b}},S=m??c?Gp(m??c,x):x,C=(i=(n=g.root)!=null?n:l.Root)!=null?i:uot,E=(s=(o=g.input)!=null?o:l.Input)!=null?s:dot;return F.jsx(kle,Y({slots:{root:C,input:E},componentsProps:S,fullWidth:u,inputComponent:h,multiline:f,ref:r,type:y},_,{classes:w}))});kMe.muiName="Input";const UMe=kMe;function hot(t){return ii("MuiFormControl",t)}Zr("MuiFormControl",["root","marginNone","marginNormal","marginDense","fullWidth","disabled"]);const pot=["children","className","color","component","disabled","error","focused","fullWidth","hiddenLabel","margin","required","size","variant"],fot=t=>{const{classes:e,margin:r,fullWidth:i}=t,n={root:["root",r!=="none"&&`margin${zt(r)}`,i&&"fullWidth"]};return ui(n,hot,e)},mot=Ot("div",{name:"MuiFormControl",slot:"Root",overridesResolver:({ownerState:t},e)=>Y({},e.root,e[`margin${zt(t.margin)}`],t.fullWidth&&e.fullWidth)})(({ownerState:t})=>Y({display:"inline-flex",flexDirection:"column",position:"relative",minWidth:0,padding:0,margin:0,border:0,verticalAlign:"top"},t.margin==="normal"&&{marginTop:16,marginBottom:8},t.margin==="dense"&&{marginTop:8,marginBottom:4},t.fullWidth&&{width:"100%"})),got=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiFormControl"}),{children:n,className:s,color:o="primary",component:a="div",disabled:l=!1,error:c=!1,focused:u,fullWidth:h=!1,hiddenLabel:f=!1,margin:m="none",required:g=!1,size:y="medium",variant:_="outlined"}=i,b=Ut(i,pot),w=Y({},i,{color:o,component:a,disabled:l,error:c,fullWidth:h,hiddenLabel:f,margin:m,required:g,size:y,variant:_}),x=fot(w),[S,C]=U.useState(()=>{let W=!1;return n&&U.Children.forEach(n,G=>{if(!BL(G,["Input","Select"]))return;const B=BL(G,["Select"])?G.props.input:G;B&&Bnt(B.props)&&(W=!0)}),W}),[E,R]=U.useState(()=>{let W=!1;return n&&U.Children.forEach(n,G=>{BL(G,["Input","Select"])&&(aV(G.props,!0)||aV(G.props.inputProps,!0))&&(W=!0)}),W}),[P,D]=U.useState(!1);l&&P&&D(!1);const L=u!==void 0&&!l?u:P;let k;const V=U.useMemo(()=>({adornedStart:S,setAdornedStart:C,color:o,disabled:l,error:c,filled:E,focused:L,fullWidth:h,hiddenLabel:f,size:y,onBlur:()=>{D(!1)},onEmpty:()=>{R(!1)},onFilled:()=>{R(!0)},onFocus:()=>{D(!0)},registerEffect:k,required:g,variant:_}),[S,o,l,c,E,L,h,f,k,g,y,_]);return F.jsx(Fle.Provider,{value:V,children:F.jsx(mot,Y({as:a,ownerState:w,className:Pt(x.root,s),ref:r},b,{children:n}))})}),Im=got;function yot(t){return ii("MuiFormHelperText",t)}const vot=Zr("MuiFormHelperText",["root","error","disabled","sizeSmall","sizeMedium","contained","focused","filled","required"]),Yye=vot;var Zye;const _ot=["children","className","component","disabled","error","filled","focused","margin","required","variant"],bot=t=>{const{classes:e,contained:r,size:i,disabled:n,error:s,filled:o,focused:a,required:l}=t,c={root:["root",n&&"disabled",s&&"error",i&&`size${zt(i)}`,r&&"contained",a&&"focused",o&&"filled",l&&"required"]};return ui(c,yot,e)},wot=Ot("p",{name:"MuiFormHelperText",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.size&&e[`size${zt(r.size)}`],r.contained&&e.contained,r.filled&&e.filled]}})(({theme:t,ownerState:e})=>Y({color:(t.vars||t).palette.text.secondary},t.typography.caption,{textAlign:"left",marginTop:3,marginRight:0,marginBottom:0,marginLeft:0,[`&.${Yye.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${Yye.error}`]:{color:(t.vars||t).palette.error.main}},e.size==="small"&&{marginTop:4},e.contained&&{marginLeft:14,marginRight:14})),xot=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiFormHelperText"}),{children:n,className:s,component:o="p"}=i,a=Ut(i,_ot),l=v3(),c=y3({props:i,muiFormControl:l,states:["variant","size","disabled","error","filled","focused","required"]}),u=Y({},i,{component:o,contained:c.variant==="filled"||c.variant==="outlined",variant:c.variant,size:c.size,disabled:c.disabled,error:c.error,filled:c.filled,focused:c.focused,required:c.required}),h=bot(u);return F.jsx(wot,Y({as:o,ownerState:u,className:Pt(h.root,s),ref:r},a,{children:n===" "?Zye||(Zye=F.jsx("span",{className:"notranslate",children:""})):n}))}),zMe=xot;function Sot(t){return ii("MuiFormLabel",t)}const Tot=Zr("MuiFormLabel",["root","colorSecondary","focused","disabled","error","filled","required","asterisk"]),XL=Tot,Eot=["children","className","color","component","disabled","error","filled","focused","required"],Cot=t=>{const{classes:e,color:r,focused:i,disabled:n,error:s,filled:o,required:a}=t,l={root:["root",`color${zt(r)}`,n&&"disabled",s&&"error",o&&"filled",i&&"focused",a&&"required"],asterisk:["asterisk",s&&"error"]};return ui(l,Sot,e)},Rot=Ot("label",{name:"MuiFormLabel",slot:"Root",overridesResolver:({ownerState:t},e)=>Y({},e.root,t.color==="secondary"&&e.colorSecondary,t.filled&&e.filled)})(({theme:t,ownerState:e})=>Y({color:(t.vars||t).palette.text.secondary},t.typography.body1,{lineHeight:"1.4375em",padding:0,position:"relative",[`&.${XL.focused}`]:{color:(t.vars||t).palette[e.color].main},[`&.${XL.disabled}`]:{color:(t.vars||t).palette.text.disabled},[`&.${XL.error}`]:{color:(t.vars||t).palette.error.main}})),Oot=Ot("span",{name:"MuiFormLabel",slot:"Asterisk",overridesResolver:(t,e)=>e.asterisk})(({theme:t})=>({[`&.${XL.error}`]:{color:(t.vars||t).palette.error.main}})),Aot=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiFormLabel"}),{children:n,className:s,component:o="label"}=i,a=Ut(i,Eot),l=v3(),c=y3({props:i,muiFormControl:l,states:["color","required","focused","disabled","error","filled"]}),u=Y({},i,{color:c.color||"primary",component:o,disabled:c.disabled,error:c.error,filled:c.filled,focused:c.focused,required:c.required}),h=Cot(u);return F.jsxs(Rot,Y({as:o,ownerState:u,className:Pt(h.root,s),ref:r},a,{children:[n,c.required&&F.jsxs(Oot,{ownerState:u,"aria-hidden":!0,className:h.asterisk,children:["","*"]})]}))}),Pot=Aot,Mot=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"];function nQ(t){return`scale(${t}, ${t**2})`}const $ot={entering:{opacity:1,transform:nQ(1)},entered:{opacity:1,transform:"none"}},DW=typeof navigator<"u"&&/^((?!chrome|android).)*(safari|mobile)/i.test(navigator.userAgent)&&/(os |version\/)15(.|_)4/i.test(navigator.userAgent),VMe=U.forwardRef(function(e,r){const{addEndListener:i,appear:n=!0,children:s,easing:o,in:a,onEnter:l,onEntered:c,onEntering:u,onExit:h,onExited:f,onExiting:m,style:g,timeout:y="auto",TransitionComponent:_=Ile}=e,b=Ut(e,Mot),w=U.useRef(),x=U.useRef(),S=_f(),C=U.useRef(null),E=Js(C,s.ref,r),R=B=>Z=>{if(B){const M=C.current;Z===void 0?B(M):B(M,Z)}},P=R(u),D=R((B,Z)=>{Nle(B);const{duration:M,delay:$,easing:N}=lP({style:g,timeout:y,easing:o},{mode:"enter"});let j;y==="auto"?(j=S.transitions.getAutoHeightDuration(B.clientHeight),x.current=j):j=M,B.style.transition=[S.transitions.create("opacity",{duration:j,delay:$}),S.transitions.create("transform",{duration:DW?j:j*.666,delay:$,easing:N})].join(","),l&&l(B,Z)}),L=R(c),k=R(m),V=R(B=>{const{duration:Z,delay:M,easing:$}=lP({style:g,timeout:y,easing:o},{mode:"exit"});let N;y==="auto"?(N=S.transitions.getAutoHeightDuration(B.clientHeight),x.current=N):N=Z,B.style.transition=[S.transitions.create("opacity",{duration:N,delay:M}),S.transitions.create("transform",{duration:DW?N:N*.666,delay:DW?M:M||N*.333,easing:$})].join(","),B.style.opacity=0,B.style.transform=nQ(.75),h&&h(B)}),W=R(f),G=B=>{y==="auto"&&(w.current=setTimeout(B,x.current||0)),i&&i(C.current,B)};return U.useEffect(()=>()=>{clearTimeout(w.current)},[]),F.jsx(_,Y({appear:n,in:a,nodeRef:C,onEnter:D,onEntered:L,onEntering:P,onExit:V,onExited:W,onExiting:k,addEndListener:G,timeout:y==="auto"?null:y},b,{children:(B,Z)=>U.cloneElement(s,Y({style:Y({opacity:0,transform:nQ(.75),visibility:B==="exited"&&!a?"hidden":void 0},$ot[B],g,s.props.style),ref:E},Z))}))});VMe.muiSupportAuto=!0;const sQ=VMe,Iot=["disableUnderline","components","componentsProps","fullWidth","inputComponent","multiline","slotProps","slots","type"],Lot=t=>{const{classes:e,disableUnderline:r}=t,n=ui({root:["root",!r&&"underline"],input:["input"]},Ynt,e);return Y({},e,n)},Dot=Ot(i7,{shouldForwardProp:t=>vf(t)||t==="classes",name:"MuiInput",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[...t7(t,e),!r.disableUnderline&&e.underline]}})(({theme:t,ownerState:e})=>{let i=t.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return t.vars&&(i=`rgba(${t.vars.palette.common.onBackgroundChannel} / ${t.vars.opacity.inputUnderline})`),Y({position:"relative"},e.formControl&&{"label + &":{marginTop:16}},!e.disableUnderline&&{"&:after":{borderBottom:`2px solid ${(t.vars||t).palette[e.color].main}`,left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:t.transitions.create("transform",{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${wM.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${wM.error}`]:{"&:before, &:after":{borderBottomColor:(t.vars||t).palette.error.main}},"&:before":{borderBottom:`1px solid ${i}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:t.transitions.create("border-bottom-color",{duration:t.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${wM.disabled}, .${wM.error}):before`]:{borderBottom:`2px solid ${(t.vars||t).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${i}`}},[`&.${wM.disabled}:before`]:{borderBottomStyle:"dotted"}})}),Not=Ot(n7,{name:"MuiInput",slot:"Input",overridesResolver:r7})({}),BMe=U.forwardRef(function(e,r){var i,n,s,o;const a=ni({props:e,name:"MuiInput"}),{disableUnderline:l,components:c={},componentsProps:u,fullWidth:h=!1,inputComponent:f="input",multiline:m=!1,slotProps:g,slots:y={},type:_="text"}=a,b=Ut(a,Iot),w=Lot(a),S={root:{ownerState:{disableUnderline:l}}},C=g??u?Gp(g??u,S):S,E=(i=(n=y.root)!=null?n:c.Root)!=null?i:Dot,R=(s=(o=y.input)!=null?o:c.Input)!=null?s:Not;return F.jsx(kle,Y({slots:{root:E,input:R},slotProps:C,fullWidth:h,inputComponent:f,multiline:m,ref:r,type:_},b,{classes:w}))});BMe.muiName="Input";const jMe=BMe;function Fot(t){return ii("MuiInputLabel",t)}Zr("MuiInputLabel",["root","focused","disabled","error","required","asterisk","formControl","sizeSmall","shrink","animated","standard","filled","outlined"]);const kot=["disableAnimation","margin","shrink","variant","className"],Uot=t=>{const{classes:e,formControl:r,size:i,shrink:n,disableAnimation:s,variant:o,required:a}=t,c=ui({root:["root",r&&"formControl",!s&&"animated",n&&"shrink",i==="small"&&"sizeSmall",o],asterisk:[a&&"asterisk"]},Fot,e);return Y({},e,c)},zot=Ot(Pot,{shouldForwardProp:t=>vf(t)||t==="classes",name:"MuiInputLabel",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`& .${XL.asterisk}`]:e.asterisk},e.root,r.formControl&&e.formControl,r.size==="small"&&e.sizeSmall,r.shrink&&e.shrink,!r.disableAnimation&&e.animated,e[r.variant]]}})(({theme:t,ownerState:e})=>Y({display:"block",transformOrigin:"top left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"100%"},e.formControl&&{position:"absolute",left:0,top:0,transform:"translate(0, 20px) scale(1)"},e.size==="small"&&{transform:"translate(0, 17px) scale(1)"},e.shrink&&{transform:"translate(0, -1.5px) scale(0.75)",transformOrigin:"top left",maxWidth:"133%"},!e.disableAnimation&&{transition:t.transitions.create(["color","transform","max-width"],{duration:t.transitions.duration.shorter,easing:t.transitions.easing.easeOut})},e.variant==="filled"&&Y({zIndex:1,pointerEvents:"none",transform:"translate(12px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},e.size==="small"&&{transform:"translate(12px, 13px) scale(1)"},e.shrink&&Y({userSelect:"none",pointerEvents:"auto",transform:"translate(12px, 7px) scale(0.75)",maxWidth:"calc(133% - 24px)"},e.size==="small"&&{transform:"translate(12px, 4px) scale(0.75)"})),e.variant==="outlined"&&Y({zIndex:1,pointerEvents:"none",transform:"translate(14px, 16px) scale(1)",maxWidth:"calc(100% - 24px)"},e.size==="small"&&{transform:"translate(14px, 9px) scale(1)"},e.shrink&&{userSelect:"none",pointerEvents:"auto",maxWidth:"calc(133% - 32px)",transform:"translate(14px, -9px) scale(0.75)"}))),Vot=U.forwardRef(function(e,r){const i=ni({name:"MuiInputLabel",props:e}),{disableAnimation:n=!1,shrink:s,className:o}=i,a=Ut(i,kot),l=v3();let c=s;typeof c>"u"&&l&&(c=l.filled||l.focused||l.adornedStart);const u=y3({props:i,muiFormControl:l,states:["size","variant","required"]}),h=Y({},i,{disableAnimation:n,formControl:l,shrink:c,size:u.size,variant:u.variant,required:u.required}),f=Uot(h);return F.jsx(zot,Y({"data-shrink":c,ownerState:h,ref:r,className:Pt(f.root,o)},a,{classes:f}))}),Iy=Vot,Bot=U.createContext({}),Gy=Bot;function jot(t){return ii("MuiList",t)}Zr("MuiList",["root","padding","dense","subheader"]);const Got=["children","className","component","dense","disablePadding","subheader"],Hot=t=>{const{classes:e,disablePadding:r,dense:i,subheader:n}=t;return ui({root:["root",!r&&"padding",i&&"dense",n&&"subheader"]},jot,e)},qot=Ot("ul",{name:"MuiList",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.disablePadding&&e.padding,r.dense&&e.dense,r.subheader&&e.subheader]}})(({ownerState:t})=>Y({listStyle:"none",margin:0,padding:0,position:"relative"},!t.disablePadding&&{paddingTop:8,paddingBottom:8},t.subheader&&{paddingTop:0})),Wot=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiList"}),{children:n,className:s,component:o="ul",dense:a=!1,disablePadding:l=!1,subheader:c}=i,u=Ut(i,Got),h=U.useMemo(()=>({dense:a}),[a]),f=Y({},i,{component:o,dense:a,disablePadding:l}),m=Hot(f);return F.jsx(Gy.Provider,{value:h,children:F.jsxs(qot,Y({as:o,className:Pt(m.root,s),ref:r,ownerState:f},u,{children:[c,n]}))})}),GMe=Wot;function Xot(t){return ii("MuiListItem",t)}const Yot=Zr("MuiListItem",["root","container","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","padding","button","secondaryAction","selected"]),_R=Yot;function Zot(t){return ii("MuiListItemButton",t)}const Jot=Zr("MuiListItemButton",["root","focusVisible","dense","alignItemsFlexStart","disabled","divider","gutters","selected"]),bR=Jot,Kot=["alignItems","autoFocus","component","children","dense","disableGutters","divider","focusVisibleClassName","selected","className"],Qot=(t,e)=>{const{ownerState:r}=t;return[e.root,r.dense&&e.dense,r.alignItems==="flex-start"&&e.alignItemsFlexStart,r.divider&&e.divider,!r.disableGutters&&e.gutters]},eat=t=>{const{alignItems:e,classes:r,dense:i,disabled:n,disableGutters:s,divider:o,selected:a}=t,c=ui({root:["root",i&&"dense",!s&&"gutters",o&&"divider",n&&"disabled",e==="flex-start"&&"alignItemsFlexStart",a&&"selected"]},Zot,r);return Y({},r,c)},tat=Ot(S_,{shouldForwardProp:t=>vf(t)||t==="classes",name:"MuiListItemButton",slot:"Root",overridesResolver:Qot})(({theme:t,ownerState:e})=>Y({display:"flex",flexGrow:1,justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minWidth:0,boxSizing:"border-box",textAlign:"left",paddingTop:8,paddingBottom:8,transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${bR.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:cn(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${bR.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:cn(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${bR.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:cn(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:cn(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${bR.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${bR.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},e.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},e.alignItems==="flex-start"&&{alignItems:"flex-start"},!e.disableGutters&&{paddingLeft:16,paddingRight:16},e.dense&&{paddingTop:4,paddingBottom:4})),rat=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiListItemButton"}),{alignItems:n="center",autoFocus:s=!1,component:o="div",children:a,dense:l=!1,disableGutters:c=!1,divider:u=!1,focusVisibleClassName:h,selected:f=!1,className:m}=i,g=Ut(i,Kot),y=U.useContext(Gy),_=U.useMemo(()=>({dense:l||y.dense||!1,alignItems:n,disableGutters:c}),[n,y.dense,l,c]),b=U.useRef(null);Sh(()=>{s&&b.current&&b.current.focus()},[s]);const w=Y({},i,{alignItems:n,dense:_.dense,disableGutters:c,divider:u,selected:f}),x=eat(w),S=Js(b,r);return F.jsx(Gy.Provider,{value:_,children:F.jsx(tat,Y({ref:S,href:g.href||g.to,component:(g.href||g.to)&&o==="div"?"button":o,focusVisibleClassName:Pt(x.focusVisible,h),ownerState:w,className:Pt(x.root,m)},g,{classes:x,children:a}))})}),iat=rat;function nat(t){return ii("MuiListItemSecondaryAction",t)}Zr("MuiListItemSecondaryAction",["root","disableGutters"]);const sat=["className"],oat=t=>{const{disableGutters:e,classes:r}=t;return ui({root:["root",e&&"disableGutters"]},nat,r)},aat=Ot("div",{name:"MuiListItemSecondaryAction",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.disableGutters&&e.disableGutters]}})(({ownerState:t})=>Y({position:"absolute",right:16,top:"50%",transform:"translateY(-50%)"},t.disableGutters&&{right:0})),HMe=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiListItemSecondaryAction"}),{className:n}=i,s=Ut(i,sat),o=U.useContext(Gy),a=Y({},i,{disableGutters:o.disableGutters}),l=oat(a);return F.jsx(aat,Y({className:Pt(l.root,n),ownerState:a,ref:r},s))});HMe.muiName="ListItemSecondaryAction";const lat=HMe,cat=["className"],uat=["alignItems","autoFocus","button","children","className","component","components","componentsProps","ContainerComponent","ContainerProps","dense","disabled","disableGutters","disablePadding","divider","focusVisibleClassName","secondaryAction","selected","slotProps","slots"],dat=(t,e)=>{const{ownerState:r}=t;return[e.root,r.dense&&e.dense,r.alignItems==="flex-start"&&e.alignItemsFlexStart,r.divider&&e.divider,!r.disableGutters&&e.gutters,!r.disablePadding&&e.padding,r.button&&e.button,r.hasSecondaryAction&&e.secondaryAction]},hat=t=>{const{alignItems:e,button:r,classes:i,dense:n,disabled:s,disableGutters:o,disablePadding:a,divider:l,hasSecondaryAction:c,selected:u}=t;return ui({root:["root",n&&"dense",!o&&"gutters",!a&&"padding",l&&"divider",s&&"disabled",r&&"button",e==="flex-start"&&"alignItemsFlexStart",c&&"secondaryAction",u&&"selected"],container:["container"]},Xot,i)},pat=Ot("div",{name:"MuiListItem",slot:"Root",overridesResolver:dat})(({theme:t,ownerState:e})=>Y({display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",width:"100%",boxSizing:"border-box",textAlign:"left"},!e.disablePadding&&Y({paddingTop:8,paddingBottom:8},e.dense&&{paddingTop:4,paddingBottom:4},!e.disableGutters&&{paddingLeft:16,paddingRight:16},!!e.secondaryAction&&{paddingRight:48}),!!e.secondaryAction&&{[`& > .${bR.root}`]:{paddingRight:48}},{[`&.${_R.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${_R.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:cn(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${_R.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:cn(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${_R.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},e.alignItems==="flex-start"&&{alignItems:"flex-start"},e.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},e.button&&{transition:t.transitions.create("background-color",{duration:t.transitions.duration.shortest}),"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${_R.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:cn(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:cn(t.palette.primary.main,t.palette.action.selectedOpacity)}}},e.hasSecondaryAction&&{paddingRight:48})),fat=Ot("li",{name:"MuiListItem",slot:"Container",overridesResolver:(t,e)=>e.container})({position:"relative"}),mat=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiListItem"}),{alignItems:n="center",autoFocus:s=!1,button:o=!1,children:a,className:l,component:c,components:u={},componentsProps:h={},ContainerComponent:f="li",ContainerProps:{className:m}={},dense:g=!1,disabled:y=!1,disableGutters:_=!1,disablePadding:b=!1,divider:w=!1,focusVisibleClassName:x,secondaryAction:S,selected:C=!1,slotProps:E={},slots:R={}}=i,P=Ut(i.ContainerProps,cat),D=Ut(i,uat),L=U.useContext(Gy),k=U.useMemo(()=>({dense:g||L.dense||!1,alignItems:n,disableGutters:_}),[n,L.dense,g,_]),V=U.useRef(null);Sh(()=>{s&&V.current&&V.current.focus()},[s]);const W=U.Children.toArray(a),G=W.length&&BL(W[W.length-1],["ListItemSecondaryAction"]),B=Y({},i,{alignItems:n,autoFocus:s,button:o,dense:k.dense,disabled:y,disableGutters:_,disablePadding:b,divider:w,hasSecondaryAction:G,selected:C}),Z=hat(B),M=Js(V,r),$=R.root||u.Root||pat,N=E.root||h.root||{},j=Y({className:Pt(Z.root,N.className,l),disabled:y},D);let J=c||"li";return o&&(j.component=c||"div",j.focusVisibleClassName=Pt(_R.focusVisible,x),J=S_),G?(J=!j.component&&!c?"div":J,f==="li"&&(J==="li"?J="div":j.component==="li"&&(j.component="div")),F.jsx(Gy.Provider,{value:k,children:F.jsxs(fat,Y({as:f,className:Pt(Z.container,m),ref:M,ownerState:B},P,{children:[F.jsx($,Y({},N,!B2($)&&{as:J,ownerState:Y({},B,N.ownerState)},j,{children:W})),W.pop()]}))})):F.jsx(Gy.Provider,{value:k,children:F.jsxs($,Y({},N,{as:J,ref:M},!B2($)&&{ownerState:Y({},B,N.ownerState)},j,{children:[W,S&&F.jsx(lat,{children:S})]}))})}),gat=mat;function yat(t){return ii("MuiListItemIcon",t)}const vat=Zr("MuiListItemIcon",["root","alignItemsFlexStart"]),Jye=vat,_at=["className"],bat=t=>{const{alignItems:e,classes:r}=t;return ui({root:["root",e==="flex-start"&&"alignItemsFlexStart"]},yat,r)},wat=Ot("div",{name:"MuiListItemIcon",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.alignItems==="flex-start"&&e.alignItemsFlexStart]}})(({theme:t,ownerState:e})=>Y({minWidth:56,color:(t.vars||t).palette.action.active,flexShrink:0,display:"inline-flex"},e.alignItems==="flex-start"&&{marginTop:8})),xat=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiListItemIcon"}),{className:n}=i,s=Ut(i,_at),o=U.useContext(Gy),a=Y({},i,{alignItems:o.alignItems}),l=bat(a);return F.jsx(wat,Y({className:Pt(l.root,n),ownerState:a,ref:r},s))}),Sat=xat,Tat=Zr("MuiListItemText",["root","multiline","dense","inset","primary","secondary"]),Kye=Tat,Eat=["actions","autoFocus","autoFocusItem","children","className","disabledItemsFocusable","disableListWrap","onKeyDown","variant"];function NW(t,e,r){return t===e?t.firstChild:e&&e.nextElementSibling?e.nextElementSibling:r?null:t.firstChild}function Qye(t,e,r){return t===e?r?t.firstChild:t.lastChild:e&&e.previousElementSibling?e.previousElementSibling:r?null:t.lastChild}function qMe(t,e){if(e===void 0)return!0;let r=t.innerText;return r===void 0&&(r=t.textContent),r=r.trim().toLowerCase(),r.length===0?!1:e.repeating?r[0]===e.keys[0]:r.indexOf(e.keys.join(""))===0}function xM(t,e,r,i,n,s){let o=!1,a=n(t,e,e?r:!1);for(;a;){if(a===t.firstChild){if(o)return!1;o=!0}const l=i?!1:a.disabled||a.getAttribute("aria-disabled")==="true";if(!a.hasAttribute("tabindex")||!qMe(a,s)||l)a=n(t,a,r);else return a.focus(),!0}return!1}const Cat=U.forwardRef(function(e,r){const{actions:i,autoFocus:n=!1,autoFocusItem:s=!1,children:o,className:a,disabledItemsFocusable:l=!1,disableListWrap:c=!1,onKeyDown:u,variant:h="selectedMenu"}=e,f=Ut(e,Eat),m=U.useRef(null),g=U.useRef({keys:[],repeating:!0,previousKeyMatched:!0,lastTime:null});Sh(()=>{n&&m.current.focus()},[n]),U.useImperativeHandle(i,()=>({adjustStyleForScrollbar:(x,S)=>{const C=!m.current.style.width;if(x.clientHeight<m.current.clientHeight&&C){const E=`${j3e(Ll(x))}px`;m.current.style[S.direction==="rtl"?"paddingLeft":"paddingRight"]=E,m.current.style.width=`calc(100% + ${E})`}return m.current}}),[]);const y=x=>{const S=m.current,C=x.key,E=Ll(S).activeElement;if(C==="ArrowDown")x.preventDefault(),xM(S,E,c,l,NW);else if(C==="ArrowUp")x.preventDefault(),xM(S,E,c,l,Qye);else if(C==="Home")x.preventDefault(),xM(S,null,c,l,NW);else if(C==="End")x.preventDefault(),xM(S,null,c,l,Qye);else if(C.length===1){const R=g.current,P=C.toLowerCase(),D=performance.now();R.keys.length>0&&(D-R.lastTime>500?(R.keys=[],R.repeating=!0,R.previousKeyMatched=!0):R.repeating&&P!==R.keys[0]&&(R.repeating=!1)),R.lastTime=D,R.keys.push(P);const L=E&&!R.repeating&&qMe(E,R);R.previousKeyMatched&&(L||xM(S,E,!1,l,NW,R))?x.preventDefault():R.previousKeyMatched=!1}u&&u(x)},_=Js(m,r);let b=-1;U.Children.forEach(o,(x,S)=>{if(!U.isValidElement(x)){b===S&&(b+=1,b>=o.length&&(b=-1));return}x.props.disabled||(h==="selectedMenu"&&x.props.selected||b===-1)&&(b=S),b===S&&(x.props.disabled||x.props.muiSkipListHighlight||x.type.muiSkipListHighlight)&&(b+=1,b>=o.length&&(b=-1))});const w=U.Children.map(o,(x,S)=>{if(S===b){const C={};return s&&(C.autoFocus=!0),x.props.tabIndex===void 0&&h==="selectedMenu"&&(C.tabIndex=0),U.cloneElement(x,C)}return x});return F.jsx(GMe,Y({role:"menu",ref:_,className:a,onKeyDown:y,tabIndex:n?0:-1},f,{children:w}))}),Rat=Cat;function Oat(t){return ii("MuiPopover",t)}Zr("MuiPopover",["root","paper"]);const Aat=["onEntering"],Pat=["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","className","container","elevation","marginThreshold","open","PaperProps","slots","slotProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"],Mat=["slotProps"];function e0e(t,e){let r=0;return typeof e=="number"?r=e:e==="center"?r=t.height/2:e==="bottom"&&(r=t.height),r}function t0e(t,e){let r=0;return typeof e=="number"?r=e:e==="center"?r=t.width/2:e==="right"&&(r=t.width),r}function r0e(t){return[t.horizontal,t.vertical].map(e=>typeof e=="number"?`${e}px`:e).join(" ")}function FW(t){return typeof t=="function"?t():t}const $at=t=>{const{classes:e}=t;return ui({root:["root"],paper:["paper"]},Oat,e)},Iat=Ot(DMe,{name:"MuiPopover",slot:"Root",overridesResolver:(t,e)=>e.root})({}),WMe=Ot($le,{name:"MuiPopover",slot:"Paper",overridesResolver:(t,e)=>e.paper})({position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}),Lat=U.forwardRef(function(e,r){var i,n,s;const o=ni({props:e,name:"MuiPopover"}),{action:a,anchorEl:l,anchorOrigin:c={vertical:"top",horizontal:"left"},anchorPosition:u,anchorReference:h="anchorEl",children:f,className:m,container:g,elevation:y=8,marginThreshold:_=16,open:b,PaperProps:w={},slots:x,slotProps:S,transformOrigin:C={vertical:"top",horizontal:"left"},TransitionComponent:E=sQ,transitionDuration:R="auto",TransitionProps:{onEntering:P}={}}=o,D=Ut(o.TransitionProps,Aat),L=Ut(o,Pat),k=(i=S==null?void 0:S.paper)!=null?i:w,V=U.useRef(),W=Js(V,k.ref),G=Y({},o,{anchorOrigin:c,anchorReference:h,elevation:y,marginThreshold:_,externalPaperSlotProps:k,transformOrigin:C,TransitionComponent:E,transitionDuration:R,TransitionProps:D}),B=$at(G),Z=U.useCallback(()=>{if(h==="anchorPosition")return u;const $e=FW(l),we=($e&&$e.nodeType===1?$e:Ll(V.current).body).getBoundingClientRect();return{top:we.top+e0e(we,c.vertical),left:we.left+t0e(we,c.horizontal)}},[l,c.horizontal,c.vertical,u,h]),M=U.useCallback($e=>({vertical:e0e($e,C.vertical),horizontal:t0e($e,C.horizontal)}),[C.horizontal,C.vertical]),$=U.useCallback($e=>{const Be={width:$e.offsetWidth,height:$e.offsetHeight},we=M(Be);if(h==="none")return{top:null,left:null,transformOrigin:r0e(we)};const Ie=Z();let je=Ie.top-we.vertical,fe=Ie.left-we.horizontal;const Ae=je+Be.height,gt=fe+Be.width,Re=ef(FW(l)),He=Re.innerHeight-_,Dt=Re.innerWidth-_;if(je<_){const Fe=je-_;je-=Fe,we.vertical+=Fe}else if(Ae>He){const Fe=Ae-He;je-=Fe,we.vertical+=Fe}if(fe<_){const Fe=fe-_;fe-=Fe,we.horizontal+=Fe}else if(gt>Dt){const Fe=gt-Dt;fe-=Fe,we.horizontal+=Fe}return{top:`${Math.round(je)}px`,left:`${Math.round(fe)}px`,transformOrigin:r0e(we)}},[l,h,Z,M,_]),[N,j]=U.useState(b),J=U.useCallback(()=>{const $e=V.current;if(!$e)return;const Be=$($e);Be.top!==null&&($e.style.top=Be.top),Be.left!==null&&($e.style.left=Be.left),$e.style.transformOrigin=Be.transformOrigin,j(!0)},[$]),K=($e,Be)=>{P&&P($e,Be),J()},te=()=>{j(!1)};U.useEffect(()=>{b&&J()}),U.useImperativeHandle(a,()=>b?{updatePosition:()=>{J()}}:null,[b,J]),U.useEffect(()=>{if(!b)return;const $e=V2(()=>{J()}),Be=ef(l);return Be.addEventListener("resize",$e),()=>{$e.clear(),Be.removeEventListener("resize",$e)}},[l,b,J]);let ae=R;R==="auto"&&!E.muiSupportAuto&&(ae=void 0);const be=g||(l?Ll(FW(l)).body:void 0),Ee=(n=x==null?void 0:x.root)!=null?n:Iat,Je=(s=x==null?void 0:x.paper)!=null?s:WMe,ze=b_({elementType:Je,externalSlotProps:Y({},k,{style:N?k.style:Y({},k.style,{opacity:0})}),additionalProps:{elevation:y,ref:W},ownerState:G,className:Pt(B.paper,k==null?void 0:k.className)}),Ge=b_({elementType:Ee,externalSlotProps:(S==null?void 0:S.root)||{},externalForwardedProps:L,additionalProps:{ref:r,slotProps:{backdrop:{invisible:!0}},container:be,open:b},ownerState:G,className:Pt(B.root,m)}),{slotProps:Le}=Ge,de=Ut(Ge,Mat);return F.jsx(Ee,Y({},de,!B2(Ee)&&{slotProps:Le},{children:F.jsx(E,Y({appear:!0,in:b,onEntering:K,onExited:te,timeout:ae},D,{children:F.jsx(Je,Y({},ze,{children:f}))}))}))}),Dat=Lat;function Nat(t){return ii("MuiMenu",t)}Zr("MuiMenu",["root","paper","list"]);const Fat=["onEntering"],kat=["autoFocus","children","disableAutoFocusItem","MenuListProps","onClose","open","PaperProps","PopoverClasses","transitionDuration","TransitionProps","variant"],Uat={vertical:"top",horizontal:"right"},zat={vertical:"top",horizontal:"left"},Vat=t=>{const{classes:e}=t;return ui({root:["root"],paper:["paper"],list:["list"]},Nat,e)},Bat=Ot(Dat,{shouldForwardProp:t=>vf(t)||t==="classes",name:"MuiMenu",slot:"Root",overridesResolver:(t,e)=>e.root})({}),jat=Ot(WMe,{name:"MuiMenu",slot:"Paper",overridesResolver:(t,e)=>e.paper})({maxHeight:"calc(100% - 96px)",WebkitOverflowScrolling:"touch"}),Gat=Ot(Rat,{name:"MuiMenu",slot:"List",overridesResolver:(t,e)=>e.list})({outline:0}),Hat=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiMenu"}),{autoFocus:n=!0,children:s,disableAutoFocusItem:o=!1,MenuListProps:a={},onClose:l,open:c,PaperProps:u={},PopoverClasses:h,transitionDuration:f="auto",TransitionProps:{onEntering:m}={},variant:g="selectedMenu"}=i,y=Ut(i.TransitionProps,Fat),_=Ut(i,kat),b=_f(),w=b.direction==="rtl",x=Y({},i,{autoFocus:n,disableAutoFocusItem:o,MenuListProps:a,onEntering:m,PaperProps:u,transitionDuration:f,TransitionProps:y,variant:g}),S=Vat(x),C=n&&!o&&c,E=U.useRef(null),R=(L,k)=>{E.current&&E.current.adjustStyleForScrollbar(L,b),m&&m(L,k)},P=L=>{L.key==="Tab"&&(L.preventDefault(),l&&l(L,"tabKeyDown"))};let D=-1;return U.Children.map(s,(L,k)=>{U.isValidElement(L)&&(L.props.disabled||(g==="selectedMenu"&&L.props.selected||D===-1)&&(D=k))}),F.jsx(Bat,Y({onClose:l,anchorOrigin:{vertical:"bottom",horizontal:w?"right":"left"},transformOrigin:w?Uat:zat,slots:{paper:jat},slotProps:{paper:Y({},u,{classes:Y({},u.classes,{root:S.paper})})},className:S.root,open:c,ref:r,transitionDuration:f,TransitionProps:Y({onEntering:R},y),ownerState:x},_,{classes:h,children:F.jsx(Gat,Y({onKeyDown:P,actions:E,autoFocus:n&&(D===-1||o),autoFocusItem:C,variant:g},a,{className:Pt(S.list,a.className),children:s}))}))}),qat=Hat;function Wat(t){return ii("MuiMenuItem",t)}const Xat=Zr("MuiMenuItem",["root","focusVisible","dense","disabled","divider","gutters","selected"]),SM=Xat,Yat=["autoFocus","component","dense","divider","disableGutters","focusVisibleClassName","role","tabIndex","className"],Zat=(t,e)=>{const{ownerState:r}=t;return[e.root,r.dense&&e.dense,r.divider&&e.divider,!r.disableGutters&&e.gutters]},Jat=t=>{const{disabled:e,dense:r,divider:i,disableGutters:n,selected:s,classes:o}=t,l=ui({root:["root",r&&"dense",e&&"disabled",!n&&"gutters",i&&"divider",s&&"selected"]},Wat,o);return Y({},o,l)},Kat=Ot(S_,{shouldForwardProp:t=>vf(t)||t==="classes",name:"MuiMenuItem",slot:"Root",overridesResolver:Zat})(({theme:t,ownerState:e})=>Y({},t.typography.body1,{display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",textDecoration:"none",minHeight:48,paddingTop:6,paddingBottom:6,boxSizing:"border-box",whiteSpace:"nowrap"},!e.disableGutters&&{paddingLeft:16,paddingRight:16},e.divider&&{borderBottom:`1px solid ${(t.vars||t).palette.divider}`,backgroundClip:"padding-box"},{"&:hover":{textDecoration:"none",backgroundColor:(t.vars||t).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${SM.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:cn(t.palette.primary.main,t.palette.action.selectedOpacity),[`&.${SM.focusVisible}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.focusOpacity}))`:cn(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.focusOpacity)}},[`&.${SM.selected}:hover`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:cn(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:cn(t.palette.primary.main,t.palette.action.selectedOpacity)}},[`&.${SM.focusVisible}`]:{backgroundColor:(t.vars||t).palette.action.focus},[`&.${SM.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity},[`& + .${Wye.root}`]:{marginTop:t.spacing(1),marginBottom:t.spacing(1)},[`& + .${Wye.inset}`]:{marginLeft:52},[`& .${Kye.root}`]:{marginTop:0,marginBottom:0},[`& .${Kye.inset}`]:{paddingLeft:36},[`& .${Jye.root}`]:{minWidth:36}},!e.dense&&{[t.breakpoints.up("sm")]:{minHeight:"auto"}},e.dense&&Y({minHeight:32,paddingTop:4,paddingBottom:4},t.typography.body2,{[`& .${Jye.root} svg`]:{fontSize:"1.25rem"}}))),Qat=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiMenuItem"}),{autoFocus:n=!1,component:s="li",dense:o=!1,divider:a=!1,disableGutters:l=!1,focusVisibleClassName:c,role:u="menuitem",tabIndex:h,className:f}=i,m=Ut(i,Yat),g=U.useContext(Gy),y=U.useMemo(()=>({dense:o||g.dense||!1,disableGutters:l}),[g.dense,o,l]),_=U.useRef(null);Sh(()=>{n&&_.current&&_.current.focus()},[n]);const b=Y({},i,{dense:y.dense,divider:a,disableGutters:l}),w=Jat(i),x=Js(_,r);let S;return i.disabled||(S=h!==void 0?h:-1),F.jsx(Gy.Provider,{value:y,children:F.jsx(Kat,Y({ref:x,role:u,tabIndex:S,component:s,focusVisibleClassName:Pt(w.focusVisible,c),className:Pt(w.root,f)},m,{ownerState:b,classes:w}))})}),ia=Qat;function elt(t){return ii("MuiNativeSelect",t)}const tlt=Zr("MuiNativeSelect",["root","select","multiple","filled","outlined","standard","disabled","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),Ule=tlt,rlt=["className","disabled","error","IconComponent","inputRef","variant"],ilt=t=>{const{classes:e,variant:r,disabled:i,multiple:n,open:s,error:o}=t,a={select:["select",r,i&&"disabled",n&&"multiple",o&&"error"],icon:["icon",`icon${zt(r)}`,s&&"iconOpen",i&&"disabled"]};return ui(a,elt,e)},XMe=({ownerState:t,theme:e})=>Y({MozAppearance:"none",WebkitAppearance:"none",userSelect:"none",borderRadius:0,cursor:"pointer","&:focus":Y({},e.vars?{backgroundColor:`rgba(${e.vars.palette.common.onBackgroundChannel} / 0.05)`}:{backgroundColor:e.palette.mode==="light"?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)"},{borderRadius:0}),"&::-ms-expand":{display:"none"},[`&.${Ule.disabled}`]:{cursor:"default"},"&[multiple]":{height:"auto"},"&:not([multiple]) option, &:not([multiple]) optgroup":{backgroundColor:(e.vars||e).palette.background.paper},"&&&":{paddingRight:24,minWidth:16}},t.variant==="filled"&&{"&&&":{paddingRight:32}},t.variant==="outlined"&&{borderRadius:(e.vars||e).shape.borderRadius,"&:focus":{borderRadius:(e.vars||e).shape.borderRadius},"&&&":{paddingRight:32}}),nlt=Ot("select",{name:"MuiNativeSelect",slot:"Select",shouldForwardProp:vf,overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.select,e[r.variant],r.error&&e.error,{[`&.${Ule.multiple}`]:e.multiple}]}})(XMe),YMe=({ownerState:t,theme:e})=>Y({position:"absolute",right:0,top:"calc(50% - .5em)",pointerEvents:"none",color:(e.vars||e).palette.action.active,[`&.${Ule.disabled}`]:{color:(e.vars||e).palette.action.disabled}},t.open&&{transform:"rotate(180deg)"},t.variant==="filled"&&{right:7},t.variant==="outlined"&&{right:7}),slt=Ot("svg",{name:"MuiNativeSelect",slot:"Icon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.icon,r.variant&&e[`icon${zt(r.variant)}`],r.open&&e.iconOpen]}})(YMe),olt=U.forwardRef(function(e,r){const{className:i,disabled:n,error:s,IconComponent:o,inputRef:a,variant:l="standard"}=e,c=Ut(e,rlt),u=Y({},e,{disabled:n,variant:l,error:s}),h=ilt(u);return F.jsxs(U.Fragment,{children:[F.jsx(nlt,Y({ownerState:u,className:Pt(h.select,i),disabled:n,ref:a||r},c)),e.multiple?null:F.jsx(slt,{as:o,ownerState:u,className:h.icon})]})}),alt=olt;var i0e;const llt=["children","classes","className","label","notched"],clt=Ot("fieldset")({textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%"}),ult=Ot("legend")(({ownerState:t,theme:e})=>Y({float:"unset",width:"auto",overflow:"hidden"},!t.withLabel&&{padding:0,lineHeight:"11px",transition:e.transitions.create("width",{duration:150,easing:e.transitions.easing.easeOut})},t.withLabel&&Y({display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:e.transitions.create("max-width",{duration:50,easing:e.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}},t.notched&&{maxWidth:"100%",transition:e.transitions.create("max-width",{duration:100,easing:e.transitions.easing.easeOut,delay:50})})));function dlt(t){const{className:e,label:r,notched:i}=t,n=Ut(t,llt),s=r!=null&&r!=="",o=Y({},t,{notched:i,withLabel:s});return F.jsx(clt,Y({"aria-hidden":!0,className:e,ownerState:o},n,{children:F.jsx(ult,{ownerState:o,children:s?F.jsx("span",{children:r}):i0e||(i0e=F.jsx("span",{className:"notranslate",children:""}))})}))}const hlt=["components","fullWidth","inputComponent","label","multiline","notched","slots","type"],plt=t=>{const{classes:e}=t,i=ui({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},Jnt,e);return Y({},e,i)},flt=Ot(i7,{shouldForwardProp:t=>vf(t)||t==="classes",name:"MuiOutlinedInput",slot:"Root",overridesResolver:t7})(({theme:t,ownerState:e})=>{const r=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return Y({position:"relative",borderRadius:(t.vars||t).shape.borderRadius,[`&:hover .${f1.notchedOutline}`]:{borderColor:(t.vars||t).palette.text.primary},"@media (hover: none)":{[`&:hover .${f1.notchedOutline}`]:{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:r}},[`&.${f1.focused} .${f1.notchedOutline}`]:{borderColor:(t.vars||t).palette[e.color].main,borderWidth:2},[`&.${f1.error} .${f1.notchedOutline}`]:{borderColor:(t.vars||t).palette.error.main},[`&.${f1.disabled} .${f1.notchedOutline}`]:{borderColor:(t.vars||t).palette.action.disabled}},e.startAdornment&&{paddingLeft:14},e.endAdornment&&{paddingRight:14},e.multiline&&Y({padding:"16.5px 14px"},e.size==="small"&&{padding:"8.5px 14px"}))}),mlt=Ot(dlt,{name:"MuiOutlinedInput",slot:"NotchedOutline",overridesResolver:(t,e)=>e.notchedOutline})(({theme:t})=>{const e=t.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{borderColor:t.vars?`rgba(${t.vars.palette.common.onBackgroundChannel} / 0.23)`:e}}),glt=Ot(n7,{name:"MuiOutlinedInput",slot:"Input",overridesResolver:r7})(({theme:t,ownerState:e})=>Y({padding:"16.5px 14px"},!t.vars&&{"&:-webkit-autofill":{WebkitBoxShadow:t.palette.mode==="light"?null:"0 0 0 100px #266798 inset",WebkitTextFillColor:t.palette.mode==="light"?null:"#fff",caretColor:t.palette.mode==="light"?null:"#fff",borderRadius:"inherit"}},t.vars&&{"&:-webkit-autofill":{borderRadius:"inherit"},[t.getColorSchemeSelector("dark")]:{"&:-webkit-autofill":{WebkitBoxShadow:"0 0 0 100px #266798 inset",WebkitTextFillColor:"#fff",caretColor:"#fff"}}},e.size==="small"&&{padding:"8.5px 14px"},e.multiline&&{padding:0},e.startAdornment&&{paddingLeft:0},e.endAdornment&&{paddingRight:0})),ZMe=U.forwardRef(function(e,r){var i,n,s,o,a;const l=ni({props:e,name:"MuiOutlinedInput"}),{components:c={},fullWidth:u=!1,inputComponent:h="input",label:f,multiline:m=!1,notched:g,slots:y={},type:_="text"}=l,b=Ut(l,hlt),w=plt(l),x=v3(),S=y3({props:l,muiFormControl:x,states:["color","disabled","error","focused","hiddenLabel","size","required"]}),C=Y({},l,{color:S.color||"primary",disabled:S.disabled,error:S.error,focused:S.focused,formControl:x,fullWidth:u,hiddenLabel:S.hiddenLabel,multiline:m,size:S.size,type:_}),E=(i=(n=y.root)!=null?n:c.Root)!=null?i:flt,R=(s=(o=y.input)!=null?o:c.Input)!=null?s:glt;return F.jsx(kle,Y({slots:{root:E,input:R},renderSuffix:P=>F.jsx(mlt,{ownerState:C,className:w.notchedOutline,label:f!=null&&f!==""&&S.required?a||(a=F.jsxs(U.Fragment,{children:[f,"","*"]})):f,notched:typeof g<"u"?g:!!(P.startAdornment||P.filled||P.focused)}),fullWidth:u,inputComponent:h,multiline:m,ref:r,type:_},b,{classes:Y({},w,{notchedOutline:null})}))});ZMe.muiName="Input";const _3=ZMe;function ylt(t){return ii("MuiSelect",t)}const vlt=Zr("MuiSelect",["select","multiple","filled","outlined","standard","disabled","focused","icon","iconOpen","iconFilled","iconOutlined","iconStandard","nativeInput","error"]),TM=vlt;var n0e;const _lt=["aria-describedby","aria-label","autoFocus","autoWidth","children","className","defaultOpen","defaultValue","disabled","displayEmpty","error","IconComponent","inputRef","labelId","MenuProps","multiple","name","onBlur","onChange","onClose","onFocus","onOpen","open","readOnly","renderValue","SelectDisplayProps","tabIndex","type","value","variant"],blt=Ot("div",{name:"MuiSelect",slot:"Select",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`&.${TM.select}`]:e.select},{[`&.${TM.select}`]:e[r.variant]},{[`&.${TM.error}`]:e.error},{[`&.${TM.multiple}`]:e.multiple}]}})(XMe,{[`&.${TM.select}`]:{height:"auto",minHeight:"1.4375em",textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"}}),wlt=Ot("svg",{name:"MuiSelect",slot:"Icon",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.icon,r.variant&&e[`icon${zt(r.variant)}`],r.open&&e.iconOpen]}})(YMe),xlt=Ot("input",{shouldForwardProp:t=>mit(t)&&t!=="classes",name:"MuiSelect",slot:"NativeInput",overridesResolver:(t,e)=>e.nativeInput})({bottom:0,left:0,position:"absolute",opacity:0,pointerEvents:"none",width:"100%",boxSizing:"border-box"});function s0e(t,e){return typeof e=="object"&&e!==null?t===e:String(t)===String(e)}function Slt(t){return t==null||typeof t=="string"&&!t.trim()}const Tlt=t=>{const{classes:e,variant:r,disabled:i,multiple:n,open:s,error:o}=t,a={select:["select",r,i&&"disabled",n&&"multiple",o&&"error"],icon:["icon",`icon${zt(r)}`,s&&"iconOpen",i&&"disabled"],nativeInput:["nativeInput"]};return ui(a,ylt,e)},Elt=U.forwardRef(function(e,r){const{"aria-describedby":i,"aria-label":n,autoFocus:s,autoWidth:o,children:a,className:l,defaultOpen:c,defaultValue:u,disabled:h,displayEmpty:f,error:m=!1,IconComponent:g,inputRef:y,labelId:_,MenuProps:b={},multiple:w,name:x,onBlur:S,onChange:C,onClose:E,onFocus:R,onOpen:P,open:D,readOnly:L,renderValue:k,SelectDisplayProps:V={},tabIndex:W,value:G,variant:B="standard"}=e,Z=Ut(e,_lt),[M,$]=rV({controlled:G,default:u,name:"Select"}),[N,j]=rV({controlled:D,default:c,name:"Select"}),J=U.useRef(null),K=U.useRef(null),[te,ae]=U.useState(null),{current:be}=U.useRef(D!=null),[Ee,Je]=U.useState(),ze=Js(r,y),Ge=U.useCallback(Xe=>{K.current=Xe,Xe&&ae(Xe)},[]),Le=te==null?void 0:te.parentNode;U.useImperativeHandle(ze,()=>({focus:()=>{K.current.focus()},node:J.current,value:M}),[M]),U.useEffect(()=>{c&&N&&te&&!be&&(Je(o?null:Le.clientWidth),K.current.focus())},[te,o]),U.useEffect(()=>{s&&K.current.focus()},[s]),U.useEffect(()=>{if(!_)return;const Xe=Ll(K.current).getElementById(_);if(Xe){const it=()=>{getSelection().isCollapsed&&K.current.focus()};return Xe.addEventListener("click",it),()=>{Xe.removeEventListener("click",it)}}},[_]);const de=(Xe,it)=>{Xe?P&&P(it):E&&E(it),be||(Je(o?null:Le.clientWidth),j(Xe))},$e=Xe=>{Xe.button===0&&(Xe.preventDefault(),K.current.focus(),de(!0,Xe))},Be=Xe=>{de(!1,Xe)},we=U.Children.toArray(a),Ie=Xe=>{const it=we.find(Oe=>Oe.props.value===Xe.target.value);it!==void 0&&($(it.props.value),C&&C(Xe,it))},je=Xe=>it=>{let Oe;if(it.currentTarget.hasAttribute("tabindex")){if(w){Oe=Array.isArray(M)?M.slice():[];const Ze=M.indexOf(Xe.props.value);Ze===-1?Oe.push(Xe.props.value):Oe.splice(Ze,1)}else Oe=Xe.props.value;if(Xe.props.onClick&&Xe.props.onClick(it),M!==Oe&&($(Oe),C)){const Ze=it.nativeEvent||it,At=new Ze.constructor(Ze.type,Ze);Object.defineProperty(At,"target",{writable:!0,value:{value:Oe,name:x}}),C(At,Xe)}w||de(!1,it)}},fe=Xe=>{L||[" ","ArrowUp","ArrowDown","Enter"].indexOf(Xe.key)!==-1&&(Xe.preventDefault(),de(!0,Xe))},Ae=te!==null&&N,gt=Xe=>{!Ae&&S&&(Object.defineProperty(Xe,"target",{writable:!0,value:{value:M,name:x}}),S(Xe))};delete Z["aria-invalid"];let Re,He;const Dt=[];let Fe=!1;(aV({value:M})||f)&&(k?Re=k(M):Fe=!0);const nt=we.map(Xe=>{if(!U.isValidElement(Xe))return null;let it;if(w){if(!Array.isArray(M))throw new Error(Hw(2));it=M.some(Oe=>s0e(Oe,Xe.props.value)),it&&Fe&&Dt.push(Xe.props.children)}else it=s0e(M,Xe.props.value),it&&Fe&&(He=Xe.props.children);return U.cloneElement(Xe,{"aria-selected":it?"true":"false",onClick:je(Xe),onKeyUp:Oe=>{Oe.key===" "&&Oe.preventDefault(),Xe.props.onKeyUp&&Xe.props.onKeyUp(Oe)},role:"option",selected:it,value:void 0,"data-value":Xe.props.value})});Fe&&(w?Dt.length===0?Re=null:Re=Dt.reduce((Xe,it,Oe)=>(Xe.push(it),Oe<Dt.length-1&&Xe.push(", "),Xe),[]):Re=He);let Ke=Ee;!o&&be&&te&&(Ke=Le.clientWidth);let mt;typeof W<"u"?mt=W:mt=h?null:0;const wt=V.id||(x?`mui-component-select-${x}`:void 0),xt=Y({},e,{variant:B,value:M,open:Ae,error:m}),st=Tlt(xt);return F.jsxs(U.Fragment,{children:[F.jsx(blt,Y({ref:Ge,tabIndex:mt,role:"button","aria-disabled":h?"true":void 0,"aria-expanded":Ae?"true":"false","aria-haspopup":"listbox","aria-label":n,"aria-labelledby":[_,wt].filter(Boolean).join(" ")||void 0,"aria-describedby":i,onKeyDown:fe,onMouseDown:h||L?null:$e,onBlur:gt,onFocus:R},V,{ownerState:xt,className:Pt(V.className,st.select,l),id:wt,children:Slt(Re)?n0e||(n0e=F.jsx("span",{className:"notranslate",children:""})):Re})),F.jsx(xlt,Y({"aria-invalid":m,value:Array.isArray(M)?M.join(","):M,name:x,ref:J,"aria-hidden":!0,onChange:Ie,tabIndex:-1,disabled:h,className:st.nativeInput,autoFocus:s,ownerState:xt},Z)),F.jsx(wlt,{as:g,className:st.icon,ownerState:xt}),F.jsx(qat,Y({id:`menu-${x||""}`,anchorEl:Le,open:Ae,onClose:Be,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},b,{MenuListProps:Y({"aria-labelledby":_,role:"listbox",disableListWrap:!0},b.MenuListProps),PaperProps:Y({},b.PaperProps,{style:Y({minWidth:Ke},b.PaperProps!=null?b.PaperProps.style:null)}),children:nt}))]})}),Clt=Elt,Rlt=["autoWidth","children","classes","className","defaultOpen","displayEmpty","IconComponent","id","input","inputProps","label","labelId","MenuProps","multiple","native","onClose","onOpen","open","renderValue","SelectDisplayProps","variant"],Olt=t=>{const{classes:e}=t;return e},zle={name:"MuiSelect",overridesResolver:(t,e)=>e.root,shouldForwardProp:t=>vf(t)&&t!=="variant",slot:"Root"},Alt=Ot(jMe,zle)(""),Plt=Ot(_3,zle)(""),Mlt=Ot(UMe,zle)(""),JMe=U.forwardRef(function(e,r){const i=ni({name:"MuiSelect",props:e}),{autoWidth:n=!1,children:s,classes:o={},className:a,defaultOpen:l=!1,displayEmpty:c=!1,IconComponent:u=tst,id:h,input:f,inputProps:m,label:g,labelId:y,MenuProps:_,multiple:b=!1,native:w=!1,onClose:x,onOpen:S,open:C,renderValue:E,SelectDisplayProps:R,variant:P="outlined"}=i,D=Ut(i,Rlt),L=w?alt:Clt,k=v3(),V=y3({props:i,muiFormControl:k,states:["variant","error"]}),W=V.variant||P,G=Y({},i,{variant:W,classes:o}),B=Olt(G),Z=f||{standard:F.jsx(Alt,{ownerState:G}),outlined:F.jsx(Plt,{label:g,ownerState:G}),filled:F.jsx(Mlt,{ownerState:G})}[W],M=Js(r,Z.ref);return F.jsx(U.Fragment,{children:U.cloneElement(Z,Y({inputComponent:L,inputProps:Y({children:s,error:V.error,IconComponent:u,variant:W,type:void 0,multiple:b},w?{id:h}:{autoWidth:n,defaultOpen:l,displayEmpty:c,labelId:y,MenuProps:_,onClose:x,onOpen:S,open:C,renderValue:E,SelectDisplayProps:Y({id:h},R)},m,{classes:m?Gp(B,m.classes):B},f?f.props.inputProps:{})},b&&w&&W==="outlined"?{notched:!0}:{},{ref:M,className:Pt(Z.props.className,a)},!f&&{variant:W},D))})});JMe.muiName="Select";const Ly=JMe;function $lt(t){return ii("MuiTooltip",t)}const Ilt=Zr("MuiTooltip",["popper","popperInteractive","popperArrow","popperClose","tooltip","tooltipArrow","touch","tooltipPlacementLeft","tooltipPlacementRight","tooltipPlacementTop","tooltipPlacementBottom","arrow"]),aw=Ilt,Llt=["arrow","children","classes","components","componentsProps","describeChild","disableFocusListener","disableHoverListener","disableInteractive","disableTouchListener","enterDelay","enterNextDelay","enterTouchDelay","followCursor","id","leaveDelay","leaveTouchDelay","onClose","onOpen","open","placement","PopperComponent","PopperProps","slotProps","slots","title","TransitionComponent","TransitionProps"];function Dlt(t){return Math.round(t*1e5)/1e5}const Nlt=t=>{const{classes:e,disableInteractive:r,arrow:i,touch:n,placement:s}=t,o={popper:["popper",!r&&"popperInteractive",i&&"popperArrow"],tooltip:["tooltip",i&&"tooltipArrow",n&&"touch",`tooltipPlacement${zt(s.split("-")[0])}`],arrow:["arrow"]};return ui(o,$lt,e)},Flt=Ot(MMe,{name:"MuiTooltip",slot:"Popper",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.popper,!r.disableInteractive&&e.popperInteractive,r.arrow&&e.popperArrow,!r.open&&e.popperClose]}})(({theme:t,ownerState:e,open:r})=>Y({zIndex:(t.vars||t).zIndex.tooltip,pointerEvents:"none"},!e.disableInteractive&&{pointerEvents:"auto"},!r&&{pointerEvents:"none"},e.arrow&&{[`&[data-popper-placement*="bottom"] .${aw.arrow}`]:{top:0,marginTop:"-0.71em","&::before":{transformOrigin:"0 100%"}},[`&[data-popper-placement*="top"] .${aw.arrow}`]:{bottom:0,marginBottom:"-0.71em","&::before":{transformOrigin:"100% 0"}},[`&[data-popper-placement*="right"] .${aw.arrow}`]:Y({},e.isRtl?{right:0,marginRight:"-0.71em"}:{left:0,marginLeft:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"100% 100%"}}),[`&[data-popper-placement*="left"] .${aw.arrow}`]:Y({},e.isRtl?{left:0,marginLeft:"-0.71em"}:{right:0,marginRight:"-0.71em"},{height:"1em",width:"0.71em","&::before":{transformOrigin:"0 0"}})})),klt=Ot("div",{name:"MuiTooltip",slot:"Tooltip",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.tooltip,r.touch&&e.touch,r.arrow&&e.tooltipArrow,e[`tooltipPlacement${zt(r.placement.split("-")[0])}`]]}})(({theme:t,ownerState:e})=>Y({backgroundColor:t.vars?t.vars.palette.Tooltip.bg:cn(t.palette.grey[700],.92),borderRadius:(t.vars||t).shape.borderRadius,color:(t.vars||t).palette.common.white,fontFamily:t.typography.fontFamily,padding:"4px 8px",fontSize:t.typography.pxToRem(11),maxWidth:300,margin:2,wordWrap:"break-word",fontWeight:t.typography.fontWeightMedium},e.arrow&&{position:"relative",margin:0},e.touch&&{padding:"8px 16px",fontSize:t.typography.pxToRem(14),lineHeight:`${Dlt(16/14)}em`,fontWeight:t.typography.fontWeightRegular},{[`.${aw.popper}[data-popper-placement*="left"] &`]:Y({transformOrigin:"right center"},e.isRtl?Y({marginLeft:"14px"},e.touch&&{marginLeft:"24px"}):Y({marginRight:"14px"},e.touch&&{marginRight:"24px"})),[`.${aw.popper}[data-popper-placement*="right"] &`]:Y({transformOrigin:"left center"},e.isRtl?Y({marginRight:"14px"},e.touch&&{marginRight:"24px"}):Y({marginLeft:"14px"},e.touch&&{marginLeft:"24px"})),[`.${aw.popper}[data-popper-placement*="top"] &`]:Y({transformOrigin:"center bottom",marginBottom:"14px"},e.touch&&{marginBottom:"24px"}),[`.${aw.popper}[data-popper-placement*="bottom"] &`]:Y({transformOrigin:"center top",marginTop:"14px"},e.touch&&{marginTop:"24px"})})),Ult=Ot("span",{name:"MuiTooltip",slot:"Arrow",overridesResolver:(t,e)=>e.arrow})(({theme:t})=>({overflow:"hidden",position:"absolute",width:"1em",height:"0.71em",boxSizing:"border-box",color:t.vars?t.vars.palette.Tooltip.bg:cn(t.palette.grey[700],.9),"&::before":{content:'""',margin:"auto",display:"block",width:"100%",height:"100%",backgroundColor:"currentColor",transform:"rotate(45deg)"}}));let A5=!1,kW=null,EM={x:0,y:0};function P5(t,e){return r=>{e&&e(r),t(r)}}const zlt=U.forwardRef(function(e,r){var i,n,s,o,a,l,c,u,h,f,m,g,y,_,b,w,x,S,C;const E=ni({props:e,name:"MuiTooltip"}),{arrow:R=!1,children:P,components:D={},componentsProps:L={},describeChild:k=!1,disableFocusListener:V=!1,disableHoverListener:W=!1,disableInteractive:G=!1,disableTouchListener:B=!1,enterDelay:Z=100,enterNextDelay:M=0,enterTouchDelay:$=700,followCursor:N=!1,id:j,leaveDelay:J=0,leaveTouchDelay:K=1500,onClose:te,onOpen:ae,open:be,placement:Ee="bottom",PopperComponent:Je,PopperProps:ze={},slotProps:Ge={},slots:Le={},title:de,TransitionComponent:$e=sQ,TransitionProps:Be}=E,we=Ut(E,Llt),Ie=U.isValidElement(P)?P:F.jsx("span",{children:P}),je=_f(),fe=je.direction==="rtl",[Ae,gt]=U.useState(),[Re,He]=U.useState(null),Dt=U.useRef(!1),Fe=G||N,nt=U.useRef(),Ke=U.useRef(),mt=U.useRef(),wt=U.useRef(),[xt,st]=rV({controlled:be,default:!1,name:"Tooltip",state:"open"});let Xe=xt;const it=sle(j),Oe=U.useRef(),Ze=U.useCallback(()=>{Oe.current!==void 0&&(document.body.style.WebkitUserSelect=Oe.current,Oe.current=void 0),clearTimeout(wt.current)},[]);U.useEffect(()=>()=>{clearTimeout(nt.current),clearTimeout(Ke.current),clearTimeout(mt.current),Ze()},[Ze]);const At=Ar=>{clearTimeout(kW),A5=!0,st(!0),ae&&!Xe&&ae(Ar)},_t=$m(Ar=>{clearTimeout(kW),kW=setTimeout(()=>{A5=!1},800+J),st(!1),te&&Xe&&te(Ar),clearTimeout(nt.current),nt.current=setTimeout(()=>{Dt.current=!1},je.transitions.duration.shortest)}),cr=Ar=>{Dt.current&&Ar.type!=="touchstart"||(Ae&&Ae.removeAttribute("title"),clearTimeout(Ke.current),clearTimeout(mt.current),Z||A5&&M?Ke.current=setTimeout(()=>{At(Ar)},A5?M:Z):At(Ar))},pr=Ar=>{clearTimeout(Ke.current),clearTimeout(mt.current),mt.current=setTimeout(()=>{_t(Ar)},J)},{isFocusVisibleRef:kr,onBlur:Gr,onFocus:Ir,ref:_i}=ole(),[,Wi]=U.useState(!1),Qs=Ar=>{Gr(Ar),kr.current===!1&&(Wi(!1),pr(Ar))},eo=Ar=>{Ae||gt(Ar.currentTarget),Ir(Ar),kr.current===!0&&(Wi(!0),cr(Ar))},to=Ar=>{Dt.current=!0;const so=Ie.props;so.onTouchStart&&so.onTouchStart(Ar)},ro=cr,tn=pr,rn=Ar=>{to(Ar),clearTimeout(mt.current),clearTimeout(nt.current),Ze(),Oe.current=document.body.style.WebkitUserSelect,document.body.style.WebkitUserSelect="none",wt.current=setTimeout(()=>{document.body.style.WebkitUserSelect=Oe.current,cr(Ar)},$)},pi=Ar=>{Ie.props.onTouchEnd&&Ie.props.onTouchEnd(Ar),Ze(),clearTimeout(mt.current),mt.current=setTimeout(()=>{_t(Ar)},K)};U.useEffect(()=>{if(!Xe)return;function Ar(so){(so.key==="Escape"||so.key==="Esc")&&_t(so)}return document.addEventListener("keydown",Ar),()=>{document.removeEventListener("keydown",Ar)}},[_t,Xe]);const io=Js(Ie.ref,_i,gt,r);!de&&de!==0&&(Xe=!1);const no=U.useRef(),za=Ar=>{const so=Ie.props;so.onMouseMove&&so.onMouseMove(Ar),EM={x:Ar.clientX,y:Ar.clientY},no.current&&no.current.update()},ue={},bi=typeof de=="string";k?(ue.title=!Xe&&bi&&!W?de:null,ue["aria-describedby"]=Xe?it:null):(ue["aria-label"]=bi?de:null,ue["aria-labelledby"]=Xe&&!bi?it:null);const zs=Y({},ue,we,Ie.props,{className:Pt(we.className,Ie.props.className),onTouchStart:to,ref:io},N?{onMouseMove:za}:{}),Jn={};B||(zs.onTouchStart=rn,zs.onTouchEnd=pi),W||(zs.onMouseOver=P5(ro,zs.onMouseOver),zs.onMouseLeave=P5(tn,zs.onMouseLeave),Fe||(Jn.onMouseOver=ro,Jn.onMouseLeave=tn)),V||(zs.onFocus=P5(eo,zs.onFocus),zs.onBlur=P5(Qs,zs.onBlur),Fe||(Jn.onFocus=eo,Jn.onBlur=Qs));const Pd=U.useMemo(()=>{var Ar;let so=[{name:"arrow",enabled:!!Re,options:{element:Re,padding:4}}];return(Ar=ze.popperOptions)!=null&&Ar.modifiers&&(so=so.concat(ze.popperOptions.modifiers)),Y({},ze.popperOptions,{modifiers:so})},[Re,ze]),yt=Y({},E,{isRtl:fe,arrow:R,disableInteractive:Fe,placement:Ee,PopperComponentProp:Je,touch:Dt.current}),Va=Nlt(yt),Vs=(i=(n=Le.popper)!=null?n:D.Popper)!=null?i:Flt,bg=(s=(o=(a=Le.transition)!=null?a:D.Transition)!=null?o:$e)!=null?s:sQ,wg=(l=(c=Le.tooltip)!=null?c:D.Tooltip)!=null?l:klt,Ba=(u=(h=Le.arrow)!=null?h:D.Arrow)!=null?u:Ult,Ef=W$(Vs,Y({},ze,(f=Ge.popper)!=null?f:L.popper,{className:Pt(Va.popper,ze==null?void 0:ze.className,(m=(g=Ge.popper)!=null?g:L.popper)==null?void 0:m.className)}),yt),$0=W$(bg,Y({},Be,(y=Ge.transition)!=null?y:L.transition),yt),gr=W$(wg,Y({},(_=Ge.tooltip)!=null?_:L.tooltip,{className:Pt(Va.tooltip,(b=(w=Ge.tooltip)!=null?w:L.tooltip)==null?void 0:b.className)}),yt),xg=W$(Ba,Y({},(x=Ge.arrow)!=null?x:L.arrow,{className:Pt(Va.arrow,(S=(C=Ge.arrow)!=null?C:L.arrow)==null?void 0:S.className)}),yt);return F.jsxs(U.Fragment,{children:[U.cloneElement(Ie,zs),F.jsx(Vs,Y({as:Je??MMe,placement:Ee,anchorEl:N?{getBoundingClientRect:()=>({top:EM.y,left:EM.x,right:EM.x,bottom:EM.y,width:0,height:0})}:Ae,popperRef:no,open:Ae?Xe:!1,id:it,transition:!0},Jn,Ef,{popperOptions:Pd,children:({TransitionProps:Ar})=>F.jsx(bg,Y({timeout:je.transitions.duration.shorter},Ar,$0,{children:F.jsxs(wg,Y({},gr,{children:[de,R?F.jsx(Ba,Y({},xg,{ref:He})):null]}))}))}))]})}),Vlt=zlt;function Blt(t){return ii("MuiTab",t)}const jlt=Zr("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper"]),Ux=jlt,Glt=["className","disabled","disableFocusRipple","fullWidth","icon","iconPosition","indicator","label","onChange","onClick","onFocus","selected","selectionFollowsFocus","textColor","value","wrapped"],Hlt=t=>{const{classes:e,textColor:r,fullWidth:i,wrapped:n,icon:s,label:o,selected:a,disabled:l}=t,c={root:["root",s&&o&&"labelIcon",`textColor${zt(r)}`,i&&"fullWidth",n&&"wrapped",a&&"selected",l&&"disabled"],iconWrapper:["iconWrapper"]};return ui(c,Blt,e)},qlt=Ot(S_,{name:"MuiTab",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.label&&r.icon&&e.labelIcon,e[`textColor${zt(r.textColor)}`],r.fullWidth&&e.fullWidth,r.wrapped&&e.wrapped]}})(({theme:t,ownerState:e})=>Y({},t.typography.button,{maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center"},e.label&&{flexDirection:e.iconPosition==="top"||e.iconPosition==="bottom"?"column":"row"},{lineHeight:1.25},e.icon&&e.label&&{minHeight:72,paddingTop:9,paddingBottom:9,[`& > .${Ux.iconWrapper}`]:Y({},e.iconPosition==="top"&&{marginBottom:6},e.iconPosition==="bottom"&&{marginTop:6},e.iconPosition==="start"&&{marginRight:t.spacing(1)},e.iconPosition==="end"&&{marginLeft:t.spacing(1)})},e.textColor==="inherit"&&{color:"inherit",opacity:.6,[`&.${Ux.selected}`]:{opacity:1},[`&.${Ux.disabled}`]:{opacity:(t.vars||t).palette.action.disabledOpacity}},e.textColor==="primary"&&{color:(t.vars||t).palette.text.secondary,[`&.${Ux.selected}`]:{color:(t.vars||t).palette.primary.main},[`&.${Ux.disabled}`]:{color:(t.vars||t).palette.text.disabled}},e.textColor==="secondary"&&{color:(t.vars||t).palette.text.secondary,[`&.${Ux.selected}`]:{color:(t.vars||t).palette.secondary.main},[`&.${Ux.disabled}`]:{color:(t.vars||t).palette.text.disabled}},e.fullWidth&&{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"},e.wrapped&&{fontSize:t.typography.pxToRem(12)})),Wlt=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiTab"}),{className:n,disabled:s=!1,disableFocusRipple:o=!1,fullWidth:a,icon:l,iconPosition:c="top",indicator:u,label:h,onChange:f,onClick:m,onFocus:g,selected:y,selectionFollowsFocus:_,textColor:b="inherit",value:w,wrapped:x=!1}=i,S=Ut(i,Glt),C=Y({},i,{disabled:s,disableFocusRipple:o,selected:y,icon:!!l,iconPosition:c,label:!!h,fullWidth:a,textColor:b,wrapped:x}),E=Hlt(C),R=l&&h&&U.isValidElement(l)?U.cloneElement(l,{className:Pt(E.iconWrapper,l.props.className)}):l,P=L=>{!y&&f&&f(L,w),m&&m(L)},D=L=>{_&&!y&&f&&f(L,w),g&&g(L)};return F.jsxs(qlt,Y({focusRipple:!o,className:Pt(E.root,n),ref:r,role:"tab","aria-selected":y,disabled:s,onClick:P,onFocus:D,ownerState:C,tabIndex:y?0:-1},S,{children:[c==="top"||c==="start"?F.jsxs(U.Fragment,{children:[R,h]}):F.jsxs(U.Fragment,{children:[h,R]}),u]}))}),zx=Wlt;function Xlt(t){return ii("MuiToolbar",t)}Zr("MuiToolbar",["root","gutters","regular","dense"]);const Ylt=["className","component","disableGutters","variant"],Zlt=t=>{const{classes:e,disableGutters:r,variant:i}=t;return ui({root:["root",!r&&"gutters",i]},Xlt,e)},Jlt=Ot("div",{name:"MuiToolbar",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,!r.disableGutters&&e.gutters,e[r.variant]]}})(({theme:t,ownerState:e})=>Y({position:"relative",display:"flex",alignItems:"center"},!e.disableGutters&&{paddingLeft:t.spacing(2),paddingRight:t.spacing(2),[t.breakpoints.up("sm")]:{paddingLeft:t.spacing(3),paddingRight:t.spacing(3)}},e.variant==="dense"&&{minHeight:48}),({theme:t,ownerState:e})=>e.variant==="regular"&&t.mixins.toolbar),Klt=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiToolbar"}),{className:n,component:s="div",disableGutters:o=!1,variant:a="regular"}=i,l=Ut(i,Ylt),c=Y({},i,{component:s,disableGutters:o,variant:a}),u=Zlt(c);return F.jsx(Jlt,Y({as:s,className:Pt(u.root,n),ref:r,ownerState:c},l))}),Qlt=Klt,ect=I4(F.jsx("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"}),"KeyboardArrowLeft"),tct=I4(F.jsx("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}),"KeyboardArrowRight");function rct(t){return(1+Math.sin(Math.PI*t-Math.PI/2))/2}function ict(t,e,r,i={},n=()=>{}){const{ease:s=rct,duration:o=300}=i;let a=null;const l=e[t];let c=!1;const u=()=>{c=!0},h=f=>{if(c){n(new Error("Animation cancelled"));return}a===null&&(a=f);const m=Math.min(1,(f-a)/o);if(e[t]=s(m)*(r-l)+l,m>=1){requestAnimationFrame(()=>{n(null)});return}requestAnimationFrame(h)};return l===r?(n(new Error("Element already at target position")),u):(requestAnimationFrame(h),u)}const nct=["onChange"],sct={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};function oct(t){const{onChange:e}=t,r=Ut(t,nct),i=U.useRef(),n=U.useRef(null),s=()=>{i.current=n.current.offsetHeight-n.current.clientHeight};return Sh(()=>{const o=V2(()=>{const l=i.current;s(),l!==i.current&&e(i.current)}),a=ef(n.current);return a.addEventListener("resize",o),()=>{o.clear(),a.removeEventListener("resize",o)}},[e]),U.useEffect(()=>{s(),e(i.current)},[e]),F.jsx("div",Y({style:sct,ref:n},r))}function act(t){return ii("MuiTabScrollButton",t)}const lct=Zr("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),cct=lct,uct=["className","slots","slotProps","direction","orientation","disabled"],dct=t=>{const{classes:e,orientation:r,disabled:i}=t;return ui({root:["root",r,i&&"disabled"]},act,e)},hct=Ot(S_,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.root,r.orientation&&e[r.orientation]]}})(({ownerState:t})=>Y({width:40,flexShrink:0,opacity:.8,[`&.${cct.disabled}`]:{opacity:0}},t.orientation==="vertical"&&{width:"100%",height:40,"& svg":{transform:`rotate(${t.isRtl?-90:90}deg)`}})),pct=U.forwardRef(function(e,r){var i,n;const s=ni({props:e,name:"MuiTabScrollButton"}),{className:o,slots:a={},slotProps:l={},direction:c}=s,u=Ut(s,uct),f=_f().direction==="rtl",m=Y({isRtl:f},s),g=dct(m),y=(i=a.StartScrollButtonIcon)!=null?i:ect,_=(n=a.EndScrollButtonIcon)!=null?n:tct,b=b_({elementType:y,externalSlotProps:l.startScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:m}),w=b_({elementType:_,externalSlotProps:l.endScrollButtonIcon,additionalProps:{fontSize:"small"},ownerState:m});return F.jsx(hct,Y({component:"div",className:Pt(g.root,o),ref:r,role:null,ownerState:m,tabIndex:null},u,{children:c==="left"?F.jsx(y,Y({},b)):F.jsx(_,Y({},w))}))}),fct=pct;function mct(t){return ii("MuiTabs",t)}const gct=Zr("MuiTabs",["root","vertical","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),UW=gct,yct=["aria-label","aria-labelledby","action","centered","children","className","component","allowScrollButtonsMobile","indicatorColor","onChange","orientation","ScrollButtonComponent","scrollButtons","selectionFollowsFocus","slots","slotProps","TabIndicatorProps","TabScrollButtonProps","textColor","value","variant","visibleScrollbar"],o0e=(t,e)=>t===e?t.firstChild:e&&e.nextElementSibling?e.nextElementSibling:t.firstChild,a0e=(t,e)=>t===e?t.lastChild:e&&e.previousElementSibling?e.previousElementSibling:t.lastChild,M5=(t,e,r)=>{let i=!1,n=r(t,e);for(;n;){if(n===t.firstChild){if(i)return;i=!0}const s=n.disabled||n.getAttribute("aria-disabled")==="true";if(!n.hasAttribute("tabindex")||s)n=r(t,n);else{n.focus();return}}},vct=t=>{const{vertical:e,fixed:r,hideScrollbar:i,scrollableX:n,scrollableY:s,centered:o,scrollButtonsHideMobile:a,classes:l}=t;return ui({root:["root",e&&"vertical"],scroller:["scroller",r&&"fixed",i&&"hideScrollbar",n&&"scrollableX",s&&"scrollableY"],flexContainer:["flexContainer",e&&"flexContainerVertical",o&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",a&&"scrollButtonsHideMobile"],scrollableX:[n&&"scrollableX"],hideScrollbar:[i&&"hideScrollbar"]},mct,l)},_ct=Ot("div",{name:"MuiTabs",slot:"Root",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[{[`& .${UW.scrollButtons}`]:e.scrollButtons},{[`& .${UW.scrollButtons}`]:r.scrollButtonsHideMobile&&e.scrollButtonsHideMobile},e.root,r.vertical&&e.vertical]}})(({ownerState:t,theme:e})=>Y({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex"},t.vertical&&{flexDirection:"column"},t.scrollButtonsHideMobile&&{[`& .${UW.scrollButtons}`]:{[e.breakpoints.down("sm")]:{display:"none"}}})),bct=Ot("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.scroller,r.fixed&&e.fixed,r.hideScrollbar&&e.hideScrollbar,r.scrollableX&&e.scrollableX,r.scrollableY&&e.scrollableY]}})(({ownerState:t})=>Y({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap"},t.fixed&&{overflowX:"hidden",width:"100%"},t.hideScrollbar&&{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},t.scrollableX&&{overflowX:"auto",overflowY:"hidden"},t.scrollableY&&{overflowY:"auto",overflowX:"hidden"})),wct=Ot("div",{name:"MuiTabs",slot:"FlexContainer",overridesResolver:(t,e)=>{const{ownerState:r}=t;return[e.flexContainer,r.vertical&&e.flexContainerVertical,r.centered&&e.centered]}})(({ownerState:t})=>Y({display:"flex"},t.vertical&&{flexDirection:"column"},t.centered&&{justifyContent:"center"})),xct=Ot("span",{name:"MuiTabs",slot:"Indicator",overridesResolver:(t,e)=>e.indicator})(({ownerState:t,theme:e})=>Y({position:"absolute",height:2,bottom:0,width:"100%",transition:e.transitions.create()},t.indicatorColor==="primary"&&{backgroundColor:(e.vars||e).palette.primary.main},t.indicatorColor==="secondary"&&{backgroundColor:(e.vars||e).palette.secondary.main},t.vertical&&{height:"100%",width:2,right:0})),Sct=Ot(oct,{name:"MuiTabs",slot:"ScrollbarSize"})({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),l0e={},Tct=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiTabs"}),n=_f(),s=n.direction==="rtl",{"aria-label":o,"aria-labelledby":a,action:l,centered:c=!1,children:u,className:h,component:f="div",allowScrollButtonsMobile:m=!1,indicatorColor:g="primary",onChange:y,orientation:_="horizontal",ScrollButtonComponent:b=fct,scrollButtons:w="auto",selectionFollowsFocus:x,slots:S={},slotProps:C={},TabIndicatorProps:E={},TabScrollButtonProps:R={},textColor:P="primary",value:D,variant:L="standard",visibleScrollbar:k=!1}=i,V=Ut(i,yct),W=L==="scrollable",G=_==="vertical",B=G?"scrollTop":"scrollLeft",Z=G?"top":"left",M=G?"bottom":"right",$=G?"clientHeight":"clientWidth",N=G?"height":"width",j=Y({},i,{component:f,allowScrollButtonsMobile:m,indicatorColor:g,orientation:_,vertical:G,scrollButtons:w,textColor:P,variant:L,visibleScrollbar:k,fixed:!W,hideScrollbar:W&&!k,scrollableX:W&&!G,scrollableY:W&&G,centered:c&&!W,scrollButtonsHideMobile:!m}),J=vct(j),K=b_({elementType:S.StartScrollButtonIcon,externalSlotProps:C.startScrollButtonIcon,ownerState:j}),te=b_({elementType:S.EndScrollButtonIcon,externalSlotProps:C.endScrollButtonIcon,ownerState:j}),[ae,be]=U.useState(!1),[Ee,Je]=U.useState(l0e),[ze,Ge]=U.useState({start:!1,end:!1}),[Le,de]=U.useState({overflow:"hidden",scrollbarWidth:0}),$e=new Map,Be=U.useRef(null),we=U.useRef(null),Ie=()=>{const Oe=Be.current;let Ze;if(Oe){const _t=Oe.getBoundingClientRect();Ze={clientWidth:Oe.clientWidth,scrollLeft:Oe.scrollLeft,scrollTop:Oe.scrollTop,scrollLeftNormalized:rye(Oe,n.direction),scrollWidth:Oe.scrollWidth,top:_t.top,bottom:_t.bottom,left:_t.left,right:_t.right}}let At;if(Oe&&D!==!1){const _t=we.current.children;if(_t.length>0){const cr=_t[$e.get(D)];At=cr?cr.getBoundingClientRect():null}}return{tabsMeta:Ze,tabMeta:At}},je=$m(()=>{const{tabsMeta:Oe,tabMeta:Ze}=Ie();let At=0,_t;if(G)_t="top",Ze&&Oe&&(At=Ze.top-Oe.top+Oe.scrollTop);else if(_t=s?"right":"left",Ze&&Oe){const pr=s?Oe.scrollLeftNormalized+Oe.clientWidth-Oe.scrollWidth:Oe.scrollLeft;At=(s?-1:1)*(Ze[_t]-Oe[_t]+pr)}const cr={[_t]:At,[N]:Ze?Ze[N]:0};if(isNaN(Ee[_t])||isNaN(Ee[N]))Je(cr);else{const pr=Math.abs(Ee[_t]-cr[_t]),kr=Math.abs(Ee[N]-cr[N]);(pr>=1||kr>=1)&&Je(cr)}}),fe=(Oe,{animation:Ze=!0}={})=>{Ze?ict(B,Be.current,Oe,{duration:n.transitions.duration.standard}):Be.current[B]=Oe},Ae=Oe=>{let Ze=Be.current[B];G?Ze+=Oe:(Ze+=Oe*(s?-1:1),Ze*=s&&G3e()==="reverse"?-1:1),fe(Ze)},gt=()=>{const Oe=Be.current[$];let Ze=0;const At=Array.from(we.current.children);for(let _t=0;_t<At.length;_t+=1){const cr=At[_t];if(Ze+cr[$]>Oe){_t===0&&(Ze=Oe);break}Ze+=cr[$]}return Ze},Re=()=>{Ae(-1*gt())},He=()=>{Ae(gt())},Dt=U.useCallback(Oe=>{de({overflow:null,scrollbarWidth:Oe})},[]),Fe=()=>{const Oe={};Oe.scrollbarSizeListener=W?F.jsx(Sct,{onChange:Dt,className:Pt(J.scrollableX,J.hideScrollbar)}):null;const Ze=ze.start||ze.end,At=W&&(w==="auto"&&Ze||w===!0);return Oe.scrollButtonStart=At?F.jsx(b,Y({slots:{StartScrollButtonIcon:S.StartScrollButtonIcon},slotProps:{startScrollButtonIcon:K},orientation:_,direction:s?"right":"left",onClick:Re,disabled:!ze.start},R,{className:Pt(J.scrollButtons,R.className)})):null,Oe.scrollButtonEnd=At?F.jsx(b,Y({slots:{EndScrollButtonIcon:S.EndScrollButtonIcon},slotProps:{endScrollButtonIcon:te},orientation:_,direction:s?"left":"right",onClick:He,disabled:!ze.end},R,{className:Pt(J.scrollButtons,R.className)})):null,Oe},nt=$m(Oe=>{const{tabsMeta:Ze,tabMeta:At}=Ie();if(!(!At||!Ze)){if(At[Z]<Ze[Z]){const _t=Ze[B]+(At[Z]-Ze[Z]);fe(_t,{animation:Oe})}else if(At[M]>Ze[M]){const _t=Ze[B]+(At[M]-Ze[M]);fe(_t,{animation:Oe})}}}),Ke=$m(()=>{if(W&&w!==!1){const{scrollTop:Oe,scrollHeight:Ze,clientHeight:At,scrollWidth:_t,clientWidth:cr}=Be.current;let pr,kr;if(G)pr=Oe>1,kr=Oe<Ze-At-1;else{const Gr=rye(Be.current,n.direction);pr=s?Gr<_t-cr-1:Gr>1,kr=s?Gr>1:Gr<_t-cr-1}(pr!==ze.start||kr!==ze.end)&&Ge({start:pr,end:kr})}});U.useEffect(()=>{const Oe=V2(()=>{Be.current&&(je(),Ke())}),Ze=ef(Be.current);Ze.addEventListener("resize",Oe);let At;return typeof ResizeObserver<"u"&&(At=new ResizeObserver(Oe),Array.from(we.current.children).forEach(_t=>{At.observe(_t)})),()=>{Oe.clear(),Ze.removeEventListener("resize",Oe),At&&At.disconnect()}},[je,Ke]);const mt=U.useMemo(()=>V2(()=>{Ke()}),[Ke]);U.useEffect(()=>()=>{mt.clear()},[mt]),U.useEffect(()=>{be(!0)},[]),U.useEffect(()=>{je(),Ke()}),U.useEffect(()=>{nt(l0e!==Ee)},[nt,Ee]),U.useImperativeHandle(l,()=>({updateIndicator:je,updateScrollButtons:Ke}),[je,Ke]);const wt=F.jsx(xct,Y({},E,{className:Pt(J.indicator,E.className),ownerState:j,style:Y({},Ee,E.style)}));let xt=0;const st=U.Children.map(u,Oe=>{if(!U.isValidElement(Oe))return null;const Ze=Oe.props.value===void 0?xt:Oe.props.value;$e.set(Ze,xt);const At=Ze===D;return xt+=1,U.cloneElement(Oe,Y({fullWidth:L==="fullWidth",indicator:At&&!ae&&wt,selected:At,selectionFollowsFocus:x,onChange:y,textColor:P,value:Ze},xt===1&&D===!1&&!Oe.props.tabIndex?{tabIndex:0}:{}))}),Xe=Oe=>{const Ze=we.current,At=Ll(Ze).activeElement;if(At.getAttribute("role")!=="tab")return;let cr=_==="horizontal"?"ArrowLeft":"ArrowUp",pr=_==="horizontal"?"ArrowRight":"ArrowDown";switch(_==="horizontal"&&s&&(cr="ArrowRight",pr="ArrowLeft"),Oe.key){case cr:Oe.preventDefault(),M5(Ze,At,a0e);break;case pr:Oe.preventDefault(),M5(Ze,At,o0e);break;case"Home":Oe.preventDefault(),M5(Ze,null,o0e);break;case"End":Oe.preventDefault(),M5(Ze,null,a0e);break}},it=Fe();return F.jsxs(_ct,Y({className:Pt(J.root,h),ownerState:j,ref:r,as:f},V,{children:[it.scrollButtonStart,it.scrollbarSizeListener,F.jsxs(bct,{className:J.scroller,ownerState:j,style:{overflow:Le.overflow,[G?`margin${s?"Left":"Right"}`:"marginBottom"]:k?void 0:-Le.scrollbarWidth},ref:Be,onScroll:mt,children:[F.jsx(wct,{"aria-label":o,"aria-labelledby":a,"aria-orientation":_==="vertical"?"vertical":null,className:J.flexContainer,ownerState:j,onKeyDown:Xe,ref:we,role:"tablist",children:st}),ae&&wt]}),it.scrollButtonEnd]}))}),Ect=Tct;function Cct(t){return ii("MuiTextField",t)}Zr("MuiTextField",["root"]);const Rct=["autoComplete","autoFocus","children","className","color","defaultValue","disabled","error","FormHelperTextProps","fullWidth","helperText","id","InputLabelProps","inputProps","InputProps","inputRef","label","maxRows","minRows","multiline","name","onBlur","onChange","onClick","onFocus","placeholder","required","rows","select","SelectProps","type","value","variant"],Oct={standard:jMe,filled:UMe,outlined:_3},Act=t=>{const{classes:e}=t;return ui({root:["root"]},Cct,e)},Pct=Ot(Im,{name:"MuiTextField",slot:"Root",overridesResolver:(t,e)=>e.root})({}),Mct=U.forwardRef(function(e,r){const i=ni({props:e,name:"MuiTextField"}),{autoComplete:n,autoFocus:s=!1,children:o,className:a,color:l="primary",defaultValue:c,disabled:u=!1,error:h=!1,FormHelperTextProps:f,fullWidth:m=!1,helperText:g,id:y,InputLabelProps:_,inputProps:b,InputProps:w,inputRef:x,label:S,maxRows:C,minRows:E,multiline:R=!1,name:P,onBlur:D,onChange:L,onClick:k,onFocus:V,placeholder:W,required:G=!1,rows:B,select:Z=!1,SelectProps:M,type:$,value:N,variant:j="outlined"}=i,J=Ut(i,Rct),K=Y({},i,{autoFocus:s,color:l,disabled:u,error:h,fullWidth:m,multiline:R,required:G,select:Z,variant:j}),te=Act(K),ae={};j==="outlined"&&(_&&typeof _.shrink<"u"&&(ae.notched=_.shrink),ae.label=S),Z&&((!M||!M.native)&&(ae.id=void 0),ae["aria-describedby"]=void 0);const be=sle(y),Ee=g&&be?`${be}-helper-text`:void 0,Je=S&&be?`${be}-label`:void 0,ze=Oct[j],Ge=F.jsx(ze,Y({"aria-describedby":Ee,autoComplete:n,autoFocus:s,defaultValue:c,fullWidth:m,multiline:R,name:P,rows:B,maxRows:C,minRows:E,type:$,value:N,id:be,inputRef:x,onBlur:D,onChange:L,onFocus:V,onClick:k,placeholder:W,inputProps:b},ae,w));return F.jsxs(Pct,Y({className:Pt(te.root,a),disabled:u,error:h,fullWidth:m,ref:r,required:G,color:l,variant:j,ownerState:K},J,{children:[S!=null&&S!==""&&F.jsx(Iy,Y({htmlFor:be,id:Je},_,{children:S})),Z?F.jsx(Ly,Y({"aria-describedby":Ee,id:be,labelId:Je,value:N,input:Ge},M,{children:o})):Ge,g&&F.jsx(zMe,Y({id:Ee},f,{children:g}))]}))}),$ct=Mct,bu={DEMOTYPE:"demoType",DEMOPANEL:"demoPanel",CAMERALOCATION:"cameraLocation",PLACENAME:"placeName",AVAILABLELAYERS:"availableLayers",FIELDDOMAINS:"fieldDomans",SCOREDFIELDS:"scoredFields",AOIGEOMETRY:"AOIgeometry",BASEMAP:"basemap",WAYPOINTSGEOMETRY:"waypointsGeometry",SURFACERESOLUTION:"surfaceResolution",SURFACEDATA:"surfaceData",SURFACEREQUEST:"surfaceRequest",SELECTEDFIELDS:"selectedFields"},Ict={"Los Angeles":{position:{x:-118.255,y:34.01,z:1380},heading:0,tilt:76},Ontario:{position:{x:-117.685,y:33.935,z:2546},heading:6.873,tilt:76.762},Detroit:{position:{x:-83.113,y:42.268,z:4754},heading:33.511,tilt:65.004},"Arlington, TX":{position:{x:-97.11,y:32.704,z:3122},heading:3.431,tilt:46.679},"The Villages":{position:{x:-81.941,y:28.812,z:3245},heading:339,tilt:69},Phoenix:{position:{x:-112.026,y:33.356,z:2659},heading:335,tilt:75},"Holland, MI":{position:{x:-86.034,y:42.749,z:2181},heading:298,tilt:71.86}},KMe={demoType:"DEMO SELECT",demoPanel:"DEMO PANEL",cameraLocation:Ict["Los Angeles"],placeName:"Los Angeles",availableLayers:[],fieldDomains:[],scoredFields:[],AOIgeometry:{},basemap:"dark-gray-vector",waypointsGeometry:[],surfaceResolution:0,surfaceRequest:!1,selectedFields:[]},Co=U.createContext(KMe),Lct=({children:t})=>{const[e,r]=U.useReducer((i,n)=>{switch(n.type){case bu.DEMOTYPE:return{...i,demoType:n.payload};case bu.DEMOPANEL:return{...i,demoPanel:n.payload};case bu.CAMERALOCATION:return{...i,cameraLocation:n.payload};case bu.PLACENAME:return{...i,placeName:n.payload};case bu.AVAILABLELAYERS:return{...i,availableLayers:n.payload};case bu.FIELDDOMAINS:return{...i,fieldDomains:n.payload};case bu.SCOREDFIELDS:return{...i,scoredFields:n.payload};case bu.AOIGEOMETRY:return{...i,AOIgeometry:n.payload};case bu.BASEMAP:return{...i,basemap:n.payload};case bu.WAYPOINTSGEOMETRY:return{...i,waypointsGeometry:n.payload};case bu.SURFACERESOLUTION:return{...i,surfaceResolution:n.payload};case bu.SURFACEDATA:return{...i,surfaceResolution:n.payload.surfaceResolution,demoPanel:n.payload.demoPanel,scoredFields:n.payload.scoredFields,surfaceRequest:n.payload.surfaceRequest};case bu.SURFACEREQUEST:return{...i,surfaceRequest:n.payload};case bu.SELECTEDFIELDS:return{...i,selectedFields:n.payload};default:return i}},KMe);return F.jsx(Co.Provider,{value:[e,r],children:t})};function Dct({demoCardData:t}){const[e,r]=U.useContext(Co);U.useEffect(()=>{console.log("democards",e)},[e]);const i=()=>F.jsx(F.Fragment,{children:t.map(n=>F.jsx(cl,{style:{width:300,position:"absolute",left:"50%",top:"50%",marginLeft:n.cardPosition.marginLeft,marginTop:n.cardPosition.marginTop,opacity:.9},sx:{zIndex:"tooltip",boxShadow:9},children:F.jsx(Oit,{sx:{maxWidth:320},children:F.jsxs(Mst,{onClick:s=>r({type:"demoType",payload:s.target.title}),children:[F.jsx(Bit,{title:n.name,component:"img",height:"140",image:n.imagePath,alt:n.altText}),F.jsxs(Lit,{children:[F.jsx(eQ,{title:n.name,gutterBottom:!0,variant:"h5",component:"div",children:n.name}),F.jsx(eQ,{title:n.name,variant:"body2",color:"text.secondary",children:n.desc})]})]})})},n.name))});return F.jsx(F.Fragment,{children:i()})}const Nct="modulepreload",Fct=function(t){return"/arcgis-demo-vite/"+t},c0e={},le=function(e,r,i){if(!r||r.length===0)return e();const n=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=Fct(s),s in c0e)return;c0e[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let u=n.length-1;u>=0;u--){const h=n[u];if(h.href===s&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":Nct,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})};function d(t,e,r,i){var n,s=arguments.length,o=s<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o}function Xur(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(h){o(h)}}function l(u){try{c(i.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):n(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}let lw;function he(t){return typeof lw[t]=="function"?lw[t]=lw[t](globalThis):lw[t]}var vAe,_Ae,bAe,wAe;lw=(vAe=globalThis.dojoConfig)!=null&&vAe.has||(_Ae=globalThis.esriConfig)!=null&&_Ae.has?{...(bAe=globalThis.dojoConfig)==null?void 0:bAe.has,...(wAe=globalThis.esriConfig)==null?void 0:wAe.has}:{},he.add=(t,e,r,i)=>((i||lw[t]===void 0)&&(lw[t]=e),r&&he(t)),he.cache=lw,he.add("esri-deprecation-warnings",!0),he.add("esri-force-fullscreen-debug",!1),(()=>{var e;he.add("host-webworker",globalThis.WorkerGlobalScope!==void 0&&self instanceof globalThis.WorkerGlobalScope);const t=typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document;if(he.add("host-browser",t),he.add("host-node",typeof globalThis.process=="object"&&((e=globalThis.process.versions)==null?void 0:e.node)&&globalThis.process.versions.v8),he.add("dom",t),he("host-browser")){const r=navigator,i=r.userAgent,n=r.appVersion,s=parseFloat(n);if(he.add("wp",parseFloat(i.split("Windows Phone")[1])||void 0),he.add("msapp",parseFloat(i.split("MSAppHost/")[1])||void 0),he.add("khtml",n.includes("Konqueror")?s:void 0),he.add("edge",parseFloat(i.split("Edge/")[1])||void 0),he.add("opr",parseFloat(i.split("OPR/")[1])||void 0),he.add("webkit",!he("wp")&&!he("edge")&&parseFloat(i.split("WebKit/")[1])||void 0),he.add("chrome",!he("edge")&&!he("opr")&&parseFloat(i.split("Chrome/")[1])||void 0),he.add("android",!he("wp")&&parseFloat(i.split("Android ")[1])||void 0),he.add("safari",!n.includes("Safari")||he("wp")||he("chrome")||he("android")||he("edge")||he("opr")?void 0:parseFloat(n.split("Version/")[1])),he.add("mac",n.includes("Macintosh")),!he("wp")&&/(iPhone|iPod|iPad)/.test(i)){const o=RegExp.$1.replace(/P/,"p"),a=/OS ([\d_]+)/.test(i)?RegExp.$1:"1",l=parseFloat(a.replace(/_/,".").replaceAll("_",""));he.add(o,l),he.add("ios",l)}he("webkit")||(!i.includes("Gecko")||he("wp")||he("khtml")||he("edge")||he.add("mozilla",s),he("mozilla")&&he.add("ff",parseFloat(i.split("Firefox/")[1]||i.split("Minefield/")[1])||void 0))}})(),(()=>{if(globalThis.navigator){const t=navigator.userAgent,e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Opera Mini|IEMobile/i.test(t),r=/iPhone/i.test(t);e&&he.add("esri-mobile",e),r&&he.add("esri-iPhone",r),he.add("esri-geolocation",!!navigator.geolocation)}he.add("esri-wasm","WebAssembly"in globalThis),he.add("esri-shared-array-buffer",()=>{const t="SharedArrayBuffer"in globalThis,e=globalThis.crossOriginIsolated===!1;return t&&!e}),he.add("wasm-simd",()=>{const t=[0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11];return WebAssembly.validate(new Uint8Array(t))}),he.add("esri-atomics","Atomics"in globalThis),he.add("esri-workers","Worker"in globalThis),he.add("web-feat:cache","caches"in globalThis),he.add("esri-workers-arraybuffer-transfer",!he("safari")||Number(he("safari"))>=12),he.add("workers-pool-size",8),he.add("featurelayer-simplify-thresholds",[.5,.5,.5,.5]),he.add("featurelayer-simplify-payload-size-factors",[1,1,4]),he.add("featurelayer-animation-enabled",!0),he.add("featurelayer-snapshot-enabled",!0),he.add("featurelayer-snapshot-point-min-threshold",8e4),he.add("featurelayer-snapshot-point-max-threshold",4e5),he.add("featurelayer-snapshot-point-coverage",.1),he.add("featurelayer-advanced-symbols",!1),he.add("featurelayer-pbf",!0),he.add("featurelayer-pbf-statistics",!1),he.add("feature-layers-workers",!0),he.add("feature-polyline-generalization-factor",1),he.add("mapview-transitions-duration",200),he.add("mapview-srswitch-adjust-rotation-scale-threshold",24e6),he.add("mapserver-pbf-version-support",10.81),he.add("mapservice-popup-identify-max-tolerance",20),he.add("heatmap-allow-raster-fallback",!1),he.add("heatmap-force-raster",!1),he("host-webworker")||he("host-browser")&&(he.add("esri-csp-restrictions",()=>{try{new Function}catch{return!0}return!1}),he.add("esri-image-decode",()=>{if("decode"in new Image){const t=new Image;return t.src='data:image/svg+xml;charset=UTF-8,<svg version="1.1" xmlns="http://www.w3.org/2000/svg"></svg>',void t.decode().then(()=>{he.add("esri-image-decode",!0,!0,!0)}).catch(()=>{he.add("esri-image-decode",!1,!0,!0)})}return!1}),he.add("esri-url-encodes-apostrophe",()=>{const t=window.document.createElement("a");return t.href="?'",t.href.includes("?%27")}))})();let YL=class RS{constructor(e=1){this._seed=e}set seed(e){this._seed=e??Math.random()*RS._m}getInt(){return this._seed=(RS._a*this._seed+RS._c)%RS._m,this._seed}getFloat(){return this.getInt()/(RS._m-1)}getIntRange(e,r){return Math.round(this.getFloatRange(e,r))}getFloatRange(e,r){const i=r-e;return e+this.getInt()/RS._m*i}};YL._m=2147483647,YL._a=48271,YL._c=0;const s7=1.5,kct=1/s7,Uct=.5;function o7(t,e){return e?t.filter((r,i,n)=>n.findIndex(e.bind(null,r))===i):t.filter((r,i,n)=>n.indexOf(r)===i)}function T_(t,e,r){if(t==null&&e==null)return!0;if(t==null||e==null||t.length!==e.length)return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function Vle(t,e){let r=t.length!==e.length;r&&(t.length=e.length);for(let i=0;i<e.length;++i)t[i]!==e[i]&&(t[i]=e[i],r=!0);return r}function zct(t,e,r){let i,n;return r?(i=e.filter(s=>!t.some(o=>r(o,s))),n=t.filter(s=>!e.some(o=>r(o,s)))):(i=e.filter(s=>!t.includes(s)),n=t.filter(s=>!e.includes(s))),{added:i,removed:n}}function Vct(t){return t&&typeof t.length=="number"}function Bct(t,e){const r=t.length;if(r===0)return[];const i=[];for(let n=0;n<r;n+=e)i.push(t.slice(n,n+e));return i}const jct=!!Array.prototype.fill;function Yur(t,e){if(jct)return new Array(t).fill(e);const r=new Array(t);for(let i=0;i<t;i++)r[i]=e;return r}function Gct(t,e){e===void 0&&(e=t,t=0);const r=new Array(e-t);for(let i=t;i<e;i++)r[i-t]=i;return r}function QMe(t,e,r){const i=t.length;let n=0,s=i-1;for(;n<s;){const a=n+Math.floor((s-n)/2);e>t[a]?n=a+1:s=a}const o=t[n];return r?e>=t[i-1]?-1:o===e?n:n-1:o===e?n:-1}let e$e=class{constructor(){this.last=0}};const t$e=new e$e;function oQ(t,e,r,i){i=i||t$e;const n=Math.max(0,i.last-10);for(let o=n;o<r;++o)if(t[o]===e)return i.last=o,o;const s=Math.min(n,r);for(let o=0;o<s;++o)if(t[o]===e)return i.last=o,o;return-1}function fN(t,e,r,i){const n=r??t.length,s=oQ(t,e,n,i);if(s!==-1)return t[s]=t[n-1],r==null&&t.pop(),e}const Rf=new Set;function Hct(t,e,r=t.length,i=e.length,n,s){if(i===0||r===0)return r;Rf.clear();for(let a=0;a<i;++a)Rf.add(e[a]);n=n||t$e;const o=Math.max(0,n.last-10);for(let a=o;a<r;++a)if(Rf.has(t[a])&&(s&&s.push(t[a]),Rf.delete(t[a]),t[a]=t[r-1],--r,--a,Rf.size===0||r===0))return Rf.clear(),r;for(let a=0;a<o;++a)if(Rf.has(t[a])&&(s&&s.push(t[a]),Rf.delete(t[a]),t[a]=t[r-1],--r,--a,Rf.size===0||r===0))return Rf.clear(),r;return Rf.clear(),r}function qct(t,e){let r=0;for(let i=0;i<t.length;++i){const n=t[i];e(n,i)&&(t[r]=n,r++)}t.length=r}function Wct(t){return t?(u0e.seed=t,()=>u0e.getFloat()):Math.random}function Jur(t,e){const r=Wct(e);for(let i=t.length-1;i>0;i--){const n=Math.floor(r()*(i+1)),s=t[i];t[i]=t[n],t[n]=s}return t}const u0e=new YL;function Ble(t,e){const r=t.indexOf(e);return r!==-1?(t.splice(r,1),e):null}function Kur(t,e){const r=new Map,i=t.length;for(let n=0;n<i;n++){const s=t[n],o=e(s,n,t),a=r.get(o);a?a.push(s):r.set(o,[s])}return r}function _0(t,e){return t!=null}const Xct=[];function Y$(t){return t instanceof ArrayBuffer}function jle(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int8Array"}function cw(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8Array"}function r$e(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint8ClampedArray"}function a7(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int16Array"}function l7(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint16Array"}function c7(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Int32Array"}function u7(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Uint32Array"}function b3(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float32Array"}function w3(t){var e;return((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="Float64Array"}function ig(t){return!("buffer"in t)}function uw(t){return t!=null?ig(t)?8*t.length+12:t.byteLength+i$e:0}const i$e=145,Eh=1024;function Yct(t){return w3(t)||b3(t)||c7(t)||a7(t)||jle(t)}function Zct(t){return w3(t)||b3(t)}function Jct(t){return w3(t)?179769e303:b3(t)?3402823e32:u7(t)?4294967295:l7(t)?65535:cw(t)||r$e(t)?255:c7(t)?2147483647:a7(t)?32767:jle(t)?127:256}function n$e(t,e){let r;if(e)for(r in t)t.hasOwnProperty(r)&&(t[r]===void 0?delete t[r]:t[r]instanceof Object&&n$e(t[r],!0));else for(r in t)t.hasOwnProperty(r)&&t[r]===void 0&&delete t[r];return t}function ie(t){if(!t||typeof t!="object"||typeof t=="function")return t;const e=a$e(t);if(e!=null)return e;if(lV(t))return t.clone();if(s$e(t))return t.map(ie);if(o$e(t))return t.clone();const r={};for(const i of Object.getOwnPropertyNames(t))r[i]=ie(t[i]);return r}function aQ(t){if(!t||typeof t!="object"||typeof t=="function"||"HTMLElement"in globalThis&&t instanceof HTMLElement)return t;const e=a$e(t);if(e!=null)return e;if(s$e(t)){let r=!0;const i=t.map(n=>{const s=aQ(n);return n!=null&&s==null&&(r=!1),s});return r?i:null}if(lV(t))return t.clone();if(t instanceof File||t instanceof Blob)return t;if(!o$e(t)){const r=new(Object.getPrototypeOf(t)).constructor;for(const i of Object.getOwnPropertyNames(t)){const n=t[i],s=aQ(n);if(n!=null&&s==null)return null;r[i]=s}return r}return null}function lV(t){return typeof t.clone=="function"}function s$e(t){return typeof t.map=="function"&&typeof t.forEach=="function"}function o$e(t){return typeof t.notifyChange=="function"&&typeof t.watch=="function"}function d0e(t){if(Object.prototype.toString.call(t)!=="[object Object]")return!1;const e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}function a$e(t){if(jle(t)||cw(t)||r$e(t)||a7(t)||l7(t)||c7(t)||u7(t)||b3(t)||w3(t))return t.slice();if(t instanceof Date)return new Date(t.getTime());if(t instanceof ArrayBuffer)return t.slice(0,t.byteLength);if(t instanceof Map){const e=new Map;for(const[r,i]of t)e.set(r,ie(i));return e}if(t instanceof Set){const e=new Set;for(const r of t)e.add(ie(r));return e}return null}function Gle(t,e){return t===e||typeof t=="number"&&isNaN(t)&&typeof e=="number"&&isNaN(e)||typeof(t||{}).getTime=="function"&&typeof(e||{}).getTime=="function"&&t.getTime()===e.getTime()||!1}function l$e(t,e){return t===e||(t==null||typeof t=="string"?t===e:typeof t=="number"?t===e||typeof e=="number"&&isNaN(t)&&isNaN(e):t instanceof Date?e instanceof Date&&t.getTime()===e.getTime():Array.isArray(t)?Array.isArray(e)&&T_(t,e):t instanceof Set?e instanceof Set&&Qct(t,e):t instanceof Map?e instanceof Map&&eut(t,e):!!d0e(t)&&d0e(e)&&Kct(t,e))}function Kct(t,e){if(t===null||e===null)return!1;const r=Object.keys(t);if(e===null||Object.keys(e).length!==r.length)return!1;for(const i of r)if(t[i]!==e[i]||!Object.prototype.hasOwnProperty.call(e,i))return!1;return!0}function Qct(t,e){if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0}function eut(t,e){if(t.size!==e.size)return!1;for(const[r,i]of t){const n=e.get(r);if(n!==i||n===void 0&&!e.has(r))return!1}return!0}function c$e(t,e,r=!1){return d$e(t,e,r)}function N4(t,e){if(e!=null)return e[t]||u$e(t.split("."),!1,e)}function Rc(t,e,r){const i=t.split("."),n=i.pop(),s=u$e(i,!0,r);s&&n&&(s[n]=e)}function u$e(t,e,r){let i=r;for(const n of t){if(i==null)return;if(!(n in i)){if(!e)return;i[n]={}}i=i[n]}return i}function d$e(t,e,r){return e?Object.keys(e).reduce((i,n)=>{let s=i[n],o=e[n];return s===o?i:s===void 0?(i[n]=ie(o),i):(Array.isArray(o)||Array.isArray(i)?(s=s?Array.isArray(s)?i[n]=s.concat():i[n]=[s]:i[n]=[],o&&(Array.isArray(o)||(o=[o]),r?o.forEach(a=>{s.includes(a)||s.push(a)}):i[n]=o.concat())):o&&typeof o=="object"?i[n]=d$e(s,o,r):i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[n]=o),i)},t||{}):t}var xAe;const Ti={analysisTheme:{accentColor:[255,127,0],textColor:"white"},apiKey:void 0,applicationName:"",applicationUrl:(xAe=globalThis.location)==null?void 0:xAe.href,assetsPath:"",fontsUrl:"https://static.arcgis.com/fonts",geometryServiceUrl:"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",geoRSSServiceUrl:"https://utility.arcgis.com/sharing/rss",kmlServiceUrl:"https://utility.arcgis.com/sharing/kml",userPrivilegesApplied:!1,portalUrl:"https://www.arcgis.com",routeServiceUrl:"https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",workers:{loaderConfig:{has:{},paths:{},map:{},packages:[]}},request:{crossOriginNoCorsDomains:null,httpsDomains:["arcgis.com","arcgisonline.com","esrikr.com","premiumservices.blackbridge.com","esripremium.accuweather.com","gbm.digitalglobe.com","firstlook.digitalglobe.com","msi.digitalglobe.com"],interceptors:[],maxUrlLength:2e3,priority:"high",proxyRules:[],proxyUrl:null,timeout:6e4,trustedServers:[],useIdentity:!0},log:{interceptors:[],level:null}};if(globalThis.esriConfig&&(c$e(Ti,globalThis.esriConfig,!0),delete Ti.has),!Ti.assetsPath){{const t="4.27";Ti.assetsPath=`https://js.arcgis.com/${t}/@arcgis/core/assets`}Ti.defaultAssetsPath=Ti.assetsPath}const tut=/\{([^\}]+)\}/g;function h0e(t){return t??""}function d7(t,e){return t.replaceAll(tut,typeof e=="object"?(r,i)=>h0e(N4(i,e)):(r,i)=>h0e(e(i)))}function Qur(t,e){return t.replaceAll(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,r=>e&&e.includes(r)?r:`\\${r}`)}function Hle(t){let e=0;for(let r=0;r<t.length;r++)e=(e<<5)-e+t.charCodeAt(r),e|=0;return e}function edr(t){return new DOMParser().parseFromString(t||"","text/html").body.innerText||""}function tdr(t,e){return new RegExp(`{${e}}`,"ig").test(t)}const p0e={info:0,warn:1,error:2,none:3};let re=class rc{constructor(e){this.level=null,this._module="",this._parent=null,this.writer=null,this._loggedMessages={error:new Map,warn:new Map,info:new Map},e.level!=null&&(this.level=e.level),e.writer!=null&&(this.writer=e.writer),this._module=e.module,rc._loggers.set(this.module,this);const r=this.module.lastIndexOf(".");r!==-1&&(this._parent=rc.getLogger(this.module.slice(0,r)))}get module(){return this._module}get parent(){return this._parent}error(...e){this._log("error","always",...e)}warn(...e){this._log("warn","always",...e)}info(...e){this._log("info","always",...e)}errorOnce(...e){this._log("error","once",...e)}warnOnce(...e){this._log("warn","once",...e)}infoOnce(...e){this._log("info","once",...e)}errorOncePerTick(...e){this._log("error","oncePerTick",...e)}warnOncePerTick(...e){this._log("warn","oncePerTick",...e)}infoOncePerTick(...e){this._log("info","oncePerTick",...e)}get test(){const e=this;return{loggedMessages:e._loggedMessages,clearLoggedWarnings:()=>e._loggedMessages.warn.clear()}}static get test(){return{resetLoggers(e=new Map){const r=rc._loggers;return rc._loggers=e,r},set throttlingDisabled(e){rc._throttlingDisabled=e}}}static getLogger(e){return e=typeof e!="string"?e.declaredClass:e,rc._loggers.get(e)||new rc({module:e})}_log(e,r,...i){if(this._matchLevel(e)){if(r!=="always"&&!rc._throttlingDisabled){const n=this._argsToKey(i),s=this._loggedMessages[e].get(n);if(r==="once"&&s!=null||r==="oncePerTick"&&s&&s>=rc._tickCounter)return;this._loggedMessages[e].set(n,rc._tickCounter),rc._scheduleTickCounterIncrement()}for(const n of Ti.log.interceptors)if(n(e,this.module,...i))return;this._inheritedWriter()(e,this.module,...i)}}_parentWithMember(e,r){let i=this;for(;i!=null;){const n=i[e];if(n!=null)return n;i=i.parent}return r}_inheritedWriter(){return this._parentWithMember("writer",this._consoleWriter)}_consoleWriter(e,r,...i){console[e](`[${r}]`,...i)}_matchLevel(e){const r=Ti.log.level||"warn";return p0e[this._parentWithMember("level",r)]<=p0e[e]}_argsToKey(...e){return Hle(JSON.stringify(e,(i,n)=>typeof n!="object"||Array.isArray(n)?n:"[Object]"))}static _scheduleTickCounterIncrement(){rc._tickCounterScheduled||(rc._tickCounterScheduled=!0,Promise.resolve().then(()=>{rc._tickCounter++,rc._tickCounterScheduled=!1}))}};re._loggers=new Map,re._tickCounter=0,re._tickCounterScheduled=!1,re._throttlingDisabled=!1;function rut(t,e){return t.replaceAll(/\$\{([^\s\:\}]*)(?:\:([^\s\:\}]+))?\}/g,(r,i)=>i===""?"$":(N4(i,e)??"").toString())}let h$e=class{constructor(e,r,i){this.name=e,this.details=i,this.message=(r&&rut(r,i))??""}toString(){return"["+this.name+"]: "+this.message}},H=class p$e extends h$e{constructor(e,r,i){super(e,r,i)}toJSON(){if(this.details!=null)try{return{name:this.name,message:this.message,details:JSON.parse(JSON.stringify(this.details,(e,r)=>{if(r&&typeof r=="object"&&typeof r.toJSON=="function")return r;try{return ie(r)}catch{return"[object]"}}))}}catch(e){throw re.getLogger("esri.core.Error").error(e),e}return{name:this.name,message:this.message,details:this.details}}static fromJSON(e){return new p$e(e.name,e.message,e.details)}};H.prototype.type="error";function rd(t,e){return t!=null?e(t):null}function qu(t,e){return h7(t,e),t}function h7(t,e){if(t==null)throw new Error(e??"value is None")}function qe(t){return t==null||t.destroy(),null}function pt(t){return t==null||t.dispose(),null}function yi(t){return t==null||t.remove(),null}function xc(t){return t==null||t.abort(),null}function xn(t){return t==null||t.release(),null}function iut(t,e,r){return t!=null&&e!=null?r!=null?r(t,e):t.equals(e):t===e}function x3(t){return null}function idr(t,e){const r=new Array;for(const i of t)r.push(i!=null?e(i):null);return r}function ndr(t,e){for(const r of t)rd(r,e)}function sdr(t){return t}const nut=/^https:\/\/([a-z\d-]+)(\.maps([^.]*))?\.arcgis\.com/i,sut={devext:{customBaseUrl:"mapsdevext.arcgis.com",portalHostname:"devext.arcgis.com"},qaext:{customBaseUrl:"mapsqa.arcgis.com",portalHostname:"qaext.arcgis.com"},www:{customBaseUrl:"maps.arcgis.com",portalHostname:"www.arcgis.com"}};function f0e(t){const e=t==null?void 0:t.match(nut);if(!e)return null;const[,r,i,n]=e;if(!r)return null;let s=null,o=null,a=null;const{devext:l,qaext:c,www:u}=sut;if(i)if(s=r,n)switch(n.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qa":({customBaseUrl:o,portalHostname:a}=c);break;default:return null}else({customBaseUrl:o,portalHostname:a}=u);else switch(r.toLowerCase()){case"devext":({customBaseUrl:o,portalHostname:a}=l);break;case"qaext":({customBaseUrl:o,portalHostname:a}=c);break;case"www":({customBaseUrl:o,portalHostname:a}=u);break;default:return null}return{customBaseUrl:o,isPortal:!1,portalHostname:a,urlKey:s}}function out(t){return/\/(sharing|usrsvcs)\/(appservices|servers)\//i.test(t)}function aut(t){const e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r.buffer}const lut=re.getLogger("esri.core.urlUtils"),S3=Ti.request,m0e="esri/config: esriConfig.request.proxyUrl is not set.",f$e=/^\s*[a-z][a-z0-9-+.]*:(?![0-9])/i,m$e=/^\s*http:/i,cut=/^\s*https:/i,uut=/^\s*file:/i,dut=/:\d+$/,hut=/^https?:\/\/[^/]+\.arcgis.com\/sharing(\/|$)/i,put=new RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$"),fut=new RegExp("^((([^\\[:]+):)?([^@]+)@)?(\\[([^\\]]+)\\]|([^\\[:]*))(:([0-9]+))?$");let yA=class{constructor(e=""){this.uri=e,this.scheme=null,this.authority=null,this.path=null,this.query=null,this.fragment=null,this.user=null,this.password=null,this.host=null,this.port=null;let r=this.uri.match(put);this.scheme=r[2]||(r[1]?"":null),this.authority=r[4]||(r[3]?"":null),this.path=r[5],this.query=r[7]||(r[6]?"":null),this.fragment=r[9]||(r[8]?"":null),this.authority!=null&&(r=this.authority.match(fut),this.user=r[3]||null,this.password=r[4]||null,this.host=r[6]||r[7],this.port=r[9]||null)}toString(){return this.uri}};const $5={},mut=new yA(Ti.applicationUrl);let vc=mut;const gut=yut();let qle=gut;const Wle=()=>vc,adr=()=>qle;function yut(){const t=vc.path,e=t.substring(0,t.lastIndexOf(t.split("/")[t.split("/").length-1]));return`${`${vc.scheme}://${vc.host}${vc.port!=null?`:${vc.port}`:""}`}${e}`}function Ts(t){if(!t)return null;const e={path:null,query:null},r=new yA(t),i=t.indexOf("?");return r.query===null?e.path=t:(e.path=t.substring(0,i),e.query=Xle(r.query)),r.fragment&&(e.hash=r.fragment,r.query===null&&(e.path=e.path.substring(0,e.path.length-(r.fragment.length+1)))),e}function Xle(t){const e=t.split("&"),r={};for(const i of e){if(!i)continue;const n=i.indexOf("=");let s,o;n<0?(s=decodeURIComponent(i),o=""):(s=decodeURIComponent(i.slice(0,n)),o=decodeURIComponent(i.slice(n+1)));let a=r[s];typeof a=="string"&&(a=r[s]=[a]),Array.isArray(a)?a.push(o):r[s]=o}return r}function g0e(t){return t&&typeof t=="object"&&"toJSON"in t&&typeof t.toJSON=="function"}function mN(t,e){return t?e&&typeof e=="function"?Object.keys(t).map(r=>encodeURIComponent(r)+"="+encodeURIComponent(e(r,t[r]))).join("&"):Object.keys(t).map(r=>{const i=t[r];if(i==null)return"";const n=encodeURIComponent(r)+"=",s=e&&e[r];return s?n+encodeURIComponent(s(i)):Array.isArray(i)?i.map(o=>g0e(o)?n+encodeURIComponent(JSON.stringify(o)):n+encodeURIComponent(o)).join("&"):g0e(i)?n+encodeURIComponent(JSON.stringify(i)):n+encodeURIComponent(i)}).filter(r=>r).join("&"):""}function vut(t=!1){let e,r=S3.proxyUrl;if(typeof t=="string"){e=Tut(t);const i=p7(t);i&&(r=i.proxyUrl)}else e=!!t;if(!r)throw lut.warn(m0e),new H("urlutils:proxy-not-set",m0e);return e&&lQ()&&(r=ece(r)),Ts(r)}function ldr(t){const e=p7(t);let r,i;if(e){const n=Yle(e.proxyUrl);r=n.path,i=n.query?Xle(n.query):null}if(r){const n=Ts(t);t=r+"?"+n.path;const s=mN({...i,...n.query});s&&(t=`${t}?${s}`)}return t}const CM={path:"",query:""};function Yle(t){const e=t.indexOf("?");return e!==-1?(CM.path=t.slice(0,e),CM.query=t.slice(e+1)):(CM.path=t,CM.query=null),CM}function g$e(t){return t=(t=uV(t=Aut(t=Yle(t).path),!0)).toLowerCase()}function _ut(t){const e={proxyUrl:t.proxyUrl,urlPrefix:g$e(t.urlPrefix)},r=S3.proxyRules,i=e.urlPrefix;let n=r.length;for(let s=0;s<r.length;s++){const o=r[s].urlPrefix;if(i.indexOf(o)===0){if(i.length===o.length)return-1;n=s;break}o.indexOf(i)===0&&(n=s+1)}return r.splice(n,0,e),n}function p7(t){const e=S3.proxyRules,r=g$e(t);for(let i=0;i<e.length;i++)if(r.indexOf(e[i].urlPrefix)===0)return e[i]}function but(t,e){if(!t||!e)return!1;t=cV(t),e=cV(e);const r=f0e(t),i=f0e(e);return r!=null&&i!=null?r.portalHostname===i.portalHostname:r==null&&i==null&&uP(t,e,!0)}function y$e(t,e){return t=cV(t),e=cV(e),uV(t)===uV(e)}function cV(t){const e=(t=qp(t)).indexOf("/sharing");return e>0?t.substring(0,e):t.replace(/\/+$/,"")}function v$e(t){const e=i=>i==null||i instanceof RegExp&&i.test(t)||typeof i=="string"&&t.startsWith(i),r=S3.interceptors;if(r){for(const i of r)if(Array.isArray(i.urls)){if(i.urls.some(e))return i}else if(e(i.urls))return i}return null}function uP(t,e,r=!1){if(!t||!e)return!1;const i=uQ(t),n=uQ(e);return!(!r&&i.scheme!==n.scheme)&&i.host!=null&&n.host!=null&&i.host.toLowerCase()===n.host.toLowerCase()&&i.port===n.port}function Zle(t){if(typeof t=="string"){if(!fd(t))return!0;t=uQ(t)}if(uP(t,vc))return!0;const e=S3.trustedServers||[];for(let r=0;r<e.length;r++){const i=wut(e[r]);for(let n=0;n<i.length;n++)if(uP(t,i[n]))return!0}return!1}function wut(t){return $5[t]||(Qle(t)||s0(t)?$5[t]=[new yA(ah(t))]:$5[t]=[new yA(`http://${t}`),new yA(`https://${t}`)]),$5[t]}function ah(t,e=qle,r){return s0(t)?r&&r.preserveProtocolRelative?t:vc.scheme==="http"&&vc.authority===Xm(t).slice(2)?`http:${t}`:`https:${t}`:Qle(t)?t:bd(t[0]==="/"?Out(e):e,t)}function Jle(t,e=qle,r){if(t==null||!fd(t))return t;const i=qp(t),n=i.toLowerCase(),s=qp(e).toLowerCase().replace(/\/+$/,""),o=r?qp(r).toLowerCase().replace(/\/+$/,""):null;if(o&&s.indexOf(o)!==0)return t;const a=(h,f,m)=>(m=h.indexOf(f,m))===-1?h.length:m;let l=a(n,"/",n.indexOf("//")+2),c=-1;for(;n.slice(0,l+1)===s.slice(0,l)+"/"&&(c=l+1,l!==n.length);)l=a(n,"/",l+1);if(c===-1||o&&c<o.length)return t;t=i.slice(c);const u=s.slice(c-1).replaceAll(/[^/]+/g,"").length;if(u>0)for(let h=0;h<u;h++)t=`../${t}`;else t=`./${t}`;return t}function qp(t){return t=$ut(t=Mut(t=Put(t=ah(t=t.trim()))))}function bd(...t){const e=t.filter(_0);if(!e||!e.length)return;const r=[];if(fd(e[0])){const n=e[0],s=n.indexOf("//");s!==-1&&(r.push(n.slice(0,s+1)),Cut(e[0])&&(r[0]+="/"),e[0]=n.slice(s+2))}else e[0][0]==="/"&&r.push("");const i=e.reduce((n,s)=>s?n.concat(s.split("/")):n,[]);for(let n=0;n<i.length;n++){const s=i[n];s===".."&&r.length>0&&r[r.length-1]!==".."?r.pop():(!s&&n===i.length-1||s&&(s!=="."||r.length===0))&&r.push(s)}return r.join("/")}function Xm(t,e=!1){if(t==null||qw(t)||b0(t))return null;let r=t.indexOf("://");if(r===-1&&s0(t))r=2;else{if(r===-1)return null;r+=3}const i=t.indexOf("/",r);return i!==-1&&(t=t.slice(0,i)),e&&(t=uV(t,!0)),t}function fd(t){return s0(t)||Qle(t)}function qw(t){return t!=null&&t.slice(0,5)==="blob:"}function b0(t){return t!=null&&t.slice(0,5)==="data:"}function Kle(t){const e=q2(t);return e&&e.isBase64?aut(e.data):null}function cdr(t){return btoa(String.fromCharCode.apply(null,t)).replaceAll("+","-").replaceAll("/","_").replace(/=+$/,"")}const xut=/^data:(.*?)(;base64)?,(.*)$/;function q2(t){const e=t.match(xut);if(!e)return null;const[,r,i,n]=e;return{mediaType:r,isBase64:!!i,data:n}}function _$e(t){return t.isBase64?`data:${t.mediaType};base64,${t.data}`:`data:${t.mediaType},${t.data}`}function udr(t){const e=Kle(t);if(!e)return null;const r=q2(t);return new Blob([e],{type:r.mediaType})}function ddr(t,e){Sut(t,e)}function Sut(t,e){if(!t)return!1;const r=document.createElement("a");if(!("download"in r))return!1;const i=URL.createObjectURL(t);return r.download=e,r.href=i,r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i),!0}function s0(t){return t!=null&&t[0]==="/"&&t[1]==="/"}function Qle(t){return t!=null&&f$e.test(t)}function Tut(t){return t!=null&&cut.test(t)||vc.scheme==="https"&&s0(t)}function Eut(t){return t!=null&&m$e.test(t)||vc.scheme==="http"&&s0(t)}function Cut(t){return t!=null&&uut.test(t)}function ece(t){return s0(t)?`https:${t}`:t.replace(m$e,"https:")}function Rut(){return vc.scheme==="http"}function lQ(){return vc.scheme==="https"}function uV(t,e=!1){return s0(t)?t.slice(2):(t=t.replace(f$e,""),e&&t.length>1&&t[0]==="/"&&t[1]==="/"&&(t=t.slice(2)),t)}function Out(t){const e=t.indexOf("//"),r=t.indexOf("/",e+2);return r===-1?t:t.slice(0,r)}function tce(t){let e=0;if(fd(t)){const i=t.indexOf("//");i!==-1&&(e=i+2)}const r=t.lastIndexOf("/");return r<e?t:t.slice(0,r+1)}function hdr(t,e){if(!t)return"";const r=Ts(t).path.replace(/\/+$/,""),i=r.substring(r.lastIndexOf("/")+1);if(!(e!=null&&e.length))return i;const n=new RegExp(`.(${e.join("|")})$`,"ig");return i.replace(n,"")}function Aut(t){return t&&t[t.length-1]==="/"?t:`${t}/`}function b$e(t){return t.replace(/\/+$/,"")}function Put(t){if(/^https?:\/\//i.test(t)){const e=Yle(t);t=(t=e.path.replaceAll(/\/{2,}/g,"/")).replace("/","//"),e.query&&(t+=`?${e.query}`)}return t}function Mut(t){return t.replace(/^(https?:\/\/)(arcgis\.com)/i,"$1www.$2")}function $ut(t){const e=S3.httpsDomains;if(!Eut(t))return t;const r=t.indexOf("/",7);let i;if(i=r===-1?t:t.slice(0,r),i=i.toLowerCase().slice(7),dut.test(i)){if(!i.endsWith(":80"))return t;i=i.slice(0,-3),t=t.replace(":80","")}return Rut()&&i===vc.authority&&!hut.test(t)||(lQ()&&i===vc.authority||e&&e.some(n=>i===n||i.endsWith(`.${n}`))||lQ()&&!p7(t))&&(t=ece(t)),t}function cQ(t,e,r){if(!(e&&r&&t&&fd(t)))return t;const i=t.indexOf("//"),n=t.indexOf("/",i+2),s=t.indexOf(":",i+2),o=Math.min(n<0?t.length:n,s<0?t.length:s);return t.slice(i+2,o).toLowerCase()!==e.toLowerCase()?t:`${t.slice(0,i+2)}${r}${t.slice(o)}`}function uQ(t){return typeof t=="string"?new yA(ah(t)):(t.scheme||(t.scheme=vc.scheme),t)}function w$e(t){return Iut.test(t)}function x$e(t,e){const r=Ts(t),i=Object.keys(r.query||{});return i.length>0&&e&&e.warn("removeQueryParameters()",`Url query parameters are not supported, the following parameters have been removed: ${i.join(", ")}.`),r.path}function rce(t,e,r){const i=Ts(t),n=i.query||{};return n[e]=String(r),`${i.path}?${mN(n)}`}function zW(t,e){const r=Ts(t),i=r.query||{};for(const s in e)i[s]=e[s];const n=mN(i);return n?`${r.path}?${n}`:r.path}function ice(t){if(t==null)return null;const e=t.match(S$e);return e?e[2]:null}function y0e(t){if(t==null)return null;const e=t.match(S$e);return e?{path:e[1],extension:e[2]}:{path:t,extension:null}}async function pdr(t){return typeof t=="string"?q2(t)??{data:t}:new Promise((e,r)=>{const i=new FileReader;i.readAsDataURL(t),i.onload=()=>e(q2(i.result)),i.onerror=n=>r(n)})}const S$e=/([^.]*)\.([^\/]*)$/,Iut=/(^data:image\/svg|\.svg$)/i,T$e="20230626",E$e="b81703b48e0b92e492f4cc6b739af02a9af50038",C$e="4.27";let nce=C$e;nce="4.27.6";const Lut={async request(t,e){var a,l;const{default:r}=await le(()=>Promise.resolve().then(()=>VIe),void 0),i=t.options,n=i.responseType;i.signal=e==null?void 0:e.signal,i.responseType=n==="native"||n==="native-request-init"?"native-request-init":n&&["blob","json","text"].includes(n)&&((a=v$e(t.url))!=null&&a.after)?n:"array-buffer";const s=await r(t.url,i),o={data:s.data,httpStatus:s.httpStatus,ssl:s.ssl};switch((l=s.requestOptions)==null?void 0:l.responseType){case"native-request-init":return delete o.data.signal,o;case"blob":o.data=await o.data.arrayBuffer();break;case"json":o.data=new TextEncoder().encode(JSON.stringify(o.data)).buffer;break;case"text":o.data=new TextEncoder().encode(o.data).buffer}return{result:o,transferList:[o.data]}}};let Hr;function fdr(t){Hr=t}function mdr(t){const e=Hr==null?void 0:Hr.findCredential(t);return e!=null&&e.token?rce(t,"token",e.token):t}he("host-webworker");function Dut(t){return t&&t.release&&typeof t.release=="function"}function Nut(t){return t&&t.acquire&&typeof t.acquire=="function"}let il=class dQ{constructor(e,r,i,n=1,s=0){if(this._ctor=e,this._acquireFunction=r,this._releaseFunction=i,this.allocationSize=n,this._pool=new Array(s),this._initialSize=s,this._ctor)for(let o=0;o<s;o++)this._pool[o]=new this._ctor;this.allocationSize=Math.max(n,1)}destroy(){this.prune(0)}acquire(...e){let r;if(dQ.test.disabled)r=new this._ctor;else{if(this._pool.length===0){const i=this.allocationSize;for(let n=0;n<i;n++)this._pool[n]=new this._ctor}r=this._pool.pop()}return this._acquireFunction?this._acquireFunction(r,...e):Nut(r)&&r.acquire(...e),r}release(e){e&&!dQ.test.disabled&&(this._releaseFunction?this._releaseFunction(e):Dut(e)&&e.release(),this._pool.push(e))}prune(e=this._initialSize){if(!(e>=this._pool.length)){for(let r=e;r<this._pool.length;++r){const i=this._pool[r];this._dispose(i)}this._pool.length=e}}_dispose(e){e.dispose&&typeof e.dispose=="function"&&e.dispose()}};il.test={disabled:!1};function Fut(t){t.length=0}let Ku=class{constructor(e=50,r=50){this._pool=new il(Array,void 0,Fut,r,e)}acquire(){return this._pool.acquire()}release(e){this._pool.release(e)}prune(){this._pool.prune(0)}static acquire(){return VW.acquire()}static release(e){return VW.release(e)}static prune(){VW.prune()}};const VW=new Ku(100);function ydr(t){const e=[];return function*(){yield*e;for(const r of t)e.push(r),yield r}}function kut(t,e){for(const r of t)if(r!=null&&e(r))return r}function hQ(t){return t!=null&&typeof t[Symbol.iterator]=="function"}let Ri=class pQ{constructor(){this._groups=new Map}destroy(){this.removeAll()}get size(){let e=0;return this._groups.forEach(r=>{e+=r.length}),e}add(e,r){if(hQ(e)){const i=this._getOrCreateGroup(r);for(const n of e)this._isHandle(n)&&i.push(n)}else this._isHandle(e)&&this._getOrCreateGroup(r).push(e);return this}forEach(e,r){if(typeof e=="function")this._groups.forEach(i=>i.forEach(e));else{const i=this._getGroup(e);i&&r&&i.forEach(r)}}has(e){return this._groups.has(this._ensureGroupKey(e))}remove(e){if(typeof e!="string"&&hQ(e)){for(const r of e)this.remove(r);return this}return this.has(e)?(this._removeAllFromGroup(this._getGroup(e)),this._groups.delete(this._ensureGroupKey(e)),this):this}removeAll(){return this._groups.forEach(e=>this._removeAllFromGroup(e)),this._groups.clear(),this}_isHandle(e){return e&&(!!e.remove||e instanceof pQ)}_getOrCreateGroup(e){if(this.has(e))return this._getGroup(e);const r=[];return this._groups.set(this._ensureGroupKey(e),r),r}_getGroup(e){return this._groups.get(this._ensureGroupKey(e))}_ensureGroupKey(e){return e||"_default_"}_removeAllFromGroup(e){for(const r of e)r instanceof pQ?r.removeAll():r.remove()}};const R$e=Symbol("Accessor-beforeDestroy");function E_(t){return kl(()=>t.forEach(e=>e!=null&&e.remove()))}function kl(t){return{remove:()=>{t&&(t(),t=void 0)}}}function vdr(t){return kl(()=>{const e=t();e!=null&&e.remove()})}function _dr(t){return kl(t!=null?()=>t.destroy():void 0)}function Ul(t){return t.__accessor__??null}function Uut(t,e){return t!=null&&t.metadatas&&t.metadatas[e]!=null}function y8(t,e,r){return r?dV(t,e,{policy:r,path:""}):dV(t,e,null)}function dV(t,e,r){return e?Object.keys(e).reduce((i,n)=>{const s=n;let o=null,a="merge";if(r&&(o=r.path?`${r.path}.${n}`:n,a=r.policy(o)),a==="replace"||a==="replace-arrays"&&Array.isArray(i[s]))return i[s]=e[s],i;if(i[s]===void 0)return i[s]=ie(e[s]),i;let l=i[s],c=e[s];if(l===c)return i;if(Array.isArray(c)||Array.isArray(i))l=l?Array.isArray(l)?i[s]=l.concat():i[s]=[l]:i[s]=[],c&&(Array.isArray(c)||(c=[c]),c.forEach(u=>{l.includes(u)||l.push(u)}));else if(c&&typeof c=="object")if(r){const u=r.path;r.path=o,i[s]=dV(l,c,r),r.path=u}else i[s]=dV(l,c,null);else i.hasOwnProperty(n)&&!e.hasOwnProperty(n)||(i[s]=c);return i},t||{}):t}function O$e(t){return Array.isArray(t)?t:t.split(".")}function v0e(t){return t.includes(",")?t.split(",").map(e=>e.trim()):[t.trim()]}function zut(t){if(Array.isArray(t)){const e=[];for(const r of t)e.push(...v0e(r));return e}return v0e(t)}function A$e(t,e,r,i){const n=zut(e);if(n.length!==1){const s=n.map(o=>i(t,o,r));return E_(s)}return i(t,n[0],r)}function sce(t){let e=!1;return()=>{e||(e=!0,t())}}function P$e(t,e){const r=t[t.length-1]==="?"?t.slice(0,-1):t;if(e.getItemAt!=null||Array.isArray(e)){const n=parseInt(r,10);if(!isNaN(n))return Array.isArray(e)?e[n]:e.at(n)}const i=Ul(e);return Uut(i,r)?i.get(r):e[r]}function M$e(t,e,r){if(t==null)return t;const i=P$e(e[r],t);return!i&&r<e.length-1?void 0:r===e.length-1?i:M$e(i,e,r+1)}function F4(t,e,r=0){return typeof e!="string"||e.includes(".")?M$e(t,O$e(e),r):P$e(e,t)}function hV(t,e){return F4(t,e)}function _0e(t,e){return F4(e,t)!==void 0}function k4(t){let e=t.constructor.__accessorMetadata__;const r=Object.prototype.hasOwnProperty.call(t.constructor,"__accessorMetadata__");if(e){if(!r){e=Object.create(e);for(const i in e)e[i]=ie(e[i]);Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0})}}else e={},Object.defineProperty(t.constructor,"__accessorMetadata__",{value:e,enumerable:!1,configurable:!0,writable:!0});return t.constructor.__accessorMetadata__}function U4(t,e){const r=k4(t);let i=r[e];return i||(i=r[e]={}),i}function Vut(t,e){return y8(t,e,jut)}const But=/^(?:[^.]+\.)?(?:value|type|(?:json\.type|json\.origins\.[^.]\.type))$/;function jut(t){return But.test(t)?"replace":"merge"}var Uv;(function(t){t[t.INITIALIZING=0]="INITIALIZING",t[t.CONSTRUCTING=1]="CONSTRUCTING",t[t.CONSTRUCTED=2]="CONSTRUCTED"})(Uv||(Uv={}));let Gut=class{constructor(e,r){this._observers=e,this._observer=r}remove(){Ble(this._observers,this._observer)}},$$e=class{constructor(){this._observers=null,this.destroyed=!1}observe(e){if(this.destroyed||e.destroyed)return Hut;this._observers==null&&(this._observers=[]);const r=this._observers;let i=!1,n=!1;const s=r.length;for(let o=0;o<s;++o){const a=r[o];if(a.destroyed)n=!0;else if(a===e){i=!0;break}}return i||(r.push(e),n&&this._removeDestroyedObservers()),new Gut(r,e)}_removeDestroyedObservers(){const e=this._observers;if(!e||e.length===0)return;const r=e.length;let i=0;for(let n=0;n<r;++n){for(;n+i<r&&e[n+i].destroyed;)++i;if(i>0){if(!(n+i<r))break;e[n]=e[n+i]}}e.length=r-i}destroy(){if(this.destroyed)return;this.destroyed=!0;const e=this._observers;if(e!=null){for(const r of e)r.onCommitted();this._observers=null}}};const Hut=kl();var Fr;(function(t){t[t.DEFAULTS=0]="DEFAULTS",t[t.COMPUTED=1]="COMPUTED",t[t.SERVICE=2]="SERVICE",t[t.PORTAL_ITEM=3]="PORTAL_ITEM",t[t.WEB_SCENE=4]="WEB_SCENE",t[t.WEB_MAP=5]="WEB_MAP",t[t.LINK_CHART=6]="LINK_CHART",t[t.USER=7]="USER"})(Fr||(Fr={}));const fQ=Fr.USER+1;function Gv(t){switch(t){case"defaults":return Fr.DEFAULTS;case"service":return Fr.SERVICE;case"portal-item":return Fr.PORTAL_ITEM;case"web-scene":return Fr.WEB_SCENE;case"web-map":return Fr.WEB_MAP;case"link-chart":return Fr.LINK_CHART;case"user":return Fr.USER;default:return null}}function pV(t){switch(t){case Fr.DEFAULTS:return"defaults";case Fr.SERVICE:return"service";case Fr.PORTAL_ITEM:return"portal-item";case Fr.WEB_SCENE:return"web-scene";case Fr.WEB_MAP:return"web-map";case Fr.LINK_CHART:return"link-chart";case Fr.USER:return"user"}return void 0}function qut(t){return pV(t)}var ln;(function(t){t[t.Dirty=1]="Dirty",t[t.Overriden=2]="Overriden",t[t.Computing=4]="Computing",t[t.NonNullable=8]="NonNullable",t[t.HasDefaultValue=16]="HasDefaultValue",t[t.DepTrackingInitialized=32]="DepTrackingInitialized",t[t.AutoTracked=64]="AutoTracked",t[t.ExplicitlyTracking=128]="ExplicitlyTracking"})(ln||(ln={}));const fV={onObservableAccessed:()=>{},onTrackingEnd:()=>{}},Z$=[];let ZL=fV;function br(t){ZL.onObservableAccessed(t)}let v8=!1,_8=!1;function C_(t,e,r){if(v8)return oce(t,e,r);I$e(t);const i=e.call(r);return L$e(),i}function Wut(t,e){return C_(fV,t,e)}function oce(t,e,r){const i=v8;v8=!0,I$e(t);let n=null;try{n=e.call(r)}catch(s){_8&&re.getLogger("esri.core.accessorSupport.tracking").error(s)}return L$e(),v8=i,n}function I$e(t){ZL=t,Z$.push(t)}function L$e(){const t=Z$.length;if(t>1){const e=Z$.pop();ZL=Z$[t-2],e.onTrackingEnd()}else if(t===1){const e=Z$.pop();ZL=fV,e.onTrackingEnd()}else ZL=fV}function D$e(t,e){const r=e.observerObject;if(r.flags&ln.DepTrackingInitialized)return;const i=_8;_8=!1,r.flags&ln.AutoTracked?oce(e,e.metadata.get,t):N$e(t,e),_8=i}const Xut=[];function N$e(t,e){const r=e.observerObject;r.flags&ln.ExplicitlyTracking||(r.flags|=ln.ExplicitlyTracking,oce(e,()=>{const i=e.metadata.dependsOn||Xut;for(const n of i)if(typeof n!="string"||n.includes(".")){const s=O$e(n);for(let o=0,a=t;o<s.length&&a!=null&&typeof a=="object";++o)a=b0e(a,s[o],o!==s.length-1)}else b0e(t,n,!1)}),r.flags&=~ln.ExplicitlyTracking)}function b0e(t,e,r){const i=e[e.length-1]==="?"?e.slice(0,-1):e;if(t.getItemAt!=null||Array.isArray(t)){const s=parseInt(i,10);if(!isNaN(s))return Array.isArray(t)?t[s]:t.at(s)}const n=Ul(t);if(n){const s=n.propertiesByName.get(i);s&&(br(s.observerObject),D$e(t,s))}return r?t[i]:void 0}let w0e=class{constructor(e,r){this.propertyName=e,this.metadata=r,this.observerObject=new Yut,this._accessed=null,this._handles=null,this.observerObject.flags=ln.Dirty|(r.nonNullable?ln.NonNullable:0)|(r.hasOwnProperty("value")?ln.HasDefaultValue:0)|(r.get===void 0?ln.DepTrackingInitialized:0)|(r.dependsOn===void 0?ln.AutoTracked:0)}destroy(){this.observerObject.destroy(),this._accessed=null,this._clearObservationHandles()}getComputed(e){const r=this.observerObject;br(r);const i=e.store,n=this.propertyName,s=r.flags,o=i.get(n);if(s&ln.Computing||~s&ln.Dirty&&i.has(n))return o;r.flags|=ln.Computing;const a=e.host;let l;s&ln.AutoTracked?l=C_(this,this.metadata.get,a):(N$e(a,this),l=this.metadata.get.call(a)),i.set(n,l,Fr.COMPUTED);const c=i.get(n);return c===o?r.flags&=~ln.Dirty:Wut(this.commit,this),r.flags&=~ln.Computing,c}onObservableAccessed(e){if(e===this.observerObject)return;let r=this._accessed;if(r==null)r=[],this._accessed=r;else if(r.includes(e))return;r.push(e)}onTrackingEnd(){this._clearObservationHandles();const e=this.observerObject;e.flags|=ln.DepTrackingInitialized;const r=this._accessed;if(r==null||r.length===0)return;let i=this._handles;i==null&&(i=[],this._handles=i);for(let n=0;n<r.length;++n)i.push(r[n].observe(e));r.length=0}notifyChange(){const e=this.observerObject;e.onInvalidated(),e.onCommitted()}invalidate(){this.observerObject.onInvalidated()}commit(){const e=this.observerObject;e.flags&=~ln.Dirty,e.onCommitted()}_clearObservationHandles(){const e=this._handles;if(e!==null){for(let r=0;r<e.length;++r)e[r].remove();e.length=0}}},Yut=class extends $$e{constructor(){super(...arguments),this.flags=0}onInvalidated(){~this.flags&ln.Overriden&&(this.flags|=ln.Dirty);const e=this._observers;if(e&&e.length>0)for(const r of e)r.onInvalidated()}onCommitted(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onCommitted()}}destroy(){this.flags&ln.Dirty&&this.onCommitted(),super.destroy()}},Zut=class F$e{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new F$e;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,ie(i))}),r}get(e){return this._values.get(e)}originOf(){return Fr.USER}keys(){return[...this._values.keys()]}set(e,r){this._values.set(e,r)}delete(e){this._values.delete(e)}has(e){return this._values.has(e)}forEach(e){this._values.forEach(e)}};function I5(t,e,r){return t!==void 0}function x0e(t,e,r,i){return t!==void 0&&(!(r==null&&t.observerObject.flags&ln.NonNullable)||(i.lifecycle,Uv.INITIALIZING,!1))}function Jut(t){return t&&typeof t.destroy=="function"}re.getLogger("esri.core.accessorSupport.Properties");let Kut=class{constructor(e){this.host=e,this.propertiesByName=new Map,this.ctorArgs=null,this.destroyed=!1,this.lifecycle=Uv.INITIALIZING,this.store=new Zut,this._origin=Fr.USER;const r=this.host.constructor.__accessorMetadata__;for(const i in r){const n=new w0e(i,r[i]);this.propertiesByName.set(i,n)}this.metadatas=r}initialize(){this.lifecycle=Uv.CONSTRUCTING}constructed(){this.lifecycle=Uv.CONSTRUCTED}destroy(){this.destroyed=!0;for(const[e,r]of this.propertiesByName){if(r.metadata.autoDestroy){const i=this.internalGet(e);i&&Jut(i)&&(i.destroy(),~r.observerObject.flags&ln.NonNullable&&this._internalSet(r,null))}r.destroy()}}get initialized(){return this.lifecycle!==Uv.INITIALIZING}get(e){const r=this.propertiesByName.get(e);if(r.metadata.get)return r.getComputed(this);br(r.observerObject);const i=this.store;return i.has(e)?i.get(e):r.metadata.value}originOf(e){const r=this.store.originOf(e);if(r===void 0){const i=this.propertiesByName.get(e);if(i!==void 0&&i.observerObject.flags&ln.HasDefaultValue)return"defaults"}return pV(r)}has(e){return!!this.propertiesByName.has(e)&&this.store.has(e)}keys(){return[...this.propertiesByName.keys()]}internalGet(e){const r=this.propertiesByName.get(e);if(I5(r))return this.store.has(e)?this.store.get(e):r.metadata.value}internalSet(e,r){const i=this.propertiesByName.get(e);I5(i)&&this._internalSet(i,r)}getDependsInfo(e,r,i){const n=this.propertiesByName.get(r);if(!I5(n))return"";const s=new Set,o=C_({onObservableAccessed:l=>s.add(l),onTrackingEnd:()=>{}},()=>{var l;return(l=n.metadata.get)==null?void 0:l.call(e)});let a=`${i}${e.declaredClass.split(".").pop()}.${r}: ${o}
`;if(s.size===0)return a;i+="  ";for(const l of s)l instanceof w0e&&(a+=`${i}${l.propertyName}: undefined
`);return a}setAtOrigin(e,r,i){const n=this.propertiesByName.get(e);if(I5(n))return this._setAtOrigin(n,r,i)}isOverridden(e){const r=this.propertiesByName.get(e);return r!==void 0&&!!(r.observerObject.flags&ln.Overriden)}clearOverride(e){const r=this.propertiesByName.get(e),i=r==null?void 0:r.observerObject;i&&i.flags&ln.Overriden&&(i.flags&=~ln.Overriden,r.notifyChange())}override(e,r){const i=this.propertiesByName.get(e);if(!x0e(i,e,r,this))return;const n=i.metadata.cast;if(n){const s=this._cast(n,r),{valid:o,value:a}=s;if(BW.release(s),!o)return;r=a}i.observerObject.flags|=ln.Overriden,this._internalSet(i,r)}set(e,r){const i=this.propertiesByName.get(e);if(!x0e(i,e,r,this))return;const n=i.metadata.cast;if(n){const o=this._cast(n,r),{valid:a,value:l}=o;if(BW.release(o),!a)return;r=l}const s=i.metadata.set;s?s.call(this.host,r):this._internalSet(i,r)}setDefaultOrigin(e){this._origin=Gv(e)}getDefaultOrigin(){return pV(this._origin)}notifyChange(e){const r=this.propertiesByName.get(e);r!==void 0&&r.notifyChange()}invalidate(e){const r=this.propertiesByName.get(e);r!==void 0&&r.invalidate()}commit(e){const r=this.propertiesByName.get(e);r!==void 0&&r.commit()}_internalSet(e,r){const i=this.lifecycle!==Uv.INITIALIZING?this._origin:Fr.DEFAULTS;this._setAtOrigin(e,r,i)}_setAtOrigin(e,r,i){const n=this.store,s=e.propertyName;n.has(s,i)&&Gle(r,n.get(s))&&~e.observerObject.flags&ln.Overriden&&i===n.originOf(s)||(e.invalidate(),n.set(s,r,i),e.commit(),D$e(this.host,e))}_cast(e,r){const i=BW.acquire();return i.valid=!0,i.value=r,e&&(i.value=e.call(this.host,r,i)),i}},Qut=class{constructor(){this.value=null,this.valid=!0}acquire(){this.valid=!0}release(){this.value=null}};const BW=new il(Qut);function mV(t,e,r){if(t&&e)if(typeof e=="object")for(const i of Object.getOwnPropertyNames(e))mV(t,i,e[i]);else{if(e.includes(".")){const n=e.split("."),s=n.splice(n.length-1,1)[0];return void mV(hV(t,n),s,r)}const i=t.__accessor__;i!=null&&edt(e,i),t[e]=r}}function edt(t,e){if(he("esri-unknown-property-errors")&&!tdt(t,e))throw new H("set:unknown-property",rdt(t,e))}function tdt(t,e){return e.metadatas[t]!=null}function rdt(t,e){return"setting unknown property '"+t+"' on instance of "+e.host.declaredClass}let idt;function ndt(){return idt}let k$e=class extends il{constructor(){super(...arguments),this._set=new Set}destroy(){super.destroy(),this._set=x3(this._set)}acquire(...e){const r=super.acquire(...e);return this._set.delete(r),r}release(e){e&&!this._set.has(e)&&(super.release(e),this._set.add(e))}_dispose(e){this._set.delete(e),super._dispose(e)}};const L5=[];function dP(t){L5.push(t),L5.length===1&&queueMicrotask(()=>{const e=L5.slice();L5.length=0;for(const r of e)r()})}let Hv=class{constructor(e,r=30){this.name=e,this._counter=0,this._samples=new Array(r)}record(e){e!=null&&(this._samples[++this._counter%this._samples.length]=e)}get median(){return this._samples.slice().sort((e,r)=>e-r)[Math.floor(this._samples.length/2)]}get average(){return this._samples.reduce((e,r)=>e+r,0)/this._samples.length}get last(){return this._samples[this._counter%this._samples.length]}};var mQ;(function(t){const e=(s,o,a,l)=>{let c=o,u=o;const h=a>>>1,f=s[c-1];for(;u<=h;){u=c<<1,u<a&&l(s[u-1],s[u])<0&&++u;const m=s[u-1];if(l(m,f)<=0)break;s[c-1]=m,c=u}s[c-1]=f},r=(s,o)=>s<o?-1:s>o?1:0;function i(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(s,u,a,l);const c=o+1;for(let u=a-1;u>o;u--){const h=s[o];s[o]=s[u],s[u]=h,e(s,c,u,l)}}function*n(s,o,a,l){o===void 0&&(o=0),a===void 0&&(a=s.length),l===void 0&&(l=r);for(let u=a>>>1;u>o;u--)e(s,u,a,l),yield;const c=o+1;for(let u=a-1;u>o;u--){const h=s[o];s[o]=s[u],s[u]=h,e(s,c,u,l),yield}}t.sort=i,t.iterableSort=n})(mQ||(mQ={}));const S0e=mQ,sdt=1.5,odt=1.1;let dr=class{constructor(e){this.data=[],this._length=0,this._allocator=void 0,this._deallocator=()=>null,this._shrink=()=>{},this._hint=new e$e,e&&(e.initialSize&&(this.data=new Array(e.initialSize)),e.allocator&&(this._allocator=e.allocator),e.deallocator!==void 0&&(this._deallocator=e.deallocator),e.shrink&&(this._shrink=()=>T0e(this)))}toArray(){return this.data.slice(0,this.length)}filter(e){const r=new Array;for(let i=0;i<this._length;i++){const n=this.data[i];e(n)&&r.push(n)}return r}at(e){if((e=Math.trunc(e)||0)<0&&(e+=this._length),!(e<0||e>=this._length))return this.data[e]}includes(e,r){const i=this.data.indexOf(e,r);return i!==-1&&i<this.length}get length(){return this._length}set length(e){if(e>this._length){if(this._allocator){for(;this._length<e;)this.data[this._length++]=this._allocator(this.data[this._length]);return}this._length=e}else{if(this._deallocator)for(let r=e;r<this._length;++r)this.data[r]=this._deallocator(this.data[r]);this._length=e,this._shrink()}}clear(){this.length=0}prune(){this.clear(),this.data=[]}push(e){this.data[this._length++]=e}pushArray(e,r=e.length){for(let i=0;i<r;i++)this.data[this._length++]=e[i]}fill(e,r){for(let i=0;i<r;i++)this.data[this._length++]=e}pushNew(){this._allocator&&(this.data[this.length]=this._allocator(this.data[this.length]));const e=this.data[this._length];return++this._length,e}unshift(e){this.data.unshift(e),this._length++,T0e(this)}pop(){if(this.length===0)return;const e=this.data[this.length-1];return this.length=this.length-1,this._shrink(),e}remove(e){const r=oQ(this.data,e,this.length,this._hint);if(r!==-1)return this.data.splice(r,1),this.length=this.length-1,e}removeUnordered(e){return this.removeUnorderedIndex(oQ(this.data,e,this.length,this._hint))}removeUnorderedIndex(e){if(!(e>=this.length||e<0))return this.swapElements(e,this.length-1),this.pop()}removeUnorderedMany(e,r=e.length,i){this.length=Hct(this.data,e,this.length,r,this._hint,i),this._shrink()}front(){if(this.length!==0)return this.data[0]}back(){if(this.length!==0)return this.data[this.length-1]}swapElements(e,r){if(e>=this.length||r>=this.length||e===r)return;const i=this.data[e];this.data[e]=this.data[r],this.data[r]=i}sort(e){S0e.sort(this.data,0,this.length,e)}iterableSort(e){return S0e.iterableSort(this.data,0,this.length,e)}some(e,r){for(let i=0;i<this.length;++i)if(e.call(r,this.data[i],i,this.data))return!0;return!1}find(e,r){for(let i=0;i<this.length;++i){const n=this.data[i];if(e.call(r,n,i))return n}}filterInPlace(e,r){let i=0;for(let n=0;n<this._length;++n){const s=this.data[n];e.call(r,s,n,this.data)&&(this.data[n]=this.data[i],this.data[i]=s,i++)}if(this._deallocator)for(let n=i;n<this._length;n++)this.data[n]=this._deallocator(this.data[n]);return this._length=i,this._shrink(),this}forAll(e,r){const i=this.length,n=this.data;for(let s=0;s<i;++s)e.call(r,n[s],s,n)}forEach(e,r){for(let i=0;i<this.length;++i)e.call(r,this.data[i],i,this.data)}map(e,r){const i=new Array(this.length);for(let n=0;n<this.length;++n)i[n]=e.call(r,this.data[n],n,this.data);return i}reduce(e,r){let i=r;for(let n=0;n<this.length;++n)i=e(i,this.data[n],n,this.data);return i}has(e){const r=this.length,i=this.data;for(let n=0;n<r;++n)if(i[n]===e)return!0;return!1}};function T0e(t){t.data.length>sdt*t.length&&(t.data.length=Math.floor(t.length*odt))}function adt(t){return{setTimeout:(e,r)=>{const i=t.setTimeout(e,r);return{remove:()=>t.clearTimeout(i)}}}}const z4=adt(globalThis);function f7(t){return t&&(typeof t.on=="function"||typeof t.addEventListener=="function")}function V4(t,e,r){if(!f7(t))throw new TypeError("target is not a Evented or EventTarget object");if("on"in t)return t.on(e,r);if(Array.isArray(e)){const i=e.slice();for(const n of i)t.addEventListener(n,r);return{remove(){for(const n of i)t.removeEventListener(n,r)}}}return t.addEventListener(e,r),{remove(){t.removeEventListener(e,r)}}}function U$e(t,e,r){if(!f7(t))throw new TypeError("target is not a Evented or EventTarget object");if("once"in t)return t.once(e,r);const i=V4(t,e,n=>{i.remove(),r.call(t,n)});return{remove(){i.remove()}}}const ldt={Win:"Meta",Scroll:"ScrollLock",Spacebar:" ",Down:"ArrowDown",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Del:"Delete",Apps:"ContextMenu",Esc:"Escape",Multiply:"*",Add:"+",Subtract:"-",Decimal:".",Divide:"/"};function cdt({key:t}){return ldt[t]||t}function Wr(t="Aborted"){return new H("AbortError",t)}function vr(t,e="Aborted"){if(go(t))throw Wr(e)}function m7(t){return t!=null?"aborted"in t?t:t.signal:t}function go(t){const e=m7(t);return e!=null&&e.aborted}function Oa(t){if(Yn(t))throw t}function E0e(t){if(!Yn(t))throw t}function Dl(t,e){const r=m7(t);if(r!=null){if(!r.aborted)return U$e(r,"abort",()=>e());e()}}function g7(t,e){const r=m7(t);if(r!=null)return vr(r),U$e(r,"abort",()=>e(Wr()))}function ace(t,e){return m7(e)==null?t:new Promise((r,i)=>{let n=Dl(e,()=>i(Wr()));const s=()=>n=yi(n);t.then(s,s),t.then(r,i)})}function Yn(t){return(t==null?void 0:t.name)==="AbortError"}async function gQ(t){try{return await t}catch(e){if(!Yn(e))throw e;return}}async function Adr(t,e=re.getLogger("esri")){try{return await t}catch(r){Yn(r)||e.error(r)}}async function ou(t){if(!t)return;if(typeof t.forEach!="function"){const r=Object.keys(t),i=r.map(o=>t[o]),n=await ou(i),s={};return r.map((o,a)=>s[o]=n[a]),s}const e=t;return Promise.allSettled(e).then(r=>Array.from(e,(i,n)=>{const s=r[n];return s.status==="fulfilled"?{promise:i,value:s.value}:{promise:i,error:s.reason}}))}async function gV(t){return(await ou(t)).filter(e=>!!e.value).map(e=>e.value)}function gN(t,e=void 0,r){const i=new AbortController;return Dl(r,()=>i.abort()),new Promise((n,s)=>{let o=setTimeout(()=>{o=0,n(e)},t);Dl(i,()=>{o&&(clearTimeout(o),s(Wr()))})})}function Dh(t){return t&&typeof t.then=="function"}function yQ(t){return Dh(t)?t:Promise.resolve(t)}function B4(t,e=-1){let r,i,n,s,o=null;const a=(...l)=>{if(r){i=l,s&&s.reject(Wr()),s=Da();const f=s.promise;if(o){const m=o;o=null,m.abort()}return f}if(n=s||Da(),s=null,e>0){const f=new AbortController;r=yQ(t(...l,f.signal));const m=r;gN(e).then(()=>{r===m&&(s?f.abort():o=f)})}else r=1,r=yQ(t(...l));const c=()=>{const f=i;i=n=r=o=null,f!=null&&a(...f)},u=r,h=n;return u.then(c,c),u.then(h.resolve,h.reject),h.promise};return a}function Da(){let t,e;const r=new Promise((n,s)=>{t=n,e=s}),i=n=>{t(n)};return i.resolve=n=>t(n),i.reject=n=>e(n),i.timeout=(n,s)=>z4.setTimeout(()=>i.reject(s),n),i.promise=r,i}function Pdr(t,e){return t.then(e,e)}async function C0e(t){await Promise.resolve(),vr(t)}function Mdr(t){return t}function z$e(t){return 1e3*t}function lce(t){return .001*t}function udt(){return performance.now()}let ddt=class{constructor(e){this.phases=e,this.paused=!1,this.ticks=-1,this.removed=!1}},hdt=class{constructor(e){this.callback=e,this.isActive=!0}remove(){this.isActive=!1}},vQ=0,_Q=0;const RM={time:0,deltaTime:0,elapsedFrameTime:0,frameDuration:0},bQ=["prepare","preRender","render","postRender","update","finish"],wQ=[],W2=new dr;let pdt=class{constructor(e){this._task=e}remove(){this._task.removed=!0}pause(){this._task.paused=!0}resume(){this._task.paused=!1}};const yV={frameTasks:W2,willDispatch:!1,clearFrameTasks:fdt,dispatch:j$e,executeFrameTasks:gdt};function T3(t){const e=new hdt(t);return wQ.push(e),yV.willDispatch||(yV.willDispatch=!0,dP(j$e)),e}function hP(t){const e=new ddt(t);return W2.push(e),vV==null&&(vQ=performance.now(),vV=requestAnimationFrame(V$e)),new pdt(e)}let vV=null;function fdt(t=!1){W2.forAll(e=>{e.removed=!0}),t&&B$e()}function mdt(t){_Q=Math.max(0,t)}function V$e(){const t=performance.now();vV=null,vV=W2.length>0?requestAnimationFrame(V$e):null,yV.executeFrameTasks(t)}function gdt(t){const e=t-vQ;vQ=t;const r=_Q>0?_Q:1e3/60,i=Math.max(0,e-r);RM.time=t,RM.frameDuration=r-i;for(let n=0;n<bQ.length;n++){const s=performance.now(),o=bQ[n];W2.forAll(a=>{var l;a.paused||a.removed||(n===0&&a.ticks++,a.phases[o]&&(RM.elapsedFrameTime=performance.now()-t,RM.deltaTime=a.ticks===0?0:e,(l=a.phases[o])==null||l.call(a,RM)))}),ydt[n].record(performance.now()-s)}B$e(),vdt.record(performance.now()-t)}const D5=new dr;function B$e(){W2.forAll(t=>{t.removed&&D5.push(t)}),W2.removeUnorderedMany(D5.data,D5.length),D5.clear()}function j$e(){for(;wQ.length;){const t=wQ.shift();t.isActive&&t.callback()}yV.willDispatch=!1}function Ddr(t=1,e){const r=Da(),i=()=>{go(e)?r.reject(Wr()):t===0?r():(--t,dP(()=>i()))};return i(),r.promise}const ydt=bQ.map(t=>new Hv(t)),vdt=new Hv("total");function b8(t,e){for(const r of t.entries())if(e(r[0]))return!0;return!1}let _dt=0;const bdt=0;function au(){return++_dt}let y7=class{constructor(e){this._accessed=[],this._handles=[],this._observerObject=new wdt(e),R0e.register(this,new WeakRef(this._observerObject),this)}destroy(){var e;R0e.unregister(this._observerObject),this._accessed.length=0,(e=this._observerObject)==null||e.destroy(),this.clear()}onObservableAccessed(e){const r=this._accessed;r.includes(e)||r.push(e)}onTrackingEnd(){const e=this._handles,r=this._accessed,i=this._observerObject;for(let n=0;n<r.length;++n)e.push(r[n].observe(i));r.length=0}clear(){const e=this._handles;for(let r=0;r<e.length;++r)e[r].remove();e.length=0}},wdt=class{constructor(e){this._notify=e,this._invalidCount=0,this.destroyed=!1}onInvalidated(){this._invalidCount++}onCommitted(){if(this.destroyed)return;const e=this._invalidCount;if(e===1)return this._invalidCount=0,void this._notify();this._invalidCount=e>0?e-1:0}destroy(){this.destroyed=!0,this._notify=xdt}};const R0e=new FinalizationRegistry(t=>{var e;(e=t.deref())==null||e.destroy()});function xdt(){}let vA=!1;const _V=[];function G$e(t,e){let r=new y7(s),i=null,n=!1;function s(){if(!r||n)return;if(vA)return void W$e(s);const a=i;r.clear(),vA=!0,n=!0,i=C_(r,t),n=!1,vA=!1,e(i,a),X$e()}function o(){r&&(r.destroy(),r=null,i=null)}return n=!0,i=C_(r,t),n=!1,{remove:o}}function H$e(t,e){let r=new y7(n),i=null;function n(){e(i,o)}function s(){r&&(r.destroy(),r=null),i=null}function o(){return r?(r.clear(),i=C_(r,t),i):null}return o(),{remove:s}}function q$e(t){let e=new y7(i),r=!1;function i(){e&&!r&&(vA?W$e(i):(e.clear(),vA=!0,r=!0,C_(e,t),r=!1,vA=!1,X$e()))}function n(){e&&(e.destroy(),e=null)}return r=!0,C_(e,t),r=!1,{remove:n}}function W$e(t){_V.includes(t)||_V.unshift(t)}function X$e(){for(;_V.length;)_V.pop()()}var JL;(function(t){t[t.Untracked=0]="Untracked",t[t.Tracked=1]="Tracked"})(JL||(JL={}));let yN=class{constructor(){this.uid=au(),this.removed=!1,this.type=null,this.oldValue=null,this.callback=null,this.getValue=null,this.target=null,this.path=null,this.equals=null}static acquireUntracked(e,r,i,n,s){return this.pool.acquire(JL.Untracked,e,r,i,n,s,Gle)}static acquireTracked(e,r,i,n){return this.pool.acquire(JL.Tracked,e,r,i,null,null,n)}notify(e,r){this.type===JL.Untracked?this.callback.call(this.target,e,r,this.path,this.target):this.callback.call(null,e,r,void 0,void 0)}acquire(e,r,i,n,s,o,a){this.uid=au(),this.removed=!1,this.type=e,this.oldValue=r,this.callback=i,this.getValue=n,this.target=s,this.path=o,this.equals=a}release(){this.target=this.path=this.oldValue=this.callback=this.getValue=null,this.uid=au(),this.removed=!0}};yN.pool=new k$e(yN);const w8=new Ku,Kv=new Set;let bV;function wV(t){Kv.delete(t),Kv.add(t),bV||(bV=T3(Edt))}function Sdt(t){if(t.removed)return;const e=t.oldValue,r=t.getValue();t.equals(e,r)||(t.oldValue=r,t.notify(r,e))}function Tdt(t){for(const e of Kv.values())e.target===t&&(e.removed=!0)}function Edt(){let t=10;for(;bV&&t--;){bV=null;const e=Cdt(),r=w8.acquire();for(const i of e){const n=i.uid;Sdt(i),n===i.uid&&i.removed&&r.push(i)}for(const i of Kv)i.removed&&(r.push(i),Kv.delete(i));for(const i of r)yN.pool.release(i);w8.release(r),w8.release(e),xQ.forEach(i=>i())}}function Cdt(){const t=w8.acquire();t.length=Kv.size;let e=0;for(const r of Kv)t[e]=r,++e;return Kv.clear(),t}const xQ=new Set;function Y$e(t){return xQ.add(t),{remove(){xQ.delete(t)}}}function Rdt(t,e,r){let i=A$e(t,e,r,(n,s,o)=>{let a,l,c=H$e(()=>F4(n,s),(u,h)=>{n.__accessor__.destroyed||a&&a.uid!==l?i.remove():(a||(a=yN.acquireUntracked(u,o,h,n,s),l=a.uid),wV(a))});return{remove:sce(()=>{c.remove(),a&&(a.uid!==l||a.removed||(a.removed=!0,wV(a)),a=null),i=c=null})}});return i}function Odt(t,e,r){const i=A$e(t,e,r,(n,s,o)=>{let a=!1;return G$e(()=>F4(n,s),(l,c)=>{n.__accessor__.destroyed?i.remove():a||(a=!0,Gle(c,l)||o.call(n,l,c,s,n),a=!1)})});return i}function Adt(t,e,r,i=!1){return!t.__accessor__||t.__accessor__.destroyed?{remove(){}}:i?Odt(t,e,r):Rdt(t,e,r)}function Pdt(t,e,r){let i,n,s=H$e(t,(o,a)=>{i&&i.uid!==n?s.remove():(i||(i=yN.acquireTracked(o,e,a,r),n=i.uid),wV(i))});return{remove:sce(()=>{s.remove(),i&&(i.uid!==n||i.removed||(i.removed=!0,wV(i)),i=null),s=null})}}function Mdt(t,e,r){let i=!1;return G$e(t,(n,s)=>{i||(i=!0,r(s,n)||e(n,s),i=!1)})}function $dt(t,e,r=!1,i=l$e){return r?Mdt(t,e,i):Pdt(t,e,i)}function O0e(t){return b8(Kv,e=>e.oldValue===t)}function Pa(t,e){for(const[r,i]of t)if(e(i,r))return!0;return!1}function Udr(t,e){for(const[r,i]of t)if(e(i,r))return i;return null}function Z$e(t,e,r){const i=t.get(e);if(i!==void 0)return i;const n=r();return t.set(e,n),n}const _A=re.getLogger("esri.core.accessorSupport.ensureTypes");function Idt(t){return t==null?t:new Date(t)}function Ldt(t){return t==null?t:!!t}function j4(t){return t==null?t:t.toString()}function Op(t){return t==null?t:(t=parseFloat(t),isNaN(t)?0:t)}function cce(t){return t==null?t:Math.round(parseFloat(t))}function J$e(t){return t&&t.constructor&&t.constructor.__accessorMetadata__!==void 0}function xV(t,e){return e!=null&&t&&!(e instanceof t)}function K$e(t){return t&&"isCollection"in t}function A0e(t){return t&&t.Type?typeof t.Type=="function"?t.Type:t.Type.base:null}function Ddt(t,e){if(!e||!e.constructor||!K$e(e.constructor))return SQ(t,e)?e:new t(e);const r=A0e(t.prototype.itemType),i=A0e(e.constructor.prototype.itemType);return r?i?r===i?e:r.prototype.isPrototypeOf(i.prototype)?new t(e):(SQ(t,e),e):new t(e):e}function SQ(t,e){return!!J$e(e)&&(_A.error("Accessor#set","Assigning an instance of '"+(e.declaredClass||"unknown")+"' which is not a subclass of '"+v7(t)+"'"),!0)}function X2(t,e){return e==null?e:K$e(t)?Ddt(t,e):xV(t,e)?SQ(t,e)?e:new t(e):e}function v7(t){return t&&t.prototype&&t.prototype.declaredClass||"unknown"}const Ndt=new WeakMap;function Fdt(t){switch(t){case Number:return Op;case hn:return cce;case Boolean:return Ldt;case String:return j4;case Date:return Idt;default:return Z$e(Ndt,t,()=>X2.bind(null,t))}}function ls(t,e){const r=Fdt(t);return arguments.length===1?r:r(e)}function vN(t,e,r){return arguments.length===1?vN.bind(null,t):e&&(Array.isArray(e)?e.map(i=>t(i,r)):[t(e,r)])}function kdt(t,e){return arguments.length===1?vN(r=>ls(t,r)):vN(r=>ls(t,r),e)}function Q$e(t,e,r){return e!==0&&Array.isArray(r)?r.map(i=>Q$e(t,e-1,i)):t(r)}function SV(t,e,r){if(arguments.length===2)return s=>SV(t,e,s);if(!r)return r;r=Q$e(t,e,r);let i=e,n=r;for(;i>0&&Array.isArray(n);)i--,n=n[0];if(n!==void 0)for(let s=0;s<i;s++)r=[r];return r}function Udt(t,e,r){return arguments.length===2?SV(i=>ls(t,i),e):SV(i=>ls(t,i),e,r)}function eIe(t){return!!Array.isArray(t)&&!t.some(e=>{const r=typeof e;return!(r==="string"||r==="number"||r==="function"&&t.length>1)})}function TQ(t,e){if(arguments.length===2)return TQ(t).call(null,e);const r=new Set,i=t.filter(a=>typeof a!="function"),n=t.filter(a=>typeof a=="function");for(const a of t)typeof a!="string"&&typeof a!="number"||r.add(a);let s=null,o=null;return(a,l)=>{if(a==null)return a;const c=typeof a,u=c==="string"||c==="number";return u&&(r.has(a)||n.some(h=>c==="string"&&h===String||c==="number"&&h===Number))||c==="object"&&n.some(h=>!xV(a,h))?a:(u&&i.length?(s||(s=i.map(h=>typeof h=="string"?`'${h}'`:`${h}`).join(", ")),_A.error("Accessor#set",`'${a}' is not a valid value for this property, only the following values are valid: ${s}`)):typeof a=="object"&&n.length?(o||(o=n.map(h=>v7(h)).join(", ")),_A.error("Accessor#set",`'${a}' is not a valid value for this property, value must be one of ${o}`)):_A.error("Accessor#set",`'${a}' is not a valid value for this property`),l&&(l.valid=!1),null)}}function ng(t,e){if(arguments.length===2)return ng(t).call(null,e);const r={},i=[],n=[];for(const l in t.typeMap){const c=t.typeMap[l];r[l]=ls(c),i.push(v7(c)),n.push(l)}const s=()=>`'${i.join("', '")}'`,o=()=>`'${n.join("', '")}'`,a=typeof t.key=="string"?l=>l[t.key]:t.key;return l=>{if(t.base&&!xV(t.base,l)||l==null)return l;const c=a(l)||t.defaultKeyValue,u=r[c];if(!u)return _A.error("Accessor#set",`Invalid property value, value needs to be one of ${s()}, or a plain object that can autocast (having .type = ${o()})`),null;if(!xV(t.typeMap[c],l))return l;if(typeof t.key=="string"&&!J$e(l)){const h={};for(const f in l)f!==t.key&&(h[f]=l[f]);return u(h)}return u(l)}}let hn=class{};const Vdr={native:t=>({type:"native",value:t}),array:t=>({type:"array",value:t}),oneOf:t=>({type:"one-of",values:t})};function zdt(t){if(!t||!("type"in t))return!1;switch(t.type){case"native":case"array":case"one-of":return!0}return!1}function tIe(t){switch(t.type){case"native":return ls(t.value);case"array":return vN(tIe(t.value));case"one-of":return Vdt(t);default:return null}}function Vdt(t){let e=null;return(r,i)=>CQ(r,t)?r:(e==null&&(e=EQ(t)),_A.error("Accessor#set",`Invalid property value, value needs to be of type ${e}`),i&&(i.valid=!1),null)}function EQ(t){switch(t.type){case"native":switch(t.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case hn:return"integer";case Date:return"date";default:return v7(t.value)}case"array":return`array of ${EQ(t.value)}`;case"one-of":{const e=t.values.map(r=>EQ(r));return`one of ${e.slice(0,e.length-1)} or ${e[e.length-1]}`}}return"unknown"}function CQ(t,e){if(t==null)return!0;switch(e.type){case"native":switch(e.value){case Number:case hn:return typeof t=="number";case Boolean:return typeof t=="boolean";case String:return typeof t=="string"}return t instanceof e.value;case"array":return!!Array.isArray(t)&&!t.some(r=>!CQ(r,e.value));case"one-of":return e.values.some(r=>CQ(t,r))}}function p(t={}){return(e,r)=>{if(e===Function.prototype)throw new Error(`Inappropriate use of @property() on a static field: ${e.name}.${r}. Accessor does not support static properties.`);const i=Object.getOwnPropertyDescriptor(e,r),n=U4(e,r);i&&(i.get||i.set?(n.get=i.get||n.get,n.set=i.set||n.set):"value"in i&&("value"in t&&re.getLogger("esri.core.accessorSupport.decorators.property").warn(`@property() will redefine the value of "${r}" on "${e.constructor.name}" already defined in the metadata`,t),n.value=t.value=i.value)),t.readOnly!=null&&(n.readOnly=t.readOnly);const s=t.aliasOf;if(s){const l=typeof s=="string"?s:s.source,c=typeof s=="string"?null:s.overridable===!0;let u;n.dependsOn=[l],n.get=function(){let h=hV(this,l);if(typeof h=="function"){u||(u=l.split(".").slice(0,-1).join("."));const f=hV(this,u);f&&(h=h.bind(f))}return h},n.readOnly||(n.set=c?function(h){this._override(r,h)}:function(h){mV(this,l,h)})}const o=t.type,a=t.types;n.cast||(o?n.cast=Bdt(o):a&&(Array.isArray(a)?n.cast=vN(ng(a[0])):n.cast=ng(a))),Vut(n,t),t.range&&(n.cast=jdt(n.cast,t.range))}}function uce(t,e,r){const i=U4(t,r);i.json||(i.json={});let n=i.json;return e!==void 0&&(n.origins||(n.origins={}),n.origins[e]||(n.origins[e]={}),n=n.origins[e]),n}function Bdt(t){let e=0,r=t;if(zdt(t))return tIe(t);for(;Array.isArray(r)&&r.length===1&&typeof r[0]!="string"&&typeof r[0]!="number";)r=r[0],e++;const i=r;if(eIe(i))return e===0?TQ(i):SV(TQ(i),e);if(e===1)return kdt(i);if(e>1)return Udt(i,e);const n=t;return n.from?n.from:ls(n)}function jdt(t,e){return r=>{let i=+t(r);return e.step!=null&&(i=Math.round(i/e.step)*e.step),e.min!=null&&(i=Math.max(e.min,i)),e.max!=null&&(i=Math.min(e.max,i)),i}}function Gdt(t){if(t.json&&t.json.origins){const e=t.json.origins,r={"web-document":["web-scene","web-map"]};for(const i in r)if(e[i]){const n=e[i];r[i].forEach(s=>{e[s]=n}),delete e[i]}}}let nf=class extends h$e{constructor(e,r,i){super(e,r,i)}};nf.prototype.type="warning";function rIe(t){return!!t&&t.prototype&&t.prototype.declaredClass&&t.prototype.declaredClass.indexOf("esri.core.Collection")===0}const RQ=re.getLogger("esri.core.accessorSupport.extensions.serializableProperty.reader");function P0e(t,e,r){var i,n;t&&(!r&&!e.read||(i=e.read)!=null&&i.reader||((n=e.read)==null?void 0:n.enabled)===!1||Wdt(t)&&Rc("read.reader",E3(t),e))}function E3(t){var r,i;const e=t.ndimArray??0;if(e>1)return qdt(t);if(e===1)return M0e(t);if("type"in t&&nIe(t.type)){const n=(i=(r=t.type.prototype)==null?void 0:r.itemType)==null?void 0:i.Type,s=M0e(typeof n=="function"?{type:n}:{types:n});return(o,a,l)=>{const c=s(o,a,l);return c&&new t.type(c)}}return dce(t)}function dce(t){return"type"in t?Hdt(t.type):Xdt(t.types)}function Hdt(t){return t.prototype.read?(e,r,i)=>{if(e==null)return e;const n=typeof e;if(n!=="object")return void RQ.error(`Expected JSON value of type 'object' to deserialize type '${t.prototype.declaredClass}', but got '${n}'`);const s=new t;return s.read(e,i),s}:t.fromJSON}function iIe(t,e,r,i){return i!==0&&Array.isArray(e)?e.map(n=>iIe(t,n,r,i-1)):t(e,void 0,r)}function qdt(t){const e=dce(t),r=iIe.bind(null,e),i=t.ndimArray??0;return(n,s,o)=>{if(n==null)return n;n=r(n,o,i);let a=i,l=n;for(;a>0&&Array.isArray(l);)a--,l=l[0];if(l!==void 0)for(let c=0;c<a;c++)n=[n];return n}}function M0e(t){const e=dce(t);return(r,i,n)=>{if(r==null)return r;if(Array.isArray(r)){const o=[];for(const a of r){const l=e(a,void 0,n);l!==void 0&&o.push(l)}return o}const s=e(r,void 0,n);return s!==void 0?[s]:void 0}}function nIe(t){if(!rIe(t))return!1;const e=t.prototype.itemType;return!(!e||!e.Type)&&(typeof e.Type=="function"?hce(e.Type):sIe(e.Type))}function Wdt(t){return"types"in t?sIe(t.types):hce(t.type)}function hce(t){return!Array.isArray(t)&&!!t&&t.prototype&&("read"in t.prototype||"fromJSON"in t||nIe(t))}function sIe(t){for(const e in t.typeMap)if(!hce(t.typeMap[e]))return!1;return!0}function Xdt(t){let e=null;const r=t.errorContext??"type";return(i,n,s)=>{if(i==null)return i;const o=typeof i;if(o!=="object")return void RQ.error(`Expected JSON value of type 'object' to deserialize, but got '${o}'`);e||(e=Ydt(t));const a=t.key;if(typeof a!="string")return;const l=i[a],c=l?e[l]:t.defaultKeyValue?t.typeMap[t.defaultKeyValue]:void 0;if(!c){const h=`Type '${l||"unknown"}' is not supported`;return s&&s.messages&&i&&s.messages.push(new nf(`${r}:unsupported`,h,{definition:i,context:s})),void RQ.error(h)}const u=new c;return u.read(i,s),u}}function Ydt(t){var r,i;const e={};for(const n in t.typeMap){const s=t.typeMap[n],o=k4(s.prototype);if(typeof t.key=="function")continue;const a=o[t.key];if(!a)continue;(r=a.json)!=null&&r.type&&Array.isArray(a.json.type)&&a.json.type.length===1&&typeof a.json.type[0]=="string"&&(e[a.json.type[0]]=s);const l=(i=a.json)==null?void 0:i.write;if(!l||!l.writer){e[n]=s;continue}const c=l.target,u=typeof c=="string"?c:t.key,h={};l.writer(n,h,u),h[u]&&(e[h[u]]=s)}return e}function Zdt(t){if(t.json||(t.json={}),I0e(t.json),L0e(t.json),$0e(t.json),t.json.origins)for(const e in t.json.origins)I0e(t.json.origins[e]),L0e(t.json.origins[e]),$0e(t.json.origins[e]);return!0}function $0e(t){t.name&&(t.read&&typeof t.read=="object"?t.read.source===void 0&&(t.read.source=t.name):t.read={source:t.name},t.write&&typeof t.write=="object"?t.write.target===void 0&&(t.write.target=t.name):t.write={target:t.name})}function I0e(t){typeof t.read=="boolean"?t.read={enabled:t.read}:typeof t.read=="function"?t.read={enabled:!0,reader:t.read}:t.read&&typeof t.read=="object"&&t.read.enabled===void 0&&(t.read.enabled=!0)}function L0e(t){typeof t.write=="boolean"?t.write={enabled:t.write}:typeof t.write=="function"?t.write={enabled:!0,writer:t.write}:t.write&&typeof t.write=="object"&&t.write.enabled===void 0&&(t.write.enabled=!0)}function D0e(t,e){if(!e.write||e.write.writer||e.write.enabled===!1&&!e.write.overridePolicy)return;const r=(t==null?void 0:t.ndimArray)??0;t&&(r===1||"type"in t&&rIe(t.type))?e.write.writer=Qdt:r>1?e.write.writer=eht(r):e.types?Array.isArray(e.types)?e.write.writer=Kdt(e.types[0]):e.write.writer=Jdt(e.types):e.write.writer=_N}function Jdt(t){return(e,r,i,n)=>e?oIe(e,t,n)?_N(e,r,i,n):void 0:_N(e,r,i,n)}function oIe(t,e,r){for(const i in e.typeMap)if(t instanceof e.typeMap[i])return!0;if(r!=null&&r.messages){const i=e.errorContext??"type",n=`Values of type '${(typeof e.key!="function"?t[e.key]:t.declaredClass)??"Unknown"}' cannot be written`;r&&r.messages&&t&&r.messages.push(new H(`${i}:unsupported`,n,{definition:t,context:r})),re.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(n)}return!1}function Kdt(t){return(e,r,i,n)=>!e||!Array.isArray(e)?_N(e,r,i,n):_N(e.filter(s=>oIe(s,t,n)),r,i,n)}function _N(t,e,r,i){Rc(r,TV(t,i),e)}function TV(t,e){return t&&typeof t.write=="function"?t.write({},e):t&&typeof t.toJSON=="function"?t.toJSON():typeof t=="number"?EV(t):t}function EV(t){return t===-1/0?-Number.MAX_VALUE:t===1/0?Number.MAX_VALUE:isNaN(t)?null:t}function Qdt(t,e,r,i){let n;t===null?n=null:t&&typeof t.map=="function"?(n=t.map(s=>TV(s,i)),typeof n.toArray=="function"&&(n=n.toArray())):n=[TV(t,i)],Rc(r,n,e)}function aIe(t,e,r){return r!==0&&Array.isArray(t)?t.map(i=>aIe(i,e,r-1)):TV(t,e)}function eht(t){return(e,r,i,n)=>{let s;if(e===null)s=null;else{s=aIe(e,n,t);let o=t,a=s;for(;o>0&&Array.isArray(a);)o--,a=a[0];if(a!==void 0)for(let l=0;l<o;l++)s=[s]}Rc(i,s,r)}}function tht(t,e){return pce(t,"any",e==null?void 0:e.origin)}function OQ(t,e){return pce(t,"read",e==null?void 0:e.origin)}function lIe(t,e){return pce(t,"write",e==null?void 0:e.origin)}function pce(t,e,r){let i=t==null?void 0:t.json;if(i!=null&&i.origins&&r){let n;n=r==="link-chart"?i.origins[r]&&(e==="any"||e in i.origins[r])?i.origins[r]:i.origins["web-map"]:i.origins[r],n&&(e==="any"||e in n)&&(i=n)}return i}function rht(t){const e=iht(t);if(t.json.origins)for(const r in t.json.origins){const i=t.json.origins[r],n=i.types?nht(i):e;P0e(n,i,!1),i.types&&!i.write&&t.json.write&&t.json.write.enabled&&(i.write={...t.json.write}),D0e(n,i)}P0e(e,t.json,!0),D0e(e,t.json)}function iht(t){return t.json.types?AQ(t.json):t.type?cIe(t):AQ(t)}function nht(t){return t.type?cIe(t):AQ(t)}function cIe(t){if(!t.type)return;let e=0,r=t.type;for(;Array.isArray(r)&&!eIe(r);)r=r[0],e++;return{type:r,ndimArray:e}}function AQ(t){if(!t.types)return;let e=0,r=t.types;for(;Array.isArray(r);)r=r[0],e++;return{types:r,ndimArray:e}}function sht(t){Zdt(t)&&(Gdt(t),rht(t))}const jW=new Set,GW=new Set;function I(t){return e=>{e.prototype.declaredClass=t,aht(e);const r=[],i=[];let n=e.prototype;for(;n;)n.hasOwnProperty("initialize")&&!jW.has(n.initialize)&&(jW.add(n.initialize),r.push(n.initialize)),n.hasOwnProperty("destroy")&&!GW.has(n.destroy)&&(GW.add(n.destroy),i.push(n.destroy)),n=Object.getPrototypeOf(n);jW.clear(),GW.clear();class s extends e{constructor(...a){if(super(...a),this.constructor===s&&typeof this.postscript=="function"){if(r.length&&Object.defineProperty(this,"initialize",{enumerable:!1,configurable:!0,value(){for(let l=r.length-1;l>=0;l--)r[l].call(this)}}),i.length){let l=!1;const c=this[R$e];Object.defineProperty(this,"destroy",{enumerable:!1,configurable:!0,value(){if(!l){l=!0,c.call(this);for(let u=0;u<i.length;u++)i[u].call(this)}}})}this.postscript(...a)}}}return s.__accessorMetadata__=k4(e.prototype),s.prototype.declaredClass=t,s}}function oht(t,e){return e.get==null?function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i===void 0)return;br(i.observerObject);const n=r.store;return n.has(t)?n.get(t):i.metadata.value}:function(){const r=this.__accessor__,i=r.propertiesByName.get(t);if(i!==void 0)return i.getComputed(r)}}function aht(t){const e=t.prototype,r=k4(e),i={};for(const n of Object.getOwnPropertyNames(r)){const s=r[n];sht(s),i[n]={enumerable:!0,configurable:!0,get:oht(n,s),set(o){const a=this.__accessor__;if(a!==void 0){if(!Object.isFrozen(this)){if(a.initialized&&s.readOnly)throw new TypeError(`[accessor] cannot assign to read-only property '${n}' of ${this.declaredClass}`);if(a.lifecycle===Uv.CONSTRUCTED&&s.constructOnly)throw new TypeError(`[accessor] cannot assign to construct-only property '${n}' of ${this.declaredClass}`);a.set(n,o)}}else Object.defineProperty(this,n,{enumerable:!0,configurable:!0,writable:!0,value:o})}}}Object.defineProperties(t.prototype,i)}var uIe,dIe;function lht(t){var e;if(t==null)return{value:t};if(Array.isArray(t))return{type:[t[0]],value:null};switch(typeof t){case"object":return(e=t.constructor)!=null&&e.__accessorMetadata__||t instanceof Date?{type:t.constructor,value:t}:t;case"boolean":return{type:Boolean,value:t};case"string":return{type:String,value:t};case"number":return{type:Number,value:t};case"function":return{type:t,value:null};default:return}}const K1=Symbol("Accessor-Handles"),PQ=Symbol("Accessor-Initialized");let Ce=class hIe{static createSubclass(e={}){if(Array.isArray(e))throw new Error("Multi-inheritance unsupported since 4.16");const{properties:r,declaredClass:i,constructor:n}=e;delete e.declaredClass,delete e.properties,delete e.constructor;const s=this;class o extends s{constructor(...l){super(...l),this.inherited=null,n&&n.apply(this,l)}}k4(o.prototype);for(const a in e){const l=e[a];o.prototype[a]=typeof l=="function"?function(...c){const u=this.inherited;let h;this.inherited=function(...f){if(s.prototype[a])return s.prototype[a].apply(this,f)};try{h=l.apply(this,c)}catch(f){throw this.inherited=u,f}return this.inherited=u,h}:e[a]}for(const a in r){const l=lht(r[a]);p(l)(o.prototype,a)}return I(i)(o)}constructor(...e){if(this[uIe]=null,this[dIe]=!1,this.constructor===hIe)throw new Error("[accessor] cannot instantiate Accessor. This can be fixed by creating a subclass of Accessor");const r=new Kut(this);Object.defineProperty(this,"__accessor__",{enumerable:!1,value:r}),e.length>0&&this.normalizeCtorArgs&&(r.ctorArgs=this.normalizeCtorArgs.apply(this,e)),N0e.register(this,r.propertiesByName,this)}postscript(e){const r=this.__accessor__,i=r.ctorArgs||e;r.initialize(),i&&(this.set(i),r.ctorArgs=null),r.constructed(),this.initialize(),this[PQ]=!0}initialize(){}[R$e](){this[K1]=qe(this[K1])}destroy(){var e;this.destroyed||(N0e.unregister(this),Tdt(this),this.__accessor__.destroy(),(e=ndt())==null||e.onInstanceDestroy(this))}get constructed(){return this.__accessor__&&this.__accessor__.initialized||!1}get initialized(){return this[PQ]}get destroyed(){return this.__accessor__&&this.__accessor__.destroyed||!1}commitProperty(e){this.get(e)}get(e){return hV(this,e)}hasOwnProperty(e){return this.__accessor__?this.__accessor__.has(e):Object.prototype.hasOwnProperty.call(this,e)}keys(){return this.__accessor__?this.__accessor__.keys():[]}set(e,r){return mV(this,e,r),this}watch(e,r,i){return Adt(this,e,r,i)}own(e){this.addHandles(e)}addHandles(e,r){if(this.destroyed){const n=Array.isArray(e)?e:[e];for(const s of n)s.remove();return}let i=this[K1];i==null&&(i=this[K1]=new Ri),i.add(e,r)}removeHandles(e){const r=this[K1];r!=null&&r.remove(e)}removeAllHandles(){const e=this[K1];e!=null&&e.removeAll()}hasHandles(e){const r=this[K1];return r!=null&&r.has(e)}_override(e,r){r===void 0?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_clearOverride(e){return this.__accessor__.clearOverride(e)}_overrideIfSome(e,r){r==null?this.__accessor__.clearOverride(e):this.__accessor__.override(e,r)}_isOverridden(e){return this.__accessor__.isOverridden(e)}notifyChange(e){this.__accessor__.notifyChange(e)}_get(e){return this.__accessor__.internalGet(e)}_set(e,r){return this.__accessor__.internalSet(e,r),this}};uIe=K1,dIe=PQ;const N0e=new FinalizationRegistry(t=>{for(const e of t.values())e.destroy()});let x8=class pIe{constructor(){this._emitter=new pIe.EventEmitter(this)}emit(e,r){return this._emitter.emit(e,r)}on(e,r){return this._emitter.on(e,r)}once(e,r){return this._emitter.once(e,r)}hasEventListener(e){return this._emitter.hasEventListener(e)}};(function(t){class e{constructor(n=null){this._target=n,this._listenersMap=null}clear(){var n;(n=this._listenersMap)==null||n.clear(),this._listenersMap=null}destroy(){this.clear()}emit(n,s){const o=this._listenersMap&&this._listenersMap.get(n);if(!o)return!1;const a=this._target||this;return[...o].forEach(l=>{l.call(a,s)}),o.length>0}on(n,s){if(Array.isArray(n)){const a=n.map(l=>this.on(l,s));return E_(a)}if(n.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap||(this._listenersMap=new Map);const o=this._listenersMap.get(n)||[];return o.push(s),this._listenersMap.set(n,o),{remove:()=>{const a=this._listenersMap&&this._listenersMap.get(n)||[],l=a.indexOf(s);l>=0&&a.splice(l,1)}}}once(n,s){const o=this.on(n,a=>{o.remove(),s.call(null,a)});return o}hasEventListener(n){const s=this._listenersMap&&this._listenersMap.get(n);return s!=null&&s.length>0}}t.EventEmitter=e,t.EventedMixin=i=>{let n=class extends i{constructor(){super(...arguments),this._emitter=new e}destroy(){this._emitter.clear()}emit(s,o){return this._emitter.emit(s,o)}on(s,o){return this._emitter.on(s,o)}once(s,o){return this._emitter.once(s,o)}hasEventListener(s){return this._emitter.hasEventListener(s)}};return n=d([I("esri.core.Evented")],n),n};let r=class extends Ce{constructor(){super(...arguments),this._emitter=new x8.EventEmitter(this)}destroy(){this._emitter.clear()}emit(i,n){return this._emitter.emit(i,n)}on(i,n){return this._emitter.on(i,n)}once(i,n){return this._emitter.once(i,n)}hasEventListener(i){return this._emitter.hasEventListener(i)}};r=d([I("esri.core.Evented")],r),t.EventedAccessor=r})(x8||(x8={}));const pn=x8;var Mi;(function(t){t[t.ADD=1]="ADD",t[t.REMOVE=2]="REMOVE",t[t.MOVE=4]="MOVE"})(Mi||(Mi={}));function fce(t){return(e,r)=>{e[r]=t}}let _7=class extends $$e{notify(){const e=this._observers;if(e&&e.length>0){const r=e.slice();for(const i of r)i.onInvalidated(),i.onCommitted()}}};var Dv;let cht=class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}};const Uh=new il(cht,void 0,t=>{t.item=null,t.target=null,t.defaultPrevented=!1,t.cancellable=!1}),uht=()=>{};function HW(t){return t?t instanceof LT?t.toArray():t.length?Array.prototype.slice.apply(t):[]:[]}function qW(t){if(t&&t.length)return t[0]}function dht(t,e,r,i){const n=Math.min(t.length-r,e.length-i);let s=0;for(;s<n&&t[r+s]===e[i+s];)s++;return s}function fIe(t,e,r,i){e&&e.forEach((n,s,o)=>{t.push(n),fIe(t,r.call(i,n,s,o),r,i)})}const m1=new Set,g1=new Set,y1=new Set,WW=new Map;let hht=0,LT=Dv=class extends pn.EventedAccessor{static isCollection(t){return t!=null&&t instanceof Dv}constructor(t){super(t),this._chgListeners=[],this._notifications=null,this._timer=null,this._observable=new _7,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:hht++})}normalizeCtorArgs(t){return t?Array.isArray(t)||t instanceof Dv?{items:t}:t:{}}destroy(){this._removeAllRaw()}*[Symbol.iterator](){yield*this.items}get items(){return br(this._observable),this._items}set items(t){this._emitBeforeChanges(Mi.ADD)||(this._splice(0,this.length,HW(t)),this._emitAfterChanges(Mi.ADD))}hasEventListener(t){return t==="change"?this._chgListeners.length>0:this._emitter.hasEventListener(t)}on(t,e){if(t==="change"){const r=this._chgListeners,i={removed:!1,callback:e};return r.push(i),this._notifications&&this._notifications.push({listeners:r.slice(),items:this._items.slice(),changes:[]}),{remove(){this.remove=uht,i.removed=!0,r.splice(r.indexOf(i),1)}}}return this._emitter.on(t,e)}once(t,e){const r=this.on(t,e);return{remove(){r.remove()}}}add(t,e){if(br(this._observable),this._emitBeforeChanges(Mi.ADD))return this;const r=this.getNextIndex(e??null);return this._splice(r,0,[t]),this._emitAfterChanges(Mi.ADD),this}addMany(t,e=this._items.length){if(br(this._observable),!t||!t.length)return this;if(this._emitBeforeChanges(Mi.ADD))return this;const r=this.getNextIndex(e);return this._splice(r,0,HW(t)),this._emitAfterChanges(Mi.ADD),this}at(t){if(br(this._observable),(t=Math.trunc(t)||0)<0&&(t+=this.length),!(t<0||t>=this.length))return this._items[t]}removeAll(){if(br(this._observable),!this.length||this._emitBeforeChanges(Mi.REMOVE))return[];const t=this._removeAllRaw();return this._emitAfterChanges(Mi.REMOVE),t}_removeAllRaw(){return this.length===0?[]:this._splice(0,this.length)||[]}clone(){return br(this._observable),this._createNewInstance({items:this._items.map(ie)})}concat(...t){br(this._observable);const e=t.map(HW);return this._createNewInstance({items:this._items.concat(...e)})}drain(t,e){if(br(this._observable),!this.length||this._emitBeforeChanges(Mi.REMOVE))return;const r=this._splice(0,this.length),i=r.length;for(let n=0;n<i;n++)t.call(e,r[n],n,r);this._emitAfterChanges(Mi.REMOVE)}every(t,e){return br(this._observable),this._items.every(t,e)}filter(t,e){let r;return br(this._observable),r=arguments.length===2?this._items.filter(t,e):this._items.filter(t),this._createNewInstance({items:r})}find(t,e){return br(this._observable),this._items.find(t,e)}findIndex(t,e){return br(this._observable),this._items.findIndex(t,e)}flatten(t,e){br(this._observable);const r=[];return fIe(r,this,t,e),new Dv(r)}forEach(t,e){return br(this._observable),this._items.forEach(t,e)}getItemAt(t){return br(this._observable),this._items[t]}getNextIndex(t){br(this._observable);const e=this.length;return(t=t??e)<0?t=0:t>e&&(t=e),t}includes(t,e=0){return br(this._observable),this._items.includes(t,e)}indexOf(t,e=0){return br(this._observable),this._items.indexOf(t,e)}join(t=","){return br(this._observable),this._items.join(t)}lastIndexOf(t,e=this.length-1){return br(this._observable),this._items.lastIndexOf(t,e)}map(t,e){br(this._observable);const r=this._items.map(t,e);return new Dv({items:r})}reorder(t,e=this.length-1){br(this._observable);const r=this.indexOf(t);if(r!==-1){if(e<0?e=0:e>=this.length&&(e=this.length-1),r!==e){if(this._emitBeforeChanges(Mi.MOVE))return t;this._splice(r,1),this._splice(e,0,[t]),this._emitAfterChanges(Mi.MOVE)}return t}}pop(){if(br(this._observable),!this.length||this._emitBeforeChanges(Mi.REMOVE))return;const t=qW(this._splice(this.length-1,1));return this._emitAfterChanges(Mi.REMOVE),t}push(...t){return br(this._observable),this._emitBeforeChanges(Mi.ADD)||(this._splice(this.length,0,t),this._emitAfterChanges(Mi.ADD)),this.length}reduce(t,e){br(this._observable);const r=this._items;return arguments.length===2?r.reduce(t,e):r.reduce(t)}reduceRight(t,e){br(this._observable);const r=this._items;return arguments.length===2?r.reduceRight(t,e):r.reduceRight(t)}remove(t){return br(this._observable),this.removeAt(this.indexOf(t))}removeAt(t){if(br(this._observable),t<0||t>=this.length||this._emitBeforeChanges(Mi.REMOVE))return;const e=qW(this._splice(t,1));return this._emitAfterChanges(Mi.REMOVE),e}removeMany(t){if(br(this._observable),!t||!t.length||this._emitBeforeChanges(Mi.REMOVE))return[];const e=t instanceof Dv?t.toArray():t,r=this._items,i=[],n=e.length;for(let s=0;s<n;s++){const o=e[s],a=r.indexOf(o);if(a>-1){const l=1+dht(e,r,s+1,a+1),c=this._splice(a,l);c&&c.length>0&&i.push.apply(i,c),s+=l-1}}return this._emitAfterChanges(Mi.REMOVE),i}reverse(){if(br(this._observable),this._emitBeforeChanges(Mi.MOVE))return this;const t=this._splice(0,this.length);return t&&(t.reverse(),this._splice(0,0,t)),this._emitAfterChanges(Mi.MOVE),this}shift(){if(br(this._observable),!this.length||this._emitBeforeChanges(Mi.REMOVE))return;const t=qW(this._splice(0,1));return this._emitAfterChanges(Mi.REMOVE),t}slice(t=0,e=this.length){return br(this._observable),this._createNewInstance({items:this._items.slice(t,e)})}some(t,e){return br(this._observable),this._items.some(t,e)}sort(t){if(br(this._observable),!this.length||this._emitBeforeChanges(Mi.MOVE))return this;const e=this._splice(0,this.length);return arguments.length?e.sort(t):e.sort(),this._splice(0,0,e),this._emitAfterChanges(Mi.MOVE),this}splice(t,e,...r){br(this._observable);const i=(e?Mi.REMOVE:0)|(r.length?Mi.ADD:0);if(this._emitBeforeChanges(i))return[];const n=this._splice(t,e,r)||[];return this._emitAfterChanges(i),n}toArray(){return br(this._observable),this._items.slice()}toJSON(){return br(this._observable),this.toArray()}toLocaleString(){return br(this._observable),this._items.toLocaleString()}toString(){return br(this._observable),this._items.toString()}unshift(...t){return br(this._observable),!t.length||this._emitBeforeChanges(Mi.ADD)||(this._splice(0,0,t),this._emitAfterChanges(Mi.ADD)),this.length}_createNewInstance(t){return new this.constructor(t)}_splice(t,e,r){const i=this._items,n=this.itemType;let s,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._timer=T3(()=>this._dispatchChange())),e){if(o=i.splice(t,e),this.hasEventListener("before-remove")){const a=Uh.acquire();a.target=this,a.cancellable=!0;for(let l=0,c=o.length;l<c;l++)s=o[l],a.reset(s),this.emit("before-remove",a),a.defaultPrevented&&(o.splice(l,1),i.splice(t,0,s),t+=1,l-=1,c-=1);Uh.release(a)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const a=Uh.acquire();a.target=this,a.cancellable=!1;const l=o.length;for(let c=0;c<l;c++)a.reset(o[c]),this.emit("after-remove",a);Uh.release(a)}}if(r&&r.length){if(n){const u=[];for(const h of r){const f=n.ensureType(h);f==null&&h!=null||u.push(f)}r=u}const a=this.hasEventListener("before-add"),l=this.hasEventListener("after-add"),c=t===this.length;if(a||l){const u=Uh.acquire();u.target=this,u.cancellable=!0;const h=Uh.acquire();h.target=this,h.cancellable=!1;for(const f of r)a?(u.reset(f),this.emit("before-add",u),u.defaultPrevented||(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),l&&(h.reset(f),this.emit("after-add",h)))):(c?i.push(f):i.splice(t++,0,f),this._set("length",i.length),h.reset(f),this.emit("after-add",h));Uh.release(h),Uh.release(u)}else{if(c)for(const u of r)i.push(u);else i.splice(t,0,...r);this._set("length",i.length)}}return(r&&r.length||o&&o.length)&&this._notifyChangeEvent(r,o),o}_emitBeforeChanges(t){let e=!1;if(this.hasEventListener("before-changes")){const r=Uh.acquire();r.target=this,r.cancellable=!0,r.type=t,this.emit("before-changes",r),e=r.defaultPrevented,Uh.release(r)}return e}_emitAfterChanges(t){if(this.hasEventListener("after-changes")){const e=Uh.acquire();e.target=this,e.cancellable=!1,e.type=t,this.emit("after-changes",e),Uh.release(e)}this._observable.notify()}_notifyChangeEvent(t,e){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:t,removed:e})}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),!this._notifications)return;const t=this._notifications;this._notifications=null;for(const e of t){const r=e.changes;m1.clear(),g1.clear(),y1.clear();for(const{added:l,removed:c}of r){if(l)if(y1.size===0&&g1.size===0)for(const u of l)m1.add(u);else for(const u of l)g1.has(u)?(y1.add(u),g1.delete(u)):y1.has(u)||m1.add(u);if(c)if(y1.size===0&&m1.size===0)for(const u of c)g1.add(u);else for(const u of c)m1.has(u)?m1.delete(u):(y1.delete(u),g1.add(u))}const i=Ku.acquire();m1.forEach(l=>{i.push(l)});const n=Ku.acquire();g1.forEach(l=>{n.push(l)});const s=this._items,o=e.items,a=Ku.acquire();if(y1.forEach(l=>{o.indexOf(l)!==s.indexOf(l)&&a.push(l)}),e.listeners&&(i.length||n.length||a.length)){const l={target:this,added:i,removed:n,moved:a},c=e.listeners.length;for(let u=0;u<c;u++){const h=e.listeners[u];h.removed||h.callback.call(this,l)}}Ku.release(i),Ku.release(n),Ku.release(a)}m1.clear(),g1.clear(),y1.clear()}};LT.ofType=t=>{if(!t)return Dv;if(WW.has(t))return WW.get(t);let e=null;if(typeof t=="function")e=t.prototype.declaredClass;else if(t.base)e=t.base.prototype.declaredClass;else for(const i in t.typeMap){const n=t.typeMap[i].prototype.declaredClass;e?e+=` | ${n}`:e=n}let r=class extends Dv{};return d([fce({Type:t,ensureType:typeof t=="function"?ls(t):ng(t)})],r.prototype,"itemType",void 0),r=d([I(`esri.core.Collection<${e}>`)],r),WW.set(t,r),r},d([p()],LT.prototype,"length",void 0),d([p()],LT.prototype,"items",null),LT=Dv=d([I("esri.core.Collection")],LT);const vt=LT;function R_(t,e,r=vt){return e||(e=new r),e===t||(e.removeAll(),pht(t)?e.addMany(t):t&&e.add(t)),e}function mce(t){return t}function pht(t){return t&&(Array.isArray(t)||"items"in t&&Array.isArray(t.items))}const F0e=new Set;function fht(t,e,r=!1){r&&F0e.has(e)||(r&&F0e.add(e),t.warn(` DEPRECATED - ${e}`))}function Lm(t,e,r={}){if(he("esri-deprecation-warnings")){const{moduleName:i}=r;CV(t,`Property: ${(i?i+"::":"")+e}`,r)}}function CV(t,e,r={}){if(he("esri-deprecation-warnings")){const{replacement:i,version:n,see:s,warnOnce:o}=r;let a=e;i&&(a+=`
	 Replacement: ${i}`),n&&(a+=`
	 Version: ${n}`),s&&(a+=`
	 See ${s} for more details.`),fht(t,a,o)}}let mht=class mIe{constructor(){this._values=new Map,this.multipleOriginsSupported=!1}clone(e){const r=new mIe;return this._values.forEach((i,n)=>{e&&e.has(n)||r.set(n,ie(i.value),i.origin)}),r}get(e,r){r=this._normalizeOrigin(r);const i=this._values.get(e);return r==null||(i==null?void 0:i.origin)===r?i==null?void 0:i.value:void 0}originOf(e){var r;return((r=this._values.get(e))==null?void 0:r.origin)??Fr.USER}keys(e){e=this._normalizeOrigin(e);const r=[...this._values.keys()];return e==null?r:r.filter(i=>{var n;return((n=this._values.get(i))==null?void 0:n.origin)===e})}set(e,r,i){if((i=this._normalizeOrigin(i))===Fr.DEFAULTS){const n=this._values.get(e);if(n&&n.origin!=null&&n.origin>i)return}this._values.set(e,new ght(r,i))}delete(e,r){var i;(r=this._normalizeOrigin(r))!=null&&((i=this._values.get(e))==null?void 0:i.origin)!==r||this._values.delete(e)}has(e,r){var i;return(r=this._normalizeOrigin(r))!=null?((i=this._values.get(e))==null?void 0:i.origin)===r:this._values.has(e)}forEach(e){this._values.forEach(({value:r},i)=>e(r,i))}_normalizeOrigin(e){if(e!=null)return e===Fr.DEFAULTS?e:Fr.USER}},ght=class{constructor(e,r){this.value=e,this.origin=r}};function gIe(t,e,r){e.keys().forEach(n=>{r.set(n,e.get(n),Fr.DEFAULTS)});const i=t.metadatas;Object.keys(i).forEach(n=>{t.internalGet(n)&&r.set(n,t.internalGet(n),Fr.DEFAULTS)})}function yht(t,e,r){if(!t||!t.read||t.read.enabled===!1||!t.read.source)return!1;const i=t.read.source;if(typeof i=="string"){if(i===e||i.includes(".")&&i.indexOf(e)===0&&_0e(i,r))return!0}else for(const n of i)if(n===e||n.includes(".")&&n.indexOf(e)===0&&_0e(n,r))return!0;return!1}function vht(t){return t&&(!t.read||t.read.enabled!==!1&&!t.read.source)}function _ht(t,e,r,i,n){let s=OQ(e[r],n);vht(s)&&(t[r]=!0);for(const o of Object.getOwnPropertyNames(e))s=OQ(e[o],n),yht(s,r,i)&&(t[o]=!0)}function bht(t,e,r,i){const n=r.metadatas,s=tht(n[e],i),o=s==null?void 0:s.default;if(o===void 0)return;const a=typeof o=="function"?o.call(t,e,i):o;a!==void 0&&r.set(e,a)}const yIe={origin:"service"};function vIe(t,e,r=yIe){if(!e||typeof e!="object")return;const i=Ul(t),n=i.metadatas,s={};for(const o of Object.getOwnPropertyNames(e))_ht(s,n,o,e,r);i.setDefaultOrigin(r.origin);for(const o of Object.getOwnPropertyNames(s)){const a=OQ(n[o],r).read,l=a&&a.source;let c;c=l&&typeof l=="string"?F4(e,l):e[o],a&&a.reader&&(c=a.reader.call(t,c,e,r)),c!==void 0&&i.set(o,c)}if(!r||!r.ignoreDefaults){i.setDefaultOrigin("defaults");for(const o of Object.getOwnPropertyNames(n))s[o]||bht(t,o,i,r)}i.setDefaultOrigin("user")}function _Ie(t,e,r,i=yIe){var s;const n={...i,messages:[]};r(n),(s=n.messages)==null||s.forEach(o=>{o.type!=="warning"||t.loaded?i&&i.messages&&i.messages.push(o):t.loadWarnings.push(o)})}function wht(t,e,r,i,n){var o,a;const s={};return(a=(o=e.write)==null?void 0:o.writer)==null||a.call(t,i,s,r,n),s}function bIe(t,e,r,i,n,s){if(!i||!i.write)return!1;const o=t.get(r);if(!n&&i.write.overridePolicy){const a=i.write.overridePolicy.call(t,o,r,s??void 0);a!==void 0&&(n=a)}if(n||(n=i.write),!n||n.enabled===!1)return!1;if((o===null&&!n.allowNull&&!n.writerEnsuresNonNull||o===void 0)&&n.isRequired){const a=new H("web-document-write:property-required",`Missing value for required property '${r}' on '${t.declaredClass}'`,{propertyName:r,target:t});return a&&s&&s.messages?s.messages.push(a):a&&!s&&re.getLogger("esri.core.accessorSupport.write").error(a.name,a.message),!1}return!(o===void 0||o===null&&!n.allowNull&&!n.writerEnsuresNonNull||!n.alwaysWriteDefaults&&(!e.store.multipleOriginsSupported||e.store.originOf(r)===Fr.DEFAULTS)&&xht(t,r,s,i,o)||!n.ignoreOrigin&&s&&s.origin&&e.store.multipleOriginsSupported&&e.store.originOf(r)<Gv(s.origin))}function xht(t,e,r,i,n){const s=i.default;if(s===void 0)return!1;if(i.defaultEquals!=null)return i.defaultEquals(n);if(typeof s=="function"){if(Array.isArray(n)){const o=s.call(t,e,r??void 0);return T_(o,n)}return!1}return s===n}function Sht(t,e,r,i){const n=Ul(t),s=n.metadatas,o=lIe(s[e],i);return!!o&&bIe(t,n,e,o,r,i)}function wIe(t,e,r){var s,o;if(t&&typeof t.toJSON=="function"&&(!t.toJSON.isDefaultToJSON||!t.write))return y8(e,t.toJSON(r));const i=Ul(t),n=i.metadatas;for(const a in n){const l=lIe(n[a],r);if(!bIe(t,i,a,l,void 0,r))continue;const c=t.get(a),u=wht(t,l,l.write&&typeof l.write.target=="string"?l.write.target:a,c,r);Object.keys(u).length>0&&(e=y8(e,u),(o=(s=r==null?void 0:r.resources)==null?void 0:s.pendingOperations)!=null&&o.length&&r.resources.pendingOperations.push(Promise.all(r.resources.pendingOperations).then(()=>y8(e,u,()=>"replace-arrays"))),r&&r.writtenProperties&&r.writtenProperties.push({target:t,propName:a,oldOrigin:qut(i.store.originOf(a)),newOrigin:r.origin}))}return e}const C3=t=>{let e=class extends t{constructor(...r){super(...r);const i=Ul(this),n=i.store,s=new mht;i.store=s,gIe(i,n,s)}read(r,i){vIe(this,r,i)}write(r,i){return wIe(this,r??{},i)}toJSON(r){return this.write({},r)}static fromJSON(r,i){return Tht.call(this,r,i)}};return e=d([I("esri.core.JSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function Tht(t,e){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const r=new this;return r.read(t,e),r}let me=class extends C3(Ce){};me=d([I("esri.core.JSONSupport")],me);var Fb;(function(t){t[t.PENDING=0]="PENDING",t[t.RESOLVED=1]="RESOLVED",t[t.REJECTED=2]="REJECTED"})(Fb||(Fb={}));let Eht=class{constructor(){this._resolver=Da(),this._status=Fb.PENDING,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=Fb.RESOLVED,this._cleanUp()},()=>{this._status=Fb.REJECTED,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return this._status===Fb.RESOLVED}isRejected(){return this._status===Fb.REJECTED}isFulfilled(){return this._status!==Fb.PENDING}abort(){this._resolver.reject(Wr())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=Da(),r=[...this._resolvingPromises,e.promise],i=this._allPromise=Promise.all(r);i.then(()=>{this.isFulfilled()||this._allPromise!==i||this._resolver.resolve()},n=>{this.isFulfilled()||this._allPromise!==i||Yn(n)||this._resolver.reject(n)}),e.resolve()}};const G4=t=>{let e=class extends t{constructor(...r){super(...r),this._promiseProps=new Eht,this.addResolvingPromise(Promise.resolve())}destroy(){var r;(r=this._promiseProps)==null||r.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(r,i){return this._promiseProps.promise.then(()=>this).then(r,i)}catch(r){return this.when(null,r)}addResolvingPromise(r){r&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in r?r.when():r)}};return e=d([I("esri.core.Promise")],e),e};let RV=class extends G4(Ce){};RV=d([I("esri.core.Promise")],RV);const Cht="not-loaded",Rht="loading",Oht="failed",k0e="loaded",xIe=t=>{let e=class extends t{constructor(...r){super(...r),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(i=>{const n=this.load.bind(this);this.load=s=>{const o=new Promise((a,l)=>{const c=g7(s,l);this.destroyed&&l(new H("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(a,l).finally(()=>{c&&c.remove()})});if(this.loadStatus===Cht){this._set("loadStatus",Rht);const a=this._loadController=new AbortController;n({signal:a.signal}),Dl(a.signal,()=>{this._promiseProps.abort()})}return i(),o}})),this.when(()=>{this._set("loadStatus",k0e),this._loadController=null},i=>{this._set("loadStatus",Oht),this._set("loadError",i),this._loadController=null})}destroy(){this._loadController=xc(this._loadController),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===k0e}get loadWarnings(){return this._get("loadWarnings")}load(){return null}cancelLoad(){var r;return this.isFulfilled()||(this._set("loadError",new H("load:cancelled","Cancelled")),(r=this._loadController)==null||r.abort()),this}};return d([p({readOnly:!0})],e.prototype,"loaded",null),d([p({readOnly:!0})],e.prototype,"loadError",void 0),d([p({clonable:!1})],e.prototype,"loadStatus",void 0),d([p({type:[nf],readOnly:!0})],e.prototype,"loadWarnings",null),e=d([I("esri.core.Loadable")],e),e};let J$=class extends xIe(RV){};J$=d([I("esri.core.Loadable")],J$),function(t){function e(r){return!(!r||!r.load)}t.LoadableMixin=xIe,t.isLoadable=e}(J$||(J$={}));const sg=J$;function b7(t,e,r){return ou(t.map((i,n)=>e.apply(r,[i,n])))}async function Aht(t,e,r){return(await ou(t.map((i,n)=>e.apply(r,[i,n])))).map(i=>i.value)}function gce(t){return{ok:!0,value:t}}function yce(t){return{ok:!1,error:t}}function Pht(t){return t!=null&&t.ok===!0?t.value:null}function Mht(t){return t!=null&&t.ok===!1?t.error:null}async function wd(t){if(t==null)return{ok:!1,error:new Error("no promise provided")};try{return gce(await t)}catch(e){return yce(e)}}async function Zdr(t){try{return gce(await t)}catch(e){return Oa(e),yce(e)}}function Jdr(t){if(t.ok===!0)return t.value;throw t.error}function R3(t,e){return new Q1(t,e)}let Q1=class extends Ce{get value(){return Pht(this._result)}get error(){return Mht(this._result)}get finished(){return this._result!=null}constructor(e,r){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=xc(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:i}=this._abortController;this.promise=e(i),this.promise.then(n=>{this._result=gce(n),this._cleanup()},n=>{this._result=yce(n),this._cleanup()}),this._abortHandle=Dl(r,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=yi(this._abortHandle),this._abortController=null}};d([p()],Q1.prototype,"value",null),d([p()],Q1.prototype,"error",null),d([p()],Q1.prototype,"finished",null),d([p()],Q1.prototype,"promise",void 0),d([p()],Q1.prototype,"_result",void 0),Q1=d([I("esri.core.asyncUtils.ReactiveTask")],Q1);async function vce(t,e){return await t.load(),$ht(t,e)}async function $ht(t,e){const r=[],i=(...s)=>{for(const o of s)o!=null&&(Array.isArray(o)?i(...o):vt.isCollection(o)?o.forEach(a=>i(a)):sg.isLoadable(o)&&r.push(o))};e(i);let n=null;if(await Aht(r,async s=>{const o=await wd(Iht(s)?s.loadAll():s.load());o.ok!==!1||n||(n=o)}),n)throw n.error;return t}function Iht(t){return"loadAll"in t&&typeof t.loadAll=="function"}function tt(t,e,r){let i,n;return e===void 0?(n=t,i=[void 0]):typeof e!="string"?(n=t,i=[void 0],r=e):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;for(const l of i){const c=uce(s,l,n);c.write&&typeof c.write=="object"||(c.write={}),r&&(c.write.target=r),c.write.writer=a[o]}}}let ri=class{constructor(e,r={ignoreUnknown:!1,useNumericKeys:!1}){this._jsonToAPI=e,this._options=r,this.apiValues=[],this.jsonValues=[],this._apiToJSON=this._invertMap(e),this.apiValues=this._getKeysSorted(this._apiToJSON),this.jsonValues=this._getKeysSorted(this._jsonToAPI),this.read=i=>this.fromJSON(i),this.write=(i,n,s)=>{const o=this.toJSON(i);o!==void 0&&Rc(s,o,n)},this.write.isJSONMapWriter=!0}toJSON(e){if(e==null)return null;if(this._apiToJSON.hasOwnProperty(e)){const r=this._apiToJSON[e];return this._options.useNumericKeys?+r:r}return this._options.ignoreUnknown?void 0:e}fromJSON(e){return e!=null&&this._jsonToAPI.hasOwnProperty(e)?this._jsonToAPI[e]:this._options.ignoreUnknown?void 0:e}_invertMap(e){const r={};for(const i in e)r[e[i]]=i;return r}_getKeysSorted(e){const r=[];for(const i in e)r.push(i);return r.sort(),r}};function Ac(){return function(t,e){return new ri(t,{ignoreUnknown:!0,...e})}}let _ce=class{constructor(e,r,i,n){this.semiMajorAxis=e,this.flattening=r,this.outerAtmosphereRimWidth=i;const s=1-this.flattening;this.semiMinorAxis=this.semiMajorAxis*s,this.halfSemiMajorAxis=this.semiMajorAxis/2,this.halfCircumference=Math.PI*this.semiMajorAxis,this.metersPerDegree=this.halfCircumference/180,this.inverseFlattening=1/(1-this.flattening)-1,this.eccentricitySquared=n||2*this.flattening-this.flattening*this.flattening,this.meanRadiusSemiAxes=(2*this.semiMajorAxis+this.semiMinorAxis)/3}get radius(){return this.semiMajorAxis}};const Rr=new _ce(6378137,1/298.257223563,3e5,.006694379990137799),Hy=new _ce(3396190,1/169.8944472236118,23e4),O_=new _ce(1737400,0,0);var Dp;(function(t){t[t.CGCS2000=4490]="CGCS2000",t[t.GCSMARS2000=104971]="GCSMARS2000",t[t.GCSMARS2000_SPHERE=104905]="GCSMARS2000_SPHERE",t[t.GCSMOON2000=104903]="GCSMOON2000"})(Dp||(Dp={}));let v;const z={values:[1,.3048,.3048006096012192,.3047972654,.9143917962,.201166195164,.9143984146160287,.3047994715386762,20.11676512155263,20.11678249437587,.9143985307444408,.91439523,.3047997101815088,20.1168,20.116756,5e4,15e4],units:["Meter","Foot","Foot_US","Foot_Clarke","Yard_Clarke","Link_Clarke","Yard_Sears","Foot_Sears","Chain_Sears","Chain_Benoit_1895_B","Yard_Indian","Yard_Indian_1937","Foot_Gold_Coast","Chain","Chain_Sears_1922_Truncated","50_Kilometers","150_Kilometers"],2066:5,2136:12,2155:2,2157:0,2158:0,2159:12,2160:12,2204:2,2219:0,2220:0,2254:2,2255:2,2256:1,2265:1,2266:1,2267:2,2268:2,2269:1,2270:1,2271:2,2272:2,2273:1,2294:0,2295:0,2314:3,2899:2,2900:2,2901:1,2909:1,2910:1,2911:2,2912:2,2913:1,2914:1,2992:1,2993:0,2994:1,3080:1,3089:2,3090:0,3091:2,3102:2,3141:0,3142:0,3167:14,3359:2,3360:0,3361:1,3362:0,3363:2,3364:0,3365:2,3366:3,3404:2,3405:0,3406:0,3407:3,3439:0,3440:0,3479:1,3480:0,3481:1,3482:0,3483:1,3484:0,3485:2,3486:0,3487:2,3488:0,3489:0,3490:2,3491:0,3492:2,3493:0,3494:2,3495:0,3496:2,3497:0,3498:2,3499:0,3500:2,3501:0,3502:2,3503:0,3504:2,3505:0,3506:2,3507:0,3508:2,3509:0,3510:2,3511:0,3512:2,3513:0,3514:0,3515:2,3516:0,3517:2,3518:0,3519:2,3520:0,3521:2,3522:0,3523:2,3524:0,3525:2,3526:0,3527:2,3528:0,3529:2,3530:0,3531:2,3532:0,3533:2,3534:0,3535:2,3536:0,3537:2,3538:0,3539:2,3540:0,3541:2,3542:0,3543:2,3544:0,3545:2,3546:0,3547:2,3548:0,3549:2,3550:0,3551:2,3552:0,3553:2,3582:2,3583:0,3584:2,3585:0,3586:2,3587:0,3588:1,3589:0,3590:1,3591:0,3592:0,3593:1,3598:2,3599:0,3600:2,3605:1,3606:0,3607:0,3608:2,3609:0,3610:2,3611:0,3612:2,3613:0,3614:2,3615:0,3616:2,3617:0,3618:2,3619:0,3620:2,3621:0,3622:2,3623:0,3624:2,3625:0,3626:2,3627:0,3628:2,3629:0,3630:2,3631:0,3632:2,3633:0,3634:1,3635:0,3636:1,3640:2,3641:0,3642:2,3643:0,3644:1,3645:0,3646:1,3647:0,3648:1,3649:0,3650:2,3651:0,3652:2,3653:0,3654:2,3655:0,3656:1,3657:0,3658:2,3659:0,3660:2,3661:0,3662:2,3663:0,3664:2,3668:2,3669:0,3670:2,3671:0,3672:2,3673:0,3674:2,3675:0,3676:1,3677:2,3678:0,3679:1,3680:2,3681:0,3682:1,3683:2,3684:0,3685:0,3686:2,3687:0,3688:2,3689:0,3690:2,3691:0,3692:2,3696:2,3697:0,3698:2,3699:0,3700:2,3793:0,3794:0,3812:0,3854:0,3857:0,3920:0,3978:0,3979:0,3991:2,3992:2,4026:0,4037:0,4038:0,4071:0,4082:0,4083:0,4087:0,4088:0,4217:2,4414:0,4415:0,4417:0,4434:0,4437:0,4438:2,4439:2,4462:0,4467:0,4471:0,4474:0,4559:0,4647:0,4822:0,4826:0,4839:0,5018:0,5041:0,5042:0,5048:0,5167:0,5168:0,5221:0,5223:0,5234:0,5235:0,5243:0,5247:0,5266:0,5316:0,5320:0,5321:0,5325:0,5337:0,5361:0,5362:0,5367:0,5382:0,5383:0,5396:0,5456:0,5457:0,5469:0,5472:4,5490:0,5513:0,5514:0,5523:0,5559:0,5588:1,5589:3,5596:0,5627:0,5629:0,5641:0,5643:0,5644:0,5646:2,5654:2,5655:2,5659:0,5700:0,5825:0,5836:0,5837:0,5839:0,5842:0,5844:0,5858:0,5879:0,5880:0,5887:0,5890:0,6128:1,6129:1,6141:1,6204:0,6210:0,6211:0,6307:0,6312:0,6316:0,6362:0,6391:1,6405:1,6406:0,6407:1,6408:0,6409:1,6410:0,6411:2,6412:0,6413:2,6414:0,6415:0,6416:2,6417:0,6418:2,6419:0,6420:2,6421:0,6422:2,6423:0,6424:2,6425:0,6426:2,6427:0,6428:2,6429:0,6430:2,6431:0,6432:2,6433:0,6434:2,6435:0,6436:2,6437:0,6438:2,6439:0,6440:0,6441:2,6442:0,6443:2,6444:0,6445:2,6446:0,6447:2,6448:0,6449:2,6450:0,6451:2,6452:0,6453:2,6454:0,6455:2,6456:0,6457:2,6458:0,6459:2,6460:0,6461:2,6462:0,6463:2,6464:0,6465:2,6466:0,6467:2,6468:0,6469:2,6470:0,6471:2,6472:0,6473:2,6474:0,6475:2,6476:0,6477:2,6478:0,6479:2,6484:2,6485:0,6486:2,6487:0,6488:2,6489:0,6490:2,6491:0,6492:2,6493:0,6494:1,6495:0,6496:1,6497:0,6498:0,6499:1,6500:0,6501:2,6502:0,6503:2,6504:0,6505:2,6506:0,6507:2,6508:0,6509:0,6510:2,6515:1,6516:0,6518:0,6519:2,6520:0,6521:2,6522:0,6523:2,6524:0,6525:2,6526:0,6527:2,6528:0,6529:2,6530:0,6531:2,6532:0,6533:2,6534:0,6535:2,6536:0,6537:2,6538:0,6539:2,6540:0,6541:2,6542:0,6543:2,6544:0,6545:1,6546:0,6547:1,6548:0,6549:2,6550:0,6551:2,6552:0,6553:2,6554:0,6555:2,6556:0,6557:1,6558:0,6559:1,6560:0,6561:1,6562:0,6563:2,6564:0,6565:2,6566:0,6567:0,6568:2,6569:0,6570:1,6571:0,6572:2,6573:0,6574:2,6575:0,6576:2,6577:0,6578:2,6582:2,6583:0,6584:2,6585:0,6586:2,6587:0,6588:2,6589:0,6590:2,6591:0,6592:0,6593:2,6594:0,6595:2,6596:0,6597:2,6598:0,6599:2,6600:0,6601:2,6602:0,6603:2,6605:2,6606:0,6607:2,6608:0,6609:2,6610:0,6611:0,6612:2,6613:0,6614:2,6615:0,6616:2,6617:0,6618:2,6633:2,6646:0,6703:0,6784:0,6785:1,6786:0,6787:1,6788:0,6789:1,6790:0,6791:1,6792:0,6793:1,6794:0,6795:1,6796:0,6797:1,6798:0,6799:1,6800:0,6801:1,6802:0,6803:1,6804:0,6805:1,6806:0,6807:1,6808:0,6809:1,6810:0,6811:1,6812:0,6813:1,6814:0,6815:1,6816:0,6817:1,6818:0,6819:1,6820:0,6821:1,6822:0,6823:1,6824:0,6825:1,6826:0,6827:1,6828:0,6829:1,6830:0,6831:1,6832:0,6833:1,6834:0,6835:1,6836:0,6837:1,6838:0,6839:1,6840:0,6841:1,6842:0,6843:1,6844:0,6845:1,6846:0,6847:1,6848:0,6849:1,6850:0,6851:1,6852:0,6853:1,6854:0,6855:1,6856:0,6857:1,6858:0,6859:1,6860:0,6861:1,6862:0,6863:1,6867:0,6868:1,6870:0,6875:0,6876:0,6879:0,6880:2,6884:0,6885:1,6886:0,6887:1,6915:0,6922:0,6923:2,6924:0,6925:2,6962:0,6984:0,6991:0,7128:2,7131:0,7132:2,7142:0,7257:0,7258:2,7259:0,7260:2,7261:0,7262:2,7263:0,7264:2,7265:0,7266:2,7267:0,7268:2,7269:0,7270:2,7271:0,7272:2,7273:0,7274:2,7275:0,7276:2,7277:0,7278:2,7279:0,7280:2,7281:0,7282:2,7283:0,7284:2,7285:0,7286:2,7287:0,7288:2,7289:0,7290:2,7291:0,7292:2,7293:0,7294:2,7295:0,7296:2,7297:0,7298:2,7299:0,7300:2,7301:0,7302:2,7303:0,7304:2,7305:0,7306:2,7307:0,7308:2,7309:0,7310:2,7311:0,7312:2,7313:0,7314:2,7315:0,7316:2,7317:0,7318:2,7319:0,7320:2,7321:0,7322:2,7323:0,7324:2,7325:0,7326:2,7327:0,7328:2,7329:0,7330:2,7331:0,7332:2,7333:0,7334:2,7335:0,7336:2,7337:0,7338:2,7339:0,7340:2,7341:0,7342:2,7343:0,7344:2,7345:0,7346:2,7347:0,7348:2,7349:0,7350:2,7351:0,7352:2,7353:0,7354:2,7355:0,7356:2,7357:0,7358:2,7359:0,7360:2,7361:0,7362:2,7363:0,7364:2,7365:0,7366:2,7367:0,7368:2,7369:0,7370:2,7877:0,7878:0,7882:0,7883:0,7887:0,7899:0,7991:0,7992:0,8035:2,8036:2,8058:0,8059:0,8082:0,8083:0,8088:0,8090:0,8091:2,8092:0,8093:2,8095:0,8096:2,8097:0,8098:2,8099:0,8100:2,8101:0,8102:2,8103:0,8104:2,8105:0,8106:2,8107:0,8108:2,8109:0,8110:2,8111:0,8112:2,8113:0,8114:2,8115:0,8116:2,8117:0,8118:2,8119:0,8120:2,8121:0,8122:2,8123:0,8124:2,8125:0,8126:2,8127:0,8128:2,8129:0,8130:2,8131:0,8132:2,8133:0,8134:2,8135:0,8136:2,8137:0,8138:2,8139:0,8140:2,8141:0,8142:2,8143:0,8144:2,8145:0,8146:2,8147:0,8148:2,8149:0,8150:2,8151:0,8152:2,8153:0,8154:2,8155:0,8156:2,8157:0,8158:2,8159:0,8160:2,8161:0,8162:2,8163:0,8164:2,8165:0,8166:2,8167:0,8168:2,8169:0,8170:2,8171:0,8172:2,8173:0,8177:2,8179:0,8180:2,8181:0,8182:2,8184:0,8185:2,8187:0,8189:2,8191:0,8193:2,8196:0,8197:2,8198:0,8200:2,8201:0,8202:2,8203:0,8204:2,8205:0,8206:2,8207:0,8208:2,8209:0,8210:2,8212:0,8213:2,8214:0,8216:2,8218:0,8220:2,8222:0,8224:2,8225:0,8226:2,8311:0,8312:1,8313:0,8314:1,8315:0,8316:1,8317:0,8318:1,8319:0,8320:1,8321:0,8322:1,8323:0,8324:1,8325:0,8326:1,8327:0,8328:1,8329:0,8330:1,8331:0,8332:1,8333:0,8334:1,8335:0,8336:1,8337:0,8338:1,8339:0,8340:1,8341:0,8342:1,8343:0,8344:1,8345:0,8346:1,8347:0,8348:1,8352:0,8353:0,8379:0,8380:2,8381:0,8382:2,8383:0,8384:2,8385:0,8387:2,8391:0,8395:0,8433:0,8441:0,8455:0,8456:0,8531:2,8682:0,8686:0,8687:0,8692:0,8693:0,8826:0,8903:0,8950:0,8951:0,9039:0,9040:0,9141:0,9149:0,9150:0,9191:0,9221:0,9222:0,9249:0,9250:0,9252:0,9254:0,9265:0,9284:0,9285:0,9300:0,9354:0,9367:0,9373:0,9377:0,9387:0,9391:0,9456:0,9473:0,9498:0,9674:0,9678:0,9680:0,9709:0,9712:0,9713:0,9716:0,9741:0,9748:2,9749:2,9761:0,9766:0,9793:0,9794:0,9869:0,9874:0,9875:0,9880:0,9943:0,9945:0,9947:0,9967:0,9972:0,9977:0,20042:0,20050:1,20499:0,20538:0,20539:0,20790:0,20791:0,21291:0,21292:0,21500:0,21817:0,21818:0,22032:0,22033:0,22091:0,22092:0,22239:0,22240:0,22332:0,22337:0,22338:0,22391:0,22392:0,22639:0,22700:0,22739:0,22770:0,22780:0,22832:0,23090:0,23095:0,23239:0,23240:0,23433:0,23700:0,24047:0,24048:0,24100:3,24200:0,24305:0,24306:0,24382:10,24383:0,24500:0,24547:0,24548:0,24571:9,24600:0,25e3:0,25231:0,25884:0,25932:0,26237:0,26331:0,26332:0,26432:0,26591:0,26592:0,26632:0,26692:0,27120:0,27200:0,27291:6,27292:6,27429:0,27492:0,27493:0,27500:0,27700:0,28232:0,28600:0,28991:0,28992:0,29100:0,29101:0,29220:0,29221:0,29333:0,29635:0,29636:0,29701:0,29738:0,29739:0,29849:0,29850:0,29871:8,29872:7,29873:0,29874:0,30200:5,30339:0,30340:0,30591:0,30592:0,30791:0,30792:0,30800:0,31028:0,31121:0,31154:0,31170:0,31171:0,31370:0,31528:0,31529:0,31600:0,31700:0,31838:0,31839:0,31900:0,31901:0,32061:0,32062:0,32098:0,32099:2,32100:0,32104:0,32161:0,32766:0,53048:0,53049:0,54090:0,54091:0,65061:2,65062:2,65161:0,65163:0,102041:2,102064:11,102068:15,102069:16,102118:2,102119:1,102120:2,102121:2,102217:2,102218:0,102219:2,102220:2,102378:1,102379:1,102380:0,102381:1,102589:2,102599:2,102600:2,102604:2,102647:0,102704:2,102705:2,102706:0,102731:0,102732:0,102759:1,102760:1,102761:2,102762:0,102763:2,102764:0,102765:0,102766:2,102970:1,102974:2,102993:0,102994:0,102995:2,102996:2,103015:0,103016:2,103017:0,103018:2,103025:0,103026:0,103027:2,103028:2,103035:0,103036:0,103037:2,103038:2,103039:0,103040:0,103041:2,103042:2,103043:0,103044:0,103045:2,103046:2,103047:0,103048:0,103049:2,103050:2,103051:0,103052:2,103053:0,103054:2,103055:0,103056:2,103057:0,103058:0,103059:2,103060:2,103061:0,103062:0,103063:2,103064:2,103069:2,103070:0,103071:0,103072:2,103073:2,103086:0,103087:0,103088:2,103089:2,103094:1,103095:0,103096:2,103103:0,103104:2,103105:0,103106:2,103121:0,103122:2,103123:0,103124:0,103125:1,103126:1,103127:0,103128:0,103129:2,103130:2,103131:0,103132:0,103133:2,103134:2,103135:0,103136:0,103137:1,103138:1,103139:0,103140:2,103141:0,103142:2,103143:0,103144:2,103145:0,103146:1,103147:0,103148:0,103149:2,103150:2,103151:0,103152:2,103172:0,103173:2,103174:0,103175:0,103176:2,103177:2,103178:0,103179:0,103180:2,103181:2,103182:0,103183:0,103184:2,103185:2,103228:0,103229:0,103230:2,103231:2,103250:0,103251:2,103252:0,103253:2,103260:0,103261:0,103262:2,103263:2,103270:0,103271:0,103272:2,103273:2,103274:0,103275:0,103276:2,103277:2,103278:0,103279:0,103280:2,103281:2,103282:0,103283:0,103284:2,103285:2,103286:0,103287:2,103288:0,103289:2,103290:0,103291:2,103292:0,103293:0,103294:2,103295:2,103296:0,103297:0,103298:2,103299:2,103376:2,103377:0,103378:0,103379:2,103380:2,103393:0,103394:0,103395:2,103396:2,103472:0,103473:1,103474:0,103475:2,103482:0,103483:2,103484:0,103485:2,103500:0,103501:2,103502:0,103503:0,103504:1,103505:1,103506:0,103507:0,103508:2,103509:2,103510:0,103511:0,103512:2,103513:2,103514:0,103515:2,103516:0,103517:2,103518:0,103519:2,103520:0,103521:1,103522:0,103523:0,103524:2,103525:2,103526:0,103527:2,103561:2,103562:2,103563:0,103564:0,103565:2,103566:2,103567:0,103568:0,103569:2,103570:2,103584:0,103585:2,103586:0,103587:2,103588:1,103589:0,103590:2,103591:1,103592:0,103593:2,103594:1,103695:2};for(v=2e3;v<=2045;v++)z[v]=0;for(v=2056;v<=2065;v++)z[v]=0;for(v=2067;v<=2135;v++)z[v]=0;for(v=2137;v<=2154;v++)z[v]=0;for(v=2161;v<=2170;v++)z[v]=0;for(v=2172;v<=2193;v++)z[v]=0;for(v=2195;v<=2198;v++)z[v]=0;for(v=2200;v<=2203;v++)z[v]=0;for(v=2205;v<=2217;v++)z[v]=0;for(v=2222;v<=2224;v++)z[v]=1;for(v=2225;v<=2250;v++)z[v]=2;for(v=2251;v<=2253;v++)z[v]=1;for(v=2257;v<=2264;v++)z[v]=2;for(v=2274;v<=2279;v++)z[v]=2;for(v=2280;v<=2282;v++)z[v]=1;for(v=2283;v<=2289;v++)z[v]=2;for(v=2290;v<=2292;v++)z[v]=0;for(v=2308;v<=2313;v++)z[v]=0;for(v=2315;v<=2491;v++)z[v]=0;for(v=2494;v<=2866;v++)z[v]=0;for(v=2867;v<=2869;v++)z[v]=1;for(v=2870;v<=2888;v++)z[v]=2;for(v=2891;v<=2895;v++)z[v]=2;for(v=2896;v<=2898;v++)z[v]=1;for(v=2902;v<=2908;v++)z[v]=2;for(v=2915;v<=2920;v++)z[v]=2;for(v=2921;v<=2923;v++)z[v]=1;for(v=2924;v<=2930;v++)z[v]=2;for(v=2931;v<=2962;v++)z[v]=0;for(v=2964;v<=2968;v++)z[v]=2;for(v=2969;v<=2973;v++)z[v]=0;for(v=2975;v<=2991;v++)z[v]=0;for(v=2995;v<=3051;v++)z[v]=0;for(v=3054;v<=3079;v++)z[v]=0;for(v=3081;v<=3088;v++)z[v]=0;for(v=3092;v<=3101;v++)z[v]=0;for(v=3106;v<=3138;v++)z[v]=0;for(v=3146;v<=3151;v++)z[v]=0;for(v=3153;v<=3166;v++)z[v]=0;for(v=3168;v<=3172;v++)z[v]=0;for(v=3174;v<=3203;v++)z[v]=0;for(v=3294;v<=3358;v++)z[v]=0;for(v=3367;v<=3403;v++)z[v]=0;for(v=3408;v<=3416;v++)z[v]=0;for(v=3417;v<=3438;v++)z[v]=2;for(v=3441;v<=3446;v++)z[v]=2;for(v=3447;v<=3450;v++)z[v]=0;for(v=3451;v<=3459;v++)z[v]=2;for(v=3460;v<=3478;v++)z[v]=0;for(v=3554;v<=3559;v++)z[v]=0;for(v=3560;v<=3570;v++)z[v]=2;for(v=3571;v<=3581;v++)z[v]=0;for(v=3594;v<=3597;v++)z[v]=0;for(v=3601;v<=3604;v++)z[v]=0;for(v=3637;v<=3639;v++)z[v]=0;for(v=3665;v<=3667;v++)z[v]=0;for(v=3693;v<=3695;v++)z[v]=0;for(v=3701;v<=3727;v++)z[v]=0;for(v=3728;v<=3739;v++)z[v]=2;for(v=3740;v<=3751;v++)z[v]=0;for(v=3753;v<=3760;v++)z[v]=2;for(v=3761;v<=3773;v++)z[v]=0;for(v=3775;v<=3777;v++)z[v]=0;for(v=3779;v<=3781;v++)z[v]=0;for(v=3783;v<=3785;v++)z[v]=0;for(v=3788;v<=3791;v++)z[v]=0;for(v=3797;v<=3802;v++)z[v]=0;for(v=3814;v<=3816;v++)z[v]=0;for(v=3825;v<=3829;v++)z[v]=0;for(v=3832;v<=3841;v++)z[v]=0;for(v=3844;v<=3852;v++)z[v]=0;for(v=3873;v<=3885;v++)z[v]=0;for(v=3890;v<=3893;v++)z[v]=0;for(v=3907;v<=3912;v++)z[v]=0;for(v=3942;v<=3950;v++)z[v]=0;for(v=3968;v<=3970;v++)z[v]=0;for(v=3973;v<=3976;v++)z[v]=0;for(v=3986;v<=3989;v++)z[v]=0;for(v=3994;v<=3997;v++)z[v]=0;for(v=4048;v<=4051;v++)z[v]=0;for(v=4056;v<=4063;v++)z[v]=0;for(v=4093;v<=4096;v++)z[v]=0;for(v=4390;v<=4398;v++)z[v]=0;for(v=4399;v<=4413;v++)z[v]=2;for(v=4418;v<=4433;v++)z[v]=2;for(v=4455;v<=4457;v++)z[v]=2;for(v=4484;v<=4489;v++)z[v]=0;for(v=4491;v<=4554;v++)z[v]=0;for(v=4568;v<=4589;v++)z[v]=0;for(v=4652;v<=4656;v++)z[v]=0;for(v=4766;v<=4800;v++)z[v]=0;for(v=5014;v<=5016;v++)z[v]=0;for(v=5069;v<=5072;v++)z[v]=0;for(v=5105;v<=5130;v++)z[v]=0;for(v=5173;v<=5188;v++)z[v]=0;for(v=5253;v<=5259;v++)z[v]=0;for(v=5269;v<=5275;v++)z[v]=0;for(v=5292;v<=5311;v++)z[v]=0;for(v=5329;v<=5331;v++)z[v]=0;for(v=5343;v<=5349;v++)z[v]=0;for(v=5355;v<=5357;v++)z[v]=0;for(v=5387;v<=5389;v++)z[v]=0;for(v=5459;v<=5463;v++)z[v]=0;for(v=5479;v<=5482;v++)z[v]=0;for(v=5518;v<=5520;v++)z[v]=0;for(v=5530;v<=5539;v++)z[v]=0;for(v=5550;v<=5552;v++)z[v]=0;for(v=5562;v<=5583;v++)z[v]=0;for(v=5623;v<=5625;v++)z[v]=2;for(v=5631;v<=5639;v++)z[v]=0;for(v=5649;v<=5653;v++)z[v]=0;for(v=5663;v<=5680;v++)z[v]=0;for(v=5682;v<=5685;v++)z[v]=0;for(v=5875;v<=5877;v++)z[v]=0;for(v=5896;v<=5899;v++)z[v]=0;for(v=5921;v<=5940;v++)z[v]=0;for(v=6050;v<=6125;v++)z[v]=0;for(v=6244;v<=6275;v++)z[v]=0;for(v=6328;v<=6348;v++)z[v]=0;for(v=6350;v<=6356;v++)z[v]=0;for(v=6366;v<=6372;v++)z[v]=0;for(v=6381;v<=6387;v++)z[v]=0;for(v=6393;v<=6404;v++)z[v]=0;for(v=6480;v<=6483;v++)z[v]=0;for(v=6511;v<=6514;v++)z[v]=0;for(v=6579;v<=6581;v++)z[v]=0;for(v=6619;v<=6624;v++)z[v]=0;for(v=6625;v<=6627;v++)z[v]=2;for(v=6628;v<=6632;v++)z[v]=0;for(v=6634;v<=6637;v++)z[v]=0;for(v=6669;v<=6692;v++)z[v]=0;for(v=6707;v<=6709;v++)z[v]=0;for(v=6720;v<=6723;v++)z[v]=0;for(v=6732;v<=6738;v++)z[v]=0;for(v=6931;v<=6933;v++)z[v]=0;for(v=6956;v<=6959;v++)z[v]=0;for(v=7005;v<=7007;v++)z[v]=0;for(v=7057;v<=7070;v++)z[v]=2;for(v=7074;v<=7082;v++)z[v]=0;for(v=7109;v<=7118;v++)z[v]=0;for(v=7119;v<=7127;v++)z[v]=1;for(v=7374;v<=7376;v++)z[v]=0;for(v=7528;v<=7586;v++)z[v]=0;for(v=7587;v<=7645;v++)z[v]=2;for(v=7692;v<=7696;v++)z[v]=0;for(v=7755;v<=7787;v++)z[v]=0;for(v=7791;v<=7795;v++)z[v]=0;for(v=7799;v<=7801;v++)z[v]=0;for(v=7803;v<=7805;v++)z[v]=0;for(v=7825;v<=7831;v++)z[v]=0;for(v=7845;v<=7859;v++)z[v]=0;for(v=8013;v<=8032;v++)z[v]=0;for(v=8065;v<=8068;v++)z[v]=1;for(v=8518;v<=8529;v++)z[v]=2;for(v=8533;v<=8536;v++)z[v]=2;for(v=8538;v<=8540;v++)z[v]=2;for(v=8677;v<=8679;v++)z[v]=0;for(v=8836;v<=8840;v++)z[v]=0;for(v=8857;v<=8859;v++)z[v]=0;for(v=8908;v<=8910;v++)z[v]=0;for(v=9154;v<=9159;v++)z[v]=0;for(v=9205;v<=9218;v++)z[v]=0;for(v=9271;v<=9273;v++)z[v]=0;for(v=9295;v<=9297;v++)z[v]=0;for(v=9356;v<=9360;v++)z[v]=0;for(v=9404;v<=9407;v++)z[v]=0;for(v=9476;v<=9482;v++)z[v]=0;for(v=9487;v<=9494;v++)z[v]=0;for(v=9697;v<=9699;v++)z[v]=0;for(v=9821;v<=9865;v++)z[v]=0;for(v=20002;v<=20032;v++)z[v]=0;for(v=20047;v<=20049;v++)z[v]=0;for(v=20062;v<=20092;v++)z[v]=0;for(v=20135;v<=20138;v++)z[v]=0;for(v=20248;v<=20258;v++)z[v]=0;for(v=20348;v<=20358;v++)z[v]=0;for(v=20436;v<=20440;v++)z[v]=0;for(v=20822;v<=20824;v++)z[v]=0;for(v=20904;v<=20932;v++)z[v]=0;for(v=20934;v<=20936;v++)z[v]=0;for(v=21004;v<=21032;v++)z[v]=0;for(v=21035;v<=21037;v++)z[v]=0;for(v=21095;v<=21097;v++)z[v]=0;for(v=21148;v<=21150;v++)z[v]=0;for(v=21207;v<=21264;v++)z[v]=0;for(v=21307;v<=21364;v++)z[v]=0;for(v=21413;v<=21423;v++)z[v]=0;for(v=21453;v<=21463;v++)z[v]=0;for(v=21473;v<=21483;v++)z[v]=0;for(v=21780;v<=21782;v++)z[v]=0;for(v=21891;v<=21894;v++)z[v]=0;for(v=21896;v<=21899;v++)z[v]=0;for(v=22171;v<=22177;v++)z[v]=0;for(v=22181;v<=22187;v++)z[v]=0;for(v=22191;v<=22197;v++)z[v]=0;for(v=22207;v<=22222;v++)z[v]=0;for(v=22234;v<=22236;v++)z[v]=0;for(v=22243;v<=22250;v++)z[v]=0;for(v=22262;v<=22265;v++)z[v]=0;for(v=22307;v<=22322;v++)z[v]=0;for(v=22348;v<=22357;v++)z[v]=0;for(v=22407;v<=22422;v++)z[v]=0;for(v=22462;v<=22465;v++)z[v]=0;for(v=22521;v<=22525;v++)z[v]=0;for(v=22607;v<=22622;v++)z[v]=0;for(v=22641;v<=22646;v++)z[v]=0;for(v=22648;v<=22657;v++)z[v]=0;for(v=22707;v<=22722;v++)z[v]=0;for(v=22762;v<=22765;v++)z[v]=0;for(v=22991;v<=22994;v++)z[v]=0;for(v=23028;v<=23038;v++)z[v]=0;for(v=23830;v<=23853;v++)z[v]=0;for(v=23866;v<=23872;v++)z[v]=0;for(v=23877;v<=23884;v++)z[v]=0;for(v=23886;v<=23894;v++)z[v]=0;for(v=23946;v<=23948;v++)z[v]=0;for(v=24311;v<=24313;v++)z[v]=0;for(v=24342;v<=24347;v++)z[v]=0;for(v=24370;v<=24374;v++)z[v]=10;for(v=24375;v<=24381;v++)z[v]=0;for(v=24718;v<=24721;v++)z[v]=0;for(v=24817;v<=24821;v++)z[v]=0;for(v=24877;v<=24882;v++)z[v]=0;for(v=24891;v<=24893;v++)z[v]=0;for(v=25391;v<=25395;v++)z[v]=0;for(v=25828;v<=25838;v++)z[v]=0;for(v=26191;v<=26195;v++)z[v]=0;for(v=26391;v<=26393;v++)z[v]=0;for(v=26701;v<=26722;v++)z[v]=0;for(v=26729;v<=26799;v++)z[v]=2;for(v=26801;v<=26803;v++)z[v]=2;for(v=26811;v<=26813;v++)z[v]=2;for(v=26847;v<=26870;v++)z[v]=2;for(v=26891;v<=26899;v++)z[v]=0;for(v=26901;v<=26923;v++)z[v]=0;for(v=26929;v<=26946;v++)z[v]=0;for(v=26948;v<=26998;v++)z[v]=0;for(v=27037;v<=27040;v++)z[v]=0;for(v=27205;v<=27232;v++)z[v]=0;for(v=27258;v<=27260;v++)z[v]=0;for(v=27391;v<=27398;v++)z[v]=0;for(v=27561;v<=27564;v++)z[v]=0;for(v=27571;v<=27574;v++)z[v]=0;for(v=27581;v<=27584;v++)z[v]=0;for(v=27591;v<=27594;v++)z[v]=0;for(v=28191;v<=28193;v++)z[v]=0;for(v=28348;v<=28358;v++)z[v]=0;for(v=28402;v<=28432;v++)z[v]=0;for(v=28462;v<=28492;v++)z[v]=0;for(v=29118;v<=29122;v++)z[v]=0;for(v=29168;v<=29172;v++)z[v]=0;for(v=29177;v<=29185;v++)z[v]=0;for(v=29187;v<=29195;v++)z[v]=0;for(v=29900;v<=29903;v++)z[v]=0;for(v=30161;v<=30179;v++)z[v]=0;for(v=30491;v<=30494;v++)z[v]=0;for(v=30729;v<=30732;v++)z[v]=0;for(v=31251;v<=31259;v++)z[v]=0;for(v=31265;v<=31268;v++)z[v]=0;for(v=31275;v<=31279;v++)z[v]=0;for(v=31281;v<=31297;v++)z[v]=0;for(v=31461;v<=31469;v++)z[v]=0;for(v=31491;v<=31495;v++)z[v]=0;for(v=31917;v<=31922;v++)z[v]=0;for(v=31965;v<=32e3;v++)z[v]=0;for(v=32001;v<=32003;v++)z[v]=2;for(v=32005;v<=32031;v++)z[v]=2;for(v=32033;v<=32060;v++)z[v]=2;for(v=32064;v<=32067;v++)z[v]=2;for(v=32074;v<=32077;v++)z[v]=2;for(v=32081;v<=32086;v++)z[v]=0;for(v=32107;v<=32130;v++)z[v]=0;for(v=32133;v<=32159;v++)z[v]=0;for(v=32164;v<=32167;v++)z[v]=2;for(v=32180;v<=32199;v++)z[v]=0;for(v=32201;v<=32260;v++)z[v]=0;for(v=32301;v<=32360;v++)z[v]=0;for(v=32601;v<=32662;v++)z[v]=0;for(v=32664;v<=32667;v++)z[v]=2;for(v=32701;v<=32761;v++)z[v]=0;for(v=53001;v<=53004;v++)z[v]=0;for(v=53008;v<=53019;v++)z[v]=0;for(v=53021;v<=53032;v++)z[v]=0;for(v=53034;v<=53037;v++)z[v]=0;for(v=53042;v<=53046;v++)z[v]=0;for(v=53074;v<=53080;v++)z[v]=0;for(v=54001;v<=54004;v++)z[v]=0;for(v=54008;v<=54019;v++)z[v]=0;for(v=54021;v<=54032;v++)z[v]=0;for(v=54034;v<=54037;v++)z[v]=0;for(v=54042;v<=54046;v++)z[v]=0;for(v=54048;v<=54053;v++)z[v]=0;for(v=54074;v<=54080;v++)z[v]=0;for(v=54098;v<=54101;v++)z[v]=0;for(v=102001;v<=102040;v++)z[v]=0;for(v=102042;v<=102063;v++)z[v]=0;for(v=102065;v<=102067;v++)z[v]=0;for(v=102070;v<=102117;v++)z[v]=0;for(v=102122;v<=102216;v++)z[v]=0;for(v=102221;v<=102377;v++)z[v]=0;for(v=102382;v<=102388;v++)z[v]=0;for(v=102389;v<=102398;v++)z[v]=2;for(v=102399;v<=102444;v++)z[v]=0;for(v=102445;v<=102447;v++)z[v]=2;for(v=102448;v<=102458;v++)z[v]=0;for(v=102459;v<=102468;v++)z[v]=2;for(v=102469;v<=102499;v++)z[v]=0;for(v=102500;v<=102519;v++)z[v]=1;for(v=102520;v<=102524;v++)z[v]=0;for(v=102525;v<=102529;v++)z[v]=2;for(v=102530;v<=102588;v++)z[v]=0;for(v=102590;v<=102598;v++)z[v]=0;for(v=102601;v<=102603;v++)z[v]=0;for(v=102605;v<=102628;v++)z[v]=0;for(v=102629;v<=102646;v++)z[v]=2;for(v=102648;v<=102700;v++)z[v]=2;for(v=102701;v<=102703;v++)z[v]=0;for(v=102707;v<=102730;v++)z[v]=2;for(v=102733;v<=102758;v++)z[v]=2;for(v=102767;v<=102900;v++)z[v]=0;for(v=102901;v<=102933;v++)z[v]=2;for(v=102934;v<=102950;v++)z[v]=13;for(v=102951;v<=102955;v++)z[v]=0;for(v=102961;v<=102963;v++)z[v]=0;for(v=102965;v<=102969;v++)z[v]=0;for(v=102971;v<=102973;v++)z[v]=0;for(v=102975;v<=102989;v++)z[v]=0;for(v=102990;v<=102992;v++)z[v]=1;for(v=102997;v<=103002;v++)z[v]=0;for(v=103003;v<=103008;v++)z[v]=2;for(v=103009;v<=103011;v++)z[v]=0;for(v=103012;v<=103014;v++)z[v]=2;for(v=103019;v<=103021;v++)z[v]=0;for(v=103022;v<=103024;v++)z[v]=2;for(v=103029;v<=103031;v++)z[v]=0;for(v=103032;v<=103034;v++)z[v]=2;for(v=103065;v<=103068;v++)z[v]=0;for(v=103074;v<=103076;v++)z[v]=0;for(v=103077;v<=103079;v++)z[v]=1;for(v=103080;v<=103082;v++)z[v]=0;for(v=103083;v<=103085;v++)z[v]=2;for(v=103090;v<=103093;v++)z[v]=0;for(v=103097;v<=103099;v++)z[v]=0;for(v=103100;v<=103102;v++)z[v]=2;for(v=103107;v<=103109;v++)z[v]=0;for(v=103110;v<=103112;v++)z[v]=2;for(v=103113;v<=103116;v++)z[v]=0;for(v=103117;v<=103120;v++)z[v]=2;for(v=103153;v<=103157;v++)z[v]=0;for(v=103158;v<=103162;v++)z[v]=2;for(v=103163;v<=103165;v++)z[v]=0;for(v=103166;v<=103168;v++)z[v]=1;for(v=103169;v<=103171;v++)z[v]=2;for(v=103186;v<=103188;v++)z[v]=0;for(v=103189;v<=103191;v++)z[v]=2;for(v=103192;v<=103195;v++)z[v]=0;for(v=103196;v<=103199;v++)z[v]=2;for(v=103200;v<=103224;v++)z[v]=0;for(v=103225;v<=103227;v++)z[v]=1;for(v=103232;v<=103237;v++)z[v]=0;for(v=103238;v<=103243;v++)z[v]=2;for(v=103244;v<=103246;v++)z[v]=0;for(v=103247;v<=103249;v++)z[v]=2;for(v=103254;v<=103256;v++)z[v]=0;for(v=103257;v<=103259;v++)z[v]=2;for(v=103264;v<=103266;v++)z[v]=0;for(v=103267;v<=103269;v++)z[v]=2;for(v=103300;v<=103375;v++)z[v]=0;for(v=103381;v<=103383;v++)z[v]=0;for(v=103384;v<=103386;v++)z[v]=1;for(v=103387;v<=103389;v++)z[v]=0;for(v=103390;v<=103392;v++)z[v]=2;for(v=103397;v<=103399;v++)z[v]=0;for(v=103400;v<=103471;v++)z[v]=2;for(v=103476;v<=103478;v++)z[v]=0;for(v=103479;v<=103481;v++)z[v]=2;for(v=103486;v<=103488;v++)z[v]=0;for(v=103489;v<=103491;v++)z[v]=2;for(v=103492;v<=103495;v++)z[v]=0;for(v=103496;v<=103499;v++)z[v]=2;for(v=103528;v<=103543;v++)z[v]=0;for(v=103544;v<=103548;v++)z[v]=2;for(v=103549;v<=103551;v++)z[v]=0;for(v=103552;v<=103554;v++)z[v]=1;for(v=103555;v<=103557;v++)z[v]=2;for(v=103558;v<=103560;v++)z[v]=0;for(v=103571;v<=103573;v++)z[v]=0;for(v=103574;v<=103576;v++)z[v]=2;for(v=103577;v<=103580;v++)z[v]=0;for(v=103581;v<=103583;v++)z[v]=2;for(v=103595;v<=103694;v++)z[v]=0;for(v=103696;v<=103699;v++)z[v]=0;for(v=103700;v<=103793;v++)z[v]=2;for(v=103794;v<=103890;v++)z[v]=0;for(v=103891;v<=103896;v++)z[v]=2;for(v=103900;v<=103971;v++)z[v]=2;for(v=103972;v<=103977;v++)z[v]=0;for(v=112e3;v<=112101;v++)z[v]=0;const Lht={102113:!0,102100:!0,3857:!0,3785:!0},Dht={4326:!0,3785:!0,3857:!0,102113:!0,102100:!0,104905:!0,104971:!0},U0e='PROJCS["WGS_1984_Web_Mercator_Auxiliary_Sphere",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator_Auxiliary_Sphere"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],PARAMETER["Auxiliary_Sphere_Type",0.0],UNIT["Meter",1.0]]',N5=[-20037508342788905e-9,20037508342788905e-9],F5=[-20037508342787e-6,20037508342787e-6],SIe={102113:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:N5,origin:F5,dx:1e-5},102100:{wkTemplate:U0e,valid:N5,origin:F5,dx:1e-5},3785:{wkTemplate:'PROJCS["WGS_1984_Web_Mercator",GEOGCS["GCS_WGS_1984_Major_Auxiliary_Sphere",DATUM["D_WGS_1984_Major_Auxiliary_Sphere",SPHEROID["WGS_1984_Major_Auxiliary_Sphere",6378137.0,0.0]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Mercator"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],PARAMETER["Standard_Parallel_1",0.0],UNIT["Meter",1.0]]',valid:N5,origin:F5,dx:1e-5},3857:{wkTemplate:U0e,valid:N5,origin:F5,dx:1e-5},4326:{wkTemplate:'GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",{Central_Meridian}],UNIT["Degree",0.0174532925199433]]',altTemplate:'PROJCS["WGS_1984_Plate_Carree",GEOGCS["GCS_WGS_1984",DATUM["D_WGS_1984",SPHEROID["WGS_1984",6378137.0,298.257223563]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]],PROJECTION["Plate_Carree"],PARAMETER["False_Easting",0.0],PARAMETER["False_Northing",0.0],PARAMETER["Central_Meridian",{Central_Meridian}],UNIT["Degrees",111319.491]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104971:{wkTemplate:'GEOGCS["Mars_2000_(Sphere)",DATUM["Mars_2000_(Sphere)",SPHEROID["Mars_2000_(Sphere)",3396190.0,0.0]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5},104905:{wkTemplate:'GEOGCS["GCS_Mars_2000",DATUM["D_Mars_2000",SPHEROID["Mars_2000_IAU_IAG",3396190.0,169.8944472236118]],PRIMEM["Reference_Meridian",0.0],UNIT["Degree",0.0174532925199433]]',valid:[-180,180],origin:[-180,90],dx:1e-5}};function So(t,e){return t===e||t!=null&&e!=null&&(t.wkid!=null||e.wkid!=null?t.wkid===e.wkid||Y2(t)&&Y2(e)||e.latestWkid!=null&&t.wkid===e.latestWkid||t.latestWkid!=null&&e.wkid===t.latestWkid:!(!t.wkt||!e.wkt)&&t.wkt.toUpperCase()===e.wkt.toUpperCase())}function Dw(t){return $l(t)&&t.wkid&&SIe[t.wkid]||null}function bce(t){return!!$l(t)&&(t.wkid?z[t.wkid]==null:!!t.wkt&&!!/^\s*GEOGCS/i.test(t.wkt))}function pP(t){return!(w0(t)||x0(t))}function bN(t){return $l(t)&&t.wkid===4326}function TIe(t){return $l(t)&&t.wkid===Dp.CGCS2000}function Y2(t){return $l(t)&&t.wkid!=null&&Lht[t.wkid]===!0}function wN(t){return $l(t)&&t.wkid===32662}function wce(t){return t===Dp.GCSMARS2000||t===Dp.GCSMARS2000_SPHERE}function w0(t){return $l(t)&&t.wkid!=null&&wce(t.wkid)}function xce(t){return t===Dp.GCSMOON2000}function x0(t){return $l(t)&&t.wkid!=null&&xce(t.wkid)}function Nht(t){return $l(t)&&t.wkid!=null&&Dht[t.wkid]===!0}function $l(t){return t!=null&&(t.wkid!=null&&t.wkid>=2e3||t.wkt!=null)}const Fht={wkid:4326,wkt:d7(SIe[4326].wkTemplate,{Central_Meridian:"0.0"})},kht={wkid:102100,latestWkid:3857},Uht={wkid:32662};function Sce(t){return{wkt:`GEOCCS["Spherical geocentric",
    DATUM["Not specified",
      SPHEROID["Sphere",${t.radius},0]],
    PRIMEM["Greenwich",0.0,
      AUTHORITY["EPSG","8901"]],
    UNIT["m",1.0],
    AXIS["Geocentric X",OTHER],
    AXIS["Geocentric Y",EAST],
    AXIS["Geocentric Z",NORTH]
  ]`}}const EIe=Sce(Rr),Tce=Sce(Hy),Ece=Sce(O_),CIe={wkt:`GEOCCS["WGS 84",
  DATUM["WGS_1984",
    SPHEROID["WGS 84",${Rr.radius},298.257223563,
      AUTHORITY["EPSG","7030"]],
    AUTHORITY["EPSG","6326"]],
  PRIMEM["Greenwich",0,
    AUTHORITY["EPSG","8901"]],
  UNIT["m",1.0,
    AUTHORITY["EPSG","9001"]],
  AXIS["Geocentric X",OTHER],
  AXIS["Geocentric Y",OTHER],
  AXIS["Geocentric Z",NORTH],
  AUTHORITY["EPSG","4978"]
]`};function Xr(t){return t!=null&&(w0(t)||So(t,Tce))?Hy:t!=null&&(x0(t)||So(t,Ece))?O_:Rr}function thr(t){return wce(t)?Hy:xce(t)?O_:Rr}const Cce=39.37,zht=Rr.radius*Math.PI/200,RIe=/UNIT\[([^\]]+)\]\]$/i,y2=z,OIe=/UNIT\[([^\]]+)\]/i,Vht=new Set([4261,4305,4807,4810,4811,4812,4816,4819,4821,4901,4902,37225,104139,104140]),Bht=Ac()({meter:"meters",foot:"feet",foot_us:"us-feet",foot_clarke:"clarke-feet",yard_clarke:"clarke-yards",link_clarke:"clarke-links",yard_sears:"sears-yards",foot_sears:"sears-feet",chain_sears:"sears-chains",chain_benoit_1895_b:"benoit-1895-b-chains",yard_indian:"indian-yards",yard_indian_1937:"indian-1937-yards",foot_gold_coast:"gold-coast-feet",chain_sears_1922_truncated:"sears-1922-truncated-chains","50_kilometers":"50-kilometers","150_kilometers":"150-kilometers"}),Eg=t=>t*t,v1=t=>t*t*t,xN={length:{baseUnit:"meters",units:{millimeters:{inBaseUnits:.001},centimeters:{inBaseUnits:.01},decimeters:{inBaseUnits:.1},meters:{inBaseUnits:1},kilometers:{inBaseUnits:1e3},inches:{inBaseUnits:.0254},feet:{inBaseUnits:.3048},yards:{inBaseUnits:.9144},miles:{inBaseUnits:1609.344},"nautical-miles":{inBaseUnits:1852},"us-feet":{inBaseUnits:1200/3937}}},area:{baseUnit:"square-meters",units:{"square-millimeters":{inBaseUnits:Eg(.001)},"square-centimeters":{inBaseUnits:Eg(.01)},"square-decimeters":{inBaseUnits:Eg(.1)},"square-meters":{inBaseUnits:1},"square-kilometers":{inBaseUnits:Eg(1e3)},"square-inches":{inBaseUnits:Eg(.0254)},"square-feet":{inBaseUnits:Eg(.3048)},"square-yards":{inBaseUnits:Eg(.9144)},"square-miles":{inBaseUnits:Eg(1609.344)},"square-us-feet":{inBaseUnits:Eg(1200/3937)},acres:{inBaseUnits:.0015625*Eg(1609.344)},ares:{inBaseUnits:100},hectares:{inBaseUnits:1e4}}},volume:{baseUnit:"liters",units:{liters:{inBaseUnits:1},"cubic-millimeters":{inBaseUnits:1e3*v1(.001)},"cubic-centimeters":{inBaseUnits:1e3*v1(.01)},"cubic-decimeters":{inBaseUnits:1e3*v1(.1)},"cubic-meters":{inBaseUnits:1e3},"cubic-kilometers":{inBaseUnits:1e3*v1(1e3)},"cubic-inches":{inBaseUnits:1e3*v1(.0254)},"cubic-feet":{inBaseUnits:1e3*v1(.3048)},"cubic-yards":{inBaseUnits:1e3*v1(.9144)},"cubic-miles":{inBaseUnits:1e3*v1(1609.344)}}},angle:{baseUnit:"radians",units:{radians:{inBaseUnits:1},degrees:{inBaseUnits:Math.PI/180}}}},jht=(()=>{const t={};for(const e in xN)for(const r in xN[e].units)t[r]=e;return t})();function Ght(t,e,r){return t*xN[r].units[e].inBaseUnits}function Hht(t,e,r){return t/xN[r].units[e].inBaseUnits}const AIe=["metric","imperial","inches","feet","yards","miles","nautical-miles","us-feet","meters","kilometers"],qht=new Map([["meters","square-meters"],["feet","square-feet"],["us-feet","square-us-feet"]]);function MQ(t){const e=jht[t];if(!e)throw new Error("unknown type");return e}function z0e(t,e=null){return e=e||MQ(t),xN[e].baseUnit===t}function Po(t,e,r){if(e===r)return t;const i=MQ(e);if(i!==MQ(r))throw new Error("incompatible units");const n=z0e(e,i)?t:Ght(t,e,i);return z0e(r,i)?n:Hht(n,r,i)}function rhr(t,e,r){switch(r){case"metric":return Wht(t,e);case"imperial":return Yht(t,e);default:return r}}function ihr(t,e,r){switch(r){case"metric":return Xht(t,e);case"imperial":return Zht(t,e);default:return r}}function Wht(t,e){const r=Po(t,e,"meters");return Math.abs(r)<3e3?"meters":"kilometers"}function Xht(t,e){const r=Po(t,e,"meters");return Math.abs(r)<1e5?"meters":"kilometers"}function Yht(t,e){const r=Po(t,e,"feet");return Math.abs(r)<1e3?"feet":"miles"}function Zht(t,e){const r=Po(t,e,"feet");return Math.abs(r)<1e5?"feet":"miles"}function nhr(t,e){const r=Po(t,e,"square-meters");return Math.abs(r)<3e6?"square-meters":"square-kilometers"}function shr(t,e){const r=Po(t,e,"square-feet");return Math.abs(r)<1e6?"square-feet":"square-miles"}function PIe(t,e,r){return Po(t,e,"meters")/(r*Math.PI/180)}function MIe(t){return Bht.fromJSON(t.toLowerCase())||null}function SN(t){if(t!=null&&!pP(t))return 1;const e=Pc(t);return e>1e5?1:e}function $Ie(t){return Pc(t)>=Xr(t).metersPerDegree?"meters":H4(t)}function Pc(t,e=Rr.metersPerDegree){return Jht(t,!0)??e}function Jht(t,e=!1){const r=t!=null?t.wkid:null,i=t!=null?t.wkt:null;let n=null;if(r){if(wce(r))return Hy.metersPerDegree;if(xce(r))return O_.metersPerDegree;n=y2.values[y2[r]],!n&&e&&Vht.has(r)&&(n=zht)}else i&&(DIe(i)?n=B0e(RIe.exec(i),n):LIe(i)&&(n=B0e(OIe.exec(i),n)));return n}function V0e(t){return t.isGeographic?1:Pc(t)}function B0e(t,e){return t&&t[1]?IIe(t[1]):e}function IIe(t){return parseFloat(t.split(",")[1])}function H4(t){const e=t!=null?t.wkid:null,r=t!=null?t.wkt:null;let i=null;if(e)i=y2.units[y2[e]];else if(r){const n=DIe(r)?RIe:LIe(r)?OIe:null;if(n){const s=n.exec(r);s&&s[1]&&(i=Qht(s[1]))}}return i!=null?MIe(i):null}function ohr(t){const e=H4(t);return e!=null&&AIe.includes(e)?e:null}function ahr(t){const e=$Ie(t);return e!=null&&AIe.includes(e)?e:null}function lhr(t){const e=H4(t);return e==null?null:qht.get(e)}function LIe(t){return/^GEOCCS/i.test(t)}function DIe(t){return/^PROJCS/i.test(t)}const Kht=1e-7;function Qht(t){const e=/[\\"\\']{1}([^\\"\\']+)/.exec(t);let r=e&&e[1];if(!r||!y2.units.includes(r)){const i=IIe(t);r=null;const n=y2.values;for(let s=0;s<n.length;++s)if(Math.abs(i-n[s])<Kht){r=y2.units[s];break}}return r}function chr(t){const e=H4(t);if(e==null)return null;switch(e){case"feet":case"us-feet":case"clarke-feet":case"clarke-yards":case"clarke-links":case"sears-yards":case"sears-feet":case"sears-chains":case"benoit-1895-b-chains":case"indian-yards":case"indian-1937-yards":case"gold-coast-feet":case"sears-1922-truncated-chains":return"imperial";case"50-kilometers":case"150-kilometers":case"meters":return"metric"}return null}const ept={esriAcres:"acres",esriAres:"ares",esriHectares:"hectares",esriSquareCentimeters:"square-centimeters",esriSquareDecimeters:"square-decimeters",esriSquareFeet:"square-feet",esriSquareInches:"square-inches",esriSquareKilometers:"square-kilometers",esriSquareMeters:"square-meters",esriSquareMiles:"square-miles",esriSquareMillimeters:"square-millimeters",esriSquareUsFeet:"square-us-feet",esriSquareYards:"square-yards"},tpt={esriCentimeters:"centimeters",esriDecimeters:"decimeters",esriFeet:"feet",esriInches:"inches",esriKilometers:"kilometers",esriMeters:"meters",esriMiles:"miles",esriMillimeters:"millimeters",esriNauticalMiles:"nautical-miles",esriYards:"yards"},rpt={esriDUDecimalDegrees:"degrees",esriDURadians:"radians"},ipt=Ac()(ept),npt=Ac()(tpt),uhr=Ac()(rpt);var qg;let Zi=qg=class extends me{static fromJSON(t){if(!t)return null;if(t.wkid){if(t.wkid===102100)return qg.WebMercator;if(t.wkid===4326)return qg.WGS84}const e=new qg;return e.read(t),e}constructor(t){super(t),this.latestWkid=null,this.wkid=null,this.wkt=null,this.vcsWkid=null,this.latestVcsWkid=null,this.imageCoordinateSystem=null}normalizeCtorArgs(t){return t&&typeof t=="object"?t:{[typeof t=="string"?"wkt":"wkid"]:t}}get isWGS84(){return bN(this)}get isWebMercator(){return Y2(this)}get isGeographic(){return bce(this)}get isWrappable(){return Nht(this)}get metersPerUnit(){return Pc(this)}get unit(){return H4(this)||(this.isGeographic?"degrees":null)}writeWkt(t,e){this.wkid||(e.wkt=t)}clone(){if(this===qg.WGS84)return qg.WGS84;if(this===qg.WebMercator)return qg.WebMercator;const t=new qg;return this.wkid!=null?(t.wkid=this.wkid,this.latestWkid!=null&&(t.latestWkid=this.latestWkid),this.vcsWkid!=null&&(t.vcsWkid=this.vcsWkid),this.latestVcsWkid!=null&&(t.latestVcsWkid=this.latestVcsWkid)):this.wkt!=null&&(t.wkt=this.wkt),this.imageCoordinateSystem&&(t.imageCoordinateSystem=ie(this.imageCoordinateSystem)),t}equals(t){if(t==null)return!1;if(this.imageCoordinateSystem||t.imageCoordinateSystem){if(this.imageCoordinateSystem==null||t.imageCoordinateSystem==null)return!1;const{id:e,referenceServiceName:r}=t.imageCoordinateSystem,{geodataXform:i}=t.imageCoordinateSystem,n=this.imageCoordinateSystem;return e==null||i?JSON.stringify(n)===JSON.stringify(t.imageCoordinateSystem):r?n.id===e&&n.referenceServiceName===r:n.id===e}return So(this,t)}toJSON(t){return this.write(void 0,t)}};Zi.GCS_NAD_1927=null,Zi.WGS84=null,Zi.WebMercator=null,Zi.PlateCarree=null,d([p({readOnly:!0})],Zi.prototype,"isWGS84",null),d([p({readOnly:!0})],Zi.prototype,"isWebMercator",null),d([p({readOnly:!0})],Zi.prototype,"isGeographic",null),d([p({readOnly:!0})],Zi.prototype,"isWrappable",null),d([p({type:hn,json:{write:!0}})],Zi.prototype,"latestWkid",void 0),d([p({readOnly:!0})],Zi.prototype,"metersPerUnit",null),d([p({readOnly:!0})],Zi.prototype,"unit",null),d([p({type:hn,json:{write:!0,origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkt==null}}}}}}})],Zi.prototype,"wkid",void 0),d([p({type:String,json:{origins:{"web-scene":{write:{overridePolicy(){return{isRequired:this.wkid==null}}}}}}})],Zi.prototype,"wkt",void 0),d([tt("wkt"),tt("web-scene","wkt")],Zi.prototype,"writeWkt",null),d([p({type:hn,json:{write:!0}})],Zi.prototype,"vcsWkid",void 0),d([p({type:hn,json:{write:!0}})],Zi.prototype,"latestVcsWkid",void 0),d([p()],Zi.prototype,"imageCoordinateSystem",void 0),Zi=qg=d([I("esri.geometry.SpatialReference")],Zi),Zi.prototype.toJSON.isDefaultToJSON=!0,Zi.GCS_NAD_1927=new Zi({wkid:4267,wkt:'GEOGCS["GCS_North_American_1927",DATUM["D_North_American_1927",SPHEROID["Clarke_1866",6378206.4,294.9786982]],PRIMEM["Greenwich",0.0],UNIT["Degree",0.0174532925199433]]'}),Zi.WGS84=new Zi(Fht),Zi.WebMercator=new Zi(kht),Zi.PlateCarree=new Zi(Uht),Object.freeze&&(Object.freeze(Zi.GCS_NAD_1927),Object.freeze(Zi.WGS84),Object.freeze(Zi.WebMercator));const dt=Zi,spt=["elevation3d.arcgis.com","js.arcgis.com","jsdev.arcgis.com","jsqa.arcgis.com","static.arcgis.com"];function NIe(t){const e=Xm(t,!0);return!!e&&e.endsWith(".arcgis.com")&&!spt.includes(e)&&!t.endsWith("/sharing/rest/generateToken")}function FIe(t,e,r=!1,i){return new Promise((n,s)=>{if(go(i))return void s(j0e());let o=()=>{c(),s(new Error(`Unable to load ${e}`))},a=()=>{const u=t;c(),n(u)},l=()=>{if(!t)return;const u=t;c(),u.src="",s(j0e())};const c=()=>{he("esri-image-decode")||(t.removeEventListener("error",o),t.removeEventListener("load",a)),o=null,a=null,t=null,i!=null&&i.removeEventListener("abort",l),l=null,r&&URL.revokeObjectURL(e)};i!=null&&i.addEventListener("abort",l),he("esri-image-decode")?t.decode().then(a,o):(t.addEventListener("error",o),t.addEventListener("load",a))})}function j0e(){try{return new DOMException("Aborted","AbortError")}catch{const t=new Error;return t.name="AbortError",t}}const kIe="Timeout exceeded";function opt(){return new Error(kIe)}function dhr(t){return typeof t=="object"&&!!t&&"message"in t&&t.message===kIe}function apt(t){Ti.request.crossOriginNoCorsDomains||(Ti.request.crossOriginNoCorsDomains={});const e=Ti.request.crossOriginNoCorsDomains;for(let r of t)r=r.toLowerCase(),/^https?:\/\//.test(r)?e[Xm(r)??""]=0:(e[Xm("http://"+r)??""]=0,e[Xm("https://"+r)??""]=0)}function lpt(t){const e=Ti.request.crossOriginNoCorsDomains;if(e){let r=Xm(t);if(r)return r=r.toLowerCase(),!uP(r,Wle())&&e[r]<Date.now()-36e5}return!1}async function cpt(t){var n;const e=Ti.request.crossOriginNoCorsDomains,r=Xm(t);e&&r&&(e[r.toLowerCase()]=Date.now());const i=Ts(t);t=i.path,((n=i.query)==null?void 0:n.f)==="json"&&(t+="?f=json");try{await fetch(t,{mode:"no-cors",credentials:"include"})}catch{}}async function ti(t,e){var c;t instanceof URL&&(t=t.toString()),(e==null?void 0:e.query)instanceof URLSearchParams&&(e.query=Xle(e.query.toString().replaceAll("+"," ")));const r=b0(t),i=qw(t);i||r||(t=qp(t));const n={url:t,requestOptions:{...e}};let s=v$e(t);if(s){const u=await ypt(s,n);if(u!=null)return{data:u,getHeader:Rce,httpStatus:200,requestOptions:n.requestOptions,url:n.url};s.after||s.error||(s=null)}if(t=n.url,(e=n.requestOptions).responseType==="image"&&(he("host-webworker")||he("host-node")))throw qy("request:invalid-parameters",new Error("responseType 'image' is not supported in Web Workers or Node environment"),n);if(e.method==="head"){if(e.body)throw qy("request:invalid-parameters",new Error("body parameter cannot be set when method is 'head'"),n);if(r||i)throw qy("request:invalid-parameters",new Error("data and blob URLs are not supported for method 'head'"),n)}if(await fpt(),OV)return OV.execute(t,e);const o=new AbortController;Dl(e,()=>o.abort());const a={controller:o,credential:void 0,credentialToken:void 0,fetchOptions:void 0,hasToken:!1,interceptor:s,params:n,redoRequest:!1,useIdentity:bm.useIdentity,useProxy:!1,useSSL:!1,withCredentials:!1},l=await _pt(a);return(c=s==null?void 0:s.after)==null||c.call(s,l),l}let OV;const bm=Ti.request,UIe="FormData"in globalThis,upt=[499,498,403,401],dpt=["COM_0056","COM_0057","SB_0008"],hpt=[/\/arcgis\/tokens/i,/\/sharing(\/rest)?\/generatetoken/i,/\/rest\/info/i],Rce=()=>null,AV=Symbol();function ppt(t){const e=Xm(t);e&&!ti._corsServers.includes(e)&&ti._corsServers.push(e)}function G0e(t){const e=Xm(t);return!e||e.endsWith(".arcgis.com")||ti._corsServers.includes(e)||Zle(e)}function qy(t,e,r,i){let n="Error";const s={url:r.url,requestOptions:r.requestOptions,getHeader:Rce,ssl:!1};if(e instanceof H)return e.details?(e.details=ie(e.details),e.details.url=r.url,e.details.requestOptions=r.requestOptions):e.details=s,e;if(e){const o=i&&(c=>i.headers.get(c)),a=i==null?void 0:i.status,l=e.message;l&&(n=l),o&&(s.getHeader=o),s.httpStatus=(e.httpCode!=null?e.httpCode:e.code)||a||0,s.subCode=e.subcode,s.messageCode=e.messageCode,typeof e.details=="string"?s.messages=[e.details]:s.messages=e.details,s.raw=AV in e?e[AV]:e}return Yn(e)?Wr():new H(t,n,s)}async function fpt(){he("host-webworker")?OV||(OV=await le(()=>import("./request-92db5538.js"),[])):ti._abortableFetch||(ti._abortableFetch=globalThis.fetch.bind(globalThis))}async function $Q(){Hr||await le(()=>import("./IdentityManager-e14f7f8d.js"),[])}async function mpt(t){var a;const e=t.params.url,r=t.params.requestOptions,i=t.controller.signal,n=r.body;let s=null,o=null;if(UIe&&"HTMLFormElement"in globalThis&&(n instanceof FormData?s=n:n instanceof HTMLFormElement&&(s=new FormData(n))),typeof n=="string"&&(o=n),t.fetchOptions={cache:r.cacheBust&&!("polyfill"in ti._abortableFetch)?"no-cache":"default",credentials:"same-origin",headers:r.headers||{},method:r.method==="head"?"HEAD":"GET",mode:"cors",priority:bm.priority,redirect:"follow",signal:i},(s||o)&&(t.fetchOptions.body=s||o),r.authMode==="anonymous"&&(t.useIdentity=!1),t.hasToken=!!(/token=/i.test(e)||(a=r.query)!=null&&a.token||s!=null&&s.get("token")),!t.hasToken&&Ti.apiKey&&NIe(e)&&(r.query||(r.query={}),r.query.token=Ti.apiKey,t.hasToken=!0),t.useIdentity&&!t.hasToken&&!t.credentialToken&&!zIe(e)&&!go(i)){let l;r.authMode==="immediate"?(await $Q(),l=await Hr.getCredential(e,{signal:i}),t.credential=l):r.authMode==="no-prompt"?(await $Q(),l=await Hr.getCredential(e,{prompt:!1,signal:i}).catch(()=>{}),t.credential=l):Hr&&(l=Hr.findCredential(e)),l&&(t.credentialToken=l.token,t.useSSL=!!l.ssl)}}function zIe(t){return hpt.some(e=>e.test(t))}async function gpt(t){let e=t.params.url;const r=t.params.requestOptions,i=t.fetchOptions??{},n=qw(e)||b0(e),s=r.responseType||"json",o=n?0:r.timeout!=null?r.timeout:bm.timeout;let a=!1;if(!n){t.useSSL&&(e=ece(e)),r.cacheBust&&i.cache==="default"&&(e=rce(e,"request.preventCache",Date.now()));let f={...r.query};t.credentialToken&&(f.token=t.credentialToken);let m=mN(f);he("esri-url-encodes-apostrophe")&&(m=m.replaceAll("'","%27"));const g=e.length+1+m.length;let y;a=r.method==="delete"||r.method==="post"||r.method==="put"||!!r.body||g>bm.maxUrlLength;const _=r.useProxy||!!p7(e);if(_){const b=vut(e);y=b.path,!a&&y.length+1+g>bm.maxUrlLength&&(a=!0),b.query&&(f={...b.query,...f})}if(i.method==="HEAD"&&(a||_)){if(a)throw g>bm.maxUrlLength?qy("request:invalid-parameters",new Error("URL exceeds maximum length"),t.params):qy("request:invalid-parameters",new Error("cannot use POST request when method is 'head'"),t.params);if(_)throw qy("request:invalid-parameters",new Error("cannot use proxy when method is 'head'"),t.params)}if(a?(i.method=r.method==="delete"?"DELETE":r.method==="put"?"PUT":"POST",r.body?e=zW(e,f):(i.body=mN(f),i.headers||(i.headers={}),i.headers["Content-Type"]="application/x-www-form-urlencoded")):e=zW(e,f),_&&(t.useProxy=!0,e=`${y}?${e}`),f.token&&UIe&&i.body instanceof FormData&&!out(e)&&i.body.set("token",f.token),r.hasOwnProperty("withCredentials"))t.withCredentials=r.withCredentials;else if(!uP(e,Wle())){if(Zle(e))t.withCredentials=!0;else if(Hr){const b=Hr.findServerInfo(e);b!=null&&b.webTierAuth&&(t.withCredentials=!0)}}t.withCredentials&&(i.credentials="include",lpt(e)&&await cpt(a?zW(e,f):e))}let l,c,u=0,h=!1;o>0&&(u=setTimeout(()=>{h=!0,t.controller.abort()},o));try{if(r.responseType==="native-request-init")c=i,c.url=e;else if(r.responseType!=="image"||i.cache!=="default"||i.method!=="GET"||a||vpt(r.headers)||!n&&!t.useProxy&&bm.proxyUrl&&!G0e(e)){if(l=await ti._abortableFetch(e,i),t.useProxy||ppt(e),r.responseType==="native")c=l;else if(i.method!=="HEAD")if(l.ok){switch(s){case"array-buffer":c=await l.arrayBuffer();break;case"blob":case"image":c=await l.blob();break;default:c=await l.text()}if(u&&(clearTimeout(u),u=0),s==="json"||s==="xml"||s==="document")if(c)switch(s){case"json":c=JSON.parse(c);break;case"xml":c=H0e(c,"application/xml");break;case"document":c=H0e(c,"text/html")}else c=null;if(c){if(s==="array-buffer"||s==="blob"){const f=l.headers.get("Content-Type");if(f&&/application\/json|text\/plain/i.test(f)&&c[s==="blob"?"size":"byteLength"]<=750)try{const m=await new Response(c).json();m.error&&(c=m)}catch{}}s==="image"&&c instanceof Blob&&(c=await q0e(URL.createObjectURL(c),t,!0))}}else{c=await l.text();try{c=JSON.parse(c)}catch{}}}else c=await q0e(e,t)}catch(f){if(f.name==="AbortError")throw h?opt():Wr("Request canceled");if(!(!l&&f instanceof TypeError&&bm.proxyUrl)||r.body||r.method==="delete"||r.method==="head"||r.method==="post"||r.method==="put"||t.useProxy||G0e(e))throw f;t.redoRequest=!0,_ut({proxyUrl:bm.proxyUrl,urlPrefix:Xm(e)??""})}finally{u&&clearTimeout(u)}return[l,c]}async function ypt(t,e){if(t.responseData!=null)return t.responseData;if(t.headers&&(e.requestOptions.headers={...e.requestOptions.headers,...t.headers}),t.query&&(e.requestOptions.query={...e.requestOptions.query,...t.query}),t.before){let r,i;try{i=await t.before(e)}catch(n){r=qy("request:interceptor",n,e)}if((i instanceof Error||i instanceof H)&&(r=qy("request:interceptor",i,e)),r)throw t.error&&t.error(r),r;return i}}function vpt(t){if(t){for(const e of Object.getOwnPropertyNames(t))if(t[e])return!0}return!1}function H0e(t,e){let r;try{r=new DOMParser().parseFromString(t,e)}catch{}if(!r||r.getElementsByTagName("parsererror").length)throw new SyntaxError("XML Parse error");return r}async function _pt(t){var s,o;let e,r;await mpt(t);try{do[e,r]=await gpt(t);while(!await bpt(t,e,r))}catch(a){const l=qy("request:server",a,t.params,e);throw l.details.ssl=t.useSSL,(s=t.interceptor)!=null&&s.error&&t.interceptor.error(l),l}const i=t.params.url;if(r&&/\/sharing\/rest\/(accounts|portals)\/self/i.test(i)){if(!t.hasToken&&!t.credentialToken&&((o=r.user)!=null&&o.username)&&!Zle(i)){const a=Xm(i,!0);a&&bm.trustedServers.push(a)}Array.isArray(r.authorizedCrossOriginNoCorsDomains)&&apt(r.authorizedCrossOriginNoCorsDomains)}const n=t.credential;if(n&&Hr){const a=Hr.findServerInfo(n.server);let l=a==null?void 0:a.owningSystemUrl;if(l){l=l.replace(/\/?$/,"/sharing");const c=Hr.findCredential(l,n.userId);c&&Hr._getIdenticalSvcIdx(l,c)===-1&&c.resources.unshift(l)}}return{data:r,getHeader:e?a=>e==null?void 0:e.headers.get(a):Rce,httpStatus:(e==null?void 0:e.status)??200,requestOptions:t.params.requestOptions,ssl:t.useSSL,url:t.params.url}}async function bpt(t,e,r){var c;if(t.redoRequest)return t.redoRequest=!1,!1;const i=t.params.requestOptions;if(!e||i.responseType==="native"||i.responseType==="native-request-init")return!0;let n,s;if(r&&(r.error?n=r.error:r.status==="error"&&Array.isArray(r.messages)&&(n={...r},n[AV]=r,n.details=r.messages)),!n&&!e.ok)throw n=new Error(`Unable to load ${e.url} status: ${e.status}`),n[AV]=r,n;let o,a=null;n&&(s=Number(n.code),a=n.hasOwnProperty("subcode")?Number(n.subcode):null,o=n.messageCode,o=o==null?void 0:o.toUpperCase());const l=i.authMode;if(s===403&&(a===4||(c=n.message)!=null&&c.toLowerCase().includes("ssl")&&!n.message.toLowerCase().includes("permission"))){if(!t.useSSL)return t.useSSL=!0,!1}else if(!t.hasToken&&t.useIdentity&&(l!=="no-prompt"||s===498)&&s!==void 0&&upt.includes(s)&&!zIe(t.params.url)&&(s!==403||o&&!dpt.includes(o)&&(a==null||a===2&&t.credentialToken))){await $Q();try{const u=await Hr.getCredential(t.params.url,{error:qy("request:server",n,t.params),prompt:l!=="no-prompt",signal:t.controller.signal,token:t.credentialToken});return t.credential=u,t.credentialToken=u.token,t.useSSL=t.useSSL||u.ssl,!1}catch(u){if(l==="no-prompt")return t.credential=void 0,t.credentialToken=void 0,!1;n=u}}if(n)throw n;return!0}function q0e(t,e,r=!1){const i=e.controller.signal,n=new Image;return e.withCredentials?n.crossOrigin="use-credentials":n.crossOrigin="anonymous",n.alt="",n.fetchPriority=bm.priority,n.src=t,FIe(n,t,r,i)}ti._abortableFetch=null,ti._corsServers=["https://server.arcgisonline.com","https://services.arcgisonline.com"];const VIe=Object.freeze(Object.defineProperty({__proto__:null,default:ti},Symbol.toStringTag,{value:"Module"}));function ke(t,e,r){let i,n;return e===void 0||Array.isArray(e)?(n=t,r=e,i=[void 0]):(n=e,i=Array.isArray(t)?t:[t]),(s,o)=>{const a=s.constructor.prototype;i.forEach(l=>{const c=uce(s,l,n);c.read&&typeof c.read=="object"||(c.read={}),c.read.reader=a[o],r&&(c.read.source=(c.read.source||[]).concat(r))})}}let Wg=class extends me{constructor(...e){super(...e),this.type=null,this.hasM=!1,this.hasZ=!1,this.spatialReference=dt.WGS84}get cache(){return this.commitProperty("spatialReference"),{}}get extent(){return null}readSpatialReference(e,r){if(e instanceof dt)return e;if(e!=null){const i=new dt;return i.read(e,r),i}return e}clone(){return console.warn(".clone() is not implemented for "+this.declaredClass),null}clearCache(){this.notifyChange("cache")}getCacheValue(e){return this.cache[e]}setCacheValue(e,r){this.cache[e]=r}};d([p()],Wg.prototype,"type",void 0),d([p({readOnly:!0})],Wg.prototype,"cache",null),d([p({readOnly:!0})],Wg.prototype,"extent",null),d([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Wg.prototype,"hasM",void 0),d([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Wg.prototype,"hasZ",void 0),d([p({type:dt,json:{write:!0},value:dt.WGS84})],Wg.prototype,"spatialReference",void 0),d([ke("spatialReference")],Wg.prototype,"readSpatialReference",null),Wg=d([I("esri.geometry.Geometry")],Wg);const Sx=Wg,wpt=Object.prototype.toString;function xpt(t){const e="__accessorMetadata__"in t?ls(t):t;return function(...r){if(r.push(e),typeof r[2]=="number")throw new Error("Using @cast has parameter decorator is not supported since 4.16");return Spt.apply(this,r)}}function Spt(t,e,r,i){U4(t,e).cast=i}function Tpt(t){return(e,r)=>{U4(e,t).cast=e[r]}}function ur(...t){if(t.length!==3||typeof t[1]!="string")return t.length===1&&wpt.call(t[0])==="[object Function]"?xpt(t[0]):t.length===1&&typeof t[0]=="string"?Tpt(t[0]):void 0}function Ept(t,e){const r=t.x-e.x,i=t.y-e.y,n=t.hasZ&&e.hasZ?t.z-e.z:0;return Math.sqrt(r*r+i*i+n*n)}const Cpt=57.29577951308232,Rpt=.017453292519943;function W0e(t){return t*Cpt}function X0e(t){return t*Rpt}function Y0e(t){return t/Rr.radius}function PV(t){return Math.PI/2-2*Math.atan(Math.exp(-t/Rr.radius))}function IQ(t){return t.wkid!=null||t.wkt!=null}const XW=[0,0];function MV(t,e,r,i,n){const s=t,o=n;if(o.spatialReference=r,"x"in s&&"x"in o)[o.x,o.y]=e(s.x,s.y,XW,i);else if("xmin"in s&&"xmin"in o)[o.xmin,o.ymin]=e(s.xmin,s.ymin,XW,i),[o.xmax,o.ymax]=e(s.xmax,s.ymax,XW,i);else if("paths"in s&&"paths"in o||"rings"in s&&"rings"in o){const a="paths"in s?s.paths:s.rings,l=[];let c;for(let u=0;u<a.length;u++){const h=a[u];c=[],l.push(c);for(let f=0;f<h.length;f++)c.push(e(h[f][0],h[f][1],[0,0],i)),h[f].length>2&&c[f].push(h[f][2]),h[f].length>3&&c[f].push(h[f][3])}"paths"in o?o.paths=l:o.rings=l}else if("points"in s&&"points"in o){const a=s.points,l=[];for(let c=0;c<a.length;c++)l[c]=e(a[c][0],a[c][1],[0,0],i),a[c].length>2&&l[c].push(a[c][2]),a[c].length>3&&l[c].push(a[c][3]);o.points=l}return n}function Nw(t,e){const r=t&&(IQ(t)?t:t.spatialReference),i=e&&(IQ(e)?e:e.spatialReference);return!(t&&"type"in t&&t.type==="mesh"||e&&"type"in e&&e.type==="mesh"||!r||!i)&&(!!So(i,r)||Y2(i)&&bN(r)||Y2(r)&&bN(i))}function PE(t,e){if(t==null)return null;const r=t.spatialReference,i=e&&(IQ(e)?e:e.spatialReference);return Nw(r,i)?So(r,i)?ie(t):Y2(i)?MV(t,kO,dt.WebMercator,!1,ie(t)):bN(i)?MV(t,KL,dt.WGS84,!1,ie(t)):null:null}function kO(t,e,r=[0,0]){e>89.99999?e=89.99999:e<-89.99999&&(e=-89.99999);const i=X0e(e);return r[0]=X0e(t)*Rr.radius,r[1]=Rr.halfSemiMajorAxis*Math.log((1+Math.sin(i))/(1-Math.sin(i))),r}function KL(t,e,r=[0,0],i=!1){const n=W0e(t/Rr.radius);return r[0]=i?n:n-360*Math.floor((n+180)/360),r[1]=W0e(Math.PI/2-2*Math.atan(Math.exp(-e/Rr.radius))),r}function bA(t,e=!1,r=ie(t)){return MV(t,kO,dt.WebMercator,e,r)}function UO(t,e=!1,r=ie(t)){return MV(t,KL,dt.WGS84,e,r)}var S8;const OM=[0,0];function Z0e(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let zc=S8=class extends Sx{static copy(t,e){e._set("x",t._get("x")),e._set("y",t._get("y")),e._set("z",t._get("z")),e._set("m",t._get("m"));const r=t._get("spatialReference");e._set("spatialReference",Object.isFrozen(r)?r:r.clone())}constructor(...t){super(...t),this.x=0,this.y=0,this.z=void 0,this.m=void 0,this.type="point"}normalizeCtorArgs(t,e,r,i,n){let s;if(Array.isArray(t))s=t,n=e,t=s[0],e=s[1],r=s[2],i=s[3];else if(t&&typeof t=="object"){if(s=t,t=s.x!=null?s.x:s.longitude,e=s.y!=null?s.y:s.latitude,r=s.z,i=s.m,(n=s.spatialReference)&&n.declaredClass!=="esri.geometry.SpatialReference"&&(n=new dt(n)),s.longitude!=null||s.latitude!=null){if(s.longitude==null)re.getLogger(this).warn(".longitude=","Latitude was defined without longitude");else if(s.latitude==null)re.getLogger(this).warn(".latitude=","Longitude was defined without latitude");else if(!s.declaredClass&&n&&n.isWebMercator){const a=kO(s.longitude,s.latitude,OM);t=a[0],e=a[1]}}}else Z0e(r)?(n=r,r=null):Z0e(i)&&(n=i,i=null);const o={x:t,y:e};return o.x==null&&o.y!=null?re.getLogger(this).warn(".y=","Y coordinate was defined without an X coordinate"):o.y==null&&o.x!=null&&re.getLogger(this).warn(".x=","X coordinate was defined without a Y coordinate"),n!=null&&(o.spatialReference=n),r!=null&&(o.z=r),i!=null&&(o.m=i),o}get cache(){return this.commitProperty("x"),this.commitProperty("y"),this.commitProperty("z"),this.commitProperty("m"),this.commitProperty("spatialReference"),{}}get hasM(){return this.m!==void 0}set hasM(t){t!==(this._get("m")!==void 0)&&(this._set("m",t?0:void 0),this._set("hasM",t))}get hasZ(){return this.z!==void 0}set hasZ(t){t!==(this._get("z")!==void 0)&&(this._set("z",t?0:void 0),this._set("hasZ",t))}get latitude(){const{spatialReference:t,x:e,y:r}=this;if(t){if(t.isWebMercator)return KL(e,r,OM)[1];if(t.isGeographic)return r}return null}set latitude(t){const{spatialReference:e,x:r}=this;t!=null&&e&&(e.isWebMercator?this._set("y",kO(r,t,OM)[1]):e.isGeographic&&this._set("y",t),this._set("latitude",t))}get longitude(){const{x:t,y:e,spatialReference:r}=this;if(r){if(r.isWebMercator)return KL(t,e,OM)[0];if(r.isGeographic)return t}return null}set longitude(t){const{y:e,spatialReference:r}=this;t!=null&&r&&(r.isWebMercator?this._set("x",kO(t,e,OM)[0]):r.isGeographic&&this._set("x",t),this._set("longitude",t))}writeX(t,e,r){e[r]=isNaN(t)?"NaN":t}readX(t){return typeof t=="string"?NaN:t}clone(){const t=new S8;return t.x=this.x,t.y=this.y,t.z=this.z,t.m=this.m,t.spatialReference=this.spatialReference,t}copy(t){return S8.copy(t,this),this}equals(t){if(t==null)return!1;const{x:e,y:r,z:i,m:n,spatialReference:s}=this,{z:o,m:a}=t;let{x:l,y:c,spatialReference:u}=t;if(!s.equals(u))if(s.isWebMercator&&u.isWGS84)[l,c]=kO(l,c),u=s;else{if(!s.isWGS84||!u.isWebMercator)return!1;[l,c]=KL(l,c),u=s}return e===l&&r===c&&i===o&&n===a&&s.wkid===u.wkid}offset(t,e,r){return this.x+=t,this.y+=e,r!=null&&(this.z=(this.z??0)+r),this}normalize(){if(!this.spatialReference)return this;const t=Dw(this.spatialReference);if(!t)return this;let e=this.x;const[r,i]=t.valid,n=2*i;let s;return e>i?(s=Math.ceil(Math.abs(e-i)/n),e-=s*n):e<r&&(s=Math.ceil(Math.abs(e-r)/n),e+=s*n),this._set("x",e),this}distance(t){return Ept(this,t)}toArray(){const t=this.hasZ,e=this.hasM;return t&&e?[this.x,this.y,this.z,this.m]:t?[this.x,this.y,this.z]:e?[this.x,this.y,this.m]:[this.x,this.y]}toJSON(t){return this.write({},t)}};d([p({readOnly:!0})],zc.prototype,"cache",null),d([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],zc.prototype,"hasM",null),d([p({type:Boolean,json:{read:!1,write:{enabled:!1,overridePolicy:null}}})],zc.prototype,"hasZ",null),d([p({type:Number})],zc.prototype,"latitude",null),d([p({type:Number})],zc.prototype,"longitude",null),d([p({type:Number,json:{type:[Number,String],write:{isRequired:!0,allowNull:!0}}}),ur(t=>isNaN(t)?t:Op(t))],zc.prototype,"x",void 0),d([tt("x")],zc.prototype,"writeX",null),d([ke("x")],zc.prototype,"readX",null),d([p({type:Number,json:{write:!0}})],zc.prototype,"y",void 0),d([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasZ}}}}})],zc.prototype,"z",void 0),d([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.hasM}}}}})],zc.prototype,"m",void 0),zc=S8=d([I("esri.geometry.Point")],zc),zc.prototype.toJSON.isDefaultToJSON=!0;const Gt=zc,YW=[0,0];function Oce(t,e){return e!=null&&dc(t,e.x,e.y,e.z)}function phr(t,e){if(!e.points||e.points.length)return!1;for(const r of e.points)if(!fP(t,r))return!1;return!0}function Opt(t,e){const{xmin:r,ymin:i,zmin:n,xmax:s,ymax:o,zmax:a}=e;return t.hasZ&&e.hasZ?dc(t,r,i,n)&&dc(t,r,o,n)&&dc(t,s,o,n)&&dc(t,s,i,n)&&dc(t,r,i,a)&&dc(t,r,o,a)&&dc(t,s,o,a)&&dc(t,s,i,a):dc(t,r,i)&&dc(t,r,o)&&dc(t,s,o)&&dc(t,s,i)}function fP(t,e){return dc(t,e[0],e[1])}function Apt(t,e){return dc(t,e[0],e[1],e[2])}function dc(t,e,r,i){return e>=t.xmin&&e<=t.xmax&&r>=t.ymin&&r<=t.ymax&&(i==null||!t.hasZ||i>=t.zmin&&i<=t.zmax)}function Ppt(t,e){return YW[1]=e.y,YW[0]=e.x,Mpt(t,YW)}function Mpt(t,e){return BIe(t.rings,e)}function BIe(t,e){if(!t)return!1;if($pt(t))return J0e(!1,t,e);let r=!1;for(let i=0,n=t.length;i<n;i++)r=J0e(r,t[i],e);return r}function $pt(t){return!Array.isArray(t[0][0])}function J0e(t,e,r){const[i,n]=r;let s=t,o=0;for(let a=0,l=e.length;a<l;a++){o++,o===l&&(o=0);const[c,u]=e[a],[h,f]=e[o];(u<n&&f>=n||f<n&&u>=n)&&c+(n-u)/(f-u)*(h-c)<i&&(s=!s)}return s}function Ipt(t,e){return Oce(t,e)}function Lpt(t,e){const r=t.hasZ&&e.hasZ;let i,n,s;if(t.xmin<=e.xmin){if(i=e.xmin,t.xmax<i)return!1}else if(i=t.xmin,e.xmax<i)return!1;if(t.ymin<=e.ymin){if(n=e.ymin,t.ymax<n)return!1}else if(n=t.ymin,e.ymax<n)return!1;if(r&&e.hasZ){if(t.zmin<=e.zmin){if(s=e.zmin,t.zmax<s)return!1}else if(s=t.zmin,e.zmax<s)return!1}return!0}function Dpt(t,e){const{points:r,hasZ:i}=e,n=i?Apt:fP;for(const s of r)if(n(t,s))return!0;return!1}const Z2=[0,0],J2=[0,0],K2=[0,0],Q2=[0,0],Npt=[Z2,J2,K2,Q2],jIe=[[K2,Z2],[Z2,J2],[J2,Q2],[Q2,K2]];function Fpt(t,e){return kpt(t,e.rings)}function kpt(t,e){Z2[0]=t.xmin,Z2[1]=t.ymax,J2[0]=t.xmax,J2[1]=t.ymax,K2[0]=t.xmin,K2[1]=t.ymin,Q2[0]=t.xmax,Q2[1]=t.ymin;for(const r of Npt)if(BIe(e,r))return!0;for(const r of e){if(!r.length)continue;let i=r[0];if(fP(t,i))return!0;for(let n=1;n<r.length;n++){const s=r[n];if(fP(t,s)||GIe(i,s,jIe))return!0;i=s}}return!1}function Upt(t,e){Z2[0]=t.xmin,Z2[1]=t.ymax,J2[0]=t.xmax,J2[1]=t.ymax,K2[0]=t.xmin,K2[1]=t.ymin,Q2[0]=t.xmax,Q2[1]=t.ymin;const r=e.paths;for(const i of r){if(!r.length)continue;let n=i[0];if(fP(t,n))return!0;for(let s=1;s<i.length;s++){const o=i[s];if(fP(t,o)||GIe(n,o,jIe))return!0;n=o}}return!1}const ja=[0,0];function zpt(t){for(let e=0;e<t.length;e++){const r=t[e];for(let n=0;n<r.length-1;n++){const s=r[n],o=r[n+1];for(let a=e+1;a<t.length;a++)for(let l=0;l<t[a].length-1;l++){const c=t[a][l],u=t[a][l+1];if(LQ(s,o,c,u,ja)&&!(ja[0]===s[0]&&ja[1]===s[1]||ja[0]===c[0]&&ja[1]===c[1]||ja[0]===o[0]&&ja[1]===o[1]||ja[0]===u[0]&&ja[1]===u[1]))return!0}}const i=r.length;if(!(i<=4))for(let n=0;n<i-3;n++){let s=i-1;n===0&&(s=i-2);const o=r[n],a=r[n+1];for(let l=n+2;l<s;l++){const c=r[l],u=r[l+1];if(LQ(o,a,c,u,ja)&&!(ja[0]===o[0]&&ja[1]===o[1]||ja[0]===c[0]&&ja[1]===c[1]||ja[0]===a[0]&&ja[1]===a[1]||ja[0]===u[0]&&ja[1]===u[1]))return!0}}}return!1}function GIe(t,e,r){for(let i=0;i<r.length;i++)if(LQ(t,e,r[i][0],r[i][1]))return!0;return!1}function LQ(t,e,r,i,n){const[s,o]=t,[a,l]=e,[c,u]=r,[h,f]=i,m=h-c,g=s-c,y=a-s,_=f-u,b=o-u,w=l-o,x=_*y-m*w;if(x===0)return!1;const S=(m*b-_*g)/x,C=(y*b-w*g)/x;return S>=0&&S<=1&&C>=0&&C<=1&&(n&&(n[0]=s+S*(a-s),n[1]=o+S*(l-o)),!0)}function Vpt(t){switch(t){case"esriGeometryEnvelope":case"extent":return Lpt;case"esriGeometryMultipoint":case"multipoint":return Dpt;case"esriGeometryPoint":case"point":return Ipt;case"esriGeometryPolygon":case"polygon":return Fpt;case"esriGeometryPolyline":case"polyline":return Upt}}var Kh;function Bpt(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}function _1(t,e,r){return e==null?r:r==null?e:t(e,r)}let ya=Kh=class extends Sx{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,r,i,n){return Bpt(t)?{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0}:typeof t=="object"?(t.spatialReference=t.spatialReference==null?dt.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:r,ymax:i,spatialReference:n??dt.WGS84}}static fromBounds(t,e){return new Kh({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}static fromPoint(t){return new Kh({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new Gt({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return this.mmin!=null&&this.mmax!=null}get hasZ(){return this.zmin!=null&&this.zmax!=null}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return t.z!=null&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new Kh;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,this.zmin!=null&&(t.zmin=this.zmin,t.zmax=this.zmax),this.mmin!=null&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&Nw(e,r)&&(t=e.isWebMercator?bA(t):UO(t,!0)),t.type==="point"?Oce(this,t):t.type==="extent"&&Opt(this,t)}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;return e&&r&&!e.equals(r)&&Nw(e,r)&&(t=e.isWebMercator?bA(t):UO(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),r=this.width*e,i=this.height*e;if(this.xmin+=r,this.ymin+=i,this.xmax-=r,this.ymax-=i,this.hasZ){const n=(this.zmax-this.zmin)*e;this.zmin+=n,this.zmax-=n}if(this.hasM){const n=(this.mmax-this.mmin)*e;this.mmin+=n,this.mmax-=n}return this}intersects(t){if(t==null)return!1;t.type==="mesh"&&(t=t.extent);const e=this.spatialReference,r=t.spatialReference;return e&&r&&!So(e,r)&&Nw(e,r)&&(t=e.isWebMercator?bA(t):UO(t,!0)),Vpt(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,r){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,r!=null&&(this.zmin+=r,this.zmax+=r),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=_1(Math.min,this.zmin,t.zmin),this.zmax=_1(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=_1(Math.min,this.mmin,t.mmin),this.mmax=_1(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:t!=null&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=_1(Math.max,this.zmin,t.zmin),this.zmax=_1(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=_1(Math.max,this.mmin,t.mmin),this.mmax=_1(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=Dw(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,r=this._getCM(t);if(r){const i=e.isWebMercator?UO(r):r;this.xmin-=r.x,this.xmax-=r.x,e.isWebMercator||(i.x=this._normalizeX(i.x,t).x),this.spatialReference=new dt(d7((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:i.x}))}return this}_getCM(t){let e=null;const[r,i]=t.valid,n=this.xmin,s=this.xmax;return n>=r&&n<=i&&s>=r&&s<=i||(e=this.center),e}_normalize(t,e,r){const i=this.spatialReference;if(!i)return this;const n=r??Dw(i);if(n==null)return this;const s=this._getParts(n).map(l=>l.extent);if(s.length<2)return s[0]||this;if(s.length>2)return t?this._shiftCM(n):this.set({xmin:n.valid[0],xmax:n.valid[1]});if(t)return this._shiftCM(n);if(e)return s;let o=!0,a=!0;return s.forEach(l=>{l.hasZ||(o=!1),l.hasM||(a=!1)}),{rings:s.map(l=>{const c=[[l.xmin,l.ymin],[l.xmin,l.ymax],[l.xmax,l.ymax],[l.xmax,l.ymin],[l.xmin,l.ymin]];if(o){const u=(l.zmax-l.zmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}if(a){const u=(l.mmax-l.mmin)/2;for(let h=0;h<c.length;h++)c[h].push(u)}return c}),hasZ:o,hasM:a,spatialReference:i}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:n,ymax:s,spatialReference:o}=this,a=this.width,l=this.xmin,c=this.xmax;let u;t=t||Dw(o);const[h,f]=t.valid;u=this._normalizeX(this.xmin,t);const m=u.x,g=u.frameId;u=this._normalizeX(this.xmax,t);const y=u.x,_=u.frameId,b=m===y&&a>0;if(a>2*f){const w=new Kh(l<c?m:y,n,f,s,o),x=new Kh(h,n,l<c?y:m,s,o),S=new Kh(0,n,f,s,o),C=new Kh(h,n,0,s,o),E=[],R=[];w.contains(S)&&E.push(g),w.contains(C)&&R.push(g),x.contains(S)&&E.push(_),x.contains(C)&&R.push(_);for(let P=g+1;P<_;P++)E.push(P),R.push(P);e.push({extent:w,frameIds:[g]},{extent:x,frameIds:[_]},{extent:S,frameIds:E},{extent:C,frameIds:R})}else m>y||b?e.push({extent:new Kh(m,n,f,s,o),frameIds:[g]},{extent:new Kh(h,n,y,s,o),frameIds:[_]}):e.push({extent:new Kh(m,n,y,s,o),frameIds:[g]});this.cache._parts=e}const r=this.hasZ,i=this.hasM;if(r||i){const n={};r&&(n.zmin=this.zmin,n.zmax=this.zmax),i&&(n.mmin=this.mmin,n.mmax=this.mmax);for(let s=0;s<e.length;s++)e[s].extent.set(n)}return e}_normalizeX(t,e){const[r,i]=e.valid,n=2*i;let s,o=0;return t>i?(s=Math.ceil(Math.abs(t-i)/n),t-=s*n,o=s):t<r&&(s=Math.ceil(Math.abs(t-r)/n),t+=s*n,o=-s),{x:t,frameId:o}}};d([p({readOnly:!0})],ya.prototype,"cache",null),d([p({readOnly:!0})],ya.prototype,"center",null),d([p({readOnly:!0})],ya.prototype,"extent",null),d([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],ya.prototype,"hasM",null),d([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],ya.prototype,"hasZ",null),d([p({readOnly:!0})],ya.prototype,"height",null),d([p({readOnly:!0})],ya.prototype,"width",null),d([p({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],ya.prototype,"xmin",void 0),d([p({type:Number,json:{write:!0}})],ya.prototype,"ymin",void 0),d([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],ya.prototype,"mmin",void 0),d([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],ya.prototype,"zmin",void 0),d([p({type:Number,json:{write:!0}})],ya.prototype,"xmax",void 0),d([p({type:Number,json:{write:!0}})],ya.prototype,"ymax",void 0),d([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],ya.prototype,"mmax",void 0),d([p({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],ya.prototype,"zmax",void 0),ya=Kh=d([I("esri.geometry.Extent")],ya),ya.prototype.toJSON.isDefaultToJSON=!0;const $r=ya;let QL;var SAe,TAe;const jpt=((SAe=globalThis.esriConfig)==null?void 0:SAe.locale)??((TAe=globalThis.dojoConfig)==null?void 0:TAe.locale);function HIe(){var t;return jpt??((t=globalThis.navigator)==null?void 0:t.language)??"en"}function Ym(){return QL===void 0&&(QL=HIe()),QL}const eD=[];function qIe(t){return eD.push(t),{remove(){eD.splice(eD.indexOf(t),1)}}}const DQ=[];function Ace(t){return DQ.push(t),{remove(){eD.splice(DQ.indexOf(t),1)}}}function Gpt(){const t=HIe();QL!==t&&(QL=t,[...DQ].forEach(e=>{e.call(null,t)}),[...eD].forEach(e=>{e.call(null,t)}))}var EAe;(EAe=globalThis.addEventListener)==null||EAe.call(globalThis,"languagechange",Gpt);let k5;function Hpt(t){return k5&&!k5.destroyed||(k5=t()),k5}var NQ;const qpt=new ri({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});let Qh=NQ=class extends Ce{constructor(t){super(t),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(t){t!=="asc"&&t!=="desc"||this._set("sortOrder",t)}clone(){return new NQ({categories:this.categories?ie(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(t,e){let r=[];this.categories&&(r=this.categories.map(o=>Array.isArray(o)?JSON.stringify(o):o));let i="";if(this.extent){const o=PE(this.extent,dt.WGS84);o!=null&&(i=`${o.xmin},${o.ymin},${o.xmax},${o.ymax}`)}let n=this.query;!this.disableExtraQuery&&t.extraQuery&&(n="("+n+")"+t.extraQuery);const s={categories:r,bbox:i,q:n,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(o=>qpt.toJSON(o.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...e,...s}}}};d([p()],Qh.prototype,"categories",void 0),d([p()],Qh.prototype,"disableExtraQuery",void 0),d([p({type:$r})],Qh.prototype,"extent",void 0),d([p()],Qh.prototype,"filter",void 0),d([p()],Qh.prototype,"num",void 0),d([p()],Qh.prototype,"query",void 0),d([p()],Qh.prototype,"sortField",void 0),d([p()],Qh.prototype,"sortOrder",null),d([p()],Qh.prototype,"start",void 0),Qh=NQ=d([I("esri.portal.PortalQueryParams")],Qh);const Ry=Qh;let OS=class extends Ce{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}};d([p()],OS.prototype,"nextQueryParams",void 0),d([p()],OS.prototype,"queryParams",void 0),d([p()],OS.prototype,"results",void 0),d([p()],OS.prototype,"total",void 0),OS=d([I("esri.portal.PortalQueryResult")],OS);const Wpt=OS;let ev=class extends me{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.get("portal.restUrl");return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new H("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}};d([p({type:Date})],ev.prototype,"created",void 0),d([p()],ev.prototype,"id",void 0),d([p()],ev.prototype,"portal",void 0),d([p()],ev.prototype,"title",void 0),d([p({readOnly:!0})],ev.prototype,"url",null),d([p()],ev.prototype,"username",void 0),ev=d([I("esri.portal.PortalFolder")],ev);const Xpt=ev;let va=class extends me{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.tags=null,this.title=null}get thumbnailUrl(){var i;const e=this.url,r=this.thumbnail;return e&&r&&this.portal?(i=this.portal)==null?void 0:i.normalizeUrl(`${e}/info/${r}?f=json`):null}get url(){const e=this.get("portal.restUrl");return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return qu(this.portal).request(this.url+"/categorySchema",e).then(r=>{const i=r.categorySchema||[];return i.some(n=>n.source==="contentCategorySetsGroupQuery.LivingAtlas")?this._fetchCategorySchemaSet("LivingAtlas",e):i})}fetchMembers(e){return qu(this.portal).request(this.url+"/users",e)}getThumbnailUrl(e){let r=this.thumbnailUrl;return r&&e&&(r+=`&w=${e}`),r}toJSON(){throw new H("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}queryItems(e,r){let i=ls(Ry,e);const n=qu(this.portal);return parseFloat(n.currentVersion)>5?(i=i||new Ry,n.queryPortal(`/content/groups/${this.id}/search`,i,"PortalItem",r)):(i=i?i.clone():new Ry,i.query="group:"+this.id+(i.query?" "+i.query:""),n.queryItems(i,r))}_fetchCategorySchemaSet(e,r){const i=qu(this.portal);return i.fetchSelf(i.authMode,!0,r).then(n=>{const s=n.contentCategorySetsGroupQuery;if(s){const o=new Ry;return o.disableExtraQuery=!0,o.num=1,o.query=s,i.queryGroups(o,r)}throw new H("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(n=>{if(n.total){const s=n.results[0],o=new Ry;return o.num=1,o.query=`typekeywords:"${e}"`,s.queryItems(o,r)}throw new H("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(n=>n.total?n.results[0].fetchData("json",r).then(s=>{const o=s&&s.categorySchema;return o&&o.length?o:[]}):[])}};d([p()],va.prototype,"access",void 0),d([p({type:Date})],va.prototype,"created",void 0),d([p()],va.prototype,"description",void 0),d([p()],va.prototype,"id",void 0),d([p()],va.prototype,"isInvitationOnly",void 0),d([p({type:Date})],va.prototype,"modified",void 0),d([p()],va.prototype,"owner",void 0),d([p()],va.prototype,"portal",void 0),d([p()],va.prototype,"snippet",void 0),d([p()],va.prototype,"sortField",void 0),d([p()],va.prototype,"sortOrder",void 0),d([p()],va.prototype,"tags",void 0),d([p()],va.prototype,"thumbnail",void 0),d([p({readOnly:!0})],va.prototype,"thumbnailUrl",null),d([p()],va.prototype,"title",void 0),d([p({readOnly:!0})],va.prototype,"url",null),va=d([I("esri.portal.PortalGroup")],va);const FQ=va,Ypt=Object.freeze(Object.defineProperty({__proto__:null,default:FQ},Symbol.toStringTag,{value:"Module"}));var kQ;let Kn=kQ=class extends me{constructor(...t){super(...t),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userType=null}get thumbnailUrl(){const t=this.url,e=this.thumbnail;return t&&e?this.portal.normalizeUrl(`${t}/info/${e}?f=json`):null}get userContentUrl(){const t=this.get("portal.restUrl");return t?`${t}/content/users/${this.username}`:null}get url(){const t=this.get("portal.restUrl");return t?`${t}/community/users/${this.username}`:null}addItem(t){const e=t&&t.item,r=t&&t.data,i=t&&t.folder,n={method:"post"};e&&(n.query=e.createPostQuery(),r!=null&&(typeof r=="string"?n.query.text=r:typeof r=="object"&&(n.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+(typeof i=="string"?i:i.id)),this.portal.request(s+"/addItem",n).then(o=>(e.id=o.id,e.portal=this.portal,e.loaded?e.reload():e.load()))}deleteItem(t){let e=this.userContentUrl;return t.ownerFolder&&(e+="/"+t.ownerFolder),this.portal.request(e+`/items/${t.id}/delete`,{method:"post"}).then(()=>{t.id=null,t.portal=null})}deleteItems(t){const e=this.userContentUrl+"/deleteItems",r=t.map(i=>i.id);if(r.length){const i={method:"post",query:{items:r.join(",")}};return this.portal.request(e,i).then(()=>{t.forEach(n=>{n.id=null,n.portal=null})})}return Promise.resolve(void 0)}fetchFolders(){const t={query:{num:1}};return this.portal.request(this.userContentUrl??"",t).then(e=>{let r;return r=e&&e.folders?e.folders.map(i=>{const n=Xpt.fromJSON(i);return n.portal=this.portal,n}):[],r})}fetchGroups(){return this.portal.request(this.url??"").then(t=>{let e;return e=t&&t.groups?t.groups.map(r=>{const i=FQ.fromJSON(r);return i.portal=this.portal,i}):[],e})}fetchItems(t){const e=t??{};let r,i=this.userContentUrl??"";return e.folder&&(i+="/"+e.folder.id),le(()=>Promise.resolve().then(()=>WIe),void 0).then(({default:n})=>{r=n;const s={folders:!1,num:e.num||10,start:e.start||1,sortField:e.sortField||"created",sortOrder:e.sortOrder||"asc"};return this.portal.request(i,{query:s})}).then(n=>{let s;return n&&n.items?(s=n.items.map(o=>{const a=r.fromJSON(o);return a.portal=this.portal,a}),Promise.all(s.map(o=>o.load())).catch(o=>o).then(()=>({items:s,nextStart:n.nextStart,total:n.total}))):{items:[],nextStart:-1,total:0}})}fetchTags(){return this.portal.request(this.url+"/tags").then(t=>t.tags)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}queryFavorites(t){return this.favGroupId?(this._favGroup||(this._favGroup=new FQ({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(t)):Promise.reject(new H("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}toJSON(){throw new H("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");const e=new kQ;return e.sourceJSON=t,e.read(t),e}};d([p()],Kn.prototype,"access",void 0),d([p({type:Date})],Kn.prototype,"created",void 0),d([p()],Kn.prototype,"culture",void 0),d([p()],Kn.prototype,"description",void 0),d([p()],Kn.prototype,"email",void 0),d([p()],Kn.prototype,"favGroupId",void 0),d([p()],Kn.prototype,"fullName",void 0),d([p({type:Date})],Kn.prototype,"modified",void 0),d([p()],Kn.prototype,"orgId",void 0),d([p()],Kn.prototype,"portal",void 0),d([p()],Kn.prototype,"preferredView",void 0),d([p()],Kn.prototype,"privileges",void 0),d([p()],Kn.prototype,"region",void 0),d([p()],Kn.prototype,"role",void 0),d([p()],Kn.prototype,"roleId",void 0),d([p()],Kn.prototype,"sourceJSON",void 0),d([p()],Kn.prototype,"thumbnail",void 0),d([p({readOnly:!0})],Kn.prototype,"thumbnailUrl",null),d([p()],Kn.prototype,"units",void 0),d([p({readOnly:!0})],Kn.prototype,"userContentUrl",null),d([p({readOnly:!0})],Kn.prototype,"url",null),d([p()],Kn.prototype,"username",void 0),d([p()],Kn.prototype,"userType",void 0),Kn=kQ=d([I("esri.portal.PortalUser")],Kn);const Pce=Kn,Zpt=Object.freeze(Object.defineProperty({__proto__:null,default:Pce},Symbol.toStringTag,{value:"Module"}));var tv;let U5;const K0e={PortalGroup:()=>le(()=>Promise.resolve().then(()=>Ypt),void 0),PortalItem:()=>le(()=>Promise.resolve().then(()=>WIe),void 0),PortalUser:()=>le(()=>Promise.resolve().then(()=>Zpt),void 0)};let ot=tv=class extends C3(sg){constructor(t){super(t),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=Ti.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(t){return typeof t=="string"?{url:t}:t}destroy(){Q0e.unregister(this),this.defaultBasemap=qe(this.defaultBasemap),this.defaultDevBasemap=qe(this.defaultDevBasemap),this.defaultVectorBasemap=qe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=yi(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(t){if(t)for(const e of t)Ti.request.trustedServers.includes(e)||Ti.request.trustedServers.push(e);return t}readDefaultBasemap(t){return this._readBasemap(t)}readDefaultDevBasemap(t){return this._readBasemap(t)}readDefaultVectorBasemap(t){return this._readBasemap(t)}get extraQuery(){const t=!(this.user&&this.user.orgId)||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get restUrl(){let t=this.url;if(t){const e=t.indexOf("/sharing");t=e>0?t.substring(0,e):this.url.replace(/\/+$/,""),t+="/sharing/rest"}return t}get thumbnailUrl(){const t=this.restUrl,e=this.thumbnail;return t&&e?this._normalizeSSL(t+"/portals/self/resources/"+e):null}readUrlKey(t){return t&&t.toLowerCase()}readUser(t){let e=null;return t&&(e=Pce.fromJSON(t),e.portal=this),e}load(t){const e=le(()=>Promise.resolve().then(()=>Sft),void 0).then(({default:r})=>{vr(t),U5=r}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(r=>{var i;if(Hr){const n=Hr;this.credential=n.findCredential(this.restUrl),this.credential||this.authMode!==tv.AUTH_MODE_AUTO||((i=this._esriIdCredentialCreateHandle)==null||i.remove(),this._esriIdCredentialCreateHandle=n.on("credential-create",Jpt(new WeakRef(this))),Q0e.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=r,this.read(r)});return this.addResolvingPromise(e),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),e=(await le(()=>import("./ElevationLayer-925700ae.js"),["assets/ElevationLayer-925700ae.js","assets/ArcGISCachedService-4f08085c.js","assets/TileInfoTilemapCache-ceebbee8.js","assets/TilemapCache-7c47158a.js"])).default;return t?t.map(r=>new e({id:r.id,url:r.url})):[]}async fetchBasemaps(t,e){const r=await this._fetchBasemaps(t,e);if((e==null?void 0:e.include3d)===!0&&this.use3dBasemaps!==!1){const i=await this._fetchBasemaps3D(t,e);r.unshift(...i)}return r}fetchCategorySchema(t){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",t).then(e=>e.categorySchema):go(t)?Promise.reject(Wr()):Promise.resolve([])}fetchFeaturedGroups(t){const e=this.featuredGroups,r=new Ry;if(r.num=100,r.sortField="title",e&&e.length){const i=[];for(const n of e)i.push(`(title:"${n.title}" AND owner:${n.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,t).then(n=>n.results)}return go(t)?Promise.reject(Wr()):Promise.resolve([])}fetchRegions(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Ym();return this.request(this.restUrl+"/portals/regions",{...t,query:{culture:e}})}fetchSettings(t){var r;const e=((r=this.user)==null?void 0:r.culture)||this.culture||Ym();return this.request(this.restUrl+"/portals/self/settings",{...t,query:{culture:e}})}static getDefault(){return Hpt(()=>new tv)}queryGroups(t,e){return this.queryPortal("/community/groups",t,"PortalGroup",e)}queryItems(t,e){return this.queryPortal("/search",t,"PortalItem",e)}queryUsers(t,e){return t.sortField||(t.sortField="username"),this.queryPortal("/community/users",t,"PortalUser",e)}fetchSelf(t=this.authMode,e=!1,r){const i=this.restUrl+"/portals/self",n={authMode:t,query:{culture:Ym().toLowerCase()},...r};return n.authMode==="auto"&&(n.authMode="no-prompt"),e&&(n.query.default=!0),this.request(i,n)}queryPortal(t,e,r,i){const n=ls(Ry,e),s=o=>this.request(this.restUrl+t,{...n.toRequestOptions(this),...i}).then(a=>{const l=n.clone();return l.start=a.nextStart,new Wpt({nextQueryParams:l,queryParams:n,total:a.total,results:tv._resultsToTypedArray(o,{portal:this},a,i)})}).then(a=>Promise.all(a.results.map(l=>typeof l.when=="function"?l.when():a)).then(()=>a,l=>(Oa(l),a)));return r&&K0e[r]?K0e[r]().then(({default:o})=>(vr(i),s(o))):s()}signIn(){if(this.authMode===tv.AUTH_MODE_ANONYMOUS)return Promise.reject(new H("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if(this.loadStatus==="failed")return Promise.reject(this.loadError);const t=e=>Promise.resolve().then(()=>this.loadStatus==="not-loaded"?(e||(this.authMode="immediate"),this.load().then(()=>null)):this.loadStatus==="loading"?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(r=>{r&&(this.sourceJSON=r,this.read(r))});return Hr?Hr.getCredential(this.restUrl).then(e=>t(e)):t(this.credential)}normalizeUrl(t){const e=this.credential&&this.credential.token;return this._normalizeSSL(e?t+(t.includes("?")?"&":"?")+"token="+e:t)}requestToTypedArray(t,e,r){return this.request(t,e).then(i=>{const n=tv._resultsToTypedArray(r,{portal:this},i);return Promise.all(n.map(s=>typeof s.when=="function"?s.when():i)).then(()=>n,()=>n)})}request(t,e={}){const r={f:"json",...e.query},{authMode:i=this.authMode===tv.AUTH_MODE_ANONYMOUS?"anonymous":"auto",body:n=null,cacheBust:s=!1,method:o="auto",responseType:a="json",signal:l}=e,c={authMode:i,body:n,cacheBust:s,method:o,query:r,responseType:a,timeout:0,signal:l};return ti(this._normalizeSSL(t),c).then(u=>u.data)}toJSON(){throw new H("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new tv({sourceJSON:t})}_getHelperService(t){const e=this.helperServices&&this.helperServices[t];if(!e)throw new H("portal:service-not-found",`The \`helperServices\` do not include an entry named "${t}"`);return e}async _fetchBasemaps(t,e){const r=new Ry;r.query=t||(Ti.apiKey&&NIe(this.url)?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,e);if(!i.total)return[];const n=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=n.sortField||"name",r.sortOrder=n.sortOrder||"desc";const s=await n.queryItems(r,e);return s.total?s.results.filter(o=>o.type==="Web Map").map(o=>new U5({portalItem:o})):[]}async _fetchBasemaps3D(t,e){const r=t||this.basemapGalleryGroupQuery3D;if(!r)return[];const i=new Ry({query:r,disableExtraQuery:!0}),n=await this.queryGroups(i,e);if(!n.total)return[];const s=n.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const o=await s.queryItems(i,e);return o.total?o.results.filter(a=>a.type==="Web Scene").map(a=>new U5({portalItem:a})):[]}_normalizeSSL(t){return t.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(t){if(t){const e=U5.fromJSON(t);return e.portalItem={portal:this},e}return null}static _resultsToTypedArray(t,e,r,i){let n=[];if(r){const s=i!=null?i.signal:null;n=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(t||e)&&(n=n.map(o=>{const a=Object.assign(t?t.fromJSON(o):o,e);return typeof a.load=="function"&&a.load(s),a}))}else n=[];return n}};ot.AUTH_MODE_ANONYMOUS="anonymous",ot.AUTH_MODE_AUTO="auto",ot.AUTH_MODE_IMMEDIATE="immediate",d([p()],ot.prototype,"access",void 0),d([p()],ot.prototype,"allSSL",void 0),d([p()],ot.prototype,"authMode",void 0),d([p()],ot.prototype,"authorizedCrossOriginDomains",void 0),d([ke("authorizedCrossOriginDomains")],ot.prototype,"readAuthorizedCrossOriginDomains",null),d([p()],ot.prototype,"basemapGalleryGroupQuery",void 0),d([p({json:{name:"3DBasemapGalleryGroupQuery"}})],ot.prototype,"basemapGalleryGroupQuery3D",void 0),d([p()],ot.prototype,"bingKey",void 0),d([p()],ot.prototype,"canListApps",void 0),d([p()],ot.prototype,"canListData",void 0),d([p()],ot.prototype,"canListPreProvisionedItems",void 0),d([p()],ot.prototype,"canProvisionDirectPurchase",void 0),d([p()],ot.prototype,"canSearchPublic",void 0),d([p()],ot.prototype,"canShareBingPublic",void 0),d([p()],ot.prototype,"canSharePublic",void 0),d([p()],ot.prototype,"canSignInArcGIS",void 0),d([p()],ot.prototype,"canSignInIDP",void 0),d([p()],ot.prototype,"colorSetsGroupQuery",void 0),d([p()],ot.prototype,"commentsEnabled",void 0),d([p({type:Date})],ot.prototype,"created",void 0),d([p()],ot.prototype,"credential",void 0),d([p()],ot.prototype,"culture",void 0),d([p()],ot.prototype,"currentVersion",void 0),d([p()],ot.prototype,"customBaseUrl",void 0),d([p()],ot.prototype,"defaultBasemap",void 0),d([ke("defaultBasemap")],ot.prototype,"readDefaultBasemap",null),d([p()],ot.prototype,"defaultDevBasemap",void 0),d([ke("defaultDevBasemap")],ot.prototype,"readDefaultDevBasemap",null),d([p({type:$r})],ot.prototype,"defaultExtent",void 0),d([p()],ot.prototype,"defaultVectorBasemap",void 0),d([ke("defaultVectorBasemap")],ot.prototype,"readDefaultVectorBasemap",null),d([p()],ot.prototype,"description",void 0),d([p()],ot.prototype,"devBasemapGalleryGroupQuery",void 0),d([p()],ot.prototype,"eueiEnabled",void 0),d([p({readOnly:!0})],ot.prototype,"extraQuery",null),d([p()],ot.prototype,"featuredGroups",void 0),d([p()],ot.prototype,"featuredItemsGroupQuery",void 0),d([p()],ot.prototype,"galleryTemplatesGroupQuery",void 0),d([p()],ot.prototype,"livingAtlasGroupQuery",void 0),d([p()],ot.prototype,"hasCategorySchema",void 0),d([p()],ot.prototype,"helpBase",void 0),d([p()],ot.prototype,"helperServices",void 0),d([p()],ot.prototype,"helpMap",void 0),d([p()],ot.prototype,"homePageFeaturedContent",void 0),d([p()],ot.prototype,"homePageFeaturedContentCount",void 0),d([p()],ot.prototype,"httpPort",void 0),d([p()],ot.prototype,"httpsPort",void 0),d([p()],ot.prototype,"id",void 0),d([p()],ot.prototype,"ipCntryCode",void 0),d([p({readOnly:!0})],ot.prototype,"isOrganization",null),d([p()],ot.prototype,"isPortal",void 0),d([p()],ot.prototype,"isReadOnly",void 0),d([p({readOnly:!0})],ot.prototype,"itemPageUrl",null),d([p()],ot.prototype,"layerTemplatesGroupQuery",void 0),d([p()],ot.prototype,"maxTokenExpirationMinutes",void 0),d([p({type:Date})],ot.prototype,"modified",void 0),d([p()],ot.prototype,"name",void 0),d([p()],ot.prototype,"portalHostname",void 0),d([p()],ot.prototype,"portalMode",void 0),d([p()],ot.prototype,"portalProperties",void 0),d([p()],ot.prototype,"region",void 0),d([p({readOnly:!0})],ot.prototype,"restUrl",null),d([p()],ot.prototype,"rotatorPanels",void 0),d([p()],ot.prototype,"showHomePageDescription",void 0),d([p()],ot.prototype,"sourceJSON",void 0),d([p()],ot.prototype,"staticImagesUrl",void 0),d([p({json:{name:"2DStylesGroupQuery"}})],ot.prototype,"stylesGroupQuery2d",void 0),d([p({json:{name:"stylesGroupQuery"}})],ot.prototype,"stylesGroupQuery3d",void 0),d([p()],ot.prototype,"supportsHostedServices",void 0),d([p()],ot.prototype,"symbolSetsGroupQuery",void 0),d([p()],ot.prototype,"templatesGroupQuery",void 0),d([p()],ot.prototype,"thumbnail",void 0),d([p({readOnly:!0})],ot.prototype,"thumbnailUrl",null),d([p()],ot.prototype,"units",void 0),d([p()],ot.prototype,"url",void 0),d([p()],ot.prototype,"urlKey",void 0),d([ke("urlKey")],ot.prototype,"readUrlKey",null),d([p()],ot.prototype,"user",void 0),d([ke("user")],ot.prototype,"readUser",null),d([p()],ot.prototype,"use3dBasemaps",void 0),d([p()],ot.prototype,"useStandardizedQuery",void 0),d([p()],ot.prototype,"useVectorBasemaps",void 0),d([p()],ot.prototype,"vectorBasemapGalleryGroupQuery",void 0),ot=tv=d([I("esri.portal.Portal")],ot);const Ns=ot,Q0e=new FinalizationRegistry(t=>{t.remove()});function Jpt(t){const e=Hr;return()=>{const r=t.deref();r&&e.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}const Kpt=re.getLogger("esri.assets");function Qpt(t,e){return ti(fi(t),e)}function fi(t){if(!Ti.assetsPath)throw Kpt.errorOnce("The API assets location needs to be set using config.assetsPath. More information: https://arcg.is/1OzLe50"),new H("assets:path-not-set","config.assetsPath is not set");return bd(Ti.assetsPath,t)}let rv=class extends Ce{constructor(e){super(e),this.portalItem=null}normalizeCtorArgs(e){return e&&e.portalItem&&e.path?{...e,path:this._normalizePath(e.path,e.portalItem)}:e}set path(e){e!=null&&fd(e)?re.getLogger(this).error("portalitemresource:invalid-path","A portal item resource path must be relative"):this._set("path",e)}_castPath(e){return this._normalizePath(e,this.portalItem)}get url(){return this.portalItem&&this.path?`${this.portalItem.itemUrl}/resources/${this.path}`:null}get cdnUrl(){return this.portalItem&&this.path?`${this.portalItem.itemCdnUrl}/resources/${this.path}`:null}get itemRelativeUrl(){return this.portalItem&&this.path?`./resources/${this.path}`:null}fetch(e="json",r){const i=this.cdnUrl;if(i==null)throw new H("portal-item-resource:fetch","Portal item resource does not refer to a valid item or path");return this.portalItem.portal.request(i,{responseType:e,query:{token:this.portalItem.apiKey},signal:r==null?void 0:r.signal})}async update(e,r){const{addOrUpdateResource:i}=await le(()=>Promise.resolve().then(()=>rI),void 0);return i(this,"update",e,r)}hasPath(){return this.path!=null}_normalizePath(e,r){return e==null?e:(e=e.replace(/^\/+/,""),r!=null&&fd(e)&&(e=Jle(e,r.itemUrl)),e==null?void 0:e.replace(/^\/+/,"").replace(/^(\.\/)?resources\//,""))}};d([p()],rv.prototype,"portalItem",void 0),d([p({type:String,value:null})],rv.prototype,"path",null),d([ur("path")],rv.prototype,"_castPath",null),d([p({type:String,readOnly:!0})],rv.prototype,"url",null),d([p({type:String,readOnly:!0})],rv.prototype,"cdnUrl",null),d([p({type:String,readOnly:!0})],rv.prototype,"itemRelativeUrl",null),rv=d([I("esri.portal.PortalItemResource")],rv);const eft=rv;let K$=class extends Ce{constructor(e){super(e),this.created=null,this.rating=null}};d([p()],K$.prototype,"created",void 0),d([p()],K$.prototype,"rating",void 0),K$=d([I("esri.portal.PortalRating")],K$);const ZW=K$;var AS;const tft=new Set(["Map Service","Feature Service","Feature Collection","Scene Service","Image Service","Stream Service","Vector Tile Service","GeoJson","CSV","KML","WFS","WMTS","WMS","Feed"]),rft=new Set(["KML","GeoJson","CSV"]);let Pr=AS=class extends C3(sg){static from(t){return X2(AS,t)}constructor(t){super(t),this.access=null,this.accessInformation=null,this.apiKey=null,this.applicationProxies=null,this.avgRating=null,this.categories=null,this.created=null,this.culture=null,this.description=null,this.extent=null,this.groupCategories=null,this.id=null,this.isOrgItem=!1,this.itemControl=null,this.licenseInfo=null,this.modified=null,this.name=null,this.numComments=null,this.numRatings=null,this.numViews=null,this.owner=null,this.ownerFolder=null,this.portal=null,this.screenshots=null,this.size=null,this.snippet=null,this.sourceJSON=null,this.sourceUrl=null,this.spatialReference=null,this.tags=null,this.title=null,this.type=null,this.typeKeywords=null,this.url=null}destroy(){this.portal=null}get displayName(){const t=this.type,e=this.typeKeywords||[];let r=t;return t==="Feature Service"||t==="Feature Collection"?r=e.includes("Table")?"Table":e.includes("Route Layer")?"Route Layer":e.includes("Markup")?"Markup":"Feature Layer":t==="Image Service"?r=e.includes("Elevation 3D Layer")?"Elevation Layer":e.includes("Tiled Imagery")?"Tiled Imagery Layer":"Imagery Layer":t==="Scene Service"?r="Scene Layer":t==="Video Service"?r="Video Layer":t==="Scene Package"?r="Scene Layer Package":t==="Stream Service"?r="Feature Layer":t==="Geoprocessing Service"?r=e.includes("Web Tool")?"Tool":"Geoprocessing Service":t==="Geocoding Service"?r="Locator":t==="Geoenrichment Service"?r="GeoEnrichment Service":t==="Microsoft Powerpoint"?r="Microsoft PowerPoint":t==="GeoJson"?r="GeoJSON":t==="Globe Service"?r="Globe Layer":t==="Vector Tile Service"?r="Tile Layer":t==="netCDF"?r="NetCDF":t==="Map Service"?r=e.includes("Spatiotemporal")||!e.includes("Hosted Service")&&!e.includes("Tiled")||e.includes("Relational")?"Map Image Layer":"Tile Layer":t&&t.toLowerCase().includes("add in")?r=t.replaceAll(/(add in)/gi,"Add-In"):t==="datastore catalog service"?r="Big Data File Share":t==="Compact Tile Package"?r="Tile Package (tpkx)":t==="OGCFeatureServer"?r="OGC Feature Layer":t==="web mapping application"&&e.includes("configurableApp")?r="Instant App":t==="Insights Page"?r="Insights Report":t==="Excalibur Imagery Project"&&(r="Excalibur Project"),r}readExtent(t){return t&&t.length?new $r(t[0][0],t[0][1],t[1][0],t[1][1]):null}get iconUrl(){const t=this.type&&this.type.toLowerCase()||"",e=this.typeKeywords||[],r="esri/images/portal/",i="16";let n,s=!1,o=!1,a=!1,l=!1,c=!1,u=!1;return t.indexOf("service")>0||t==="feature collection"||t==="kml"||t==="wms"||t==="wmts"||t==="wfs"?(s=e.includes("Hosted Service"),t==="feature service"||t==="feature collection"||t==="kml"||t==="wfs"?(o=e.includes("Table"),a=e.includes("Route Layer"),l=e.includes("Markup"),c=e.includes("Spatiotemporal"),u=e.includes("UtilityNetwork"),n=c&&o?"spatiotemporaltable":o?"table":a?"routelayer":l?"markup":c?"spatiotemporal":s?"featureshosted":u?"utilitynetwork":"features"):n=t==="map service"||t==="wms"||t==="wmts"?s||e.includes("Tiled")||t==="wmts"?"maptiles":"mapimages":t==="scene service"?e.includes("Line")?"sceneweblayerline":e.includes("3DObject")?"sceneweblayermultipatch":e.includes("Point")?"sceneweblayerpoint":e.includes("IntegratedMesh")?"sceneweblayermesh":e.includes("PointCloud")?"sceneweblayerpointcloud":e.includes("Polygon")?"sceneweblayerpolygon":e.includes("Building")?"sceneweblayerbuilding":e.includes("Voxel")?"sceneweblayervoxel":"sceneweblayer":t==="image service"?e.includes("Elevation 3D Layer")?"elevationlayer":e.includes("Tiled Imagery")?"tiledimagerylayer":"imagery":t==="stream service"?"streamlayer":t==="video service"?e.includes("Live Stream")?"livestreamvideolayer":"videolayer":t==="vector tile service"?"vectortile":t==="datastore catalog service"?"datastorecollection":t==="geocoding service"?"geocodeservice":t==="geoprocessing service"?e.includes("Web Tool")?"tool":"layers":t==="geodata service"?"geodataservice":"layers"):n=t==="web map"||t==="cityengine web scene"?"maps":t==="web scene"?e.includes("ViewingMode-Local")?"webscenelocal":"websceneglobal":t==="web mapping application"&&e.includes("configurableApp")?"instantapps":t==="web mapping application"||t==="mobile application"||t==="application"||t==="operation view"||t==="desktop application"?"apps":t==="map document"||t==="map package"||t==="published map"||t==="scene document"||t==="globe document"||t==="basemap package"||t==="mobile basemap package"||t==="mobile map package"||t==="project package"||t==="project template"||t==="pro map"||t==="layout"||t==="layer"&&e.includes("ArcGIS Pro")||t==="explorer map"&&e.indexOf("Explorer Document")?"mapsgray":t==="service definition"||t==="csv"||t==="shapefile"||t==="cad drawing"||t==="geojson"||t==="netcdf"||t==="administrative report"?"datafiles":t==="explorer add in"||t==="desktop add in"||t==="windows viewer add in"||t==="windows viewer configuration"?"appsgray":t==="360 vr experience"?"360vr":t==="arcgis pro add in"||t==="arcgis pro configuration"?"addindesktop":t==="rule package"||t==="file geodatabase"||t==="sqlite geodatabase"||t==="csv collection"||t==="kml collection"||t==="windows mobile package"||t==="map template"||t==="desktop application template"||t==="gml"||t==="arcpad package"||t==="code sample"||t==="form"||t==="document link"||t==="earth configuration"||t==="operations dashboard add in"||t==="rules package"||t==="image"||t==="workflow manager package"||t==="explorer map"&&e.includes("Explorer Mapping Application")||e.includes("Document")?"datafilesgray":t==="network analysis service"||t==="geoprocessing service"||t==="geodata service"||t==="geometry service"||t==="geoprocessing package"||t==="locator package"||t==="geoprocessing sample"||t==="workflow manager service"?"toolsgray":t==="layer"||t==="layer package"||t==="explorer layer"?"layersgray":t==="scene package"?"scenepackage":t==="mobile scene package"?"mobilescenepackage":t==="tile package"||t==="compact tile package"?"tilepackage":t==="task file"?"taskfile":t==="report template"?"report-template":t==="statistical data collection"?"statisticaldatacollection":t==="insights workbook"?"workbook":t==="insights model"?"insightsmodel":t==="insights page"?"insightspage":t==="insights theme"?"insightstheme":t==="hub initiative"?"hubinitiative":t==="hubpage"?"hubpage":t==="hub event"?"hubevent":t==="hub site application"?"hubsite":t==="hub project"?"hubproject":t==="relational database connection"?"relationaldatabaseconnection":t==="big data file share"?"datastorecollection":t==="image collection"?"imagecollection":t==="style"?"style":t==="desktop style"?"desktopstyle":t==="dashboard"?"dashboard":t==="raster function template"?"rasterprocessingtemplate":t==="vector tile package"?"vectortilepackage":t==="ortho mapping project"?"orthomappingproject":t==="ortho mapping template"?"orthomappingtemplate":t==="solution"?"solutions":t==="geopackage"?"geopackage":t==="deep learning package"?"deeplearningpackage":t==="real time analytic"?"realtimeanalytics":t==="big data analytic"?"bigdataanalytics":t==="feed"?"feed":t==="excalibur imagery project"?"excaliburimageryproject":t==="notebook"?"notebook":t==="storymap"?"storymap":t==="survey123 add in"?"survey123addin":t==="mission"?"mission":t==="mission report"?"missionreport":t==="quickcapture project"?"quickcaptureproject":t==="pro report"?"proreport":t==="pro report template"?"proreporttemplate":t==="urban model"?"urbanmodel":t==="web experience"?"experiencebuilder":t==="web experience template"?"webexperiencetemplate":t==="experience builder widget"?"experiencebuilderwidget":t==="experience builder widget package"?"experiencebuilderwidgetpackage":t==="workflow"?"workflow":t==="insights script"?"insightsscript":t==="kernel gateway connection"?"kernelgatewayconnection":t==="hub initiative template"?"hubinitiativetemplate":t==="storymap theme"?"storymaptheme":t==="knowledge graph"?"knowledgegraph":t==="native application"?"nativeapp":t==="native application installer"?"nativeappinstaller":t==="link chart"?"linkchart":t==="investigation"?"investigation":t==="ogcfeatureserver"?"features":t==="pro project"?"proproject":t==="insights workbook package"?"insightsworkbookpackage":t==="apache parquet"?"apacheparquet":t==="notebook code snippets"||t==="notebook code snippet library"?"notebookcodesnippets":t==="suitability model"?"suitabilitymodel":t==="esri classifier definition"?"classifierdefinition":t==="esri classification schema"?"classificationschema":t==="insights data engineering workbook"?"dataengineeringworkbook":t==="insights data engineering model"?"dataengineeringmodel":t==="deep learning studio project"?"deeplearningproject":t==="discussion"?"discussion":t==="allsource project"?"allsourceproject":t==="api key"?"apikey":t==="data pipeline"?"datapipelines":"maps",n?fi(r+n+i+".png"):null}get isLayer(){return this.type!=null&&tft.has(this.type)}get itemCdnUrl(){let t=this.itemUrl;return t&&Hr&&!Hr.findCredential(t)&&(t=Hr._normalizeAGOLorgDomain(t),t=t.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),t=t.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),t=t.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),t}get itemPageUrl(){var e;const t=(e=this.portal)==null?void 0:e.itemPageUrl;return t&&this.id?`${t}?id=${this.id}`:null}get itemUrl(){var e;const t=(e=this.portal)==null?void 0:e.restUrl;return t&&this.id?`${t}/content/items/${this.id}`:null}get thumbnailUrl(){var r;const t=this.itemUrl,e=this.thumbnail;return t&&e?((r=this.portal)==null?void 0:r.normalizeUrl(`${t}/info/${e}?f=json`))??null:null}get userItemUrl(){const t=this.get("portal.restUrl");if(!t)return null;const e=this.owner||this.get("portal.user.username");return e?`${t}/content/users/${this.ownerFolder?`${e}/${this.ownerFolder}`:e}/items/${this.id}`:null}load(t){const e=this.portal??(this.portal=Ns.getDefault()),r=e.load(t).then(()=>this.sourceJSON?this.sourceJSON:this.id&&this.itemUrl?e.request(this.itemUrl,{signal:t!=null?t.signal:null,query:{token:this.apiKey}}):{}).then(i=>{this.sourceJSON=i,this.read(i)});return this.addResolvingPromise(r),Promise.resolve(this)}async addRating(t){const e={method:"post",query:{}};return t instanceof ZW&&(t=t.rating),t==null||isNaN(t)||typeof t!="number"||(e.query.rating=t),this.portal?(await this.portal.request(this.itemUrl+"/addRating",e),new ZW({rating:t,created:new Date})):null}clone(){const t={access:this.access,accessInformation:this.accessInformation,applicationProxies:ie(this.applicationProxies),avgRating:this.avgRating,categories:ie(this.categories),created:ie(this.created),culture:this.culture,description:this.description,extent:ie(this.extent),groupCategories:ie(this.groupCategories),id:this.id,itemControl:this.itemControl,licenseInfo:this.licenseInfo,modified:ie(this.modified),name:this.name,numComments:this.numComments,numRatings:this.numRatings,numViews:this.numViews,owner:this.owner,ownerFolder:this.ownerFolder,portal:this.portal,screenshots:ie(this.screenshots),size:this.size,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ie(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ie(this.typeKeywords),url:this.url};this.loaded&&(t.loadStatus="loaded");const e=new AS({sourceJSON:this.sourceJSON}).set(t);return e._set("isOrgItem",this.isOrgItem),e}createPostQuery(){var r;const t=this.toJSON();for(const i of["tags","typeKeywords","categories"])t[i]=(r=t[i])==null?void 0:r.join(", ");const{extent:e}=t;return e&&(t.extent=JSON.stringify(e)),t}async deleteRating(){await qu(this.portal).request(this.itemUrl+"/deleteRating",{method:"post"})}fetchData(t="json",e){return qu(this.portal).request(this.itemUrl+"/data",{responseType:t,...e,query:{token:this.apiKey}})}async fetchRating(t){const e=await qu(this.portal).request(this.itemUrl+"/rating",{query:{token:this.apiKey},...t});return e.rating!=null?(e.created=new Date(e.created),new ZW(e)):null}fetchRelatedItems(t,e){return qu(this.portal).requestToTypedArray(this.itemUrl+"/relatedItems",{query:{...t,token:this.apiKey},...e},AS)}getThumbnailUrl(t){let e=this.thumbnailUrl;return e&&t&&(e+=`&w=${t}`),e}reload(){return qu(this.portal).request(this.itemUrl??"",{cacheBust:!0,query:{token:this.apiKey}}).then(t=>(this.sourceJSON=t,this.read(t),this))}update(t){return this.id?this.load().then(()=>qu(this.portal).signIn()).then(()=>{const e=t&&t.data,r={method:"post"};r.query=this.createPostQuery();for(const i in r.query)r.query[i]===null&&(r.query[i]="");return r.query.clearEmptyFields=!0,e!=null&&(typeof e=="string"?r.query.text=e:typeof e=="object"&&(r.query.text=JSON.stringify(e))),this.portal.request(`${this.userItemUrl}/update`,r).then(()=>this.reload())}):Promise.reject(new H("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async copy(t){if(!this.id)throw new H("portal:item-does-not-exist","The item does not exist yet");await this.load();const{portal:e,itemUrl:r}=this;await qu(e).signIn();const{copyResources:i,folder:n,tags:s,title:o}=t||{},a={method:"post",query:{copyPrivateResources:i==="all",folder:typeof n=="string"?n:n==null?void 0:n.id,includeResources:!!i,tags:s==null?void 0:s.join(","),title:o}},{itemId:l}=await e.request(`${r}/copy`,a);return new AS({id:l,portal:e})}updateThumbnail(t){return this.id?this.load().then(()=>this.portal.signIn()).then(()=>{const e=t.thumbnail,r=t.filename,i={method:"post"};if(typeof e=="string")b0(e)?i.query={data:e}:i.query={url:ah(e)},r!=null&&(i.query.filename=r);else{const n=new FormData;r!=null?n.append("file",e,r):n.append("file",e),i.body=n}return this.portal.request(`${this.userItemUrl}/updateThumbnail`,i).then(()=>this.reload())}):Promise.reject(new H("portal:item-does-not-exist","The item does not exist yet and cannot be updated"))}async fetchResources(t={},e){const{fetchResources:r}=await le(()=>Promise.resolve().then(()=>rI),void 0);return r(this,t,e)}async addResource(t,e,r){const{addOrUpdateResource:i}=await le(()=>Promise.resolve().then(()=>rI),void 0);return t.portalItem=this,i(t,"add",e,r)}async removeResource(t,e){const{removeResource:r}=await le(()=>Promise.resolve().then(()=>rI),void 0);if(t.portalItem&&t.portalItem.itemUrl!==this.itemUrl)throw new H("removeresource:portal-item-mismatch","The portal item associated with the provided resource does not match the item");return r(this,t,e)}async removeAllResources(t){const{removeAllResources:e}=await le(()=>Promise.resolve().then(()=>rI),void 0);return e(this,t)}resourceFromPath(t){return new eft({portalItem:this,path:t})}toJSON(){const t=this.extent,e={accessInformation:this.accessInformation,categories:ie(this.categories),created:this.created&&this.created.getTime(),description:this.description,extent:t&&[[t.xmin,t.ymin],[t.xmax,t.ymax]],id:this.id,isOrgItem:this.isOrgItem,licenseInfo:this.licenseInfo,modified:this.modified&&this.modified.getTime(),name:this.name,owner:this.owner,ownerFolder:this.ownerFolder,snippet:this.snippet,sourceUrl:this.sourceUrl,spatialReference:this.spatialReference,tags:ie(this.tags),thumbnail:this.thumbnail,title:this.title,type:this.type,typeKeywords:ie(this.typeKeywords),url:this.url};return n$e(e)}static fromJSON(t){if(!t)return null;if(t.declaredClass)throw new Error("JSON object is already hydrated");return new AS({sourceJSON:t})}_getPostQuery(){const t=this.toJSON();for(const e in t)e==="tags"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="typeKeywords"&&t[e]!==null&&(t[e]=t[e].join(", ")),e==="extent"&&t[e]&&(t[e]=JSON.stringify(t[e]));return t}};d([p({type:["private","shared","org","public"]})],Pr.prototype,"access",void 0),d([p()],Pr.prototype,"accessInformation",void 0),d([p({type:String})],Pr.prototype,"apiKey",void 0),d([p({json:{read:{source:"appProxies"}}})],Pr.prototype,"applicationProxies",void 0),d([p()],Pr.prototype,"avgRating",void 0),d([p()],Pr.prototype,"categories",void 0),d([p({type:Date})],Pr.prototype,"created",void 0),d([p()],Pr.prototype,"culture",void 0),d([p()],Pr.prototype,"description",void 0),d([p({readOnly:!0})],Pr.prototype,"displayName",null),d([p({type:$r})],Pr.prototype,"extent",void 0),d([ke("extent")],Pr.prototype,"readExtent",null),d([p()],Pr.prototype,"groupCategories",void 0),d([p({readOnly:!0})],Pr.prototype,"iconUrl",null),d([p()],Pr.prototype,"id",void 0),d([p({readOnly:!0})],Pr.prototype,"isLayer",null),d([p({type:Boolean,readOnly:!0})],Pr.prototype,"isOrgItem",void 0),d([p()],Pr.prototype,"itemControl",void 0),d([p({readOnly:!0})],Pr.prototype,"itemPageUrl",null),d([p({readOnly:!0})],Pr.prototype,"itemUrl",null),d([p()],Pr.prototype,"licenseInfo",void 0),d([p({type:Date})],Pr.prototype,"modified",void 0),d([p()],Pr.prototype,"name",void 0),d([p()],Pr.prototype,"numComments",void 0),d([p()],Pr.prototype,"numRatings",void 0),d([p()],Pr.prototype,"numViews",void 0),d([p()],Pr.prototype,"owner",void 0),d([p()],Pr.prototype,"ownerFolder",void 0),d([p({type:Ns})],Pr.prototype,"portal",void 0),d([p()],Pr.prototype,"screenshots",void 0),d([p()],Pr.prototype,"size",void 0),d([p()],Pr.prototype,"snippet",void 0),d([p()],Pr.prototype,"sourceJSON",void 0),d([p({type:String})],Pr.prototype,"sourceUrl",void 0),d([p({type:String})],Pr.prototype,"spatialReference",void 0),d([p()],Pr.prototype,"tags",void 0),d([p()],Pr.prototype,"thumbnail",void 0),d([p({readOnly:!0})],Pr.prototype,"thumbnailUrl",null),d([p()],Pr.prototype,"title",void 0),d([p()],Pr.prototype,"type",void 0),d([p()],Pr.prototype,"typeKeywords",void 0),d([p({type:String,json:{read(t,e){var r;if(rft.has(e.type)){const i=(r=this.portal)==null?void 0:r.restUrl;t||(t=i&&this.id?`${i}/content/items/${this.id}/data`:null)}return t}}})],Pr.prototype,"url",void 0),d([p({readOnly:!0})],Pr.prototype,"userItemUrl",null),Pr=AS=d([I("esri.portal.PortalItem")],Pr);const Qv=Pr,WIe=Object.freeze(Object.defineProperty({__proto__:null,default:Qv},Symbol.toStringTag,{value:"Module"})),eve=/^([a-z]{2})(?:[-_]([A-Za-z]{2}))?$/,ift={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:!0,nl:!0,pl:!0,"pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,"zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function tve(t){return t in ift}const Q$=[],wA=new Map;function rve(t){for(const e of wA.keys())YIe(t.pattern,e)&&wA.delete(e)}function nft(t){return Q$.includes(t)||(rve(t),Q$.unshift(t)),{remove(){const e=Q$.indexOf(t);e>-1&&(Q$.splice(e,1),rve(t))}}}async function XIe(t){const e=Ym();wA.has(t)||wA.set(t,oft(t,e));const r=wA.get(t);return r&&await aft.add(r),r}function sft(t){if(!eve.test(t))return null;const e=eve.exec(t);if(e===null)return null;const[,r,i]=e,n=r+(i?"-"+i.toUpperCase():"");return tve(n)?n:tve(r)?r:null}async function oft(t,e){const r=[];for(const i of Q$)if(YIe(i.pattern,t))try{return await i.fetchMessageBundle(t,e)}catch(n){r.push(n)}throw r.length?new H("intl:message-bundle-error",`Errors occurred while loading "${t}"`,{errors:r}):new H("intl:no-message-bundle-loader",`No loader found for message bundle "${t}"`)}function YIe(t,e){return typeof t=="string"?e.startsWith(t):t.test(e)}Ace(()=>{wA.clear()});const aft=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(t){return this._increase(),t.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=Da())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&this._numLoading===0&&(this._dfd.resolve(),this._dfd=null)}};async function lft(t){if(!t)return;const e=t.includes("-vector")?t.slice(0,t.indexOf("-vector")):t,r=await XIe("esri/t9n/basemaps");return r[t]||r[e]}const UQ={streets:{id:"streets",classic:!0,deprecated:!0,get thumbnailUrl(){return fi("esri/images/basemap/streets.jpg")},baseMapLayers:[{id:"streets-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Street Map",showLegend:!1,visibility:!0,opacity:1}]},satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},topo:{id:"topo",classic:!0,deprecated:!0,get thumbnailUrl(){return fi("esri/images/basemap/topo.jpg")},baseMapLayers:[{id:"topo-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Topo Map",showLegend:!1,visibility:!0,opacity:1}]},gray:{id:"gray",classic:!0,deprecated:!0,get thumbnailUrl(){return fi("esri/images/basemap/gray.jpg")},baseMapLayers:[{id:"gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Light Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"dark-gray":{id:"dark-gray",classic:!0,deprecated:!0,get thumbnailUrl(){return fi("esri/images/basemap/dark-gray.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Base",showLegend:!1,visibility:!0,opacity:1},{id:"dark-gray-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Dark Gray Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},"national-geographic":{id:"national-geographic",classic:!0,deprecated:!0,get thumbnailUrl(){return fi("esri/images/basemap/national-geographic.jpg")},baseMapLayers:[{id:"national-geographic-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer",title:"NatGeo World Map",showLegend:!1,layerType:"ArcGISTiledMapServiceLayer",visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return fi("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"arcgis-imagery":{get thumbnailUrl(){return fi("esri/images/basemap/hybrid.jpg")},title:"Imagery Hybrid",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-imagery-standard":{get thumbnailUrl(){return fi("esri/images/basemap/satellite.jpg")},title:"Imagery",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Imagery",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/World_Imagery/MapServer"}]},"arcgis-imagery-labels":{title:"Hybrid [Reference]",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Imagery:Labels",title:"Hybrid Reference Layer",isReference:!0}]},"arcgis-light-gray":{get thumbnailUrl(){return fi("esri/images/basemap/gray-vector.jpg")},title:"Light Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Base",title:"Light Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:LightGray:Labels",title:"Light Gray Canvas Labels",isReference:!0}]},"arcgis-dark-gray":{get thumbnailUrl(){return fi("esri/images/basemap/dark-gray.jpg")},title:"Dark Gray Canvas",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Base",title:"Dark Gray Canvas Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:DarkGray:Labels",title:"Dark Gray Canvas Labels",isReference:!0}]},"arcgis-navigation":{get thumbnailUrl(){return fi("esri/images/basemap/streets-navigation.jpg")},title:"Navigation",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Navigation",title:"World Navigation Map"}]},"arcgis-navigation-night":{title:"Navigation (Dark Mode)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:NavigationNight",title:"World Navigation Map (Dark Mode)"}]},"arcgis-streets":{get thumbnailUrl(){return fi("esri/images/basemap/streets-vector.jpg")},title:"Streets",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Streets",title:"World Street Map"}]},"arcgis-streets-night":{get thumbnailUrl(){return fi("esri/images/basemap/streets-night.jpg")},title:"Streets (Night)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsNight",title:"World Street Map (Night)"}]},"arcgis-streets-relief":{get thumbnailUrl(){return fi("esri/images/basemap/streets-relief.jpg")},title:"Streets (with Relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:StreetsRelief:Base",title:"World Street Map (with Relief)"}]},"arcgis-topographic":{get thumbnailUrl(){return fi("esri/images/basemap/topo.jpg")},title:"Topographic",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Topographic:Base",title:"World Topographic Map"}]},"arcgis-oceans":{get thumbnailUrl(){return fi("esri/images/basemap/oceans.jpg")},title:"Oceans",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Ocean Base",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Oceans:Labels",title:"World Ocean Reference",isReference:!0}]},"osm-standard":{title:"OpenStreetMap",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Standard",title:"OpenStreetMap"}]},"osm-standard-relief":{title:"OpenStreetMap (with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StandardRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-streets":{title:"OpenStreetMap (Streets)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:Streets",title:"OpenStreetMap (Streets)"}]},"osm-streets-relief":{title:"OpenStreetMap (Streets with relief)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:StreetsRelief:Base",layerType:"VectorTileLayer",title:"OpenStreetMap Relief Base"}]},"osm-light-gray":{title:"OpenStreetMap (Light Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Base",title:"OSM (Light Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:LightGray:Labels",title:"OSM (Light Gray Reference)",isReference:!0}]},"osm-dark-gray":{title:"OpenStreetMap (Dark Gray Canvas)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Base",title:"OSM (Dark Gray Base)"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/OSM:DarkGray:Labels",title:"OSM (Dark Gray Reference)",isReference:!0}]},"arcgis-terrain":{title:"Terrain with Labels",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Base",title:"World Terrain Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Terrain:Detail",title:"World Terrain Reference",isReference:!0}]},"arcgis-community":{title:"Community",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Community",title:"Community"}]},"arcgis-charted-territory":{title:"Charted Territory",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ChartedTerritory:Base",title:"Charted Territory"}]},"arcgis-colored-pencil":{title:"Colored Pencil",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ColoredPencil",title:"Colored Pencil"}]},"arcgis-nova":{title:"Nova",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Nova",title:"Nova"}]},"arcgis-modern-antique":{title:"Modern Antique",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:ModernAntique:Base",title:"Modern Antique"}]},"arcgis-midcentury":{title:"Mid-Century",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Midcentury",title:"Mid-Century"}]},"arcgis-newspaper":{title:"Newspaper",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:Newspaper",title:"Newspaper"}]},"arcgis-hillshade-light":{title:"Hillshade",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer"}]},"arcgis-hillshade-dark":{title:"Hillshade (Dark)",baseMapLayers:[{layerType:"ArcGISTiledMapServiceLayer",showLegend:!1,title:"World Hillshade (Dark)",url:"https://ibasemaps-api.arcgis.com/arcgis/rest/services/Elevation/World_Hillshade_Dark/MapServer"}]},"arcgis-human-geography":{title:"Human Geography",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Base",title:"Human Geography Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Detail",title:"Human Geography Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeography:Label",title:"Human Geography Label",isReference:!0}]},"arcgis-human-geography-dark":{title:"Human Geography (Dark)",baseMapLayers:[{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Base",title:"Human Geography Dark Base"},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Detail",title:"Human Geography Dark Detail",isReference:!0},{layerType:"VectorTileLayer",styleUrl:"https://basemaps-api.arcgis.com/arcgis/rest/services/styles/ArcGIS:HumanGeographyDark:Label",title:"Human Geography Dark Label",isReference:!0}]}};function _hr(t){return t!=null&&typeof t=="object"&&"type"in t&&t.type==="feature"}function tD(t){const e=t==null?void 0:t.type;return e==="base-tile"||e==="tile"||e==="elevation"||e==="imagery-tile"||e==="base-elevation"||e==="open-street-map"||e==="wcs"||e==="web-tile"||e==="wmts"||e==="vector-tile"}function mP(t){return t!=null&&"type"in t&&t.type==="group"}const bhr={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function ZIe(t){const e=t==null?void 0:t.type;return e==="building-scene"||e==="integrated-mesh"||e==="point-cloud"||e==="scene"}function ive(t){return(t==null?void 0:t.type)==="voxel"}function nve(t){return(t==null?void 0:t.type)==="imagery-tile"}function JIe(t){return t!=null&&t.parent!=null&&"declaredClass"in t.parent&&t.parent.declaredClass==="esri.Basemap"&&t.parent.baseLayers.includes(t)}function Mce(t){var e;return(t==null?void 0:t.type)==="feature"&&!t.url&&((e=t.source)==null?void 0:e.type)==="memory"}function whr(t){var e;return(t==null?void 0:t.type)==="feature"&&((e=t.source)==null?void 0:e.type)==="feature-layer"}function cft(t){if(t.activeLayer){const e=t.activeLayer.tileMatrixSet;if(e)return e;const r=t.activeLayer.tileMatrixSets;if(r)return r}return null}async function KIe(t,e){const r=Hr==null?void 0:Hr.findServerInfo(t);if((r==null?void 0:r.currentVersion)!=null)return r.owningSystemUrl||null;const i=t.toLowerCase().indexOf("/rest/services");if(i===-1)return null;const n=`${t.substring(0,i)}/rest/info`,s=e!=null?e.signal:null,{data:o}=await ti(n,{query:{f:"json"},responseType:"json",signal:s});return(o==null?void 0:o.owningSystemUrl)||null}function uft(t){if(!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function dft(t){return uft(t)?"effectiveCapabilities"in t?t.effectiveCapabilities:t.capabilities:null}function hft(t){if(!("editingEnabled"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}function pft(t){return!!hft(t)&&("effectiveEditingEnabled"in t?t.effectiveEditingEnabled:t.editingEnabled)}const fft=new Set(["bing-maps","imagery","imagery-tile","map-image","open-street-map","tile","unknown","unsupported","vector-tile","web-tile","wms","wmts"]),mft=new Set(["csv","feature","geo-rss","geojson","group","imagery","imagery-tile","kml","map-image","map-notes","media","ogc-feature","route","stream","subtype-group","tile","unknown","unsupported","vector-tile","web-tile","wfs","wms","wmts"]);function gft(t){return t.layerContainerType==="basemap"?fft:t.layerContainerType==="operational-layers"?mft:null}function yft(t,e){if(e.restrictedWebMapWriting){const r=gft(e);return r==null||r.has(t.type)&&!Mce(t)}return!0}function vft(t,e){if(e)if(Mce(t)){const r=N4("featureCollection.layers",e),i=r&&r[0]&&r[0].layerDefinition;i&&sve(t,i)}else t.type!=="group"&&sve(t,e)}function sve(t,e){"maxScale"in t&&(e.maxScale=EV(t.maxScale)??void 0),"minScale"in t&&(e.minScale=EV(t.minScale)??void 0)}function _ft(t,e){if(vft(t,e),e&&("blendMode"in t&&(e.blendMode=t.blendMode,e.blendMode==="normal"&&delete e.blendMode),e.opacity=EV(t.opacity)??void 0,e.title=t.title||"Layer",e.visibility=t.visible,"legendEnabled"in t&&t.type!=="wmts"))if(Mce(t)){const r=e.featureCollection;r&&(r.showLegend=t.legendEnabled)}else e.showLegend=t.legendEnabled}function ove(t,e,r){if(!("write"in t)||!t.write)return r&&r.messages&&r.messages.push(new H("layer:unsupported",`Layers (${t.title}, ${t.id}) of type '${t.declaredClass}' cannot be persisted`,{layer:t})),null;if(yft(t,r)){const i={};return t.write(i,r)?i:null}return e!=null&&_ft(t,e=ie(e)),e}var T8;let bft=0;const QIe="esri.Basemap";let ep=T8=class extends C3(sg){constructor(t){super(t),this.id=null,this.portalItem=null,this.spatialReference=null,this.thumbnailUrl=null,this.title="Basemap",this.id=Date.now().toString(16)+"-basemap-"+bft++,this.baseLayers=new vt,this.referenceLayers=new vt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type==="elevation"&&re.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a basemap layer and will therefore be ignored.`)},r=i=>{i.parent=null};this.addHandles([this.baseLayers.on("after-add",i=>e(i.item)),this.referenceLayers.on("after-add",i=>e(i.item)),this.baseLayers.on("after-remove",i=>r(i.item)),this.referenceLayers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{re.getLogger(this).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){var r;const t=this.baseLayers.removeAll();for(const i of t)i.destroy();const e=this.referenceLayers.removeAll();for(const i of e)i.destroy();this.baseLayers.destroy(),this.referenceLayers.destroy(),(r=this.portalItem)==null||r.destroy(),this.portalItem=null}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set baseLayers(t){this._set("baseLayers",R_(t,this._get("baseLayers")))}_writeBaseLayers(t,e,r){const i=[];t&&(r={...r,layerContainerType:"basemap"},this.baseLayers.forEach(n=>{const s=ove(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);s!=null&&i.push(s)}),this.referenceLayers.forEach(n=>{const s=ove(n,r.webmap?r.webmap.getLayerJSONFromResourceInfo(n):null,r);s!=null&&(n.type!=="scene"&&(s.isReference=!0),i.push(s))})),e.baseMapLayers=i}set referenceLayers(t){this._set("referenceLayers",R_(t,this._get("referenceLayers")))}writeTitle(t,e){e.title=t||"Basemap"}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return vce(this,t=>{t(this.baseLayers,this.referenceLayers)})}clone(){const t={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.map(e=>lV(e)?e.clone():e),referenceLayers:this.referenceLayers.map(e=>lV(e)?e.clone():e)};return this.loaded&&(t.loadStatus="loaded"),new T8({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}write(t,e){return t=t||{},e&&e.origin||(e={origin:"web-map",...e}),super.write(t,e),!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(t.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(r=>{const i=ie(r);return i.url&&s0(i.url)&&(i.url=`https:${i.url}`),i.templateUrl&&s0(i.templateUrl)&&(i.templateUrl=`https:${i.templateUrl}`),i})),t}async _loadFromSource(t){const{resourceInfo:e,portalItem:r}=this;vr(t);const i=[];if(e){const n=e.context?e.context.url:null;if(i.push(this._loadLayersFromJSON(e.data,n,t)),e.data.id&&!e.data.title){const s=e.data.id;i.push(lft(s).then(o=>{o&&this.read({title:o},e.context)}))}}else r&&i.push(this._loadFromItem(r,t));await Promise.all(i)}async _loadLayersFromJSON(t,e,r){const i=this.resourceInfo&&this.resourceInfo.context,n=this.portalItem&&this.portalItem.portal||i&&i.portal||null,s=xft[(i==null?void 0:i.origin)||""]??"web-map",{populateOperationalLayers:o}=await le(()=>import("./layersCreator-5ed461fc.js"),["assets/layersCreator-5ed461fc.js","assets/lazyLayerLoader-49c90994.js","assets/portalLayers-e8c5e5dc.js","assets/layersLoader-8bc96631.js","assets/fetchService-7b5f3ba7.js","assets/jsonContext-03b7f0b9.js"]),a=[];if(vr(r),t.baseMapLayers&&Array.isArray(t.baseMapLayers)){const l={context:{origin:s,url:e,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"},c=f=>s==="web-scene"&&f.layerType==="ArcGISSceneServiceLayer"||f.isReference,u=o(this.baseLayers,t.baseMapLayers.filter(f=>!c(f)),l);a.push(u);const h=o(this.referenceLayers,t.baseMapLayers.filter(c),l);a.push(h)}await ou(a)}async _loadFromItem(t,e){const r=await t.load(e),i=await r.fetchData("json",e),n=Ts(t.itemUrl??"");return this._set("resourceInfo",{data:i.baseMap??{},context:{origin:wft[t.type||""]??"web-map",portal:t.portal||Ns.getDefault(),url:n}}),this.read(this.resourceInfo.data,this.resourceInfo.context),this.read({spatialReference:i.spatialReference},this.resourceInfo.context),this.read({title:t.title,thumbnailUrl:t.thumbnailUrl},{origin:"portal-item",portal:t.portal||Ns.getDefault(),url:n}),this._loadLayersFromJSON(this.resourceInfo.data,n,e)}static fromId(t){const e=UQ[t];if(!e)return null;if(e.deprecated){let r=null;t==="dark-gray"?r="dark-gray-vector":t==="gray"?r="gray-vector":t==="streets"?r="streets-vector":t==="topo"&&(r="topo-vector"),CV(re.getLogger(QIe),`The ${t} basemap has entered mature support and is no longer being updated.`,{replacement:r,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return T8.fromJSON(e)}};d([p({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(t,e,r,i){this._writeBaseLayers(t,e,i)}},origins:{"web-scene":{write:{ignoreOrigin:!0,target:{baseMapLayers:{type:vt}},writer(t,e,r,i){this._writeBaseLayers(t,e,i)}}}}}})],ep.prototype,"baseLayers",null),d([p({type:String,json:{origins:{"web-scene":{write:!0}}}})],ep.prototype,"id",void 0),d([p({type:Qv})],ep.prototype,"portalItem",void 0),d([p()],ep.prototype,"referenceLayers",null),d([p({readOnly:!0})],ep.prototype,"resourceInfo",void 0),d([p({type:dt})],ep.prototype,"spatialReference",void 0),d([p()],ep.prototype,"thumbnailUrl",void 0),d([p({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],ep.prototype,"title",void 0),d([tt("title")],ep.prototype,"writeTitle",null),ep=T8=d([I(QIe)],ep);const wft={"Web Scene":"web-scene","Web Map":"web-map","Link Chart":"link-chart"},xft={"web-scene":"web-scene","web-map":"web-map","link-chart":"link-chart"},TN=ep,Sft=Object.freeze(Object.defineProperty({__proto__:null,default:TN},Symbol.toStringTag,{value:"Module"})),$V={transparent:[0,0,0,0],black:[0,0,0,1],silver:[192,192,192,1],gray:[128,128,128,1],white:[255,255,255,1],maroon:[128,0,0,1],red:[255,0,0,1],purple:[128,0,128,1],fuchsia:[255,0,255,1],green:[0,128,0,1],lime:[0,255,0,1],olive:[128,128,0,1],yellow:[255,255,0,1],navy:[0,0,128,1],blue:[0,0,255,1],teal:[0,128,128,1],aqua:[0,255,255,1],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],blanchedalmond:[255,235,205,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],oldlace:[253,245,230,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],rebeccapurple:[102,51,153,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],whitesmoke:[245,245,245,1],yellowgreen:[154,205,50,1]};function eLe(t){return!!$V[t]||!!$V[t.toLowerCase()]}function $ce(t){return $V[t]??$V[t.toLowerCase()]}function Tft(t){return[...$ce(t)]}function JW(t,e,r){r<0&&++r,r>1&&--r;const i=6*r;return i<1?t+(e-t)*i:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}function tLe(t,e,r,i=1){const n=(t%360+360)%360/360,s=r<=.5?r*(e+1):r+e-r*e,o=2*r-s;return[Math.round(255*JW(o,s,n+1/3)),Math.round(255*JW(o,s,n)),Math.round(255*JW(o,s,n-1/3)),i]}function Eft(t){const e=t.length>5,r=e?8:4,i=(1<<r)-1,n=e?1:17,s=e?t.length===9:t.length===5;let o=+("0x"+t.substr(1));if(isNaN(o))return null;const a=[0,0,0,1];let l;return s&&(l=o&i,o>>=r,a[3]=n*l/255),l=o&i,o>>=r,a[2]=n*l,l=o&i,o>>=r,a[1]=n*l,l=o&i,o>>=r,a[0]=n*l,a}function A(){return[0,0,0]}function qi(t){return[t[0],t[1],t[2]]}function Ue(t,e,r){return[t,e,r]}function mc(t){const e=A(),r=Math.min(3,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function Ice(t,e){return new Float64Array(t,e,3)}function rLe(){return A()}function iLe(){return Ue(1,1,1)}function nLe(){return Ue(1,0,0)}function sLe(){return Ue(0,1,0)}function Lce(){return Ue(0,0,1)}const Sc=rLe(),qv=iLe(),oLe=nLe(),aLe=sLe(),Dce=Lce();Object.freeze(Object.defineProperty({__proto__:null,ONES:qv,UNIT_X:oLe,UNIT_Y:aLe,UNIT_Z:Dce,ZEROS:Sc,clone:qi,create:A,createView:Ice,fromArray:mc,fromValues:Ue,ones:iLe,unitX:nLe,unitY:sLe,unitZ:Lce,zeros:rLe},Symbol.toStringTag,{value:"Module"}));let Nce=1e-6;function Bl(){return Nce}function Cft(t){Nce=t}const q4=Math.random,Rft=Math.PI/180,Oft=180/Math.PI;function w7(t){return t*Rft}function Aft(t){return t*Oft}function Pft(t,e){return Math.abs(t-e)<=Nce*Math.max(1,Math.abs(t),Math.abs(e))}Object.freeze(Object.defineProperty({__proto__:null,RANDOM:q4,equals:Pft,getEpsilon:Bl,setEpsilon:Cft,toDegree:Aft,toRadian:w7},Symbol.toStringTag,{value:"Module"}));function We(t){const e=t[0],r=t[1],i=t[2];return Math.sqrt(e*e+r*r+i*i)}function oe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function se(t,e,r,i){return t[0]=e,t[1]=r,t[2]=i,t}function ge(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ve(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function x7(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function IV(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function Mft(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function lLe(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function LV(t,e){return t[0]=Math.abs(e[0]),t[1]=Math.abs(e[1]),t[2]=Math.abs(e[2]),t}function cLe(t,e){return t[0]=Math.sign(e[0]),t[1]=Math.sign(e[1]),t[2]=Math.sign(e[2]),t}function Fce(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function $ft(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function Ift(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function ce(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function id(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t}function Li(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return Math.sqrt(r*r+i*i+n*n)}function ks(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function Al(t){const e=t[0],r=t[1],i=t[2];return e*e+r*r+i*i}function Nl(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function Lft(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Se(t,e){const r=e[0],i=e[1],n=e[2];let s=r*r+i*i+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s),t}function ye(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Lt(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];return t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o,t}function mi(t,e,r,i){const n=e[0],s=e[1],o=e[2];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t}function Dft(t,e,r,i,n,s){const o=s*s,a=o*(2*s-3)+1,l=o*(s-2)+s,c=o*(s-1),u=o*(3-2*s);return t[0]=e[0]*a+r[0]*l+i[0]*c+n[0]*u,t[1]=e[1]*a+r[1]*l+i[1]*c+n[1]*u,t[2]=e[2]*a+r[2]*l+i[2]*c+n[2]*u,t}function Nft(t,e,r,i,n,s){const o=1-s,a=o*o,l=s*s,c=a*o,u=3*s*a,h=3*l*o,f=l*s;return t[0]=e[0]*c+r[0]*u+i[0]*h+n[0]*f,t[1]=e[1]*c+r[1]*u+i[1]*h+n[1]*f,t[2]=e[2]*c+r[2]*u+i[2]*h+n[2]*f,t}function Fft(t,e){e=e||1;const r=q4,i=2*r()*Math.PI,n=2*r()-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*s,t[1]=Math.sin(i)*s,t[2]=n*e,t}function lt(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12],t[1]=r[1]*i+r[5]*n+r[9]*s+r[13],t[2]=r[2]*i+r[6]*n+r[10]*s+r[14],t}function nd(t,e,r){const i=e[0],n=e[1],s=e[2];return t[0]=i*r[0]+n*r[3]+s*r[6],t[1]=i*r[1]+n*r[4]+s*r[7],t[2]=i*r[2]+n*r[5]+s*r[8],t}function md(t,e,r){const i=r[0],n=r[1],s=r[2],o=r[3],a=e[0],l=e[1],c=e[2];let u=n*c-s*l,h=s*a-i*c,f=i*l-n*a,m=n*f-s*h,g=s*u-i*f,y=i*h-n*u;const _=2*o;return u*=_,h*=_,f*=_,m*=2,g*=2,y*=2,t[0]=a+u+m,t[1]=l+h+g,t[2]=c+f+y,t}function kft(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0],s[1]=n[1]*Math.cos(i)-n[2]*Math.sin(i),s[2]=n[1]*Math.sin(i)+n[2]*Math.cos(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function Uft(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[2]*Math.sin(i)+n[0]*Math.cos(i),s[1]=n[1],s[2]=n[2]*Math.cos(i)-n[0]*Math.sin(i),t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function zft(t,e,r,i){const n=[],s=[];return n[0]=e[0]-r[0],n[1]=e[1]-r[1],n[2]=e[2]-r[2],s[0]=n[0]*Math.cos(i)-n[1]*Math.sin(i),s[1]=n[0]*Math.sin(i)+n[1]*Math.cos(i),s[2]=n[2],t[0]=s[0]+r[0],t[1]=s[1]+r[1],t[2]=s[2]+r[2],t}function uLe(t,e){oe(z5,t),oe(V5,e),Se(z5,z5),Se(V5,V5);const r=ye(z5,V5);return r>1?0:r<-1?Math.PI:Math.acos(r)}const z5=A(),V5=A();function Vft(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function gi(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Ww(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=e[0],o=e[1],a=e[2],l=Bl();return Math.abs(r-s)<=l*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-o)<=l*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(n-a)<=l*Math.max(1,Math.abs(n),Math.abs(a))}function H_(t,e,r){const i=r[0]-e[0],n=r[1]-e[1],s=r[2]-e[2];let o=i*i+n*n+s*s;return o>0?(o=1/Math.sqrt(o),t[0]=i*o,t[1]=n*o,t[2]=s*o,t):(t[0]=0,t[1]=0,t[2]=0,t)}const Gi=ve,Bft=x7,jft=IV,W4=Li,S7=ks,ju=We,gP=Al,ave=Object.freeze(Object.defineProperty({__proto__:null,abs:LV,add:ge,angle:uLe,bezier:Nft,ceil:Mft,copy:oe,cross:Lt,direction:H_,dist:W4,distance:Li,div:jft,divide:IV,dot:ye,equals:Ww,exactEquals:gi,floor:lLe,hermite:Dft,inverse:Lft,len:ju,length:We,lerp:mi,max:$ft,min:Fce,mul:Bft,multiply:x7,negate:Nl,normalize:Se,random:Fft,rotateX:kft,rotateY:Uft,rotateZ:zft,round:Ift,scale:ce,scaleAndAdd:id,set:se,sign:cLe,sqrDist:S7,sqrLen:gP,squaredDistance:ks,squaredLength:Al,str:Vft,sub:Gi,subtract:ve,transformMat3:nd,transformMat4:lt,transformQuat:md},Symbol.toStringTag,{value:"Module"}));function Up(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ki(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function kce(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function dLe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function hLe(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function pLe(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function Gft(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Hft(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function qft(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function Wft(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function Xft(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function eE(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function Yft(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}function fLe(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return Math.sqrt(r*r+i*i+n*n+s*s)}function DV(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2],s=e[3]-t[3];return r*r+i*i+n*n+s*s}function Uce(t){const e=t[0],r=t[1],i=t[2],n=t[3];return Math.sqrt(e*e+r*r+i*i+n*n)}function zce(t){const e=t[0],r=t[1],i=t[2],n=t[3];return e*e+r*r+i*i+n*n}function Zft(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Jft(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function mLe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*r+i*i+n*n+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=r*o,t[1]=i*o,t[2]=n*o,t[3]=s*o),t}function gLe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function T7(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t[2]=o+i*(r[2]-o),t[3]=a+i*(r[3]-a),t}function Kft(t,e){const r=q4;let i,n,s,o,a,l;e=e||1;do i=2*r()-1,n=2*r()-1,a=i*i+n*n;while(a>=1);do s=2*r()-1,o=2*r()-1,l=s*s+o*o;while(l>=1);const c=Math.sqrt((1-a)/l);return t[0]=e*i,t[1]=e*n,t[2]=e*s*c,t[3]=e*o*c,t}function hh(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3];return t[0]=r[0]*i+r[4]*n+r[8]*s+r[12]*o,t[1]=r[1]*i+r[5]*n+r[9]*s+r[13]*o,t[2]=r[2]*i+r[6]*n+r[10]*s+r[14]*o,t[3]=r[3]*i+r[7]*n+r[11]*s+r[15]*o,t}function Qft(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2],c=r[3],u=c*i+a*s-l*n,h=c*n+l*i-o*s,f=c*s+o*n-a*i,m=-o*i-a*n-l*s;return t[0]=u*c+m*-o+h*-l-f*-a,t[1]=h*c+m*-a+f*-o-u*-l,t[2]=f*c+m*-l+u*-a-h*-o,t[3]=e[3],t}function emt(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function xA(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function NV(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Bl();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}const tmt=dLe,rmt=hLe,imt=pLe,nmt=fLe,smt=DV,omt=Uce,amt=zce,yLe=Object.freeze(Object.defineProperty({__proto__:null,add:kce,ceil:Gft,copy:Up,dist:nmt,distance:fLe,div:imt,divide:pLe,dot:gLe,equals:NV,exactEquals:xA,floor:Hft,inverse:Jft,len:omt,length:Uce,lerp:T7,max:Wft,min:qft,mul:rmt,multiply:hLe,negate:Zft,normalize:mLe,random:Kft,round:Xft,scale:eE,scaleAndAdd:Yft,set:Ki,sqrDist:smt,sqrLen:amt,squaredDistance:DV,squaredLength:zce,str:emt,sub:tmt,subtract:dLe,transformMat4:hh,transformQuat:Qft},Symbol.toStringTag,{value:"Module"})),lve=new Float32Array(1);function lmt(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}function Te(t,e,r){return Math.min(Math.max(t,e),r)}function tE(t){return(t&t-1)==0}function xhr(t){return t--,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function Shr(t){return 10**Math.ceil(Math.LOG10E*Math.log(t))}function Xt(t,e,r){return t+(e-t)*r}function sr(t){return t*Math.PI/180}function Oc(t){return 180*t/Math.PI}function zQ(t,e=1e-6){return(t<0?-1:1)/Math.max(Math.abs(t),e)}function Vo(t){return Math.acos(Te(t,-1,1))}function sf(t){return Math.asin(Te(t,-1,1))}function e_(t,e,r=1e-6){return t===e?!0:!Number.isFinite(t)||!Number.isFinite(e)?!1:(t>e?t-e:e-t)<=r}const FV=new DataView(new ArrayBuffer(Float64Array.BYTES_PER_ELEMENT));function VQ(t){return FV.setFloat64(0,t),FV.getBigInt64(0)}function cmt(t){return FV.setBigInt64(0,t),FV.getFloat64(0)}const E8=BigInt("1000000"),umt=vLe(1);function vLe(t){const e=VQ(t=Math.abs(t)),r=cmt(e<=E8?E8:e-E8);return Math.abs(t-r)}function Thr(t,e,r=umt){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;if(r!=null&&vLe(Math.min(Math.abs(t),Math.abs(e)))<r)return Math.abs(t-e)<=r;const i=VQ(t),n=VQ(e);return i<0!=n<0?!1:!((i<n?n-i:i-n)>E8)}function dmt(t,e,r=1e-6){if(t===e)return!0;if(!Number.isFinite(t)||!Number.isFinite(e))return!1;const i=Math.abs(t-e),n=Math.abs(t),s=Math.abs(e);if(t===0||e===0||n<1e-12&&s<1e-12){if(i>.01*r)return!1}else if(i/(n+s)>r)return!1;return!0}function hmt(t){return _Le(Math.max(-BQ,Math.min(t,BQ)))}function _Le(t){return lve[0]=t,lve[0]}function EN(t,e,r){const i=Te((r-t)/(e-t),0,1);return i*i*(3-2*i)}function cve(t,e){const r=We(t),i=sf(t[2]/r),n=Math.atan2(t[1]/r,t[0]/r);return se(e,r,i,n),e}function Ehr(t,e,r){return Ki(t,e[0],e[1],e[2],e[3]*r)}function Chr(t){const e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[3]*t[3]+t[4]*t[4]+t[5]*t[5],i=t[6]*t[6]+t[7]*t[7]+t[8]*t[8];return!(e_(e,1)&&e_(r,1)&&e_(i,1))}const BQ=_Le(34028234663852886e22);function B5(t){return Te(cce(t),0,255)}function j5(t,e,r){return t=Number(t),isNaN(t)?r:t<e?e:t>r?r:t}let C8=class yl{static blendColors(e,r,i,n=new yl){return n.r=Math.round(e.r+(r.r-e.r)*i),n.g=Math.round(e.g+(r.g-e.g)*i),n.b=Math.round(e.b+(r.b-e.b)*i),n.a=e.a+(r.a-e.a)*i,n._sanitize()}static fromRgb(e,r){const i=e.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(i){const n=i[2].split(/\s*,\s*/),s=i[1];if(s==="rgb"&&n.length===3||s==="rgba"&&n.length===4){const o=n[0];if(o.charAt(o.length-1)==="%"){const a=n.map(l=>2.56*parseFloat(l));return n.length===4&&(a[3]=parseFloat(n[3])),yl.fromArray(a,r)}return yl.fromArray(n.map(a=>parseFloat(a)),r)}if(s==="hsl"&&n.length===3||s==="hsla"&&n.length===4)return yl.fromArray(tLe(parseFloat(n[0]),parseFloat(n[1])/100,parseFloat(n[2])/100,parseFloat(n[3])),r)}return null}static fromHex(e,r=new yl){if(e.length!==4&&e.length!==7||e[0]!=="#")return null;const i=e.length===4?4:8,n=(1<<i)-1;let s=+("0x"+e.substr(1));return isNaN(s)?null:(["b","g","r"].forEach(o=>{const a=s&n;s>>=i,r[o]=i===4?17*a:a}),r.a=1,r)}static fromArray(e,r=new yl){return r._set(Number(e[0]),Number(e[1]),Number(e[2]),Number(e[3])),isNaN(r.a)&&(r.a=1),r._sanitize()}static fromString(e,r){const i=eLe(e)?$ce(e):null;return i&&yl.fromArray(i,r)||yl.fromRgb(e,r)||yl.fromHex(e,r)}static fromJSON(e){return e&&new yl([e[0],e[1],e[2],e[3]/255])}static toUnitRGB(e){return e!=null?[e.r/255,e.g/255,e.b/255]:null}static toUnitRGBA(e){return e!=null?[e.r/255,e.g/255,e.b/255,e.a!=null?e.a:1]:null}constructor(e){this.r=255,this.g=255,this.b=255,this.a=1,e&&this.setColor(e)}get isBright(){return .299*this.r+.587*this.g+.114*this.b>=127}setColor(e){return typeof e=="string"?yl.fromString(e,this):Array.isArray(e)?yl.fromArray(e,this):(this._set(e.r??0,e.g??0,e.b??0,e.a??1),e instanceof yl||this._sanitize()),this}toRgb(){return[this.r,this.g,this.b]}toRgba(){return[this.r,this.g,this.b,this.a]}toHex(){const e=this.r.toString(16),r=this.g.toString(16),i=this.b.toString(16);return`#${e.length<2?"0"+e:e}${r.length<2?"0"+r:r}${i.length<2?"0"+i:i}`}toCss(e=!1){const r=this.r+", "+this.g+", "+this.b;return e?`rgba(${r}, ${this.a})`:`rgb(${r})`}toString(){return this.toCss(!0)}toJSON(){return this.toArray()}toArray(e=yl.AlphaMode.ALWAYS){const r=B5(this.r),i=B5(this.g),n=B5(this.b);return e===yl.AlphaMode.ALWAYS||this.a!==1?[r,i,n,B5(255*this.a)]:[r,i,n]}clone(){return new yl(this.toRgba())}hash(){return this.r<<24|this.g<<16|this.b<<8|255*this.a}equals(e){return e!=null&&e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a}_sanitize(){return this.r=Math.round(j5(this.r,0,255)),this.g=Math.round(j5(this.g,0,255)),this.b=Math.round(j5(this.b,0,255)),this.a=j5(this.a,0,1),this}_set(e,r,i,n){this.r=e,this.g=r,this.b=i,this.a=n}};C8.prototype.declaredClass="esri.Color",function(t){var e;(e=t.AlphaMode||(t.AlphaMode={}))[e.ALWAYS=0]="ALWAYS",e[e.UNLESS_OPAQUE=1]="UNLESS_OPAQUE"}(C8||(C8={}));const ht=C8;function Rhr(t){}function pmt(t){return()=>t}function Rt(t,e={}){const r=t instanceof ri?t:new ri(t,e),i={type:(e==null?void 0:e.ignoreUnknown)??1?r.apiValues:String,json:{type:r.jsonValues,read:!(e!=null&&e.readOnly)&&{reader:r.read},write:{writer:r.write}}};return(e==null?void 0:e.readOnly)!==void 0&&(i.readOnly=!!e.readOnly),(e==null?void 0:e.default)!==void 0&&(i.json.default=e.default),(e==null?void 0:e.name)!==void 0&&(i.json.name=e.name),(e==null?void 0:e.nonNullable)!==void 0&&(i.nonNullable=e.nonNullable),p(i)}var jQ;let R8=jQ=class extends me{constructor(t){super(t),this.type="none"}clone(){return new jQ({type:this.type})}};d([Rt({none:"none",stayAbove:"stay-above"})],R8.prototype,"type",void 0),R8=jQ=d([I("esri.ground.NavigationConstraint")],R8);function X4(t){const e=cce(100*(1-t));return Math.max(0,Math.min(e,100))}function rE(t){const e=1-t/100;return Math.max(0,Math.min(e,1))}var GQ;let iv=GQ=class extends C3(sg){constructor(t){super(t),this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new vt;const e=i=>{i.parent&&i.parent!==this&&"remove"in i.parent&&i.parent.remove(i),i.parent=this,i.type!=="elevation"&&i.type!=="base-elevation"&&re.getLogger(this).error(`Layer '${i.title}, id:${i.id}' of type '${i.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=i=>{i.parent=null};this.addHandles([this.layers.on("after-add",i=>e(i.item)),this.layers.on("after-remove",i=>r(i.item))])}initialize(){this.when().catch(t=>{Yn(t)||re.getLogger(this).error("#load()","Failed to load ground",t)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const t=this.layers.removeAll();for(const e of t)e.destroy();this.layers.destroy()}normalizeCtorArgs(t){return t&&"resourceInfo"in t&&(this._set("resourceInfo",t.resourceInfo),delete(t={...t}).resourceInfo),t}set layers(t){this._set("layers",R_(t,this._get("layers")))}writeLayers(t,e,r,i){const n=[];t&&(i={...i,layerContainerType:"ground"},t.forEach(s=>{if("write"in s){const o={};pmt(s)().write(o,i)&&n.push(o)}else i&&i.messages&&i.messages.push(new H("layer:unsupported",`Layers (${s.title}, ${s.id}) of type '${s.declaredClass}' cannot be persisted in the ground`,{layer:s}))})),e.layers=n}load(t){return this.addResolvingPromise(this._loadFromSource(t)),Promise.resolve(this)}loadAll(){return vce(this,t=>{t(this.layers)})}async queryElevation(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await le(()=>import("./ElevationQuery-ee4f075c.js"),[]);vr(e);const i=new r,n=this.layers.filter(uve).toArray();return i.queryAll(n,t,e)}async createElevationSampler(t,e){await this.load({signal:e==null?void 0:e.signal});const{ElevationQuery:r}=await le(()=>import("./ElevationQuery-ee4f075c.js"),[]);vr(e);const i=new r,n=this.layers.filter(uve).toArray();return i.createSamplerAll(n,t,e)}clone(){const t={opacity:this.opacity,surfaceColor:ie(this.surfaceColor),navigationConstraint:ie(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(t.loadStatus="loaded"),new GQ({resourceInfo:this.resourceInfo}).set(t)}read(t,e){this.resourceInfo||this._set("resourceInfo",{data:t,context:e}),super.read(t,e)}_loadFromSource(t){const e=this.resourceInfo;return e?this._loadLayersFromJSON(e.data,e.context,t):Promise.resolve()}_loadLayersFromJSON(t,e,r){const i=e&&e.origin||"web-scene",n=e&&e.portal||null,s=e&&e.url||null;return le(()=>import("./layersCreator-5ed461fc.js"),["assets/layersCreator-5ed461fc.js","assets/lazyLayerLoader-49c90994.js","assets/portalLayers-e8c5e5dc.js","assets/layersLoader-8bc96631.js","assets/fetchService-7b5f3ba7.js","assets/jsonContext-03b7f0b9.js"]).then(({populateOperationalLayers:o})=>{vr(r);const a=[];if(t.layers&&Array.isArray(t.layers)){const l={context:{origin:i,url:s,portal:n,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};a.push(o(this.layers,t.layers,l))}return ou(a)}).then(()=>{})}};function fmt(t){return t&&"createElevationSampler"in t}function uve(t){return t.type==="elevation"||fmt(t)}d([p({json:{read:!1}})],iv.prototype,"layers",null),d([tt("layers")],iv.prototype,"writeLayers",null),d([p({readOnly:!0})],iv.prototype,"resourceInfo",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:hn,read:{reader:rE,source:"transparency"},write:{writer:(t,e)=>{e.transparency=X4(t)},target:"transparency"}}})],iv.prototype,"opacity",void 0),d([p({type:ht,json:{type:[hn],write:(t,e)=>{e.surfaceColor=t.toJSON().slice(0,3)}}})],iv.prototype,"surfaceColor",void 0),d([p({type:R8,json:{write:!0}})],iv.prototype,"navigationConstraint",void 0),iv=GQ=d([I("esri.Ground")],iv);const CN=iv;let wR=class extends vt{constructor(e){super(e),this.getCollections=null}initialize(){this.own(q$e(()=>this._refresh()))}destroy(){this.getCollections=null}_refresh(){const e=this.getCollections!=null?this.getCollections():null;if(e==null)return void this.removeAll();let r=0;for(const i of e)i!=null&&(r=this._processCollection(r,i));this.splice(r,this.length)}_createNewInstance(e){return new vt(e)}_processCollection(e,r){if(!r)return e;const i=this.itemFilterFunction??(n=>!!n);for(const n of r)if(n){if(i(n)){const s=this.indexOf(n,e);s>=0?s!==e&&this.reorder(n,e):this.add(n,e),++e}if(this.getChildrenFunction){const s=this.getChildrenFunction(n);if(Array.isArray(s))for(const o of s)e=this._processCollection(e,o);else e=this._processCollection(e,s)}}return e}};d([p()],wR.prototype,"getCollections",void 0),d([p()],wR.prototype,"getChildrenFunction",void 0),d([p()],wR.prototype,"itemFilterFunction",void 0),wR=d([I("esri.core.CollectionFlattener")],wR);const RN=wR,mmt=[["binary","application/octet-stream","bin",""]];function gmt(t,e){return Bce(_mt(t,e))}function ymt(t,e){return Bce(bmt(t,e))}function Ahr(t,e){return bLe(vmt(t,e))}function Vce(t){return[...mmt,...t]}function vmt(t,e){return Vce(e).find(r=>Bce(r)===t)}function _mt(t,e){return Vce(e).find(r=>bLe(r)===t)}function bmt(t,e){const r=t.toLowerCase();return Vce(e).find(i=>wmt(i).some(n=>r.endsWith(n)))}function Bce(t){return t==null?void 0:t[0]}function bLe(t){return t==null?void 0:t[1]}function wmt(t){return(t==null?void 0:t[2].split(","))??[]}function Phr(t){var e;return(e=t.tables)==null?void 0:e.find(r=>r.role==="assetMaps")}function xmt(t){var e,r;return!(!(t&&typeof t=="object"&&"loaded"in t&&t.loaded&&((r=(e=dft(t))==null?void 0:e.operations)!=null&&r.supportsEditing)&&"type"in t)||"editingEnabled"in t&&!pft(t)||t.type==="scene"&&!Smt(t))}function Smt(t){const e=t.infoFor3D;if(!e)return!0;const{supportedFormats:r,queryFormats:i}=e,n=gmt("model/gltf-binary",r)??ymt("glb",r);return n!=null&&i.includes(n)}const dve=re.getLogger("esri.support.basemapUtils");function Tmt(){return{}}function Emt(t){for(const e in t){const r=t[e];(r==null?void 0:r.destroyed)===!1&&r.destroy(),delete t[e]}}function jce(t,e){let r;if(typeof t=="string"){if(!(t in UQ)){const i=Object.entries(UQ).filter(([n,s])=>Ti.apiKey&&!s.classic||!Ti.apiKey&&s.classic&&!s.deprecated).map(([n])=>`"${n}"`).join(", ");return dve.warn(`Unable to find basemap definition for: ${t}. Try one of these: ${i}`),null}e&&(r=e[t]),r||(r=TN.fromId(t),e&&(e[t]=r))}else r=ls(TN,t);return r!=null&&r.destroyed&&(dve.warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}function Mhr(t,e){var r,i,n,s;return((i=(r=t.basemap)==null?void 0:r.referenceLayers)==null?void 0:i.some(o=>o.uid===e))||((s=(n=t.basemap)==null?void 0:n.baseLayers)==null?void 0:s.some(o=>o.uid===e))}function Cmt(t,e=null){const r=jce(t);if(!r)return null;const i=r.clone();return e&&(i.baseLayers=hve(i.baseLayers,e.baseLayers),i.referenceLayers=hve(i.referenceLayers,e.referenceLayers)),i}function hve(t,e){const r=new vt;return t.forEach(i=>{const n=e.find(s=>Rmt(pve(i),pve(s)))||i;r.includes(n)?r.push(i):r.push(n)}),r}function pve(t){var e,r;return{type:t.type,url:Omt("urlTemplate"in t&&t.urlTemplate||t.url||"styleUrl"in t&&t.styleUrl||""),minScale:"minScale"in t&&t.minScale!=null?t.minScale:0,maxScale:"maxScale"in t&&t.maxScale!=null?t.maxScale:0,opacity:t.opacity!=null?t.opacity:1,visible:t.visible==null||!!t.visible,sublayers:t.type!=="map-image"&&t.type!=="wms"||t.sublayers==null||(e=t.sublayers)==null?void 0:e.map(i=>({id:i.id,visible:i.visible})),activeLayerId:t.type==="wmts"?(r=t.activeLayer)==null?void 0:r.id:void 0}}function Rmt(t,e){if(t.type!==e.type||t.type==="scene"||t.url!==e.url||t.minScale!==e.minScale||t.maxScale!==e.maxScale||t.visible!==e.visible||t.opacity!==e.opacity)return!1;if(t.activeLayerId!=null||e.activeLayerId!=null)return t.activeLayerId===e.activeLayerId;if(t.sublayers!=null||e.sublayers!=null){if(t.sublayers==null||e.sublayers==null||t.sublayers.length!==e.sublayers.length)return!1;for(let r=0;r<t.sublayers.length;r++){const i=t.sublayers.at(r),n=e.sublayers.at(r);if((i==null?void 0:i.id)!==(n==null?void 0:n.id)||(i==null?void 0:i.visible)!==(n==null?void 0:n.visible))return!1}}return!0}function Omt(t){return t?qp(t).replace(/^\s*https?:/i,"").toLowerCase():""}function Amt(t){return new RN({getCollections:()=>[t.tables,t.layers],getChildrenFunction:e=>{const r=[];return"tables"in e&&r.push(e.tables),"layers"in e&&r.push(e.layers),r},itemFilterFunction:e=>{const r=e.parent;return!!r&&"tables"in r&&r.tables.includes(e)}})}function KW(t){for(const e of t.values())e==null||e.destroy();t.clear()}const fve={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function Pmt(t){let e=null;if(typeof t=="string")if(t in fve){const r=fve[t];e=new CN({resourceInfo:{data:{layers:[r]}}})}else re.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${t}. Try "world-elevation"`);else e=ls(CN,t);return e}function yP(t,e,r=!1){let{hasM:i,hasZ:n}=t;Array.isArray(e)?e.length!==4||i||n?e.length===3&&r&&!i?(n=!0,i=!1):e.length===3&&i&&n&&(i=!1,n=!1):(i=!0,n=!0):(n=!n&&e.hasZ&&(!i||e.hasM),i=!i&&e.hasM&&(!n||e.hasZ)),t.hasZ=n,t.hasM=i}var HQ;function mve(t){return(e,r)=>e==null?r:r==null?e:t(e,r)}function Mmt(t){return t&&(t.declaredClass==="esri.geometry.SpatialReference"||t.wkid!=null)}let eb=HQ=class extends Sx{constructor(...t){super(...t),this.points=[],this.type="multipoint"}normalizeCtorArgs(t,e){if(!t&&!e)return{};const r={};Array.isArray(t)?(r.points=t,r.spatialReference=e):Mmt(t)?r.spatialReference=t:(t.points&&(r.points=t.points),t.spatialReference&&(r.spatialReference=t.spatialReference),t.hasZ&&(r.hasZ=t.hasZ),t.hasM&&(r.hasM=t.hasM));const i=r.points&&r.points[0];return i&&(r.hasZ===void 0&&r.hasM===void 0?(r.hasZ=i.length>2,r.hasM=!1):r.hasZ===void 0?r.hasZ=i.length>3:r.hasM===void 0&&(r.hasM=i.length>3)),r}get cache(){return this.commitProperty("points"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const t=this.points;if(!t.length)return null;const e=new $r,r=this.hasZ,i=this.hasM,n=r?3:2,s=t[0],o=mve(Math.min),a=mve(Math.max);let l,c,u,h,[f,m]=s,[g,y]=s;for(let _=0,b=t.length;_<b;_++){const w=t[_],[x,S]=w;if(f=o(f,x),m=o(m,S),g=a(g,x),y=a(y,S),r&&w.length>2){const C=w[2];l=o(l,C),u=a(u,C)}if(i&&w.length>n){const C=w[n];c=o(c,C),h=a(h,C)}}return e.xmin=f,e.ymin=m,e.xmax=g,e.ymax=y,e.spatialReference=this.spatialReference,r?(e.zmin=l,e.zmax=u):(e.zmin=void 0,e.zmax=void 0),i?(e.mmin=c,e.mmax=h):(e.mmin=void 0,e.mmax=void 0),e}writePoints(t,e){e.points=ie(this.points)}addPoint(t){return yP(this,t),Array.isArray(t)?this.points.push(t):this.points.push(t.toArray()),this.notifyChange("points"),this}clone(){const t={points:ie(this.points),spatialReference:this.spatialReference};return this.hasZ&&(t.hasZ=!0),this.hasM&&(t.hasM=!0),new HQ(t)}getPoint(t){if(!this._validateInputs(t))return null;const e=this.points[t],r={x:e[0],y:e[1],spatialReference:this.spatialReference};let i=2;return this.hasZ&&(r.z=e[2],i=3),this.hasM&&(r.m=e[i]),new Gt(r)}removePoint(t){if(!this._validateInputs(t))return null;const e=new Gt(this.points.splice(t,1)[0],this.spatialReference);return this.notifyChange("points"),e}setPoint(t,e){return this._validateInputs(t)?(yP(this,e),Array.isArray(e)||(e=e.toArray()),this.points[t]=e,this.notifyChange("points"),this):this}toJSON(t){return this.write({},t)}_validateInputs(t){return t!=null&&t>=0&&t<this.points.length}};d([p({readOnly:!0})],eb.prototype,"cache",null),d([p()],eb.prototype,"extent",null),d([p({type:[[Number]],json:{write:{isRequired:!0}}})],eb.prototype,"points",void 0),d([tt("points")],eb.prototype,"writePoints",null),eb=HQ=d([I("esri.geometry.Multipoint")],eb),eb.prototype.toJSON.isDefaultToJSON=!0;const Y4=eb;function $hr(t){const e=[];for(t.reset();t.nextPath();){const r=[];for(;t.nextPoint();)r.push([t.x,t.y]);e.push(r)}return t.reset(),e}function $mt(t){const e=[];for(;t.nextPoint();)e.push([t.x,t.y]);return t.seekPathStart(),e}function gve(t){if(!t)return null;if(Array.isArray(t))return t;const e=t.hasZ,r=t.hasM;if(t.type==="point")return r&&e?[t.x,t.y,t.z,t.m]:e?[t.x,t.y,t.z]:r?[t.x,t.y,t.m]:[t.x,t.y];if(t.type==="polygon")return t.rings.slice(0);if(t.type==="polyline")return t.paths.slice(0);if(t.type==="multipoint")return t.points.slice(0);if(t.type==="extent"){const i=t.clone().normalize();if(!i)return null;let n=!1,s=!1;return i.forEach(o=>{o.hasZ&&(n=!0),o.hasM&&(s=!0)}),i.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(n&&o.hasZ){const l=.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(s&&o.hasM){const l=.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a})}return null}function E7(t,e){const r=e[0]-t[0],i=e[1]-t[1];if(t.length>2&&e.length>2){const n=t[2]-e[2];return Math.sqrt(r*r+i*i+n*n)}return Math.sqrt(r*r+i*i)}function wLe(t,e,r){const i=t[0]+r*(e[0]-t[0]),n=t[1]+r*(e[1]-t[1]);return t.length>2&&e.length>2?[i,n,t[2]+r*(e[2]-t[2])]:[i,n]}function Ihr(t,e,r,i){const[n,s]=e,[o,a]=r[i],[l,c]=r[i+1],u=l-o,h=c-a,f=u*u+h*h,m=(n-o)*u+(s-a)*h,g=Math.min(1,Math.max(0,m/f));return t[0]=o+u*g,t[1]=a+h*g,t}function Lhr(t,e,r){let i,n,s,o,a=!1,l=1/0;for(r.reset();r.nextPath();)if(r.nextPoint())for(i=r.x,n=r.y;r.nextPoint();)s=r.x,o=r.y,n>e!=o>e&&t<(s-i)*(e-n)/(o-n)+i&&(a=!a),l=Math.min(l,Imt(t,e,i,n,s,o)),i=s,n=o;return l===0?0:(a?1:-1)*Math.sqrt(l)}function Imt(t,e,r,i,n,s){let o=r,a=i,l=n-o,c=s-a;if(l!==0||c!==0){const u=((t-o)*l+(e-a)*c)/(l*l+c*c);u>1?(o=n,a=s):u>0&&(o+=l*u,a+=c*u)}return l=t-o,c=e-a,l*l+c*c}function xLe(t,e){return wLe(t,e,.5)}function SLe(t){const e=t.length;let r=0;for(let i=0;i<e-1;++i)r+=E7(t[i],t[i+1]);return r}function TLe(t,e){if(e<=0)return t[0];const r=t.length;let i=0;for(let n=0;n<r-1;++n){const s=E7(t[n],t[n+1]);if(e-i<s){const o=(e-i)/s;return wLe(t[n],t[n+1],o)}i+=s}return t[r-1]}function Gce(t,e,r){const i=t.length;let n=0,s=0,o=0;for(let a=0;a<i;a++){const l=t[a],c=t[(a+1)%i];let u=2;n+=l[0]*c[1]-c[0]*l[1],l.length>2&&c.length>2&&r&&(s+=l[0]*c[2]-c[0]*l[2],u=3),l.length>u&&c.length>u&&e&&(o+=l[0]*c[u]-c[0]*l[u])}return n<=0&&s<=0&&o<=0}function Lmt(t){const e=t.length;return e>2&&T_(t[0],t[e-1])}function Dhr(t){if("rings"in t&&(Dmt(t),t.rings.length>0&&!Gce(t.rings[0],t.hasM??!1,t.hasZ??!1)))for(const e of t.rings)e.reverse()}function Dmt(t){if("rings"in t)for(const e of t.rings)Lmt(e)||e.push(e[0].slice())}function Nhr(t){return t.type!=="polygon"&&t.type!=="polyline"||Nmt(t.type==="polygon"?t.rings:t.paths,t.spatialReference),t}function Nmt(t,e){const r=Dw(e);if(!r)return;const i=r.valid[0],n=r.valid[1],s=n-i;for(const o of t){let a=1/0,l=-1/0;for(const u of o){const h=Fmt(u[0],i,n);a=Math.min(a,h),l=Math.max(l,h),u[0]=h}const c=l-a;s-c<c&&o.forEach(u=>{u[0]<0&&(u[0]+=s)})}}function Fmt(t,e,r){const i=r-e;return t<e?r-(e-t)%i:t>r?e+(t-e)%i:t}function Fhr(t){if(!t||t.length<3)return 0;let e=0;const r=t.length-1;for(let i=0;i<r;i++)e+=(t[i][0]-t[i+1][0])*(t[i][1]+t[i+1][1]);return e+=(t[r][0]-t[0][0])*(t[r][1]+t[0][1]),-.5*e}function ELe(t){if(!t||t.numPoints<3)return 0;let e,r,i=0;if(t.seekPathStart(),!t.nextPoint())return 0;e=t.x,r=t.y;const n=e,s=r;for(;t.nextPoint();)i+=(e-t.x)*(r+t.y),e=t.x,r=t.y;return i+=(e-n)*(r+s),-.5*i}function khr(t,e){if(t===e)return!0;if(t.type!==e.type)return!1;if(t.type==="point"||t.type==="mesh"||t.type==="extent")return!0;if(t.type==="multipoint")return t.points.length===e.points.length;const[r,i]=t.type==="polyline"?[t.paths,e.paths]:[t.rings,e.rings];return r.length===i.length&&r.every((n,s)=>n.length===i[s].length)}function Uhr(t){return t?t.hasZ?[t.xmax-t.xmin/2,t.ymax-t.ymin/2,t.zmax-t.zmin/2]:[t.xmax-t.xmin/2,t.ymax-t.ymin/2]:null}function kmt(t){return t?CLe(t.rings,t.hasZ??!1):null}function CLe(t,e){if(!t||!t.length)return null;const r=[],i=[],n=e?[1/0,-1/0,1/0,-1/0,1/0,-1/0]:[1/0,-1/0,1/0,-1/0];for(let s=0,o=t.length;s<o;s++){const a=RLe(t[s],e,n);a&&i.push(a)}if(i.sort((s,o)=>{let a=s[2]-o[2];return a===0&&e&&(a=s[4]-o[4]),a}),i.length&&(r[0]=i[0][0],r[1]=i[0][1],e&&(r[2]=i[0][3]),(r[0]<n[0]||r[0]>n[1]||r[1]<n[2]||r[1]>n[3]||e&&(r[2]<n[4]||r[2]>n[5]))&&(r.length=0)),!r.length){const s=t[0]&&t[0].length?Umt(t[0],e):null;if(!s)return null;r[0]=s[0],r[1]=s[1],e&&s.length>2&&(r[2]=s[2])}return r}function RLe(t,e,r){let i=0,n=0,s=0,o=0,a=0;const l=t.length?t[0][0]:0,c=t.length?t[0][1]:0,u=t.length&&e?t[0][2]:0;for(let f=0;f<t.length;f++){const m=t[f],g=t[(f+1)%t.length],[y,_,b]=m,w=y-l,x=_-c,[S,C,E]=g,R=S-l,P=C-c,D=w*P-R*x;if(o+=D,i+=(w+R)*D,n+=(x+P)*D,e&&m.length>2&&g.length>2){const L=b-u,k=E-u,V=w*k-R*L;s+=(L+k)*V,a+=V}y<r[0]&&(r[0]=y),y>r[1]&&(r[1]=y),_<r[2]&&(r[2]=_),_>r[3]&&(r[3]=_),e&&(b<r[4]&&(r[4]=b),b>r[5]&&(r[5]=b))}if(o>0&&(o*=-1),a>0&&(a*=-1),!o)return null;o*=.5,a*=.5;const h=[i/(6*o)+l,n/(6*o)+c,o];return e&&(r[4]===r[5]||a===0?(h[3]=(r[4]+r[5])/2,h[4]=0):(h[3]=s/(6*a)+u,h[4]=a)),h}function Umt(t,e){const r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;for(let l=0,c=t.length;l<c-1;l++){const u=t[l],h=t[l+1];if(u&&h){r[0]=u[0],r[1]=u[1],i[0]=h[0],i[1]=h[1],e&&u.length>2&&h.length>2&&(r[2]=u[2],i[2]=h[2]);const f=E7(r,i);if(f){n+=f;const m=xLe(u,h);s+=f*m[0],o+=f*m[1],e&&m.length>2&&(a+=f*m[2])}}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.length?t[0]:null}function zmt(t){const{hasZ:e,numPaths:r}=t;if(r===0)return null;const i=[],n=[],s=e?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(t.reset();t.nextPath();){const o=RLe($mt(t),t.hasZ,s);o&&n.push(o)}if(n.sort((o,a)=>{let l=o[2]-a[2];return l===0&&e&&(l=o[4]-a[4]),l}),n.length&&(i[0]=n[0][0],i[1]=n[0][1],e&&(i[2]=n[0][3]),(i[0]<s[0]||i[0]>s[1]||i[1]<s[2]||i[1]>s[3]||e&&(i[2]<s[4]||i[2]>s[5]))&&(i.length=0)),!i.length){t.reset(),t.nextPath();const o=t.numPoints?Vmt(t):null;if(!o)return null;i[0]=o[0],i[1]=o[1],e&&o.length>2&&(i[2]=o[2])}return i}function Vmt(t){const{hasZ:e}=t,r=e?[0,0,0]:[0,0],i=e?[0,0,0]:[0,0];let n=0,s=0,o=0,a=0;if(t.nextPoint()){let l=t.x,c=t.y,u=t.z;for(;t.nextPoint();){const h=t.x,f=t.y,m=t.z;r[0]=l,r[1]=c,i[0]=h,i[1]=f,e&&(r[2]=u,i[2]=m);const g=E7(r,i);if(g){n+=g;const y=xLe(r,i);s+=g*y[0],o+=g*y[1],e&&y.length>2&&(a+=g*y[2])}l=h,c=f,u=m}}return n>0?e?[s/n,o/n,a/n]:[s/n,o/n]:t.numPoints?(t.seekPathStart(),t.nextPoint(),[t.x,t.y]):null}const Bmt=1e-6;function zhr(t){let e=0;for(t.reset();t.nextPath();)e+=ELe(t);if(e<Bmt){const n=zmt(t);return n?[n[0],n[1]]:null}const r=[0,0];if(t.reset(),!t.nextPath()||!t.nextPoint())return null;const i=[t.x,t.y];for(t.reset();t.nextPath();)Gmt(r,i,t);return r[0]*=1/e,r[1]*=1/e,r[0]+=i[0],r[1]+=i[1],r}const jmt=1/3;function Gmt(t,e,r){if(!t||!r||r.numPoints<3)return null;r.nextPoint();const i=r.x,n=r.y;r.nextPoint();let s,o=r.x-i,a=r.y-n,l=0,c=0;for(;r.nextPoint();)l=r.x-i,c=r.y-n,s=.5*jmt*(l*a-c*o),t[0]+=s*(o+l),t[1]+=s*(a+c),o=l,a=c;const u=ELe(r),h=[i,n];return h[0]-=e[0],h[1]-=e[1],h[0]*=u,h[1]*=u,t[0]+=h[0],t[1]+=h[1],t}function lr(t=Xmt){return[t[0],t[1],t[2],t[3]]}function Vhr(t){return[t[0],t[1],t[2],t[3]]}function A_(t,e){return t!==e&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3]),t}function Hce(t,e,r,i,n=lr()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function OLe(t,e=lr()){return e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax,e}function C7(t,e){return new $r({xmin:t[0],ymin:t[1],xmax:t[2],ymax:t[3],spatialReference:e})}function SA(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Fw(t,e,r){if(e!=null)if("length"in e)XQ(e)?(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[2]),r[3]=Math.max(t[3],e[3])):e.length!==2&&e.length!==3||(r[0]=Math.min(t[0],e[0]),r[1]=Math.min(t[1],e[1]),r[2]=Math.max(t[2],e[0]),r[3]=Math.max(t[3],e[1]));else switch(e.type){case"extent":r[0]=Math.min(t[0],e.xmin),r[1]=Math.min(t[1],e.ymin),r[2]=Math.max(t[2],e.xmax),r[3]=Math.max(t[3],e.ymax);break;case"point":r[0]=Math.min(t[0],e.x),r[1]=Math.min(t[1],e.y),r[2]=Math.max(t[2],e.x),r[3]=Math.max(t[3],e.y)}else A_(r,t)}function QW(t,e,r=t){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3];for(let l=0;l<i;l++){const c=e[l];n=Math.min(n,c[0]),s=Math.min(s,c[1]),o=Math.max(o,c[0]),a=Math.max(a,c[1])}return r[0]=n,r[1]=s,r[2]=o,r[3]=a,r}function qQ(t){for(let e=0;e<4;e++)if(!isFinite(t[e]))return!1;return!0}function lh(t){return t==null||t[0]>=t[2]?0:t[2]-t[0]}function og(t){return t[1]>=t[3]?0:t[3]-t[1]}function ALe(t){return lh(t)*og(t)}function qce(t,e=[0,0]){return e[0]=(t[0]+t[2])/2,e[1]=(t[1]+t[3])/2,e}function PLe(t,e){return R7(t,e[0],e[1])}function yve(t,e){const r=e[3],i=.5*(t[0]+t[2]),n=Math.abs(e[0]-i),s=.5*(t[2]-t[0]);if(n>r+s)return!1;const o=.5*(t[1]+t[3]),a=.5*(t[3]-t[1]),l=Math.abs(e[1]-o);if(l>r+a)return!1;if(n<s||l<a)return!0;const c=n-s,u=l-a;return c*c+u*u<=r*r}function Bhr(t,e,r){const i=t[0],n=t[1],s=t[2],o=t[3],{x:a,y:l}=e,{x:c,y:u}=r,h=(_,b)=>(u-l)*_+(a-c)*b+(c*l-a*u)<0,f=h(i,o),m=h(s,o),g=h(s,n),y=h(i,n);return!(f===m&&m===g&&g===y&&y===f||a<i&&c<i||a>s&&c>s||l>o&&u>o||l<n&&u<n)}function jhr(t,e){return R7(t,e.x,e.y)}function R7(t,e,r){return e>=t[0]&&r>=t[1]&&e<=t[2]&&r<=t[3]}function Hmt(t,e,r){return e[0]>=t[0]-r&&e[1]>=t[1]-r&&e[0]<=t[2]+r&&e[1]<=t[3]+r}function Z4(t,e){return Math.max(e[0],t[0])<=Math.min(e[2],t[2])&&Math.max(e[1],t[1])<=Math.min(e[3],t[3])}function vve(t,e){return e[0]>=t[0]&&e[2]<=t[2]&&e[1]>=t[1]&&e[3]<=t[3]}function WQ(t,e,r){if(e==null)return A_(r,t);const i=e[0],n=e[1],s=e[2],o=e[3];return r[0]=Te(t[0],i,s),r[1]=Te(t[1],n,o),r[2]=Te(t[2],i,s),r[3]=Te(t[3],n,o),r}function qmt(t,e){const r=(t[0]+t[2])/2,i=(t[1]+t[3])/2,n=Math.max(Math.abs(e[0]-r)-lh(t)/2,0),s=Math.max(Math.abs(e[1]-i)-og(t)/2,0);return Math.sqrt(n*n+s*s)}function kV(t,e,r,i=t){return i[0]=t[0]+e,i[1]=t[1]+r,i[2]=t[2]+e,i[3]=t[3]+r,i}function xd(t){return t?A_(t,YQ):lr(YQ)}function XQ(t){return t!=null&&t.length===4}function Wmt(t){return!(lh(t)!==0&&isFinite(t[0])||og(t)!==0&&isFinite(t[1]))}function v2(t,e){return XQ(t)&&XQ(e)?t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]:t===e}const Ghr=[-1/0,-1/0,1/0,1/0],YQ=[1/0,1/0,-1/0,-1/0],Xmt=[0,0,0,0];function MLe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function $Le(t){return t.points!==void 0}function ILe(t){return t.x!==void 0&&t.y!==void 0}function LLe(t){return t.paths!==void 0}function DLe(t){return t.rings!==void 0}function NLe(t){function e(r,i){return r==null?i:i==null?r:t(r,i)}return e}const dw=NLe(Math.min),hw=NLe(Math.max);function Hhr(t,e){return LLe(e)?vP(t,e.paths,!1,!1):DLe(e)?vP(t,e.rings,!1,!1):$Le(e)?Wce(t,e.points,!1,!1,!1,!1):MLe(e)?FLe(t,e):(ILe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.x,t[3]=e.y),t)}function qhr(t){let e,r,i,n;for(t.reset(),e=i=1/0,r=n=-1/0;t.nextPath();){const s=Ymt(t);e=Math.min(s[0],e),i=Math.min(s[1],i),r=Math.max(s[2],r),n=Math.max(s[3],n)}return lr([e,i,r,n])}function Ymt(t){let e,r,i,n;for(e=i=1/0,r=n=-1/0;t.nextPoint();)e=Math.min(t.x,e),i=Math.min(t.y,i),r=Math.max(t.x,r),n=Math.max(t.y,n);return lr([e,i,r,n])}function Whr(t,e){return LLe(e)?vP(t,e.paths,!0,!1):DLe(e)?vP(t,e.rings,!0,!1):$Le(e)?Wce(t,e.points,!0,!1,!0,!1):MLe(e)?FLe(t,e,!0,!1,!0,!1):(ILe(e)&&(t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.x,t[4]=e.y,t[5]=e.z),t)}function vP(t,e,r,i){const n=r?3:2;if(!e.length||!e[0].length)return null;let s,o,a,l,[c,u]=e[0][0],[h,f]=e[0][0];for(let m=0;m<e.length;m++){const g=e[m];for(let y=0;y<g.length;y++){const _=g[y],[b,w]=_;if(c=dw(c,b),u=dw(u,w),h=hw(h,b),f=hw(f,w),r&&_.length>2){const x=_[2];s=dw(s,x),o=hw(o,x)}if(i&&_.length>n){const x=_[n];a=dw(s,x),l=hw(o,x)}}}return r?i?(t[0]=c,t[1]=u,t[2]=s,t[3]=a,t[4]=h,t[5]=f,t[6]=o,t[7]=l,t.length=8,t):(t[0]=c,t[1]=u,t[2]=s,t[3]=h,t[4]=f,t[5]=o,t.length=6,t):i?(t[0]=c,t[1]=u,t[2]=a,t[3]=h,t[4]=f,t[5]=l,t.length=6,t):(t[0]=c,t[1]=u,t[2]=h,t[3]=f,t.length=4,t)}function FLe(t,e,r,i,n,s){const o=e.xmin,a=e.xmax,l=e.ymin,c=e.ymax;let u=e.zmin,h=e.zmax,f=e.mmin,m=e.mmax;return n?(u=u||0,h=h||0,s?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=u,t[3]=f,t[4]=a,t[5]=c,t[6]=h,t[7]=m,t):(t[0]=o,t[1]=l,t[2]=u,t[3]=a,t[4]=c,t[5]=h,t)):s?(f=f||0,m=m||0,t[0]=o,t[1]=l,t[2]=f,t[3]=a,t[4]=c,t[5]=m,t):(t[0]=o,t[1]=l,t[2]=a,t[3]=c,t)}function Wce(t,e,r,i,n,s){const o=r?3:2,a=i&&s,l=r&&n;if(!e.length||!e[0].length)return null;let c,u,h,f,[m,g]=e[0],[y,_]=e[0];for(let b=0;b<e.length;b++){const w=e[b],[x,S]=w;if(m=dw(m,x),g=dw(g,S),y=hw(y,x),_=hw(_,S),l&&w.length>2){const C=w[2];c=dw(c,C),u=hw(u,C)}if(a&&w.length>o){const C=w[o];h=dw(c,C),f=hw(u,C)}}return n?(c=c||0,u=u||0,s?(h=h||0,f=f||0,t[0]=m,t[1]=g,t[2]=c,t[3]=h,t[4]=y,t[5]=_,t[6]=u,t[7]=f,t):(t[0]=m,t[1]=g,t[2]=c,t[3]=y,t[4]=_,t[5]=u,t)):s?(h=h||0,f=f||0,t[0]=m,t[1]=g,t[2]=h,t[3]=y,t[4]=_,t[5]=f,t):(t[0]=m,t[1]=g,t[2]=y,t[3]=_,t)}function Zmt(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Jmt(t){return t.points!==void 0}function Kmt(t){return t.x!==void 0&&t.y!==void 0}function Qmt(t){return t.paths!==void 0}function egt(t){return t.rings!==void 0}const Xce=[];function kLe(t,e,r,i){return{xmin:t,ymin:e,xmax:r,ymax:i}}function ULe(t,e,r,i,n,s){return{xmin:t,ymin:e,zmin:r,xmax:i,ymax:n,zmax:s}}function zLe(t,e,r,i,n,s){return{xmin:t,ymin:e,mmin:r,xmax:i,ymax:n,mmax:s}}function VLe(t,e,r,i,n,s,o,a){return{xmin:t,ymin:e,zmin:r,mmin:i,xmax:n,ymax:s,zmax:o,mmax:a}}function Yce(t,e=!1,r=!1){return e?r?VLe(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7]):ULe(t[0],t[1],t[2],t[3],t[4],t[5]):r?zLe(t[0],t[1],t[2],t[3],t[4],t[5]):kLe(t[0],t[1],t[2],t[3])}function Xhr(t){return t?Zmt(t)?t:Kmt(t)?rgt(t):egt(t)?BLe(t):Qmt(t)?jLe(t):Jmt(t)?tgt(t):null:null}function tgt(t){const{hasZ:e,hasM:r,points:i}=t;return Yce(Wce(Xce,i,e??!1,r??!1),e,r)}function rgt(t){const{x:e,y:r,z:i,m:n}=t,s=n!=null;return i!=null?s?VLe(e,r,i,n,e,r,i,n):ULe(e,r,i,e,r,i):s?zLe(e,r,n,e,r,n):kLe(e,r,e,r)}function BLe(t){const{hasZ:e,hasM:r,rings:i}=t,n=vP(Xce,i,e??!1,r??!1);return n?Yce(n,e,r):null}function jLe(t){const{hasZ:e,hasM:r,paths:i}=t,n=vP(Xce,i,e??!1,r??!1);return n?Yce(n,e,r):null}var O8;function _ve(t){return!Array.isArray(t[0])}let Xg=O8=class extends Sx{static fromExtent(t){const e=t.clone().normalize(),r=t.spatialReference;let i=!1,n=!1;for(const o of e)o.hasZ&&(i=!0),o.hasM&&(n=!0);const s={rings:e.map(o=>{const a=[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]];if(i&&o.hasZ){const l=o.zmin+.5*(o.zmax-o.zmin);for(let c=0;c<a.length;c++)a[c].push(l)}if(n&&o.hasM){const l=o.mmin+.5*(o.mmax-o.mmin);for(let c=0;c<a.length;c++)a[c].push(l)}return a}),spatialReference:r};return i&&(s.hasZ=!0),n&&(s.hasM=!0),new O8(s)}constructor(...t){super(...t),this.rings=[],this.type="polygon"}normalizeCtorArgs(t,e){let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.rings??null,e||(t.spatialReference?e=t.spatialReference:t.rings||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||dt.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=s.length>3):r===void 0?r=i?s.length>3:s.length>2:i===void 0&&(i=r?s.length>3:s.length>2)),{rings:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("rings"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get centroid(){const t=kmt(this);if(!t||isNaN(t[0])||isNaN(t[1])||this.hasZ&&isNaN(t[2]))return null;const e=new Gt;return e.x=t[0],e.y=t[1],e.spatialReference=this.spatialReference,this.hasZ&&(e.z=t[2]),e}get extent(){const{spatialReference:t}=this,e=BLe(this);if(!e)return null;const r=new $r(e);return r.spatialReference=t,r}get isSelfIntersecting(){return zpt(this.rings)}writeRings(t,e){e.rings=ie(this.rings)}addRing(t){if(!t)return;const e=this.rings,r=e.length;if(_ve(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("rings"),this}clone(){const t=new O8;return t.spatialReference=this.spatialReference,t.rings=ie(this.rings),t.hasZ=this.hasZ,t.hasM=this.hasM,t}equals(t){if(this===t)return!0;if(t==null)return!1;const e=this.spatialReference,r=t.spatialReference;if(e!=null!=(r!=null)||e!=null&&r!=null&&!e.equals(r)||this.rings.length!==t.rings.length)return!1;const i=([n,s,o,a],[l,c,u,h])=>n===l&&s===c&&(o==null&&u==null||o===u)&&(a==null&&h==null||a===h);for(let n=0;n<this.rings.length;n++){const s=this.rings[n],o=t.rings[n];if(!T_(s,o,i))return!1}return!0}contains(t){if(!t)return!1;const e=PE(t,this.spatialReference);return Ppt(this,e??t)}isClockwise(t){let e;return e=_ve(t)?t.map(r=>this.hasZ?this.hasM?[r.x,r.y,r.z,r.m]:[r.x,r.y,r.z]:[r.x,r.y]):t,Gce(e,this.hasM,this.hasZ)}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.rings[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new Gt(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new Gt(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new Gt(r[0],r[1],r[2],r[3],this.spatialReference):new Gt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(yP(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t].splice(e,0,r),this.notifyChange("rings"),this):this}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Gt(this.rings[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("rings"),r}removeRing(t){if(!this._validateInputs(t,null))return null;const e=this.rings.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new Gt(n,r));return this.notifyChange("rings"),i}setPoint(t,e,r){return this._validateInputs(t,e)?(yP(this,r),Array.isArray(r)||(r=r.toArray()),this.rings[t][e]=r,this.notifyChange("rings"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.rings.length)return!1;if(e!=null){const i=this.rings[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([p({readOnly:!0})],Xg.prototype,"cache",null),d([p({readOnly:!0})],Xg.prototype,"centroid",null),d([p({readOnly:!0})],Xg.prototype,"extent",null),d([p({readOnly:!0})],Xg.prototype,"isSelfIntersecting",null),d([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],Xg.prototype,"rings",void 0),d([tt("rings")],Xg.prototype,"writeRings",null),Xg=O8=d([I("esri.geometry.Polygon")],Xg),Xg.prototype.toJSON.isDefaultToJSON=!0;const Tc=Xg;var ZQ;function igt(t){return!Array.isArray(t[0])}let tb=ZQ=class extends Sx{constructor(...t){super(...t),this.paths=[],this.type="polyline"}normalizeCtorArgs(t,e){let r,i,n=null,s=null;return t&&!Array.isArray(t)?(n=t.paths??null,e||(t.spatialReference?e=t.spatialReference:t.paths||(e=t)),r=t.hasZ,i=t.hasM):n=t,n=n||[],e=e||dt.WGS84,n.length&&n[0]&&n[0][0]!=null&&typeof n[0][0]=="number"&&(n=[n]),s=n[0]&&n[0][0],s&&(r===void 0&&i===void 0?(r=s.length>2,i=!1):r===void 0?r=!i&&s.length>3:i===void 0&&(i=!r&&s.length>3)),{paths:n,spatialReference:e,hasZ:r,hasM:i}}get cache(){return this.commitProperty("paths"),this.commitProperty("hasZ"),this.commitProperty("hasM"),this.commitProperty("spatialReference"),{}}get extent(){const{spatialReference:t}=this,e=jLe(this);if(!e)return null;const r=new $r(e);return r.spatialReference=t,r}writePaths(t,e){e.paths=ie(this.paths)}addPath(t){if(!t)return;const e=this.paths,r=e.length;if(igt(t)){const i=[];for(let n=0,s=t.length;n<s;n++)i[n]=t[n].toArray();e[r]=i}else e[r]=t.concat();return this.notifyChange("paths"),this}clone(){const t=new ZQ;return t.spatialReference=this.spatialReference,t.paths=ie(this.paths),t.hasZ=this.hasZ,t.hasM=this.hasM,t}getPoint(t,e){if(!this._validateInputs(t,e))return null;const r=this.paths[t][e],i=this.hasZ,n=this.hasM;return i&&!n?new Gt(r[0],r[1],r[2],void 0,this.spatialReference):n&&!i?new Gt(r[0],r[1],void 0,r[2],this.spatialReference):i&&n?new Gt(r[0],r[1],r[2],r[3],this.spatialReference):new Gt(r[0],r[1],this.spatialReference)}insertPoint(t,e,r){return this._validateInputs(t,e,!0)?(yP(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t].splice(e,0,r),this.notifyChange("paths"),this):this}removePath(t){if(!this._validateInputs(t,null))return null;const e=this.paths.splice(t,1)[0],r=this.spatialReference,i=e.map(n=>new Gt(n,r));return this.notifyChange("paths"),i}removePoint(t,e){if(!this._validateInputs(t,e))return null;const r=new Gt(this.paths[t].splice(e,1)[0],this.spatialReference);return this.notifyChange("paths"),r}setPoint(t,e,r){return this._validateInputs(t,e)?(yP(this,r),Array.isArray(r)||(r=r.toArray()),this.paths[t][e]=r,this.notifyChange("paths"),this):this}_validateInputs(t,e,r=!1){if(t==null||t<0||t>=this.paths.length)return!1;if(e!=null){const i=this.paths[t];if(r&&(e<0||e>i.length)||!r&&(e<0||e>=i.length))return!1}return!0}toJSON(t){return this.write({},t)}};d([p({readOnly:!0})],tb.prototype,"cache",null),d([p({readOnly:!0})],tb.prototype,"extent",null),d([p({type:[[[Number]]],json:{write:{isRequired:!0}}})],tb.prototype,"paths",void 0),d([tt("paths")],tb.prototype,"writePaths",null),tb=ZQ=d([I("esri.geometry.Polyline")],tb),tb.prototype.toJSON.isDefaultToJSON=!0;const J4=tb,O7=Ac()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon"}),bve=Ac()({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh"});function GLe(t){return t.xmin!==void 0&&t.ymin!==void 0&&t.xmax!==void 0&&t.ymax!==void 0}function Zce(t){return t.points!==void 0}function Jce(t){return t.x!==void 0&&t.y!==void 0}function Kce(t){return t.paths!==void 0}function TA(t){return t.rings!==void 0}function P_(t){return t==null?null:t instanceof Sx?t:Jce(t)?Gt.fromJSON(t):Kce(t)?J4.fromJSON(t):TA(t)?Tc.fromJSON(t):Zce(t)?Y4.fromJSON(t):GLe(t)?$r.fromJSON(t):null}function Qce(t){return t?Jce(t)?"esriGeometryPoint":Kce(t)?"esriGeometryPolyline":TA(t)?"esriGeometryPolygon":GLe(t)?"esriGeometryEnvelope":Zce(t)?"esriGeometryMultipoint":null:null}const ngt={esriGeometryPoint:Gt,esriGeometryPolyline:J4,esriGeometryPolygon:Tc,esriGeometryEnvelope:$r,esriGeometryMultipoint:Y4};function sgt(t){return t&&ngt[t]||null}const ME={base:Sx,key:"type",typeMap:{extent:$r,multipoint:Y4,point:Gt,polyline:J4,polygon:Tc}};ng(ME);let HLe=0;const K4=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+HLe++})}};return e=d([I("esri.core.Identifiable")],e),e},Yhr=t=>{let e=class extends t{constructor(...r){super(...r),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:HLe++})}};return e=d([I("esri.core.NumericIdentifiable")],e),e};let wve=class extends K4(class{}){};wve=d([I("esri.core.Identifiable")],wve);async function ogt(t){const e="portalItem"in t?t:{portalItem:t},{fromItem:r}=await le(()=>import("./portalLayers-e8c5e5dc.js"),["assets/portalLayers-e8c5e5dc.js","assets/lazyLayerLoader-49c90994.js","assets/layersLoader-8bc96631.js","assets/fetchService-7b5f3ba7.js","assets/jsonContext-03b7f0b9.js"]);try{return await r(e)}catch(i){const n=e&&e.portalItem,s=n&&n.id||"unset",o=n&&n.portal&&n.portal.url||Ti.portalUrl;throw re.getLogger("esri.layers.support.fromPortalItem").error("#fromPortalItem()","Failed to create layer from portal item (portal: '"+o+"', id: '"+s+"')",i),i}}let agt=0,_a=class extends pn.EventedMixin(K4(sg)){constructor(){super(...arguments),this.attributionDataUrl=null,this.fullExtent=new $r(-180,-90,180,90,dt.WGS84),this.id=Date.now().toString(16)+"-layer-"+agt++,this.legendEnabled=!0,this.listMode="show",this.opacity=1,this.parent=null,this.popupEnabled=!0,this.attributionVisible=!0,this.spatialReference=dt.WGS84,this.title=null,this.type=null,this.url=null,this.visible=!0}static async fromArcGISServerUrl(e){const r=typeof e=="string"?{url:e}:e;return(await le(()=>import("./arcgisLayers-d57dec19.js"),["assets/arcgisLayers-d57dec19.js","assets/fetchService-7b5f3ba7.js","assets/lazyLayerLoader-49c90994.js"])).fromUrl(r)}static fromPortalItem(e){return ogt(e)}initialize(){this.when().catch(e=>{Yn(e)||re.getLogger(this).error("#load()",`Failed to load layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}')`,{error:e})})}destroy(){if(this.parent){const e=this,r=this.parent;"layers"in r&&r.layers.includes(e)?r.layers.remove(e):"tables"in r&&r.tables.includes(e)?r.tables.remove(e):"baseLayers"in r&&r.baseLayers.includes(e)?r.baseLayers.remove(e):"baseLayers"in r&&r.referenceLayers.includes(e)&&r.referenceLayers.remove(e)}}get hasAttributionData(){return this.attributionDataUrl!=null}get parsedUrl(){return Ts(this.url)}async fetchAttributionData(){const e=this.attributionDataUrl;if(this.hasAttributionData&&e)return(await ti(e,{query:{f:"json"},responseType:"json"})).data;throw new H("layer:no-attribution-data","Layer does not have attribution data")}};d([p({type:String})],_a.prototype,"attributionDataUrl",void 0),d([p({type:$r})],_a.prototype,"fullExtent",void 0),d([p({readOnly:!0})],_a.prototype,"hasAttributionData",null),d([p({type:String,clonable:!1})],_a.prototype,"id",void 0),d([p({type:Boolean,nonNullable:!0})],_a.prototype,"legendEnabled",void 0),d([p({type:["show","hide","hide-children"]})],_a.prototype,"listMode",void 0),d([p({type:Number,range:{min:0,max:1},nonNullable:!0})],_a.prototype,"opacity",void 0),d([p({clonable:!1})],_a.prototype,"parent",void 0),d([p({readOnly:!0})],_a.prototype,"parsedUrl",null),d([p({type:Boolean})],_a.prototype,"popupEnabled",void 0),d([p({type:Boolean})],_a.prototype,"attributionVisible",void 0),d([p({type:dt})],_a.prototype,"spatialReference",void 0),d([p({type:String})],_a.prototype,"title",void 0),d([p({readOnly:!0,json:{read:!1}})],_a.prototype,"type",void 0),d([p()],_a.prototype,"url",void 0),d([p({type:Boolean,nonNullable:!0})],_a.prototype,"visible",void 0),_a=d([I("esri.layers.Layer")],_a);const O3=_a;function JQ(t,e,r){let i,n;if(t)for(let s=0,o=t.length;s<o;s++){if(i=t.at(s),(i==null?void 0:i[e])===r)return i;if((i==null?void 0:i.type)==="group"&&(n=JQ(i.layers,e,r),n))return n}}const lgt=t=>{let e=class extends t{constructor(...r){super(...r),this.layers=new vt;const i=o=>{o.parent&&"remove"in o.parent&&o.parent.remove(o)},n=o=>{o.parent=this,this.layerAdded(o),o.type!=="elevation"&&o.type!=="base-elevation"||re.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as an operational layer and will therefore be ignored.`)},s=o=>{o.parent=null,this.layerRemoved(o)};this.addHandles([this.layers.on("before-add",o=>i(o.item)),this.layers.on("after-add",o=>n(o.item)),this.layers.on("after-remove",o=>s(o.item))])}destroy(){const r=this.layers.toArray();for(const i of r)i.destroy();this.layers.destroy()}set layers(r){this._set("layers",R_(r,this._get("layers")))}add(r,i){const n=this.layers;if(i=n.getNextIndex(i),r instanceof O3){const s=r;s.parent===this?this.reorder(s,i):n.add(s,i)}else Dh(r)?r.then(s=>{this.destroyed||this.add(s,i)}):re.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,i){const n=this.layers;let s=n.getNextIndex(i);r.slice().forEach(o=>{o.parent!==this?(n.add(o,s),s+=1):this.reorder(o,s)})}findLayerById(r){return JQ(this.layers,"id",r)}findLayerByUid(r){return JQ(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,i){return this.layers.reorder(r,i)}layerAdded(r){}layerRemoved(r){}};return d([p()],e.prototype,"layers",null),e=d([I("esri.support.LayersMixin")],e),e};function KQ(t,e,r){if(t)for(let i=0,n=t.length;i<n;i++){const s=t.at(i);if(s[e]===r)return s;if((s==null?void 0:s.type)==="group"){const o=KQ(s.tables,e,r);if(o)return o}}}const cgt=t=>{let e=class extends t{constructor(...r){super(...r),this.tables=new vt,this.addHandles([this.tables.on("after-add",i=>{const n=i.item;n.parent&&n.parent!==this&&"tables"in n.parent&&n.parent.tables.remove(n),n.parent=this,n.type!=="feature"&&re.getLogger(this).error(`Layer 'title:${n.title}, id:${n.id}' of type '${n.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",i=>{i.item.parent=null})])}destroy(){const r=this.tables.removeAll();for(const i of r)i.destroy();this.tables.destroy()}set tables(r){this._set("tables",R_(r,this._get("tables")))}findTableById(r){return KQ(this.tables,"id",r)}findTableByUid(r){return KQ(this.tables,"uid",r)}};return d([p()],e.prototype,"tables",null),e=d([I("esri.support.TablesMixin")],e),e};let Yg=class extends cgt(lgt(pn.EventedMixin(Ce))){constructor(e){super(e),this.allLayers=new RN({getCollections:()=>{var r,i,n;return[(r=this.basemap)==null?void 0:r.baseLayers,(i=this.ground)==null?void 0:i.layers,this.layers,(n=this.basemap)==null?void 0:n.referenceLayers]},getChildrenFunction:r=>"layers"in r?r.layers:null}),this.allTables=Amt(this),this.basemap=null,this.editableLayers=new RN({getCollections:()=>[this.allLayers],itemFilterFunction:xmt}),this.ground=new CN,this._basemapCache=Tmt()}destroy(){var e,r;this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),(e=this.ground)==null||e.destroy(),(r=this.basemap)==null||r.destroy(),Emt(this._basemapCache),this._basemapCache=null}castBasemap(e){return jce(e,this._basemapCache)}castGround(e){return Pmt(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(r=>r.id===e)}findTableById(e){return this.allTables.find(r=>r.id===e)}};d([p({readOnly:!0,dependsOn:[]})],Yg.prototype,"allLayers",void 0),d([p({readOnly:!0})],Yg.prototype,"allTables",void 0),d([p({type:TN})],Yg.prototype,"basemap",void 0),d([ur("basemap")],Yg.prototype,"castBasemap",null),d([p({readOnly:!0})],Yg.prototype,"editableLayers",void 0),d([p({type:CN,nonNullable:!0})],Yg.prototype,"ground",void 0),d([ur("ground")],Yg.prototype,"castGround",null),Yg=d([I("esri.Map")],Yg);const qLe=Yg,Rn=t=>{let e=class extends t{clone(){var l;const r=qu(Ul(this),"unable to clone instance of non-accessor class"),i=r.metadatas,n=r.store,s={},o=new Map;for(const c in i){const u=i[c],h=n==null?void 0:n.originOf(c),f=u.clonable;if(u.readOnly||f===!1||h!==Fr.USER&&h!==Fr.DEFAULTS&&h!==Fr.WEB_MAP&&h!==Fr.WEB_SCENE)continue;const m=this[c];let g=null;g=typeof f=="function"?f(m):f==="reference"?m:aQ(m),m!=null&&g==null||(h===Fr.DEFAULTS?o.set(c,g):s[c]=g)}const a=new(Object.getPrototypeOf(this)).constructor(s);if(o.size){const c=(l=Ul(a))==null?void 0:l.store;if(c)for(const[u,h]of o)c.set(u,h,Fr.DEFAULTS)}return a}};return e=d([I("esri.core.Clonable")],e),e};let xve=class extends Rn(Ce){};xve=d([I("esri.core.Clonable")],xve);let Xw=class{constructor(e,r){this.min=e,this.max=r,this.range=r-e}ndiff(e,r=0){return Math.ceil((e-r)/this.range)*this.range+r}_normalize(e,r,i,n=0,s=!1){return(i-=n)<e?i+=this.ndiff(e-i):i>r&&(i-=this.ndiff(i-r)),s&&i===r&&(i=e),i+n}normalize(e,r=0,i=!1){return this._normalize(this.min,this.max,e,r,i)}clamp(e,r=0){return Te(e-r,this.min,this.max)+r}monotonic(e,r,i){return e<r?r:r+this.ndiff(e-r,i)}minimalMonotonic(e,r,i){return this._normalize(e,e+this.range,r,i)}center(e,r,i){return r=this.monotonic(e,r,i),this.normalize((e+r)/2,i)}diff(e,r,i){return this.monotonic(e,r,i)-e}shortestSignedDiff(e,r){e=this.normalize(e);const i=(r=this.normalize(r))-e,n=r<e?this.minimalMonotonic(e,r)-e:r-this.minimalMonotonic(r,e);return Math.abs(i)<Math.abs(n)?i:n}contains(e,r,i){return r=this.minimalMonotonic(e,r),(i=this.minimalMonotonic(e,i))>e&&i<r}};function eue(t){for(const e in t){const r=t[e];r instanceof Function&&(t[e]=r.bind(t))}return t}const ugt=eue(new Xw(0,2*Math.PI)),Yw=eue(new Xw(-Math.PI,Math.PI)),tue=eue(new Xw(0,360));let nv=class extends Rn(me){constructor(...e){super(...e),this.position=new Gt([0,0,0]),this.heading=0,this.tilt=0,this.fov=55}normalizeCtorArgs(e,r,i,n){if(e&&typeof e=="object"&&("x"in e||Array.isArray(e))){const s={position:e};return r!=null&&(s.heading=r),i!=null&&(s.tilt=i),n!=null&&(s.fov=n),s}return e}writePosition(e,r,i,n){const s=e.clone();s.x=Op(e.x||0),s.y=Op(e.y||0),s.z=e.hasZ?Op(e.z||0):e.z,r[i]=s.write({},n)}readPosition(e,r){const i=new Gt;return i.read(e,r),i.x=Op(i.x||0),i.y=Op(i.y||0),i.z=i.hasZ?Op(i.z||0):i.z,i}equals(e){return e!=null&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)}};d([p({type:Gt,json:{write:{isRequired:!0}}})],nv.prototype,"position",void 0),d([tt("position")],nv.prototype,"writePosition",null),d([ke("position")],nv.prototype,"readPosition",null),d([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ur(t=>tue.normalize(Op(t)))],nv.prototype,"heading",void 0),d([p({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),ur(t=>Te(Op(t),-180,180))],nv.prototype,"tilt",void 0),d([p({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],nv.prototype,"fov",void 0),nv=d([I("esri.Camera")],nv);const of=nv;var QQ;let rb=QQ=class extends me{constructor(t){super(t),this.rotation=0,this.scale=0,this.targetGeometry=null,this.camera=null}castRotation(t){return(t%=360)<0&&(t+=360),t}clone(){return new QQ({rotation:this.rotation,scale:this.scale,targetGeometry:this.targetGeometry!=null?this.targetGeometry.clone():null,camera:this.camera!=null?this.camera.clone():null})}};function eX(){return{enabled:!this.camera}}d([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:eX}}}}})],rb.prototype,"rotation",void 0),d([ur("rotation")],rb.prototype,"castRotation",null),d([p({type:Number,json:{write:!0,origins:{"web-map":{default:0,write:!0},"web-scene":{write:{overridePolicy:eX}}}}})],rb.prototype,"scale",void 0),d([p({types:ME,json:{read:P_,write:!0,origins:{"web-scene":{read:P_,write:{overridePolicy:eX}}}}})],rb.prototype,"targetGeometry",void 0),d([p({type:of,json:{write:!0}})],rb.prototype,"camera",void 0),rb=QQ=d([I("esri.Viewpoint")],rb);const Sd=rb;let dgt=class WLe{constructor(){this._propertyOriginMap=new Map,this._originStores=new Array(fQ),this._values=new Map,this.multipleOriginsSupported=!0}clone(e){const r=new WLe,i=this._originStores[Fr.DEFAULTS];i&&i.forEach((n,s)=>{r.set(s,ie(n),Fr.DEFAULTS)});for(let n=Fr.SERVICE;n<fQ;n++){const s=this._originStores[n];s&&s.forEach((o,a)=>{e&&e.has(a)||r.set(a,ie(o),n)})}return r}get(e,r){const i=r===void 0?this._values:this._originStores[r];return i?i.get(e):void 0}keys(e){const r=e==null?this._values:this._originStores[e];return r?[...r.keys()]:[]}set(e,r,i=Fr.USER){let n=this._originStores[i];if(n||(n=new Map,this._originStores[i]=n),n.set(e,r),!this._values.has(e)||this._propertyOriginMap.get(e)<=i){const s=this._values.get(e);return this._values.set(e,r),this._propertyOriginMap.set(e,i),s!==r}return!1}delete(e,r=Fr.USER){const i=this._originStores[r];if(!i)return;const n=i.get(e);if(i.delete(e),this._values.has(e)&&this._propertyOriginMap.get(e)===r){this._values.delete(e);for(let s=r-1;s>=0;s--){const o=this._originStores[s];if(o&&o.has(e)){this._values.set(e,o.get(e)),this._propertyOriginMap.set(e,s);break}}}return n}has(e,r){const i=r===void 0?this._values:this._originStores[r];return!!i&&i.has(e)}revert(e,r){for(;r>0&&!this.has(e,r);)--r;const i=this._originStores[r],n=i&&i.get(e),s=this._values.get(e);return this._values.set(e,n),this._propertyOriginMap.set(e,r),s!==n}originOf(e){return this._propertyOriginMap.get(e)||Fr.DEFAULTS}forEach(e){this._values.forEach(e)}};const XLe=t=>{let e=class extends t{constructor(...r){super(...r);const i=Ul(this),n=i.store,s=new dgt;i.store=s,gIe(i,n,s)}read(r,i){vIe(this,r,i)}getAtOrigin(r,i){const n=tX(this),s=Gv(i);if(typeof r=="string")return n.get(r,s);const o={};return r.forEach(a=>{o[a]=n.get(a,s)}),o}originOf(r){return pV(this.originIdOf(r))}originIdOf(r){return tX(this).originOf(r)}revert(r,i){const n=tX(this),s=Gv(i),o=Ul(this);let a;a=typeof r=="string"?r==="*"?n.keys(s):[r]:r,a.forEach(l=>{o.invalidate(l),n.revert(l,s),o.commit(l)})}};return e=d([I("esri.core.ReadOnlyMultiOriginJSONSupport")],e),e};function tX(t){return Ul(t).store}let Sve=class extends XLe(Ce){};Sve=d([I("esri.core.ReadOnlyMultiOriginJSONSupport")],Sve);const hgt=t=>{let e=class extends t{constructor(...r){super(...r)}clear(r,i="user"){return rX(this).delete(r,Gv(i))}write(r,i){return wIe(this,r=r||{},i),r}setAtOrigin(r,i,n){Ul(this).setAtOrigin(r,i,Gv(n))}removeOrigin(r){const i=rX(this),n=Gv(r),s=i.keys(n);for(const o of s)i.originOf(o)===n&&i.set(o,i.get(o,n),Fr.USER)}updateOrigin(r,i){const n=rX(this),s=Gv(i),o=this.get(r);for(let a=s+1;a<fQ;++a)n.delete(r,a);n.set(r,o,s)}toJSON(r){return this.write({},r)}};return e=d([I("esri.core.WriteableMultiOriginJSONSupport")],e),e.prototype.toJSON.isDefaultToJSON=!0,e};function rX(t){return Ul(t).store}const Q4=t=>{let e=class extends hgt(XLe(t)){constructor(...r){super(...r)}};return e=d([I("esri.core.MultiOriginJSONSupport")],e),e};let eee=class extends Q4(Ce){};eee=d([I("esri.core.MultiOriginJSONSupport")],eee);function pe(t,e,r={}){return rue(t,e,r,YLe)}function du(t,e,r={}){return rue(t,e,r,ZLe)}function rue(t,e,r={},i){let n=null;const s=r.once?(o,a)=>{i(o)&&(yi(n),e(o,a))}:(o,a)=>{i(o)&&e(o,a)};if(n=$dt(t,s,r.sync,r.equals),r.initial){const o=t();s(o,o)}return n}function da(t,e,r,i={}){let n=null,s=null,o=null;function a(){var u;n&&s&&(s.remove(),(u=i.onListenerRemove)==null||u.call(i,n),n=null,s=null)}function l(u){i.once&&i.once&&yi(o),r(u)}const c=pe(t,(u,h)=>{var f;a(),f7(u)&&(n=u,s=V4(u,e,l),(f=i.onListenerAdd)==null||f.call(i,u))},{sync:i.sync,initial:!0});return o=kl(()=>{c.remove(),a()}),o}function Zw(t,e){return pgt(t,ZLe,e)}function pgt(t,e,r){if(go(r))return Promise.reject(Wr());const i=t();if(e!=null&&e(i))return Promise.resolve(i);let n=null;function s(){n=yi(n)}return new Promise((o,a)=>{n=E_([Dl(r,()=>{s(),a(Wr())}),rue(t,l=>{s(),o(l)},{sync:!1,once:!0},e??YLe)])})}function YLe(t){return!0}function ZLe(t){return!!t}function npr(t,e,r={}){let i=!1;const n=pe(t,(s,o)=>{i||e(s,o)},r);return{remove(){n.remove()},pause(){i=!0},resume(){i=!1}}}const li={sync:!0},_r={initial:!0},Bi={sync:!0,initial:!0};function JLe(t){return t&&"getAtOrigin"in t&&"originOf"in t}function UV(t){t&&t.writtenProperties&&t.writtenProperties.forEach(({target:e,propName:r,newOrigin:i})=>{JLe(e)&&i&&e.originOf(r)!==i&&e.updateOrigin(r,i)})}var eI;const zV=Ac()({orthometric:"gravity-related-height",gravity_related_height:"gravity-related-height",ellipsoidal:"ellipsoidal"}),KLe=zV.jsonValues.slice();fN(KLe,"orthometric");const rD=Ac()({meter:"meters",foot:"feet","us-foot":"us-feet","clarke-foot":"clarke-feet","clarke-yard":"clarke-yards","clarke-link":"clarke-links","sears-yard":"sears-yards","sears-foot":"sears-feet","sears-chain":"sears-chains","benoit-1895-b-chain":"benoit-1895-b-chains","indian-yard":"indian-yards","indian-1937-yard":"indian-1937-yards","gold-coast-foot":"gold-coast-feet","sears-1922-truncated-chain":"sears-1922-truncated-chains","50-kilometers":"50-kilometers","150-kilometers":"150-kilometers"});let jf=eI=class extends me{constructor(t){super(t),this.heightModel="gravity-related-height",this.heightUnit="meters",this.vertCRS=null}writeHeightModel(t,e,r){return zV.write(t,e,r)}readHeightModel(t,e,r){return zV.read(t)||(r&&r.messages&&r.messages.push(fgt(t,{context:r})),null)}readHeightUnit(t,e,r){return rD.read(t)||(r&&r.messages&&r.messages.push(Tve(t,{context:r})),null)}readHeightUnitService(t,e,r){return MIe(t)||rD.read(t)||(r&&r.messages&&r.messages.push(Tve(t,{context:r})),null)}readVertCRS(t,e){return e.vertCRS||e.ellipsoid||e.geoid}clone(){return new eI({heightModel:this.heightModel,heightUnit:this.heightUnit,vertCRS:this.vertCRS})}equals(t){return!!t&&(this===t||this.heightModel===t.heightModel&&this.heightUnit===t.heightUnit&&this.vertCRS===t.vertCRS)}static deriveUnitFromSR(t,e){const r=$Ie(e);return new eI({heightModel:t.heightModel,heightUnit:r,vertCRS:t.vertCRS})}write(t,e){return e={origin:"web-scene",...e},super.write(t,e)}static fromJSON(t){if(!t)return null;const e=new eI;return e.read(t,{origin:"web-scene"}),e}};function Tve(t,e){return new nf("height-unit:unsupported",`Height unit of value '${t}' is not supported`,e)}function fgt(t,e){return new nf("height-model:unsupported",`Height model of value '${t}' is not supported`,e)}d([p({type:zV.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:KLe,default:"ellipsoidal"}}}})],jf.prototype,"heightModel",void 0),d([tt("web-scene","heightModel")],jf.prototype,"writeHeightModel",null),d([ke(["web-scene","service"],"heightModel")],jf.prototype,"readHeightModel",null),d([p({type:rD.apiValues,constructOnly:!0,json:{origins:{"web-scene":{type:rD.jsonValues,write:rD.write}}}})],jf.prototype,"heightUnit",void 0),d([ke("web-scene","heightUnit")],jf.prototype,"readHeightUnit",null),d([ke("service","heightUnit")],jf.prototype,"readHeightUnitService",null),d([p({type:String,constructOnly:!0,json:{origins:{"web-scene":{write:!0}}}})],jf.prototype,"vertCRS",void 0),d([ke("service","vertCRS",["vertCRS","ellipsoid","geoid"])],jf.prototype,"readVertCRS",null),jf=eI=d([I("esri.geometry.HeightModelInfo")],jf);const q_=jf;function Rs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function S0(t,e,r,i,n,s,o,a,l,c,u,h,f,m,g,y,_){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t[9]=u,t[10]=h,t[11]=f,t[12]=m,t[13]=g,t[14]=y,t[15]=_,t}function af(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Td(t,e){if(t===e){const r=e[1],i=e[2],n=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=s,t[11]=e[14],t[12]=n,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function A3(t,e){return Uo(t,e)||af(t),t}function Uo(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],m=e[11],g=e[12],y=e[13],_=e[14],b=e[15],w=r*a-i*o,x=r*l-n*o,S=r*c-s*o,C=i*l-n*a,E=i*c-s*a,R=n*c-s*l,P=u*y-h*g,D=u*_-f*g,L=u*b-m*g,k=h*_-f*y,V=h*b-m*y,W=f*b-m*_;let G=w*W-x*V+S*k+C*L-E*D+R*P;return G?(G=1/G,t[0]=(a*W-l*V+c*k)*G,t[1]=(n*V-i*W-s*k)*G,t[2]=(y*R-_*E+b*C)*G,t[3]=(f*E-h*R-m*C)*G,t[4]=(l*L-o*W-c*D)*G,t[5]=(r*W-n*L+s*D)*G,t[6]=(_*S-g*R-b*x)*G,t[7]=(u*R-f*S+m*x)*G,t[8]=(o*V-a*L+c*P)*G,t[9]=(i*L-r*V-s*P)*G,t[10]=(g*E-y*S+b*w)*G,t[11]=(h*S-u*E-m*w)*G,t[12]=(a*D-o*k-l*P)*G,t[13]=(r*k-i*D+n*P)*G,t[14]=(y*x-g*C-_*w)*G,t[15]=(u*C-h*x+f*w)*G,t):null}function mgt(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],m=e[11],g=e[12],y=e[13],_=e[14],b=e[15];return t[0]=a*(f*b-m*_)-h*(l*b-c*_)+y*(l*m-c*f),t[1]=-(i*(f*b-m*_)-h*(n*b-s*_)+y*(n*m-s*f)),t[2]=i*(l*b-c*_)-a*(n*b-s*_)+y*(n*c-s*l),t[3]=-(i*(l*m-c*f)-a*(n*m-s*f)+h*(n*c-s*l)),t[4]=-(o*(f*b-m*_)-u*(l*b-c*_)+g*(l*m-c*f)),t[5]=r*(f*b-m*_)-u*(n*b-s*_)+g*(n*m-s*f),t[6]=-(r*(l*b-c*_)-o*(n*b-s*_)+g*(n*c-s*l)),t[7]=r*(l*m-c*f)-o*(n*m-s*f)+u*(n*c-s*l),t[8]=o*(h*b-m*y)-u*(a*b-c*y)+g*(a*m-c*h),t[9]=-(r*(h*b-m*y)-u*(i*b-s*y)+g*(i*m-s*h)),t[10]=r*(a*b-c*y)-o*(i*b-s*y)+g*(i*c-s*a),t[11]=-(r*(a*m-c*h)-o*(i*m-s*h)+u*(i*c-s*a)),t[12]=-(o*(h*_-f*y)-u*(a*_-l*y)+g*(a*f-l*h)),t[13]=r*(h*_-f*y)-u*(i*_-n*y)+g*(i*f-n*h),t[14]=-(r*(a*_-l*y)-o*(i*_-n*y)+g*(i*l-n*a)),t[15]=r*(a*f-l*h)-o*(i*f-n*h)+u*(i*l-n*a),t}function ggt(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15];return(e*o-r*s)*(h*_-f*y)-(e*a-i*s)*(u*_-f*g)+(e*l-n*s)*(u*y-h*g)+(r*a-i*o)*(c*_-f*m)-(r*l-n*o)*(c*y-h*m)+(i*l-n*a)*(c*g-u*m)}function Ii(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=e[9],m=e[10],g=e[11],y=e[12],_=e[13],b=e[14],w=e[15];let x=r[0],S=r[1],C=r[2],E=r[3];return t[0]=x*i+S*a+C*h+E*y,t[1]=x*n+S*l+C*f+E*_,t[2]=x*s+S*c+C*m+E*b,t[3]=x*o+S*u+C*g+E*w,x=r[4],S=r[5],C=r[6],E=r[7],t[4]=x*i+S*a+C*h+E*y,t[5]=x*n+S*l+C*f+E*_,t[6]=x*s+S*c+C*m+E*b,t[7]=x*o+S*u+C*g+E*w,x=r[8],S=r[9],C=r[10],E=r[11],t[8]=x*i+S*a+C*h+E*y,t[9]=x*n+S*l+C*f+E*_,t[10]=x*s+S*c+C*m+E*b,t[11]=x*o+S*u+C*g+E*w,x=r[12],S=r[13],C=r[14],E=r[15],t[12]=x*i+S*a+C*h+E*y,t[13]=x*n+S*l+C*f+E*_,t[14]=x*s+S*c+C*m+E*b,t[15]=x*o+S*u+C*g+E*w,t}function hu(t,e,r){const i=r[0],n=r[1],s=r[2];if(e===t)t[12]=e[0]*i+e[4]*n+e[8]*s+e[12],t[13]=e[1]*i+e[5]*n+e[9]*s+e[13],t[14]=e[2]*i+e[6]*n+e[10]*s+e[14],t[15]=e[3]*i+e[7]*n+e[11]*s+e[15];else{const o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],f=e[6],m=e[7],g=e[8],y=e[9],_=e[10],b=e[11];t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=f,t[7]=m,t[8]=g,t[9]=y,t[10]=_,t[11]=b,t[12]=o*i+u*n+g*s+e[12],t[13]=a*i+h*n+y*s+e[13],t[14]=l*i+f*n+_*s+e[14],t[15]=c*i+m*n+b*s+e[15]}return t}function A7(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function sd(t,e,r,i){let n,s,o,a,l,c,u,h,f,m,g,y,_,b,w,x,S,C,E,R,P,D,L,k,V=i[0],W=i[1],G=i[2],B=Math.sqrt(V*V+W*W+G*G);return B<Bl()?null:(B=1/B,V*=B,W*=B,G*=B,n=Math.sin(r),s=Math.cos(r),o=1-s,a=e[0],l=e[1],c=e[2],u=e[3],h=e[4],f=e[5],m=e[6],g=e[7],y=e[8],_=e[9],b=e[10],w=e[11],x=V*V*o+s,S=W*V*o+G*n,C=G*V*o-W*n,E=V*W*o-G*n,R=W*W*o+s,P=G*W*o+V*n,D=V*G*o+W*n,L=W*G*o-V*n,k=G*G*o+s,t[0]=a*x+h*S+y*C,t[1]=l*x+f*S+_*C,t[2]=c*x+m*S+b*C,t[3]=u*x+g*S+w*C,t[4]=a*E+h*R+y*P,t[5]=l*E+f*R+_*P,t[6]=c*E+m*R+b*P,t[7]=u*E+g*R+w*P,t[8]=a*D+h*L+y*k,t[9]=l*D+f*L+_*k,t[10]=c*D+m*L+b*k,t[11]=u*D+g*L+w*k,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function _P(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*n+c*i,t[5]=o*n+u*i,t[6]=a*n+h*i,t[7]=l*n+f*i,t[8]=c*n-s*i,t[9]=u*n-o*i,t[10]=h*n-a*i,t[11]=f*n-l*i,t}function P7(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n-c*i,t[1]=o*n-u*i,t[2]=a*n-h*i,t[3]=l*n-f*i,t[8]=s*i+c*n,t[9]=o*i+u*n,t[10]=a*i+h*n,t[11]=l*i+f*n,t}function bP(t,e,r){const i=Math.sin(r),n=Math.cos(r),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*n+c*i,t[1]=o*n+u*i,t[2]=a*n+h*i,t[3]=l*n+f*i,t[4]=c*n-s*i,t[5]=u*n-o*i,t[6]=h*n-a*i,t[7]=f*n-l*i,t}function eF(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function ygt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ch(t,e,r){if(e===0)return af(t);let i,n,s,o=r[0],a=r[1],l=r[2],c=Math.sqrt(o*o+a*a+l*l);return c<Bl()?null:(c=1/c,o*=c,a*=c,l*=c,i=Math.sin(e),n=Math.cos(e),s=1-n,t[0]=o*o*s+n,t[1]=a*o*s+l*i,t[2]=l*o*s-a*i,t[3]=0,t[4]=o*a*s-l*i,t[5]=a*a*s+n,t[6]=l*a*s+o*i,t[7]=0,t[8]=o*l*s+a*i,t[9]=a*l*s-o*i,t[10]=l*l*s+n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function QLe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vgt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eDe(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function tDe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=i+i,l=n+n,c=s+s,u=i*a,h=i*l,f=i*c,m=n*l,g=n*c,y=s*c,_=o*a,b=o*l,w=o*c;return t[0]=1-(m+y),t[1]=h+w,t[2]=f-b,t[3]=0,t[4]=h-w,t[5]=1-(u+y),t[6]=g+_,t[7]=0,t[8]=f+b,t[9]=g-_,t[10]=1-(u+m),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function _gt(t,e){const r=bgt,i=-e[0],n=-e[1],s=-e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=i*i+n*n+s*s+o*o;return h>0?(r[0]=2*(a*o+u*i+l*s-c*n)/h,r[1]=2*(l*o+u*n+c*i-a*s)/h,r[2]=2*(c*o+u*s+a*n-l*i)/h):(r[0]=2*(a*o+u*i+l*s-c*n),r[1]=2*(l*o+u*n+c*i-a*s),r[2]=2*(c*o+u*s+a*n-l*i)),tDe(t,e,r),t}const bgt=A();function tee(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function rDe(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10];return t[0]=Math.sqrt(r*r+i*i+n*n),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(l*l+c*c+u*u),t}function wgt(t,e){const r=e[0]+e[5]+e[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),t[3]=.25*i,t[0]=(e[6]-e[9])/i,t[1]=(e[8]-e[2])/i,t[2]=(e[1]-e[4])/i):e[0]>e[5]&&e[0]>e[10]?(i=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/i,t[0]=.25*i,t[1]=(e[1]+e[4])/i,t[2]=(e[8]+e[2])/i):e[5]>e[10]?(i=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/i,t[0]=(e[1]+e[4])/i,t[1]=.25*i,t[2]=(e[6]+e[9])/i):(i=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/i,t[0]=(e[8]+e[2])/i,t[1]=(e[6]+e[9])/i,t[2]=.25*i),t}function xgt(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3],l=n+n,c=s+s,u=o+o,h=n*l,f=n*c,m=n*u,g=s*c,y=s*u,_=o*u,b=a*l,w=a*c,x=a*u,S=i[0],C=i[1],E=i[2];return t[0]=(1-(g+_))*S,t[1]=(f+x)*S,t[2]=(m-w)*S,t[3]=0,t[4]=(f-x)*C,t[5]=(1-(h+_))*C,t[6]=(y+b)*C,t[7]=0,t[8]=(m+w)*E,t[9]=(y-b)*E,t[10]=(1-(h+g))*E,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function Sgt(t,e,r,i,n){const s=e[0],o=e[1],a=e[2],l=e[3],c=s+s,u=o+o,h=a+a,f=s*c,m=s*u,g=s*h,y=o*u,_=o*h,b=a*h,w=l*c,x=l*u,S=l*h,C=i[0],E=i[1],R=i[2],P=n[0],D=n[1],L=n[2],k=(1-(y+b))*C,V=(m+S)*C,W=(g-x)*C,G=(m-S)*E,B=(1-(f+b))*E,Z=(_+w)*E,M=(g+x)*R,$=(_-w)*R,N=(1-(f+y))*R;return t[0]=k,t[1]=V,t[2]=W,t[3]=0,t[4]=G,t[5]=B,t[6]=Z,t[7]=0,t[8]=M,t[9]=$,t[10]=N,t[11]=0,t[12]=r[0]+P-(k*P+G*D+M*L),t[13]=r[1]+D-(V*P+B*D+$*L),t[14]=r[2]+L-(W*P+Z*D+N*L),t[15]=1,t}function Tgt(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,h=i*a,f=n*o,m=n*a,g=n*l,y=s*o,_=s*a,b=s*l;return t[0]=1-h-g,t[1]=u+b,t[2]=f-_,t[3]=0,t[4]=u-b,t[5]=1-c-g,t[6]=m+y,t[7]=0,t[8]=f+_,t[9]=m-y,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function iDe(t,e,r,i,n,s,o){const a=1/(r-e),l=1/(n-i),c=1/(s-o);return t[0]=2*s*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s*l,t[6]=0,t[7]=0,t[8]=(r+e)*a,t[9]=(n+i)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function Egt(t,e,r,i,n){const s=1/Math.tan(e/2);let o;return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,n!=null&&n!==1/0?(o=1/(i-n),t[10]=(n+i)*o,t[14]=2*n*i*o):(t[10]=-1,t[14]=-2*i),t}function Cgt(t,e,r,i){const n=Math.tan(e.upDegrees*Math.PI/180),s=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(n+s);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(o-a)*l*.5,t[9]=(n-s)*c*.5,t[10]=i/(r-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*r/(r-i),t[15]=0,t}function nDe(t,e,r,i,n,s,o){const a=1/(e-r),l=1/(i-n),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+r)*a,t[13]=(n+i)*l,t[14]=(o+s)*c,t[15]=1,t}function M7(t,e,r,i){const n=e[0],s=e[1],o=e[2];let a=n-r[0],l=s-r[1],c=o-r[2];const u=Bl();if(Math.abs(a)<u&&Math.abs(l)<u&&Math.abs(c)<u)return void af(t);let h=1/Math.sqrt(a*a+l*l+c*c);a*=h,l*=h,c*=h;const f=i[0],m=i[1],g=i[2];let y=m*c-g*l,_=g*a-f*c,b=f*l-m*a;h=Math.sqrt(y*y+_*_+b*b),h?(h=1/h,y*=h,_*=h,b*=h):(y=0,_=0,b=0);let w=l*b-c*_,x=c*y-a*b,S=a*_-l*y;h=Math.sqrt(w*w+x*x+S*S),h?(h=1/h,w*=h,x*=h,S*=h):(w=0,x=0,S=0),t[0]=y,t[1]=w,t[2]=a,t[3]=0,t[4]=_,t[5]=x,t[6]=l,t[7]=0,t[8]=b,t[9]=S,t[10]=c,t[11]=0,t[12]=-(y*n+_*s+b*o),t[13]=-(w*n+x*s+S*o),t[14]=-(a*n+l*s+c*o),t[15]=1}function sDe(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=i[0],l=i[1],c=i[2];let u=n-r[0],h=s-r[1],f=o-r[2],m=u*u+h*h+f*f;m>0&&(m=1/Math.sqrt(m),u*=m,h*=m,f*=m);let g=l*f-c*h,y=c*u-a*f,_=a*h-l*u;return m=g*g+y*y+_*_,m>0&&(m=1/Math.sqrt(m),g*=m,y*=m,_*=m),t[0]=g,t[1]=y,t[2]=_,t[3]=0,t[4]=h*_-f*y,t[5]=f*g-u*_,t[6]=u*y-h*g,t[7]=0,t[8]=u,t[9]=h,t[10]=f,t[11]=0,t[12]=n,t[13]=s,t[14]=o,t[15]=1,t}function Rgt(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ogt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2+t[9]**2+t[10]**2+t[11]**2+t[12]**2+t[13]**2+t[14]**2+t[15]**2)}function Agt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function oDe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function Pgt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function Mgt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t[9]=e[9]+r[9]*i,t[10]=e[10]+r[10]*i,t[11]=e[11]+r[11]*i,t[12]=e[12]+r[12]*i,t[13]=e[13]+r[13]*i,t[14]=e[14]+r[14]*i,t[15]=e[15]+r[15]*i,t}function aDe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function iue(t,e){if(t===e)return!0;const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],f=t[10],m=t[11],g=t[12],y=t[13],_=t[14],b=t[15],w=e[0],x=e[1],S=e[2],C=e[3],E=e[4],R=e[5],P=e[6],D=e[7],L=e[8],k=e[9],V=e[10],W=e[11],G=e[12],B=e[13],Z=e[14],M=e[15],$=Bl();return Math.abs(r-w)<=$*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(i-x)<=$*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(n-S)<=$*Math.max(1,Math.abs(n),Math.abs(S))&&Math.abs(s-C)<=$*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(o-E)<=$*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(a-R)<=$*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(l-P)<=$*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(c-D)<=$*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(u-L)<=$*Math.max(1,Math.abs(u),Math.abs(L))&&Math.abs(h-k)<=$*Math.max(1,Math.abs(h),Math.abs(k))&&Math.abs(f-V)<=$*Math.max(1,Math.abs(f),Math.abs(V))&&Math.abs(m-W)<=$*Math.max(1,Math.abs(m),Math.abs(W))&&Math.abs(g-G)<=$*Math.max(1,Math.abs(g),Math.abs(G))&&Math.abs(y-B)<=$*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(_-Z)<=$*Math.max(1,Math.abs(_),Math.abs(Z))&&Math.abs(b-M)<=$*Math.max(1,Math.abs(b),Math.abs(M))}function nue(t){const e=Bl(),r=t[0],i=t[1],n=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}function $7(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[8]===0&&t[9]===0&&t[10]===1}const $gt=Ii,Igt=oDe;Object.freeze(Object.defineProperty({__proto__:null,add:Agt,adjoint:mgt,copy:Rs,determinant:ggt,equals:iue,exactEquals:aDe,frob:Ogt,fromQuat:Tgt,fromQuat2:_gt,fromRotation:Ch,fromRotationTranslation:tDe,fromRotationTranslationScale:xgt,fromRotationTranslationScaleOrigin:Sgt,fromScaling:ygt,fromTranslation:eF,fromXRotation:QLe,fromYRotation:vgt,fromZRotation:eDe,frustum:iDe,getRotation:wgt,getScaling:rDe,getTranslation:tee,hasIdentityRotation:$7,identity:af,invert:Uo,invertOrIdentity:A3,isOrthoNormal:nue,lookAt:M7,mul:$gt,multiply:Ii,multiplyScalar:Pgt,multiplyScalarAndAdd:Mgt,ortho:nDe,perspective:Egt,perspectiveFromFieldOfView:Cgt,rotate:sd,rotateX:_P,rotateY:P7,rotateZ:bP,scale:A7,set:S0,str:Rgt,sub:Igt,subtract:oDe,targetTo:sDe,translate:hu,transpose:Td},Symbol.toStringTag,{value:"Module"}));let iX,ne=null;function lDe(){return!!ne}function Lgt(){return!!he("esri-wasm")}function cDe(){return iX||(iX=le(()=>import("./pe-wasm-2c2e08ba.js"),[]).then(t=>t.p).then(({default:t})=>t({locateFile:e=>fi(`esri/geometry/support/${e}`)})).then(t=>{dDe(t)}),iX)}var ree,gs,iee;(function(t){function e(s,o,a){ne.ensureCache.prepare();const l=DT(a),c=a===l,u=ne.ensureFloat64(l),h=ne._pe_geog_to_proj(ne.getPointer(s),o,u);return h&&Zb(a,o,u,c),h}function r(s,o,a,l){switch(l){case gs.PE_TRANSFORM_P_TO_G:return i(s,o,a);case gs.PE_TRANSFORM_G_TO_P:return e(s,o,a)}return 0}function i(s,o,a){return n(s,o,a,0)}function n(s,o,a,l){ne.ensureCache.prepare();const c=DT(a),u=a===c,h=ne.ensureFloat64(c),f=ne._pe_proj_to_geog_center(ne.getPointer(s),o,h,l);return f&&Zb(a,o,h,u),f}t.geogToProj=e,t.projGeog=r,t.projToGeog=i,t.projToGeogCenter=n})(ree||(ree={})),function(t){function e(){t.PE_BUFFER_MAX=ne.PeDefs.prototype.PE_BUFFER_MAX,t.PE_NAME_MAX=ne.PeDefs.prototype.PE_NAME_MAX,t.PE_MGRS_MAX=ne.PeDefs.prototype.PE_MGRS_MAX,t.PE_USNG_MAX=ne.PeDefs.prototype.PE_USNG_MAX,t.PE_DD_MAX=ne.PeDefs.prototype.PE_DD_MAX,t.PE_DDM_MAX=ne.PeDefs.prototype.PE_DDM_MAX,t.PE_DMS_MAX=ne.PeDefs.prototype.PE_DMS_MAX,t.PE_UTM_MAX=ne.PeDefs.prototype.PE_UTM_MAX,t.PE_PARM_MAX=ne.PeDefs.prototype.PE_PARM_MAX,t.PE_TYPE_NONE=ne.PeDefs.prototype.PE_TYPE_NONE,t.PE_TYPE_GEOGCS=ne.PeDefs.prototype.PE_TYPE_GEOGCS,t.PE_TYPE_PROJCS=ne.PeDefs.prototype.PE_TYPE_PROJCS,t.PE_TYPE_GEOGTRAN=ne.PeDefs.prototype.PE_TYPE_GEOGTRAN,t.PE_TYPE_COORDSYS=ne.PeDefs.prototype.PE_TYPE_COORDSYS,t.PE_TYPE_UNIT=ne.PeDefs.prototype.PE_TYPE_UNIT,t.PE_TYPE_LINUNIT=ne.PeDefs.prototype.PE_TYPE_LINUNIT,t.PE_STR_OPTS_NONE=ne.PeDefs.prototype.PE_STR_OPTS_NONE,t.PE_STR_AUTH_NONE=ne.PeDefs.prototype.PE_STR_AUTH_NONE,t.PE_STR_AUTH_TOP=ne.PeDefs.prototype.PE_STR_AUTH_TOP,t.PE_STR_NAME_CANON=ne.PeDefs.prototype.PE_STR_NAME_CANON,t.PE_PARM_X0=ne.PeDefs.prototype.PE_PARM_X0,t.PE_PARM_ND=ne.PeDefs.prototype.PE_PARM_ND,t.PE_TRANSFORM_1_TO_2=ne.PeDefs.prototype.PE_TRANSFORM_1_TO_2,t.PE_TRANSFORM_2_TO_1=ne.PeDefs.prototype.PE_TRANSFORM_2_TO_1,t.PE_TRANSFORM_P_TO_G=ne.PeDefs.prototype.PE_TRANSFORM_P_TO_G,t.PE_TRANSFORM_G_TO_P=ne.PeDefs.prototype.PE_TRANSFORM_G_TO_P,t.PE_HORIZON_RECT=ne.PeDefs.prototype.PE_HORIZON_RECT,t.PE_HORIZON_POLY=ne.PeDefs.prototype.PE_HORIZON_POLY,t.PE_HORIZON_LINE=ne.PeDefs.prototype.PE_HORIZON_LINE,t.PE_HORIZON_DELTA=ne.PeDefs.prototype.PE_HORIZON_DELTA}t.init=e}(gs||(gs={})),function(t){const e={},r={},i=m=>{if(m){const g=m.getType();switch(g){case gs.PE_TYPE_GEOGCS:m=ne.castObject(m,ne.PeGeogcs);break;case gs.PE_TYPE_PROJCS:m=ne.castObject(m,ne.PeProjcs);break;case gs.PE_TYPE_GEOGTRAN:m=ne.castObject(m,ne.PeGeogtran);break;default:g&gs.PE_TYPE_UNIT&&(m=ne.castObject(m,ne.PeUnit))}}return m};function n(){ne.PeFactory.prototype.initialize(null)}function s(m){return o(gs.PE_TYPE_COORDSYS,m)}function o(m,g){let y=null,_=e[m];if(_||(_={},e[m]=_),_.hasOwnProperty(String(g)))y=_[g];else{const b=ne.PeFactory.prototype.factoryByType(m,g);ne.compare(b,ne.NULL)||(y=b,_[g]=y)}return y=i(y),y}function a(m,g){let y=null,_=r[m];if(_||(_={},r[m]=_),_.hasOwnProperty(g))y=_[g];else{const b=ne.PeFactory.prototype.fromString(m,g);ne.compare(b,ne.NULL)||(y=b,_[g]=y)}return y=i(y),y}function l(m){return o(gs.PE_TYPE_GEOGCS,m)}function c(m){return o(gs.PE_TYPE_GEOGTRAN,m)}function u(m){return ne.PeFactory.prototype.getCode(m)}function h(m){return o(gs.PE_TYPE_PROJCS,m)}function f(m){return o(gs.PE_TYPE_UNIT,m)}t.initialize=n,t.coordsys=s,t.factoryByType=o,t.fromString=a,t.geogcs=l,t.geogtran=c,t.getCode=u,t.projcs=h,t.unit=f}(iee||(iee={}));let uDe=null;var VV,nee,see,oee,BV,aee,jV,GV,lee;function dDe(t){function e(s,o,a){s[o]=a(s[o])}ne=t,gs.init(),VV.init(),BV.init(),jV.init(),GV.init(),uDe=class extends ne.PeGCSExtent{destroy(){ne.destroy(this)}};const r=[ne.PeDatum,ne.PeGeogcs,ne.PeGeogtran,ne.PeObject,ne.PeParameter,ne.PePrimem,ne.PeProjcs,ne.PeSpheroid,ne.PeUnit];for(const s of r)e(s.prototype,"getName",o=>function(){return o.call(this,new Array(gs.PE_NAME_MAX))});for(const s of[ne.PeGeogtran,ne.PeProjcs])e(s.prototype,"getParameters",o=>function(){const a=new Array(gs.PE_PARM_MAX);let l=o.call(this);for(let c=0;c<a.length;c++){const u=ne.getValue(l,"*");a[c]=u?ne.wrapPointer(u,ne.PeParameter):null,l+=Int32Array.BYTES_PER_ELEMENT}return a});e(ne.PeHorizon.prototype,"getCoord",s=>function(){const o=this.getSize();if(!o)return null;const a=[];return Zb(a,o,s.call(this)),a}),e(ne.PeGTlistExtendedEntry.prototype,"getEntries",s=>{const o=ne._pe_getPeGTlistExtendedGTsSize();return function(){let a=null;const l=s.call(this);if(!ne.compare(l,ne.NULL)){a=[l];const c=this.getSteps();if(c>1){const u=ne.getPointer(l);for(let h=1;h<c;h++)a.push(ne.wrapPointer(u+o*h,ne.PeGTlistExtendedGTs))}}return a}});const i=ne._pe_getPeHorizonSize(),n=s=>function(){let o=this._cache;if(o||(o=new Map,this._cache=o),o.has(s))return o.get(s);let a=null;const l=s.call(this);if(!ne.compare(l,ne.NULL)){a=[l];const c=l.getNump();if(c>1){const u=ne.getPointer(l);for(let h=1;h<c;h++)a.push(ne.wrapPointer(u+i*h,ne.PeHorizon))}}return o.set(s,a),a};e(ne.PeProjcs.prototype,"horizonGcsGenerate",n),e(ne.PeProjcs.prototype,"horizonPcsGenerate",n),ne.PeObject.prototype.toString=function(s=gs.PE_STR_OPTS_NONE){ne.ensureCache.prepare();const o=ne.getPointer(this),a=ne.ensureInt8(new Array(gs.PE_BUFFER_MAX));return ne.UTF8ToString(ne._pe_object_to_string_ext(o,s,a))}}function I0(t){if(!t)return;const e=ne.getClass(t);if(!e)return;const r=ne.getCache(e);if(!r)return;const i=ne.getPointer(t);i&&delete r[i]}function G5(t,e){const r=[],i=new Array(e);for(let n=0;n<t;n++)r.push(ne.ensureInt8(i));return r}function DT(t){let e;return Array.isArray(t[0])?(e=[],t.forEach(r=>{e.push(r[0],r[1])})):e=t,e}function Zb(t,e,r,i=!1){if(i)for(let n=0;n<2*e;n++)t[n]=ne.getValue(r+n*Float64Array.BYTES_PER_ELEMENT,"double");else{const n=t.length===0;for(let s=0;s<e;s++)n&&(t[s]=new Array(2)),t[s][0]=ne.getValue(r,"double"),t[s][1]=ne.getValue(r+Float64Array.BYTES_PER_ELEMENT,"double"),r+=2*Float64Array.BYTES_PER_ELEMENT}}(function(t){let e;function r(){t.PE_GTLIST_OPTS_COMMON=ne.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON,e=ne._pe_getPeGTlistExtendedEntrySize()}function i(n,s,o,a,l,c){let u=null;const h=new ne.PeInteger(c);try{const f=ne.PeGTlistExtended.prototype.getGTlist(n,s,o,a,l,h);if((c=h.val)&&(u=[f],c>1)){const m=ne.getPointer(f);for(let g=1;g<c;g++)u.push(ne.wrapPointer(m+e*g,ne.PeGTlistExtendedEntry))}}finally{ne.destroy(h)}return u}t.init=r,t.getGTlist=i})(VV||(VV={})),function(t){function e(r){if(r&&r.length){for(const i of r)I0(i),i.getEntries().forEach(n=>{I0(n);const s=n.getGeogtran();I0(s),s.getParameters().forEach(I0),[s.getGeogcs1(),s.getGeogcs2()].forEach(o=>{I0(o);const a=o.getDatum();I0(a),I0(a.getSpheroid()),I0(o.getPrimem()),I0(o.getUnit())})});ne.PeGTlistExtendedEntry.prototype.Delete(r[0])}}t.destroy=e}(nee||(nee={})),function(t){function e(r,i,n,s,o){ne.ensureCache.prepare();const a=DT(n),l=n===a,c=ne.ensureFloat64(a);let u=0;s&&(u=ne.ensureFloat64(s));const h=ne._pe_geog_to_geog(ne.getPointer(r),i,c,u,o);return h&&Zb(n,i,c,l),h}t.geogToGeog=e}(see||(see={})),function(t){const e=(c,u,h,f,m,g)=>{let y,_;switch(ne.ensureCache.prepare(),c){case"dd":y=ne._pe_geog_to_dd,_=gs.PE_DD_MAX;break;case"ddm":y=ne._pe_geog_to_ddm,_=gs.PE_DDM_MAX;break;case"dms":y=ne._pe_geog_to_dms,_=gs.PE_DMS_MAX}let b=0;u&&(b=ne.getPointer(u));const w=DT(f),x=ne.ensureFloat64(w),S=G5(h,_),C=y(b,h,x,m,ne.ensureInt32(S));if(C)for(let E=0;E<h;E++)g[E]=ne.UTF8ToString(S[E]);return C},r=(c,u,h,f,m)=>{let g;switch(ne.ensureCache.prepare(),c){case"dd":g=ne._pe_dd_to_geog;break;case"ddm":g=ne._pe_ddm_to_geog;break;case"dms":g=ne._pe_dms_to_geog}let y=0;u&&(y=ne.getPointer(u));const _=f.map(S=>ne.ensureString(S)),b=ne.ensureInt32(_),w=ne.ensureFloat64(new Array(2*h)),x=g(y,h,b,w);return x&&Zb(m,h,w),x};function i(c,u,h,f,m){return e("dms",c,u,h,f,m)}function n(c,u,h,f){return r("dms",c,u,h,f)}function s(c,u,h,f,m){return e("ddm",c,u,h,f,m)}function o(c,u,h,f){return r("ddm",c,u,h,f)}function a(c,u,h,f,m){return e("dd",c,u,h,f,m)}function l(c,u,h,f){return r("dd",c,u,h,f)}t.geogToDms=i,t.dmsToGeog=n,t.geogToDdm=s,t.ddmToGeog=o,t.geogToDd=a,t.ddToGeog=l}(oee||(oee={})),function(t){function e(){t.PE_MGRS_STYLE_NEW=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW,t.PE_MGRS_STYLE_OLD=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD,t.PE_MGRS_STYLE_AUTO=ne.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO,t.PE_MGRS_180_ZONE_1_PLUS=ne.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS,t.PE_MGRS_ADD_SPACES=ne.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES}function r(n,s,o,a,l,c,u){ne.ensureCache.prepare();let h=0;n&&(h=ne.getPointer(n));const f=DT(o),m=ne.ensureFloat64(f),g=G5(s,gs.PE_MGRS_MAX),y=ne.ensureInt32(g),_=ne._pe_geog_to_mgrs_extended(h,s,m,a,l,c,y);if(_)for(let b=0;b<s;b++)u[b]=ne.UTF8ToString(g[b]);return _}function i(n,s,o,a,l){ne.ensureCache.prepare();let c=0;n&&(c=ne.getPointer(n));const u=o.map(g=>ne.ensureString(g)),h=ne.ensureInt32(u),f=ne.ensureFloat64(new Array(2*s)),m=ne._pe_mgrs_to_geog_extended(c,s,h,a,f);return m&&Zb(l,s,f),m}t.init=e,t.geogToMgrsExtended=r,t.mgrsToGeogExtended=i}(BV||(BV={})),function(t){function e(i,n,s,o,a,l,c){ne.ensureCache.prepare();let u=0;i&&(u=ne.getPointer(i));const h=DT(s),f=ne.ensureFloat64(h),m=G5(n,gs.PE_MGRS_MAX),g=ne.ensureInt32(m),y=ne._pe_geog_to_usng(u,n,f,o,a,l,g);if(y)for(let _=0;_<n;_++)c[_]=ne.UTF8ToString(m[_]);return y}function r(i,n,s,o){ne.ensureCache.prepare();let a=0;i&&(a=ne.getPointer(i));const l=s.map(f=>ne.ensureString(f)),c=ne.ensureInt32(l),u=ne.ensureFloat64(new Array(2*n)),h=ne._pe_usng_to_geog(a,n,c,u);return h&&Zb(o,n,u),h}t.geogToUsng=e,t.usngToGeog=r}(aee||(aee={})),function(t){function e(){t.PE_UTM_OPTS_NONE=ne.PeNotationUtm.prototype.PE_UTM_OPTS_NONE,t.PE_UTM_OPTS_ADD_SPACES=ne.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES,t.PE_UTM_OPTS_NS=ne.PeNotationUtm.prototype.PE_UTM_OPTS_NS}function r(n,s,o,a,l){ne.ensureCache.prepare();let c=0;n&&(c=ne.getPointer(n));const u=DT(o),h=ne.ensureFloat64(u),f=G5(s,gs.PE_UTM_MAX),m=ne.ensureInt32(f),g=ne._pe_geog_to_utm(c,s,h,a,m);if(g)for(let y=0;y<s;y++)l[y]=ne.UTF8ToString(f[y]);return g}function i(n,s,o,a,l){ne.ensureCache.prepare();let c=0;n&&(c=ne.getPointer(n));const u=o.map(g=>ne.ensureString(g)),h=ne.ensureInt32(u),f=ne.ensureFloat64(new Array(2*s)),m=ne._pe_utm_to_geog(c,s,h,a,f);return m&&Zb(l,s,f),m}t.init=e,t.geogToUtm=r,t.utmToGeog=i}(jV||(jV={})),function(t){const e=new Map;function r(){t.PE_PCSINFO_OPTION_NONE=ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE,t.PE_PCSINFO_OPTION_DOMAIN=ne.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN,t.PE_POLE_OUTSIDE_BOUNDARY=ne.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY,t.PE_POLE_POINT=ne.PePCSInfo.prototype.PE_POLE_POINT}function i(n,s=t.PE_PCSINFO_OPTION_DOMAIN){let o=null,a=null;return e.has(n)&&(a=e.get(n),a[s]&&(o=a[s])),o||(o=ne.PePCSInfo.prototype.generate(n,s),a||(a=[],e.set(n,a)),a[s]=o),o}t.init=r,t.generate=i}(GV||(GV={})),function(t){function e(){return ne.PeVersion.prototype.version_string()}t.versionString=e}(lee||(lee={}));const Dgt=Object.freeze(Object.defineProperty({__proto__:null,get PeCSTransformations(){return ree},get PeDefs(){return gs},get PeFactory(){return iee},get PeGCSExtent(){return uDe},get PeGTTransformations(){return see},get PeGTlistExtended(){return VV},get PeGTlistExtendedEntry(){return nee},get PeNotationDms(){return oee},get PeNotationMgrs(){return BV},get PeNotationUsng(){return aee},get PeNotationUtm(){return jV},get PePCSInfo(){return GV},get PeVersion(){return lee},_init:dDe,get _pe(){return ne},isLoaded:lDe,isSupported:Lgt,load:cDe},Symbol.toStringTag,{value:"Module"})),Wu=Math.PI/180,Ngt=/SPHEROID\[([^\]]+)]/i,b1=Rr.radius,Of=Rr.eccentricitySquared,Fgt={a1:b1*Of,a2:b1*Of*b1*Of,a3:b1*Of*Of/2,a4:b1*Of*b1*Of*2.5,a5:b1*Of+b1*Of*Of/2,a6:1-Of},kgt={4267:{a:63782064e-1,f:1/294.9786982},4269:{a:6378137,f:1/298.257222101},4326:{a:Rr.radius,f:Rr.flattening},104900:{a:2439700,f:0},104901:{a:6051e3,f:0},104902:{a:6051800,f:0},104903:{a:O_.radius,f:O_.flattening},104904:{a:3393400,f:1/192.0430107526882},104905:{a:Hy.radius,f:Hy.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492e3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1e4,f:0},104912:{a:2409300,f:0},104913:{a:15e3,f:0},104914:{a:4e4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85e3,f:0},104918:{a:1821460,f:0},104919:{a:5e3,f:0},104920:{a:12e3,f:0},104921:{a:3e4,f:3},104922:{a:18e3,f:0},104923:{a:14e3,f:0},104924:{a:49300,f:0},104925:{a:60268e3,f:1/10.2079945799458},104926:{a:16e3,f:0},104927:{a:9500,f:0},104928:{a:56e4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16e3,f:0},104932:{a:133e3,f:0},104933:{a:718e3,f:0},104934:{a:888e3,f:0},104935:{a:1986300,f:0},104936:{a:1e4,f:0},104937:{a:41900,f:0},104938:{a:11e4,f:0},104939:{a:50100,f:0},104940:{a:764e3,f:0},104941:{a:11e3,f:0},104942:{a:529800,f:0},104943:{a:2575e3,f:0},104944:{a:25559e3,f:1/43.61604095563141},104945:{a:578900,f:0},104946:{a:33e3,f:0},104947:{a:21e3,f:0},104948:{a:13e3,f:0},104949:{a:31e3,f:0},104950:{a:27e3,f:0},104951:{a:42e3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15e3,f:0},104955:{a:54e3,f:0},104956:{a:77e3,f:0},104957:{a:27e3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764e3,f:.01708124697141011},104961:{a:74e3,f:0},104962:{a:79e3,f:0},104963:{a:104e3,f:.14423076923076922},104964:{a:29e3,f:0},104965:{a:17e4,f:0},104966:{a:208e3,f:0},104967:{a:4e4,f:0},104968:{a:1352600,f:0},104969:{a:1195e3,f:0},104970:{a:593e3,f:0},104971:{a:Hy.radius,f:0},104972:{a:47e4,f:0},104973:{a:255e3,f:0},104974:{a:2439400,f:0}};let H5=0,nX=class cee{static fromGE(e){const r=new cee;return r._wkt=e.wkt,r._wkid=e.wkid,r._isInverse=e.isInverse,r}constructor(e){this.uid=H5++,e?(this._wkt=e.wkt!=null?e.wkt:null,this._wkid=e.wkid!=null?e.wkid:-1,this._isInverse=e.isInverse!=null&&e.isInverse===!0):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}get wkt(){return this._wkt}set wkt(e){this._wkt=e,this.uid=H5++}get wkid(){return this._wkid}set wkid(e){this._wkid=e,this.uid=H5++}get isInverse(){return this._isInverse}set isInverse(e){this._isInverse=e,this.uid=H5++}getInverse(){const e=new cee;return e._wkt=this.wkt,e._wkid=this._wkid,e._isInverse=!this.isInverse,e}},HV=class tI{static cacheKey(e,r){return[e.wkid!==void 0&&e.wkid!==null?e.wkid.toString():"-1",e.wkt!==void 0&&e.wkt!==null?e.wkt.toString():"",r.wkid!==void 0&&r.wkid!==null?r.wkid.toString():"-1",r.wkt!==void 0&&r.wkt!==null?r.wkt.toString():""].join(",")}static fromGE(e){const r=new tI;let i="";for(const n of e.steps){const s=nX.fromGE(n);r.steps.push(s),i+=s.uid.toString()+","}return r._cachedProjection={},r._gtlistentry=null,r._chain=i,r}constructor(e){if(this.steps=[],this._cachedProjection={},this._chain="",this._gtlistentry=null,e&&e.steps)for(const r of e.steps)r instanceof nX?this.steps.push(r):this.steps.push(new nX({wkid:r.wkid,wkt:r.wkt,isInverse:r.isInverse}))}getInverse(){const e=new tI;e.steps=[];for(let r=this.steps.length-1;r>=0;r--){const i=this.steps[r];e.steps.push(i.getInverse())}return e}getGTListEntry(){let e="";for(const r of this.steps)e+=r.uid.toString()+",";return e!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=e),this._gtlistentry}assignCachedGe(e,r,i){this._cachedProjection[tI.cacheKey(e,r)]=i}getCachedGeTransformation(e,r){let i="";for(const s of this.steps)i+=s.uid.toString()+",";i!==this._chain&&(this._gtlistentry=null,this._cachedProjection={},this._chain=i);const n=this._cachedProjection[tI.cacheKey(e,r)];return n===void 0?null:n}};function hDe(t,e,r){if(e==null||r==null||r.vcsWkid||So(e,r))return null;const i=SN(e)/SN(r);if(i===1)return null;switch(t){case"point":case"esriGeometryPoint":return n=>Ugt(n,i);case"polyline":case"esriGeometryPolyline":return n=>Vgt(n,i);case"polygon":case"esriGeometryPolygon":return n=>zgt(n,i);case"multipoint":case"esriGeometryMultipoint":return n=>Bgt(n,i);case"extent":case"esriGeometryEnvelope":return n=>jgt(n,i);default:return null}}function Ugt(t,e){t&&t.z!=null&&(t.z*=e)}function zgt(t,e){if(t)for(const r of t.rings)for(const i of r)i.length>2&&(i[2]*=e)}function Vgt(t,e){if(t)for(const r of t.paths)for(const i of r)i.length>2&&(i[2]*=e)}function Bgt(t,e){if(t)for(const r of t.points)r.length>2&&(r[2]*=e)}function jgt(t,e){t&&t.zmin!=null&&t.zmax!=null&&(t.zmin*=e,t.zmax*=e)}let Zm=null,Jw=null,iD=null,A8={};const pDe=new _7;function tF(){return!!Zm&&lDe()}function wP(t){return iD==null&&(iD=Promise.all([cDe(),le(()=>import("./geometryEngineBase-3a3551e4.js"),[]).then(e=>e.g),le(()=>import("./hydrated-7c582448.js"),[])])),iD.then(([,e,{hydratedAdapter:r}])=>{vr(t),Jw=r,Zm=e.default,Zm._enableProjection(Dgt),pDe.notify()})}function o0(t,e,r=null,i=null){return Array.isArray(t)?t.length===0?[]:uee(Jw,t,t[0].spatialReference,e,r,i):uee(Jw,[t],t.spatialReference,e,r,i)[0]}function uee(t,e,r,i,n=null,s=null){if(r==null||i==null)return e;if(lf(r,i,n))return e.map(o=>oue(o,r,i));if(n==null){const o=HV.cacheKey(r,i);A8[o]!==void 0?n=A8[o]:((n=mDe(r,i,void 0))==null&&(n=new HV),A8[o]=n)}if(Zm==null||t==null)throw new I7;return s!=null?Zm._project(t,e,r,i,n,s):Zm._project(t,e,r,i,n)}function Ggt(t,e){const r=fDe([t],e);return r.pending!=null?{pending:r.pending,geometry:null}:r.geometries!=null?{pending:null,geometry:r.geometries[0]}:{pending:null,geometry:null}}function fDe(t,e){if(!tF()){for(const r of t)if(r!=null&&!So(r.spatialReference,e)&&$l(r.spatialReference)&&$l(e)&&!lf(r.spatialReference,e))return br(pDe),{pending:wP(),geometries:null}}return{pending:null,geometries:t.map(r=>r==null?null:So(r.spatialReference,e)?r:$l(r.spatialReference)&&$l(e)?gDe(r,e):null)}}function mDe(t,e,r=null){if(t==null||e==null)return null;if(Zm==null||Jw==null)throw new I7;const i=Zm._getTransformation(Jw,t,e,r,r==null?void 0:r.spatialReference);return i!==null?HV.fromGE(i):null}function Hgt(t,e,r=null){if(Zm==null||Jw==null)throw new I7;const i=Zm._getTransformationBySuitability(Jw,t,e,r,r==null?void 0:r.spatialReference);if(i!==null){const n=[];for(const s of i)n.push(HV.fromGE(s));return n}return[]}class I7 extends H{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}var ee;function qgt(){Zm=null,Jw=null,iD=null,A8={}}(function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SPHERICAL_ECEF=1]="SPHERICAL_ECEF",t[t.WGS84=2]="WGS84",t[t.WEB_MERCATOR=3]="WEB_MERCATOR",t[t.WGS84_ECEF=4]="WGS84_ECEF",t[t.CGCS2000=5]="CGCS2000",t[t.WGS84_COMPARABLE_LON_LAT=6]="WGS84_COMPARABLE_LON_LAT",t[t.SPHERICAL_MARS_PCPF=7]="SPHERICAL_MARS_PCPF",t[t.GCSMARS2000=8]="GCSMARS2000",t[t.SPHERICAL_MOON_PCPF=9]="SPHERICAL_MOON_PCPF",t[t.GCSMOON2000=10]="GCSMOON2000",t[t.LON_LAT=11]="LON_LAT",t[t.PLATE_CARREE=12]="PLATE_CARREE"})(ee||(ee={}));const Wgt={get loadPromise(){return iD}};function gDe(t,e){try{const r=o0(t,e);if(r==null)return null;"xmin"in t&&"xmin"in r&&(r.zmin=t.zmin,r.zmax=t.zmax);const i=hDe(r.type,t.spatialReference,e);return i!=null&&i(r),r}catch(r){if(!(r instanceof I7))throw r;return null}}function lf(t,e,r){return!r&&(!!So(t,e)||$l(t)&&$l(e)&&!!uue(t,e,hue))}async function sue(t,e,r,i){if(tF())return C0e(i);if(Array.isArray(t)){for(const{source:n,dest:s,geographicTransformation:o}of t)if(!lf(n,s,o))return wP(i)}else if(!lf(t,e,r))return wP(i);return C0e(i)}function Xgt(t,e){switch(uue(t,e,hue)){case on:return"copy3";case fw:return"wgs84ToSphericalECEF";case iE:return"wgs84ToWebMercator";case pw:return"wgs84ToPlateCarree";case gw:return"wgs84ToWGS84ECEF";case _2:return"webMercatorToWGS84";case ODe:return"webMercatorToSphericalECEF";case ADe:return"webMercatorToWGS84ECEF";case PDe:return"webMercatorToPlateCarree";case yw:return"wgs84ECEFToWGS84";case LDe:return"wgs84ECEFToSphericalECEF";case DDe:return"wgs84ECEFToWebMercator";case mw:return"sphericalECEFToWGS84";case $De:return"sphericalECEFToWebMercator";case mee:return"sphericalMarsPCPFToMars2000";case fee:return"sphericalMoonPCPFToMoon2000";case IDe:return"sphericalECEFToWGS84ECEF";case pee:return"mars2000ToSphericalPCPF";case hee:return"moon2000ToSphericalPCPF";default:return null}}function oue(t,e,r){return t?"x"in t?vDe(t,e,new Gt,r,0):"xmin"in t?SDe(t,e,new $r,r,0):"rings"in t?xDe(t,e,new Tc,r,0):"paths"in t?bDe(t,e,new J4,r,0):"points"in t?_De(t,e,new Y4,r,0):null:null}function yDe(t,e,r=e.spatialReference,i=0){return r!=null&&t.spatialReference!=null&&vDe(t,t.spatialReference,e,r,i)!=null}function vDe(t,e,r,i,n){hi[0]=t.x,hi[1]=t.y;const s=t.z;return hi[2]=s!==void 0?s:n,Ni(hi,e,0,hi,i,0,1)?(r.x=hi[0],r.y=hi[1],r.spatialReference=i,s===void 0?(r.z=void 0,r.hasZ=!1):(r.z=hi[2],r.hasZ=!0),t.m===void 0?(r.m=void 0,r.hasM=!1):(r.m=t.m,r.hasM=!0),r):null}function Ygt(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&_De(t,t.spatialReference,e,r,i)!=null}function _De(t,e,r,i,n){const{points:s,hasZ:o,hasM:a}=t,l=[],c=s.length,u=[];for(const h of s)u.push(h[0],h[1],o?h[2]:n);if(!Ni(u,e,0,u,i,0,c))return null;for(let h=0;h<c;++h){const f=3*h,m=u[f],g=u[f+1];o&&a?l.push([m,g,u[f+2],s[h][3]]):o?l.push([m,g,u[f+2]]):a?l.push([m,g,s[h][2]]):l.push([m,g])}return r.points=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r}function Zgt(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&bDe(t,t.spatialReference,e,r,i)!=null}function bDe(t,e,r,i,n){const{paths:s,hasZ:o,hasM:a}=t,l=[];return CDe(s,o??!1,a??!1,e,l,i,n)?(r.paths=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function Jgt({hasZ:t,spatialReference:e,paths:r},i,n=0){const s=a0(e,P3),o=zp[s][ee.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>se(hi,l[0],l[1],n);for(const l of r){const c=[];for(const u of l){const h=[0,0,n];o(a(u),0,h,0),c.push(h)}i.push(c)}return!0}function Kgt({hasZ:t,spatialReference:e,rings:r},i,n=0){const s=a0(e,P3),o=zp[s][ee.WGS84_COMPARABLE_LON_LAT];if(o==null)return!1;const a=t?l=>l:l=>se(hi,l[0],l[1],n);for(const l of r){const c=[];for(const u of l){const h=[0,0,n];o(a(u),0,h,0),c.push(h)}i.push(c)}return!0}function wDe(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&xDe(t,t.spatialReference,e,r,i)!=null}function xDe(t,e,r,i,n){const{rings:s,hasZ:o,hasM:a}=t,l=[];return CDe(s,o??!1,a??!1,e,l,i,n)?(r.rings=l,r.spatialReference=i,r.hasZ=o,r.hasM=a,r):null}function Qgt(t,e,r=e.spatialReference,i=0){return t.spatialReference!=null&&r!=null&&SDe(t,t.spatialReference,e,r,i)!=null}function SDe(t,e,r,i,n){const{xmin:s,ymin:o,xmax:a,ymax:l,hasZ:c,hasM:u}=t;return dee(s,o,c?t.zmin:n,e,hi,i)?(r.xmin=hi[0],r.ymin=hi[1],c&&(r.zmin=hi[2]),dee(a,l,c?t.zmax:n,e,hi,i)?(r.xmax=hi[0],r.ymax=hi[1],c&&(r.zmax=hi[2]),u&&(r.mmin=t.mmin,r.mmax=t.mmax),r.spatialReference=i,r):null):null}function M_(t,e,r){if(e==null||r==null)return null;const i=new Gt({spatialReference:r});return Ni(t,e,0,hi,r,0,1)?(i.x=hi[0],i.y=hi[1],i.z=hi[2],i):null}function aue(t,e,r){return Ni(t,e,0,hi,r.spatialReference,0,1)?(r.x=hi[0],r.y=hi[1],r.z=hi[2],r):null}function Na(t,e,r,i=0){hi[0]=t.x,hi[1]=t.y;const n=t.z;return hi[2]=n!==void 0?n:i,Ni(hi,t.spatialReference,0,e,r,0,1)}function dee(t,e,r,i,n,s){return Gn[0]=t,Gn[1]=e,Gn[2]=r,Ni(Gn,i,0,n,s,0,1)}function Ys(t,e,r,i){return!(e==null||i==null||t.length<2)&&(t.length===2&&(Gn[0]=t[0],Gn[1]=t[1],Gn[2]=0,t=Gn),Ni(t,e,0,r,i,0,1))}function TDe(t,e){hi[0]=t.x,hi[1]=t.y;const r=t.z;return hi[2]=r!==void 0?r:0,EDe(hi,t.spatialReference,e)}function EDe(t,e,r){return eyt(t,e,r)}function eyt(t,e,r){if(e==null)return!1;const i=a0(e,P3),n=zp[i][ee.WGS84_COMPARABLE_LON_LAT];return n!=null&&(n(t,0,Gn,0),r!==Gn&&(r[0]=Gn[0],r[1]=Gn[1],r.length>2&&(r[2]=Gn[2])),!0)}function Ni(t,e,r,i,n,s,o=1){const a=uue(e,n,hue);if(a==null)return!1;if(a===on){if(t===i&&r===s)return!0;const c=r+3*o;for(let u=r,h=s;u<c;u++,h++)i[h]=t[u];return!0}const l=r+3*o;for(let c=r,u=s;c<l;c+=3,u+=3)a(t,c,i,u);return!0}function tyt(t,e,r,i,n){oe(hi,t),ge(q5,t,e),Ys(hi,r,hi,n),Ys(q5,r,q5,n),ve(i,q5,hi),Se(i,i)}function CDe(t,e,r,i,n,s,o=0){const a=new Array;for(const c of t)for(const u of c)a.push(u[0],u[1],e?u[2]:o);if(!Ni(a,i,0,a,s,0,a.length/3))return!1;let l=0;n.length=0;for(const c of t){const u=new Array;for(const h of c)e&&r?u.push([a[l++],a[l++],a[l++],h[3]]):e?u.push([a[l++],a[l++],a[l++]]):r?(u.push([a[l++],a[l++],h[2]]),l++):(u.push([a[l++],a[l++]]),l++);n.push(u)}return!0}function ryt(t,e,r,i){if(e==null||i==null)return!1;const n=NDe(e,i,uyt);if(n.projector===on)return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],!0;if(n.projector==null)return!1;const{source:s,dest:o}=n;if(o.spatialReferenceId===ee.WEB_MERCATOR){const a=zp[s.spatialReferenceId][ee.WGS84];return a!=null&&(a(t,0,ym,0),iE(ym,0,r,0),r[3]=Eve(ym[1],t[2],t[3],Rr.radius),!0)}if(s.spatialReferenceId!==ee.WGS84&&s.spatialReferenceId!==ee.CGCS2000||o.spatialReferenceId!==ee.PLATE_CARREE){n.projector(t,0,r,0);const a=s.metersPerUnit??1,l=o.metersPerUnit??1;r[3]=t[3]*a/l}else{const a=zp[s.spatialReferenceId][ee.SPHERICAL_ECEF],l=zp[ee.SPHERICAL_ECEF][ee.PLATE_CARREE];let c=t[3];a!=null&&l!=null&&(c=Eve(t[1],t[2],t[3],Rr.radius)),n.projector(t,0,r,0),r[3]=c}return!0}function Eve(t,e,r,i){const n=i+e;if(n<i/2||r>n)return Number.MAX_VALUE;const s=Math.abs(Dm*t)+Math.asin(r/n);return s>=Math.PI/2?Number.MAX_VALUE:r/Math.cos(s)}function rF(t,e,r,i){return t!=null&&(So(e,i)?(A_(r,t),!0):(Gn[0]=t[0],Gn[1]=t[1],Gn[2]=0,!!Ni(Gn,e,0,Gn,i,0,1)&&(r[0]=Gn[0],r[1]=Gn[1],Gn[0]=t[2],Gn[1]=t[3],Gn[2]=0,!!Ni(Gn,e,0,Gn,i,0,1)&&(r[2]=Gn[0],r[3]=Gn[1],!0))))}function iyt(t,e,r,i){if(e==null||i==null)return!1;const n=a0(e,P3),s=a0(i,FDe);if(n===s&&n!==ee.UNKNOWN||So(e,i))return r[0]=1,r[1]=1,r[2]=1,!0;if(n===ee.SPHERICAL_ECEF){const o=We(t),a=o/Math.sqrt(t[0]*t[0]+t[1]*t[1]),l=o/Rr.radius;if(s===ee.WEB_MERCATOR)return r[0]=a*l,r[1]=a*l,r[2]=1,!0;if(s===ee.WGS84||s===ee.CGCS2000){const c=nD;return r[0]=c*a*l,r[1]=c*l,r[2]=1,!0}}else if(n===ee.PLATE_CARREE){if(s===ee.WGS84||s===ee.CGCS2000)return r[0]=nD,r[1]=nD,r[2]=1,!0;if(s===ee.WEB_MERCATOR){const o=t[1]/Rr.radius;return r[0]=1,r[1]=1/Math.cos(o),r[2]=1,!0}}return!1}function lu(t,e,r,i){if(t==null||i==null)return!1;const n=a0(t,P3),s=a0(i,FDe);if(n===s&&!Cve(s)&&(n!==ee.UNKNOWN||So(t,i)))return eF(r,e),!0;if(Cve(s)){const o=zp[n][ee.LON_LAT],a=zp[ee.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,ym,0),a(ym,0,w1,0),lue(Dm*ym[0],Dm*ym[1],r),r[12]=w1[0],r[13]=w1[1],r[14]=w1[2],!0)}if((s===ee.WEB_MERCATOR||s===ee.PLATE_CARREE)&&(n===ee.WGS84||n===ee.CGCS2000&&s===ee.PLATE_CARREE||n===ee.SPHERICAL_ECEF||n===ee.WEB_MERCATOR)){const o=zp[n][ee.LON_LAT],a=zp[ee.LON_LAT][s];return o!=null&&a!=null&&(o(e,0,ym,0),a(ym,0,w1,0),n===ee.SPHERICAL_ECEF?RDe(Dm*ym[0],Dm*ym[1],r):af(r),r[12]=w1[0],r[13]=w1[1],r[14]=w1[2],!0)}return!1}function Cve(t){return t===ee.SPHERICAL_ECEF||t===ee.SPHERICAL_MARS_PCPF||t===ee.SPHERICAL_MOON_PCPF}function lue(t,e,r){const i=Math.sin(t),n=Math.cos(t),s=Math.sin(e),o=Math.cos(e),a=r;return a[0]=-i,a[4]=-s*n,a[8]=o*n,a[12]=0,a[1]=n,a[5]=-s*i,a[9]=o*i,a[13]=0,a[2]=0,a[6]=o,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}function RDe(t,e,r){return lue(t,e,r),Td(r,r),r}function a0(t,e){return t?e.spatialReference===t?e.spatialReferenceId:(e.spatialReference=t,"metersPerUnit"in e&&(e.metersPerUnit=Pc(t,1)),t.wkt===EIe.wkt?e.spatialReferenceId=ee.SPHERICAL_ECEF:bN(t)?e.spatialReferenceId=ee.WGS84:Y2(t)?e.spatialReferenceId=ee.WEB_MERCATOR:wN(t)?e.spatialReferenceId=ee.PLATE_CARREE:t.wkt===CIe.wkt?e.spatialReferenceId=ee.WGS84_ECEF:t.wkid===Dp.CGCS2000?e.spatialReferenceId=ee.CGCS2000:t.wkt===Tce.wkt?e.spatialReferenceId=ee.SPHERICAL_MARS_PCPF:t.wkt===Ece.wkt?e.spatialReferenceId=ee.SPHERICAL_MOON_PCPF:w0(t)?e.spatialReferenceId=ee.GCSMARS2000:x0(t)?e.spatialReferenceId=ee.GCSMOON2000:e.spatialReferenceId=ee.UNKNOWN):ee.UNKNOWN}function on(t,e,r,i){t!==r&&(r[i++]=t[e++],r[i++]=t[e++],r[i]=t[e])}function _2(t,e,r,i){r[i++]=xP*(t[e++]/Rr.radius),r[i++]=xP*(Math.PI/2-2*Math.atan(Math.exp(-t[e++]/Rr.radius))),r[i]=t[e]}function ODe(t,e,r,i){_2(t,e,r,i),fw(r,i,r,i)}function ADe(t,e,r,i){_2(t,e,r,i),gw(r,i,r,i)}function L7(t,e,r,i,n){const s=.4999999*Math.PI,o=Te(Dm*t[e+1],-s,s),a=Math.sin(o);r[i++]=Dm*t[e]*n.radius,r[i++]=n.halfSemiMajorAxis*Math.log((1+a)/(1-a)),r[i]=t[e+2]}function iE(t,e,r,i){L7(t,e,r,i,Rr)}const Rve=Rr.radius*Math.PI/180,nD=180/(Rr.radius*Math.PI);function pw(t,e,r,i){r[i]=t[e]*Rve,r[i+1]=t[e+1]*Rve,r[i+2]=t[e+2]}function n2(t,e,r,i){r[i]=t[e]*nD,r[i+1]=t[e+1]*nD,r[i+2]=t[e+2]}function PDe(t,e,r,i){_2(t,e,r,i),pw(r,i,r,i)}function nyt(t,e,r,i){yw(t,e,r,i),pw(r,i,r,i)}function syt(t,e,r,i){mw(t,e,r,i),pw(r,i,r,i)}function oyt(t,e,r,i){n2(t,e,r,i),fw(r,i,r,i)}function ayt(t,e,r,i){n2(t,e,r,i),iE(r,i,r,i)}function lyt(t,e,r,i){n2(t,e,r,i),gw(r,i,r,i)}function Kw(t){if(t==null)return!1;const e=a0(t,P3);return!!zp[e][ee.WGS84_COMPARABLE_LON_LAT]}function MDe(t,e,r,i){const n=Math.cos(r);t[0]=Math.cos(e)*n*i,t[1]=Math.sin(e)*n*i,t[2]=Math.sin(r)*i}function cue(t,e,r,i,n){const s=n+t[e+2],o=Dm*t[e+1],a=Dm*t[e],l=Math.cos(o);r[i++]=Math.cos(a)*l*s,r[i++]=Math.sin(a)*l*s,r[i]=Math.sin(o)*s}function hee(t,e,r,i){cue(t,e,r,i,O_.radius)}function pee(t,e,r,i){cue(t,e,r,i,Hy.radius)}function fw(t,e,r,i){cue(t,e,r,i,Rr.radius)}function D7(t,e,r,i,n){const s=t[e],o=t[e+1],a=t[e+2],l=Math.sqrt(s*s+o*o+a*a),c=sf(a/(l===0?1:l)),u=Math.atan2(o,s);r[i++]=xP*u,r[i++]=xP*c,r[i]=l-n}function fee(t,e,r,i){D7(t,e,r,i,O_.radius)}function mee(t,e,r,i){D7(t,e,r,i,Hy.radius)}function mw(t,e,r,i){D7(t,e,r,i,Rr.radius)}function $De(t,e,r,i){mw(t,e,r,i),iE(r,i,r,i)}function IDe(t,e,r,i){mw(t,e,r,i),gw(r,i,r,i)}function cyt(t,e,r,i,n){const s=Dm*t[e],o=Dm*t[e+1],a=t[e+2],l=Math.sin(o),c=Math.cos(o),u=n.radius/Math.sqrt(1-n.eccentricitySquared*l*l);r[i++]=(u+a)*c*Math.cos(s),r[i++]=(u+a)*c*Math.sin(s),r[i++]=(u*(1-n.eccentricitySquared)+a)*l}function gw(t,e,r,i){cyt(t,e,r,i,Rr)}function yw(t,e,r,i){const n=Fgt,s=t[e],o=t[e+1],a=t[e+2];let l,c,u,h,f,m,g,y,_,b,w,x,S,C,E,R,P,D,L,k,V;l=Math.abs(a),c=s*s+o*o,u=Math.sqrt(c),h=c+a*a,f=Math.sqrt(h),k=Math.atan2(o,s),m=a*a/h,g=c/h,C=n.a2/f,E=n.a3-n.a4/f,g>.3?(y=l/f*(1+g*(n.a1+C+m*E)/f),L=Math.asin(y),b=y*y,_=Math.sqrt(1-b)):(_=u/f*(1-m*(n.a5-C-g*E)/f),L=Math.acos(_),b=1-_*_,y=Math.sqrt(b)),w=1-Rr.eccentricitySquared*b,x=Rr.radius/Math.sqrt(w),S=n.a6*x,C=u-x*_,E=l-S*y,P=_*C+y*E,R=_*E-y*C,D=R/(S/w+P),L+=D,V=P+R*D/2,a<0&&(L=-L),r[i++]=xP*k,r[i++]=xP*L,r[i]=V}function LDe(t,e,r,i){yw(t,e,r,i),fw(r,i,r,i)}function DDe(t,e,r,i){yw(t,e,r,i),iE(r,i,r,i)}const zp={[ee.WGS84]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:on,[ee.WGS84_COMPARABLE_LON_LAT]:on,[ee.SPHERICAL_ECEF]:fw,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:iE,[ee.PLATE_CARREE]:pw,[ee.WGS84]:on,[ee.WGS84_ECEF]:gw},[ee.CGCS2000]:{[ee.CGCS2000]:on,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:on,[ee.WGS84_COMPARABLE_LON_LAT]:on,[ee.SPHERICAL_ECEF]:fw,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:pw,[ee.WGS84]:null,[ee.WGS84_ECEF]:gw},[ee.GCSMARS2000]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:on,[ee.GCSMOON2000]:null,[ee.LON_LAT]:on,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:pee,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.GCSMOON2000]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:on,[ee.LON_LAT]:on,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:hee,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.WEB_MERCATOR]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:_2,[ee.WGS84_COMPARABLE_LON_LAT]:_2,[ee.SPHERICAL_ECEF]:ODe,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:on,[ee.PLATE_CARREE]:PDe,[ee.WGS84]:_2,[ee.WGS84_ECEF]:ADe},[ee.WGS84_ECEF]:{[ee.CGCS2000]:yw,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:yw,[ee.WGS84_COMPARABLE_LON_LAT]:yw,[ee.SPHERICAL_ECEF]:LDe,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:DDe,[ee.PLATE_CARREE]:nyt,[ee.WGS84]:yw,[ee.WGS84_ECEF]:on},[ee.SPHERICAL_ECEF]:{[ee.CGCS2000]:mw,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:mw,[ee.WGS84_COMPARABLE_LON_LAT]:mw,[ee.SPHERICAL_ECEF]:on,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:$De,[ee.PLATE_CARREE]:syt,[ee.WGS84]:mw,[ee.WGS84_ECEF]:IDe},[ee.SPHERICAL_MARS_PCPF]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:mee,[ee.GCSMOON2000]:null,[ee.LON_LAT]:mee,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:on,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.SPHERICAL_MOON_PCPF]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:fee,[ee.LON_LAT]:fee,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:on,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.UNKNOWN]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:null,[ee.WGS84_COMPARABLE_LON_LAT]:null,[ee.SPHERICAL_ECEF]:null,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:on,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:null,[ee.WGS84]:null,[ee.WGS84_ECEF]:null},[ee.LON_LAT]:{[ee.CGCS2000]:on,[ee.GCSMARS2000]:on,[ee.GCSMOON2000]:on,[ee.LON_LAT]:on,[ee.WGS84_COMPARABLE_LON_LAT]:on,[ee.SPHERICAL_ECEF]:fw,[ee.SPHERICAL_MARS_PCPF]:pee,[ee.SPHERICAL_MOON_PCPF]:hee,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:iE,[ee.PLATE_CARREE]:pw,[ee.WGS84]:on,[ee.WGS84_ECEF]:gw},[ee.WGS84_COMPARABLE_LON_LAT]:{[ee.CGCS2000]:null,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:on,[ee.WGS84_COMPARABLE_LON_LAT]:on,[ee.SPHERICAL_ECEF]:fw,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:null,[ee.PLATE_CARREE]:pw,[ee.WGS84]:on,[ee.WGS84_ECEF]:gw},[ee.PLATE_CARREE]:{[ee.CGCS2000]:n2,[ee.GCSMARS2000]:null,[ee.GCSMOON2000]:null,[ee.LON_LAT]:n2,[ee.WGS84_COMPARABLE_LON_LAT]:n2,[ee.SPHERICAL_ECEF]:oyt,[ee.SPHERICAL_MARS_PCPF]:null,[ee.SPHERICAL_MOON_PCPF]:null,[ee.UNKNOWN]:null,[ee.WEB_MERCATOR]:ayt,[ee.PLATE_CARREE]:on,[ee.WGS84]:n2,[ee.WGS84_ECEF]:lyt}};function uue(t,e,r=due()){return t==null||e==null?null:NDe(t,e,r).projector}function NDe(t,e,r){if(t==null||e==null||r.source.spatialReference===t&&r.dest.spatialReference===e)return r;const i=a0(t,r.source),n=a0(e,r.dest);return i===ee.UNKNOWN&&n===ee.UNKNOWN?So(t,e)?r.projector=on:r.projector=null:r.projector=zp[i][n],r}function due(){return{source:{spatialReference:null,spatialReferenceId:ee.UNKNOWN,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:ee.UNKNOWN,metersPerUnit:1},projector:on}}const P3={spatialReference:null,spatialReferenceId:ee.UNKNOWN},FDe={spatialReference:null,spatialReferenceId:ee.UNKNOWN},hue=due(),uyt=due(),Dm=sr(1),xP=Oc(1),Gn=A(),ym=A(),w1=A(),hi=A(),q5=A(),spr=Object.freeze(Object.defineProperty({__proto__:null,canProjectToWGS84ComparableLonLat:Kw,canProjectWithoutEngine:lf,computeENUToSphericalPCPFLocalRotation:lue,computeSphericalPCPFToENULocalRotation:RDe,computeTranslationToOriginAndRotation:lu,getProjectorName:Xgt,getTransformation:mDe,getTransformations:Hgt,initializeProjection:sue,isLoaded:tF,load:wP,localLinearScaleFactors:iyt,lonLatToSphericalPCPF:MDe,lonLatToWebMercatorComparable:L7,project:o0,projectBoundingRect:rF,projectBoundingSphere:ryt,projectBuffer:Ni,projectDirection:tyt,projectExtent:Qgt,projectMany:uee,projectMultipoint:Ygt,projectOrLoad:Ggt,projectOrLoadMany:fDe,projectPoint:yDe,projectPointToVector:Na,projectPointToWGS84ComparableLonLat:TDe,projectPolygon:wDe,projectPolygonToWGS84ComparableLonLat:Kgt,projectPolyline:Zgt,projectPolylineToWGS84ComparableLonLat:Jgt,projectVectorToDehydratedPoint:aue,projectVectorToPoint:M_,projectVectorToVector:Ys,projectVectorToWGS84ComparableLonLat:EDe,projectWithoutEngine:oue,projectXYZToVector:dee,sphericalPCPFtoLonLatElevation:D7,test:Wgt,tryProjectWithZConversion:gDe,unload:qgt},Symbol.toStringTag,{value:"Module"}));function $_(t,e){const r=e&&e.url&&e.url.path;if(t&&r&&(t=ah(t,r,{preserveProtocolRelative:!0}),e.portalItem&&e.readResourcePaths)){const i=Jle(t,e.portalItem.itemUrl);i!=null&&dyt.test(i)&&e.readResourcePaths.push(e.portalItem.resourceFromPath(i).path)}return gee(t,e&&e.portal)}function I_(t,e,r=SP.YES){if(t==null)return t;!fd(t)&&e&&e.blockedRelativeUrls&&e.blockedRelativeUrls.push(t);let i=ah(t);if(e){const n=e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.rootPath||e.url&&e.url.path;if(n){const s=gee(n,e.portal),o=gee(i,e.portal);i=Jle(o,s,s),i!=null&&i!==o&&i!==t&&e.verifyItemRelativeUrls&&e.verifyItemRelativeUrls.writtenUrls.push(i)}}return i=VDe(i,e==null?void 0:e.portal),fd(i)&&(i=qp(i)),e!=null&&e.resources&&(e!=null&&e.portalItem)&&!fd(i)&&!b0(i)&&r===SP.YES&&e.resources.toKeep.push({resource:e.portalItem.resourceFromPath(i),compress:!1}),i}function N7(t,e,r){return $_(t,r)}function Qw(t,e,r,i){const n=I_(t,i);n!==void 0&&(e[r]=n)}const kDe=/\/items\/([^\/]+)\/resources\/(.*)/,dyt=/^\.\/resources\//;function UDe(t){const e=(t==null?void 0:t.match(kDe))??null;return(e==null?void 0:e[1])??null}function zDe(t){const e=(t==null?void 0:t.match(kDe))??null;if(e==null)return null;const r=e[2],i=r.lastIndexOf("/");if(i===-1){const{path:o,extension:a}=y0e(r);return{prefix:null,filename:o,extension:a}}const{path:n,extension:s}=y0e(r.slice(i+1));return{prefix:r.slice(0,i),filename:n,extension:s}}function VDe(t,e){return e&&!e.isPortal&&e.urlKey&&e.customBaseUrl?cQ(t,`${e.urlKey}.${e.customBaseUrl}`,e.portalHostname):t}function gee(t,e){if(!e||e.isPortal||!e.urlKey||!e.customBaseUrl)return t;const r=`${e.urlKey}.${e.customBaseUrl}`,i=Wle();return uP(i,`${i.scheme}://${r}`)?cQ(t,e.portalHostname,r):cQ(t,r,e.portalHostname)}var SP;(function(t){t[t.YES=0]="YES",t[t.NO=1]="NO"})(SP||(SP={}));const hyt=Object.freeze(Object.defineProperty({__proto__:null,get MarkKeep(){return SP},ensureMainOnlineDomain:VDe,fromJSON:$_,itemIdFromResourceUrl:UDe,prefixAndFilenameFromResourceUrl:zDe,read:N7,toJSON:I_,write:Qw},Symbol.toStringTag,{value:"Module"})),BDe={mapserver:"MapServer",imageserver:"ImageServer",featureserver:"FeatureServer",sceneserver:"SceneServer",streamserver:"StreamServer",vectortileserver:"VectorTileServer"},jDe=Object.values(BDe),GDe=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/rest\\/services\\/(.+?)\\/(${jDe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),pyt=new RegExp(`^((?:https?:)?\\/\\/\\S+?\\/([^\\/\\n]+)\\/(${jDe.join("|")}))(?:\\/(?:layers\\/)?(\\d+))?`,"i"),fyt=/(.*?)\/(?:layers\/)?(\d+)\/?$/i;function opr(t){return!!GDe.test(t)}function $E(t){if(t==null)return null;const e=Ts(t),r=e.path.match(GDe)||e.path.match(pyt);if(!r)return null;const[,i,n,s,o]=r,a=n.indexOf("/");return{title:F7(a!==-1?n.slice(a+1):n),serverType:BDe[s.toLowerCase()],sublayer:o!=null&&o!==""?parseInt(o,10):null,url:{path:i}}}function myt(t){const e=Ts(t).path.match(fyt);return e?{serviceUrl:e[1],sublayerId:Number(e[2])}:null}function F7(t){return(t=t.replaceAll(/\s*[/_]+\s*/g," "))[0].toUpperCase()+t.slice(1)}function HDe(t,e){const r=[];if(t){const i=$E(t);i!=null&&i.title&&r.push(i.title)}if(e){const i=F7(e);r.push(i)}if(r.length===2){if(r[0].toLowerCase().includes(r[1].toLowerCase()))return r[0];if(r[1].toLowerCase().includes(r[0].toLowerCase()))return r[1]}return r.join(" - ")}function pue(t){if(!t)return!1;const e=".arcgis.com/",r="//services",i="//tiles",n="//features",s=(t=t.toLowerCase()).includes(e),o=t.includes(r)||t.includes(i)||t.includes(n);return s&&o}function gyt(t,e){return t&&b$e(x$e(t,e))}function qDe(t){let{url:e}=t;if(!e)return{url:e};e=x$e(e,t.logger);const r=Ts(e),i=$E(r.path);let n;if(i!=null)i.sublayer!=null&&t.layer.layerId==null&&(n=i.sublayer),e=i.url.path;else if(t.nonStandardUrlAllowed){const s=myt(r.path);s!=null&&(e=s.serviceUrl,n=s.sublayerId)}return{url:b$e(e),layerId:n}}function WDe(t,e,r,i,n){Qw(e,i,"url",n),i.url&&t.layerId!=null&&(i.url=bd(i.url,r,t.layerId.toString()))}function apr(t){if(!t)return!1;const e=t.toLowerCase(),r=e.includes("/services/"),i=e.includes("/mapserver/wmsserver"),n=e.includes("/imageserver/wmsserver"),s=e.includes("/wmsserver");return r&&(i||n||s)}function yyt(t,e){if(!t)return null;if(!yee(t))return new H("webscene:unsupported-height-model-info","The vertical coordinate system of the scene is not supported",{heightModelInfo:t});const r=t.heightUnit,i=q_.deriveUnitFromSR(t,e).heightUnit;return r!==i?new H("webscene:incompatible-height-unit",`The vertical units of the scene (${r}) must match the horizontal units of the scene (${i})`,{verticalUnit:r,horizontalUnit:i}):null}function lpr(t,e,r){const i=XDe(t),n=e,s=vyt(i,n,r);if(i){const o=q_.deriveUnitFromSR(i,t.spatialReference).heightUnit;if(!r&&o!==i.heightUnit){const a=new H("layerview:unmatched-height-unit",`The vertical units of the layer must match the horizontal units (${o})`,{horizontalUnit:o});return new H("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i,error:a})}}if(!_yt(t)||s===Gu.Unsupported)return new H("layerview:unsupported-height-model-info","The vertical coordinate system of the layer is not supported",{heightModelInfo:i});switch(s){case Gu.Units:{const o=(i==null?void 0:i.heightUnit)||"unknown",a=(n==null?void 0:n.heightUnit)||"unknown",l=new H("layerview:incompatible-height-unit",`The vertical units of the layer (${o}) must match the vertical units of the scene (${a})`,{layerUnit:o,sceneUnit:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case Gu.HeightModel:{const o=(i==null?void 0:i.heightModel)||"unknown",a=(n==null?void 0:n.heightModel)||"unknown",l=new H("layerview:incompatible-height-model",`The height model of the layer (${o}) must match the height model of the scene (${a})`,{layerHeightModel:o,sceneHeightModel:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}case Gu.CRS:{const o=(i==null?void 0:i.vertCRS)||"unknown",a=(n==null?void 0:n.vertCRS)||"unknown",l=new H("layerview:incompatible-vertical-datum",`The vertical datum of the layer (${o}) must match the vertical datum of the scene (${a})`,{layerDatum:o,sceneDatum:a});return new H("layerview:incompatible-height-model-info","The vertical coordinate system of the layer is incompatible with the scene",{layerHeightModelInfo:i,sceneHeightModelInfo:n,error:l})}}return null}function vyt(t,e,r){if(!yee(t)||!yee(e))return Gu.Unsupported;if(t==null||e==null)return Gu.Ok;if(!r&&t.heightUnit!==e.heightUnit)return Gu.Units;if(t.heightModel!==e.heightModel)return Gu.HeightModel;switch(t.heightModel){case"gravity-related-height":return Gu.Ok;case"ellipsoidal":return t.vertCRS===e.vertCRS?Gu.Ok:Gu.CRS;default:return Gu.Unsupported}}var Gu;function yee(t){return t==null||t.heightModel!=null&&t.heightUnit!=null}function _yt(t){return"heightModelInfo"in t&&t.heightModelInfo!=null||t.spatialReference!=null||!JDe(t)}function XDe(t){var i;const e=t.url?$E(t.url):void 0;return!(((i=t.spatialReference)==null?void 0:i.vcsWkid)==null&&e!=null&&e.serverType==="ImageServer")&&YDe(t)&&t.heightModelInfo?t.heightModelInfo:JDe(t)?q_.deriveUnitFromSR(wyt,t.spatialReference):null}function YDe(t){return"heightModelInfo"in t}function ZDe(t){if(t.type==="unknown"||!("capabilities"in t))return!1;switch(t.type){case"csv":case"feature":case"geojson":case"subtype-group":case"ogc-feature":case"oriented-imagery":case"wfs":case"knowledge-graph-sublayer":return!0;default:return!1}}function JDe(t){return ZDe(t)?!!(t.capabilities&&t.capabilities.data&&t.capabilities.data.supportsZ):KDe(t)}function byt(t){return t.layers!=null||KDe(t)||ZDe(t)||YDe(t)}function KDe(t){switch(t.type){case"building-scene":case"elevation":case"integrated-mesh":case"point-cloud":case"scene":case"voxel":return!0;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"csv":case"dimension":case"geojson":case"feature":case"subtype-group":case"geo-rss":case"graphics":case"group":case"imagery":case"imagery-tile":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-image":case"map-notes":case"media":case"ogc-feature":case"open-street-map":case"oriented-imagery":case"route":case"stream":case"tile":case"unknown":case"unsupported":case"vector-tile":case"video":case"wcs":case"web-tile":case"wfs":case"wms":case"wmts":case null:return!1}return!1}(function(t){t[t.Ok=0]="Ok",t[t.Units=1]="Units",t[t.HeightModel=2]="HeightModel",t[t.CRS=3]="CRS",t[t.Unsupported=4]="Unsupported"})(Gu||(Gu={}));const wyt=new q_({heightModel:"gravity-related-height"});let ib=class extends me{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};d([p({type:String,json:{write:!0}})],ib.prototype,"facilityIdField",void 0),d([p({type:String,json:{write:!0}})],ib.prototype,"layerId",void 0),d([p({type:String,json:{write:!0}})],ib.prototype,"nameField",void 0),d([p({type:String,json:{write:!0}})],ib.prototype,"siteIdField",void 0),d([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],ib.prototype,"sublayerId",void 0),ib=d([I("esri.layers.support.FacilityLayerInfo")],ib);const xyt=ib;let Gf=class extends me{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};d([p({type:String,json:{write:!0}})],Gf.prototype,"facilityIdField",void 0),d([p({type:String,json:{write:!0}})],Gf.prototype,"layerId",void 0),d([p({type:String,json:{write:!0}})],Gf.prototype,"levelIdField",void 0),d([p({type:String,json:{write:!0}})],Gf.prototype,"levelNumberField",void 0),d([p({type:String,json:{write:!0}})],Gf.prototype,"longNameField",void 0),d([p({type:String,json:{write:!0}})],Gf.prototype,"shortNameField",void 0),d([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],Gf.prototype,"sublayerId",void 0),d([p({type:String,json:{write:!0}})],Gf.prototype,"verticalOrderField",void 0),Gf=d([I("esri.layers.support.LevelLayerInfo")],Gf);const Syt=Gf;let PS=class extends me{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};d([p({type:String,json:{write:!0}})],PS.prototype,"layerId",void 0),d([p({type:String,json:{write:!0}})],PS.prototype,"nameField",void 0),d([p({type:String,json:{write:!0}})],PS.prototype,"siteIdField",void 0),d([p({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],PS.prototype,"sublayerId",void 0),PS=d([I("esri.layers.support.SiteLayerInfo")],PS);const Tyt=PS;let xR=class extends me{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};d([p({type:Syt,json:{write:!0}})],xR.prototype,"levelLayer",void 0),d([p({type:xyt,json:{write:!0}})],xR.prototype,"facilityLayer",void 0),d([p({type:Tyt,json:{write:!0}})],xR.prototype,"siteLayer",void 0),xR=d([I("esri.support.MapFloorInfo")],xR);const Eyt=xR,Cyt=Symbol("WebScene"),Ryt="webscene:failed-to-copy-embedded-resources",Oyt="webscene:schema-validation";function Ayt(){return new H(Ryt,"Copying of embedded resources is currently not supported")}function Pyt(t){return new H(Oyt,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:t})}var at;function Ove(t){return t==="global"?at.Global:at.Local}function sX(t){return t===at.Global?"global":"local"}(function(t){t[t.Global=1]="Global",t[t.Local=2]="Local"})(at||(at={}));function ON(t,e){return t!=null&&(e==null||(e===at.Local?!t.isGeographic||t.isWGS84||t.wkid===Dp.CGCS2000:t.isWebMercator||t.isWGS84||t.wkid===Dp.CGCS2000||t.wkid===Dp.GCSMARS2000||t.wkid===Dp.GCSMARS2000_SPHERE||t.wkid===Dp.GCSMOON2000))}const Myt="randomUUID"in crypto;function k7(){if(Myt)return crypto.randomUUID();const t=crypto.getRandomValues(new Uint16Array(8));t[3]=4095&t[3]|16384,t[4]=16383&t[4]|32768;const e=r=>t[r].toString(16).padStart(4,"0");return e(0)+e(1)+"-"+e(2)+"-"+e(3)+"-"+e(4)+"-"+e(5)+e(6)+e(7)}function ppr(){return`{${k7()}}`}async function $yt(t,e={},r){await t.load(r);const i=bd(t.itemUrl,"resources"),{start:n=1,num:s=10,sortOrder:o="asc",sortField:a="created"}=e,l={query:{start:n,num:s,sortOrder:o,sortField:a,token:t.apiKey},signal:r==null?void 0:r.signal},c=await t.portal.request(i,l);return{total:c.total,nextStart:c.nextStart,resources:c.resources.map(({created:u,size:h,resource:f})=>({created:new Date(u),size:h,resource:t.resourceFromPath(f)}))}}async function Iyt(t,e,r,i){if(!t.hasPath())throw new H(`portal-item-resource-${e}:invalid-path`,"Resource does not have a valid path");const n=t.portalItem;await n.load(i);const s=bd(n.userItemUrl,e==="add"?"addResources":"updateResources"),[o,a]=QDe(t.path),l=await eNe(r),c=new FormData;return o&&o!=="."&&c.append("resourcesPrefix",o),i!=null&&i.compress&&c.append("compress","true"),c.append("fileName",a),c.append("file",l,a),c.append("f","json"),i!=null&&i.access&&c.append("access",i.access),await n.portal.request(s,{method:"post",body:c,signal:i==null?void 0:i.signal}),t}async function Lyt(t,e,r){if(!e.hasPath())throw new H("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(r);const i=bd(t.userItemUrl,"removeResources");await t.portal.request(i,{method:"post",query:{resource:e.path},signal:r==null?void 0:r.signal}),e.portalItem=null}async function Dyt(t,e){await t.load(e);const r=bd(t.userItemUrl,"removeResources");return t.portal.request(r,{method:"post",query:{deleteAll:!0},signal:e==null?void 0:e.signal})}function QDe(t){const e=t.lastIndexOf("/");return e===-1?[".",t]:[t.slice(0,e),t.slice(e+1)]}function fue(t){const[e,r]=Nyt(t),[i,n]=QDe(e);return[i,n,r]}function Nyt(t){const e=ice(t);return e==null?[t,""]:[t.slice(0,t.length-e.length-1),`.${e}`]}async function eNe(t){return t instanceof Blob?t:(await ti(t.url,{responseType:"blob"})).data}function Fyt(t,e){if(!t.hasPath())return null;const[r,,i]=fue(t.path);return t.portalItem.resourceFromPath(bd(r,e+i))}function tNe(t,e){if(!t.hasPath())return null;const[r,,i]=fue(t.path);return t.portalItem.resourceFromPath(bd(r,e+i))}const rI=Object.freeze(Object.defineProperty({__proto__:null,addOrUpdateResource:Iyt,contentToBlob:eNe,fetchResources:$yt,getSiblingOfSameType:Fyt,getSiblingOfSameTypeI:tNe,removeAllResources:Dyt,removeResource:Lyt,splitPrefixFileNameAndExtension:fue},Symbol.toStringTag,{value:"Module"}));async function qV(t,e,r){if(!e||!e.resources)return;const i=e.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=e.portalItem;const n=new Set(e.resources.toKeep.map(c=>c.resource.path)),s=new Set,o=[];n.forEach(c=>{i.delete(c),t.paths.push(c)});for(const c of e.resources.toUpdate)if(i.delete(c.resource.path),n.has(c.resource.path)||s.has(c.resource.path)){const{resource:u,content:h,finish:f,error:m}=c,g=tNe(u,k7());t.paths.push(g.path),o.push(Ave({resource:g,content:h,compress:c.compress,finish:f,error:m},r))}else t.paths.push(c.resource.path),o.push(kyt(c,r)),s.add(c.resource.path);for(const c of e.resources.toAdd)o.push(Ave(c,r)),t.paths.push(c.resource.path);if(i.forEach(c=>{if(e.portalItem){const u=e.portalItem.resourceFromPath(c);o.push(u.portalItem.removeResource(u).catch(()=>{}))}}),o.length===0)return;const a=await ou(o);vr(r);const l=a.filter(c=>"error"in c).map(c=>c.error);if(l.length>0)throw new H("save:resources","Failed to save one or more resources",{errors:l})}async function Ave(t,e){var n,s;const r={...e??{},compress:t.compress},i=await wd(t.resource.portalItem.addResource(t.resource,t.content,r));if(i.ok!==!0)throw(n=t.error)==null||n.call(t,i.error),i.error;(s=t.finish)==null||s.call(t,t.resource)}async function kyt(t,e){var i,n;const r=await wd(t.resource.update(t.content,e));if(r.ok!==!0)throw(i=t.error)==null||i.call(t,r.error),r.error;(n=t.finish)==null||n.call(t,t.resource)}const Uyt={width:600,height:400},W5=1.5;function zyt(t,e){e=e||Uyt;let{width:r,height:i}=e;const n=r/i;return n<W5?i=r/W5:n>W5&&(r=i*W5),r>t.width&&(i*=t.width/r,r=t.width),i>t.height&&(r*=t.height/i,i=t.height),{width:Math.round(r),height:Math.round(i)}}function Pve(t){return{enabled:!!(t!=null&&t.length)}}const mue=new ri({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"oid",esriFieldTypeGeometry:"geometry",esriFieldTypeBlob:"blob",esriFieldTypeRaster:"raster",esriFieldTypeGUID:"guid",esriFieldTypeGlobalID:"global-id",esriFieldTypeXML:"xml",esriFieldTypeBigInteger:"big-integer",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"});var vee;let SR=vee=class extends me{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new vee({exactMatch:this.exactMatch,type:this.type,name:this.name})}};d([p({type:Boolean,json:{write:!0}})],SR.prototype,"exactMatch",void 0),d([p({type:String,json:{write:!0}})],SR.prototype,"name",void 0),d([Rt(mue)],SR.prototype,"type",void 0),SR=vee=d([I("esri.webdoc.applicationProperties.SearchLayerField")],SR);const Vyt=SR;var _ee;let TR=_ee=class extends me{constructor(t){super(t),this.field=null,this.id=null,this.subLayer=null}clone(){return new _ee(ie({field:this.field,id:this.id,subLayer:this.subLayer}))}};d([p({type:Vyt,json:{write:{isRequired:!0}}})],TR.prototype,"field",void 0),d([p({type:String,json:{write:{isRequired:!0}}})],TR.prototype,"id",void 0),d([p({type:hn,json:{write:!0}})],TR.prototype,"subLayer",void 0),TR=_ee=d([I("esri.webdoc.applicationProperties.SearchLayer")],TR);const Byt=TR;var bee;let ER=bee=class extends me{constructor(t){super(t),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new bee({exactMatch:this.exactMatch,type:this.type,name:this.name})}};d([p({type:Boolean,json:{write:!0}})],ER.prototype,"exactMatch",void 0),d([p({type:String,json:{write:!0}})],ER.prototype,"name",void 0),d([Rt(mue)],ER.prototype,"type",void 0),ER=bee=d([I("esri.webdoc.applicationProperties.SearchTableField")],ER);const jyt=ER;var wee;let iI=wee=class extends me{constructor(t){super(t),this.field=null,this.id=null}clone(){return new wee(ie({field:this.field,id:this.id}))}};d([p({type:jyt,json:{write:{isRequired:!0}}})],iI.prototype,"field",void 0),d([p({type:String,json:{write:{isRequired:!0}}})],iI.prototype,"id",void 0),iI=wee=d([I("esri.webdoc.applicationProperties.SearchTable")],iI);const Gyt=iI;var xee;const rNe=vt.ofType(Byt),iNe=vt.ofType(Gyt);let Zg=xee=class extends me{constructor(t){super(t),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new rNe,this.tables=new iNe}readAddressSearchEnabled(t){return!t}writeAddressSearchEnabled(t,e,r){e[r]=!t}clone(){return new xee(ie({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};d([p({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],Zg.prototype,"addressSearchEnabled",void 0),d([ke("addressSearchEnabled")],Zg.prototype,"readAddressSearchEnabled",null),d([tt("addressSearchEnabled")],Zg.prototype,"writeAddressSearchEnabled",null),d([p({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],Zg.prototype,"enabled",void 0),d([p({type:String,json:{write:!0}})],Zg.prototype,"hintText",void 0),d([p({type:rNe,json:{write:{overridePolicy:Pve},origins:{"web-scene":{write:{isRequired:!0}}}}})],Zg.prototype,"layers",void 0),d([p({type:iNe,json:{read:!0,write:{overridePolicy:Pve}}})],Zg.prototype,"tables",void 0),Zg=xee=d([I("esri.webdoc.applicationProperties.Search")],Zg);const Hyt=Zg;var See;let P8=See=class extends me{constructor(t){super(t),this.search=null}clone(){return new See(ie({search:this.search}))}};d([p({type:Hyt,json:{write:!0}})],P8.prototype,"search",void 0),P8=See=d([I("esri.webdoc.applicationProperties.Viewing")],P8);const qyt=P8;var Tee;let M8=Tee=class extends me{constructor(t){super(t),this.viewing=null}clone(){return new Tee({viewing:this.viewing?this.viewing.clone():null})}};d([p({type:qyt,json:{write:!0}})],M8.prototype,"viewing",void 0),M8=Tee=d([I("esri.webscene.ApplicationProperties")],M8);const Wyt=M8;var Eee;let nI=Eee=class extends me{constructor(t){super(t),this.type="sunny",this.cloudCover=.5}clone(){return new Eee({cloudCover:this.cloudCover})}};d([Rt({sunny:"sunny"})],nI.prototype,"type",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],nI.prototype,"cloudCover",void 0),nI=Eee=d([I("esri.views.3d.environment.SunnyWeather")],nI);const WV=nI;var Cee;let sI=Cee=class extends me{constructor(t){super(t),this.type="cloudy",this.cloudCover=.5}clone(){return new Cee({cloudCover:this.cloudCover})}};d([Rt({cloudy:"cloudy"})],sI.prototype,"type",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],sI.prototype,"cloudCover",void 0),sI=Cee=d([I("esri.views.3d.environment.CloudyWeather")],sI);const Xyt=sI;var Ree;let oI=Ree=class extends me{constructor(t){super(t),this.type="foggy",this.fogStrength=.5}clone(){return new Ree({fogStrength:this.fogStrength})}};d([Rt({foggy:"foggy"})],oI.prototype,"type",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],oI.prototype,"fogStrength",void 0),oI=Ree=d([I("esri.views.3d.environment.FoggyWeather")],oI);const Yyt=oI;var Oee;let CR=Oee=class extends me{constructor(t){super(t),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new Oee({cloudCover:this.cloudCover,precipitation:this.precipitation})}};d([Rt({rainy:"rainy"})],CR.prototype,"type",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],CR.prototype,"cloudCover",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],CR.prototype,"precipitation",void 0),CR=Oee=d([I("esri.views.3d.environment.RainyWeather")],CR);const Zyt=CR;var Aee;let MS=Aee=class extends me{constructor(t){super(t),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new Aee({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};d([Rt({snowy:"snowy"})],MS.prototype,"type",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],MS.prototype,"cloudCover",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],MS.prototype,"precipitation",void 0),d([p({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],MS.prototype,"snowCover",void 0),MS=Aee=d([I("esri.views.3d.environment.SnowyWeather")],MS);const Jyt=MS,gue={key:"type",base:WV,typeMap:{sunny:WV,cloudy:Xyt,rainy:Zyt,snowy:Jyt,foggy:Yyt}},Kyt=Object.keys(gue.typeMap);function Qyt(t,e){return!!Kyt.includes(t)||(e.error(`"${t}" is not a valid weather type`),!1)}const by=1e4;var Pee;let tp=Pee=class extends me{constructor(t){super(t),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(t,e){return e.datetime!=null&&new Date(e.datetime)||null}writeDate(t,e,r){e[r]=t.getTime()}readDirectShadowsEnabled(t,e){return!!e.directShadows}writedirectShadowsEnabled(t,e,r){t&&(e[r]=t)}writeDisplayUTCOffset(t,e){t!=null&&(e.displayUTCOffset=t)}clone(){return new Pee(this.cloneConstructProperties())}cloneConstructProperties(){const t={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:this.displayUTCOffset!=null?this.displayUTCOffset:null};return this.date!=null&&(t.date=new Date(this.date.getTime())),t}};d([p({readOnly:!0,type:["sun"],json:{write:!0}})],tp.prototype,"type",void 0),d([p({type:Date,json:{type:Number,write:{target:"datetime"}}})],tp.prototype,"date",void 0),d([ke("date",["datetime"])],tp.prototype,"readDate",null),d([tt("date")],tp.prototype,"writeDate",null),d([p({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],tp.prototype,"directShadowsEnabled",void 0),d([ke("directShadowsEnabled",["directShadows"])],tp.prototype,"readDirectShadowsEnabled",null),d([tt("directShadowsEnabled")],tp.prototype,"writedirectShadowsEnabled",null),d([p({type:Number,json:{write:!0}})],tp.prototype,"displayUTCOffset",void 0),d([tt("displayUTCOffset")],tp.prototype,"writeDisplayUTCOffset",null),tp=Pee=d([I("esri.webscene.SunLighting")],tp);const nE=tp;var Mee;let aI=Mee=class extends me{constructor(t){super(t),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new Mee(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};d([p({readOnly:!0,type:["virtual"],json:{write:!0}})],aI.prototype,"type",void 0),d([p({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],aI.prototype,"directShadowsEnabled",void 0),aI=Mee=d([I("esri.webscene.VirtualLighting")],aI);const iF=aI,nNe={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:nE,virtual:iF}};let $8=class extends me{constructor(e){super(e)}clone(){}};d([p({readOnly:!0,json:{read:!1}})],$8.prototype,"type",void 0),$8=d([I("esri.webscene.background.Background")],$8);const sNe=$8,e0t=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i,t0t="screenUtils.toPt: input not recognized!",oNe=96;function Es(t){return t?t/72*oNe:0}function Rh(t){return t?72*t/oNe:0}function Ei(t){if(typeof t=="string"){const e=t.match(e0t);if(e){const r=Number(e[1]),i=e[3]&&e[3].toLowerCase(),n=t.charAt(0)==="-",s=i==="px"?Rh(r):r;return n?-s:s}return console.warn(t0t),null}return t}function Oh(t=0,e=0){return{x:t,y:e}}function Tn(t=0,e=0){return[t,e]}function aNe(t=0,e=0){return[t,e]}function ua(t=0,e=0,r=0){return[t,e,r]}function mpr(t){return t}function gpr(t){return t}function ypr(t){return t}function Oy(t,e){return e?(e[0]=t.x,e[1]=t.y,e.length>2&&(e[2]=0),e):[t.x,t.y]}function r0t(t,e){const r=e.transparency!=null?rE(e.transparency):1,i=e.color;return i&&Array.isArray(i)?new ht([i[0]||0,i[1]||0,i[2]||0,r]):null}function i0t(t,e){e.color=t.toJSON().slice(0,3);const r=X4(t.a);r!==0&&(e.transparency=r)}const W_={type:ht,json:{type:[hn],default:null,read:{source:["color","transparency"],reader:r0t},write:{target:{color:{type:[hn]},transparency:{type:hn}},writer:i0t}}},l0={type:Number,cast:Ei,json:{write:!0}};var $ee;const n0t={...W_,nonNullable:!0};let lI=$ee=class extends sNe{constructor(t){super(t),this.type="color",this.color=new ht([0,0,0,1])}clone(){return new $ee(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};d([Rt({color:"color"},{readOnly:!0})],lI.prototype,"type",void 0),d([p(n0t)],lI.prototype,"color",void 0),lI=$ee=d([I("esri.webscene.background.ColorBackground")],lI);const lNe=lI,Mve={base:sNe,key:"type",typeMap:{color:lNe}};function s0t(t){return(e,r,i)=>{if(!e)return e;for(const n in t.typeMap)if(e.type===n){const s=new t.typeMap[n];return s.read(e,i),s}}}const o0t={types:Mve,json:{read:s0t(Mve),write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.isPresentation})}}};var Iee;const cNe="esri.webscene.Environment",a0t=re.getLogger(cNe),$ve=(t,e,r)=>({enabled:!r||!r.isPresentation});let nb=Iee=class extends me{constructor(t){super(t),this.lighting=new nE,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(t){Qyt(t==null?void 0:t.type,a0t)&&this._set("weather",t)}clone(){return new Iee(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&this.lighting.type==="virtual"?iF.prototype.clone.call(this.lighting):nE.prototype.clone.call(this.lighting),background:ie(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};d([p({types:nNe,nonNullable:!0,json:{write:!0}})],nb.prototype,"lighting",void 0),d([p(o0t)],nb.prototype,"background",void 0),d([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:$ve}}})],nb.prototype,"atmosphereEnabled",void 0),d([p({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:$ve}}})],nb.prototype,"starsEnabled",void 0),d([p({types:gue,nonNullable:!0,json:{write:!0},value:new WV})],nb.prototype,"weather",null),nb=Iee=d([I(cNe)],nb);const TP=nb;var Lee;let $S=Lee=class extends me{constructor(t){super(t),this.environment=new TP,this.spatialReference=null,this.viewpoint=null}set viewingMode(t){this._set("viewingMode",t)}clone(){return new Lee({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})}};d([p({type:TP,json:{write:{isRequired:!0}}})],$S.prototype,"environment",void 0),d([p({type:dt})],$S.prototype,"spatialReference",void 0),d([p({type:["local","global"]})],$S.prototype,"viewingMode",null),d([p({type:Sd,json:{write:{isRequired:!0}}})],$S.prototype,"viewpoint",void 0),$S=Lee=d([I("esri.webscene.InitialViewProperties")],$S);const XV=$S,Ive={ArcGISAnnotationLayer:!0,ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISStreamLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BingMapsAerial:!0,BingMapsHybrid:!0,BingMapsRoad:!0,CSV:!0,GeoRSS:!0,GeoJSON:!0,GroupLayer:!0,KML:!0,MediaLayer:!0,OGCFeatureLayer:!0,OrientedImageryLayer:!0,SubtypeGroupLayer:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,WebTiledLayer:!0},Lve={ArcGISImageServiceLayer:!0,ArcGISImageServiceVectorLayer:!0,ArcGISMapServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,WMS:!0,WebTiledLayer:!0,BingMapsAerial:!0,BingMapsRoad:!0,BingMapsHybrid:!0},Dve={ArcGISFeatureLayer:!0},l0t={"web-scene/operational-layers":{ArcGISDimensionLayer:!0,ArcGISFeatureLayer:!0,ArcGISImageServiceLayer:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0,ArcGISTiledElevationServiceLayer:!0,ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,BuildingSceneLayer:!0,GroupLayer:!0,IntegratedMeshLayer:!0,OGCFeatureLayer:!0,PointCloudLayer:!0,WebTiledLayer:!0,CSV:!0,GeoJSON:!0,VectorTileLayer:!0,WFS:!0,WMS:!0,KML:!0,RasterDataLayer:!0,Voxel:!0,LineOfSightLayer:!0},"web-scene/basemap":{ArcGISTiledImageServiceLayer:!0,ArcGISTiledMapServiceLayer:!0,WebTiledLayer:!0,OpenStreetMap:!0,VectorTileLayer:!0,ArcGISImageServiceLayer:!0,WMS:!0,ArcGISMapServiceLayer:!0,ArcGISSceneServiceLayer:!0},"web-scene/ground":{ArcGISTiledElevationServiceLayer:!0,RasterDataElevationLayer:!0},"web-map/operational-layers":Ive,"web-map/basemap":Lve,"web-map/tables":Dve,"link-chart/operational-layers":{...Ive,LinkChartLayer:!0},"link-chart/basemap":Lve,"link-chart/tables":Dve,"portal-item/operational-layers":{ArcGISFeatureLayer:!0,ArcGISSceneServiceLayer:!0,PointCloudLayer:!0,BuildingSceneLayer:!0,IntegratedMeshLayer:!0,OrientedImageryLayer:!0}},Nve={milliseconds:1,seconds:1e3,minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26784e5,years:31536e6,decades:31536e7,centuries:31536e8},c0t={milliseconds:{getter:"getMilliseconds",setter:"setMilliseconds",multiplier:1},seconds:{getter:"getSeconds",setter:"setSeconds",multiplier:1},minutes:{getter:"getMinutes",setter:"setMinutes",multiplier:1},hours:{getter:"getHours",setter:"setHours",multiplier:1},days:{getter:"getDate",setter:"setDate",multiplier:1},weeks:{getter:"getDate",setter:"setDate",multiplier:7},months:{getter:"getMonth",setter:"setMonth",multiplier:1},years:{getter:"getFullYear",setter:"setFullYear",multiplier:1},decades:{getter:"getFullYear",setter:"setFullYear",multiplier:10},centuries:{getter:"getFullYear",setter:"setFullYear",multiplier:100}};function u0t(t,e){const r=new Date(t,e+1,1);return r.setDate(0),r.getDate()}function b2(t,e,r){const i=new Date(t.getTime());if(e&&r){const n=c0t[r],{getter:s,setter:o,multiplier:a}=n;if(r==="months"){const l=u0t(i.getFullYear(),i.getMonth()+e);i.getDate()>l&&i.setDate(l)}i[o](i[s]()+e*a)}return i}function Fve(t,e){switch(e){case"milliseconds":return new Date(t.getTime());case"seconds":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds());case"minutes":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes());case"hours":return new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours());case"days":return new Date(t.getFullYear(),t.getMonth(),t.getDate());case"weeks":return new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay());case"months":return new Date(t.getFullYear(),t.getMonth(),1);case"years":return new Date(t.getFullYear(),0,1);case"decades":return new Date(t.getFullYear()-t.getFullYear()%10,0,1);case"centuries":return new Date(t.getFullYear()-t.getFullYear()%100,0,1);default:return new Date}}function d0t(t,e,r){return t===0?0:t*Nve[e]/Nve[r]}var Hf;let Xd=Hf=class extends me{static get allTime(){return kve}static get empty(){return h0t}constructor(t){super(t),this.end=null,this.start=null}readEnd(t,e){return e.end!=null?new Date(e.end):null}writeEnd(t,e){e.end=t?t.getTime():null}get isAllTime(){return this.equals(Hf.allTime)}get isEmpty(){return this.equals(Hf.empty)}readStart(t,e){return e.start!=null?new Date(e.start):null}writeStart(t,e){e.start=t?t.getTime():null}clone(){return new Hf({end:this.end,start:this.start})}equals(t){if(!t)return!1;const e=this.start!=null?this.start.getTime():this.start,r=this.end!=null?this.end.getTime():this.end,i=t.start!=null?t.start.getTime():t.start,n=t.end!=null?t.end.getTime():t.end;return e===i&&r===n}expandTo(t){if(this.isEmpty||this.isAllTime)return this.clone();const e=rd(this.start,i=>Fve(i,t)),r=rd(this.end,i=>{const n=Fve(i,t);return i.getTime()===n.getTime()?n:b2(n,1,t)});return new Hf({start:e,end:r})}intersection(t){var a,l,c,u;if(!t)return this.clone();if(this.isEmpty||t.isEmpty)return Hf.empty;if(this.isAllTime)return t.clone();if(t.isAllTime)return this.clone();const e=((a=this.start)==null?void 0:a.getTime())??-1/0,r=((l=this.end)==null?void 0:l.getTime())??1/0,i=((c=t.start)==null?void 0:c.getTime())??-1/0,n=((u=t.end)==null?void 0:u.getTime())??1/0;let s,o;if(i>=e&&i<=r?s=i:e>=i&&e<=n&&(s=e),r>=i&&r<=n?o=r:n>=e&&n<=r&&(o=n),s!=null&&o!=null&&!isNaN(s)&&!isNaN(o)){const h=new Hf;return h.start=s===-1/0?null:new Date(s),h.end=o===1/0?null:new Date(o),h}return Hf.empty}offset(t,e){if(this.isEmpty||this.isAllTime)return this.clone();const r=new Hf,{start:i,end:n}=this;return i!=null&&(r.start=b2(i,t,e)),n!=null&&(r.end=b2(n,t,e)),r}union(t){if(!t||t.isEmpty)return this.clone();if(this.isEmpty)return t.clone();if(this.isAllTime||t.isAllTime)return kve.clone();const e=this.start!=null&&t.start!=null?new Date(Math.min(this.start.getTime(),t.start.getTime())):null,r=this.end!=null&&t.end!=null?new Date(Math.max(this.end.getTime(),t.end.getTime())):null;return new Hf({start:e,end:r})}};d([p({type:Date,json:{write:{allowNull:!0}}})],Xd.prototype,"end",void 0),d([ke("end")],Xd.prototype,"readEnd",null),d([tt("end")],Xd.prototype,"writeEnd",null),d([p({readOnly:!0,json:{read:!1}})],Xd.prototype,"isAllTime",null),d([p({readOnly:!0,json:{read:!1}})],Xd.prototype,"isEmpty",null),d([p({type:Date,json:{write:{allowNull:!0}}})],Xd.prototype,"start",void 0),d([ke("start")],Xd.prototype,"readStart",null),d([tt("start")],Xd.prototype,"writeStart",null),Xd=Hf=d([I("esri.TimeExtent")],Xd);const kve=new Xd,h0t=new Xd({start:void 0,end:void 0}),T0=Xd;function p0t(t){if(!t)return t;const{start:e,end:r}=t;return new T0({start:e!=null?b2(e,-e.getTimezoneOffset(),"minutes"):e,end:r!=null?b2(r,-r.getTimezoneOffset(),"minutes"):r})}function f0t(t){if(!t)return t;const{start:e,end:r}=t;return new T0({start:e!=null?b2(e,e.getTimezoneOffset(),"minutes"):e,end:r!=null?b2(r,r.getTimezoneOffset(),"minutes"):r})}var EP;function m0t(t,e){switch(t.type){case"range":{const r="range"in t?t.range[0]:t.minValue,i="range"in t?t.range[1]:t.maxValue;if(r!=null&&+e<r||i!=null&&+e>i)return EP.VALUE_OUT_OF_RANGE;break}case"coded-value":case"codedValue":if(t.codedValues==null||t.codedValues.every(r=>r==null||r.code!==e))return EP.INVALID_CODED_VALUE}return null}(function(t){t.VALUE_OUT_OF_RANGE="domain-validation-error::value-out-of-range",t.INVALID_CODED_VALUE="domain-validation-error::invalid-coded-value"})(EP||(EP={}));const g0t=re.getLogger("esri.support.arcadeOnDemand");let oX;function ex(){return oX||(oX=(async()=>{const t=await le(()=>import("./arcadeUtils-854834ad.js").then(e=>e.av),["assets/arcadeUtils-854834ad.js","assets/arcadeTimeUtils-147e820f.js","assets/executionError-c92d3b85.js","assets/number-80dd919e.js","assets/centroid-95e8df64.js","assets/hash-6f442295.js"]);return{arcade:t.arcade,arcadeUtils:t,Dictionary:t.Dictionary,Feature:t.arcadeFeature}})()),oX}const y0t=(t,e,r)=>yue.create(t,e,r,null,["$feature"],[]),v0t=(t,e,r)=>yue.create(t,e,r,null,["$feature","$view"],[]),_0t=(t,e,r,i)=>yue.create(t,e,r,i,["$feature","$view"],[]);let yue=class uNe{constructor(e,r,i,n,s,o,a){this.services=null,this.script=e,this.evaluate=n;const l=Array.isArray(o)?o:o.fields;this.fields=l,this._syntaxTree=i,this._arcade=r,this._arcadeFeature=s,this._spatialReference=a,this._referencesGeometry=r.scriptTouchesGeometry(this._syntaxTree),this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}static async create(e,r,i,n,s,o){const{arcade:a,Feature:l,Dictionary:c}=await ex(),u=dt.fromJSON(r);let h;try{h=a.parseScript(e,o)}catch(P){return g0t.error(new H("arcade-bad-expression","Failed to parse arcade script",{script:e,error:P})),null}const f=s.reduce((P,D)=>({...P,[D]:null}),{});let m=null;n!=null&&(m=new c(n),m.immutable=!0,f.$config=null);const g=a.scriptUsesGeometryEngine(h),y=g&&a.enableGeometrySupport(),_=a.scriptUsesFeatureSet(h)&&a.enableFeatureSetSupport(),b=a.scriptIsAsync(h),w=b&&a.enableAsyncSupport(),x={vars:f,spatialReference:u,useAsync:!!w};await Promise.all([y,_,w]);const S=new Set;await a.loadDependentModules(S,h,null,b,g);const C=new c;C.immutable=!1,C.setField("scale",0);const E=a.compileScript(h,x),R=(P,D)=>("$view"in P&&P.$view&&(C.setField("scale",typeof P.$view=="object"&&"scale"in P.$view?P.$view.scale:void 0),P.$view=C),m&&(P.$config=m),E({vars:P,spatialReference:u,services:D}));return new uNe(e,a,h,R,new l,i,u)}repurposeFeature(e){return e.geometry&&!e.geometry.spatialReference&&(e.geometry.spatialReference=this._spatialReference),this._arcadeFeature.repurposeFromGraphicLikeObject(e.geometry,e.attributes,{fields:this.fields}),this._arcadeFeature}referencesGeometry(){return this._referencesGeometry}referencesScale(){return this._referencesScale}};const b0t=/^([0-9_])/,w0t=/[^a-z0-9_\u0080-\uffff]+/gi;function x0t(t){return t==null?null:t.trim().replaceAll(w0t,"_").replace(b0t,"F$1")||null}const S0t=["field","field2","field3","normalizationField","rotationInfo.field","proportionalSymbolInfo.field","proportionalSymbolInfo.normalizationField","colorInfo.field","colorInfo.normalizationField"],T0t=["field","normalizationField"];function CP(t,e){if(t!=null&&e!=null){for(const r of Array.isArray(t)?t:[t])if(Uve(S0t,r,e),"visualVariables"in r&&r.visualVariables)for(const i of r.visualVariables)Uve(T0t,i,e)}}function Uve(t,e,r){if(t)for(const i of t){const n=N4(i,e),s=n&&typeof n!="function"&&r.get(n);s&&Rc(i,s.name,e)}}function vue(t,e){var r;if(t!=null&&((r=e==null?void 0:e.fields)!=null&&r.length))if("startField"in t){const i=e.get(t.startField),n=e.get(t.endField);t.startField=(i==null?void 0:i.name)??null,t.endField=(n==null?void 0:n.name)??null}else{const i=e.get(t.startTimeField),n=e.get(t.endTimeField);t.startTimeField=(i==null?void 0:i.name)??null,t.endTimeField=(n==null?void 0:n.name)??null}}const aX=new Set;function U7(t,e){return t&&e?(aX.clear(),AN(aX,t,e),Array.from(aX).sort()):[]}function AN(t,e,r){var i;if(r)if((i=e==null?void 0:e.fields)!=null&&i.length)if(r.includes("*"))for(const{name:n}of e.fields)t.add(n);else for(const n of r)gh(t,e,n);else{if(r.includes("*"))return t.clear(),void t.add("*");for(const n of r)n!=null&&t.add(n)}}function gh(t,e,r){if(typeof r=="string")if(e){const i=e.get(r);i&&t.add(i.name)}else t.add(r)}function E0t(t,e){return e==null||t==null?[]:e.includes("*")?(t.fields??[]).map(r=>r.name):e}async function pu(t,e,r){var s;if(!r)return;const{arcadeUtils:i}=await ex(),n=i.extractFieldNames(r,(s=e==null?void 0:e.fields)==null?void 0:s.map(o=>o.name));for(const o of n)gh(t,e,o)}async function dNe(t,e,r){if(r&&r!=="1=1"){const{WhereClause:i}=await le(()=>import("./WhereClause-50cca87e.js").then(s=>s.W),["assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js"]),n=i.create(r,e);if(!n.isStandardized)throw new H("fieldUtils:collectFilterFields","Where clause is not standardized",{where:r});AN(t,e,n.fieldNames)}}function C0t({displayField:t,fields:e}){return t||(e&&e.length?lX(e,"name-or-title")||lX(e,"unique-identifier")||lX(e,"type-or-category")||R0t(e):null)}function R0t(t){for(const e of t){if(!e||!e.name)continue;const r=e.name.toLowerCase();if(r.includes("name")||r.includes("title"))return e.name}return null}function lX(t,e){for(const r of t)if(r&&r.valueType&&r.valueType===e)return r.name;return null}async function vpr(t,e){var i;if(!e)return;const r=(i=e.elevationInfo)==null?void 0:i.featureExpressionInfo;return r?r.collectRequiredFields(t,e.fieldsIndex):void 0}function O0t(t,e,r){r.onStatisticExpression?pu(t,e,r.onStatisticExpression.expression):t.add(r.onStatisticField)}async function _pr(t,e,r){if(!e||!r||!("fields"in r))return;const i=[],n=r.popupTemplate;i.push(A0t(t,e,n)),r.fields&&i.push(...r.fields.map(async s=>O0t(t,e.fieldsIndex,s))),await Promise.all(i)}async function A0t(t,e,r){const i=[];r!=null&&r.expressionInfos&&i.push(...r.expressionInfos.map(s=>pu(t,e.fieldsIndex,s.expression)));const n=r==null?void 0:r.content;if(Array.isArray(n))for(const s of n)s.type==="expression"&&s.expressionInfo&&i.push(pu(t,e.fieldsIndex,s.expressionInfo.expression));await Promise.all(i)}async function bpr(t,e,r){e&&(e.timeInfo&&r!=null&&r.timeExtent&&AN(t,e.fieldsIndex,[e.timeInfo.startField,e.timeInfo.endField]),e.floorInfo&&AN(t,e.fieldsIndex,[e.floorInfo.floorField]),r!=null&&r.where!=null&&await dNe(t,e.fieldsIndex,r.where))}async function wpr(t,e,r){e&&r&&await Promise.all(r.map(i=>P0t(t,e,i)))}async function P0t(t,e,r){e&&r&&(r.valueExpression?await pu(t,e.fieldsIndex,r.valueExpression):r.field&&gh(t,e.fieldsIndex,r.field))}function M0t(t){return t?U7(t.fieldsIndex,hNe(t)):[]}function $0t(t){if(!t)return[];const e=t.geometryFieldsInfo;return e?U7(t.fieldsIndex,[e.shapeAreaField,e.shapeLengthField]):[]}const I0t=["oid","global-id","guid"],L0t=["oid","global-id"],D0t=[/^fnode_$/i,/^tnode_$/i,/^lpoly_$/i,/^rpoly_$/i,/^poly_$/i,/^subclass$/i,/^subclass_$/i,/^rings_ok$/i,/^rings_nok$/i,/shape/i,/perimeter/i,/objectid/i,/_i$/i];function N0t(t){const e=new Set;pNe(t).forEach(i=>e.add(i)),$0t(t).forEach(i=>e.add(i.toLowerCase()));const r=t&&"infoFor3D"in t?t.infoFor3D:void 0;return r&&(Object.values(r.assetMapFieldRoles).forEach(i=>e.add(i.toLowerCase())),Object.values(r.transformFieldRoles).forEach(i=>e.add(i.toLowerCase()))),Array.from(e)}function hNe(t){if(!t)return[];const e="editFieldsInfo"in t&&t.editFieldsInfo;if(!e)return[];const{creationDateField:r,creatorField:i,editDateField:n,editorField:s}=e;return[r,i,n,s].filter(Boolean)}function pNe(t){return hNe(t).map(e=>e.toLowerCase())}function F0t(t,e){var r;return t.editable&&!I0t.includes(t.type)&&!pNe(e).includes(((r=t.name)==null?void 0:r.toLowerCase())??"")}function k0t(t,e){var i;const r=((i=t.name)==null?void 0:i.toLowerCase())??"";return!((e==null?void 0:e.objectIdField)!=null&&r===e.objectIdField.toLowerCase()||(e==null?void 0:e.globalIdField)!=null&&r===e.globalIdField.toLowerCase()||N0t(e).includes(r)||L0t.includes(t.type)||D0t.some(n=>n.test(r)))}async function xpr(t,e){const{labelingInfo:r,fieldsIndex:i}=e;r&&r.length&&await Promise.all(r.map(n=>U0t(t,i,n)))}async function U0t(t,e,r){if(!r)return;const i=r.getLabelExpression(),n=r.where;if(i.type==="arcade")await pu(t,e,i.expression);else{const s=i.expression.match(/{[^}]*}/g);s&&s.forEach(o=>{gh(t,e,o.slice(1,-1))})}await dNe(t,e,n)}function z0t(t){const e=t.defaultValue;return e!==void 0&&gNe(t,e)?e:t.nullable?null:void 0}function fNe(t){return typeof t=="number"&&!isNaN(t)&&isFinite(t)}function V0t(t){return t===null||fNe(t)}const _ue="isInteger"in Number?Number.isInteger:t=>typeof t=="number"&&isFinite(t)&&Math.floor(t)===t;function B0t(t){return t===null||_ue(t)}function mNe(t){return t!=null&&typeof t=="string"}function j0t(t){return t===null||mNe(t)}function G0t(){return!0}function gNe(t,e){let r;switch(t.type){case"date":case"integer":case"long":case"small-integer":case"esriFieldTypeDate":case"esriFieldTypeInteger":case"esriFieldTypeLong":case"esriFieldTypeSmallInteger":r=t.nullable?B0t:_ue;break;case"double":case"single":case"esriFieldTypeSingle":case"esriFieldTypeDouble":r=t.nullable?V0t:fNe;break;case"string":case"esriFieldTypeString":r=t.nullable?j0t:mNe;break;default:r=G0t}return arguments.length===1?r:r(e)}const H0t=["integer","small-integer","single","double"],q0t=new Set([...H0t,"esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),W0t=["date","date-only","time-only","timestamp-offset"],X0t=new Set([...W0t,"esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function bue(t){return t!=null&&q0t.has(t.type)}function Spr(t){return t!=null&&(t.type==="string"||t.type==="esriFieldTypeString")}function Tpr(t){return t!=null&&X0t.has(t.type)}var YV,ZV;function Epr(t){return t==null||typeof t=="number"&&isNaN(t)?null:t}function Cpr(t,e){return t==null||t.nullable&&e===null?null:bue(t)&&!Y0t(t.type,Number(e))?YV.OUT_OF_RANGE:gNe(t,e)?t.domain?m0t(t.domain,e):null:ZV.INVALID_TYPE}function Y0t(t,e){const r=typeof t=="string"?yNe(t):t;if(!r)return!1;const i=r.min,n=r.max;return r.isInteger?_ue(e)&&e>=i&&e<=n:e>=i&&e<=n}function yNe(t){switch(t){case"esriFieldTypeSmallInteger":case"small-integer":return Z0t;case"esriFieldTypeInteger":case"integer":return J0t;case"esriFieldTypeBigInteger":case"big-integer":return K0t;case"esriFieldTypeSingle":case"single":return Q0t;case"esriFieldTypeDouble":case"double":return evt}}(function(t){t.OUT_OF_RANGE="numeric-range-validation-error::out-of-range"})(YV||(YV={})),function(t){t.INVALID_TYPE="type-validation-error::invalid-type"}(ZV||(ZV={}));const Z0t={min:-32768,max:32767,isInteger:!0},J0t={min:-2147483648,max:2147483647,isInteger:!0},K0t={min:-Number.MAX_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,isInteger:!0},Q0t={min:-34e37,max:12e37,isInteger:!1},evt={min:-Number.MAX_VALUE,max:Number.MAX_VALUE,isInteger:!1};function Rpr(t,e,r){switch(t){case EP.INVALID_CODED_VALUE:return`Value ${r} is not in the coded domain - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case EP.VALUE_OUT_OF_RANGE:return`Value ${r} is out of the range of valid values - field: ${e.name}, domain: ${JSON.stringify(e.domain)}`;case ZV.INVALID_TYPE:return`Value ${r} is not a valid value for the field type - field: ${e.name}, type: ${e.type}, nullable: ${e.nullable}`;case YV.OUT_OF_RANGE:{const{min:i,max:n}=yNe(e.type);return`Value ${r} is out of range for the number type - field: ${e.name}, type: ${e.type}, value range is ${i} to ${n}`}}}function Opr(t,e){return!tvt(t,e,null)}function tvt(t,e,r){if(!e||!e.attributes||!t){if(r!=null)for(const s of t??[])r.add(s);return!0}const i=e.attributes;let n=!1;for(const s of t)if(!(s in i)){if(n=!0,r==null)break;r.add(s)}return n}function rvt(t){return!!t&&["raster.itempixelvalue","raster.servicepixelvalue"].some(e=>t.toLowerCase().startsWith(e))}var Dee;let cI=Dee=class extends me{constructor(t){super(t)}async collectRequiredFields(t,e){return pu(t,e,this.expression)}clone(){return new Dee({expression:this.expression,title:this.title})}equals(t){return this.expression===t.expression&&this.title===t.title}};d([p({type:String,json:{write:!0}})],cI.prototype,"expression",void 0),d([p({type:String,json:{write:!0}})],cI.prototype,"title",void 0),cI=Dee=d([I("esri.layers.support.FeatureExpressionInfo")],cI);const zve=cI,RP={unknown:1,inches:Po(1,"meters","inches"),feet:Po(1,"meters","feet"),"us-feet":Po(1,"meters","us-feet"),yards:Po(1,"meters","yards"),miles:Po(1,"meters","miles"),"nautical-miles":Po(1,"meters","nautical-miles"),millimeters:Po(1,"meters","millimeters"),centimeters:Po(1,"meters","centimeters"),decimeters:Po(1,"meters","decimeters"),meters:Po(1,"meters","meters"),kilometers:Po(1,"meters","kilometers"),"decimal-degrees":1/PIe(1,"meters",Rr.radius)};function ivt(t){return!!t&&RP[t]!=null}function vNe(t){return 1/(RP[t]||1)}function nvt(){const t=Object.keys(RP);return t.sort(),t}const svt=nvt();var Nee;const X5=Ac()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),Vve=new ri({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});let sv=Nee=class extends me{constructor(t){super(t),this.offset=null}readFeatureExpressionInfo(t,e){return t??(e.featureExpression&&e.featureExpression.value===0?{expression:"0"}:void 0)}writeFeatureExpressionInfo(t,e,r,i){e[r]=t.write({},i),t.expression==="0"&&(e.featureExpression={value:0})}get mode(){const{offset:t,featureExpressionInfo:e}=this;return this._isOverridden("mode")?this._get("mode"):t!=null||e?"relative-to-ground":"on-the-ground"}set mode(t){this._override("mode",t)}set unit(t){this._set("unit",t)}write(t,e){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(t,e):null}clone(){return new Nee({mode:this.mode,offset:this.offset,featureExpressionInfo:this.featureExpressionInfo?this.featureExpressionInfo.clone():void 0,unit:this.unit})}equals(t){return this.mode===t.mode&&this.offset===t.offset&&this.unit===t.unit&&iut(this.featureExpressionInfo,t.featureExpressionInfo)}};d([p({type:zve,json:{write:!0}})],sv.prototype,"featureExpressionInfo",void 0),d([ke("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],sv.prototype,"readFeatureExpressionInfo",null),d([tt("featureExpressionInfo",{featureExpressionInfo:{type:zve},"featureExpression.value":{type:[0]}})],sv.prototype,"writeFeatureExpressionInfo",null),d([p({type:X5.apiValues,nonNullable:!0,json:{type:X5.jsonValues,read:X5.read,write:{writer:X5.write,isRequired:!0}}})],sv.prototype,"mode",null),d([p({type:Number,json:{write:!0}})],sv.prototype,"offset",void 0),d([p({type:svt,json:{type:String,read:Vve.read,write:Vve.write}})],sv.prototype,"unit",null),sv=Nee=d([I("esri.layers.support.ElevationInfo")],sv);const _Ne=sv,wue={type:Boolean,value:!0,json:{origins:{service:{read:!1,write:!1},"web-map":{read:!1,write:!1}},name:"screenSizePerspective",write:!0}},nF={type:Boolean,value:!0,json:{name:"disablePopup",read:{reader:(t,e)=>!e.disablePopup},write:{enabled:!0,writer(t,e,r){e[r]=!t}}}},sF={type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",write:!0}},xue={type:String,json:{origins:{"portal-item":{write:!1}},write:{isRequired:!0,ignoreOrigin:!0,writer:Qw}}},Sue={type:Boolean,value:!0,nonNullable:!0,json:{origins:{service:{read:{enabled:!1}}},name:"showLegend",write:!0}},Tue={value:null,type:_Ne,json:{origins:{service:{name:"elevationInfo",write:!0}},name:"layerDefinition.elevationInfo",write:!0}};function Apr(t){return{type:t,readOnly:!0,json:{origins:{service:{read:!0}},read:!1}}}const bNe={write:!0,read:!0},JV={type:Number,json:{origins:{"web-document":bNe,"portal-item":{write:!0}}}},ovt={...JV,json:{...JV.json,origins:{"web-document":{...bNe,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}}}},read:{source:["layerDefinition.drawingInfo.transparency","drawingInfo.transparency"],reader:(t,e,r)=>r&&r.origin!=="service"||!e.drawingInfo||e.drawingInfo.transparency===void 0?e.layerDefinition&&e.layerDefinition.drawingInfo&&e.layerDefinition.drawingInfo.transparency!==void 0?rE(e.layerDefinition.drawingInfo.transparency):void 0:rE(e.drawingInfo.transparency)}}},Ppr={type:T0,readOnly:!0,get(){var a,l;if(!((a=this.layer)!=null&&a.timeInfo))return null;const{datesInUnknownTimezone:t,timeOffset:e,useViewTime:r}=this.layer,i=(l=this.view)==null?void 0:l.timeExtent;let n=this.layer.timeExtent;t&&(n=f0t(n));let s=r?i&&n?i.intersection(n):i||n:n;if(!s||s.isEmpty||s.isAllTime)return s;e&&(s=s.offset(-e.value,e.unit)),t&&(s=p0t(s));const o=this._get("timeExtent");return s.equals(o)?o:s}},Mpr={type:$r,readOnly:!0,json:{origins:{service:{read:{source:["fullExtent","spatialReference"],reader:(t,e)=>{const r=$r.fromJSON(t);return e.spatialReference!=null&&typeof e.spatialReference=="object"&&(r.spatialReference=dt.fromJSON(e.spatialReference)),r}}}},read:!1}},Eue={type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}}}},avt={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.minScale"},write:{target:"layerDefinition.minScale"}}},lvt={type:Number,json:{origins:{service:{write:{enabled:!1}}},read:{source:"layerDefinition.maxScale"},write:{target:"layerDefinition.maxScale"}}},wNe={json:{write:{ignoreOrigin:!0},origins:{"web-map":{read:!1,write:!1}}}},Cue=t=>{let e=class extends t{constructor(){super(...arguments),this.title=null}writeListMode(r,i,n,s){(s&&s.layerContainerType==="ground"||r&&Sht(this,n,{},s))&&(i[n]=r)}writeOperationalLayerType(r,i,n,s){!r||s&&s.layerContainerType==="tables"||(i.layerType=r)}writeTitle(r,i){i.title=r??"Layer"}read(r,i){i&&(i.layer=this),_Ie(this,r,n=>super.read(r,n),i)}write(r,i){var o,a;if(i!=null&&i.origin){const l=`${i.origin}/${i.layerContainerType||"operational-layers"}`,c=l0t[l];let u=!!(c!=null&&c[this.operationalLayerType]);if(this.operationalLayerType==="ArcGISTiledElevationServiceLayer"&&l==="web-scene/operational-layers"&&(u=!1),this.operationalLayerType==="ArcGISDimensionLayer"&&l==="web-map/operational-layers"&&(u=!1),!u)return(o=i.messages)==null||o.push(new H("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${l}'`,{layer:this})),null}const n=super.write(r,{...i,layer:this}),s=!!i&&!!i.messages&&!!i.messages.filter(l=>l instanceof H&&l.name==="web-document-write:property-required").length;return qw(n==null?void 0:n.url)?((a=i==null?void 0:i.messages)==null||a.push(new H("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&s?null:n}beforeSave(){}};return d([p({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],e.prototype,"id",void 0),d([p(wNe)],e.prototype,"listMode",void 0),d([tt("listMode")],e.prototype,"writeListMode",null),d([p({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1}}}})],e.prototype,"operationalLayerType",void 0),d([tt("operationalLayerType")],e.prototype,"writeOperationalLayerType",null),d([p(JV)],e.prototype,"opacity",void 0),d([p({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],e.prototype,"title",void 0),d([tt("title"),tt(["web-scene"],"title")],e.prototype,"writeTitle",null),d([p({type:Boolean,json:{name:"visibility"}})],e.prototype,"visible",void 0),e=d([I("esri.layers.mixins.OperationalLayer")],e),e};function cvt(t){return"operationalLayerType"in t}function OP(t){const e=t[0]*t[0]+t[4]*t[4]+t[8]*t[8],r=t[1]*t[1]+t[5]*t[5]+t[9]*t[9],i=t[2]*t[2]+t[6]*t[6]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}function uvt(t,e){const r=Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),i=Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),n=Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]);return se(t,r,i,n),t}function $pr(t,e,r){r=r||t;const i=ye(t,e);se(r,t[0]-i*e[0],t[1]-i*e[1],t[2]-i*e[2]),Se(r,r)}function dvt(t,e,r){Math.abs(t[0])>Math.abs(t[1])?se(e,0,1,0):se(e,1,0,0),Lt(r,t,e),Se(e,e),Lt(e,r,t),Se(r,r)}function hvt(t,e){return(t%e+e)%e}function Y5(t,e,r,i,n,s){const o=t+(e-t)*n;return o+(r+(i-r)*n-o)*s}function pvt(t,e,r,i=A()){const n=We(t),s=We(e),o=ye(t,e)/(n*s);if(o<.9999999999999999){const a=Math.acos(o),l=((1-r)*n+r*s)/Math.sin(a),c=l/n*Math.sin((1-r)*a),u=l/s*Math.sin(r*a);return ce(s2,t,c),ce(o2,e,u),ge(i,s2,o2)}return mi(i,t,e,r)}function Ipr(t,e,r,i=A(),n=A()){const s=We(t),o=We(e),a=ye(t,e)/(s*o);if(a<.9999999999999999){const l=Math.acos(a),c=Math.sin(l),u=Math.sin(r*l),h=Math.sin((1-r)*l),f=(1-r)*s+r*o;{const m=f/c,g=m/o*u;ce(s2,t,m/s*h),ce(o2,e,g),ge(i,s2,o2)}{const m=1/s*(-Math.cos((1-r)*l)*l*f+h*(-s+o));ce(s2,t,m);const g=1/o*(Math.cos(r*l)*l*f+u*(-s+o));ce(o2,e,g),ge(n,s2,o2),ce(n,n,1/c)}return n}return mi(i,t,e,r),ve(n,e,t),Se(n,n),n}function I8(t,e,r){t=Se(s2,t),e=Se(o2,e);const i=Vo(ye(t,e));if(r){const n=Lt(fvt,t,e);if(ye(n,r)<0)return-i}return i}function L8(t){const e=t.length;return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[e-1][0])return t[e-1][1];let i=1;for(;r>t[i][0];)i++;const n=t[i-1][0],s=t[i][0],o=(s-r)/(s-n);return o*t[i-1][1]+(1-o)*t[i][1]}}function Lpr(t,e,r,i){ve(Bve,e,t),ve(jve,r,t),Lt(i,Bve,jve),Se(i,i),i[3]=-ye(t,i)}const Bve=A(),jve=A(),fvt=A(),s2=A(),o2=A();let D8=class extends me{constructor(e){super(e),this.type=null}};d([p({type:["attachments","custom","fields","media","text","expression","relationship"],readOnly:!0,json:{read:!1,write:!0}})],D8.prototype,"type",void 0),D8=d([I("esri.popup.content.Content")],D8);const Tx=D8;var Fee;let IS=Fee=class extends Tx{constructor(t){super(t),this.description=null,this.displayType="auto",this.title=null,this.type="attachments"}clone(){return new Fee({description:this.description,displayType:this.displayType,title:this.title})}};d([p({type:String,json:{write:!0}})],IS.prototype,"description",void 0),d([p({type:["auto","preview","list"],json:{write:!0}})],IS.prototype,"displayType",void 0),d([p({type:String,json:{write:!0}})],IS.prototype,"title",void 0),d([p({type:["attachments"],readOnly:!0,json:{read:!1,write:!0}})],IS.prototype,"type",void 0),IS=Fee=d([I("esri.popup.content.AttachmentsContent")],IS);const PN=IS;var kee;let LS=kee=class extends Tx{constructor(t){super(t),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new kee({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?ie(this.outFields):null})}};d([p()],LS.prototype,"creator",void 0),d([p()],LS.prototype,"destroyer",void 0),d([p()],LS.prototype,"outFields",void 0),d([p({type:["custom"],readOnly:!0})],LS.prototype,"type",void 0),LS=kee=d([I("esri.popup.content.CustomContent")],LS);const mvt=LS;var Uee;let RR=Uee=class extends me{constructor(t){super(t),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new Uee({title:this.title,expression:this.expression})}};d([p({type:String,json:{write:!0}})],RR.prototype,"title",void 0),d([p({type:String,json:{write:!0}})],RR.prototype,"expression",void 0),d([p({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],RR.prototype,"returnType",void 0),RR=Uee=d([I("esri.popup.ElementExpressionInfo")],RR);const gvt=RR;var zee;let uI=zee=class extends Tx{constructor(t){super(t),this.expressionInfo=null,this.type="expression"}clone(){var t;return new zee({expressionInfo:(t=this.expressionInfo)==null?void 0:t.clone()})}};d([p({type:gvt,json:{write:!0}})],uI.prototype,"expressionInfo",void 0),d([p({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],uI.prototype,"type",void 0),uI=zee=d([I("esri.popup.content.ExpressionContent")],uI);const Rue=uI;class IE extends Error{}class yvt extends IE{constructor(e){super(`Invalid DateTime: ${e.toMessage()}`)}}class vvt extends IE{constructor(e){super(`Invalid Interval: ${e.toMessage()}`)}}class _vt extends IE{constructor(e){super(`Invalid Duration: ${e.toMessage()}`)}}class dI extends IE{}class xNe extends IE{constructor(e){super(`Invalid unit ${e}`)}}class Ap extends IE{}class x1 extends IE{constructor(){super("Zone is an abstract class")}}const bt="numeric",ag="short",yh="long",KV={year:bt,month:bt,day:bt},SNe={year:bt,month:ag,day:bt},bvt={year:bt,month:ag,day:bt,weekday:ag},TNe={year:bt,month:yh,day:bt},ENe={year:bt,month:yh,day:bt,weekday:yh},CNe={hour:bt,minute:bt},RNe={hour:bt,minute:bt,second:bt},ONe={hour:bt,minute:bt,second:bt,timeZoneName:ag},ANe={hour:bt,minute:bt,second:bt,timeZoneName:yh},PNe={hour:bt,minute:bt,hourCycle:"h23"},MNe={hour:bt,minute:bt,second:bt,hourCycle:"h23"},$Ne={hour:bt,minute:bt,second:bt,hourCycle:"h23",timeZoneName:ag},INe={hour:bt,minute:bt,second:bt,hourCycle:"h23",timeZoneName:yh},LNe={year:bt,month:bt,day:bt,hour:bt,minute:bt},DNe={year:bt,month:bt,day:bt,hour:bt,minute:bt,second:bt},NNe={year:bt,month:ag,day:bt,hour:bt,minute:bt},FNe={year:bt,month:ag,day:bt,hour:bt,minute:bt,second:bt},wvt={year:bt,month:ag,day:bt,weekday:ag,hour:bt,minute:bt},kNe={year:bt,month:yh,day:bt,hour:bt,minute:bt,timeZoneName:ag},UNe={year:bt,month:yh,day:bt,hour:bt,minute:bt,second:bt,timeZoneName:ag},zNe={year:bt,month:yh,day:bt,weekday:yh,hour:bt,minute:bt,timeZoneName:yh},VNe={year:bt,month:yh,day:bt,weekday:yh,hour:bt,minute:bt,second:bt,timeZoneName:yh};class oF{get type(){throw new x1}get name(){throw new x1}get ianaName(){return this.name}get isUniversal(){throw new x1}offsetName(e,r){throw new x1}formatOffset(e,r){throw new x1}offset(e){throw new x1}equals(e){throw new x1}get isValid(){throw new x1}}let cX=null;class z7 extends oF{static get instance(){return cX===null&&(cX=new z7),cX}get type(){return"system"}get name(){return new Intl.DateTimeFormat().resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return jNe(e,r,i)}formatOffset(e,r){return oD(this.offset(e),r)}offset(e){return-new Date(e).getTimezoneOffset()}equals(e){return e.type==="system"}get isValid(){return!0}}let N8={};function xvt(t){return N8[t]||(N8[t]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"})),N8[t]}const Svt={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};function Tvt(t,e){const r=t.format(e).replace(/\u200E/g,""),i=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(r),[,n,s,o,a,l,c,u]=i;return[o,n,s,a,l,c,u]}function Evt(t,e){const r=t.formatToParts(e),i=[];for(let n=0;n<r.length;n++){const{type:s,value:o}=r[n],a=Svt[s];s==="era"?i[a]=o:$i(a)||(i[a]=parseInt(o,10))}return i}let Z5={};class L_ extends oF{static create(e){return Z5[e]||(Z5[e]=new L_(e)),Z5[e]}static resetCache(){Z5={},N8={}}static isValidSpecifier(e){return this.isValidZone(e)}static isValidZone(e){if(!e)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:e}).format(),!0}catch{return!1}}constructor(e){super(),this.zoneName=e,this.valid=L_.isValidZone(e)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(e,{format:r,locale:i}){return jNe(e,r,i,this.name)}formatOffset(e,r){return oD(this.offset(e),r)}offset(e){const r=new Date(e);if(isNaN(r))return NaN;const i=xvt(this.name);let[n,s,o,a,l,c,u]=i.formatToParts?Evt(i,r):Tvt(i,r);a==="BC"&&(n=-Math.abs(n)+1);const f=Pue({year:n,month:s,day:o,hour:l===24?0:l,minute:c,second:u,millisecond:0});let m=+r;const g=m%1e3;return m-=g>=0?g:1e3+g,(f-m)/(60*1e3)}equals(e){return e.type==="iana"&&e.name===this.name}get isValid(){return this.valid}}let Gve={};function Cvt(t,e={}){const r=JSON.stringify([t,e]);let i=Gve[r];return i||(i=new Intl.ListFormat(t,e),Gve[r]=i),i}let Vee={};function Bee(t,e={}){const r=JSON.stringify([t,e]);let i=Vee[r];return i||(i=new Intl.DateTimeFormat(t,e),Vee[r]=i),i}let jee={};function Rvt(t,e={}){const r=JSON.stringify([t,e]);let i=jee[r];return i||(i=new Intl.NumberFormat(t,e),jee[r]=i),i}let Gee={};function Ovt(t,e={}){const{base:r,...i}=e,n=JSON.stringify([t,i]);let s=Gee[n];return s||(s=new Intl.RelativeTimeFormat(t,e),Gee[n]=s),s}let hI=null;function Avt(){return hI||(hI=new Intl.DateTimeFormat().resolvedOptions().locale,hI)}function Pvt(t){const e=t.indexOf("-x-");e!==-1&&(t=t.substring(0,e));const r=t.indexOf("-u-");if(r===-1)return[t];{let i,n;try{i=Bee(t).resolvedOptions(),n=t}catch{const l=t.substring(0,r);i=Bee(l).resolvedOptions(),n=l}const{numberingSystem:s,calendar:o}=i;return[n,s,o]}}function Mvt(t,e,r){return(r||e)&&(t.includes("-u-")||(t+="-u"),r&&(t+=`-ca-${r}`),e&&(t+=`-nu-${e}`)),t}function $vt(t){const e=[];for(let r=1;r<=12;r++){const i=zr.utc(2016,r,1);e.push(t(i))}return e}function Ivt(t){const e=[];for(let r=1;r<=7;r++){const i=zr.utc(2016,11,13+r);e.push(t(i))}return e}function J5(t,e,r,i,n){const s=t.listingMode(r);return s==="error"?null:s==="en"?i(e):n(e)}function Lvt(t){return t.numberingSystem&&t.numberingSystem!=="latn"?!1:t.numberingSystem==="latn"||!t.locale||t.locale.startsWith("en")||new Intl.DateTimeFormat(t.intl).resolvedOptions().numberingSystem==="latn"}class Dvt{constructor(e,r,i){this.padTo=i.padTo||0,this.floor=i.floor||!1;const{padTo:n,floor:s,...o}=i;if(!r||Object.keys(o).length>0){const a={useGrouping:!1,...i};i.padTo>0&&(a.minimumIntegerDigits=i.padTo),this.inf=Rvt(e,a)}}format(e){if(this.inf){const r=this.floor?Math.floor(e):e;return this.inf.format(r)}else{const r=this.floor?Math.floor(e):Aue(e,3);return na(r,this.padTo)}}}class Nvt{constructor(e,r,i){this.opts=i,this.originalZone=void 0;let n;if(this.opts.timeZone)this.dt=e;else if(e.zone.type==="fixed"){const o=-1*(e.offset/60),a=o>=0?`Etc/GMT+${o}`:`Etc/GMT${o}`;e.offset!==0&&L_.create(a).valid?(n=a,this.dt=e):(n="UTC",this.dt=e.offset===0?e:e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone)}else e.zone.type==="system"?this.dt=e:e.zone.type==="iana"?(this.dt=e,n=e.zone.name):(n="UTC",this.dt=e.setZone("UTC").plus({minutes:e.offset}),this.originalZone=e.zone);const s={...this.opts};s.timeZone=s.timeZone||n,this.dtf=Bee(r,s)}format(){return this.originalZone?this.formatToParts().map(({value:e})=>e).join(""):this.dtf.format(this.dt.toJSDate())}formatToParts(){const e=this.dtf.formatToParts(this.dt.toJSDate());return this.originalZone?e.map(r=>{if(r.type==="timeZoneName"){const i=this.originalZone.offsetName(this.dt.ts,{locale:this.dt.locale,format:this.opts.timeZoneName});return{...r,value:i}}else return r}):e}resolvedOptions(){return this.dtf.resolvedOptions()}}class Fvt{constructor(e,r,i){this.opts={style:"long",...i},!r&&BNe()&&(this.rtf=Ovt(e,i))}format(e,r){return this.rtf?this.rtf.format(e,r):e_t(r,e,this.opts.numeric,this.opts.style!=="long")}formatToParts(e,r){return this.rtf?this.rtf.formatToParts(e,r):[]}}class vs{static fromOpts(e){return vs.create(e.locale,e.numberingSystem,e.outputCalendar,e.defaultToEN)}static create(e,r,i,n=!1){const s=e||ta.defaultLocale,o=s||(n?"en-US":Avt()),a=r||ta.defaultNumberingSystem,l=i||ta.defaultOutputCalendar;return new vs(o,a,l,s)}static resetCache(){hI=null,Vee={},jee={},Gee={}}static fromObject({locale:e,numberingSystem:r,outputCalendar:i}={}){return vs.create(e,r,i)}constructor(e,r,i,n){const[s,o,a]=Pvt(e);this.locale=s,this.numberingSystem=r||o||null,this.outputCalendar=i||a||null,this.intl=Mvt(this.locale,this.numberingSystem,this.outputCalendar),this.weekdaysCache={format:{},standalone:{}},this.monthsCache={format:{},standalone:{}},this.meridiemCache=null,this.eraCache={},this.specifiedLocale=n,this.fastNumbersCached=null}get fastNumbers(){return this.fastNumbersCached==null&&(this.fastNumbersCached=Lvt(this)),this.fastNumbersCached}listingMode(){const e=this.isEnglish(),r=(this.numberingSystem===null||this.numberingSystem==="latn")&&(this.outputCalendar===null||this.outputCalendar==="gregory");return e&&r?"en":"intl"}clone(e){return!e||Object.getOwnPropertyNames(e).length===0?this:vs.create(e.locale||this.specifiedLocale,e.numberingSystem||this.numberingSystem,e.outputCalendar||this.outputCalendar,e.defaultToEN||!1)}redefaultToEN(e={}){return this.clone({...e,defaultToEN:!0})}redefaultToSystem(e={}){return this.clone({...e,defaultToEN:!1})}months(e,r=!1,i=!0){return J5(this,e,i,qNe,()=>{const n=r?{month:e,day:"numeric"}:{month:e},s=r?"format":"standalone";return this.monthsCache[s][e]||(this.monthsCache[s][e]=$vt(o=>this.extract(o,n,"month"))),this.monthsCache[s][e]})}weekdays(e,r=!1,i=!0){return J5(this,e,i,YNe,()=>{const n=r?{weekday:e,year:"numeric",month:"long",day:"numeric"}:{weekday:e},s=r?"format":"standalone";return this.weekdaysCache[s][e]||(this.weekdaysCache[s][e]=Ivt(o=>this.extract(o,n,"weekday"))),this.weekdaysCache[s][e]})}meridiems(e=!0){return J5(this,void 0,e,()=>ZNe,()=>{if(!this.meridiemCache){const r={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[zr.utc(2016,11,13,9),zr.utc(2016,11,13,19)].map(i=>this.extract(i,r,"dayperiod"))}return this.meridiemCache})}eras(e,r=!0){return J5(this,e,r,JNe,()=>{const i={era:e};return this.eraCache[e]||(this.eraCache[e]=[zr.utc(-40,1,1),zr.utc(2017,1,1)].map(n=>this.extract(n,i,"era"))),this.eraCache[e]})}extract(e,r,i){const n=this.dtFormatter(e,r),s=n.formatToParts(),o=s.find(a=>a.type.toLowerCase()===i);return o?o.value:null}numberFormatter(e={}){return new Dvt(this.intl,e.forceSimple||this.fastNumbers,e)}dtFormatter(e,r={}){return new Nvt(e,this.intl,r)}relFormatter(e={}){return new Fvt(this.intl,this.isEnglish(),e)}listFormatter(e={}){return Cvt(this.intl,e)}isEnglish(){return this.locale==="en"||this.locale.toLowerCase()==="en-us"||new Intl.DateTimeFormat(this.intl).resolvedOptions().locale.startsWith("en-us")}equals(e){return this.locale===e.locale&&this.numberingSystem===e.numberingSystem&&this.outputCalendar===e.outputCalendar}}let uX=null;class wc extends oF{static get utcInstance(){return uX===null&&(uX=new wc(0)),uX}static instance(e){return e===0?wc.utcInstance:new wc(e)}static parseSpecifier(e){if(e){const r=e.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i);if(r)return new wc(B7(r[1],r[2]))}return null}constructor(e){super(),this.fixed=e}get type(){return"fixed"}get name(){return this.fixed===0?"UTC":`UTC${oD(this.fixed,"narrow")}`}get ianaName(){return this.fixed===0?"Etc/UTC":`Etc/GMT${oD(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(e,r){return oD(this.fixed,r)}get isUniversal(){return!0}offset(){return this.fixed}equals(e){return e.type==="fixed"&&e.fixed===this.fixed}get isValid(){return!0}}class kvt extends oF{constructor(e){super(),this.zoneName=e}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}function Jb(t,e){if($i(t)||t===null)return e;if(t instanceof oF)return t;if(Uvt(t)){const r=t.toLowerCase();return r==="default"?e:r==="local"||r==="system"?z7.instance:r==="utc"||r==="gmt"?wc.utcInstance:wc.parseSpecifier(r)||L_.create(t)}else return w2(t)?wc.instance(t):typeof t=="object"&&t.offset&&typeof t.offset=="number"?t:new kvt(t)}let Hve=()=>Date.now(),qve="system",Wve=null,Xve=null,Yve=null,Zve=60,Jve;class ta{static get now(){return Hve}static set now(e){Hve=e}static set defaultZone(e){qve=e}static get defaultZone(){return Jb(qve,z7.instance)}static get defaultLocale(){return Wve}static set defaultLocale(e){Wve=e}static get defaultNumberingSystem(){return Xve}static set defaultNumberingSystem(e){Xve=e}static get defaultOutputCalendar(){return Yve}static set defaultOutputCalendar(e){Yve=e}static get twoDigitCutoffYear(){return Zve}static set twoDigitCutoffYear(e){Zve=e%100}static get throwOnInvalid(){return Jve}static set throwOnInvalid(e){Jve=e}static resetCaches(){vs.resetCache(),L_.resetCache()}}function $i(t){return typeof t>"u"}function w2(t){return typeof t=="number"}function V7(t){return typeof t=="number"&&t%1===0}function Uvt(t){return typeof t=="string"}function zvt(t){return Object.prototype.toString.call(t)==="[object Date]"}function BNe(){try{return typeof Intl<"u"&&!!Intl.RelativeTimeFormat}catch{return!1}}function Vvt(t){return Array.isArray(t)?t:[t]}function Kve(t,e,r){if(t.length!==0)return t.reduce((i,n)=>{const s=[e(n),n];return i&&r(i[0],s[0])===i[0]?i:s},null)[1]}function Bvt(t,e){return e.reduce((r,i)=>(r[i]=t[i],r),{})}function AP(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Wv(t,e,r){return V7(t)&&t>=e&&t<=r}function jvt(t,e){return t-e*Math.floor(t/e)}function na(t,e=2){const r=t<0;let i;return r?i="-"+(""+-t).padStart(e,"0"):i=(""+t).padStart(e,"0"),i}function kb(t){if(!($i(t)||t===null||t===""))return parseInt(t,10)}function Vx(t){if(!($i(t)||t===null||t===""))return parseFloat(t)}function Oue(t){if(!($i(t)||t===null||t==="")){const e=parseFloat("0."+t)*1e3;return Math.floor(e)}}function Aue(t,e,r=!1){const i=10**e;return(r?Math.trunc:Math.round)(t*i)/i}function aF(t){return t%4===0&&(t%100!==0||t%400===0)}function sD(t){return aF(t)?366:365}function QV(t,e){const r=jvt(e-1,12)+1,i=t+(e-r)/12;return r===2?aF(i)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][r-1]}function Pue(t){let e=Date.UTC(t.year,t.month-1,t.day,t.hour,t.minute,t.second,t.millisecond);return t.year<100&&t.year>=0&&(e=new Date(e),e.setUTCFullYear(t.year,t.month-1,t.day)),+e}function eB(t){const e=(t+Math.floor(t/4)-Math.floor(t/100)+Math.floor(t/400))%7,r=t-1,i=(r+Math.floor(r/4)-Math.floor(r/100)+Math.floor(r/400))%7;return e===4||i===3?53:52}function Hee(t){return t>99?t:t>ta.twoDigitCutoffYear?1900+t:2e3+t}function jNe(t,e,r,i=null){const n=new Date(t),s={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};i&&(s.timeZone=i);const o={timeZoneName:e,...s},a=new Intl.DateTimeFormat(r,o).formatToParts(n).find(l=>l.type.toLowerCase()==="timezonename");return a?a.value:null}function B7(t,e){let r=parseInt(t,10);Number.isNaN(r)&&(r=0);const i=parseInt(e,10)||0,n=r<0||Object.is(r,-0)?-i:i;return r*60+n}function GNe(t){const e=Number(t);if(typeof t=="boolean"||t===""||Number.isNaN(e))throw new Ap(`Invalid unit value ${t}`);return e}function tB(t,e){const r={};for(const i in t)if(AP(t,i)){const n=t[i];if(n==null)continue;r[e(i)]=GNe(n)}return r}function oD(t,e){const r=Math.trunc(Math.abs(t/60)),i=Math.trunc(Math.abs(t%60)),n=t>=0?"+":"-";switch(e){case"short":return`${n}${na(r,2)}:${na(i,2)}`;case"narrow":return`${n}${r}${i>0?`:${i}`:""}`;case"techie":return`${n}${na(r,2)}${na(i,2)}`;default:throw new RangeError(`Value format ${e} is out of range for property format`)}}function j7(t){return Bvt(t,["hour","minute","second","millisecond"])}const Gvt=["January","February","March","April","May","June","July","August","September","October","November","December"],HNe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Hvt=["J","F","M","A","M","J","J","A","S","O","N","D"];function qNe(t){switch(t){case"narrow":return[...Hvt];case"short":return[...HNe];case"long":return[...Gvt];case"numeric":return["1","2","3","4","5","6","7","8","9","10","11","12"];case"2-digit":return["01","02","03","04","05","06","07","08","09","10","11","12"];default:return null}}const WNe=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],XNe=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],qvt=["M","T","W","T","F","S","S"];function YNe(t){switch(t){case"narrow":return[...qvt];case"short":return[...XNe];case"long":return[...WNe];case"numeric":return["1","2","3","4","5","6","7"];default:return null}}const ZNe=["AM","PM"],Wvt=["Before Christ","Anno Domini"],Xvt=["BC","AD"],Yvt=["B","A"];function JNe(t){switch(t){case"narrow":return[...Yvt];case"short":return[...Xvt];case"long":return[...Wvt];default:return null}}function Zvt(t){return ZNe[t.hour<12?0:1]}function Jvt(t,e){return YNe(e)[t.weekday-1]}function Kvt(t,e){return qNe(e)[t.month-1]}function Qvt(t,e){return JNe(e)[t.year<0?0:1]}function e_t(t,e,r="always",i=!1){const n={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]},s=["hours","minutes","seconds"].indexOf(t)===-1;if(r==="auto"&&s){const h=t==="days";switch(e){case 1:return h?"tomorrow":`next ${n[t][0]}`;case-1:return h?"yesterday":`last ${n[t][0]}`;case 0:return h?"today":`this ${n[t][0]}`}}const o=Object.is(e,-0)||e<0,a=Math.abs(e),l=a===1,c=n[t],u=i?l?c[1]:c[2]||c[1]:l?n[t][0]:t;return o?`${a} ${u} ago`:`in ${a} ${u}`}function Qve(t,e){let r="";for(const i of t)i.literal?r+=i.val:r+=e(i.val);return r}const t_t={D:KV,DD:SNe,DDD:TNe,DDDD:ENe,t:CNe,tt:RNe,ttt:ONe,tttt:ANe,T:PNe,TT:MNe,TTT:$Ne,TTTT:INe,f:LNe,ff:NNe,fff:kNe,ffff:zNe,F:DNe,FF:FNe,FFF:UNe,FFFF:VNe};class _c{static create(e,r={}){return new _c(e,r)}static parseFormat(e){let r=null,i="",n=!1;const s=[];for(let o=0;o<e.length;o++){const a=e.charAt(o);a==="'"?(i.length>0&&s.push({literal:n||/^\s+$/.test(i),val:i}),r=null,i="",n=!n):n||a===r?i+=a:(i.length>0&&s.push({literal:/^\s+$/.test(i),val:i}),i=a,r=a)}return i.length>0&&s.push({literal:n||/^\s+$/.test(i),val:i}),s}static macroTokenToFormatOpts(e){return t_t[e]}constructor(e,r){this.opts=r,this.loc=e,this.systemLoc=null}formatWithSystemDefault(e,r){return this.systemLoc===null&&(this.systemLoc=this.loc.redefaultToSystem()),this.systemLoc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTime(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).format()}formatDateTimeParts(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).formatToParts()}formatInterval(e,r={}){return this.loc.dtFormatter(e.start,{...this.opts,...r}).dtf.formatRange(e.start.toJSDate(),e.end.toJSDate())}resolvedOptions(e,r={}){return this.loc.dtFormatter(e,{...this.opts,...r}).resolvedOptions()}num(e,r=0){if(this.opts.forceSimple)return na(e,r);const i={...this.opts};return r>0&&(i.padTo=r),this.loc.numberFormatter(i).format(e)}formatDateTimeFromString(e,r){const i=this.loc.listingMode()==="en",n=this.loc.outputCalendar&&this.loc.outputCalendar!=="gregory",s=(m,g)=>this.loc.extract(e,m,g),o=m=>e.isOffsetFixed&&e.offset===0&&m.allowZ?"Z":e.isValid?e.zone.formatOffset(e.ts,m.format):"",a=()=>i?Zvt(e):s({hour:"numeric",hourCycle:"h12"},"dayperiod"),l=(m,g)=>i?Kvt(e,m):s(g?{month:m}:{month:m,day:"numeric"},"month"),c=(m,g)=>i?Jvt(e,m):s(g?{weekday:m}:{weekday:m,month:"long",day:"numeric"},"weekday"),u=m=>{const g=_c.macroTokenToFormatOpts(m);return g?this.formatWithSystemDefault(e,g):m},h=m=>i?Qvt(e,m):s({era:m},"era"),f=m=>{switch(m){case"S":return this.num(e.millisecond);case"u":case"SSS":return this.num(e.millisecond,3);case"s":return this.num(e.second);case"ss":return this.num(e.second,2);case"uu":return this.num(Math.floor(e.millisecond/10),2);case"uuu":return this.num(Math.floor(e.millisecond/100));case"m":return this.num(e.minute);case"mm":return this.num(e.minute,2);case"h":return this.num(e.hour%12===0?12:e.hour%12);case"hh":return this.num(e.hour%12===0?12:e.hour%12,2);case"H":return this.num(e.hour);case"HH":return this.num(e.hour,2);case"Z":return o({format:"narrow",allowZ:this.opts.allowZ});case"ZZ":return o({format:"short",allowZ:this.opts.allowZ});case"ZZZ":return o({format:"techie",allowZ:this.opts.allowZ});case"ZZZZ":return e.zone.offsetName(e.ts,{format:"short",locale:this.loc.locale});case"ZZZZZ":return e.zone.offsetName(e.ts,{format:"long",locale:this.loc.locale});case"z":return e.zoneName;case"a":return a();case"d":return n?s({day:"numeric"},"day"):this.num(e.day);case"dd":return n?s({day:"2-digit"},"day"):this.num(e.day,2);case"c":return this.num(e.weekday);case"ccc":return c("short",!0);case"cccc":return c("long",!0);case"ccccc":return c("narrow",!0);case"E":return this.num(e.weekday);case"EEE":return c("short",!1);case"EEEE":return c("long",!1);case"EEEEE":return c("narrow",!1);case"L":return n?s({month:"numeric",day:"numeric"},"month"):this.num(e.month);case"LL":return n?s({month:"2-digit",day:"numeric"},"month"):this.num(e.month,2);case"LLL":return l("short",!0);case"LLLL":return l("long",!0);case"LLLLL":return l("narrow",!0);case"M":return n?s({month:"numeric"},"month"):this.num(e.month);case"MM":return n?s({month:"2-digit"},"month"):this.num(e.month,2);case"MMM":return l("short",!1);case"MMMM":return l("long",!1);case"MMMMM":return l("narrow",!1);case"y":return n?s({year:"numeric"},"year"):this.num(e.year);case"yy":return n?s({year:"2-digit"},"year"):this.num(e.year.toString().slice(-2),2);case"yyyy":return n?s({year:"numeric"},"year"):this.num(e.year,4);case"yyyyyy":return n?s({year:"numeric"},"year"):this.num(e.year,6);case"G":return h("short");case"GG":return h("long");case"GGGGG":return h("narrow");case"kk":return this.num(e.weekYear.toString().slice(-2),2);case"kkkk":return this.num(e.weekYear,4);case"W":return this.num(e.weekNumber);case"WW":return this.num(e.weekNumber,2);case"o":return this.num(e.ordinal);case"ooo":return this.num(e.ordinal,3);case"q":return this.num(e.quarter);case"qq":return this.num(e.quarter,2);case"X":return this.num(Math.floor(e.ts/1e3));case"x":return this.num(e.ts);default:return u(m)}};return Qve(_c.parseFormat(r),f)}formatDurationFromString(e,r){const i=l=>{switch(l[0]){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":return"hour";case"d":return"day";case"w":return"week";case"M":return"month";case"y":return"year";default:return null}},n=l=>c=>{const u=i(c);return u?this.num(l.get(u),c.length):c},s=_c.parseFormat(r),o=s.reduce((l,{literal:c,val:u})=>c?l:l.concat(u),[]),a=e.shiftTo(...o.map(i).filter(l=>l));return Qve(s,n(a))}}class Nm{constructor(e,r){this.reason=e,this.explanation=r}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}const KNe=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/;function M3(...t){const e=t.reduce((r,i)=>r+i.source,"");return RegExp(`^${e}$`)}function $3(...t){return e=>t.reduce(([r,i,n],s)=>{const[o,a,l]=s(e,n);return[{...r,...o},a||i,l]},[{},null,1]).slice(0,2)}function I3(t,...e){if(t==null)return[null,null];for(const[r,i]of e){const n=r.exec(t);if(n)return i(n)}return[null,null]}function QNe(...t){return(e,r)=>{const i={};let n;for(n=0;n<t.length;n++)i[t[n]]=kb(e[r+n]);return[i,null,r+n]}}const e4e=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,r_t=`(?:${e4e.source}?(?:\\[(${KNe.source})\\])?)?`,Mue=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,t4e=RegExp(`${Mue.source}${r_t}`),$ue=RegExp(`(?:T${t4e.source})?`),i_t=/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,n_t=/(\d{4})-?W(\d\d)(?:-?(\d))?/,s_t=/(\d{4})-?(\d{3})/,o_t=QNe("weekYear","weekNumber","weekDay"),a_t=QNe("year","ordinal"),l_t=/(\d{4})-(\d\d)-(\d\d)/,r4e=RegExp(`${Mue.source} ?(?:${e4e.source}|(${KNe.source}))?`),c_t=RegExp(`(?: ${r4e.source})?`);function EA(t,e,r){const i=t[e];return $i(i)?r:kb(i)}function u_t(t,e){return[{year:EA(t,e),month:EA(t,e+1,1),day:EA(t,e+2,1)},null,e+3]}function L3(t,e){return[{hours:EA(t,e,0),minutes:EA(t,e+1,0),seconds:EA(t,e+2,0),milliseconds:Oue(t[e+3])},null,e+4]}function lF(t,e){const r=!t[e]&&!t[e+1],i=B7(t[e+1],t[e+2]),n=r?null:wc.instance(i);return[{},n,e+3]}function cF(t,e){const r=t[e]?L_.create(t[e]):null;return[{},r,e+1]}const d_t=RegExp(`^T?${Mue.source}$`),h_t=/^-?P(?:(?:(-?\d{1,20}(?:\.\d{1,20})?)Y)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20}(?:\.\d{1,20})?)W)?(?:(-?\d{1,20}(?:\.\d{1,20})?)D)?(?:T(?:(-?\d{1,20}(?:\.\d{1,20})?)H)?(?:(-?\d{1,20}(?:\.\d{1,20})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,20}))?S)?)?)$/;function p_t(t){const[e,r,i,n,s,o,a,l,c]=t,u=e[0]==="-",h=l&&l[0]==="-",f=(m,g=!1)=>m!==void 0&&(g||m&&u)?-m:m;return[{years:f(Vx(r)),months:f(Vx(i)),weeks:f(Vx(n)),days:f(Vx(s)),hours:f(Vx(o)),minutes:f(Vx(a)),seconds:f(Vx(l),l==="-0"),milliseconds:f(Oue(c),h)}]}const f_t={GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Iue(t,e,r,i,n,s,o){const a={year:e.length===2?Hee(kb(e)):kb(e),month:HNe.indexOf(r)+1,day:kb(i),hour:kb(n),minute:kb(s)};return o&&(a.second=kb(o)),t&&(a.weekday=t.length>3?WNe.indexOf(t)+1:XNe.indexOf(t)+1),a}const m_t=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/;function g_t(t){const[,e,r,i,n,s,o,a,l,c,u,h]=t,f=Iue(e,n,i,r,s,o,a);let m;return l?m=f_t[l]:c?m=0:m=B7(u,h),[f,new wc(m)]}function y_t(t){return t.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}const v_t=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,__t=/^(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,b_t=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/;function e_e(t){const[,e,r,i,n,s,o,a]=t;return[Iue(e,n,i,r,s,o,a),wc.utcInstance]}function w_t(t){const[,e,r,i,n,s,o,a]=t;return[Iue(e,a,r,i,n,s,o),wc.utcInstance]}const x_t=M3(i_t,$ue),S_t=M3(n_t,$ue),T_t=M3(s_t,$ue),E_t=M3(t4e),i4e=$3(u_t,L3,lF,cF),C_t=$3(o_t,L3,lF,cF),R_t=$3(a_t,L3,lF,cF),O_t=$3(L3,lF,cF);function A_t(t){return I3(t,[x_t,i4e],[S_t,C_t],[T_t,R_t],[E_t,O_t])}function P_t(t){return I3(y_t(t),[m_t,g_t])}function M_t(t){return I3(t,[v_t,e_e],[__t,e_e],[b_t,w_t])}function $_t(t){return I3(t,[h_t,p_t])}const I_t=$3(L3);function L_t(t){return I3(t,[d_t,I_t])}const D_t=M3(l_t,c_t),N_t=M3(r4e),F_t=$3(L3,lF,cF);function k_t(t){return I3(t,[D_t,i4e],[N_t,F_t])}const U_t="Invalid Duration",n4e={weeks:{days:7,hours:7*24,minutes:7*24*60,seconds:7*24*60*60,milliseconds:7*24*60*60*1e3},days:{hours:24,minutes:24*60,seconds:24*60*60,milliseconds:24*60*60*1e3},hours:{minutes:60,seconds:60*60,milliseconds:60*60*1e3},minutes:{seconds:60,milliseconds:60*1e3},seconds:{milliseconds:1e3}},z_t={years:{quarters:4,months:12,weeks:52,days:365,hours:365*24,minutes:365*24*60,seconds:365*24*60*60,milliseconds:365*24*60*60*1e3},quarters:{months:3,weeks:13,days:91,hours:91*24,minutes:91*24*60,seconds:91*24*60*60,milliseconds:91*24*60*60*1e3},months:{weeks:4,days:30,hours:30*24,minutes:30*24*60,seconds:30*24*60*60,milliseconds:30*24*60*60*1e3},...n4e},zh=146097/400,aC=146097/4800,V_t={years:{quarters:4,months:12,weeks:zh/7,days:zh,hours:zh*24,minutes:zh*24*60,seconds:zh*24*60*60,milliseconds:zh*24*60*60*1e3},quarters:{months:3,weeks:zh/28,days:zh/4,hours:zh*24/4,minutes:zh*24*60/4,seconds:zh*24*60*60/4,milliseconds:zh*24*60*60*1e3/4},months:{weeks:aC/7,days:aC,hours:aC*24,minutes:aC*24*60,seconds:aC*24*60*60,milliseconds:aC*24*60*60*1e3},...n4e},DS=["years","quarters","months","weeks","days","hours","minutes","seconds","milliseconds"],B_t=DS.slice(0).reverse();function S1(t,e,r=!1){const i={values:r?e.values:{...t.values,...e.values||{}},loc:t.loc.clone(e.loc),conversionAccuracy:e.conversionAccuracy||t.conversionAccuracy,matrix:e.matrix||t.matrix};return new ki(i)}function j_t(t){return t<0?Math.floor(t):Math.ceil(t)}function s4e(t,e,r,i,n){const s=t[n][r],o=e[r]/s,a=Math.sign(o)===Math.sign(i[n]),l=!a&&i[n]!==0&&Math.abs(o)<=1?j_t(o):Math.trunc(o);i[n]+=l,e[r]-=l*s}function G_t(t,e){B_t.reduce((r,i)=>$i(e[i])?r:(r&&s4e(t,e,r,e,i),i),null)}function H_t(t){const e={};for(const[r,i]of Object.entries(t))i!==0&&(e[r]=i);return e}class ki{constructor(e){const r=e.conversionAccuracy==="longterm"||!1;let i=r?V_t:z_t;e.matrix&&(i=e.matrix),this.values=e.values,this.loc=e.loc||vs.create(),this.conversionAccuracy=r?"longterm":"casual",this.invalid=e.invalid||null,this.matrix=i,this.isLuxonDuration=!0}static fromMillis(e,r){return ki.fromObject({milliseconds:e},r)}static fromObject(e,r={}){if(e==null||typeof e!="object")throw new Ap(`Duration.fromObject: argument expected to be an object, got ${e===null?"null":typeof e}`);return new ki({values:tB(e,ki.normalizeUnit),loc:vs.fromObject(r),conversionAccuracy:r.conversionAccuracy,matrix:r.matrix})}static fromDurationLike(e){if(w2(e))return ki.fromMillis(e);if(ki.isDuration(e))return e;if(typeof e=="object")return ki.fromObject(e);throw new Ap(`Unknown duration argument ${e} of type ${typeof e}`)}static fromISO(e,r){const[i]=$_t(e);return i?ki.fromObject(i,r):ki.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static fromISOTime(e,r){const[i]=L_t(e);return i?ki.fromObject(i,r):ki.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static invalid(e,r=null){if(!e)throw new Ap("need to specify a reason the Duration is invalid");const i=e instanceof Nm?e:new Nm(e,r);if(ta.throwOnInvalid)throw new _vt(i);return new ki({invalid:i})}static normalizeUnit(e){const r={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[e&&e.toLowerCase()];if(!r)throw new xNe(e);return r}static isDuration(e){return e&&e.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(e,r={}){const i={...r,floor:r.round!==!1&&r.floor!==!1};return this.isValid?_c.create(this.loc,i).formatDurationFromString(this,e):U_t}toHuman(e={}){const r=DS.map(i=>{const n=this.values[i];return $i(n)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...e,unit:i.slice(0,-1)}).format(n)}).filter(i=>i);return this.loc.listFormatter({type:"conjunction",style:e.listStyle||"narrow",...e}).format(r)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let e="P";return this.years!==0&&(e+=this.years+"Y"),(this.months!==0||this.quarters!==0)&&(e+=this.months+this.quarters*3+"M"),this.weeks!==0&&(e+=this.weeks+"W"),this.days!==0&&(e+=this.days+"D"),(this.hours!==0||this.minutes!==0||this.seconds!==0||this.milliseconds!==0)&&(e+="T"),this.hours!==0&&(e+=this.hours+"H"),this.minutes!==0&&(e+=this.minutes+"M"),(this.seconds!==0||this.milliseconds!==0)&&(e+=Aue(this.seconds+this.milliseconds/1e3,3)+"S"),e==="P"&&(e+="T0S"),e}toISOTime(e={}){if(!this.isValid)return null;const r=this.toMillis();if(r<0||r>=864e5)return null;e={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...e};const i=this.shiftTo("hours","minutes","seconds","milliseconds");let n=e.format==="basic"?"hhmm":"hh:mm";(!e.suppressSeconds||i.seconds!==0||i.milliseconds!==0)&&(n+=e.format==="basic"?"ss":":ss",(!e.suppressMilliseconds||i.milliseconds!==0)&&(n+=".SSS"));let s=i.toFormat(n);return e.includePrefix&&(s="T"+s),s}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(e){if(!this.isValid)return this;const r=ki.fromDurationLike(e),i={};for(const n of DS)(AP(r.values,n)||AP(this.values,n))&&(i[n]=r.get(n)+this.get(n));return S1(this,{values:i},!0)}minus(e){if(!this.isValid)return this;const r=ki.fromDurationLike(e);return this.plus(r.negate())}mapUnits(e){if(!this.isValid)return this;const r={};for(const i of Object.keys(this.values))r[i]=GNe(e(this.values[i],i));return S1(this,{values:r},!0)}get(e){return this[ki.normalizeUnit(e)]}set(e){if(!this.isValid)return this;const r={...this.values,...tB(e,ki.normalizeUnit)};return S1(this,{values:r})}reconfigure({locale:e,numberingSystem:r,conversionAccuracy:i,matrix:n}={}){const o={loc:this.loc.clone({locale:e,numberingSystem:r}),matrix:n,conversionAccuracy:i};return S1(this,o)}as(e){return this.isValid?this.shiftTo(e).get(e):NaN}normalize(){if(!this.isValid)return this;const e=this.toObject();return G_t(this.matrix,e),S1(this,{values:e},!0)}rescale(){if(!this.isValid)return this;const e=H_t(this.normalize().shiftToAll().toObject());return S1(this,{values:e},!0)}shiftTo(...e){if(!this.isValid)return this;if(e.length===0)return this;e=e.map(o=>ki.normalizeUnit(o));const r={},i={},n=this.toObject();let s;for(const o of DS)if(e.indexOf(o)>=0){s=o;let a=0;for(const c in i)a+=this.matrix[c][o]*i[c],i[c]=0;w2(n[o])&&(a+=n[o]);const l=Math.trunc(a);r[o]=l,i[o]=(a*1e3-l*1e3)/1e3;for(const c in n)DS.indexOf(c)>DS.indexOf(o)&&s4e(this.matrix,n,c,r,o)}else w2(n[o])&&(i[o]=n[o]);for(const o in i)i[o]!==0&&(r[s]+=o===s?i[o]:i[o]/this.matrix[s][o]);return S1(this,{values:r},!0).normalize()}shiftToAll(){return this.isValid?this.shiftTo("years","months","weeks","days","hours","minutes","seconds","milliseconds"):this}negate(){if(!this.isValid)return this;const e={};for(const r of Object.keys(this.values))e[r]=this.values[r]===0?0:-this.values[r];return S1(this,{values:e},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(e){if(!this.isValid||!e.isValid||!this.loc.equals(e.loc))return!1;function r(i,n){return i===void 0||i===0?n===void 0||n===0:i===n}for(const i of DS)if(!r(this.values[i],e.values[i]))return!1;return!0}}const lC="Invalid Interval";function q_t(t,e){return!t||!t.isValid?uo.invalid("missing or invalid start"):!e||!e.isValid?uo.invalid("missing or invalid end"):e<t?uo.invalid("end before start",`The end of an interval must be after its start, but you had start=${t.toISO()} and end=${e.toISO()}`):null}class uo{constructor(e){this.s=e.start,this.e=e.end,this.invalid=e.invalid||null,this.isLuxonInterval=!0}static invalid(e,r=null){if(!e)throw new Ap("need to specify a reason the Interval is invalid");const i=e instanceof Nm?e:new Nm(e,r);if(ta.throwOnInvalid)throw new vvt(i);return new uo({invalid:i})}static fromDateTimes(e,r){const i=MM(e),n=MM(r),s=q_t(i,n);return s??new uo({start:i,end:n})}static after(e,r){const i=ki.fromDurationLike(r),n=MM(e);return uo.fromDateTimes(n,n.plus(i))}static before(e,r){const i=ki.fromDurationLike(r),n=MM(e);return uo.fromDateTimes(n.minus(i),n)}static fromISO(e,r){const[i,n]=(e||"").split("/",2);if(i&&n){let s,o;try{s=zr.fromISO(i,r),o=s.isValid}catch{o=!1}let a,l;try{a=zr.fromISO(n,r),l=a.isValid}catch{l=!1}if(o&&l)return uo.fromDateTimes(s,a);if(o){const c=ki.fromISO(n,r);if(c.isValid)return uo.after(s,c)}else if(l){const c=ki.fromISO(i,r);if(c.isValid)return uo.before(a,c)}}return uo.invalid("unparsable",`the input "${e}" can't be parsed as ISO 8601`)}static isInterval(e){return e&&e.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return this.invalidReason===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(e="milliseconds"){return this.isValid?this.toDuration(e).get(e):NaN}count(e="milliseconds"){if(!this.isValid)return NaN;const r=this.start.startOf(e),i=this.end.startOf(e);return Math.floor(i.diff(r,e).get(e))+(i.valueOf()!==this.end.valueOf())}hasSame(e){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,e):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(e){return this.isValid?this.s>e:!1}isBefore(e){return this.isValid?this.e<=e:!1}contains(e){return this.isValid?this.s<=e&&this.e>e:!1}set({start:e,end:r}={}){return this.isValid?uo.fromDateTimes(e||this.s,r||this.e):this}splitAt(...e){if(!this.isValid)return[];const r=e.map(MM).filter(o=>this.contains(o)).sort(),i=[];let{s:n}=this,s=0;for(;n<this.e;){const o=r[s]||this.e,a=+o>+this.e?this.e:o;i.push(uo.fromDateTimes(n,a)),n=a,s+=1}return i}splitBy(e){const r=ki.fromDurationLike(e);if(!this.isValid||!r.isValid||r.as("milliseconds")===0)return[];let{s:i}=this,n=1,s;const o=[];for(;i<this.e;){const a=this.start.plus(r.mapUnits(l=>l*n));s=+a>+this.e?this.e:a,o.push(uo.fromDateTimes(i,s)),i=s,n+=1}return o}divideEqually(e){return this.isValid?this.splitBy(this.length()/e).slice(0,e):[]}overlaps(e){return this.e>e.s&&this.s<e.e}abutsStart(e){return this.isValid?+this.e==+e.s:!1}abutsEnd(e){return this.isValid?+e.e==+this.s:!1}engulfs(e){return this.isValid?this.s<=e.s&&this.e>=e.e:!1}equals(e){return!this.isValid||!e.isValid?!1:this.s.equals(e.s)&&this.e.equals(e.e)}intersection(e){if(!this.isValid)return this;const r=this.s>e.s?this.s:e.s,i=this.e<e.e?this.e:e.e;return r>=i?null:uo.fromDateTimes(r,i)}union(e){if(!this.isValid)return this;const r=this.s<e.s?this.s:e.s,i=this.e>e.e?this.e:e.e;return uo.fromDateTimes(r,i)}static merge(e){const[r,i]=e.sort((n,s)=>n.s-s.s).reduce(([n,s],o)=>s?s.overlaps(o)||s.abutsStart(o)?[n,s.union(o)]:[n.concat([s]),o]:[n,o],[[],null]);return i&&r.push(i),r}static xor(e){let r=null,i=0;const n=[],s=e.map(l=>[{time:l.s,type:"s"},{time:l.e,type:"e"}]),o=Array.prototype.concat(...s),a=o.sort((l,c)=>l.time-c.time);for(const l of a)i+=l.type==="s"?1:-1,i===1?r=l.time:(r&&+r!=+l.time&&n.push(uo.fromDateTimes(r,l.time)),r=null);return uo.merge(n)}difference(...e){return uo.xor([this].concat(e)).map(r=>this.intersection(r)).filter(r=>r&&!r.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()}  ${this.e.toISO()})`:lC}toLocaleString(e=KV,r={}){return this.isValid?_c.create(this.s.loc.clone(r),e).formatInterval(this):lC}toISO(e){return this.isValid?`${this.s.toISO(e)}/${this.e.toISO(e)}`:lC}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:lC}toISOTime(e){return this.isValid?`${this.s.toISOTime(e)}/${this.e.toISOTime(e)}`:lC}toFormat(e,{separator:r="  "}={}){return this.isValid?`${this.s.toFormat(e)}${r}${this.e.toFormat(e)}`:lC}toDuration(e,r){return this.isValid?this.e.diff(this.s,e,r):ki.invalid(this.invalidReason)}mapEndpoints(e){return uo.fromDateTimes(e(this.s),e(this.e))}}class K5{static hasDST(e=ta.defaultZone){const r=zr.now().setZone(e).set({month:12});return!e.isUniversal&&r.offset!==r.set({month:6}).offset}static isValidIANAZone(e){return L_.isValidZone(e)}static normalizeZone(e){return Jb(e,ta.defaultZone)}static months(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||vs.create(r,i,s)).months(e)}static monthsFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null,outputCalendar:s="gregory"}={}){return(n||vs.create(r,i,s)).months(e,!0)}static weekdays(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||vs.create(r,i,null)).weekdays(e)}static weekdaysFormat(e="long",{locale:r=null,numberingSystem:i=null,locObj:n=null}={}){return(n||vs.create(r,i,null)).weekdays(e,!0)}static meridiems({locale:e=null}={}){return vs.create(e).meridiems()}static eras(e="short",{locale:r=null}={}){return vs.create(r,null,"gregory").eras(e)}static features(){return{relative:BNe()}}}function t_e(t,e){const r=n=>n.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf(),i=r(e)-r(t);return Math.floor(ki.fromMillis(i).as("days"))}function W_t(t,e,r){const i=[["years",(l,c)=>c.year-l.year],["quarters",(l,c)=>c.quarter-l.quarter+(c.year-l.year)*4],["months",(l,c)=>c.month-l.month+(c.year-l.year)*12],["weeks",(l,c)=>{const u=t_e(l,c);return(u-u%7)/7}],["days",t_e]],n={},s=t;let o,a;for(const[l,c]of i)r.indexOf(l)>=0&&(o=l,n[l]=c(t,e),a=s.plus(n),a>e?(n[l]--,t=s.plus(n)):t=a);return[t,n,a,o]}function X_t(t,e,r,i){let[n,s,o,a]=W_t(t,e,r);const l=e-n,c=r.filter(h=>["hours","minutes","seconds","milliseconds"].indexOf(h)>=0);c.length===0&&(o<e&&(o=n.plus({[a]:1})),o!==n&&(s[a]=(s[a]||0)+l/(o-n)));const u=ki.fromObject(s,i);return c.length>0?ki.fromMillis(l,i).shiftTo(...c).plus(u):u}const Lue={arab:"[-]",arabext:"[-]",bali:"[-]",beng:"[-]",deva:"[-]",fullwide:"[-]",gujr:"[-]",hanidec:"[|||||||||]",khmr:"[-]",knda:"[-]",laoo:"[-]",limb:"[-]",mlym:"[-]",mong:"[-]",mymr:"[-]",orya:"[-]",tamldec:"[-]",telu:"[-]",thai:"[-]",tibt:"[-]",latn:"\\d"},r_e={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Y_t=Lue.hanidec.replace(/[\[|\]]/g,"").split("");function Z_t(t){let e=parseInt(t,10);if(isNaN(e)){e="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r);if(t[r].search(Lue.hanidec)!==-1)e+=Y_t.indexOf(t[r]);else for(const n in r_e){const[s,o]=r_e[n];i>=s&&i<=o&&(e+=i-s)}}return parseInt(e,10)}else return e}function Af({numberingSystem:t},e=""){return new RegExp(`${Lue[t||"latn"]}${e}`)}const J_t="missing Intl.DateTimeFormat.formatToParts support";function nn(t,e=r=>r){return{regex:t,deser:([r])=>e(Z_t(r))}}const K_t=String.fromCharCode(160),o4e=`[ ${K_t}]`,a4e=new RegExp(o4e,"g");function Q_t(t){return t.replace(/\./g,"\\.?").replace(a4e,o4e)}function i_e(t){return t.replace(/\./g,"").replace(a4e," ").toLowerCase()}function Pf(t,e){return t===null?null:{regex:RegExp(t.map(Q_t).join("|")),deser:([r])=>t.findIndex(i=>i_e(r)===i_e(i))+e}}function n_e(t,e){return{regex:t,deser:([,r,i])=>B7(r,i),groups:e}}function Q5(t){return{regex:t,deser:([e])=>e}}function e1t(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function t1t(t,e){const r=Af(e),i=Af(e,"{2}"),n=Af(e,"{3}"),s=Af(e,"{4}"),o=Af(e,"{6}"),a=Af(e,"{1,2}"),l=Af(e,"{1,3}"),c=Af(e,"{1,6}"),u=Af(e,"{1,9}"),h=Af(e,"{2,4}"),f=Af(e,"{4,6}"),m=_=>({regex:RegExp(e1t(_.val)),deser:([b])=>b,literal:!0}),y=(_=>{if(t.literal)return m(_);switch(_.val){case"G":return Pf(e.eras("short",!1),0);case"GG":return Pf(e.eras("long",!1),0);case"y":return nn(c);case"yy":return nn(h,Hee);case"yyyy":return nn(s);case"yyyyy":return nn(f);case"yyyyyy":return nn(o);case"M":return nn(a);case"MM":return nn(i);case"MMM":return Pf(e.months("short",!0,!1),1);case"MMMM":return Pf(e.months("long",!0,!1),1);case"L":return nn(a);case"LL":return nn(i);case"LLL":return Pf(e.months("short",!1,!1),1);case"LLLL":return Pf(e.months("long",!1,!1),1);case"d":return nn(a);case"dd":return nn(i);case"o":return nn(l);case"ooo":return nn(n);case"HH":return nn(i);case"H":return nn(a);case"hh":return nn(i);case"h":return nn(a);case"mm":return nn(i);case"m":return nn(a);case"q":return nn(a);case"qq":return nn(i);case"s":return nn(a);case"ss":return nn(i);case"S":return nn(l);case"SSS":return nn(n);case"u":return Q5(u);case"uu":return Q5(a);case"uuu":return nn(r);case"a":return Pf(e.meridiems(),0);case"kkkk":return nn(s);case"kk":return nn(h,Hee);case"W":return nn(a);case"WW":return nn(i);case"E":case"c":return nn(r);case"EEE":return Pf(e.weekdays("short",!1,!1),1);case"EEEE":return Pf(e.weekdays("long",!1,!1),1);case"ccc":return Pf(e.weekdays("short",!0,!1),1);case"cccc":return Pf(e.weekdays("long",!0,!1),1);case"Z":case"ZZ":return n_e(new RegExp(`([+-]${a.source})(?::(${i.source}))?`),2);case"ZZZ":return n_e(new RegExp(`([+-]${a.source})(${i.source})?`),2);case"z":return Q5(/[a-z_+-/]{1,256}?/i);case" ":return Q5(/[^\S\n\r]/);default:return m(_)}})(t)||{invalidReason:J_t};return y.token=t,y}const r1t={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"},timeZoneName:{long:"ZZZZZ",short:"ZZZ"}};function i1t(t,e){const{type:r,value:i}=t;if(r==="literal"){const o=/^\s+$/.test(i);return{literal:!o,val:o?" ":i}}const n=e[r];let s=r1t[r];if(typeof s=="object"&&(s=s[n]),s)return{literal:!1,val:s}}function n1t(t){return[`^${t.map(r=>r.regex).reduce((r,i)=>`${r}(${i.source})`,"")}$`,t]}function s1t(t,e,r){const i=t.match(e);if(i){const n={};let s=1;for(const o in r)if(AP(r,o)){const a=r[o],l=a.groups?a.groups+1:1;!a.literal&&a.token&&(n[a.token.val[0]]=a.deser(i.slice(s,s+l))),s+=l}return[i,n]}else return[i,{}]}function o1t(t){const e=s=>{switch(s){case"S":return"millisecond";case"s":return"second";case"m":return"minute";case"h":case"H":return"hour";case"d":return"day";case"o":return"ordinal";case"L":case"M":return"month";case"y":return"year";case"E":case"c":return"weekday";case"W":return"weekNumber";case"k":return"weekYear";case"q":return"quarter";default:return null}};let r=null,i;return $i(t.z)||(r=L_.create(t.z)),$i(t.Z)||(r||(r=new wc(t.Z)),i=t.Z),$i(t.q)||(t.M=(t.q-1)*3+1),$i(t.h)||(t.h<12&&t.a===1?t.h+=12:t.h===12&&t.a===0&&(t.h=0)),t.G===0&&t.y&&(t.y=-t.y),$i(t.u)||(t.S=Oue(t.u)),[Object.keys(t).reduce((s,o)=>{const a=e(o);return a&&(s[a]=t[o]),s},{}),r,i]}let dX=null;function a1t(){return dX||(dX=zr.fromMillis(1555555555555)),dX}function l1t(t,e){if(t.literal)return t;const r=_c.macroTokenToFormatOpts(t.val),i=u4e(r,e);return i==null||i.includes(void 0)?t:i}function l4e(t,e){return Array.prototype.concat(...t.map(r=>l1t(r,e)))}function c4e(t,e,r){const i=l4e(_c.parseFormat(r),t),n=i.map(o=>t1t(o,t)),s=n.find(o=>o.invalidReason);if(s)return{input:e,tokens:i,invalidReason:s.invalidReason};{const[o,a]=n1t(n),l=RegExp(o,"i"),[c,u]=s1t(e,l,a),[h,f,m]=u?o1t(u):[null,null,void 0];if(AP(u,"a")&&AP(u,"H"))throw new dI("Can't include meridiem when specifying 24-hour format");return{input:e,tokens:i,regex:l,rawMatches:c,matches:u,result:h,zone:f,specificOffset:m}}}function c1t(t,e,r){const{result:i,zone:n,specificOffset:s,invalidReason:o}=c4e(t,e,r);return[i,n,s,o]}function u4e(t,e){return t?_c.create(e,t).formatDateTimeParts(a1t()).map(n=>i1t(n,t)):null}const d4e=[0,31,59,90,120,151,181,212,243,273,304,334],h4e=[0,31,60,91,121,152,182,213,244,274,305,335];function Vp(t,e){return new Nm("unit out of range",`you specified ${e} (of type ${typeof e}) as a ${t}, which is invalid`)}function p4e(t,e,r){const i=new Date(Date.UTC(t,e-1,r));t<100&&t>=0&&i.setUTCFullYear(i.getUTCFullYear()-1900);const n=i.getUTCDay();return n===0?7:n}function f4e(t,e,r){return r+(aF(t)?h4e:d4e)[e-1]}function m4e(t,e){const r=aF(t)?h4e:d4e,i=r.findIndex(s=>s<e),n=e-r[i];return{month:i+1,day:n}}function qee(t){const{year:e,month:r,day:i}=t,n=f4e(e,r,i),s=p4e(e,r,i);let o=Math.floor((n-s+10)/7),a;return o<1?(a=e-1,o=eB(a)):o>eB(e)?(a=e+1,o=1):a=e,{weekYear:a,weekNumber:o,weekday:s,...j7(t)}}function s_e(t){const{weekYear:e,weekNumber:r,weekday:i}=t,n=p4e(e,1,4),s=sD(e);let o=r*7+i-n-3,a;o<1?(a=e-1,o+=sD(a)):o>s?(a=e+1,o-=sD(e)):a=e;const{month:l,day:c}=m4e(a,o);return{year:a,month:l,day:c,...j7(t)}}function hX(t){const{year:e,month:r,day:i}=t,n=f4e(e,r,i);return{year:e,ordinal:n,...j7(t)}}function o_e(t){const{year:e,ordinal:r}=t,{month:i,day:n}=m4e(e,r);return{year:e,month:i,day:n,...j7(t)}}function u1t(t){const e=V7(t.weekYear),r=Wv(t.weekNumber,1,eB(t.weekYear)),i=Wv(t.weekday,1,7);return e?r?i?!1:Vp("weekday",t.weekday):Vp("week",t.week):Vp("weekYear",t.weekYear)}function d1t(t){const e=V7(t.year),r=Wv(t.ordinal,1,sD(t.year));return e?r?!1:Vp("ordinal",t.ordinal):Vp("year",t.year)}function g4e(t){const e=V7(t.year),r=Wv(t.month,1,12),i=Wv(t.day,1,QV(t.year,t.month));return e?r?i?!1:Vp("day",t.day):Vp("month",t.month):Vp("year",t.year)}function y4e(t){const{hour:e,minute:r,second:i,millisecond:n}=t,s=Wv(e,0,23)||e===24&&r===0&&i===0&&n===0,o=Wv(r,0,59),a=Wv(i,0,59),l=Wv(n,0,999);return s?o?a?l?!1:Vp("millisecond",n):Vp("second",i):Vp("minute",r):Vp("hour",e)}const pX="Invalid DateTime",a_e=864e13;function ek(t){return new Nm("unsupported zone",`the zone "${t.name}" is not supported`)}function fX(t){return t.weekData===null&&(t.weekData=qee(t.c)),t.weekData}function AM(t,e){const r={ts:t.ts,zone:t.zone,c:t.c,o:t.o,loc:t.loc,invalid:t.invalid};return new zr({...r,...e,old:r})}function v4e(t,e,r){let i=t-e*60*1e3;const n=r.offset(i);if(e===n)return[i,e];i-=(n-e)*60*1e3;const s=r.offset(i);return n===s?[i,n]:[t-Math.min(n,s)*60*1e3,Math.max(n,s)]}function l_e(t,e){t+=e*60*1e3;const r=new Date(t);return{year:r.getUTCFullYear(),month:r.getUTCMonth()+1,day:r.getUTCDate(),hour:r.getUTCHours(),minute:r.getUTCMinutes(),second:r.getUTCSeconds(),millisecond:r.getUTCMilliseconds()}}function F8(t,e,r){return v4e(Pue(t),e,r)}function c_e(t,e){const r=t.o,i=t.c.year+Math.trunc(e.years),n=t.c.month+Math.trunc(e.months)+Math.trunc(e.quarters)*3,s={...t.c,year:i,month:n,day:Math.min(t.c.day,QV(i,n))+Math.trunc(e.days)+Math.trunc(e.weeks)*7},o=ki.fromObject({years:e.years-Math.trunc(e.years),quarters:e.quarters-Math.trunc(e.quarters),months:e.months-Math.trunc(e.months),weeks:e.weeks-Math.trunc(e.weeks),days:e.days-Math.trunc(e.days),hours:e.hours,minutes:e.minutes,seconds:e.seconds,milliseconds:e.milliseconds}).as("milliseconds"),a=Pue(s);let[l,c]=v4e(a,r,t.zone);return o!==0&&(l+=o,c=t.zone.offset(l)),{ts:l,o:c}}function PM(t,e,r,i,n,s){const{setZone:o,zone:a}=r;if(t&&Object.keys(t).length!==0||e){const l=e||a,c=zr.fromObject(t,{...r,zone:l,specificOffset:s});return o?c:c.setZone(a)}else return zr.invalid(new Nm("unparsable",`the input "${n}" can't be parsed as ${i}`))}function tk(t,e,r=!0){return t.isValid?_c.create(vs.create("en-US"),{allowZ:r,forceSimple:!0}).formatDateTimeFromString(t,e):null}function mX(t,e){const r=t.c.year>9999||t.c.year<0;let i="";return r&&t.c.year>=0&&(i+="+"),i+=na(t.c.year,r?6:4),e?(i+="-",i+=na(t.c.month),i+="-",i+=na(t.c.day)):(i+=na(t.c.month),i+=na(t.c.day)),i}function u_e(t,e,r,i,n,s){let o=na(t.c.hour);return e?(o+=":",o+=na(t.c.minute),(t.c.second!==0||!r)&&(o+=":")):o+=na(t.c.minute),(t.c.second!==0||!r)&&(o+=na(t.c.second),(t.c.millisecond!==0||!i)&&(o+=".",o+=na(t.c.millisecond,3))),n&&(t.isOffsetFixed&&t.offset===0&&!s?o+="Z":t.o<0?(o+="-",o+=na(Math.trunc(-t.o/60)),o+=":",o+=na(Math.trunc(-t.o%60))):(o+="+",o+=na(Math.trunc(t.o/60)),o+=":",o+=na(Math.trunc(t.o%60)))),s&&(o+="["+t.zone.ianaName+"]"),o}const _4e={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},h1t={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},p1t={ordinal:1,hour:0,minute:0,second:0,millisecond:0},b4e=["year","month","day","hour","minute","second","millisecond"],f1t=["weekYear","weekNumber","weekday","hour","minute","second","millisecond"],m1t=["year","ordinal","hour","minute","second","millisecond"];function d_e(t){const e={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[t.toLowerCase()];if(!e)throw new xNe(t);return e}function h_e(t,e){const r=Jb(e.zone,ta.defaultZone),i=vs.fromObject(e),n=ta.now();let s,o;if($i(t.year))s=n;else{for(const c of b4e)$i(t[c])&&(t[c]=_4e[c]);const a=g4e(t)||y4e(t);if(a)return zr.invalid(a);const l=r.offset(n);[s,o]=F8(t,l,r)}return new zr({ts:s,zone:r,loc:i,o})}function p_e(t,e,r){const i=$i(r.round)?!0:r.round,n=(o,a)=>(o=Aue(o,i||r.calendary?0:2,!0),e.loc.clone(r).relFormatter(r).format(o,a)),s=o=>r.calendary?e.hasSame(t,o)?0:e.startOf(o).diff(t.startOf(o),o).get(o):e.diff(t,o).get(o);if(r.unit)return n(s(r.unit),r.unit);for(const o of r.units){const a=s(o);if(Math.abs(a)>=1)return n(a,o)}return n(t>e?-0:0,r.units[r.units.length-1])}function f_e(t){let e={},r;return t.length>0&&typeof t[t.length-1]=="object"?(e=t[t.length-1],r=Array.from(t).slice(0,t.length-1)):r=Array.from(t),[e,r]}class zr{constructor(e){const r=e.zone||ta.defaultZone;let i=e.invalid||(Number.isNaN(e.ts)?new Nm("invalid input"):null)||(r.isValid?null:ek(r));this.ts=$i(e.ts)?ta.now():e.ts;let n=null,s=null;if(!i)if(e.old&&e.old.ts===this.ts&&e.old.zone.equals(r))[n,s]=[e.old.c,e.old.o];else{const a=r.offset(this.ts);n=l_e(this.ts,a),i=Number.isNaN(n.year)?new Nm("invalid input"):null,n=i?null:n,s=i?null:a}this._zone=r,this.loc=e.loc||vs.create(),this.invalid=i,this.weekData=null,this.c=n,this.o=s,this.isLuxonDateTime=!0}static now(){return new zr({})}static local(){const[e,r]=f_e(arguments),[i,n,s,o,a,l,c]=r;return h_e({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static utc(){const[e,r]=f_e(arguments),[i,n,s,o,a,l,c]=r;return e.zone=wc.utcInstance,h_e({year:i,month:n,day:s,hour:o,minute:a,second:l,millisecond:c},e)}static fromJSDate(e,r={}){const i=zvt(e)?e.valueOf():NaN;if(Number.isNaN(i))return zr.invalid("invalid input");const n=Jb(r.zone,ta.defaultZone);return n.isValid?new zr({ts:i,zone:n,loc:vs.fromObject(r)}):zr.invalid(ek(n))}static fromMillis(e,r={}){if(w2(e))return e<-a_e||e>a_e?zr.invalid("Timestamp out of range"):new zr({ts:e,zone:Jb(r.zone,ta.defaultZone),loc:vs.fromObject(r)});throw new Ap(`fromMillis requires a numerical input, but received a ${typeof e} with value ${e}`)}static fromSeconds(e,r={}){if(w2(e))return new zr({ts:e*1e3,zone:Jb(r.zone,ta.defaultZone),loc:vs.fromObject(r)});throw new Ap("fromSeconds requires a numerical input")}static fromObject(e,r={}){e=e||{};const i=Jb(r.zone,ta.defaultZone);if(!i.isValid)return zr.invalid(ek(i));const n=ta.now(),s=$i(r.specificOffset)?i.offset(n):r.specificOffset,o=tB(e,d_e),a=!$i(o.ordinal),l=!$i(o.year),c=!$i(o.month)||!$i(o.day),u=l||c,h=o.weekYear||o.weekNumber,f=vs.fromObject(r);if((u||a)&&h)throw new dI("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(c&&a)throw new dI("Can't mix ordinal dates with month/day");const m=h||o.weekday&&!u;let g,y,_=l_e(n,s);m?(g=f1t,y=h1t,_=qee(_)):a?(g=m1t,y=p1t,_=hX(_)):(g=b4e,y=_4e);let b=!1;for(const P of g){const D=o[P];$i(D)?b?o[P]=y[P]:o[P]=_[P]:b=!0}const w=m?u1t(o):a?d1t(o):g4e(o),x=w||y4e(o);if(x)return zr.invalid(x);const S=m?s_e(o):a?o_e(o):o,[C,E]=F8(S,s,i),R=new zr({ts:C,zone:i,o:E,loc:f});return o.weekday&&u&&e.weekday!==R.weekday?zr.invalid("mismatched weekday",`you can't specify both a weekday of ${o.weekday} and a date of ${R.toISO()}`):R}static fromISO(e,r={}){const[i,n]=A_t(e);return PM(i,n,r,"ISO 8601",e)}static fromRFC2822(e,r={}){const[i,n]=P_t(e);return PM(i,n,r,"RFC 2822",e)}static fromHTTP(e,r={}){const[i,n]=M_t(e);return PM(i,n,r,"HTTP",r)}static fromFormat(e,r,i={}){if($i(e)||$i(r))throw new Ap("fromFormat requires an input string and a format");const{locale:n=null,numberingSystem:s=null}=i,o=vs.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0}),[a,l,c,u]=c1t(o,e,r);return u?zr.invalid(u):PM(a,l,i,`format ${r}`,e,c)}static fromString(e,r,i={}){return zr.fromFormat(e,r,i)}static fromSQL(e,r={}){const[i,n]=k_t(e);return PM(i,n,r,"SQL",e)}static invalid(e,r=null){if(!e)throw new Ap("need to specify a reason the DateTime is invalid");const i=e instanceof Nm?e:new Nm(e,r);if(ta.throwOnInvalid)throw new yvt(i);return new zr({invalid:i})}static isDateTime(e){return e&&e.isLuxonDateTime||!1}static parseFormatForOpts(e,r={}){const i=u4e(e,vs.fromObject(r));return i?i.map(n=>n?n.val:null).join(""):null}static expandFormat(e,r={}){return l4e(_c.parseFormat(e),vs.fromObject(r)).map(n=>n.val).join("")}get(e){return this[e]}get isValid(){return this.invalid===null}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?fX(this).weekYear:NaN}get weekNumber(){return this.isValid?fX(this).weekNumber:NaN}get weekday(){return this.isValid?fX(this).weekday:NaN}get ordinal(){return this.isValid?hX(this.c).ordinal:NaN}get monthShort(){return this.isValid?K5.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?K5.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?K5.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?K5.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return aF(this.year)}get daysInMonth(){return QV(this.year,this.month)}get daysInYear(){return this.isValid?sD(this.year):NaN}get weeksInWeekYear(){return this.isValid?eB(this.weekYear):NaN}resolvedLocaleOptions(e={}){const{locale:r,numberingSystem:i,calendar:n}=_c.create(this.loc.clone(e),e).resolvedOptions(this);return{locale:r,numberingSystem:i,outputCalendar:n}}toUTC(e=0,r={}){return this.setZone(wc.instance(e),r)}toLocal(){return this.setZone(ta.defaultZone)}setZone(e,{keepLocalTime:r=!1,keepCalendarTime:i=!1}={}){if(e=Jb(e,ta.defaultZone),e.equals(this.zone))return this;if(e.isValid){let n=this.ts;if(r||i){const s=e.offset(this.ts),o=this.toObject();[n]=F8(o,s,e)}return AM(this,{ts:n,zone:e})}else return zr.invalid(ek(e))}reconfigure({locale:e,numberingSystem:r,outputCalendar:i}={}){const n=this.loc.clone({locale:e,numberingSystem:r,outputCalendar:i});return AM(this,{loc:n})}setLocale(e){return this.reconfigure({locale:e})}set(e){if(!this.isValid)return this;const r=tB(e,d_e),i=!$i(r.weekYear)||!$i(r.weekNumber)||!$i(r.weekday),n=!$i(r.ordinal),s=!$i(r.year),o=!$i(r.month)||!$i(r.day),a=s||o,l=r.weekYear||r.weekNumber;if((a||n)&&l)throw new dI("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(o&&n)throw new dI("Can't mix ordinal dates with month/day");let c;i?c=s_e({...qee(this.c),...r}):$i(r.ordinal)?(c={...this.toObject(),...r},$i(r.day)&&(c.day=Math.min(QV(c.year,c.month),c.day))):c=o_e({...hX(this.c),...r});const[u,h]=F8(c,this.o,this.zone);return AM(this,{ts:u,o:h})}plus(e){if(!this.isValid)return this;const r=ki.fromDurationLike(e);return AM(this,c_e(this,r))}minus(e){if(!this.isValid)return this;const r=ki.fromDurationLike(e).negate();return AM(this,c_e(this,r))}startOf(e){if(!this.isValid)return this;const r={},i=ki.normalizeUnit(e);switch(i){case"years":r.month=1;case"quarters":case"months":r.day=1;case"weeks":case"days":r.hour=0;case"hours":r.minute=0;case"minutes":r.second=0;case"seconds":r.millisecond=0;break}if(i==="weeks"&&(r.weekday=1),i==="quarters"){const n=Math.ceil(this.month/3);r.month=(n-1)*3+1}return this.set(r)}endOf(e){return this.isValid?this.plus({[e]:1}).startOf(e).minus(1):this}toFormat(e,r={}){return this.isValid?_c.create(this.loc.redefaultToEN(r)).formatDateTimeFromString(this,e):pX}toLocaleString(e=KV,r={}){return this.isValid?_c.create(this.loc.clone(r),e).formatDateTime(this):pX}toLocaleParts(e={}){return this.isValid?_c.create(this.loc.clone(e),e).formatDateTimeParts(this):[]}toISO({format:e="extended",suppressSeconds:r=!1,suppressMilliseconds:i=!1,includeOffset:n=!0,extendedZone:s=!1}={}){if(!this.isValid)return null;const o=e==="extended";let a=mX(this,o);return a+="T",a+=u_e(this,o,r,i,n,s),a}toISODate({format:e="extended"}={}){return this.isValid?mX(this,e==="extended"):null}toISOWeekDate(){return tk(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:e=!1,suppressSeconds:r=!1,includeOffset:i=!0,includePrefix:n=!1,extendedZone:s=!1,format:o="extended"}={}){return this.isValid?(n?"T":"")+u_e(this,o==="extended",r,e,i,s):null}toRFC2822(){return tk(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return tk(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?mX(this,!0):null}toSQLTime({includeOffset:e=!0,includeZone:r=!1,includeOffsetSpace:i=!0}={}){let n="HH:mm:ss.SSS";return(r||e)&&(i&&(n+=" "),r?n+="z":e&&(n+="ZZ")),tk(this,n,!0)}toSQL(e={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(e)}`:null}toString(){return this.isValid?this.toISO():pX}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1e3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1e3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(e={}){if(!this.isValid)return{};const r={...this.c};return e.includeConfig&&(r.outputCalendar=this.outputCalendar,r.numberingSystem=this.loc.numberingSystem,r.locale=this.loc.locale),r}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(e,r="milliseconds",i={}){if(!this.isValid||!e.isValid)return ki.invalid("created by diffing an invalid DateTime");const n={locale:this.locale,numberingSystem:this.numberingSystem,...i},s=Vvt(r).map(ki.normalizeUnit),o=e.valueOf()>this.valueOf(),a=o?this:e,l=o?e:this,c=X_t(a,l,s,n);return o?c.negate():c}diffNow(e="milliseconds",r={}){return this.diff(zr.now(),e,r)}until(e){return this.isValid?uo.fromDateTimes(this,e):this}hasSame(e,r){if(!this.isValid)return!1;const i=e.valueOf(),n=this.setZone(e.zone,{keepLocalTime:!0});return n.startOf(r)<=i&&i<=n.endOf(r)}equals(e){return this.isValid&&e.isValid&&this.valueOf()===e.valueOf()&&this.zone.equals(e.zone)&&this.loc.equals(e.loc)}toRelative(e={}){if(!this.isValid)return null;const r=e.base||zr.fromObject({},{zone:this.zone}),i=e.padding?this<r?-e.padding:e.padding:0;let n=["years","months","days","hours","minutes","seconds"],s=e.unit;return Array.isArray(e.unit)&&(n=e.unit,s=void 0),p_e(r,this.plus(i),{...e,numeric:"always",units:n,unit:s})}toRelativeCalendar(e={}){return this.isValid?p_e(e.base||zr.fromObject({},{zone:this.zone}),this,{...e,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...e){if(!e.every(zr.isDateTime))throw new Ap("min requires all arguments be DateTimes");return Kve(e,r=>r.valueOf(),Math.min)}static max(...e){if(!e.every(zr.isDateTime))throw new Ap("max requires all arguments be DateTimes");return Kve(e,r=>r.valueOf(),Math.max)}static fromFormatExplain(e,r,i={}){const{locale:n=null,numberingSystem:s=null}=i,o=vs.fromOpts({locale:n,numberingSystem:s,defaultToEN:!0});return c4e(o,e,r)}static fromStringExplain(e,r,i={}){return zr.fromFormatExplain(e,r,i)}static get DATE_SHORT(){return KV}static get DATE_MED(){return SNe}static get DATE_MED_WITH_WEEKDAY(){return bvt}static get DATE_FULL(){return TNe}static get DATE_HUGE(){return ENe}static get TIME_SIMPLE(){return CNe}static get TIME_WITH_SECONDS(){return RNe}static get TIME_WITH_SHORT_OFFSET(){return ONe}static get TIME_WITH_LONG_OFFSET(){return ANe}static get TIME_24_SIMPLE(){return PNe}static get TIME_24_WITH_SECONDS(){return MNe}static get TIME_24_WITH_SHORT_OFFSET(){return $Ne}static get TIME_24_WITH_LONG_OFFSET(){return INe}static get DATETIME_SHORT(){return LNe}static get DATETIME_SHORT_WITH_SECONDS(){return DNe}static get DATETIME_MED(){return NNe}static get DATETIME_MED_WITH_SECONDS(){return FNe}static get DATETIME_MED_WITH_WEEKDAY(){return wvt}static get DATETIME_FULL(){return kNe}static get DATETIME_FULL_WITH_SECONDS(){return UNe}static get DATETIME_HUGE(){return zNe}static get DATETIME_HUGE_WITH_SECONDS(){return VNe}}function MM(t){if(zr.isDateTime(t))return t;if(t&&t.valueOf&&w2(t.valueOf()))return zr.fromJSDate(t);if(t&&typeof t=="object")return zr.fromObject(t);throw new Ap(`Unknown datetime argument: ${t}, of type ${typeof t}`)}const g1t={year:void 0,month:void 0,day:void 0,weekday:void 0},y1t={hour:void 0,minute:void 0,second:void 0},v1t={timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone},Due={timeZone:"Etc/UTC"},Cg={year:"numeric",month:"numeric",day:"numeric"},$M={year:"numeric",month:"long",day:"numeric"},IM={year:"numeric",month:"short",day:"numeric"},LM={year:"numeric",month:"long",weekday:"long",day:"numeric"},rp={hour:"numeric",minute:"numeric"},Mf={...rp,second:"numeric"},D3={"short-date":Cg,"short-date-short-time":{...Cg,...rp},"short-date-short-time-24":{...Cg,...rp,hour12:!1},"short-date-long-time":{...Cg,...Mf},"short-date-long-time-24":{...Cg,...Mf,hour12:!1},"short-date-le":Cg,"short-date-le-short-time":{...Cg,...rp},"short-date-le-short-time-24":{...Cg,...rp,hour12:!1},"short-date-le-long-time":{...Cg,...Mf},"short-date-le-long-time-24":{...Cg,...Mf,hour12:!1},"long-month-day-year":$M,"long-month-day-year-short-time":{...$M,...rp},"long-month-day-year-short-time-24":{...$M,...rp,hour12:!1},"long-month-day-year-long-time":{...$M,...Mf},"long-month-day-year-long-time-24":{...$M,...Mf,hour12:!1},"day-short-month-year":IM,"day-short-month-year-short-time":{...IM,...rp},"day-short-month-year-short-time-24":{...IM,...rp,hour12:!1},"day-short-month-year-long-time":{...IM,...Mf},"day-short-month-year-long-time-24":{...IM,...Mf,hour12:!1},"long-date":LM,"long-date-short-time":{...LM,...rp},"long-date-short-time-24":{...LM,...rp,hour12:!1},"long-date-long-time":{...LM,...Mf},"long-date-long-time-24":{...LM,...Mf,hour12:!1},"long-month-year":{month:"long",year:"numeric"},"short-month-year":{month:"short",year:"numeric"},year:{year:"numeric"},"short-time":rp,"long-time":Mf},_1t=Ac()({shortDate:"short-date",shortDateShortTime:"short-date-short-time",shortDateShortTime24:"short-date-short-time-24",shortDateLongTime:"short-date-long-time",shortDateLongTime24:"short-date-long-time-24",shortDateLE:"short-date-le",shortDateLEShortTime:"short-date-le-short-time",shortDateLEShortTime24:"short-date-le-short-time-24",shortDateLELongTime:"short-date-le-long-time",shortDateLELongTime24:"short-date-le-long-time-24",longMonthDayYear:"long-month-day-year",longMonthDayYearShortTime:"long-month-day-year-short-time",longMonthDayYearShortTime24:"long-month-day-year-short-time-24",longMonthDayYearLongTime:"long-month-day-year-long-time",longMonthDayYearLongTime24:"long-month-day-year-long-time-24",dayShortMonthYear:"day-short-month-year",dayShortMonthYearShortTime:"day-short-month-year-short-time",dayShortMonthYearShortTime24:"day-short-month-year-short-time-24",dayShortMonthYearLongTime:"day-short-month-year-long-time",dayShortMonthYearLongTime24:"day-short-month-year-long-time-24",longDate:"long-date",longDateShortTime:"long-date-short-time",longDateShortTime24:"long-date-short-time-24",longDateLongTime:"long-date-long-time",longDateLongTime24:"long-date-long-time-24",longMonthYear:"long-month-year",shortMonthYear:"short-month-year",year:"year"}),w4e={ar:"ar-u-nu-latn-ca-gregory"};let Wee=new WeakMap,x4e=D3["short-date-short-time"];function b1t(t){const e=t||x4e;let r=Wee.get(e);if(!r){const i=Ym(),n=w4e[i]||i;r=new Intl.DateTimeFormat(n,e),Wee.set(e,r)}return r}function pI(t){return D3[t]}function tx(t,e){return b1t(e).format(t)}function w1t(t,e=D3["short-date"]){return tx(new Date(t),{...e,...Due,...y1t})}function x1t(t,e=D3["short-time"]){return tx(new Date(`1970-01-01T${t}Z`),{...e,...Due,...g1t})}function S1t(t,e=D3["short-date-short-time"]){const r=zr.fromISO(t,{setZone:!0}),i=Ym(),n=w4e[i]??i;return r.toLocaleString({...v1t,...e},{locale:n})}Ace(()=>{Wee=new WeakMap,x4e=D3["short-date-short-time"]});const T1t={ar:"ar-u-nu-latn"};let k8=new WeakMap,S4e={};function E1t(t){const e=t||S4e;if(!k8.has(e)){const r=Ym(),i=T1t[Ym()]||r;k8.set(e,new Intl.NumberFormat(i,t))}return k8.get(e)}function C1t(t={}){const e={};return t.digitSeparator!=null&&(e.useGrouping=t.digitSeparator),t.places!=null&&(e.minimumFractionDigits=e.maximumFractionDigits=t.places),e}function PP(t,e){return Object.is(t,-0)&&(t=0),E1t(e).format(t)}Ace(()=>{k8=new WeakMap,S4e={}});let OR=class extends Rn(me){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}formatNumber(e){return PP(e,C1t(this))}formatDate(e,r=!1){return this.dateFormat?tx(e,{...pI(this.dateFormat),...r&&Due}):this.formatNumber(e)}formatDateOnly(e){const r=(this.dateFormat&&pI(this.dateFormat))??void 0;return w1t(e,r)}formatTimeOnly(e){const r=(this.dateFormat&&pI(this.dateFormat))??void 0;return x1t(e,r)}formatTimestamp(e){const r=(this.dateFormat&&pI(this.dateFormat))??void 0;return S1t(e,r)}formatRasterPixelValue(e){return e.includes("-")?e:e.trim().includes(",")?this._formatDelimitedString(e,",",", "):e.trim().includes(";")?this._formatDelimitedString(e,";","; "):e.trim().includes(" ")?this._formatDelimitedString(e," "," "):this.formatNumber(Number(e))}_formatDelimitedString(e,r,i){return e&&r&&i?e.trim().split(r).map(n=>this.formatNumber(Number(n))).join(i):e}};d([Rt(_1t)],OR.prototype,"dateFormat",void 0),d([p({type:Boolean,json:{write:!0}})],OR.prototype,"digitSeparator",void 0),d([p({type:hn,json:{write:!0}})],OR.prototype,"places",void 0),OR=d([I("esri.popup.support.FieldInfoFormat")],OR);const fI=OR;var Xee;let qf=Xee=class extends me{constructor(t){super(t),this.fieldName=null,this.format=null,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new Xee({fieldName:this.fieldName,format:this.format?ie(this.format):null,isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};d([p({type:String,json:{write:!0}})],qf.prototype,"fieldName",void 0),d([p({type:fI,json:{write:!0}})],qf.prototype,"format",void 0),d([p({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],qf.prototype,"isEditable",void 0),d([p({type:String,json:{write:!0}})],qf.prototype,"label",void 0),d([Rt(new ri({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],qf.prototype,"stringFieldOption",void 0),d([p({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],qf.prototype,"statisticType",void 0),d([p({type:String,json:{write:!0}})],qf.prototype,"tooltip",void 0),d([p({type:Boolean,json:{write:!0}})],qf.prototype,"visible",void 0),qf=Xee=d([I("esri.popup.FieldInfo")],qf);const Nue=qf;var Yee;let ov=Yee=class extends Tx{constructor(t){super(t),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(t,e){e.fieldInfos=t&&t.map(r=>r.toJSON())}clone(){return new Yee(ie({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};d([p({type:Object,json:{write:!0}})],ov.prototype,"attributes",void 0),d([p({type:String,json:{write:!0}})],ov.prototype,"description",void 0),d([p({type:[Nue]})],ov.prototype,"fieldInfos",void 0),d([tt("fieldInfos")],ov.prototype,"writeFieldInfos",null),d([p({type:String,json:{write:!0}})],ov.prototype,"title",void 0),d([p({type:["fields"],readOnly:!0,json:{read:!1,write:!0}})],ov.prototype,"type",void 0),ov=Yee=d([I("esri.popup.content.FieldsContent")],ov);const MN=ov;let NS=class extends me{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};d([p({type:String,json:{write:!0}})],NS.prototype,"altText",void 0),d([p({type:String,json:{write:!0}})],NS.prototype,"caption",void 0),d([p({type:String,json:{write:!0}})],NS.prototype,"title",void 0),d([p({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],NS.prototype,"type",void 0),NS=d([I("esri.popup.content.mixins.MediaInfo")],NS);const Fue=NS;var Zee;let AR=Zee=class extends Ce{constructor(t){super(t),this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new Zee({fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};d([p()],AR.prototype,"fieldName",void 0),d([p()],AR.prototype,"tooltip",void 0),d([p()],AR.prototype,"value",void 0),AR=Zee=d([I("esri.popup.content.support.ChartMediaInfoValueSeries")],AR);const R1t=AR;var Jee;let FS=Jee=class extends me{constructor(t){super(t),this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new Jee({fields:ie(this.fields),normalizeField:this.normalizeField,tooltipField:this.tooltipField})}};d([p({type:[String],json:{write:!0}})],FS.prototype,"fields",void 0),d([p({type:String,json:{write:!0}})],FS.prototype,"normalizeField",void 0),d([p({type:[R1t],json:{read:!1}})],FS.prototype,"series",void 0),d([p({type:String,json:{write:!0}})],FS.prototype,"tooltipField",void 0),FS=Jee=d([I("esri.popup.content.support.ChartMediaInfoValue")],FS);const O1t=FS;let mI=class extends Fue{constructor(e){super(e),this.type=null,this.value=null}};d([p({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],mI.prototype,"type",void 0),d([p({type:O1t,json:{write:!0}})],mI.prototype,"value",void 0),mI=d([I("esri.popup.content.mixins.ChartMediaInfo")],mI);const G7=mI,H7=Ac()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});var Kee;let U8=Kee=class extends G7{constructor(t){super(t),this.type="bar-chart"}clone(){return new Kee({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([p({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:H7.write}})],U8.prototype,"type",void 0),U8=Kee=d([I("esri.popup.content.BarChartMediaInfo")],U8);const T4e=U8;var Qee;let z8=Qee=class extends G7{constructor(t){super(t),this.type="column-chart"}clone(){return new Qee({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([p({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:H7.write}})],z8.prototype,"type",void 0),z8=Qee=d([I("esri.popup.content.ColumnChartMediaInfo")],z8);const E4e=z8;var ete;let gI=ete=class extends me{constructor(t){super(t),this.linkURL=null,this.sourceURL=null}clone(){return new ete({linkURL:this.linkURL,sourceURL:this.sourceURL})}};d([p({type:String,json:{write:!0}})],gI.prototype,"linkURL",void 0),d([p({type:String,json:{write:!0}})],gI.prototype,"sourceURL",void 0),gI=ete=d([I("esri.popup.content.support.ImageMediaInfoValue")],gI);const A1t=gI;var tte;let PR=tte=class extends Fue{constructor(t){super(t),this.refreshInterval=null,this.type="image",this.value=null}clone(){return new tte({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?this.value.clone():null})}};d([p({type:Number,json:{write:!0}})],PR.prototype,"refreshInterval",void 0),d([p({type:["image"],readOnly:!0,json:{read:!1,write:!0}})],PR.prototype,"type",void 0),d([p({type:A1t,json:{write:!0}})],PR.prototype,"value",void 0),PR=tte=d([I("esri.popup.content.ImageMediaInfo")],PR);const C4e=PR;var rte;let V8=rte=class extends G7{constructor(t){super(t),this.type="line-chart"}clone(){return new rte({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([p({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:H7.write}})],V8.prototype,"type",void 0),V8=rte=d([I("esri.popup.content.LineChartMediaInfo")],V8);const R4e=V8;var ite;let B8=ite=class extends G7{constructor(t){super(t),this.type="pie-chart"}clone(){return new ite({altText:this.altText,title:this.title,caption:this.caption,value:this.value?this.value.clone():null})}};d([p({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:H7.write}})],B8.prototype,"type",void 0),B8=ite=d([I("esri.popup.content.PieChartMediaInfo")],B8);const O4e=B8,A4e={base:Fue,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":T4e,"column-chart":E4e,"line-chart":R4e,"pie-chart":O4e,image:C4e}};var nte;let Wf=nte=class extends Tx{constructor(t){super(t),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(t){return t&&t.map(e=>e.type==="image"?C4e.fromJSON(e):e.type==="barchart"?T4e.fromJSON(e):e.type==="columnchart"?E4e.fromJSON(e):e.type==="linechart"?R4e.fromJSON(e):e.type==="piechart"?O4e.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(t,e){e.mediaInfos=t&&t.map(r=>r.toJSON())}clone(){return new nte(ie({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};d([p()],Wf.prototype,"activeMediaInfoIndex",void 0),d([p({type:Object,json:{write:!0}})],Wf.prototype,"attributes",void 0),d([p({type:String,json:{write:!0}})],Wf.prototype,"description",void 0),d([p({types:[A4e]})],Wf.prototype,"mediaInfos",void 0),d([ke("mediaInfos")],Wf.prototype,"readMediaInfos",null),d([tt("mediaInfos")],Wf.prototype,"writeMediaInfos",null),d([p({type:String,json:{write:!0}})],Wf.prototype,"title",void 0),d([p({type:["media"],readOnly:!0,json:{read:!1,write:!0}})],Wf.prototype,"type",void 0),Wf=nte=d([I("esri.popup.content.MediaContent")],Wf);const rB=Wf;var ste;let yI=ste=class extends me{constructor(t){super(t),this.field=null,this.order=null}clone(){return new ste({field:this.field,order:this.order})}};d([p({type:String,json:{write:!0}})],yI.prototype,"field",void 0),d([p({type:["asc","desc"],json:{write:!0}})],yI.prototype,"order",void 0),yI=ste=d([I("esri.popup.support.RelatedRecordsInfoFieldOrder")],yI);const kue=yI;let Jg=class extends Rn(Tx){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};d([p({type:String,json:{write:!0}})],Jg.prototype,"description",void 0),d([p({type:Number,json:{type:hn,write:!0}})],Jg.prototype,"displayCount",void 0),d([p({type:["list"],json:{write:!0}})],Jg.prototype,"displayType",void 0),d([p({type:[kue],json:{write:!0}})],Jg.prototype,"orderByFields",void 0),d([p({type:Number,json:{type:hn,write:!0}})],Jg.prototype,"relationshipId",void 0),d([p({type:String,json:{write:!0}})],Jg.prototype,"title",void 0),d([p({type:["relationship"],readOnly:!0,json:{read:!1,write:!0}})],Jg.prototype,"type",void 0),Jg=d([I("esri.popup.content.RelationshipContent")],Jg);const iB=Jg;var ote;let vI=ote=class extends Tx{constructor(t){super(t),this.text=null,this.type="text"}clone(){return new ote({text:this.text})}};d([p({type:String,json:{write:!0}})],vI.prototype,"text",void 0),d([p({type:["text"],readOnly:!0,json:{read:!1,write:!0}})],vI.prototype,"type",void 0),vI=ote=d([I("esri.popup.content.TextContent")],vI);const nB=vI,P1t={base:null,key:"type",typeMap:{attachment:PN,media:rB,text:nB,expression:Rue,field:MN,relationship:iB}};var ate;let kS=ate=class extends me{constructor(t){super(t),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new ate({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([p({type:String,json:{write:!0}})],kS.prototype,"name",void 0),d([p({type:String,json:{write:!0}})],kS.prototype,"title",void 0),d([p({type:String,json:{write:!0}})],kS.prototype,"expression",void 0),d([p({type:["string","number"],json:{write:!0}})],kS.prototype,"returnType",void 0),kS=ate=d([I("esri.popup.ExpressionInfo")],kS);const M1t=kS;var lte;let _I=lte=class extends me{constructor(t){super(t),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new lte({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};d([p({type:Boolean,json:{write:!0}})],_I.prototype,"returnTopmostRaster",void 0),d([p({type:Boolean,json:{write:!0}})],_I.prototype,"showNoDataRecords",void 0),_I=lte=d([I("esri.popup.LayerOptions")],_I);const $1t=_I;var cte;let bI=cte=class extends me{constructor(t){super(t),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new cte({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?ie(this.orderByFields):null})}};d([p({type:Boolean,json:{write:!0}})],bI.prototype,"showRelatedRecords",void 0),d([p({type:[kue],json:{write:!0}})],bI.prototype,"orderByFields",void 0),bI=cte=d([I("esri.popup.RelatedRecordsInfo")],bI);const I1t=bI;var ute;let ip=ute=class extends K4(Ce){constructor(t){super(t),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new ute({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};d([p()],ip.prototype,"active",void 0),d([p()],ip.prototype,"className",void 0),d([p()],ip.prototype,"disabled",void 0),d([p()],ip.prototype,"icon",void 0),d([p()],ip.prototype,"id",void 0),d([p()],ip.prototype,"indicator",void 0),d([p()],ip.prototype,"title",void 0),d([p()],ip.prototype,"type",void 0),d([p()],ip.prototype,"visible",void 0),ip=ute=d([I("esri.support.actions.ActionBase")],ip);const uF=ip;var dte;let j8=dte=class extends uF{constructor(t){super(t),this.image=null,this.type="button"}clone(){return new dte({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};d([p()],j8.prototype,"image",void 0),j8=dte=d([I("esri.support.Action.ActionButton")],j8);const P4e=j8;var hte;let wI=hte=class extends uF{constructor(t){super(t),this.image=null,this.type="toggle",this.value=!1}clone(){return new hte({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};d([p()],wI.prototype,"image",void 0),d([p()],wI.prototype,"value",void 0),wI=hte=d([I("esri.support.Action.ActionToggle")],wI);const M4e=wI,L1t="esri.PopupTemplate",D1t=re.getLogger(L1t),DM="relationships/",m_e="expression/",N1t=vt.ofType({key:"type",defaultKeyValue:"button",base:uF,typeMap:{button:P4e,toggle:M4e}}),F1t={base:Tx,key:"type",typeMap:{media:rB,custom:mvt,text:nB,attachments:PN,fields:MN,expression:Rue,relationship:iB}},k1t=["attachments","fields","media","text","expression","relationship"];let ba=class extends Rn(me){constructor(){super(...arguments),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(r=>ng(F1t,r)):typeof e=="string"||typeof e=="function"||e instanceof HTMLElement||Dh(e)?e:(D1t.error("content error","unsupported content value",{value:e}),null)}readContent(e,r){const{popupElements:i}=r;return Array.isArray(i)&&i.length>0?this._readPopupInfoElements(r.description,r.mediaInfos,i):this._readPopupInfo(r)}writeContent(e,r,i,n){typeof e!="string"?Array.isArray(e)&&(r.popupElements=e.filter(s=>k1t.includes(s.type)).map(s=>s&&s.toJSON(n)),r.popupElements.forEach(s=>{s.type==="attachments"?this._writeAttachmentContent(r):s.type==="media"?this._writeMediaContent(s,r):s.type==="text"?this._writeTextContent(s,r):s.type==="relationship"&&this._writeRelationshipContent(s,r)})):r.description=e}writeFieldInfos(e,r,i,n){const{content:s}=this,o=Array.isArray(s)?s:null;if(e){const a=o?o.filter(c=>c.type==="fields"):[],l=a.length&&a.every(c=>{var u;return(u=c.fieldInfos)==null?void 0:u.length});r.fieldInfos=e.filter(Boolean).map(c=>{const u=c.toJSON(n);return l&&(u.visible=!1),u})}if(o)for(const a of o)a.type==="fields"&&this._writeFieldsContent(a,r)}writeLayerOptions(e,r,i,n){r[i]=!e||e.showNoDataRecords===null&&e.returnTopmostRaster===null?null:e.toJSON(n)}writeTitle(e,r){r.title=e||""}async collectRequiredFields(e,r){const i=this.expressionInfos||[];await this._collectExpressionInfoFields(e,r,[...i,...this._getContentExpressionInfos(this.content,i)]),AN(e,r,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const r=new Set;return await this.collectRequiredFields(r,e),[...r].sort()}_writeFieldsContent(e,r){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const i=ie(e.fieldInfos);Array.isArray(r.fieldInfos)?i.forEach(n=>{const s=r.fieldInfos.find(o=>o.fieldName.toLowerCase()===n.fieldName.toLowerCase());s?s.visible=!0:r.fieldInfos.push(n)}):r.fieldInfos=i}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,r){var s,o;const i=((s=e.orderByFields)==null?void 0:s.map(a=>this._toFieldOrderJSON(a,e.relationshipId)))||[],n=[...((o=r.relatedRecordsInfo)==null?void 0:o.orderByFields)||[],...i];r.relatedRecordsInfo={showRelatedRecords:!0,...(n==null?void 0:n.length)&&{orderByFields:n}}}_writeTextContent(e,r){!r.description&&e.text&&(r.description=e.text)}_writeMediaContent(e,r){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const i=ie(e.mediaInfos);Array.isArray(r.mediaInfos)?r.mediaInfos=[...r.mediaInfos,...i]:r.mediaInfos=i}_readPopupInfoElements(e,r,i){const n={description:!1,mediaInfos:!1};return i.map(s=>s.type==="media"?(s.mediaInfos||!r||n.mediaInfos||(s.mediaInfos=r,n.mediaInfos=!0),rB.fromJSON(s)):s.type==="text"?(s.text||!e||n.description||(s.text=e,n.description=!0),nB.fromJSON(s)):s.type==="attachments"?PN.fromJSON(s):s.type==="fields"?MN.fromJSON(s):s.type==="expression"?Rue.fromJSON(s):s.type==="relationship"?iB.fromJSON(s):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:r,order:i}=e;if(!(r!=null&&r.startsWith(DM)))return null;const n=r.replace(DM,"").split("/");if(n.length!==2)return null;const s=parseInt(n[0],10),o=n[1];return typeof s=="number"&&o?iB.fromJSON({relationshipId:s,orderByFields:[{field:o,order:i}]}):null}_toFieldOrderJSON(e,r){const{order:i,field:n}=e;return{field:`${DM}${r}/${n}`,order:i}}_readPopupInfo({description:e,mediaInfos:r,showAttachments:i,relatedRecordsInfo:n={showRelatedRecords:!1}}){const s=[];e?s.push(new nB({text:e})):s.push(new MN),Array.isArray(r)&&r.length&&s.push(rB.fromJSON({mediaInfos:r})),i&&s.push(PN.fromJSON({displayType:"auto"}));const{showRelatedRecords:o,orderByFields:a}=n;return o&&(a!=null&&a.length)&&a.forEach(l=>{const c=this._toRelationshipContent(l);c&&s.push(c)}),s.length?s:e}_getContentElementFields(e){const r=e==null?void 0:e.type;if(r==="attachments")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if(r==="custom")return e.outFields||[];if(r==="fields")return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if(r==="media"){const i=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...i.reduce((n,s)=>[...n,...this._getMediaInfoFields(s)],[])]}return r==="text"?this._extractFieldNames(e.text):[]}_getMediaInfoFields(e){const{caption:r,title:i,value:n}=e,s=n||{},{fields:o,normalizeField:a,tooltipField:l,sourceURL:c,linkURL:u}=s,h=[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(c),...this._extractFieldNames(u),...o??[]];return a&&h.push(a),l&&h.push(l),h}_getContentExpressionInfos(e,r){return Array.isArray(e)?e.reduce((i,n)=>[...i,...n.type==="expression"&&n.expressionInfo?[n.expressionInfo]:[]],r):[]}_getContentFields(e){return typeof e=="string"?this._extractFieldNames(e):Array.isArray(e)?e.reduce((r,i)=>[...r,...this._getContentElementFields(i)],[]):[]}async _collectExpressionInfoFields(e,r,i){i&&await Promise.all(i.map(n=>pu(e,r,n.expression)))}_getFieldInfoFields(e){return e?e.filter(r=>r.visible===void 0||!!r.visible).map(r=>r.fieldName).filter(r=>!r.startsWith(DM)&&!r.startsWith(m_e)):[]}_getActionsFields(e){return e?e.toArray().reduce((r,i)=>[...r,...this._getActionFields(i)],[]):[]}_getActionFields(e){const{className:r,title:i,type:n}=e,s=n==="button"||n==="toggle"?e.image:"";return[...this._extractFieldNames(i),...this._extractFieldNames(r),...this._extractFieldNames(s)]}_getTitleFields(e){return typeof e=="string"?this._extractFieldNames(e):[]}_extractFieldNames(e){if(!e||typeof e!="string")return[];const r=/{[^}]*}/g,i=e.match(r);if(!i)return[];const n=/\{(\w+):.+\}/,s=i.filter(o=>!(o.indexOf(`{${DM}`)===0||o.indexOf(`{${m_e}`)===0)).map(o=>o.replace(n,"{$1}"));return s?s.map(o=>o.slice(1,-1)):[]}};d([p({type:N1t})],ba.prototype,"actions",void 0),d([p()],ba.prototype,"content",void 0),d([ur("content")],ba.prototype,"castContent",null),d([ke("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],ba.prototype,"readContent",null),d([tt("content",{popupElements:{type:vt.ofType(P1t)},showAttachments:{type:Boolean},mediaInfos:{type:vt.ofType(A4e)},description:{type:String},relatedRecordsInfo:{type:I1t}})],ba.prototype,"writeContent",null),d([p({type:[M1t],json:{write:!0}})],ba.prototype,"expressionInfos",void 0),d([p({type:[Nue]})],ba.prototype,"fieldInfos",void 0),d([tt("fieldInfos")],ba.prototype,"writeFieldInfos",null),d([p({type:$1t})],ba.prototype,"layerOptions",void 0),d([tt("layerOptions")],ba.prototype,"writeLayerOptions",null),d([p({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],ba.prototype,"lastEditInfoEnabled",void 0),d([p()],ba.prototype,"outFields",void 0),d([p()],ba.prototype,"overwriteActions",void 0),d([p()],ba.prototype,"returnGeometry",void 0),d([p({json:{type:String}})],ba.prototype,"title",void 0),d([tt("title")],ba.prototype,"writeTitle",null),ba=d([I("esri.PopupTemplate")],ba);const LE=ba,g_e=new ri({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let U1t=0,MR=class extends me{constructor(e){super(e),this.id="sym"+U1t++,this.type=null,this.color=new ht([0,0,0,1])}readColor(e){return e&&e[0]!=null?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,r){}hash(){return JSON.stringify(this.toJSON())}clone(){}};d([p({type:g_e.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:g_e.write}}})],MR.prototype,"type",void 0),d([p({type:ht,json:{write:{allowNull:!0}}})],MR.prototype,"color",void 0),d([ke("color")],MR.prototype,"readColor",null),MR=d([I("esri.symbols.Symbol")],MR);const Cd=MR;var pte;let sb=pte=class extends Cd{constructor(t){super(t),this.data=null,this.type="cim"}readData(t,e){return e}writeData(t,e){Object.assign(e,t)}async collectRequiredFields(t,e){var r;if(((r=this.data)==null?void 0:r.type)==="CIMSymbolReference"){const i=this.data.primitiveOverrides;if(i){const n=i.map(s=>{const o=s.valueExpressionInfo;return pu(t,e,o.expression)});await Promise.all(n)}}}clone(){return new pte({data:ie(this.data)})}hash(){return Hle(JSON.stringify(this.data)).toString()}};d([p({json:{write:!1}})],sb.prototype,"color",void 0),d([p({json:{write:!0}})],sb.prototype,"data",void 0),d([ke("data",["symbol"])],sb.prototype,"readData",null),d([tt("data",{})],sb.prototype,"writeData",null),d([Rt({CIMSymbolReference:"cim"},{readOnly:!0})],sb.prototype,"type",void 0),sb=pte=d([I("esri.symbols.CIMSymbol")],sb);const N3=sb;let $R=class extends me{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,r,i){e||(r[i]=e)}};d([p({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],$R.prototype,"enabled",void 0),d([tt("enabled")],$R.prototype,"writeEnabled",null),d([p({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0})],$R.prototype,"type",void 0),$R=d([I("esri.symbols.Symbol3DLayer")],$R);const E0=$R;let US=class extends me{constructor(e){super(e),this.color=new ht([0,0,0,1]),this.extensionLength=0,this.size=Rh(1)}clone(){}cloneProperties(){return{color:ie(this.color),size:this.size,extensionLength:this.extensionLength}}};d([p({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],US.prototype,"type",void 0),d([p(W_)],US.prototype,"color",void 0),d([p({...l0,json:{write:{overridePolicy:t=>({enabled:!!t})}}})],US.prototype,"extensionLength",void 0),d([p(l0)],US.prototype,"size",void 0),US=d([I("esri.symbols.edges.Edges3D")],US);const Uue=US;var fte;let G8=fte=class extends Uue{constructor(t){super(t),this.type="sketch"}clone(){return new fte(this.cloneProperties())}};d([Rt({sketch:"sketch"},{readOnly:!0})],G8.prototype,"type",void 0),G8=fte=d([I("esri.symbols.edges.SketchEdges3D")],G8);const z1t=G8;var mte;let H8=mte=class extends Uue{constructor(t){super(t),this.type="solid"}clone(){return new mte(this.cloneProperties())}};d([Rt({solid:"solid"},{readOnly:!0})],H8.prototype,"type",void 0),H8=mte=d([I("esri.symbols.support.SolidEdges3D")],H8);const V1t=H8,$4e={types:{key:"type",base:Uue,typeMap:{solid:V1t,sketch:z1t}},json:{write:!0}};var gte;let vh=gte=class extends me{constructor(t){super(t),this.color=null}clone(){const t={color:this.color!=null?this.color.clone():null};return new gte(t)}};d([p(W_)],vh.prototype,"color",void 0),vh=gte=d([I("esri.symbols.support.Symbol3DMaterial")],vh);var yte;let ob=yte=class extends E0{constructor(t){super(t),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new yte({edges:this.edges&&this.edges.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,size:this.size})}};d([Rt({Extrude:"extrude"},{readOnly:!0})],ob.prototype,"type",void 0),d([p({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],ob.prototype,"size",void 0),d([p({type:vh,json:{write:!0}})],ob.prototype,"material",void 0),d([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ob.prototype,"castShadows",void 0),d([p($4e)],ob.prototype,"edges",void 0),ob=yte=d([I("esri.symbols.ExtrudeSymbol3DLayer")],ob);const I4e=ob;let xI=class extends Cd{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}};d([Rt({esriSLS:"simple-line"},{readOnly:!0})],xI.prototype,"type",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],xI.prototype,"width",void 0),xI=d([I("esri.symbols.LineSymbol")],xI);const B1t=xI,j1t=["begin","end","begin-end"],L4e=["arrow","circle","square","diamond","cross","x"];var vte;let Kg=vte=class extends me{constructor(t){super(t),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(t,e,r,i){e[r]=(i==null?void 0:i.origin)==="web-map"?"arrow":t}set color(t){this._set("color",t)}readColor(t){return t&&t[0]!=null?[t[0],t[1],t[2],t[3]/255]:t}writeColor(t,e,r,i){(i==null?void 0:i.origin)==="web-map"||(e[r]=t)}clone(){return new vte({color:ie(this.color),placement:this.placement,style:this.style})}hash(){var t;return`${this.placement}.${(t=this.color)==null?void 0:t.hash()}.${this.style}`}};d([p({type:["begin","end","begin-end"],json:{write:!0}})],Kg.prototype,"placement",void 0),d([Rt({"line-marker":"line-marker"},{readOnly:!0}),p({json:{origins:{"web-map":{write:!1}}}})],Kg.prototype,"type",void 0),d([p({type:L4e})],Kg.prototype,"style",void 0),d([tt("style")],Kg.prototype,"writeStyle",null),d([p({type:ht,value:null,json:{write:{allowNull:!0}}})],Kg.prototype,"color",null),d([ke("color")],Kg.prototype,"readColor",null),d([tt("color")],Kg.prototype,"writeColor",null),Kg=vte=d([I("esri.symbols.LineSymbolMarker")],Kg);const G1t=Kg;var _te;const gX=new ri({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSInsideFrame:"inside-frame",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});let av=_te=class extends B1t{constructor(...t){super(...t),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(t,e,r,i,n,s){if(t&&typeof t!="string")return t;const o={};return t!=null&&(o.style=t),e!=null&&(o.color=e),r!=null&&(o.width=Ei(r)),i!=null&&(o.cap=i),n!=null&&(o.join=n),s!=null&&(o.miterLimit=Ei(s)),o}clone(){var t;return new _te({color:ie(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:(t=this.marker)==null?void 0:t.clone()})}hash(){var t,e;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${(e=this.marker)==null?void 0:e.hash()}`}};d([Rt({esriSLS:"simple-line"},{readOnly:!0})],av.prototype,"type",void 0),d([p({type:gX.apiValues,json:{read:gX.read,write:gX.write}})],av.prototype,"style",void 0),d([p({type:["butt","round","square"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],av.prototype,"cap",void 0),d([p({type:["miter","round","bevel"],json:{write:{overridePolicy:(t,e,r)=>({enabled:t!=="round"&&(r==null||r.origin==null)})}}})],av.prototype,"join",void 0),d([p({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":G1t}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],av.prototype,"marker",void 0),d([p({type:Number,json:{read:!1,write:!1}})],av.prototype,"miterLimit",void 0),av=_te=d([I("esri.symbols.SimpleLineSymbol")],av);const Rd=av;let SI=class extends Cd{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline&&this.outline.hash()}`}};d([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Rd}},json:{default:null,write:!0}})],SI.prototype,"outline",void 0),d([p({type:["simple-fill","picture-fill"],readOnly:!0})],SI.prototype,"type",void 0),SI=d([I("esri.symbols.FillSymbol")],SI);const D4e=SI;let q8=class extends me{constructor(e){super(e)}clone(){}};d([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],q8.prototype,"type",void 0),q8=d([I("esri.symbols.patterns.LinePattern3D")],q8);const N4e=q8,H1t=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"];var bte;const q1t=Ac()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});let TI=bte=class extends N4e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new bte(t)}};d([p({type:["style"]})],TI.prototype,"type",void 0),d([Rt(q1t),p({type:H1t})],TI.prototype,"style",void 0),TI=bte=d([I("esri.symbols.patterns.LineStylePattern3D")],TI);const zue=TI;let W8=class extends me{constructor(e){super(e)}clone(){}};d([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],W8.prototype,"type",void 0),W8=d([I("esri.symbols.patterns.Pattern3D")],W8);const F4e=W8,W1t=["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"];var wte;let EI=wte=class extends F4e{constructor(t){super(t),this.type="style",this.style="solid"}clone(){const t={style:this.style};return new wte(t)}};d([p({type:["style"]})],EI.prototype,"type",void 0),d([p({type:W1t,json:{read:!0,write:!0}})],EI.prototype,"style",void 0),EI=wte=d([I("esri.symbols.patterns.StylePattern3D")],EI);const k4e=EI,X1t={types:{key:"type",base:F4e,typeMap:{style:k4e}},json:{write:!0}},U4e={types:{key:"type",base:N4e,typeMap:{style:zue}},json:{write:!0}},aD=new ht("white");new ht("black");const Y1t=new ht([255,255,255,0]);function Z1t(t){return t.r===0&&t.g===0&&t.b===0}var xte;let lD=xte=class extends vh{constructor(t){super(t),this.colorMixMode=null}clone(){const t={color:this.color!=null?this.color.clone():null,colorMixMode:this.colorMixMode};return new xte(t)}};d([Rt({multiply:"multiply",replace:"replace",tint:"tint"})],lD.prototype,"colorMixMode",void 0),lD=xte=d([I("esri.symbols.support.Symbol3DFillMaterial")],lD);function To(t=G4e){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function sE(t,e,r,i,n,s,o=To()){return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function Xpr(t,e){const r=isFinite(t[2])||isFinite(t[5]);return new $r(r?{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],zmin:t[2],zmax:t[5],spatialReference:e}:{xmin:t[0],xmax:t[3],ymin:t[1],ymax:t[4],spatialReference:e})}function MP(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[3]),t[4]=Math.max(t[4],e[4]),t[5]=Math.max(t[5],e[5])}function J1t(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[3]=Math.max(t[3],e[2]),t[4]=Math.max(t[4],e[3])}function c0(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.min(t[2],e[2]),t[3]=Math.max(t[3],e[0]),t[4]=Math.max(t[4],e[1]),t[5]=Math.max(t[5],e[2])}function ph(t,e,r=0,i=e.length/3){let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];for(let u=0;u<i;u++)n=Math.min(n,e[r+3*u]),s=Math.min(s,e[r+3*u+1]),o=Math.min(o,e[r+3*u+2]),a=Math.max(a,e[r+3*u]),l=Math.max(l,e[r+3*u+1]),c=Math.max(c,e[r+3*u+2]);t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function yX(t,e,r){const i=e.length;let n=t[0],s=t[1],o=t[2],a=t[3],l=t[4],c=t[5];if(r)for(let u=0;u<i;u++){const h=e[u];n=Math.min(n,h[0]),s=Math.min(s,h[1]),o=Math.min(o,h[2]),a=Math.max(a,h[0]),l=Math.max(l,h[1]),c=Math.max(c,h[2])}else for(let u=0;u<i;u++){const h=e[u];n=Math.min(n,h[0]),s=Math.min(s,h[1]),a=Math.max(a,h[0]),l=Math.max(l,h[1])}t[0]=n,t[1]=s,t[2]=o,t[3]=a,t[4]=l,t[5]=c}function K1t(t){for(let e=0;e<6;e++)if(!isFinite(t[e]))return!1;return!0}function DE(t){return t[0]>=t[3]?0:t[3]-t[0]}function NE(t){return t[1]>=t[4]?0:t[4]-t[1]}function Ex(t){return t[2]>=t[5]?0:t[5]-t[2]}function z4e(t){const e=DE(t),r=Ex(t),i=NE(t);return Math.sqrt(e*e+r*r+i*i)}function Fm(t,e=[0,0,0]){return e[0]=t[0]+DE(t)/2,e[1]=t[1]+NE(t)/2,e[2]=t[2]+Ex(t)/2,e}function rk(t,e=[0,0,0]){return e[0]=DE(t),e[1]=NE(t),e[2]=Ex(t),e}function Vue(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[0]<=t[3]&&e[1]<=t[4]&&e[2]<=t[5]}function Ypr(t,e){return e[0]>=t[0]&&e[1]>=t[1]&&e[2]>=t[2]&&e[3]<=t[3]&&e[4]<=t[4]&&e[5]<=t[5]}function Q1t(t,e){return Math.max(e[0],t[0])<=Math.min(e[3],t[3])&&Math.max(e[1],t[1])<=Math.min(e[4],t[4])&&Math.max(e[2],t[2])<=Math.min(e[5],t[5])}function km(t,e){return e==null||Q1t(t,e)}function V4e(t,e,r,i,n=t){return n[0]=t[0]+e,n[1]=t[1]+r,n[2]=t[2]+i,n[3]=t[3]+e,n[4]=t[4]+r,n[5]=t[5]+i,n}function Zpr(t,e,r=t){const i=t[0]+DE(t)/2,n=t[1]+NE(t)/2,s=t[2]+Ex(t)/2;return r[0]=i+(t[0]-i)*e,r[1]=n+(t[1]-n)*e,r[2]=s+(t[2]-s)*e,r[3]=i+(t[3]-i)*e,r[4]=n+(t[4]-n)*e,r[5]=s+(t[5]-s)*e,r}function Jpr(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function B4e(t,e,r=t){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r!==t&&(r[3]=t[3],r[4]=t[4],r[5]=t[5]),r}function j4e(t,e,r=t){return r[3]=e[0],r[4]=e[1],r[5]=e[2],r!==t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2]),t}function q7(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function en(t){return t?q7(t,y_e):To(y_e)}function Bue(t,e){return e||(e=lr()),e[0]=t[0],e[1]=t[1],e[2]=t[3],e[3]=t[4],e}function Kpr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=Number.NEGATIVE_INFINITY,t[3]=e[2],t[4]=e[3],t[5]=Number.POSITIVE_INFINITY,t}function ebt(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=Number.NEGATIVE_INFINITY,t[3]=i,t[4]=n,t[5]=Number.POSITIVE_INFINITY,t}function Ste(t){return t.length===6}function jue(t){return DE(t)===0&&NE(t)===0&&Ex(t)===0}function Qpr(t,e,r){if(t==null||e==null)return t===e;if(!Ste(t)||!Ste(e))return!1;if(r){for(let i=0;i<t.length;i++)if(!r(t[i],e[i]))return!1}else for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function tbt(t,e,r,i,n,s){return sE(t,e,r,i,n,s,rbt)}const efr=[-1/0,-1/0,-1/0,1/0,1/0,1/0],y_e=[1/0,1/0,1/0,-1/0,-1/0,-1/0],G4e=[0,0,0,0,0,0],rbt=To();function vX(t,{isPrimitive:e,width:r,depth:i,height:n}){const s=e?10:1;if(r==null&&n==null&&i==null)return[s*t[0],s*t[1],s*t[2]];const o=Ue(r,i,n);let a;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/t[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=t[l]*a);return o}const ibt=sE(-.5,-.5,-.5,.5,.5,.5),nbt=sE(-.5,-.5,0,.5,.5,1),sbt=sE(-.5,-.5,0,.5,.5,.5);function obt(t){switch(t){case"sphere":case"cube":case"diamond":return ibt;case"cylinder":case"cone":case"inverted-cone":return nbt;case"tetrahedron":return sbt;default:return}}const Gue=["butt","square","round"],abt=[...Gue,"none"],H4e=["miter","bevel","round"];var Tte;let zS=Tte=class extends me{constructor(t){super(t),this.color=new ht([0,0,0,1]),this.size=Rh(1),this.pattern=null,this.patternCap="butt"}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size,pattern:this.pattern!=null?this.pattern.clone():null,patternCap:this.patternCap};return new Tte(t)}};d([p(W_)],zS.prototype,"color",void 0),d([p(l0)],zS.prototype,"size",void 0),d([p(U4e)],zS.prototype,"pattern",void 0),d([p({type:Gue,json:{default:"butt",write:{overridePolicy(){return{enabled:this.pattern!=null}}}}})],zS.prototype,"patternCap",void 0),zS=Tte=d([I("esri.symbols.support.Symbol3DOutline")],zS);var X8;let lv=X8=class extends E0{constructor(t){super(t),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const t={edges:this.edges!=null?this.edges.clone():null,enabled:this.enabled,material:this.material!=null?this.material.clone():null,pattern:this.pattern!=null?this.pattern.clone():null,castShadows:this.castShadows,outline:this.outline!=null?this.outline.clone():null};return new X8(t)}static fromSimpleFillSymbol(t){var i,n,s;const e=t.outline&&t.outline.style&&t.outline.style!=="inside-frame"&&t.outline.style!=="solid"?new zue({style:t.outline.style}):null,r={size:((i=t.outline)==null?void 0:i.width)??0,color:(((n=t.outline)==null?void 0:n.color)??aD).clone(),pattern:e};return e&&((s=t.outline)!=null&&s.cap)&&(r.patternCap=t.outline.cap),new X8({material:new lD({color:(t.color??Y1t).clone()}),pattern:t.style&&t.style!=="solid"?new k4e({style:t.style}):null,outline:r})}};d([Rt({Fill:"fill"},{readOnly:!0})],lv.prototype,"type",void 0),d([p({type:lD,json:{write:!0}})],lv.prototype,"material",void 0),d([p(X1t)],lv.prototype,"pattern",void 0),d([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],lv.prototype,"castShadows",void 0),d([p({type:zS,json:{write:!0}})],lv.prototype,"outline",void 0),d([p($4e)],lv.prototype,"edges",void 0),lv=X8=d([I("esri.symbols.FillSymbol3DLayer")],lv);const F3=lv,lbt=["none","underline","line-through"],cbt=["normal","italic","oblique"],ubt=["normal","lighter","bold","bolder"],q4e={type:Number,cast:t=>{const e=Op(t);return e===0?1:Te(e,.1,4)},nonNullable:!0},dbt=["left","right","center"],hbt=["baseline","top","middle","bottom"],W4e={type:dbt,nonNullable:!0},X4e={type:hbt,nonNullable:!0},tfr=8;var Ete;let cv=Ete=class extends me{constructor(t){super(t),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(t){return Ei(t)}clone(){return new Ete({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}};d([p({type:lbt,json:{default:"none",write:!0}})],cv.prototype,"decoration",void 0),d([p({type:String,json:{write:!0}})],cv.prototype,"family",void 0),d([p({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:!r||!r.textSymbol3D})}}})],cv.prototype,"size",void 0),d([ur("size")],cv.prototype,"castSize",null),d([p({type:cbt,json:{default:"normal",write:!0}})],cv.prototype,"style",void 0),d([p({type:ubt,json:{default:"normal",write:!0}})],cv.prototype,"weight",void 0),cv=Ete=d([I("esri.symbols.Font")],cv);const W7=cv;var Cte;const pbt=Ac()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});let VS=Cte=class extends me{constructor(t){super(t)}readHref(t,e,r){return t?$_(t,r):e.dataURI}writeHref(t,e,r,i){t&&(b0(t)?e.dataURI=t:(e.href=I_(t,i),fd(e.href)&&(e.href=qp(e.href))))}clone(){return new Cte({href:this.href,primitive:this.primitive})}};d([p({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],VS.prototype,"href",void 0),d([ke("href")],VS.prototype,"readHref",null),d([tt("href",{href:{type:String},dataURI:{type:String}})],VS.prototype,"writeHref",null),d([Rt(pbt)],VS.prototype,"primitive",void 0),VS=Cte=d([I("esri.symbols.support.IconSymbol3DLayerResource")],VS);const fbt="circle";var Rte;let zO=Rte=class extends Ce{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new Rte({x:this.x,y:this.y})}};d([p({type:Number})],zO.prototype,"x",void 0),d([p({type:Number})],zO.prototype,"y",void 0),zO=Rte=d([I("esri.symbols.support.Symbol3DAnchorPosition2D")],zO);var Ote;let CI=Ote=class extends me{constructor(t){super(t),this.color=new ht([0,0,0,1]),this.size=Rh(1)}clone(){const t={color:this.color!=null?this.color.clone():null,size:this.size};return new Ote(t)}};d([p(W_)],CI.prototype,"color",void 0),d([p(l0)],CI.prototype,"size",void 0),CI=Ote=d([I("esri.symbols.support.Symbol3DIconOutline")],CI);var IR;const Y4e="esri.symbols.IconSymbol3DLayer";let Qg=IR=class extends E0{constructor(t){super(t),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null}clone(){return new IR({anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),enabled:this.enabled,material:this.material!=null?this.material.clone():null,outline:this.outline!=null?this.outline.clone():null,resource:this.resource&&this.resource.clone(),size:this.size})}static fromSimpleMarkerSymbol(t){const e=t.color||aD,r=v_e(t),i=t.outline&&t.outline.width>0?{size:t.outline.width,color:(t.outline.color||aD).clone()}:null;return new IR({size:t.size,resource:{primitive:gbt(t.style)},material:{color:e},outline:i,anchor:r?"relative":void 0,anchorPosition:r})}static fromPictureMarkerSymbol(t){const e=!t.color||Z1t(t.color)?aD:t.color,r=v_e(t);return new IR({size:t.width<=t.height?t.height:t.width,resource:{href:t.url},material:{color:e.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(t){return new IR({resource:{href:_$e({mediaType:"application/json",data:JSON.stringify(t.data)})}})}};function v_e(t){const e="width"in t?t.width:t.size,r="height"in t?t.height:t.size,i=__e(t.xoffset),n=__e(t.yoffset);return(i||n)&&e&&r?{x:-i/e,y:n/r}:null}function __e(t){return isFinite(t)?t:0}d([p({type:vh,json:{write:!0}})],Qg.prototype,"material",void 0),d([p({type:VS,json:{write:!0}})],Qg.prototype,"resource",void 0),d([Rt({Icon:"icon"},{readOnly:!0})],Qg.prototype,"type",void 0),d([p(l0)],Qg.prototype,"size",void 0),d([Rt({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"}),p({json:{default:"center"}})],Qg.prototype,"anchor",void 0),d([p({type:zO,json:{type:[Number],read:{reader:t=>new zO({x:t[0],y:t[1]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],Qg.prototype,"anchorPosition",void 0),d([p({type:CI,json:{write:!0}})],Qg.prototype,"outline",void 0),Qg=IR=d([I(Y4e)],Qg);const mbt={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};function gbt(t){return mbt[t]||(re.getLogger(Y4e).warn(`${t} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle")}const vw=Qg;let BS=class extends Rn(me){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return e!=null&&e.placement===this.placement&&e.style===this.style&&(this.color==null&&e.color==null||this.color!=null&&e.color!=null&&this.color.toJSON()===e.color.toJSON())}};d([p({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],BS.prototype,"type",void 0),d([p({type:j1t,json:{default:"begin-end",write:!0}})],BS.prototype,"placement",void 0),d([p({type:L4e,json:{default:"arrow",write:!0}})],BS.prototype,"style",void 0),d([p({type:ht,json:{type:[hn],default:null,write:!0}})],BS.prototype,"color",void 0),BS=d([I("esri.symbols.LineStyleMarker3D")],BS);const Ate=BS;var Y8;let ey=Y8=class extends E0{constructor(t){super(t),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=Rh(1),this.pattern=null,this.marker=null}clone(){const t={enabled:this.enabled,material:this.material!=null?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:this.pattern!=null?this.pattern.clone():null,marker:this.marker!=null?this.marker.clone():null};return new Y8(t)}static fromSimpleLineSymbol(t){var r;const e={enabled:!0,size:t.width??Rh(1),cap:t.cap||"butt",join:t.join||"miter",pattern:t.style&&t.style!=="inside-frame"?new zue({style:t.style}):null,material:new vh({color:(t.color||aD).clone()}),marker:t.marker?new Ate({placement:t.marker.placement,style:t.marker.style,color:((r=t.marker.color)==null?void 0:r.clone())??null}):null};return new Y8(e)}};d([p({type:vh,json:{write:!0}})],ey.prototype,"material",void 0),d([Rt({Line:"line"},{readOnly:!0})],ey.prototype,"type",void 0),d([p({type:H4e,json:{write:!0,default:"miter"}})],ey.prototype,"join",void 0),d([p({type:Gue,json:{write:!0,default:"butt"}})],ey.prototype,"cap",void 0),d([p(l0)],ey.prototype,"size",void 0),d([p(U4e)],ey.prototype,"pattern",void 0),d([p({types:{key:"type",base:Ate,typeMap:{style:Ate}},json:{write:!0}})],ey.prototype,"marker",void 0),ey=Y8=d([I("esri.symbols.LineSymbol3DLayer")],ey);const dF=ey;var Pte;const ybt=Ac()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});let RI=Pte=class extends me{clone(){return new Pte({href:this.href,primitive:this.primitive})}};d([p({type:String,json:{read:N7,write:Qw}})],RI.prototype,"href",void 0),d([Rt(ybt)],RI.prototype,"primitive",void 0),RI=Pte=d([I("esri.symbols.support.ObjectSymbol3DLayerResource")],RI);const Z4e="sphere";var Mte;let NT=Mte=class extends Ce{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new Mte({x:this.x,y:this.y,z:this.z})}};d([p({type:Number})],NT.prototype,"x",void 0),d([p({type:Number})],NT.prototype,"y",void 0),d([p({type:Number})],NT.prototype,"z",void 0),NT=Mte=d([I("esri.symbols.support.Symbol3DAnchorPosition3D")],NT);var $te;let ic=$te=class extends E0{constructor(t){super(t),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new $te({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition&&this.anchorPosition.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,resource:this.resource&&this.resource.clone(),width:this.width})}get isPrimitive(){return!this.resource||typeof this.resource.href!="string"}};d([p({type:vh,json:{write:!0}})],ic.prototype,"material",void 0),d([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],ic.prototype,"castShadows",void 0),d([p({type:RI,json:{write:!0}})],ic.prototype,"resource",void 0),d([Rt({Object:"object"},{readOnly:!0})],ic.prototype,"type",void 0),d([p({type:Number,json:{write:!0}})],ic.prototype,"width",void 0),d([p({type:Number,json:{write:!0}})],ic.prototype,"height",void 0),d([p({type:Number,json:{write:!0}})],ic.prototype,"depth",void 0),d([Rt({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"}),p({json:{default:"origin"}})],ic.prototype,"anchor",void 0),d([p({type:NT,json:{type:[Number],read:{reader:t=>new NT({x:t[0],y:t[1],z:t[2]})},write:{writer:(t,e)=>{e.anchorPosition=[t.x,t.y,t.z]},overridePolicy(){return{enabled:this.anchor==="relative"}}}}})],ic.prototype,"anchorPosition",void 0),d([p({type:Number,json:{write:!0}})],ic.prototype,"heading",void 0),d([p({type:Number,json:{write:!0}})],ic.prototype,"tilt",void 0),d([p({type:Number,json:{write:!0}})],ic.prototype,"roll",void 0),d([p({readOnly:!0})],ic.prototype,"isPrimitive",null),ic=$te=d([I("esri.symbols.ObjectSymbol3DLayer")],ic);const Hue=ic;var Ite;let Vc=Ite=class extends E0{constructor(t){super(t),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(t,e){return t??(e.height==null&&e.size!=null?e.size:void 0)}readHeight(t,e){return t??(e.width==null&&e.size!=null?e.size:void 0)}clone(){return new Ite({enabled:this.enabled,material:this.material!=null?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}};d([p({type:vh,json:{write:!0}})],Vc.prototype,"material",void 0),d([p({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],Vc.prototype,"castShadows",void 0),d([Rt({Path:"path"},{readOnly:!0})],Vc.prototype,"type",void 0),d([p({type:["circle","quad"],json:{write:!0,default:"circle"}})],Vc.prototype,"profile",void 0),d([p({type:H4e,json:{write:!0,default:"miter"}})],Vc.prototype,"join",void 0),d([p({type:abt,json:{write:!0,default:"butt"}})],Vc.prototype,"cap",void 0),d([p({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],Vc.prototype,"width",void 0),d([ke("width",["width","size","height"])],Vc.prototype,"readWidth",null),d([p({type:Number,json:{write:!0}})],Vc.prototype,"height",void 0),d([ke("height",["height","size","width"])],Vc.prototype,"readHeight",null),d([p({type:["center","bottom","top"],json:{write:!0,default:"center"}})],Vc.prototype,"anchor",void 0),d([p({type:["heading","all"],json:{write:!0,default:"all"}})],Vc.prototype,"profileRotation",void 0),Vc=Ite=d([I("esri.symbols.PathSymbol3DLayer")],Vc);const que=Vc;var Lte;let VO=Lte=class extends me{constructor(){super(...arguments),this.color=new ht([0,0,0,1]),this.size=0}clone(){const t={color:ie(this.color),size:this.size};return new Lte(t)}};d([p(W_)],VO.prototype,"color",void 0),d([p(l0)],VO.prototype,"size",void 0),VO=Lte=d([I("esri.symbols.support.Symbol3DHalo")],VO);let cD=class extends Rn(me){constructor(e){super(e),this.color=null}};d([p(W_)],cD.prototype,"color",void 0),cD=d([I("esri.symbols.support.Symbol3DTextBackground")],cD);var Z8;let Pu=Z8=class extends E0{constructor(t){super(t),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(t){t!=null&&this._userSize!=null&&(t.size=this._userSize),this._set("font",t)}writeFont(t,e,r,i){const n={...i,textSymbol3D:!0};e.font=t.write({},n),delete e.font.size}get size(){return this._userSize!=null?this._userSize:this.font!=null&&this.font.size!=null?this.font.size:9}set size(t){this._userSize=t,this.font!=null&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const t=new Z8({enabled:this.enabled,font:this.font&&ie(this.font),halo:this.halo&&ie(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:this.material!=null?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:ie(this.background)});return t._userSize=this._userSize,t}static fromTextSymbol(t){return new Z8({font:t.font!=null?t.font.clone():new W7,halo:vbt(t.haloColor,t.haloSize),horizontalAlignment:t.horizontalAlignment,lineHeight:t.lineHeight,material:t.color?new vh({color:t.color.clone()}):null,text:t.text,verticalAlignment:t.verticalAlignment,background:t.backgroundColor?new cD({color:t.backgroundColor.clone()}):null})}};function vbt(t,e){return t&&e!=null&&e>0?new VO({color:ie(t),size:e}):null}d([p({type:W7,json:{write:!0}})],Pu.prototype,"font",null),d([tt("font")],Pu.prototype,"writeFont",null),d([p({type:VO,json:{write:!0}})],Pu.prototype,"halo",void 0),d([p({...W4e,json:{default:"center",write:!0}})],Pu.prototype,"horizontalAlignment",void 0),d([p({...q4e,json:{default:1,write:!0}})],Pu.prototype,"lineHeight",void 0),d([p({type:vh,json:{write:!0}})],Pu.prototype,"material",void 0),d([p({type:cD,json:{write:!0}})],Pu.prototype,"background",void 0),d([p(l0)],Pu.prototype,"size",null),d([p({type:String,json:{write:!0}})],Pu.prototype,"text",void 0),d([Rt({Text:"text"},{readOnly:!0})],Pu.prototype,"type",void 0),d([p({...X4e,json:{default:"baseline",write:!0}})],Pu.prototype,"verticalAlignment",void 0),Pu=Z8=d([I("esri.symbols.TextSymbol3DLayer")],Pu);const FE=Pu;var Dte;let ab=Dte=class extends E0{constructor(t){super(t),this.color=Nte.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new Dte({color:ie(this.color),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}};d([p({type:ht,nonNullable:!0,json:{type:[hn],write:(t,e,r)=>e[r]=t.toArray(ht.AlphaMode.UNLESS_OPAQUE),default:()=>Nte.clone(),defaultEquals:t=>t.toCss(!0)===Nte.toCss(!0)}})],ab.prototype,"color",void 0),d([Rt({Water:"water"},{readOnly:!0})],ab.prototype,"type",void 0),d([p({type:["small","medium","large"],json:{write:!0,default:"medium"}})],ab.prototype,"waterbodySize",void 0),d([p({type:Number,json:{write:!0,default:null}})],ab.prototype,"waveDirection",void 0),d([p({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],ab.prototype,"waveStrength",void 0),ab=Dte=d([I("esri.symbols.WaterSymbol3DLayer")],ab);const Nte=new ht([0,119,190]),J4e=ab;var Fte;let jS=Fte=class extends Ce{constructor(t){super(t),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new Fte({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}};d([p({type:String})],jS.prototype,"name",void 0),d([p({type:String})],jS.prototype,"styleUrl",void 0),d([p({type:String})],jS.prototype,"styleName",void 0),d([p({type:Ns})],jS.prototype,"portal",void 0),jS=Fte=d([I("esri.symbols.support.StyleOrigin")],jS);const $N=jS;var kte;let x2=kte=class extends Ce{constructor(){super(...arguments),this.url=""}clone(){return new kte({url:this.url})}};d([p({type:String})],x2.prototype,"url",void 0),x2=kte=d([I("esri.symbols.support.Thumbnail")],x2);const K4e={icon:vw,object:Hue,line:dF,path:que,fill:F3,extrude:I4e,text:FE,water:J4e},_bt=vt.ofType({base:E0,key:"type",typeMap:K4e,errorContext:"symbol-layer"});let ty=class extends Cd{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const r=this.__accessor__&&this.__accessor__.metadatas&&this.__accessor__.metadatas.symbolLayers,i=r&&r.type||vt;this._set("symbolLayers",new i)}get color(){return null}set color(e){this.constructed&&re.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){R_(e,this._get("symbolLayers"))}readStyleOrigin(e,r,i){if(e.styleUrl&&e.name){const n=$_(e.styleUrl,i);return new $N({styleUrl:n,name:e.name})}if(e.styleName&&e.name)return new $N({portal:i&&i.portal||Ns.getDefault(),styleName:e.styleName,name:e.name});i&&i.messages&&i.messages.push(new nf("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:i,definition:e}))}writeStyleOrigin(e,r,i,n){if(e.styleUrl&&e.name){let s=I_(e.styleUrl,n);fd(s)&&(s=qp(s)),r.styleOrigin={styleUrl:s,name:e.name}}else e.styleName&&e.name&&(e.portal&&n&&n.portal&&!y$e(e.portal.restUrl,n.portal.restUrl)?n&&n.messages&&n.messages.push(new nf("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):r.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof E0||e&&K4e[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}};d([p({json:{read:!1,write:!1}})],ty.prototype,"color",null),d([p({type:_bt,nonNullable:!0,json:{write:!0}}),ur(mce)],ty.prototype,"symbolLayers",null),d([p({type:$N})],ty.prototype,"styleOrigin",void 0),d([ke("styleOrigin")],ty.prototype,"readStyleOrigin",null),d([tt("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],ty.prototype,"writeStyleOrigin",null),d([p({type:x2,json:{read:!1}})],ty.prototype,"thumbnail",void 0),d([p({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],ty.prototype,"type",void 0),ty=d([I("esri.symbols.Symbol3D")],ty);const k3=ty;let OI=class extends me{constructor(e){super(e),this.visible=!0}clone(){}};d([p({type:["line"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],OI.prototype,"type",void 0),d([p({readOnly:!0})],OI.prototype,"visible",void 0),OI=d([I("esri.symbols.callouts.Callout3D")],OI);const Q4e=OI;var Ute;let J8=Ute=class extends me{constructor(){super(...arguments),this.color=new ht("white")}clone(){return new Ute({color:ie(this.color)})}};d([p(W_)],J8.prototype,"color",void 0),J8=Ute=d([I("esri.symbols.callouts.LineCallout3DBorder")],J8);const eFe=J8;Object.freeze(Object.defineProperty({__proto__:null,default:eFe},Symbol.toStringTag,{value:"Module"}));var zte;let lb=zte=class extends Q4e{constructor(t){super(t),this.type="line",this.color=new ht([0,0,0,1]),this.size=Rh(1),this.border=null}get visible(){return this.size>0&&this.color!=null&&this.color.a>0}clone(){return new zte({color:ie(this.color),size:this.size,border:ie(this.border)})}};d([Rt({line:"line"},{readOnly:!0})],lb.prototype,"type",void 0),d([p(W_)],lb.prototype,"color",void 0),d([p(l0)],lb.prototype,"size",void 0),d([p({type:eFe,json:{write:!0}})],lb.prototype,"border",void 0),d([p({readOnly:!0})],lb.prototype,"visible",null),lb=zte=d([I("esri.symbols.callouts.LineCallout3D")],lb);const bbt=lb;function Wue(t){if(!t)return!1;const e=t.verticalOffset;return!!e&&!(e.screenLength<=0||e.maxWorldLength!=null&&e.maxWorldLength<=0)}function tFe(t){if(!t||!t.supportsCallout||!t.supportsCallout())return!1;const e=t.callout;return!!e&&!!e.visible&&!!Wue(t)}function Xue(t){return t.type==="point-3d"||t.type==="label-3d"}function rFe(t){return t.horizontalAlignment==="center"}const iFe={types:{key:"type",base:Q4e,typeMap:{line:bbt}},json:{write:!0}};var Vte;let LR=Vte=class extends me{constructor(t){super(t),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new Vte({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}};d([p(l0)],LR.prototype,"screenLength",void 0),d([p({type:Number,nonNullable:!0,json:{write:!0,default:0}})],LR.prototype,"minWorldLength",void 0),d([p({type:Number,json:{write:!0}})],LR.prototype,"maxWorldLength",void 0),LR=Vte=d([I("esri.symbols.support.Symbol3DVerticalOffset")],LR);const nFe=LR;var K8;const sFe=vt.ofType({base:null,key:"type",typeMap:{text:FE}});let cb=K8=class extends k3{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new sFe,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return tFe(this)}hasVisibleVerticalOffset(){return Wue(this)}clone(){return new K8({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail),callout:ie(this.callout),verticalOffset:ie(this.verticalOffset)})}static fromTextSymbol(t){return new K8({symbolLayers:[FE.fromTextSymbol(t)]})}};d([p({type:nFe,json:{write:!0}})],cb.prototype,"verticalOffset",void 0),d([p(iFe)],cb.prototype,"callout",void 0),d([p({json:{read:!1,write:!1}})],cb.prototype,"styleOrigin",void 0),d([p({type:sFe})],cb.prototype,"symbolLayers",void 0),d([Rt({LabelSymbol3D:"label-3d"},{readOnly:!0})],cb.prototype,"type",void 0),cb=K8=d([I("esri.symbols.LabelSymbol3D")],cb);const X7=cb;var Q8;const oFe=vt.ofType({base:null,key:"type",typeMap:{line:dF,path:que}}),wbt=vt.ofType({base:null,key:"type",typeMap:{line:dF,path:que}});let AI=Q8=class extends k3{constructor(t){super(t),this.symbolLayers=new oFe,this.type="line-3d"}clone(){return new Q8({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromSimpleLineSymbol(t){return new Q8({symbolLayers:[dF.fromSimpleLineSymbol(t)]})}};d([p({type:oFe,json:{type:wbt}})],AI.prototype,"symbolLayers",void 0),d([Rt({LineSymbol3D:"line-3d"},{readOnly:!0})],AI.prototype,"type",void 0),AI=Q8=d([I("esri.symbols.LineSymbol3D")],AI);const hF=AI;let ub=class extends Cd{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}};d([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],ub.prototype,"angle",void 0),d([p({type:["simple-marker","picture-marker"],readOnly:!0})],ub.prototype,"type",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],ub.prototype,"xoffset",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],ub.prototype,"yoffset",void 0),d([p({type:Number,cast:t=>t==="auto"?t:Ei(t),json:{write:!0}})],ub.prototype,"size",void 0),ub=d([I("esri.symbols.MarkerSymbol")],ub);const aFe=ub;var ez;const lFe=vt.ofType({base:null,key:"type",typeMap:{fill:F3}});let PI=ez=class extends k3{constructor(t){super(t),this.symbolLayers=new lFe,this.type="mesh-3d"}clone(){return new ez({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromSimpleFillSymbol(t){return new ez({symbolLayers:[F3.fromSimpleFillSymbol(t)]})}};d([p({type:lFe})],PI.prototype,"symbolLayers",void 0),d([Rt({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],PI.prototype,"type",void 0),PI=ez=d([I("esri.symbols.MeshSymbol3D")],PI);const pF=PI;function xbt(t,e,r){return e.imageData?_$e({mediaType:e.contentType||"image/png",isBase64:!0,data:e.imageData}):cFe(e.url,r)}function cFe(t,e){var r;return Tbt(e)&&!fd(t)&&((r=e==null?void 0:e.layer)!=null&&r.parsedUrl)?bd(e.layer.parsedUrl.path,"images",t):$_(t,e)}function Sbt(t,e,r,i){if(b0(t)){const n=q2(t);if(!n)return;e.contentType=n.mediaType,e.imageData=n.data,r&&r.imageData===e.imageData&&r.url&&Qw(r.url,e,"url",i)}else Qw(t,e,"url",i)}const uFe={json:{read:{source:["imageData","url"],reader:xbt},write:{writer(t,e,r,i){Sbt(t,e,this.source,i)}}}},dFe={readOnly:!0,json:{read:{source:["imageData","url"],reader(t,e,r){const i={};return e.imageData&&(i.imageData=e.imageData),e.contentType&&(i.contentType=e.contentType),e.url&&(i.url=cFe(e.url,r)),i}}}};function Tbt(t){var e,r;return!(t==null||t.origin!=="service"&&t.origin!=="portal-item"||((e=t.layer)==null?void 0:e.type)!=="feature"&&((r=t.layer)==null?void 0:r.type)!=="stream")}var Bte;let np=Bte=class extends D4e{constructor(...t){super(...t),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string"&&t.imageData==null)return t;const n={};return t&&(n.url=t),e&&(n.outline=e),r!=null&&(n.width=Ei(r)),i!=null&&(n.height=Ei(i)),n}clone(){const t=new Bte({color:ie(this.color),height:this.height,outline:this.outline&&this.outline.clone(),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return t._set("source",ie(this.source)),t}hash(){var t;return`${super.hash()}.${(t=this.color)==null?void 0:t.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}};d([Rt({esriPFS:"picture-fill"},{readOnly:!0})],np.prototype,"type",void 0),d([p(uFe)],np.prototype,"url",void 0),d([p({type:Number,json:{write:!0}})],np.prototype,"xscale",void 0),d([p({type:Number,json:{write:!0}})],np.prototype,"yscale",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],np.prototype,"width",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],np.prototype,"height",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],np.prototype,"xoffset",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],np.prototype,"yoffset",void 0),d([p(dFe)],np.prototype,"source",void 0),np=Bte=d([I("esri.symbols.PictureFillSymbol")],np);const hFe=np;var jte;let Xf=jte=class extends aFe{constructor(...t){super(...t),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string"&&t.imageData==null)return t;const i={};return t&&(i.url=t),e!=null&&(i.width=Ei(e)),r!=null&&(i.height=Ei(r)),i}readHeight(t,e){return e.size||t}readWidth(t,e){return e.size||t}clone(){const t=new jte({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return t._set("source",ie(this.source)),t}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}};d([p({json:{write:!1}})],Xf.prototype,"color",void 0),d([Rt({esriPMS:"picture-marker"},{readOnly:!0})],Xf.prototype,"type",void 0),d([p(uFe)],Xf.prototype,"url",void 0),d([p(dFe)],Xf.prototype,"source",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],Xf.prototype,"height",void 0),d([ke("height",["height","size"])],Xf.prototype,"readHeight",null),d([p({type:Number,cast:Ei,json:{write:!0}})],Xf.prototype,"width",void 0),d([p({json:{write:!1}})],Xf.prototype,"size",void 0),Xf=jte=d([I("esri.symbols.PictureMarkerSymbol")],Xf);const Y7=Xf;var GS;const pFe=vt.ofType({base:null,key:"type",typeMap:{icon:vw,object:Hue,text:FE}});let HS=GS=class extends k3{constructor(t){super(t),this.verticalOffset=null,this.callout=null,this.symbolLayers=new pFe,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const t of this.symbolLayers.items)switch(t.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return tFe(this)}hasVisibleVerticalOffset(){return Wue(this)}clone(){return new GS({verticalOffset:ie(this.verticalOffset),callout:ie(this.callout),styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromSimpleMarkerSymbol(t){return new GS({symbolLayers:[vw.fromSimpleMarkerSymbol(t)]})}static fromPictureMarkerSymbol(t){return new GS({symbolLayers:[vw.fromPictureMarkerSymbol(t)]})}static fromCIMSymbol(t){var i,n;if(((n=(i=t.data)==null?void 0:i.symbol)==null?void 0:n.type)!=="CIMPointSymbol")return null;const r=t.data.symbol;return new GS(r!=null&&r.callout?{symbolLayers:[vw.fromCIMSymbol(t)],callout:{type:"line",size:.5,color:[0,0,0]},verticalOffset:{screenLength:40}}:{symbolLayers:[vw.fromCIMSymbol(t)]})}static fromTextSymbol(t){return new GS({symbolLayers:[FE.fromTextSymbol(t)]})}};d([p({type:nFe,json:{write:!0}})],HS.prototype,"verticalOffset",void 0),d([p(iFe)],HS.prototype,"callout",void 0),d([p({type:pFe,json:{origins:{"web-scene":{write:!0}}}})],HS.prototype,"symbolLayers",void 0),d([Rt({PointSymbol3D:"point-3d"},{readOnly:!0})],HS.prototype,"type",void 0),HS=GS=d([I("esri.symbols.PointSymbol3D")],HS);const _w=HS;var MI;const fFe=vt.ofType({base:null,key:"type",typeMap:{extrude:I4e,fill:F3,icon:vw,line:dF,object:Hue,text:FE,water:J4e}});let $I=MI=class extends k3{constructor(t){super(t),this.symbolLayers=new fFe,this.type="polygon-3d"}clone(){return new MI({styleOrigin:ie(this.styleOrigin),symbolLayers:ie(this.symbolLayers),thumbnail:ie(this.thumbnail)})}static fromJSON(t){const e=new MI;if(e.read(t),e.symbolLayers.length===2&&e.symbolLayers.at(0).type==="fill"&&e.symbolLayers.at(1).type==="line"){const r=e.symbolLayers.at(0),i=e.symbolLayers.at(1);!i.enabled||t.symbolLayers&&t.symbolLayers[1]&&t.symbolLayers[1].enable===!1||(r.outline={size:i.size,color:i.material!=null?i.material.color:null}),e.symbolLayers.removeAt(1)}return e}static fromSimpleFillSymbol(t){return new MI({symbolLayers:[F3.fromSimpleFillSymbol(t)]})}};d([p({type:fFe,json:{write:!0}})],$I.prototype,"symbolLayers",void 0),d([Rt({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],$I.prototype,"type",void 0),$I=MI=d([I("esri.symbols.PolygonSymbol3D")],$I);const fF=$I;var Gte;const _X=new ri({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});let qS=Gte=class extends D4e{constructor(...t){super(...t),this.color=new ht([0,0,0,.25]),this.outline=new Rd,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.style=t),e&&(i.outline=e),r&&(i.color=r),i}clone(){return new Gte({color:ie(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}};d([p()],qS.prototype,"color",void 0),d([p()],qS.prototype,"outline",void 0),d([Rt({esriSFS:"simple-fill"},{readOnly:!0})],qS.prototype,"type",void 0),d([p({type:_X.apiValues,json:{read:_X.read,write:_X.write}})],qS.prototype,"style",void 0),qS=Gte=d([I("esri.symbols.SimpleFillSymbol")],qS);const X_=qS;var Hte;const bX=new ri({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});let ry=Hte=class extends aFe{constructor(...t){super(...t),this.color=new ht([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new Rd}normalizeCtorArgs(t,e,r,i){if(t&&typeof t!="string")return t;const n={};return t&&(n.style=t),e!=null&&(n.size=Ei(e)),r&&(n.outline=r),i&&(n.color=i),n}writeColor(t,e){t&&this.style!=="x"&&this.style!=="cross"&&(e.color=t.toJSON()),t===null&&(e.color=null)}set path(t){this.style="path",this._set("path",t)}clone(){return new Hte({angle:this.angle,color:ie(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${(t=this.outline)==null?void 0:t.hash()}`}};d([p()],ry.prototype,"color",void 0),d([tt("color")],ry.prototype,"writeColor",null),d([Rt({esriSMS:"simple-marker"},{readOnly:!0})],ry.prototype,"type",void 0),d([p()],ry.prototype,"size",void 0),d([p({type:bX.apiValues,json:{read:bX.read,write:bX.write}})],ry.prototype,"style",void 0),d([p({type:String,json:{write:!0}})],ry.prototype,"path",null),d([p({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":Rd}},json:{default:null,write:!0}})],ry.prototype,"outline",void 0),ry=Hte=d([I("esri.symbols.SimpleMarkerSymbol")],ry);const lg=ry;var qte;let hs=qte=class extends Cd{constructor(...t){super(...t),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new W7,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(t,e,r){if(t&&typeof t!="string")return t;const i={};return t&&(i.text=t),e&&(i.font=e),r&&(i.color=r),i}writeLineWidth(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}castLineWidth(t){return Ei(t)}writeLineHeight(t,e,r,i){i&&typeof i!="string"?i.origin:e[r]=t}clone(){return new qte({angle:this.angle,backgroundColor:ie(this.backgroundColor),borderLineColor:ie(this.borderLineColor),borderLineSize:this.borderLineSize,color:ie(this.color),font:this.font&&this.font.clone(),haloColor:ie(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){var t;return`${this.backgroundColor&&this.backgroundColor.hash()}.${this.borderLineColor}.${this.borderLineSize}.${(t=this.color)==null?void 0:t.hash()}.${this.font&&this.font.hash()}.${this.haloColor&&this.haloColor.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}};d([p({type:ht,json:{write:!0}})],hs.prototype,"backgroundColor",void 0),d([p({type:ht,json:{write:!0}})],hs.prototype,"borderLineColor",void 0),d([p({type:Number,json:{write:!0},cast:Ei})],hs.prototype,"borderLineSize",void 0),d([p({type:W7,json:{write:!0}})],hs.prototype,"font",void 0),d([p({...W4e,json:{write:!0}})],hs.prototype,"horizontalAlignment",void 0),d([p({type:Boolean,json:{write:!0}})],hs.prototype,"kerning",void 0),d([p({type:ht,json:{write:!0}})],hs.prototype,"haloColor",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],hs.prototype,"haloSize",void 0),d([p({type:Boolean,json:{write:!0}})],hs.prototype,"rightToLeft",void 0),d([p({type:Boolean,json:{write:!0}})],hs.prototype,"rotated",void 0),d([p({type:String,json:{write:!0}})],hs.prototype,"text",void 0),d([Rt({esriTS:"text"},{readOnly:!0})],hs.prototype,"type",void 0),d([p({...X4e,json:{write:!0}})],hs.prototype,"verticalAlignment",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],hs.prototype,"xoffset",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],hs.prototype,"yoffset",void 0),d([p({type:Number,json:{read:t=>t&&-1*t,write:(t,e)=>e.angle=t&&-1*t}})],hs.prototype,"angle",void 0),d([p({type:Number,json:{write:!0}})],hs.prototype,"width",void 0),d([p({type:Number})],hs.prototype,"lineWidth",void 0),d([tt("lineWidth")],hs.prototype,"writeLineWidth",null),d([ur("lineWidth")],hs.prototype,"castLineWidth",null),d([p(q4e)],hs.prototype,"lineHeight",void 0),d([tt("lineHeight")],hs.prototype,"writeLineHeight",null),hs=qte=d([I("esri.symbols.TextSymbol")],hs);const U3=hs;var Wte;let Yf=Wte=class extends Cd{constructor(t){super(t),this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const t=this.portal!=null?this.portal:Ns.getDefault(),e=t.user?t.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${e}:${t.url}`}read(t,e){this.portal=e==null?void 0:e.portal,super.read(t,e)}clone(){return new Wte({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(t){return this._fetchSymbol("webRef",t)}fetchCIMSymbol(t){return this._fetchSymbol("cimRef",t)}async _fetchSymbol(t,e){const r=e!=null?e.cache:null,i=r?this._fetchCacheKey:null;if(r!=null){const a=i&&r.get(i);if(a)return a.clone()}const{resolveWebStyleSymbol:n}=await le(()=>Promise.resolve().then(()=>GUt),void 0);vr(e);const s=n(this,{portal:this.portal},t,e);s.catch(a=>{re.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",a)});const o=await s;return t==="webRef"&&o.type==="point-3d"||t==="cimRef"&&o.type==="cim"?(r!=null&&r.set(i,o.clone()),o):null}};d([p({json:{write:!1}})],Yf.prototype,"color",void 0),d([p({type:String,json:{write:!0}})],Yf.prototype,"styleName",void 0),d([p({type:Ns,json:{write:!1}})],Yf.prototype,"portal",void 0),d([p({type:String,json:{read:N7,write:Qw}})],Yf.prototype,"styleUrl",void 0),d([p({type:x2,json:{read:!1}})],Yf.prototype,"thumbnail",void 0),d([p({type:String,json:{write:!0}})],Yf.prototype,"name",void 0),d([Rt({styleSymbolReference:"web-style"},{readOnly:!0})],Yf.prototype,"type",void 0),d([p()],Yf.prototype,"_fetchCacheKey",null),Yf=Wte=d([I("esri.symbols.WebStyleSymbol")],Yf);const kE=Yf;function Z7(t){if(!t)return!1;switch(t.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}}function rx(t){if(!t)return!1;switch(t.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}}const Um={base:Cd,key:"type",typeMap:{"simple-fill":X_,"picture-fill":hFe,"picture-marker":Y7,"simple-line":Rd,"simple-marker":lg,text:U3,"label-3d":X7,"line-3d":hF,"mesh-3d":pF,"point-3d":_w,"polygon-3d":fF,"web-style":kE,cim:N3},errorContext:"symbol"},Ebt={base:Cd,key:"type",typeMap:{"picture-marker":Y7,"simple-marker":lg,text:U3,"web-style":kE,cim:N3},errorContext:"symbol"},Cbt=E3({types:Um}),mFe={base:Cd,key:"type",typeMap:{"simple-fill":X_,"picture-fill":hFe,"picture-marker":Y7,"simple-line":Rd,"simple-marker":lg,text:U3,"line-3d":hF,"mesh-3d":pF,"point-3d":_w,"polygon-3d":fF,"web-style":kE,cim:N3},errorContext:"symbol"},Rbt={base:Cd,key:"type",typeMap:{text:U3,"label-3d":X7},errorContext:"symbol"},b_e={base:Cd,key:"type",typeMap:{"line-3d":hF,"mesh-3d":pF,"point-3d":_w,"polygon-3d":fF,"web-style":kE,cim:N3},errorContext:"symbol"},Obt={base:Cd,key:"type",typeMap:{"label-3d":X7},errorContext:"symbol"},gFe=ng(Um);var Xte;function Abt(t){if(!t)return null;const e={};for(const r in t){const i=P_(t[r]);i&&(e[r]=i)}return Object.keys(e).length!==0?e:null}function Pbt(t){if(t==null)return null;const e={};for(const r in t){const i=t[r];i&&(e[r]=i.toJSON())}return Object.keys(e).length!==0?e:null}let Mu=Xte=class extends Rn(me){constructor(...t){super(...t),this.isAggregate=!1,this.layer=null,this.popupTemplate=null,this.sourceLayer=null,Object.defineProperty(this,"uid",{value:au(),configurable:!0})}normalizeCtorArgs(t,e,r,i){return t&&!t.declaredClass?t:{geometry:t,symbol:e,attributes:r,popupTemplate:i}}set aggregateGeometries(t){const e=this._get("aggregateGeometries");JSON.stringify(e)!==JSON.stringify(t)&&this._set("aggregateGeometries",t)}set attributes(t){const e=this._get("attributes");e!==t&&(this._set("attributes",t),this._notifyLayer("attributes",e,t))}set geometry(t){const e=this._get("geometry");e!==t&&(this._set("geometry",t),this._notifyLayer("geometry",e,t))}set symbol(t){const e=this._get("symbol");e!==t&&(this._set("symbol",t),this._notifyLayer("symbol",e,t))}set visible(t){const e=this._get("visible");e!==t&&(this._set("visible",t),this._notifyLayer("visible",e,t))}cloneShallow(){return new Xte({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible})}getEffectivePopupTemplate(t=!1){if(this.popupTemplate)return this.popupTemplate;for(const e of[this.sourceLayer,this.layer])if(e){if("popupTemplate"in e&&e.popupTemplate)return e.popupTemplate;if(t&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate!=null)return e.defaultPopupTemplate}return null}getAttribute(t){var e;return(e=this.attributes)==null?void 0:e[t]}setAttribute(t,e){if(this.attributes){const r=this.getAttribute(t);this.attributes[t]=e,this._notifyLayer("attributes",r,e,t)}else this.attributes={[t]:e},this._notifyLayer("attributes",void 0,e,t)}getObjectId(){return this.sourceLayer&&"objectIdField"in this.sourceLayer&&this.sourceLayer.objectIdField?this.getAttribute(this.sourceLayer.objectIdField):null}toJSON(){return{aggregateGeometries:Pbt(this.aggregateGeometries),geometry:this.geometry!=null?this.geometry.toJSON():null,symbol:this.symbol!=null?this.symbol.toJSON():null,attributes:{...this.attributes},popupTemplate:this.popupTemplate&&this.popupTemplate.toJSON()}}notifyGeometryChanged(){this._notifyLayer("geometry",this.geometry,this.geometry)}notifyMeshTransformChanged(t={}){const{geometry:e}=this;if((e==null?void 0:e.type)==="mesh"){const r={origin:e.origin,transform:e.transform};this._notifyLayer("origin-transform",r,r,t.action)}}_notifyLayer(t,e,r,i){if(!this.layer||!("graphicChanged"in this.layer))return;const n={graphic:this,property:t,oldValue:e,newValue:r};t==="origin-transform"&&(n.action=i),t==="attributes"&&(n.attributeName=i),this.layer.graphicChanged(n)}};d([p({value:null,json:{read:Abt}})],Mu.prototype,"aggregateGeometries",null),d([p({value:null})],Mu.prototype,"attributes",null),d([p({value:null,types:ME,json:{read:P_}})],Mu.prototype,"geometry",null),d([p({type:Boolean})],Mu.prototype,"isAggregate",void 0),d([p({clonable:"reference"})],Mu.prototype,"layer",void 0),d([p({type:LE})],Mu.prototype,"popupTemplate",void 0),d([p({clonable:"reference"})],Mu.prototype,"sourceLayer",void 0),d([p({value:null,types:Um})],Mu.prototype,"symbol",null),d([p({type:Boolean,value:!0})],Mu.prototype,"visible",null),Mu=Xte=d([I("esri.Graphic")],Mu),function(t){t.generateUID=au}(Mu||(Mu={}));const cf=Mu;function uf(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Mbt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Yue(t,e,r,i,n,s,o,a,l,c){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t[6]=a,t[7]=l,t[8]=c,t}function Zue(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function df(t,e){if(t===e){const r=e[1],i=e[2],n=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=i,t[7]=n}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function UE(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=u*o-a*c,f=-u*s+a*l,m=c*s-o*l;let g=r*h+i*f+n*m;return g?(g=1/g,t[0]=h*g,t[1]=(-u*i+n*c)*g,t[2]=(a*i-n*o)*g,t[3]=f*g,t[4]=(u*r-n*l)*g,t[5]=(-a*r+n*s)*g,t[6]=m*g,t[7]=(-c*r+i*l)*g,t[8]=(o*r-i*s)*g,t):null}function $bt(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t[0]=o*u-a*c,t[1]=n*c-i*u,t[2]=i*a-n*o,t[3]=a*l-s*u,t[4]=r*u-n*l,t[5]=n*s-r*a,t[6]=s*c-o*l,t[7]=i*l-r*c,t[8]=r*o-i*s,t}function Ibt(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8];return e*(c*s-o*l)+r*(-c*n+o*a)+i*(l*n-s*a)}function $P(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=r[0],m=r[1],g=r[2],y=r[3],_=r[4],b=r[5],w=r[6],x=r[7],S=r[8];return t[0]=f*i+m*o+g*c,t[1]=f*n+m*a+g*u,t[2]=f*s+m*l+g*h,t[3]=y*i+_*o+b*c,t[4]=y*n+_*a+b*u,t[5]=y*s+_*l+b*h,t[6]=w*i+x*o+S*c,t[7]=w*n+x*a+S*u,t[8]=w*s+x*l+S*h,t}function sB(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=r[0],m=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t[6]=f*i+m*o+c,t[7]=f*n+m*a+u,t[8]=f*s+m*l+h,t}function Jue(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=Math.sin(r),m=Math.cos(r);return t[0]=m*i+f*o,t[1]=m*n+f*a,t[2]=m*s+f*l,t[3]=m*o-f*i,t[4]=m*a-f*n,t[5]=m*l-f*s,t[6]=c,t[7]=u,t[8]=h,t}function Kue(t,e,r){const i=r[0],n=r[1],s=r[2];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t[6]=s*e[6],t[7]=s*e[7],t[8]=s*e[8],t}function Lbt(t,e,r){const i=r[0],n=r[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=n*e[3],t[4]=n*e[4],t[5]=n*e[5],t}function Dbt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Nbt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=0,t[3]=-r,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Fbt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function kbt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function J7(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r+r,a=i+i,l=n+n,c=r*o,u=i*o,h=i*a,f=n*o,m=n*a,g=n*l,y=s*o,_=s*a,b=s*l;return t[0]=1-h-g,t[3]=u-b,t[6]=f+_,t[1]=u+b,t[4]=1-c-g,t[7]=m-y,t[2]=f-_,t[5]=m+y,t[8]=1-c-h,t}function yFe(t,e){const r=e[0],i=e[1],n=e[2],s=e[4],o=e[5],a=e[6],l=e[8],c=e[9],u=e[10],h=u*o-a*c,f=-u*s+a*l,m=c*s-o*l,g=r*h+i*f+n*m;if(!g)return null;const y=1/g;return t[0]=h*y,t[1]=(-u*i+n*c)*y,t[2]=(a*i-n*o)*y,t[3]=f*y,t[4]=(u*r-n*l)*y,t[5]=(-a*r+n*s)*y,t[6]=m*y,t[7]=(-c*r+i*l)*y,t[8]=(o*r-i*s)*y,t}function ix(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],m=e[11],g=e[12],y=e[13],_=e[14],b=e[15],w=r*a-i*o,x=r*l-n*o,S=r*c-s*o,C=i*l-n*a,E=i*c-s*a,R=n*c-s*l,P=u*y-h*g,D=u*_-f*g,L=u*b-m*g,k=h*_-f*y,V=h*b-m*y,W=f*b-m*_;let G=w*W-x*V+S*k+C*L-E*D+R*P;return G?(G=1/G,t[0]=(a*W-l*V+c*k)*G,t[1]=(l*L-o*W-c*D)*G,t[2]=(o*V-a*L+c*P)*G,t[3]=(n*V-i*W-s*k)*G,t[4]=(r*W-n*L+s*D)*G,t[5]=(i*L-r*V-s*P)*G,t[6]=(y*R-_*E+b*C)*G,t[7]=(_*S-g*R-b*x)*G,t[8]=(g*E-y*S+b*w)*G,t):null}function Ubt(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function zbt(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Vbt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+t[6]**2+t[7]**2+t[8]**2)}function Bbt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function vFe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function jbt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Gbt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t[6]=e[6]+r[6]*i,t[7]=e[7]+r[7]*i,t[8]=e[8]+r[8]*i,t}function Hbt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function qbt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=e[0],f=e[1],m=e[2],g=e[3],y=e[4],_=e[5],b=e[6],w=e[7],x=e[8],S=Bl();return Math.abs(r-h)<=S*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(i-f)<=S*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(n-m)<=S*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(s-g)<=S*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(o-y)<=S*Math.max(1,Math.abs(o),Math.abs(y))&&Math.abs(a-_)<=S*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(l-b)<=S*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(c-w)<=S*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(u-x)<=S*Math.max(1,Math.abs(u),Math.abs(x))}function Que(t){const e=Bl(),r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return Math.abs(1-(r*r+s*s+l*l))<=e&&Math.abs(1-(i*i+o*o+c*c))<=e&&Math.abs(1-(n*n+a*a+u*u))<=e}const Wbt=$P,Xbt=vFe;Object.freeze(Object.defineProperty({__proto__:null,add:Bbt,adjoint:$bt,copy:Mbt,determinant:Ibt,equals:qbt,exactEquals:Hbt,frob:Vbt,fromMat2d:kbt,fromMat4:uf,fromQuat:J7,fromRotation:Nbt,fromScaling:Fbt,fromTranslation:Dbt,identity:Zue,invert:UE,isOrthoNormal:Que,mul:Wbt,multiply:$P,multiplyScalar:jbt,multiplyScalarAndAdd:Gbt,normalFromMat4:ix,normalFromMat4Legacy:yFe,projection:Ubt,rotate:Jue,scale:Kue,scaleByVec2:Lbt,set:Yue,str:zbt,sub:Xbt,subtract:vFe,translate:sB,transpose:df},Symbol.toStringTag,{value:"Module"}));function vn(){return[1,0,0,0,1,0,0,0,1]}function _Fe(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8]]}function Ybt(t,e,r,i,n,s,o,a,l){return[t,e,r,i,n,s,o,a,l]}function bFe(t,e){return new Float64Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:_Fe,create:vn,createView:bFe,fromValues:Ybt},Symbol.toStringTag,{value:"Module"}));function Me(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function IP(t){return[t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15]]}function ede(t,e,r,i,n,s,o,a,l,c,u,h,f,m,g,y){return[t,e,r,i,n,s,o,a,l,c,u,h,f,m,g,y]}function wFe(t,e){return new Float64Array(t,e,16)}const bo=Me();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:bo,clone:IP,create:Me,createView:wFe,fromValues:ede},Symbol.toStringTag,{value:"Module"}));let Y_=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return this._itemsPtr===0&&dP(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3*w_e);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,w_e));e++)this._items.push(this._allocator())}};const w_e=1024;function wr(){return[0,0,0,0]}function mF(t){return[t[0],t[1],t[2],t[3]]}function nr(t,e,r,i){return[t,e,r,i]}function tde(t){const e=wr(),r=Math.min(4,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function xFe(t,e){return new Float64Array(t,e,4)}function SFe(){return wr()}function TFe(){return nr(1,1,1,1)}function EFe(){return nr(1,0,0,0)}function CFe(){return nr(0,1,0,0)}function RFe(){return nr(0,0,1,0)}function OFe(){return nr(0,0,0,1)}const Wy=SFe(),Np=TFe(),Zbt=EFe(),Jbt=CFe(),Kbt=RFe(),Qbt=OFe();Object.freeze(Object.defineProperty({__proto__:null,ONES:Np,UNIT_W:Qbt,UNIT_X:Zbt,UNIT_Y:Jbt,UNIT_Z:Kbt,ZEROS:Wy,clone:mF,create:wr,createView:xFe,fromArray:tde,fromValues:nr,ones:TFe,unitW:OFe,unitX:EFe,unitY:CFe,unitZ:RFe,zeros:SFe},Symbol.toStringTag,{value:"Module"}));var oB;(function(t){t[t.KILOBYTES=1024]="KILOBYTES",t[t.MEGABYTES=1048576]="MEGABYTES",t[t.GIGABYTES=1073741824]="GIGABYTES"})(oB||(oB={}));function bf(){return[0,0,0,1]}function ewt(t){return[t[0],t[1],t[2],t[3]]}function twt(t,e,r,i){return[t,e,r,i]}function AFe(t,e){return new Float64Array(t,e,4)}const rwt=bf();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:rwt,clone:ewt,create:bf,createView:AFe,fromValues:twt},Symbol.toStringTag,{value:"Module"}));function Qe(){return[0,0]}function BO(t){return[t[0],t[1]]}function Nr(t,e){return[t,e]}function PFe(t){const e=Qe(),r=Math.min(2,t.length);for(let i=0;i<r;++i)e[i]=t[i];return e}function MFe(t,e){return new Float64Array(t,e,2)}function $Fe(){return Qe()}function IFe(){return Nr(1,1)}function LFe(){return Nr(1,0)}function DFe(){return Nr(0,1)}const cg=$Fe(),iwt=IFe(),NFe=LFe(),nwt=DFe();Object.freeze(Object.defineProperty({__proto__:null,ONES:iwt,UNIT_X:NFe,UNIT_Y:nwt,ZEROS:cg,clone:BO,create:Qe,createView:MFe,fromArray:PFe,fromValues:Nr,ones:IFe,unitX:LFe,unitY:DFe,zeros:$Fe},Symbol.toStringTag,{value:"Module"}));let z3=class WS{constructor(e,r,i){this._itemByteSize=e,this._itemCreate=r,this._buffers=new Array,this._items=new Array,this._itemsPtr=0,this._itemsPerBuffer=Math.ceil(i/this._itemByteSize)}get(){this._itemsPtr===0&&dP(()=>this._reset());const e=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=e;){const r=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let i=0;i<this._itemsPerBuffer;++i)this._items.push(this._itemCreate(r,i*this._itemByteSize));this._buffers.push(r)}return this._items[this._itemsPtr++]}_reset(){const e=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>e;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0}static createVec2f64(e=cC){return new WS(16,MFe,e)}static createVec3f64(e=cC){return new WS(24,Ice,e)}static createVec4f64(e=cC){return new WS(32,xFe,e)}static createMat3f64(e=cC){return new WS(72,bFe,e)}static createMat4f64(e=cC){return new WS(128,wFe,e)}static createQuatf64(e=cC){return new WS(32,AFe,e)}get test(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}};const cC=4*oB.KILOBYTES,lfr=z3.createVec2f64(),ut=z3.createVec3f64(),rde=z3.createVec4f64();z3.createMat3f64();const ide=z3.createMat4f64(),cfr=z3.createQuatf64();function la(t){return t?x_e(qi(t.origin),qi(t.direction)):x_e(A(),A())}function x_e(t,e){return{origin:t,direction:e}}function ufr(t,e){return T_(t.origin,e.origin)&&T_(t.direction,e.direction)}function Ah(t,e){const r=lwt.get();return r.origin=t,r.direction=e,r}function aB(t,e=la()){return FFe(t.origin,t.direction,e)}function swt(t,e,r=la()){return oe(r.origin,t),ve(r.direction,e,t),r}function FFe(t,e,r=la()){return oe(r.origin,t),oe(r.direction,e),r}function owt(t,e){const r=Lt(ut.get(),Se(ut.get(),t.direction),ve(ut.get(),e,t.origin));return ye(r,r)}function awt(t,e,r){const i=ye(t.direction,ve(r,e,t.origin));return ge(r,t.origin,ce(r,t.direction,i)),r}const lwt=new Y_(()=>la());function K7(t){return t?{ray:la(t.ray),c0:t.c0,c1:t.c1}:{ray:la(),c0:0,c1:Number.MAX_VALUE}}function cwt(t,e=K7()){return aB(t,e.ray),e.c0=0,e.c1=Number.MAX_VALUE,e}function uwt(t,e,r=K7()){const i=We(t.vector);return FFe(t.origin,e,r.ray),r.c0=0,r.c1=i,r}function dfr(t,e){return kFe(t,t.c0,e)}function hfr(t,e){return kFe(t,t.c1,e)}function kFe(t,e,r){return ge(r,t.ray.origin,ce(r,t.ray.direction,e))}new Y_(()=>K7());var od;(function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"})(od||(od={}));function pfr(t,e,r){const i=ye(t,e)/ye(t,t);return ce(r,t,i)}function kw(t,e){return ye(t,e)/We(t)}function Q7(t,e){const r=ye(t,e)/(We(t)*We(e));return-Vo(r)}function UFe(t,e,r){Se(ik,t),Se(wX,e);const i=ye(ik,wX),n=Vo(i),s=Lt(ik,ik,wX);return ye(s,r)<0?2*Math.PI-n:n}const ik=A(),wX=A(),zFe=us();function us(){return wr()}function LP(t,e=us()){return Up(e,t)}function VFe(t,e){return nr(t[0],t[1],t[2],e)}function dwt(t){return t}function hwt(t){t[0]=t[1]=t[2]=t[3]=0}function eH(t,e){return t[0]=t[1]=t[2]=0,t[3]=e,t}function t_(t){return t[3]}function pwt(t){return t}function BFe(t,e,r,i){return nr(t,e,r,i)}function fwt(t,e,r){return t!==r&&oe(r,t),r[3]=t[3]+e,r}function mwt(t,e,r){return re.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported"),t===r?r:LP(t,r)}function Cx(t,e,r){if(e==null)return!1;const{origin:i,direction:n}=e,s=gwt;s[0]=i[0]-t[0],s[1]=i[1]-t[1],s[2]=i[2]-t[2];const o=n[0]*n[0]+n[1]*n[1]+n[2]*n[2];if(o===0)return!1;const a=2*(n[0]*s[0]+n[1]*s[1]+n[2]*s[2]),l=a*a-4*o*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-t[3]*t[3]);if(l<0)return!1;const c=Math.sqrt(l);let u=(-a-c)/(2*o);const h=(-a+c)/(2*o);return(u<0||h<u&&h>0)&&(u=h),!(u<0)&&(r&&(r[0]=i[0]+n[0]*u,r[1]=i[1]+n[1]*u,r[2]=i[2]+n[2]*u),!0)}const gwt=A();function Yte(t,e){return Cx(t,e,null)}function ywt(t,e,r){if(Cx(t,e,r))return r;const i=V3(t,e,ut.get());return ge(r,e.origin,ce(ut.get(),e.direction,Li(e.origin,i)/We(e.direction))),r}function V3(t,e,r){const i=ut.get(),n=ide.get();Lt(i,e.origin,e.direction);const s=t_(t);Lt(r,i,e.origin),ce(r,r,1/We(r)*s);const o=HFe(t,e.origin),a=Q7(e.origin,r);return Ch(n,a+o,i),lt(r,r,n),r}function vwt(t,e,r){return Cx(t,e,r)?r:(awt(e,t,r),jFe(t,r,r))}function jFe(t,e,r){const i=ve(ut.get(),e,t),n=ce(ut.get(),i,t[3]/We(i));return ge(r,n,t)}function GFe(t,e){const r=ve(ut.get(),e,t),i=Al(r),n=t[3]*t[3];return Math.sqrt(Math.abs(i-n))}function HFe(t,e){const r=ve(ut.get(),e,t),i=We(r),n=t_(t),s=n+Math.abs(n-i);return Vo(n/s)}const xX=A();function qFe(t,e,r,i){const n=ve(xX,e,t);switch(r){case od.X:{const s=cve(n,xX)[2];return se(i,-Math.sin(s),Math.cos(s),0)}case od.Y:{const s=cve(n,xX),o=s[1],a=s[2],l=Math.sin(o);return se(i,-l*Math.cos(a),-l*Math.sin(a),Math.cos(o))}case od.Z:return Se(i,n);default:return}}function WFe(t,e){const r=ve(Zte,e,t);return We(r)-t[3]}function _wt(t,e,r,i){const n=WFe(t,e),s=qFe(t,e,od.Z,Zte),o=ce(Zte,s,r-n);return ge(i,e,o)}function bwt(t,e){const r=ks(t,e),i=t_(t);return r<=i*i}function wwt(t,e,r=us()){const i=Li(t,e),n=t[3],s=e[3];return i+s<n?(Up(r,t),r):i+n<s?(Up(r,e),r):(mi(r,t,e,(i+s-n)/(2*i)),r[3]=(i+n+s)/2,r)}const Zte=A(),tH=us(),xwt=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:zFe,altitudeAt:WFe,angleToSilhouette:HFe,axisAt:qFe,clear:hwt,closestPoint:vwt,closestPointOnSilhouette:V3,containsPoint:bwt,copy:LP,create:us,distanceToSilhouette:GFe,elevate:fwt,fromCenterAndRadius:VFe,fromRadius:eH,fromValues:BFe,getCenter:pwt,getRadius:t_,intersectRay:Cx,intersectRayClosestSilhouette:ywt,intersectsRay:Yte,projectPoint:jFe,setAltitudeAt:_wt,setExtent:mwt,tmpSphere:tH,union:wwt,wrap:dwt},Symbol.toStringTag,{value:"Module"}));function oi(t=II){return[t[0],t[1],t[2],t[3]]}function Swt(t=II[0],e=II[1],r=II[2],i=II[3]){return nde(t,e,r,i,rde.get())}function rH(t,e){return nde(e[0],e[1],e[2],e[3],t)}function nde(t,e,r,i,n=oi()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function XFe(t,e,r){return oe(r,t),r[3]=e,r}function gF(t,e,r){const i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function Rl(t,e,r,i=oi()){const n=r[0]-e[0],s=r[1]-e[1],o=r[2]-e[2],a=t[0]-e[0],l=t[1]-e[1],c=t[2]-e[2],u=s*c-o*l,h=o*a-n*c,f=n*l-s*a,m=u*u+h*h+f*f,g=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return i[0]=u*g,i[1]=h*g,i[2]=f*g,i[3]=-(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]),i}function YFe(t,e,r,i,n){const s=t.length/3;if(s<3)return!1;se(NM,t[3*r],t[3*r+1],t[3*r+2]);let o=i,a=!1;for(;o<s-1&&!a;){const l=3*o;se(uC,t[l],t[l+1],t[l+2]),o++,a=!gi(NM,uC)}if(!a)return!1;for(o=Math.max(o,n),a=!1;o<s&&!a;){const l=3*o;se(FT,t[l],t[l+1],t[l+2]),o++,ve(nk,NM,uC),Se(nk,nk),ve(sk,uC,FT),Se(sk,sk),a=!gi(NM,FT)&&!gi(uC,FT)&&Math.abs(ye(nk,sk))<Twt}return a?(Rl(NM,uC,FT,e),!0):(r!==0||i!==1||n!==2)&&YFe(t,e,0,1,2)}const Twt=.99619469809,NM=A(),uC=A(),FT=A(),nk=A(),sk=A();function Jte(t,e,r){return e!==t&&rH(t,e),t[3]=-ye(t,r),t}function Kte(t,e){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function IN(t,e,r,i){return Lt(FT,e,t),gF(r,FT,i)}function ffr(t,e,r,i){return iH(t,e,ve(ut.get(),r,e),Pwt,i)}function zE(t,e,r){return e!=null&&iH(t,e.origin,e.direction,Mwt,r)}function Ewt(t,e,r){return iH(t,e.origin,e.vector,Xy.NONE,r)}function Cwt(t,e,r){return iH(t,e.origin,e.vector,Xy.CLAMP,r)}function ZFe(t,e){return zi(t,e)>=0}function Rwt(t,e){const r=ye(t,e.ray.direction),i=-zi(t,e.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function Owt(t,e){const r=ye(t,e.ray.direction),i=-zi(t,e.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const n=i/r;return r>0?n<e.c1&&(e.c1=n):n>e.c0&&(e.c0=n),e.c0<=e.c1}function Awt(t,e,r){const i=ce(ut.get(),t,-t[3]),n=Qte(t,ve(ut.get(),e,i),ut.get());return ge(r,n,i),r}function mfr(t,e,r,i){const n=t,s=ut.get(),o=ut.get();dvt(n,s,o);const a=ve(ut.get(),r,e),l=kw(s,a),c=kw(o,a),u=kw(n,a);return se(i,l,c,u)}function Qte(t,e,r){const i=ce(ut.get(),t,ye(t,e));return ve(r,e,i),r}function zi(t,e){return ye(t,e)+t[3]}function iH(t,e,r,i,n){const s=ye(t,r);if(s===0)return!1;let o=-(ye(t,e)+t[3])/s;return i&Xy.CLAMP&&(o=Te(o,0,1)),!(!(i&Xy.INFINITE_MIN)&&o<0||!(i&Xy.INFINITE_MAX)&&o>1)&&(ge(n,e,ce(n,r,o)),!0)}function gfr(t){return t}const II=[0,0,1,0];var Xy;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.INFINITE_MIN=4]="INFINITE_MIN",t[t.INFINITE_MAX=8]="INFINITE_MAX"})(Xy||(Xy={}));const Pwt=Xy.INFINITE_MIN|Xy.INFINITE_MAX,Mwt=Xy.INFINITE_MAX;function LN(t){return t?[oi(t[0]),oi(t[1]),oi(t[2]),oi(t[3]),oi(t[4]),oi(t[5])]:[oi(),oi(),oi(),oi(),oi(),oi()]}function JFe(){return[A(),A(),A(),A(),A(),A(),A(),A()]}function lB(t,e){for(let r=0;r<B3;r++)rH(t[r],e[r])}function KFe(t,e,r,i=Fwt){const n=Ii(ide.get(),e,t);Uo(n,n);for(let s=0;s<Dwt;++s){const o=hh(rde.get(),Nwt[s],n);se(i[s],o[0]/o[3],o[1]/o[3],o[2]/o[3])}QFe(r,i)}function QFe(t,e){Rl(e[Ct.FAR_BOTTOM_LEFT],e[Ct.NEAR_BOTTOM_LEFT],e[Ct.NEAR_TOP_LEFT],t[Ui.LEFT]),Rl(e[Ct.NEAR_BOTTOM_RIGHT],e[Ct.FAR_BOTTOM_RIGHT],e[Ct.FAR_TOP_RIGHT],t[Ui.RIGHT]),Rl(e[Ct.FAR_BOTTOM_LEFT],e[Ct.FAR_BOTTOM_RIGHT],e[Ct.NEAR_BOTTOM_RIGHT],t[Ui.BOTTOM]),Rl(e[Ct.NEAR_TOP_LEFT],e[Ct.NEAR_TOP_RIGHT],e[Ct.FAR_TOP_RIGHT],t[Ui.TOP]),Rl(e[Ct.NEAR_BOTTOM_LEFT],e[Ct.NEAR_BOTTOM_RIGHT],e[Ct.NEAR_TOP_RIGHT],t[Ui.NEAR]),Rl(e[Ct.FAR_BOTTOM_RIGHT],e[Ct.FAR_BOTTOM_LEFT],e[Ct.FAR_TOP_LEFT],t[Ui.FAR])}function bw(t,e){for(let r=0;r<B3;r++){const i=t[r];if(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]+i[3]>=e[3])return!1}return!0}function $wt(t,e){return t5e(t,cwt(e,r5e.get()))}function yfr(t,e){for(let r=0;r<B3;r++){const i=t[r];if(!Owt(i,e))return!1}return!0}function Iwt(t,e,r){return t5e(t,uwt(e,r,r5e.get()))}function e5e(t,e){for(let r=0;r<B3;r++)if(zi(t[r],e)>0)return!1;return!0}function t5e(t,e){for(let r=0;r<B3;r++)if(!Rwt(t[r],e))return!1;return!0}var Ui,Ct;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.TOP=3]="TOP",t[t.NEAR=4]="NEAR",t[t.FAR=5]="FAR"})(Ui||(Ui={})),function(t){t[t.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT",t[t.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT",t[t.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT",t[t.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT",t[t.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT",t[t.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT",t[t.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT",t[t.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"}(Ct||(Ct={}));const Lwt={bottom:[Ct.FAR_BOTTOM_RIGHT,Ct.NEAR_BOTTOM_RIGHT,Ct.NEAR_BOTTOM_LEFT,Ct.FAR_BOTTOM_LEFT],near:[Ct.NEAR_BOTTOM_LEFT,Ct.NEAR_BOTTOM_RIGHT,Ct.NEAR_TOP_RIGHT,Ct.NEAR_TOP_LEFT],far:[Ct.FAR_BOTTOM_RIGHT,Ct.FAR_BOTTOM_LEFT,Ct.FAR_TOP_LEFT,Ct.FAR_TOP_RIGHT],right:[Ct.NEAR_BOTTOM_RIGHT,Ct.FAR_BOTTOM_RIGHT,Ct.FAR_TOP_RIGHT,Ct.NEAR_TOP_RIGHT],left:[Ct.FAR_BOTTOM_LEFT,Ct.NEAR_BOTTOM_LEFT,Ct.NEAR_TOP_LEFT,Ct.FAR_TOP_LEFT],top:[Ct.FAR_TOP_LEFT,Ct.NEAR_TOP_LEFT,Ct.NEAR_TOP_RIGHT,Ct.FAR_TOP_RIGHT]},B3=6,Dwt=8,Nwt=[nr(-1,-1,-1,1),nr(1,-1,-1,1),nr(1,1,-1,1),nr(-1,1,-1,1),nr(-1,-1,1,1),nr(1,-1,1,1),nr(1,1,1,1),nr(-1,1,1,1)],r5e=new Y_(K7),Fwt=JFe(),sde=96;function vfr(t,e){const r=e||t.extent,i=t.width,n=Pc(r&&r.spatialReference);return r&&i?r.width/i*n*Cce*sde:0}function kwt(t,e){return t/(Pc(e)*Cce*sde)}function Uwt(t){return t/(Cce*sde)}var Sn,Ia;(function(t){t[t.OBJECT=0]="OBJECT",t[t.HUD=1]="HUD",t[t.TERRAIN=2]="TERRAIN",t[t.OVERLAY=3]="OVERLAY",t[t.I3S=4]="I3S",t[t.PCL=5]="PCL",t[t.LOD=6]="LOD",t[t.VOXEL=7]="VOXEL"})(Sn||(Sn={}));let zwt=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerUids=[],this.store=Ia.ALL}};(function(t){t[t.MIN=0]="MIN",t[t.MINMAX=1]="MINMAX",t[t.ALL=2]="ALL"})(Ia||(Ia={}));let Vwt=class{constructor(e,r,i){this.object=e,this.geometryId=r,this.triangleNr=i}},Bwt=class extends Vwt{constructor(e,r,i,n){super(e,r,i),this.center=n!=null?qi(n):null}},i5e=class{constructor(e){this.layerUid=e}},nH=class extends i5e{constructor(e,r){super(e),this.graphicUid=r}};function fg(t){return t?{origin:qi(t.origin),vector:qi(t.vector)}:{origin:A(),vector:A()}}function jwt(t,e){const r=Hwt.get();return r.origin=t,r.vector=e,r}function Tfr(t,e=fg()){return Gwt(t.origin,t.vector,e)}function Gwt(t,e,r=fg()){return oe(r.origin,t),oe(r.vector,e),r}function S2(t,e,r=fg()){return oe(r.origin,t),ve(r.vector,e,t),r}function ode(t,e){const r=ve(ut.get(),e,t.origin),i=ye(t.vector,r),n=ye(t.vector,t.vector),s=Te(i/n,0,1),o=ve(ut.get(),ce(ut.get(),t.vector,s),r);return ye(o,o)}function Efr(t,e,r){return ere(t,e,0,1,r)}function Cfr(t,e,r){return ge(r,t.origin,ce(r,t.vector,e))}function ere(t,e,r,i,n){const{vector:s,origin:o}=t,a=ve(ut.get(),e,o),l=ye(s,a)/Al(s);return ce(n,s,Te(l,r,i)),ge(n,n,t.origin)}function Rfr(t,e){if(s5e(t,jwt(e.origin,e.direction),!1,cB)){const{tA:r,pB:i,distance2:n}=cB;if(r>=0&&r<=1)return n;if(r<0)return ks(t.origin,i);if(r>1)return ks(ge(ut.get(),t.origin,t.vector),i)}return null}function n5e(t,e,r){return!!s5e(t,e,!0,cB)&&(oe(r,cB.pA),!0)}function s5e(t,e,r,i){const s=t.origin,o=ge(ut.get(),s,t.vector),a=e.origin,l=ge(ut.get(),a,e.vector),c=ut.get(),u=ut.get();if(c[0]=s[0]-a[0],c[1]=s[1]-a[1],c[2]=s[2]-a[2],u[0]=l[0]-a[0],u[1]=l[1]-a[1],u[2]=l[2]-a[2],Math.abs(u[0])<1e-6&&Math.abs(u[1])<1e-6&&Math.abs(u[2])<1e-6)return!1;const h=ut.get();if(h[0]=o[0]-s[0],h[1]=o[1]-s[1],h[2]=o[2]-s[2],Math.abs(h[0])<1e-6&&Math.abs(h[1])<1e-6&&Math.abs(h[2])<1e-6)return!1;const f=c[0]*u[0]+c[1]*u[1]+c[2]*u[2],m=u[0]*h[0]+u[1]*h[1]+u[2]*h[2],g=c[0]*h[0]+c[1]*h[1]+c[2]*h[2],y=u[0]*u[0]+u[1]*u[1]+u[2]*u[2],_=(h[0]*h[0]+h[1]*h[1]+h[2]*h[2])*y-m*m;if(Math.abs(_)<1e-6)return!1;let b=(f*m-g*y)/_,w=(f+m*b)/y;r&&(b=Te(b,0,1),w=Te(w,0,1));const x=ut.get(),S=ut.get();return x[0]=s[0]+b*h[0],x[1]=s[1]+b*h[1],x[2]=s[2]+b*h[2],S[0]=a[0]+w*u[0],S[1]=a[1]+w*u[1],S[2]=a[2]+w*u[2],i.tA=b,i.tB=w,i.pA=x,i.pB=S,i.distance2=ks(x,S),!0}const cB={tA:0,tB:0,pA:A(),pB:A(),distance2:0},Hwt=new Y_(()=>fg()),SX=re.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");let qwt=class{constructor(){this.plane=oi(),this.origin=A(),this.basis1=A(),this.basis2=A()}};const o5e=qwt;function Z_(t=y5e){return{plane:oi(t.plane),origin:qi(t.origin),basis1:qi(t.basis1),basis2:qi(t.basis2)}}function Wwt(t,e,r){const i=sxt.get();return i.origin=t,i.basis1=e,i.basis2=r,i.plane=Swt(0,0,0,0),sH(i),i}function VE(t,e=Z_()){return ade(t.origin,t.basis1,t.basis2,e)}function Xwt(t,e){oe(e.origin,t.origin),oe(e.basis1,t.basis1),oe(e.basis2,t.basis2),rH(e.plane,t.plane)}function ade(t,e,r,i=Z_()){return oe(i.origin,t),oe(i.basis1,e),oe(i.basis2,r),sH(i),ixt(i,"fromValues()"),i}function sH(t){IN(t.basis2,t.basis1,t.origin,t.plane)}function a5e(t,e,r){t!==r&&VE(t,r);const i=ce(ut.get(),D_(t),e);return ge(r.origin,r.origin,i),r.plane[3]-=e,r}function Ywt(t,e,r){return l5e(e,r),a5e(r,dde(t,t.origin),r),r}function l5e(t,e=Z_()){const r=(t[2]-t[0])/2,i=(t[3]-t[1])/2;return se(e.origin,t[0]+r,t[1]+i,0),se(e.basis1,r,0,0),se(e.basis2,0,i,0),nde(0,0,1,0,e.plane),e}function lde(t,e,r){return!!zE(t.plane,e,r)&&m5e(t,r)}function Zwt(t,e,r){if(lde(t,e,r))return r;const i=c5e(t,e,ut.get());return ge(r,e.origin,ce(ut.get(),e.direction,Li(e.origin,i)/We(e.direction))),r}function c5e(t,e,r){const i=uB.get();g5e(t,e,i,uB.get());let n=Number.POSITIVE_INFINITY;for(const s of pde){const o=hde(t,s,oH.get()),a=ut.get();if(Ewt(i,o,a)){const l=H_(ut.get(),e.origin,a),c=Math.abs(Vo(ye(e.direction,l)));c<n&&(n=c,oe(r,a))}}return n===Number.POSITIVE_INFINITY?u5e(t,e,r):r}function u5e(t,e,r){if(lde(t,e,r))return r;const i=uB.get(),n=uB.get();g5e(t,e,i,n);let s=Number.POSITIVE_INFINITY;for(const o of pde){const a=hde(t,o,oH.get()),l=ut.get();if(Cwt(i,a,l)){const c=owt(e,l);if(!ZFe(n,l))continue;c<s&&(s=c,oe(r,l))}}return cde(t,e.origin)<s&&d5e(t,e.origin,r),r}function d5e(t,e,r){const i=Awt(t.plane,e,ut.get()),n=ere(S_e(t,t.basis1),i,-1,1,ut.get()),s=ere(S_e(t,t.basis2),i,-1,1,ut.get());return ve(r,ge(ut.get(),n,s),t.origin),r}function h5e(t,e,r){const{origin:i,basis1:n,basis2:s}=t,o=ve(ut.get(),e,i),a=kw(n,o),l=kw(s,o),c=kw(D_(t),o);return se(r,a,l,c)}function cde(t,e){const r=h5e(t,e,ut.get()),{basis1:i,basis2:n}=t,s=We(i),o=We(n),a=Math.max(Math.abs(r[0])-s,0),l=Math.max(Math.abs(r[1])-o,0),c=r[2];return a*a+l*l+c*c}function Jwt(t,e){return Math.sqrt(cde(t,e))}function Kwt(t,e){let r=Number.NEGATIVE_INFINITY;for(const i of pde){const n=hde(t,i,oH.get()),s=ode(n,e);s>r&&(r=s)}return Math.sqrt(r)}function ude(t,e){return ZFe(t.plane,e)&&m5e(t,e)}function Qwt(t,e,r,i){return rxt(t,r,i)}function dde(t,e){const r=-t.plane[3];return kw(D_(t),e)-r}function ext(t,e,r,i){const n=dde(t,e),s=ce(nxt,D_(t),r-n);return ge(i,e,s),i}function p5e(t,e){return gi(t.basis1,e.basis1)&&gi(t.basis2,e.basis2)&&gi(t.origin,e.origin)}function f5e(t,e,r){return t!==r&&VE(t,r),Uo(dC,e),Td(dC,dC),lt(r.basis1,t.basis1,dC),lt(r.basis2,t.basis2,dC),lt(r.plane,t.plane,dC),lt(r.origin,t.origin,e),Jte(r.plane,r.plane,r.origin),r}function txt(t,e,r,i){return t!==i&&VE(t,i),Ch(TX,e,r),lt(i.basis1,t.basis1,TX),lt(i.basis2,t.basis2,TX),sH(i),i}function D_(t){return t.plane}function rxt(t,e,r){switch(e){case od.X:oe(r,t.basis1),Se(r,r);break;case od.Y:oe(r,t.basis2),Se(r,r);break;case od.Z:oe(r,D_(t))}return r}function m5e(t,e){const r=ve(ut.get(),e,t.origin),i=Al(t.basis1),n=Al(t.basis2),s=ye(t.basis1,r),o=ye(t.basis2,r);return-s-i<0&&s-i<0&&-o-n<0&&o-n<0}function S_e(t,e){const r=oH.get();return oe(r.origin,t.origin),oe(r.vector,e),r}function hde(t,e,r){const{basis1:i,basis2:n,origin:s}=t,o=ce(ut.get(),i,e.origin[0]),a=ce(ut.get(),n,e.origin[1]);ge(r.origin,o,a),ge(r.origin,r.origin,s);const l=ce(ut.get(),i,e.direction[0]),c=ce(ut.get(),n,e.direction[1]);return ce(r.vector,ge(l,l,c),2),r}function ixt(t,e){Math.abs(ye(t.basis1,t.basis2)/(We(t.basis1)*We(t.basis2)))>1e-6&&SX.warn(e,"Provided basis vectors are not perpendicular"),Math.abs(ye(t.basis1,D_(t)))>1e-6&&SX.warn(e,"Basis vectors and plane normal are not perpendicular"),Math.abs(-ye(D_(t),t.origin)-t.plane[3])>1e-6&&SX.warn(e,"Plane offset is not consistent with plane origin")}function g5e(t,e,r,i){const n=D_(t);IN(n,e.direction,e.origin,r),IN(r,n,e.origin,i)}const y5e={plane:oi(),origin:Ue(0,0,0),basis1:Ue(1,0,0),basis2:Ue(0,1,0)},uB=new Y_(oi),oH=new Y_(fg),nxt=A(),sxt=new Y_(()=>Z_()),pde=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],dC=Me(),TX=Me(),oxt=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:o5e,UP:y5e,altitudeAt:dde,axisAt:Qwt,closestPoint:u5e,closestPointOnSilhouette:c5e,copy:VE,copyWithoutVerify:Xwt,create:Z_,distance:Jwt,distance2:cde,distanceToSilhouette:Kwt,elevate:a5e,equals:p5e,extrusionContainsPoint:ude,fromAABoundingRect:l5e,fromValues:ade,intersectRay:lde,intersectRayClosestSilhouette:Zwt,normal:D_,projectPoint:d5e,projectPointLocal:h5e,rotate:txt,setAltitudeAt:ext,setExtent:Ywt,transform:f5e,updateUnboundedPlane:sH,wrap:Wwt},Symbol.toStringTag,{value:"Module"}));function mg(t){return t!=null&&t.dist!=null}function T_e(t){return(e,r,i)=>(mi(E_e,e,r,i),!ude(t,E_e))}function aH(t){return mg(t)&&t.intersector===Sn.OBJECT&&!!t.target}function lH(t){return mg(t)&&t.intersector===Sn.HUD&&!!t.target&&"center"in t.target&&t.target.center!=null}const E_e=A();function axt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function dB(t,e,r){r*=.5;const i=Math.sin(r);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(r),t}function fde(t,e){const r=2*Math.acos(e[3]),i=Math.sin(r/2);return i>Bl()?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),r}function cH(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*u+o*a+n*c-s*l,t[1]=n*u+o*l+s*a-i*c,t[2]=s*u+o*c+i*l-n*a,t[3]=o*u-i*a-n*l-s*c,t}function lxt(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+o*a,t[1]=n*l+s*a,t[2]=s*l-n*a,t[3]=o*l-i*a,t}function cxt(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l-s*a,t[1]=n*l+o*a,t[2]=s*l+i*a,t[3]=o*l-n*a,t}function uxt(t,e,r){r*=.5;const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+n*a,t[1]=n*l-i*a,t[2]=s*l+o*a,t[3]=o*l-s*a,t}function dxt(t,e){const r=e[0],i=e[1],n=e[2];return t[0]=r,t[1]=i,t[2]=n,t[3]=Math.sqrt(Math.abs(1-r*r-i*i-n*n)),t}function tz(t,e,r,i){const n=e[0],s=e[1],o=e[2],a=e[3];let l,c,u,h,f,m=r[0],g=r[1],y=r[2],_=r[3];return c=n*m+s*g+o*y+a*_,c<0&&(c=-c,m=-m,g=-g,y=-y,_=-_),1-c>Bl()?(l=Math.acos(c),u=Math.sin(l),h=Math.sin((1-i)*l)/u,f=Math.sin(i*l)/u):(h=1-i,f=i),t[0]=h*n+f*m,t[1]=h*s+f*g,t[2]=h*o+f*y,t[3]=h*a+f*_,t}function hxt(t){const e=q4,r=e(),i=e(),n=e(),s=Math.sqrt(1-r),o=Math.sqrt(r);return t[0]=s*Math.sin(2*Math.PI*i),t[1]=s*Math.cos(2*Math.PI*i),t[2]=o*Math.sin(2*Math.PI*n),t[3]=o*Math.cos(2*Math.PI*n),t}function pxt(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=r*r+i*i+n*n+s*s,a=o?1/o:0;return t[0]=-r*a,t[1]=-i*a,t[2]=-n*a,t[3]=s*a,t}function u0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function v5e(t,e){const r=e[0]+e[4]+e[8];let i;if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{let n=0;e[4]>e[0]&&(n=1),e[8]>e[3*n+n]&&(n=2);const s=(n+1)%3,o=(n+2)%3;i=Math.sqrt(e[3*n+n]-e[3*s+s]-e[3*o+o]+1),t[n]=.5*i,i=.5/i,t[3]=(e[3*s+o]-e[3*o+s])*i,t[s]=(e[3*s+n]+e[3*n+s])*i,t[o]=(e[3*o+n]+e[3*n+o])*i}return t}function fxt(t,e,r,i){const n=.5*Math.PI/180;e*=n,r*=n,i*=n;const s=Math.sin(e),o=Math.cos(e),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return t[0]=s*l*u-o*a*c,t[1]=o*a*u+s*l*c,t[2]=o*l*c-s*a*u,t[3]=o*l*u+s*a*c,t}function mxt(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}const yF=Up,gxt=Ki,yxt=kce,vxt=cH,_xt=eE,bxt=gLe,wxt=T7,_5e=Uce,xxt=_5e,b5e=zce,Sxt=b5e,mde=mLe,Txt=xA,Ext=NV;function Cxt(t,e,r){const i=ye(e,r);return i<-.999999?(Lt(Rg,Rxt,e),ju(Rg)<1e-6&&Lt(Rg,Oxt,e),Se(Rg,Rg),dB(t,Rg,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Lt(Rg,e,r),t[0]=Rg[0],t[1]=Rg[1],t[2]=Rg[2],t[3]=1+i,mde(t,t))}const Rg=A(),Rxt=Ue(1,0,0),Oxt=Ue(0,1,0);function Axt(t,e,r,i,n,s){return tz(C_e,e,n,s),tz(R_e,r,i,s),tz(t,C_e,R_e,2*s*(1-s)),t}const C_e=bf(),R_e=bf();function Pxt(t,e,r,i){const n=Mxt;return n[0]=r[0],n[3]=r[1],n[6]=r[2],n[1]=i[0],n[4]=i[1],n[7]=i[2],n[2]=-e[0],n[5]=-e[1],n[8]=-e[2],mde(t,v5e(t,n))}const Mxt=vn();Object.freeze(Object.defineProperty({__proto__:null,add:yxt,calculateW:dxt,conjugate:u0,copy:yF,dot:bxt,equals:Ext,exactEquals:Txt,fromEuler:fxt,fromMat3:v5e,getAxisAngle:fde,identity:axt,invert:pxt,len:xxt,length:_5e,lerp:wxt,mul:vxt,multiply:cH,normalize:mde,random:hxt,rotateX:lxt,rotateY:cxt,rotateZ:uxt,rotationTo:Cxt,scale:_xt,set:gxt,setAxes:Pxt,setAxisAngle:dB,slerp:tz,sqlerp:Axt,sqrLen:Sxt,squaredLength:b5e,str:mxt},Symbol.toStringTag,{value:"Module"}));function $n(){return new Float32Array(3)}function hB(t){const e=new Float32Array(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function xi(t,e,r){const i=new Float32Array(3);return i[0]=t,i[1]=e,i[2]=r,i}function w5e(t,e){return new Float32Array(t,e,3)}function gde(){return $n()}function x5e(){return xi(1,1,1)}function S5e(){return xi(1,0,0)}function T5e(){return xi(0,1,0)}function E5e(){return xi(0,0,1)}const $xt=gde(),Ixt=x5e(),Lxt=S5e(),Dxt=T5e(),Nxt=E5e();Object.freeze(Object.defineProperty({__proto__:null,ONES:Ixt,UNIT_X:Lxt,UNIT_Y:Dxt,UNIT_Z:Nxt,ZEROS:$xt,clone:hB,create:$n,createView:w5e,fromValues:xi,ones:x5e,unitX:S5e,unitY:T5e,unitZ:E5e,zeros:gde},Symbol.toStringTag,{value:"Module"}));let Fxt=class{constructor(){this._transform=Me(),this._transformInverse=new ok({value:this._transform},Uo,Me),this._transformInverseTranspose=new ok(this._transformInverse,Td,Me),this._transformTranspose=new ok({value:this._transform},Td,Me),this._transformInverseRotation=new ok({value:this._transform},yFe,vn)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){Rs(this._transform,e)}multiplyTransform(e){Ii(this._transform,this._transform,e)}set(e){Rs(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,r){this.setTransformMatrix(e),this.multiplyTransform(r),this._invalidateLazyTransforms()}},ok=class{constructor(e,r,i){this._original=e,this._update=r,this._dirty=!0,this._transform=i()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}},kxt=class{constructor(e=0){this.offset=e,this.tmpVertex=A()}applyToVertex(e,r,i){const n=e+this.localOrigin[0],s=r+this.localOrigin[1],o=i+this.localOrigin[2],a=this.offset/Math.sqrt(n*n+s*s+o*o);return this.tmpVertex[0]=e+n*a,this.tmpVertex[1]=r+s*a,this.tmpVertex[2]=i+o*a,this.tmpVertex}applyToAabb(e){for(let s=0;s<3;++s)T1[s]=e[0+s]+this.localOrigin[s],ak[s]=e[3+s]+this.localOrigin[s],FM[s]=T1[s];const r=this.applyToVertex(T1[0],T1[1],T1[2]);for(let s=0;s<3;++s)e[s]=r[s],e[s+3]=r[s];const i=s=>{const o=this.applyToVertex(s[0],s[1],s[2]);for(let a=0;a<3;++a)e[a]=Math.min(e[a],o[a]),e[a+3]=Math.max(e[a+3],o[a])};for(let s=1;s<8;++s){for(let o=0;o<3;++o)FM[o]=s&1<<o?ak[o]:T1[o];i(FM)}let n=0;for(let s=0;s<3;++s)T1[s]*ak[s]<0&&(n|=1<<s);if(n!==0&&n!==7){for(let s=0;s<8;++s)if(!(n&s)){for(let o=0;o<3;++o)FM[o]=n&1<<o?0:s&1<<o?T1[o]:ak[o];i(FM)}}for(let s=0;s<3;++s)e[s]-=this.localOrigin[s],e[s+3]-=this.localOrigin[s];return e}};const T1=A(),ak=A(),FM=A();let Uxt=class{constructor(e=0){this.componentLocalOriginLength=0,this._tmpVertex=A(),this._mbs=us(),this._obb={center:A(),halfSize:$n(),quaternion:null},this._totalOffset=0,this._offset=0,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}applyToVertex(e,r,i){const n=e,s=r,o=i+this.componentLocalOriginLength,a=this._totalOffset/Math.sqrt(n*n+s*s+o*o);return this._tmpVertex[0]=e+n*a,this._tmpVertex[1]=r+s*a,this._tmpVertex[2]=i+o*a,this._tmpVertex}applyToAabb(e){const r=e[0],i=e[1],n=e[2]+this.componentLocalOriginLength,s=e[3],o=e[4],a=e[5]+this.componentLocalOriginLength,l=r*s<0?0:Math.min(Math.abs(r),Math.abs(s)),c=i*o<0?0:Math.min(Math.abs(i),Math.abs(o)),u=n*a<0?0:Math.min(Math.abs(n),Math.abs(a)),h=Math.sqrt(l*l+c*c+u*u);if(h<this._totalOffset)return e[0]-=r<0?this._totalOffset:0,e[1]-=i<0?this._totalOffset:0,e[2]-=n<0?this._totalOffset:0,e[3]+=s>0?this._totalOffset:0,e[4]+=o>0?this._totalOffset:0,e[5]+=a>0?this._totalOffset:0,e;const f=Math.max(Math.abs(r),Math.abs(s)),m=Math.max(Math.abs(i),Math.abs(o)),g=Math.max(Math.abs(n),Math.abs(a)),y=Math.sqrt(f*f+m*m+g*g),_=this._totalOffset/y,b=this._totalOffset/h;return e[0]+=r*(r>0?_:b),e[1]+=i*(i>0?_:b),e[2]+=n*(n>0?_:b),e[3]+=s*(s<0?_:b),e[4]+=o*(o<0?_:b),e[5]+=a*(a<0?_:b),e}applyToMbs(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this._totalOffset/r;return this._mbs[0]=e[0]+e[0]*i,this._mbs[1]=e[1]+e[1]*i,this._mbs[2]=e[2]+e[2]*i,this._mbs[3]=e[3]+e[3]*this._totalOffset/r,this._mbs}applyToObb(e){const r=e.center,i=this._totalOffset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);this._obb.center[0]=r[0]+r[0]*i,this._obb.center[1]=r[1]+r[1]*i,this._obb.center[2]=r[2]+r[2]*i,md(this._obb.halfSize,e.halfSize,e.quaternion),ge(this._obb.halfSize,this._obb.halfSize,e.center);const n=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);return this._obb.halfSize[0]+=this._obb.halfSize[0]*n,this._obb.halfSize[1]+=this._obb.halfSize[1]*n,this._obb.halfSize[2]+=this._obb.halfSize[2]*n,ve(this._obb.halfSize,this._obb.halfSize,e.center),u0(M_e,e.quaternion),md(this._obb.halfSize,this._obb.halfSize,M_e),this._obb.halfSize[0]*=this._obb.halfSize[0]<0?-1:1,this._obb.halfSize[1]*=this._obb.halfSize[1]<0?-1:1,this._obb.halfSize[2]*=this._obb.halfSize[2]<0?-1:1,this._obb.quaternion=e.quaternion,this._obb}},zxt=class{constructor(e=0){this.offset=e,this.sphere=us(),this.tmpVertex=A()}applyToVertex(e,r,i){const n=this.objectTransform.transform;let s=n[0]*e+n[4]*r+n[8]*i+n[12],o=n[1]*e+n[5]*r+n[9]*i+n[13],a=n[2]*e+n[6]*r+n[10]*i+n[14];const l=this.offset/Math.sqrt(s*s+o*o+a*a);s+=s*l,o+=o*l,a+=a*l;const c=this.objectTransform.inverse;return this.tmpVertex[0]=c[0]*s+c[4]*o+c[8]*a+c[12],this.tmpVertex[1]=c[1]*s+c[5]*o+c[9]*a+c[13],this.tmpVertex[2]=c[2]*s+c[6]*o+c[10]*a+c[14],this.tmpVertex}applyToMinMax(e,r){const i=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*i,e[1]+=e[1]*i,e[2]+=e[2]*i;const n=this.offset/Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]+=r[0]*n,r[1]+=r[1]*n,r[2]+=r[2]*n}applyToAabb(e){const r=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*r,e[1]+=e[1]*r,e[2]+=e[2]*r;const i=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*i,e[4]+=e[4]*i,e[5]+=e[5]*i,e}applyToBoundingSphere(e){const r=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]),i=this.offset/r;return this.sphere[0]=e[0]+e[0]*i,this.sphere[1]=e[1]+e[1]*i,this.sphere[2]=e[2]+e[2]*i,this.sphere[3]=e[3]+e[3]*this.offset/r,this.sphere}};const O_e=new zxt;function tre(t){return t!=null?(O_e.offset=t,O_e):null}const A_e=new Uxt;function Vxt(t){return t!=null?(A_e.offset=t,A_e):null}const P_e=new kxt;function Bxt(t){return t!=null?(P_e.offset=t,P_e):null}const Kb="terrain",M_e=bf(),DP=1e-5;let jxt=class{constructor(e){this.options=new zwt,this._results=new Gxt,this.transform=new Fxt,this.tolerance=DP,this.verticalOffset=null,this._ray=la(),this._rayEnd=A(),this._rayBeginTransformed=A(),this._rayEndTransformed=A(),this.viewingMode=e??at.Global}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,r,i){this.resetWithRay(swt(e,r,this._ray),i)}resetWithRay(e,r){this.camera=r,e!==this._ray&&aB(e,this._ray),this.options.verticalOffset!==0?this.viewingMode===at.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,ge(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,r,i,n,s){this.point=r,this.filterPredicate=n,this.tolerance=i??DP;const o=tre(this.verticalOffset);if(e&&e.length>0){const a=s?l=>{s(l)&&this.intersectObject(l)}:l=>{this.intersectObject(l)};for(const l of e){const c=l.getSpatialQueryAccelerator&&l.getSpatialQueryAccelerator();c!=null?(o!=null?c.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,a,o):c.forEachAlongRay(this._ray.origin,this._ray.direction,a),this.options.selectionMode&&this.options.hud&&c.forEachDegenerateObject(a)):l.objects.forAll(u=>a(u))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.shaderTransformation,n=tre(this.verticalOffset);for(const s of r){if(!s.visible)continue;const{material:o,id:a}=s;this.transform.setAndInvalidateLazyTransforms(i,s.shaderTransformation),lt(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),lt(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const l=this.transform.transform;n!=null&&(n.objectTransform=this.transform),o.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(c,u,h,f,m,g)=>{if(c>=0){if(this.filterPredicate!=null&&!this.filterPredicate(this._ray.origin,this._rayEnd,c))return;const y=f?this._results.hud:this._results,_=f?b=>{const w=new Bwt(e,a,h,g);b.set(Sn.HUD,w,c,u,bo,m)}:b=>b.set(Sn.OBJECT,{object:e,geometryId:a,triangleNr:h},c,u,l,m);if((y.min.drapedLayerOrder==null||m>=y.min.drapedLayerOrder)&&(y.min.dist==null||c<y.min.dist)&&_(y.min),this.options.store!==Ia.MIN&&(y.max.drapedLayerOrder==null||m<y.max.drapedLayerOrder)&&(y.max.dist==null||c>y.max.dist)&&_(y.max),this.options.store===Ia.ALL)if(f){const b=new rre(this._ray);_(b),this._results.hud.all.push(b)}else{const b=new CA(this._ray);_(b),this._results.all.push(b)}}})}}sortResults(e=this._results.all){e.sort((r,i)=>r.dist!==i.dist?(r.dist??0)-(i.dist??0):r.drapedLayerOrder!==i.drapedLayerOrder?(r.drapedLayerOrder??Number.MAX_VALUE)-(i.drapedLayerOrder??Number.MAX_VALUE):(i.drapedLayerGraphicOrder??Number.MIN_VALUE)-(r.drapedLayerGraphicOrder??Number.MIN_VALUE))}};function hf(t){return new jxt(t)}let Gxt=class{constructor(){this.min=new CA(la()),this.max=new CA(la()),this.hud={min:new rre(la()),max:new rre(la()),all:new Array},this.ground=new CA(la()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}},CA=class{get ray(){return this._ray}get distanceInRenderSpace(){return this.dist!=null?(ce(lk,this.ray.direction,this.dist),We(lk)):null}getIntersectionPoint(e){return!!mg(this)&&(ce(lk,this.ray.direction,this.dist),ge(e,this.ray.origin,lk),!0)}getTransformedNormal(e){return oe(kM,this.normal),kM[3]=0,hh(kM,kM,this.transformation),oe(e,kM),Se(e,e)}constructor(e){this.intersector=Sn.OBJECT,this.normal=A(),this.transformation=Me(),this._ray=la(),this.init(e)}init(e){this.dist=null,this.target=null,this.drapedLayerOrder=null,this.drapedLayerGraphicOrder=null,this.intersector=Sn.OBJECT,aB(e,this._ray)}set(e,r,i,n,s,o,a){this.intersector=e,this.dist=i,oe(this.normal,n??Dce),Rs(this.transformation,s??bo),this.target=r,this.drapedLayerOrder=o,this.drapedLayerGraphicOrder=a}copy(e){aB(e.ray,this._ray),this.intersector=e.intersector,this.dist=e.dist,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.drapedLayerGraphicOrder=e.drapedLayerGraphicOrder,oe(this.normal,e.normal),Rs(this.transformation,e.transformation)}},rre=class extends CA{constructor(){super(...arguments),this.intersector=Sn.HUD}};function yde(t){return new CA(t)}const lk=A(),kM=wr();function C5e(t,e,r,i){return t.renderCoordsHelper.fromRenderCoords(e.eye,pB,i)!=null&&PLe(r,pB)}function uH(t,e){return t.elevationProvider?t.elevationProvider.getElevation(e[0],e[1],e[2],t.renderCoordsHelper.spatialReference,"ground")??0:0}function BE(t,e,r,i){const n=t.state.camera.clone();e&&r&&i&&(n.eye=e,n.center=r,n.up=i),Hxt(t,n.ray,E1)||oe(E1,n.center);const s=t.state.constraints,o=s.minimumPoiDistance;if(ks(n.eye,E1)<o){const a=s.collision.enabled;oe(Bx,n.viewForward),ce(Bx,Bx,o),a?n.eye=ve(pB,E1,Bx):ge(E1,n.eye,Bx);const l=t.renderCoordsHelper,c=l.getAltitude(n.eye),u=s.collision.elevationMargin;a&&c<u&&(ve(Bx,E1,n.eye),n.eye=l.setAltitude(pB,u,n.eye),ge(E1,n.eye,Bx))}return n.center=E1,n}function $_e(t,e,r){if(!t.state.isGlobal||!t.stateManager.constraintsManager)return!1;const i=uH(t,e),n=t.stateManager.constraintsManager.nearFarHeuristic,{far:s}=n.compute(e,r,t.renderDataExtent,i,Wxt),o=s*s;return ks(e,r)>o}function Hxt(t,e,r){let i=I_e[t.viewingMode];i||(i=hf(t.state.viewingMode),i.options.backfacesTerrain=!t.state.isGlobal,i.options.invisibleTerrain=!0,I_e[t.viewingMode]=i);const{isGlobal:n}=t.state;return!(!t.sceneIntersectionHelper.intersectRay(e,i,r)||$_e(t,e.origin,r))||!(!t.renderCoordsHelper.intersectManifold(e,0,r)||$_e(t,e.origin,r))||!!n&&qxt(e,r,Xr(t.spatialReference).radius)}function qxt(t,e,r){const i=ye(t.origin,t.origin)-r*r,n=i>0?Math.sqrt(i)/3:1;return ce(e,t.direction,n/We(t.direction)),ge(e,e,t.origin),!0}const I_e={},pB=A(),E1=A(),Bx=A(),Wxt={near:0,far:0},Xxt=A(),ck=A();function vde(){return{direction:A(),up:A()}}function R5e(t,e,r,i,n){let s=Se(Xxt,t),o=ye(s,i);const a=o>0;o=Math.abs(o),o>.99&&(o=Math.abs(ye(e,i)),o<.99?(oe(s,e),a&&ce(s,s,-1)):s=null);let l=0;if(s){ce(ck,i,ye(i,s)),ve(s,s,ck);const u=ye(s,n)/(We(s)*We(n));Lt(ck,s,n),l=(ye(ck,i)>0?1:-1)*Oc(Vo(u))}const c=Oc(Vo(-ye(i,t)/We(t)));return r?(r.heading=l,r.tilt=c,r):{heading:l,tilt:c}}const O5e=Ue(0,1,0),A5e=Ue(0,0,1),UM=Me(),L0=A(),D0=A();function P5e(t,e,r,i=vde()){const{direction:n,up:s}=i;return eDe(UM,-sr(e)),_P(UM,UM,sr(r)),lt(n,A5e,UM),ce(n,n,-1),lt(s,O5e,UM),i}function Yxt(t,e,r,i){return R5e(e,r,i,A5e,O5e)}function Zxt(t,e,r,i){const n=P5e(t,r,i),s=A();return ce(s,n.direction,-e),ge(s,s,t),{up:n.up,eye:s,heading:r,tilt:i}}function Jxt(t){return Oc(t)}function Kxt(t){return sr(t)}function M5e(t,e,r,i,n){const s=t.renderSpatialReference,o=t.map&&t.spatialReference||e.spatialReference;return Na(e,L0,s),Na(e,D0,s),L0[0]-=r/2,D0[0]+=r/2,L0[1]-=i/2,D0[1]+=i/2,Ys(L0,s,L0,o),Ys(D0,s,D0,o),n?(n.xmin=L0[0],n.ymin=L0[1],n.xmax=D0[0],n.ymax=D0[1],n.spatialReference=o):n=new $r(L0[0],L0[1],D0[0],D0[1],o),n}const Qxt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:Yxt,eyeForCenterWithHeadingTilt:Zxt,eyeTiltToLookAtTilt:Kxt,headingTiltToDirectionUp:P5e,lookAtTiltToEyeTilt:Jxt,toExtent:M5e},Symbol.toStringTag,{value:"Module"}));function L_e(t,e,r){if(e.longitude==null||e.latitude==null||r.longitude==null||r.latitude==null)throw new Error("Invalid points: no lon/lat");return eSt(t,e.longitude,e.latitude,r.longitude,r.latitude)}function eSt(t,e,r,i,n){const s=sr(r),o=sr(n),a=s-o,l=sr(e)-sr(i),c=Math.sin(a/2),u=Math.sin(l/2),h=2*sf(Math.sqrt(c*c+Math.cos(s)*Math.cos(o)*u*u))*t;return Math.round(1e4*h)/1e4}function tSt(t,e,r){const i=e.spatialReference,n=Xr(i),s=new Gt(e.x,t.y,i),o=new Gt(r.x,t.y,i),a=new Gt(t.x,e.y,i),l=new Gt(t.x,r.y,i);return{lon:L_e(n.radius,s,o),lat:L_e(n.radius,a,l)}}function rSt(t,e,r){const i=e/r,n=sr(t),s=Math.sin(i/2),o=Math.cos(n),a=2*sf(Math.sqrt(s*s/(o*o)));return Oc(a)}function iSt(t,e){let r=t/15;return e||(r=Math.round(r)),r}function D_e(t,e){const r=t==null?void 0:t[0];if(r==null)return null;e||(e={hours:0,minutes:0,seconds:0}),e.hours=iSt(r,!0);const i=e.hours%1;e.hours-=i,e.minutes=60*i;const n=e.minutes%1;return e.minutes-=n,e.seconds=Math.round(60*n),e}const $5e=Ue(0,0,1),I5e=Se(A(),Ue(1,1,1)),nSt=new Xw(-180,180),zM=Me(),Ub=A(),hC=A();function L5e(t,e,r,i=vde()){Lt(Ub,t,$5e),ye(Ub,Ub)===0&&Lt(Ub,t,I5e),Ch(zM,-sr(e),t),sd(zM,zM,-sr(r),Ub);const{up:n,direction:s}=i;return Lt(n,Ub,t),Se(n,n),lt(n,n,zM),Se(s,t),Nl(s,s),lt(s,s,zM),i}function sSt(t,e,r,i){const n=Ub,s=hC;return Se(n,t),Lt(hC,n,$5e),ye(hC,hC)===0&&Lt(hC,n,I5e),Lt(s,hC,n),R5e(e,r,i,n,s)}function oSt(t,e,r,i){const n={eye:A(),up:null,tilt:i,heading:r},s=Ub;s[0]=t[0],s[1]=t[2],s[2]=-t[1];const o=e,a=sr(r),l=sr(i),c=Math.sin(a),u=Math.cos(a),h=Math.sin(l),f=Math.cos(l),m=We(s);let g;if(Math.abs(l)<1e-8)g=o+m;else{const Z=m/h,M=sf(o/Z),$=Math.PI-l-M;g=Z*Math.sin($)}const y=f*o,_=o*o*(h*h),b=u*u*_,w=g-y,x=w*w,S=b*(b+x-s[1]*s[1]);if(S<0)return ce(n.eye,s,g/m),n.tilt=0,uk(n,t);const C=Math.sqrt(S),E=s[1]*w,R=b+x;let P;if(P=u>0?-C+E:C+E,Math.abs(R)<1e-8)return m<1e-8?(n.eye[0]=0,n.eye[1]=0,n.eye[2]=o):ce(n.eye,s,g/m),n.tilt=0,EX(n.eye),uk(n,t);n.eye[1]=P/R;const D=c*c*_,L=h*o,k=u*L*n.eye[1],V=n.eye[1]*n.eye[1],W=1-V,G=Math.sqrt(W),B=b*V+D-2*k*G*w+W*x;return Math.abs(B)<1e-8?(ce(n.eye,s,g/m),n.tilt=0,EX(n.eye),uk(n,t)):(n.eye[0]=(W*(g*s[0]-y*s[0])-L*G*(s[0]*n.eye[1]*u+s[2]*c))/B,n.eye[2]=(W*(g*s[2]-y*s[2])-L*G*(s[2]*n.eye[1]*u-s[0]*c))/B,ce(n.eye,n.eye,g),EX(n.eye),uk(n,t))}function EX(t){const e=t[1];t[1]=-t[2],t[2]=e}function uk(t,e){const r=L5e(e,t.heading,t.tilt);return t.up=r.up,t}function aSt(t,e,r){const i=We(e),n=Math.sqrt(r*r+i*i-2*r*i*Math.cos(Math.PI-t)),s=sf(r/(n/Math.sin(t)));return Oc(t-s)}function lSt(t,e,r){const i=sr(t),n=We(e);return sf(r/(n/Math.sin(i)))+i}function D5e(t,e,r,i,n){let s,o,a,l;const c=e.latitude,u=Xr(t.spatialReference).radius,h=e.longitude,f=rSt(c,r,u)/2;s=h-f,o=h+f;const m=sr(c),g=(1+Math.sin(m))/(1-Math.sin(m)),y=(g+1)*Math.tan(i/u/2),_=y*y;function b(x){const S=Math.PI/2;return(x=ugt.normalize(x,-S))>S&&(x=Math.PI-x),x}if(a=1.5*Math.PI-2*Math.atan(.5*(y+Math.sqrt(4*g+_))),l=a+i/u,a=b(a),l=b(l),l<a){const x=l;l=a,a=x}if(a=Math.max(Oc(a),-90),l=Math.min(Oc(l),90),o=nSt.monotonic(s,o),o-s>180){const x=(o-s-180)/2;s+=x,o-=x}const w=t.spatialReference&&t.spatialReference.isGeographic?t.spatialReference:dt.WGS84;return n?(n.xmin=s,n.ymin=a,n.xmax=o,n.ymax=l,n.spatialReference=w):n=new $r(s,a,o,l,w),t.spatialReference&&t.spatialReference.isWebMercator&&bA(n,!1,n),n}const cSt=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:sSt,eyeForCenterWithHeadingTilt:oSt,eyeTiltToLookAtTilt:lSt,headingTiltToDirectionUp:L5e,lookAtTiltToEyeTilt:aSt,toExtent:D5e},Symbol.toStringTag,{value:"Module"}));function fB(t){return t.type==="point"}let _de=class{constructor(e,r=null,i=0){this.array=e,this.spatialReference=r,this.offset=i}};function N5e(t){return"array"in t}function Dy(t,e,r="ground"){if(fB(e))return t.getElevation(e.x,e.y,e.z||0,e.spatialReference,r);if(N5e(e)){let i=e.offset;return t.getElevation(e.array[i++],e.array[i++],e.array[i]||0,e.spatialReference??t.spatialReference,r)}return t.getElevation(e[0],e[1],e[2]||0,t.spatialReference,r)}const F5e=re.getLogger("esri.views.3d.support.cameraUtils"),k5e=39.37,U5e=96,ire=1,uSt=8,dSt=5,z5e=1,N_e=A(),hSt={heading:0,tilt:0},Qb=new Gt,pSt=new Xw(-20037508342788905e-9,20037508342788905e-9),fSt=new Xw(-180,180);var nl;function vF(t){return t.spatialReference||dt.WGS84}function j3(t){return t.viewingMode==="global"?cSt:Qxt}function mSt(t,e,r,i,n){return j3(t).headingTiltToDirectionUp(e,r,i,n)}function Ov(t,e){if(e==null)return null;const r=t.renderSpatialReference,i=j3(t).headingTiltToDirectionUp,n=A();if(!Na(e.position,n,r))return null;const s=i(n,e.heading,e.tilt);ce(s.direction,s.direction,t.state.camera.distance),ge(s.direction,s.direction,n);const o=BE(t,n,s.direction,s.up);return o.fov=sr(e.fov),o}(function(t){t[t.LOCKED=0]="LOCKED",t[t.ADJUST=1]="ADJUST"})(nl||(nl={}));const pC=A();function NP(t,e,r){const i=t.renderSpatialReference,n=dH(t,e.eye,e.viewForward,e.up,hSt);let s=vF(t);return Ys(e.eye,i,pC,s)||(s=dt.WGS84,Ys(e.eye,i,pC,s)),r==null?new of(new Gt(pC,s),n.heading,n.tilt,Oc(e.fov)):(r.position.x=pC[0],r.position.y=pC[1],r.position.z=pC[2],r.position.spatialReference=s,r.heading=n.heading,r.tilt=n.tilt,r.fov=Oc(e.fov),r)}function bde(t,e,r){const i=t.state.camera,n=i.width/2/i.pixelRatio;return t.renderCoordsHelper.viewingMode===at.Global&&r!=null&&(e*=Math.cos(sr(r))),e/=t.renderCoordsHelper.unitInMeters,n/(U5e*k5e/e)/Math.tan(i.fovX/2)}function oE(t,e,r){const i=t.state.camera,n=e*Math.tan(i.fovX/2),s=i.width/2/i.pixelRatio;let o=U5e*k5e/(s/n);return t.renderCoordsHelper.viewingMode===at.Global&&r!=null&&(o/=Math.cos(sr(r))),o*t.renderCoordsHelper.unitInMeters}function V5e(t,e,r,i,n,s){return B5e(t,e,bde(t,r,e.latitude),i,n,s)}function B5e(t,e,r,i,n,s){if(T2(s)){const a=new G3(s.signal);return DN(t,i.heading,i.tilt,e,r,n,a),void a.resolver.promise.then(l=>{const c=gB(t,l,i.fov);if(c!=null)return s.resolver.resolve(c);s.resolver.reject()},l=>s.resolver.reject(l))}const o=DN(t,i.heading,i.tilt,e,r,n);return gB(t,o,i.fov,s)}function dH(t,e,r,i,n){return j3(t).directionToHeadingTilt(e,r,i,n)}function gSt(t,e){return!!(t.basemapTerrain&&t.renderCoordsHelper.fromRenderCoords(e,Qb,t.spatialReference)&&t.elevationProvider&&(Dy(t.elevationProvider,Qb)??0)>(Qb.z??0)-z5e)}async function ySt(t,e,r){if(!t.renderCoordsHelper.fromRenderCoords(e,Qb,t.spatialReference)||!t.elevationProvider)return!1;const i=Qb.z??0;return(await t.elevationProvider.queryElevation(Qb.x,Qb.y,i,Qb.spatialReference,"ground",r)??0)>i-z5e}async function vSt(t,e,r){const i=A();if(e)if(e instanceof Gt){if(Na(e,i,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const n=await t.elevationProvider.queryElevation(e.x,e.y,e.z??0,e.spatialReference,"ground",r);return n!=null&&t.renderCoordsHelper.setAltitude(i,n),i}}else oe(i,e);else oe(i,t.state.camera.center);return i}function _St(t,e){const r=A();if(e&&e instanceof Gt){if(Na(e,r,t.renderSpatialReference),e.z==null&&t.basemapTerrain!=null&&t.elevationProvider!=null){const i=Dy(t.elevationProvider,e);i!=null&&t.renderCoordsHelper.setAltitude(r,i)}}else oe(r,e||t.state.camera.center);return r}function DN(t,e,r,i,n,s,o){const a=i&&i instanceof Gt?i:null;if(T2(o))return vSt(t,i,o.signal).then(c=>{nre(t,e,r,a,c,n,s,o)},c=>o.resolver.reject(c)),null;const l=_St(t,i);return nre(t,e,r,a,l,n,s,o)}function nre(t,e,r,i,n,s,o,a){if(i==null){const h=t.renderSpatialReference;if((i=M_(n,h,vF(t)))==null)return null}s=Math.max(s,t.state.constraints.minimumPoiDistance);const l=xSt(t,e,r,n,s,o),c=(0,j3(t).eyeForCenterWithHeadingTilt)(n,s,l.heading,l.tilt);if(o===nl.ADJUST&&t.viewingMode==="global"&&r>0){const h=()=>{const m=j5e(t,n,s,TSt(t,s,r,n));return o=r-m<1?nl.LOCKED:nl.ADJUST,nre(t,e,m,i,n,s,o,a)},f=t.map.ground.navigationConstraint;if(!f||f.type==="stay-above"){if(gSt(t,c.eye))return h();if(T2(a))return ySt(t,c.eye,a.signal).then(m=>m?h():(a.resolver.resolve({eye:c.eye,up:c.up,center:qi(n),heading:c.heading,tilt:c.tilt}),null)),null}}const u=!a||T2(a)?{center:A(),eye:A(),up:A(),tilt:0,heading:0}:a;return u.eye=c.eye,u.up=c.up,u.center=qi(n),u.heading=c.heading,u.tilt=c.tilt,T2(a)&&a.resolver.resolve(u),u}function uD(t,e,r,i,n,s=null){let o,a,l;if(t.state.isGlobal){if(!ON(e.spatialReference,at.Global))return T2(s)&&s.resolver.reject(),null;const _=new Gt(e.xmin,e.ymin,e.spatialReference),b=new Gt(e.xmax,e.ymax,e.spatialReference),w=e.spatialReference.isGeographic?fSt:pSt;o=new Gt({x:w.center(_.x,b.x),y:(b.y+_.y)/2,z:e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0,spatialReference:e.spatialReference});const x=Xr(e.spatialReference),S=tSt(o,_,b);a=S.lon,l=S.lat,w.diff(_.x,b.x)>w.range/2&&(a+=x.halfCircumference),a=Math.min(a,x.halfCircumference),l=Math.min(l,x.halfCircumference)}else{const _=t.renderSpatialReference??e.spatialReference;_.equals(e.spatialReference)||(e=o0(e,_)),a=e.xmax-e.xmin,l=e.ymax-e.ymin;const b=e.zmax!=null&&e.zmin!=null?(e.zmax+e.zmin)/2:void 0;o=new Gt({x:e.xmin+.5*a,y:e.ymin+.5*l,z:b,spatialReference:_})}const c=e.zmax!=null&&e.zmin!=null?e.zmax-e.zmin:0,u=t.state.camera,h=1/Math.tan(u.fovX/2),f=1/Math.tan(u.fovY/2),m=1/Math.tan(u.fov/2),g=Math.max(.5*a*h,.5*l*f,.5*c*m)/ire;if(T2(s)){const _=new G3(s.signal);return DN(t,r,i,o,g,n,_),void _.resolver.promise.then(b=>{const w=gB(t,b,t.camera.fov);if(w!=null)return s.resolver.resolve(w);s.resolver.reject()},b=>s.resolver.reject(b))}const y=DN(t,r,i,o,g,n);return gB(t,y,t.camera.fov,s)}function bSt(t,e,r){const i=t.renderSpatialReference,n=M_(r,i,vF(t));if(n==null)return null;const s=Math.tan(e.fovX/2),o=Math.tan(e.fovY/2),a=W4(e.eye,r),l=2*a*s*ire,c=2*a*o*ire;return t.viewingMode==="global"?D5e(t,n,l,c):M5e(t,n,l,c)}function wSt(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.distance;if(Math.log(r/i)/Math.LN2>uSt)return!0;const n=t.renderSpatialReference,s=vF(t),o=M_(e,n,s),a=M_(t.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,n,s);if(o==null||a==null)return!1;const l=Math.tan(.5*t.state.camera.fov)*i;return a.distance(o)/l>dSt}function xSt(t,e,r,i,n,s){let o=0;return s===nl.ADJUST&&wSt(t,i,n)?(e=0,o=SSt(t,n,r,i)):o=wde(t,i,n,r),o=t.state.constraints.clampTilt(n,o),{heading:e,tilt:r=j5e(t,i,n,o)}}const mB=.7;function SSt(t,e,r,i){const n=wde(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);s.max=Math.min(s.max,.5*Math.PI);const o=s.min*(1-mB)+s.max*mB;return Math.min(n,o)}function TSt(t,e,r,i){let n=wde(t,i,e,r);if(!t.state.constraints.tilt)return n;const s=t.state.constraints.tilt(e);return n=Math.min(n,.5*Math.PI),s.min*(1-mB)+n*mB}function j5e(t,e,r,i){return j3(t).lookAtTiltToEyeTilt(i,e,r)}function wde(t,e,r,i){return j3(t).eyeTiltToLookAtTilt(i,e,r)}function gB(t,e,r,i){if(e==null)return null;const n=t.renderSpatialReference,s=M_(e.eye,n,vF(t));return s==null?null:i!=null?(i.position=s,i.heading=e.heading,i.tilt=e.tilt,i.fov=r,i):new of(s,e.heading,e.tilt,r)}function ESt(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.levelAtScale(e);F5e.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")}function G5e(t,e){var i;const r=(i=t.basemapTerrain)==null?void 0:i.tilingScheme;if(r)return r.scaleAtLevel(e);F5e.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")}function H5e(t,e){return Ys(e.center,t.renderSpatialReference,N_e,dt.WGS84),oE(t,e.distance,N_e[1])}let G3=class{constructor(e){this.signal=e,this.resolver=Da()}};function T2(t){return t&&"resolver"in t}const CSt=.66;function q5e(t){return 360-tue.normalize(t)}function hH(t){return tue.normalize(360-t)}function VM(t){return t!=null&&t.resolver&&t.resolver.reject(),null}function RSt(t,e){return t!=null&&t.resolver&&t.resolver.resolve(e),e}function xde(t,e,r,i=null){if(!e)return VM(i);const n=t.spatialReference||dt.WGS84;if(e.camera!=null){const c=PE(e.camera.position,n);if(c==null)return VM(i);const u=e.camera.clone();return u.position=c.clone(),RSt(i,u)}if(e.targetGeometry==null)return VM(i);const s=e.get("targetGeometry.spatialReference");if(s&&!Nw(s,n))return VM(i);const o=NP(t,t.state.camera);let a=nl.ADJUST;if(e.rotation!=null&&(o.heading=q5e(e.rotation),a=nl.LOCKED),r!=null&&(o.tilt=r),e.targetGeometry.type==="point"){const c=e.targetGeometry;let u;const h=e.targetGeometry.clone();return u=e.scale!=null?bde(t,e.scale,c.latitude):t.state.camera.distance,B5e(t,h,u,o,a,i)}const l=e.targetGeometry.extent;return l?uD(t,l,o.heading,o.tilt,a,i):VM(i)}function OSt(t,e,r=null){return r==null&&(r=new Sd),Ede(t,null,e.clone(),r)}async function ASt(t,e,r){const i=USt(t,e);if(!i)throw new H("viewpointutils-create:no-target","Missing target for creating viewpoint");const n=new of({fov:t.camera.fov}),s=new Sd({camera:n});if(i.target instanceof Sd)return jx(await $St(t,i.target,i,r,s));if(i.target instanceof of)return jx(X5e(t,i.target,s));const o=i.scale!=null||i.zoom!=null;if(i.target instanceof $r){const c=i.target.xmin===i.target.xmax||i.target.ymin===i.target.ymax;return jx(o||c?await sre(t,i,i.target.center,n,r,s):await NSt(t,i,i.target,n,r,s))}const a={boundingBox:en(),hasZ:!1,screenSpaceObjects:[]},l=o?PSt(t,i):void 0;if(await W5e(t,i.target,l,a),isFinite(a.boundingBox[0])){let c;if(Fm(a.boundingBox,_s),Jd.x=_s[0],Jd.y=_s[1],Jd.z=_s[2],Jd.spatialReference=t.spatialReference,isFinite(Jd.z)&&a.hasZ?c=jue(a.boundingBox):(Jd.z=void 0,c=Wmt(Bue(a.boundingBox,VSt))),o||c)return jx(await sre(t,i,Jd,n,r,s));const u=zSt(t,a.screenSpaceObjects);return jx(await kSt(t,i,Jd,a.boundingBox,u,n,r,s))}return i.position?jx(LSt(t,i,n,s)):jx(await DSt(t,i,n,r,s))}function Sde(t,e){return e.scale==null&&e.zoom!=null?G5e(t,e.zoom):e.scale}function PSt(t,e){const r=Sde(t,e);return r?Uwt(r):void 0}function Tde(t,e){let r=!1;return e.heading!=null?(t.heading=e.heading,r=!0):e.rotation!=null&&(t.heading=q5e(e.rotation),r=!0),e.tilt!=null&&(t.tilt=e.tilt,r=!0),e.fov!=null&&(t.fov=e.fov),r}function Ede(t,e,r,i){const n=t.spatialReference||dt.WGS84;return(e=e??Ov(t,r))==null||(i.targetGeometry=M_(e.center,t.renderSpatialReference,n),i.scale=H5e(t,e),i.rotation=hH(r.heading),i.camera=r),i}function yB(t,e,r){var a,l;const i=()=>new H("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!e)throw i();if(!Nw(e.spatialReference,t.spatialReference))throw new H("viewpointutils:incompatible-spatialreference",`Spatial reference (${e.spatialReference?e.spatialReference.wkid:"unknown"}) is incompatible with the view (${(a=t.spatialReference)==null?void 0:a.wkid})`,{geometry:e});const n=[];if(!e.hasZ&&t.basemapTerrain){let c;switch(e.type){case"point":c=e;break;case"multipoint":case"polyline":c=(l=e.extent)==null?void 0:l.center;break;case"mesh":c=e.origin;break;case"extent":c=e.center;break;case"polygon":c=e.centroid}c&&t.basemapTerrain.spatialReference!=null&&Nw(c,t.basemapTerrain.spatialReference)&&t.elevationProvider?_s[2]=Dy(t.elevationProvider,c)??0:_s[2]=0}(0,BSt[e.type])(e,c=>{n.push(c[0],c[1],c[2])},_s);const s=n.length/3;if(s===0)throw i();const o=new Array(n.length);if(Ni(n,e.spatialReference,0,o,t.spatialReference,0,s)){e.hasZ&&(r.hasZ=!0);for(let c=0;c<o.length;c+=3)e.hasZ?(_s[0]=o[c],_s[1]=o[c+1],_s[2]=o[c+2]):(_s[0]=o[c],_s[1]=o[c+1]),c0(r.boundingBox,_s)}}async function MSt(t,e,r,i){const n=await wd(t.whenViewForGraphic(e));if(n.ok===!1||n.value==null||!("whenGraphicBounds"in n.value))return void yB(t,e.geometry,i);const s=n.value,o=await wd(s.whenGraphicBounds(e,{minDemResolution:r}));if(o.ok===!1)return void yB(t,e.geometry,i);const{screenSpaceObjects:a,boundingBox:l}=o.value;MP(i.boundingBox,l),a&&a.forEach(c=>{i.screenSpaceObjects.push(c)}),isFinite(l[2])&&(i.hasZ=!0)}async function W5e(t,e,r,i){var n;if(Array.isArray(e)&&e.length===2){const s=e[0],o=e[1];if(typeof s=="number"&&typeof o=="number")return Jd.x=s,Jd.y=o,Jd.z=void 0,Jd.spatialReference=(n=t.spatialReference)!=null&&n.isGeographic?t.spatialReference:dt.WGS84,void yB(t,Jd,i)}e&&"map"in e&&typeof e.map=="function"?await ou(e.map(s=>W5e(t,s,r,i))):e instanceof Sx?yB(t,e,i):e instanceof cf&&await MSt(t,e,r,i)}async function $St(t,e,r,i,n){if(e.camera!=null)return X5e(t,e.camera,n);n.scale=e.scale,n.rotation=e.rotation,n.targetGeometry=e.targetGeometry!=null?e.targetGeometry.clone():null,n.camera=null,r.heading!=null?n.rotation=hH(r.heading):r.rotation!=null&&(n.rotation=r.rotation);const s=Sde(t,r);s!=null&&(n.scale=s);const o=new G3(i);return xde(t,n,r.tilt,o),n.camera=await o.resolver.promise,n}function X5e(t,e,r){const i=t.spatialReference,n=PE(e.position,i);return n==null?null:((e=e.clone()).fov=t.camera.fov,e.position=n,Ede(t,null,e,r))}function ISt(t,e,r,i,n,s){const o=t.renderSpatialReference;return Na(r,hk,o),Na(e,CX,o),s.targetGeometry=new Gt(e),n.position=new Gt(r),ve(vB,CX,hk),dH(t,hk,vB,i.up,n),s.scale=oE(t,Li(hk,CX),s.targetGeometry.latitude),s.rotation=hH(n.heading),s.camera=n,s}async function sre(t,e,r,i,n,s){if(r==null)throw new H("createfromcenter","invalid point");s.targetGeometry=r.clone();const o=BE(t);if(e.position)return ISt(t,s.targetGeometry,e.position,o,i,s);if(e.zoomFactor){const l=o.distance/e.zoomFactor,c=ce(_s,o.viewForward,-l);o.eye=ge(_s,o.center,c),s.scale=oE(t,l,r.latitude)}NP(t,o,i);const a=Tde(i,e)?nl.LOCKED:nl.ADJUST;if(!e.zoomFactor){const l=Sde(t,e);l==null?(Na(r,_s,t.renderSpatialReference),e5e(o.frustum,_s)?s.scale=oE(t,Li(o.eye,_s),r.latitude):s.scale=H5e(t,o)):s.scale=l;const c=new G3(n);V5e(t,s.targetGeometry,s.scale,i,a,c),s.camera=await c.resolver.promise}return s}function LSt(t,e,r,i){const n=BE(t);return oe(vB,n.viewForward),dH(t,n.eye,vB,n.up,RX),r.position=new Gt(e.position),r.heading=e.heading!=null?e.heading:RX.heading,r.tilt=e.tilt!=null?e.tilt:RX.tilt,Ede(t,null,r,i)}async function DSt(t,e,r,i,n){const s=BE(t);return sre(t,e,M_(s.center,t.renderSpatialReference,t.spatialReference),r,i,n)}async function NSt(t,e,r,i,n,s){s.targetGeometry=r.clone();const o=BE(t);NP(t,o,i);const a=Tde(i,e)?nl.LOCKED:nl.ADJUST,l=new G3(n);return uD(t,r,i.heading,i.tilt,a,l),s.camera=await l.resolver.promise,s}function FSt(t,e,r,i,n){let s=0;r.z!=null?s=r.z:t.basemapTerrain&&t.elevationProvider&&(s=Dy(t.elevationProvider,r)),se(_s,r.x,r.y,s),lu(t.spatialReference,_s,F_e,t.renderSpatialReference),uf(dk,F_e),df(dk,dk),en(BM);const o=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(let g=0;g<o.length;g++){const y=o[g];let _=i[y[2]];isFinite(_)||(_=s),se(_s,i[y[0]],i[y[1]],_),Ys(_s,t.spatialReference,_s,t.renderSpatialReference),c0(BM,nd(_s,_s,dk))}const a=DE(BM),l=Ex(BM),c=NE(BM),u=1/Math.tan(e.fovX/2),h=1/Math.tan(e.fovY/2),f=.5*Math.sqrt(a*a+c*c)*Math.max(h,u)+.5*l,m=.5*l*h+.5*Math.max(a,c);return Math.max(f,m)/n}async function kSt(t,e,r,i,n,s,o,a){a.targetGeometry=r.clone();const l=BE(t),c=FSt(t,l,r,i,n);NP(t,l,s);const u=Tde(s,e)?nl.LOCKED:nl.ADJUST;a.scale=oE(t,c,a.targetGeometry.latitude);const h=new G3(o);return V5e(t,a.targetGeometry,a.scale,s,u,h),a.camera=await h.resolver.promise,a}function USt(t,e){if(!e||!t.spatialReference)return null;const r={target:void 0};return"declaredClass"in e||Array.isArray(e)?r.target=e:(Object.assign(r,e),e.center&&!r.target&&(r.target=e.center)),r}function jx(t){return t&&t.camera!=null&&(t.rotation=hH(t.camera.heading)),t}function zSt(t,e){const r=CSt;if(!e.length)return r;let i=Number.NEGATIVE_INFINITY;for(let n=0;n<e.length;n++){const s=e[n].screenSpaceBoundingRect;i=Math.max(i,Math.abs(s[0]),Math.abs(s[1]),Math.abs(s[2]),Math.abs(s[3]))}return r-i/Math.min(t.width,t.height)*2}const _s=A(),F_e=Me(),dk=vn(),BM=To(),VSt=lr(),vB=A(),hk=A(),CX=A(),RX={heading:0,tilt:0},Jd=new Gt,BSt={point(t,e,r){r[0]=t.x,r[1]=t.y,t.z!=null&&(r[2]=t.z),e(r)},polygon(t,e,r){const i=t.hasZ;for(let n=0;n<t.rings.length;n++){const s=t.rings[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},polyline(t,e,r){const i=t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n];for(let o=0;o<s.length;o++)r[0]=s[o][0],r[1]=s[o][1],i&&(r[2]=s[o][2]),e(r)}},multipoint(t,e,r){const i=t.points,n=t.hasZ;for(let s=0;s<i.length;s++)r[0]=i[s][0],r[1]=i[s][1],n&&(r[2]=i[s][2]),e(r)},extent(t,e,r){t.zmin!=null&&t.zmax!=null?(e(se(r,t.xmin,t.ymin,t.zmin)),e(se(r,t.xmax,t.ymin,t.zmin)),e(se(r,t.xmin,t.ymax,t.zmin)),e(se(r,t.xmax,t.ymax,t.zmin)),e(se(r,t.xmin,t.ymin,t.zmax)),e(se(r,t.xmax,t.ymin,t.zmax)),e(se(r,t.xmin,t.ymax,t.zmax)),e(se(r,t.xmax,t.ymax,t.zmax))):(e(se(r,t.xmin,t.ymin,r[2])),e(se(r,t.xmax,t.ymin,r[2])),e(se(r,t.xmin,t.ymax,r[2])),e(se(r,t.xmax,t.ymax,r[2])))},mesh(t,e,r){const i=t.vertexAttributes&&t.vertexAttributes.position;if(i)for(let n=0;n<i.length;n+=3)e(se(r,i[n],i[n+1],i[n+2]))}};let jSt=class{constructor(e,r){this._observable=new _7,this._value=e,this._equalityFunction=r}get value(){return br(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}};function NN(t,e=l$e){return new jSt(t,e)}let GSt=class{constructor(){this._tasks=new Array,this._running=NN(!1)}get length(){return this._tasks.length}get running(){return this._running.value}destroy(){this.cancelAll()}runTask(e){for(;!e.done&&this._process(e);)e.madeProgress()}push(e,r,i){return this._running.value=!0,new Promise((n,s)=>this._tasks.push(new k_e(n,s,e,r,i)))}unshift(e,r,i){return this._running.value=!0,new Promise((n,s)=>this._tasks.unshift(new k_e(n,s,e,r,i)))}_process(e){var i;if(this._tasks.length===0)return!1;const r=this._tasks.shift();try{const n=go(r.signal);if(n&&!r.abortCallback)r.reject(Wr());else{const s=n?(i=r.abortCallback)==null?void 0:i.call(r,Wr()):r.callback(e);Dh(s)?s.then(r.resolve,r.reject):r.resolve(s)}}catch(n){r.reject(n)}return this._running.value=this._tasks.length>0,!0}cancelAll(){const e=Wr();for(const r of this._tasks)if(r.abortCallback){const i=r.abortCallback(e);r.resolve(i)}else r.reject(e);this._tasks.length=0,this._running.value=!1}},k_e=class{constructor(e,r,i,n=void 0,s=void 0){this.resolve=e,this.reject=r,this.callback=i,this.signal=n,this.abortCallback=s}},LI=class extends Ce{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};d([p()],LI.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),d([p()],LI.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),LI=d([I("esri.views.support.DebugFlags")],LI);const HSt=new LI;var ai;(function(t){t[t.ANIMATING=0]="ANIMATING",t[t.INTERACTING=1]="INTERACTING",t[t.IDLE=2]="IDLE"})(ai||(ai={}));function qSt(){return new _B.Scheduler}var ll,Vt;(function(t){t[t.YIELD=1]="YIELD"})(ll||(ll={})),function(t){t.RESOURCE_CONTROLLER_IMMEDIATE="immediate",t.RESOURCE_CONTROLLER="schedule",t.SLIDE="slide",t.STREAM_DATA_LOADER="stream loader",t.ELEVATION_QUERY="elevation query",t.TERRAIN_SURFACE="terrain",t.SURFACE_GEOMETRY_UPDATES="surface geometry updates",t.LOD_RENDERER="LoD renderer",t.GRAPHICS_CORE="Graphics3D",t.I3S_CONTROLLER="I3S",t.POINT_CLOUD_LAYER="point cloud",t.FEATURE_TILE_FETCHER="feature fetcher",t.OVERLAY="overlay",t.STAGE="stage",t.GRAPHICS_DECONFLICTOR="graphics deconflictor",t.FILTER_VISIBILITY="Graphics3D filter visibility",t.SCALE_VISIBILITY="Graphics3D scale visibility",t.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",t.POINT_OF_INTEREST_FREQUENT="POI frequent",t.POINT_OF_INTEREST_INFREQUENT="POI infrequent",t.LABELER="labeler",t.FEATURE_QUERY_ENGINE="feature query",t.FEATURE_TILE_TREE="feature tile tree",t.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",t.ELEVATION_ALIGNMENT="elevation alignment",t.TEXT_TEXTURE_ATLAS="text texture atlas",t.TEXTURE_UNLOAD="texture unload",t.LINE_OF_SIGHT_TOOL="line of sight tool",t.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",t.ELEVATION_PROFILE="elevation profile",t.SNAPPING="snapping",t.SHADOW_ACCUMULATOR="shadow accumulator",t.CLOUDS_GENERATOR="clouds generator",t[t.NONE=0]="NONE",t[t.TEST_PRIO=1]="TEST_PRIO"}(Vt||(Vt={}));const wy=0,U_e=new Map([[Vt.RESOURCE_CONTROLLER_IMMEDIATE,wy],[Vt.RESOURCE_CONTROLLER,4],[Vt.SLIDE,wy],[Vt.STREAM_DATA_LOADER,wy],[Vt.ELEVATION_QUERY,wy],[Vt.TERRAIN_SURFACE,1],[Vt.SURFACE_GEOMETRY_UPDATES,1],[Vt.LOD_RENDERER,2],[Vt.GRAPHICS_CORE,2],[Vt.I3S_CONTROLLER,2],[Vt.POINT_CLOUD_LAYER,2],[Vt.FEATURE_TILE_FETCHER,2],[Vt.OVERLAY,4],[Vt.STAGE,4],[Vt.GRAPHICS_DECONFLICTOR,4],[Vt.FILTER_VISIBILITY,4],[Vt.SCALE_VISIBILITY,4],[Vt.FRUSTUM_VISIBILITY,4],[Vt.CLOUDS_GENERATOR,4],[Vt.POINT_OF_INTEREST_FREQUENT,6],[Vt.POINT_OF_INTEREST_INFREQUENT,30],[Vt.LABELER,8],[Vt.FEATURE_QUERY_ENGINE,8],[Vt.FEATURE_TILE_TREE,16],[Vt.FEATURE_TILE_TREE_ACTIVE,wy],[Vt.ELEVATION_ALIGNMENT,12],[Vt.TEXT_TEXTURE_ATLAS,12],[Vt.TEXTURE_UNLOAD,12],[Vt.LINE_OF_SIGHT_TOOL,16],[Vt.LINE_OF_SIGHT_TOOL_INTERACTIVE,wy],[Vt.SNAPPING,wy],[Vt.SHADOW_ACCUMULATOR,30]]);function z_e(t){return U_e.has(t)?U_e.get(t):typeof t=="number"?t:1}const V_e=6.5,B_e=1,WSt=30,j_e=1e3/30,G_e=100,H_e=.9;var _B,Gx;(function(t){class e{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(s=>s.needsUpdate)}constructor(){this._updating=NN(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new Hv("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new i,this._state=ai.INTERACTING,this._tasks=new dr,this._runQueue=new dr,this._load=0,this._idleStateCallbacks=new dr,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=pe(()=>HSt.SCHEDULER_LOG_SLOW_TASKS,o=>this._debug=o,_r);for(const o of Object.keys(Vt))this.performanceInfo.tasks.set(Vt[o],new Hv(Vt[o]));const s=this;this._test={FRAME_SAFETY_BUDGET:V_e,INTERACTING_BUDGET:j_e,IDLE_BUDGET:G_e,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:()=>s._budget,setBudget:o=>s._budget=o,updateTask:o=>this._updateTask(o),getState:o=>this._getState(o),getRuntime:o=>this._getRuntime(o),frameTaskTimes:this._frameTaskTimes,resetRuntimes:()=>this._resetRuntimes(),getRunning:()=>this._getRunning()}}destroy(){this._tasks.toArray().forEach(s=>s.remove()),this._tasks.clear(),yi(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(s){this._updatingChanged(),s&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this.frame())}))}registerTask(s,o){const a=z_e(s),l=new r(this,s,o,a);return this._tasks.push(l),this._updatingChanged(),this.performanceInfo.tasks.has(s)||this.performanceInfo.tasks.set(s,new Hv(s)),l}registerIdleStateCallbacks(s,o){const a={idleBegin:s,idleEnd:o};this._idleStateCallbacks.push(a),this.state===ai.IDLE&&this._idleUpdatesStartFired&&a.idleBegin();const l=this;return{remove:()=>this._removeIdleStateCallbacks(a),set idleBegin(c){l._idleUpdatesStartFired&&(a.idleEnd(),l._state===ai.IDLE&&c()),a.idleBegin=c},set idleEnd(c){a.idleEnd=c}}}get load(){return this._load}set state(s){this._state!==s&&(this._state=s,this.state!==ai.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll(o=>o.idleEnd())))}get state(){return this._state}updateBudget(s){this._test.usedBudget=0,++this._frameNumber;let o=V_e,a=s.frameDuration,l=B_e;switch(this.state){case ai.IDLE:o=0,a=Math.max(G_e,s.frameDuration),l=WSt;break;case ai.INTERACTING:a=Math.max(j_e,s.frameDuration);case ai.ANIMATING:}return a=a-s.elapsedFrameTime-o,this.state!==ai.IDLE&&a<B_e&&!this._forceTask?(this._forceTask=!0,!1):(a=Math.max(a,l),this._budget.reset(a,this.state),this._updateLoad(),this._schedule())}frame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case ai.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll(s=>s.idleBegin())),this._runIdle();break;case ai.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}stopFrame(){this._budget.reset(0,this._state),this._budget.madeProgress()}_removeIdleStateCallbacks(s){this._idleUpdatesStartFired&&s.idleEnd(),this._idleStateCallbacks.removeUnordered(s)}removeTask(s){this._tasks.removeUnordered(s),this._runQueue.removeUnordered(s),this._updatingChanged()}_updateTask(s){this._tasks.forAll(o=>{o.name===s&&o.setPriority(s)})}_getState(s){if(this._runQueue.some(a=>a.name===s))return Gx.SCHEDULED;let o=Gx.IDLE;return this._tasks.forAll(a=>{a.name===s&&a.needsUpdate&&(a.schedulePriority<=1?o=Gx.READY:o!==Gx.READY&&(o=Gx.WAITING))}),o}_getRuntime(s){let o=0;return this._tasks.forAll(a=>{a.name===s&&(o+=a.runtime)}),o}_resetRuntimes(){this._tasks.forAll(s=>s.runtime=0)}_getRunning(){const s=new Map;if(this._tasks.forAll(a=>{a.needsUpdate&&s.set(a.name,(s.get(a.name)||0)+1)}),s.size===0)return null;let o="";return s.forEach((a,l)=>{o+=a>1?` ${a}x ${l}`:` ${l}`}),o}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const s=this._tasks.reduce((o,a)=>a.needsUpdate?++o:o,0);this._load=this._load*H_e+s*(1-H_e)}_schedule(){for(this._runQueue.filterInPlace(s=>!!s.needsUpdate||(s.schedulePriority=s.basePriority,!1)),this._tasks.forAll(s=>{s.basePriority===wy&&s.needsUpdate&&!this._runQueue.includes(s)&&s.blockFrame!==this._frameNumber&&this._runQueue.unshift(s)});this._runQueue.length===0;){let s=!1,o=0;if(this._tasks.forAll(a=>{a.needsUpdate&&a.schedulePriority!==0&&a.basePriority!==wy&&a.blockFrame!==this._frameNumber&&(s=!0,o=Math.max(o,a.basePriority),a.schedulePriority===1?(a.schedulePriority=0,this._runQueue.push(a)):--a.schedulePriority)}),!s)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){const s=this._budget.now();this._startFrameTaskTimes();do for(;this._runQueue.length>0;){const o=this._budget.now(),a=this._runQueue.pop();this._budget.resetProgress();try{a.task.runTask(this._budget)===ll.YIELD&&(a.blockFrame=this._frameNumber)}catch(c){re.getLogger("esri.views.support.Scheduler").error(`Exception in task "${a.name}"`,c)}!this._budget.hasProgressed&&a.blockFrame!==this._frameNumber&&a.needsUpdate&&(a.name,Vt.I3S_CONTROLLER,a.blockFrame=this._frameNumber),a.schedulePriority=a.basePriority;const l=this._budget.now()-o;if(a.runtime+=l,this._frameTaskTimes.set(a.priority,this._frameTaskTimes.get(a.priority)+l),this._debug&&l>2*this._budget.budget&&console.log("Task",a.name,"used",l,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-s)}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-s)}_startFrameTaskTimes(){for(const s of Object.keys(Vt))this._frameTaskTimes.set(Vt[s],0)}_recordFrameTaskTimes(s){this._frameTaskTimes.forEach((o,a)=>this.performanceInfo.tasks.get(a).record(o)),this.performanceInfo.total.record(s)}get test(){return this._test}}t.Scheduler=e;class r{get task(){return this._task.value}get updating(){return this._queue.running}constructor(s,o,a,l){this._scheduler=s,this.name=o,this._basePriority=l,this.blockFrame=0,this.runtime=0,this._queue=new GSt,this._handles=new Ri,this.schedulePriority=this._basePriority,this._task=NN(a??this._queue),this._handles.add(du(()=>this.task.running,c=>s.taskRunningChanged(c)))}remove(){this.processQueue(bc),this._scheduler.removeTask(this),this.schedule=FP.schedule,this.reschedule=FP.reschedule,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(s){this.name=s;const o=z_e(s);this._basePriority!==wy&&this.schedulePriority===0||(this.schedulePriority=o),this._basePriority=o}get priority(){return this.name}set priority(s){this.setPriority(s)}get needsUpdate(){return this.updating||this.task.running}schedule(s,o,a){return this._queue.push(s,o,a)}reschedule(s,o,a){return this._queue.unshift(s,o,a)}processQueue(s){this._queue.runTask(s)}}class i{constructor(){this._begin=typeof performance<"u"?performance.now():0,this._budget=0,this._state=ai.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}run(s){return!this.done&&(s()===!0&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get state(){return this._state}get enabled(){return this._enabled}set enabled(s){this._enabled=s}reset(s,o){this._begin=this.now(),this._budget=s,this._state=o,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return performance.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}t.Budget=i})(_B||(_B={})),function(t){t.SCHEDULED="s",t.READY="r",t.WAITING="w",t.IDLE="i"}(Gx||(Gx={}));const bc=(()=>{const t=new _B.Budget;return t.enabled=!1,t})();let XSt=class{remove(){}processQueue(){}schedule(e,r,i){try{if(go(r)){const n=Wr();return i?Promise.resolve(i(n)):Promise.reject(n)}return yQ(e(bc))}catch(n){return Promise.reject(n)}}reschedule(e,r,i){return this.schedule(e,r,i)}};const FP=new XSt;var ore;let Xv=ore=class extends me{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}clone(){return new ore({url:this.url})}};d([p({type:String,json:{write:{isRequired:!0}}})],Xv.prototype,"url",void 0),Xv=ore=d([I("esri.webdoc.support.SlideThumbnail")],Xv);var are;let rz=are=class extends me{constructor(){super(...arguments),this.text=""}clone(){return new are({text:this.text})}};d([p({type:String,json:{write:!0}})],rz.prototype,"text",void 0),rz=are=d([I("esri.webscene.support.Description")],rz);const iz=rz;var lre;let jO=lre=class extends me{constructor(){super(...arguments),this.lighting=new nE,this.weather=new WV}clone(){return new lre({lighting:ie(this.lighting),weather:ie(this.weather)})}};d([p({types:nNe,json:{write:!0}})],jO.prototype,"lighting",void 0),d([p({types:gue,json:{write:!0}})],jO.prototype,"weather",void 0),jO=lre=d([I("esri.webscene.Environment")],jO);var nz;let sz=nz=class extends me{constructor(){super(...arguments),this.opacity=null}clone(){return new nz({opacity:this.opacity})}cloneAndApplyTo(t){return this.opacity==null||((t=(t==null?void 0:t.clone())??new CN).opacity=this.opacity),t}static fromGround(t){return new nz({opacity:t.opacity})}};d([p({type:Number,json:{type:hn,read:{reader:rE,source:"transparency"},write:{writer:(t,e)=>{e.transparency=X4(t)},target:"transparency"}}})],sz.prototype,"opacity",void 0),sz=nz=d([I("esri.webscene.support.SlideGround")],sz);const Y5e=sz;var cre;let GO=cre=class extends me{constructor(t){super(t),this.id="",this.sublayerIds=null}clone(){return new cre({id:this.id,sublayerIds:ie(this.sublayerIds)})}};d([p({type:String,json:{write:!0}})],GO.prototype,"id",void 0),d([p({type:[hn],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],GO.prototype,"sublayerIds",void 0),GO=cre=d([I("esri.webscene.support.SlideVisibleLayer")],GO);var ure;let oz=ure=class extends me{constructor(){super(...arguments),this.text=""}clone(){return new ure({text:this.text})}};d([p({type:String,json:{write:{isRequired:!0}}})],oz.prototype,"text",void 0),oz=ure=d([I("esri.webscene.support.Title")],oz);const dD=oz;let YSt=0;const dre=vt.ofType(GO);let vl=class extends me{constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+YSt++,this.title=new dD,this.description=new iz,this.thumbnail=new Xv,this.viewpoint=null,this.basemap=null,this.ground=null,this.environment=new jO,this.visibleLayers=new dre}destroy(){var e;this.visibleLayers.removeAll(),(e=this.basemap)==null||e.destroy(),this.basemap=null,this.thumbnail=qe(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null}castTitle(e){return typeof e=="string"?new dD({text:e}):ls(dD,e)}castDescription(e){return typeof e=="string"?new iz({text:e}):ls(iz,e)}castThumbnail(e){return typeof e=="string"?new Xv({url:e}):ls(Xv,e)}castBasemap(e){return jce(e)}set visibleLayers(e){this._set("visibleLayers",R_(e,this._get("visibleLayers"),dre))}castVisibleLayers(e){return e&&typeof e.map=="function"?e.map(r=>{if(typeof r=="string")return{id:r};if(r instanceof O3){const i=q_e(r);return{id:r.id,sublayerIds:i}}return r.id?{id:r.id,sublayerIds:"sublayerIds"in r?r.sublayerIds:void 0}:(re.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),r)}):null}clone(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})}_updateVisibleLayersFrom(e){const r=[];return ou(this._getLayers(e.map).map(i=>e.whenLayerView(i).then(n=>{if(n.visible){const s=q_e(i);r.push(new GO({id:n.layer.id,sublayerIds:s}))}})).toArray()).then(()=>{this.visibleLayers.removeAll(),this.visibleLayers.addMany(r)})}updateFrom(e,r){const i={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...r&&r.screenshot};return e.when(()=>(this.viewpoint=e.viewpoint.clone(),this.environment.lighting=e.environment.lighting.type==="virtual"?iF.prototype.clone.apply(e.environment.lighting):nE.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.basemap=e.map.basemap&&e.map.basemap.clone()||null,this.ground=e.map.ground?Y5e.fromGround(e.map.ground):null,this._updateVisibleLayersFrom(e))).then(()=>e.takeScreenshot(i)).then(n=>(this.thumbnail=new Xv({url:n.dataUrl}),this))}async applyTo(e,r){this._applyToController!=null&&this._applyToController.abort();let i=new AbortController;this._applyToController=i;const n=g7(r,()=>i==null?void 0:i.abort()),s=e.resourceController.scheduler.registerTask(Vt.SLIDE);let o=!1;const a={animate:!0,...r,signal:this._applyToController.signal},l=async()=>{await Promise.all([s.schedule(()=>o=this._setViewpointOfInterest(e,a)),s.schedule(()=>this._applyBasemap(e,a),a.signal)]),await this._loadLayersWithSublayerVisibility(e),await Promise.all([s.schedule(()=>this._applyLayerVisibility(e),a.signal),s.schedule(()=>this._applyGround(e),a.signal),s.schedule(()=>this._applyViewpoint(e,a),a.signal)]),await s.schedule(()=>e.environment.weather=this.environment.weather.clone())},c=await wd(e.addUpdatingPromise(l()));if(o&&(e.contentCamera=null),s.remove(),this._applyToController===i&&(this._applyToController=null),i=null,n==null||n.remove(),c.ok===!1)throw c.error;return this}async _applyBasemap(e,r){if(this.basemap){try{await this.basemap.load(r)}catch(i){if(Yn(i))throw i}e.map.basemap=Cmt(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_getLayers(e){const r=new vt;return this._collectLayers(e,r),this._collectLayers(e.ground,r),r}_collectLayers(e,r){e.layers.forEach(i=>{cvt(i)&&(r.add(i),"layers"in i&&this._collectLayers(i,r))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await ou(this._getLayers(e.map).map(r=>{var n;return((n=this.visibleLayers.find(s=>s.id===r.id))==null?void 0:n.sublayerIds)?r.load():null}))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(r=>{const i=this.visibleLayers.find(o=>o.id===r.id);r.visible=i!=null;const n=i==null?void 0:i.sublayerIds,s=Z5e(r);n&&s&&s.forEach(o=>o.visible=n.includes(o.id))})}_setViewpointOfInterest(e,r){if(e.state.fixedContentCamera||!this.viewpoint||r!=null&&r.ignoreViewpoint||!(r!=null&&r.useDestinationCamera))return!1;const i=xde(e,this.viewpoint);return e.contentCamera=i,i!=null}async _applyViewpoint(e,r){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!r.ignoreViewpoint){if(this.viewpoint.camera!=null&&(this.viewpoint.camera.fov=e.camera.fov),r.animate&&this.get("environment.lighting.date"))return this._animateToLighting(e,r);r.animate&&(e.environment.applyLighting(this.environment.lighting.clone()),await e.goTo(this.viewpoint,r)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,r){let i=null;return e.environment.lighting.type!=="virtual"&&this.environment.lighting.type!=="virtual"&&(e.viewingMode==="global"&&(i=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,this.environment.lighting.type==="virtual"||e.environment.lighting.type==="virtual"?(e.environment.applyLighting(this.environment.lighting.clone()),e.environment.lighting.type!=="virtual"&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):this.environment.lighting.displayUTCOffset!=null&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,r).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(n=>{throw e.animation==null&&this._applyCachedCameraTrackingEnabled(e),n}).finally(()=>{yi(i)})}_applyCachedCameraTrackingEnabled(e){e.environment.cachedCameraTrackingEnabled!=null&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[e.getTime(),3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds()]}_setTime(e,r,i){return e.setTime(r),e.setUTCHours(i/3600),e.setUTCMinutes(i%3600/60),e.setUTCSeconds(i%3600%60),e}_animateLightingWithCamera(e,r,i){const n=new Date(r.date.toString()),[s,o]=this._getTime(n),[a,l]=this._getTime(i.date),c=ZSt(o,l),u=e.renderCoordsHelper,h=A();u.toRenderCoords(e.camera.position,h);const f=A(),m=A();this.viewpoint.camera!=null&&u.toRenderCoords(this.viewpoint.camera.position,f);const g=new Date;return du(()=>e.camera,y=>{u.toRenderCoords(y.position,m);const _=ks(h,m),b=ks(f,m);let w=0;_+b!==0&&(w=_/(_+b));const x=s+(a-s)*w,S=JSt(o,c*w);r.date=this._setTime(g,x,S)})}static createFrom(e,r){return new this().updateFrom(e,r)}};function Z5e(t){if(t.type==="building-scene"||t.type==="map-image")return t.allSublayers.toArray()}function q_e(t){const e=Z5e(t);if(e)return e.filter(r=>r.visible).map(r=>r.id)}d([p({type:String,json:{write:{isRequired:!0}}})],vl.prototype,"id",void 0),d([p({type:dD,json:{default:()=>new dD({text:""}),write:{isRequired:!0}}})],vl.prototype,"title",void 0),d([ur("title")],vl.prototype,"castTitle",null),d([p({type:iz,json:{write:{overridePolicy:t=>({enabled:!(!t||!t.text)})}}})],vl.prototype,"description",void 0),d([ur("description")],vl.prototype,"castDescription",null),d([p({type:Xv,json:{default:()=>new Xv({url:""}),write:{isRequired:!0}}})],vl.prototype,"thumbnail",void 0),d([ur("thumbnail")],vl.prototype,"castThumbnail",null),d([p({type:Sd,nonNullable:!0,json:{write:{isRequired:!0}}})],vl.prototype,"viewpoint",void 0),d([p({type:TN,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],vl.prototype,"basemap",void 0),d([ur("basemap")],vl.prototype,"castBasemap",null),d([p({type:Y5e,json:{write:!0}})],vl.prototype,"ground",void 0),d([p({type:dre,json:{write:{isRequired:!0}}})],vl.prototype,"visibleLayers",null),d([ur("visibleLayers")],vl.prototype,"castVisibleLayers",null),d([p({type:jO,json:{write:!0}})],vl.prototype,"environment",void 0),vl=d([I("esri.webscene.Slide")],vl);const hre=86400,W_e=43200;function ZSt(t,e){let r=e-t;return r>W_e&&(r-=hre),r<-W_e&&(r+=hre),r}function JSt(t,e){return hvt(t+e,hre)}const KSt=vl,pre=vt.ofType(KSt);let az=class extends me{constructor(e){super(e),this.slides=new pre}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(r=>!!r.viewpoint)),this._set("slides",R_(e,this._get("slides"),pre))}clone(){return new this.constructor({slides:this.slides.clone()})}};d([p({type:pre,nonNullable:!0,json:{write:!0}}),ur(mce)],az.prototype,"slides",null),az=d([I("esri.webscene.Presentation")],az);const J5e=az;var fre;let DR=fre=class extends me{constructor(t){super(t)}clone(){return new fre({name:this.name,path:this.path,title:this.title})}};d([p({type:String,json:{write:!0}})],DR.prototype,"name",void 0),d([p({type:String,json:{write:!0}})],DR.prototype,"path",void 0),d([p({type:String,json:{write:!0}})],DR.prototype,"title",void 0),DR=fre=d([I("esri.webscene.TransportationNetwork")],DR);const QSt=DR;let nx=class{constructor(e,r,i=""){this.major=e,this.minor=r,this._context=i}lessThan(e,r){return this.major<e||e===this.major&&this.minor<r}since(e,r){return!this.lessThan(e,r)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new H(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new nx(this.major,this.minor,this._context)}static parse(e,r=""){const[i,n]=e.split("."),s=/^\s*\d+\s*$/;if(!i||!i.match||!s.test(i))throw new H((r&&r+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!n||!n.match||!s.test(n))throw new H((r&&r+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});const o=parseInt(i,10),a=parseInt(n,10);return new nx(o,a,r)}},bB=class extends nx{constructor(e,r){super(e,r,"webscene")}get supportsGround(){return this.since(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}},eTt=null;function tTt(){return eTt}var K5e;const E2=new bB(1,31),rTt=()=>{const e=[],r=E2.major;for(let i=8;i<=E2.minor;i++)e.push(`${r}.${i}`);return e},OX="Web Scene",pk="ViewingMode-Local";let Pi=class extends sg.LoadableMixin(G4(Q4(qLe))){constructor(e){super(e),this[K5e]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new J5e,this.initialViewProperties=new XV,this.portalItem=null,this.resourceInfo=null,this._debouncedSaveOperations=B4(async(r,i,n)=>{switch(r){case HO.SAVE:return this._saveImpl(i);case HO.SAVE_AS:return this._saveAsImpl(n,i)}}),this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{re.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(r){return void this.addResolvingPromise(Promise.reject(r))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles([da(()=>this.tables,"before-add",e=>{e.preventDefault(),re.getLogger(this).errorOnce("tables","Tables are not yet supported in a WebScene")}),da(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC())])}destroy(){var e;this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=qe(this.portalItem),(e=this.basemap)==null||e.destroy()}writeClippingArea(e,r){r.clippingArea||(r.clippingArea={}),r.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,r){return!!r.clippingArea&&!!r.clippingArea.clip}writeClippingEnabled(e,r){this.clippingArea&&(r.clippingArea||(r.clippingArea={}),r.clippingArea.clip=e)}writeLayers(e,r,i,n){const s={...n,layerContainerType:"operational-layers"},o=e.map(a=>this.verifyWriteLayer(a,n)?a.write({},s):null).filter(a=>!!a);r[i]=o.toArray()}verifyWriteLayer(e,r){return"write"in e||(r&&r.messages&&r.messages.push(new H("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1)}readSourceVersion(e,r){const[i,n]=r.version.split(".");return new bB(parseInt(i,10),parseInt(n,10))}writeSourceVersion(e,r,i){r[i]=`${E2.major}.${E2.minor}`}get thumbnailUrl(){var e;return((e=this.portalItem)==null?void 0:e.thumbnailUrl)??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,r){e&&this._isAuthoringAppSetByUser?r.authoringApp=e:r.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,r){e&&this._isAuthoringAppVersionSetByUser?r.authoringAppVersion=e:r.authoringAppVersion=C$e}writeGround(e,r,i,n){r[i]=e?e.write({},n):{transparency:0,layers:[]}}readInitialViewProperties(e,r){const i={};return r.initialState&&r.initialState.environment&&(i.environment=TP.fromJSON(r.initialState.environment)),r.spatialReference?i.spatialReference=dt.fromJSON(r.spatialReference):i.spatialReference=dt.WebMercator,i.viewingMode=r.viewingMode||"global",r.initialState&&r.initialState.viewpoint&&(i.viewpoint=Sd.fromJSON(r.initialState.viewpoint)),new XV(i)}get spatialReference(){var e;return((e=this.initialViewProperties)==null?void 0:e.spatialReference)??dt.WebMercator}get viewingMode(){var e;return((e=this.initialViewProperties)==null?void 0:e.viewingMode)??"global"}load(e){const r=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{r&&r!==this.ground&&r.destroy()})),Promise.resolve(this)}loadAll(){return vce(this,e=>{const r=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,r&&r.map(i=>i.basemap))})}read(e,r){var s;r={...r,origin:"web-scene"};const i=this._isAuthoringAppVersionSetByUser,n=this._isAuthoringAppSetByUser;if(_Ie(this,e,o=>super.read(e,o),r),n||(this._isAuthoringAppSetByUser=!1),i||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&((s=this.sourceVersion)==null?void 0:s.supportsVisibleElevationLayersInSlides)){const o=e.baseMap.elevationLayers.map(u=>({id:u.id})),a=this.presentation.slides,l=(u,h)=>u.visibleLayers.some(f=>f.id===h),c=o.filter(u=>!a.some(h=>l(h,u.id)));a.forEach(u=>{u.visibleLayers.addMany(c)})}}_writeBasemapElevationLayers(e){const r=e.ground&&e.ground.layers;!e.baseMap&&r&&r.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=ie(r))}write(e,r){var s;if(this.loadStatus!=="loaded"){const o=new H("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw re.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),o}this._runLayersIdGC();const i=!(r!=null&&r.messages);r={messages:[],...r,origin:"web-scene"};const n=super.write(e,r);if(i){const o=((s=r.messages)==null?void 0:s.filter(a=>a.name==="web-document-write:property-required"))??[];if(o.length){const a=new H("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:o});throw re.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",o),a}}return this._writeBasemapElevationLayers(n),n}async save(e){return this._debouncedSaveOperations(HO.SAVE,e)}async _saveImpl(e){var s;if(!this.portalItem)throw re.getLogger(this).error("save(): requires the .portalItem property to be set"),await Promise.resolve(),new H("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(((s=this.portalItem)==null?void 0:s.type)!==OX)throw await Promise.resolve(),new H("webscene:portal-item-wrong-type",`Portal item needs to have type "${OX}"`);const r=this._updateFromPromise;await this._ensureLoadBeforeSave();const i=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl?Ts(this.portalItem.itemUrl):null,messages:[],portal:this.portalItem.portal??Ns.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),n=this.write({},i);return await Promise.all(i.resources.pendingOperations),await this._verifySave(n,i,e),this._updateTypeKeywords(this.portalItem),await this.portalItem.update({data:n}),await qV(this._resourceReferences,i,null),UV(i),r&&await r,await this._saveThumbnail(),this.portalItem}async saveAs(e,r){return this._debouncedSaveOperations(HO.SAVE_AS,r,e)}async _saveAsImpl(e,r){var c;let i=Qv.from(e);i||(re.getLogger(this).error("saveAs(portalItem): requires a portal item parameter"),await Promise.reject(new H("webscene:portal-item-required","saveAs requires a portal item to save to"))),i.id&&(i=i.clone(),i.id=null);const n=i.portal||Ns.getDefault();await this._ensureLoadBeforeSave(),i.type=OX,i.portal=n;const s=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:n,portalItem:i,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),o=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(o,s,r);const a=this.thumbnailUrl,l=!this._isOverridden("thumbnailUrl");return this._updateTypeKeywords(i),await n.signIn(),await((c=n.user)==null?void 0:c.addItem({item:i,folder:r&&r.folder,data:o})),await qV(this._resourceReferences,s,null),this.portalItem=i,eee.prototype.read.call(this,{version:o.version,authoringApp:o.authoringApp,authoringAppVersion:o.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:i.itemUrl?Ts(i.itemUrl):void 0}),UV(s),a&&(this.thumbnailUrl=l?rce(a,"w","8192"):a),s.portalItem=i,await this._saveThumbnail(),i}async _saveThumbnail(){var e;this._isOverridden("thumbnailUrl")&&(await((e=this.portalItem)==null?void 0:e.updateThumbnail({thumbnail:this.thumbnailUrl})),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}_verifySave(e,r,i,n=!1){var c;if(!pP(this.spatialReference))return Promise.reject(new H("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let s,o=((c=r.messages)==null?void 0:c.filter(u=>u.type==="error").map(u=>new H(u.name,u.message,u.details)))??[];r.blockedRelativeUrls&&(o=o.concat(r.blockedRelativeUrls.map(u=>new H("url:unsupported",`Relative url '${u}' is not supported in Web Scene`)))),i&&i.ignoreUnsupported&&(o=o.filter(u=>u.name!=="layer:unsupported"&&u.name!=="symbol:unsupported"&&u.name!=="symbol-layer:unsupported"&&u.name!=="property:unsupported"&&u.name!=="url:unsupported"&&u.name!=="scenemodification:unsupported")),i!=null&&i.requiredPropertyChecksDisabled&&(o=o.filter(u=>u.name!=="web-document-write:property-required"));const a=!!(i!=null&&i.strictSchemaValidationEnabled),l=tTt();return s=a&&l?l().then(u=>{const h=u.validate(e);if(h.length>0){const f=`webscene did not validate:
${h.join(`
`)}`;re.getLogger(this).error(`${n?"saveAs":"save"}(): ${f}`)}return h.map(f=>new H("webscene:schema-validation",f))}).then(u=>{if(u.length>0)throw Pyt(u.concat(o));return o}):Promise.resolve(o),s.then(u=>{if(u.length>0)throw new H("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:u})})}_verifySaveAs(e,r,i){return this.canNotSaveAs(r)?Promise.reject(Ayt()):this._verifySave(e,r,i,!0)}verifySaveAs(e){const r=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),i=this.write({},r);return this._verifySaveAs(i,r,e)}canNotSaveAs(e){var r,i;return e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},e)),(((i=(r=e.verifyItemRelativeUrls)==null?void 0:r.writtenUrls)==null?void 0:i.length)??0)>0}async updateFrom(e,r={}){const i=this._updateFrom(e,r);this._updateFromPromise=i,await i,this._updateFromPromise===i&&(this._updateFromPromise=null)}async _updateFrom(e,r={}){if(await e.whenReady(),!r.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=TP.prototype.clone.apply(e.environment)),!r.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,e.clippingArea!=null?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const i of e.allLayerViews){const n="visible";n in i&&n in i.layer&&i._isOverridden(n)&&(i.layer[n]=i[n])}(r.thumbnailExcluded===!1||r.thumbnailExcluded==null&&!r.viewpointExcluded)&&await this._updateFromThumbnail(e,r.thumbnailSize??void 0)}async _updateFromThumbnail(e,r){const i=zyt(e,r),n=await e.takeScreenshot({format:"jpg",width:i.width,height:i.height,disableDecorations:!0});this.thumbnailUrl=n.dataUrl}_loadFromSource(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()}_readAndLoadFromJSON(e,r){const i=this._validateJSON(e);return this.read(i,r),this._loadFromJSON(i,r)}_extractOperationalLayers(e){var s;const r=[];if(!((s=this.sourceVersion)!=null&&s.supportsGround)&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const o of e.baseMap.elevationLayers)r.push(o);const i=[],n=o=>{var a;return o.layers&&(o.layers=o.layers.filter(n)),o.layerType!=="ArcGISTiledElevationServiceLayer"||((a=this.sourceVersion)!=null&&a.supportsGround||i.push(o),!1)};return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(n):[],operationalElevationLayers:i,basemapElevationLayers:r}}_loadFromJSON(e,r){const i=new vt;return this._validateSpatialReference().then(()=>this._validateHeightModelInfo()).then(()=>le(()=>import("./layersCreator-5ed461fc.js"),["assets/layersCreator-5ed461fc.js","assets/lazyLayerLoader-49c90994.js","assets/portalLayers-e8c5e5dc.js","assets/layersLoader-8bc96631.js","assets/fetchService-7b5f3ba7.js","assets/jsonContext-03b7f0b9.js"])).then(({populateOperationalLayers:n})=>{const{operationalLayers:s,operationalElevationLayers:o,basemapElevationLayers:a}=this._extractOperationalLayers(e),l=[],c={context:{...r,layerContainerType:"operational-layers"}};if(this.portalItem&&(c.context.portal=this.portalItem.portal||Ns.getDefault()),a.length>0){const u={...c,context:{...c.context,layerContainerType:"ground"}};u.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(n(this.ground.layers,a,u))}if(o.length>0){const u={...c,context:{...c.context,layerContainerType:"ground"}};u.defaultLayerType="ArcGISTiledElevationServiceLayer",l.push(n(i,o,u))}return s&&s.length>0&&l.push(n(this.layers,s,c)),ou(l).then(()=>{})}).then(()=>this._loadObjectsWithLayers()).then(()=>{this.ground.layers.addMany(i)})}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],r=[...this.allLayers.items];for(const{basemap:i}of this.presentation.slides.items)i&&(r.push(...i.baseLayers.items),r.push(...i.referenceLayers.items));for(const i of r)if("beforeSave"in i&&typeof i.beforeSave=="function"){const n=i.beforeSave();n&&e.push(n)}await ou(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(r=>{r.basemap&&e.push(r.basemap.load())}),await ou(e)}async _loadFromItem(e){if(await e.load().catch(n=>{throw new H("webscene:load-portal-item","Failed to load portal item",{error:n})}),e.type!=="Web Scene")throw new H("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const r=await e.fetchData();this.resourceInfo=r;const i={origin:"web-scene",url:Ts(e.itemUrl),portal:e.portal||Ns.getDefault(),portalItem:e,readResourcePaths:[]};await this._readAndLoadFromJSON(r,i),this._resourceReferences={portalItem:e,paths:i.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,r=this._sceneSpatialReference;let i;if(e.viewingMode!=="local"){if(!ON(r,at.Global))return Promise.reject(new H("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:r,viewingMode:e.viewingMode}));i=l=>!l||lf(l,r)}else{if(!ON(r,at.Local))return Promise.reject(new H("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:r,viewingMode:e.viewingMode}));i=l=>!l||l.equals(r)}const n=l=>{var c,u;return((c=l==null?void 0:l.camera)==null?void 0:c.position.spatialReference)??((u=l==null?void 0:l.targetGeometry)==null?void 0:u.spatialReference)},s=e.viewpoint,o=n(s);if(o&&!i(o))return Promise.reject(new H("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:o,sceneSpatialReference:r,viewingMode:e.viewingMode}));const a=this.presentation.slides.find(l=>!i(n(l.viewpoint)));if(a){const l=n(a.viewpoint);return Promise.reject(new H("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:r,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,r=yyt(this.heightModelInfo,e);return r?Promise.reject(r):Promise.resolve()}_validateJSON(e){const r=bB.parse(e.version||"","webscene");return E2.validate(r),e.version=`${r.major}.${r.minor}`,r.major===1&&r.minor<=2&&(e.spatialReference=dt.WebMercator.toJSON()),e}_updateTypeKeywords(e){this.initialViewProperties.viewingMode==="local"?e.typeKeywords?e.typeKeywords.includes(pk)||e.typeKeywords.push(pk):e.typeKeywords=[pk]:this.initialViewProperties.viewingMode==="global"&&e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(r=>r!==pk)),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((r,i,n)=>n.indexOf(r)===i))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||dt.WebMercator}get _verifyItemRelativeRootPath(){var e;return(e=this.portalItem)!=null&&e.itemUrl?Ts(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const r=this._verifyItemRelativeRootPath;return r&&(e.verifyItemRelativeUrls={rootPath:r,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,r=n=>this.allLayers.some(s=>s.id===n);e&&e.layers&&(e.layers=e.layers.filter(n=>r(n.id)));const i=this.presentation&&this.presentation.slides;i&&i.forEach(n=>{n.visibleLayers&&(n.visibleLayers=n.visibleLayers.filter(s=>r(s.id)))})}static fromJSON(e){if(!e)throw new H("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}};var HO;K5e=Cyt,Pi.version=`${E2.major}.${E2.minor}`,d([p({type:Wyt,json:{write:!0}})],Pi.prototype,"applicationProperties",void 0),d([p({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],Pi.prototype,"basemap",void 0),d([p({type:$r,json:{read:{source:"clippingArea.geometry",reader:P_},write:{target:"clippingArea.geometry"}}})],Pi.prototype,"clippingArea",void 0),d([tt("clippingArea")],Pi.prototype,"writeClippingArea",null),d([p({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],Pi.prototype,"clippingEnabled",void 0),d([ke("clippingEnabled",["clippingArea"])],Pi.prototype,"readClippingEnabled",null),d([tt("clippingEnabled")],Pi.prototype,"writeClippingEnabled",null),d([p({type:Eyt,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],Pi.prototype,"floorInfo",void 0),d([p({type:q_,json:{write:!0}})],Pi.prototype,"heightModelInfo",void 0),d([p({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],Pi.prototype,"layers",void 0),d([tt("layers")],Pi.prototype,"writeLayers",null),d([p({readOnly:!0,type:bB,json:{type:rTt(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],Pi.prototype,"sourceVersion",void 0),d([ke("sourceVersion",["version"])],Pi.prototype,"readSourceVersion",null),d([tt("sourceVersion")],Pi.prototype,"writeSourceVersion",null),d([p({json:{read:!1,write:!1}})],Pi.prototype,"tables",void 0),d([p()],Pi.prototype,"thumbnailUrl",null),d([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Pi.prototype,"authoringApp",null),d([tt("authoringApp")],Pi.prototype,"writeAuthoringApp",null),d([p({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],Pi.prototype,"authoringAppVersion",null),d([tt("authoringAppVersion")],Pi.prototype,"writeAuthoringAppVersion",null),d([p({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],Pi.prototype,"ground",void 0),d([tt("ground")],Pi.prototype,"writeGround",null),d([p({type:vt.ofType(QSt),json:{write:!0}})],Pi.prototype,"transportationNetworks",void 0),d([p({type:J5e,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(t,e,r,i)=>{if(t.slides&&t.slides.length>0){const n={...i,isPresentation:!0};e.presentation=t.write({},n)}}}}})],Pi.prototype,"presentation",void 0),d([p({type:XV,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new XV({viewingMode:"global",spatialReference:dt.WebMercator})}})],Pi.prototype,"initialViewProperties",void 0),d([ke("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],Pi.prototype,"readInitialViewProperties",null),d([p({type:dt,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Pi.prototype,"spatialReference",null),d([p({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],Pi.prototype,"viewingMode",null),d([p({type:Qv})],Pi.prototype,"portalItem",void 0),d([p()],Pi.prototype,"resourceInfo",void 0),Pi=d([I("esri.WebScene")],Pi),function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"}(HO||(HO={}));const iTt=Pi;function pH(t){return typeof t=="string"?document.getElementById(t):t??null}function Q5e(t){for(;t.hasChildNodes();)t.removeChild(t.firstChild)}function X_e(t,e){const r=e.parentNode;r&&r.insertBefore(t,e)}function Y_e(t,e){for(;;){const r=t.firstChild;if(!r)break;e.appendChild(r)}}let mre=class{constructor(e=r=>r.values().next().value){this._peeker=e,this._observable=new _7,this._items=new Set}get length(){return br(this._observable),this._items.size}clear(){this.length!==0&&(this._items.clear(),this._observable.notify())}last(){if(this.length===0)return;let e;for(e of this._items);return e}peek(){if(this.length!==0)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(e){return br(this._observable),this._items.has(e)}pop(){if(this.length===0)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(this.length===0)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const r=this.length;return this._items.forEach(i=>{e(i)||this._items.delete(i)}),r!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){br(this._observable),yield*this._items}};const nTt={statsWorker:()=>le(()=>import("./statsWorker-3c56df8f.js"),["assets/statsWorker-3c56df8f.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js"]),geometryEngineWorker:()=>le(()=>import("./geometryEngineWorker-7734f22a.js"),["assets/geometryEngineWorker-7734f22a.js","assets/geometryEngineJSON-53578afa.js","assets/geometryEngineBase-3a3551e4.js","assets/json-48e3ea08.js"]),CSVSourceWorker:()=>le(()=>import("./CSVSourceWorker-30bb4bcf.js"),["assets/CSVSourceWorker-30bb4bcf.js","assets/json-48e3ea08.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/number-80dd919e.js"]),EdgeProcessingWorker:()=>le(()=>import("./EdgeProcessingWorker-0bf6ea72.js"),[]),ElevationSamplerWorker:()=>le(()=>import("./ElevationSamplerWorker-bdbccb92.js"),["assets/ElevationSamplerWorker-bdbccb92.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/georeference-31d6bdc3.js","assets/MeshGeoreferencedRelativeVertexSpace-f0de074a.js","assets/MeshLocalVertexSpace-0cd48a41.js","assets/MeshTransform-f49f56fb.js"]),FeatureServiceSnappingSourceWorker:()=>le(()=>import("./FeatureServiceSnappingSourceWorker-21df58c3.js"),["assets/FeatureServiceSnappingSourceWorker-21df58c3.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/symbologySnappingCandidates-1e210adb.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/query-faa7dd63.js"]),GeoJSONSourceWorker:()=>le(()=>import("./GeoJSONSourceWorker-3a9ed765.js"),["assets/GeoJSONSourceWorker-3a9ed765.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/geojson-b47d7fde.js","assets/sourceUtils-014f2566.js"]),LercWorker:()=>le(()=>import("./LercWorker-d9ba2cf9.js"),[]),MemorySourceWorker:()=>le(()=>import("./MemorySourceWorker-318883c0.js"),["assets/MemorySourceWorker-318883c0.js","assets/objectIdUtils-789e911a.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/sourceUtils-014f2566.js"]),PBFDecoderWorker:()=>le(()=>import("./PBFDecoderWorker-904377a3.js"),["assets/PBFDecoderWorker-904377a3.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js"]),Pipeline:()=>le(()=>import("./Pipeline-729b5fc3.js").then(t=>t.P),["assets/Pipeline-729b5fc3.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/StreamFeatureManager-353ae173.js","assets/quickselect-8ff2a76e.js","assets/arcadeTimeUtils-147e820f.js","assets/centroid-8e8cfa47.js","assets/ogcFeatureUtils-b7539bae.js","assets/geojson-b47d7fde.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/createConnection-d2892117.js","assets/definitions-77bd9395.js","assets/TileInfoView-f292a00b.js","assets/number-e491b09e.js","assets/geohashUtils-77d8429b.js"]),PointCloudWorker:()=>le(()=>import("./PointCloudWorker-2383dca9.js"),["assets/PointCloudWorker-2383dca9.js","assets/PointCloudWorkerUtil-2cba7d14.js","assets/PointCloudUniqueValueRenderer-05a6e7f7.js"]),RasterWorker:()=>le(()=>import("./RasterWorker-8cc816d8.js"),["assets/RasterWorker-8cc816d8.js","assets/dataUtils-79510e96.js","assets/pixelRangeUtils-cc28ceb4.js","assets/colorUtils-c0f43caf.js","assets/utils-8dbba0ba.js","assets/rasterProjectionHelper-e9bda175.js"]),SceneLayerSnappingSourceWorker:()=>le(()=>import("./SceneLayerSnappingSourceWorker-57a357bd.js"),[]),SceneLayerWorker:()=>le(()=>import("./SceneLayerWorker-03575c61.js").then(t=>t.a),["assets/SceneLayerWorker-03575c61.js","assets/MeshGeoreferencedRelativeVertexSpace-f0de074a.js","assets/MeshLocalVertexSpace-0cd48a41.js","assets/I3SNode-8649fb12.js"]),WFSSourceWorker:()=>le(()=>import("./WFSSourceWorker-2b80033a.js"),["assets/WFSSourceWorker-2b80033a.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/geojson-b47d7fde.js","assets/sourceUtils-014f2566.js","assets/wfsUtils-4d6af6fb.js","assets/xmlUtils-444cb4c0.js"]),WorkerTileHandler:()=>le(()=>import("./WorkerTileHandler-14261aa8.js"),["assets/WorkerTileHandler-14261aa8.js","assets/TileClipper-ae6eca9e.js","assets/StyleRepository-c00c989a.js","assets/colorUtils-c0f43caf.js","assets/definitions-77bd9395.js","assets/Rect-98da58d6.js","assets/pbf-816f3f11.js","assets/TurboLine-01e1f1e4.js","assets/BidiEngine-9a40f2f4.js"])};var Qa;(function(t){t[t.HANDSHAKE=0]="HANDSHAKE",t[t.OPEN=1]="OPEN",t[t.OPENED=2]="OPENED",t[t.RESPONSE=3]="RESPONSE",t[t.INVOKE=4]="INVOKE",t[t.ABORT=5]="ABORT",t[t.CLOSE=6]="CLOSE",t[t.OPEN_PORT=7]="OPEN_PORT",t[t.ON=8]="ON"})(Qa||(Qa={}));let sTt=0;function eke(){return sTt++}function oTt(t){return t&&typeof t=="object"&&("result"in t||"transferList"in t)}function FN(t){return t?typeof t=="string"?JSON.stringify({name:"message",message:t}):t.toJSON?JSON.stringify(t):JSON.stringify({name:t.name,message:t.message,details:t.details||{stack:t.stack}}):null}function Cde(t,e,r,i){if(e.type===Qa.OPEN_PORT)return void t.postMessage(e,[e.port]);if(e.type!==Qa.INVOKE&&e.type!==Qa.RESPONSE)return void t.postMessage(e);let n;if(oTt(r)?(n=Z_e(r.transferList),e.data=r.result):(n=Z_e(i),e.data=r),n){if(he("ff")){for(const s of n)if("byteLength"in s&&s.byteLength>267386880){const o="Worker call with large ArrayBuffer would crash Firefox";switch(e.type){case Qa.INVOKE:throw o;case Qa.RESPONSE:return void Cde(t,{type:Qa.RESPONSE,jobId:e.jobId,error:FN(o)})}}}t.postMessage(e,n)}else t.postMessage(e)}function kN(t){if(!t)return null;const e=t.data;return e?typeof e=="string"?JSON.parse(e):e:null}function Z_e(t){if(!t||!t.length)return null;if(he("esri-workers-arraybuffer-transfer"))return t;const e=t.filter(r=>!aTt(r));return e.length?e:null}function aTt(t){var e;return t instanceof ArrayBuffer||((e=t==null?void 0:t.constructor)==null?void 0:e.name)==="ArrayBuffer"}const{CLOSE:J_e,ABORT:K_e,INVOKE:Q_e,RESPONSE:jM,OPEN_PORT:e1e,ON:lTt}=Qa,cTt=2;let uTt=class{constructor(e){this._timer=null,this._cancelledJobIds=new Set,this._invokeMessages=[],this._invoke=e,this._timer=null,this._process=this._process.bind(this)}push(e){e.type===Qa.ABORT?this._cancelledJobIds.add(e.jobId):(this._invokeMessages.push(e),this._timer===null&&(this._timer=setTimeout(this._process,0)))}clear(){this._invokeMessages.length=0,this._cancelledJobIds.clear(),this._timer=null}_process(){this._timer=null;for(const e of this._invokeMessages)this._cancelledJobIds.has(e.jobId)||this._invoke(e);this._cancelledJobIds.clear(),this._invokeMessages.length=0}},sx=class NR{static connect(e){const r=new MessageChannel;let i;i=typeof e=="function"?new e:"default"in e&&typeof e.default=="function"?new e.default:e;const n=new NR(r.port1,{channel:r,client:i},()=>null);return typeof i=="object"&&"remoteClient"in i&&(i.remoteClient=n),NR.clients.set(n,i),r.port2}static loadWorker(e){const r=nTt[e];return r?r():Promise.resolve(null)}constructor(e,r,i){this._port=e,this._getNextJob=i,this._outJobs=new Map,this._inJobs=new Map,this._invokeQueue=new uTt(n=>this._onInvokeMessage(n)),this._client=r.client,this._onMessage=this._onMessage.bind(this),this._channel=r.channel,this._schedule=r.schedule,this._port.addEventListener("message",this._onMessage),this._port.start()}close(){this._post({type:J_e}),this._close()}isBusy(){return this._outJobs.size>0}invoke(e,r,i){const n=i==null?void 0:i.signal,s=i==null?void 0:i.transferList;if(!this._port)return Promise.reject(new H("worker:port-closed",`Cannot call invoke('${e}'), port is closed`,{methodName:e,data:r}));const o=eke();return new Promise((a,l)=>{if(go(n))return this._processWork(),void l(Wr());const c=Dl(n,()=>{const h=this._outJobs.get(o);h&&(this._outJobs.delete(o),this._processWork(),yi(h.abortHandle),this._post({type:K_e,jobId:o}),l(Wr()))}),u={resolve:a,reject:l,abortHandle:c,debugInfo:e};this._outJobs.set(o,u),this._post({type:Q_e,jobId:o,methodName:e,abortable:n!=null},r,s)})}on(e,r){const i=new MessageChannel;function n(s){r(s.data)}return this._port.postMessage({type:Qa.ON,eventType:e,port:i.port2},[i.port2]),i.port1.addEventListener("message",n),i.port1.start(),{remove(){i.port1.postMessage({type:Qa.CLOSE}),i.port1.close(),i.port1.removeEventListener("message",n)}}}jobAdded(){this._processWork()}openPort(){const e=new MessageChannel;return this._post({type:e1e,port:e.port2}),e.port1}_processWork(){if(this._outJobs.size>=cTt)return;const e=this._getNextJob();if(!e)return;const{methodName:r,data:i,invokeOptions:n,resolver:s}=e;this.invoke(r,i,n).then(o=>s.resolve(o)).catch(o=>s.reject(o))}_close(){this._channel&&(this._channel=void 0),this._port.removeEventListener("message",this._onMessage),this._port.close(),this._outJobs.forEach(e=>{yi(e.abortHandle),e.reject(Wr(`Worker closing, aborting job calling '${e.debugInfo}'`))}),this._inJobs.clear(),this._outJobs.clear(),this._invokeQueue.clear(),this._port=null,this._client=null,this._schedule=null}_onMessage(e){this._schedule!=null?this._schedule(()=>this._processMessage(e)):this._processMessage(e)}_processMessage(e){const r=kN(e);if(r)switch(r.type){case jM:this._onResponseMessage(r);break;case Q_e:this._invokeQueue.push(r);break;case K_e:this._onAbortMessage(r);break;case J_e:this._onCloseMessage();break;case e1e:this._onOpenPortMessage(r);break;case lTt:this._onOnMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);this._invokeQueue.push(e),n&&(n.controller&&n.controller.abort(),r.delete(i))}_onCloseMessage(){const e=this._client;this._close(),e&&"destroy"in e&&NR.clients.get(this)===e&&e.destroy(),NR.clients.delete(this),e!=null&&e.remoteClient&&(e.remoteClient=null)}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs;let l,c=this._client,u=c[r];try{if(!u&&r&&r.includes(".")){const h=r.split(".");for(let f=0;f<h.length-1;f++)c=c[h[f]],u=c[h[f+1]]}if(typeof u!="function")throw new TypeError(`${r} is not a function`);l=u.call(c,n,{client:this,signal:o?o.signal:null})}catch(h){return void this._post({type:jM,jobId:i,error:FN(h)})}Dh(l)?(a.set(i,{controller:o,promise:l}),l.then(h=>{a.has(i)&&(a.delete(i),this._post({type:jM,jobId:i},h))},h=>{a.has(i)&&(a.delete(i),Yn(h)||this._post({type:jM,jobId:i,error:FN(h||{message:`Error encountered at method ${r}`})}))})):this._post({type:jM,jobId:i},l)}_onOpenPortMessage(e){new NR(e.port,{client:this._client},()=>null)}_onOnMessage(e){const{port:r}=e,i=this._client.on(e.eventType,s=>{r.postMessage(s)}),n=V4(e.port,"message",s=>{const o=kN(s);(o==null?void 0:o.type)===Qa.CLOSE&&(n.remove(),i.remove(),r.close())})}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs;if(!s.has(r))return;const o=s.get(r);s.delete(r),this._processWork(),yi(o.abortHandle),i?o.reject(H.fromJSON(JSON.parse(i))):o.resolve(n)}_post(e,r,i){return Cde(this._port,e,r,i)}};sx.kernelInfo={buildDate:T$e,fullVersion:nce,revision:E$e},sx.clients=new Map;let dTt=class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new mre}destroy(){this.close()}get closed(){return!this._clients||!this._clients.length}open(e,r){return new Promise((i,n)=>{let s=!0;const o=a=>{vr(r.signal),s&&(s=!1,a())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let a=0;a<e.length;++a){const l=e[a];Dh(l)?this._clientPromises[a]=l.then(c=>(this._clients[a]=new sx(c,r,()=>this._ongoingJobsQueue.pop()??null),o(i),this._clients[a]),()=>(o(n),null)):(this._clients[a]=new sx(l,r,()=>this._ongoingJobsQueue.pop()??null),this._clientPromises[a]=Promise.resolve(this._clients[a]),o(i))}})}broadcast(e,r,i){const n=new Array(this._clientPromises.length);for(let s=0;s<this._clientPromises.length;++s){const o=this._clientPromises[s];n[s]=o.then(a=>a==null?void 0:a.invoke(e,r,i))}return n}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(Wr(`Worker closing, aborting job calling '${e.methodName}'`));for(const r of this._clientPromises)r.then(i=>i==null?void 0:i.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0}invoke(e,r,i){let n;Array.isArray(i)?(re.getLogger("esri.core.workers.Connection").warn("invoke()","The transferList parameter is deprecated, use the options object instead"),n={transferList:i}):n=i;const s=Da();this._ongoingJobsQueue.push({methodName:e,data:r,invokeOptions:n,resolver:s});for(let o=0;o<this._clientPromises.length;o++){const a=this._clients[o];a?a.jobAdded():this._clientPromises[o].then(l=>l==null?void 0:l.jobAdded())}return s.promise}on(e,r){return Promise.all(this._clientPromises).then(()=>E_(this._clients.map(i=>i.on(e,r))))}openPorts(){return new Promise(e=>{const r=new Array(this._clientPromises.length);let i=r.length;for(let n=0;n<this._clientPromises.length;++n)this._clientPromises[n].then(s=>{s&&(r[n]=s.openPort()),--i==0&&e(r)})})}get test(){return{numClients:this._clients.length}}};const tke=re.getLogger("esri.intl.substitute");function hTt(t,e,r={}){const{format:i={}}=r;return d7(t,n=>pTt(n,e,i))}function pTt(t,e,r){let i,n;const s=t.indexOf(":");if(s===-1?i=t.trim():(i=t.slice(0,s).trim(),n=t.slice(s+1).trim()),!i)return"";const o=N4(i,e);if(o==null)return"";const a=(n?r==null?void 0:r[n]:null)??(r==null?void 0:r[i]);return a?fTt(o,a):n?mTt(o,n):Rde(o)}function fTt(t,e){switch(e.type){case"date":return tx(t,e.intlOptions);case"number":return PP(t,e.intlOptions);default:return tke.warn("missing format descriptor for key {key}"),Rde(t)}}function mTt(t,e){switch(e.toLowerCase()){case"dateformat":return tx(t);case"numberformat":return PP(t);default:return tke.warn(`inline format is unsupported since 4.12: ${e}`),/^(dateformat|datestring)/i.test(e)?tx(t):/^numberformat/i.test(e)?PP(t):Rde(t)}}function Rde(t){switch(typeof t){case"string":return t;case"number":return PP(t);case"boolean":return""+t;default:return t instanceof Date?tx(t):""}}async function gTt(t,e,r,i){const n=e.exec(r);if(!n)throw new H("esri-intl:invalid-bundle",`Bundle id "${r}" is not compatible with the pattern "${e}"`);const s=n[1]?`${n[1]}/`:"",o=n[2],a=sft(i),l=`${s}${o}.json`,c=a?`${s}${o}_${a}.json`:l;let u;try{u=await t1e(t(c))}catch(h){if(c===l)throw new H("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:h});try{u=await t1e(t(l))}catch(f){throw new H("intl:unknown-bundle",`Bundle "${r}" cannot be loaded`,{error:f})}}return u}async function t1e(t){if(r1e.fetchBundleAsset!=null)return r1e.fetchBundleAsset(t);const e=await ti(t,{responseType:"text"});return JSON.parse(e.data)}let yTt=class{constructor({base:e="",pattern:r,location:i=new URL(window.location.href)}){let n;n=typeof i=="string"?s=>new URL(s,new URL(i,window.location.href)).href:i instanceof URL?s=>new URL(s,i).href:i,this.pattern=typeof r=="string"?new RegExp(`^${r}`):r,this.getAssetUrl=n,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,r){return gTt(this.getAssetUrl,this.matcher,e,r)}};function vTt(t){return new yTt(t)}const r1e={};nft(vTt({pattern:"esri/",location:fi}));const _Tt={};function bTt(t){const e={async:t.async,isDebug:t.isDebug,locale:t.locale,baseUrl:t.baseUrl,has:{...t.has},map:{...t.map},packages:t.packages&&t.packages.concat()||[],paths:{...t.paths}};return t.hasOwnProperty("async")||(e.async=!0),t.hasOwnProperty("isDebug")||(e.isDebug=!1),t.baseUrl||(e.baseUrl=_Tt.baseUrl),e}let wTt=class{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(r=>{this[r]=(...i)=>e[r](...i)})}},lz=class{constructor(){this._dispatcher=new wTt,this._workerPostMessage({type:Qa.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){dP(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,r,i){this._dispatcher.addEventListener(e,r,i)}removeEventListener(e,r,i){this._dispatcher.removeEventListener(e,r,i)}_workerPostMessage(e){dP(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(e){const r=kN(e);if(r&&r.type===Qa.OPEN){const{modulePath:i,jobId:n}=r;let s=await sx.loadWorker(i);s||(s=await le(()=>import(i),[]));const o=sx.connect(s);this._workerPostMessage({type:Qa.OPENED,jobId:n,data:o})}}};const gre=re.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:xTt}=Qa,STt='let globalId=0;const outgoing=new Map,configuration=JSON.parse("{CONFIGURATION}");self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;return new Promise(((r,s)=>{if(t){if(t.aborted)return s(createAbortError());t.addEventListener("abort",(()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:ABORT,jobId:n}),s(createAbortError()))}))}outgoing.set(n,{resolve:r,reject:s}),self.postMessage({type:INVOKE,jobId:n,methodName:e,abortable:null!=t,data:o})}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\\nModules version: ${r}\\nAssets version: ${n??s}\\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case OPEN:let n;function t(e){const o=n.connect(e);self.postMessage({type:OPENED,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case RESPONSE:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});';let fk,mk;const i1e="Failed to create Worker. Fallback to execute module in main thread";async function TTt(){if(!he("esri-workers")||(he("mozilla"),0))return n1e(new lz);if(!fk&&!mk)try{const e=STt.split('"{CONFIGURATION}"').join(`'${ETt()}'`);fk=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){mk=e||{}}let t;if(fk)try{t=new Worker(fk,{name:"esri-worker-"+CTt++})}catch{gre.warn(i1e,mk),t=new lz}else gre.warn(i1e,mk),t=new lz;return n1e(t)}async function n1e(t){return new Promise(e=>{function r(n){const s=kN(n);s&&s.type===xTt&&(t.removeEventListener("message",r),t.removeEventListener("error",i),e(t))}function i(n){n.preventDefault(),t.removeEventListener("message",r),t.removeEventListener("error",i),gre.warn("Failed to create Worker. Fallback to execute module in main thread",n),(t=new lz).addEventListener("message",r),t.addEventListener("error",i)}t.addEventListener("message",r),t.addEventListener("error",i)})}function ETt(){let t;if(Ti.default!=null){const n={...Ti};delete n.default,t=JSON.parse(JSON.stringify(n))}else t=JSON.parse(JSON.stringify(Ti));t.assetsPath=ah(t.assetsPath),t.defaultAssetsPath=t.defaultAssetsPath?ah(t.defaultAssetsPath):void 0,t.request.interceptors=[],t.log.interceptors=[],t.locale=Ym(),t.has={"esri-csp-restrictions":he("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":he("esri-2d-update-debug"),"esri-2d-log-updating":he("esri-2d-log-updating"),"featurelayer-pbf":he("featurelayer-pbf"),"featurelayer-simplify-thresholds":he("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":he("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":he("featurelayer-simplify-mobile-factor"),"esri-atomics":he("esri-atomics"),"esri-shared-array-buffer":he("esri-shared-array-buffer"),"esri-tiles-debug":he("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":he("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":he("feature-polyline-generalization-factor"),"host-webworker":1,"polylabel-placement-enabled":he("polylabel-placement-enabled")},t.workers.loaderUrl&&(t.workers.loaderUrl=ah(t.workers.loaderUrl)),t.workers.workerPath?t.workers.workerPath=ah(t.workers.workerPath):t.workers.workerPath=ah(fi("esri/core/workers/RemoteClient.js")),t.workers.useDynamicImport=!1;const e=Ti.workers.loaderConfig,r=bTt({baseUrl:e==null?void 0:e.baseUrl,locale:Ym(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...e==null?void 0:e.has},map:{...e==null?void 0:e.map},paths:{...e==null?void 0:e.paths},packages:(e==null?void 0:e.packages)||[]});return JSON.stringify({esriConfig:t,loaderConfig:r,kernelInfo:{buildDate:T$e,fullVersion:nce,revision:E$e}})}let CTt=0;const{ABORT:s1e,INVOKE:RTt,OPEN:OTt,OPENED:ATt,RESPONSE:GM}=Qa;let PTt=class rke{static async create(e){const r=await TTt();return new rke(r,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",i=>{i.preventDefault(),re.getLogger("esri.core.workers.WorkerOwner").error(i)})}terminate(){this.worker.terminate()}async open(e,r={}){const{signal:i}=r,n=eke();return new Promise((s,o)=>{const a={resolve:s,reject:o,abortHandle:g7(i,()=>{this._outJobs.delete(n),this._post({type:s1e,jobId:n})})};this._outJobs.set(n,a),this._post({type:OTt,jobId:n,modulePath:e})})}_onMessage(e){const r=kN(e);if(r)switch(r.type){case ATt:this._onOpenedMessage(r);break;case GM:this._onResponseMessage(r);break;case s1e:this._onAbortMessage(r);break;case RTt:this._onInvokeMessage(r)}}_onAbortMessage(e){const r=this._inJobs,i=e.jobId,n=r.get(i);n&&(n.controller&&n.controller.abort(),r.delete(i))}_onInvokeMessage(e){const{methodName:r,jobId:i,data:n,abortable:s}=e,o=s?new AbortController:null,a=this._inJobs,l=Lut[r];let c;try{if(typeof l!="function")throw new TypeError(`${r} is not a function`);c=l.call(null,n,{signal:o?o.signal:null})}catch(u){return void this._post({type:GM,jobId:i,error:FN(u)})}Dh(c)?(a.set(i,{controller:o,promise:c}),c.then(u=>{a.has(i)&&(a.delete(i),this._post({type:GM,jobId:i},u))},u=>{a.has(i)&&(a.delete(i),u||(u={message:"Error encountered at method"+r}),Yn(u)||this._post({type:GM,jobId:i,error:FN(u||{message:`Error encountered at method ${r}`})}))})):this._post({type:GM,jobId:i},c)}_onOpenedMessage(e){const{jobId:r,data:i}=e,n=this._outJobs.get(r);n&&(this._outJobs.delete(r),yi(n.abortHandle),n.resolve(i))}_onResponseMessage(e){const{jobId:r,error:i,data:n}=e,s=this._outJobs.get(r);s&&(this._outJobs.delete(r),yi(s.abortHandle),i?s.reject(H.fromJSON(JSON.parse(i))):s.resolve(n))}_post(e,r,i){return Cde(this.worker,e,r,i)}};const o1e=he("host-browser")?Math.min(navigator.hardwareConcurrency-1,he("workers-pool-size")):0;let a2=he("esri-mobile")?Math.min(o1e,3):o1e;a2||(a2=he("safari")&&he("mac")?7:2);let a1e=0;const cz=[];function MTt(){ike()}async function gk(t,e){const r=new dTt;return await r.open(t,e),r}async function Ode(t,e={}){if(typeof t!="string")throw new H("workers:undefined-module","modulePath is missing");let r=e.strategy||"distributed";if(he("host-webworker")&&!he("esri-workers")&&(r="local"),r==="local"){let i=await sx.loadWorker(t);i||(i=await le(()=>import(t),[])),vr(e.signal);const n=e.client||i;return gk([sx.connect(i)],{...e,client:n})}if(await ike(),vr(e.signal),r==="dedicated"){const i=a1e++%a2;return gk([await cz[i].open(t,e)],e)}if(e.maxNumWorkers&&e.maxNumWorkers>0){const i=Math.min(e.maxNumWorkers,a2);if(i<a2){const n=new Array(i);for(let s=0;s<i;++s){const o=a1e++%a2;n[s]=cz[o].open(t,e)}return gk(n,e)}}return gk(cz.map(i=>i.open(t,e)),e)}let yk=null;async function ike(){if(yk)return yk;new AbortController;const t=[];for(let e=0;e<a2;e++){const r=PTt.create(e).then(i=>(cz[e]=i,i));t.push(r)}return yk=Promise.all(t),yk}let Yy=class extends Ce{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._handles=new Ri,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll(),this._handles.destroy()}add(e,r,i={}){return this._installWatch(e,r,i,pe)}addWhen(e,r,i={}){return this._installWatch(e,r,i,du)}addOnCollectionChange(e,r,{initial:i=!1,final:n=!1}={}){const s=++this._handleId;return this._handles.add([da(e,"after-changes",this._createSyncUpdatingCallback(),li),da(e,"change",r,{onListenerAdd:i?o=>r({added:o.toArray(),removed:[]}):void 0,onListenerRemove:n?o=>r({added:[],removed:o.toArray()}):void 0})],s),kl(()=>this._handles.remove(s))}addPromise(e){if(e==null)return e;const r=++this._handleId;this._handles.add({remove:()=>{this._pendingPromises.delete(e)&&(this._pendingPromises.size!==0||this._handles.has(vk)||this._set("updating",!1))}},r),this._pendingPromises.add(e),this._set("updating",!0);const i=()=>this._handles.remove(r);return e.then(i,i),e}removeAll(){this._pendingPromises.clear(),this._handles.removeAll(),this._set("updating",!1)}_installWatch(e,r,i={},n){const s=++this._handleId;i.sync||this._installSyncUpdatingWatch(e,s);const o=n(e,r,i);return this._handles.add(o,s),kl(()=>this._handles.remove(s))}_installSyncUpdatingWatch(e,r){const i=this._createSyncUpdatingCallback(),n=pe(e,i,{sync:!0,equals:()=>!1});return this._handles.add(n,r),n}_createSyncUpdatingCallback(){return()=>{this._handles.remove(vk),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this._handles.add(T3(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this._handles.remove(vk))}),vk)}}};d([p({readOnly:!0})],Yy.prototype,"updating",void 0),Yy=d([I("esri.core.support.WatchUpdatingTracking")],Yy);const vk=-42,jE=t=>{let e=class extends t{constructor(){super(...arguments),this._handles=new Ri,this._updatingHandles=new Yy}destroy(){this.destroyed||(this._handles.destroy(),this._updatingHandles.destroy())}get handles(){return this._handles}get updatingHandles(){return this._updatingHandles}};return d([p({readOnly:!0})],e.prototype,"handles",null),d([p({readOnly:!0})],e.prototype,"updatingHandles",null),e=d([I("esri.core.HandleOwner")],e),e};let aE=class extends jE(Ce){};aE=d([I("esri.core.HandleOwner")],aE);let hD=class extends jE(vt){constructor(e){super(e),this.handles.add([this.on("before-add",r=>{r.item==null&&r.preventDefault()}),this.on("after-add",r=>this._own(r.item)),this.on("after-remove",r=>this._release(r.item))])}get owner(){return this._get("owner")}set owner(e){e!==this._get("owner")&&(this._releaseAll(),this._set("owner",e),this._ownAll())}_ownAll(){for(const e of this.items)this._own(e)}_releaseAll(){for(const e of this.items)this._release(e)}_createNewInstance(e){return this.itemType?new(vt.ofType(this.itemType.Type))(e):new vt(e)}};function wB(t,e){return{type:t,cast:mce,set(r){const i=R_(r,this._get(e),t);i.owner=this,this._set(e,i)}}}d([p()],hD.prototype,"owner",null),hD=d([I("esri.core.support.OwningCollection")],hD);const $Tt=new dt(EIe),l1e=new dt(Tce),c1e=new dt(Ece),smr=new dt(CIe);function d0(t){return t&&(w0(t)||So(t,l1e))?l1e:t&&(x0(t)||So(t,c1e))?c1e:$Tt}function ITt(t){const{value:e,operations:r}=t;return{operations:r,value:r.create(e)}}function LTt(t,e,r){return t.operations.setExtent(t.value,e,r.value),r}function DTt(t){return{operations:t,value:t.create()}}function nke(t,e,r=DTt(t)){return r.operations=t,t.copy(e,r.value),r}function NTt(t){return nke(xwt,BFe(0,0,0,Xr(t).radius))}const u1e=2**50;function FTt(){return nke(oxt,ade([0,0,0],[u1e,0,0],[0,u1e,0]))}function kTt(t,e,r){return t.operations.axisAt(t.value,e,od.Z,r)}function UTt(t,e,r,i){return t.operations.axisAt(t.value,e,r,i)}function zTt(t,e,r){return t.operations.intersectRay(t.value,e,r)}function VTt(t,e,r){return t.operations.intersectRayClosestSilhouette(t.value,e,r)}function BTt(t,e){return t.operations.altitudeAt(t.value,e)}function ske(t,e,r,i){return t.operations.setAltitudeAt(t.value,e,r,i)}function jTt(t,e,r,i){return e!==i&&Rs(i,e),se(fC,i[12],i[13],i[14]),ske(t,fC,r,fC),i[12]=fC[0],i[13]=fC[1],i[14]=fC[2],i}function AX(t,e,r){return t.operations.elevate(t.value,e,r.value)}const fC=A();function d1e(t,e,r,i,n){return n[0]=ye(t,e),n[1]=ye(t,r),n[2]=ye(t,i),n}function yre(t,e,r,i,n){oe(r,t),oe(_k,e),Se(_k,_k),Lt(i,_k,r),Lt(n,i,r)}function GTt(t,e){return t?d0(e):e.isGeographic?dt.PlateCarree:e}const _k=A(),HTt="OBJECTID";let kP=class extends hD{constructor(e){super(e),this.handles.add(this.on("before-add",r=>{r.item!=null&&r.item.parent===this.owner&&(re.getLogger(this).warn("Analysis inside the collection must be unique. Not adding this element again."),r.preventDefault())}))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};kP=d([I("esri.support.AnalysesCollection")],kP);const uz={widthBreakpoint:{getValue(t){const e=t.viewSize[0],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(t){const e=t.viewSize[1],r=t.breakpoints,i=this.values;return e<=r.xsmall?i.xsmall:e<=r.small?i.small:e<=r.medium?i.medium:e<=r.large?i.large:i.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(t){const e=t.viewSize,r=e[0],i=e[1],n=this.values;return i>=r?n.portrait:n.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},PX={xsmall:544,small:768,medium:992,large:1200};function qTt(t){const e=t;return e&&e.xsmall<e.small&&e.small<e.medium&&e.medium<e.large}function MX(t,e){return e?uz[t].valueToClassName[e].split(" "):[]}const WTt=t=>{let e=class extends t{constructor(...r){super(...r),this._breakpointsHandles=new Ri,this.orientation=null,this.widthBreakpoint=null,this.heightBreakpoint=null,this.breakpoints=PX}initialize(){this._breakpointsHandles.add(pe(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),_r))}destroy(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=qe(this._breakpointsHandles))}set breakpoints(r){if(r===this._get("breakpoints"))return;const i=qTt(r);if(!i){const n=JSON.stringify(PX,null,2);console.warn("provided breakpoints are not valid, using defaults:"+n)}r=i?r:PX,this._set("breakpoints",{...r})}_updateClassNames(){if(!this.container)return;const r=Ku.acquire(),i=Ku.acquire();let n,s=!1;for(n in uz){const o=this[n],a=uz[n].getValue({viewSize:this.size,breakpoints:this.breakpoints});o!==a&&(s=!0,this[n]=a,MX(n,o).forEach(l=>i.push(l)),MX(n,a).forEach(l=>r.push(l)))}s&&(this._applyClassNameChanges(r,i),Ku.release(r),Ku.release(i))}_applyClassNameChanges(r,i){const n=this.container;n&&(i.forEach(s=>n.classList.remove(s)),r.forEach(s=>n.classList.add(s)))}_removeActiveClassNames(){const r=this.container;if(!r)return;let i;for(i in uz)MX(i,this[i]).forEach(n=>r.classList.remove(n))}};return d([p()],e.prototype,"breakpoints",null),d([p()],e.prototype,"orientation",void 0),d([p()],e.prototype,"widthBreakpoint",void 0),d([p()],e.prototype,"heightBreakpoint",void 0),e=d([I("esri.views.BreakpointsOwner")],e),e};/*!
 * @esri/arcgis-html-sanitizer - v3.0.1 - Tue Nov 15 2022 09:46:54 GMT-0800 (Pacific Standard Time)
 * Copyright (c) 2022 - Environmental Systems Research Institute, Inc.
 * Apache-2.0
 * 
 * js-xss
 * Copyright (c) 2012-2018 Zongmin Lei() <leizongmin@gmail.com>
 * http://ucdok.com
 * MIT License, see https://github.com/leizongmin/js-xss/blob/master/LICENSE for details
 */var XTt=function(t){if(typeof t!="object"||t===null||Object.prototype.toString.call(t)!=="[object Object]")return!1;var e=Object.getPrototypeOf(t);if(e===null)return!0;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},kT={exports:{}},Ks={},UN={exports:{}},GE={};function oke(){var t={};return t["align-content"]=!1,t["align-items"]=!1,t["align-self"]=!1,t["alignment-adjust"]=!1,t["alignment-baseline"]=!1,t.all=!1,t["anchor-point"]=!1,t.animation=!1,t["animation-delay"]=!1,t["animation-direction"]=!1,t["animation-duration"]=!1,t["animation-fill-mode"]=!1,t["animation-iteration-count"]=!1,t["animation-name"]=!1,t["animation-play-state"]=!1,t["animation-timing-function"]=!1,t.azimuth=!1,t["backface-visibility"]=!1,t.background=!0,t["background-attachment"]=!0,t["background-clip"]=!0,t["background-color"]=!0,t["background-image"]=!0,t["background-origin"]=!0,t["background-position"]=!0,t["background-repeat"]=!0,t["background-size"]=!0,t["baseline-shift"]=!1,t.binding=!1,t.bleed=!1,t["bookmark-label"]=!1,t["bookmark-level"]=!1,t["bookmark-state"]=!1,t.border=!0,t["border-bottom"]=!0,t["border-bottom-color"]=!0,t["border-bottom-left-radius"]=!0,t["border-bottom-right-radius"]=!0,t["border-bottom-style"]=!0,t["border-bottom-width"]=!0,t["border-collapse"]=!0,t["border-color"]=!0,t["border-image"]=!0,t["border-image-outset"]=!0,t["border-image-repeat"]=!0,t["border-image-slice"]=!0,t["border-image-source"]=!0,t["border-image-width"]=!0,t["border-left"]=!0,t["border-left-color"]=!0,t["border-left-style"]=!0,t["border-left-width"]=!0,t["border-radius"]=!0,t["border-right"]=!0,t["border-right-color"]=!0,t["border-right-style"]=!0,t["border-right-width"]=!0,t["border-spacing"]=!0,t["border-style"]=!0,t["border-top"]=!0,t["border-top-color"]=!0,t["border-top-left-radius"]=!0,t["border-top-right-radius"]=!0,t["border-top-style"]=!0,t["border-top-width"]=!0,t["border-width"]=!0,t.bottom=!1,t["box-decoration-break"]=!0,t["box-shadow"]=!0,t["box-sizing"]=!0,t["box-snap"]=!0,t["box-suppress"]=!0,t["break-after"]=!0,t["break-before"]=!0,t["break-inside"]=!0,t["caption-side"]=!1,t.chains=!1,t.clear=!0,t.clip=!1,t["clip-path"]=!1,t["clip-rule"]=!1,t.color=!0,t["color-interpolation-filters"]=!0,t["column-count"]=!1,t["column-fill"]=!1,t["column-gap"]=!1,t["column-rule"]=!1,t["column-rule-color"]=!1,t["column-rule-style"]=!1,t["column-rule-width"]=!1,t["column-span"]=!1,t["column-width"]=!1,t.columns=!1,t.contain=!1,t.content=!1,t["counter-increment"]=!1,t["counter-reset"]=!1,t["counter-set"]=!1,t.crop=!1,t.cue=!1,t["cue-after"]=!1,t["cue-before"]=!1,t.cursor=!1,t.direction=!1,t.display=!0,t["display-inside"]=!0,t["display-list"]=!0,t["display-outside"]=!0,t["dominant-baseline"]=!1,t.elevation=!1,t["empty-cells"]=!1,t.filter=!1,t.flex=!1,t["flex-basis"]=!1,t["flex-direction"]=!1,t["flex-flow"]=!1,t["flex-grow"]=!1,t["flex-shrink"]=!1,t["flex-wrap"]=!1,t.float=!1,t["float-offset"]=!1,t["flood-color"]=!1,t["flood-opacity"]=!1,t["flow-from"]=!1,t["flow-into"]=!1,t.font=!0,t["font-family"]=!0,t["font-feature-settings"]=!0,t["font-kerning"]=!0,t["font-language-override"]=!0,t["font-size"]=!0,t["font-size-adjust"]=!0,t["font-stretch"]=!0,t["font-style"]=!0,t["font-synthesis"]=!0,t["font-variant"]=!0,t["font-variant-alternates"]=!0,t["font-variant-caps"]=!0,t["font-variant-east-asian"]=!0,t["font-variant-ligatures"]=!0,t["font-variant-numeric"]=!0,t["font-variant-position"]=!0,t["font-weight"]=!0,t.grid=!1,t["grid-area"]=!1,t["grid-auto-columns"]=!1,t["grid-auto-flow"]=!1,t["grid-auto-rows"]=!1,t["grid-column"]=!1,t["grid-column-end"]=!1,t["grid-column-start"]=!1,t["grid-row"]=!1,t["grid-row-end"]=!1,t["grid-row-start"]=!1,t["grid-template"]=!1,t["grid-template-areas"]=!1,t["grid-template-columns"]=!1,t["grid-template-rows"]=!1,t["hanging-punctuation"]=!1,t.height=!0,t.hyphens=!1,t.icon=!1,t["image-orientation"]=!1,t["image-resolution"]=!1,t["ime-mode"]=!1,t["initial-letters"]=!1,t["inline-box-align"]=!1,t["justify-content"]=!1,t["justify-items"]=!1,t["justify-self"]=!1,t.left=!1,t["letter-spacing"]=!0,t["lighting-color"]=!0,t["line-box-contain"]=!1,t["line-break"]=!1,t["line-grid"]=!1,t["line-height"]=!1,t["line-snap"]=!1,t["line-stacking"]=!1,t["line-stacking-ruby"]=!1,t["line-stacking-shift"]=!1,t["line-stacking-strategy"]=!1,t["list-style"]=!0,t["list-style-image"]=!0,t["list-style-position"]=!0,t["list-style-type"]=!0,t.margin=!0,t["margin-bottom"]=!0,t["margin-left"]=!0,t["margin-right"]=!0,t["margin-top"]=!0,t["marker-offset"]=!1,t["marker-side"]=!1,t.marks=!1,t.mask=!1,t["mask-box"]=!1,t["mask-box-outset"]=!1,t["mask-box-repeat"]=!1,t["mask-box-slice"]=!1,t["mask-box-source"]=!1,t["mask-box-width"]=!1,t["mask-clip"]=!1,t["mask-image"]=!1,t["mask-origin"]=!1,t["mask-position"]=!1,t["mask-repeat"]=!1,t["mask-size"]=!1,t["mask-source-type"]=!1,t["mask-type"]=!1,t["max-height"]=!0,t["max-lines"]=!1,t["max-width"]=!0,t["min-height"]=!0,t["min-width"]=!0,t["move-to"]=!1,t["nav-down"]=!1,t["nav-index"]=!1,t["nav-left"]=!1,t["nav-right"]=!1,t["nav-up"]=!1,t["object-fit"]=!1,t["object-position"]=!1,t.opacity=!1,t.order=!1,t.orphans=!1,t.outline=!1,t["outline-color"]=!1,t["outline-offset"]=!1,t["outline-style"]=!1,t["outline-width"]=!1,t.overflow=!1,t["overflow-wrap"]=!1,t["overflow-x"]=!1,t["overflow-y"]=!1,t.padding=!0,t["padding-bottom"]=!0,t["padding-left"]=!0,t["padding-right"]=!0,t["padding-top"]=!0,t.page=!1,t["page-break-after"]=!1,t["page-break-before"]=!1,t["page-break-inside"]=!1,t["page-policy"]=!1,t.pause=!1,t["pause-after"]=!1,t["pause-before"]=!1,t.perspective=!1,t["perspective-origin"]=!1,t.pitch=!1,t["pitch-range"]=!1,t["play-during"]=!1,t.position=!1,t["presentation-level"]=!1,t.quotes=!1,t["region-fragment"]=!1,t.resize=!1,t.rest=!1,t["rest-after"]=!1,t["rest-before"]=!1,t.richness=!1,t.right=!1,t.rotation=!1,t["rotation-point"]=!1,t["ruby-align"]=!1,t["ruby-merge"]=!1,t["ruby-position"]=!1,t["shape-image-threshold"]=!1,t["shape-outside"]=!1,t["shape-margin"]=!1,t.size=!1,t.speak=!1,t["speak-as"]=!1,t["speak-header"]=!1,t["speak-numeral"]=!1,t["speak-punctuation"]=!1,t["speech-rate"]=!1,t.stress=!1,t["string-set"]=!1,t["tab-size"]=!1,t["table-layout"]=!1,t["text-align"]=!0,t["text-align-last"]=!0,t["text-combine-upright"]=!0,t["text-decoration"]=!0,t["text-decoration-color"]=!0,t["text-decoration-line"]=!0,t["text-decoration-skip"]=!0,t["text-decoration-style"]=!0,t["text-emphasis"]=!0,t["text-emphasis-color"]=!0,t["text-emphasis-position"]=!0,t["text-emphasis-style"]=!0,t["text-height"]=!0,t["text-indent"]=!0,t["text-justify"]=!0,t["text-orientation"]=!0,t["text-overflow"]=!0,t["text-shadow"]=!0,t["text-space-collapse"]=!0,t["text-transform"]=!0,t["text-underline-position"]=!0,t["text-wrap"]=!0,t.top=!1,t.transform=!1,t["transform-origin"]=!1,t["transform-style"]=!1,t.transition=!1,t["transition-delay"]=!1,t["transition-duration"]=!1,t["transition-property"]=!1,t["transition-timing-function"]=!1,t["unicode-bidi"]=!1,t["vertical-align"]=!1,t.visibility=!1,t["voice-balance"]=!1,t["voice-duration"]=!1,t["voice-family"]=!1,t["voice-pitch"]=!1,t["voice-range"]=!1,t["voice-rate"]=!1,t["voice-stress"]=!1,t["voice-volume"]=!1,t.volume=!1,t["white-space"]=!1,t.widows=!1,t.width=!0,t["will-change"]=!1,t["word-break"]=!0,t["word-spacing"]=!0,t["word-wrap"]=!0,t["wrap-flow"]=!1,t["wrap-through"]=!1,t["writing-mode"]=!1,t["z-index"]=!1,t}function YTt(t,e,r){}function ZTt(t,e,r){}var JTt=/javascript\s*\:/img;function KTt(t,e){return JTt.test(e)?"":e}GE.whiteList=oke();GE.getDefaultWhiteList=oke;GE.onAttr=YTt;GE.onIgnoreAttr=ZTt;GE.safeAttrValue=KTt;var QTt={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},trimRight:function(t){return String.prototype.trimRight?t.trimRight():t.replace(/(\s*$)/g,"")}},HM=QTt;function e2t(t,e){t=HM.trimRight(t),t[t.length-1]!==";"&&(t+=";");var r=t.length,i=!1,n=0,s=0,o="";function a(){if(!i){var u=HM.trim(t.slice(n,s)),h=u.indexOf(":");if(h!==-1){var f=HM.trim(u.slice(0,h)),m=HM.trim(u.slice(h+1));if(f){var g=e(n,o.length,f,m,u);g&&(o+=g+"; ")}}}n=s+1}for(;s<r;s++){var l=t[s];if(l==="/"&&t[s+1]==="*"){var c=t.indexOf("*/",s+2);if(c===-1)break;s=c+1,n=s+1,i=!1}else l==="("?i=!0:l===")"?i=!1:l===";"?i||a():l===`
`&&a()}return HM.trim(o)}var t2t=e2t,bk=GE,r2t=t2t;function h1e(t){return t==null}function i2t(t){var e={};for(var r in t)e[r]=t[r];return e}function ake(t){t=i2t(t||{}),t.whiteList=t.whiteList||bk.whiteList,t.onAttr=t.onAttr||bk.onAttr,t.onIgnoreAttr=t.onIgnoreAttr||bk.onIgnoreAttr,t.safeAttrValue=t.safeAttrValue||bk.safeAttrValue,this.options=t}ake.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onAttr,s=r.onIgnoreAttr,o=r.safeAttrValue,a=r2t(t,function(l,c,u,h,f){var m=i[u],g=!1;if(m===!0?g=m:typeof m=="function"?g=m(h):m instanceof RegExp&&(g=m.test(h)),g!==!0&&(g=!1),h=o(u,h),!!h){var y={position:c,sourcePosition:l,source:f,isWhite:g};if(g){var _=n(u,h,y);return h1e(_)?u+":"+h:_}else{var _=s(u,h,y);if(!h1e(_))return _}}});return a};var n2t=ake;(function(t,e){var r=GE,i=n2t;function n(o,a){var l=new i(a);return l.process(o)}e=t.exports=n,e.FilterCSS=i;for(var s in r)e[s]=r[s]})(UN,UN.exports);var Ade={indexOf:function(t,e){var r,i;if(Array.prototype.indexOf)return t.indexOf(e);for(r=0,i=t.length;r<i;r++)if(t[r]===e)return r;return-1},forEach:function(t,e,r){var i,n;if(Array.prototype.forEach)return t.forEach(e,r);for(i=0,n=t.length;i<n;i++)e.call(r,t[i],i,t)},trim:function(t){return String.prototype.trim?t.trim():t.replace(/(^\s*)|(\s*$)/g,"")},spaceIndex:function(t){var e=/\s|\n|\t/,r=e.exec(t);return r?r.index:-1}},s2t=UN.exports.FilterCSS,o2t=UN.exports.getDefaultWhiteList,xB=Ade;function lke(){return{a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}}var cke=new s2t;function a2t(t,e,r){}function l2t(t,e,r){}function c2t(t,e,r){}function u2t(t,e,r){}function uke(t){return t.replace(h2t,"&lt;").replace(p2t,"&gt;")}function d2t(t,e,r,i){if(r=gke(r),e==="href"||e==="src"){if(r=xB.trim(r),r==="#")return"#";if(!(r.substr(0,7)==="http://"||r.substr(0,8)==="https://"||r.substr(0,7)==="mailto:"||r.substr(0,4)==="tel:"||r.substr(0,11)==="data:image/"||r.substr(0,6)==="ftp://"||r.substr(0,2)==="./"||r.substr(0,3)==="../"||r[0]==="#"||r[0]==="/"))return""}else if(e==="background"){if(wk.lastIndex=0,wk.test(r))return""}else if(e==="style"){if(p1e.lastIndex=0,p1e.test(r)||(f1e.lastIndex=0,f1e.test(r)&&(wk.lastIndex=0,wk.test(r))))return"";i!==!1&&(i=i||cke,r=i.process(r))}return r=yke(r),r}var h2t=/</g,p2t=/>/g,f2t=/"/g,m2t=/&quot;/g,g2t=/&#([a-zA-Z0-9]*);?/gim,y2t=/&colon;?/gim,v2t=/&newline;?/gim,wk=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,p1e=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,f1e=/u\s*r\s*l\s*\(.*/gi;function dke(t){return t.replace(f2t,"&quot;")}function hke(t){return t.replace(m2t,'"')}function pke(t){return t.replace(g2t,function(r,i){return i[0]==="x"||i[0]==="X"?String.fromCharCode(parseInt(i.substr(1),16)):String.fromCharCode(parseInt(i,10))})}function fke(t){return t.replace(y2t,":").replace(v2t," ")}function mke(t){for(var e="",r=0,i=t.length;r<i;r++)e+=t.charCodeAt(r)<32?" ":t.charAt(r);return xB.trim(e)}function gke(t){return t=hke(t),t=pke(t),t=fke(t),t=mke(t),t}function yke(t){return t=dke(t),t=uke(t),t}function _2t(){return""}function b2t(t,e){typeof e!="function"&&(e=function(){});var r=!Array.isArray(t);function i(o){return r?!0:xB.indexOf(t,o)!==-1}var n=[],s=!1;return{onIgnoreTag:function(o,a,l){if(i(o))if(l.isClosing){var c="[/removed]",u=l.position+c.length;return n.push([s!==!1?s:l.position,u]),s=!1,c}else return s||(s=l.position),"[removed]";else return e(o,a,l)},remove:function(o){var a="",l=0;return xB.forEach(n,function(c){a+=o.slice(l,c[0]),l=c[1]}),a+=o.slice(l),a}}}function w2t(t){for(var e="",r=0;r<t.length;){var i=t.indexOf("<!--",r);if(i===-1){e+=t.slice(r);break}e+=t.slice(r,i);var n=t.indexOf("-->",i);if(n===-1)break;r=n+3}return e}function x2t(t){var e=t.split("");return e=e.filter(function(r){var i=r.charCodeAt(0);return i===127?!1:i<=31?i===10||i===13:!0}),e.join("")}Ks.whiteList=lke();Ks.getDefaultWhiteList=lke;Ks.onTag=a2t;Ks.onIgnoreTag=l2t;Ks.onTagAttr=c2t;Ks.onIgnoreTagAttr=u2t;Ks.safeAttrValue=d2t;Ks.escapeHtml=uke;Ks.escapeQuote=dke;Ks.unescapeQuote=hke;Ks.escapeHtmlEntities=pke;Ks.escapeDangerHtml5Entities=fke;Ks.clearNonPrintableCharacter=mke;Ks.friendlyAttrValue=gke;Ks.escapeAttrValue=yke;Ks.onIgnoreTagStripAll=_2t;Ks.StripTagBody=b2t;Ks.stripCommentTag=w2t;Ks.stripBlankChar=x2t;Ks.cssFilter=cke;Ks.getDefaultCSSWhiteList=o2t;var fH={},zb=Ade;function S2t(t){var e=zb.spaceIndex(t),r;return e===-1?r=t.slice(1,-1):r=t.slice(1,e+1),r=zb.trim(r).toLowerCase(),r.slice(0,1)==="/"&&(r=r.slice(1)),r.slice(-1)==="/"&&(r=r.slice(0,-1)),r}function T2t(t){return t.slice(0,2)==="</"}function E2t(t,e,r){var i="",n=0,s=!1,o=!1,a=0,l=t.length,c="",u="";e:for(a=0;a<l;a++){var h=t.charAt(a);if(s===!1){if(h==="<"){s=a;continue}}else if(o===!1){if(h==="<"){i+=r(t.slice(n,a)),s=a,n=a;continue}if(h===">"){i+=r(t.slice(n,s)),u=t.slice(s,a+1),c=S2t(u),i+=e(s,i.length,c,u,T2t(u)),n=a+1,s=!1;continue}if(h==='"'||h==="'")for(var f=1,m=t.charAt(a-f);m.trim()===""||m==="=";){if(m==="="){o=h;continue e}m=t.charAt(a-++f)}}else if(h===o){o=!1;continue}}return n<t.length&&(i+=r(t.substr(n))),i}var C2t=/[^a-zA-Z0-9\\_:.-]/gim;function R2t(t,e){var r=0,i=0,n=[],s=!1,o=t.length;function a(f,m){if(f=zb.trim(f),f=f.replace(C2t,"").toLowerCase(),!(f.length<1)){var g=e(f,m||"");g&&n.push(g)}}for(var l=0;l<o;l++){var c=t.charAt(l),u,h;if(s===!1&&c==="="){s=t.slice(r,l),r=l+1,i=t.charAt(r)==='"'||t.charAt(r)==="'"?r:A2t(t,l+1);continue}if(s!==!1&&l===i){if(h=t.indexOf(c,l+1),h===-1)break;u=zb.trim(t.slice(i+1,h)),a(s,u),s=!1,l=h,r=l+1;continue}if(/\s|\n|\t/.test(c))if(t=t.replace(/\s|\n|\t/g," "),s===!1)if(h=O2t(t,l),h===-1){u=zb.trim(t.slice(r,l)),a(u),s=!1,r=l+1;continue}else{l=h-1;continue}else if(h=P2t(t,l-1),h===-1){u=zb.trim(t.slice(r,l)),u=m1e(u),a(s,u),s=!1,r=l+1;continue}else continue}return r<t.length&&(s===!1?a(t.slice(r)):a(s,m1e(zb.trim(t.slice(r))))),zb.trim(n.join(" "))}function O2t(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="="?e:-1}}function A2t(t,e){for(;e<t.length;e++){var r=t[e];if(r!==" ")return r==="'"||r==='"'?e:-1}}function P2t(t,e){for(;e>0;e--){var r=t[e];if(r!==" ")return r==="="?e:-1}}function M2t(t){return t[0]==='"'&&t[t.length-1]==='"'||t[0]==="'"&&t[t.length-1]==="'"}function m1e(t){return M2t(t)?t.substr(1,t.length-2):t}fH.parseTag=E2t;fH.parseAttr=R2t;var $2t=UN.exports.FilterCSS,vm=Ks,vke=fH,I2t=vke.parseTag,L2t=vke.parseAttr,dz=Ade;function xk(t){return t==null}function D2t(t){var e=dz.spaceIndex(t);if(e===-1)return{html:"",closing:t[t.length-2]==="/"};t=dz.trim(t.slice(e+1,-1));var r=t[t.length-1]==="/";return r&&(t=dz.trim(t.slice(0,-1))),{html:t,closing:r}}function N2t(t){var e={};for(var r in t)e[r]=t[r];return e}function F2t(t){var e={};for(var r in t)Array.isArray(t[r])?e[r.toLowerCase()]=t[r].map(function(i){return i.toLowerCase()}):e[r.toLowerCase()]=t[r];return e}function _ke(t){t=N2t(t||{}),t.stripIgnoreTag&&(t.onIgnoreTag&&console.error('Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'),t.onIgnoreTag=vm.onIgnoreTagStripAll),t.whiteList||t.allowList?t.whiteList=F2t(t.whiteList||t.allowList):t.whiteList=vm.whiteList,t.onTag=t.onTag||vm.onTag,t.onTagAttr=t.onTagAttr||vm.onTagAttr,t.onIgnoreTag=t.onIgnoreTag||vm.onIgnoreTag,t.onIgnoreTagAttr=t.onIgnoreTagAttr||vm.onIgnoreTagAttr,t.safeAttrValue=t.safeAttrValue||vm.safeAttrValue,t.escapeHtml=t.escapeHtml||vm.escapeHtml,this.options=t,t.css===!1?this.cssFilter=!1:(t.css=t.css||{},this.cssFilter=new $2t(t.css))}_ke.prototype.process=function(t){if(t=t||"",t=t.toString(),!t)return"";var e=this,r=e.options,i=r.whiteList,n=r.onTag,s=r.onIgnoreTag,o=r.onTagAttr,a=r.onIgnoreTagAttr,l=r.safeAttrValue,c=r.escapeHtml,u=e.cssFilter;r.stripBlankChar&&(t=vm.stripBlankChar(t)),r.allowCommentTag||(t=vm.stripCommentTag(t));var h=!1;r.stripIgnoreTagBody&&(h=vm.StripTagBody(r.stripIgnoreTagBody,s),s=h.onIgnoreTag);var f=I2t(t,function(m,g,y,_,b){var w={sourcePosition:m,position:g,isClosing:b,isWhite:Object.prototype.hasOwnProperty.call(i,y)},x=n(y,_,w);if(!xk(x))return x;if(w.isWhite){if(w.isClosing)return"</"+y+">";var S=D2t(_),C=i[y],E=L2t(S.html,function(R,P){var D=dz.indexOf(C,R)!==-1,L=o(y,R,P,D);return xk(L)?D?(P=l(y,R,P,u),P?R+'="'+P+'"':R):(L=a(y,R,P,D),xk(L)?void 0:L):L});return _="<"+y,E&&(_+=" "+E),S.closing&&(_+=" /"),_+=">",_}else return x=s(y,_,w),xk(x)?c(_):x},c);return h&&(f=h.remove(f)),f};var k2t=_ke;(function(t,e){var r=Ks,i=fH,n=k2t;function s(a,l){var c=new n(l);return c.process(a)}e=t.exports=s,e.filterXSS=s,e.FilterXSS=n,function(){for(var a in r)e[a]=r[a];for(var l in i)e[l]=i[l]}();function o(){return typeof self<"u"&&typeof DedicatedWorkerGlobalScope<"u"&&self instanceof DedicatedWorkerGlobalScope}o()&&(self.filterXSS=t.exports)})(kT,kT.exports);var U2t=function(){function t(e,r){var i=this;this.arcgisWhiteList={a:["href","style","target"],abbr:["title"],audio:["autoplay","controls","loop","muted","preload"],b:[],br:[],dd:["style"],div:["align","style"],dl:["style"],dt:["style"],em:[],figcaption:["style"],figure:["style"],font:["color","face","size","style"],h1:["style"],h2:["style"],h3:["style"],h4:["style"],h5:["style"],h6:["style"],hr:[],i:[],img:["alt","border","height","src","style","width"],li:[],ol:[],p:["style"],source:["media","src","type"],span:["style"],strong:[],sub:["style"],sup:["style"],table:["border","cellpadding","cellspacing","height","style","width"],tbody:[],tr:["align","height","style","valign"],td:["align","colspan","height","nowrap","rowspan","style","valign","width"],th:["align","colspan","height","nowrap","rowspan","style","valign","width"],u:[],ul:[],video:["autoplay","controls","height","loop","muted","poster","preload","width"]},this.allowedProtocols=["http","https","mailto","iform","tel","flow","lfmobile","arcgis-navigator","arcgis-appstudio-player","arcgis-survey123","arcgis-collector","arcgis-workforce","arcgis-explorer","arcgis-trek2there","arcgis-quickcapture","mspbi","comgooglemaps","pdfefile","pdfehttp","pdfehttps","boxapp","boxemm","awb","awbs","gropen","radarscope"],this.arcgisFilterOptions={allowCommentTag:!0,safeAttrValue:function(s,o,a,l){return s==="a"&&o==="href"||(s==="img"||s==="source")&&o==="src"?i.sanitizeUrl(a):kT.exports.safeAttrValue(s,o,a,l)}},this._entityMap={"&":"&#x38;","<":"&#x3C;",">":"&#x3E;",'"':"&#x22;","'":"&#x27;","/":"&#x2F;"};var n;e&&!r?n=e:e&&r?(n=Object.create(this.arcgisFilterOptions),Object.keys(e).forEach(function(s){s==="whiteList"?n.whiteList=i._extendObjectOfArrays([i.arcgisWhiteList,e.whiteList||{}]):n[s]=e[s]})):(n=Object.create(this.arcgisFilterOptions),n.whiteList=this.arcgisWhiteList),this.xssFilterOptions=n,this._xssFilter=new kT.exports.FilterXSS(n)}return t.prototype.sanitize=function(e,r){switch(r===void 0&&(r={}),typeof e){case"number":return isNaN(e)||!isFinite(e)?null:e;case"boolean":return e;case"string":return this._xssFilter.process(e);case"object":return this._iterateOverObject(e,r);default:return r.allowUndefined&&typeof e>"u"?void 0:null}},t.prototype.sanitizeUrl=function(e,r){var i=(r??{}).isProtocolRequired,n=i===void 0?!0:i,s=this._trim(e.substring(0,e.indexOf(":"))),o=e==="/",a=/^#/.test(e),l=s&&this.allowedProtocols.indexOf(s.toLowerCase())>-1;return o||a||l?kT.exports.escapeAttrValue(e):!s&&!n?kT.exports.escapeAttrValue("https://".concat(e)):""},t.prototype.sanitizeHTMLAttribute=function(e,r,i,n){return typeof this.xssFilterOptions.safeAttrValue=="function"?this.xssFilterOptions.safeAttrValue(e,r,i,n):kT.exports.safeAttrValue(e,r,i,n)},t.prototype.validate=function(e,r){r===void 0&&(r={});var i=this.sanitize(e,r);return{isValid:e===i,sanitized:i}},t.prototype.encodeHTML=function(e){var r=this;return String(e).replace(/[&<>"'\/]/g,function(i){return r._entityMap[i]})},t.prototype.encodeAttrValue=function(e){var r=/^[a-zA-Z0-9]$/;return String(e).replace(/[\x00-\xFF]/g,function(i,n){return r.test(i)?i:"&#x".concat(Number(e.charCodeAt(n)).toString(16),";")})},t.prototype._extendObjectOfArrays=function(e){var r={};return e.forEach(function(i){Object.keys(i).forEach(function(n){Array.isArray(i[n])&&Array.isArray(r[n])?r[n]=r[n].concat(i[n]):r[n]=i[n]})}),r},t.prototype._iterateOverObject=function(e,r){var i=this;r===void 0&&(r={});try{var n=!1,s=void 0;if(Array.isArray(e))s=e.reduce(function(a,l){var c=i.validate(l,r);return c.isValid?a.concat([l]):(n=!0,a.concat([c.sanitized]))},[]);else if(XTt(e)){var o=Object.keys(e);s=o.reduce(function(a,l){var c=e[l],u=i.validate(c,r);return u.isValid?a[l]=c:(n=!0,a[l]=u.sanitized),a},{})}else return r.allowUndefined&&typeof e>"u"?void 0:null;return n?s:e}catch{return null}},t.prototype._trim=function(e){return String.prototype.trim?e.trim():e.replace(/(^\s*)|(\s*$)/g,"")},t}();const mH=new Map;function bke(){mH.clear()}function z2t(t){return mH.get(t)}function V2t(t,e){mH.set(t,e)}function $X(t){mH.delete(t)}var lE,UP,B2t=function(t){if("WebkitTransition"in t.style)lE="webkitTransitionEnd",UP="webkitAnimationEnd";else{if(!("transition"in t.style))throw new Error("Your browser is not supported!");lE="transitionend",UP="animationend"}},wke=function(t){lE||B2t(t)},j2t=function(t,e){return e===void 0&&(e=t+"-active"),function(r){wke(r);var i=!1,n=function(s){i||(i=!0,r.removeEventListener(lE,n),r.removeEventListener(UP,n),r.classList.remove(t),r.classList.remove(e))};r.classList.add(t),r.addEventListener(lE,n),r.addEventListener(UP,n),requestAnimationFrame(function(){r.classList.add(e)})}},G2t=function(t,e){return e===void 0&&(e=t+"-active"),function(r,i){wke(r);var n=!1,s=function(o){n||(n=!0,r.removeEventListener(lE,s),r.removeEventListener(UP,s),i())};r.classList.add(t),r.addEventListener(lE,s),r.addEventListener(UP,s),requestAnimationFrame(function(){r.classList.add(e)})}};const H2t=re.getLogger("esri.widgets.support.widgetUtils");function q2t(t){const e=Ku.acquire();for(let i=0;i<arguments.length;i++){const n=arguments[i],s=typeof n;if(s==="string")e.push(n);else if(Array.isArray(n))e.push.apply(e,n);else if(s==="object")for(const o in n)n[o]&&e.push(o)}const r=e.join(" ");return Ku.release(e),r}(()=>{const t=new Map,e=new ResizeObserver(i=>{var n;bke();for(const s of i)(n=t.get(s.target))==null||n(s)}),r=(i,n,s)=>(t.has(i)&&H2t.error("Already observing element",i),t.set(i,n),e.observe(i,s),kl(()=>{e.unobserve(i),t.delete(i)}));return(i,n,s)=>{let o=null;return pe(()=>typeof i=="function"?i():i,a=>{o==null||o.remove(),a&&(o=r(a,n,s))},Bi)}})();function vre(t){const e=t==null?void 0:t.closest("[dir]");return e!==null&&e instanceof HTMLElement&&e.dir==="rtl"||document.dir==="rtl"}function amr(t){const e="data-node-ref";this[t.getAttribute(e)]=null}function lmr(t){const e="data-node-ref";this[t.getAttribute(e)]=t}function cmr(t,e){return(t==="enter"?j2t:G2t)(e)}const W2t=["dd","dl","dt","h1","h2","h3","h4","h5","h6","sub","sup","animate","animatetransform","circle","clippath","defs","ellipse","g","image","line","lineargradient","marker","mask","path","pattern","polygon","polyline","radialgradient","rect","stop","svg","switch","symbol","text","textpath","tspan","use"],X2t=W2t.reduce((t,e)=>(t[e]=[],t),{}),Y2t=["align","alink","alt","bgcolor","border","cellpadding","cellspacing","class","color","cols","colspan","coords","d","dir","face","height","hspace","ismap","lang","marginheight","marginwidth","multiple","nohref","noresize","noshade","nowrap","ref","rel","rev","rows","rowspan","scrolling","shape","span","summary","tabindex","title","usemap","valign","value","vlink","vspace","width"],xke=new U2t({whiteList:X2t,onTagAttr:(t,e,r)=>{const i=`${e}="${r}"`;if(Y2t.includes(e))return i},stripIgnoreTag:!0,stripIgnoreTagBody:["script","style"]},!0);function Z2t(t){return t==="Enter"||t===" "}const Ske="http://www.w3.org/",gH=`${Ske}2000/svg`,Tke=`${Ske}1999/xlink`;let g1e=[],Pde=(t,e)=>{let r={};return Object.keys(t).forEach(i=>{r[i]=t[i]}),e&&Object.keys(e).forEach(i=>{r[i]=e[i]}),r},Mde=(t,e)=>t.vnodeSelector===e.vnodeSelector&&(t.properties&&e.properties?t.properties.key===e.properties.key&&t.properties.bind===e.properties.bind:!t.properties&&!e.properties),Eke=t=>{if(typeof t!="string")throw new Error("Style values must be strings")},J2t=(t,e,r)=>{if(e.vnodeSelector!==""){for(let i=r;i<t.length;i++)if(Mde(t[i],e))return i}return-1},IX=(t,e,r,i)=>{let n=t[e];if(n.vnodeSelector==="")return;let s=n.properties;if(!(s&&(s.key===void 0?s.bind:s.key))){for(let o=0;o<t.length;o++)if(o!==e){let a=t[o];if(Mde(a,n))throw new Error(`${r.vnodeSelector} had a ${n.vnodeSelector} child ${i==="added"?i:"removed"}, but there is now more than one. You must add unique key properties to make them distinguishable.`)}}},K2t=t=>{if(t.properties){let e=t.properties.enterAnimation;e&&e(t.domNode,t.properties)}},_re=[],bre=!1,Cke=t=>{(t.children||[]).forEach(Cke),t.properties&&t.properties.afterRemoved&&t.properties.afterRemoved.apply(t.properties.bind||t.properties,[t.domNode])},y1e=()=>{bre=!1,_re.forEach(Cke),_re.length=0},v1e=t=>{_re.push(t),bre||(bre=!0,typeof window<"u"&&"requestIdleCallback"in window?window.requestIdleCallback(y1e,{timeout:16}):setTimeout(y1e,16))},_1e=t=>{let e=t.domNode;if(t.properties){let r=t.properties.exitAnimation;if(r)return e.style.pointerEvents="none",void r(e,()=>{e.parentNode&&(e.parentNode.removeChild(e),v1e(t))},t.properties)}e.parentNode&&(e.parentNode.removeChild(e),v1e(t))},Q2t=(t,e,r)=>{if(!e)return;let i=r.eventHandlerInterceptor,n=Object.keys(e),s=n.length;for(let o=0;o<s;o++){let a=n[o],l=e[a];if(a==="className")throw new Error('Property "className" is not supported, use "class".');if(a==="class")wre(t,l,!0);else if(a==="classes"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let f=c[h];l[f]&&t.classList.add(f)}}else if(a==="styles"){let c=Object.keys(l),u=c.length;for(let h=0;h<u;h++){let f=c[h],m=l[f];m&&(Eke(m),r.styleApplyer(t,f,m))}}else if(a!=="key"&&l!=null){let c=typeof l;c==="function"?(a.lastIndexOf("on",0)===0&&(i&&(l=i(a,l,t,e)),a==="oninput"&&function(){let u=l;l=function(h){u.apply(this,[h]),h.target["oninput-value"]=h.target.value}}()),t[a]=l):r.namespace===gH?a==="href"?t.setAttributeNS(Tke,a,l):t.setAttribute(a,l):c==="string"&&a!=="value"?a==="innerHTML"?t[a]=xke.sanitize(l):Rke(t)&&a in t?t[a]=l:t.setAttribute(a,l):t[a]=l}}};function Rke(t){if(!(t instanceof Element&&t.tagName.includes("-")))return!1;const e=window.customElements.get(t.tagName.toLowerCase());return!!e&&t instanceof e}let SB,eEt=(t,e,r)=>{if(e)for(let i of e)qO(i,t,void 0,r)},Oke=(t,e,r)=>{eEt(t,e.children,r),e.text&&(t.textContent=e.text),Q2t(t,e.properties,r),e.properties&&e.properties.afterCreate&&e.properties.afterCreate.apply(e.properties.bind||e.properties,[t,r,e.vnodeSelector,e.properties,e.children])},qO=(t,e,r,i)=>{let n,s=0,o=t.vnodeSelector,a=e.ownerDocument;if(o==="")n=t.domNode=a.createTextNode(t.text),r!==void 0?e.insertBefore(n,r):e.appendChild(n);else{for(let l=0;l<=o.length;++l){let c=o.charAt(l);if(l===o.length||c==="."||c==="#"){let u=o.charAt(s-1),h=o.slice(s,l);u==="."?n.classList.add(h):u==="#"?n.id=h:(h==="svg"&&(i=Pde(i,{namespace:gH})),i.namespace!==void 0?n=t.domNode=a.createElementNS(i.namespace,h):(n=t.domNode=t.domNode||a.createElement(h),h==="input"&&t.properties&&t.properties.type!==void 0&&n.setAttribute("type",t.properties.type)),r!==void 0?e.insertBefore(n,r):n.parentNode!==e&&e.appendChild(n)),s=l+1}}Oke(n,t,i)}},wre=(t,e,r)=>{e&&e.split(" ").forEach(i=>{i&&t.classList.toggle(i,r)})},tEt=(t,e,r,i)=>{if(!r)return;let n=!1,s=Object.keys(r),o=s.length;for(let a=0;a<o;a++){let l=s[a],c=r[l],u=e[l];if(l==="class")u!==c&&(wre(t,u,!1),wre(t,c,!0));else if(l==="classes"){let h=t.classList,f=Object.keys(c),m=f.length;for(let g=0;g<m;g++){let y=f[g],_=!!c[y];_!==!!u[y]&&(n=!0,_?h.add(y):h.remove(y))}}else if(l==="styles"){let h=Object.keys(c),f=h.length;for(let m=0;m<f;m++){let g=h[m],y=c[g];y!==u[g]&&(n=!0,y?(Eke(y),i.styleApplyer(t,g,y)):i.styleApplyer(t,g,""))}}else if(c||typeof u!="string"||(c=""),l==="value"){let h=t[l];h!==c&&(t["oninput-value"]?h===t["oninput-value"]:c!==u)&&(t[l]=c,t["oninput-value"]=void 0),c!==u&&(n=!0)}else if(c!==u){let h=typeof c;h==="function"&&i.eventHandlerInterceptor||(i.namespace===gH?l==="href"?t.setAttributeNS(Tke,l,c):t.setAttribute(l,c):h==="string"?l==="innerHTML"?t[l]=xke.sanitize(c):l==="role"&&c===""?t.removeAttribute(l):Rke(t)&&l in t?t[l]=c:t.setAttribute(l,c):t[l]!==c&&(t[l]=c),n=!0)}}return n},rEt=(t,e,r,i,n)=>{if(r===i)return!1;i=i||g1e;let s,o=(r=r||g1e).length,a=i.length,l=0,c=0,u=!1;for(;c<a;){let h=l<o?r[l]:void 0,f=i[c];if(h!==void 0&&Mde(h,f))u=SB(h,f,n)||u,l++;else{let m=J2t(r,f,l+1);if(m>=0){for(s=l;s<m;s++)_1e(r[s]),IX(r,s,t,"removed");u=SB(r[m],f,n)||u,l=m+1}else qO(f,e,l<o?r[l].domNode:void 0,n),K2t(f),IX(i,c,t,"added")}c++}if(o>l)for(s=l;s<o;s++)_1e(r[s]),IX(r,s,t,"removed");return u};SB=(t,e,r)=>{let i=t.domNode,n=!1;if(t===e)return!1;let s=!1;if(e.vnodeSelector===""){if(e.text!==t.text){let o=i.ownerDocument.createTextNode(e.text);return i.parentNode.replaceChild(o,i),e.domNode=o,n=!0,n}e.domNode=i}else e.vnodeSelector.lastIndexOf("svg",0)===0&&(r=Pde(r,{namespace:gH})),t.text!==e.text&&(s=!0,e.text===void 0?i.removeChild(i.firstChild):i.textContent=e.text),e.domNode=i,s=rEt(e,i,t.children,e.children,r)||s,s=tEt(i,t.properties,e.properties,r)||s,e.properties&&e.properties.afterUpdate&&e.properties.afterUpdate.apply(e.properties.bind||e.properties,[i,r,e.vnodeSelector,e.properties,e.children]);return s&&e.properties&&e.properties.updateAnimation&&e.properties.updateAnimation(i,e.properties,t.properties),n};let qM=(t,e)=>({getLastRender:()=>t,update:r=>{if(t.vnodeSelector!==r.vnodeSelector)throw new Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");let i=t;t=r,SB(i,r,e)},domNode:t.domNode});const iEt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{e.charAt(0)==="-"?t.style.setProperty(e,r):t.style[e]=r}};let FR=t=>Pde(iEt,t),ww={create:(t,e)=>(e=FR(e),qO(t,document.createElement("div"),void 0,e),qM(t,e)),append:(t,e,r)=>(r=FR(r),qO(e,t,void 0,r),qM(e,r)),insertBefore:(t,e,r)=>(r=FR(r),qO(e,t.parentNode,t,r),qM(e,r)),merge:(t,e,r)=>(r=FR(r),e.domNode=t,Oke(t,e,r),qM(e,r)),replace:(t,e,r)=>(r=FR(r),qO(e,t.parentNode,t,r),t.parentNode.removeChild(t),qM(e,r))},Ake,nEt=(t,e)=>{let r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r};Ake=Array.prototype.find?(t,e)=>t.find(e):(t,e)=>t.filter(e)[0];let sEt=(t,e)=>{let r=t;return e.forEach(i=>{r=r&&r.children?Ake(r.children,n=>n.domNode===i):void 0}),r},oEt=(t,e,r)=>{let i=function(n){r("domEvent",n);let s=e(),o=nEt(n.currentTarget,s.domNode);o.reverse();let a,l=sEt(s.getLastRender(),o);return t.scheduleRender(),l&&(a=l.properties[`on${n.type}`].apply(l.properties.bind||this,arguments)),r("domEventProcessed",n),a};return(n,s,o,a)=>i},b1e=t=>{let e,r,i=FR(t),n=i.performanceLogger,s=!0,o=!1,a=[],l=[],c=(h,f,m)=>{let g,y=()=>g;i.eventHandlerInterceptor=oEt(e,y,n),g=h(f,m(),i),a.push(g),l.push(m)},u=()=>{if(r=void 0,s){s=!1,n("renderStart",void 0);for(let h=0;h<a.length;h++){let f=l[h]();n("rendered",void 0),a[h].update(f),n("patched",void 0)}n("renderDone",void 0),s=!0}};return e={renderNow:u,scheduleRender:()=>{r||o||(r=requestAnimationFrame(u))},stop:()=>{r&&(cancelAnimationFrame(r),r=void 0),o=!0},resume:()=>{o=!1,s=!0,e.scheduleRender()},append:(h,f)=>{c(ww.append,h,f)},insertBefore:(h,f)=>{c(ww.insertBefore,h,f)},merge:(h,f)=>{c(ww.merge,h,f)},replace:(h,f)=>{c(ww.replace,h,f)},detach:h=>{for(let f=0;f<l.length;f++)if(l[f]===h)return l.splice(f,1),a.splice(f,1)[0];throw new Error("renderFunction was not found")}},e},db=class extends Ce{constructor(){super(...arguments),this.items=new vt,this._watchUpdatingTracking=new Yy,this._callbacks=new Map,this._projector=b1e(),this._hiddenProjector=b1e()}get needsRender(){return this.items.length>0}get updating(){var e;return((e=this._watchUpdatingTracking)==null?void 0:e.updating)??!1}initialize(){const e=document.createElement("div");e.className="esri-overlay-surface",this._set("surface",e),this._hiddenSurface=document.createElement("div"),this._hiddenSurface.setAttribute("style","visibility: hidden;"),e.appendChild(this._hiddenSurface),this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const i of r.added){const n=()=>i.render();this._callbacks.set(i,n),this._projector.append(this.surface,n)}for(const i of r.removed){const n=this._projector.detach(this._callbacks.get(i));this.surface.removeChild(n.domNode),this._callbacks.delete(i)}})}addItem(e){this.items.add(e)}removeItem(e){this.items.remove(e)}destroy(){this.items.removeAll(),this._callbacks.forEach(e=>this._projector.detach(e)),this._callbacks=null,this._projector=null,this._watchUpdatingTracking.destroy()}render(){this._projector.renderNow()}computeBoundingRect(e){const r=this._hiddenSurface,i=this._hiddenProjector;let n;const s=()=>(n=e.render(),n);i.append(r,s),i.renderNow();const o={left:0,top:0,right:0,bottom:0};if(n&&n.domNode){const a=n.domNode.getBoundingClientRect();o.left=a.left,o.top=a.top,o.right=a.right,o.bottom=a.bottom}for(i.detach(s);r.firstChild;)r.removeChild(r.firstChild);return o}overlaps(e,r){const i=this.computeBoundingRect(e),n=this.computeBoundingRect(r);return Math.max(i.left,n.left)<=Math.min(i.right,n.right)&&Math.max(i.top,n.top)<=Math.min(i.bottom,n.bottom)}get hasVisibleItems(){return this.items.some(e=>e.visible)}async prepare(){await document.fonts.load(this._fontString()).catch(()=>{})}renderCanvas(e){if(!this.items.some(i=>i.visible))return;const r=e.getContext("2d");r.save(),r.font=this._fontString(),this.items.forEach(i=>{r.save(),i.renderCanvas(r),r.restore()}),r.restore()}_fontString(){return`10px ${getComputedStyle(this.surface).fontFamily}`}};d([p({readOnly:!0})],db.prototype,"surface",void 0),d([p({readOnly:!0})],db.prototype,"items",void 0),d([p({readOnly:!0})],db.prototype,"needsRender",null),d([p({readOnly:!0})],db.prototype,"_watchUpdatingTracking",void 0),d([p({readOnly:!0})],db.prototype,"updating",null),db=d([I("esri.views.overlay.ViewOverlay")],db);const w1e=db,LX=[0,0];function aEt(t){const e=(t.ownerDocument||window.document).defaultView,r=t.getBoundingClientRect();return LX[0]=r.left+((e==null?void 0:e.pageXOffset)??0),LX[1]=r.top+((e==null?void 0:e.pageYOffset)??0),LX}function x1e(t){t&&(Q5e(t),t.parentNode&&t.parentNode.removeChild(t))}function lEt(t){const e=document.createElement("div");return t.appendChild(e),e}const WM=16,Sk=750,cEt=512,uEt=2,dEt=t=>{let e=class extends t{constructor(...r){super(...r),this._freqInfo={freq:WM,time:Sk},this._overlayRenderTaskHandle=null,this.height=0,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.ui=null,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([pe(()=>this.cursor,i=>{const{surface:n}=this;n&&n.setAttribute("data-cursor",i)}),pe(()=>this.navigating,i=>{const{surface:n}=this;n&&n.setAttribute("data-navigating",i.toString())})])}initialize(){this.addHandles([pe(()=>this.ui,(r,i)=>this._handleUIChange(r,i),_r),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui=qe(this.ui),this.container=null)}get container(){return this._get("container")??null}set container(r){const i=this._get("container"),n=pH(r);if(n||typeof r!="string"||re.getLogger(this).error("#container",`element with id '${r}' not found`),i===n)return;if(this._stopMeasuring(),i&&(i.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(x1e(this.root),this._set("root",null)),this.userContent&&(Y_e(this.userContent,i),x1e(this.userContent),this._set("userContent",null))),!n)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);n.classList.add("esri-view");const s=document.createElement("div");s.className="esri-view-user-storage",Y_e(n,s),n.appendChild(s),this._set("userContent",s);const o=document.createElement("div");o.className="esri-view-root",n.insertBefore(o,n.firstChild),this._set("root",o);const a=document.createElement("div");a.className="esri-view-surface",a.setAttribute("role","application"),a.tabIndex=0,o.appendChild(a),this._set("surface",a);const l=new w1e;o.appendChild(l.surface),this._set("overlay",l),this.addHandles(pe(()=>l.needsRender,c=>{c&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=hP({render:()=>{var u;return(u=this.overlay)==null?void 0:u.render()}}):this._overlayRenderTaskHandle=yi(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",n),this._startMeasuring()}get focused(){const r=document.activeElement===this.surface;return document.hasFocus()&&r}get size(){return[this.width,this.height]}blur(){var r;(r=this.surface)==null||r.blur()}focus(){var r;(r=this.surface)==null||r.focus()}pageToContainer(r,i,n){const s=this.position;return r-=s?s[0]:0,i-=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}containerToPage(r,i,n){const s=this.position;return r+=s?s[0]:0,i+=s?s[1]:0,n?(n[0]=r,n[1]=i):n=[r,i],n}_handleUIChange(r,i){this.removeHandles("ui"),i&&i!==r&&i.destroy(),r&&(r.view=this,this.addHandles(pe(()=>this.root,n=>{r.container=n?lEt(n):null},_r),"ui")),this._set("ui",r)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const r=this._freqInfo;r.freq=WM,r.time=Sk,this.addHandles([(()=>{const i=()=>{r.freq=WM,r.time=Sk};return window.addEventListener("resize",i),{remove(){window.removeEventListener("resize",i)}}})(),hP({prepare:i=>{const n=this._measure(),s=this._freqInfo;if(s.time+=i.deltaTime,n&&(s.freq=WM,this._get("resizing")||this._set("resizing",!0)),s.time<s.freq)return;s.time=0;const o=this._position();s.freq=o||n?WM:Math.min(Sk,s.freq*uEt),!n&&s.freq>=cEt&&this._get("resizing")&&this._set("resizing",!1)}})],"measuring"),this._measure(),this._position()}_measure(){const r=this.container,i=r?r.clientWidth:0,n=r?r.clientHeight:0;if(i===0||n===0)return this.suspended||this._set("suspended",!0),!1;const s=this.width,o=this.height;return i===s&&n===o?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",i),this._set("height",n),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:s,oldHeight:o,width:i,height:n}),!0)}_position(){const r=this.container,i=this.position,n=r&&aEt(r);return!!n&&(!i||n[0]!==i[0]||n[1]!==i[1])&&(this._set("position",[n[0],n[1]]),!0)}forceDOMReadyCycle(){}};return d([p()],e.prototype,"container",null),d([p({readOnly:!0})],e.prototype,"focused",null),d([p({readOnly:!0})],e.prototype,"height",void 0),d([p({type:w1e})],e.prototype,"overlay",void 0),d([p({readOnly:!0})],e.prototype,"position",void 0),d([p({readOnly:!0})],e.prototype,"resizing",void 0),d([p({readOnly:!0})],e.prototype,"root",void 0),d([p({value:null,readOnly:!0})],e.prototype,"size",null),d([p({readOnly:!0})],e.prototype,"surface",void 0),d([p({readOnly:!0})],e.prototype,"suspended",void 0),d([p()],e.prototype,"ui",void 0),d([p({readOnly:!0})],e.prototype,"userContent",void 0),d([p({readOnly:!0})],e.prototype,"width",void 0),d([p()],e.prototype,"widthBreakpoint",void 0),e=d([I("esri.views.DOMContainer")],e),e},$de=re.getLogger("esri.layers.support.ElevationSampler");let Pke=class{queryElevation(e){return Mke(e.clone(),this)}on(){return gEt}projectIfRequired(e,r){return $ke(e,r)}},hEt=class extends Pke{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){super(),this.tile=e,this.noDataValue=i;const n=e.tile.extent;this.extent=C7(n,r.spatialReference),this.extent.zmin=e.zmin,this.extent.zmax=e.zmax,this._aaExtent=n;const s=Pc(r.spatialReference),o=r.lodAt(e.tile.level).resolution*s;this.demResolution={min:o,max:o}}contains(e){const r=this.projectIfRequired(e,this.spatialReference);return r!=null&&this.containsAt(r.x,r.y)}containsAt(e,r){return R7(this._aaExtent,e,r)}elevationAt(e,r){if(!this.containsAt(e,r)){const i=this.extent,n=`${i.xmin}, ${i.ymin}, ${i.xmax}, ${i.ymax}`;return $de.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return this.tile.sample(e,r)??this.noDataValue}},pmr=class extends Pke{get spatialReference(){return this.extent.spatialReference}constructor(e,r,i){let n;super(),typeof r=="number"?(this.noDataValue=r,n=null):(n=r,this.noDataValue=i),this.samplers=n?e.map(o=>new hEt(o,n,this.noDataValue)):e;const s=this.samplers[0];if(s){this.extent=s.extent.clone();const{min:o,max:a}=s.demResolution;this.demResolution={min:o,max:a};for(let l=1;l<this.samplers.length;l++){const c=this.samplers[l];this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max)}}else this.extent=C7(lr(),n.spatialReference),this.demResolution={min:0,max:0}}elevationAt(e,r){for(const i of this.samplers)if(i.containsAt(e,r))return i.elevationAt(e,r);return $de.warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler`),this.noDataValue}};function Mke(t,e){const r=$ke(t,e.spatialReference);if(!r)return null;switch(t.type){case"point":pEt(t,r,e);break;case"polyline":fEt(t,r,e);break;case"multipoint":mEt(t,r,e)}return t}function $ke(t,e){if(t==null)return null;const r=t.spatialReference;if(r.equals(e))return t;const i=PE(t,e);return i||$de.error(`Cannot project geometry spatial reference (wkid:${r.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),i}function pEt(t,e,r){t.z=r.elevationAt(e.x,e.y)}function fEt(t,e,r){Ay.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.paths.length;n++){const s=t.paths[n],o=e.paths[n];for(let a=0;a<s.length;a++){const l=s[a],c=o[a];Ay.x=c[0],Ay.y=c[1],i&&(l[3]=l[2]),l[2]=r.elevationAt(Ay.x,Ay.y)}}t.hasZ=!0}function mEt(t,e,r){Ay.spatialReference=e.spatialReference;const i=t.hasM&&!t.hasZ;for(let n=0;n<t.points.length;n++){const s=t.points[n],o=e.points[n];Ay.x=o[0],Ay.y=o[1],i&&(s[3]=s[2]),s[2]=r.elevationAt(Ay.x,Ay.y)}t.hasZ=!0}const Ay=new Gt,gEt={remove(){}};var xre;let iy=xre=class extends me{constructor(t){super(t),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new xre({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}};d([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],iy.prototype,"cols",void 0),d([p({type:hn,json:{write:!0}})],iy.prototype,"level",void 0),d([p({type:String,json:{write:!0}})],iy.prototype,"levelValue",void 0),d([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],iy.prototype,"origin",void 0),d([p({type:Number,json:{write:!0}})],iy.prototype,"resolution",void 0),d([p({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],iy.prototype,"rows",void 0),d([p({type:Number,json:{write:!0}})],iy.prototype,"scale",void 0),iy=xre=d([I("esri.layers.support.LOD")],iy);const Cm=iy;let yEt=class{constructor(e,r,i,n,s=void 0){this.id=e,this.level=r,this.row=i,this.col=n,this.extent=s}};var hb;const S1e=new ri({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});let _l=hb=class extends me{static create(t={}){const{resolutionFactor:e=1,scales:r,size:i=256,spatialReference:n=dt.WebMercator,numLODs:s=24}=t;if(!$l(n)){const h=[];if(r)for(let f=0;f<r.length;f++){const m=r[f];h.push(new Cm({level:f,scale:m,resolution:m}))}else{let f=5e-4;for(let m=s-1;m>=0;m--)h.unshift(new Cm({level:m,scale:f,resolution:f})),f*=2}return new hb({dpi:96,lods:h,origin:new Gt(0,0,n),size:[i,i],spatialReference:n})}const o=Dw(n),a=t.origin?new Gt({x:t.origin.x,y:t.origin.y,spatialReference:n}):new Gt(o?{x:o.origin[0],y:o.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),l=96,c=1/(Pc(n)*39.37*l),u=[];if(r)for(let h=0;h<r.length;h++){const f=r[h],m=f*c;u.push(new Cm({level:h,scale:f,resolution:m}))}else{let h=bce(n)?512/i*5916575275917094e-7:256/i*591657527591555e-6;const f=Math.ceil(s/e);u.push(new Cm({level:0,scale:h,resolution:h*c}));for(let m=1;m<f;m++){const g=h/2**e,y=g*c;u.push(new Cm({level:m,scale:g,resolution:y})),h=g}}return new hb({dpi:l,lods:u,origin:a,size:[i,i],spatialReference:n})}constructor(t){super(t),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:t,origin:e}=this;if(t&&e){const r=Dw(t);return t.isWrappable&&!!r&&Math.abs(r.origin[0]-e.x)<=r.dx}return!1}readOrigin(t,e){return Gt.fromJSON({spatialReference:e.spatialReference,...t})}set lods(t){let e=0,r=0;const i=[],n=this._levelToLOD={};t&&(e=-1/0,r=1/0,t.forEach(s=>{i.push(s.scale),e=s.scale>e?s.scale:e,r=s.scale<r?s.scale:r,n[s.level]=s})),this._set("scales",i),this._set("lods",t),this._initializeUpsampleLevels()}readSize(t,e){return[e.cols,e.rows]}writeSize(t,e){e.cols=t[0],e.rows=t[1]}zoomToScale(t){const e=this.scales;if(t<=0)return e[0];if(t>=e.length-1)return e[e.length-1];const r=Math.floor(t),i=r+1;return e[r]/(e[r]/e[i])**(t-r)}scaleToZoom(t){const e=this.scales,r=e.length-1;let i=0;for(;i<r;i++){const n=e[i],s=e[i+1];if(n<=t)return i;if(s===t)return i+1;if(n>t&&s<t)return i+Math.log(n/t)/Math.log(n/s)}return i}snapScale(t,e=.95){const r=this.scaleToZoom(t);return r%Math.floor(r)>=e?this.zoomToScale(Math.ceil(r)):this.zoomToScale(Math.floor(r))}tileAt(t,e,r,i){const n=this.lodAt(t);if(!n)return null;let s,o;if(typeof e=="number")s=e,o=r;else if(So(e.spatialReference,this.spatialReference))s=e.x,o=e.y,i=r;else{const c=PE(e,this.spatialReference);if(c==null)return null;s=c.x,o=c.y,i=r}const a=n.resolution*this.size[0],l=n.resolution*this.size[1];return i||(i=new yEt(null,0,0,0,lr())),i.level=t,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((s-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(t,e=hb.ExtrapolateOptions.NONE){let r=this.lodAt(t.level);if(!r&&e===hb.ExtrapolateOptions.POWER_OF_TWO){const o=this.lods[this.lods.length-1];o.level<t.level&&(r=o)}if(!r)return;const i=t.level-r.level,n=r.resolution*this.size[0]/2**i,s=r.resolution*this.size[1]/2**i;t.id=`${t.level}/${t.row}/${t.col}`,t.extent||(t.extent=lr()),t.extent[0]=this.origin.x+t.col*n,t.extent[1]=this.origin.y-(t.row+1)*s,t.extent[2]=t.extent[0]+n,t.extent[3]=t.extent[1]+s}upsampleTile(t){const e=this._upsampleLevels[t.level];return!(!e||e.parentLevel===-1)&&(t.level=e.parentLevel,t.row=Math.floor(t.row/e.factor+.001),t.col=Math.floor(t.col/e.factor+.001),this.updateTileInfo(t),!0)}getTileBounds(t,e){const r=this.lodAt(e.level);if(r==null)return null;const{resolution:i}=r,n=i*this.size[0],s=i*this.size[1];return t[0]=this.origin.x+e.col*n,t[1]=this.origin.y-(e.row+1)*s,t[2]=t[0]+n,t[3]=t[1]+s,t}lodAt(t){var e;return((e=this._levelToLOD)==null?void 0:e[t])??null}clone(){return hb.fromJSON(this.write({}))}getOrCreateCompatible(t,e){if(this.size[0]===256&&this.size[1]===256)return t===256?this:null;const r=[],i=this.lods.length;for(let n=0;n<i;n++){const s=this.lods[n],o=s.resolution*e;r.push(new Cm({level:s.level,scale:s.scale,resolution:o}))}return new hb({size:[t,t],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const t=this.lods;this._upsampleLevels=[];let e=null;for(let r=0;r<t.length;r++){const i=t[r];this._upsampleLevels[i.level]={parentLevel:e?e.level:-1,factor:e?e.resolution/i.resolution:0},e=i}}};d([p({type:Number,json:{write:!0}})],_l.prototype,"compressionQuality",void 0),d([p({type:Number,json:{write:!0}})],_l.prototype,"dpi",void 0),d([p({type:String,json:{read:S1e.read,write:S1e.write,origins:{"web-scene":{read:!1,write:!1}}}})],_l.prototype,"format",void 0),d([p({readOnly:!0})],_l.prototype,"isWrappable",null),d([p({type:Gt,json:{write:!0}})],_l.prototype,"origin",void 0),d([ke("origin")],_l.prototype,"readOrigin",null),d([p({type:[Cm],value:null,json:{write:!0}})],_l.prototype,"lods",null),d([p({readOnly:!0})],_l.prototype,"scales",void 0),d([p({cast:t=>Array.isArray(t)?t:typeof t=="number"?[t,t]:[256,256]})],_l.prototype,"size",void 0),d([ke("size",["rows","cols"])],_l.prototype,"readSize",null),d([tt("size",{cols:{type:hn},rows:{type:hn}})],_l.prototype,"writeSize",null),d([p({type:dt,json:{write:!0}})],_l.prototype,"spatialReference",void 0),_l=hb=d([I("esri.layers.support.TileInfo")],_l),function(t){var e;(e=t.ExtrapolateOptions||(t.ExtrapolateOptions={}))[e.NONE=0]="NONE",e[e.POWER_OF_TWO=1]="POWER_OF_TWO"}(_l||(_l={}));const hz=_l,vEt=12;let Qu=class Bc{constructor(e){const r=Bc.checkUnsupported(e);if(r!=null)throw r;const i=e;this.spatialReference=i.spatialReference,this._isWebMercator=this.spatialReference.isWebMercator,this._isGCS=Kw(this.spatialReference)||w0(this.spatialReference)||x0(this.spatialReference),this.origin=[i.origin.x,i.origin.y],this.pixelSize=i.size[0],this.dpi=i.dpi;const n=i.lods.reduce((c,u,h)=>(u.level<c.min&&(c.min=u.level,c.minIndex=h),c.max=Math.max(c.max,u.level),c),{min:1/0,minIndex:0,max:-1/0}),s=i.lods[n.minIndex],o=2**s.level;let a=s.resolution*o,l=s.scale*o;this.levels=new Array(n.max+1);for(let c=0;c<this.levels.length;c++)this.levels[c]={resolution:a,scale:l,tileSize:[a*i.size[0],a*i.size[1]]},a/=2,l/=2}clone(){return new Bc(this.toTileInfo())}toTileInfo(){return new hz({dpi:this.dpi,origin:new Gt({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((e,r)=>new Cm({level:r,scale:e.scale,resolution:e.resolution}))})}getExtent(e,r,i,n){const s=this.levels[e],o=s.tileSize[0],a=s.tileSize[1];n[0]=this.origin[0]+i*o,n[2]=this.origin[0]+(i+1)*o,n[3]=this.origin[1]-r*a,n[1]=this.origin[1]-(r+1)*a}convertExtentToRadians(e,r){this._isWebMercator?(r[0]=Y0e(e[0]),r[1]=PV(e[1]),r[2]=Y0e(e[2]),r[3]=PV(e[3])):this._isGCS&&(r[0]=sr(e[0]),r[1]=sr(e[1]),r[2]=sr(e[2]),r[3]=sr(e[3]))}getExtentGeometry(e,r,i,n=new $r){return this.getExtent(e,r,i,Og),n.spatialReference=this.spatialReference,n.xmin=Og[0],n.ymin=Og[1],n.xmax=Og[2],n.ymax=Og[3],n.zmin=void 0,n.zmax=void 0,n}ensureMaxLod(e){if(e==null)return!1;let r=!1;for(;this.levels.length<=e;){const i=this.levels[this.levels.length-1],n=i.resolution/2;this.levels.push({resolution:n,scale:i.scale/2,tileSize:[n*this.pixelSize,n*this.pixelSize]}),r=!0}return r}capMaxLod(e){this.levels.length>e+1&&(this.levels.length=e+1)}getMaxLod(){return this.levels.length-1}scaleAtLevel(e){return this.levels[0].scale/2**e}levelAtScale(e){const r=this.levels[0].scale;return e>=r?0:Math.log(r/e)*Math.LOG2E}resolutionAtLevel(e){return this.levels[0].resolution/2**e}compatibleWith(e){if(!(e instanceof Bc)){if(Bc.checkUnsupported(e))return!1;e=new Bc(e)}if(!e.spatialReference.equals(this.spatialReference)||e.pixelSize!==this.pixelSize)return!1;const r=Math.min(this.levels.length,e.levels.length)-1,i=this.levels[r].resolution;let n=.5*i;return!e_(e.origin[0],this.origin[0],n)||!e_(e.origin[1],this.origin[1],n)?!1:(n=.5*i/2**r/this.pixelSize*vEt,e_(i,e.levels[r].resolution,n))}rootTilesInExtent(e,r=null,i=1/0){const n=new Array,s=this.levels[0].tileSize;if(e==null||s[0]===0||s[1]===0)return n;Bc.computeRowColExtent(e,s,this.origin,Og);let o=Og[1],a=Og[3],l=Og[0],c=Og[2];const u=c-l,h=a-o;if(u*h>i){const f=Math.floor(Math.sqrt(i));h>f&&(o=o+Math.floor(.5*h)-Math.floor(.5*f),a=o+f),u>f&&(l=l+Math.floor(.5*u)-Math.floor(.5*f),c=l+f)}for(let f=o;f<a;f++)for(let m=l;m<c;m++)n.push([0,f,m]);return r!=null&&(r[0]=this.origin[0]+l*s[0],r[1]=this.origin[1]-a*s[1],r[2]=this.origin[0]+c*s[0],r[3]=this.origin[1]-o*s[1]),n}static computeRowColExtent(e,r,i,n){const s=.001*(e[2]-e[0]+(e[3]-e[1]));n[0]=Math.max(0,Math.floor((e[0]+s-i[0])/r[0])),n[2]=Math.max(0,Math.ceil((e[2]-s-i[0])/r[0])),n[1]=Math.max(0,Math.floor((i[1]-e[3]+s)/r[1])),n[3]=Math.max(0,Math.ceil((i[1]-e[1]-s)/r[1]))}static isPowerOfTwo(e){const r=e.lods,i=r[0].resolution*2**r[0].level;return!r.some(n=>!dmt(n.resolution,i/2**n.level))}static hasGapInLevels(e){const r=e.lods.map(i=>i.level);r.sort((i,n)=>i-n);for(let i=1;i<r.length;i++)if(r[i]!==r[0]+i)return!0;return!1}static tileSizeSupported(e){const r=e.size[1];return r===e.size[0]&&(r&r-1)==0&&r>=128&&r<=512}static hasOriginPerLODs(e){const r=e.origin;return e.lods.some(i=>i.origin!=null&&(i.origin[0]!==r.x||i.origin[1]!==r.y))}static getMissingTileInfoError(){return new H("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}static checkUnsupported(e){return e==null?Ide():e.lods.length<1?new H("tilingscheme:generic","Tiling scheme must have at least one level"):Bc.isPowerOfTwo(e)?Bc.hasGapInLevels(e)?new H("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):Bc.tileSizeSupported(e)?Bc.hasOriginPerLODs(e)?new H("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new H("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new H("tilingscheme:power-of-two","Tiling scheme must be power of two")}static fromExtent(e,r){const i=e[2]-e[0],n=e[3]-e[1],s=Pc(r),o=1.2*Math.max(i,n),a=256,l=96,c=.0254,u=new Bc(new hz({size:[a,a],origin:new Gt({x:e[0]-.5*(o-i),y:e[3]+.5*(o-n)}),lods:[new Cm({level:0,resolution:o/a,scale:1/(a/l*c/(o*s))})],spatialReference:r}));return u.ensureMaxLod(20),u}static makeWebMercatorAuxiliarySphere(e){const r=new Bc(Bc.WebMercatorAuxiliarySphereTileInfo);return r.ensureMaxLod(e),r}static makeGCSWithTileSize(e,r=256,i=16){const n=256/r,s=new Bc(new hz({size:[r,r],origin:new Gt({x:-180,y:90,spatialReference:e}),spatialReference:e,lods:[new Cm({level:0,resolution:.703125*n,scale:295497598570834e-6*n})]}));return s.ensureMaxLod(i),s}get test(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}};function Ide(){return new H("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}Qu.WebMercatorAuxiliarySphereTileInfo=new hz({size:[256,256],origin:new Gt({x:-20037508342787e-6,y:20037508342787e-6,spatialReference:dt.WebMercator}),spatialReference:dt.WebMercator,lods:[new Cm({level:0,resolution:156543.03392800014,scale:591657527591555e-6})]}),Qu.WebMercatorAuxiliarySphere=Qu.makeWebMercatorAuxiliarySphere(19);const Og=lr(),WO=64,DI=512,_Et=2.5,zN=hmt(BQ/10),Ike=2,Lke=lr();Qu.WebMercatorAuxiliarySphere.getExtent(0,0,0,Lke);const bEt=lr([-180,-90,180,90]),wEt="Cannot extend surface to encompass all layers because it would result in too many root tiles.",xEt="Surface extent is too large for tile resolution at level 0.",SEt=3;let TEt=SEt;function Sre(t){return t<4?3:TEt}let pb=class extends pn.EventedAccessor{constructor(e){super(e),this.demResolution={min:-1,max:-1},this.noDataValue=zN}initialize(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))}get extent(){const e=this.view.basemapTerrain;if(e==null||e.extent==null||e.spatialReference==null)return null;const r=C7(e.extent,e.spatialReference);return r.zmin=e.visibleElevationBounds.min,r.zmax=e.visibleElevationBounds.max,r}get spatialReference(){var e;return((e=this.view.basemapTerrain)==null?void 0:e.spatialReference)??dt.WGS84}elevationAt(e,r){var i;if(this.extent==null||!dc(this.extent,e,r)){const n=this.extent!=null?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;return re.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${e}, ${r}) is outside of the sampler extent (${n})`),this.noDataValue}return((i=this.view.elevationProvider)==null?void 0:i.getElevation(e,r,0,this.spatialReference,"ground"))??this.noDataValue}queryElevation(e){return Mke(e.clone(),this)}};d([p({readOnly:!0})],pb.prototype,"demResolution",void 0),d([p({readOnly:!0})],pb.prototype,"extent",null),d([p({readOnly:!0})],pb.prototype,"noDataValue",void 0),d([p()],pb.prototype,"spatialReference",null),d([p({constructOnly:!0})],pb.prototype,"view",void 0),pb=d([I("esri.views.support.GroundViewElevationSampler")],pb);const EEt=pb;let fb=class extends Ce{constructor(e){super(e),this.view=null,this.layerViews=new vt}initialize(){this.addHandles(du(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground},e=>e.load())),this.addHandles(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))}destroy(){this.removeAllHandles(),this._set("view",null);for(const e of this.layerViews)e.destroy();this.layerViews.length=0}get elevationSampler(){return this.view?this.view.type==="2d"?null:this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new EEt({view:this.view}):null:null}get updating(){return!this.suspended&&this.layerViews.some(e=>e.updating)}get suspended(){return!this.view||this.view.suspended}_layerViewsAfterChangesHandler(){this.removeHandles("updating"),this.addHandles(this.layerViews.map(e=>pe(()=>e.updating,()=>this._updateUpdating(),li)).toArray(),"updating"),this._updateUpdating()}_updateUpdating(){this.notifyChange("updating")}};d([p({readOnly:!0})],fb.prototype,"elevationSampler",null),d([p({type:Boolean,readOnly:!0})],fb.prototype,"updating",null),d([p({constructOnly:!0})],fb.prototype,"view",void 0),d([p({type:vt,readOnly:!0})],fb.prototype,"layerViews",void 0),d([p({readOnly:!0})],fb.prototype,"suspended",null),fb=d([I("esri.views.GroundView")],fb);const CEt=fb;let N_=class{constructor(e,r){this._owner=r,this._properties={},this._afterDispatchHandle=null;for(const i in e){const n=e[i],s=new k$e(n,void 0,void 0,2,2);this._properties[i]={pool:s,acquired:[]}}this._afterDispatchHandle=Y$e(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const e in this._properties){const r=this._properties[e];for(const i of r.acquired)O0e(i)||r.pool.release(i);r.pool.destroy(),r.pool=null,r.acquired=null}this._properties=null,this._owner=null}get(e){const r=this._owner._get(e),i=this._properties[e];let n=i.pool.acquire();for(i.acquired.push(n);n===r;)i.acquired.push(n),n=i.pool.acquire();return n}_release(){for(const e in this._properties){const r=this._properties[e];let i=0;for(const n of r.acquired)O0e(n)?r.acquired[i++]=n:r.pool.release(n);r.acquired.length=i}}};const REt=he("mac")?"Meta":"Ctrl",yH={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(let t=48;t<58;t++)yH[t]=String.fromCharCode(t);for(let t=1;t<25;t++)yH[111+t]=`F${t}`;for(let t=65;t<91;t++)yH[t]=[String.fromCharCode(t+32),String.fromCharCode(t)];function OEt(t){if(t.key!==void 0)return cdt(t);const e=yH[t.keyCode];return Array.isArray(e)?t.shiftKey?e[1]:e[0]:e}function AEt(t){switch(t){case"Ctrl":case"Alt":case"Shift":case"Meta":case"Primary":return!0}return!1}let PEt=class{constructor(e,r=[]){this.eventType=e,this.keyModifiers=r}matches(e){if(e.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const r=e.modifiers;for(const i of this.keyModifiers)if(!r.has(i))return!1;return!0}};const T1e=re.getLogger("esri.views.input.InputHandler");let Ua=class{constructor(e){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=e}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const e in this._incoming){const r=this._incoming[e];for(const i of r)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(e=>e.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(e){this._manager?T1e.error("This InputHandler has already been registered with an InputManager"):(e.setEventCallback(r=>this._handleEvent(r)),e.setUninstallCallback(()=>this._onUninstall()),this._manager=e)}onUninstall(){}registerIncoming(e,r,i){let n;typeof r=="function"?(i=r,n=[]):n=r||[];const s=typeof e=="string"?new PEt(e,n):e,o=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},a=u=>{const h=this._incoming[u.match.eventType];if(h){const f=h.indexOf(u);h.splice(f,1),o(),this._manager&&this._manager.updateDependencies()}},l=new MEt(s,i,{onPause:a,onRemove:a,onResume:u=>{const h=this._incoming[u.match.eventType];h&&!h.includes(u)&&(h.push(u),o(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(l),o(),this._manager&&this._manager.updateDependencies(),l}registerOutgoing(e){if(this._outgoing[e])throw new Error("There is already a callback registered for this outgoing InputEvent: "+e);const r=new $Et(e,{onEmit:(i,n,s,o)=>{var a;(a=this._manager)==null||a.emit(i.eventType,n,s,o)},onRemove:i=>{var n;delete this._outgoing[i.eventType],(n=this._manager)==null||n.updateDependencies()}});return this._outgoing[e]=r,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),r}startCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!0)}stopCapturingPointer(e){var r;(r=this._manager)==null||r.setPointerCapture(e,!1)}refreshHasPendingInputs(){var e;(e=this._manager)==null||e.refreshHasPendingInputs()}_onUninstall(){this._manager?(this.onUninstall(),this._manager=null):T1e.error("This InputHandler is not registered with an InputManager")}_handleEvent(e){var i;const r=this._incoming[e.type];if(r){for(const n of r)if(n.match.matches(e)&&((i=n.callback)==null||i.call(n,e),e.shouldStopPropagation()))break}}},MEt=class{constructor(e,r,i){this.match=e,this._callback=r,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},$Et=class{constructor(e,r){this.eventType=e,this._removed=!1,this._handler=r}emit(e,r,i){this._removed||this._handler.onEmit(this,e,r,i)}remove(){this._removed=!0,this._handler.onRemove(this)}},IEt=class extends Ua{constructor(e){super(!0),this._onChange=e,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",r=>{this._update(r.data)})}_update(e){const r=e.native.pointerType==="touch"?"touch":"mouse",{x:i,y:n}=e;r===this._value&&this._x===i&&this._y===n||(this._value=r,this._x=i,this._y=n,this._onChange(r,i,n))}},LEt=class extends Ua{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=NN(!1),this._onPointerAdd=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.add(e.native.pointerId),this._update())},this._onPointerRemove=({data:e})=>{e.pointerType==="touch"&&(this._activeTouchPointerIds.delete(e.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},sp=class extends Ce{constructor(e){super(e),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=REt,this._latestPointerType="mouse",this._propertiesPool=new N_({latestPointerLocation:FEt},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const e=Object.keys(this._nameToGroup);for(const r of e)this.uninstallHandlers(r);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(e=>e.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(e,r,i=Pn.INTERNAL){if(this._nameToGroup[e])return void re.getLogger(this).error("There is already an InputHandler group registered under the name `"+e+"`");if(r.length===0)return void re.getLogger(this).error("Can't register a group of zero handlers");const n={name:e,handlers:r.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[e]=n;for(let s=n.handlers.length-1;s>=0;s--){const o=n.handlers[s];this._handlers.push(o),o.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(a,l,c,u,h)=>{this._emitInputEvent(o.priorityIndex+1,a,l,c,h,u)},setPointerCapture:(a,l)=>{this._setPointerCapture(n,o,a,l)},setEventCallback:a=>{o.eventCallback=a},setUninstallCallback:a=>{o.uninstallCallback=a},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(e){const r=this._nameToGroup[e];r?(r.handlers.forEach(i=>{var n;i.removed=!0,(n=i.uninstallCallback)==null||n.call(i)}),delete this._nameToGroup[e],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):re.getLogger(this).error("There is no InputHandler group registered under the name `"+e+"`")}hasHandlers(e){return this._nameToGroup[e]!==void 0}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const e=new Set,r=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const n=this._handlers[i];n.priorityIndex=i,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s){for(const o of n.handler.outgoingEventTypes)if(e.has(o)){s=!0;break}}if(s)for(const o of n.handler.incomingEventMatches){e.add(o.eventType);for(const a of o.keyModifiers)AEt(a)||r.add(a)}n.active=s}this._sourceEvents=e,this._keyModifiers=r,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(e,r,i){this._latestPointerType=e;const n=this._get("latestPointerLocation");if(n==null||n.x!==r||n.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=r,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(e,r){if(e==="pointer-capture-lost"){const s=r;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(e,r);const i=this.test.timestamp!=null?this.test.timestamp:r.native?r.native.timestamp:void 0,n=r.native?r.native.cancelable:void 0;this._emitInputEventFromSource(e,r,i,n)}_updateKeyModifiers(e,r){if(!r)return;let i=!1;const n=()=>{if(!i){const a=new Set;this._activeKeyModifiers.forEach(l=>{a.add(l)}),this._activeKeyModifiers=a,i=!0}},s=(a,l)=>{l&&!this._activeKeyModifiers.has(a)?(n(),this._activeKeyModifiers.add(a)):!l&&this._activeKeyModifiers.has(a)&&(n(),this._activeKeyModifiers.delete(a))};if(e==="key-down"||e==="key-up"){const a=r.key;this._keyModifiers.has(a)&&s(a,e==="key-down")}const o=r.native;s("Alt",!(!o||!o.altKey)),s("Ctrl",!(!o||!o.ctrlKey)),s("Shift",!(!o||!o.shiftKey)),s("Meta",!(!o||!o.metaKey)),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new IEt((e,r,i)=>this._setLatestPointer(e,r,i)),this._multiTouchHandler=new LEt,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],Pn.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,Pn.INTERNAL)}_setPointerCapture(e,r,i,n){const s=e.name+"-"+r.priorityIndex,o=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,o),n?(o.add(s),o.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):o.has(s)&&(o.delete(s),o.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(e=>!e.removed),this.updateDependencies()}_emitInputEventFromSource(e,r,i,n){this._emitInputEvent(0,e,r,i,n)}_emitInputEvent(e,r,i,n,s,o){const a=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),l=s!==void 0&&s,c={event:new DEt(r,i,a,o||this._activeKeyModifiers,l),priorityIndex:e};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(e){this._currentPropagation={events:new mre,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:e.event.timestamp},this._currentPropagation.events.push(e),this._continuePropagation()}_continuePropagation(){var r,i;this._paused=!1;const e=this._currentPropagation;if(e){for(;e.events.length>0;){const{event:n,priorityIndex:s}=e.events.pop(),o=n.data&&n.data.eventId;if(!(o!=null&&this._stoppedPropagationEventIds.has(o)))for(e.currentHandler=this._handlersPriority[s];e.currentHandler;){if(e.currentHandler.removed)e.needsHandlerGarbageCollect=!0;else{if(e.currentHandler.active&&!n.shouldStopPropagation()&&((i=(r=e.currentHandler).eventCallback)==null||i.call(r,n)),n.shouldStopPropagation()){o!=null&&this._stoppedPropagationEventIds.add(o);break}if(n.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:n,priorityIndex:e.currentHandler.priorityIndex+1})}e.currentHandler=this._handlersPriority[e.currentHandler.priorityIndex+1]}}e.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(e){const r=new mre;r.push(e);const i=this._currentPropagation;if(i){for(;i.events.length;)r.push(i.events.pop());i.events=r,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(e,r){if(e.handler.hasSideEffects!==r.handler.hasSideEffects)return e.handler.hasSideEffects?1:-1;if(e.groupPriority!==r.groupPriority)return e.groupPriority>r.groupPriority?-1:1;for(const i of e.handler.incomingEventMatches)for(const n of r.handler.incomingEventMatches){if(i.eventType!==n.eventType)continue;const s=i.keyModifiers.filter(o=>n.keyModifiers.includes(o));if(s.length===i.keyModifiers.length!=(s.length===n.keyModifiers.length))return i.keyModifiers.length>n.keyModifiers.length?-1:1}return e.priorityIndex>r.priorityIndex?-1:1}_sortHandlersPriority(e){const r=[];for(const i of e){let n=0;for(;n<r.length&&this._compareHandlerPriority(i,r[n])>=0;)n++;r.splice(n,0,i)}return r}get debug(){const e=r=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},r(),this._setPointerCapture=i};return{injectEvent:(r,i)=>{e(()=>{this._onEventReceived(r,i)})},disablePointerCapture:e}}};d([p({readOnly:!0})],sp.prototype,"hasPendingInputs",null),d([p({constructOnly:!0})],sp.prototype,"eventSource",void 0),d([p({constructOnly:!0})],sp.prototype,"recognizers",void 0),d([p()],sp.prototype,"_latestPointerType",void 0),d([p()],sp.prototype,"latestPointerType",null),d([p()],sp.prototype,"multiTouchActive",null),d([p({readOnly:!0})],sp.prototype,"latestPointerLocation",void 0),d([p()],sp.prototype,"_paused",void 0),d([p({readOnly:!0})],sp.prototype,"updating",null),sp=d([I("esri.views.input.InputManager")],sp);let DEt=class{constructor(e,r,i,n,s){this.type=e,this.data=r,this.timestamp=i,this.modifiers=n,this.cancelable=s,this._propagationState=Vb.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=Vb.STOPPED}shouldStopPropagation(){return(this._propagationState&Vb.STOPPED)!=0}async(e){this._propagationState|=Vb.PAUSED;const r=(i,n)=>{this._propagationState&=~Vb.PAUSED;const s=this._resumeCallback;if(this._resumeCallback=null,s&&s(),n)throw i;return i};return(typeof e=="function"?e():e).then(i=>r(i,!1),i=>r(i,!0))}shouldPausePropagation(e){return!!(this._propagationState&Vb.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}};var Vb;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(Vb||(Vb={}));const Pn={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};let NEt=class{};const FEt=NEt;function Ag(t){return t!=null&&"open"in t&&"declaredClass"in t}function E1e(t){return t!=null&&"declaredClass"in t&&"dockOptions"in t}const kEt=t=>{let e=class extends t{constructor(){super(...arguments),this._popupSetupTask=null,this.popup={},this.popupEnabled=!0}initialize(){this.addHandles([pe(()=>[this.ui,this.popup],([r,i],n)=>{const s="popup",o="manual";if(n){const[a,l]=n;a&&Ag(l)&&(l.view=null,E1e(l)&&a.remove(l,s))}r&&Ag(i)&&(i.view=this,E1e(i)&&r.add(i,{key:s,position:o,internal:!0}))},_r),this.on("click",r=>{this.popup&&this.popupEnabled&&(r.pointerType!=="mouse"||r.button===0)&&(!Ag(this.popup)&&"autoOpenEnabled"in this.popup&&this.popup.autoOpenEnabled===!1||(Ag(this.popup)?this.popup.viewModel.handleViewClick(r):r.async(async()=>{await this.setupPopup(),Ag(this.popup)&&!this.destroyed&&this.ready&&this.popupEnabled&&this.popup.viewModel.handleViewClick(r)})))},Pn.WIDGET)]),Zw(()=>this.ready&&this.popupEnabled&&!this.updating).then(()=>{le(()=>import("./Popup-74f19d21.js").then(r=>r.a0),["assets/Popup-74f19d21.js","assets/unitFormatUtils-b0223a02.js","assets/AttachmentInfo-51785aa9.js","assets/symbolUtils-dcab99f5.js","assets/colorUtils-c0f43caf.js","assets/executeQueryJSON-fe09b3cb.js","assets/query-faa7dd63.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js"])})}destroy(){this.destroyed||this.closePopup()}async openPopup(r){Ag(this.popup)&&this.popup.open(r);try{if(await this.setupPopup(),!this.popup)return void re.getLogger(this).error(new H("view:null-popup","Popup is null and can't be opened"));this.popup.open(r)}catch{}}closePopup(){var r;(r=this._popupSetupTask)==null||r.abort(),Ag(this.popup)&&this.popup.close()}async fetchPopupFeatures(r,i){await this.when();const{location:n,queryArea:s,layerViewsAndGraphics:o,clientOnlyGraphics:a}=await this._prepareFetchPopupFeatures(r,i),l=Promise.resolve(a),c=this._queryLayerPopupFeatures(s,o,i),u=c.map(h=>h.promise);return{location:n,clientOnlyGraphics:a,allGraphicsPromise:gV([l,...u]).then(h=>Array.from(new Set(h.flat()))),promisesPerLayerView:c}}async setupPopup(){var r;if((r=this._popupSetupTask)==null||r.abort(),this.popup&&!Ag(this.popup))return this._popupSetupTask=R3(async i=>{const{default:n}=await le(()=>import("./Popup-74f19d21.js").then(o=>o.a0),["assets/Popup-74f19d21.js","assets/unitFormatUtils-b0223a02.js","assets/AttachmentInfo-51785aa9.js","assets/symbolUtils-dcab99f5.js","assets/colorUtils-c0f43caf.js","assets/executeQueryJSON-fe09b3cb.js","assets/query-faa7dd63.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js"]);if(vr(i),!this.popup||Ag(this.popup))return;const s=this.popup;delete s.open,delete s.close,this.popup=new n(s)}),this._popupSetupTask.promise}_queryLayerPopupFeatures(r,i,n){return i.map(({layerView:s,graphics:o})=>{const a={clientGraphics:o,event:n!=null?n.event:void 0,signal:n!=null?n.signal:void 0,defaultPopupTemplateEnabled:n!=null&&!!n.defaultPopupTemplateEnabled},l=s.fetchPopupFeatures(r,a);return{layerView:s,promise:l}})}_isValidPopupGraphic(r,i){return r&&!!r.getEffectivePopupTemplate(i!=null&&i.defaultPopupTemplateEnabled)}async _prepareFetchPopupFeatures(r,i){const{clientGraphics:n,queryArea:s,location:o}=await this._popupHitTestGraphics(r,i),a=this._getFetchPopupLayerViews(),{layerViewsAndGraphics:l,clientOnlyGraphics:c}=this._graphicsPerFetchPopupLayerView(n,a);return{clientOnlyGraphics:c,layerViewsAndGraphics:l,queryArea:s,location:o}}async _popupHitTestGraphics(r,i){const n=await this.popupHitTest(r),s=n.results,o=n.mapPoint,a=s.filter(c=>c.type==="graphic"&&this._isValidPopupGraphic(c.graphic,i)),l=a.length?a[0].mapPoint:null;return{clientGraphics:a.map(c=>c.graphic),queryArea:o,location:o||l}}_getFetchPopupLayerViews(){const r=[];return this.allLayerViews.forEach(i=>{this._isValidPopupLayerView(i)&&r.push(i)}),this.graphicsView!=null&&this._isValidPopupLayerView(this.graphicsView)&&r.push(this.graphicsView),r.reverse()}_isValidPopupLayerView(r){return r!=null&&(!("layer"in r)||!r.suspended)&&"fetchPopupFeatures"in r}_graphicsPerFetchPopupLayerView(r,i){const n=[],s=new Map,o=i.map(a=>{const l=[];return"layer"in a?s.set(a.layer,l):s.set(a.graphics,l),{layerView:a,graphics:l}});for(const a of r){const l=s.get(a.layer)||s.get(a.sourceLayer)||null;l?l.push(a):n.push(a)}return{layerViewsAndGraphics:o,clientOnlyGraphics:n}}};return d([p({cast(r){return!r||Ag(r)||typeof r=="object"&&(r.open=i=>(CV(re.getLogger(this),"view.popup is no longer created by default. view.popup.open() will stop working when the popup isn't created",{replacement:"Use view.openPopup() instead.",version:"4.27"}),this.openPopup(i)),r.close=()=>(CV(re.getLogger(this),"view.popup is no longer created by default. view.popup.close() will stop working when the popup isn't created",{replacement:"Use view.closePopup() instead.",version:"4.27"}),this.closePopup())),r}})],e.prototype,"popup",void 0),d([p()],e.prototype,"popupEnabled",void 0),e=d([I("esri.views.PopupView")],e),e};let C2=class extends hD{_own(e){e.layer&&"remove"in e.layer&&e.layer!==this.owner&&e.layer.remove(e),e.layer=this.owner}_release(e){e.layer===this.owner&&(e.layer=null)}};d([fce({Type:cf,ensureType:ls(cf)})],C2.prototype,"itemType",void 0),C2=d([I("esri.support.GraphicsCollection")],C2);const C1e=new Map([["AUS Central Standard Time","Australia/Darwin"],["AUS Eastern Standard Time","Australia/Sydney"],["Afghanistan Standard Time","Asia/Kabul"],["Alaskan Standard Time","America/Anchorage"],["Aleutian Standard Time","America/Adak"],["Altai Standard Time","Asia/Barnaul"],["Arab Standard Time","Asia/Riyadh"],["Arabian Standard Time","Asia/Dubai"],["Arabic Standard Time","Asia/Baghdad"],["Argentina Standard Time","America/Buenos_Aires"],["Astrakhan Standard Time","Europe/Astrakhan"],["Atlantic Standard Time","America/Halifax"],["Aus Central W. Standard Time","Australia/Eucla"],["Azerbaijan Standard Time","Asia/Baku"],["Azores Standard Time","Atlantic/Azores"],["Bahia Standard Time","America/Bahia"],["Bangladesh Standard Time","Asia/Dhaka"],["Belarus Standard Time","Europe/Minsk"],["Bougainville Standard Time","Pacific/Bougainville"],["Canada Central Standard Time","America/Regina"],["Cape Verde Standard Time","Atlantic/Cape_Verde"],["Caucasus Standard Time","Asia/Yerevan"],["Cen. Australia Standard Time","Australia/Adelaide"],["Central America Standard Time","America/Guatemala"],["Central Asia Standard Time","Asia/Almaty"],["Central Brazilian Standard Time","America/Cuiaba"],["Central Europe Standard Time","Europe/Budapest"],["Central European Standard Time","Europe/Warsaw"],["Central Pacific Standard Time","Pacific/Guadalcanal"],["Central Standard Time","America/Chicago"],["Central Standard Time (Mexico)","America/Mexico_City"],["Chatham Islands Standard Time","Pacific/Chatham"],["China Standard Time","Asia/Shanghai"],["Cuba Standard Time","America/Havana"],["Dateline Standard Time","Etc/GMT+12"],["E. Africa Standard Time","Africa/Nairobi"],["E. Australia Standard Time","Australia/Brisbane"],["E. Europe Standard Time","Europe/Chisinau"],["E. South America Standard Time","America/Sao_Paulo"],["Easter Island Standard Time","Pacific/Easter"],["Eastern Standard Time","America/New_York"],["Eastern Standard Time (Mexico)","America/Cancun"],["Egypt Standard Time","Africa/Cairo"],["Ekaterinburg Standard Time","Asia/Yekaterinburg"],["FLE Standard Time","Europe/Kiev"],["Fiji Standard Time","Pacific/Fiji"],["GMT Standard Time","Europe/London"],["GTB Standard Time","Europe/Bucharest"],["Georgian Standard Time","Asia/Tbilisi"],["Greenland Standard Time","America/Godthab"],["Greenwich Standard Time","Atlantic/Reykjavik"],["Haiti Standard Time","America/Port-au-Prince"],["Hawaiian Standard Time","Pacific/Honolulu"],["India Standard Time","Asia/Calcutta"],["Iran Standard Time","Asia/Tehran"],["Israel Standard Time","Asia/Jerusalem"],["Jordan Standard Time","Asia/Amman"],["Kaliningrad Standard Time","Europe/Kaliningrad"],["Korea Standard Time","Asia/Seoul"],["Libya Standard Time","Africa/Tripoli"],["Line Islands Standard Time","Pacific/Kiritimati"],["Lord Howe Standard Time","Australia/Lord_Howe"],["Magadan Standard Time","Asia/Magadan"],["Magallanes Standard Time","America/Punta_Arenas"],["Marquesas Standard Time","Pacific/Marquesas"],["Mauritius Standard Time","Indian/Mauritius"],["Middle East Standard Time","Asia/Beirut"],["Montevideo Standard Time","America/Montevideo"],["Morocco Standard Time","Africa/Casablanca"],["Mountain Standard Time","America/Denver"],["Mountain Standard Time (Mexico)","America/Mazatlan"],["Myanmar Standard Time","Asia/Rangoon"],["N. Central Asia Standard Time","Asia/Novosibirsk"],["Namibia Standard Time","Africa/Windhoek"],["Nepal Standard Time","Asia/Katmandu"],["New Zealand Standard Time","Pacific/Auckland"],["Newfoundland Standard Time","America/St_Johns"],["Norfolk Standard Time","Pacific/Norfolk"],["North Asia East Standard Time","Asia/Irkutsk"],["North Asia Standard Time","Asia/Krasnoyarsk"],["North Korea Standard Time","Asia/Pyongyang"],["Omsk Standard Time","Asia/Omsk"],["Pacific SA Standard Time","America/Santiago"],["Pacific Standard Time","America/Los_Angeles"],["Pacific Standard Time (Mexico)","America/Tijuana"],["Pakistan Standard Time","Asia/Karachi"],["Paraguay Standard Time","America/Asuncion"],["Qyzylorda Standard Time","Asia/Qyzylorda"],["Romance Standard Time","Europe/Paris"],["Russia Time Zone 10","Asia/Srednekolymsk"],["Russia Time Zone 11","Asia/Kamchatka"],["Russia Time Zone 3","Europe/Samara"],["Russian Standard Time","Europe/Moscow"],["SA Eastern Standard Time","America/Cayenne"],["SA Pacific Standard Time","America/Bogota"],["SA Western Standard Time","America/La_Paz"],["SE Asia Standard Time","Asia/Bangkok"],["Saint Pierre Standard Time","America/Miquelon"],["Sakhalin Standard Time","Asia/Sakhalin"],["Samoa Standard Time","Pacific/Apia"],["Sao Tome Standard Time","Africa/Sao_Tome"],["Saratov Standard Time","Europe/Saratov"],["Singapore Standard Time","Asia/Singapore"],["South Africa Standard Time","Africa/Johannesburg"],["South Sudan Standard Time","Africa/Juba"],["Sri Lanka Standard Time","Asia/Colombo"],["Sudan Standard Time","Africa/Khartoum"],["Syria Standard Time","Asia/Damascus"],["Taipei Standard Time","Asia/Taipei"],["Tasmania Standard Time","Australia/Hobart"],["Tocantins Standard Time","America/Araguaina"],["Tokyo Standard Time","Asia/Tokyo"],["Tomsk Standard Time","Asia/Tomsk"],["Tonga Standard Time","Pacific/Tongatapu"],["Transbaikal Standard Time","Asia/Chita"],["Turkey Standard Time","Europe/Istanbul"],["Turks And Caicos Standard Time","America/Grand_Turk"],["US Eastern Standard Time","America/Indianapolis"],["US Mountain Standard Time","America/Phoenix"],["UTC","Etc/GMT"],["UTC+01","Etc/GMT-1"],["UTC+02","Etc/GMT-2"],["UTC+03","Etc/GMT-3"],["UTC+04","Etc/GMT-4"],["UTC+05","Etc/GMT-5"],["UTC+06","Etc/GMT-6"],["UTC+07","Etc/GMT-7"],["UTC+08","Etc/GMT-8"],["UTC+09","Etc/GMT-9"],["UTC+10","Etc/GMT-10"],["UTC+11","Etc/GMT-11"],["UTC+12","Etc/GMT-12"],["UTC+13","Etc/GMT-13"],["UTC+14","Etc/GMT-14"],["UTC-01","Etc/GMT+1"],["UTC-02","Etc/GMT+2"],["UTC-03","Etc/GMT+3"],["UTC-04","Etc/GMT+4"],["UTC-05","Etc/GMT+5"],["UTC-06","Etc/GMT+6"],["UTC-07","Etc/GMT+7"],["UTC-08","Etc/GMT+8"],["UTC-09","Etc/GMT+9"],["UTC-10","Etc/GMT+10"],["UTC-11","Etc/GMT+11"],["UTC-12","Etc/GMT+12"],["Ulaanbaatar Standard Time","Asia/Ulaanbaatar"],["Venezuela Standard Time","America/Caracas"],["Vladivostok Standard Time","Asia/Vladivostok"],["Volgograd Standard Time","Europe/Volgograd"],["W. Australia Standard Time","Australia/Perth"],["W. Central Africa Standard Time","Africa/Lagos"],["W. Europe Standard Time","Europe/Berlin"],["W. Mongolia Standard Time","Asia/Hovd"],["West Asia Standard Time","Asia/Tashkent"],["West Bank Standard Time","Asia/Hebron"],["West Pacific Standard Time","Pacific/Port_Moresby"],["Yakutsk Standard Time","Asia/Yakutsk"],["Yukon Standard Time","America/Whitehorse"]]);function UEt(t,e="system"){if(!t||!C1e.has(t.timeZone))return e;const r=C1e.get(t.timeZone);return VEt(t.timeZone)||t.respectsDaylightSaving?r:zEt(r)}function zEt(t){const e=zr.local().setZone(t),r=Math.min(e.set({month:1,day:1}).offset,e.set({month:5}).offset);return r===0?"Etc/UTC":`Etc/GMT${wc.instance(-r).formatOffset(0,"narrow")}`}function VEt(t){return t.startsWith("UTC")}let mb=class extends Rn(me){constructor(e){super(e),this.legacy=null,this.timeZone="system"}readLegacy(e,r){const{timeZone:i,respectsDaylightSaving:n}=r;return{timeZone:i,respectsDaylightSaving:n}}readTimeZone(e,r){return"timeZoneIANA"in r?r.timeZoneIANA:UEt(r)}writeTimeZone(e,r){r.timeZoneIANA=e}equals(e){return e!=null&&this.timeZone!=null&&e.timeZone!=null&&this.timeZone===e.timeZone}};d([p()],mb.prototype,"legacy",void 0),d([ke("legacy",["timeZone"])],mb.prototype,"readLegacy",null),d([p({type:String,nonNullable:!0})],mb.prototype,"timeZone",void 0),d([ke("timeZone",["timeZone","timeZoneIANA","respectsDaylightSaving"])],mb.prototype,"readTimeZone",null),d([tt("timeZone")],mb.prototype,"writeTimeZone",null),mb=d([I("esri.time.TimeReference")],mb);const zP=mb;let gb=class extends Ce{constructor(e){super(e),this.view=null,this.baseLayerViews=new vt,this.referenceLayerViews=new vt,this._loadingHandle=pe(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap},r=>{r&&r.load().catch(()=>{})},_r)}destroy(){this._set("view",null),this._loadingHandle&&(this._loadingHandle.remove(),this._loadingHandle=null);for(const e of this.baseLayerViews)e.destroy();this.baseLayerViews.length=0;for(const e of this.referenceLayerViews)e.destroy();this.referenceLayerViews.length=0}get suspended(){return!this.view||this.view.suspended}get updating(){var r,i;if(this.view&&this.view.suspended)return!1;const e=(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.basemap;return!!e&&!!e.loaded&&(this.baseLayerViews.some(n=>n.updating)||this.referenceLayerViews.some(n=>n.updating))}};d([p({constructOnly:!0})],gb.prototype,"view",void 0),d([p({readOnly:!0})],gb.prototype,"baseLayerViews",void 0),d([p({readOnly:!0})],gb.prototype,"referenceLayerViews",void 0),d([p({readOnly:!0})],gb.prototype,"suspended",null),d([p({type:Boolean,readOnly:!0})],gb.prototype,"updating",null),gb=d([I("esri.views.BasemapView")],gb);function BEt(t){return"tryRecycleWith"in t}let jEt=class{constructor(e,r,i){this.layer=e,this.view=r,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=Da(),this._started=!1,this.done=!1,this.promise=this._deferred.promise,Dl(this._controller.signal,()=>{const n=new H("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(n)})}tryRecycle(e){if(!this.done||!this.layerView||!BEt(this.layerView))return null;const r=this.layer.type,i=this._controller.signal;for(let n=0;n<e.length;n++){const s=e[n];if(s.type!==r)continue;const o=this.layerView.tryRecycleWith(s,{signal:i});if(o){e.splice(n,1),this.layer=s;const a=this.layerView,l=a.view;return this.promise=Promise.race([o.then(()=>(vr(this._controller.signal),s.emit("layerview-destroy",{view:l,layerView:a}),l.emit("layerview-destroy",{view:l,layerView:a}),s.emit("layerview-create",{view:l,layerView:a}),l.emit("layerview-create",{view:l,layerView:a}),a)),new Promise((c,u)=>Dl(this._controller.signal,()=>u(Wr())))]),this.promise}}return null}destroy(){this._controller.abort();const{layerView:e}=this;if(e){const{layer:r,view:i}=this;r.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:r,layerView:e})}this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null,this._map=null}async start(){var n,s,o;if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:r,view:i}=this;this._map=i.map;try{let a,l;if(await r.load({signal:e}),"prefetchResources"in r&&await((n=r.prefetchResources)==null?void 0:n.call(r,{signal:e})),HEt(r))a=await r.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(r))throw new H("layer:view-not-supported","No layerview implementation was found");const h=await this.layerViewImporter.importLayerView(r);vr(e),a="default"in h?new h.default({layer:r,view:i}):new h({layer:r,view:i})}const c=()=>{l=yi(l),a.destroyed||a.destroy(),a.layer=null,a.parent=null,a.view=null,this.done=!0};l=Dl(e,c),vr(e);try{await a.when()}catch(h){throw c(),h}if(!((o=(s=this._map)==null?void 0:s.allLayers)==null?void 0:o.includes(r)))return c(),void this._deferred.reject(new H("view:no-layerview-for-layer","The layer has been removed from the map",{layer:r}));this.layerView=a,r.emit("layerview-create",{view:i,layerView:a}),i.emit("layerview-create",{layer:r,layerView:a}),this.done=!0,this._deferred.resolve(a)}catch(a){r.emit("layerview-create-error",{view:i,error:a}),i.emit("layerview-create-error",{layer:r,error:a}),this.done=!0,this._deferred.reject(new H("layerview:create-error","layerview creation failed",{layer:r,error:a}))}}},op=class extends Ce{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._recyclingInfoMap=new Map,this._watchUpdatingTracking=new Yy,this.supportsGround=!0,this._preloadLayerViewModules=()=>{var i;const r=(i=this.view.map)==null?void 0:i.allLayers;if(r)for(const n of r)this.layerViewImporter.hasLayerViewModule(n)&&this.layerViewImporter.importLayerView(n)},this._reschedule=()=>this.destroyed?Promise.reject():(this._workPromise==null&&(this._workPromise=Da(),this._workPromise.promise.catch(()=>{})),this.removeHandles("reschedule"),this.addHandles(T3(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{var l,c,u;if(this.destroyed)return;const r=this.view.map;if(this._map!==r&&(this.clear(),this._map=r),this._workPromise==null)return void this.notifyChange("updating");this.removeHandles("reschedule"),this.removeHandles("collection-change");const i=new Set,n=[],s=this.view.ready,o=h=>{if(h!=null){for(const f of h)if(f){i.add(f);const m=this._layerLayerViewInfoMap.get(f);m&&s?m.start():m||this._recyclingInfoMap.has(f)||n.push(f),"layers"in f&&f.layers&&o(f.layers)}}};for(const h of this._rootCollectionNames)o(this.get(h));for(const[h,f]of this._layerLayerViewInfoMap)if(!i.has(h)){this._layerLayerViewInfoMap.delete(f.layer);const m=f.tryRecycle(n);m?(this.notifyChange("updating"),this._recyclingInfoMap.set(f.layer,f),m.then(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),this._layerLayerViewInfoMap.set(f.layer,f),this._reschedule()}).catch(()=>{this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy(),this._reschedule()})):f.destroy()}for(const[h,f]of this._recyclingInfoMap)i.has(h)||(this.notifyChange("updating"),this._recyclingInfoMap.delete(f.layer),f.destroy());for(const h of n)this._createLayerView(h);this._refreshCollections();const a=[(l=r==null?void 0:r.ground)==null?void 0:l.layers,(c=r==null?void 0:r.basemap)==null?void 0:c.baseLayers,(u=r==null?void 0:r.basemap)==null?void 0:u.referenceLayers,r==null?void 0:r.layers].filter(h=>!!h);i.forEach(h=>"layers"in h&&a.push(h.layers)),this.addHandles(a.map(h=>this._watchUpdatingTracking.addOnCollectionChange(()=>h,this._reschedule)),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.own([da(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.allLayers},"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),pe(()=>{const e=this.view,r=e==null?void 0:e.map;return[r==null?void 0:r.basemap,r==null?void 0:r.ground,r==null?void 0:r.layers,e==null?void 0:e.ready]},()=>this._reschedule(),Bi)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),KW(this._recyclingInfoMap),KW(this._layerLayerViewInfoMap),this._watchUpdatingTracking.destroy(),this._map=null,this._workPromise!=null&&(this._workPromise.reject(Wr()),this._workPromise=null)}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return this._workPromise!=null||this._watchUpdatingTracking.updating||Pa(this._layerLayerViewInfoMap,e=>!e.done)||this._recyclingInfoMap.size>0}get updatingRemaining(){let e=0;for(const r of this._layerLayerViewInfoMap.values())r.done||++e;return e}clear(){this.destroyed||(KW(this._layerLayerViewInfoMap),this._refreshCollections())}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e)){if(this._recyclingInfoMap.has(e))return this._recyclingInfoMap.get(e).promise;throw new H("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e})}return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,r]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(r),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,r,i){if(!e||!r)return void(r&&r.removeAll());let n=0;for(const s of e){const o=this._layerLayerViewInfoMap.get(s);if(!o||!o.layerView)continue;const a=o.layerView;a.layer=s,a.parent=i,r.at(n)!==a&&r.splice(n,0,a),s.layers&&this._populateLayerViewsOwners(s.layers,a.layerViews,a),n+=1}n<r.length&&r.splice(n,r.length)}_createLayerView(e){e.load().catch(()=>{}),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const r=new jEt(e,this.view,this.layerViewImporter);r.promise.then(()=>this._refreshCollections(),i=>{i&&(Yn(i)||i.name==="cancelled:layerview-create")||re.getLogger(this).error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:i}),this._refreshCollections()}),this._layerLayerViewInfoMap.set(e,r),this.view.ready&&r.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};d([p()],op.prototype,"_workPromise",void 0),d([p({readOnly:!0})],op.prototype,"_watchUpdatingTracking",void 0),d([p({readOnly:!0})],op.prototype,"_layersToLayerViews",null),d([p({readOnly:!0})],op.prototype,"_rootCollectionNames",null),d([p()],op.prototype,"layerViewImporter",void 0),d([p()],op.prototype,"supportsGround",void 0),d([p({readOnly:!0})],op.prototype,"updating",null),d([p({readOnly:!0})],op.prototype,"updatingRemaining",null),d([p({constructOnly:!0})],op.prototype,"view",void 0),op=d([I("esri.views.LayerViewManager")],op);const GEt=op;function HEt(t){return"createLayerView"in t&&t.createLayerView!=null}let zd=class extends Ce{constructor(e){super(e),this.factor=1.5,this.offset=Oh(0,0),this.position=null,this.size=120,this.maskUrl=null,this.maskEnabled=!0,this.overlayUrl=null,this.overlayEnabled=!0,this.visible=!0}get version(){return this.commitProperty("factor"),this.commitProperty("offset"),this.commitProperty("position"),this.commitProperty("visible"),this.commitProperty("size"),this.commitProperty("maskUrl"),this.commitProperty("maskEnabled"),this.commitProperty("overlayUrl"),this.commitProperty("overlayEnabled"),(this._get("version")||0)+1}};d([p({type:Number})],zd.prototype,"factor",void 0),d([p({nonNullable:!0})],zd.prototype,"offset",void 0),d([p()],zd.prototype,"position",void 0),d([p({type:Number,range:{min:0}})],zd.prototype,"size",void 0),d([p()],zd.prototype,"maskUrl",void 0),d([p()],zd.prototype,"maskEnabled",void 0),d([p()],zd.prototype,"overlayUrl",void 0),d([p()],zd.prototype,"overlayEnabled",void 0),d([p({readOnly:!0})],zd.prototype,"version",null),d([p({type:Boolean})],zd.prototype,"visible",void 0),zd=d([I("esri.views.Magnifier")],zd);const Dke=zd;let XO=class extends Ce{constructor(e,r){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=(r==null?void 0:r.registerTask(Vt.TEXTURE_UNLOAD))??FP}normalizeCtorArgs(){return{}}destroy(){var e,r,i;super.destroy(),(e=this._frameTask)==null||e.remove(),(r=this._textureRequests)==null||r.forEach(n=>this._releaseTextureRequest(n)),(i=this._textureRequests)==null||i.clear()}get updating(){return this._frameTask.updating}fromData(e,r,i){var o,a;const n=this.makeUid(e);let s=this._textureRequests.get(n);if(!s){const l=new Nke(i);l.texture=r(),(o=this._stage)==null||o.add(l.texture),(a=this._stage)==null||a.loadImmediate(l.texture),this._textureRequests.set(n,l),s=l}return s.referenceCount++,{uid:n,texture:s.texture,release:()=>this._release(n)}}_release(e){const r=this._textureRequests.get(e);r?(r.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),r.referenceCount--,r.referenceCount<1&&this._frameTask.schedule(()=>this._releaseNow(e))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const r=this._textureRequests.get(e);!r||r.referenceCount>0||(this._releaseTextureRequest(r),this._textureRequests.delete(e))}_releaseTextureRequest(e){var r;e.onRemove&&e.onRemove(),e.texture?(r=this._stage)==null||r.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,r=null){return r!=null?`${e}.${r}px`:e}};d([p()],XO.prototype,"_frameTask",void 0),d([p()],XO.prototype,"updating",null),XO=d([I("esri.views.3d.support.TextureCollection")],XO);let Nke=class{constructor(e){this.onRemove=e,this.referenceCount=0}};var R1e;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right"})(R1e||(R1e={}));const Fke=["click","double-click","immediate-click","immediate-double-click","hold","drag","key-down","key-up","pointer-down","pointer-move","pointer-up","pointer-drag","mouse-wheel","pointer-enter","pointer-leave","gamepad","focus","blur"],kke={};function Uke(t){return!!kke[t]}function qEt(t){for(const e of t)if(!Uke(e))return!1;return!0}Fke.forEach(t=>{kke[t]=!0});let WEt=class{constructor(e){this._handlers=new Map,this._counter=0,this._handlerCounts=new Map,this.view=e,this.inputManager=null}connect(e){e&&this.disconnect(),this.inputManager=e,this._handlers.forEach(({handler:r,priority:i},n)=>{var s;return(s=this.inputManager)==null?void 0:s.installHandlers(n,[r],i)})}disconnect(){this.inputManager&&this._handlers.forEach((e,r)=>{var i;return(i=this.inputManager)==null?void 0:i.uninstallHandlers(r)}),this.inputManager=null}destroy(){this.disconnect(),this._handlers.clear(),this.view=null}on(e,r,i,n){const s=Array.isArray(e)?e:e.split(",");if(!qEt(s))return s.some(Uke)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;let o,a;Array.isArray(r)?a=r:(o=r,a=[]),typeof i=="function"?o=i:n=i,n=n??Pn.DEFAULT;const l=this._createUniqueGroupName(),c=new XEt(this.view,s,a,o);this._handlers.set(l,{handler:c,priority:n});for(const u of s){const h=this._handlerCounts.get(u)||0;this._handlerCounts.set(u,h+1)}return this.inputManager&&this.inputManager.installHandlers(l,[c],n),{remove:()=>this._removeHandler(l,s)}}hasHandler(e){return!!this._handlerCounts.get(e)}_removeHandler(e,r){if(this._handlers.has(e)){this._handlers.delete(e);for(const i of r){const n=this._handlerCounts.get(i);n===void 0?console.error("Trying to remove handler for event that has no handlers registered: ",i):n===1?this._handlerCounts.delete(i):this._handlerCounts.set(i,n-1)}}this.inputManager&&this.inputManager.uninstallHandlers(e)}_createUniqueGroupName(){return this._counter+=1,`viewEvents_${this._counter}`}},XEt=class extends Ua{constructor(e,r,i,n){super(!0),this._latestDragStart=void 0,this.view=e;for(const s of r)switch(s){case"click":this.registerIncoming("click",i,o=>n(this._wrapClick(o)));break;case"double-click":this.registerIncoming("double-click",i,o=>n(this._wrapDoubleClick(o)));break;case"immediate-click":this.registerIncoming("immediate-click",i,o=>n(this._wrapImmediateClick(o)));break;case"immediate-double-click":this.registerIncoming("immediate-double-click",i,o=>n(this._wrapImmediateDoubleClick(o)));break;case"hold":this.registerIncoming("hold",i,o=>n(this._wrapHold(o)));break;case"drag":this.registerIncoming("drag",i,o=>{const a=this._wrapDrag(o);a&&n(a)});break;case"key-down":this.registerIncoming("key-down",i,o=>n(this._wrapKeyDown(o)));break;case"key-up":this.registerIncoming("key-up",i,o=>n(this._wrapKeyUp(o)));break;case"pointer-down":this.registerIncoming("pointer-down",i,o=>n(this._wrapPointer(o,"pointer-down")));break;case"pointer-move":this.registerIncoming("pointer-move",i,o=>n(this._wrapPointer(o,"pointer-move")));break;case"pointer-up":this.registerIncoming("pointer-up",i,o=>n(this._wrapPointer(o,"pointer-up")));break;case"pointer-drag":this.registerIncoming("pointer-drag",i,o=>n(this._wrapPointerDrag(o)));break;case"mouse-wheel":this.registerIncoming("mouse-wheel",i,o=>n(this._wrapMouseWheel(o)));break;case"pointer-enter":this.registerIncoming("pointer-enter",i,o=>n(this._wrapPointer(o,"pointer-enter")));break;case"pointer-leave":this.registerIncoming("pointer-leave",i,o=>n(this._wrapPointer(o,"pointer-leave")));break;case"gamepad":this.registerIncoming("gamepad",i,o=>{n(this._wrapGamepad(o))});break;case"focus":this.registerIncoming("focus",i,o=>{n(this._wrapFocus(o))});break;case"blur":this.registerIncoming("blur",i,o=>{n(this._wrapBlur(o))})}}_wrapFocus(e){return{type:"focus",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapBlur(e){return{type:"blur",timestamp:e.timestamp,native:e.data.native,cancelable:e.cancelable,stopPropagation:()=>e.stopPropagation(),async:r=>e.async(r),preventDefault:()=>e.preventDefault()}}_wrapClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,screenPoint:Oh(s,o),mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_wrapDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,{cancelable:c,timestamp:u}=e;return{type:"double-click",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:u,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:c,stopPropagation:()=>e.stopPropagation(),async:h=>e.async(h),preventDefault:()=>e.preventDefault()}}_wrapImmediateClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapImmediateDoubleClick(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a,eventId:l}=e.data,c=a.pointerId,{cancelable:u,timestamp:h}=e;return{type:"immediate-double-click",pointerId:c,pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:h,mapPoint:this._getMapPoint(s,o),eventId:l,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:f=>e.async(f),preventDefault:()=>e.preventDefault()}}_wrapHold(e){const{pointerType:r,button:i,buttons:n,x:s,y:o,native:a}=e.data,{cancelable:l,timestamp:c}=e;return{type:"hold",pointerType:r,button:i,buttons:n,x:s,y:o,native:a,timestamp:c,mapPoint:this._getMapPoint(s,o),cancelable:l,stopPropagation:()=>e.stopPropagation(),async:u=>e.async(u),preventDefault:()=>e.preventDefault()}}_getMapPoint(e,r){return this.view.toMap(Oh(e,r),{exclude:[]})}_wrapDrag(e){const r=e.data,{x:i,y:n}=r.center,{action:s,pointerType:o,button:a}=r;if(s==="start"&&(this._latestDragStart=r),!this._latestDragStart)return;const l=r.pointer.native,c=r.buttons,{cancelable:u,timestamp:h}=e,f={x:this._latestDragStart.center.x,y:this._latestDragStart.center.y};return s==="end"&&(this._latestDragStart=void 0),{type:"drag",action:s,x:i,y:n,origin:f,pointerType:o,button:a,buttons:c,radius:r.radius,angle:Oc(r.angle),native:l,timestamp:h,cancelable:u,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapKeyDown(e){const{key:r,repeat:i,native:n}=e.data,{cancelable:s,timestamp:o}=e;return{type:"key-down",key:r,repeat:i,native:n,timestamp:o,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:a=>e.async(a),preventDefault:()=>e.preventDefault()}}_wrapKeyUp(e){const{key:r,native:i}=e.data,{cancelable:n,timestamp:s}=e;return{type:"key-up",key:r,native:i,timestamp:s,cancelable:n,stopPropagation:()=>e.stopPropagation(),async:o=>e.async(o),preventDefault:()=>e.preventDefault()}}_wrapPointer(e,r){const{x:i,y:n,button:s,buttons:o,native:a,eventId:l}=e.data,c=a.pointerId,u=a.pointerType,{cancelable:h,timestamp:f}=e;return{type:r,x:i,y:n,pointerId:c,pointerType:u,button:s,buttons:o,native:a,timestamp:f,eventId:l,cancelable:h,stopPropagation:()=>e.stopPropagation(),async:m=>e.async(m),preventDefault:()=>e.preventDefault()}}_wrapPointerDrag(e){const{x:r,y:i,buttons:n,native:s,eventId:o}=e.data.currentEvent,{button:a}=e.data.startEvent,l=e.data.startEvent.native.pointerId,c=e.data.startEvent.native.pointerType,u=e.data.action,h={x:e.data.startEvent.x,y:e.data.startEvent.y},{cancelable:f,timestamp:m}=e;return{type:"pointer-drag",x:r,y:i,pointerId:l,pointerType:c,button:a,buttons:n,action:u,origin:h,native:s,timestamp:m,eventId:o,cancelable:f,stopPropagation:()=>e.stopPropagation(),async:g=>e.async(g),preventDefault:()=>e.preventDefault()}}_wrapMouseWheel(e){const{cancelable:r,data:i,timestamp:n}=e,{x:s,y:o,deltaY:a,native:l}=i;return{type:"mouse-wheel",x:s,y:o,deltaY:a,native:l,timestamp:n,cancelable:r,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}_wrapGamepad(e){const{action:r,state:i,device:n}=e.data,{cancelable:s,timestamp:o}=e,{buttons:a,axes:l}=i;return{type:"gamepad",device:n,timestamp:o,action:r,buttons:a,axes:l,cancelable:s,stopPropagation:()=>e.stopPropagation(),async:c=>e.async(c),preventDefault:()=>e.preventDefault()}}};var VN,O1e,A1e;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(VN||(VN={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(O1e||(O1e={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(A1e||(A1e={}));function YEt(t){return[t.on("before-add",e=>{const r=e.item;if(r==null||t.includes(r))return re.getLogger("esri.views.interactive.interactiveToolUtils").warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void e.preventDefault();r.onAdd()}),t.on("after-remove",e=>{const r=e.item;r.active&&(r.view.activeTool=null),r.destroy()})]}function Tre(t){return t.visible&&t.getEditableFlag!=null&&t.getEditableFlag(VN.USER)&&t.getEditableFlag(VN.MANAGER)}function gp(t){return Oh(t.x,t.y)}function kmr(t){return Tn(t.x,t.y)}function zke(t,e){var i;const r=(i=t instanceof HTMLElement?t:t.surface)==null?void 0:i.getBoundingClientRect();return r?Oh(e.clientX-r.left,e.clientY-r.top):Oh(0,0)}function P1e(t,e){return e instanceof Event?zke(t,e):gp(e)}function M1e(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}let ZEt=class{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._revertToNullActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}hasFocusedManipulators(){return this._grabbedManipulators.size>0||this._draggedManipulators.size>0}handleInputEvent(e,r){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":$1e(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),e.action==="end"&&(this._stopDrag=!1));break;case"pointer-down":{if(!I1e(e))break;const n=gp(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(s==null)break;const o=s.manipulator,a=s.tool;o==null||a==null||!o.interactive||o.grabbable&&o.grabbableForEvent(e)||!o.grabbing||o.dragging||this._ungrabManipulatorBeforeDragging(o,e,r),o!=null&&a!=null&&o.interactive&&o.grabbable&&o.grabbableForEvent(e)&&!o.grabbing&&(this._grabbedManipulators.set(e.pointerId,{manipulator:o,tool:a,start:n,pointerType:e.pointerType}),this._grabbedManipulators.size===1&&r.activeTool==null&&(this._revertToNullActiveTool=!0,r.setActiveTool(s.tool)),o.grabbing=!0,o.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:n}),i());break}case"pointer-up":this._draggedManipulators.has(e.pointerId)||this._handlePointerEnd(e,r);break;case"pointer-drag":{if(!I1e(e))break;const n=this._grabbedManipulators.get(e.pointerId),s=rd(n,({manipulator:u})=>u),o=rd(n,({tool:u})=>u);if(s==null||o==null)break;const a=gp(e);a.x=Te(a.x,0,r.view.width),a.y=Te(a.y,0,r.view.height);const l=n.start,c=this._draggedManipulators.get(e.pointerId);switch(e.action){case"start":case"update":e.action!=="update"&&this._grabbedManipulators.size!==1||(s.dragging=!0,c?s.events.emit("drag",{action:"update",start:l,screenPoint:a}):s.events.emit("drag",{action:"start",start:l,screenPoint:a,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{tool:o,manipulator:s,start:l}));break;case"end":s.dragging=!1,c&&s.events.emit("drag",{action:"end",start:l,screenPoint:a}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,r)}i();break}case"immediate-click":{const n=gp(e),s=this._intersect(n,e.pointerType,r.forEachTool);if(JEt(e)||r.forEachTool(c=>{if((s==null||s.tool!==c||c.automaticManipulatorSelection)&&c.manipulators){let u=!1;c.manipulators.forEach(({manipulator:h})=>{h.selected&&(h.selected=!1,u=!0)}),u&&c.onManipulatorSelectionChanged&&c.onManipulatorSelectionChanged()}}),s==null)break;const{manipulator:o,tool:a}=s;if(!o.interactive)break;o.selectable&&a.automaticManipulatorSelection&&(o.selected=!o.selected,a.onManipulatorSelectionChanged&&a.onManipulatorSelectionChanged());const l=e.native.shiftKey;o.events.emit("immediate-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const n=gp(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit(e.type,{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const n=gp(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const n=gp(e),s=this._intersect(n,e.pointerType,r.forEachTool),o=s!=null?s.manipulator:null;if(o==null||!o.interactive)break;const a=e.native.shiftKey;o.events.emit("immediate-double-click",{screenPoint:n,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(r.forEachTool)}_ungrabManipulatorBeforeDragging(e,r,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:r.pointerType,screenPoint:gp(r)}),this._grabbedManipulators.forEach(({manipulator:n},s)=>{n===e&&this._grabbedManipulators.delete(s)}),this._afterManipulatorUngrab(i.setActiveTool)}_handlePointerEnd(e,r){const i=rd(this._grabbedManipulators.get(e.pointerId),({manipulator:n})=>n);i!=null&&i.grabbing&&(i.grabbing=!1,i.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:gp(e)}),this._grabbedManipulators.delete(e.pointerId),this._afterManipulatorUngrab(r.setActiveTool))}_cursorFromMap(e){let r=null;return Pa(e,({manipulator:i})=>!(i==null||!i.interactive)&&(i.grabbing&&i.grabCursor?(r=i.grabCursor,!0):!!i.cursor&&(r=i.cursor,!0))),r}_onFocusChange(e){this._updateCursor(),this._updateFocusedManipulatorTools(e)}_updateCursor(){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const r=new Set,i=new Set;this._grabbedManipulators.forEach(({tool:n})=>{r.add(n)}),this._hoveredManipulators.forEach(({tool:n})=>{i.add(n)}),e(n=>{n.hasGrabbedManipulators=r.has(n),n.hasHoveredManipulators=i.has(n);const s=this._grabbedManipulators.values(),o=kut(s,({tool:a})=>a===n);n.firstGrabbedManipulator=o!=null?o.manipulator:null})}clearPointers(e,{forEachTool:r,setActiveTool:i},n=!0,s){const o=(a,l)=>a===e&&(s==null||s===l);this._grabbedManipulators.forEach(({tool:a,manipulator:l,pointerType:c},u)=>{o(a,l)&&(this._grabbedManipulators.delete(u),l.grabbing=!1,l.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:c}))}),this._draggedManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._draggedManipulators.delete(c),l.dragging=!1,l.events.emit("drag",{action:"cancel"}))}),n&&this._hoveredManipulators.forEach(({tool:a,manipulator:l},c)=>{o(a,l)&&(this._hoveredManipulators.delete(c),l.hovering=!1)}),this._afterManipulatorUngrab(i),this._onFocusChange(r)}_intersect(e,r,i){let n=null;return i(s=>{if(s.manipulators==null||!Tre(s))return!1;const o=s.manipulators.intersect(e,r);return o!=null&&(n={tool:s,manipulator:o},!0)}),n}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach((r,i)=>{this._updateHoveredStateForPointerAtScreenPosition(Oh(r.x,r.y),i,r.pointerType,e)})}handleHoverEvent(e,r){e.type!=="pointer-up"&&e.type!=="immediate-click"&&e.type!=="pointer-move"||!$1e(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(gp(e),e.pointerId,e.pointerType,r)}_updateHoveredStateForPointerAtScreenPosition(e,r,i,n){let s=this._intersect(e,i,n);const o=rd(this._hoveredManipulators.get(r),({manipulator:a})=>a);s==null||s.manipulator.interactive||(s=null),s!=null&&o===s.manipulator||(o!=null&&(o.hovering=!1),s!=null?(s.manipulator.hovering=!0,this._hoveredManipulators.set(r,s)):this._hoveredManipulators.delete(r),this._onFocusChange(n))}_afterManipulatorUngrab(e){this._grabbedManipulators.size===0&&this._revertToNullActiveTool&&(e(null),this._revertToNullActiveTool=!1)}};function $1e(t){return t==="mouse"}function I1e(t){return t.pointerType!=="mouse"||t.button===0}function JEt(t){return!!t.native.shiftKey}const L1e="attached",DX="tools",KEt=1e3;let Zf=class extends aE{constructor(e){super(e),this._clock=z4,this._manipulatorState=new ZEt,this.tools=new vt,this.cursor=null,this._interacting=!1,this._interactingTimeout=null,this._forEachTool=r=>{for(const i of this.tools.items)if(r(i))return}}initialize(){this.handles.add([this.view.on(Fke,e=>{this._handleInputEvent(e)},Pn.TOOL),...YEt(this.tools),this.tools.on("before-add",({item:e})=>{this._updateToolEditableFlag(e)}),this.tools.on("before-remove",({item:e})=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()}),this.tools.on("change",()=>{this._refreshToolWatchers()})])}destroy(){this.detach(),this.handles.removeAll()}get _manipulatorStateEventArgs(){return{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}}set activeTool(e){if(e!=null&&!this.view.ready)return void re.getLogger(this).error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const r=this.activeTool;this._set("activeTool",e),r!=null&&r.deactivate(),e!=null&&e.activate(),this._removeIncompleteTools(e);for(const i of this.tools){this._updateToolEditableFlag(i);const n=Tre(i);this.activeTool!=null&&n||this._manipulatorState.clearPointers(i,this._manipulatorStateEventArgs,!n)}this._updateCursor()}get updating(){var e;return this.updatingHandles.updating||this.tools.some(r=>r.updating)||(((e=this.textures)==null?void 0:e.updating)??!1)}get interacting(){return this._interacting}_clearInteractingTimeout(){this._interactingTimeout=yi(this._interactingTimeout)}_startInteractingTimeout(){this._clearInteractingTimeout(),this._interactingTimeout=this._clock.setTimeout(()=>this._interacting=!1,KEt)}attach(){var e;this.view.type==="3d"?(this._set("textures",new XO(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([pe(()=>{const{state:r}=this.view;return"camera"in r&&r.camera},()=>this._forEachManipulator(r=>r.onViewChange())),(e=this.view.elevationProvider)==null?void 0:e.on("elevation-change",r=>this._forEachManipulator(i=>i.onElevationChange(r))),kl(()=>this._set("textures",qe(this.textures)))],L1e)):this.handles.add(pe(()=>this.view.extent,()=>this._forEachManipulator(r=>r.onViewChange())))}detach(){this.activeTool=null,this.tools.removeAll(),this.handles.remove(L1e),this._clearInteractingTimeout(),this._interacting=!1}_forEachManipulator(e){this._forEachTool(r=>{r.manipulators&&r.manipulators.forEach(({manipulator:i})=>e(i,r))})}_handleInputEvent(e){let r=!1;const i={...e,stopPropagation:()=>{r=!0,e.stopPropagation()}};this.activeTool!=null?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool(n=>{!r&&n.visible&&n.handleInputEvent(i)}),!r&&e.type==="key-down"&&e.key==="Escape"&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,this._manipulatorStateEventArgs),r||this.activeTool==null||this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor(),e.type==="pointer-move"&&(this._manipulatorState.hasFocusedManipulators()||this.activeTool)&&(this._interacting=!0,this._startInteractingTimeout())}_refreshToolWatchers(){this.handles.remove(DX),this._forEachTool(e=>{if(e instanceof Ce){const r=pe(()=>[e.cursor,e.visible,e.editable],()=>{Tre(e)||this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs),this._updateCursor()});this.handles.add(r,DX)}e.manipulators&&this.handles.add([e.manipulators.on("after-remove",r=>{this._manipulatorState.clearPointers(e,this._manipulatorStateEventArgs,!0,r.item.manipulator)}),e.manipulators.on("change",()=>{this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})],DX)}),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateToolEditableFlag(e){var r;(r=e.setEditableFlag)==null||r.call(e,VN.MANAGER,this.activeTool==null||e===this.activeTool)}_updateCursor(){let e=this._manipulatorState.cursor;e==null&&this._forEachTool(r=>!(r.cursor==null||!r.visible)&&(e=r.cursor,!0)),this._get("cursor")!==e&&this._set("cursor",e)}_removeIncompleteTools(e){this.tools.filter(r=>(e==null||r!==e)&&!r.created&&r.removeIncompleteOnCancel).forEach(r=>{this.tools.remove(r)})}get test(){return{setClock:e=>this._clock=e}}};d([p({constructOnly:!0,nonNullable:!0})],Zf.prototype,"view",void 0),d([p({readOnly:!0,nonNullable:!0})],Zf.prototype,"textures",void 0),d([p({value:null})],Zf.prototype,"activeTool",null),d([p({readOnly:!0,type:vt})],Zf.prototype,"tools",void 0),d([p({readOnly:!0})],Zf.prototype,"cursor",void 0),d([p({readOnly:!0})],Zf.prototype,"updating",null),d([p()],Zf.prototype,"_interacting",void 0),d([p({readOnly:!0})],Zf.prototype,"interacting",null),Zf=d([I("esri.views.ToolViewManager")],Zf);let kR=class extends Ce{constructor(e){super(),this.nativeIndex=null,this._detectedDeviceType="unknown",e.mapping==="standard"?this._detectedDeviceType="standard":QEt.test(e.id)?this._detectedDeviceType="spacemouse":this._detectedDeviceType="unknown",this.nativeIndex=e.index}get native(){const e=navigator.getGamepads?navigator.getGamepads():[];return this.nativeIndex!=null&&this.nativeIndex<e.length?e[this.nativeIndex]:null}get deviceType(){return this._detectedDeviceType}get axisThreshold(){return eCt[this.deviceType]}};d([p({nonNullable:!0,readOnly:!0})],kR.prototype,"nativeIndex",void 0),d([p({type:String,readOnly:!0})],kR.prototype,"deviceType",null),d([p({type:Number,readOnly:!0})],kR.prototype,"axisThreshold",null),kR=d([I("esri.views.input.gamepad.GamepadInputDevice")],kR);const QEt=new RegExp("^(3dconnexion|space(mouse|navigator|pilot|explorer))","i"),eCt={standard:.15,spacemouse:.025,unknown:0},Lde=kR;let NI=class extends Ce{constructor(...e){super(...e),this.devices=new vt,this.enabledFocusMode="document"}};d([p({type:vt.ofType(Lde),readOnly:!0})],NI.prototype,"devices",void 0),d([p({type:["document","view","none"]})],NI.prototype,"enabledFocusMode",void 0),NI=d([I("esri.views.input.gamepad.GamepadSettings")],NI);const tCt=NI;let pz=class extends Ce{constructor(){super(...arguments),this.gamepad=new tCt}};d([p({readOnly:!0})],pz.prototype,"gamepad",void 0),pz=d([I("esri.views.input.Input")],pz);const rCt=pz;let yb=class extends Ce{constructor(e){super(e),this.enabled=!0,this.device=null,this.mode="pan",this.tiltDirection="forward-down",this.velocityFactor=1}};d([p({type:Boolean,nonNullable:!0})],yb.prototype,"enabled",void 0),d([p({type:Lde})],yb.prototype,"device",void 0),d([p({type:["pan","zoom"],nonNullable:!0})],yb.prototype,"mode",void 0),d([p({type:["forward-down","forward-up"],nonNullable:!0})],yb.prototype,"tiltDirection",void 0),d([p({type:Number,nonNullable:!0})],yb.prototype,"velocityFactor",void 0),yb=d([I("esri.views.navigation.gamepad.GamepadSettings")],yb);const Vke=yb;let XS=class extends Ce{constructor(e){super(e),this.browserTouchPanEnabled=!0,this.gamepad=new Vke,this.momentumEnabled=!0,this.mouseWheelZoomEnabled=!0}};d([p({type:Boolean})],XS.prototype,"browserTouchPanEnabled",void 0),d([p({type:Vke,nonNullable:!0})],XS.prototype,"gamepad",void 0),d([p({type:Boolean})],XS.prototype,"momentumEnabled",void 0),d([p({type:Boolean})],XS.prototype,"mouseWheelZoomEnabled",void 0),XS=d([I("esri.views.navigation.Navigation")],XS);const Bke=XS;let Ere,NX=null;async function iCt(t){NX||(NX=le(()=>Promise.resolve().then(()=>rVt),void 0).then(e=>Ere=e)),await NX,vr(t)}async function jke(t,e,r,i){if(!t)return null;const n=t.spatialReference;return tF()||lf(n,e)?o0(t,e):Ere?Ere.projectGeometry(t,e,r,i):(await Promise.race([iCt(i),wP(i)]),jke(t,e,r,i))}let bn=class extends Ce{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=xc(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return this.userSpatialReference!=null?this.userSpatialReference:this._spatialReferenceTask.spatialReference}get extent(){return this._extentTask.extent}get heightModelInfo(){return this._heightModelInfoTask.heightModelInfo}get vcsWkid(){return this._heightModelInfoTask.vcsWkid}get latestVcsWkid(){return this._heightModelInfoTask.latestVcsWkid}get viewingMode(){return this.userSpatialReference==null||this.userSpatialReference.equals(this._spatialReferenceTask.spatialReference)?this._spatialReferenceTask.viewingMode:null}get tileInfo(){return this._tileInfoTask.tileInfo}get mapCollections(){var i,n,s,o;const e=(i=this.map)==null?void 0:i.call(this),r=[];return this.priorityCollection!=null&&r.push(this.priorityCollection),r.push({parent:e==null?void 0:e.basemap,layers:(n=e==null?void 0:e.basemap)==null?void 0:n.baseLayers},{layers:e==null?void 0:e.layers},{parent:e==null?void 0:e.ground,layers:(s=e==null?void 0:e.ground)==null?void 0:s.layers},{parent:e==null?void 0:e.basemap,layers:(o=e==null?void 0:e.basemap)==null?void 0:o.referenceLayers}),r}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;let i=null;for(const s of e){const o=this._getSupportedSpatialReferences(s);if(o.length>0){const a=this._narrowDownSpatialReferenceCandidates(i,o);a!=null&&(i=a)}if(i!=null&&i.length===1)break}if(r&&(i==null||i.length!==1))return{updating:!0};const n=this._pickSpatialReferenceCandidate(i);return{spatialReference:n!=null?n.spatialReference:null,viewingMode:n!=null?n.viewingMode:null,updating:!1}}get _tileInfoTask(){var i,n,s,o,a,l,c;if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:r}=this._collectLayers([{parent:(n=(i=this.map)==null?void 0:i.call(this))==null?void 0:n.basemap,layers:(a=(o=(s=this.map)==null?void 0:s.call(this))==null?void 0:o.basemap)==null?void 0:a.baseLayers},{layers:(c=(l=this.map)==null?void 0:l.call(this))==null?void 0:c.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const u=e[0].tileInfo;return{tileInfo:u&&u.spatialReference.equals(this.spatialReference)?u:null,updating:!1}}return{updating:r}}get _heightModelInfoTask(){var i,n,s;if(!this.required.heightModelInfo||this.suspended&&((i=this._get("_heightModelInfoTask"))!=null&&i.heightModelInfo))return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:r}=this._allLayers;for(const o of e)if(byt(o)){const a=XDe(o);if(a)return{heightModelInfo:a,vcsWkid:(n=o.spatialReference)==null?void 0:n.vcsWkid,latestVcsWkid:(s=o.spatialReference)==null?void 0:s.latestVcsWkid,updating:!1}}return{updating:r}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,r=e.updating,i=[];for(const n of e.layers){const s="fullExtents"in n&&n.fullExtents||(n.fullExtent!=null?[n.fullExtent]:[]),o=this.requiresExtentInSpatialReference?null:s[0],a=s.find(l=>l.spatialReference.equals(this.spatialReference))??o;if(a)return{candidates:[{extent:a,layer:n}],updating:!1};if(this._getSupportedSpatialReferences(n).length>0)for(const l of s)i.push({extent:l,layer:n})}return{candidates:i,updating:r}}get _extentTask(){const{candidates:e,updating:r}=this._extentCandidatesTask;if(r)return{updating:r};if(e==null||e.length===0)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),n=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&n.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:this._projectExtentTask.task!=null&&!this._projectExtentTask.task.finished}:(this._projectExtentTask.task!=null&&(this._projectExtentTask.task=xc(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:n.clone(),task:R3(async s=>{try{const o=await jke(i.extent,n,"portalItem"in i.layer?i.layer.portalItem:void 0,s);this._projectExtentTask={...this._projectExtentTask,task:null,output:o}}catch{if(go(s))return;this._projectExtentTask={...this._projectExtentTask,task:null}}})},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,r){if(e==null)return r;const i=[],n=(s,o)=>s!=null?o!=null?s===o&&s:s:o;for(const s of e)for(const o of r){if(!s.spatialReference.equals(o.spatialReference))continue;const a=n(s.viewingMode,o.viewingMode);if(a!==!1){i.push({spatialReference:s.spatialReference,viewingMode:a});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const r=this.defaultSpatialReference;return e==null||e.length<1?r!=null?{spatialReference:r,viewingMode:null}:null:(r!=null&&e.length>1&&e.some(({spatialReference:i})=>i.equals(r))&&(e=e.filter(({spatialReference:i})=>i.equals(r))),e.length>1&&e.some(({viewingMode:i})=>i!==at.Local)&&(e=e.filter(({viewingMode:i})=>i!==at.Local)),e[0])}_getSupportedSpatialReferences(e){const r="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(r.length===0)return[];const i=[];for(const n of r){const s=this.getSpatialReferenceSupport({spatialReference:n,layer:e});if(s!=null){const o=s.constraints!=null?s.constraints:[{spatialReference:n,viewingMode:null}];for(const{spatialReference:a,viewingMode:l}of o)this.requiresExtentInSpatialReference&&this.userSpatialReference!=null&&!a.equals(this.userSpatialReference)||i.push({spatialReference:a,viewingMode:l})}}return i}_pickExtentCandidate(e){const r=this.spatialReference;return e.find(({extent:i})=>r.equals(i.spatialReference))||e[0]}_collectLayers(e){var i;if(this._loadMaybe((i=this.map)==null?void 0:i.call(this))!=="loaded")return{layers:[],updating:!0};const r=new nCt;for(const n of e)if(this._collectCollection(n,r),r.preloading===this.sourcePreloadCount)break;return{layers:r.layers,updating:r.updating}}_collectCollection(e,r){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return r.updating=!0,void++r.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":r.updating=!0,++r.preloading;break;case"loaded":r.updating||r.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},r)}if(r.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e&&e.loadStatus!=null?e.loadStatus==="not-loaded"?(e.load().catch(r=>{Yn(r)||console.log(r)}),"loading"):e.loadStatus:"loaded"}};d([p()],bn.prototype,"required",void 0),d([p({constructOnly:!0})],bn.prototype,"map",void 0),d([p({constructOnly:!0})],bn.prototype,"getSpatialReferenceSupport",void 0),d([p()],bn.prototype,"defaultSpatialReference",void 0),d([p()],bn.prototype,"userSpatialReference",void 0),d([p()],bn.prototype,"sourcePreloadCount",void 0),d([p()],bn.prototype,"priorityCollection",void 0),d([p()],bn.prototype,"requiresExtentInSpatialReference",void 0),d([p()],bn.prototype,"suspended",void 0),d([p({readOnly:!0})],bn.prototype,"ready",null),d([p({readOnly:!0})],bn.prototype,"heightModelInfoReady",null),d([p({readOnly:!0})],bn.prototype,"spatialReference",null),d([p({readOnly:!0})],bn.prototype,"extent",null),d([p({readOnly:!0})],bn.prototype,"heightModelInfo",null),d([p({readOnly:!0})],bn.prototype,"vcsWkid",null),d([p({readOnly:!0})],bn.prototype,"latestVcsWkid",null),d([p({readOnly:!0})],bn.prototype,"viewingMode",null),d([p({readOnly:!0})],bn.prototype,"tileInfo",null),d([p({readOnly:!0})],bn.prototype,"mapCollections",null),d([p({readOnly:!0})],bn.prototype,"_allLayers",null),d([p({readOnly:!0})],bn.prototype,"_spatialReferenceTask",null),d([p({readOnly:!0})],bn.prototype,"_tileInfoTask",null),d([p({readOnly:!0})],bn.prototype,"_heightModelInfoTask",null),d([p({readOnly:!0})],bn.prototype,"_extentCandidatesTask",null),d([p()],bn.prototype,"_extentTask",null),d([p()],bn.prototype,"_projectExtentTask",void 0),bn=d([I("esri.views.support.DefaultsFromMap")],bn);let nCt=class{constructor(){this.layers=new Array,this.preloading=-1,this.updating=!1}};var FI;let er=FI=class extends jE(pn.EventedMixin(G4(Ce))){constructor(t){super(t),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new RN({getCollections:()=>{var e,r,i;return[(e=this.basemapView)==null?void 0:e.baseLayerViews,(r=this.groundView)==null?void 0:r.layerViews,this.layerViews,(i=this.basemapView)==null?void 0:i.referenceLayerViews]},getChildrenFunction:oCt}),this.groundView=null,this.basemapView=null,this.fatalError=null,this.graphics=new C2,this.analyses=new kP,this.typeSpecificPreconditionsReady=!0,this.layerViews=new vt,this.magnifier=new Dke,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.timeReference=new zP,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new rCt,this.navigation=new Bke,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new WEt(this),this.persistableViewModels=new vt,this._isValid=!1,this._readyCycleForced=!1,this._currentSpatialReference=null,this.handles.add(pe(()=>this.preconditionsReady,e=>{var r,i;e?(this._currentSpatialReference=this.spatialReference,FI.views.add(this)):(this._currentSpatialReference=null,FI.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?((r=this.toolViewManager)==null||r.detach(),this.analysisViewManager!=null&&this.analysisViewManager.detach(),(i=this.layerViewManager)==null||i.clear(),this._teardown()):e&&!this.ready&&(this._startup(),this.analysisViewManager!=null&&this.analysisViewManager.attach(),this.toolViewManager.attach())},li))}initialize(){this.addResolvingPromise(this.validate().then(()=>(this._isValid=!0,Zw(()=>this.ready)))),this.basemapView=new gb({view:this}),this.layerViewManager=new GEt({view:this,layerViewImporter:{importLayerView:t=>this.importLayerView(t),hasLayerViewModule:t=>this.hasLayerViewModule(t)},supportsGround:this.supportsGround}),this.toolViewManager=new Zf({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([pe(()=>this.initialExtentRequired,t=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:t},{sync:!0,initial:!0}),pe(()=>this.ready,t=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=t,this.defaultsFromMap.userSpatialReference=t?this.spatialReference:this._userSpatialReference)},{sync:!0}),pe(()=>this._userSpatialReference,t=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=t)},{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let t=null;this.handles.add([pe(()=>{var e;return(e=this.defaultsFromMap)==null?void 0:e.ready},e=>{var i;const r=((i=this.map)==null?void 0:i.allLayers.length)>0;if(e&&!this.spatialReference&&r){if(t!=null)return;const n=kl(()=>t=xc(t));t=R3(async s=>{try{await gN(this.spatialReferenceWarningDelay,null,s)}catch{return}finally{t=null}re.getLogger(this).warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}),this.handles.add(n,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")},{sync:!0})])}destroy(){var t,e;this.destroyed||(FI.views.remove(this),this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=qe(this.graphics),this.analyses=qe(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),qe(this.analysisViewManager),this.toolViewManager=qe(this.toolViewManager),this.layerViewManager=qe(this.layerViewManager),this.basemapView=qe(this.basemapView),(t=this.groundView)==null||t.destroy(),(e=this.layerViews)==null||e.forEach(r=>r.destroy()),this.layerViews.length=0,this.invalidate(),this._emitter.clear(),this.handles.removeAll(),this.map=qe(this.map))}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return re.getLogger(this).error("#toMap()","Not implemented on this instance of View"),null}get activeTool(){var t;return(t=this.toolViewManager)==null?void 0:t.activeTool}set activeTool(t){this.toolViewManager&&(this.toolViewManager.activeTool=t)}get animation(){return this._get("animation")}set animation(t){this._set("animation",t)}get center(){return null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new bn({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:t=>this.getSpatialReferenceSupport(t),...this._defaultsFromMapSettings})}get extent(){return this._get("extent")}set extent(t){this._set("extent",t)}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get navigating(){return!1}get preconditionsReady(){var t;return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||sg.isLoadable(this.map)&&!this.map.loaded||this.width===0||this.height===0||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!((t=this.defaultsFromMap)!=null&&t.ready)||!this.typeSpecificPreconditionsReady)}get resolution(){return 0}set map(t){t!==this._get("map")&&(t!=null&&t.destroyed&&(re.getLogger(this).warn("#map","The provided map is already destroyed",{map:t}),t=null),sg.isLoadable(t)&&t.load().catch(()=>{}),this.constructed&&!this.destroyed&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",t))}get spatialReference(){var e,r;let t=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return t&&((r=(e=this.defaultsFromMap)==null?void 0:e.required)!=null&&r.heightModelInfo)&&(t=t.clone(),t.vcsWkid=this.defaultsFromMap.vcsWkid,t.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),t}set spatialReference(t){const e=!So(t,this._get("spatialReference"));this._set("_userSpatialReference",t),e&&(this._set("spatialReference",t),this._spatialReferenceChanged(t))}_spatialReferenceChanged(t){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get tools(){var t;return(t=this.toolViewManager)==null?void 0:t.tools}get initialExtent(){var t;return(t=this.defaultsFromMap)==null?void 0:t.extent}get cursor(){const t=this.toolViewManager?this.toolViewManager.cursor:null;return t??(this._cursor||"default")}set cursor(t){this._cursor=t,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(t){var e;return((e=this.layerViewManager)==null?void 0:e.whenLayerView(t))??Promise.reject()}getDefaultSpatialReference(){var t;return(t=this.defaultsFromMap)==null?void 0:t.spatialReference}getDefaultHeightModelInfo(){var t;return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??((t=this.defaultsFromMap)==null?void 0:t.heightModelInfo)??null}importLayerView(t){throw new H("importLayerView() not implemented")}hasLayerViewModule(t){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(t){return this.getSpatialReferenceSupport({spatialReference:t})!=null}when(t,e){return this.isResolved()&&!this.ready&&re.getLogger(this).warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(t,e)}forceReadyCycle(){this.ready&&(du(()=>this.destroyed||this.preconditionsReady===!1,()=>this._readyCycleForced=!1,{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(t){this.toolViewManager.tools.add(t),this.activeTool=t}tryFatalErrorRecovery(){this.fatalError=null}};er.views=new vt,d([p()],er.prototype,"_userSpatialReference",void 0),d([p()],er.prototype,"activeTool",null),d([p({readOnly:!0})],er.prototype,"allLayerViews",void 0),d([p()],er.prototype,"groundView",void 0),d([p()],er.prototype,"animation",null),d([p()],er.prototype,"basemapView",void 0),d([p()],er.prototype,"center",null),d([p({readOnly:!0})],er.prototype,"_defaultsFromMapSettings",null),d([p()],er.prototype,"defaultsFromMap",null),d([p()],er.prototype,"fatalError",void 0),d([p({type:$r})],er.prototype,"extent",null),d([p(wB(C2,"graphics"))],er.prototype,"graphics",void 0),d([p(wB(kP,"analyses"))],er.prototype,"analyses",void 0),d([p({readOnly:!0,type:q_})],er.prototype,"heightModelInfo",null),d([p({readOnly:!0})],er.prototype,"interacting",null),d([p({readOnly:!0})],er.prototype,"navigating",null),d([p({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],er.prototype,"preconditionsReady",null),d([p({readOnly:!0})],er.prototype,"typeSpecificPreconditionsReady",void 0),d([p({type:vt,readOnly:!0})],er.prototype,"layerViews",void 0),d([p()],er.prototype,"resolution",null),d([p({type:Dke})],er.prototype,"magnifier",void 0),d([p({value:null,type:qLe})],er.prototype,"map",null),d([p()],er.prototype,"padding",void 0),d([p({readOnly:!0})],er.prototype,"ready",void 0),d([p({type:dt})],er.prototype,"spatialReference",null),d([p()],er.prototype,"spatialReferenceWarningDelay",void 0),d([p()],er.prototype,"stationary",null),d([p({readOnly:!0})],er.prototype,"supportsGround",void 0),d([p({type:T0})],er.prototype,"timeExtent",void 0),d([p({type:zP,nonNullable:!0})],er.prototype,"timeReference",void 0),d([p()],er.prototype,"tools",null),d([p()],er.prototype,"toolViewManager",void 0),d([p({readOnly:!0})],er.prototype,"type",void 0),d([p({type:Number})],er.prototype,"scale",void 0),d([p({readOnly:!0})],er.prototype,"updating",void 0),d([p({readOnly:!0})],er.prototype,"initialExtentRequired",void 0),d([p({readOnly:!0})],er.prototype,"initialExtent",null),d([p()],er.prototype,"cursor",null),d([p({readOnly:!0})],er.prototype,"input",void 0),d([p({type:Bke,nonNullable:!0})],er.prototype,"navigation",void 0),d([p()],er.prototype,"layerViewManager",void 0),d([p()],er.prototype,"analysisViewManager",void 0),d([p()],er.prototype,"width",void 0),d([p()],er.prototype,"height",void 0),d([p({readOnly:!0})],er.prototype,"resizing",void 0),d([p({value:null,readOnly:!0})],er.prototype,"size",null),d([p({readOnly:!0})],er.prototype,"suspended",void 0),d([p({readOnly:!0})],er.prototype,"viewEvents",void 0),d([p({readOnly:!0})],er.prototype,"persistableViewModels",void 0),d([p()],er.prototype,"_isValid",void 0),d([p()],er.prototype,"_readyCycleForced",void 0),d([p()],er.prototype,"_currentSpatialReference",void 0),er=FI=d([I("esri.views.View")],er);const sCt=er;function oCt(t){return t.layerViews}let vb=class extends RV{constructor(e){super(e),this.state="running",this.target=null,this._resolver=null}initialize(){this._resolver=Da(),this.addResolvingPromise(this._resolver.promise)}get done(){return this.state==="finished"||this.state==="stopped"}stop(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","stopped"),(e=this._resolver)==null||e.reject(new H("ViewAnimation stopped")))}finish(){var e;this.state!=="stopped"&&this.state!=="finished"&&(this._set("state","finished"),(e=this._resolver)==null||e.resolve())}update(e,r){r||(r=Dh(e)?"waiting-for-target":"running"),this._set("target",e),this._set("state",r)}};d([p({readOnly:!0})],vb.prototype,"done",null),d([p({readOnly:!0,type:String})],vb.prototype,"state",void 0),d([p()],vb.prototype,"target",void 0),vb=d([I("esri.views.ViewAnimation")],vb),function(t){t.State={RUNNING:"running",STOPPED:"stopped",FINISHED:"finished",WAITING_FOR_TARGET:"waiting-for-target"}}(vb||(vb={}));const VP=vb,XM=()=>le(()=>import("./TileLayerView3D-0bb1fb97.js"),["assets/TileLayerView3D-0bb1fb97.js","assets/LayerView3D-d89227ef.js","assets/TiledLayerView3D-7ea22dbd.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js","assets/MapServiceLayerViewHelper-54ef702c.js","assets/floorFilterUtils-080a7cd2.js","assets/drapedUtils-482b56eb.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/sublayerUtils-421ec0c7.js"]),D1e=()=>le(()=>import("./ElevationLayerView3D-5ef706f2.js"),["assets/ElevationLayerView3D-5ef706f2.js","assets/LayerView3D-d89227ef.js","assets/TiledLayerView3D-7ea22dbd.js","assets/LayerView-18befeb9.js"]),N1e={"base-dynamic":()=>le(()=>import("./BaseDynamicLayerView3D-8e283e99.js"),["assets/BaseDynamicLayerView3D-8e283e99.js","assets/DynamicLayerView3D-43790025.js","assets/LayerView3D-d89227ef.js","assets/projectExtentUtils-3af128e1.js","assets/ImageMaterial-fc7d3eab.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js"]),"base-elevation":D1e,"base-tile":XM,"bing-maps":XM,"building-scene":()=>le(()=>import("./BuildingSceneLayerView3D-227a633c.js"),["assets/BuildingSceneLayerView3D-227a633c.js","assets/BuildingGroupSublayer-43c3fe64.js","assets/BuildingComponentSublayer-6957bc48.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/I3SMeshView3D-f3cc02f5.js","assets/I3SOverrides-4b229600.js","assets/I3SNode-8649fb12.js","assets/meshFeatureSet-1e513016.js","assets/MeshGeoreferencedRelativeVertexSpace-f0de074a.js","assets/MeshLocalVertexSpace-0cd48a41.js","assets/MeshTransform-f49f56fb.js","assets/georeference-31d6bdc3.js","assets/External-37176b11.js","assets/FeatureLayerView3D-595c2569.js","assets/FeatureLayerViewBase3D-9fc03cdd.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js","assets/SceneModification-ae130d17.js","assets/SceneLayerWorker-03575c61.js","assets/I3SQueryFeatureStore-b107cd3e.js","assets/DefinitionExpressionSceneLayerView-912b31f6.js"]),csv:()=>le(()=>import("./CSVLayerView3D-a5e90658.js"),["assets/CSVLayerView3D-a5e90658.js","assets/FeatureLayerViewBase3D-9fc03cdd.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js"]),dimension:()=>le(()=>import("./DimensionLayerView3D-e04bf2a4.js"),["assets/DimensionLayerView3D-e04bf2a4.js","assets/LayerView3D-d89227ef.js","assets/LayerView-18befeb9.js"]),elevation:D1e,feature:()=>le(()=>import("./FeatureLayerView3D-595c2569.js"),["assets/FeatureLayerView3D-595c2569.js","assets/FeatureLayerViewBase3D-9fc03cdd.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js"]),geojson:()=>le(()=>import("./GeoJSONLayerView3D-9f2e732e.js"),["assets/GeoJSONLayerView3D-9f2e732e.js","assets/FeatureLayerViewBase3D-9fc03cdd.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js"]),graphics:()=>le(()=>import("./GraphicsLayerView3D-fa8a8aeb.js"),["assets/GraphicsLayerView3D-fa8a8aeb.js","assets/LayerView3D-d89227ef.js","assets/queryForSymbologySnapping-17730445.js","assets/GraphicsProcessor-e1abb931.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView-18befeb9.js"]),group:()=>le(()=>import("./GroupLayerView-8f6a1a38.js"),["assets/GroupLayerView-8f6a1a38.js","assets/LayerView-18befeb9.js"]),imagery:()=>le(()=>import("./ImageryLayerView3D-c28ad088.js"),["assets/ImageryLayerView3D-c28ad088.js","assets/DynamicLayerView3D-43790025.js","assets/LayerView3D-d89227ef.js","assets/projectExtentUtils-3af128e1.js","assets/ImageMaterial-fc7d3eab.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js"]),"integrated-mesh":()=>le(()=>import("./IntegratedMeshLayerView3D-86955368.js"),["assets/IntegratedMeshLayerView3D-86955368.js","assets/I3SMeshView3D-f3cc02f5.js","assets/I3SOverrides-4b229600.js","assets/I3SNode-8649fb12.js","assets/meshFeatureSet-1e513016.js","assets/MeshGeoreferencedRelativeVertexSpace-f0de074a.js","assets/MeshLocalVertexSpace-0cd48a41.js","assets/MeshTransform-f49f56fb.js","assets/georeference-31d6bdc3.js","assets/External-37176b11.js","assets/FeatureLayerView3D-595c2569.js","assets/FeatureLayerViewBase3D-9fc03cdd.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js","assets/SceneModification-ae130d17.js","assets/SceneLayerWorker-03575c61.js"]),"line-of-sight":()=>le(()=>import("./LineOfSightLayerView3D-839589c7.js"),["assets/LineOfSightLayerView3D-839589c7.js","assets/LayerView3D-d89227ef.js","assets/LayerView-18befeb9.js"]),"map-image":()=>le(()=>import("./MapImageLayerView3D-d4551f61.js"),["assets/MapImageLayerView3D-d4551f61.js","assets/DynamicLayerView3D-43790025.js","assets/LayerView3D-d89227ef.js","assets/projectExtentUtils-3af128e1.js","assets/ImageMaterial-fc7d3eab.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js","assets/ExportImageParameters-0a859877.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-421ec0c7.js","assets/MapServiceLayerViewHelper-54ef702c.js","assets/drapedUtils-482b56eb.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js"]),media:()=>le(()=>import("./MediaLayerView3D-afbc30d3.js"),["assets/MediaLayerView3D-afbc30d3.js","assets/MediaElementView-3718b5e9.js","assets/normalizeUtilsSync-0d231fb2.js","assets/normalizeUtilsCommon-8aa93216.js","assets/LayerView3D-d89227ef.js","assets/ImageMaterial-fc7d3eab.js","assets/LayerView-18befeb9.js"]),"ogc-feature":()=>le(()=>import("./OGCFeatureLayerView3D-0a300abc.js"),["assets/OGCFeatureLayerView3D-0a300abc.js","assets/FeatureLayerViewBase3D-9fc03cdd.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js"]),"open-street-map":XM,"oriented-imagery":()=>le(()=>import("./FeatureLayerView3D-595c2569.js"),["assets/FeatureLayerView3D-595c2569.js","assets/FeatureLayerViewBase3D-9fc03cdd.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js"]),"point-cloud":()=>le(()=>import("./PointCloudLayerView3D-824e3e55.js").then(t=>t.P),["assets/PointCloudLayerView3D-824e3e55.js","assets/LayerView3D-d89227ef.js","assets/PointCloudWorkerUtil-2cba7d14.js","assets/PointCloudUniqueValueRenderer-05a6e7f7.js","assets/PopupSceneLayerView-779a6d5d.js","assets/LayerView-18befeb9.js"]),voxel:()=>le(()=>import("./VoxelLayerView3D-b56ad750.js"),["assets/VoxelLayerView3D-b56ad750.js","assets/LayerView3D-d89227ef.js","assets/PopupSceneLayerView-779a6d5d.js","assets/LayerView-18befeb9.js"]),route:()=>le(()=>import("./RouteLayerView3D-cf00af15.js"),["assets/RouteLayerView3D-cf00af15.js","assets/Stop-c616f43a.js","assets/LayerView3D-d89227ef.js","assets/GraphicsProcessor-e1abb931.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/projectExtentUtils-3af128e1.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js"]),scene:t=>t.profile==null||t.profile==="mesh-pyramids"?le(()=>import("./SceneLayerView3D-24d837c1.js"),["assets/SceneLayerView3D-24d837c1.js","assets/I3SOverrides-4b229600.js","assets/I3SNode-8649fb12.js","assets/meshFeatureSet-1e513016.js","assets/MeshGeoreferencedRelativeVertexSpace-f0de074a.js","assets/MeshLocalVertexSpace-0cd48a41.js","assets/MeshTransform-f49f56fb.js","assets/georeference-31d6bdc3.js","assets/External-37176b11.js","assets/FeatureLayerView3D-595c2569.js","assets/FeatureLayerViewBase3D-9fc03cdd.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js","assets/I3SMeshView3D-f3cc02f5.js","assets/SceneModification-ae130d17.js","assets/SceneLayerWorker-03575c61.js","assets/SceneLayerView-d410a4c5.js","assets/DefinitionExpressionSceneLayerView-912b31f6.js","assets/I3SQueryFeatureStore-b107cd3e.js","assets/PopupSceneLayerView-779a6d5d.js"]):le(()=>import("./SceneLayerGraphicsView3D-f44a13a0.js"),["assets/SceneLayerGraphicsView3D-f44a13a0.js","assets/I3SOverrides-4b229600.js","assets/I3SNode-8649fb12.js","assets/meshFeatureSet-1e513016.js","assets/MeshGeoreferencedRelativeVertexSpace-f0de074a.js","assets/MeshLocalVertexSpace-0cd48a41.js","assets/MeshTransform-f49f56fb.js","assets/georeference-31d6bdc3.js","assets/External-37176b11.js","assets/FeatureLayerView3D-595c2569.js","assets/FeatureLayerViewBase3D-9fc03cdd.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js","assets/SceneLayerView-d410a4c5.js","assets/DefinitionExpressionSceneLayerView-912b31f6.js","assets/PopupSceneLayerView-779a6d5d.js"]),stream:()=>le(()=>import("./StreamLayerView3D-6582db81.js"),["assets/StreamLayerView3D-6582db81.js","assets/StreamFeatureManager-353ae173.js","assets/createConnection-d2892117.js","assets/query-faa7dd63.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/LayerView-18befeb9.js"]),tile:XM,"imagery-tile":()=>le(()=>import("./ImageryTileLayerView3D-e1fa51b1.js"),["assets/ImageryTileLayerView3D-e1fa51b1.js","assets/LayerView3D-d89227ef.js","assets/TiledLayerView3D-7ea22dbd.js","assets/rasterProjectionHelper-e9bda175.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js","assets/drapedUtils-482b56eb.js"]),"vector-tile":()=>le(()=>import("./VectorTileLayerView3D-5416273e.js"),["assets/VectorTileLayerView3D-5416273e.js","assets/Rect-98da58d6.js","assets/pbf-816f3f11.js","assets/rasterizingUtils-fc723d1a.js","assets/TileInfoView-f292a00b.js","assets/definitions-77bd9395.js","assets/number-e491b09e.js","assets/GeometryUtils-0258f920.js","assets/StyleRepository-c00c989a.js","assets/colorUtils-c0f43caf.js","assets/TileClipper-ae6eca9e.js","assets/LayerView3D-d89227ef.js","assets/TiledLayerView3D-7ea22dbd.js","assets/LayerView-18befeb9.js"]),wcs:()=>le(()=>import("./ImageryTileLayerView3D-e1fa51b1.js"),["assets/ImageryTileLayerView3D-e1fa51b1.js","assets/LayerView3D-d89227ef.js","assets/TiledLayerView3D-7ea22dbd.js","assets/rasterProjectionHelper-e9bda175.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js","assets/drapedUtils-482b56eb.js"]),"web-tile":XM,wfs:()=>le(()=>import("./WFSLayerView3D-b8283821.js"),["assets/WFSLayerView3D-b8283821.js","assets/FeatureLayerViewBase3D-9fc03cdd.js","assets/FeatureLikeLayerView3D-1c709d6f.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/queryForSymbologySnapping-17730445.js","assets/hash-6f442295.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/floorFilterUtils-080a7cd2.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView3D-d89227ef.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/EventedSet-aab6d560.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js"]),wms:()=>le(()=>import("./WMSLayerView3D-8fe366b6.js"),["assets/WMSLayerView3D-8fe366b6.js","assets/DynamicLayerView3D-43790025.js","assets/LayerView3D-d89227ef.js","assets/projectExtentUtils-3af128e1.js","assets/ImageMaterial-fc7d3eab.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js","assets/ExportWMSImageParameters-533cb2f5.js"]),wmts:()=>le(()=>import("./WMTSLayerView3D-cb7ad60b.js"),["assets/WMTSLayerView3D-cb7ad60b.js","assets/LayerView3D-d89227ef.js","assets/TiledLayerView3D-7ea22dbd.js","assets/LayerView-18befeb9.js","assets/RefreshableLayerView-ae86cf2f.js"]),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null,video:null};function aCt(t){const e=t.declaredClass?t.declaredClass.slice(t.declaredClass.lastIndexOf(".")+1):"Unknown",r=e.replaceAll(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();return new H(`${r}:view-not-supported`,`${e} is not supported in 3D`)}const F1e={hasLayerViewModule:t=>N1e[t.type]!=null,importLayerView:t=>{const e=N1e[t.type];if(e==null)throw aCt(t);return e(t)}},k1e="analyses-owner-handles";var YO,UT;(function(t){t[t.PENDING=0]="PENDING",t[t.CREATED=1]="CREATED"})(YO||(YO={})),function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED"}(UT||(UT={}));let YS=class extends aE{constructor(e){super(e),this._allAnalysisViews=new vt,this._creatingViewCount=0,this._items=new Map,this._scheduledUpdateHandle=null,this._attachedToViewResolver=U1e(),this._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}}}destroy(){this._disconnectOwners(),this._attachedToViewResolver.reject(Wr("AnalysisViewManager was destroyed"))}attach(){this._connectOwners(),this._attachedToViewResolver.resolve()}detach(){this._disconnectOwners(),this._attachedToViewResolver.reject(Wr()),this._attachedToViewResolver=U1e()}get updating(){return!this.view.ready||this._creatingViewCount!==0||this._allAnalysisViews.some(e=>e.updating)}get testInfo(){return{allAnalysisViews:this._allAnalysisViews}}async whenAnalysisView(e){await this._attachedToViewResolver.promise;const r=this._items.get(e);if(r==null||r.state.list===UT.REMOVED)throw new H("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:e});return r.createAnalysisViewTask.promise}_connectOwners(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),k1e)}_disconnectOwners(){this.handles.remove(k1e),this._update(),this._creatingViewCount=0}_connectAnalysesCollection(e){for(const n of e)this._addAnalysis(n);const r=e.on("after-add",n=>this._addAnalysis(n.item)),i=e.on("after-remove",n=>this._removeAnalysis(n.item));return{remove:()=>{r.remove(),i.remove();for(const n of e)this._removeAnalysis(n)}}}_addAnalysis(e){const r=this._items.get(e);if(r==null){const i={state:{view:YO.PENDING,list:UT.ADDED},analysis:e,view:null,createAnalysisViewTask:null};this._items.set(e,i),i.createAnalysisViewTask=R3(n=>this._createAnalysisViewPromise(i,n))}else r.state.list=UT.ADDED}_removeAnalysis(e){const r=this._items.get(e);r!=null?(r.state.list=UT.REMOVED,this._scheduleUpdate()):re.getLogger(this).error("Trying to remove analysis which was not added")}_scheduleUpdate(){this._scheduledUpdateHandle==null&&(this._scheduledUpdateHandle=T3(()=>this._update()))}_update(){this._scheduledUpdateHandle=yi(this._scheduledUpdateHandle),this._items.forEach(e=>{if(e.state.list===UT.REMOVED)switch(this._items.delete(e.analysis),e.state.view){case YO.PENDING:e.createAnalysisViewTask=xc(e.createAnalysisViewTask);break;case YO.CREATED:e.view!=null&&(this._allAnalysisViews.remove(e.view),e.view=qe(e.view),e.createAnalysisViewTask=null)}})}async _createAnalysisViewPromise(e,r){const i=e.analysis,n=i.type,s=this._analysisModules[n];if(this._creatingViewCount+=1,s.module==null)try{s.module=await this._loadAnalysisModule(n)}catch(a){throw this._creatingViewCount-=1,a}if(go(r))throw this._creatingViewCount-=1,Wr("AnalysisView creation aborted");const o=new s.module.default({analysis:i,view:this.view});try{await o.when()}catch(a){throw this._creatingViewCount-=1,a}if(go(r))throw this._creatingViewCount-=1,o.destroy(),Wr("AnalysisView creation aborted");return e.view=o,e.state.view=YO.CREATED,this._allAnalysisViews.add(o),this._creatingViewCount-=1,o}_loadAnalysisModule(e){switch(e){case"area-measurement":return le(()=>import("./AreaMeasurementAnalysisView3D-4f1ab8c5.js").then(r=>r.A),["assets/AreaMeasurementAnalysisView3D-4f1ab8c5.js","assets/UnitNormalizer-130f3c9a.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/AnalysisView3D-ee058dc2.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/euclideanAreaMeasurementUtils-2c8d453a.js","assets/measurementUtils-a6d314a6.js","assets/LineVisualElement-d2c1133a.js","assets/EditGeometryOperations-642c6092.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/Segment-f4ffef66.js","assets/TextOverlayItem-aab5180d.js"]);case"dimension":return le(()=>import("./DimensionAnalysisView3D-bb1a7c41.js"),["assets/DimensionAnalysisView3D-bb1a7c41.js","assets/AnalysisView3D-ee058dc2.js","assets/LengthDimension-e5700bc8.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/Segment-f4ffef66.js","assets/LineVisualElement-d2c1133a.js","assets/TextOverlayItem-aab5180d.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/manipulatorUtils-a300321b.js","assets/ImageMaterial-fc7d3eab.js","assets/Factory-b8446b63.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js","assets/VerticesVisualElement-4162f1d8.js","assets/RightAngleQuadVisualElement-d3280488.js","assets/VisualElementResources-376ef456.js","assets/PointVisualElement-4c93780d.js","assets/SnappingContext-06ffe599.js","assets/PointSnappingHint-76d2669d.js","assets/EditGeometryOperations-642c6092.js","assets/SnappingOperation-58dfc7fe.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/analysisViewUtils-4dd43fbe.js"]);case"direct-line-measurement":return le(()=>import("./DirectLineMeasurementAnalysisView3D-0385362e.js").then(r=>r.D),["assets/DirectLineMeasurementAnalysisView3D-0385362e.js","assets/UnitNormalizer-130f3c9a.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/AnalysisView3D-ee058dc2.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/LineVisualElement-d2c1133a.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/Segment-f4ffef66.js","assets/TextOverlayItem-aab5180d.js","assets/RightAngleQuadVisualElement-d3280488.js","assets/VisualElementResources-376ef456.js"]);case"line-of-sight":return le(()=>import("./LineOfSightAnalysisView3D-83e851f1.js"),["assets/LineOfSightAnalysisView3D-83e851f1.js","assets/AnalysisView3D-ee058dc2.js","assets/LineOfSightAnalysisTarget-9a4b2f31.js","assets/LineVisualElement-d2c1133a.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/manipulatorUtils-a300321b.js","assets/ImageMaterial-fc7d3eab.js","assets/manipulatorUtils-e16e9d30.js","assets/PointVisualElement-4c93780d.js","assets/VisualElementResources-376ef456.js","assets/analysisViewUtils-4dd43fbe.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js"]);case"slice":return le(()=>import("./SliceAnalysisView3D-d6eaf8ac.js"),["assets/SliceAnalysisView3D-d6eaf8ac.js","assets/AnalysisView3D-ee058dc2.js","assets/sliceToolUtils-e90afac1.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/LineVisualElement-d2c1133a.js","assets/manipulatorUtils-a300321b.js","assets/ImageMaterial-fc7d3eab.js","assets/BuildingComponentSublayer-6957bc48.js","assets/Factory-b8446b63.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js","assets/analysisViewUtils-4dd43fbe.js"])}}};function U1e(){const t=Da();return t.promise.catch(()=>{}),t}d([p()],YS.prototype,"updating",null),d([p({constructOnly:!0})],YS.prototype,"view",void 0),d([p()],YS.prototype,"_allAnalysisViews",void 0),d([p()],YS.prototype,"_creatingViewCount",void 0),YS=d([I("esri.views.3d.analysis.AnalysisViewManager3D")],YS);const lCt=YS;let uv=class extends Ce{constructor(e){super(e),this.collision=new kI,this.distance=1/0,this.minimumPoiDistance=4,this.tilt=null}get altitude(){return this.mode===at.Local?null:this._get("altitude")||null}set altitude(e){this.mode!==at.Local?this._set("altitude",e):re.getLogger(this).warn("Altitude constraint is ignored in local scenes")}clampAltitude(e){return this.altitude?Te(e,this.altitude.min,this.altitude.max):e}clampTilt(e,r){if(!this.tilt)return r;const i=this.tilt(e);return Te(r,i.min,i.max)}clampDistance(e){return Math.min(e,this.distance)}createDefaultTilt(){return this.mode===at.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()}createConstantMaxTilt(e){return(r,i=FX)=>(i.min=Ja.min,i.max=e,i)}_createDefaultTiltLocal(){const e=this.collision.enabled?L8([[4e3,Ja.max],[1e4,sr(88)],[6e6,sr(88)]]):()=>Ja.max;return(r,i=FX)=>(i.min=Ja.min,i.max=e(r),i)}_createDefaultTiltGlobal(){const e=this.collision.enabled?L8([[4e3,Ja.max],[5e4,sr(88)],[6e6,sr(88)],[2e7,Ja.min]]):L8([[3e5,Ja.max],[3e6,sr(88)],[6e6,sr(88)],[2e7,Ja.min]]);return(r,i=FX)=>(i.min=Ja.min,i.max=e(r),i)}};function cCt(t){return{min:-2e5,max:4*t.radius}}d([p()],uv.prototype,"altitude",null),d([p({readOnly:!0})],uv.prototype,"collision",void 0),d([p()],uv.prototype,"distance",void 0),d([p({readOnly:!0})],uv.prototype,"minimumPoiDistance",void 0),d([p()],uv.prototype,"tilt",void 0),d([p({constructOnly:!0})],uv.prototype,"mode",void 0),uv=d([I("esri.views.3d.state.Constraints")],uv);const z1e=cCt(Rr),Ja={min:sr(.5),max:sr(179.5)},FX={min:0,max:0};let kI=class extends Ce{constructor(){super(...arguments),this.enabled=!0,this.elevationMargin=5}};d([p({type:Boolean})],kI.prototype,"enabled",void 0),d([p({type:Number})],kI.prototype,"elevationMargin",void 0),kI=d([I("esri.views.3d.state.Constraints.CollisionConstraint")],kI);let ZO=class extends Ce{constructor(){super(...arguments),this.min=z1e.min,this.max=z1e.max}};d([p({type:Number})],ZO.prototype,"min",void 0),d([p({type:Number})],ZO.prototype,"max",void 0),ZO=d([I("esri.views.3d.constraints.AltitudeConstraint")],ZO);let Av=class extends Ce{constructor(){super(...arguments),this.mode="auto"}get near(){return this._get("near")}set near(e){this._set("near",e),e>=this._get("far")&&(this.far=e+1e-9),this.mode="manual"}castNear(e){return Math.max(1e-8,e)}get far(){return this._get("far")}set far(e){this._set("far",e),e<=this._get("near")&&(this.near=e-1e-9),this.mode="manual"}castFar(e){return Math.max(1e-8,e)}autoUpdate(e,r){this.mode==="auto"&&(this._get("near")!==e&&this._set("near",e),this._get("far")!==r&&this._set("far",r))}};d([p({type:Number,value:1e-8})],Av.prototype,"near",null),d([ur("near")],Av.prototype,"castNear",null),d([p({type:Number,value:1e-8})],Av.prototype,"far",null),d([ur("far")],Av.prototype,"castFar",null),d([p({type:["auto","manual"]})],Av.prototype,"mode",void 0),Av=d([I("esri.views.3d.constraints.ClipDistanceConstraint")],Av);const Cre={min:Oc(Ja.min),max:Oc(Ja.max)};let zT=class extends Ce{constructor(){super(...arguments),this.mode="auto"}get max(){return this._get("max")}set max(e){this._set("max",e),this.mode="manual"}castMax(e){return Te(e,Cre.min,Cre.max)}autoUpdate(e){this.mode==="auto"&&this._get("max")!==e&&this._set("max",e)}};d([p({type:["auto","manual"]})],zT.prototype,"mode",void 0),d([p({type:Number,value:Cre.max})],zT.prototype,"max",null),d([ur("max")],zT.prototype,"castMax",null),zT=d([I("esri.views.3d.constraints.TiltConstraint")],zT);let VT=class extends Ce{constructor(){super(...arguments),this.tilt=new zT,this.altitude=new ZO,this.clipDistance=new Av}};d([p({type:zT})],VT.prototype,"tilt",void 0),d([p({type:ZO})],VT.prototype,"altitude",void 0),d([p({type:Av})],VT.prototype,"clipDistance",void 0),VT=d([I("esri.views.3d.constraints.Constraints")],VT);var UR;const Gke="esri.views.3d.environment.SunLighting",Tk=re.getLogger(Gke);let ny=UR=class extends pn.EventedMixin(nE){constructor(t){super(t),this.cameraTrackingEnabled=!0,this.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};const e=new Date().getFullYear(),r=new Date("March 15, "+e+" 12:00:00 UTC");this._set("defaultDate",r),this._set("date",r)}get ambientOcclusionEnabled(){return Lm(Tk,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){Lm(Tk,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return Lm(Tk,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){Lm(Tk,"waterReflectionEnabled",{replacement:"reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}get defaultDate(){return new Date(this._get("defaultDate").getTime())}static fromWebsceneLighting(t){return new UR(t.cloneConstructProperties())}set defaultDate(t){const e=this._get("date")===this._get("defaultDate");t=new Date(t.getTime()),this._set("defaultDate",t),e&&this._set("date",t)}set date(t){t!=null&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(t.getTime())))}autoUpdate(t,e){const r=UR.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours,this.positionTimezoneInfo.minutes=e.minutes,this.positionTimezoneInfo.seconds=e.seconds;let i=null;t!=null&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(t.getTime())?(i=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(i=this.date&&this.date.getTime(),this._set("date",new Date(t.getTime()))));const n=UR.calculateTimezoneOffset(this.positionTimezoneInfo);if(r!==n&&(Ek.target=this,Ek.timezoneOffset=n,this.emit("timezone-will-change",Ek),Ek.target=null),t!=null)return isNaN(t.getTime())||i!==t.getTime()}clone(){const t=this._get("date")===this._get("defaultDate"),e=new UR({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled});return t&&e._set("date",e._get("defaultDate")),e.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated,e.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours,e.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes,e.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds,e}cloneWithWebsceneLighting(t){const e=this.clone();return t.date!=null&&(e.date=t.date),e.directShadowsEnabled=t.directShadowsEnabled,e.displayUTCOffset=t.displayUTCOffset,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([p({type:Boolean})],ny.prototype,"cameraTrackingEnabled",void 0),d([p({type:Boolean})],ny.prototype,"ambientOcclusionEnabled",null),d([p({type:Boolean})],ny.prototype,"waterReflectionEnabled",null),d([p({type:Date})],ny.prototype,"defaultDate",null),d([p({type:Date})],ny.prototype,"date",null),ny=UR=d([I(Gke)],ny),function(t){function e({hours:r,minutes:i,seconds:n}){return Math.round(r+i/60+n/3600)}t.calculateTimezoneOffset=e}(ny||(ny={}));const Ek={target:null,timezoneOffset:0},_b=ny;var fz;const Hke="esri.views.3d.environment.VirtualLighting",Ck=re.getLogger(Hke);let zR=fz=class extends pn.EventedMixin(iF){constructor(t){super(t),this.cameraTrackingEnabled=!0}get ambientOcclusionEnabled(){return Lm(Ck,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._get("ambientOcclusionEnabled")??!1}set ambientOcclusionEnabled(t){Lm(Ck,"ambientOcclusionEnabled",{replacement:"ambient occlusion is automatically shown and this property has no effect",version:"4.27"}),this._set("ambientOcclusionEnabled",t)}get waterReflectionEnabled(){return Lm(Ck,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._get("waterReflectionEnabled")??!1}set waterReflectionEnabled(t){Lm(Ck,"waterReflectionEnabled",{replacement:"water reflections are automatically shown and this property has no effect",version:"4.27"}),this._set("waterReflectionEnabled",t)}clone(){return new fz({...this.cloneConstructProperties(),cameraTrackingEnabled:this.cameraTrackingEnabled})}static fromWebsceneLighting(t){return new fz(t.cloneConstructProperties())}cloneWithWebsceneLighting(t){const e=this.clone();return e.directShadowsEnabled=t.directShadowsEnabled,e}cloneNonPersistentConstructProperties(){return{cameraTrackingEnabled:this.cameraTrackingEnabled}}};d([p({type:Boolean})],zR.prototype,"ambientOcclusionEnabled",null),d([p({type:Boolean})],zR.prototype,"waterReflectionEnabled",null),d([p({type:Boolean})],zR.prototype,"cameraTrackingEnabled",void 0),zR=fz=d([I(Hke)],zR);const UI=zR,uCt={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:_b,virtual:UI}};var Rre;let pD=Rre=class extends Ce{set quality(t){["low","high"].includes(t)&&this._set("quality",t)}clone(){return new Rre({quality:this.quality})}};d([p({type:["low","high"],value:"low"})],pD.prototype,"quality",null),pD=Rre=d([I("esri.views.3d.environment.SceneViewAtmosphere")],pD);var zI;let VR=zI=class extends TP{constructor(t){super(t),this.atmosphere=new pD,this.lighting=new _b,this.cachedCameraTrackingEnabled=null}static fromWebsceneEnvironment(t){const e=t.cloneConstructProperties();return new zI({...e,lighting:e.lighting?e.lighting.type==="virtual"?UI.fromWebsceneLighting(e.lighting):_b.fromWebsceneLighting(e.lighting):void 0})}castLighting(t){return this._convertLighting(t)}applyLighting(t){this.lighting=this._convertLighting(t)}_convertLighting(t){var e,r;return t?t instanceof _b||t instanceof UI?t:t instanceof nE?this.lighting&&this.lighting.type!=="virtual"?this.lighting.cloneWithWebsceneLighting(t):new _b({...t.cloneConstructProperties(),...(e=this.lighting)==null?void 0:e.cloneNonPersistentConstructProperties()}):t instanceof iF?this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t):new UI({...t.cloneConstructProperties(),...(r=this.lighting)==null?void 0:r.cloneNonPersistentConstructProperties()}):ng(uCt,t):new _b}clone(){return new zI({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ie(this.background)})}cloneWithWebsceneEnvironment(t){return new zI({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:ie(this.background),...t.cloneConstructProperties(),lighting:this._getLighting(t)})}_getLighting(t){switch(t.lighting.type){case"sun":return this.lighting&&this.lighting.type==="sun"?this.lighting.cloneWithWebsceneLighting(t.lighting):_b.fromWebsceneLighting(t.lighting);case"virtual":return this.lighting&&this.lighting.type==="virtual"?this.lighting.cloneWithWebsceneLighting(t.lighting):UI.fromWebsceneLighting(t.lighting);default:return t.lighting,_b.fromWebsceneLighting(t.lighting)}}};d([p({type:pD,json:{read:!1},nonNullable:!0})],VR.prototype,"atmosphere",void 0),d([p({nonNullable:!0})],VR.prototype,"lighting",void 0),d([ur("lighting")],VR.prototype,"castLighting",null),VR=zI=d([I("esri.views.3d.environment.SceneViewEnvironment")],VR);const BR=VR;var Sl;(function(t){t[t.Realistic=0]="Realistic",t[t.Local=1]="Local",t[t.Mars=2]="Mars",t[t.None=3]="None"})(Sl||(Sl={}));function Eo(t,e){return t[0]=e[0],t[1]=e[1],t}function Or(t,e,r){return t[0]=e,t[1]=r,t}function Tp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function os(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Dde(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function qke(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function dCt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function hCt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function pCt(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function fCt(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function mCt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function eu(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function r_(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t}function F_(t,e){const r=e[0]-t[0],i=e[1]-t[1];return Math.sqrt(r*r+i*i)}function ug(t,e){const r=e[0]-t[0],i=e[1]-t[1];return r*r+i*i}function _F(t){const e=t[0],r=t[1];return Math.sqrt(e*e+r*r)}function ox(t){const e=t[0],r=t[1];return e*e+r*r}function Nde(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Wke(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function BP(t,e){const r=e[0],i=e[1];let n=r*r+i*i;return n>0&&(n=1/Math.sqrt(n),t[0]=e[0]*n,t[1]=e[1]*n),t}function Mn(t,e){return t[0]*e[0]+t[1]*e[1]}function gCt(t,e,r){const i=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=i,t}function ih(t,e,r,i){const n=e[0],s=e[1];return t[0]=n+i*(r[0]-n),t[1]=s+i*(r[1]-s),t}function yCt(t,e){e=e||1;const r=2*q4()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Xke(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n,t[1]=r[1]*i+r[3]*n,t}function ZS(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[2]*n+r[4],t[1]=r[1]*i+r[3]*n+r[5],t}function vCt(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[3]*n+r[6],t[1]=r[1]*i+r[4]*n+r[7],t}function _Ct(t,e,r){const i=e[0],n=e[1];return t[0]=r[0]*i+r[4]*n+r[12],t[1]=r[1]*i+r[5]*n+r[13],t}function bCt(t,e,r,i){const n=e[0]-r[0],s=e[1]-r[1],o=Math.sin(i),a=Math.cos(i);return t[0]=n*a-s*o+r[0],t[1]=n*o+s*a+r[1],t}function wCt(t,e){const r=t[0],i=t[1],n=e[0],s=e[1];let o=r*r+i*i;o>0&&(o=1/Math.sqrt(o));let a=n*n+s*s;a>0&&(a=1/Math.sqrt(a));const l=(r*n+i*s)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function xCt(t){return"vec2("+t[0]+", "+t[1]+")"}function Yke(t,e){return t[0]===e[0]&&t[1]===e[1]}function Zke(t,e){const r=t[0],i=t[1],n=e[0],s=e[1],o=Bl();return Math.abs(r-n)<=o*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=o*Math.max(1,Math.abs(i),Math.abs(s))}function SCt(t,e,r,i,n){let s=e[0]-r[0],o=e[1]-r[1];const a=(i[0]*s+i[1]*o)*(n-1);return s=i[0]*a,o=i[1]*a,t[0]=e[0]+s,t[1]=e[1]+o,t}const TCt=_F,Fde=os,ECt=Dde,CCt=qke,Jke=F_,RCt=ug,OCt=ox;Object.freeze(Object.defineProperty({__proto__:null,add:Tp,angle:wCt,ceil:dCt,copy:Eo,cross:gCt,dist:Jke,distance:F_,div:CCt,divide:qke,dot:Mn,equals:Zke,exactEquals:Yke,floor:hCt,inverse:Wke,len:TCt,length:_F,lerp:ih,max:fCt,min:pCt,mul:ECt,multiply:Dde,negate:Nde,normalize:BP,projectAndScale:SCt,random:yCt,rotate:bCt,round:mCt,scale:eu,scaleAndAdd:r_,set:Or,sqrDist:RCt,sqrLen:OCt,squaredDistance:ug,squaredLength:ox,str:xCt,sub:Fde,subtract:os,transformMat2:Xke,transformMat2d:ZS,transformMat3:vCt,transformMat4:_Ct},Symbol.toStringTag,{value:"Module"}));function kde(t){return Te((t-1e5)/(1e6-1e5),0,1)}const Ore=1e4,ACt=.085,Bb=1e5;let PCt=class{};const Ai=PCt;function T(t,...e){let r="";for(let i=0;i<e.length;i++)r+=t[i]+e[i];return r+=t[t.length-1],r}(function(t){function e(i){return Math.round(i).toString()}function r(i){return i.toPrecision(8)}t.int=e,t.float=r})(T||(T={}));var O;(function(t){t.POSITION="position",t.NORMAL="normal",t.NORMALCOMPRESSED="normalCompressed",t.UV0="uv0",t.AUXPOS1="auxpos1",t.AUXPOS2="auxpos2",t.COLOR="color",t.SYMBOLCOLOR="symbolColor",t.SIZE="size",t.TANGENT="tangent",t.OFFSET="offset",t.SUBDIVISIONFACTOR="subdivisionFactor",t.COLORFEATUREATTRIBUTE="colorFeatureAttribute",t.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute",t.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute",t.DISTANCETOSTART="distanceToStart",t.UVMAPSPACE="uvMapSpace",t.BOUNDINGRECT="boundingRect",t.UVREGION="uvRegion",t.PROFILERIGHT="profileRight",t.PROFILEUP="profileUp",t.PROFILEVERTEXANDNORMAL="profileVertexAndNormal",t.FEATUREVALUE="featureValue",t.MODELORIGINHI="modelOriginHi",t.MODELORIGINLO="modelOriginLo",t.MODEL="model",t.MODELNORMAL="modelNormal",t.INSTANCECOLOR="instanceColor",t.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute",t.LOCALTRANSFORM="localTransform",t.GLOBALTRANSFORM="globalTransform",t.BOUNDINGSPHERE="boundingSphere",t.MODELORIGIN="modelOrigin",t.MODELSCALEFACTORS="modelScaleFactors",t.FEATUREATTRIBUTE="featureAttribute",t.STATE="state",t.LODLEVEL="lodLevel",t.POSITION0="position0",t.POSITION1="position1",t.NORMALA="normalA",t.NORMALB="normalB",t.COMPONENTINDEX="componentIndex",t.VARIANTOFFSET="variantOffset",t.VARIANTSTROKE="variantStroke",t.VARIANTEXTENSION="variantExtension",t.U8PADDING="u8padding",t.U16PADDING="u16padding",t.SIDENESS="sideness",t.START="start",t.END="end",t.UP="up",t.EXTRUDE="extrude",t.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor",t.INSTANCEOBJECTANDLAYERIDCOLOR="instanceObjectAndLayerIdColor"})(O||(O={}));var xs;function Zy(t,e){switch(e.textureCoordinateType){case xs.Default:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);case xs.Compressed:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),void t.vertex.code.add(T`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);case xs.Atlas:return t.attributes.add(O.UV0,"vec2"),t.varyings.add("vuv0","vec2"),t.attributes.add(O.UVREGION,"vec4"),t.varyings.add("vuvRegion","vec4"),void t.vertex.code.add(T`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:e.textureCoordinateType;case xs.None:return void t.vertex.code.add(T`void forwardTextureCoordinates() {}`);case xs.COUNT:return}}(function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Atlas=2]="Atlas",t[t.Compressed=3]="Compressed",t[t.COUNT=4]="COUNT"})(xs||(xs={}));function Od(t){t.code.add(T`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)}function Ph(t){t.include(Od),t.code.add(T`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture(depthTex, uv)), nearFar);
}`)}function vH(t){t.fragment.code.add(T`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)}var Ci;(function(t){t[t.Pass=0]="Pass",t[t.Draw=1]="Draw"})(Ci||(Ci={}));let Zn=class{constructor(e,r,i,n,s=null){this.name=e,this.type=r,this.arraySize=s,this.bind={[Ci.Pass]:null,[Ci.Draw]:null},i!=null&&n!=null&&(this.bind[i]=n)}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},ar=class extends Zn{constructor(e,r){super(e,"vec3",Ci.Pass,(i,n,s)=>i.setUniform3fv(e,r(n,s)))}};function J_(t){t.uniforms.add(new ar("mainLightDirection",(e,r)=>r.lighting.mainLight.direction))}function C0(t){t.uniforms.add(new ar("mainLightIntensity",(e,r)=>r.lighting.mainLight.intensity))}function TB(t){J_(t.fragment),C0(t.fragment),t.fragment.code.add(T`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)}let Yr=class extends Zn{constructor(e,r){super(e,"vec2",Ci.Pass,(i,n,s)=>i.setUniform2fv(e,r(n,s)))}},Cr=class extends Zn{constructor(e,r){super(e,"vec4",Ci.Pass,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}},Ye=class extends Zn{constructor(e,r){super(e,"float",Ci.Pass,(i,n,s)=>i.setUniform1f(e,r(n,s)))}},yn=class extends Zn{constructor(e,r){super(e,"mat4",Ci.Pass,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};const Xl=wr();let MCt=class{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}};function It(t,e){if(!t){e=e||"Assertion";const r=new Error(e).stack;throw new MCt(`${e} at ${r}`)}}function mC(t,e){t||(e=e||"",console.warn("Verify failed: "+e+`
`+new Error("verify").stack))}function V1e(t,e,r,i){let n,s=(r[0]-t[0])/e[0],o=(i[0]-t[0])/e[0];s>o&&(n=s,s=o,o=n);let a=(r[1]-t[1])/e[1],l=(i[1]-t[1])/e[1];if(a>l&&(n=a,a=l,l=n),s>l||a>o)return!1;a>s&&(s=a),l<o&&(o=l);let c=(r[2]-t[2])/e[2],u=(i[2]-t[2])/e[2];return c>u&&(n=c,c=u,u=n),!(s>u||c>o)&&(u<o&&(o=u),!(o<0))}function Rk(t,e,r,i,n,s=Qe()){const o=(i[n]-r[n])*(e[0]-t[0])-(i[0]-r[0])*(e[n]-t[n]),a=(i[0]-r[0])*(t[n]-r[n])-(i[n]-r[n])*(t[0]-r[0]);if(o===0)return!1;const l=a/o;return s[0]=t[0]+l*(e[0]-t[0]),s[1]=t[n]+l*(e[n]-t[n]),!0}function B1e(t,e,r,i,n){Xl[0]=t[0],Xl[1]=t[1],Xl[2]=t[2],Xl[3]=1,hh(Xl,Xl,e),n.length>2&&(n[2]=-Xl[2]),hh(Xl,Xl,r),It(Xl[3]!==0),n[0]=Xl[0]/Xl[3],n[1]=Xl[1]/Xl[3],n[2]=Xl[2]/Xl[3],n[0]=(.5*n[0]+.5)*i[2]+i[0],n[1]=(.5*n[1]+.5)*i[3]+i[1]}function $Ct(t,e){return Math.log(t)/Math.log(e)}function ICt(t,e,r,i){t[12]=e,t[13]=r,t[14]=i}function Kke(t){return t[0]===1&&t[1]===0&&t[2]===0&&t[3]===0&&t[4]===0&&t[5]===1&&t[6]===0&&t[7]===0&&t[8]===0&&t[9]===0&&t[10]===1&&t[11]===0&&t[15]===1}const Qke=re.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");let e6e=class{constructor(){this._includedModules=new Map}include(e,r){if(this._includedModules.has(e)){const i=this._includedModules.get(e);if(i!==r){Qke.error("Trying to include shader module multiple times with different sets of options.");const n=new Set;for(const s of Object.keys(i))i[s]!==e[s]&&n.add(s);for(const s of Object.keys(e))i[s]!==e[s]&&n.add(s);n.forEach(s=>console.error(`  ${s}: current ${i[s]} new ${e[s]}`))}}else this._includedModules.set(e,r),e(this.builder,r)}},jr=class extends e6e{constructor(){super(...arguments),this.vertex=new j1e,this.fragment=new j1e,this.attributes=new NCt,this.varyings=new FCt,this.extensions=new Are,this.constants=new t6e}get fragmentUniforms(){return this.fragment.uniforms.entries}get builder(){return this}generate(e){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s=e==="vertex"?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=e==="vertex"?UCt:kCt,c=this.constants.generateSource().concat(s.constants.generateSource());return`#version 300 es
${r.join(`
`)}

${l}

${c.join(`
`)}

${o.join(`
`)}

${i.join(`
`)}

${n.join(`
`)}

${a.join(`
`)}`}generateBind(e,r){const i=new Map;this.vertex.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)}),this.fragment.uniforms.entries.forEach(o=>{const a=o.bind[e];a!=null&&i.set(o.name,a)});const n=Array.from(i.values()),s=n.length;return(o,a,l)=>{for(let c=0;c<s;++c)n[c](r,o,a,l)}}},LCt=class{constructor(){this._entries=new Map}add(...e){for(const r of e)this._add(r)}get(e){return this._entries.get(e)}_add(e){if(e!=null){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new H(`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else Qke.error(`Trying to add null Uniform from ${new Error().stack}.`)}generateSource(){return Array.from(this._entries.values()).map(e=>e.arraySize!=null?`uniform ${e.type} ${e.name}[${e.arraySize}];`:`uniform ${e.type} ${e.name};`)}get entries(){return Array.from(this._entries.values())}},DCt=class{constructor(){this._entries=new Array}add(e){this._entries.push(e)}generateSource(){return this._entries}},j1e=class extends e6e{constructor(){super(...arguments),this.uniforms=new LCt,this.code=new DCt,this.constants=new t6e}get builder(){return this}},NCt=class{constructor(){this._entries=new Array}add(e,r){this._entries.push([e,r])}generateSource(e){return e==="fragment"?[]:this._entries.map(r=>`in ${r[1]} ${r[0]};`)}},FCt=class{constructor(){this._entries=new Map}add(e,r){this._entries.has(e)&&It(this._entries.get(e)===r),this._entries.set(e,r)}generateSource(e){const r=new Array;return this._entries.forEach((i,n)=>r.push(e==="vertex"?`out ${i} ${n};`:`in ${i} ${n};`)),r}},Are=class Pre{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const r=e==="vertex"?Pre.ALLOWLIST_VERTEX:Pre.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(i=>r.includes(i)).map(i=>`#extension ${i} : enable`)}};Are.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"],Are.ALLOWLIST_VERTEX=[];let t6e=class oo{constructor(){this._entries=new Set}add(e,r,i){let n="ERROR_CONSTRUCTOR_STRING";switch(r){case"float":n=oo._numberToFloatStr(i);break;case"int":n=oo._numberToIntStr(i);break;case"bool":n=i.toString();break;case"vec2":n=`vec2(${oo._numberToFloatStr(i[0])},                            ${oo._numberToFloatStr(i[1])})`;break;case"vec3":n=`vec3(${oo._numberToFloatStr(i[0])},                            ${oo._numberToFloatStr(i[1])},                            ${oo._numberToFloatStr(i[2])})`;break;case"vec4":n=`vec4(${oo._numberToFloatStr(i[0])},                            ${oo._numberToFloatStr(i[1])},                            ${oo._numberToFloatStr(i[2])},                            ${oo._numberToFloatStr(i[3])})`;break;case"ivec2":n=`ivec2(${oo._numberToIntStr(i[0])},                             ${oo._numberToIntStr(i[1])})`;break;case"ivec3":n=`ivec3(${oo._numberToIntStr(i[0])},                             ${oo._numberToIntStr(i[1])},                             ${oo._numberToIntStr(i[2])})`;break;case"ivec4":n=`ivec4(${oo._numberToIntStr(i[0])},                             ${oo._numberToIntStr(i[1])},                             ${oo._numberToIntStr(i[2])},                             ${oo._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${r}(${Array.prototype.map.call(i,s=>oo._numberToFloatStr(s)).join(", ")})`}return this._entries.add(`const ${r} ${e} = ${n};`),this}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}};const kCt=`#ifdef GL_FRAGMENT_PRECISION_HIGH
  precision highp float;
  precision highp sampler2D;
#else
  precision mediump float;
  precision mediump sampler2D;
#endif

out vec4 fragColor;`,UCt=`precision highp float;
precision highp sampler2D;`;let Mt=class extends Zn{constructor(e,r){super(e,"sampler2D",Ci.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};const fD=Ue(parseFloat(5802e-9.toFixed(6)),parseFloat(13558e-9.toFixed(6)),parseFloat(331e-7.toFixed(6))),kX=3,UX=Ue(kX*parseFloat(65e-8.toFixed(6)),kX*parseFloat(1881e-9.toFixed(6)),kX*parseFloat(85e-9.toFixed(6))),zCt=3996e-9,VCt=Ue(parseFloat(Number(fD[0]+UX[0]).toFixed(6)),parseFloat(Number(fD[1]+UX[1]).toFixed(6)),parseFloat(Number(fD[2]+UX[2]).toFixed(6)));function BCt(t){const e=new jr;e.attributes.add(O.POSITION,"vec2"),e.include(Zy,{textureCoordinateType:xs.Default}),e.varyings.add("worldRay","vec3"),e.varyings.add("eyeDir","vec3");const{vertex:r,fragment:i}=e;return r.uniforms.add(new yn("inverseProjectionMatrix",(n,s)=>s.camera.inverseProjectionMatrix),new yn("inverseViewMatrix",(n,s)=>A3(jCt,s.camera.viewMatrix))),r.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),i.uniforms.add(new ar("backgroundColor",n=>n.backgroundColor),new Yr("radii",n=>n.radii),new ar("cameraPosition",(n,s)=>s.camera.eye),new Cr("heightParameters",n=>n.heightParameters),new Ye("innerFadeDistance",n=>n.innerFadeDistance),new Ye("altitudeFade",n=>n.altitudeFade),new Mt("depthTexture",n=>n.depthTexture),new Ye("hazeStrength",n=>n.hazeStrength)),i.constants.add("betaRayleigh","vec3",fD),i.constants.add("betaCombined","vec3",VCt),i.constants.add("betaMie","float",zCt),i.constants.add("scaleHeight","float",ACt*Bb),J_(i),e.include(vH),t.haze&&(i.include(Ph),i.uniforms.add(new Yr("nearFar",(n,s)=>s.camera.nearFar))),i.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),i.code.add(T`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`),i.code.add(T`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`),i.code.add(T`
    const int STEPS = 6;

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${t.haze?T`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${t.haze?"":T`mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * `} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${t.haze?"":T`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${t.haze?T`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:T`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    ${t.haze?"":T`
            vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
              vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
              if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
                return fragColor;
              }

              float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
              vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
              float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
              if (relDist > 1.0) {
                return surfaceColor;
              }

              return mix(fragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
            }

            float getGlow(float dist, float radius, float intensity) {
              return pow(radius / max(dist, 1e-6), intensity);
            }

            vec3 getSun(vec3 cameraPos, vec3 rayDir, vec3 lightDir){

              // Get the amount of atmosphere between camera and the Sun along the view ray
              float scaleFract = (length(cameraPos) - radii[0]) / scaleHeight;
              float sunOpticalDepth = getOpticalDepth(cameraPos, rayDir, max(scaleFract, 0.0));

              // Find the amount of light that remains after travelling through the atmosphere from the Sun along the view ray
              // This will make the colour of the Sun reddish on the horizon and white from space
              vec3 sunTransmittance = exp(-(mix(betaCombined, betaRayleigh, 0.5)) * max(0.0, sunOpticalDepth));

              // Alignment of light direction and view ray
              float mu = clamp(dot(rayDir, lightDir), 0.0, 1.0);
              // Draw the Sun as a bright disc
              float sunDisc = 256.0 * smoothstep(0.0, 128.0, clamp(getGlow(1.0 - mu, 3e-5, 3.0), 0.0, 128.0));

              return normalize(sunTransmittance) * sunDisc;
            }`}

    ${t.haze&&t.reduced?T`
        float getDepth(vec2 uv){
          return linearDepthFromTexture(depthTexture, uv, nearFar);
        }

        float textureBilinear(vec2 uv) {
          // Information about the high-resolution depth texture
          vec2 depthTextureSize = vec2(textureSize(depthTexture, 0));
          vec2 texelSize = 1.0 / depthTextureSize;

          // The uv inside the upper right pixel - of the tile of 4 pixels -
          // that the atmosphere uv maps to in the depth texture
          vec2 depthUV = (uv * depthTextureSize) - vec2(0.5);

          // Relative distance of the uv coordinates inside the depth texture pixel
          vec2 f = fract(depthUV);

          // Snap to the centre of the depth texture pixel
          vec2 snapUV = (floor(depthUV) + vec2(0.5)) / depthTextureSize;

          // Read the depth texture pixel and its three neighbours
          float d0 = getDepth(snapUV);
          float d1 = getDepth(snapUV + vec2(texelSize.x, 0.0));
          float d2 = getDepth(snapUV + vec2(0.0, texelSize.y));
          float d3 = getDepth(snapUV + texelSize);

          // Return the bilinearly interpolated value of the neighbouring pixels based
          // on the sample position in the depth texture pixel
          return mix(mix(d0, d1, f.x), mix(d2, d3, f.x), f.y);
        }
        `:""}

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${t.haze?T`
          vec4 depthSample = texture(depthTexture, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;

              ${t.reduced?T`cameraSpaceRay *= -textureBilinear(vuv0);`:T`cameraSpaceRay *= -linearDepthFromTexture(depthTexture, vuv0, nearFar);`}

            terrainDepth = max(0.0, length(cameraSpaceRay));
          }else{
            discard;
          }
          `:T`${t.reduced?"":T`
                float depthSample = texture(depthTexture, vuv0).r;
                if (depthSample != 1.0) {
                  fragColor = vec4(0);
                  return;
                }`}`}

      ${t.haze?T`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            // Alpha is ignored for haze blending
            float alpha = 1.0;
            `:T`
            vec3 col = linearizeGamma(backgroundColor);
            col += getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            col += getSun(cameraPosition, rayDir, mainLightDirection);
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}

      col = tonemapACES(col);
      fragColor = delinearizeGamma(vec4(col, alpha));
      ${t.haze?"":T`fragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, fragColor);`}
    }
  `),e}const jCt=Me(),GCt=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:fD,build:BCt},Symbol.toStringTag,{value:"Module"}));let Jr=class{constructor(e,r){this._module=e,this._loadModule=r}get(){return this._module}async reload(){return this._module=await this._loadModule(),this._module}};var Qi,Zt,De,h0,Wt,zm,jP,$t,Oi,cs,Kt,ir,qn,Yt,Et,Fs,Hs,qr,nh,Ea;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(Qi||(Qi={})),function(t){t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(Zt||(Zt={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"}(De||(De={})),function(t){t[t.ADD=32774]="ADD",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.SUBTRACT=32778]="SUBTRACT",t[t.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"}(h0||(h0={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"}(Wt||(Wt={})),function(t){t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(zm||(zm={})),function(t){t[t.CW=2304]="CW",t[t.CCW=2305]="CCW"}(jP||(jP={})),function(t){t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT"}($t||($t={})),function(t){t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS"}(Oi||(Oi={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP"}(cs||(cs={})),function(t){t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Kt||(Kt={})),function(t){t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"}(ir||(ir={})),function(t){t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"}(qn||(qn={})),function(t){t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.RED=6403]="RED",t[t.RG=33319]="RG",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER"}(Yt||(Yt={})),function(t){t[t.RGBA4=32854]="RGBA4",t[t.R16F=33325]="R16F",t[t.RG16F=33327]="RG16F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.R32F=33326]="R32F",t[t.RG32F=33328]="RG32F",t[t.RGBA32F=34836]="RGBA32F",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB5_A1=32855]="RGB5_A1",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.RGB16F=34843]="RGB16F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.RGB565=36194]="RGB565",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2=32857]="RGB10_A2",t[t.RGB10_A2UI=36975]="RGB10_A2UI"}(Et||(Et={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.INT=5124]="INT",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"}(Fs||(Fs={})),function(t){t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"}(Hs||(Hs={})),function(t){t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.STATIC_READ=35045]="STATIC_READ",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.STREAM_COPY=35042]="STREAM_COPY"}(qr||(qr={})),function(t){t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER"}(nh||(nh={})),function(t){t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"}(Ea||(Ea={}));const zX=33984;var ko,Yd;(function(t){t[t.Texture=0]="Texture",t[t.BufferObject=1]="BufferObject",t[t.VertexArrayObject=2]="VertexArrayObject",t[t.Shader=3]="Shader",t[t.Program=4]="Program",t[t.FramebufferObject=5]="FramebufferObject",t[t.Renderbuffer=6]="Renderbuffer",t[t.Sync=7]="Sync",t[t.COUNT=8]="COUNT"})(ko||(ko={})),function(t){t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"}(Yd||(Yd={}));const G1e=33306;var ts,H1e,q1e,W1e,EB,Mre,X1e;(function(t){t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(ts||(ts={})),function(t){t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT=5124]="INT",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"}(H1e||(H1e={})),function(t){t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS"}(q1e||(q1e={})),function(t){t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED"}(W1e||(W1e={})),function(t){t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED"}(EB||(EB={})),function(t){t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"}(Mre||(Mre={})),function(t){t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"}(X1e||(X1e={}));let si=class{constructor(e,r,i){this.release=i,this.initializeConfiguration(e,r),this._configuration=r.snapshot(),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}destroy(){this._program=pt(this._program),this._pipeline=this._configuration=null}reload(e){pt(this._program),this._program=this.initializeProgram(e),this._pipeline=this.initializePipeline(e.rctx.capabilities)}get program(){return this._program}get compiled(){return this.program.compiled}get key(){return this._configuration.key}get configuration(){return this._configuration}bindPipelineState(e,r=null,i){e.setPipelineState(this.getPipelineState(r,i))}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}get primitiveType(){return Zt.TRIANGLES}getPipelineState(e,r){return this._pipeline}initializeConfiguration(e,r){}};const Br=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.UV0,2],[O.COLOR,3],[O.COLORFEATUREATTRIBUTE,3],[O.SIZE,4],[O.TANGENT,4],[O.AUXPOS1,5],[O.SYMBOLCOLOR,5],[O.AUXPOS2,6],[O.FEATUREATTRIBUTE,6],[O.INSTANCEFEATUREATTRIBUTE,6],[O.INSTANCECOLOR,7],[O.OBJECTANDLAYERIDCOLOR,7],[O.INSTANCEOBJECTANDLAYERIDCOLOR,7],[O.MODEL,8],[O.MODELNORMAL,12],[O.MODELORIGINHI,11],[O.MODELORIGINLO,15]]),HCt=re.getLogger("esri.views.webgl.checkWebGLError");function qCt(t,e){switch(e){case t.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case t.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case t.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case t.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case t.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case t.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const r6e=!!he("enable-feature:webgl-debug");function _p(){return r6e}function $re(){return r6e}function ew(t){if(_p()){const e=t.getError();if(e){const r=qCt(t,e),i=new Error().stack;HCt.error(new H("webgl-error","WebGL error occured",{message:r,stack:i}))}}}let Kr=class{constructor(e,r,i){this._context=e,this._locations=i,this._textures=new Map,this._freeTextureUnits=new dr({deallocator:null}),this._glProgram=e.programCache.acquire(r.generate("vertex"),r.generate("fragment"),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bindPass=r.generateBind(Ci.Pass,this),this.bindDraw=r.generateBind(Ci.Draw,this),this._fragmentUniforms=_p()?r.fragmentUniforms:null}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get compiled(){return this._glProgram.compiled}setUniform1b(e,r){this._glProgram.setUniform1i(e,r?1:0)}setUniform1i(e,r){this._glProgram.setUniform1i(e,r)}setUniform1f(e,r){this._glProgram.setUniform1f(e,r)}setUniform2fv(e,r){this._glProgram.setUniform2fv(e,r)}setUniform3fv(e,r){this._glProgram.setUniform3fv(e,r)}setUniform4fv(e,r){this._glProgram.setUniform4fv(e,r)}setUniformMatrix3fv(e,r){this._glProgram.setUniformMatrix3fv(e,r)}setUniformMatrix4fv(e,r){this._glProgram.setUniformMatrix4fv(e,r)}setUniform1fv(e,r){this._glProgram.setUniform1fv(e,r)}setUniform1iv(e,r){this._glProgram.setUniform1iv(e,r)}setUniform2iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform3iv(e,r){this._glProgram.setUniform3iv(e,r)}setUniform4iv(e,r){this._glProgram.setUniform4iv(e,r)}assertCompatibleVertexAttributeLocations(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")}stop(){this._textures.clear(),this._freeTextureUnits.clear()}bindTexture(e,r){if(r==null||r.glName==null){const n=this._textures.get(e);return n&&(this._context.bindTexture(null,n.unit),this._freeTextureUnit(n),this._textures.delete(e)),null}let i=this._textures.get(e);return i==null?(i=this._allocTextureUnit(r),this._textures.set(e,i)):i.texture=r,this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(r,i.unit),i.unit}rebindTextures(){this._context.useProgram(this),this._textures.forEach((e,r)=>{this._context.bindTexture(e.texture,e.unit),this.setUniform1i(r,e.unit)}),this._fragmentUniforms!=null&&this._fragmentUniforms.forEach(e=>{e.type!=="sampler2D"&&e.type!=="samplerCube"||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})}_allocTextureUnit(e){return{texture:e,unit:this._freeTextureUnits.length===0?this._textures.size:this._freeTextureUnits.pop()}}_freeTextureUnit(e){this._freeTextureUnits.push(e.unit)}};var Hi,cE,is,i_,cu,k_,GP,Si,uE,n_;(function(t){t[t.None=0]="None",t[t.Front=1]="Front",t[t.Back=2]="Back",t[t.COUNT=3]="COUNT"})(Hi||(Hi={})),function(t){t[t.Less=0]="Less",t[t.Lequal=1]="Lequal",t[t.COUNT=2]="COUNT"}(cE||(cE={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.UPDATE=1]="UPDATE"}(is||(is={})),function(t){t[t.NOT_LOADED=0]="NOT_LOADED",t[t.LOADING=1]="LOADING",t[t.LOADED=2]="LOADED"}(i_||(i_={})),function(t){t[t.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded",t[t.OutlineVisualElementMask=2]="OutlineVisualElementMask"}(cu||(cu={})),function(t){t[t.Highlight=0]="Highlight",t[t.MaskOccludee=1]="MaskOccludee",t[t.COUNT=2]="COUNT"}(k_||(k_={})),function(t){t[t.CHANGED=0]="CHANGED",t[t.UNCHANGED=1]="UNCHANGED"}(GP||(GP={})),function(t){t[t.Blend=0]="Blend",t[t.Opaque=1]="Opaque",t[t.Mask=2]="Mask",t[t.MaskBlend=3]="MaskBlend",t[t.COUNT=4]="COUNT"}(Si||(Si={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(uE||(uE={})),function(t){t.DDS_ENCODING="image/vnd-ms.dds",t.KTX2_ENCODING="image/ktx2",t.BASIS_ENCODING="image/x.basis"}(n_||(n_={}));function Ed(t,e,r=h0.ADD,i=[0,0,0,0]){return{srcRgb:t,srcAlpha:t,dstRgb:e,dstAlpha:e,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function Fa(t,e,r,i,n=h0.ADD,s=h0.ADD,o=[0,0,0,0]){return{srcRgb:t,srcAlpha:e,dstRgb:r,dstAlpha:i,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const Ude={face:zm.BACK,mode:jP.CCW},i6e={face:zm.FRONT,mode:jP.CCW},_H=t=>t===Hi.Back?Ude:t===Hi.Front?i6e:null,fu={zNear:0,zFar:1},hr={r:!0,g:!0,b:!0,a:!0};function WCt(t){return tRt.intern(t)}function XCt(t){return rRt.intern(t)}function YCt(t){return iRt.intern(t)}function ZCt(t){return nRt.intern(t)}function JCt(t){return sRt.intern(t)}function KCt(t){return oRt.intern(t)}function QCt(t){return aRt.intern(t)}function eRt(t){return lRt.intern(t)}function Qt(t){return cRt.intern(t)}let K_=class{constructor(e,r){this._makeKey=e,this._makeRef=r,this._interns=new Map}intern(e){if(!e)return null;const r=this._makeKey(e),i=this._interns;return i.has(r)||i.set(r,this._makeRef(e)),i.get(r)??null}};function Q_(t){return"["+t.join(",")+"]"}const tRt=new K_(n6e,t=>({__tag:"Blending",...t}));function n6e(t){return t?Q_([t.srcRgb,t.srcAlpha,t.dstRgb,t.dstAlpha,t.opRgb,t.opAlpha,t.color.r,t.color.g,t.color.b,t.color.a]):null}const rRt=new K_(s6e,t=>({__tag:"Culling",...t}));function s6e(t){return t?Q_([t.face,t.mode]):null}const iRt=new K_(o6e,t=>({__tag:"PolygonOffset",...t}));function o6e(t){return t?Q_([t.factor,t.units]):null}const nRt=new K_(a6e,t=>({__tag:"DepthTest",...t}));function a6e(t){return t?Q_([t.func]):null}const sRt=new K_(l6e,t=>({__tag:"StencilTest",...t}));function l6e(t){return t?Q_([t.function.func,t.function.ref,t.function.mask,t.operation.fail,t.operation.zFail,t.operation.zPass]):null}const oRt=new K_(c6e,t=>({__tag:"DepthWrite",...t}));function c6e(t){return t?Q_([t.zNear,t.zFar]):null}const aRt=new K_(u6e,t=>({__tag:"ColorWrite",...t}));function u6e(t){return t?Q_([t.r,t.g,t.b,t.a]):null}const lRt=new K_(d6e,t=>({__tag:"StencilWrite",...t}));function d6e(t){return t?Q_([t.mask]):null}const cRt=new K_(uRt,t=>({blending:WCt(t.blending),culling:XCt(t.culling),polygonOffset:YCt(t.polygonOffset),depthTest:ZCt(t.depthTest),stencilTest:JCt(t.stencilTest),depthWrite:KCt(t.depthWrite),colorWrite:QCt(t.colorWrite),stencilWrite:eRt(t.stencilWrite)}));function uRt(t){return t?Q_([n6e(t.blending),s6e(t.culling),o6e(t.polygonOffset),a6e(t.depthTest),l6e(t.stencilTest),c6e(t.depthWrite),u6e(t.colorWrite),d6e(t.stencilWrite)]):null}let dRt=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setSubState(e,r,i,n){return(i||e!==r)&&(n(e),this._pipelineInvalid=!0),e}},hRt=class extends Ai{constructor(){super(...arguments),this.heightParameters=wr(),this.radii=Qe(),this.innerFadeDistance=0,this.altitudeFade=0,this.hazeStrength=1,this.renderScale=Qe(),this.backgroundColor=A()}},VI=class h6e extends si{initializeProgram(e){return new Kr(e.rctx,h6e.shader.get().build(this.configuration),Br)}initializePipeline(){return this.configuration.reduced?Qt({blending:Ed(De.ONE,De.ZERO),depthTest:{func:Oi.ALWAYS},colorWrite:hr}):this.configuration.haze?Qt({blending:Fa(De.ONE,De.ZERO,De.ONE_MINUS_SRC_COLOR,De.ONE),colorWrite:hr}):Qt({blending:Ed(De.SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:Oi.LEQUAL},colorWrite:hr})}};VI.shader=new Jr(GCt,()=>le(()=>import("./ChapmanAtmosphere.glsl-8e782505.js"),[]));let jl=class extends Ai{constructor(){super(),this._key="",this._keyDirty=!1,this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[],this._parameterNames||(this._parameterNames=[])}get key(){return this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits)),this._key}snapshot(){const e=this._parameterNames,r={key:this.key};for(const i of e)r[i]=this[i];return r}};function X(t={}){return(e,r)=>{if(e._parameterNames=e._parameterNames??[],e._parameterNames.push(r),t.constValue!=null)Object.defineProperty(e,r,{get:()=>t.constValue});else{const i=e._parameterNames.length-1,n=t.count||2,s=Math.ceil(Math.log2(n)),o=e._parameterBits??[0];let a=0;for(;o[a]+s>16;)a++,a>=o.length&&o.push(0);e._parameterBits=o;const l=o[a],c=(1<<s)-1<<l;o[a]+=s,Object.defineProperty(e,r,{get(){return this[i]},set(u){if(this[i]!==u&&(this[i]=u,this._keyDirty=!0,this._parameterBits[a]=this._parameterBits[a]&~c|+u<<l&c,typeof u!="number"&&typeof u!="boolean"))throw new Error("Configuration value for "+r+" must be boolean or number, got "+typeof u)}})}}}let CB=class extends jl{constructor(){super(...arguments),this.haze=!1,this.reduced=!1}};d([X()],CB.prototype,"haze",void 0),d([X()],CB.prototype,"reduced",void 0);let La=class{constructor(e,r,i,n,s,o=!1,a=0){this.name=e,this.count=r,this.type=i,this.offset=n,this.stride=s,this.normalized=o,this.divisor=a}};new La(O.POSITION,3,$t.FLOAT,0,12);new La(O.POSITION,3,$t.FLOAT,0,20),new La(O.UV0,2,$t.FLOAT,12,20);new La(O.POSITION,3,$t.FLOAT,0,32),new La(O.NORMAL,3,$t.FLOAT,12,32),new La(O.UV0,2,$t.FLOAT,24,32);new La(O.POSITION,3,$t.FLOAT,0,16),new La(O.COLOR,4,$t.UNSIGNED_BYTE,12,16);const zde=[new La(O.POSITION,2,$t.FLOAT,0,8)],bF=[new La(O.POSITION,2,$t.FLOAT,0,16),new La(O.UV0,2,$t.FLOAT,8,16)];function Y1e(t){const e=t.gl;switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";case e.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case e.INVALID_OPERATION:return"The specified command is not allowed for the current state";case e.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case e.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case e.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"}function el(t,e){return t.vertexBuffers[e].byteLength/pRt(t.layout[e])}function pRt(t){return t[0].stride}function Vde(t,e,r,i,n=0){const s=t.gl,o=t.capabilities.instancing;t.bindBuffer(r);for(const a of i){const l=e.get(a.name);l===void 0&&console.error(`There is no location for vertex attribute '${a.name}' defined.`);const c=n*a.stride;if(a.count<=4)s.vertexAttribPointer(l,a.count,a.type,a.normalized,a.stride,a.offset+c),s.enableVertexAttribArray(l),a.divisor>0&&o&&o.vertexAttribDivisor(l,a.divisor);else if(a.count===9)for(let u=0;u<3;u++)s.vertexAttribPointer(l+u,3,a.type,a.normalized,a.stride,a.offset+12*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else if(a.count===16)for(let u=0;u<4;u++)s.vertexAttribPointer(l+u,4,a.type,a.normalized,a.stride,a.offset+16*u+c),s.enableVertexAttribArray(l+u),a.divisor>0&&o&&o.vertexAttribDivisor(l+u,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)}}function Bde(t,e,r,i){const n=t.gl,s=t.capabilities.instancing;t.bindBuffer(r);for(const o of i){const a=e.get(o.name);if(o.count<=4)n.disableVertexAttribArray(a),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a,0);else if(o.count===9)for(let l=0;l<3;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else if(o.count===16)for(let l=0;l<4;l++)n.disableVertexAttribArray(a+l),o.divisor&&o.divisor>0&&s&&s.vertexAttribDivisor(a+l,0);else console.error("Unsupported vertex attribute element count: "+o.count)}t.unbindBuffer(Wt.ARRAY_BUFFER)}function jde(t){switch(t){case Yt.ALPHA:case Yt.LUMINANCE:case Yt.RED:case Yt.RED_INTEGER:case Et.R8:case Et.R8I:case Et.R8UI:case Et.R8_SNORM:case Hs.STENCIL_INDEX8:return 1;case Yt.LUMINANCE_ALPHA:case Yt.RG:case Yt.RG_INTEGER:case Et.RGBA4:case Et.R16F:case Et.R16I:case Et.R16UI:case Et.RG8:case Et.RG8I:case Et.RG8UI:case Et.RG8_SNORM:case Et.RGB565:case Et.RGB5_A1:case Hs.DEPTH_COMPONENT16:return 2;case Yt.DEPTH_COMPONENT:case Yt.RGB:case Yt.RGB_INTEGER:case Et.RGB8:case Et.RGB8I:case Et.RGB8UI:case Et.RGB8_SNORM:case Et.SRGB8:case Hs.DEPTH_COMPONENT24:return 3;case Yt.DEPTH_STENCIL:case Yt.DEPTH24_STENCIL8:case Yt.RGBA:case Yt.RGBA_INTEGER:case Et.RGBA8:case Et.R32F:case Et.R11F_G11F_B10F:case Et.RG16F:case Et.R32I:case Et.R32UI:case Et.RG16I:case Et.RG16UI:case Et.RGBA8I:case Et.RGBA8UI:case Et.RGBA8_SNORM:case Et.SRGB8_ALPHA8:case Et.RGB9_E5:case Et.RGB10_A2UI:case Et.RGB10_A2:case Hs.DEPTH_STENCIL:case Hs.DEPTH_COMPONENT32F:case Hs.DEPTH24_STENCIL8:return 4;case Hs.DEPTH32F_STENCIL8:return 5;case Et.RGB16F:case Et.RGB16I:case Et.RGB16UI:return 6;case Et.RG32F:case Et.RG32I:case Et.RG32UI:case Et.RGBA16F:case Et.RGBA16I:case Et.RGBA16UI:return 8;case Et.RGB32F:case Et.RGB32I:case Et.RGB32UI:return 12;case Et.RGBA32F:case Et.RGBA32I:case Et.RGBA32UI:return 16;case ts.COMPRESSED_RGB_S3TC_DXT1_EXT:case ts.COMPRESSED_RGBA_S3TC_DXT1_EXT:return .5;case ts.COMPRESSED_RGBA_S3TC_DXT3_EXT:case ts.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case ts.COMPRESSED_R11_EAC:case ts.COMPRESSED_SIGNED_R11_EAC:case ts.COMPRESSED_RGB8_ETC2:case ts.COMPRESSED_SRGB8_ETC2:case ts.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case ts.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return .5;case ts.COMPRESSED_RG11_EAC:case ts.COMPRESSED_SIGNED_RG11_EAC:case ts.COMPRESSED_RGBA8_ETC2_EAC:case ts.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}const gC=re.getLogger("esri.views.webgl.VertexArrayObject");let pf=class{constructor(e,r,i,n,s=null){this._context=e,this._locations=r,this._layout=i,this._buffers=n,this._indexBuffer=s,this._glName=null,this._initialized=!1,e.instanceCounter.increment(ko.VertexArrayObject,this)}get glName(){return this._glName}get context(){return this._context}get vertexBuffers(){return this._buffers}get indexBuffer(){return this._indexBuffer}get byteSize(){return Object.keys(this._buffers).reduce((e,r)=>e+this._buffers[r].byteLength,this._indexBuffer!=null?this._indexBuffer.byteLength:0)}get layout(){return this._layout}get locations(){return this._locations}get memoryEstimate(){return this.byteSize+(Object.keys(this._buffers).length+(this._indexBuffer?1:0))*i$e}dispose(){var e;if(this._context){this._context.getBoundVAO()===this&&this._context.bindVAO(null);for(const r in this._buffers)(e=this._buffers[r])==null||e.dispose(),delete this._buffers[r];this._indexBuffer=pt(this._indexBuffer),this.disposeVAOOnly()}else(this._glName||Object.getOwnPropertyNames(this._buffers).length>0)&&gC.warn("Leaked WebGL VAO")}disposeVAOOnly(){var e,r;this._glName&&(((r=(e=this._context)==null?void 0:e.capabilities)==null?void 0:r.vao).deleteVertexArray(this._glName),this._glName=null),this._context.instanceCounter.decrement(ko.VertexArrayObject,this),this._context=x3(this._context)}initialize(){if(this._initialized)return;const e=this._context.capabilities.vao;if(e){const r=e.createVertexArray();e.bindVertexArray(r),this._bindLayout(),e.bindVertexArray(null),this._glName=r}this._initialized=!0}bind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())}_bindLayout(){const{_buffers:e,_layout:r,_indexBuffer:i}=this;e||gC.error("Vertex buffer dictionary is empty!");const n=this._context.gl;for(const s in e){const o=e[s];o||gC.error("Vertex buffer is uninitialized!");const a=r[s];a||gC.error("Vertex element descriptor is empty!"),Vde(this._context,this._locations,o,a)}i!=null&&(this._context.capabilities.vao?n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,i.glName):this._context.bindBuffer(i))}unbind(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()}_unbindLayout(){const{_buffers:e,_layout:r}=this;e||gC.error("Vertex buffer dictionary is empty!");for(const i in e){const n=e[i];n||gC.error("Vertex buffer is uninitialized!");const s=r[i];Bde(this._context,this._locations,n,s)}this._indexBuffer!=null&&this._context.unbindBuffer(this._indexBuffer.bufferType)}},gg=class extends pf{};var Mr;function Ire(t,e,r={}){const i=e===Mr.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];for(const n of i){const s=t.getContext(n,r);if(s)return s}return null}function fRt(t,e,r={}){const i=p6e(t);for(const n of i){const s=Ire(e,n,r);if(s)return s}return null}function p6e(t){if(t==="3d")return[Mr.WEBGL2];const e=he("esri-force-webgl");return e===Mr.WEBGL1||e===Mr.WEBGL2?[e]:he("mac")&&he("chrome")?[Mr.WEBGL1,Mr.WEBGL2]:[Mr.WEBGL2,Mr.WEBGL1]}(function(t){t[t.WEBGL1=1]="WEBGL1",t[t.WEBGL2=2]="WEBGL2"})(Mr||(Mr={}));const Pg=re.getLogger("esri.views.webgl.BufferObject");let ci=class jR{static createIndex(e,r,i){return new jR(e,Wt.ELEMENT_ARRAY_BUFFER,r,i)}static createVertex(e,r,i){return new jR(e,Wt.ARRAY_BUFFER,r,i)}static createUniform(e,r,i){if(e.type!==Mr.WEBGL2)throw new Error("Uniform buffers are supported in WebGL2 only!");return new jR(e,Wt.UNIFORM_BUFFER,r,i)}static createPixelPack(e,r=qr.STREAM_READ,i){if(e.type!==Mr.WEBGL2)throw new Error("Pixel pack buffers are supported in WebGL2 only!");const n=new jR(e,Wt.PIXEL_PACK_BUFFER,r);return i&&n.setSize(i),n}static createPixelUnpack(e,r=qr.STREAM_DRAW,i){if(e.type!==Mr.WEBGL2)throw new Error("Pixel unpack buffers are supported in WebGL2 only!");return new jR(e,Wt.PIXEL_UNPACK_BUFFER,r,i)}constructor(e,r,i,n){this._context=e,this.bufferType=r,this.usage=i,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(ko.BufferObject,this),this._glName=this._context.gl.createBuffer(),ew(this._context.gl),n&&this.setData(n)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get byteLength(){return this.bufferType===Wt.ELEMENT_ARRAY_BUFFER?this._indexType===$t.UNSIGNED_INT?4*this._size:2*this._size:this._size}get _isVAOAware(){return this.bufferType===Wt.ELEMENT_ARRAY_BUFFER||this.bufferType===Wt.ARRAY_BUFFER}dispose(){var e;(e=this._context)!=null&&e.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(ko.BufferObject,this),this._context=x3(this._context)):this._glName&&Pg.warn("Leaked WebGL buffer object")}setSize(e,r=null){if(e<=0&&Pg.error("Buffer size needs to be positive!"),this.bufferType===Wt.ELEMENT_ARRAY_BUFFER&&r!=null)switch(this._indexType=r,r){case $t.UNSIGNED_SHORT:e*=2;break;case $t.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let r=e.byteLength;this.bufferType===Wt.ELEMENT_ARRAY_BUFFER&&(l7(e)&&(r/=2,this._indexType=$t.UNSIGNED_SHORT),u7(e)&&(r/=4,this._indexType=$t.UNSIGNED_INT)),this._setBufferData(r,e)}_setBufferData(e,r=null){this._size=e;const i=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const n=this._context.gl;r!=null?n.bufferData(this.bufferType,r,this.usage):n.bufferData(this.bufferType,e,this.usage),ew(n),this._isVAOAware&&this._context.bindVAO(i)}setSubData(e,r,i,n){if(!e)return;(r<0||r*e.BYTES_PER_ELEMENT>=this.byteLength)&&Pg.error("offset is out of range!"),i>=n&&Pg.error("end must be bigger than start!"),(r+(n-i))*e.BYTES_PER_ELEMENT>this.byteLength&&Pg.error("An attempt to write beyond the end of the buffer!");const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const o=this._context.gl;if(this._context.type===Mr.WEBGL2)o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,e,i,n-i);else{const a=i===0&&n===e.length?e:e.subarray(i,n);o.bufferSubData(this.bufferType,r*e.BYTES_PER_ELEMENT,a)}ew(o),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,r=0,i,n){if(this._context.type!==Mr.WEBGL2)return void Pg.error("Get buffer subdata is supported in WebGL2 only!");if(i<0||n<0)return void Pg.error("Problem getting subdata: offset and length were less than zero!");const s=mRt(e)?e.BYTES_PER_ELEMENT:1;if(s*((i??0)+(n??0))>e.byteLength)return void Pg.error("Problem getting subdata: offset and length exceeded destination size!");r+s*(n??0)>this.byteLength&&Pg.warn("Potential problem getting subdata: requested data exceeds buffer size!");const o=this._context.gl;this._context.bindBuffer(this,Wt.COPY_READ_BUFFER),o.getBufferSubData(Wt.COPY_READ_BUFFER,r,e,i,n),this._context.unbindBuffer(Wt.COPY_READ_BUFFER)}async getSubDataAsync(e,r=0,i,n){this._context.type===Mr.WEBGL2?(await this._context.clientWaitAsync(),this.getSubData(e,r,i,n)):Pg.error("Get buffer subdata is supported in WebGL2 only!")}};function mRt(t){return Vct(t)}var ax;(function(t){t[t.Texture=0]="Texture",t[t.RenderBuffer=1]="RenderBuffer"})(ax||(ax={}));let Vr=class{constructor(e=0,r=e){this.width=e,this.height=r,this.target=qn.TEXTURE_2D,this.pixelFormat=Yt.RGBA,this.dataType=Fs.UNSIGNED_BYTE,this.samplingMode=Kt.LINEAR,this.wrapMode=ir.REPEAT,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.depth=1,this.isImmutable=!1}};function gRt(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*(t.hasMipmap?4/3:1)*jde(t.internalFormat)}let yRt=class f6e extends Vr{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case Et.R16F:case Et.R16I:case Et.R16UI:case Et.R32F:case Et.R32I:case Et.R32UI:case Et.R8_SNORM:case Et.R8:case Et.R8I:case Et.R8UI:this.pixelFormat=Yt.RED}}static validate(e,r){return new f6e(e,r)}};const Z1e=4;let Jt=class{constructor(e,r=null,i=null){if(this.type=ax.Texture,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const n=yRt.validate(e,r);if(!n)throw new H("Texture descriptor invalid");this._descriptor=n}if(this._descriptor.context.instanceCounter.increment(ko.Texture,this),this._descriptor.context.type!==Mr.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),JS(this._descriptor.target)))throw new H("3D and array textures are not supported in WebGL1");this._descriptor.target===qn.TEXTURE_CUBE_MAP?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get gpuMemoryUsage(){return xRt.delete(this),gRt(this._descriptor)}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty}dispose(){this._descriptor.context.gl&&this._glName&&(this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor.context.instanceCounter.decrement(ko.Texture,this))}release(){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new H("Immutable textures can't be resized!");i.width=e,i.height=r,this._descriptor.target===qn.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}}_setDataCubeMap(e=null){for(let r=qn.TEXTURE_CUBE_MAP_POSITIVE_X;r<=qn.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(e,r)}setData(e){this._setData(e)}_setData(e,r){if(!this._descriptor.context||!this._descriptor.context.gl)return;const i=this._descriptor.context.gl;ew(i),this._glName||(this._glName=i.createTexture()),e===void 0&&(e=null);const n=this._descriptor,s=r??n.target,o=JS(s);e===null&&(n.width=n.width||Z1e,n.height=n.height||Z1e,o&&(n.depth=n.depth??1));const a=this._descriptor.context.bindTexture(this,Jt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Jt.TEXTURE_UNIT_FOR_UPDATES),VX(this._descriptor.context,n),this._configurePixelStorage(),ew(i);const l=this._deriveInternalFormat();if(BX(e)){let c=e.width,u=e.height;const h=1;e instanceof HTMLVideoElement&&(c=e.videoWidth,u=e.videoHeight),n.width&&n.height,o&&n.depth,n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,c,u,h),this._texImage(s,0,l,c,u,h,e),ew(i),n.hasMipmap&&this.generateMipmap(),n.width||(n.width=c),n.height||(n.height=u),o&&!n.depth&&(n.depth=h)}else{const{width:c,height:u,depth:h}=n;if(c==null||u==null)throw new H("Width and height must be specified!");if(o&&h==null)throw new H("Depth must be specified!");if(n.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(s,l,n.hasMipmap,c,u,h),mz(e)){const f=e.levels,m=Q1e(s,c,u,h),g=Math.min(m-1,f.length-1);this._descriptor.context.gl2!=null?i.texParameteri(n.target,this._descriptor.context.gl2.TEXTURE_MAX_LEVEL,g):n.hasMipmap=n.hasMipmap&&m===f.length;const y=l;if(!bRt(y))throw new H("Attempting to use compressed data with an uncompressed format!");this._forEachMipmapLevel((_,b,w,x)=>{const S=f[Math.min(_,f.length-1)];this._compressedTexImage(s,_,y,b,w,x,S)},g)}else this._texImage(s,0,l,c,u,h,e),ew(i),n.hasMipmap&&this.generateMipmap()}J1e(i,this._descriptor),K1e(i,this._descriptor),vRt(this._descriptor.context,this._descriptor),ew(i),this._descriptor.context.bindTexture(a,Jt.TEXTURE_UNIT_FOR_UPDATES)}updateData(e,r,i,n,s,o,a=0){o||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const l=this._descriptor.context.gl,c=this._descriptor.context.gl2,u=this._descriptor,h=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,target:g,isImmutable:y}=u;if(y&&!this._wasImmutablyAllocated)throw new H("Cannot update immutable texture before allocation!");const _=this._descriptor.context.bindTexture(this,Jt.TEXTURE_UNIT_FOR_UPDATES,!0);if((r<0||i<0||n>u.width||s>u.height||r+n>u.width||i+s>u.height)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,a)}if(BX(o)?c?c.texSubImage2D(g,e,r,i,n,s,f,m,o):l.texSubImage2D(g,e,r,i,f,m,o):mz(o)?l.compressedTexSubImage2D(g,e,r,i,n,s,h,o.levels[e]):l.texSubImage2D(g,e,r,i,n,s,f,m,o),a){if(!c)return void console.error("Webgl2 must be enabled to use dataRowOffset!");l.pixelStorei(c.UNPACK_SKIP_ROWS,0)}this._descriptor.context.bindTexture(_,Jt.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(e,r,i,n,s,o,a,l){l||console.error("An attempt to use uninitialized data!"),this._glName||console.error("An attempt to update uninitialized texture!");const c=this._descriptor.context.gl2;if(c==null)throw new H("3D textures are not supported in WebGL1");const u=this._descriptor,h=this._deriveInternalFormat(),{pixelFormat:f,dataType:m,isImmutable:g,target:y}=u;if(g&&!this._wasImmutablyAllocated)throw new H("Cannot update immutable texture before allocation!");JS(y)||console.warn("Attempting to set 3D texture data on a non-3D texture");const _=this._descriptor.context.bindTexture(this,Jt.TEXTURE_UNIT_FOR_UPDATES);if(this._descriptor.context.setActiveTexture(Jt.TEXTURE_UNIT_FOR_UPDATES),(r<0||i<0||n<0||s>u.width||o>u.height||a>u.depth||r+s>u.width||i+o>u.height||n+a>u.depth)&&console.error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage(),mz(l))l=l.levels[e],c.compressedTexSubImage3D(y,e,r,i,n,s,o,a,h,l);else{const b=l;c.texSubImage3D(y,e,r,i,n,s,o,a,f,m,b)}this._descriptor.context.bindTexture(_,Jt.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const e=this._descriptor;if(!e.hasMipmap){if(this._wasImmutablyAllocated)throw new H("Cannot add mipmaps to immutable texture after allocation");e.hasMipmap=!0,this._samplingModeDirty=!0,VX(this._descriptor.context,e)}e.samplingMode===Kt.LINEAR?(this._samplingModeDirty=!0,e.samplingMode=Kt.LINEAR_MIPMAP_NEAREST):e.samplingMode===Kt.NEAREST&&(this._samplingModeDirty=!0,e.samplingMode=Kt.NEAREST_MIPMAP_NEAREST);const r=this._descriptor.context.bindTexture(this,Jt.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(Jt.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(e.target),this._descriptor.context.bindTexture(r,Jt.TEXTURE_UNIT_FOR_UPDATES)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,VX(this._descriptor.context,this._descriptor),this._wrapModeDirty=!0)}applyChanges(){const e=this._descriptor.context.gl,r=this._descriptor;this._samplingModeDirty&&(J1e(e,r),this._samplingModeDirty=!1),this._wrapModeDirty&&(K1e(e,r),this._wrapModeDirty=!1)}_deriveInternalFormat(){if(this._descriptor.context.type===Mr.WEBGL1)return this._descriptor.internalFormat=this._descriptor.pixelFormat;if(this._descriptor.internalFormat!=null)return this._descriptor.internalFormat===Yt.DEPTH_STENCIL&&(this._descriptor.internalFormat=Yt.DEPTH24_STENCIL8),this._descriptor.internalFormat;switch(this._descriptor.dataType){case Fs.FLOAT:switch(this._descriptor.pixelFormat){case Yt.RGBA:return this._descriptor.internalFormat=Et.RGBA32F;case Yt.RGB:return this._descriptor.internalFormat=Et.RGB32F;default:throw new H("Unable to derive format")}case Fs.UNSIGNED_BYTE:switch(this._descriptor.pixelFormat){case Yt.RGBA:return this._descriptor.internalFormat=Et.RGBA8;case Yt.RGB:return this._descriptor.internalFormat=Et.RGB8}}return this._descriptor.internalFormat=this._descriptor.pixelFormat===Yt.DEPTH_STENCIL?Yt.DEPTH24_STENCIL8:this._descriptor.pixelFormat}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:r,flipped:i,preMultiplyAlpha:n}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n?1:0)}_texStorage(e,r,i,n,s,o){const a=this._descriptor.context.gl2;if(a==null)throw new H("Immutable textures are not supported in WebGL1");if(!_Rt(r))throw new H("Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?Q1e(e,n,s,o):1;if(JS(e)){if(o==null)throw new H("Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,n,s,o)}else a.texStorage2D(e,l,r,n,s);this._wasImmutablyAllocated=!0}_texImage(e,r,i,n,s,o,a){const l=this._descriptor.context.gl,c=JS(e),{isImmutable:u,pixelFormat:h,dataType:f}=this._descriptor,m=this._descriptor.context.type===Mr.WEBGL2,g=m?l:null;if(m||!BX(a))if(u){if(a!=null){const y=a;if(c){if(o==null)throw new H("Missing depth dimension for 3D texture upload");g.texSubImage3D(e,r,0,0,0,n,s,o,h,f,y)}else l.texSubImage2D(e,r,0,0,n,s,h,f,y)}}else{const y=a;if(c){if(o==null)throw new H("Missing depth dimension for 3D texture upload");g.texImage3D(e,r,i,n,s,o,0,h,f,y)}else l.texImage2D(e,r,i,n,s,0,h,f,y)}else l.texImage2D(e,0,i,h,f,a)}_compressedTexImage(e,r,i,n,s,o,a){const l=this._descriptor.context.gl;let c=null;const u=JS(e),h=this._descriptor.isImmutable;if(u){if(this._descriptor.context.type!==Mr.WEBGL2)throw new H("3D textures are not supported in WebGL1");c=l}if(h){if(a!=null)if(u){if(o==null)throw new H("Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,n,s,o,i,a)}else l.compressedTexSubImage2D(e,r,0,0,n,s,i,a)}else if(u){if(o==null)throw new H("Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,n,s,o,0,a)}else l.compressedTexImage2D(e,r,i,n,s,0,a)}_forEachMipmapLevel(e,r=1/0){let{width:i,height:n,depth:s,hasMipmap:o,target:a}=this._descriptor;const l=a===qn.TEXTURE_3D;if(i==null||n==null||l&&s==null)throw new H("Missing texture dimensions for mipmap calculation");for(let c=0;e(c,i,n,s),o&&(i!==1||n!==1||l&&s!==1)&&!(c>=r);++c)i=Math.max(1,i>>1),n=Math.max(1,n>>1),l&&(s=Math.max(1,s>>1))}};function VX(t,e){(e.width!=null&&e.width<0||e.height!=null&&e.height<0||e.depth!=null&&e.depth<0)&&console.error("Negative dimension parameters are not allowed!");const r=t.type===Mr.WEBGL2;r||!e.isImmutable&&!JS(e.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!"),!r&&(e.width!=null&&tE(e.width)&&e.height!=null&&tE(e.height)||(typeof e.wrapMode=="number"?e.wrapMode!==ir.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):e.wrapMode.s===ir.CLAMP_TO_EDGE&&e.wrapMode.t===ir.CLAMP_TO_EDGE||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),e.hasMipmap&&console.error("Mipmapping requires power-of-two textures!")))}function J1e(t,e){let r=e.samplingMode,i=e.samplingMode;r===Kt.LINEAR_MIPMAP_NEAREST||r===Kt.LINEAR_MIPMAP_LINEAR?(r=Kt.LINEAR,e.hasMipmap||(i=Kt.LINEAR)):r!==Kt.NEAREST_MIPMAP_NEAREST&&r!==Kt.NEAREST_MIPMAP_LINEAR||(r=Kt.NEAREST,e.hasMipmap||(i=Kt.NEAREST)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}function K1e(t,e){typeof e.wrapMode=="number"?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}function vRt(t,e){const r=t.capabilities.textureFilterAnisotropic;r&&t.gl.texParameterf(e.target,r.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}function _Rt(t){return t in Et}function bRt(t){return t in ts}function mz(t){return t!=null&&"type"in t&&t.type==="compressed"}function wRt(t){return t!=null&&"byteLength"in t}function BX(t){return t!=null&&!mz(t)&&!wRt(t)}function JS(t){return t===qn.TEXTURE_3D||t===qn.TEXTURE_2D_ARRAY}function Q1e(t,e,r,i=1){let n=Math.max(e,r);return t===qn.TEXTURE_3D&&(n=Math.max(n,i)),Math.round(Math.log(n)/Math.LN2)+1}Jt.TEXTURE_UNIT_FOR_UPDATES=0;const xRt=new Map;function vu(t,e=zde,r=Br,i=-1,n=1){let s=null;return e===bF?s=new Float32Array([i,i,0,0,n,i,1,0,i,n,0,1,n,n,1,1]):s=new Float32Array([i,i,n,i,i,n,n,n]),new gg(t,r,{geometry:e},{geometry:ci.createVertex(t,qr.STATIC_DRAW,s)})}function SRt(t,e=zde,r=Br){const i=new Float32Array([-1,-1,3,-1,-1,3]);return new gg(t,r,{geometry:e},{geometry:ci.createVertex(t,qr.STATIC_DRAW,i)})}const m6e=4;function g6e(t,e=m6e){const r=new Vr;return r.samplingMode=Kt.NEAREST,r.width=r.height=e,new Jt(t,r)}function TRt(t,e,r=m6e){const i=new Uint8Array(r*r*4);for(let s=0;s<i.length;s+=4)i[s]=255*e[0],i[s+1]=255*e[1],i[s+2]=255*e[2],i[s+3]=255*e[3];const n=new Vr;return n.samplingMode=Kt.NEAREST,n.width=n.height=r,new Jt(t,n,i)}function y6e(t){const e=new Vr;return e.samplingMode=Kt.NEAREST,e.width=e.height=1,new Jt(t,e,new Uint8Array([255,255,255,255]))}let ebe=class{constructor(e,r){this._view=e,this.type=Sl.Realistic,this._handles=new Ri,this._passParameters=new hRt,this._rootTileElevationMin=NaN,this._lowerBoundEarthRadius=Rr.radius,this._fadeHaze=0,this._tmpScale=Qe(),this._updateRadius(Rr.radius);const i=r.renderContext.rctx;this._updateRootTileElevationBounds(),this._handles.add([pe(()=>{var s,o;return(o=(s=this._view)==null?void 0:s.basemapTerrain)==null?void 0:o.rootTileElevationBounds},()=>{var s;return(s=this._view)!=null&&s.basemapTerrain?this._updateRootTileElevationBounds():null}),pe(()=>{var s,o;return(o=(s=this._view)==null?void 0:s.basemapTerrain)==null?void 0:o.visibleElevationBounds},()=>{var s;return(s=this._view)!=null&&s.basemapTerrain?this._updateVisibleElevationBounds():null})]);const n=new CB;n.haze=!1,this._atmosphereTechnique=r.techniqueRepository.acquire(VI,n),n.haze=!0,this._atmosphereHazeTechnique=r.techniqueRepository.acquire(VI,n),n.reduced=!0,n.haze=!1,this._atmosphereReducedTechnique=r.techniqueRepository.acquire(VI,n),n.haze=!0,this._atmosphereHazeReducedTechnique=r.techniqueRepository.acquire(VI,n),this._vao=vu(i,bF)}destroy(){this._handles.destroy(),this._atmosphereTechnique.release(),this._atmosphereHazeTechnique.release(),this._atmosphereReducedTechnique.release(),this._atmosphereHazeReducedTechnique.release(),this._vao.dispose()}render(e,r){this._render(e,r?this._atmosphereTechnique:this._atmosphereReducedTechnique,e.offscreenRenderingHelper.depthTexture,r,!1)}renderHaze(e,r,i){this._fadeHaze=r,this._render(e,i?this._atmosphereHazeTechnique:this._atmosphereHazeReducedTechnique,e.offscreenRenderingHelper.linearDepthTexture,i,!0)}_render(e,r,i,n,s){if(i==null)return;const o=e.offscreenRenderingHelper;this._update(e.bindParameters.camera),this._passParameters.depthTexture=i;const a=o.background.color;se(this._passParameters.backgroundColor,a[0]*a[3],a[1]*a[3],a[2]*a[3]);const l=e.rctx.bindTechnique(r,this._passParameters,e.bindParameters);if(n)o.renderDepthDetached(()=>this._renderCommon(l,e));else{const c=e.rctx.getViewport(),u=We(e.bindParameters.camera.eye)-Rr.radius;let h;if(u<Bb){const g=Math.min(1,Math.max(0,u/Bb));h=s?Xt(.4,.5,g):Xt(.2,.3,g)}else{const g=Math.min(1,Math.max(0,(u-Bb)/(15*Bb)));h=s?Xt(.5,1,g):Xt(.3,.6,g)}const f=Math.floor(h*e.bindParameters.camera.fullViewport[2]),m=Math.floor(h*e.bindParameters.camera.fullViewport[3]);e.rctx.setViewport(0,0,f,m),o.renderToTargets(()=>this._renderCommon(l,e),o.tmpColor,o.tmpDepth,[0,0,0,1],!1,!1),e.rctx.setViewport(c.x,c.y,c.width,c.height),Or(this._tmpScale,f/e.bindParameters.camera.fullViewport[2],m/e.bindParameters.camera.fullViewport[3]),o.compositeAtmosphereToMain(e.bindParameters,s,i,this._tmpScale)}}_renderCommon(e,r){this._vao!=null&&(r.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),r.rctx.drawArrays(Zt.TRIANGLE_STRIP,0,4))}_adjustRadiusForTesselation(e){return e*Math.cos(Math.PI/16/16)}_updateRootTileElevationBounds(){const e=this._view.basemapTerrain.rootTileElevationBounds.min;e!==this._rootTileElevationMin&&(this._rootTileElevationMin=e,this._lowerBoundEarthRadius=Rr.radius,this._updateVisibleElevationBounds())}_updateVisibleElevationBounds(){const e=this._adjustRadiusForTesselation(Rr.radius+this._view.basemapTerrain.visibleElevationBounds.min);e<this._lowerBoundEarthRadius&&this._updateRadius(e)}_updateRadius(e){this._lowerBoundEarthRadius=e,Or(this._passParameters.radii,e,e+Bb),this._passParameters.innerFadeDistance=2*Math.sqrt((2*e-Ore)*Ore)}_update(e){if(!e)return;const r=Al(e.eye),i=Math.sqrt(r),n=r-this._passParameters.radii[1]*this._passParameters.radii[1],s=Te((i-this._passParameters.radii[0])/Bb,0,1);Ki(this._passParameters.heightParameters,i,r,n,s),this._passParameters.altitudeFade=kde(i-this._lowerBoundEarthRadius),this._passParameters.hazeStrength=Xt(Xt(.6,1,EN(9500,10500,i-Rr.radius)),1,this._fadeHaze)}static isSupported(e){return e.renderContext.rctx.capabilities.depthTexture}};function v6e(t){t.fragment.code.add(T`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)}function Gde(t,e){switch(t.include(Zy,e),e.textureCoordinateType){case xs.Default:case xs.Compressed:return void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return texture(tex, uv);
}`);case xs.Atlas:return t.include(v6e),void t.fragment.code.add(T`vec4 textureLookup(sampler2D tex, vec2 uv) {
return textureAtlasLookup(tex, uv, vuvRegion);
}`);default:e.textureCoordinateType;case xs.None:case xs.COUNT:return}}let _h=class extends Zn{constructor(e,r){super(e,"vec3",Ci.Draw,(i,n,s,o)=>i.setUniform3fv(e,r(n,s,o)))}},Wp=class extends Zn{constructor(e,r){super(e,"sampler2D",Ci.Draw,(i,n,s)=>i.bindTexture(e,r(n,s)))}},Rx=class{constructor(e){this._material=e.material,this._techniqueRepository=e.techniqueRep,this._output=e.output}dispose(){this._techniqueRepository.release(this._technique)}get technique(){return this._technique}get _stippleTextureRepository(){return this._techniqueRepository.constructionContext.stippleTextureRepository}get _markerTextureRepository(){return this._techniqueRepository.constructionContext.markerTextureRepository}ensureTechnique(e,r){return this._technique=this._techniqueRepository.releaseAndAcquire(e,this._material.getConfiguration(this._output,r),this._technique),this._technique}ensureResources(e){return i_.LOADED}},Hde=class extends Rx{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textureRepository=e.textureRep,this._textureId=e.textureId,this._acquire(e.textureId,r=>this._texture=r),this._acquire(e.normalTextureId,r=>this._textureNormal=r),this._acquire(e.emissiveTextureId,r=>this._textureEmissive=r),this._acquire(e.occlusionTextureId,r=>this._textureOcclusion=r),this._acquire(e.metallicRoughnessTextureId,r=>this._textureMetallicRoughness=r)}dispose(){this._texture=xn(this._texture),this._textureNormal=xn(this._textureNormal),this._textureEmissive=xn(this._textureEmissive),this._textureOcclusion=xn(this._textureOcclusion),this._textureMetallicRoughness=xn(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return this._numLoading===0?i_.LOADED:i_.LOADING}get textureBindParameters(){return new _6e(this._texture!=null?this._texture.glTexture:null,this._textureNormal!=null?this._textureNormal.glTexture:null,this._textureEmissive!=null?this._textureEmissive.glTexture:null,this._textureOcclusion!=null?this._textureOcclusion.glTexture:null,this._textureMetallicRoughness!=null?this._textureMetallicRoughness.glTexture:null)}updateTexture(e){this._texture!=null&&e===this._texture.id||(this._texture=xn(this._texture),this._textureId=e,this._acquire(this._textureId,r=>this._texture=r))}_acquire(e,r){if(e==null)return void r(null);const i=this._textureRepository.acquire(e);if(Dh(i))return++this._numLoading,void i.then(n=>{if(this._disposed)return xn(n),void r(null);r(n)}).finally(()=>--this._numLoading);r(i)}},_6e=class extends Ai{constructor(e=null,r=null,i=null,n=null,s=null){super(),this.texture=e,this.textureNormal=r,this.textureEmissive=i,this.textureOcclusion=n,this.textureMetallicRoughness=s}};var Nt;(function(t){t[t.Disabled=0]="Disabled",t[t.Normal=1]="Normal",t[t.Schematic=2]="Schematic",t[t.Water=3]="Water",t[t.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh",t[t.Terrain=5]="Terrain",t[t.TerrainWithWater=6]="TerrainWithWater",t[t.COUNT=7]="COUNT"})(Nt||(Nt={}));function qde(t,e){const r=t.fragment,i=e.hasMetallicRoughnessTexture||e.hasEmissionTexture||e.hasOcclusionTexture;if(e.pbrMode===Nt.Normal&&i&&t.include(Gde,e),e.pbrMode!==Nt.Schematic)if(e.pbrMode!==Nt.Disabled){if(e.pbrMode===Nt.Normal){r.code.add(T`vec3 mrr;
vec3 emission;
float occlusion;`);const n=e.pbrTextureBindType;e.hasMetallicRoughnessTexture&&(r.uniforms.add(n===Ci.Pass?new Mt("texMetallicRoughness",s=>s.textureMetallicRoughness):new Wp("texMetallicRoughness",s=>s.textureMetallicRoughness)),r.code.add(T`void applyMetallnessAndRoughness(vec2 uv) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`)),e.hasEmissionTexture&&(r.uniforms.add(n===Ci.Pass?new Mt("texEmission",s=>s.textureEmissive):new Wp("texEmission",s=>s.textureEmissive)),r.code.add(T`void applyEmission(vec2 uv) {
emission *= textureLookup(texEmission, uv).rgb;
}`)),e.hasOcclusionTexture?(r.uniforms.add(n===Ci.Pass?new Mt("texOcclusion",s=>s.textureOcclusion):new Wp("texOcclusion",s=>s.textureOcclusion)),r.code.add(T`void applyOcclusion(vec2 uv) {
occlusion *= textureLookup(texOcclusion, uv).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):r.code.add(T`float getBakedOcclusion() { return 1.0; }`),n===Ci.Pass?r.uniforms.add(new ar("emissionFactor",s=>s.emissiveFactor),new ar("mrrFactors",s=>s.mrrFactors)):r.uniforms.add(new _h("emissionFactor",s=>s.emissiveFactor),new _h("mrrFactors",s=>s.mrrFactors)),r.code.add(T`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;

      ${e.hasMetallicRoughnessTexture?T`applyMetallnessAndRoughness(${e.hasMetallicRoughnessTextureTransform?T`metallicRoughnessUV`:"vuv0"});`:""}

      ${e.hasEmissionTexture?T`applyEmission(${e.hasEmissiveTextureTransform?T`emissiveUV`:"vuv0"});`:""}

      ${e.hasOcclusionTexture?T`applyOcclusion(${e.hasOcclusionTextureTransform?T`occlusionUV`:"vuv0"});`:""}
    }
  `)}}else r.code.add(T`float getBakedOcclusion() { return 1.0; }`);else r.code.add(T`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`)}function Wde(t,e){const r=t.fragment,i=e.lightingSphericalHarmonicsOrder!==void 0?e.lightingSphericalHarmonicsOrder:2;i===0?(r.uniforms.add(new ar("lightingAmbientSH0",(n,s)=>se(tbe,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0]))),r.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===1?(r.uniforms.add(new Cr("lightingAmbientSH_R",(n,s)=>Ki(N0,s.lighting.sh.r[0],s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3])),new Cr("lightingAmbientSH_G",(n,s)=>Ki(N0,s.lighting.sh.g[0],s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3])),new Cr("lightingAmbientSH_B",(n,s)=>Ki(N0,s.lighting.sh.b[0],s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3]))),r.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):i===2&&(r.uniforms.add(new ar("lightingAmbientSH0",(n,s)=>se(tbe,s.lighting.sh.r[0],s.lighting.sh.g[0],s.lighting.sh.b[0])),new Cr("lightingAmbientSH_R1",(n,s)=>Ki(N0,s.lighting.sh.r[1],s.lighting.sh.r[2],s.lighting.sh.r[3],s.lighting.sh.r[4])),new Cr("lightingAmbientSH_G1",(n,s)=>Ki(N0,s.lighting.sh.g[1],s.lighting.sh.g[2],s.lighting.sh.g[3],s.lighting.sh.g[4])),new Cr("lightingAmbientSH_B1",(n,s)=>Ki(N0,s.lighting.sh.b[1],s.lighting.sh.b[2],s.lighting.sh.b[3],s.lighting.sh.b[4])),new Cr("lightingAmbientSH_R2",(n,s)=>Ki(N0,s.lighting.sh.r[5],s.lighting.sh.r[6],s.lighting.sh.r[7],s.lighting.sh.r[8])),new Cr("lightingAmbientSH_G2",(n,s)=>Ki(N0,s.lighting.sh.g[5],s.lighting.sh.g[6],s.lighting.sh.g[7],s.lighting.sh.g[8])),new Cr("lightingAmbientSH_B2",(n,s)=>Ki(N0,s.lighting.sh.b[5],s.lighting.sh.b[6],s.lighting.sh.b[7],s.lighting.sh.b[8]))),r.code.add(T`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),e.pbrMode!==Nt.Normal&&e.pbrMode!==Nt.Schematic||r.code.add(T`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))}const tbe=A(),N0=wr();function wF(t){t.vertex.code.add(T`const float PI = 3.141592653589793;`),t.fragment.code.add(T`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)}var bs,dE;function ERt(t){return(t==null?void 0:t.cubeMap)!=null}function Xde(t){return t!=null&&!t.running}(function(t){t[t.RENDERING=0]="RENDERING",t[t.FINISHED_RENDERING=1]="FINISHED_RENDERING",t[t.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS",t[t.SWITCH_CHANNELS=3]="SWITCH_CHANNELS",t[t.FINISHED=4]="FINISHED"})(bs||(bs={})),function(t){t[t.RG=0]="RG",t[t.BA=1]="BA"}(dE||(dE={}));let CRt=class{constructor(){this.readChannels=dE.RG,this.renderingStage=bs.FINISHED,this.startTime=0,this.startTimeHeightFade=0,this.cameraPositionLastFrame=A(),this.isCameraPositionFinal=!0,this.parallax=new rbe,this.parallaxNew=new rbe,this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3},this.fadeInOut={stage:Mo.FINISHED,factor:1,distanceThresholdFactor:.6},this.fadeIn={stage:Xu.FINISHED,factor:1,distanceThresholdFactor:2},this.fadeInOutHeight={stage:lx.FINISHED,factor:-1}}get isFading(){return this.fadeInOut.stage===Mo.FADE_OUT||this.fadeInOut.stage===Mo.FADE_IN||this.fadeIn.stage===Xu.FADE_IN||this.fadeInOutHeight.stage!==lx.FINISHED||this.renderingStage===bs.FADING_TEXTURE_CHANNELS}};var Xu,Mo,lx;(function(t){t[t.FINISHED=0]="FINISHED",t[t.CHANGE_ANCHOR=1]="CHANGE_ANCHOR",t[t.FADE_IN=2]="FADE_IN"})(Xu||(Xu={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.FADE_OUT=1]="FADE_OUT",t[t.SWITCH=2]="SWITCH",t[t.FADE_IN=3]="FADE_IN"}(Mo||(Mo={})),function(t){t[t.FINISHED=0]="FINISHED",t[t.HEIGHT_FADE=1]="HEIGHT_FADE"}(lx||(lx={}));let rbe=class{constructor(){this.anchorPointClouds=A(),this.cloudsHeight=1e5,this.radiusCurvatureCorrectionFactor=0,this.transform=Me()}},Jy=class extends Zn{constructor(e,r){super(e,"bool",Ci.Pass,(i,n,s)=>i.setUniform1b(e,r(n,s)))}},RRt=class extends Zn{constructor(e,r){super(e,"samplerCube",Ci.Pass,(i,n,s)=>i.bindTexture(e,r(n,s)))}};function b6e(t){const e=t.fragment;e.uniforms.add(new yn("rotationMatrixClouds",(r,i)=>i.cloudsFade.parallax.transform),new yn("rotationMatrixCloudsCrossFade",(r,i)=>i.cloudsFade.parallaxNew.transform),new ar("anchorPosition",(r,i)=>i.cloudsFade.parallax.anchorPointClouds),new ar("anchorPositionCrossFade",(r,i)=>i.cloudsFade.parallaxNew.anchorPointClouds),new Ye("cloudsHeight",(r,i)=>i.cloudsFade.parallax.cloudsHeight),new Ye("radiusCurvatureCorrectionFactor",(r,i)=>i.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new Ye("totalFadeInOut",(r,i)=>i.cloudsFade.fadeInOut.stage===Mo.FINISHED?i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeIn.factor:i.cloudsFade.fadeInOutHeight.factor+1-i.cloudsFade.fadeInOut.factor),new Ye("crossFadeAnchorFactor",(r,i)=>Te(i.cloudsFade.crossFade.factor,0,1)),new RRt("cubeMap",(r,i)=>{var n;return(n=i.cloudsFade.data)!=null&&n.cubeMap?i.cloudsFade.data.cubeMap.colorTexture:null}),new Jy("crossFade",(r,i)=>i.cloudsFade.crossFade.enabled),new Jy("readChannelsRG",(r,i)=>i.cloudsFade.readChannels===dE.RG),new Jy("fadeTextureChannels",(r,i)=>i.cloudsFade.renderingStage===bs.FADING_TEXTURE_CHANNELS)),e.constants.add("planetRadius","float",Rr.radius),e.code.add(T`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`),e.code.add(T`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`),e.code.add(T`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`),J_(e),C0(e),e.code.add(T`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`),e.code.add(T`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = texture(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`),e.code.add(T`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`),e.code.add(T`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`),e.code.add(T`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)}function R0(t){t.code.add(T`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)}function ORt(){const t=new jr;t.attributes.add(O.POSITION,"vec2"),t.varyings.add("worldRay","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new yn("inverseProjectionMatrix",(i,n)=>n.camera.inverseProjectionMatrix),new yn("inverseViewMatrix",(i,n)=>A3(ARt,n.camera.viewMatrix))),e.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`),r.include(R0),r.include(Od),t.include(Wde,{pbrMode:Nt.Disabled,lightingSphericalHarmonicsOrder:2}),t.include(wF),t.include(vH),t.include(TB),t.include(b6e,{instancedDoublePrecision:!1}),r.uniforms.add(new ar("cameraPosition",(i,n)=>n.camera.eye)),r.code.add(T`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
fragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`),t}const ARt=Me(),PRt=Object.freeze(Object.defineProperty({__proto__:null,build:ORt},Symbol.toStringTag,{value:"Module"}));let w6e=class x6e extends si{constructor(e){super(e,new jl,()=>this.destroy())}initializeProgram(e){return new Kr(e.rctx,x6e.shader.get().build(),Br)}initializePipeline(){return Qt({blending:Fa(De.ONE,De.ZERO,De.SRC_ALPHA,De.ONE),depthTest:{func:Oi.LEQUAL},colorWrite:hr})}};w6e.shader=new Jr(PRt,()=>le(()=>import("./CloudsComposition.glsl-20094afd.js"),[]));let KS=class extends Ce{constructor(e){super(e),this._technique=new w6e(e),this._vao=vu(e.rctx)}destroy(){this._technique=xn(this._technique),this._vao=pt(this._vao)}render(e){const r=e.bindParameters.cloudsFade;if(this._vao==null||r.data==null)return;if(!this._technique.compiled)return void this.requestRender();const i=e.rctx.bindTechnique(this._technique,MRt,e.bindParameters);e.rctx.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),e.rctx.drawArrays(Zt.TRIANGLE_STRIP,0,4)}};d([p({constructOnly:!0})],KS.prototype,"rctx",void 0),d([p({constructOnly:!0})],KS.prototype,"viewingMode",void 0),d([p({constructOnly:!0})],KS.prototype,"planetRadius",void 0),d([p({constructOnly:!0})],KS.prototype,"requestRender",void 0),KS=d([I("esri.views.3d.environment.CloudsComposition")],KS);const MRt=new Ai;var iu;(function(t){t[t.SIXTEEN=0]="SIXTEEN",t[t.HUNDRED=1]="HUNDRED",t[t.TWOHUNDRED=2]="TWOHUNDRED",t[t.COUNT=3]="COUNT"})(iu||(iu={}));let gz=class extends jl{constructor(){super(...arguments),this.steps=iu.SIXTEEN,this.writeTextureChannels=dE.RG}};d([X({count:iu.COUNT})],gz.prototype,"steps",void 0),d([X({constValue:he("esri-mobile")?1024:2048})],gz.prototype,"cubeMapSize",void 0),d([X()],gz.prototype,"writeTextureChannels",void 0);let BI=class{constructor(e,r,i,n,s,o,a,l,c=.5){this.coverage=e,this.density=r,this.absorption=i,this.cloudSize=n,this.detailSize=s,this.smoothness=o,this.cloudHeight=a,this.raymarchingSteps=l,this.median=c}};const ibe=new BI([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],iu.SIXTEEN),bl={sunny:ibe,cloudy:new BI([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],iu.TWOHUNDRED,.6),rainy:new BI([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],iu.TWOHUNDRED,.4),snowy:new BI([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],iu.HUNDRED,.65),foggy:new BI([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],iu.SIXTEEN),default:ibe},Ep=he("esri-mobile")?64:128,$Rt=Ep/128,fm=Math.ceil(Math.sqrt(Ep)),Uw=(Ep+2)*fm,IRt=1e5,jX=128,LRt=Uw/1560;function wf(t,e=!0){t.attributes.add(O.POSITION,"vec2"),e&&t.varyings.add("uv","vec2"),t.vertex.code.add(T`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${e?T`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)}let BN=class extends Zn{constructor(e,r){super(e,"mat3",Ci.Draw,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}},S6e=class extends Ai{constructor(){super(...arguments),this.cloudRadius=0,this.cloudSize=0,this.detailSize=0,this.absorption=0,this.density=0,this.smoothness=0,this.cloudHeight=0,this.coverage=0,this.raymarchingSteps=bl.default.raymarchingSteps,this.weatherTile=Qe()}},T6e=class extends Ai{constructor(){super(...arguments),this.viewMatrix=vn()}};function DRt(t){const e=new jr;e.include(wf,!1);const r=e.fragment;return r.uniforms.add(new Ye("cloudRadius",i=>i.cloudRadius),new Ye("power",i=>Xt(35,120,i.absorption)),new Ye("sigmaE",i=>1+i.absorption),new Ye("density",i=>Xt(0,.3,i.density)),new Ye("cloudSize",i=>Xt(0,.02,Math.max(.01,1-i.cloudSize))),new Ye("detailSize",i=>Xt(0,.2,Math.max(.01,1-i.detailSize))),new Ye("smoothness",i=>Xt(0,.5,1-i.smoothness)),new Ye("cloudHeight",i=>Xt(0,1500,i.cloudHeight)),new Ye("coverage",i=>i.coverage),new BN("view",i=>i.viewMatrix),new Mt("cloudShapeTexture",i=>i.noiseTexture!=null?i.noiseTexture.textureAtlas:null),new Yr("cloudVariables",i=>Or(NRt,i.coverage,i.absorption))),r.constants.add("halfCubeMapSize","float",.5*t.cubeMapSize),r.code.add(T`
    const int STEPS = ${t.steps===iu.SIXTEEN?T`16`:t.steps===iu.HUNDRED?T`100`:T`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`),r.code.add(T`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${T.float(Uw)};
      const float dataWidth = ${T.float(Uw)};
      const float tileRows = ${T.float(fm)};
      const vec3 atlasDimensions = vec3(${T.float(Ep)}, ${T.float(Ep)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${T.float($Rt)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = (${T.float(LRt)} * p) / ${T.float(Uw)} + 0.5;

      return texture(cloudShapeTexture, uv).a;
    }
    `),r.code.add(T`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`),r.code.add(T`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`),r.code.add(`
    float multipleOctaves(float extinction, float mu, float stepL) {
      float attenuation = 1.0;
      float contribution = 1.0;
      float phaseAttenuation = 1.0;
      float luminance = 0.0;

      for (int i = 0; i < 4; i++) {
        float phase = mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);
        luminance += contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);
        attenuation *= 0.2;
        contribution *= 0.6;
        phaseAttenuation *= 0.5;
      }

      return luminance;
    }`),r.code.add(T`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`),r.code.add(T`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`),r.code.add(T`void main() {
if (coverage ==  0.0) {
fragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
fragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`),e}const NRt=Qe(),FRt=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:T6e,CloudsPassParameters:S6e,build:DRt},Symbol.toStringTag,{value:"Module"}));let E6e=class C6e extends si{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Kr(e.rctx,C6e.shader.get().build(this.configuration),Br)}initializePipeline(){return Qt({blending:Ed(De.CONSTANT_COLOR,De.ONE_MINUS_CONSTANT_COLOR,h0.ADD,this.configuration.writeTextureChannels===dE.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:Oi.LEQUAL},colorWrite:hr})}};E6e.shader=new Jr(FRt,()=>le(()=>import("./Clouds.glsl-e4e86ec4.js"),[]));var ch;(function(t){t[t.Full=0]="Full",t[t.WeatherMap=1]="WeatherMap",t[t.COUNT=2]="COUNT"})(ch||(ch={}));let Lre=class extends jl{constructor(){super(...arguments),this.mode=ch.Full}};d([X({count:ch.COUNT})],Lre.prototype,"mode",void 0);let R6e=class extends Ai{constructor(){super(...arguments),this.weatherTile=Nr(0,0)}};function kRt(t){const e=new jr;return e.include(wf,!1),e.fragment.code.add(T`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`),t.mode===ch.Full&&e.fragment.code.add(T`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${T.float(fm)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${T.float(8)});

      float worley0 = worley(p, ${T.float(2)} * 2.0);
      float worley1 = worley(p, ${T.float(2)} * 8.0);
      float worley2 = worley(p, ${T.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${T.float(2)});
      float worley1 = worley(p, ${T.float(2)} * 2.0);
      float worley2 = worley(p, ${T.float(2)} * 4.0);
      float worley3 = worley(p, ${T.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `),e.fragment.uniforms.add(new Yr("weatherTile",r=>r.weatherTile)),e.fragment.code.add(T`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${T.float(jX)});

      // Get global coordinates of p
      p += weatherTile * ${T.float(jX)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${T.float(IRt)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `),e.fragment.code.add(T`void main() {`),t.mode===ch.Full&&e.fragment.code.add(T`
        float padWidth = 1.0;
        float paddedSize = ${T.float(Ep)} + 2.0 * padWidth;
        float tileCount = ${T.float(fm)} * ${T.float(fm)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${T.float(Ep)};
          }

          if (startPadY) {
            pixel.y += ${T.float(Ep)};
          }

          if (endPadX) {
            pixel.x -= ${T.float(Ep)};
          }

          if (endPadY) {
            pixel.y -= ${T.float(Ep)};
          }

          uv = vec2(pixel.xy / ${T.float(Ep)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${T.float(Ep)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${T.float(fm)} * ${T.float(fm)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        fragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${T.float(fm)} * ${T.float(fm)});
        p = p_;
        p.z /= (${T.float(fm)} * ${T.float(fm)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        fragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `),e.fragment.code.add(T`
      vec2 mapUV = ${T.float(jX)} * (gl_FragCoord.xy / ${T.float(Uw)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${t.mode===ch.Full?T`fragColor.ba = vec2(0.0, map);`:T`fragColor = vec4(map);`};
    }
  `),e}const URt=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:R6e,build:kRt},Symbol.toStringTag,{value:"Module"}));let Dre=class O6e extends si{initializeProgram(e){return new Kr(e.rctx,O6e.shader.get().build(this.configuration),Br)}initializePipeline(){return Qt({blending:this.configuration.mode===ch.Full?Ed(De.ONE,De.ZERO):Fa(De.ZERO,De.ONE,De.ONE,De.ZERO),depthTest:{func:Oi.ALWAYS},colorWrite:hr})}};Dre.shader=new Jr(URt,()=>le(()=>import("./NoiseTextureAtlas.glsl-15ecfbfb.js"),[]));let RB=class{constructor(e,r,i=r){this.internalFormat=e,this.width=r,this.height=i,this.multisampled=!1,this.samples=1}};function zRt(t){return t.width<=0||t.height<=0||t.internalFormat==null?0:t.width*t.height*jde(t.internalFormat)}let VRt=class{constructor(e,r){this._context=e,this._descriptor=r,this.type=ax.RenderBuffer,this._context.instanceCounter.increment(ko.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=r;if(a){if(this._context.type!==Mr.WEBGL2)throw new Error("Multisampled renderbuffers are not supported in WebGL1!");i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,o,n,s)}else i.renderbufferStorage(i.RENDERBUFFER,o,n,s)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,r=this._context.parameters.maxSamples;return e?Math.min(e,r):r}get gpuMemoryUsage(){return zRt(this._descriptor)}resize(e,r){const i=this._descriptor;if(i.width===e&&i.height===r)return;i.width=e,i.height=r;const n=this._context.gl;this._context.bindRenderbuffer(this),i.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,i.internalFormat,i.width,i.height):n.renderbufferStorage(n.RENDERBUFFER,i.internalFormat,i.width,i.height)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(ko.Renderbuffer,this),this._context=x3(this._context))}};const BRt=re.getLogger("esri.views.webgl.FramebufferObject");let wo=class GR{constructor(e,r,i=null){this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthBuffer=null,this._stencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(ko.FramebufferObject,this);const n=yz(r)?r:new Jt(this._context,r);if(this._colorAttachments.set(Yd.COLOR_ATTACHMENT0,n),this._validateTextureDescriptor(n.descriptor),this._validateColorAttachmentPoint(Yd.COLOR_ATTACHMENT0),i!=null)if(GRt(i))this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),this._depthStencilTexture=yz(i)?i:new Jt(this._context,i),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const s=jRt(i)?i:new VRt(this._context,i),o=s.descriptor;o.internalFormat===Hs.STENCIL_INDEX8?this._stencilBuffer=s:this._depthBuffer=s,this._validateRenderBufferDescriptor(o)}}dispose(){var r,i;if(this._colorAttachments.size===0&&!this._glName)return;const e=this._context.getBoundFramebufferObject();this._colorAttachments.forEach((n,s)=>{var o;return(o=this.detachColorTexture(s))==null?void 0:o.dispose()}),(r=this.detachDepthStencilBuffer())==null||r.dispose(),(i=this.detachDepthStencilTexture())==null||i.dispose(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context.bindFramebuffer(e),this._context.instanceCounter.decrement(ko.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){return this._colorAttachments.get(Yd.COLOR_ATTACHMENT0)}get depthStencilAttachment(){return this._depthStencilTexture||this._depthBuffer||this._stencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){var r;const e=this._colorAttachments.get(Yd.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.width)??0}get height(){var r;const e=this._colorAttachments.get(Yd.COLOR_ATTACHMENT0);return((r=e==null?void 0:e.descriptor)==null?void 0:r.height)??0}get gpuMemoryUsage(){var e;return[...this._colorAttachments].reduce((r,[i,n])=>r+n.gpuMemoryUsage,((e=this.depthStencilAttachment)==null?void 0:e.gpuMemoryUsage)??0)}getColorTexture(e){const r=this._colorAttachments.get(e);return r&&yz(r)?r:null}attachColorTexture(e,r=Yd.COLOR_ATTACHMENT0){var n;if(!e)return;this._validateColorAttachmentPoint(r);const i=e.descriptor;this._validateTextureDescriptor(i),(n=this.detachColorTexture(r))==null||n.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,r)),this._colorAttachments.set(r,e)}detachColorTexture(e=Yd.COLOR_ATTACHMENT0){const r=this._colorAttachments.get(e);if(r)return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e)),this._colorAttachments.delete(e),r}setColorTextureTarget(e,r=Yd.COLOR_ATTACHMENT0){const i=this._colorAttachments.get(r);i&&this._framebufferTexture2D(i.glName,r,e)}attachDepthStencil(e){if(e)switch(e.type){case ax.Texture:return this._attachDepthStencilTexture(e);case ax.RenderBuffer:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){var i;if(e==null)return;const r=e.descriptor;r.pixelFormat!==Yt.DEPTH_STENCIL&&r.pixelFormat!==Yt.DEPTH24_STENCIL8&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!"),r.dataType!==Fs.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"),this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!"),this._validateTextureDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,G1e)),(i=this._depthStencilTexture)==null||i.dispose(),this._depthStencilTexture=e}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,G1e)),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){var i;if(e==null)return;const r=e.descriptor;if(r.internalFormat!==Hs.DEPTH_STENCIL&&r.internalFormat!==Hs.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat"),this._validateRenderBufferDescriptor(r),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const n=this._context.gl,s=this._getGLAttachmentPoint(r);n.framebufferRenderbuffer(Ea.FRAMEBUFFER,s,n.RENDERBUFFER,e.glName)}(i=this._depthBuffer)==null||i.dispose(),this._depthBuffer=e}detachDepthStencilBuffer(){const e=this._depthBuffer;if(e&&this._initialized){this._context.bindFramebuffer(this);const r=this._context.gl,i=this._getGLAttachmentPoint(e.descriptor);r.framebufferRenderbuffer(Ea.FRAMEBUFFER,i,r.RENDERBUFFER,null),e.dispose()}return this._depthBuffer=null,e}copyToTexture(e,r,i,n,s,o,a){(e<0||r<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const l=a.descriptor;a.descriptor.target!==qn.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!"),((l==null?void 0:l.width)==null||(l==null?void 0:l.height)==null||e+i>this.width||r+n>this.height||s+i>l.width||o+n>l.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,u=c.bindTexture(a,Jt.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(Jt.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(qn.TEXTURE_2D,0,s,o,e,r,i,n),c.bindTexture(u,Jt.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,r,i,n,s,o,a){(i<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,r,i,n,s,o,a)}async readPixelsAsync(e,r,i,n,s,o,a){if(this._context.type!==Mr.WEBGL2)return _p()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),void this.readPixels(e,r,i,n,s,o,a);const l=this._context.gl,c=ci.createPixelPack(this._context,qr.STREAM_READ,a.byteLength);this._context.bindBuffer(c),this._context.bindFramebuffer(this),l.readPixels(e,r,i,n,s,o,0),this._context.unbindBuffer(Wt.PIXEL_PACK_BUFFER),await c.getSubDataAsync(a),c.dispose()}resize(e,r){var n,s,o;if(this.width===e&&this.height===r)return;const i={width:e,height:r};l2(i,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(a=>a.resize(i.width,i.height)),(n=this._depthStencilTexture)==null||n.resize(i.width,i.height),this._initialized&&(l2(i,this._context.parameters.maxRenderbufferSize),(s=this._depthBuffer)==null||s.resize(i.width,i.height),(o=this._stencilBuffer)==null||o.resize(i.width,i.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=Ea.FRAMEBUFFER){const r=this._context.gl;if(this._initialized)return void r.bindFramebuffer(e,this.glName);this._glName&&r.deleteFramebuffer(this._glName);const i=r.createFramebuffer();r.bindFramebuffer(e,i),this._colorAttachments.forEach((s,o)=>this._framebufferTexture2D(s.glName,o,nbe(s),e));const n=this._depthBuffer||this._stencilBuffer;if(n){const s=this._getGLAttachmentPoint(n.descriptor);r.framebufferRenderbuffer(e,s,r.RENDERBUFFER,n.glName)}else this._depthStencilTexture&&this._framebufferTexture2D(this._depthStencilTexture.glName,r.DEPTH_STENCIL_ATTACHMENT,nbe(this._depthStencilTexture),e);_p()&&r.checkFramebufferStatus(e)!==r.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=i,this._initialized=!0}_framebufferTexture2D(e,r=Yd.COLOR_ATTACHMENT0,i=qn.TEXTURE_2D,n=Ea.FRAMEBUFFER,s=0){this._context.gl.framebufferTexture2D(n,r,i,e,s)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthBuffer){if(this._initialized){this._context.bindFramebuffer(this);const r=this._getGLAttachmentPoint(this._depthBuffer.descriptor);e.framebufferRenderbuffer(Ea.FRAMEBUFFER,r,e.RENDERBUFFER,null)}this._depthBuffer=pt(this._depthBuffer)}this._stencilBuffer&&(this._initialized&&(this._context.bindFramebuffer(this),e.framebufferRenderbuffer(Ea.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null)),this._stencilBuffer=pt(this._stencilBuffer)),this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,e.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture=pt(this._depthStencilTexture))}_validateTextureDescriptor(e){e.target!==qn.TEXTURE_2D&&e.target!==qn.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!"),l2(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderBufferDescriptor(e){l2(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case Hs.DEPTH_COMPONENT16:case Hs.DEPTH_COMPONENT24:case Hs.DEPTH_COMPONENT32F:return this._context.gl.DEPTH_ATTACHMENT;case Hs.DEPTH24_STENCIL8:case Hs.DEPTH32F_STENCIL8:case Hs.DEPTH_STENCIL:return this._context.gl.DEPTH_STENCIL_ATTACHMENT;case Hs.STENCIL_INDEX8:return this._context.gl.STENCIL_ATTACHMENT}}_validateColorAttachmentPoint(e){if(GR._MAX_COLOR_ATTACHMENTS===-1){const i=this._context.capabilities.drawBuffers;if(i){const n=this._context.gl;GR._MAX_COLOR_ATTACHMENTS=n.getParameter(i.MAX_COLOR_ATTACHMENTS)}else GR._MAX_COLOR_ATTACHMENTS=1}const r=e-Yd.COLOR_ATTACHMENT0;r+1>GR._MAX_COLOR_ATTACHMENTS&&re.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${r+1}. Implementation supports up to ${GR._MAX_COLOR_ATTACHMENTS} color attachments`)}};function yz(t){return t!=null&&"type"in t&&t.type===ax.Texture}function jRt(t){return t!=null&&"type"in t&&t.type===ax.RenderBuffer}function GRt(t){return yz(t)||t!=null&&"pixelFormat"in t}function l2(t,e){const r=Math.max(t.width,t.height);if(r>e){BRt.warn(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function nbe(t){return t.descriptor.target===qn.TEXTURE_CUBE_MAP?qn.TEXTURE_CUBE_MAP_POSITIVE_X:qn.TEXTURE_2D}wo._MAX_COLOR_ATTACHMENTS=-1;let jI=class extends Ce{constructor(e){super(e),this._needsRender=!0,this._passParameters=new R6e,this._frameBuffer=new wo(e.context.renderContext.rctx,new Vr(Uw)),this._vao=vu(e.context.renderContext.rctx)}get _techniqueRepository(){return this.context.techniqueRepository}get textureAtlas(){return this._texture!=null?this._weatherMapTechnique!=null&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(ch.WeatherMap)):this._fullTechnique!=null&&this._fullTechnique.compiled&&(this._texture=this._render(ch.Full)),this._texture}_setDirty(){this._needsRender=!0}updateWeatherMap(e){this._passParameters.weatherTile[0]===e[0]&&this._passParameters.weatherTile[1]===e[1]||(Eo(this._passParameters.weatherTile,e),this._setDirty())}destroy(){this._fullTechniqueCached=xn(this._fullTechniqueCached),this._weatherMapTechniqueCached=xn(this._weatherMapTechniqueCached),this._frameBuffer=pt(this._frameBuffer),this._vao=pt(this._vao)}get _fullTechnique(){if(this._fullTechniqueCached==null){const e=new Lre;e.mode=ch.Full,this._fullTechniqueCached=this._techniqueRepository.acquire(Dre,e)}return this._fullTechniqueCached}get _weatherMapTechnique(){if(this._weatherMapTechniqueCached==null){const e=new Lre;e.mode=ch.WeatherMap,this._weatherMapTechniqueCached=this._techniqueRepository.acquire(Dre,e)}return this._weatherMapTechniqueCached}_render(e){if(this._vao==null||this._frameBuffer==null)return null;const r=e===ch.Full?this._fullTechnique:this._weatherMapTechnique,i=this.context.renderContext.rctx,n=i.getViewport();i.setViewport(0,0,Uw,Uw),i.bindFramebuffer(this._frameBuffer);const s=i.bindTechnique(r,this._passParameters,null);return i.bindVAO(this._vao),s.assertCompatibleVertexAttributeLocations(this._vao),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.setViewport(n.x,n.y,n.width,n.height),this._needsRender=!1,this._frameBuffer.colorTexture}};d([p({constructOnly:!0})],jI.prototype,"context",void 0),d([p({readOnly:!0})],jI.prototype,"_techniqueRepository",null),jI=d([I("esri.views.3d.environment.NoiseTextureAtlas")],jI);function A6e(t){t.include(Ph),t.uniforms.add(new Mt("geometryDepthTexture",(e,r)=>r.multipassGeometry.linearDepthTexture),new Yr("nearFar",(e,r)=>r.camera.nearFar)),t.code.add(T`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)}let HRt=class{constructor(){this.enabled=!1}};function Mh(t,e){e.hasMultipassTerrain&&(t.fragment.include(Ph),t.fragment.uniforms.add(new Mt("terrainDepthTexture",(r,i)=>i.multipassTerrain.linearDepthTexture)),t.fragment.uniforms.add(new Yr("nearFar",(r,i)=>i.camera.nearFar)),t.fragment.uniforms.add(new Yr("inverseViewport",(r,i)=>i.inverseViewport)),t.fragment.code.add(T`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${e.cullAboveGround?">":"<="} terrainDepth){
        discard;
      }
    }
  `))}let qRt=class{constructor(){this.enabled=!1,this.cullAboveGround=!1}};function WRt(t,e){const r=t.fragment;r.include(Ph),r.uniforms.add(new Yr("nearFar",(i,n)=>n.camera.nearFar)),r.uniforms.add(new Mt("depthMap",(i,n)=>n.linearDepthTexture)),r.uniforms.add(new yn("proj",(i,n)=>n.ssr.camera.projectionMatrix)),r.uniforms.add(new Ye("invResolutionHeight",(i,n)=>1/n.ssr.camera.height)),r.uniforms.add(new yn("reprojectionMatrix",(i,n)=>n.ssr.reprojectionMatrix)),r.code.add(T`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}let XRt=class{constructor(){this.enabled=!1,this.fadeFactor=1,this.reprojectionMatrix=Me()}};function YRt(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/e)}function ZRt(t,e,r){return 2*Math.atan(Math.sqrt(e*e+r*r)*Math.tan(.5*t)/r)}function JRt(t,e,r){return 2*Math.atan(e*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}function KRt(t,e,r){return 2*Math.atan(r*Math.tan(.5*t)/Math.sqrt(e*e+r*r))}var Nre;let Bt=Nre=class extends Ce{constructor(t={}){super(t),this._center=A(),this._up=A(),this._viewUp=A(),this._viewForward=A(),this._viewRight=A(),this._ray=la(),this._viewport=nr(0,0,1,1),this._padding=nr(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=Nr(1,1e3),this._viewDirty=!0,this._viewMatrix=Me(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=Me(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=Me(),this._frustumDirty=!0,this._frustum=LN(),this._fullViewport=wr(),this._pixelRatio=1,this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(t){this._pixelRatio=t>0?t:1}get eye(){return this._ray.origin}set eye(t){this._compareAndSetView(t,this._ray.origin)}get center(){return this._center}set center(t){this._compareAndSetView(t,this._center,"_center")}get ray(){return ve(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(t){this._compareAndSetView(t,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(t){Rs(this._viewMatrix,t),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),this._viewForward}get viewUp(){return this._ensureViewClean(),this._viewUp}get viewRight(){return this._ensureViewClean(),this._viewRight}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(t){this._nearFar[0]!==t&&(this._nearFar[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(t){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]}get screenViewport(){if(this.pixelRatio===1)return this._viewport;const t=eE(wr(),this._viewport,1/this.pixelRatio),e=this._get("screenViewport");return e&&NV(t,e)?e:t}get screenPadding(){if(this.pixelRatio===1)return this._padding;const t=eE(wr(),this._padding,1/this.pixelRatio),e=this._get("screenPadding");return e&&NV(t,e)?e:t}get x(){return this._viewport[0]}set x(t){t+=this._padding[Tr.LEFT],this._viewport[0]!==t&&(this._viewport[0]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(t){t+=this._padding[Tr.BOTTOM],this._viewport[1]!==t&&(this._viewport[1]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[Tr.RIGHT]+this._padding[Tr.LEFT]}set fullWidth(t){this.width=t-(this._padding[Tr.RIGHT]+this._padding[Tr.LEFT])}get fullHeight(){return this._viewport[3]+this._padding[Tr.TOP]+this._padding[Tr.BOTTOM]}set fullHeight(t){this.height=t-(this._padding[Tr.TOP]+this._padding[Tr.BOTTOM])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[Tr.LEFT],this._fullViewport[1]=this._viewport[1]-this._padding[Tr.BOTTOM],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(t){xA(this._padding,t)||(this._viewport[0]+=t[Tr.LEFT]-this._padding[Tr.LEFT],this._viewport[1]+=t[Tr.BOTTOM]-this._padding[Tr.BOTTOM],this._viewport[2]-=t[Tr.RIGHT]+t[Tr.LEFT]-(this._padding[Tr.RIGHT]+this._padding[Tr.LEFT]),this._viewport[3]-=t[Tr.TOP]+t[Tr.BOTTOM]-(this._padding[Tr.TOP]+this._padding[Tr.BOTTOM]),Up(this._padding,t),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(Ii(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){const t=this.width,e=this.height,r=this.near*Math.tan(this.fovY/2),i=r*this._aspect,n=iDe(Me(),-i*(1+2*this._padding[Tr.LEFT]/t),i*(1+2*this._padding[Tr.RIGHT]/t),-r*(1+2*this._padding[Tr.BOTTOM]/e),r*(1+2*this._padding[Tr.TOP]/e),this.near,this.far),s=this._get("projectionMatrix");return s&&iue(s,n)?s:n}get inverseProjectionMatrix(){return Uo(Me(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||Me()}get fov(){return this._fov}set fov(t){this._fov=t,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return JRt(this._fov,this.width,this.height)}set fovX(t){this._fov=YRt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return KRt(this._fov,this.width,this.height)}set fovY(t){this._fov=ZRt(t,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return Li(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(Uo(this._viewInverseTransposeMatrix,this.viewMatrix),Td(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(t){const e=2*t-1;return 2*this.near*this.far/(this.far+this.near-e*(this.far-this.near))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return this.relativeElevation!=null&&this.relativeElevation>=0}copyFrom(t){oe(this._ray.origin,t.eye),this.center=t.center,this.up=t.up,Up(this._viewport,t.viewport),this.notifyChange("_viewport"),Up(this._padding,t.padding),this.notifyChange("_padding"),Eo(this._nearFar,t.nearFar),this.notifyChange("_nearFar"),this._fov=t.fov,this.relativeElevation=t.relativeElevation;const e=t;return this._viewDirty=e._viewDirty,this._viewDirty||(Rs(this._viewMatrix,t.viewMatrix),oe(this._viewRight,t.viewRight),oe(this._viewUp,t.viewUp),oe(this._viewForward,t.viewForward)),this._viewProjectionDirty=!0,this._frustumDirty=e._frustumDirty,this._frustumDirty||(lB(this._frustum,t.frustum),this._frustumDirty=!1),e._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(Rs(this._viewInverseTransposeMatrix,t.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),Up(this._fullViewport,t.fullViewport),this.pixelRatio=t.pixelRatio,this}copyViewFrom(t){this.eye=t.eye,this.center=t.center,this.up=t.up}clone(){return new Nre().copyFrom(this)}equals(t){return gi(this.eye,t.eye)&&gi(this.center,t.center)&&gi(this.up,t.up)&&xA(this._viewport,t.viewport)&&xA(this._padding,t.padding)&&Yke(this.nearFar,t.nearFar)&&this._fov===t.fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation}almostEquals(t){if(Math.abs(t.fov-this._fov)>=.001||DV(t.screenPadding,this.screenPadding)>=1||DV(this.screenViewport,t.screenViewport)>=1)return!1;Gi(pl,t.eye,t.center),Gi(GX,this.eye,this.center);const e=ye(pl,GX),r=gP(pl),i=gP(GX),n=5e-4;return e*e>=(1-1e-10)*r*i&&S7(t.eye,this.eye)<Math.max(r,i)*n*n}computeRenderPixelSizeAt(t){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(t))}computeRenderPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeScreenPixelSizeAt(t){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(t))}_viewDirectionDistance(t){return Math.abs(kw(this.viewForward,ve(pl,t,this.eye)))}computeScreenPixelSizeAtDist(t){return t*this.perScreenPixelRatio}computeDistanceFromRadius(t,e){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(e||1)))}getScreenCenter(t=Tn()){return t[0]=(this.padding[Tr.LEFT]+this.width/2)/this.pixelRatio,t[1]=(this.padding[Tr.TOP]+this.height/2)/this.pixelRatio,t}getRenderCenter(t,e=.5,r=.5){return t[0]=this.padding[Tr.LEFT]+this.width*e,t[1]=this.padding[Tr.BOTTOM]+this.height*r,t[2]=.5,t}setGLViewport(t){const e=this.viewport,r=this.padding;t.setViewport(e[0]-r[3],e[1]-r[2],e[2]+r[1]+r[3],e[3]+r[0]+r[2])}applyProjection(t,e){t!==Sr&&oe(Sr,t),Sr[3]=1,hh(Sr,Sr,this.projectionMatrix);const r=Math.abs(Sr[3]);ce(Sr,Sr,1/r);const i=this.fullViewport;e[0]=Xt(0,i[0]+i[2],.5+.5*Sr[0]),e[1]=Xt(0,i[1]+i[3],.5+.5*Sr[1]),e[2]=.5*(Sr[2]+1),e[3]=r}unapplyProjection(t,e){const r=this.fullViewport;Sr[0]=(t[0]/(r[0]+r[2])*2-1)*t[3],Sr[1]=(t[1]/(r[1]+r[3])*2-1)*t[3],Sr[2]=(2*t[2]-1)*t[3],Sr[3]=t[3],this.inverseProjectionMatrix!=null&&(hh(Sr,Sr,this.inverseProjectionMatrix),e[0]=Sr[0],e[1]=Sr[1],e[2]=Sr[2])}projectToScreen(t,e){return this.projectToRenderScreen(t,HX),this.renderToScreen(HX,e),e}projectToRenderScreen(t,e){if(Sr[0]=t[0],Sr[1]=t[1],Sr[2]=t[2],Sr[3]=1,hh(Sr,Sr,this.viewProjectionMatrix),Sr[3]===0)return null;ce(Sr,Sr,1/Math.abs(Sr[3]));const r=this.fullViewport;return"x"in e?(e.x=Xt(0,r[0]+r[2],.5+.5*Sr[0]),e.y=Xt(0,r[1]+r[3],.5+.5*Sr[1])):(e[0]=Xt(0,r[0]+r[2],.5+.5*Sr[0]),e[1]=Xt(0,r[1]+r[3],.5+.5*Sr[1]),e.length>2&&(e[2]=.5*(Sr[2]+1))),e}unprojectFromScreen(t,e){return this.unprojectFromRenderScreen(this.screenToRender(t,HX),e)}unprojectFromRenderScreen(t,e){if(Ii(Ok,this.projectionMatrix,this.viewMatrix),!Uo(Ok,Ok))return null;const r=this.fullViewport;return Sr[0]=2*(t[0]-r[0])/r[2]-1,Sr[1]=2*(t[1]-r[1])/r[3]-1,Sr[2]=2*t[2]-1,Sr[3]=1,hh(Sr,Sr,Ok),Sr[3]===0?null:(e[0]=Sr[0]/Sr[3],e[1]=Sr[1]/Sr[3],e[2]=Sr[2]/Sr[3],e)}constrainWindowSize(t,e,r,i){const n=t*this.pixelRatio,s=e*this.pixelRatio,o=Math.max(n-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(n-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0);return[o,a,r-l- -Math.min(this.fullWidth-n-r/2,0),i-c- -Math.min(s-i/2,0)]}computeUp(t){t===at.Global?this._computeUpGlobal():this._computeUpLocal()}screenToRender(t,e){const r=t[0]*this.pixelRatio,i=this.fullHeight-t[1]*this.pixelRatio;return e[0]=r,e[1]=i,e}renderToScreen(t,e){const r=t[0]/this.pixelRatio,i=(this.fullHeight-t[1])/this.pixelRatio;e[0]=r,e[1]=i}_computeUpGlobal(){ve(pl,this.center,this.eye);const t=We(this.center);t<1?(se(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(ye(pl,this.center))>.9999*We(pl)*t||(Lt(this._up,pl,this.center),Lt(this._up,this._up,pl),Se(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){H_(pl,this.eye,this.center),Math.abs(pl[2])<=.9999&&(ce(pl,pl,pl[2]),se(this._up,-pl[0],-pl[1],1-pl[2]),Se(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(t,e,r=""){typeof t[0]=="number"&&isFinite(t[0])&&typeof t[1]=="number"&&isFinite(t[1])&&typeof t[2]=="number"&&isFinite(t[2])?gi(t,e)||(oe(e,t),this._markViewDirty(),r.length&&this.notifyChange(r)):re.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(KFe(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(M7(this._viewMatrix,this.eye,this.center,this.up),se(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),se(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),se(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};d([p()],Bt.prototype,"_center",void 0),d([p()],Bt.prototype,"_up",void 0),d([p()],Bt.prototype,"_viewport",void 0),d([p()],Bt.prototype,"_padding",void 0),d([p()],Bt.prototype,"_fov",void 0),d([p()],Bt.prototype,"_nearFar",void 0),d([p()],Bt.prototype,"_pixelRatio",void 0),d([p()],Bt.prototype,"pixelRatio",null),d([p()],Bt.prototype,"eye",null),d([p()],Bt.prototype,"center",null),d([p()],Bt.prototype,"up",null),d([p({readOnly:!0})],Bt.prototype,"nearFar",null),d([p()],Bt.prototype,"near",null),d([p()],Bt.prototype,"far",null),d([p()],Bt.prototype,"viewport",null),d([p({readOnly:!0})],Bt.prototype,"screenViewport",null),d([p({readOnly:!0})],Bt.prototype,"screenPadding",null),d([p()],Bt.prototype,"x",null),d([p()],Bt.prototype,"y",null),d([p()],Bt.prototype,"width",null),d([p()],Bt.prototype,"height",null),d([p()],Bt.prototype,"fullWidth",null),d([p()],Bt.prototype,"fullHeight",null),d([p({readOnly:!0})],Bt.prototype,"_aspect",null),d([p()],Bt.prototype,"padding",null),d([p({readOnly:!0})],Bt.prototype,"projectionMatrix",null),d([p({readOnly:!0})],Bt.prototype,"inverseProjectionMatrix",null),d([p()],Bt.prototype,"fov",null),d([p()],Bt.prototype,"fovX",null),d([p()],Bt.prototype,"fovY",null),Bt=Nre=d([I("esri.views.3d.webgl-engine.lib.Camera")],Bt);const Sr=wr(),Ok=Me(),pl=A(),GX=A(),HX=ua();var Tr;(function(t){t[t.TOP=0]="TOP",t[t.RIGHT=1]="RIGHT",t[t.BOTTOM=2]="BOTTOM",t[t.LEFT=3]="LEFT"})(Tr||(Tr={}));var _e;(function(t){t[t.INTEGRATED_MESH=0]="INTEGRATED_MESH",t[t.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN",t[t.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL",t[t.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL",t[t.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN",t[t.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL",t[t.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN",t[t.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL",t[t.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL",t[t.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS",t[t.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE",t[t.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT",t[t.LASERLINES=12]="LASERLINES",t[t.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL",t[t.HUD_MATERIAL=14]="HUD_MATERIAL",t[t.LABEL_MATERIAL=15]="LABEL_MATERIAL",t[t.LINE_CALLOUTS=16]="LINE_CALLOUTS",t[t.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH",t[t.DRAPED_MATERIAL=18]="DRAPED_MATERIAL",t[t.DRAPED_WATER=19]="DRAPED_WATER",t[t.VOXEL=20]="VOXEL",t[t.MAX_SLOTS=21]="MAX_SLOTS"})(_e||(_e={}));var kt;(function(t){t[t.Color=0]="Color",t[t.Alpha=1]="Alpha",t[t.FrontFace=2]="FrontFace",t[t.NONE=3]="NONE",t[t.COUNT=4]="COUNT"})(kt||(kt={}));let Yde=class{constructor(e=A()){this.intensity=e}},P6e=class{constructor(e=A(),r=Ue(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},OB=class{constructor(e=A(),r=Ue(.57735,.57735,.57735),i=!0,n=1,s=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=n,this.environmentStrength=s}},M6e=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}};function QRt(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e[i];return r}function qX(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]*e;return r}function RA(t,e,r){(r=r||t).length=t.length;for(let i=0;i<t.length;i++)r[i]=t[i]+e[i];return r}function $6e(t){return(t+1)*(t+1)}function eOt(t){return Te(Math.floor(Math.sqrt(t)-1),0,2)}function I6e(t,e,r){const i=t[0],n=t[1],s=t[2],o=r||[];return o.length=$6e(e),e>=0&&(o[0]=.28209479177),e>=1&&(o[1]=.4886025119*i,o[2]=.4886025119*s,o[3]=.4886025119*n),e>=2&&(o[4]=1.09254843059*i*n,o[5]=1.09254843059*n*s,o[6]=.31539156525*(3*s*s-1),o[7]=1.09254843059*i*s,o[8]=.54627421529*(i*i-n*n)),o}function tOt(t,e){const r=$6e(t),i=e||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let n=0;n<r;n++)i.r[n]=i.g[n]=i.b[n]=0;return i}function rOt(t,e){const r=eOt(e.r.length);for(const i of t)Nl(Fre,i.direction),I6e(Fre,r,zv),QRt(zv,vz),qX(zv,i.intensity[0],yC),RA(e.r,yC),qX(zv,i.intensity[1],yC),RA(e.g,yC),qX(zv,i.intensity[2],yC),RA(e.b,yC);return e}function iOt(t,e){I6e(Fre,0,zv);for(const r of t)e.r[0]+=zv[0]*vz[0]*r.intensity[0]*4*Math.PI,e.g[0]+=zv[0]*vz[0]*r.intensity[1]*4*Math.PI,e.b[0]+=zv[0]*vz[0]*r.intensity[2]*4*Math.PI;return e}function nOt(t,e,r,i){tOt(e,i),se(r.intensity,0,0,0);let n=!1;const s=sOt,o=oOt,a=aOt;s.length=0,o.length=0,a.length=0;for(const l of t)l instanceof OB&&!n?(oe(r.direction,l.direction),oe(r.intensity,l.intensity),r.specularStrength=l.specularStrength,r.environmentStrength=l.environmentStrength,r.castShadows=l.castShadows,n=!0):l instanceof OB||l instanceof P6e?s.push(l):l instanceof Yde?o.push(l):l instanceof M6e&&a.push(l);rOt(s,i),iOt(o,i);for(const l of a)RA(i.r,l.r),RA(i.g,l.g),RA(i.b,l.b)}const sOt=[],oOt=[],aOt=[],zv=[0],yC=[0],Fre=A(),vz=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];let sbe=class{constructor(){this.color=A(),this.intensity=1}},lOt=class{constructor(){this.direction=A(),this.ambient=new sbe,this.diffuse=new sbe}};const L6e=.4;let WX=class{constructor(){this._shOrder=2,this._legacy=new lOt,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new M6e,this._mainLight=new OB(A(),Ue(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){nOt(e,this._shOrder,this._mainLight,this._sphericalHarmonics),oe(this._legacy.direction,this._mainLight.direction);const r=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*r,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*r,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*r,ce(this._legacy.diffuse.color,this._mainLight.intensity,r),oe(Ak,this._legacy.diffuse.color),ce(Ak,Ak,L6e*this.globalFactor),ge(this._legacy.ambient.color,this._legacy.ambient.color,Ak)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),oe(this._mainLight.direction,e.mainLight.direction),oe(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,r,i){if(mi(this._mainLight.intensity,e.mainLight.intensity,r.mainLight.intensity,i),this._mainLight.environmentStrength=Xt(e.mainLight.environmentStrength,r.mainLight.environmentStrength,i),this._mainLight.specularStrength=Xt(e.mainLight.specularStrength,r.mainLight.specularStrength,i),oe(this._mainLight.direction,r.mainLight.direction),this._mainLight.castShadows=r.mainLight.castShadows,this.globalFactor=Xt(e.globalFactor,r.globalFactor,i),this.noonFactor=Xt(e.noonFactor,r.noonFactor,i),e.sh.r.length===r.sh.r.length)for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=Xt(e.sh.r[n],r.sh.r[n],i),this._sphericalHarmonics.g[n]=Xt(e.sh.g[n],r.sh.g[n],i),this._sphericalHarmonics.b[n]=Xt(e.sh.b[n],r.sh.b[n],i);else for(let n=0;n<r.sh.r.length;n++)this._sphericalHarmonics.r[n]=r.sh.r[n],this._sphericalHarmonics.g[n]=r.sh.g[n],this._sphericalHarmonics.b[n]=r.sh.b[n]}};const Ak=A();let bH=class{constructor(e,r,i){this.shadowMap=e,this.ssaoHelper=r,this.slicePlane=i,this.slot=_e.OPAQUE_MATERIAL,this.hasOccludees=!1,this.enableFillLights=!0,this.transparencyPassType=kt.NONE,this.alignPixelEnabled=!1,this._camera=new Bt,this._inverseViewport=Qe(),this.oldLighting=new WX,this.newLighting=new WX,this._fadedLighting=new WX,this._lighting=this.newLighting,this.ssr=new XRt,this.multipassTerrain=new qRt,this.multipassGeometry=new HRt,this.overlays=[],this.cloudsFade=new CRt}get camera(){return this._camera}set camera(e){this._camera=this.ssr.camera=e,this._inverseViewport[0]=1/e.fullViewport[2],this._inverseViewport[1]=1/e.fullViewport[3]}get inverseViewport(){return this._inverseViewport}get lighting(){return this._lighting}get weatherFading(){return this._lighting===this._fadedLighting}fadeLighting(e){const{oldLighting:r,newLighting:i}=this;e>=1?this._lighting=i:(this._fadedLighting.lerpLighting(r,i,e),this._lighting=this._fadedLighting)}},jc=class extends Ce{constructor(e){super(e),this._handles=new Ri,this._techniques=new Array,this._techniqueConfiguration=new gz,this._bindParameters=new bH(null,null,null),this._passParameters=new S6e,this._drawParameters=new T6e,this._weatherTile=Qe(),this._weatherTileCount=128,this._faceIndex=0,this._tileIndex=0,this.coverage=Xt(bl.default.coverage[0],bl.default.coverage[1],.5),this.density=Xt(bl.default.density[0],bl.default.density[1],.5),this.absorption=Xt(bl.default.absorption[0],bl.default.absorption[1],.5),this.cloudSize=Xt(bl.default.cloudSize[0],bl.default.cloudSize[1],.5),this.detailSize=Xt(bl.default.detailSize[0],bl.default.detailSize[1],.5),this.smoothness=Xt(bl.default.smoothness[0],bl.default.smoothness[1],.5),this.cloudHeight=Xt(bl.default.cloudHeight[0],bl.default.cloudHeight[1],.5),this.raymarchingSteps=bl.default.raymarchingSteps,this._viewMatrix=Me(),this._dirty=!1,this.running=!1,this._vao=vu(e.context.renderContext.rctx)}_getTechnique(e){const r=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,i=r===dE.RG?2*e:2*e+1;return this._techniques[i]||(this._techniqueConfiguration.writeTextureChannels=r,this._techniqueConfiguration.steps=e,this._techniques[i]=new E6e({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration),this._techniques[i])}updateWeatherTile(){const e=this.view.camera.position.latitude,r=this.view.camera.position.longitude;if(e==null||r==null)return;Or(this._weatherTile,(e+90)/180,(r+180)/360);const i=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1));this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-i)*this._weatherTile[1]);let n=0,s=0;if(this.view.environment!=null&&this.view.environment.lighting.type!=="virtual"&&this.view.environment.lighting.date!=null){const o=new Date(this.view.environment.lighting.date);o.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),n=31*o.getUTCMonth()+o.getUTCDate(),s=o.getUTCFullYear()}this._weatherTile[0]=(this._weatherTile[0]+n)%(2*this._weatherTileCount),this._weatherTile[1]=(this._weatherTile[1]+s%100)%(4*this._weatherTileCount),Zke(this._passParameters.weatherTile,this._weatherTile)||this.setDirty()}initialize(){const e=Xr(this.view.spatialReference);this._passParameters.cloudRadius=.5*e.radius,this.setDirty(),this.updateWeatherTile(),this._handles.add([this.view.resourceController.scheduler.registerTask(Vt.CLOUDS_GENERATOR,this),pe(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),_r)])}destroy(){this._handles.destroy(),this._techniques.forEach(e=>xn(e)),this._frameBufferCube=pt(this._frameBufferCube),this._techniques.length=0,this._vao.dispose(),this._passParameters.noiseTexture=qe(this._passParameters.noiseTexture)}get _tilesPerFace(){switch(this._techniqueConfiguration.steps){case iu.SIXTEEN:return 1;case iu.HUNDRED:return 4;case iu.COUNT:case iu.TWOHUNDRED:return 8}}_ensureNoiseTexture(){if(this._passParameters.noiseTexture!=null)this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);else{const e=this.context;this._passParameters.noiseTexture=new jI({context:e}),this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile)}return this._passParameters.noiseTexture.textureAtlas!=null}_ensureFrameBufferCube(e){if(this._frameBufferCube==null){const r=new Vr(e);r.target=qn.TEXTURE_CUBE_MAP,r.wrapMode=ir.CLAMP_TO_EDGE,this._frameBufferCube=new wo(this.context.renderContext.rctx,r)}return this._frameBufferCube}get cubeMap(){return this._frameBufferCube}destroyFrameBufferCube(){this._frameBufferCube=pt(this._frameBufferCube)}applyPreset(e,r){const i=e.median,n=s=>{const o=Xt(s[0],s[1],i);return r<.5?Xt(s[0],o,2*r):Xt(o,s[1],2*(r-.5))};this.coverage=n(e.coverage),this.density=n(e.density),this.absorption=n(e.absorption),this.cloudSize=n(e.cloudSize),this.detailSize=n(e.detailSize),this.smoothness=n(e.smoothness),this.cloudHeight=n(e.cloudHeight),this.raymarchingSteps=e.raymarchingSteps}setDirty(){this._dirty=this.running=!0}runTask(e){this._faceIndex===0&&this._tileIndex===0&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,this.updateWeatherTile(),Eo(this._passParameters.weatherTile,this._weatherTile));const r=this._getTechnique(this._passParameters.raymarchingSteps);if(!r.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return ll.YIELD;this._faceIndex===0&&this._tileIndex===0&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=bs.RENDERING,this._passParameters.absorption=this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);const i=this.context.renderContext.rctx,n=i.bindTechnique(r,this._passParameters,this._bindParameters);i.bindVAO(this._vao),n.assertCompatibleVertexAttributeLocations(this._vao);const s=i.getViewport(),o=r.configuration.cubeMapSize,a=o/this._tilesPerFace,l=this._tileIndex*a;i.setViewport(0,l,o,a);const c=this._ensureFrameBufferCube(o);i.bindFramebuffer(c);const u=cOt[this._faceIndex],h=uOt[this._faceIndex];sDe(this._viewMatrix,dOt,u,h),uf(this._drawParameters.viewMatrix,this._viewMatrix);const f=qn.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex;return c.setColorTextureTarget(f),n.bindDraw(this._drawParameters,this._bindParameters,this._passParameters),i.gl.drawArrays(i.gl.TRIANGLE_STRIP,0,4),i.gl.flush(),i.setViewport(s.x,s.y,s.width,s.height),this.requestRender(),++this._tileIndex,this._faceIndex===4&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._faceIndex=0,this._tileIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=bs.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0),e.madeProgress(),ll.YIELD}};d([p({constructOnly:!0})],jc.prototype,"context",void 0),d([p({constructOnly:!0})],jc.prototype,"view",void 0),d([p({constructOnly:!0})],jc.prototype,"requestRender",void 0),d([p()],jc.prototype,"coverage",void 0),d([p()],jc.prototype,"density",void 0),d([p()],jc.prototype,"absorption",void 0),d([p()],jc.prototype,"cloudSize",void 0),d([p()],jc.prototype,"detailSize",void 0),d([p()],jc.prototype,"smoothness",void 0),d([p()],jc.prototype,"cloudHeight",void 0),d([p()],jc.prototype,"raymarchingSteps",void 0),d([p()],jc.prototype,"running",void 0),jc=d([I("esri.views.3d.environment.CloudsGenerator")],jc);const cOt=[xi(1,0,0),xi(-1,0,0),xi(0,1,0),xi(0,-1,0),xi(0,0,1)],uOt=[xi(0,1,0),xi(0,1,0),xi(0,0,-1),xi(0,0,1),xi(0,1,0)],dOt=gde();let D6e=class extends Ai{constructor(){super(...arguments),this.fogColor=A(),this.fogStrength=4e-6,this.atmosphereC=1,this.fogAmount=0}};function hOt(){const t=new jr;t.attributes.add(O.POSITION,"vec2"),t.include(Zy,{textureCoordinateType:xs.Default}),t.varyings.add("worldRay","vec3"),t.varyings.add("eyeDir","vec3");const{vertex:e,fragment:r}=t;return e.uniforms.add(new yn("inverseProjectionMatrix",(i,n)=>n.camera.inverseProjectionMatrix),new yn("inverseViewMatrix",(i,n)=>A3(pOt,n.camera.viewMatrix))),e.code.add(T`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`),r.uniforms.add(new Ye("atmosphereC",i=>i.atmosphereC),new ar("cameraPosition",(i,n)=>n.camera.eye),new Yr("nearFar",(i,n)=>n.camera.nearFar),new Mt("depthTexture",i=>i.depthTexture),new Ye("fogStrength",i=>i.fogStrength),new Ye("fogAmount",i=>i.fogAmount),new ar("fogColor",i=>i.fogColor)),t.include(vH),r.include(Ph),r.code.add(T`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`),r.code.add(T`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`),r.code.add(T`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}
void main() {
vec3 rayDir = normalize(worldRay);
float terrainDepth = -1.0;
float depthSample = texture(depthTexture, vuv0).r;
float zNorm = 2.0 * depthSample - 1.0;
float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
if(depthSample < 1.0 && depthSample > 0.0){
vec3 cameraSpaceRay = normalize(eyeDir);
cameraSpaceRay /= cameraSpaceRay.z;
cameraSpaceRay *= linDepth;
terrainDepth = max(0.0, length(cameraSpaceRay));
}
vec4 fog = applyFog(terrainDepth, rayDir);
fragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
}`),t}const pOt=Me(),fOt=Object.freeze(Object.defineProperty({__proto__:null,FogPassParameters:D6e,build:hOt},Symbol.toStringTag,{value:"Module"}));let N6e=class F6e extends si{constructor(e){super(e,new jl,()=>this.destroy())}initializeProgram(e){return new Kr(e.rctx,F6e.shader.get().build(),Br)}initializePipeline(){return Qt({blending:Fa(De.SRC_ALPHA,De.ZERO,De.ONE_MINUS_SRC_ALPHA,De.ONE),colorWrite:hr})}};N6e.shader=new Jr(fOt,()=>le(()=>import("./Fog.glsl-f24d0a57.js"),[]));const mOt=.95,gOt=1;let QS=class extends Ce{constructor(e){super(e),this._passParameters=new D6e;const r=e.context.renderContext.rctx;this._vao=vu(r,bF),this._technique=new N6e(e);const i=Xr(e.view.spatialReference);this._planetRadius=i.radius,this._atmosphereRadius=i.radius+Bb}destroy(){this._technique.release(),this._vao.dispose()}set strength(e){this._passParameters.fogStrength=e}get strength(){return this._passParameters.fogStrength}render(e,r){if(this._update(e,r),this._passParameters.fogAmount<=0)return;const i=this._technique;if(!i.compiled)return void this.context.requestRender();const n=e.offscreenRenderingHelper;n.renderDepthDetached(()=>{this._passParameters.depthTexture=n.depthTexture;const s=e.rctx.bindTechnique(i,this._passParameters,e.bindParameters);this._renderFog(s,e)})}_renderFog(e,r){const i=r.rctx;i.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),i.drawArrays(Zt.TRIANGLE_STRIP,0,4)}_update(e,r){const i=e.bindParameters.camera;Se(obe,i.eye);const n=Math.max(0,ye(obe,e.bindParameters.lighting.mainLight.direction)),s=r.color;ce(abe,s,.1),mi(this._passParameters.fogColor,abe,s,n);const o=We(i.eye),a=o*o;this._passParameters.atmosphereC=a-this._atmosphereRadius*this._atmosphereRadius,this._passParameters.fogAmount=(1-EN(mOt*by,gOt*by,Math.abs(o-this._planetRadius)))*r.amount,this._passParameters.fogStrength=r.strength}static isSupported(e){return e.capabilities.depthTexture}};d([p({constructOnly:!0})],QS.prototype,"context",void 0),d([p({constructOnly:!0})],QS.prototype,"view",void 0),d([p({constructOnly:!0})],QS.prototype,"rctx",void 0),d([p({constructOnly:!0})],QS.prototype,"viewingMode",void 0),QS=d([I("esri.views.3d.environment.Fog")],QS);let yOt=class{constructor(){this.color=A(),this.strength=0,this.amount=0}};const obe=A(),abe=A();let tl=class extends jl{};d([X({constValue:!0})],tl.prototype,"hasSliceHighlight",void 0),d([X({constValue:!1})],tl.prototype,"hasSliceInVertexProgram",void 0),d([X({constValue:!1})],tl.prototype,"instancedDoublePrecision",void 0),d([X({constValue:!1})],tl.prototype,"hasModelTransformation",void 0),d([X({constValue:Ci.Pass})],tl.prototype,"pbrTextureBindType",void 0);var p0;(function(t){t[t.Cone=0]="Cone",t[t.Cylinder=1]="Cylinder",t[t.Underground=2]="Underground",t[t.COUNT=3]="COUNT"})(p0||(p0={}));let Zde=class extends tl{constructor(){super(...arguments),this.geometry=p0.Cone}};d([X({count:p0.COUNT})],Zde.prototype,"geometry",void 0);var q;(function(t){t[t.Color=0]="Color",t[t.Depth=1]="Depth",t[t.Normal=2]="Normal",t[t.Shadow=3]="Shadow",t[t.ShadowHighlight=4]="ShadowHighlight",t[t.ShadowExcludeHighlight=5]="ShadowExcludeHighlight",t[t.Highlight=6]="Highlight",t[t.Alpha=7]="Alpha",t[t.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor",t[t.COUNT=9]="COUNT"})(q||(q={}));function xF(t){t.attributes.add(O.POSITION,"vec3"),t.vertex.code.add(T`vec3 positionModel() { return position; }`)}function AB({code:t},e){e.doublePrecisionRequiresObfuscation?t.add(T`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):t.add(T`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)}let xf=class extends Zn{constructor(e,r){super(e,"mat3",Ci.Pass,(i,n,s)=>i.setUniformMatrix3fv(e,r(n,s)))}};function OA(t,e){t.include(xF);const r=t.vertex;r.include(AB,e),t.varyings.add("vPositionWorldCameraRelative","vec3"),t.varyings.add("vPosition_view","vec3"),r.uniforms.add(new ar("transformWorldFromViewTH",i=>i.transformWorldFromViewTH),new ar("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new xf("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new yn("transformProjFromView",i=>i.transformProjFromView),new BN("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new _h("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new _h("transformWorldFromModelTL",i=>i.transformWorldFromModelTL)),r.code.add(T`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),r.code.add(T`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${e.spherical?T`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:T`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),t.fragment.uniforms.add(new ar("transformWorldFromViewTL",i=>i.transformWorldFromViewTL)),r.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),t.fragment.code.add(T`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)}let k6e=class extends Ai{constructor(){super(...arguments),this.transformWorldFromViewTH=A(),this.transformWorldFromViewTL=A(),this.transformViewFromCameraRelativeRS=vn(),this.transformProjFromView=Me()}},U6e=class extends Ai{constructor(){super(...arguments),this.transformWorldFromModelRS=vn(),this.transformWorldFromModelTH=A(),this.transformWorldFromModelTL=A()}};function cx(t){t.varyings.add("linearDepth","float")}function hE(t){t.vertex.uniforms.add(new Yr("nearFar",(e,r)=>r.camera.nearFar))}function wH(t){t.vertex.code.add(T`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}function H3(t,e){const{vertex:r}=t;switch(e.output){case q.Color:if(e.receiveShadows)return cx(t),void r.code.add(T`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);break;case q.Depth:case q.Shadow:case q.ShadowHighlight:case q.ShadowExcludeHighlight:return t.include(OA,e),cx(t),hE(t),wH(t),void r.code.add(T`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`)}r.code.add(T`void forwardLinearDepth() {}`)}function nu(t){wH(t),t.vertex.code.add(T`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(T`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)}let Jde=class extends Ai{constructor(){super(...arguments),this.texV=Qe(),this.altitudeFade=0,this.innerScale=0,this.undergroundFadeAlpha=0,this.silhouette=new z6e}},z6e=class{constructor(){this.center=A(),this.v1=A(),this.v2=A()}};function vOt(t){const e=new jr,{vertex:r,fragment:i}=e;if(J_(r),t.geometry===p0.Underground)e.attributes.add(O.POSITION,"vec2"),e.varyings.add("color","vec4"),r.uniforms.add(new ar("cameraPosition",(n,s)=>s.camera.eye),new Ye("undergroundFadeAlpha",n=>n.undergroundFadeAlpha)),r.code.add(T`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),i.code.add(T`void main() {
fragColor = color;
}`);else{e.include(nu,t),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vtc","vec2"),e.varyings.add("falloff","float");const n=t.geometry===p0.Cylinder;r.uniforms.add(new yn("proj",(a,l)=>l.camera.projectionMatrix),new yn("view",(a,l)=>l.camera.viewMatrix)),n||(e.varyings.add("innerFactor","float"),r.uniforms.add(new ar("silCircleCenter",a=>a.silhouette.center)),r.uniforms.add(new ar("silCircleV1",a=>a.silhouette.v1)),r.uniforms.add(new ar("silCircleV2",a=>a.silhouette.v2)),r.uniforms.add(new Yr("texV",a=>a.texV)),r.uniforms.add(new Ye("innerScale",a=>a.innerScale)));const s=6.2831853,o=1/128;r.code.add(T`
		void main(void) {
      ${n?T`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:T`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${T.float(s*o)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${T.float(o)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),i.uniforms.add(new Mt("tex",a=>a.texture)),n||i.uniforms.add(new Ye("altitudeFade",a=>a.altitudeFade)),i.code.add(T`
		void main() {
			vec4 atmosphereColor = texture(tex, vtc) * falloff;
      ${n?T`fragColor = atmosphereColor;`:T`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			fragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`)}return e}const _Ot=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:z6e,SimpleAtmospherePassParameters:Jde,build:vOt},Symbol.toStringTag,{value:"Module"}));let PB=class V6e extends si{initializeProgram(e){return new Kr(e.rctx,V6e.shader.get().build(this.configuration),Br)}initializePipeline(){return this.configuration.geometry===p0.Cylinder?Qt({blending:Fa(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),culling:Ude,depthTest:{func:Oi.LEQUAL},colorWrite:hr}):Qt({blending:Fa(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:Oi.LEQUAL},colorWrite:hr})}};PB.shader=new Jr(_Ot,()=>le(()=>import("./SimpleAtmosphere.glsl-36d0acfe.js"),[]));const bOt=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);function Ad(t,e=0){const r=t.stride;return Array.from(t.fields.keys()).filter(i=>{var s;const n=(s=t.fields.get(i))==null?void 0:s.optional;return!(n&&n.glPadding)}).map(i=>{const n=t.fields.get(i),s=n.constructor.ElementCount,o=wOt(n.constructor.ElementType),a=n.offset,l=!(!n.optional||!n.optional.glNormalized);return new La(i,s,o,a,r,l,e)})}function wOt(t){const e=xOt[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}const xOt={u8:$t.UNSIGNED_BYTE,u16:$t.UNSIGNED_SHORT,u32:$t.UNSIGNED_INT,i8:$t.BYTE,i16:$t.SHORT,i32:$t.INT,f32:$t.FLOAT};let Kde=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=9;const o=this.TypedArrayConstructor;n===void 0&&(n=9*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<9;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<9;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};Kde.ElementCount=9;let Qde=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=16;const o=this.TypedArrayConstructor;n===void 0&&(n=16*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)r[n]=this.typedBuffer[i++];return r}setMat(e,r){let i=e*this.typedBufferStride;for(let n=0;n<16;n++)this.typedBuffer[i++]=r[n]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;for(let l=0;l<16;++l)n[o++]=s[a++]}get buffer(){return this.typedBuffer.buffer}};Qde.ElementCount=16;let e1=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=1;const o=this.TypedArrayConstructor;n===void 0&&(n=o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.stride=n,this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,r){this.typedBuffer[e*this.typedBufferStride]=r}get buffer(){return this.typedBuffer.buffer}};e1.ElementCount=1;let t1=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=2;const o=this.TypedArrayConstructor;n===void 0&&(n=2*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,Or(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e]=r[1]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};t1.ElementCount=2;let r1=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.elementCount=3;const o=this.TypedArrayConstructor;n===void 0&&(n=3*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,se(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e]=r[2]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=n}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};r1.ElementCount=3;let i1=class{constructor(e,r,i=0,n,s){this.TypedArrayConstructor=e,this.start=i,this.elementCount=4;const o=this.TypedArrayConstructor;n===void 0&&(n=4*o.BYTES_PER_ELEMENT);const a=r.byteLength===0?0:i;this.typedBuffer=s==null?new o(r,a):new o(r,a,(s-i)/o.BYTES_PER_ELEMENT),this.typedBufferStride=n/o.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,r,i=this.count-r){const n=this.typedBuffer.byteOffset+r*this.stride;return new e(this.buffer,n,this.stride,n+i*this.stride)}getVec(e,r){return e*=this.typedBufferStride,Ki(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,r){e*=this.typedBufferStride,this.typedBuffer[e++]=r[0],this.typedBuffer[e++]=r[1],this.typedBuffer[e++]=r[2],this.typedBuffer[e]=r[3]}get(e,r){return this.typedBuffer[e*this.typedBufferStride+r]}set(e,r,i){this.typedBuffer[e*this.typedBufferStride+r]=i}setValues(e,r,i,n,s){e*=this.typedBufferStride,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e++]=n,this.typedBuffer[e]=s}copyFrom(e,r,i){const n=this.typedBuffer,s=r.typedBuffer;let o=e*this.typedBufferStride,a=i*r.typedBufferStride;n[o++]=s[a++],n[o++]=s[a++],n[o++]=s[a++],n[o]=s[a]}get buffer(){return this.typedBuffer.buffer}};i1.ElementCount=4;let xH=class B6e extends e1{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}static fromTypedArray(e,r){return new B6e(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};xH.ElementType="f32";let Ox=class kre extends t1{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(kre,e,r)}static fromTypedArray(e,r){return new kre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Ox.ElementType="f32";let xo=class Ure extends r1{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Ure,e,r)}static fromTypedArray(e,r){return new Ure(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};xo.ElementType="f32";let dg=class zre extends i1{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(zre,e,r)}static fromTypedArray(e,r){return new zre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};dg.ElementType="f32";let ux=class Vre extends Kde{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(Vre,e,r)}static fromTypedArray(e,r){return new Vre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ux.ElementType="f32";let ehe=class Bre extends Kde{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Bre,e,r)}static fromTypedArray(e,r){return new Bre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ehe.ElementType="f64";let the=class jre extends Qde{constructor(e,r=0,i,n){super(Float32Array,e,r,i,n),this.elementType="f32"}slice(e,r){return this.sliceBuffer(jre,e,r)}static fromTypedArray(e,r){return new jre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};the.ElementType="f32";let jN=class Gre extends Qde{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Gre,e,r)}static fromTypedArray(e,r){return new Gre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};jN.ElementType="f64";let rhe=class Hre extends e1{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Hre,e,r)}static fromTypedArray(e,r){return new Hre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};rhe.ElementType="f64";let ihe=class qre extends t1{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(qre,e,r)}static fromTypedArray(e,r){return new qre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ihe.ElementType="f64";let ff=class Wre extends r1{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Wre,e,r)}static fromTypedArray(e,r){return new Wre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ff.ElementType="f64";let SH=class Xre extends i1{constructor(e,r=0,i,n){super(Float64Array,e,r,i,n),this.elementType="f64"}slice(e,r){return this.sliceBuffer(Xre,e,r)}static fromTypedArray(e,r){return new Xre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};SH.ElementType="f64";let HP=class Yre extends e1{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Yre,e,r)}static fromTypedArray(e,r){return new Yre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};HP.ElementType="u8";let TH=class Zre extends t1{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Zre,e,r)}static fromTypedArray(e,r){return new Zre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};TH.ElementType="u8";let EH=class Jre extends r1{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Jre,e,r)}static fromTypedArray(e,r){return new Jre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};EH.ElementType="u8";let zl=class Kre extends i1{constructor(e,r=0,i,n){super(Uint8Array,e,r,i,n),this.elementType="u8"}slice(e,r){return this.sliceBuffer(Kre,e,r)}static fromTypedArray(e,r){return new Kre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};zl.ElementType="u8";let CH=class Qre extends e1{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(Qre,e,r)}static fromTypedArray(e,r){return new Qre(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};CH.ElementType="u16";let nhe=class eie extends t1{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(eie,e,r)}static fromTypedArray(e,r){return new eie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};nhe.ElementType="u16";let RH=class tie extends r1{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(tie,e,r)}static fromTypedArray(e,r){return new tie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};RH.ElementType="u16";let SF=class rie extends i1{constructor(e,r=0,i,n){super(Uint16Array,e,r,i,n),this.elementType="u16"}slice(e,r){return this.sliceBuffer(rie,e,r)}static fromTypedArray(e,r){return new rie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};SF.ElementType="u16";let OH=class iie extends e1{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(iie,e,r)}static fromTypedArray(e,r){return new iie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};OH.ElementType="u32";let she=class nie extends t1{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(nie,e,r)}static fromTypedArray(e,r){return new nie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};she.ElementType="u32";let j6e=class sie extends r1{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(sie,e,r)}static fromTypedArray(e,r){return new sie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};j6e.ElementType="u32";let G6e=class oie extends i1{constructor(e,r=0,i,n){super(Uint32Array,e,r,i,n),this.elementType="u32"}slice(e,r){return this.sliceBuffer(oie,e,r)}static fromTypedArray(e,r){return new oie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};G6e.ElementType="u32";let ohe=class aie extends e1{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(aie,e,r)}static fromTypedArray(e,r){return new aie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};ohe.ElementType="i8";let AH=class lie extends t1{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(lie,e,r)}static fromTypedArray(e,r){return new lie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};AH.ElementType="i8";let H6e=class cie extends r1{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(cie,e,r)}static fromTypedArray(e,r){return new cie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};H6e.ElementType="i8";let q6e=class uie extends i1{constructor(e,r=0,i,n){super(Int8Array,e,r,i,n),this.elementType="i8"}slice(e,r){return this.sliceBuffer(uie,e,r)}static fromTypedArray(e,r){return new uie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};q6e.ElementType="i8";let W6e=class die extends e1{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(die,e,r)}static fromTypedArray(e,r){return new die(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};W6e.ElementType="i16";let TF=class hie extends t1{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(hie,e,r)}static fromTypedArray(e,r){return new hie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};TF.ElementType="i16";let X6e=class pie extends r1{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(pie,e,r)}static fromTypedArray(e,r){return new pie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};X6e.ElementType="i16";let Y6e=class fie extends i1{constructor(e,r=0,i,n){super(Int16Array,e,r,i,n),this.elementType="i16"}slice(e,r){return this.sliceBuffer(fie,e,r)}static fromTypedArray(e,r){return new fie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Y6e.ElementType="i16";let Z6e=class mie extends e1{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(mie,e,r)}static fromTypedArray(e,r){return new mie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Z6e.ElementType="i32";let J6e=class gie extends t1{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(gie,e,r)}static fromTypedArray(e,r){return new gie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};J6e.ElementType="i32";let K6e=class yie extends r1{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(yie,e,r)}static fromTypedArray(e,r){return new yie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};K6e.ElementType="i32";let Q6e=class vie extends i1{constructor(e,r=0,i,n){super(Int32Array,e,r,i,n),this.elementType="i32"}slice(e,r){return this.sliceBuffer(vie,e,r)}static fromTypedArray(e,r){return new vie(e.buffer,e.byteOffset,r,e.byteOffset+e.byteLength)}};Q6e.ElementType="i32";function lbe(t){switch(t){case"u8":case"i8":return 1;case"u16":case"i16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}}let cbe=class eUe{constructor(e,r){this.layout=e,this.buffer=typeof r=="number"?new ArrayBuffer(r*e.stride):r;for(const i of e.fields.keys()){const n=e.fields.get(i);this[i]=new n.constructor(this.buffer,n.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,r){const i=this[e];return i&&i.elementCount===r.ElementCount&&i.elementType===r.ElementType?i:null}slice(e,r){return new eUe(this.layout,this.buffer.slice(e*this.stride,r*this.stride))}copyFrom(e,r=0,i=0,n=e.count){const s=this.stride;if(s%4==0){const o=new Uint32Array(e.buffer,r*s,n*s/4);new Uint32Array(this.buffer,i*s,n*s/4).set(o)}else{const o=new Uint8Array(e.buffer,r*s,n*s);new Uint8Array(this.buffer,i*s,n*s).set(o)}return this}},tUe=class rUe{constructor(e=null){this._stride=0,this._lastAligned=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(r=>this._fields.set(r[0],{...r[1],constructor:EOt(r[1].constructor)})))}vec2f(e,r){return this._appendField(e,Ox,r),this}vec2f64(e,r){return this._appendField(e,ihe,r),this}vec3f(e,r){return this._appendField(e,xo,r),this}vec3f64(e,r){return this._appendField(e,ff,r),this}vec4f(e,r){return this._appendField(e,dg,r),this}vec4f64(e,r){return this._appendField(e,SH,r),this}mat3f(e,r){return this._appendField(e,ux,r),this}mat3f64(e,r){return this._appendField(e,ehe,r),this}mat4f(e,r){return this._appendField(e,the,r),this}mat4f64(e,r){return this._appendField(e,jN,r),this}vec4u8(e,r){return this._appendField(e,zl,r),this}f32(e,r){return this._appendField(e,xH,r),this}f64(e,r){return this._appendField(e,rhe,r),this}u8(e,r){return this._appendField(e,HP,r),this}u16(e,r){return this._appendField(e,CH,r),this}i8(e,r){return this._appendField(e,ohe,r),this}vec2i8(e,r){return this._appendField(e,AH,r),this}vec2i16(e,r){return this._appendField(e,TF,r),this}vec2u8(e,r){return this._appendField(e,TH,r),this}vec4u16(e,r){return this._appendField(e,SF,r),this}u32(e,r){return this._appendField(e,OH,r),this}_appendField(e,r,i){if(this._fields.has(e))return void It(!1,`${e} already added to vertex buffer layout`);const n=r.ElementCount*lbe(r.ElementType),s=this._stride;this._stride+=n,this._fields.set(e,{size:n,constructor:r,offset:s,optional:i})}createBuffer(e){return new cbe(this,e)}createView(e){return new cbe(this,e)}clone(){const e=new rUe;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((r,i)=>e._fields.set(i,r)),e.BufferType=this.BufferType,e}get stride(){if(this._lastAligned!==this._fields.size){let e=1;this._fields.forEach(r=>e=Math.max(e,lbe(r.constructor.ElementType))),this._stride=Math.floor((this._stride+e-1)/e)*e,this._lastAligned=this._fields.size}return this._stride}get fields(){return this._fields}};function On(){return new tUe}let SOt=class{constructor(e){this.fields=new Array,e.fields.forEach((r,i)=>{const n={...r,constructor:iUe(r.constructor)};this.fields.push([i,n])}),this.stride=e.stride}};const TOt=[xH,Ox,xo,dg,ux,the,rhe,ihe,ff,SH,ehe,jN,HP,TH,EH,zl,CH,nhe,RH,SF,OH,she,j6e,G6e,ohe,AH,H6e,q6e,W6e,TF,X6e,Y6e,Z6e,J6e,K6e,Q6e];function iUe(t){return`${t.ElementType}_${t.ElementCount}`}function EOt(t){return nUe.get(t)}const nUe=new Map;TOt.forEach(t=>nUe.set(iUe(t),t));function sl(t,e=!1){return t<=Eh?e?new Array(t).fill(0):new Array(t):new Float64Array(t)}function sUe(t){return(ig(t)?t.length:t.byteLength/8)<=Eh?Array.from(t):new Float64Array(t)}function Xp(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function Ryr(t,e){for(let r=0;r<e.length;++r)t[r]=e[r];return t}function Oyr(t){return Array.isArray(t)?new Float64Array(t):t}function Dn(t,e=!1){return t<=Eh?e?new Array(t).fill(0):new Array(t):new Float32Array(t)}function Ayr(t){return ig(t)?t.length<Eh?t:new Float32Array(t):t.length<Eh?Array.from(t):t}function ube(t){return(ig(t)?t.length:t.byteLength/8)<=Eh?Array.from(t):new Float32Array(t)}function MB(t,e,r){return Array.isArray(t)?t.slice(e,e+r):t.subarray(e,e+r)}function Ky(t){return ig(t)?t.length<Eh?t:dbe(t):t.length<Eh?Array.from(t):t.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?t:dbe(t)}function dbe(t){let e=!0;for(const r of t){if(r>=65536)return ig(t)?new Uint32Array(t):t;r>=256&&(e=!1)}return e?new Uint8Array(t):new Uint16Array(t)}function $B(t){return t<=Eh?new Array(t):t<=65536?new Uint16Array(t):new Uint32Array(t)}function COt(t){return t<=Eh?new Array(t):new Uint32Array(t)}let vC=(()=>{const t=new Uint32Array(131072);for(let e=0;e<t.length;++e)t[e]=e;return t})();const oUe=[0],XX=(()=>{const t=new Uint16Array(65536);for(let e=0;e<t.length;++e)t[e]=e;return t})();function qP(t){if(t===1)return oUe;if(t<Eh)return Array.from(new Uint16Array(XX.buffer,0,t));if(t<XX.length)return new Uint16Array(XX.buffer,0,t);if(t>vC.length){const e=Math.max(2*vC.length,t);vC=new Uint32Array(e);for(let r=0;r<vC.length;r++)vC[r]=r}return new Uint32Array(vC.buffer,0,t)}let Pk=new Uint8Array(65536);function q3(t){if(t===1)return oUe;if(t<Eh)return new Array(t).fill(0);if(t>Pk.length){const e=Math.max(2*Pk.length,t);Pk=new Uint8Array(e)}return new Uint8Array(Pk.buffer,0,t)}let ft=class{constructor(e,r,i=!1,n=r){this.data=e,this.size=r,this.exclusive=i,this.stride=n}};var _ie;(function(t){function e(o,a){const l=o[a],c=o[a+1],u=o[a+2];return Math.sqrt(l*l+c*c+u*u)}function r(o,a){const l=o[a],c=o[a+1],u=o[a+2],h=1/Math.sqrt(l*l+c*c+u*u);o[a]*=h,o[a+1]*=h,o[a+2]*=h}function i(o,a,l){o[a]*=l,o[a+1]*=l,o[a+2]*=l}function n(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]+l[c],u[h+1]=o[a+1]+l[c+1],u[h+2]=o[a+2]+l[c+2]}function s(o,a,l,c,u,h=a){(u=u||o)[h]=o[a]-l[c],u[h+1]=o[a+1]-l[c+1],u[h+2]=o[a+2]-l[c+2]}t.length=e,t.normalize=r,t.scale=i,t.add=n,t.subtract=s})(_ie||(_ie={}));var Wn;(function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"})(Wn||(Wn={}));function ROt(t){if(t.length<Eh)return Array.from(t);if(ig(t))return Float64Array.from(t);if(!("BYTES_PER_ELEMENT"in t))return Array.from(t);switch(t.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(t);case 2:return l7(t)?Uint16Array.from(t):Int16Array.from(t);case 4:return Float32Array.from(t);default:return Float64Array.from(t)}}let aUe=class lUe{constructor(e,r,i,n){this.primitiveIndices=e,this._numIndexPerPrimitive=r,this.indices=i,this.position=n,this._children=void 0,It(e.length>=1),It(i.length%this._numIndexPerPrimitive==0),It(i.length>=e.length*this._numIndexPerPrimitive),It(n.size===3||n.size===4);const{data:s,size:o}=n,a=e.length;let l=o*i[this._numIndexPerPrimitive*e[0]];Hx.clear(),Hx.push(l);const c=Ue(s[l],s[l+1],s[l+2]),u=qi(c);for(let m=0;m<a;++m){const g=this._numIndexPerPrimitive*e[m];for(let y=0;y<this._numIndexPerPrimitive;++y){l=o*i[g+y],Hx.push(l);let _=s[l];c[0]=Math.min(_,c[0]),u[0]=Math.max(_,u[0]),_=s[l+1],c[1]=Math.min(_,c[1]),u[1]=Math.max(_,u[1]),_=s[l+2],c[2]=Math.min(_,c[2]),u[2]=Math.max(_,u[2])}}this.bbMin=c,this.bbMax=u;const h=mi(A(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(u[0]-c[0],u[1]-c[1]),u[2]-c[2]);let f=this.radius*this.radius;for(let m=0;m<Hx.length;++m){l=Hx.at(m);const g=s[l]-h[0],y=s[l+1]-h[1],_=s[l+2]-h[2],b=g*g+y*y+_*_;if(b<=f)continue;const w=Math.sqrt(b),x=.5*(w-this.radius);this.radius=this.radius+x,f=this.radius*this.radius;const S=x/w;h[0]+=g*S,h[1]+=y*S,h[2]+=_*S}this.center=h,Hx.clear()}getChildren(){if(this._children||ks(this.bbMin,this.bbMax)<=1)return this._children;const e=mi(A(),this.bbMin,this.bbMax,.5),r=this.primitiveIndices.length,i=new Uint8Array(r),n=new Array(8);for(let c=0;c<8;++c)n[c]=0;const{data:s,size:o}=this.position;for(let c=0;c<r;++c){let u=0;const h=this._numIndexPerPrimitive*this.primitiveIndices[c];let f=o*this.indices[h],m=s[f],g=s[f+1],y=s[f+2];for(let _=1;_<this._numIndexPerPrimitive;++_){f=o*this.indices[h+_];const b=s[f],w=s[f+1],x=s[f+2];b<m&&(m=b),w<g&&(g=w),x<y&&(y=x)}m<e[0]&&(u|=1),g<e[1]&&(u|=2),y<e[2]&&(u|=4),i[c]=u,++n[u]}let a=0;for(let c=0;c<8;++c)n[c]>0&&++a;if(a<2)return;const l=new Array(8);for(let c=0;c<8;++c)l[c]=n[c]>0?new Uint32Array(n[c]):void 0;for(let c=0;c<8;++c)n[c]=0;for(let c=0;c<r;++c){const u=i[c];l[u][n[u]++]=this.primitiveIndices[c]}this._children=new Array;for(let c=0;c<8;++c)l[c]!==void 0&&this._children.push(new lUe(l[c],this._numIndexPerPrimitive,this.indices,this.position));return this._children}static prune(){Hx.prune()}};const Hx=new dr({deallocator:null});let EF=class{constructor(){this.id=au()}unload(){}};function OOt(t){return t?{p0:qi(t.p0),p1:qi(t.p1),p2:qi(t.p2)}:{p0:A(),p1:A(),p2:A()}}function hbe(t,e,r){const i=e[0]-t[0],n=e[1]-t[1],s=r[0]-t[0],o=r[1]-t[1];return .5*Math.abs(i*o-n*s)}function AOt(t,e,r){return ve(YX,e,t),ve(pbe,r,t),We(Lt(YX,YX,pbe))/2}new Y_(fg);new Y_(()=>OOt());const YX=A(),pbe=A();function POt(t,e,r){if(!t||!e)return!1;const{size:i,data:n}=t;se(r,0,0,0),se(bp,0,0,0);let s=0,o=0;for(let a=0;a<e.length-2;a+=3){const l=e[a]*i,c=e[a+1]*i,u=e[a+2]*i;se(ra,n[l],n[l+1],n[l+2]),se(Vv,n[c],n[c+1],n[c+2]),se(Mk,n[u],n[u+1],n[u+2]);const h=AOt(ra,Vv,Mk);h?(ge(ra,ra,Vv),ge(ra,ra,Mk),ce(ra,ra,1/3*h),ge(r,r,ra),s+=h):(ge(bp,bp,ra),ge(bp,bp,Vv),ge(bp,bp,Mk),o+=3)}return(o!==0||s!==0)&&(s!==0?(ce(r,r,1/s),!0):o!==0&&(ce(r,bp,1/o),!0))}function MOt(t,e,r){if(!t||!e)return!1;const{size:i,data:n}=t;se(r,0,0,0);let s=-1,o=0;for(let a=0;a<e.length;a++){const l=e[a]*i;s!==l&&(r[0]+=n[l],r[1]+=n[l+1],r[2]+=n[l+2],o++),s=l}return o>1&&ce(r,r,1/o),o>0}function $Ot(t,e,r,i){if(!t)return!1;se(i,0,0,0),se(bp,0,0,0);let n=0,s=0;const{size:o,data:a}=t,l=e?e.length-1:a.length/o-1,c=l+(r?2:0);for(let u=0;u<c;u+=2){const h=u<l?u:l,f=u<l?u+1:0,m=(e?e[h]:h)*o,g=(e?e[f]:f)*o;ra[0]=a[m],ra[1]=a[m+1],ra[2]=a[m+2],Vv[0]=a[g],Vv[1]=a[g+1],Vv[2]=a[g+2],ce(ra,ge(ra,ra,Vv),.5);const y=W4(ra,Vv);y>0?(ge(i,i,ce(ra,ra,y)),n+=y):n===0&&(ge(bp,bp,ra),s++)}return n!==0?(ce(i,i,1/n),!0):s!==0&&(ce(i,bp,1/s),!0)}const ra=A(),Vv=A(),Mk=A(),bp=A();let IB=class{constructor(e){this.channel=e,this.id=au()}};function bie(t,e,r){for(let i=0;i<r;++i)e[2*i]=t[i],e[2*i+1]=t[i]-e[2*i]}function IOt(t,e){const r=t.length;for(let i=0;i<r;++i)JO[0]=t[i],e[i]=JO[0];return e}function LOt(t,e){const r=t.length;for(let i=0;i<r;++i)JO[0]=t[i],JO[1]=t[i]-JO[0],e[i]=JO[1];return e}const JO=new Float32Array(2);function wie(t,e){return t==null&&(t=[]),t.push(e),t}function xie(t,e){if(t==null)return null;const r=t.filter(i=>i!==e);return r.length===0?null:r}function DOt(t,e,r,i,n){$k[0]=t.get(e,0),$k[1]=t.get(e,1),$k[2]=t.get(e,2),bie($k,qx,3),r.set(n,0,qx[0]),i.set(n,0,qx[1]),r.set(n,1,qx[2]),i.set(n,1,qx[3]),r.set(n,2,qx[4]),i.set(n,2,qx[5])}const $k=A(),qx=new Float32Array(6);let Us=class cUe extends EF{constructor(e,r,i=[],n=null,s=Wn.Mesh,o=null,a=-1){super(),this.material=e,this.mapPositions=n,this.type=s,this.objectAndLayerIdColor=o,this.edgeIndicesLength=a,this.visible=!0,this._vertexAttributes=new Map,this._indices=new Map,this._boundingInfo=null;for(const[l,c]of r)c&&this._vertexAttributes.set(l,{...c});if(i==null||i.length===0){const l=NOt(this._vertexAttributes),c=qP(l);this.edgeIndicesLength=this.edgeIndicesLength<0?l:this.edgeIndicesLength;for(const u of this._vertexAttributes.keys())this._indices.set(u,c)}else for(const[l,c]of i)c&&(this._indices.set(l,Ky(c)),l===O.POSITION&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._indices.get(l).length:this.edgeIndicesLength))}instantiate(e={}){const r=new cUe(e.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);return this._vertexAttributes.forEach((i,n)=>{i.exclusive=!1,r._vertexAttributes.set(n,i)}),this._indices.forEach((i,n)=>r._indices.set(n,i)),r._boundingInfo=this._boundingInfo,r.transformation=e.transformation||this.transformation,r}get vertexAttributes(){return this._vertexAttributes}getMutableAttribute(e){let r=this._vertexAttributes.get(e);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:ROt(r.data)},this._vertexAttributes.set(e,r)),r}setAttributeData(e,r){const i=this._vertexAttributes.get(e);i&&this._vertexAttributes.set(e,{...i,exclusive:!0,data:r})}get indices(){return this._indices}get indexCount(){const e=this._indices.values().next().value;return e?e.length:0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo==null&&(this._boundingInfo=this._calculateBoundingInfo()),this._boundingInfo}computeAttachmentOrigin(e){return!!(this.type===Wn.Mesh?this._computeAttachmentOriginTriangles(e):this.type===Wn.Line?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(this._transformation!=null&&lt(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const r=this.indices.get(O.POSITION),i=this.vertexAttributes.get(O.POSITION);return POt(i,r,e)}_computeAttachmentOriginLines(e){const r=this.vertexAttributes.get(O.POSITION),i=this.indices.get(O.POSITION);return $Ot(r,i,i&&FOt(this.material.parameters,r,i),e)}_computeAttachmentOriginPoints(e){const r=this.indices.get(O.POSITION),i=this.vertexAttributes.get(O.POSITION);return MOt(i,r,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.indices.get(O.POSITION),r=this.vertexAttributes.get(O.POSITION);if(!e||e.length===0||!r)return null;const i=this.type===Wn.Mesh?3:1;It(e.length%i==0,"Indexing error: "+e.length+" not divisible by "+i);const n=qP(e.length/i);return new aUe(n,i,e,r)}get transformation(){return this._transformation??bo}set transformation(e){this._transformation=e&&e!==bo?IP(e):null}get shaderTransformation(){return this._shaderTransformer!=null?this._shaderTransformer(this.transformation):this.transformation}get shaderTransformer(){return this._shaderTransformer}set shaderTransformer(e){this._shaderTransformer=e}get hasVolatileTransformation(){return this._shaderTransformer!=null}addHighlight(){const e=new IB(k_.Highlight);return this.highlights=wie(this.highlights,e),e}removeHighlight(e){this.highlights=xie(this.highlights,e)}};function NOt(t){const e=t.values().next().value;return e==null?0:e.data.length/e.size}function FOt(t,e,r){return!(!("isClosed"in t)||!t.isClosed)&&(r?r.length>2:e.data.length>6)}const _C=_ie,ZX=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],kOt=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],UOt=[0,0,1,0,1,1,0,1],zOt=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],uUe=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)uUe[6*t+e]=t;const eT=new Array(36);for(let t=0;t<6;t++)eT[6*t]=0,eT[6*t+1]=1,eT[6*t+2]=2,eT[6*t+3]=2,eT[6*t+4]=3,eT[6*t+5]=0;function VOt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let i=0;i<8;i++)r[3*i]=ZX[i][0]*e[0],r[3*i+1]=ZX[i][1]*e[1],r[3*i+2]=ZX[i][2]*e[2];return new Us(t,[[O.POSITION,new ft(r,3,!0)],[O.NORMAL,new ft(kOt,3)],[O.UV0,new ft(UOt,2)]],[[O.POSITION,zOt],[O.NORMAL,uUe],[O.UV0,eT]])}const JX=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],BOt=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],jOt=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],GOt=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];function HOt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let i=0;i<6;i++)r[3*i]=JX[i][0]*e[0],r[3*i+1]=JX[i][1]*e[1],r[3*i+2]=JX[i][2]*e[2];return new Us(t,[[O.POSITION,new ft(r,3,!0)],[O.NORMAL,new ft(BOt,3)]],[[O.POSITION,jOt],[O.NORMAL,GOt]])}const _z=xi(-.5,0,-.5),bz=xi(.5,0,-.5),wz=xi(0,0,.5),xz=xi(0,.5,0),bC=$n(),wC=$n(),AA=$n(),PA=$n(),MA=$n();ve(bC,_z,xz),ve(wC,_z,bz),Lt(AA,bC,wC),Se(AA,AA),ve(bC,bz,xz),ve(wC,bz,wz),Lt(PA,bC,wC),Se(PA,PA),ve(bC,wz,xz),ve(wC,wz,_z),Lt(MA,bC,wC),Se(MA,MA);const KX=[_z,bz,wz,xz],qOt=[0,-1,0,AA[0],AA[1],AA[2],PA[0],PA[1],PA[2],MA[0],MA[1],MA[2]],WOt=[0,1,2,3,1,0,3,2,1,3,0,2],XOt=[0,0,0,1,1,1,2,2,2,3,3,3];function YOt(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let i=0;i<4;i++)r[3*i]=KX[i][0]*e[0],r[3*i+1]=KX[i][1]*e[1],r[3*i+2]=KX[i][2]*e[2];return new Us(t,[[O.POSITION,new ft(r,3,!0)],[O.NORMAL,new ft(qOt,3)]],[[O.POSITION,WOt],[O.NORMAL,XOt]])}function Iyr(t,e,r,i,n={uv:!0}){const s=-Math.PI,o=2*Math.PI,a=-Math.PI/2,l=Math.PI,c=Math.max(3,Math.floor(r)),u=Math.max(2,Math.floor(i)),h=(c+1)*(u+1),f=Dn(3*h),m=Dn(3*h),g=Dn(2*h),y=[];let _=0;for(let S=0;S<=u;S++){const C=[],E=S/u,R=a+E*l,P=Math.cos(R);for(let D=0;D<=c;D++){const L=D/c,k=s+L*o,V=Math.cos(k)*P,W=Math.sin(R),G=-Math.sin(k)*P;f[3*_]=V*e,f[3*_+1]=W*e,f[3*_+2]=G*e,m[3*_]=V,m[3*_+1]=W,m[3*_+2]=G,g[2*_]=L,g[2*_+1]=E,C.push(_),++_}y.push(C)}const b=new Array;for(let S=0;S<u;S++)for(let C=0;C<c;C++){const E=y[S][C],R=y[S][C+1],P=y[S+1][C+1],D=y[S+1][C];S===0?(b.push(E),b.push(P),b.push(D)):S===u-1?(b.push(E),b.push(R),b.push(P)):(b.push(E),b.push(R),b.push(P),b.push(P),b.push(D),b.push(E))}const w=[[O.POSITION,b],[O.NORMAL,b]],x=[[O.POSITION,new ft(f,3,!0)],[O.NORMAL,new ft(m,3,!0)]];return n.uv&&(x.push([O.UV0,new ft(g,2,!0)]),w.push([O.UV0,b])),n.offset&&(w[0][0]=O.OFFSET,x[0][0]=O.OFFSET,w.push([O.POSITION,q3(b.length)]),x.push([O.POSITION,new ft(Float64Array.from(n.offset),3,!0)])),new Us(t,x,w)}function ZOt(t,e,r,i){const{vertexAttributes:n,indices:s}=dUe(e,r,i);return new Us(t,n,s)}function dUe(t,e,r){const i=t;let n,s;if(r)n=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],s=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const u=i*(1+Math.sqrt(5))/2;n=[-i,u,0,i,u,0,-i,-u,0,i,-u,0,0,-i,u,0,i,u,0,-i,-u,0,i,-u,u,0,-i,u,0,i,-u,0,-i,-u,0,i],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let u=0;u<n.length;u+=3)_C.scale(n,u,t/_C.length(n,u));let o={};function a(u,h){u>h&&([u,h]=[h,u]);const f=u.toString()+"."+h.toString();if(o[f])return o[f];let m=n.length;return n.length+=3,_C.add(n,3*u,n,3*h,n,m),_C.scale(n,m,t/_C.length(n,m)),m/=3,o[f]=m,m}for(let u=0;u<e;u++){const h=s.length,f=new Array(4*h);for(let m=0;m<h;m+=3){const g=s[m],y=s[m+1],_=s[m+2],b=a(g,y),w=a(y,_),x=a(_,g),S=4*m;f[S]=g,f[S+1]=b,f[S+2]=x,f[S+3]=y,f[S+4]=w,f[S+5]=b,f[S+6]=_,f[S+7]=x,f[S+8]=w,f[S+9]=b,f[S+10]=w,f[S+11]=x}s=f,o={}}const l=ube(n);for(let u=0;u<l.length;u+=3)_C.normalize(l,u);const c=[[O.POSITION,s],[O.NORMAL,s]];return{vertexAttributes:[[O.POSITION,new ft(ube(n),3,!0)],[O.NORMAL,new ft(l,3,!0)]],indices:c}}function Sie(t,e,r,i,n,s,o,a,l=null){const c=r?[r[0],r[1],r[2]]:[0,0,0],u=e?[e[0],e[1],e[2]]:[0,0,1];o=o||[0,0];const h=i?[255*i[0],255*i[1],255*i[2],i.length>3?255*i[3]:255]:[255,255,255,255],f=n!=null&&n.length===2?n:[1,1],m=[[O.POSITION,new ft(c,3,!0)],[O.NORMAL,new ft(u,3,!0)],[O.UV0,new ft(o,o.length)],[O.COLOR,new ft(h,4,!0)],[O.SIZE,new ft(f,2)]];if(s!=null){const g=[s[0],s[1],s[2],s[3]];m.push([O.AUXPOS1,new ft(g,4)])}if(a!=null){const g=[a[0],a[1],a[2],a[3]];m.push([O.AUXPOS2,new ft(g,4)])}return new Us(t,m,null,null,Wn.Point,l)}const JOt=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function Lyr(t,e=JOt){const r=new Array(12);for(let u=0;u<4;u++)for(let h=0;h<3;h++)r[3*u+h]=e[u][h];const i=[0,1,2,2,3,0],n=[0,0,1],s=[0,0,0,0,0,0],o=[0,0,1,0,1,1,0,1],a=[255,255,255,255],l=[[O.POSITION,i],[O.NORMAL,s],[O.UV0,i],[O.COLOR,s]],c=[[O.POSITION,new ft(r,3,!0)],[O.NORMAL,new ft(n,3,!0)],[O.UV0,new ft(o,2,!0)],[O.COLOR,new ft(a,4,!0)]];return new Us(t,c,l)}function fbe(t,e,r,i,n,s=!0,o=!0){let a=0;const l=r,c=e;let u=xi(0,a,0),h=xi(0,a+c,0),f=xi(0,-1,0),m=xi(0,1,0);n&&(a=c,h=xi(0,0,0),u=xi(0,a,0),f=xi(0,1,0),m=xi(0,-1,0));const g=[h,u],y=[f,m],_=i+2,b=Math.sqrt(c*c+l*l);if(n)for(let P=i-1;P>=0;P--){const D=P*(2*Math.PI/i),L=xi(Math.cos(D)*l,a,Math.sin(D)*l);g.push(L);const k=xi(c*Math.cos(D)/b,-l/b,c*Math.sin(D)/b);y.push(k)}else for(let P=0;P<i;P++){const D=P*(2*Math.PI/i),L=xi(Math.cos(D)*l,a,Math.sin(D)*l);g.push(L);const k=xi(c*Math.cos(D)/b,l/b,c*Math.sin(D)/b);y.push(k)}const w=new Array,x=new Array;if(s){for(let P=3;P<g.length;P++)w.push(1),w.push(P-1),w.push(P),x.push(0),x.push(0),x.push(0);w.push(g.length-1),w.push(2),w.push(1),x.push(0),x.push(0),x.push(0)}if(o){for(let P=3;P<g.length;P++)w.push(P),w.push(P-1),w.push(0),x.push(P),x.push(P-1),x.push(1);w.push(0),w.push(2),w.push(g.length-1),x.push(1),x.push(2),x.push(y.length-1)}const S=Dn(3*_);for(let P=0;P<_;P++)S[3*P]=g[P][0],S[3*P+1]=g[P][1],S[3*P+2]=g[P][2];const C=Dn(3*_);for(let P=0;P<_;P++)C[3*P]=y[P][0],C[3*P+1]=y[P][1],C[3*P+2]=y[P][2];const E=[[O.POSITION,w],[O.NORMAL,x]],R=[[O.POSITION,new ft(S,3,!0)],[O.NORMAL,new ft(C,3,!0)]];return new Us(t,R,E)}function KOt(t,e,r,i,n,s,o){const a=n?hB(n):xi(1,0,0),l=s?hB(s):xi(0,0,0);o??(o=!0);const c=$n();Se(c,a);const u=$n();ce(u,c,Math.abs(e));const h=$n();ce(h,u,-.5),ge(h,h,l);const f=xi(0,1,0);Math.abs(1-ye(c,f))<.2&&se(f,0,0,1);const m=$n();Lt(m,c,f),Se(m,m),Lt(f,m,c);const g=2*i+(o?2:0),y=i+(o?2:0),_=Dn(3*g),b=Dn(3*y),w=Dn(2*g),x=new Array(3*i*(o?4:2)),S=new Array(3*i*(o?4:2));o&&(_[3*(g-2)]=h[0],_[3*(g-2)+1]=h[1],_[3*(g-2)+2]=h[2],w[2*(g-2)]=0,w[2*(g-2)+1]=0,_[3*(g-1)]=_[3*(g-2)]+u[0],_[3*(g-1)+1]=_[3*(g-2)+1]+u[1],_[3*(g-1)+2]=_[3*(g-2)+2]+u[2],w[2*(g-1)]=1,w[2*(g-1)+1]=1,b[3*(y-2)]=-c[0],b[3*(y-2)+1]=-c[1],b[3*(y-2)+2]=-c[2],b[3*(y-1)]=c[0],b[3*(y-1)+1]=c[1],b[3*(y-1)+2]=c[2]);const C=(k,V,W)=>{x[k]=V,S[k]=W};let E=0;const R=$n(),P=$n();for(let k=0;k<i;k++){const V=k*(2*Math.PI/i);ce(R,f,Math.sin(V)),ce(P,m,Math.cos(V)),ge(R,R,P),b[3*k]=R[0],b[3*k+1]=R[1],b[3*k+2]=R[2],ce(R,R,r),ge(R,R,h),_[3*k]=R[0],_[3*k+1]=R[1],_[3*k+2]=R[2],w[2*k]=k/i,w[2*k+1]=0,_[3*(k+i)]=_[3*k]+u[0],_[3*(k+i)+1]=_[3*k+1]+u[1],_[3*(k+i)+2]=_[3*k+2]+u[2],w[2*(k+i)]=k/i,w[2*k+1]=1;const W=(k+1)%i;C(E++,k,k),C(E++,k+i,k),C(E++,W,W),C(E++,W,W),C(E++,k+i,k),C(E++,W+i,W)}if(o){for(let k=0;k<i;k++){const V=(k+1)%i;C(E++,g-2,y-2),C(E++,k,y-2),C(E++,V,y-2)}for(let k=0;k<i;k++){const V=(k+1)%i;C(E++,k+i,y-1),C(E++,g-1,y-1),C(E++,V+i,y-1)}}const D=[[O.POSITION,x],[O.NORMAL,S],[O.UV0,x]],L=[[O.POSITION,new ft(_,3,!0)],[O.NORMAL,new ft(b,3,!0)],[O.UV0,new ft(w,2,!0)]];return new Us(t,L,D)}function Dyr(t,e,r,i,n,s){i=i||10,n=n==null||n,It(e.length>1);const o=[[0,0,0]],a=[],l=[];for(let c=0;c<i;c++){a.push([0,-c-1,-(c+1)%i-1]);const u=c/i*2*Math.PI;l.push([Math.cos(u)*r,Math.sin(u)*r])}return QOt(t,l,e,o,a,n,s)}function QOt(t,e,r,i,n,s,o=xi(0,0,0)){const a=e.length,l=Dn(r.length*a*3+(6*i.length||0)),c=Dn(r.length*a*3+(i?6:0)),u=new Array,h=new Array;let f=0,m=0;const g=$n(),y=$n(),_=$n(),b=$n(),w=$n(),x=$n(),S=$n(),C=A(),E=$n(),R=$n(),P=$n(),D=$n(),L=$n(),k=oi();se(E,0,1,0),ve(y,r[1],r[0]),Se(y,y),s?(ge(C,r[0],o),Se(_,C)):se(_,0,0,1),LB(y,_,E,E,w,_,mbe),oe(b,_),oe(D,w);for(let N=0;N<i.length;N++)ce(x,w,i[N][0]),ce(C,_,i[N][2]),ge(x,x,C),ge(x,x,r[0]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];c[m++]=-y[0],c[m++]=-y[1],c[m++]=-y[2];for(let N=0;N<n.length;N++)u.push(n[N][0]>0?n[N][0]:-n[N][0]-1+i.length),u.push(n[N][1]>0?n[N][1]:-n[N][1]-1+i.length),u.push(n[N][2]>0?n[N][2]:-n[N][2]-1+i.length),h.push(0),h.push(0),h.push(0);let V=i.length;const W=i.length-1;for(let N=0;N<r.length;N++){let j=!1;N>0&&(oe(g,y),N<r.length-1?(ve(y,r[N+1],r[N]),Se(y,y)):j=!0,ge(R,g,y),Se(R,R),ge(P,r[N-1],b),gF(r[N],R,k),zE(k,Ah(P,g),C)?(ve(C,C,r[N]),Se(_,C),Lt(w,R,_),Se(w,w)):LB(R,b,D,E,w,_,mbe),oe(b,_),oe(D,w)),s&&(ge(C,r[N],o),Se(L,C));for(let J=0;J<a;J++)if(ce(x,w,e[J][0]),ce(C,_,e[J][1]),ge(x,x,C),Se(S,x),c[m++]=S[0],c[m++]=S[1],c[m++]=S[2],ge(x,x,r[N]),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2],!j){const K=(J+1)%a;u.push(V+J),u.push(V+a+J),u.push(V+K),u.push(V+K),u.push(V+a+J),u.push(V+a+K);for(let te=0;te<6;te++){const ae=u.length-6;h.push(u[ae+te]-W)}}V+=a}const G=r[r.length-1];for(let N=0;N<i.length;N++)ce(x,w,i[N][0]),ce(C,_,i[N][1]),ge(x,x,C),ge(x,x,G),l[f++]=x[0],l[f++]=x[1],l[f++]=x[2];const B=m/3;c[m++]=y[0],c[m++]=y[1],c[m++]=y[2];const Z=V-a;for(let N=0;N<n.length;N++)u.push(n[N][0]>=0?V+n[N][0]:-n[N][0]-1+Z),u.push(n[N][2]>=0?V+n[N][2]:-n[N][2]-1+Z),u.push(n[N][1]>=0?V+n[N][1]:-n[N][1]-1+Z),h.push(B),h.push(B),h.push(B);const M=[[O.POSITION,u],[O.NORMAL,h]],$=[[O.POSITION,new ft(l,3,!0)],[O.NORMAL,new ft(c,3,!0)]];return new Us(t,$,M)}function Nyr(t,e,r,i){It(e.length>1,"createPolylineGeometry(): polyline needs at least 2 points"),It(e[0].length===3,"createPolylineGeometry(): malformed vertex"),It(r==null||r.length===e.length,"createPolylineGeometry: need same number of points and normals"),It(r==null||r[0].length===3,"createPolylineGeometry(): malformed normal");const n=sl(3*e.length),s=new Array(2*(e.length-1));let o=0,a=0;for(let u=0;u<e.length;u++){for(let h=0;h<3;h++)n[o++]=e[u][h];u>0&&(s[a++]=u-1,s[a++]=u)}const l=[],c=[];if(l.push([O.POSITION,s]),c.push([O.POSITION,new ft(n,3,!0)]),r){const u=Dn(3*r.length);let h=0;for(let f=0;f<e.length;f++)for(let m=0;m<3;m++)u[h++]=r[f][m];l.push([O.NORMAL,s]),c.push([O.NORMAL,new ft(u,3,!0)])}return i&&(c.push([O.COLOR,new ft(i,4)]),l.push([O.COLOR,qP(i.length/4)])),new Us(t,c,l,null,Wn.Line)}function Fyr(t,e,r,i,n,s=0){const o=new Array(18),a=[[-r,s,n/2],[i,s,n/2],[0,e+s,n/2],[-r,s,-n/2],[i,s,-n/2],[0,e+s,-n/2]],l=[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5];for(let c=0;c<6;c++)o[3*c]=a[c][0],o[3*c+1]=a[c][1],o[3*c+2]=a[c][2];return new Us(t,[[O.POSITION,new ft(o,3,!0)]],[[O.POSITION,l]])}function kyr(t,e){const r=t.getMutableAttribute(O.POSITION).data;for(let i=0;i<r.length;i+=3){const n=r[i],s=r[i+1],o=r[i+2];se(xC,n,s,o),lt(xC,xC,e),r[i]=xC[0],r[i+1]=xC[1],r[i+2]=xC[2]}}function eAt(t,e=t){const r=t.vertexAttributes,i=r.get(O.POSITION).data,n=r.get(O.NORMAL).data;if(n){const s=e.getMutableAttribute(O.NORMAL).data;for(let o=0;o<n.length;o+=3){const a=n[o+1];s[o+1]=-n[o+2],s[o+2]=a}}if(i){const s=e.getMutableAttribute(O.POSITION).data;for(let o=0;o<i.length;o+=3){const a=i[o+1];s[o+1]=-i[o+2],s[o+2]=a}}}function QX(t,e,r,i,n){return!(Math.abs(ye(e,t))>n)&&(Lt(r,t,e),Se(r,r),Lt(i,r,t),Se(i,i),!0)}function LB(t,e,r,i,n,s,o){return QX(t,e,n,s,o)||QX(t,r,n,s,o)||QX(t,i,n,s,o)}const mbe=.99619469809,xC=$n();let tAt=class{constructor(e,r){this.type=Sl.Local,this._configuration=new Zde,this._passParameters=new Jde,this._configuration.geometry=p0.Cylinder,this._technique=r.techniqueRepository.acquire(PB,this._configuration);const i=r.renderContext.rctx;this._vao=this._createVertexArrayObject(i),this._vaoCount=el(this._vao,"geometry");const n=new Vr;n.wrapMode=ir.CLAMP_TO_EDGE,n.flipped=!0,n.width=1,n.height=512,this._passParameters.texture=new Jt(i,n,bOt)}destroy(){this._passParameters.texture=pt(this._passParameters.texture),this._vao.dispose(),this._technique.release()}render(e){const r=e.rctx,i=r.bindTechnique(this._technique,this._passParameters,e.bindParameters);rAt(gbe,e.bindParameters.camera.viewMatrix),i.setUniformMatrix4fv("view",gbe),r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Zt.TRIANGLES,0,this._vaoCount)}renderHaze(){return!1}_createVertexArrayObject(e){const r=dUe(1,2,!1),i=r.indices[0][1],n=r.vertexAttributes[0][1];for(let l=0;l<i.length;l+=3){const c=i[l];i[l]=i[l+2],i[l+2]=c}const s=n.data,o=ybe.createBuffer(i.length),a=o.position;for(let l=0;l<i.length;++l){const c=3*i[l];a.set(l,0,s[c]),a.set(l,1,s[c+1]),a.set(l,2,s[c+2])}return new gg(e,Br,{geometry:Ad(ybe)},{geometry:ci.createVertex(e,qr.STATIC_DRAW,o.buffer)})}};function rAt(t,e){Rs(t,e),t[12]=0,t[13]=0,t[14]=0,t[15]=1}const gbe=Me(),ybe=On().vec3f(O.POSITION),iAt=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]),Ik=128,vbe=-Ore,_be=0,eY=50,nAt=()=>1-511/512,sAt=L8([[50,.1015625],[500,.21875],[5e3,1-250/512],[5e4,.4140625]]);let oAt=class{constructor(e,r){this.view=e,this.type=Sl.Mars,this._passParameters=new Jde,this._vaoCount=0,this._texV1=1;const i=Xr(e.spatialReference);this._planetRadius=i.radius,this._outerRimWidth=i.outerAtmosphereRimWidth,this._innerRimFactor=(this._planetRadius+vbe)/this._planetRadius,this._middleRimFactor=(this._planetRadius+_be)/this._planetRadius,this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius,this._texV0=_be/this._outerRimWidth,this._texVScale=this._texV1-this._texV0,this._techniqueRepository=r.techniqueRepository;const n=r.renderContext.rctx;this._cameraChangeHandle=pe(()=>{var a;return(a=this.view.state)==null?void 0:a.camera},()=>r.requestRender(),Bi),this._vao=this._createRibbon(n),this._vaoCount=el(this._vao,"geometry"),this._fadeVao=vu(n),this._fadeVaoCount=el(this._fadeVao,"geometry");const s=new Vr;s.wrapMode=ir.CLAMP_TO_EDGE,s.flipped=!0,s.width=1,s.height=512,this._passParameters.texture=new Jt(n,s,iAt);const o=new Zde;o.geometry=p0.Cone,this._coneTechnique=this._techniqueRepository.acquire(PB,o),o.geometry=p0.Underground,this._undergroundTechnique=this._techniqueRepository.acquire(PB,o)}destroy(){this._coneTechnique.release(),this._undergroundTechnique.release(),this._cameraChangeHandle.remove(),this._passParameters.texture=pt(this._passParameters.texture),this._fadeVao.dispose(),this._vao.dispose()}render(e){const r=e.bindParameters.camera;this._update(r);const i=e.rctx;this._passParameters.undergroundFadeAlpha<1&&(i.bindTechnique(this._coneTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._vao),i.drawArrays(Zt.TRIANGLES,0,this._vaoCount)),this._passParameters.undergroundFadeAlpha>0&&(i.bindTechnique(this._undergroundTechnique,this._passParameters,e.bindParameters),i.bindVAO(this._fadeVao),i.drawArrays(Zt.TRIANGLE_STRIP,0,this._fadeVaoCount))}renderHaze(){}_update(e){const r=A(),i=this._planetRadius,n=We(e.eye),s=n-i;if(s<0){const m=Math.min(-s/5e3,1);this._passParameters.undergroundFadeAlpha=m}else this._passParameters.undergroundFadeAlpha=0;const o=Math.max(eY,s),a=i+vbe;this._passParameters.innerScale=aAt(i+o,i,a)-1,this._passParameters.altitudeFade=kde(s),ce(r,e.eye,(i+eY)/n),bbe(r,e.center,e.up,i,this._passParameters.silhouette);const l=this._computeScreenRimWidth(e,r,e.up,this._passParameters.silhouette),c=nAt(),u=sAt(s);let h=this._texV0+c*this._texVScale,f=this._texV0+l*u*this._texVScale;if(s>eY){bbe(e.eye,e.center,e.up,i,this._passParameters.silhouette);const m=this._computeScreenRimWidth(e,e.eye,e.up,this._passParameters.silhouette),g=Te((m-1.5)/(l-1.5),0,1);h=this._texV0+g*c*this._texVScale,f=this._texV0+Xt(this._texV1,l*u,g)*this._texVScale}Or(this._passParameters.texV,h,f)}_createRibbon(e){const r=Dn(3+3*Ik*3),i=new Uint32Array(3*Ik*5);r[0]=0,r[1]=0,r[2]=-1;for(let o=0;o<Ik;o++){const a=9*o+3;r[a]=o,r[a+1]=this._innerRimFactor,r[a+2]=-1,r[a+3]=o,r[a+4]=this._middleRimFactor,r[a+5]=0,r[a+6]=o,r[a+7]=this._outerRimFactor,r[a+8]=1;const l=3*o+1,c=o===Ik-1?1:l+3,u=15*o;i[u]=l,i[u+1]=l+1,i[u+2]=c+1,i[u+3]=c+1,i[u+4]=c,i[u+5]=l,i[u+6]=l+1,i[u+7]=l+2,i[u+8]=c+2,i[u+9]=c+2,i[u+10]=c+1,i[u+11]=l+1,i[u+12]=l,i[u+13]=c,i[u+14]=0}const n=wbe.createBuffer(i.length),s=n.position;for(let o=0;o<i.length;++o){const a=3*i[o];s.set(o,0,r[a]),s.set(o,1,r[a+1]),s.set(o,2,r[a+2])}return new gg(e,Br,{geometry:Ad(wbe)},{geometry:ci.createVertex(e,qr.STATIC_DRAW,n.buffer)})}_computeScreenRimWidth(e,r,i,n){return ge(SC,n.center,n.v2),ce(Lk,SC,this._outerRimFactor),M7(tY,r,SC,i),B1e(SC,tY,e.projectionMatrix,e.viewport,SC),B1e(Lk,tY,e.projectionMatrix,e.viewport,Lk),Li(SC,Lk)/e.height}};function bbe(t,e,r,i,n){const s=We(t),o=i*Math.sqrt(s*s-i*i)/s,a=Math.sqrt(i*i-o*o),l=n.v1,c=n.v2;return ce(n.center,t,a/s),Lt(l,t,e),Al(l)<1&&Lt(l,t,r),ce(l,l,o/We(l)),Lt(c,l,t),ce(c,c,o/We(c)),o}const tY=Me(),SC=A(),Lk=A();function aAt(t,e,r){return t*t/(Math.sqrt(t*t-e*e)*Math.sqrt(t*t-r*r)+e*r)}const wbe=On().vec3f(O.POSITION);var U_;(function(t){t[t.Rain=0]="Rain",t[t.Snow=1]="Snow",t[t.COUNT=2]="COUNT"})(U_||(U_={}));let Tie=class extends jl{constructor(){super(...arguments),this.type=U_.Rain}};d([X({count:U_.COUNT})],Tie.prototype,"type",void 0);function lAt(t){const e=new jr;return e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.INSTANCEFEATUREATTRIBUTE,"float"),e.vertex.uniforms.add(new ar("cameraPosition",(r,i)=>i.camera.eye)),e.vertex.uniforms.add(new ar("offset",(r,i)=>cAt(r,i))),e.vertex.uniforms.add(new Ye("width",r=>r.width)),e.vertex.uniforms.add(new yn("proj",(r,i)=>i.camera.projectionMatrix)),e.vertex.uniforms.add(new yn("view",(r,i)=>i.camera.viewMatrix)),e.vertex.uniforms.add(new Ye("time",r=>r.time)),e.varyings.add("vUv","vec2"),e.vertex.code.add(T`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${t.type===U_.Rain?T`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:T`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `),e.fragment.uniforms.add(new Ye("opacity",r=>r.opacity),new ar("particleColor",(r,i)=>uAt(i,t))),e.fragment.code.add(T`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${t.type===U_.Rain?T`d = 0.35 * smoothstep(0.5, 0.0, d);`:T`d = smoothstep(0.5, 0.1, d);`}
      fragColor = opacity * vec4(particleColor * d, d);
    }
  `),e}function cAt(t,e){const r=e.camera.eye,i=.5*t.width,n=1/t.width,s=lLe(Eie,se(Eie,(r[0]+i)*n,(r[1]+i)*n,(r[2]+i)*n));return Gi(s,r,ce(s,s,t.width))}function uAt(t,e){const r=e.type===U_.Rain?hAt:dAt,i=ce(Eie,r,pAt),n=t.camera.eye;Se(xbe,n);const s=Math.max(0,ye(xbe,t.lighting.mainLight.direction));return mi(i,i,r,s)}const Eie=A(),xbe=A(),dAt=Ue(1,1,1),hAt=Ue(.85,.85,.85),pAt=.7,fAt=Object.freeze(Object.defineProperty({__proto__:null,build:lAt},Symbol.toStringTag,{value:"Module"}));let mAt=class extends Ai{constructor(){super(...arguments),this.time=0,this.radius=1,this.width=500,this.opacity=1}},Cie=class hUe extends si{initializeProgram(e){return new Kr(e.rctx,hUe.shader.get().build(this.configuration),Sz)}initializePipeline(){return Qt({blending:Fa(De.ONE,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:Oi.LEQUAL},colorWrite:hr})}};Cie.shader=new Jr(fAt,()=>le(()=>import("./Precipitation.glsl-095f1a08.js"),[]));const Sz=new Map([[O.POSITION,0],[O.INSTANCEFEATUREATTRIBUTE,1]]);let pUe=class{constructor(){this.enabled=!0,this._time=0}get time(){return this._time}advance({deltaTime:e,fixedTime:r}){return r!=null?this._time!==r&&(this._time=r,!0):(this._time=this._time+e,e!==0)}},gAt=class{constructor(e,r){this.deltaTime=e,this.fixedTime=r}},tT=class extends Ce{constructor(e){super(e),this._numParticles=25e4,this._rainSpeed=.1,this._snowSpeed=.01,this._passParameters=new mAt,this._animation=new pUe,this._updatingTracking=new Yy,this._passParameters.time=0,this._passParameters.radius=Xr(e.view.spatialReference).radius,this._techniqueRepository=e.context.techniqueRepository}destroy(){this._updatingTracking.destroy(),this._numParticles=0,this._snowTechniqueCached=xn(this._snowTechniqueCached),this._rainTechniqueCached=xn(this._rainTechniqueCached),this._vao=pt(this._vao),this._instanceIdBuffer=pt(this._instanceIdBuffer)}get updating(){return this._updatingTracking.updating}get _rainTechnique(){if(this._rainTechniqueCached==null){const e=new Tie;e.type=U_.Rain,this._rainTechniqueCached=this._techniqueRepository.acquire(Cie,e)}return this._rainTechniqueCached}get _snowTechnique(){if(this._snowTechniqueCached==null){const e=new Tie;e.type=U_.Snow,this._snowTechniqueCached=this._techniqueRepository.acquire(Cie,e)}return this._snowTechniqueCached}update(e){return this._animation.advance(e)}render(e,r,i){var l;const n=i==="rainy"?this._rainTechnique:this._snowTechnique;if(!n.compiled)return void this.context.requestRender();const s=e.rctx;if(this._ensureResources(s),n==null||this._vao==null||this._instanceIdBuffer==null||(e.bindParameters.cloudsFade.data!=null&&(this._passParameters.opacity=1-e.bindParameters.cloudsFade.fadeInOutHeight.factor),this._passParameters.opacity<=0))return;const o=.35;r=r<.5?Xt(0,o,2*r):Xt(o,1,2*(r-.5)),this._passParameters.time=(i==="rainy"?this._rainSpeed:this._snowSpeed)*lce(this._animation.time)%1e5;const a=s.bindTechnique(n,this._passParameters,e.bindParameters);s.bindVAO(this._vao),a.assertCompatibleVertexAttributeLocations(this._vao),Vde(s,Sz,this._instanceIdBuffer,Sbe,0),(l=s.capabilities.instancing)==null||l.drawArraysInstanced(Zt.TRIANGLES,0,3,this._numParticles*r),Bde(s,Sz,this._instanceIdBuffer,Sbe)}_ensureResources(e){this._vao==null&&(this._vao=this._createVertexArrayObject(e)),this._instanceIdBuffer==null&&(this._instanceIdBuffer=this._createInstanceIndices(e))}_createInstanceIndices(e){const r=[];for(let i=0;i<this._numParticles;i++)r.push(i);return ci.createVertex(e,qr.STATIC_DRAW,new Float32Array(r))}_createVertexArrayObject(e){const r=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new gg(e,Sz,{geometry:Ad(yAt)},{geometry:ci.createVertex(e,qr.STATIC_DRAW,r)})}};d([p({constructOnly:!0})],tT.prototype,"context",void 0),d([p({constructOnly:!0})],tT.prototype,"view",void 0),d([p({readOnly:!0})],tT.prototype,"updating",null),d([p()],tT.prototype,"_updatingTracking",void 0),tT=d([I("esri.views.3d.environment.Precipitation")],tT);const yAt=On().vec3f(O.POSITION),Sbe=Ad(On().f32(O.INSTANCEFEATUREATTRIBUTE),1);function vAt(){const t=new jr;return t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.COLOR,"vec4"),t.attributes.add(O.SIZE,"float"),t.varyings.add("vcolor","vec4"),t.varyings.add("vsize","float"),t.vertex.uniforms.add(new yn("transform",(e,r)=>_At(e,r)),new Cr("viewport",(e,r)=>r.camera.fullViewport),new Ye("pixelRatio",(e,r)=>r.camera.pixelRatio)),t.vertex.code.add(T`void main(void) {
gl_Position = transform * vec4(position, 0);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`),t.fragment.code.add(T`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
fragColor = vec4(vcolor.xyz, intensity);
}`),t}function _At(t,e){return Rs(C1,e.camera.projectionMatrix),C1[10]=24e-8-1,C1[11]=-1,C1[14]=(24e-8-2)*e.camera.near,Ii(C1,C1,e.camera.viewMatrix),Ii(C1,C1,t.modelMatrix)}const C1=Me(),bAt=Object.freeze(Object.defineProperty({__proto__:null,build:vAt},Symbol.toStringTag,{value:"Module"}));let wAt=class extends Ai{constructor(){super(...arguments),this.modelMatrix=Me()}},fUe=class mUe extends si{constructor(e){super(e,new jl,()=>this.destroy())}initializeProgram(e){return new Kr(e.rctx,mUe.shader.get().build(),Br)}initializePipeline(){return Qt({blending:Fa(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:Oi.LEQUAL},colorWrite:hr})}};fUe.shader=new Jr(bAt,()=>le(()=>import("./Stars.glsl-44d58bda.js"),[]));let bb=class extends Ce{get updating(){return this._updatingTracking.updating||this.loading}get loading(){return this._loadDataTask!=null&&!this._loadDataTask.finished}constructor(e){super(e),this._loadDataTask=null,this._numPoints=0,this._renderParameter=new wAt,this._updatingTracking=new Yy}initialize(){this._loadDataTask=this._createLoadDataTask()}destroy(){this._loadDataTask=xc(this._loadDataTask),this._updatingTracking.destroy(),this._numPoints=0,this._technique=xn(this._technique),this._vao=pt(this._vao),Wx=null}render(e){const{rctx:r}=e;if(this._ensureResources(r),this._technique==null||this._vao==null)return;if(!this._technique.compiled)return void this.requestRender();const i=r.bindTechnique(this._technique,this._renderParameter,e.bindParameters);r.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),r.drawArrays(Zt.POINTS,0,this._numPoints)}_ensureResources(e){if(this._technique!=null||Wx==null)return;this._technique=new fUe({rctx:e,viewingMode:this.view.state.viewingMode}),this._numPoints=Wx.byteLength/Tbe;const r=new Float32Array(Wx,0,2*this._numPoints),i=new Uint8Array(Wx,2*this._numPoints*4,this._numPoints);this._vao=this._createVertexArrayObject(e,r,i,this._numPoints),this._updatingTracking.add(()=>this.view.environment.lighting.type!=="virtual"?this.view.environment.lighting.date:null,n=>this._update(n),_r)}_computeDayDuration(e){const r=e,i=new Date(e.getFullYear(),0,1,11,58,56);return(+r-+i)/(+new Date(e.getFullYear()+1,0,1,11,58,55)-+i)}_update(e){if(!e)return;const r=(e.getHours()/12+e.getMinutes()/60*(2/24)+e.getSeconds()/60*(2/1440)-.9972222)%2,i=2*this._computeDayDuration(e),n=Rs(this._renderParameter.modelMatrix,TAt);bP(n,n,-i*Math.PI),Ii(n,SAt,n),bP(n,n,-r*Math.PI),this.requestRender()}_hexToRGB(e){return[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16)]}_unpackUint8Attributes(e){return e>=192?[2.9,e-192]:e>=160?[2.5,e-160]:e>=128?[2,e-128]:e>=96?[1.5,e-96]:e>=64?[1,e-64]:e>=32?[.7,e-32]:[.4,e]}_createVertexArrayObject(e,r,i,n){const s=Ebe.createBuffer(n),o=s.position,a=s.color,l=s.size;for(let c=0;c<n;c++){const u=r[2*c],h=r[2*c+1];o.set(c,0,-Math.cos(u)*Math.sin(h)),o.set(c,1,-Math.sin(u)*Math.sin(h)),o.set(c,2,-Math.cos(h));const f=this._unpackUint8Attributes(i[c]),m=this._hexToRGB(xAt[f[1]]);a.set(c,0,255*m[0]),a.set(c,1,255*m[1]),a.set(c,2,255*m[2]),a.set(c,3,255),l.set(c,f[0])}return new gg(e,Br,{geometry:Ad(Ebe)},{geometry:ci.createVertex(e,qr.STATIC_DRAW,s.buffer)})}_createLoadDataTask(){if(Wx!=null)return null;const e=R3(async r=>{const{data:i}=await Qpt("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:r});this._verifyStarData(i),Wx=i});return e.promise.catch(r=>{Yn(r)||re.getLogger(this).error(r)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))}),e}_verifyStarData(e){if(!e)throw new H("stars:no-data-received","Failed to create stars because star catalogue is missing");const r=e.byteLength/Tbe;if(r%1!=0||r>5e4||r<5e3)throw new H("stars:invalid-data","Failed to create stars because star catalogue data is invalid")}};d([p({constructOnly:!0})],bb.prototype,"view",void 0),d([p({constructOnly:!0})],bb.prototype,"requestRender",void 0),d([p({readOnly:!0})],bb.prototype,"updating",null),d([p()],bb.prototype,"_loadDataTask",void 0),d([p()],bb.prototype,"_updatingTracking",void 0),bb=d([I("esri.views.3d.environment.Stars")],bb);const xAt=["9bb2ff","9eb5ff","aabfff","bbccff","ccd8ff ","dae2ff","e4e9ff","eeefff","f8f6ff","fff9fb","fff5ef","fff1e5","ffeddb","ffe9d2","ffe6ca","ffe3c3","ffe0bb","ffddb4","ffdaad","ffd6a5","ffd29c","ffcc8f","ffc178","ffa94b","ff7b00"],SAt=ede(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),TAt=ede(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),Tbe=9,Ebe=On().vec3f(O.POSITION).vec4u8(O.COLOR).f32(O.SIZE);let Wx=null;function n1(t=CAt){return[t[0],t[1],t[2],t[3]]}function rY(t,e,r=n1()){return oe(r,t),r[3]=e,r}function Cbe(t,e,r=n1()){return Lt(r,t,e),Se(r,r),r[3]=-uLe(t,e),r}function Rbe(t,e,r=n1()){return dB(Dk,t,Obe(t)),dB(Abe,e,Obe(e)),cH(Dk,Abe,Dk),EAt(r,Oc(fde(r,Dk)))}function Xyr(t,e,r,i=n1()){return rY(oLe,t,Nk),rY(aLe,e,Pbe),rY(Dce,r,Mbe),Rbe(Nk,Pbe,Nk),Rbe(Nk,Mbe,i),i}function Yyr(t){return t}function Zyr(t){return t[3]}function Obe(t){return sr(t[3])}function EAt(t,e){return t[3]=e,t}const CAt=[0,0,1,0],Dk=bf(),Abe=bf();n1();const Nk=n1(),Pbe=n1(),Mbe=n1();function RAt(t,e,r){const i=t.parallax.anchorPointClouds;t.fadeIn.stage===Xu.FINISHED&&(t.fadeIn.factor=0,oe(i,Py),t.fadeIn.stage=Xu.CHANGE_ANCHOR,t.crossFade.enabled=!1,t.fadeInOut.stage=Mo.FINISHED),t.fadeIn.stage===Xu.CHANGE_ANCHOR&&t.isCameraPositionFinal&&(Xde(t.data)&&t.renderingStage!==bs.RENDERING||t.renderingStage===bs.FADING_TEXTURE_CHANNELS)&&(oe(i,Py),t.fadeIn.stage=Xu.FADE_IN,t.startTime=e,t.renderingStage===bs.FADING_TEXTURE_CHANNELS&&(t.renderingStage=bs.SWITCH_CHANNELS)),t.fadeIn.factor<1&&t.fadeIn.stage===Xu.FADE_IN?t.fadeIn.factor=r?Te((e-t.startTime)/(gUe*r),0,1):1:t.fadeIn.factor>=1&&t.fadeIn.stage===Xu.FADE_IN&&(t.fadeIn.stage=Xu.FINISHED,t.fadeIn.factor=1)}function OAt(t,e,r){const{fadeInOut:i,crossFade:n}=t;i.stage===Mo.FINISHED&&(t.startTime=e,i.factor=1,i.stage=Mo.FADE_OUT),i.factor>0&&i.stage===Mo.FADE_OUT?i.factor=r?1-Te((e-t.startTime)/(IAt*r),0,1):0:(i.factor<=0&&i.stage===Mo.FADE_OUT&&(i.factor=0,oe(t.parallax.anchorPointClouds,Py)),i.factor<=0&&i.stage===Mo.FADE_OUT&&t.isCameraPositionFinal&&(i.factor=0,i.stage=Mo.SWITCH,t.crossFade.enabled=!1,n.factor=1),i.stage===Mo.SWITCH&&(Xde(t.data)&&t.renderingStage!==bs.RENDERING||t.renderingStage===bs.FADING_TEXTURE_CHANNELS)&&(t.startTime=e,i.factor=0,i.stage=Mo.FADE_IN,oe(t.parallax.anchorPointClouds,Py),t.crossFade.enabled=!1,n.factor=1,t.renderingStage===bs.FADING_TEXTURE_CHANNELS&&(t.renderingStage=bs.SWITCH_CHANNELS)),i.factor<1&&i.stage===Mo.FADE_IN?i.factor=r?Te((e-t.startTime)/(gUe*r),0,1):1:i.factor>=1&&i.stage===Mo.FADE_IN&&(i.stage=Mo.FINISHED,i.factor=1))}function AAt(t,e,r,i){const{crossFade:n}=t,s=t.parallax.anchorPointClouds;t.crossFade.enabled&&!i||(oe(t.parallaxNew.anchorPointClouds,Py),t.startTime=e,n.factor=0,t.crossFade.enabled=!0),n.factor<1&&t.crossFade.enabled?n.factor=r?Te((e-t.startTime)/(LAt*r),0,1):1:n.factor>=1&&t.crossFade.enabled&&(t.crossFade.enabled=!1,n.factor=1,oe(s,t.parallaxNew.anchorPointClouds),t.renderingStage===bs.FADING_TEXTURE_CHANNELS&&(t.renderingStage=bs.SWITCH_CHANNELS))}function $be(t,e,r,i){const n=t.fadeInOutHeight,s=n.stage===lx.FINISHED?r:t.startTimeHeightFade;if(i!==0){const o=(r-s)/(DAt*i);n.factor+=e?-o:o}else n.factor=e?0:1;t.startTimeHeightFade=r,n.factor=Te(n.factor,0,1),n.stage=lx.HEIGHT_FADE}function PAt(t,e,r,i,n){t.renderingStage===bs.FINISHED_RENDERING&&(t.renderingStage=bs.FADING_TEXTURE_CHANNELS);const s=We(e.eye);t.fadeInOutHeight.factor<0&&(t.fadeInOutHeight.factor=s-Rr.radius>by?1:0),t.isCameraPositionFinal=Ww(t.cameraPositionLastFrame,e.eye),Se(Py,e.eye),ce(Py,Py,Rr.radius);const o=t.parallax;o.anchorPointClouds[0]===0&&o.anchorPointClouds[1]===0&&o.anchorPointClouds[2]===0&&oe(o.anchorPointClouds,Py);const a=We(ve($At,o.anchorPointClouds,Py));let l=!0;a>t.fadeIn.distanceThresholdFactor*o.cloudsHeight||t.fadeIn.stage!==Xu.FINISHED?RAt(t,i,n):a>t.fadeInOut.distanceThresholdFactor*o.cloudsHeight||t.fadeInOut.stage!==Mo.FINISHED?OAt(t,i,n):a>t.crossFade.distanceThresholdFactor*o.cloudsHeight||t.crossFade.enabled||t.renderingStage===bs.FADING_TEXTURE_CHANNELS?AAt(t,i,n,(r!==ai.IDLE||!Xde(t.data))&&t.renderingStage!==bs.FADING_TEXTURE_CHANNELS):l=!1;const c=s-Rr.radius;if((c>1.7*by||c<-by)&&t.fadeInOutHeight.factor<1?t.fadeInOutHeight.factor=1:(c>by||c<-.35*by)&&t.fadeInOutHeight.factor<1?$be(t,!1,i,n):c<by&&c>-.35*by&&t.fadeInOutHeight.factor>0?$be(t,!0,i,n):t.fadeInOutHeight.stage=lx.FINISHED,t.renderingStage===bs.SWITCH_CHANNELS&&(t.readChannels=1-t.readChannels,t.renderingStage=bs.FINISHED),o.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(s*s-Rr.radius*Rr.radius,0))/s,Cbe(Ibe,o.anchorPointClouds,TC),sd(o.transform,bo,TC[3],TC),l){const{parallaxNew:u}=t;Cbe(Ibe,u.anchorPointClouds,TC),sd(u.transform,bo,TC[3],TC)}oe(t.cameraPositionLastFrame,e.eye)}function MAt(t){return t.crossFade.enabled||t.fadeInOut.stage!==Mo.FINISHED||t.fadeIn.stage!==Xu.FINISHED||t.fadeInOutHeight.stage!==lx.FINISHED||t.renderingStage!==bs.FINISHED}const Ibe=Ue(0,0,1),TC=n1(),Py=A(),$At=A(),gUe=1,IAt=.5,LAt=1.3,DAt=1;let W3=class{constructor(){this._outer=new Map}clear(){this._outer.clear()}get empty(){return this._outer.size===0}get(e,r){var i;return(i=this._outer.get(e))==null?void 0:i.get(r)}set(e,r,i){const n=this._outer.get(e);n?n.set(r,i):this._outer.set(e,new Map([[r,i]]))}delete(e,r){const i=this._outer.get(e);i&&(i.delete(r),i.size===0&&this._outer.delete(e))}forEach(e){this._outer.forEach((r,i)=>e(r,i))}};var qs;function Lbe(t=!he("disable-feature:high-quality-idle"),e=null){const r=new W3;return t?(r.set(ai.IDLE,qs.Antialiasing,e!=="low"),r.set(ai.IDLE,qs.HighResolutionAtmosphere,e!=="low"),r.set(ai.IDLE,qs.HighQualityTransparency,!0),r.set(ai.IDLE,qs.SSAO,!0),r.set(ai.IDLE,qs.WaterReflection,!0),r.set(ai.IDLE,qs.PhysicalPixelRendering,!he("esri-mobile"))):(r.set(ai.ANIMATING,qs.HighResolutionShadows,!0),r.set(ai.INTERACTING,qs.HighResolutionShadows,!0)),r.set(ai.IDLE,qs.HighResolutionShadows,!0),r.set(ai.IDLE,qs.HighResolutionVoxel,!0),r}(function(t){t[t.Antialiasing=0]="Antialiasing",t[t.HighQualityTransparency=1]="HighQualityTransparency",t[t.HighResolutionVoxel=2]="HighResolutionVoxel",t[t.HighResolutionAtmosphere=3]="HighResolutionAtmosphere",t[t.SSAO=4]="SSAO",t[t.WaterReflection=5]="WaterReflection",t[t.HighResolutionShadows=6]="HighResolutionShadows",t[t.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(qs||(qs={}));var $A;(function(t){t[t.Immediate=0]="Immediate",t[t.Faded=1]="Faded"})($A||($A={}));var GI;const NAt=[_e.POSTPROCESSING_ENVIRONMENT_OPAQUE,_e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];let Ha=GI=class extends Ce{constructor(t){super(t),this._context=null,this._atmosphere=null,this._oldWeatherParameters=new iY,this._newWeatherParameters=new iY,this._fadedWeatherParameters=new iY,this._weatherParameters=this._newWeatherParameters}initialize(){this.view._stage.addRenderPlugin(NAt,this)}destroy(){var t;this.removeHandles(),this.uninitializeRenderContext(),((t=this.view)==null?void 0:t._stage)!=null&&this.view._stage.removeRenderPlugin(this),this._set("view",null)}get atmosphere(){return this._atmosphere}get _atmosphereType(){return this.atmosphere!=null?this.atmosphere.type:Sl.None}get canRender(){return!(this._atmosphere===null&&this._stars===null)}get needsLinearDepth(){return this._atmosphereType===Sl.Realistic}updateAnimation(t){return this._precipitation!=null&&this._precipitation.update(t)}get updating(){return this._stars!=null&&this._stars.updating||this._clouds!=null&&this._clouds.running}get weatherVisible(){return We(this.view.state.camera.eye)-Xr(this.view.spatialReference).radius<=by}get _stars(){var i;const t=this.view,e=((i=t.environment)==null?void 0:i.starsEnabled)??!1,r=this._get("_stars");return e&&this._context!=null?r??new bb({view:t,requestRender:()=>this._setNeedsRender()}):(qe(r),null)}get _precipitation(){const t=this._get("_precipitation");if(!this._precipitationEnabled||this._context==null)return qe(t),null;const e=this.view,r=this._context;return t!=null&&t.context===r?t:(qe(t),new tT({context:r,view:e}))}get _clouds(){const t=this._get("_clouds");if(!this.weatherEnabled||this._context==null)return qe(t),null;if(t!=null)return t;const e=this.view,r=this._context;return qe(t),new jc({context:r,view:e,requestRender:()=>this._setNeedsRender()})}get _cloudsComposition(){const t=this._get("_cloudsComposition");if(!this.weatherEnabled||this._context==null)return qe(t),null;const e=this.view.state.viewingMode,r=this._context.renderContext.rctx,i=Xr(this.view.spatialReference).radius;return t!=null&&t.viewingMode===e&&t.planetRadius===i?t:(qe(t),new KS({rctx:r,viewingMode:e,planetRadius:i,requestRender:()=>this._setNeedsRender()}))}get _fog(){const t=this._get("_fog");if(!this.weatherEnabled||this._context==null)return qe(t),null;if(t!=null)return t;const e=this.view,r=this._context,i=this._context.renderContext.rctx,n=this.view.state.viewingMode;return new QS({context:r,view:e,rctx:i,viewingMode:n})}get weatherEnabled(){var t,e;return!!((e=(t=this.view)==null?void 0:t.environmentManager)!=null&&e.weatherEnabled)}get _precipitationEnabled(){return this.weatherEnabled&&(this.view.environment.weather.type==="rainy"||this.view.environment.weather.type==="snowy")}initializeRenderContext(t=null){this._context=t;const e=()=>this._setNeedsRender();this.addHandles([pe(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),r=>this._updateAtmosphere(r),Bi),pe(()=>this._stars,e),pe(()=>this._precipitation,e),pe(()=>this._clouds,()=>this._updateWeather(),_r),pe(()=>this._fog,()=>this._updateFogHaze(),_r),pe(()=>this.view.state.mode,()=>{this._setNeedsRender()},li),pe(()=>this._weatherUpdateParameters,()=>{this._updateWeather(),this._updateFogHaze()},Bi)])}uninitializeRenderContext(){this._context=null,this._atmosphere=qe(this._atmosphere),this._set("_stars",qe(this._stars)),this._set("_precipitation",qe(this._precipitation)),this._set("_clouds",qe(this._clouds)),this._set("_cloudsComposition",qe(this._cloudsComposition)),this._set("_fog",qe(this._fog))}prepareRender(t){var e;t.bindParameters.cloudsFade.data=ERt(this._clouds)?this._clouds:null,this.view.viewingMode!=="local"&&((e=t.bindParameters.cloudsFade.data)==null?void 0:e.cubeMap)!=null&&(PAt(t.bindParameters.cloudsFade,t.bindParameters.camera,this.view.state.mode,t.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(t.bindParameters),t.bindParameters.cloudsFade.renderingStage===bs.FINISHED&&this._clouds!=null&&this._clouds.coverage===0&&this._clouds.running===!1&&(this._clouds.destroyFrameBufferCube(),t.bindParameters.cloudsFade.data=null))}render(t){var e,r,i,n,s,o,a,l,c;if(t.output===q.Color)switch(t.bindParameters.slot){case _e.POSTPROCESSING_ENVIRONMENT_OPAQUE:this._stars!=null&&this._stars.render(t),this.atmosphere!=null&&(this.atmosphere.render(t,((e=this.view)==null?void 0:e.qualitySettings.highResolutionAtmosphere)||((n=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer)==null?void 0:n.isFeatureEnabled(qs.HighResolutionAtmosphere))),this._cloudsComposition!=null&&t.bindParameters.cloudsFade.data!=null&&(this.weatherVisible&&this._clouds!=null&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(t)),MAt(t.bindParameters.cloudsFade)&&this._context!=null&&((s=t.bindParameters.cloudsFade.data)==null?void 0:s.cubeMap)!=null&&this._context.requestRender());break;case _e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(this.atmosphere!=null&&(this.atmosphere.renderHaze(t,this._weatherParameters.hazeAmount,((o=this.view)==null?void 0:o.qualitySettings.highResolutionAtmosphere)||((c=(l=(a=this.view)==null?void 0:a._stage)==null?void 0:l.renderer)==null?void 0:c.isFeatureEnabled(qs.HighResolutionAtmosphere))),this._weatherParameters.fog.amount>0&&this._fog!=null&&this._fog.render(t,this._weatherParameters.fog),this._precipitation!=null)){const u=this.view.environment.weather;u.type!=="rainy"&&u.type!=="snowy"||this._precipitation.render(t,u.precipitation,u.type)}}}updateLightSources(t,e,r,i){if(this._context!=null){const n=this._context.renderContext;n.bindParameters.oldLighting.copyFrom(n.bindParameters.lighting),n.bindParameters.newLighting.noonFactor=e,n.bindParameters.newLighting.globalFactor=r,n.bindParameters.newLighting.set(t),i===$A.Faded||n.bindParameters.weatherFading?n.bindParameters.fadeLighting(0):n.bindParameters.fadeLighting(1),this._context.requestRender()}}get _weatherUpdateParameters(){const t=this.weatherEnabled?this.view.environment.weather:null;return t==null?null:t.type==="rainy"||t.type==="snowy"?{type:t.type,weatherAdjustment:t.cloudCover,effect:t.precipitation}:{type:t.type,weatherAdjustment:t.type==="foggy"?t.fogStrength:t.cloudCover}}_updateWeatherFading(t){if(!t.weatherFading)return;const e=t.cloudsFade;return e.fadeIn.stage===Xu.FADE_IN?(t.fadeLighting(e.fadeIn.factor),void this._fadeWeather(e.fadeIn.factor)):e.fadeInOut.stage===Mo.FADE_IN?(t.fadeLighting(e.fadeInOut.factor),void this._fadeWeather(e.fadeInOut.factor)):e.crossFade.enabled?(t.fadeLighting(e.crossFade.factor),void this._fadeWeather(e.crossFade.factor)):(t.fadeLighting(0),void this._fadeWeather(0))}_fadeWeather(t){const{_newWeatherParameters:e,_oldWeatherParameters:r}=this;t>=1?this._weatherParameters=e:(this._fadedWeatherParameters.lerp(r,e,t),this._weatherParameters=this._fadedWeatherParameters)}_updateWeather(){const t=this._weatherUpdateParameters;t!=null&&this._clouds!=null&&(this._clouds.applyPreset(bl[t.type],t.weatherAdjustment),this._setNeedsRender())}_setNeedsRender(){this._context!=null&&this._context.requestRender()}_updateFogHaze(){const t=this._weatherUpdateParameters;if(this._fog==null||t==null||this._context==null)return;const e=this._context.renderContext.bindParameters;switch(this._oldWeatherParameters.copyFrom(this._weatherParameters),t.type){case"foggy":this._newWeatherParameters.fog.strength=Xt(3e-5,.005,t.weatherAdjustment**3),oe(this._newWeatherParameters.fog.color,Dbe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;case"rainy":this._newWeatherParameters.fog.strength=Xt(4e-6,2e-4,(t.effect??0)**3),oe(this._newWeatherParameters.fog.color,FAt),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=0,this._setNeedsRender();break;case"snowy":this._newWeatherParameters.fog.strength=Xt(4e-6,2e-4,(t.effect??0)**3),oe(this._newWeatherParameters.fog.color,Dbe),this._newWeatherParameters.fog.amount=1,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,this._newWeatherParameters.hazeAmount=1,this._setNeedsRender()}e.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}_updateAtmosphere(t){const e=this._selectAtmosphereType(t);if(e!==Sl.None&&this._context){if(!this._atmosphere||this._atmosphere.type!==e){this._atmosphere=qe(this._atmosphere);const r=this._getAtmosphereClass(e);r&&(this._atmosphere=new r(this.view,this._context))}}else this._atmosphere=qe(this._atmosphere);this._setNeedsRender()}_getAtmosphereClass(t){switch(t){case Sl.Realistic:return ebe;case Sl.Local:return tAt;case Sl.Mars:return oAt;default:case Sl.None:return null}}_selectAtmosphereType(t){const{enabled:e,viewingMode:r}=t;return!e||x0(this.view.spatialReference)?Sl.None:r===at.Local?Sl.Local:this._context!=null&&ebe.isSupported(this._context)&&pP(this.view.spatialReference)?Sl.Realistic:w0(this.view.spatialReference)?Sl.Mars:Sl.None}get test(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled}),stubGetAtmosphereClass:t=>{Nbe=GI.prototype._getAtmosphereClass,GI.prototype._getAtmosphereClass=t},restoreGetAtmosphereClass:()=>{GI.prototype._getAtmosphereClass=Nbe}}}};d([p({constructOnly:!0})],Ha.prototype,"view",void 0),d([p({readOnly:!0})],Ha.prototype,"atmosphere",null),d([p({readOnly:!0})],Ha.prototype,"_atmosphereType",null),d([p({type:Boolean,readOnly:!0})],Ha.prototype,"updating",null),d([p({readOnly:!0})],Ha.prototype,"weatherVisible",null),d([p()],Ha.prototype,"_context",void 0),d([p()],Ha.prototype,"_atmosphere",void 0),d([p({readOnly:!0})],Ha.prototype,"_stars",null),d([p({readOnly:!0})],Ha.prototype,"_precipitation",null),d([p({readOnly:!0})],Ha.prototype,"_clouds",null),d([p({readOnly:!0})],Ha.prototype,"_cloudsComposition",null),d([p({readOnly:!0})],Ha.prototype,"_fog",null),d([p({readOnly:!0})],Ha.prototype,"weatherEnabled",null),d([p({readOnly:!0})],Ha.prototype,"_precipitationEnabled",null),d([p({readOnly:!0})],Ha.prototype,"_weatherUpdateParameters",null),Ha=GI=d([I("esri.views.3d.environment.EnvironmentRenderer")],Ha);let iY=class{constructor(){this.fog=new yOt,this.hazeAmount=1}copyFrom(e){this.fog.amount=e.fog.amount,this.hazeAmount=e.hazeAmount,this.fog.strength=e.fog.strength,oe(this.fog.color,e.fog.color)}lerp(e,r,i){this.fog.amount=Xt(e.fog.amount,r.fog.amount,i),this.hazeAmount=Xt(e.hazeAmount,r.hazeAmount,i),this.fog.strength=Xt(e.fog.strength,r.fog.strength,i),mi(this.fog.color,e.fog.color,r.fog.color,i)}};const FAt=Ue(.5,.5,.5),Dbe=Ue(1.5,1.5,1.5);let Nbe;var Qyr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function CF(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Fbe,kbe,Ube,Rie={exports:{}};Rie.exports,Fbe=Rie,kbe=function(){var t=Math.PI,e=Math.sin,r=Math.cos,i=Math.tan,n=Math.asin,s=Math.atan2,o=Math.acos,a=t/180,l=864e5,c=2440588,u=2451545,h={dec:0,ra:0};function f(M){return M.valueOf()/l-.5+c}function m(M){return new Date((M+.5-c)*l)}function g(M){return f(M)-u}var y=23.4397*a;function _(M,$){return s(e(M)*r(y)-i($)*e(y),r(M))}function b(M,$){return n(e($)*r(y)+r($)*e(y)*e(M))}function w(M,$,N){return s(e(M),r(M)*e($)-i(N)*r($))}function x(M,$,N){return n(e($)*e(N)+r($)*r(N)*r(M))}function S(M,$){return a*(280.16+360.9856235*M)-$}function C(M){return a*(357.5291+.98560028*M)}function E(M){return a*(1.9148*e(M)+.02*e(2*M)+3e-4*e(3*M))}function R(M,$){return M+$+102.9372*a+t}function P(M,$){var N=C(M),j=R(N,E(N));return $||($={dec:0,ra:0}),$.dec=b(j,0),$.ra=_(j,0),$}var D={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(M,$,N,j){var J=a*-N,K=a*$,te=g(M),ae=P(te,h),be=S(te,J)-ae.ra;return j||(j={azimuth:0,altitude:0}),j.azimuth=w(be,K,ae.dec),j.altitude=x(be,K,ae.dec),j}},L=[[-.83,"sunrise","sunset"]];D.addTime=function(M,$,N){L.push([M,$,N])};var k=9e-4;function V(M,$){return Math.round(M-k-$/(2*t))}function W(M,$,N){return k+(M+$)/(2*t)+N}function G(M,$,N){return u+M+.0053*e($)-.0069*e(2*N)}function B(M,$,N){return o((e(M)-e($)*e(N))/(r($)*r(N)))}function Z(M){var $=a*(134.963+13.064993*M),N=a*(93.272+13.22935*M),j=a*(218.316+13.176396*M)+6.289*a*e($),J=5.128*a*e(N),K=385001-20905*r($);return{ra:_(j,J),dec:b(j,J),dist:K}}return D.getTimes=function(M,$,N){var j=a*-N,J=a*$,K=V(g(M),j),te=W(0,j,K),ae=C(te),be=E(ae),Ee=R(ae,be),Je=b(Ee,0),ze=G(te,ae,Ee);function Ge(fe){return G(W(B(fe,J,Je),j,K),ae,Ee)}function Le(fe){var Ae=(e(fe)-e(J)*e(Je))/(r(J)*r(Je));return Ae<-1?D.PolarException.MIDNIGHT_SUN:Ae>1?D.PolarException.POLAR_NIGHT:D.PolarException.NORMAL}var de,$e,Be,we,Ie,je={solarNoon:m(ze),nadir:m(ze-.5),polarException:D.PolarException.NORMAL};for(de=0,$e=L.length;de<$e;de+=1)Ie=ze-((we=Ge((Be=L[de])[0]*a))-ze),je[Be[1]]=m(Ie),je[Be[2]]=m(we);return je.polarException=Le(L[0][0]*a),je},D.getMoonPosition=function(M,$,N){var j=a*-N,J=a*$,K=g(M),te=Z(K),ae=S(K,j)-te.ra,be=x(ae,J,te.dec);return be+=.017*a/i(be+10.26*a/(be+5.1*a)),{azimuth:w(ae,J,te.dec),altitude:be,distance:te.dist}},D.getMoonFraction=function(M){var $=g(M),N=P($),j=Z($),J=149598e3,K=o(e(N.dec)*e(j.dec)+r(N.dec)*r(j.dec)*r(N.ra-j.ra)),te=s(J*e(K),j.dist-J*r(K));return(1+r(te))/2},D},(Ube=kbe())!==void 0&&(Fbe.exports=Ube);const pE=CF(Rie.exports),gc={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};let Fk=class{constructor(e,r){this.direct=e,this.ambient=r}};function kAt(t,e,r,i,n,s){se(s.ambient.color,1,1,1),s.ambient.intensity=gc.global.ambient,se(s.direct.color,1,1,1),s.direct.intensity=gc.global.direct;const o=e[2],a=Te((Math.abs(o)-gc.local.altitude)/(gc.global.altitude-gc.local.altitude),0,1);let l;if(s.globalFactor=a,t!=null&&(l=pE.getTimes(t,e[1],e[0])),a<1){let c;if(t!=null)c=HAt(t,l,i);else{const u=_Ue(i);c={direct:{intensity:gc.local.directAtNoon*u.direct,color:Ue(1,1,1)},ambient:{intensity:gc.local.ambientAtNoon*u.ambient,color:Ue(1,1,1)},timeOfDay:"early afternoon"}}mi(s.ambient.color,c.ambient.color,s.ambient.color,a),s.ambient.intensity=Xt(c.ambient.intensity,s.ambient.intensity,a),mi(s.direct.color,c.direct.color,s.direct.color,a),s.direct.intensity=Xt(c.direct.intensity,s.direct.intensity,a),s.specularStrength=i==="rainy"||i==="snowy"||i==="foggy"?0:1,s.environmentStrength=i==="rainy"?.7:i==="snowy"||i==="foggy"?.75:1}s.noonFactor=t!=null?GAt(t,l):1,t!=null?UAt(t,e,r,s.direct.directionToLightSource):yUe(n,r,s.direct.directionToLightSource)}function yUe(t,e,r){e===at.Global?Se(aY,t.eye):se(aY,0,0,1),ce(lY,t.viewForward,-1);const i=I8(lY,aY),n=Math.max(i-2*cY,0),s=.85*n/(n+1),o=Math.max(cY,i-cY-s);Ch(Zbe,-o,t.viewRight),lt(r,lY,Zbe),ge(r,r,ce(qAt,t.viewRight,WAt)),Se(r,r)}function UAt(t,e,r,i){const n=jAt,s=af(BAt);if(r===at.Global)pE.getPosition(t,0,0,n),se(i,0,0,-1),_P(s,s,-n.azimuth),P7(s,s,-n.altitude),lt(i,i,s);else{const o=gc.planarDirection,a=o.globalAngles,l=e[2];let c=(Math.abs(l)-o.localAltitude)/(o.globalAltitude-o.localAltitude);c=Te(c,0,1),c<1?(pE.getPosition(t,e[1],e[0],n),n.azimuth=(1-c)*n.azimuth+c*a.azimuth,n.altitude=(1-c)*n.altitude+c*a.altitude):(n.azimuth=a.azimuth,n.altitude=a.altitude),se(i,0,-1,0),bP(s,s,-n.azimuth),_P(s,s,-n.altitude),lt(i,i,s)}}function zAt(t,e){if(e===at.Global)return!0;const r=gc.planarDirection;return Math.abs(t)<r.localAltitude}const VAt=Ue(.5773502691896258,-.5773502691896258,.5773502691896258);let vUe=class{constructor(){this.ambient={color:Ue(1,1,1),intensity:.55},this.direct={color:Ue(1,1,1),intensity:.55,directionToLightSource:qi(VAt)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}};const BAt=Me(),jAt={azimuth:0,altitude:0};function GAt(t,e){const r=t.valueOf();let i,n;e.polarException===pE.PolarException.MIDNIGHT_SUN?(i=r-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,n=i+432e6):e.polarException===pE.PolarException.POLAR_NIGHT?(i=r-2,n=r-1):(i=e.sunrise.valueOf(),n=e.sunset.valueOf());const s=i+(n-i)/2;return 1-Te(Math.abs(r-s)/432e5,0,1)}function _Ue(t){switch(t){case"disabled":case"sunny":case"cloudy":return new Fk(1,1);case"rainy":return new Fk(.4,1.2);case"snowy":return new Fk(.5,1.3);case"foggy":return new Fk(.2,1.6)}}function zbe(t,e){const r=(t[0]+t[1]+t[2])/3;t[0]+=(r-t[0])*e,t[1]+=(r-t[1])*e,t[2]+=(r-t[2])*e}const nY=Ue(.01,.01,.01),Oie=Ue(1,.6,.5),Aie=Ue(1,.98,.98),Vbe=Ue(1,1,1),sY=Ue(.8,.8,1),Pie=Ue(.8,.8,1),Mie=Ue(.98,.98,1),Bbe=Ue(1,1,1),oY=Nr(.01,gc.local.ambientAtNight),$ie=Nr(gc.local.directAtTwilight,gc.local.ambientAtTwilight),Iie=Nr(.9*gc.local.directAtNoon,gc.local.ambientAtNoon),jbe=Nr(gc.local.directAtNoon,gc.local.ambientAtNoon),Gbe=Iie,Hbe=Aie,qbe=Mie,Wbe=$ie,Xbe=Oie,Ybe=Pie;function HAt(t,e,r){const i=t.valueOf();let n,s;e.polarException===pE.PolarException.MIDNIGHT_SUN?(n=i-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,s=n+432e6):e.polarException===pE.PolarException.POLAR_NIGHT?(n=i-2,s=i-1):(n=e.sunrise.valueOf(),s=e.sunset.valueOf());const o=s-n,a=n+o/2,l=o/4,c=a-l,u=a+l,h=.06*o,f=n-h/2,m=n+h/2,g=s-h/2,y=s+h/2,_=Qe(),b=A(),w=A();let x="";if(i<f||i>y)Eo(_,oY),oe(b,nY),oe(w,sY),x="night";else if(i<m){const E=(i-f)/(m-f);ih(_,oY,$ie,E),mi(b,nY,Oie,E),mi(w,sY,Pie,E),x="sun rising"}else if(i<c){const E=(i-m)/(c-m);ih(_,$ie,Iie,E),mi(b,Oie,Aie,E),mi(w,Pie,Mie,E),x="early morning"}else if(i<a){const E=(i-c)/(a-c);ih(_,Iie,jbe,E),mi(b,Aie,Vbe,E),mi(w,Mie,Bbe,E),x="late morning"}else if(i<u){const E=(i-a)/(u-a);ih(_,jbe,Gbe,E),mi(b,Vbe,Hbe,E),mi(w,Bbe,qbe,E),x="early afternoon"}else if(i<g){const E=(i-u)/(g-u);ih(_,Gbe,Wbe,E),mi(b,Hbe,Xbe,E),mi(w,qbe,Ybe,E),x="late afternoon"}else if(i<y){const E=(i-g)/(y-g);ih(_,Wbe,oY,E),mi(b,Xbe,nY,E),mi(w,Ybe,sY,E),x="sun setting"}let S=0;switch(r){case"rainy":case"foggy":S=.8;break;case"snowy":S=.5}S>0&&(zbe(b,S),zbe(w,S));const C=_Ue(r);return{direct:{intensity:_[0]*C.direct,color:b},ambient:{intensity:_[1]*C.ambient,color:w},timeOfDay:x}}const Zbe=Me(),aY=A(),lY=A(),qAt=A(),cY=.25,WAt=.2;let Jf=class extends pn.EventedAccessor{constructor(){super(),this._referencePointUpdateDelay=200,this._referencePointUpdateInterval=3e3,this._referencePointUpdateDistThreshold=1e6,this._referencePosUpdateQuery=null,this._referencePosMapCoordsRequested=null,this._viewHandles=new Ri,this._preserveAbsoluteDateTime=!1,this._trackingEnabled=!1,this._referencePosResetPreserveAbsoluteTime=!1,this._referencePosUpdateTimer=null,this._referencePosMapCoords=null,this._mainLight=new OB,this._ambientLight=new Yde,this._moonLight=new P6e,this.disableQueries=!1,this._disableWeather=!1,this._renderer=null,this._referencePosWGS84Comparable=null,this._resetReferencePosition()}destroy(){this.disconnectView(),this._viewHandles.destroy()}get _view(){var e;return(e=this._renderer)==null?void 0:e.view}get updating(){var e;return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!((e=this._renderer)!=null&&e.updating))}get weatherEnabled(){var e,r,i;return((e=this._view)==null?void 0:e.environment.atmosphereEnabled)&&!this._disableWeather&&((i=(r=this._view)==null?void 0:r.state)==null?void 0:i.viewingMode)===at.Global&&pP(this._view.spatialReference)}get weatherVisible(){var e;return this.weatherEnabled&&((e=this._renderer)==null?void 0:e.weatherVisible)}get referencePositionWGS84Comparable(){return this._referencePosWGS84Comparable}connectView(e){if(this._renderer)return;this._renderer=new Ha({view:e});const r=()=>this._updateRenderParameters(),i=()=>this._cameraHandler();this._viewHandles.add([pe(()=>e.environment.lighting,n=>this._updateLightingHandler(n),li),pe(()=>e.environment.lighting.type!=="virtual"?e.environment.lighting.date:null,n=>this._lightingDateHandler(n),li),pe(()=>e.stationary,()=>this._interactingStationaryHandler()),pe(()=>e.environment.lighting.directShadowsEnabled,r,li),pe(()=>e.qualitySettings.ambientOcclusion,r,li),pe(()=>e.qualitySettings.reflections,r,li),pe(()=>{var n;return(n=e.environment.background)==null?void 0:n.color},r,li),pe(()=>e.spatialReference,()=>this._resetReferencePosition(!0),li),pe(()=>e.environment.weather.type,()=>this._updateLighting(null,$A.Faded),li),pe(()=>this.weatherEnabled,()=>this._updateLighting(null,$A.Faded),li),pe(()=>e.viewingMode,()=>this._resetReferencePosition(!0),Bi),pe(()=>e.environment.lighting.type!=="virtual"&&e.environment.lighting.cameraTrackingEnabled,n=>this._updateCameraTracking(n),Bi),pe(()=>e.state.camera,i,Bi),pe(()=>this.disableQueries,i)]),this._updateRenderParameters(),this._updateLighting(),this._cameraHandler(),this.notifyChange("updating")}disconnectView(){this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer=qe(this._renderer)}_updateLightingHandler(e){this._updateCameraTracking(e.type!=="virtual"&&e.cameraTrackingEnabled),this._lightingDateHandler(e.type!=="virtual"?e.date:null),this._updateRenderParameters()}_updateCameraTracking(e){if(this._trackingEnabled=e,e)this._cameraHandler();else{const r=this._view.environment.lighting;(r==null?void 0:r.type)!=="virtual"&&(r.positionTimezoneInfo.autoUpdated=!1)}}_lightingDateHandler(e){const r=this._view.environment.lighting;if((r==null?void 0:r.type)!=="virtual"){if(e){if(!r.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;const i=this._view.spatialReference;if(!Kw(i)){const n=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(n))return void this._requestReferencePositionUpdate(n)}if(this._preupdateTracking(e),this._referencePosWGS84Comparable!=null){const n=D_e(this._referencePosWGS84Comparable,Jbe);n!=null&&(r.autoUpdate(null,n),this._trackingEnabled&&(r.positionTimezoneInfo.autoUpdated=!0))}}this._updateLighting(e)}}else this._updateLighting()}_preupdateTracking(e){!this._trackingEnabled&&this._view.environment.lighting.type!=="virtual"&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(e)}_cameraHandler(e=null){const r=this._view;if(!r.ready)return;const i=r.stateManager.camera;i&&(this._cameraHandlerClientSide(i,e)||this._cameraHandlerServerSide(i))}_cameraHandlerClientSide(e,r){const i=pP(this._view.spatialReference);if(i&&!Kw(this._view.spatialReference))return this._view.environment.lighting.type==="virtual"&&this._updateLighting(),!1;const n=e.position;return this._referencePosWGS84Comparable==null&&(this._referencePosWGS84Comparable=A()),i?TDe(n,this._referencePosWGS84Comparable):se(this._referencePosWGS84Comparable,n.longitude??0,n.latitude??0,n.z??0),this.notifyChange("referencePositionWGS84Comparable"),this._autoUpdateTimezone(this._referencePosWGS84Comparable,r)||this._updateLighting(r),!0}_cameraHandlerServerSide(e){const r=e.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(r))&&this._requestReferencePositionUpdate(r,!0),this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(r.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())}_interactingStationaryHandler(){this._view.stationary&&this._executePendingReferencePositionUpdate()}_updateLighting(e,r=$A.Immediate){const i=this._view;e=e||(i.environment.lighting.type==="virtual"?null:i.environment.lighting.date);const n=this._referencePosWGS84Comparable,s=n!=null?XAt:YAt,o=this.weatherVisible?i.environment.weather.type:"disabled";n!=null?kAt(e,n,i.state.viewingMode,o,i.state.camera,s):i.environment.lighting.type==="virtual"&&yUe(i.state.camera,i.state.viewingMode,s.direct.directionToLightSource);const a=this._mainLight,l=s.direct;ce(a.intensity,l.color,l.intensity*Math.PI),oe(a.direction,l.directionToLightSource),a.specularStrength=s.specularStrength,a.environmentStrength=s.environmentStrength;const c=this._ambientLight;ce(c.intensity,s.ambient.color,s.ambient.intensity);const u=this._moonLight;mi(u.intensity,JAt,KAt,s.globalFactor);const h=(1-.5*s.globalFactor)*(1-.4*s.noonFactor*(1-s.globalFactor));ce(u.intensity,u.intensity,h),oe(u.direction,l.directionToLightSource),this._renderer.updateLightSources([a,c,u],s.noonFactor,s.globalFactor,r),this._updateRenderParameters()}_autoUpdateTimezone(e,r=null){if(this._view.environment.lighting.type==="virtual"||!this._view.environment.lighting.cameraTrackingEnabled||e==null)return!1;const i=ZAt;i.setTime((r||this._view.environment.lighting.date).getTime());const n=D_e(e,Jbe);if(n==null)return!1;let s=this._view.environment.lighting.positionTimezoneInfo;if(s.autoUpdated){if(s.hours===n.hours&&s.minutes===n.minutes&&s.seconds===n.seconds)return!1}else s=n;const o=i.getUTCHours()-(n.hours-s.hours),a=i.getUTCMinutes()-(n.minutes-s.minutes),l=i.getUTCSeconds()-(n.seconds-s.seconds);return i.setUTCHours(o),i.setUTCMinutes(a),i.setUTCSeconds(l),!r&&this._view.environment.lighting.autoUpdate(i,n)}_updateRenderParameters(){const e=this._view._stage;if(!e)return;const r=this._referencePosWGS84Comparable==null||zAt(this._referencePosWGS84Comparable[2],this._view.state.viewingMode),i=this._view.environment.background,n=i instanceof lNe?{type:"color",color:tde(ht.toUnitRGBA(i.color))}:{type:"color",color:nr(0,0,0,1)};e.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&r,background:n,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible,qualitySettings:this._view.qualitySettings})}_resetReferencePosition(e=!1){this._cancelReferencePosUpdates(),this._referencePosMapCoords=null,this._referencePosMapCoordsRequested=null,this._referencePosResetPreserveAbsoluteTime=null,this._referencePosWGS84Comparable=null,this.notifyChange("updating"),e&&this._cameraHandler()}_requestReferencePositionUpdate(e,r=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(e):this._referencePosMapCoordsRequested=e.clone(),this._referencePosResetPreserveAbsoluteTime=!!r,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const i=this._referencePosUpdateQuery=gN(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===i){const s=()=>this._referencePosUpdateQuery!==i;return this._doReferencePositionUpdateQuery(s)}}).catch(s=>{s.name==="mapcoordshelper:missing-geometry-service"&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===i&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),n=this._referencePosUpdateTimer=gN(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===n&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}}async _doReferencePositionUpdateQuery(e){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1),this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone(),this._referencePosResetPreserveAbsoluteTime=null,this._referencePosMapCoordsRequested=null;const r=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);if(!e()&&!isNaN(r[0])&&!isNaN(r[1])){const i=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters;this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=r[0],this._referencePosWGS84Comparable[1]=r[1],this._referencePosWGS84Comparable[2]=i):this._referencePosWGS84Comparable=[r[0],r[1],i],this._referencePosChanged()}}_executePendingReferencePositionUpdate(){const e=this._referencePosMapCoordsRequested;e&&this._requestReferencePositionUpdate(e,this._referencePosResetPreserveAbsoluteTime)}_referencePosChanged(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting(),this.notifyChange("referencePositionWGS84Comparable")}_exceedsReferencePosDistThreshold(e){if(this._referencePosMapCoords){let r=this._referencePosMapCoords.distance(e);return this._view.mapCoordsHelper&&(r*=this._view.mapCoordsHelper.unitInMeters),r>this._referencePointUpdateDistThreshold}return!0}_cancelReferencePosUpdates(){const e=!!this._referencePosUpdateQuery;return this._referencePosUpdateQuery=null,this._referencePosUpdateTimer=null,e}get test(){const e=this;return{get renderer(){return e._renderer},set referencePointUpdateInterval(r){e._referencePointUpdateInterval=r},set referencePointUpdateDistThreshold(r){e._referencePointUpdateDistThreshold=r},set referencePosUpdateTimer(r){e._referencePosUpdateTimer=r},set referencePointUpdateDelay(r){e._referencePointUpdateDelay=r},set disableWeather(r){e._disableWeather=r}}}};d([p({type:Boolean,readOnly:!0})],Jf.prototype,"updating",null),d([p()],Jf.prototype,"disableQueries",void 0),d([p()],Jf.prototype,"_disableWeather",void 0),d([p()],Jf.prototype,"weatherEnabled",null),d([p()],Jf.prototype,"weatherVisible",null),d([p()],Jf.prototype,"referencePositionWGS84Comparable",null),d([p()],Jf.prototype,"_renderer",void 0),d([p()],Jf.prototype,"_referencePosWGS84Comparable",void 0),Jf=d([I("esri.views.3d.environment.SceneViewEnvironmentManager")],Jf);const XAt=new vUe,YAt=new vUe,ZAt=new Date,Jbe={hours:0,minutes:0,seconds:0},JAt=Ue(.22,.22,.33),KAt=Ue(.22,.22,.22);var un;(function(t){t[t.NONE=0]="NONE",t[t.TILT=1]="TILT",t[t.ALTITUDE=2]="ALTITUDE",t[t.DISTANCE=4]="DISTANCE",t[t.COLLISION=8]="COLLISION",t[t.ALL=15]="ALL",t[t.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(un||(un={}));var xr;(function(t){t[t.NONE=0]="NONE",t[t.ZOOM=1]="ZOOM",t[t.TUMBLE=2]="TUMBLE",t[t.LOOK_AROUND=3]="LOOK_AROUND",t[t.PAN=4]="PAN",t[t.ASCEND=5]="ASCEND"})(xr||(xr={}));var ha;(function(t){t[t.TUMBLE=0]="TUMBLE",t[t.LOOK_AROUND=1]="LOOK_AROUND"})(ha||(ha={}));function GN(t,e){return(t&e)!=0}function DB(t,e,r,i,n,s){t!==0&&(r?(s.min=Math.min(s.min,e),s.max=Math.max(s.max,e)):i!=null?(s.min-=Math.max(0,(e-s.min)*(1-i)),s.max+=Math.max(0,(e-s.max)*(1-i))):n&&(s.min-=Math.max(0,e-s.min-n),s.max+=Math.max(0,e-s.max-n)))}const dx={selection:un.NONE,interactionType:xr.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ha.TUMBLE};function bUe(t,e,r,i){return e=e||t.viewForward,oe(i,e),ce(i,i,Math.sign(ye(e,r))),i}function QAt(t,e,r,i){return nPt(t,e,r,rPt(i,e,r,!0))}function ePt(t,e,r,i){const n=ye(r,ve(t,i,e));return ge(t,e,ce(t,r,n))}const tPt={dir:A(),len:0,clip:Qe()};function rPt(t,e,r,i){const n=tPt;return t?(r&&i&&(n.len=Li(e,r)),oe(n.dir,t)):i?(n.len=Li(e,r),ve(n.dir,r,e),ce(n.dir,n.dir,1/n.len)):(ve(n.dir,r,e),Se(n.dir,n.dir)),n}function iPt(t,e,r){const i=ye(t,r.dir),n=-zi(t,e);if(n<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return n>0;if((n<0||i<0)&&!(n<0&&i<0))return!0;const s=n/i;return i>0?s<r.clip[1]&&(r.clip[1]=s):s>r.clip[0]&&(r.clip[0]=s),r.clip[0]<=r.clip[1]}function nPt(t,e,r,i){i.clip[0]=0,i.clip[1]=r?i.len:Number.MAX_VALUE;for(let n=0;n<t.length;n++)if(!iPt(t[n],e,i))return!1;return!0}function sPt(t,e,r=dx){const i=ahe(t,e,r);if(i===0)return!1;const n=t.renderCoordsHelper,s=n.getAltitude(e.eye)+i,o=bUe(e,r.interactionDirection,lPt(t,e,Math.sign(i),hPt),dPt),a=oe(pPt,e.viewForward),l=n.intersectInfiniteManifold(Ah(e.eye,o),s,uY);return e.eye=l??n.setAltitude(uY,s,e.eye),e.center=ePt(uY,e.eye,a,e.center),!0}function ahe(t,e,r=dx){if(!oPt(t,r)||!t.state.constraints.altitude)return 0;const i=cPt(t.state.constraints.altitude,uPt);aPt(t,r,i);const n=t.renderCoordsHelper.getAltitude(e.eye),s=Te(n,i.min,i.max)-n;return Math.abs(s)<=1e-6?0:s}function oPt(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(e.interactionType!==xr.TUMBLE||!GN(e.selection,un.TILT))}function aPt(t,e,r){const i=e.interactionType;if(i===xr.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===xr.TUMBLE||i===xr.ZOOM,c=ahe(t,o),u=c===0?0:t.renderCoordsHelper.getAltitude(o.eye);r.min=n,r.max=s,DB(c,u,l,a,.05*u,r)}function lPt(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),ce(i,i,r),i}function cPt(t,e){return e.min=t.min,e.max=t.max,e}const uPt={min:0,max:0},dPt=A(),hPt=A(),pPt=A(),uY=A();function lhe(t,e,r=dx){if(!t.state.isLocal)return 0;const i=t.state.constraints.distance;if(!t.pointsOfInterest.surfaceOrigin.renderLocation||i===1/0)return 0;kk.min=0,kk.max=i,mPt(t,r,kk);const n=che(t,e),s=kk.max-n;return s>=-1e-6?0:s}function fPt(t,e,r=dx){const i=lhe(t,e,r);if(i===0)return!1;const n=t.pointsOfInterest.surfaceOrigin;if(!n.renderLocation)return!1;const s=che(t,e)+i,o=oe(yPt,e.eye),a=bUe(e,r.interactionDirection,gPt(e,n.renderLocation,bPt),_Pt);if(!Cx(VFe(n.renderLocation,s),Ah(e.eye,a),Uk))return!1;e.eye=Uk;const l=ve(vPt,e.eye,o);e.center=ge(Uk,e.center,l);const c=t.renderCoordsHelper.getAltitude(e.center),u=t.renderCoordsHelper.intersectInfiniteManifold(e.ray,c,Uk);return u!=null&&(e.center=u),!0}function mPt(t,e,r){const i=e.interactionType;if(i===xr.NONE)return;const{min:n,max:s}=r,{interactionStartCamera:o,interactionFactor:a}=e;if(!o)return;const l=i===xr.ZOOM||i===xr.PAN,c=lhe(t,o),u=c===0?0:che(t,o);r.min=n,r.max=s,DB(c,u,l,a,.05*u,r)}function che(t,e){const r=t.pointsOfInterest.surfaceOrigin;return r.renderLocation?Li(e.eye,r.renderLocation):0}function gPt(t,e,r){return H_(r,t.eye,e)}const kk={min:0,max:0},yPt=A(),vPt=A(),_Pt=A(),bPt=A(),Uk=A();function X3(t,e,r=Bp.EYE){const i=t.state.constraints;if(!i.collision.enabled)return!1;const n=uH(t,e.eye),s=t.renderCoordsHelper.getAltitude(e.eye),o=n+i.collision.elevationMargin;if(s>=o)return!1;const a=We(e.eye);if(ve(zk,e.center,e.eye),e.eye=t.renderCoordsHelper.setAltitude(wPt,o,e.eye),r===Bp.EYE_AND_CENTER)e.center=ge(zk,e.eye,zk);else if(r===Bp.EYE_AND_CENTER_SCALE){const l=(a-s+o)/a;e.center=ce(zk,e.center,l)}return!0}var Bp;(function(t){t[t.EYE=0]="EYE",t[t.EYE_AND_CENTER=1]="EYE_AND_CENTER",t[t.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(Bp||(Bp={}));const zk=A(),wPt=A();function hx(t,e,r){t.worldUpAtPosition(e,Kbe),ve(dY,r,e);const i=We(dY);return i===0?0:Vo(ye(dY,Kbe)/i)}const Kbe=A(),dY=A();function wUe(t,e,r=dx,i=!0){YM.eyeCenterDistance=0,YM.requiresTwoSteps=!1;const n=uhe(t,e,r,void 0,YM);if(n===0)return!1;switch(Ch(Vk,-n,e.viewRight),r.tiltMode){case ha.LOOK_AROUND:lt(R1,e.viewForward,Vk),ce(R1,R1,YM.eyeCenterDistance),e.center=ge(tw,e.eye,R1);break;case ha.TUMBLE:ve(R1,e.center,e.eye),lt(R1,R1,Vk),e.eye=ve(tw,e.center,R1);break;default:r.tiltMode}return e.up=lt(tw,e.up,Vk),!YM.requiresTwoSteps||!i||wUe(t,e,r,!1)}function uhe(t,e,r=dx,i=dx,n){if(!t.state.constraints.tilt)return 0;const s=e.distance,o=t.state.constraints.tilt(s,MPt);return PPt(t,r,o),i.interactionType===xr.TUMBLE&&GN(i.selection,un.ALTITUDE)&&xUe(t,i.interactionStartCamera,o),r.tiltMode===ha.LOOK_AROUND||i.tiltMode===ha.LOOK_AROUND?SPt(t,e,o,n):xPt(t,e,o)}function xPt(t,e,r){const i=hx(t.renderCoordsHelper,e.center,e.eye),n=i-Te(i,r.min,r.max);return HN(n)?n:0}function SPt(t,e,r,i){switch(i&&(i.requiresTwoSteps=!1),t.viewingMode){case"global":return EPt(t,e,r,i);case"local":return TPt(t,e,r,i)}}function TPt(t,e,r,i){const n=hx(t.renderCoordsHelper,e.center,e.eye),s=Te(n,r.min,r.max),o=n-s;if(!HN(o))return 0;if(i){const a=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,l=t.renderCoordsHelper.getAltitude(e.eye)-a,c=Math.cos(s);Math.abs(c)>1e-4?i.eyeCenterDistance=l/c:i.eyeCenterDistance=e.distance}return o}function EPt(t,e,r,i){const n=CPt(t,e,$Pt),s=Te(n.tiltAtCenter,r.min,r.max);if(!HN(n.tiltAtCenter-s))return 0;let o,a;return n.centerIsOnSurface?(o=RPt(n),a=OPt(n,o)):(o=n.constraints.clampTilt(n.eyeCenterDistance,n.tiltAtCenter),i&&o<Math.PI/2&&(i.requiresTwoSteps=!0,o=Math.PI/2-1e-5),a=APt(n,o)),i&&(i.eyeCenterDistance=Lie(n,o)),a}function CPt(t,e,r){const i=t.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,n=i+Xr(t.spatialReference).radius,s=t.renderCoordsHelper.intersectManifold(e.ray,i,tw);return r.eyeCenterDistance=e.distance,r.centerIsOnSurface=!1,s!=null?(r.eyeCenterDistance=Li(e.eye,s),r.tiltAtCenter=hx(t.renderCoordsHelper,s,e.eye),r.centerIsOnSurface=!0):t.state.isLocal?r.tiltAtCenter=hx(t.renderCoordsHelper,e.center,e.eye):(V3(eH(tH,n),e.ray,tw),r.eyeCenterDistance=Li(e.eye,tw),r.tiltAtCenter=Vo(-ye(e.viewForward,Se(tw,tw)))),r.radius=n,r.eyeRadius=We(e.eye),r.constraints=t.state.constraints,r}function HN(t){return Math.abs(t)>1e-9}function RPt(t){const{constraints:e,eyeCenterDistance:r,tiltAtCenter:i}=t;let n=i,s=e.clampTilt(r,i);const o=Lie(t,s);if(e.clampTilt(o,i)===s)return s;let a=0;for(;a<10&&HN(s-n);){const l=(n+s)/2,c=Lie(t,l);HN(e.clampTilt(c,l)-l)?n=l:s=l,a++}return s}function Lie(t,e){if(!t.centerIsOnSurface)return t.eyeCenterDistance;const r=Math.PI-Te(e,0,Math.PI),i=sf(t.radius/t.eyeRadius*Math.sin(r)),n=Math.PI-r-i,s=Math.sin(n)/Math.sin(r);if(t.eyeRadius<t.radius&&s>1){const o=Math.PI-i,a=Math.PI-r-o;return Math.sin(a)/Math.sin(r)*t.eyeRadius}return s*t.eyeRadius}function OPt(t,e){const r=sf(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter)),i=sf(t.radius/t.eyeRadius*Math.sin(e));return t.eyeRadius>t.radius?r-i:i-r}function APt(t,e){return t.tiltAtCenter-Math.PI/2-(e-Math.PI/2)}function PPt(t,e,r){if(e.interactionType===xr.NONE)return;const{interactionStartCamera:i,interactionFactor:n}=e;if(!i)return;const{min:s,max:o}=r,a=uhe(t,i,dx,e),l=a===0?0:hx(t.renderCoordsHelper,i.center,i.eye);r.min=s,r.max=o,e.interactionType===xr.TUMBLE?(GN(e.selection,un.ALTITUDE)&&xUe(t,i,r),DB(a,l,!0,n,Qbe,r)):DB(a,l,!1,n,Qbe,r)}function xUe(t,e,r){const i=t.state.constraints;if(t.state.isLocal||!i.altitude||!e)return;const n=Al(e.center),s=Math.sqrt(n),o=e.distance,a=Xr(t.spatialReference).radius,l=i.altitude.min+a,c=i.altitude.max+a,u=(l*l-o*o-n)/(-2*s*o),h=(c*c-o*o-n)/(-2*s*o);r.min=Math.max(r.min,Math.min(Math.PI-Vo(h),r.max)),r.max=Math.min(r.max,Math.PI-Vo(u))}const R1=A(),Vk=Me(),tw=A(),Qbe=sr(5),MPt={min:0,max:0},$Pt={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},YM={eyeCenterDistance:0,requiresTwoSteps:!1};function IPt(t){return t}const PH=t=>t*t,dhe=t=>1-PH(1-t),LPt=t=>t<.5?PH(2*t)/2:(dhe(2*(t-.5))+1)/2,hhe=t=>t*t*t,SUe=t=>1-hhe(1-t),TUe=t=>t<.5?hhe(2*t)/2:(SUe(2*(t-.5))+1)/2,phe=t=>t*t*t*t,EUe=t=>1-phe(1-t),DPt=t=>t<.5?phe(2*t)/2:(EUe(2*(t-.5))+1)/2,fhe=t=>t*t*t*t*t,CUe=t=>1-fhe(1-t),NPt=t=>t<.5?fhe(2*t)/2:(CUe(2*(t-.5))+1)/2,mhe=t=>1-Math.cos(t*Math.PI/2),RUe=t=>1-mhe(1-t),FPt=t=>t<.5?mhe(2*t)/2:(RUe(2*(t-.5))+1)/2,ghe=t=>2**(10*(t-1)),RF=t=>1-ghe(1-t),kPt=t=>t<.5?ghe(2*t)/2:(RF(2*(t-.5))+1)/2,yhe=t=>-(Math.sqrt(1-t*t)-1),OUe=t=>1-yhe(1-t),UPt=t=>t<.5?yhe(2*t)/2:(OUe(2*(t-.5))+1)/2;function Sf(t){const e=2*(t-Math.sqrt((t-1)*t)),r=e/2/t;return i=>i<r?t*i*i:e*i-e+1}function Tf(t,e){return(r,i)=>r<e?e*t(r/e,i):1-t((1-r)/(1-e),i)*(1-e)}const zPt=Tf(Sf(1),1),VPt=Tf(Sf(1),0),AUe=Tf(Sf(1),.5),BPt=Tf(Sf(2),1),jPt=Tf(Sf(2),0),GPt=Tf(Sf(2),.5),HPt=Tf(Sf(3),1),qPt=Tf(Sf(3),0),WPt=Tf(Sf(3),.5),XPt=Tf(Sf(4),1),YPt=Tf(Sf(4),0),ZPt=Tf(Sf(4),.5),JPt={linear:IPt,"in-quad":PH,"out-quad":dhe,"in-out-quad":LPt,"in-coast-quad":zPt,"out-coast-quad":VPt,"in-out-coast-quad":AUe,"in-cubic":hhe,"out-cubic":SUe,"in-out-cubic":TUe,"in-coast-cubic":BPt,"out-coast-cubic":jPt,"in-out-coast-cubic":GPt,"in-quart":phe,"out-quart":EUe,"in-out-quart":DPt,"in-coast-quart":HPt,"out-coast-quart":qPt,"in-out-coast-quart":WPt,"in-quint":fhe,"out-quint":CUe,"in-out-quint":NPt,"in-coast-quint":XPt,"out-coast-quint":YPt,"in-out-coast-quint":ZPt,"in-sine":mhe,"out-sine":RUe,"in-out-sine":FPt,"in-expo":ghe,"out-expo":RF,"in-out-expo":kPt,"in-circ":yhe,"out-circ":OUe,"in-out-circ":UPt};function ws(t,e,r=t3t,i=e){i!==e&&i.copyFrom(e),i.computeUp(t.state.viewingMode);let n=!1;for(let a=0;a<r3t;a++){let l=0;for(const c of e3t)if(GN(r.selection,c.type)){const u=Math.abs(c.error(t,i,r));c.apply(t,i,r)&&(n=!0,l+=u)}if(l===0)break}const s=GN(r.selection,un.COLLISION),o=KPt(r.interactionType,t);return s&&X3(t,i,o)&&(n=!0),n&&i.computeUp(t.state.viewingMode),n}function KPt(t,e){switch(t){case xr.PAN:return Bp.EYE_AND_CENTER;case xr.ASCEND:return e.state.isGlobal?Bp.EYE_AND_CENTER_SCALE:Bp.EYE_AND_CENTER;default:return Bp.EYE}}function Rm(t){const e=Math.min(1,t/150);return TUe(e)}function QPt(t,e,r){return uhe(t,e,r)*e.distance}const e3t=[{type:un.TILT,error:QPt,apply:wUe},{type:un.ALTITUDE,error:ahe,apply:sPt},{type:un.DISTANCE,error:lhe,apply:fPt}],t3t={selection:un.ALL,interactionType:xr.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ha.TUMBLE},r3t=5,Md=A(),wu=A(),O1=A(),fl=A(),Xx=A(),i3t=A(),$d={upward:Ue(0,0,1),forward:Ue(0,1,0),sideway:Ue(1,0,0)},ewe=vn();let twe=class{constructor(e=at.Global){this.viewingMode=e,this.center=A(),this.pitch=0,this.yaw=0,this.distance=0,this.lookAtDirection=qi($d.forward)}pixelsPerPanAtZoom(e){return this.size/2/(this._zoomToPanScale*e)}zoomAtPixelsPerPan(e){return this.size/2/(this._zoomToPanScale*e)}pixelsPerRotateAtZoom(){const e=Math.max(Math.cos(Math.abs(this.pitch)),.5);return this.size/2/e}compareTo(e,r){if(r||(r={pan:0,rotate:0,sourceZoom:0,targetZoom:0}),this.viewingMode===at.Global){const s=(We(this.center)+We(e.center))/2;r.pan=I8(this.center,e.center)*s}else r.pan=Li(this.center,e.center);let i=Math.abs(e.yaw-this.yaw);i>=Math.PI&&(i=2*Math.PI-i);const n=Math.abs(e.pitch-this.pitch);return r.rotate=Math.max(i,n),r.sourceZoom=this.distance,r.targetZoom=e.distance,r}interpolate(e,r,i){this.viewingMode===at.Global?pvt(e.center,r.center,i.pan,this.center):mi(this.center,e.center,r.center,i.pan),this.distance=isFinite(r.distance)?Xt(e.distance,r.distance,i.zoom):e.distance,this.pitch=Xt(e.pitch,r.pitch,i.rotate);let n=e.yaw;const s=r.yaw;Math.abs(s-n)>=Math.PI&&(n+=2*(n<s?1:-1)*Math.PI),this.yaw=Xt(n,s,i.rotate)}copyFrom(e){oe(this.center,e.center),this.pitch=e.pitch,this.yaw=e.yaw,this.distance=e.distance,oe(this.lookAtDirection,e.lookAtDirection),this.size=e.size,this.copyFromCommon(e),this.viewingMode=e.viewingMode}copyFromRenderCamera(e){const r=this._lookAtOrientation(e.center,ewe);oe(this.center,e.center),ve(fl,e.center,e.eye),nd(fl,fl,r),nd(Xx,e.up,r),this.distance=We(fl),this.distance!==0&&(fl[0]/=this.distance,fl[1]/=this.distance,fl[2]/=this.distance),this.pitch=this._eyeUpToPitch(fl),this.yaw=this._eyeUpToYaw(fl,Xx),this.size=Math.sqrt(e.width*e.width+e.height*e.height),this.copyFromCommon(e)}copyFromCommon(e){this.fov=e.fov,this._zoomToPanScale=Math.atan(.5*this.fov)}copyToRenderCamera(e){const r=this._lookAtOrientation(this.center,ewe);df(r,r),this._axisAngleVec3($d.sideway,this.pitch-Math.PI/2,$d.forward,fl),this._axisAngleVec3($d.upward,this.yaw,fl),this._axisAngleVec3($d.sideway,this.pitch-Math.PI/2,$d.upward,Xx),this._axisAngleVec3($d.upward,this.yaw,Xx),ce(fl,fl,this.distance),nd(fl,fl,r),nd(Xx,Xx,r),e.center=this.center,e.eye=ve(fl,this.center,fl),e.up=Xx}_axisAngleVec3(e,r,i,n=i){const s=Math.cos(r),o=Math.sin(r);return ce(Md,i,s),Lt(wu,e,i),ce(wu,wu,o),ce(O1,e,(1-s)*ye(e,i)),ge(n,ge(n,Md,wu),O1)}_lookAtOrientation(e,r=vn()){return this._upAtLookAt(e,O1),Lt(Md,this.lookAtDirection,O1),Se(Md,Md),Md[0]===0&&Md[1]===0&&Md[2]===0&&oe(Md,$d.sideway),Lt(wu,O1,Md),Se(wu,wu),r[0]=Md[0],r[1]=wu[0],r[2]=O1[0],r[3]=Md[1],r[4]=wu[1],r[5]=O1[1],r[6]=Md[2],r[7]=wu[2],r[8]=O1[2],r}_upAtLookAt(e,r){return this.viewingMode===at.Local?oe(r,$d.upward):Se(r,e)}_eyeUpToPitch(e){return Math.PI-I8($d.upward,e)}_eyeUpToYaw(e,r){const i=i3t;return Math.abs(r[2])<.5?(oe(i,r),e[2]>0&&ce(i,i,-1)):oe(i,e),Lt(wu,i,$d.upward),Se(wu,wu),I8($d.sideway,wu,$d.upward)}};const NB={desiredScreenFlow:2,minDuration:500,maxDuration:8e3};let n3t=class PUe{constructor(e){this._createCamera=e,this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0},this.settings={desiredScreenFlow:NB.desiredScreenFlow},this.source=e(),this.target=e()}clone(){const e=new PUe(this._createCamera);return e.copyFrom(this),e}copyFrom(e){this.update(e.source,e.target,e.settings)}update(e,r,i){this.source!==e&&this.source.copyFrom(e),this.target!==r&&this.target.copyFrom(r),this.compared=this.source.compareTo(this.target,this.compared),this.settings.desiredScreenFlow=i.desiredScreenFlow!=null?i.desiredScreenFlow:NB.desiredScreenFlow,this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size,this.halfWindowSize=this.target.size/2}halfWindowPanAtZoom(e){const r=this.target.pixelsPerPanAtZoom(e);return this.halfWindowSize/r}get hasZoom(){return Math.abs(this.compared.sourceZoom-this.compared.targetZoom)>1e-5}get hasPan(){return this.compared.pan>1e-9}get hasRotate(){return this.compared.rotate>1e-9}},s3t=class{constructor(){this.segments=[]}get time(){return this.segments.reduce((e,r)=>e+r.time,0)}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1),e*=this.time;let i=0,n=0;const s=this.definition;for(let o=0;o<this.segments.length;o++){const a=this.segments[o],l=a.definition;if(e<=a.time||o===this.segments.length-1){if(r=this.segmentInterpolateComponentsAt(a,a.time===0?0:e/a.time,r),s.hasPan&&!isNaN(r.pan)&&isFinite(s.compared.pan)?r.pan=(i+l.compared.pan*r.pan)/s.compared.pan:r.pan=1,s.hasRotate&&!isNaN(r.rotate)&&isFinite(s.compared.rotate)?r.rotate=(n+l.compared.rotate*r.rotate)/s.compared.rotate:r.rotate=1,s.hasZoom&&!isNaN(r.zoom)&&isFinite(l.compared.targetZoom)){const c=r.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,u=this.segments[0].definition.compared.sourceZoom,h=this.segments[this.segments.length-1].definition.compared.targetZoom;r.zoom=(c-u)/(h-u)}else r.zoom=1;return r}e-=a.time,i+=l.compared.pan,n+=l.compared.rotate}}segmentInterpolateComponentsAt(e,r,i){return e.interpolateComponentsAt(r,i)}},hY=class{get time(){return this._time}constructor(e){e&&this.update(e)}update(e){e&&(this.definition?this.definition.copyFrom(e):this.definition=e.clone()),this._updatePrecomputedVariables(),this._updatePixelFlow()}_updatePrecomputedVariables(){const e=this.definition,r=e.compared,i=r.sourceZoom,n=r.targetZoom;this._zoomSign=i>n?1:-1,this._panPixelsAtSource=r.pan*e.source.pixelsPerPanAtZoom(i);const s=(e.source.pixelsPerRotateAtZoom(i)+e.target.pixelsPerRotateAtZoom(n))/2;this._rotatePixels=r.rotate*s}_updatePixelFlow(){const e=this.definition.compared.sourceZoom,r=this.definition.compared.targetZoom,{hasZoom:i,hasPan:n,hasRotate:s}=this.definition;let o=0,a=0;i&&(n&&(o=(r/e-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),s&&(a=this._zoomSign*(Math.log(e/r)/Math.LN2)*this.definition.halfWindowSize/this._rotatePixels)),this._zoomPixelFlow=0,this._panPixelFlow=0,this._rotatePixelFlow=0;const l=this.definition.desiredPixelFlow;if(i&&n&&s){const c=o+a+o*a;this._zoomPixelFlow=o*a/c*l,this._panPixelFlow=a/c*l,this._rotatePixelFlow=o/c*l}else if(i&&n){const c=1+o;this._zoomPixelFlow=o/c*l,this._panPixelFlow=1/c*l}else if(i&&s){const c=1+a;this._zoomPixelFlow=a/c*l,this._rotatePixelFlow=1/c*l}else if(n&&s){const c=this._panPixelsAtSource/this._rotatePixels,u=1+c;this._panPixelFlow=c/u*l,this._rotatePixelFlow=1/u*l}else n?this._panPixelFlow=l:i?this._zoomPixelFlow=l:s&&(this._rotatePixelFlow=l);this._time=s?this.rotateTime:i?this.zoomTime:n?this.panTime:0}get rotateTime(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}get zoomTime(){return this.definition.hasZoom?this._zoomSign*(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2)*this.definition.halfWindowSize/this._zoomPixelFlow:0}get panTime(){if(this.definition.hasPan){if(this.definition.hasZoom){const e=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2,r=e*this._panPixelsAtSource;return Math.log(r*(this._zoomPixelFlow/this._panPixelFlow)+1)/(e*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}_interpolateComponentsZoom(e){if(e===0||e===1)return e;if(this.definition.hasZoom){const r=this.definition.compared.sourceZoom,i=this.definition.compared.targetZoom;return(r*(r/i)**-e-r)/(i-r)}return e}_interpolateComponentsPan(e){if(e===0||e===1)return e;if(this.definition.hasPan&&this.definition.hasZoom){const r=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*(this._panPixelFlow*(2**(r*e*this._time)-1))/(r*Math.LN2)}return e}_interpolateComponentsRotate(e){return e}interpolateComponentsAt(e,r){e=Math.min(Math.max(e,0),1);const i=this._interpolateComponentsZoom(e),n=this._interpolateComponentsPan(e),s=this._interpolateComponentsRotate(e);return r?(r.zoom=i,r.pan=n,r.rotate=s):r={zoom:i,pan:n,rotate:s},r}};function o3t(t,e,r){const i=e-t.compared.sourceZoom,n=t.halfWindowPanAtZoom(i);return-t.halfWindowSize*(r.ascensionFactor*Math.LN2*t.compared.pan+n)*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2*n)}function a3t(t,e,r){const i=1/e,n=Math.log(t.compared.sourceZoom*i),s=1/t.desiredPixelFlow,o=1/Math.LN2,a=e-t.compared.sourceZoom,l=1/a,c=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(a))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*i*s*o*l*c-t.halfWindowSize*n*s*o*l+t.halfWindowSize*n*s*o*c/(a*a)}function l3t(t,e,r){const i=e-t.compared.sourceZoom,n=1/i,s=1/e,o=Math.log(t.compared.sourceZoom*s),a=(r.ascensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(i))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a+2*n*o+2*s-2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function c3t(t,e){return-t.halfWindowSize*Math.log(t.compared.sourceZoom/e)/(t.desiredPixelFlow*Math.LN2)}function u3t(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function d3t(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function h3t(t,e,r){return-t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e))}function p3t(t,e,r){return t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e))}function f3t(t,e,r){return-2*t.compared.pan*t.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(t.desiredPixelFlow*t.halfWindowPanAtZoom(e*e*e))}function m3t(t,e,r){return t.halfWindowSize*(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*t.halfWindowPanAtZoom(-e+t.compared.targetZoom))}function g3t(t,e,r){const i=Math.log(e/t.compared.targetZoom),n=1/t.desiredPixelFlow,s=1/Math.LN2,o=-e+t.compared.targetZoom,a=1/o,l=(-t.halfWindowPanAtZoom(e)-r.descensionFactor*Math.LN2*t.compared.pan+t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return-t.halfWindowSize*i*n*s*a+t.halfWindowSize*i*n*s*l/(o*o)+t.halfWindowSize*n*s*a*l/e}function y3t(t,e,r){const i=e-t.compared.targetZoom,n=1/i,s=1/e,o=Math.log(e/t.compared.targetZoom),a=(t.halfWindowPanAtZoom(e)+r.descensionFactor*Math.LN2*t.compared.pan-t.halfWindowPanAtZoom(t.compared.targetZoom))/t.halfWindowPanAtZoom(1);return t.halfWindowSize*n*(-2*n*s*a-2*n*o+2*s+2*o*a/(i*i)-a/(e*e))/(t.desiredPixelFlow*Math.LN2)}function v3t(t,e){return t.halfWindowSize*Math.log(e/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2)}function _3t(t,e){return t.halfWindowSize/(e*t.desiredPixelFlow*Math.LN2)}function b3t(t,e){return-t.halfWindowSize/(e*e*t.desiredPixelFlow*Math.LN2)}function w3t(t){const e=Math.LN2*t.compared.pan,r=t.compared.sourceZoom-t.compared.targetZoom,i=t.halfWindowPanAtZoom(r),n=t.halfWindowSize*Math.log(t.compared.sourceZoom/t.compared.targetZoom)/(t.desiredPixelFlow*Math.LN2*i);return t.compared.sourceZoom<=t.compared.targetZoom?n*(e-i):n*(e+i)}function x3t(t,e){let r=S3t(t,e);const i={ascensionFactor:e.ascensionFactor!=null?e.ascensionFactor:.5,descensionFactor:e.descensionFactor!=null?e.descensionFactor:.5},n=i.ascensionFactor===0,s=i.descensionFactor===0,o=n?c3t:o3t,a=n?u3t:a3t,l=n?d3t:l3t,c=s?v3t:m3t,u=s?_3t:g3t,h=s?b3t:y3t,f=S=>o(t,S,i)+h3t(t,S,i)+c(t,S,i),m=S=>a(t,S,i)+p3t(t,S,i)+u(t,S,i),g=S=>l(t,S,i)+f3t(t,S,i)+h(t,S,i);let y=f(r);const _=w3t(t);let b;const w=e.maximumIterations||20,x=e.maximumDistance!=null?e.maximumDistance:1/0;for(b=0;b<w;b++){const C=(m(r)+1e-6)/g(r);if(isNaN(C)||r>=x&&C<0){if(!isFinite(x))return null;r=x,y=f(r);break}if(r-=C,r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;const E=f(r);if(Math.abs(E-y)/y<=.005)break;y=E}return y>_*(1-.3)||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r}function S3t(t,e){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom),i=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return i<r?e.maximumDistance!=null?r+(e.maximumDistance-r)/2:1.5*r:e.maximumDistance?Math.min(e.maximumDistance,i):i}let T3t=class extends s3t{constructor(e,r){super(),this._preallocSegments=[new hY,new hY,new hY],this._ascensionSegment=null,this._descensionSegment=null,this.update(e,r)}update(e,r){if(!e)return;this.definition?this.definition.copyFrom(e):this.definition=e.clone();let i=null;r&&r.apex&&(i=x3t(e,r.apex)),this.segments.length=0,this._ascensionSegment=null,this._descensionSegment=null,i==null?this._updateWithoutApex():this._updateWithApex(i,r==null?void 0:r.apex)}segmentInterpolateComponentsAt(e,r,i){return i=e.interpolateComponentsAt(r,i),e===this._ascensionSegment?i.zoom=dhe(i.zoom):e===this._descensionSegment&&(i.zoom=PH(i.zoom)),i}_updateWithApex(e,r){const[i,n,s]=this._preallocSegments,o=(r==null?void 0:r.ascensionFactor)??.5,a=Math.min(1-o,(r==null?void 0:r.ascensionFactor)!=null&&r.descensionFactor!=null?r.descensionFactor:.5),l=1-o-a;i.definition?i.definition.copyFrom(this.definition):i.definition=this.definition.clone(),i.definition.compared.targetZoom=e,i.definition.compared.pan=this.definition.compared.pan*o,i.definition.compared.rotate=this.definition.compared.rotate*o,i.update(),this._ascensionSegment=i,this.segments.push(i),l>0&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=e,n.definition.compared.targetZoom=e,n.definition.compared.pan=this.definition.compared.pan*l,n.definition.compared.rotate=this.definition.compared.rotate*l,n.update(),this.segments.push(n)),s.definition?s.definition.copyFrom(this.definition):s.definition=this.definition.clone(),s.definition.compared.sourceZoom=e,s.definition.compared.pan=this.definition.compared.pan*a,s.definition.compared.rotate=this.definition.compared.rotate*a,s.update(),this._descensionSegment=s,this.segments.push(s)}_updateWithoutApex(){const[e]=this._preallocSegments;e.update(this.definition),this.segments.push(e)}};const E3t={zoom:0,pan:0,rotate:0};let C3t=class{get time(){return this._time}constructor(e){this._createCamera=e,this._time=0,this.definition=new n3t(e),this.path=new T3t}update(e,r,i){this.definition.update(e,r,i),this.path.update(this.definition,i),this._time=this._applyTimeSettings(z$e(isFinite(this.path.time)?this.path.time:0),i),this._easing=i.easing??(this._time>=1e3?AUe:RF)}cameraAt(e,r){r=r||this._createCamera(),e=Math.min(Math.max(0,e),1),e=this._normalizedEasing(e);const i=this.path.interpolateComponentsAt(e,E3t);return r.interpolate(this.definition.source,this.definition.target,i),r}_normalizedEasing(e){const r=this._easing(0,this._time),i=this._easing(1,this._time);return(this._easing(e,this._time)-r)/(i-r)}_applyTimeSettings(e,r){const i=r.speedFactor!=null?r.speedFactor:1;r.duration!=null?e=r.duration:r.speedFactor!=null&&(e=e/i);const n=r.minDuration!=null?r.minDuration:NB.minDuration/i,s=r.maxDuration!=null?r.maxDuration:NB.maxDuration/i;return Math.min(Math.max(n,e),s)}};const R3t=A();let O3t=class{get finished(){return this.currentTime>=this._animation.time}get time(){return this._animation.time}constructor(e){this.currentTime=0,this._animation=new C3t(()=>new twe(e)),this._current=new twe(e)}update(e,r,i){const n=this._animation.definition.source,s=this._animation.definition.target,o=ve(R3t,r.center,e.center),a=We(o);a>=1e-5?(o[0]/=a,o[1]/=a,o[2]/=a):(o[0]=0,o[1]=1,o[0]=0),oe(n.lookAtDirection,o),oe(s.lookAtDirection,o),n.copyFromRenderCamera(e),s.copyFromRenderCamera(r),this._current.copyFrom(n),this._animation.update(n,s,i),this.currentTime=0,e.almostEquals(r)&&(this.currentTime=this._animation.time)}cameraAt(e,r){return this._animation.cameraAt(e,this._current),r=r||new Bt,this._current.copyToRenderCamera(r),r}step(e,r){return this.finished||(this.currentTime=this.currentTime+z$e(e),this.currentTime>=this.time&&(this.currentTime=this.time)),this.cameraAt(this.currentTime/this.time,r)}};var In;(function(t){t.Ready="ready",t.Rejected="rejected",t.Running="running",t.Stopped="stopped",t.Finished="finished"})(In||(In={}));let Nv=class extends Ce{constructor(e){super(e),this.state=In.Ready}get active(){return this.state===In.Running}get isInteractive(){return!1}get canStop(){return!1}stopController(){return!!this.canStop&&(this.state=In.Stopped,!0)}finishController(){this.state=In.Finished}get steppingFinished(){return!1}};d([p({constructOnly:!0})],Nv.prototype,"view",void 0),d([p({readOnly:!0})],Nv.prototype,"active",null),d([p()],Nv.prototype,"state",void 0),d([p({readOnly:!0})],Nv.prototype,"isInteractive",null),Nv=d([I("esri.views.3d.state.controllers.CameraController")],Nv);let qN=class extends Nv{constructor(){super(...arguments),this._asyncResult=null}get canStop(){return!0}set asyncResult(e){this._asyncResult&&(this._asyncResult.reject(Wr()),this._asyncResult=null),this.state===In.Finished||this.state===In.Stopped?(h7(e),this.state===In.Finished?e.resolve():e.reject(Wr())):this._asyncResult=e}get asyncResult(){return this._asyncResult}onControllerStart(){this.state=In.Running,this.viewAnimation!=null&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())}updateStateFromViewAnimation(){this.viewAnimation==null||this.state!==In.Ready&&this.state!==In.Running||(this.viewAnimation.state===VP.State.FINISHED?this.finish():this.viewAnimation.state===VP.State.STOPPED&&(this.state=In.Stopped))}onControllerEnd(){this.viewAnimation==null||this.viewAnimation.done||(this.state===In.Finished?this.viewAnimation.finish():this.state===In.Stopped&&this.viewAnimation.stop()),this._asyncResult&&(this.state===In.Finished?this._asyncResult.resolve():this._asyncResult.reject(Wr()))}finish(){this.finishController()}};qN=d([I("esri.views.3d.state.controllers.AnimationController")],qN);let Yv=class extends qN{get intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.mode="interaction",this._hasTarget=!1}initialize(){this.animation=new O3t(this.view.state.viewingMode),this.viewAnimation=this.mode==="interaction"?null:new VP}get isInteractive(){return this.mode==="interaction"}begin(e,r){this._hasTarget=!0;const i=this.animationSettings(r);Bk.copyFrom(this.view.state.camera);const n=hf(this.view.state.viewingMode);this.intersectionHelper.intersectRay(Bk.ray,n,rwe)&&(Bk.center=rwe),this.animation.update(Bk,e,i),this.animation.finished&&this.finish()}finish(){this.animation.currentTime=this.animation.time,super.finish()}get steppingFinished(){return this._hasTarget&&this.animation.finished}stepController(e,r){this._hasTarget&&this.animation.step(e,r)}onControllerEnd(e){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,e),this.animation.currentTime=this.animation.time),super.onControllerEnd(e)}animationSettings(e={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(1/0)/6,ascensionFactor:void 0,descensionFactor:void 0},...e,easing:typeof e.easing=="string"?JPt[e.easing]:e.easing}}};d([p({constructOnly:!0})],Yv.prototype,"mode",void 0),d([p({readOnly:!0})],Yv.prototype,"isInteractive",null),Yv=d([I("esri.views.3d.state.controllers.PointToPointAnimationController")],Yv);const Bk=new Bt,rwe=A();function MH(t=P3t){return[t[0],t[1],t[2],t[3]]}function WN(t,e){return A3t(t[0],t[1],t[2],e,rde.get())}function A3t(t,e,r,i,n=MH()){return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function vhe(t,e,r){return Lt(r,t,e),Se(r,r),r[3]=Q7(t,e),r}const P3t=[0,0,1,0];function MUe(t,e,r){return M3t(t,t.screenToRender(e,ut.get()),r)}function M3t(t,e,r){const i=Eo(ut.get(),e);if(i[2]=0,!t.unprojectFromRenderScreen(i,r.origin))return null;const n=Eo(ut.get(),e);n[2]=1;const s=t.unprojectFromRenderScreen(n,ut.get());return s==null?null:(ve(r.direction,s,r.origin),r)}function Y3(t,e,r){return _he(t,t.screenToRender(e,ut.get()),r)}function _he(t,e,r){oe(r.origin,t.eye);const i=se(ut.get(),e[0],e[1],1),n=t.unprojectFromRenderScreen(i,ut.get());return n==null?null:(ve(r.direction,n,r.origin),r)}function bhe(t,e,r,i){const n=Y3(e,r,$3t);return Cx(t,n,i)}const $3t=la();var WP;(function(t){t[t.Ellipsoid=0]="Ellipsoid",t[t.Silhouette=1]="Silhouette"})(WP||(WP={}));const $Ue=30,FB=[1,3e8],$H=80,IUe=8,LUe=200,DUe=1508e5,NUe=5,FUe=50,I3t=5,L3t=10,pY=90,HE={exclude:new Set([Kb])};function R2(t,e,r){return r[0]=e[0]/(t.fullWidth/t.pixelRatio),r[1]=e[1]/(t.fullHeight/t.pixelRatio),r}function Die(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function px(t,e,r){const i=Ch(ide.get(),r[3],r);i==null||aDe(i,bo)||(ve(wi,t.eye,e),lt(wi,wi,i),t.eye=ge(wi,wi,e),ve(wi,t.center,e),lt(wi,wi,i),t.center=ge(wi,wi,e),t.up=lt(wi,t.up,i))}function D3t(t,e,r,i){return zE(t,MUe(e,r,She),i)}function Nie(t,e,r,i){return zE(t,Y3(e,r,She),i)}function whe(t,e,r,i){const n=ut.get();let s=1-r;ve(n,e,t.eye);const o=We(n);let a=o*(1-s);s>=0&&a<i&&(a=i,s=-(a-o)/o),Math.abs(o-a)<1e-6||(ce(n,n,s),t.eye=ge(wi,t.eye,n),t.center=mi(wi,t.center,e,s))}function kUe(t,e,r){e.getScreenCenter(iwe),bhe(t,e,iwe,wi)&&(e.center=wi);const i=e.distance,n=i*r;if(Math.abs(i-n)<1e-6)return;const s=ce(ut.get(),e.viewForward,n);e.eye=ve(wi,e.center,s)}const iwe=Tn();function fY(t,e){se(e,0,0,0);for(const r of t)ge(e,e,r);ce(e,e,1/t.length)}function Tz(t,e,r,i){return Math.sin(t/We(e))*(r+i.radius)}function nwe(t,e,r,i){return Tz(Math.PI/2,e,r,i)+(t-Math.PI/2)}var ca;(function(t){t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal"})(ca||(ca={}));const swe={Elevation:3e4,Angle:sr(16)},jk={Pole:.95,Angle:sr(18),Tilt:45},UUe=sr(80);function zUe(t,e,r,i,n,s){const o=A(),a=us();let l=!0,c=!0;return t.intersectScreen(r,o,s)?a[3]=We(o):(c=!1,e.aboveGround&&n!==WP.Ellipsoid?a[3]=Math.max(We(e.center),.9*i.radius):a[3]=We(e.eye)-e.relativeElevation,n===WP.Silhouette?XN(a,e,r,o):l=bhe(a,e,r,o)),{sphere:a,scenePickPoint:l?o:null,hasGeometryIntersection:c}}function IH(t,e,r){return We(t.eye)-r.radius>swe.Elevation?ca.Horizontal:(Y3(t,e,pwe),-Math.sign(t.relativeElevation)*(.5*Math.PI+Q7(t.eye,pwe.direction))<swe.Angle?ca.Vertical:ca.Horizontal)}function VUe(t,e,r){ve(mY,r,e),t.eye=ve(wi,t.eye,mY),t.center=ve(wi,t.center,mY)}const mY=A();function XN(t,e,r,i){const n=Y3(e,r,She);return n!=null&&(V3(t,n,Gk),Cx(t,n,i)?!(ks(Gk,n.origin)<ks(i,n.origin))||(oe(i,Gk),!1):(ve(EC,e.eye,e.center),Se(EC,EC),XFe(EC,-ye(Se(EC,EC),Gk),owe),zE(owe,n,i),!1))}const Gk=A(),EC=A(),owe=oi();function BUe(t,e,r,i,n,s){let o=0;if(Lt(zB,t,e),ve(Xk,t,e),We(t)<=n||!i.aboveGround){Lt(r,Xk,i.eye);const a=ye(t,e)/(We(t)*We(e));if(a<.9999)o=Vo(a);else{const c=We(Lt(A(),t,e))/(We(t)*We(e));o=sf(c)}const l=Math.cos(Te(Yw.normalize(sr(s)),0,UUe));o=-o-Math.max(0,We(e)-n)/(l*n)}else ve(awe,i.eye,i.center),Lt(r,Xk,awe),o=-We(Xk)/n;return Se(r,r),ce(r,r,We(zB)),o}const awe=A();function lwe(t,e,r,i){let n,s;const o=Math.cos(Te(Yw.normalize(sr(i)),0,UUe));return n=e>r?-(e-r)/(o*r):e<-r?Math.PI-(e+r)/(o*r):Vo(e/r),s=t>r?-(t-r)/(o*r):t<-r?Math.PI-(t+r)/(o*r):Vo(t/r),(s-n)*r}function N3t(t,e,r,i,n,s,o,a,l,c){const u=lwe(t[2],e[2],s[3],a),h=l?lwe(t[0],e[0],s[3],180):e[0]-t[0],f=Math.sin(o)*h-Math.cos(o)*u,m=Math.cos(o)*h+Math.sin(o)*u;Se(wi,n);const g=l?f/Math.sqrt(Math.abs(s[3]**2-ye(r,wi)**2)):f/s[3],y=m/Math.sqrt(Math.abs(s[3]**2-ye(r,i)**2));Or(c,g,y)}function jUe(t,e,r,i,n,s,o,a,l,c){Lt(zB,t,e),yre(s.up,s.eye,Hk,qk,Wk),yre([0,0,1],s.eye,s_,zw,WUe),oe(r,zw),oe(i,s_),Se(r,r),ce(r,r,We(zB)),d1e(t,Se(qk,qk),Se(Wk,Wk),Se(Hk,Hk),cwe),d1e(e,qk,Wk,Hk,uwe),N3t(cwe,uwe,t,s_,zw,o,a,l,c,n)}function F3t(t,e,r,i,n,s,o){Ch(kB,n,i),Ch(UB,o,s),Ii(KO,kB,UB),ve(e,t,r),lt(e,e,KO),ge(e,e,r)}function GUe(t,e,r,i,n,s){Ch(kB,i,r),Ch(UB,s,n),Ii(KO,kB,UB),ve(wi,t.eye,e),lt(wi,wi,KO),t.eye=ge(wi,wi,e),ve(wi,t.center,e),lt(wi,wi,KO),t.center=ge(wi,wi,e),ve(wi,t.up,e),lt(wi,wi,KO),t.up=ge(wi,wi,e)}function xhe(t,e,r,i,n,s){return(Math.abs(i)>Math.PI-jk.Angle||Math.abs(i)<jk.Angle)&&(Math.abs(t[2])<r*jk.Pole||Math.abs(e)>r)&&s.aboveGround&&n<jk.Tilt}function HUe(t,e,r,i,n,s){if(s)vhe(r,i,dwe),px(e,t,dwe);else{const o=BUe(r,i,hwe,e,t[3],n);px(e,t,WN(hwe,o))}}function qUe(t,e,r,i,n,s,o){const a=o?20:1,l=1e-12;let c,u;oe(Yx,i),Yk.copyFrom(e);for(let h=0;h<a&&ks(r,Yx)>l&&(c=ks(r,Yx),jUe(r,Yx,zw,s_,ZM,Yk,t,n,s,o),GUe(Yk,t,s_,ZM[1],zw,ZM[0]),F3t(Yx,Yx,t,s_,ZM[1],zw,ZM[0]),u=ks(r,Yx),u<c||h===0);h++)e.copyFrom(Yk)}function k3t(t,e,r,i,n,s,o){xhe(r,ye(e.up,r),t[3],-Yw.normalize(sr(n)),s,e)?qUe(t,e,r,i,-Yw.normalize(sr(n)),s,o):HUe(t,e,r,i,s,o)}function U3t(t,e,r,i,n,s){const{eye:o}=t;yre([0,0,1],o,s_,zw,WUe);const a=e.translation[0]*r.pan,l=n.mode==="zoom"?0:e.translation[1]*r.pan,c=Math.max(Math.sqrt(Math.abs(1-ye(t.center,s_)**2/We(t.center)**2)),.5),u=(Math.sin(s)*l+Math.cos(s)*a)/c,h=-Math.cos(s)*l+Math.sin(s)*a;switch(sd(i.pan.matrix,i.pan.matrix,u,s_),i.pan.enabled=!0,n.mode){case"pan":sd(i.pan.matrix,i.pan.matrix,h,zw),i.pan.enabled=!0;break;case"zoom":i.zoom=-e.translation[1]*r.zoom}}function z3t(t,e,r,i,n){const{eye:s,viewRight:o}=t,a=Lt(ut.get(),o,s),l=e.translation[0]*r.pan;switch(l!==0&&(sd(i.pan.matrix,i.pan.matrix,-l,a),i.pan.enabled=!0),n.mode){case"pan":{const c=e.translation[1]*r.pan;c!==0&&(sd(i.pan.matrix,i.pan.matrix,c,o),i.pan.enabled=!0);break}case"zoom":i.zoom=-e.translation[1]*r.zoom}}function V3t(t,e,r,i,n,s,o,a,l){xhe(t.center,ye(t.up,t.center),We(t.center),-Yw.normalize(sr(s)),o,e)?U3t(e,r,i,a,l,-Yw.normalize(sr(n))):z3t(e,r,i,a,l)}const s_=A(),zw=A(),WUe=A(),Hk=A(),qk=A(),Wk=A(),cwe=A(),uwe=A(),ZM=Qe(),dwe=MH(),kB=Me(),UB=Me(),KO=Me(),Yx=A(),wi=A(),Xk=A(),Yk=new Bt,zB=A(),hwe=A(),She={origin:A(),direction:A()},pwe={origin:A(),direction:A()},fwe=.6,gY=4,B3t=60;let VB=class extends Yv{constructor(){super(...arguments),this._zoomLocation=A(),this._tmpCamera=new Bt,this._tmpViewDir=A(),this._tmpRayDir={origin:A(),direction:A()},this._targetOnSphere=A(),this._tmpCenter=A(),this._constraintOptions={selection:un.ALL_EXCEPT_COLLISION,interactionType:xr.ZOOM,interactionFactor:null,interactionStartCamera:new Bt,interactionDirection:null,tiltMode:ha.TUMBLE},this._sphere=us()}initialize(){this._intersector=hf(this.view.state.viewingMode)}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(i.camera):this.animation.cameraAt(1,n));let s=!1,o=!1;this.intersectionHelper.intersectScreen(r,this._zoomLocation,this.view.map.ground.opacity===0?HE:{})&&(s=e>0,o=!0),this._tmpCamera.copyFrom(i.camera),s?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:oe(this._zoomLocation,this._tmpCamera.center),this._updateCamera(this._tmpCamera,e,this._zoomLocation,r,o),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:RF}}_updateCamera(e,r,i,n,s){const o=Xr(this.view.spatialReference),a=IH(e,n,o),l=Math.abs(this.view.camera.position.z);Se(Jk,e.eye),ce(Jk,Jk,-1),Y3(e,n,this._tmpRayDir),Se(this._tmpRayDir.direction,this._tmpRayDir.direction);const c=Te(Math.min(IUe,1/Math.abs(ye(Jk,this._tmpRayDir.direction)))*l,LUe,DUe);if(a===ca.Horizontal){let u=fwe**r;this._sphere[3]=We(i),ve(this._tmpViewDir,e.center,e.eye);const h=Math.min(We(this._tmpViewDir),c);let f=h*u;if(u<=1&&f<gY&&(f=gY,u=f/h),Math.abs(h-f)<1e-6)return;const m=We(e.center);if(this._sphere[3]!==m){const g=this._sphere[3]+u*(m-this._sphere[3]);e.center=ce(Zk,e.center,g/m)}ce(this._tmpViewDir,this._tmpViewDir,-u),e.eye=ge(Zk,e.center,this._tmpViewDir),ws(this.view,e,this._constraintOptions),ks(i,e.center)>1e-12&&bhe(this._sphere,e,n,this._targetOnSphere)&&k3t(this._sphere,e,i,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{let u=fwe**Math.abs(r);const h=r>0?1:-1;ve(this._tmpViewDir,i,e.eye);const f=We(this._tmpViewDir),m=this.view._stage.renderView.getMinimalDepthForArea(null,n[0],n[1],this.view.state.camera,B3t);let g=m??c;g=s&&r>0?Math.min(g,f):g,ce(this._tmpRayDir.direction,this._tmpRayDir.direction,g),ge(i,this._tmpRayDir.origin,this._tmpRayDir.direction);let y=g*u;const _=Math.max(gY,1.01*e.nearFar[0]);if(r>0&&y<_&&(y=_,u=y/g),Math.abs(g-y)<1e-6)return;ce(this._tmpRayDir.direction,this._tmpRayDir.direction,h*(1-u)),e.eye=ge(Zk,e.eye,this._tmpRayDir.direction),e.center=ge(Zk,e.center,this._tmpRayDir.direction)}X3(this.view,e)}};VB=d([I("esri.views.3d.state.controllers.global.ZoomStepController")],VB);const Zk=A(),Jk=A(),j3t=.6,G3t=4,H3t=60;let BB=class extends Yv{constructor(){super(...arguments),this._zoomLocation=A(),this._tmpCamera=new Bt,this._tmpRayDir=A(),this._tmpCenter=A(),this._constraintOptions={selection:un.ALL,interactionType:xr.ZOOM,interactionFactor:null,interactionStartCamera:new Bt,interactionDirection:null,tiltMode:ha.TUMBLE}}zoomStep(e,r){if(!this.active)return;const i=this.view.state,{interactionStartCamera:n}=this._constraintOptions;n&&(this.animation.finished?n.copyFrom(i.camera):this.animation.cameraAt(1,n)),this._tmpCamera.copyFrom(i.camera);const s=hf(this.view.state.viewingMode);let o=!1;e>0?(o=this.intersectionHelper.intersectScreenFreePointFallback(r,this._zoomLocation,this.view.map.ground.opacity===0?HE:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,s,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:oe(this._zoomLocation,this._tmpCamera.center);const a=j3t**e;let l=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,r[0],r[1],this.view.state.camera,H3t);ve(Kk,this._tmpCamera.eye,this._zoomLocation),Se(Kk,Kk);const c=Te(Math.min(IUe,1/Math.abs(ye(q3t,Kk)))*Math.abs(this.view.camera.position.z),LUe,DUe);if(l=l??c,l){const u=A();ve(u,this._zoomLocation,this._tmpCamera.eye),(l<We(u)||!o)&&(Se(u,u),ge(this._zoomLocation,this._tmpCamera.eye,ce(u,u,l)))}this._updateCamera(this._tmpCamera,a,this._zoomLocation),this.begin(this._tmpCamera)}animationSettings(){return{duration:600,easing:RF}}_updateCamera(e,r,i){ve(this._tmpRayDir,i,e.eye);const n=We(this._tmpRayDir);let s=n*r;const o=r<=1,a=Math.max(G3t,1.01*e.nearFar[0]);s!==0&&(o&&s<a&&(s=a,r=s/n),Math.abs(n-s)<1e-6||(ce(this._tmpRayDir,this._tmpRayDir,r),e.eye=ve(mwe,i,this._tmpRayDir),e.center=mi(mwe,e.center,i,1-r),ws(this.view,e,this._constraintOptions)))}};BB=d([I("esri.views.3d.state.controllers.local.ZoomStepController")],BB);const mwe=A(),q3t=Ue(0,0,1),Kk=A();function W3t(t,e){switch(e){case"primary":return t.pointerType==="touch"||t.button===0;case"secondary":return t.pointerType!=="touch"&&t.button===2;case"tertiary":return t.pointerType!=="touch"&&t.button===1}}function The(t,e){if(t.pointerType==="touch")return!1;switch(e){case"primary":return t.button===0;case"secondary":return t.button===2;case"tertiary":return t.button===1}}let X3t=class extends Ua{constructor(e,r){super(!0),this._view=e,this.registerIncoming("double-click",r,i=>this._handleDoubleClick(i))}_handleDoubleClick(e){const r=e.data;if(W3t(r,"primary")){const i=this._view.state.isGlobal?new VB({view:this._view,mode:"animation"}):new BB({view:this._view,mode:"animation"});this._view.state.switchCameraController(i),i.zoomStep(Math.log(.5)/Math.log(.6),Tn(r.x,r.y)),e.stopPropagation()}}};function Y3t(t,e,r){return t===at.Global?new J3t(r):new Z3t(e,r)}let Z3t=class{constructor(e,r){this._elevationProvider=e,this._referenceEllipsoid=Xr(r),this._unitInMeters=Pc(r,this._referenceEllipsoid.metersPerDegree)}compute(e,r,i,n,s){var x;s||(s={near:0,far:0});let o=e[2]*this._unitInMeters;const a=o,l=o-n,c=(x=this._elevationProvider)==null?void 0:x.visibleElevationBounds;c&&(o=l>=0?a-this._unitInMeters*c.min:this._unitInMeters*c.max-a);const u={x:(i=i??new $r({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0})).xmax-i.xmin,y:i.ymax-i.ymin,z:4*Math.max(i.xmax-i.xmin,i.ymax-i.ymin)},h=Math.max(u.x,u.y,u.z);ve(Zx,r,e),CC[0]=Zx[0]>0?i.xmax:i.xmin,CC[1]=Zx[1]>0?i.ymax:i.ymin,CC[2]=Zx[2]>0?h/2:-h/2,ve(CC,CC,e),Se(Zx,Zx);const f=1.1*ye(CC,Zx)*this._unitInMeters,m=Math.sqrt(o*(o+2*this._referenceEllipsoid.radius)),g=Math.max(i.xmax-i.xmin,i.ymax-i.ymin),y=g*eMt*this._unitInMeters,_=g*tMt*this._unitInMeters,b=Te((o-_)/(y-_),0,1)**3,w=Math.min(Xt(m,f,b),m)*Math.max(Math.log(Math.abs(l)),1);return XUe(Math.min(w,Math.max(34064e4,h))/this._unitInMeters,K3t,this._unitInMeters,s)}},J3t=class{constructor(e){this._referenceEllipsoid=Xr(e)}compute(e,r,i,n,s){s||(s={near:0,far:0});const o=We(e),a=o-this._referenceEllipsoid.radius,l=this._referenceEllipsoid.radius+Math.min(0,n),c=Math.abs(a-n),u=Math.max(c,Math.abs(a)),h=Math.sqrt(u*(u+2*l)),f=o+this._referenceEllipsoid.radius;return XUe(1.2*Xt(h,f,kde(u)),Te(2e4-(Math.log(u)-7.983)/9.011*19e3,1e3,2e4),1,s)}};function XUe(t,e,r,i){const n=Q3t/r;return t/e>n?(i.far=t,i.near=i.far/e):(i.near=n,i.far=i.near*e),i}const K3t=2e4,Q3t=2,eMt=.001,tMt=1e-4,CC=A(),Zx=A();let Ez=class extends Ce{constructor(e){super(e)}initialize(){this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e)))}_handleElevationChangeEvent(e){if(this.view.state.cameraController)return;const r=this.view.state.camera;e.spatialReference!=null&&C5e(this.view,r,e.extent,e.spatialReference)&&this._applyToCurrentCamera()}_applyToCurrentCamera(){this.view.state.updateCamera(e=>X3(this.view,e,Bp.EYE_AND_CENTER))}};d([p({constructOnly:!0})],Ez.prototype,"view",void 0),Ez=d([I("esri.views.3d.state.ElevationCollisionConstraint")],Ez);let HI=class extends Ce{constructor(e){super(e),this.nearFarHeuristic=Y3t(e.view.state.viewingMode,e.view.basemapTerrain,e.view.renderCoordsHelper.spatialReference)}initialize(){this.addHandles([pe(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.near,(n=(i=this.view.constraints)==null?void 0:i.clipDistance)==null?void 0:n.far]},()=>this._clipDistanceNearFarChanged()),pe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.clipDistance)==null?void 0:r.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",e=>this._updateCameraNearFar(e)),pe(()=>this.view.renderDataExtent,()=>this._updateNearFar(),li),pe(()=>{var e,r,i,n;return[(r=(e=this.view.constraints)==null?void 0:e.altitude)==null?void 0:r.min,(n=(i=this.view.constraints)==null?void 0:i.altitude)==null?void 0:n.max]},()=>this._updateAltitude(),li),pe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.max},()=>this._updateTiltMax(),li),pe(()=>{var e,r;return(r=(e=this.view.constraints)==null?void 0:e.tilt)==null?void 0:r.mode},()=>this._updateTilt(),li),pe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this._updateTiltAutoMax(),li),pe(()=>{var e,r,i,n,s,o;return[(i=(r=(e=this.view.map)==null?void 0:e.ground)==null?void 0:r.navigationConstraint)==null?void 0:i.type,(o=(s=(n=this.view.state)==null?void 0:n.constraints)==null?void 0:s.collision)==null?void 0:o.enabled]},()=>this._updateCollision(),li)]),this.view.state.isLocal&&this.addHandles(pe(()=>this.view.renderDataExtent,e=>this._updateLocalSurfaceDistance(e),_r)),this._updateNearFar(),this.view.state.viewingMode!==at.Local&&this._updateAltitude(),this._updateTilt(),this._updateCollision(),this._set("surfaceCollisionConstraint",new Ez({view:this.view}))}destroy(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))}_clipDistanceNearFarChanged(){var r;const e=(r=this.view.constraints)==null?void 0:r.clipDistance;e&&e.mode!=="auto"&&this.view.state.updateCamera(i=>this._updateCameraNearFarManual(i,e))}_updateNearFar(){this.view.state.updateCamera(e=>this._updateCameraNearFar(e))}_updateCameraNearFar(e){const r=this.view.constraints&&this.view.constraints.clipDistance;(r?r.mode:"auto")==="manual"?this._updateCameraNearFarManual(e,r):this._updateCameraNearFarAuto(e,r)}_updateCameraNearFarAuto(e,r){this.nearFarHeuristic.compute(e.eye,e.center,this.view.renderDataExtent,uH(this.view,e.eye),e),r&&r.autoUpdate(e.near,e.far)}_updateCameraNearFarManual(e,r){r&&(e.near=r.near,e.far=r.far)}_updateCollision(){var n,s,o;const e=(o=(s=(n=this.view.map)==null?void 0:n.ground)==null?void 0:s.navigationConstraint)==null?void 0:o.type,r=!e||e==="stay-above",i=this.view.state.constraints.collision;if(r!==i.enabled){i.enabled=r,r&&this._reapplyConstraints(un.COLLISION);const a=this.view.constraints&&this.view.constraints.tilt;a&&a.mode!=="auto"||this._updateTiltAuto()}}_updateAltitude(){const e=this.view.constraints&&this.view.constraints.altitude;e&&this.view.state.viewingMode!==at.Local?this.view.state.constraints.altitude={min:e.min,max:e.max}:this.view.state.constraints.altitude=null,this._reapplyConstraints()}_updateTiltMax(){const e=this.view.constraints&&this.view.constraints.tilt;e&&e.mode!=="auto"&&(this._updateTiltManual(e),this._reapplyConstraints())}_updateTilt(){const e=this.view.constraints&&this.view.constraints.tilt;(e?e.mode:"auto")==="manual"?this._updateTiltManual(e):this._updateTiltAuto(),this._reapplyConstraints()}_updateTiltManual(e){const r=this.view.state.constraints;r.tilt=r.createConstantMaxTilt(sr(e.max))}_updateTiltAuto(){const e=this.view.state.constraints;e.tilt=e.createDefaultTilt(),this._updateTiltAutoMax()}_updateTiltAutoMax(){const e=this.view.constraints&&this.view.constraints.tilt;if(!e||e.mode!=="auto")return;const r=this.view.state.constraints;if(r.tilt){const i=r.tilt(this.view.state.camera.distance).max;e.autoUpdate(Oc(i))}}_updateLocalSurfaceDistance(e){if(e==null)return;let r=Math.max(e.width,e.height);if(r<=0)return;e.zmax!=null&&e.zmin!=null&&(r=Math.max(r,e.zmax-e.zmin));const i=this.view.state,n=3*r/Math.atan(i.camera.fov/2);n!==i.constraints.distance&&(i.constraints.distance=n)}_reapplyConstraints(e=un.ALL){this.view.state.updateCamera(r=>ws(this.view,r,{selection:e,interactionType:xr.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:ha.TUMBLE}))}};d([p({constructOnly:!0})],HI.prototype,"view",void 0),d([p({readOnly:!0})],HI.prototype,"surfaceCollisionConstraint",void 0),HI=d([I("esri.views.3d.state.ConstraintsManager")],HI);let rw=class{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}constructor(e){this.renderCoordsHelper=e,this.frustum=LN(),this._points=JFe(),this.lines=new Array(12),this._origin=A(),this._direction=A(),this._altitude=null;for(let r=0;r<12;r++)this.lines[r]={origin:null,direction:A(),endpoint:null}}update(e){KFe(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),oe(this._origin,e.eye),oe(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)oe(this._points[r],e[r]);QFe(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return bw(this.frustum,e)}intersectsRay(e){return $wt(this.frustum,e)}intersectsLineSegment(e,r){return Iwt(this.frustum,e,r)}intersectsPoint(e){return e5e(this.frustum,e)}_updateLines(){const e=this._points;for(let r=0;r<4;r++){const i=r+4;yY(this.lines[r],e[r],e[i]),yY(this.lines[r+4],e[r],r===3?e[0]:e[r+1]),yY(this.lines[r+8],e[i],r===3?e[4]:e[i+1])}}};function yY(t,e,r){t.origin=e,t.endpoint=r,H_(t.direction,e,r)}rw.planePointIndices=Lwt,rw.nearFarLineIndices=[[Ct.NEAR_BOTTOM_LEFT,Ct.FAR_BOTTOM_LEFT],[Ct.NEAR_BOTTOM_RIGHT,Ct.FAR_BOTTOM_RIGHT],[Ct.NEAR_TOP_RIGHT,Ct.FAR_TOP_RIGHT],[Ct.NEAR_TOP_LEFT,Ct.FAR_TOP_LEFT]];let mD=class extends Nv{set desiredCamera(e){this._set("desiredCamera",e.clone())}constructor(e){super(e)}get canStop(){return!0}get constraintEnabled(){return this.view.state.constraints.collision.enabled}onControllerStart(){this.state=In.Running,this.addHandles(this.view.basemapTerrain.on("elevation-change",e=>this._handleElevationChangeEvent(e))),this._applyCorrection()}onControllerEnd(){this.removeAllHandles()}stepController(){}_handleElevationChangeEvent(e){(e.spatialReference==null||C5e(this.view,this.desiredCamera,e.extent,e.spatialReference))&&this._applyCorrection()}_applyCorrection(){this.view.state.updateCamera(e=>{e.copyViewFrom(this.desiredCamera),X3(this.view,e,Bp.EYE_AND_CENTER)||this.constraintEnabled||(this.state=In.Stopped)})}};d([p({constructOnly:!0})],mD.prototype,"desiredCamera",null),mD=d([I("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],mD);let rMt=class{constructor(e,r,i){this.target=e,this.options=r,this.view=i,this.state="pending",this._animationController=null,this._promise=new Promise((n,s)=>{this._resolveCallback=n,this._rejectCallback=s;const o=new AbortController;this.options.signal!=null&&Dl(this.options.signal,()=>{this.abort()}),this._abortController=o,this.waitForReady()})}then(e,r){return this._promise.then(e,r)}catch(e){return this._promise.catch(e)}resolve(e){if(this.state!=="finished")return this.state="finished",this._resolveCallback(e)}reject(e){if(this.state!=="finished")return this.state="finished",this._rejectCallback(e)}abort(e=!1){this._abortController.abort(),this.state==="wait-for-animation-finish"&&!e&&this._animationController!=null&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController(),this.reject(Wr())}async waitForReady(){if(this.state="wait-for-ready",!this.view.ready)try{await Zw(()=>this.view.ready,this._abortController.signal)}catch(e){return this.reject(e)}this.createViewPoint()}createViewPoint(){this.state!=="finished"&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,ASt(this.view,this.target,this._abortController.signal).then(e=>{if(this.state==="finished")return;const r=e?this._getCameraFromViewpoint(e):null;if(r!=null)if(this.options.animate){if(this._animationController==null)return;this.startAnimation(r,this._animationController)}else this.view.stateManager.setStateCamera(r.camera,{applyConstraints:!r.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve()},e=>{this.reject(e)}))}_getCameraFromViewpoint(e){var s;const r=!!(this.target instanceof Sd&&this.target.camera||this.target instanceof of),i=e.camera;if(i==null)return null;if(!this.view.stateManager.isCompatible(i)){const o=i.position,a=o&&o.spatialReference,l=a?a.wkid:"none",c=(s=this.view.spatialReference)==null?void 0:s.wkid;return this.reject(new H("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${l}, view: ${c})`,{camera:i})),null}const n=Ov(this.view,i);return n==null?(this.reject(new H("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:e,camera:n,isFullySpecified:r}}startAnimation(e,r){this.state="wait-for-animation-finish";const i=r.viewAnimation;if(i==null)return void this.reject(new H("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));if(i.update(e.viewpoint,"running"),!r.active||r.viewAnimation==null||r.viewAnimation.target!==e.viewpoint||this.view.state.cameraController!==r)return this.abort();let n;e.isFullySpecified?(n=new mD({view:this.view,desiredCamera:e.camera}),X3(this.view,e.camera,Bp.EYE_AND_CENTER)):ws(this.view,e.camera),r.begin(e.camera,this.options);const s=()=>{const a=this.view.state.cameraController;n&&(a&&a.active?a instanceof Yv&&a.viewAnimation!=null&&a.viewAnimation.target===e.viewpoint&&(this.view.state.cameraController=n):r.viewAnimation!=null&&r.viewAnimation.target===e.viewpoint&&r.state==="finished"&&(this.view.state.cameraController=n))},o=a=>{if(this.view.state!=null)switch(r.state){case In.Finished:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.resolve()}break;case In.Ready:case In.Rejected:case In.Running:case In.Stopped:switch(this.state){case"pending":case"wait-for-ready":case"wait-for-viewpoint":case"wait-for-animation-finish":this.reject(a)}}};i.when(s,a=>o(a)),r.asyncResult={resolve:()=>o(),reject:a=>o(a)}}_getAnimationController(){let e=null,r=null;const i=this.view.state.cameraController;return i instanceof Yv&&(i.updateStateFromViewAnimation(),i.active&&(e=i,r=e.viewAnimation)),e!=null||(e=new Yv({view:this.view,mode:"animation"}),r=e.viewAnimation,this.view.state.switchCameraController(e))?e:(r!=null&&r.stop(),this.reject(new H("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)}},Ao=class extends Ce{get camera(){const e=this._get("camera");if(!this.ready)return e;const r=NP(this.view,this.view.state.camera,vY);return r&&e&&r.equals(e)?e:r.clone()}set camera(e){var r,i;this._updatePropertyBeforeReady("camera",e)||((r=this.view.elevationProvider)==null||r.enableElevationCache(!0),this.setStateCamera(Ov(this.view,e),{applyConstraints:!1})||re.getLogger(this).error("#camera=","Invalid camera",e),(i=this.view.elevationProvider)==null||i.enableElevationCache(!1))}get contentCamera(){const e=this._get("contentCamera");if(!this.ready)return e;const r=NP(this.view,this.view.state.contentCamera,vY);return r&&e&&r.equals(e)?e:r.clone()}set contentCamera(e){if(this._updatePropertyBeforeReady("contentCamera",e))return;const r=Ov(this.view,e);r!=null?(this._updateElevation(r),this.view.state.contentCamera=r):this.view.state.contentCamera=null}installContentCameraReset(e){if(this.removeHandles(_Y),this.test.contentCameraResetState.clear(),!this.view.state.fixedContentCamera)return!1;const r=this.zoom,i=this.view.state.camera.distance**2,n=mc(this.view.state.camera.center),s=e.sticky?this.contentCamera.clone():null;return this.addHandles([pe(()=>this.contentCamera,()=>{e.sticky||(this.removeHandles(_Y),this.test.contentCameraResetState.clear())}),pe(()=>this.zoom,o=>{o!==void 0&&r!==void 0&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(o-r)/2),Math.abs(o-r)>2?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s))}),pe(()=>this.view.state.camera,o=>{const a=ks(n,o.center);this.test.contentCameraResetState.set("camera.center",a/i),a>i?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=s)})],_Y),!0}get center(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")}set center(e){var r;this._updatePropertyBeforeReady("center",e)||(e?this.isCompatible(e)?this.setStateCamera(this._centerToCamera(e),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():re.getLogger(this).error("#center=","Invalid center",e):re.getLogger(this).error("#center=","Center has an incompatible spatial reference (center: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):re.getLogger(this).error("#center=","Center may not be null or undefined"))}get extent(){if(!this.ready)return this._get("extent");const e=this.view,r=bSt(e,e.state.camera,e.pointsOfInterest.centerOnContent.renderLocation);return r??this._get("extent")}set extent(e){var r;this._updatePropertyBeforeReady("extent",e)||(e?this.isCompatible(e)?this.setStateCamera(this._extentToCamera(e),{applyConstraints:!0})||re.getLogger(this).error("#extent=","Invalid extent",e):re.getLogger(this).error("#extent=","Extent has an incompatible spatial reference (extent: "+(e.spatialReference?e.spatialReference.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e):re.getLogger(this).error("#extent=","Extent may not be null or undefined"))}get frustum(){const e=this._propertiesPool.get("frustum");return e.renderCoordsHelper=this.view.renderCoordsHelper,e.update(this.view.state.camera),e}get hasInitialView(){return!!this.view.get("map.initialViewProperties.viewpoint")}get scale(){if(this.ready){const e=this.view.pointsOfInterest.centerOnContent;return oE(this.view,e.distance,e.location.latitude)}return this._get("scale")}set scale(e){this._updatePropertyBeforeReady("scale",e)||this.setStateCamera(this._scaleToCamera(e),{applyConstraints:!0})||re.getLogger(this).error("#scale=","Invalid scale",e)}get padding(){if(!this.ready)return this._get("padding");const e=this.view.state.camera,r=e.padding,i=e.pixelRatio,n=this._get("padding"),s=Math.round(r[Tr.TOP]/i),o=Math.round(r[Tr.RIGHT]/i),a=Math.round(r[Tr.BOTTOM]/i),l=Math.round(r[Tr.LEFT]/i);return n!=null&&n.top===s&&n.right===o&&n.bottom===a&&n.left===l?n:{top:s,right:o,bottom:a,left:l}}set padding(e){this._updatePropertyBeforeReady("padding",e)||(this._paddingToArray(e,this.view.state.camera.pixelRatio,Qk),this.view.state.updateCamera(r=>r.padding=Qk))}_paddingToArray(e,r,i){e?Ki(i,e.top||0,e.right||0,e.bottom||0,e.left||0):Ki(i,0,0,0,0);for(let n=0;n<4;n++)i[n]=Math.round(i[n]*r)}get screenCenter(){const e=this.padding;return Oh((this.view.width-(e.left+e.right))/2+e.left,(this.view.height-(e.top+e.bottom))/2+e.top)}get viewpoint(){return this.ready?OSt(this.view,this.camera):this._get("viewpoint")}set viewpoint(e){var r;if(!this._updatePropertyBeforeReady("viewpoint",e))if(e)if(this.isCompatible(e))this.setStateCamera(this._viewpointToCamera(e),{applyConstraints:!e.camera})||re.getLogger(this).error("#viewpoint=","Invalid viewpoint",e);else{const i=e.camera!=null?e.camera.position:e.targetGeometry,n=i!=null&&i.spatialReference;re.getLogger(this).error("#viewpoint=","Viewpoint has an incompatible spatial reference (viewpoint: "+(n?n.wkid:"none")+", view: "+((r=this.view.spatialReference)==null?void 0:r.wkid)+")",e)}else re.getLogger(this).error("#viewpoint=","Viewpoint may not be null or undefined")}get zoom(){return this.ready?ESt(this.view,this.scale):this._get("zoom")}set zoom(e){this._updatePropertyBeforeReady("zoom",e)||e===void 0||this.setStateCamera(this._zoomToCamera(e),{applyConstraints:!0})||re.getLogger(this).error("#zoom=","Invalid zoom",e)}_computeCanvasSize(){if(this._devicePixelRatioOverride)return this.view.state.contentPixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*this._devicePixelRatioOverride),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*this._devicePixelRatioOverride),this._tmpCanvasSize.pixelRatio=this._devicePixelRatioOverride,this._tmpCanvasSize;const e=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio),r=this._usePhysicalPixelRendering?this._windowDevicePixelRatio:e;this._tmpCanvasSize.width=Math.round(this.view.surface.clientWidth*r),this._tmpCanvasSize.height=Math.round(this.view.surface.clientHeight*r);const i=this.view._stage.renderView.renderingContext.parameters.maxTextureSize;return l2(this._tmpCanvasSize,i)?this._tmpCanvasSize.pixelRatio=r:this._tmpCanvasSize.pixelRatio=this._tmpCanvasSize.width>0?this._tmpCanvasSize.width/this.view.surface.clientWidth:r,this.view.state&&(this.view.state.contentPixelRatio=Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)),this._tmpCanvasSize}get _rasterPixelRatio(){return this._devicePixelRatioOverride!=null?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}get _usePhysicalPixelRendering(){var e,r;return((r=(e=this.view)==null?void 0:e._stage)==null?void 0:r.renderer.isFeatureEnabled(qs.PhysicalPixelRendering))??!1}get _usePhysicalPixelRenderingAny(){var r,i;const e=(i=(r=this.view)==null?void 0:r._stage)==null?void 0:i.renderer;return e&&(e.isFeatureEnabled(qs.PhysicalPixelRendering,ai.IDLE)||e.isFeatureEnabled(qs.PhysicalPixelRendering,ai.INTERACTING)||e.isFeatureEnabled(qs.PhysicalPixelRendering,ai.ANIMATING))}constructor(e){super(e),this.constraintsManager=null,this.ready=!1,this._windowDevicePixelRatio=1,this._devicePixelRatioOverride=null,this._updatingIgnoreRenderState=!1,this.test={viewStateManager:this,contentCameraResetState:new Map,setDevicePixelRatio:r=>this._devicePixelRatioOverride=r,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(r){this.viewStateManager._updatingIgnoreRenderState=r},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||this.renderState!=null}},this._propertiesPool=new N_({frustum:rw},this),this._cameraSetByUser=!1,this._gotoOperation=null,this._cameraChangeTime=0,this._tmpCanvasSize=new iMt}initialize(){this._cameraChangeTime=performance.now(),this.addHandles([da(()=>this.view.state.events,"before-camera-change",e=>e&&this._updateElevation(e)),pe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},(e,r)=>this._cameraChangedHandler(e,r),li)]),du(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},e=>this._updateElevation(e),{once:!0,sync:!0}),this.addHandles([hP({prepare:()=>this._prepareFrame()}),pe(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0,this.removeHandles(e6)}),da(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale"))])}destroy(){this.exit(),this._propertiesPool=qe(this._propertiesPool)}init(){this.constraintsManager=new HI({view:this.view}),this._prepareFrame();const e=this._getInitialProperties();this._cameraSetByUser=!1,this._set("ready",!0);for(const r of e)this.set(r.name,r.value);if(!this._cameraSetByUser){const r=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent;r&&this.isCompatible(r)?this._setInitialView(r):this.view.state.viewingMode===at.Local&&this.addHandles(du(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles(e6),this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),e6)}}exit(){this._cancelGoToOperation(),this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles(e6),this.constraintsManager=qe(this.constraintsManager))}async goTo(e,r){const i={animate:!0,...r};return this._gotoOperation!=null&&this._gotoOperation.abort(i.animate),this._gotoOperation=new rMt(e,i,this.view),this.view.resourceController.scheduler.stopFrame(),this._gotoOperation}debugSetCameraOnContent(){this.setStateCamera(BE(this.view),{applyConstraints:!1})}step(e){const r=this.view.state,i=r==null?void 0:r.cameraController;i&&(r.updateCamera(n=>i.stepController(e,n)),i.steppingFinished&&i.finishController())}_cancelGoToOperation(){this._gotoOperation!=null&&(this._gotoOperation.abort(),this._gotoOperation=null)}_getInitialProperties(){const e=new Set,r=[];for(const{propertyName:i,overrides:n}of sMt){const s=e.has(i),o=this._isOverridden(i);!s&&o&&r.push({name:i,value:this._get(i)}),this._clearOverride(i),(s||o)&&n.forEach(a=>e.add(a))}return r}_setInitialView(e){if(e==null||this._cameraSetByUser)return;if(e instanceof of)return void this.setStateCamera(Ov(this.view,e),{applyConstraints:!1});if(e instanceof Sd){if(e.targetGeometry instanceof $r){const s=uD(this.view,e.targetGeometry,0,.5,nl.LOCKED);return void(s!=null&&this.setStateCamera(Ov(this.view,s),{applyConstraints:!0}))}const i={applyConstraints:!e.camera},n=this._viewpointToCamera(e);return void this.setStateCamera(n,i)}const r=uD(this.view,e,0,.5,nl.LOCKED);r!=null&&this.setStateCamera(Ov(this.view,r),{applyConstraints:!0})}_updatePropertyBeforeReady(e,r){return!this.ready&&(this._override(e,r),r&&nMt.includes(e)&&this._override("hasInitialView",!0),!0)}isCompatible(e){return e!=null&&(e instanceof Sd?e.camera?this.isCompatible(e.camera):this.isCompatible(e.targetGeometry):e instanceof of?this.isCompatible(e.position):e.spatialReference&&Nw(e.spatialReference,this.view.spatialReference))}_getPreservingHeadingTilt(e=oMt){return this._cameraSetByUser?(e.heading=this.camera.heading,e.tilt=this.camera.tilt):(e.heading=0,e.tilt=.5),e}_centerPointAtDistanceToCamera(e,r,i=A1){const{heading:n,tilt:s}=this._getPreservingHeadingTilt(),o=DN(this.view,n,s,e,r,nl.ADJUST);return o==null?null:(i.copyFrom(this.view.state.camera),i.eye=o.eye,i.center=o.center,i.up=o.up,i)}_centerToCamera(e){const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.distance;return this._centerPointAtDistanceToCamera(e,i)}_extentToCamera(e){const{heading:r,tilt:i}=this._getPreservingHeadingTilt(),n=uD(this.view,e,r,i,nl.ADJUST,vY);return n?Ov(this.view,n):null}_scaleToCamera(e){if(e==null)return null;const r=this.view.pointsOfInterest.centerOnContent;r.runTask();const i=r.renderLocation,n=r.location.latitude;if(n==null)return null;const s=bde(this.view,e,n);return this._centerPointAtDistanceToCamera(i,s)}_zoomToCamera(e){return this._scaleToCamera(G5e(this.view,e))}_viewpointToCamera(e){return Ov(this.view,xde(this.view,e))}setStateCamera(e,r){return!(e==null||!this.view.state.stopActiveCameraController())&&(this._cameraSetByUser=!0,r.doNotCancelGoToOperation||this._cancelGoToOperation(),this.view.state.updateCamera(i=>{r.positionAndOrientationOnly?(i.eye=e.eye,i.center=e.center,i.up=e.up):i.copyFrom(e),r.applyConstraints&&ws(this.view,i)}),r.applyConstraints||(this.view.state.cameraController=new mD({view:this.view,desiredCamera:e})),!0)}_prepareFrame(){const{surface:e,canvas:r}=this.view;if(!e||!r)return;this._windowDevicePixelRatio=window.devicePixelRatio;const i=this._computeCanvasSize();if(i.width!==0&&i.height!==0&&(r.width===i.width&&r.height===i.height||(r.width=i.width,r.height=i.height),this.view.state)){const n=this.view.state.camera;n.fullWidth===i.width&&n.fullHeight===i.height&&n.pixelRatio===i.pixelRatio||(A1.copyFrom(n),A1.pixelRatio!==i.pixelRatio&&(this._paddingToArray(this.padding,i.pixelRatio,Qk),A1.padding=Qk),A1.fullWidth=i.width,A1.fullHeight=i.height,A1.pixelRatio=i.pixelRatio,this.view.state.camera=A1),this._updateViewState()}}_updateElevation(e){var s;const r=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,i=((s=this.view.renderCoordsHelper)==null?void 0:s.getAltitude(e.eye))??0,n=r?uH(this.view,e.eye):0;e.relativeElevation=i-n}_updateViewState(){this.test.renderState!=null?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=ai.ANIMATING:this.view.interacting?this.view.state.mode=ai.INTERACTING:(this.view.state.mode===ai.ANIMATING&&(this._cameraChangeTime=0),performance.now()-this._cameraChangeTime<=aMt?this.view.state.mode=ai.INTERACTING:this.view.state.mode=ai.IDLE),this.view.state.rasterPixelRatio=this._rasterPixelRatio}_cameraChangedHandler(e,r){e&&r&&e.almostEquals(r)||(this._cameraChangeTime=performance.now(),this._updateViewState())}};d([p({type:of,dependsOn:["view.state.camera","ready"]})],Ao.prototype,"camera",null),d([p({type:of,dependsOn:["view.state.contentCamera","ready"]})],Ao.prototype,"contentCamera",null),d([p({type:Gt})],Ao.prototype,"center",null),d([p({type:$r})],Ao.prototype,"extent",null),d([p({readOnly:!0})],Ao.prototype,"frustum",null),d([p({readOnly:!0})],Ao.prototype,"hasInitialView",null),d([p({readOnly:!0,type:Boolean})],Ao.prototype,"ready",void 0),d([p({type:Number})],Ao.prototype,"scale",null),d([p()],Ao.prototype,"padding",null),d([p({readOnly:!0})],Ao.prototype,"screenCenter",null),d([p({constructOnly:!0})],Ao.prototype,"view",void 0),d([p({type:Sd})],Ao.prototype,"viewpoint",null),d([p({type:Number})],Ao.prototype,"zoom",null),d([p({readOnly:!0})],Ao.prototype,"_rasterPixelRatio",null),d([p({readOnly:!0})],Ao.prototype,"_usePhysicalPixelRendering",null),d([p({readOnly:!0})],Ao.prototype,"_usePhysicalPixelRenderingAny",null),d([p()],Ao.prototype,"_windowDevicePixelRatio",void 0),d([p()],Ao.prototype,"_devicePixelRatioOverride",void 0),Ao=d([I("esri.views.3d.state.ViewStateManager")],Ao);let iMt=class{constructor(){this.width=0,this.height=0,this.pixelRatio=1}};const nMt=["camera","viewpoint","extent","scale","center","zoom"],sMt=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],oMt={heading:0,tilt:0},vY=new of,A1=new Bt,Qk=wr(),e6="pending-initial-view",_Y="content-camera-reset",aMt=300,gwe=100;let Ny=class extends Nv{constructor(){super(...arguments),this.startCamera=new Bt,this.currentCamera=new Bt,this._lastInteraction=0}get isInteractive(){return performance.now()-this._lastInteraction<gwe}stepController(e,r){r.copyViewFrom(this.currentCamera),this.currentCamera.copyFrom(r)}onControllerStart(e){this.state=In.Running,this.startCamera.copyFrom(e),this.currentCamera.copyFrom(e)}onControllerEnd(e){e.copyViewFrom(this.currentCamera)}commitCamera(){this._lastInteraction=performance.now(),setTimeout(()=>this.notifyChange("isInteractive"),gwe),this.view.state.updateCamera(e=>this.stepController(0,e)),this.steppingFinished&&this.finishController()}};d([p({readOnly:!0})],Ny.prototype,"isInteractive",null),d([p()],Ny.prototype,"_lastInteraction",void 0),Ny=d([I("esri.views.3d.state.controllers.InteractiveController")],Ny);var Hu;(function(t){t[t.CENTER=0]="CENTER",t[t.EYE=1]="EYE"})(Hu||(Hu={}));let gD=class extends Ny{get _intersectionHelper(){return this.view.sceneIntersectionHelper}constructor(e){super(e),this.pivot=Hu.CENTER,this._rotScale=0,this._lastPoint=Qe(),this._tmpWorldUp=A(),this._tmpViewDir=A(),this._tmpRotCurPoint=Qe(),this._tmpTransf=Me(),this._tmpAxis=A(),this._tmpPivotPoint=A(),this._pivotPos=A(),this._constraintOptions={selection:un.ALL,interactionType:xr.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ha.TUMBLE}}initialize(){this._rotScale=this.pivot===Hu.CENTER?3:1.5}begin(e){if(this.active){switch(this.pivot){case Hu.EYE:oe(this._pivotPos,this.startCamera.eye),this._constraintOptions.interactionType=xr.LOOK_AROUND,this._constraintOptions.tiltMode=ha.LOOK_AROUND,this._constraintOptions.selection=un.NONE;break;case Hu.CENTER:{const r=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,this.view.map.ground.opacity===0?HE:{});r||oe(this._pivotPos,this.startCamera.center),this._constrainPivotPoint(e,r),this.startCamera.center=this._pivotPos,this._constraintOptions.interactionType=xr.TUMBLE,this._constraintOptions.tiltMode=ha.TUMBLE,this._constraintOptions.selection=un.ALL&~un.DISTANCE;break}}this._constraintOptions.interactionStartCamera=this.startCamera,R2(this.startCamera,e,this._lastPoint)}}_constrainPivotPoint(e,r){const i=this.startCamera,n=A();ve(n,this._pivotPos,i.eye);const s=We(n),o=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(i.eye,ywe);let a=Math.max(Math.min(I3t,1/Math.abs(ye(ywe,i.viewForward)))*o,L3t);r&&(a=Math.min(s,a));const l=Xr(this.view.spatialReference),c=Tn(i.width/i.pixelRatio*.5,i.height/i.pixelRatio*.5),u=IH(this.startCamera,c,l);let h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,i.fullWidth/i.pixelRatio*.5,i.fullHeight/i.pixelRatio*.5,i,2.5*pY,pY),f=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],i,pY);h==null&&f==null||(h=h??f??0,f=f==null||u===ca.Horizontal?h:f,a=h>f?f:h,a=r?Math.min(a,s):a),Se(n,n),oe(this._pivotPos,ge(this._tmpPivotPoint,i.eye,ce(this._tmpPivotPoint,n,a)))}update(e){if(this.active){switch(this.pivot){case Hu.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,e,this.currentCamera.center,this._pivotPos);break;case Hu.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,e,this.currentCamera.eye,this._pivotPos)}ws(this.view,this.currentCamera,this._constraintOptions),this.commitCamera()}}end(){this.active&&this.finishController()}_applyRotation(e,r,i,n){this.view.renderCoordsHelper.worldUpAtPosition(n,this._tmpWorldUp),R2(e,r,this._tmpRotCurPoint);let s=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale,o=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;ve(this._tmpViewDir,i,n);const a=We(this._tmpViewDir),l=Vo(ye(this._tmpViewDir,this._tmpWorldUp)/a);if(this.pivot===Hu.EYE){s*=-.5;const c=.5*Math.PI-l,u=.5*Math.PI*.99;s=c-Math.max(-u,Math.min(u,c+s))}return s=Te(s+l,Ja.min,Ja.max)-l,Lt(this._tmpAxis,e.up,this._tmpViewDir),this.pivot===Hu.CENTER&&(o=-o),Ch(this._tmpTransf,o,this._tmpWorldUp),sd(this._tmpTransf,this._tmpTransf,s,this._tmpAxis),lt(this._tmpViewDir,this._tmpViewDir,this._tmpTransf),e.up=lt(bY,e.up,this._tmpTransf),ge(bY,n,this._tmpViewDir),Eo(this._lastPoint,this._tmpRotCurPoint),bY}};d([p()],gD.prototype,"pivot",void 0),gD=d([I("esri.views.3d.state.controllers.RotateController")],gD);const bY=A(),ywe=A();let wY=class extends Ua{constructor(e,r,i,n){super(!0),this._view=e,this.pointerAction=r,this._pivot=i,this.registerIncoming("drag",n,s=>this._handleDrag(s))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!The(e.data,this.pointerAction))return;const i=Tn(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._cameraController=new gD({view:this._view,pivot:this._pivot}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}},Fie=class extends Ny{constructor(){super(...arguments),this._pickPoint=A(),this._tmpP0=Qe(),this._panAxisAngle=MH(),this._tmpRayDir=A(),this._tmpRayDirPick=A(),this._targetOnSphere=A(),this._navMode=ca.Horizontal,this._tmpRay={origin:A(),direction:A()},this.dragBeginPoint=Tn(),this._normalizedAnchorPoint=Qe(),this._constraintOptions={selection:un.ALL_EXCEPT_COLLISION,interactionType:xr.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:ha.TUMBLE},this._sphere=us(),this._hasPickPoint=!1}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Eo(this.dragBeginPoint,e),R2(this.startCamera,e,this._normalizedAnchorPoint);const r=Xr(this.view.spatialReference),i=zUe(this._intersectionHelper,this.startCamera,e,r,WP.Ellipsoid,this.view.map.ground.opacity===0?HE:{});if(this._navMode=IH(this.startCamera,e,r),this._navMode===ca.Horizontal)this._hasPickPoint=!!i.scenePickPoint,this._pickPoint=i.scenePickPoint??this._pickPoint,this._sphere=i.sphere;else{let n;Y3(this.startCamera,e,this._tmpRay),Se(this._tmpRay.direction,this._tmpRay.direction),i.scenePickPoint!=null&&(ve(this._tmpRayDirPick,this.startCamera.eye,i.scenePickPoint),n=We(this._tmpRayDirPick));const s=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,vwe);let o=Te(Math.min($Ue,1/Math.abs(ye(vwe,this._tmpRay.direction)))*s,FB[0],FB[1]);const a=this.view._stage.renderView.getMinimalDepthForArea(null,e[0],e[1],this.view.state.camera,$H);o=a??o,o=n!=null?Math.min(o,n):o,this._hasPickPoint=!0,ce(this._tmpRay.direction,this._tmpRay.direction,o),ge(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(this.active){if(this.currentCamera.eye=this.startCamera.eye,this.currentCamera.center=this.startCamera.center,this.currentCamera.up=this.startCamera.up,this._navMode===ca.Horizontal){ve(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);const r=We(this._tmpRayDir);R2(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;if(this._hasPickPoint&&n<r){const o=1-(1-n/r)*(1-this._sphere[3]/We(this.currentCamera.center));this.currentCamera.center=ce(t6,this.currentCamera.center,o)}ce(this._tmpRayDir,this._tmpRayDir,-n/r),this.currentCamera.eye=ge(t6,this.currentCamera.center,this._tmpRayDir),this._constraintOptions.interactionFactor=Rm(F_(this.dragBeginPoint,e)),ws(this.view,this.currentCamera,this._constraintOptions),this._hasPickPoint&&(XN(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),vhe(this._pickPoint,this._targetOnSphere,this._panAxisAngle),px(this.currentCamera,this._sphere,this._panAxisAngle))}else{const r=We(this._tmpRay.direction);R2(this.currentCamera,e,this._tmpP0);const i=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);let n=r*2**i;const s=this.view.state.constraints.minimumPoiDistance;if(i<0&&n<s&&(n=s),Math.abs(r-n)<1e-6)return;ce(this._tmpRayDir,this._tmpRay.direction,1-n/r),this.currentCamera.eye=ge(t6,this.currentCamera.eye,this._tmpRayDir),this.currentCamera.center=ge(t6,this.currentCamera.center,this._tmpRayDir)}X3(this.view,this.currentCamera),this.commitCamera()}}end(){this.active&&this.finishController()}};Fie=d([I("esri.views.3d.state.controllers.global.ZoomController")],Fie);const t6=A(),vwe=A();let kie=class extends Ny{constructor(){super(...arguments),this._tmpP=A(),this._tmpDir=A(),this._tmpN=A(),this._tmpP0=Qe(),this._tmpPoi=A(),this._tmpRayDir=A(),this.dragBeginPoint=Tn(),this._normalizedAnchorPoint=Qe(),this._constraintOptions={selection:un.ALL,interactionType:xr.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:A(),tiltMode:ha.TUMBLE},this._plane=oi()}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){if(!this.active)return;Eo(this.dragBeginPoint,e),R2(this.startCamera,e,this._normalizedAnchorPoint);const r=this._intersectionHelper.intersectScreenFreePointFallback(e,this._tmpP,this.view.map.ground.opacity===0?HE:{});ve(this._tmpDir,this._tmpP,this.startCamera.eye);const i=We(this._tmpDir);Se(this._tmpDir,this._tmpDir);const n=Math.abs(this.view.camera.position.z);let s=Te(Math.min($Ue,1/Math.abs(ye(lMt,this._tmpDir)))*n,FB[0],FB[1]);const o=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,e[0],e[1],this.view.state.camera,$H);s=o??s,s=r?Math.min(s,i):s,ce(this._tmpDir,this._tmpDir,s),ge(this._tmpP,this.startCamera.eye,this._tmpDir),ve(this._tmpN,this.startCamera.eye,this.startCamera.center),Se(this._tmpN,this._tmpN),this._tmpN[1]<0&&Nl(this._tmpN,this._tmpN),gF(this._tmpP,this._tmpN,this._plane),this._constraintOptions.interactionStartCamera=this.startCamera}update(e){if(!this.active)return;D3t(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||oe(this._tmpPoi,this.currentCamera.center),R2(this.currentCamera,e,this._tmpP0);let r=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);Eo(this._normalizedAnchorPoint,this._tmpP0),ve(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);const i=We(this._tmpRayDir);let n=i*(1-r);this._constraintOptions.interactionDirection&&(oe(this._constraintOptions.interactionDirection,this._tmpRayDir),ce(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(r)/i));const s=this.view.state.constraints.minimumPoiDistance;r>=0&&n<s&&(n=s,r=-(n-i)/i),Math.abs(i-n)<1e-6||(ce(this._tmpRayDir,this._tmpRayDir,r),this.currentCamera.eye=ge(Jx,this.currentCamera.eye,this._tmpRayDir),mi(Jx,this.currentCamera.center,this._tmpPoi,r),this._tmpPoi[2]>this.startCamera.center[2]?Jx[2]=Math.max(this.startCamera.center[2],Jx[2]):Jx[2]=Math.min(this.startCamera.center[2],Jx[2]),this.currentCamera.center=Jx,this._constraintOptions.interactionFactor=Rm(F_(this.dragBeginPoint,e)),ws(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}end(){this.active&&this.finishController()}};kie=d([I("esri.views.3d.state.controllers.local.ZoomController")],kie);const Jx=A(),lMt=Ue(0,0,1);let cMt=class extends Ua{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){const r=e.data;if(r.pointers.size>1||!The(e.data,this.pointerAction))return;const i=Tn(r.center.x,r.center.y);switch(r.action){case"start":this._cameraController&&(this._cameraController.end(),this._cameraController=null),this._view.state.isGlobal?this._cameraController=new Fie({view:this._view}):this._cameraController=new kie({view:this._view}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":this._cameraController&&this._cameraController.update(i);break;case"end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};function $f(t){let e=t*t;return t<0&&(e*=-1),e}function _we(t,e,r){const i=r,n=t.state,s=t.device,o=e.tiltDirection==="forward-down"?1:-1,a=1;return s.deviceType==="standard"?(i.translation[0]=$f(n.axes[0]),i.translation[1]=$f(n.axes[1]),i.translation[2]=$f(n.buttons[7])-$f(n.buttons[6]),i.heading=$f(n.axes[2]),i.tilt=$f(n.axes[3])):s.deviceType==="spacemouse"&&(i.translation[0]=1.2*$f(n.axes[0]),i.translation[1]=1.2*$f(n.axes[1]),i.translation[2]=2*-$f(n.axes[2]),i.heading=1.2*$f(n.axes[5]),i.tilt=1.2*$f(n.axes[3])),i.tilt*=o,ce(i.translation,i.translation,a),i}function bwe(t,e){const r=e;return r.translation[0]=t[1]-t[0],r.translation[1]=t[3]-t[2],r.translation[2]=t[4]-t[5],r.heading=t[7]-t[6],r.tilt=t[8]-t[9],r.zoom=t[10]-t[11],r}function xY(t){return t.translation[0]===0&&t.translation[1]===0&&t.translation[2]===0&&t.heading===0&&t.tilt===0&&t.zoom===0}let c2=class extends Ny{constructor(e){super(e),this._filteredSurfaceElevation=0,this._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0},this._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0],this._tmpCamera=new Bt,this._headingStart=0,this._constraintOptions={selection:un.ALL,interactionType:xr.NONE,interactionStartCamera:new Bt,interactionFactor:0,interactionDirection:null,tiltMode:ha.LOOK_AROUND}}handleEventGamepad(e){const r=_we(e,this.view.navigation.gamepad,this._transformation);(e.action==="end"||xY(r))&&this.finishController()}activateDirection(e){this._keysButtonState[e]=1,bwe(this._keysButtonState,this._transformation)}deactivateDirection(e){this._keysButtonState[e]=0;const r=bwe(this._keysButtonState,this._transformation);xY(r)&&this.finishController()}onControllerStart(e){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z,this._headingStart=this.view.camera.heading,super.onControllerStart(e)}_updateFilteredSurfaceElevation(e){const r=this.view.pointsOfInterest.cameraOnSurface.location.z,i=1;this._filteredSurfaceElevation+=i*(r-this._filteredSurfaceElevation)*e}stepController(e,r){var i;this._updateStartHeading(),this._updateFilteredSurfaceElevation(e),this.currentCamera.copyViewFrom(r),this._updateCameraCenter(),(i=this._constraintOptions.interactionStartCamera)==null||i.copyFrom(this.currentCamera),this._calculateControlTransformation(e,this.currentCamera,Kx),this._applyDisabledMovementTypes(Kx),this._applyPan(Kx.pan),this._applyRotate(Kx.rotate),this._applyZoom(Kx.zoom),this._applyAscend(Kx.ascend),this._constraintOptions.interactionType=xr.NONE,this._constraintOptions.selection=un.COLLISION,ws(this.view,this.currentCamera,this._constraintOptions),super.stepController(e,r)}_updateStartHeading(){this._transformation.heading!==0&&(this._headingStart=this.view.camera.heading)}_applyRotate(e){if(!e.enabled)return;const r=this.currentCamera;ve($c,r.center,r.eye),lt($c,$c,e.matrix),r.center=ge($c,$c,r.eye),r.up=lt($c,r.up,e.matrix),this._constraintOptions.interactionType=xr.LOOK_AROUND,this._constraintOptions.selection=un.ALL_EXCEPT_COLLISION,ws(this.view,r,this._constraintOptions)}_applyPan(e,r=this.currentCamera){e.enabled&&(r.eye=lt($c,r.eye,e.matrix),r.center=lt($c,r.center,e.matrix),this.view.state.isGlobal&&(r.up=lt($c,r.up,e.matrix)),this._constraintOptions.interactionType=xr.PAN,this._constraintOptions.selection=un.ALL,ws(this.view,r,this._constraintOptions))}_applyZoom(e){if(!e)return;const r=this.currentCamera.viewForward;this.currentCamera.eye=ge($c,this.currentCamera.eye,ce(ut.get(),r,e)),oe(JM,r),Nl(JM,JM),this._constraintOptions.interactionDirection=JM,this._constraintOptions.interactionType=xr.ZOOM,this._constraintOptions.selection=un.ALL_EXCEPT_COLLISION,ws(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_applyAscend(e){if(!e)return;const r=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,ut.get());if(this._constraintOptions.interactionDirection=oe(JM,r),this.view.state.isGlobal){const i=We(this.currentCamera.eye),n=(i+e)/i;this.currentCamera.eye=ce($c,this.currentCamera.eye,n),this.currentCamera.center=ce($c,this.currentCamera.center,n)}else{const i=ce(ut.get(),r,e);this.currentCamera.eye=ge($c,this.currentCamera.eye,i),this.currentCamera.center=ge($c,this.currentCamera.center,i)}this._updateCameraCenter(),this._constraintOptions.interactionType=xr.ASCEND,this._constraintOptions.selection=un.COLLISION,ws(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter(),this._constraintOptions.selection=un.ALL_EXCEPT_COLLISION,ws(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null}_calculateControlTransformation(e,r,i){gMt(i);const n=this._computeVelocities(e);this.view.state.isLocal?this._calculateControlTransformationLocal(n,r,i):this._calculateControlTransformationGlobal(n,r,i)}_updateCameraCenter(){const e=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,r=this.view.renderCoordsHelper,i=this.currentCamera.ray;this.currentCamera.center=r.intersectManifoldClosestSilhouette(i,e,$c)}_calculateControlTransformationLocal(e,r,i){const{viewRight:n,viewForward:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=se(ut.get(),s[0],s[1],0);Se(l,l);const c=o.translation[0]*e.pan;if(c!==0){const y=ce(ut.get(),n,c);hu(i.pan.matrix,i.pan.matrix,y),i.pan.enabled=!0}switch(a.mode){case"pan":{const y=-o.translation[1]*e.pan;if(y!==0){const _=ce(ut.get(),l,y);hu(i.pan.matrix,i.pan.matrix,_),i.pan.enabled=!0}i.zoom=o.zoom*e.zoom;break}case"zoom":i.zoom=(-o.translation[1]+o.zoom)*e.zoom;break;default:a.mode}const u=o.translation[2]*e.ascend;i.ascend=u;const h=-o.heading*e.rotate;h!==0&&(sd(i.rotate.matrix,i.rotate.matrix,h,this.view.renderCoordsHelper.worldUpAtPosition(r.eye,ut.get())),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=hx(this.view.renderCoordsHelper,r.center,r.eye),g=Te(m+f,Ja.min,Ja.max)-m;g&&(sd(i.rotate.matrix,i.rotate.matrix,g,n),i.rotate.enabled=!0)}_calculateControlTransformationGlobal(e,r,i){const{eye:n,viewRight:s}=r,o=this._transformation,a=this.view.navigation.gamepad,l=Lt(ut.get(),s,n);Se(l,l),Nl(l,l),V3t(this.startCamera,r,o,e,this.view.camera.heading,this._headingStart,this.view.camera.tilt,i,a),this._tmpCamera.copyFrom(this.currentCamera),this._applyPan(Kx.pan,this._tmpCamera);const c=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,u=o.translation[2]*e.ascend;i.ascend=u;const h=-o.heading*e.rotate;h!==0&&(sd(i.rotate.matrix,i.rotate.matrix,h,this._tmpCamera.eye),i.rotate.enabled=!0);const f=o.tilt*e.rotate,m=this._clampTiltDeltaGlobalToValidRange(f,r.ray,c);m!==0&&(sd(i.rotate.matrix,i.rotate.matrix,m,this._tmpCamera.viewRight),i.rotate.enabled=!0),i.zoom+=o.zoom*e.zoom}_clampTiltDeltaGlobalToValidRange(e,r,i){const n=Xr(this.view.spatialReference),s=Tz(Ja.min,r.origin,i,n);let o=0,a=0;const l=ut.get();if(this.view.renderCoordsHelper.intersectManifold(r,i,l)){const c=hx(this.view.renderCoordsHelper,l,r.origin);o=Tz(c,r.origin,i,n),a=Tz(Ja.max,r.origin,i,n)}else{V3(eH(tH,i+n.radius),r,l);const c=Math.PI+Q7(r.direction,l);o=nwe(c,r.origin,i,n),a=nwe(Ja.max,r.origin,i,n)}return Te(o+e,s,a)-o}_getPointAbsoluteSurfaceElevation(e,r,i){const{renderCoordsHelper:n}=this.view,s=n.getAltitude(e),o=r+Math.abs(s-r);return n.setAltitude(i,o,e),o}_clampedDistanceToSurface(e,r){const{renderCoordsHelper:i}=this.view,{camera:n}=this.view.state,{direction:s}=mSt(this.view,r,0,YUe,mMt),o=i.intersectManifoldClosestSilhouette(Ah(r,s),e,ut.get()),a=Li(r,o),l=i.intersectManifoldClosestSilhouette(Ah(r,H_(ut.get(),r,n.center)),e,ut.get()),c=Li(r,l);return Math.min(a,c)}_computeHeadingRotateRadius(e){const{renderCoordsHelper:r,state:i}=this.view,{camera:n,isGlobal:s}=i,o=r.intersectManifoldClosestSilhouette(n.ray,this._filteredSurfaceElevation,ut.get());if(s){const a=ve(ut.get(),e,o),l=We(a);ce(a,a,1/l);const c=Se(ut.get(),e),u=Vo(ye(c,a));return l*Math.sin(Math.min(dMt,u))}{const a=oe(ut.get(),e);return r.setAltitude(a,this._filteredSurfaceElevation),Li(o,a)}}_minimumAscendVelocity(){return this.view.state.constraints.collision.enabled?0:hMt}_computeVelocities(e){const r=this._filteredSurfaceElevation,i=r+Xr(this.view.spatialReference).radius,{camera:n,isGlobal:s}=this.view.state,o=ut.get(),a=this._getPointAbsoluteSurfaceElevation(n.eye,r,o),l=this._clampedDistanceToSurface(r,o),c=n.width/2,u=wwe*n.width,h=wwe*n.width,f=l*Math.tan(.5*n.fovX)/c,m=f/i,g=f/this._computeHeadingRotateRadius(o),y=a-r;return{pan:(s?m:f)*u*e,ascend:Math.max(this._minimumAscendVelocity()*e,2**(u*e/c)*y-y),zoom:2**(u*e/c)*l-l,rotate:Te(g*h,pMt,fMt)*e}}_applyDisabledMovementTypes(e){this.disableMovements==null||this.disableMovements.mode!==void 0&&this.view.state.viewingMode!==this.disableMovements.mode||(e.zoom=this.disableMovements.zoom?0:e.zoom,e.ascend=this.disableMovements.ascend?0:e.ascend,e.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&af(e.pan.matrix),e.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&af(e.rotate.matrix))}static activatesFor(e,r){const i=_we(r,e.navigation.gamepad,uMt);return!(r.action==="end"||xY(i))}};d([p({constructOnly:!0})],c2.prototype,"gamepadDevice",void 0),d([p({constructOnly:!0})],c2.prototype,"disableMovements",void 0),c2=d([I("esri.views.3d.state.controllers.GamepadKeyboardController")],c2);const uMt={translation:[0,0,0],heading:0,tilt:0,zoom:0},YUe=80,dMt=sr(YUe),wwe=.75,hMt=5,pMt=sr(30),fMt=sr(80),Kx={zoom:0,ascend:0,pan:{enabled:!1,matrix:Me()},rotate:{enabled:!1,matrix:Me()}},$c=A(),JM=A(),mMt=vde();function gMt(t){t.zoom=0,t.ascend=0,t.pan.enabled=!1,af(t.pan.matrix),t.rotate.enabled=!1,af(t.rotate.matrix)}let yMt=class extends Ua{constructor(e){super(!0),this._view=e,this._watchHandles=new Ri,this._handle=this.registerIncoming("gamepad",r=>this._handleEventGamepad(r)),this._handle.pause()}onInstall(e){super.onInstall(e),this._watchHandles.add([pe(()=>this._view.navigation.gamepad.enabled,r=>{r?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null))},_r),pe(()=>this._view.navigation.gamepad.device,r=>{this._cameraControllerGamepad&&r&&this._cameraControllerGamepad.gamepadDevice!==r&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])}onUninstall(){this._watchHandles.removeAll(),super.onUninstall()}_handleEventGamepad(e){const r=this._view.navigation.gamepad.device;if(r&&e.data.device!==r)return;const i=this._cameraControllerGamepad&&this._cameraControllerGamepad.active;if(i||c2.activatesFor(this._view,e.data)){if(!i){const n=new c2({view:this._view,gamepadDevice:e.data.device});this._view.state.switchCameraController(n)&&(this._cameraControllerGamepad=n)}this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)}}};var Fu;(function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.FORWARD=2]="FORWARD",t[t.BACKWARD=3]="BACKWARD",t[t.UP=4]="UP",t[t.DOWN=5]="DOWN",t[t.HEADINGLEFT=6]="HEADINGLEFT",t[t.HEADINGRIGHT=7]="HEADINGRIGHT",t[t.TILTUP=8]="TILTUP",t[t.TILTDOWN=9]="TILTDOWN",t[t.ZOOMIN=10]="ZOOMIN",t[t.ZOOMOUT=11]="ZOOMOUT"})(Fu||(Fu={}));let vMt=class extends Ua{constructor(e,r){super(!0),this._view=e,this._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:at.Local},this._keyToNumber={[r.left]:Fu.LEFT,[r.right]:Fu.RIGHT,[r.forward]:Fu.FORWARD,[r.backward]:Fu.BACKWARD,[r.up]:Fu.UP,[r.down]:Fu.DOWN,[r.headingLeft]:Fu.HEADINGLEFT,[r.headingRight]:Fu.HEADINGRIGHT,[r.tiltUp]:Fu.TILTUP,[r.tiltDown]:Fu.TILTDOWN,[r.zoomIn]:Fu.ZOOMIN,[r.zoomOut]:Fu.ZOOMOUT},this.registerIncoming("key-down",null,i=>this._handleKeyDown(i)),this.registerIncoming("key-up",null,i=>this._handleKeyUp(i)),this.registerIncoming("blur",null,()=>this._handleBlur())}_handleKeyDown(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new c2({view:this._view,disableMovements:this._disableMovements}),this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(r),e.stopPropagation()))}_handleBlur(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)}_handleKeyUp(e){if(e.data.native.ctrlKey||e.data.native.metaKey)return;const r=this._keyToNumber[e.data.key];r!=null&&this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(r),e.stopPropagation())}},_Mt=class extends Ua{constructor(e,r){super(!0),this._view=e,this.registerIncoming("mouse-wheel",r,i=>this._handleMouseWheel(i))}_handleMouseWheel(e){if(!this._view.navigation.mouseWheelZoomEnabled)return;const r=e.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new VB({view:this._view,mode:"interaction"}):new BB({view:this._view,mode:"interaction"}),this._view.state.switchCameraController(this._cameraController)),this._cameraController.zoomStep(-1/60*r.deltaY,Tn(r.x,r.y)),e.preventDefault(),e.stopPropagation()}},jB=class{constructor(e){this._gain=e}reset(e){this._value=e}set gain(e){this._gain=e}get value(){return this._value===void 0?0:this._value}update(e){this._value===void 0?this._value=e:this._value=this._gain*e+(1-this._gain)*this._value}},fE=class extends qN{constructor(){super(...arguments),this._beginCamera=new Bt,this._elapsedTimeSec=0,this.constraintOptions={selection:un.ALL,interactionType:xr.PAN,interactionFactor:0,interactionStartCamera:new Bt,interactionDirection:null,tiltMode:ha.TUMBLE}}initialize(){this.constraintOptions.interactionType=this.interactionType,this.viewAnimation=new VP}get steppingFinished(){return this.momentum.isFinished(this._elapsedTimeSec)}onControllerStart(e){this._beginCamera.copyFrom(e),this.constraintOptions.interactionStartCamera=this._beginCamera,super.onControllerStart(e)}stepController(e,r){r.copyViewFrom(this._beginCamera),this._elapsedTimeSec+=e,this.momentumStep(this._elapsedTimeSec,r),ws(this.view,r,this.constraintOptions)}};fE=d([I("esri.views.3d.state.controllers.momentum.MomentumController")],fE);let yD=class extends fE{constructor(e){super(e),this.interactionType=xr.PAN,this._tmpPan=A()}momentumStep(e,r){const i=this.momentum.value(e);ce(this._tmpPan,this.momentum.direction,i),r.eye=ve(xwe,r.eye,this._tmpPan),r.center=ve(xwe,r.center,this._tmpPan),this.constraintOptions.interactionDirection=this._tmpPan}};d([p({constructOnly:!0})],yD.prototype,"momentum",void 0),yD=d([I("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],yD);const xwe=A(),bMt=A(),r6=A();let Cz=class extends fE{constructor(e){super(e),this.interactionType=xr.PAN}momentumStep(e,r){const i=this.momentum.value1(e),n=this.momentum.value2(e);oe(r6,r.eye),Se(r6,r6),Lt(this.momentum.axis2,r6,this.momentum.axis1),GUe(r,bMt,this.momentum.axis1,i,this.momentum.axis2,n)}};d([p({constructOnly:!0})],Cz.prototype,"momentum",void 0),Cz=d([I("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],Cz);let BT=class extends fE{set center(e){this._set("center",qi(e))}set axis(e){this._set("axis",qi(e))}constructor(e){super(e),this.interactionType=xr.TUMBLE}momentumStep(e,r){const i=this.momentum.value(e);px(r,this.center,WN(this.axis,i))}};d([p({constructOnly:!0})],BT.prototype,"momentum",void 0),d([p({constructOnly:!0})],BT.prototype,"center",null),d([p({constructOnly:!0})],BT.prototype,"axis",null),BT=d([I("esri.views.3d.state.controllers.momentum.MomentumController")],BT);let QO=class extends fE{set zoomCenter(e){this._set("zoomCenter",qi(e))}constructor(e){super(e),this.interactionType=xr.ZOOM,this.constraintOptions.interactionDirection=A()}momentumStep(e,r){const{interactionDirection:i}=this.constraintOptions;if(!i)return;oe(i,r.eye);const n=this.momentum.valueDelta(0,e);whe(r,this.zoomCenter,n,this.view.state.constraints.minimumPoiDistance),H_(i,r.eye,i)}};d([p({constructOnly:!0})],QO.prototype,"momentum",void 0),d([p({constructOnly:!0})],QO.prototype,"zoomCenter",null),QO=d([I("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],QO);let rT=class extends fE{set screenCenter(e){this._set("screenCenter",Tn(e[0],e[1]))}set sceneCenter(e){this._set("sceneCenter",qi(e))}constructor(e){super(e),this.interactionType=xr.ZOOM,this.radius=0,this._tmpSceneCenter=A(),this._tmpZoomAxisAngle=MH(),this._sphere=us()}initialize(){this._sphere[3]=this.radius}momentumStep(e,r){const i=this.momentum.valueDelta(0,e);kUe(this._sphere,r,i),this.constraintOptions.interactionType=xr.ZOOM,ws(this.view,r,this.constraintOptions),XN(this._sphere,r,this.screenCenter,this._tmpSceneCenter),vhe(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle),px(r,this._sphere,this._tmpZoomAxisAngle),this.constraintOptions.interactionType=xr.PAN}};d([p({constructOnly:!0})],rT.prototype,"momentum",void 0),d([p({constructOnly:!0})],rT.prototype,"screenCenter",null),d([p({constructOnly:!0})],rT.prototype,"sceneCenter",null),d([p({constructOnly:!0})],rT.prototype,"radius",void 0),rT=d([I("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],rT);let Om=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const r=this.computeDelta(e);this._updateDelta(r)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return this.lastValue!==void 0}hasFilteredDelta(){return this.filteredDelta!==void 0}computeDelta(e){return this.lastValue===void 0?NaN:e-this.lastValue}_updateDelta(e){this.filteredDelta!==void 0?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},LH=class{constructor(e,r,i){this._initialVelocity=e,this._stopVelocity=r,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,r){const i=this.value(e);return this.value(e+r)-i}valueFromInitialVelocity(e,r){r=Math.min(r,this.duration);const i=1-this.friction;return e*(i**r-1)/Math.log(i)}},wMt=class extends LH{constructor(e,r,i,n,s){super(e,r,i),this._sceneVelocity=n,this.direction=s}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}},ZUe=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._time=new Om(.6),this._screen=[new Om(.4),new Om(.4)],this._scene=[new Om(.6),new Om(.6),new Om(.6)],this._tmpDirection=A()}add(e,r,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(r[0]),this._scene[1].update(r[1]),this._scene[2].update(r[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?0:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=n==null||i==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){se(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=We(this._tmpDirection);n>0&&ce(this._tmpDirection,this._tmpDirection,1/n);const s=this._time.filteredDelta;return new wMt(e,r,i,s==null?0:n/s,this._tmpDirection)}},Swe=class{constructor(e){this._gain=e}update(e){this.filteredValue!==void 0?this.filteredValue=(1-this._gain)*this.filteredValue+this._gain*e:this.filteredValue=e}reset(){this.filteredValue=void 0}get hasFilteredValue(){return this.filteredValue!==void 0}};const Twe=1e-5;let xMt=class extends LH{constructor(e,r,i,n,s,o=0,a){super(e,r,i),this._angularVelocity1=n,this.axis1=s,this.angularVelocity2=o,this.axis2=a}value1(e){return super.valueFromInitialVelocity(this._angularVelocity1,e)}value2(e){return super.valueFromInitialVelocity(this.angularVelocity2,e)}},SMt=class{constructor(e=300,r=12,i=.84){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this.enabled=!0,this._tmpAxis1=A(),this._tmpAxis2=A(),this._tmpAngles=Qe(),this._time=new Om(.3),this._screen=[new Om(.4),new Om(.4)],this._angle1=new Swe(.6),this._angle2=new Swe(.6),this._axis1=A(),this._axis2=A(),this._lastScene=A()}addMomentumDirectRotation(e,r,i,n,s,o){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;let a=BUe(this._lastScene,r,this._tmpAxis2,n,s,o);this._angle2.update(0),Al(this._tmpAxis2)<Twe?a=0:Se(this._axis1,this._tmpAxis2),this._angle1.update(a),oe(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}addMomentumPreserveHeading(e,r,i,n,s,o,a){if(this.enabled){if(this._time.hasLastValue()){if(this._time.computeDelta(i)<.01)return;jUe(this._lastScene,r,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,n,s,o,a,!1),Al(this._tmpAxis2)<Twe?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),this._angle2.update(this._tmpAngles[0]),Se(this._axis1,this._tmpAxis1),Se(this._axis2,this._tmpAxis2)),oe(this._lastScene,r)}this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._angle1.reset(),this._angle2.reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,r=this._screen[1].filteredDelta,i=e==null||r==null?null:Math.sqrt(e*e+r*r),n=this._time.filteredDelta,s=i==null||n==null?0:i/n;return Math.abs(s)<this._minimumInitialVelocity?null:this.createMomentum(s,this._stopVelocity,this._friction)}createMomentum(e,r,i){const n=this._time.filteredDelta,s=this._angle1.filteredValue,o=this._angle2.filteredValue,a=n==null||o==null?0:o/n;return new xMt(e,r,i,n==null||s==null?0:s/n,this._axis1,a,this._axis2)}},JUe=class{constructor(e=2.5,r=.01,i=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=r,this._friction=i,this._maxVelocity=n,this.enabled=!0,this.value=new Om(.8),this.time=new Om(.3)}add(e,r){if(this.enabled&&r!=null){if(this.time.hasLastValue()){if(this.time.computeDelta(r)<.01)return;if(this.value.hasFilteredDelta()){const i=this.value.computeDelta(e);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(r),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=Te(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,r,i){return new LH(e,r,i)}},KUe=class extends JUe{constructor(e=3,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){const i=this.value.lastValue;if(i!=null){let n=e-i;for(;n>Math.PI;)n-=2*Math.PI;for(;n<-Math.PI;)n+=2*Math.PI;e=i+n}super.add(e,r)}},TMt=class extends LH{constructor(e,r,i){super(e,r,i)}value(e){const r=super.value(e);return Math.exp(r)}valueDelta(e,r){const i=super.value(e),n=super.value(e+r)-i;return Math.exp(n)}},QUe=class extends JUe{constructor(e=2.5,r=.01,i=.95,n=12){super(e,r,i,n)}add(e,r){super.add(Math.log(e),r)}createMomentum(e,r,i){return new TMt(e,r,i)}},Uie=class extends Ny{constructor(){super(...arguments),this._smoothRotation=new jB(.05),this._rotationAxis=A(),this._beginAngle=0,this._beginHeading=0,this._panningPlane=oi(),this._beginRadius=0,this._smoothScaling=new jB(.05),this._zoomCenterScreen=Tn(),this._zoomMomentumEstimator=new QUe,this._rotationMomentumEstimator=new KUe,this._panSphericalMomentumEstimator=new SMt,this._panPlanarMomentumEstimator=new ZUe,this._adjustedSphere=us(),this._tmp3d=A(),this._tmpScreenPointArray=Tn(),this._beginScreenPoint=Tn(),this._beginScenePoint=A(),this._screenPickPoint=Tn(),this._scenePickPoint=A(),this._mode=ca.Horizontal,this._sphere=us(),this._pointerCount=0,this._tmpInteractionDirection=A(),this._constraintOptions={selection:un.ALL,interactionType:xr.NONE,interactionFactor:0,interactionStartCamera:new Bt,interactionDirection:null,tiltMode:ha.TUMBLE}}get _intersectionHelper(){return this.view.sceneIntersectionHelper}begin(e){var s;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panPlanarMomentumEstimator.enabled=r,this._panSphericalMomentumEstimator.enabled=r,this._beginHeading=-Yw.normalize(sr(this.view.camera.heading)),this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._smoothRotation.reset(),Oy(e.center,this._screenPickPoint),Eo(this._beginScreenPoint,this._screenPickPoint);const i=Xr(this.view.spatialReference),n=zUe(this._intersectionHelper,this.startCamera,this._screenPickPoint,i,WP.Silhouette,this.view.map.ground.opacity===0?HE:{});n.scenePickPoint!=null&&(this._scenePickPoint=n.scenePickPoint,this._sphere=n.sphere,oe(this._beginScenePoint,this._scenePickPoint),this._mode=IH(this.startCamera,this._screenPickPoint,i),this._mode===ca.Vertical&&this._preparePlanarPanMode(e,n.hasGeometryIntersection),(s=this._constraintOptions.interactionStartCamera)==null||s.copyFrom(this.startCamera))}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1;this._mode===ca.Horizontal?(r&&this._zoomSpherical(e),this._panningSpherical(e),r&&this._rotateSpherical(e)):(r&&this._zoomPlanar(e),this._panningPlanar(e),r&&this._rotatePlanar(e)),this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return this._mode===ca.Horizontal?new rT({view:this.view,momentum:r,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,radius:this._sphere[3]}):new QO({view:this.view,momentum:r,zoomCenter:this._beginScenePoint});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new BT({view:this.view,momentum:i,center:this._sphere,axis:this._rotationAxis});if(this._mode===ca.Horizontal){const n=this._panSphericalMomentumEstimator.evaluateMomentum();if(n)return new Cz({view:this.view,momentum:n})}else{const n=this._panPlanarMomentumEstimator.evaluateMomentum();if(n)return new yD({view:this.view,momentum:n})}return null}_preparePlanarPanMode(e,r){const i=Nl(this._tmp3d,this.startCamera.viewForward);gF(this._scenePickPoint,i,this._panningPlane);const n=Tn(this._screenPickPoint[0],0),s=A(),o=We(this.startCamera.eye);this._adjustedSphere[3]=o<this._sphere[3]?o-100:this._sphere[3],XN(this._adjustedSphere,this.startCamera,n,s);const a=ua();this.startCamera.projectToRenderScreen(s,a);const l=A(),c=A(),u=A();ve(l,this._scenePickPoint,this.currentCamera.eye);const h=We(l);Se(l,l);const f=NUe*Math.max(Math.abs(this.view.camera.position.z),FUe),m=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,$H);let g=m??f;g=r?Math.min(g,h):g,oe(u,ge(c,this.currentCamera.eye,ce(c,l,g))),this._panningPlane[3]=-ye(this._panningPlane,u),this.startCamera.center=ge(c,this.startCamera.eye,ce(c,this.startCamera.viewForward,g));const y=Oy(e.center,this._tmpScreenPointArray);Nie(this._panningPlane,this.startCamera,y,this._beginScenePoint)}_zoomSpherical(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),kUe(this._sphere,this.currentCamera,this._smoothScaling.value),Oy(e.center,this._zoomCenterScreen),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),this._constraintOptions.interactionType=xr.ZOOM,this._constraintOptions.interactionFactor=Rm(e.radius-this._beginRadius),ws(this.view,this.currentCamera,this._constraintOptions)}_panningSpherical(e){const r=Oy(e.center,this._tmpScreenPointArray);XN(this._sphere,this.currentCamera,r,this._tmp3d),xhe(this._beginScenePoint,ye(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(qUe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):(HUe(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(r,this._tmp3d,.001*e.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt)),this._constraintOptions.interactionType=xr.PAN,this._constraintOptions.interactionFactor=Rm(F_(this._screenPickPoint,r)),ws(this.view,this.currentCamera,this._constraintOptions)}_rotateSpherical(e){Se(this._rotationAxis,this._scenePickPoint),this.currentCamera.aboveGround||Nl(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value,i=r+Die(e.angle-r),n=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=n,this._smoothRotation.update(i);const s=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(s,.001*e.timestamp),px(this.currentCamera,this._sphere,WN(this._rotationAxis,s)),this._constraintOptions.interactionType=xr.TUMBLE,this._constraintOptions.interactionFactor=Rm(e.radius*i),ws(this.view,this.currentCamera,this._constraintOptions)}_panningPlanar(e){const r=Oy(e.center,this._tmpScreenPointArray);Nie(this._panningPlane,this.currentCamera,r,this._tmp3d)&&(VUe(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(r,this._tmp3d,.001*e.timestamp),this._constraintOptions.interactionType=xr.PAN,this._constraintOptions.interactionFactor=Rm(F_(this._beginScreenPoint,r)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),ws(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)}_zoomPlanar(e){const r=this._beginRadius/e.radius,i=.001875*Math.min(Math.max(e.radius,40),120);this._smoothScaling.gain=i,this._smoothScaling.update(r),this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*e.timestamp),whe(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance),this._constraintOptions.interactionType=xr.ZOOM,this._constraintOptions.interactionFactor=Rm(e.radius-this._beginRadius),ws(this.view,this.currentCamera,this._constraintOptions)}_rotatePlanar(e){oe(this._rotationAxis,this._beginScenePoint),this.currentCamera.aboveGround||Nl(this._rotationAxis,this._rotationAxis);const r=this._smoothRotation.value;let i=e.angle-r;i=Die(i);const n=r+i,s=.00125*Math.min(Math.max(e.radius,40),120);this._smoothRotation.gain=s,this._smoothRotation.update(n);const o=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(o,.001*e.timestamp),px(this.currentCamera,this._sphere,WN(this._rotationAxis,o)),this._constraintOptions.interactionType=xr.TUMBLE,this._constraintOptions.interactionFactor=Rm(e.radius*o),ws(this.view,this.currentCamera,this._constraintOptions)}};Uie=d([I("esri.views.3d.state.controllers.global.PinchAndPanController")],Uie);const Ewe=Ue(0,0,1),EMt={ELEVATION_THRESHOLD:3e4,ANGLE_THRESHOLD:16/180*Math.PI};let zie=class extends Ny{constructor(){super(...arguments),this._rotationValueSmooth=new jB(.05),this._scalingValueSmooth=new jB(.05),this._planeHorizontal=oi(),this._planeVertical=oi(),this._rotationMomentumEstimator=new KUe,this._panMomentumEstimator=new ZUe(300,12,.9),this._zoomMomentumEstimator=new QUe,this._beginRadius=0,this._beginCenter=A(),this._beginAngle=0,this._tmpPoints=[],this._panMode=ca.Horizontal,this._beginCenterScreen=Tn(),this._tmpCentroid3d=A(),this._tmpCentroid2d=Tn(),this._tmp2d=Tn(),this._pointerCount=0,this._constraintOptions={selection:un.ALL,interactionType:xr.NONE,interactionFactor:0,interactionStartCamera:new Bt,interactionDirection:null,tiltMode:ha.TUMBLE}}begin(e){var g;if(!this.active)return;const r=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=r,this._rotationMomentumEstimator.enabled=r,this._panMomentumEstimator.enabled=r,this._beginRadius=e.radius,this._pointerCount=e.pointers.size,this._beginAngle=e.angle,this._rotationValueSmooth.reset(),this._scalingValueSmooth.reset(),Oy(e.center,this._beginCenterScreen),XFe(Ewe,0,this._planeHorizontal);const i=A(),n=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,i,this.view.map.ground.opacity===0?HE:{}),s=A();Nl(s,this.startCamera.viewForward);const o=A();oe(o,Ewe);const a=ye(s,o),l=sf(a<0?-a:a);this._panMode=l>=EMt.ANGLE_THRESHOLD?ca.Horizontal:ca.Vertical;const c=Math.min(NUe,1/Math.abs(ye(o,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),FUe);Jte(this._planeHorizontal,this._planeHorizontal,i),this.startCamera.aboveGround||Kte(this._planeHorizontal,this._planeHorizontal);const u=A(),h=A(),f=A();ve(u,i,this.currentCamera.eye);const m=We(u);if(Se(u,u),this._panMode===ca.Vertical){ce(o,o,a),ve(this._planeVertical,s,o),Se(this._planeVertical,this._planeVertical),Jte(this._planeVertical,this._planeVertical,i);const y=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,$H);let _=y??c;_=n?Math.min(_,m):_,oe(f,ge(h,this.currentCamera.eye,ce(h,u,_))),this._planeVertical[3]=-ye(this._planeVertical,f),this._computePlanePoints(e.pointers,this._planeVertical,this.startCamera,this._tmpPoints),fY(this._tmpPoints,this._beginCenter)}else{const y=n?m:c;oe(f,ge(h,this.currentCamera.eye,ce(h,u,y))),this._planeHorizontal[3]=-ye(this._planeHorizontal,f),this._computePlanePoints(e.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints),fY(this._tmpPoints,this._beginCenter)}(g=this._constraintOptions.interactionStartCamera)==null||g.copyFrom(this.startCamera)}update(e){if(!this.active)return;this.currentCamera.copyFrom(this.startCamera);const r=e.pointers.size>1,i=this._panMode===ca.Horizontal?this._planeHorizontal:this._planeVertical,n=this._beginCenter;if(r){const s=this._beginRadius/e.radius,o=.001875*Math.min(Math.max(e.radius,40),120);this._scalingValueSmooth.gain=o,this._scalingValueSmooth.update(s),whe(this.currentCamera,n,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance),this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*e.timestamp),this._constraintOptions.interactionType=xr.ZOOM,this._constraintOptions.interactionFactor=Rm(Math.abs(e.radius-this._beginRadius)),ws(this.view,this.currentCamera,this._constraintOptions)}if(this._computePlanePoints(e.pointers,i,this.currentCamera,this._tmpPoints),fY(this._tmpPoints,this._tmpCentroid3d),Oy(e.center,this._tmpCentroid2d),VUe(this.currentCamera,n,this._tmpCentroid3d),this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*e.timestamp),this._constraintOptions.interactionType=xr.PAN,this._constraintOptions.interactionFactor=Rm(F_(this._beginCenterScreen,this._tmpCentroid2d)),ws(this.view,this.currentCamera,this._constraintOptions),r){const s=this._planeHorizontal,o=n,a=this._rotationValueSmooth.value,l=a+Die(e.angle-a),c=.00125*Math.min(Math.max(e.radius,40),120);this._rotationValueSmooth.gain=c,this._rotationValueSmooth.update(l);const u=this._rotationValueSmooth.value-this._beginAngle;this._rotationMomentumEstimator.add(u,.001*e.timestamp),px(this.currentCamera,o,WN(s,u)),this._constraintOptions.interactionType=xr.TUMBLE,this._constraintOptions.interactionFactor=Rm(Math.abs(e.radius*u)),ws(this.view,this.currentCamera,this._constraintOptions)}this.commitCamera()}end(e){e.pointers.size===this._pointerCount&&this.update(e),this.finishController();const r=this._zoomMomentumEstimator.evaluateMomentum();if(r)return new QO({view:this.view,momentum:r,zoomCenter:this._beginCenter});const i=this._rotationMomentumEstimator.evaluateMomentum();if(i)return new BT({view:this.view,momentum:i,center:this._beginCenter,axis:this._planeHorizontal});const n=this._panMomentumEstimator.evaluateMomentum();return n?new yD({view:this.view,momentum:n}):null}_computePlanePoints(e,r,i,n){n.length=e.size;const s=this._tmp2d;let o=0;return e.forEach(a=>{s[0]=a.x,s[1]=a.y,n[o]===void 0&&(n[o]=A()),Nie(r,i,s,n[o]),o+=1}),n}get _intersectionHelper(){return this.view.sceneIntersectionHelper}};zie=d([I("esri.views.3d.state.controllers.local.PinchAndPanController")],zie);let Cwe=class extends Ua{constructor(e,r,i){super(!0),this._view=e,this.pointerAction=r,this._lastEndTimestamp=0,this._lastTimestamp=0,this.registerIncoming("drag",i,n=>this._handleDrag(n))}_handleDrag(e){if(e.data.pointerType==="mouse"&&!The(e.data,this.pointerAction))return;const r=e.timestamp-this._lastEndTimestamp,i=40,n=this._momentum&&this._momentum.active&&r<i;switch(e.data.action){case"start":case"update":if(n)break;this._controller&&this._controller.active?e.data.timestamp-this._lastTimestamp>2&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case"end":case"removed":this._endController(e,!0);break;case"added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}_endController(e,r){if(this._controller&&this._controller.active){this._lastEndTimestamp=e.timestamp;const i=this._controller.end(e.data);r&&i&&(this._momentum=i,this._view.state.switchCameraController(this._momentum))}this._controller=null}_startController(e){this._controller=this._createController(),this._view.state.switchCameraController(this._controller),this._controller.begin(e.data),this._lastTimestamp=e.timestamp}_createController(){return this._view.state.isGlobal?new Uie({view:this._view}):new zie({view:this._view})}},CMt=class extends Ua{constructor(e,r){super(!0),this.view=e,this.registerIncoming("pointer-down",r,()=>this.view.state.stopActiveCameraController())}},e8e=class extends Ua{constructor(e,r){super(!0),this.key=e,this.registerIncoming("key-down",r,i=>this._handleKeyDown(i))}_handleKeyDown(e){e.data.key===this.key&&(this.activate(),e.stopPropagation())}},RMt=class extends e8e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({heading:0}).catch(()=>{})}},OMt=class extends e8e{constructor(e,r,i){super(r,i),this.view=e}activate(){this.view.goTo({tilt:0}).catch(()=>{})}},AMt=class extends Ua{constructor(e,r=!1){super(!0),this._view=e,this._invert=r,this.registerIncoming("vertical-two-finger-drag",i=>this._handleTwoFinger(i))}_handleTwoFinger(e){var n,s,o;const r=this._invert?-1:1,i=Tn(0,e.data.delta*r);switch(e.data.action){case"begin":(n=this._cameraController)==null||n.end(),this._cameraController=new gD({view:this._view,pivot:Hu.CENTER}),this._view.state.switchCameraController(this._cameraController),this._cameraController.begin(i);break;case"update":(s=this._cameraController)==null||s.update(i);break;case"end":(o=this._cameraController)==null||o.end(),this._cameraController=null}}};function Rwe(t){const e=t.native;return e?{buttons:e.buttons.map(r=>r.pressed?r.value||1:0),axes:e.axes.map(r=>$Mt(r,t.axisThreshold))}:{buttons:[],axes:[]}}function PMt(t,e){if(t.axes.length!==e.axes.length||t.buttons.length!==e.buttons.length)return!1;for(let r=0;r<t.axes.length;r++)if(t.axes[r]!==e.axes[r])return!1;for(let r=0;r<t.buttons.length;r++)if(t.buttons[r]!==e.buttons[r])return!1;return!0}function MMt(t){for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==0)return!1;for(let e=0;e<t.buttons.length;e++)if(t.buttons[e]!==0)return!1;return!0}function $Mt(t,e){const r=Math.abs(t);return r<e?0:Math.sign(t)*(r-e)/(1-e)}let IMt=class{constructor(e,r){this._element=e,this._input=r,this._hasEventListeners=!1,this._onConnectGamepad=s=>{this._connectGamepad(s.gamepad)},this._onDisconnectGamepad=s=>{const o=s.gamepad,a=o.index,l=this._inputDevices[a];l&&(this._emitGamepadEvent(o,Rwe(l),!1),this._inputDevices.splice(a,1),this._latestUpdate.splice(a,1),this._input.gamepad.devices.remove(l),this.ensurePollingState())},this._frameTask=null,this._latestUpdate=new Array,this._inputDevices=new Array,this._callback=null;const i="getGamepads"in window.navigator,n=window.isSecureContext;this.supported=i&&n,this.supported&&(this._forEachGamepad(s=>this._connectGamepad(s)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState())}destroy(){this.hasEventListeners=!1,this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))}set hasEventListeners(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}get _eventsEnabled(){return this.supported&&this._inputDevices.length>0&&this._hasEventListeners}set onEvent(e){this._callback=e}_connectGamepad(e){const r=new Lde(e);r.deviceType!=="unknown"&&(this._inputDevices[e.index]=r,this._input.gamepad.devices.add(r)),this.ensurePollingState()}ensurePollingState(){this._eventsEnabled?this._startPolling():this._stopPolling()}_startPolling(){this._frameTask==null&&(this._frameTask=hP({update:()=>this._readGamepadState()}))}_stopPolling(){this._frameTask!=null&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=new Array)}_readGamepadState(){const e=document.hasFocus(),r=this._element.contains(document.activeElement),i=this._input.gamepad.enabledFocusMode==="document"&&!e||this._input.gamepad.enabledFocusMode==="view"&&!r;this._forEachGamepad(n=>{const s=this._inputDevices[n.index];if(!s)return;const o=this._latestUpdate[n.index],a=Rwe(s),l=i||MMt(a);o&&(o.timestamp===n.timestamp||!o.active&&l||PMt(o.state,a))||this._emitGamepadEvent(n,a,!l)})}_forEachGamepad(e){const r=window.navigator.getGamepads();for(let i=0;i<r.length;i++){const n=r[i];this._validate(n)&&e(n)}}_emitGamepadEvent(e,r,i){const n=this._latestUpdate[e.index],s=n&&n.active;if(!s&&!i)return;const o=!s&&i?"start":s&&i?"update":"end";this._latestUpdate[e.index]={timestamp:e.timestamp,state:r,active:i},this._callback&&this._callback({device:this._inputDevices[e.index],state:r,action:o})}_validate(e){if(!e||!e.connected)return!1;for(let r=0;r<e.axes.length;r++)if(isNaN(e.axes[r]))return!1;return!0}};const Owe=he("edge"),LMt=he("chrome"),DMt=he("ff"),NMt=he("safari"),Awe="esri-view-surface",RC={touchNone:`${Awe}--touch-none`,touchPan:`${Awe}--touch-pan`};let t8e=class r8e{constructor(e,r){this._input=r,this._active={},this._callback=()=>{},this._activePointerCaptures=new Set,this._keyDownState=new Set,this._eventId=1,this._browserTouchPanningEnabled=!1,this._element=e,e.getAttribute("tabindex")||e.setAttribute("tabindex","0"),this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost},this._updateTouchAction(),this._element.addEventListener("keydown",this._preventAltKeyDefault),this._gamepadSource=new IMt(e,this._input),this._gamepadSource.onEvent=i=>this._callback("gamepad",i)}destroy(){this._callback=()=>{},this.activeEvents=null,this._activePointerCaptures.forEach(e=>{this._releasePointerCaptureSafe(e)}),this._gamepadSource=qe(this._gamepadSource),this._activePointerCaptures=null,this._removeTouchAction(),this._element.removeEventListener("keydown",this._preventAltKeyDefault)}get browserTouchPanningEnabled(){return this._browserTouchPanningEnabled}set browserTouchPanningEnabled(e){this._browserTouchPanningEnabled=e,this._updateTouchAction(),this._updateTouchEventHandling()}set onEventReceived(e){this._callback=e}set activeEvents(e){for(const r in this._active)if(!e||!e.has(r)){const i=this._active[r];this._element.removeEventListener(SY[r],i),delete this._active[r]}e&&e.forEach(r=>{if(!this._active[r]&&SY[r]){const i=(this._eventHandlers[r]||this._handleDefault).bind(this,r);this._element.addEventListener(SY[r],i),this._active[r]=i}}),this._gamepadSource.hasEventListeners=(e==null?void 0:e.has("gamepad"))??!1}setPointerCapture(e,r){r?this._setPointerCatpureSafe(e.pointerId):(this._releasePointerCaptureSafe(e.pointerId),this._activePointerCaptures.delete(e.pointerId))}_updateTouchAction(){this._element.classList.remove(this._browserTouchPanningEnabled?RC.touchNone:RC.touchPan),this._element.classList.add(this._browserTouchPanningEnabled?RC.touchPan:RC.touchNone)}_updateTouchEventHandling(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_removeTouchAction(){this._element.classList.remove(RC.touchNone),this._element.classList.remove(RC.touchPan),this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)}_setPointerCatpureSafe(e){try{this._element.setPointerCapture(e),this._activePointerCaptures.add(e)}catch{}}_releasePointerCaptureSafe(e){try{if(this._element.hasPointerCapture&&!this._element.hasPointerCapture(e))return;this._element.releasePointerCapture(e)}catch{}}_updateNormalizedPointerLikeEvent(e,r){const i=zke(this._element,e);return r8e.test.disableSubpixelCoordinates&&(i.x=Math.round(i.x),i.y=Math.round(i.y)),r.x=i.x,r.y=i.y,r}_handleKey(e,r){const i=OEt(r);i&&e==="key-up"&&this._keyDownState.delete(i);const n={native:r,key:i,repeat:!!i&&this._keyDownState.has(i)};i&&e==="key-down"&&this._keyDownState.add(n.key),this._callback(e,n)}_handlePointer(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});this._callback(e,i)}_handlePointerPreventDefault(e,r){const i=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,pointerType:r.pointerType,button:r.button,buttons:r.buttons,eventId:this._eventId++});r.preventDefault(),this._callback(e,i)}_handleMouseWheel(e,r){let i=r.deltaY;switch(r.deltaMode){case 0:Owe&&(i=i/document.documentElement.clientHeight*600);break;case 1:i*=30;break;case 2:i*=900}Owe?i*=.7:LMt||NMt?i*=.6:DMt&&(i*=1.375);const n=100,s=Math.abs(i);s>n&&(i=i/s*200/(1+Math.exp(-.02*(s-n))));const o=this._updateNormalizedPointerLikeEvent(r,{native:r,x:0,y:0,deltaY:i});this._callback(e,o)}_handlePointerCaptureLost(e,r){this._activePointerCaptures.delete(r.pointerId),this._handleDefault(e,r)}_handleDefault(e,r){const i={native:r};r.preventDefault(),this._callback(e,i)}_preventAltKeyDefault(e){e.key==="Alt"&&e.preventDefault()}_preventMultiTouchPanning(e){e.touches.length>1&&e.preventDefault()}};t8e.test={disableSubpixelCoordinates:!1};const SY={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};let FMt=class extends Ua{constructor(){super(!0),this.registerIncoming("context-menu",e=>{e.data.native.preventDefault()})}};function i8e(t,e){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function kMt(t,e){const r=e.x-t.x,i=e.y-t.y;return Math.sqrt(r*r+i*i)}function UMt(t,e){if(e?(e.radius=0,e.center.x=0,e.center.y=0):e={radius:0,center:Oh()},t.length===0)return e;if(t.length===1)return e.center.x=t[0].x,e.center.y=t[0].y,e;if(t.length===2){const[x,S]=t,[C,E]=[S.x-x.x,S.y-x.y];return e.radius=Math.sqrt(C*C+E*E)/2,e.center.x=(x.x+S.x)/2,e.center.y=(x.y+S.y)/2,e}let r=0,i=0;for(let x=0;x<t.length;x++)r+=t[x].x,i+=t[x].y;r/=t.length,i/=t.length;const n=t.map(x=>x.x-r),s=t.map(x=>x.y-i);let o=0,a=0,l=0,c=0,u=0,h=0,f=0;for(let x=0;x<n.length;x++){const S=n[x],C=s[x],E=S*S,R=C*C;o+=E,a+=R,l+=S*C,c+=E*S,u+=R*C,h+=S*R,f+=C*E}const m=.5*(c+h),g=.5*(u+f),y=o*a-l*l,_=(m*a-g*l)/y,b=(o*g-l*m)/y,w=Oh(_+r,b+i);return{radius:Math.sqrt(_*_+b*b+(o+a)/t.length),center:w}}function vD(t){const{native:e}=t,{pointerId:r,button:i,pointerType:n}=e;return n==="mouse"?`${r}:${i}`:`${n}`}let zMt=class extends Ua{constructor(e){super(!1),this._navigationTouch=e,this._startStateModifiers=new Set,this._activePointerMap=new Map,this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._drag=this.registerOutgoing("drag"),this.registerIncoming("pointer-drag",this._handlePointerDrag.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-capture-lost",this._handlePointerUpAndPointerLost.bind(this)),this.registerIncoming("pointer-cancel",this._handlePointerUpAndPointerLost.bind(this))}_createPayload(e,r,i,n){return{action:e,pointerType:this._pointerType,button:this._mouseButton,buttons:r.buttons,timestamp:n,pointers:VMt(this._activePointerMap),pointer:r,angle:i.angle,radius:i.radius,center:i.center}}_addPointer(e){const r=e.native.pointerId,i=i6(this._activePointerMap).angle,n={event:e,initialAngle:0,lastAngle:0};this._activePointerMap.set(r,n);const s=Rz(n,n8e(this._activePointerMap));n.initialAngle=s,n.lastAngle=s,this._updatePointerAngles(i)}_updatePointer(e){if(e&&e.x==null&&e.y==null)return;const r=e.native.pointerId,i=this._activePointerMap.get(r);i?i.event=e:this._addPointer(e)}_removePointer(e){const r=i6(this._activePointerMap).angle;this._activePointerMap.delete(e),this._updatePointerAngles(r)}_updatePointerAngles(e){const r=i6(this._activePointerMap);this._activePointerMap.forEach(i=>{i.initialAngle=Rz(i,r)-e,i.lastAngle=Rz(i,r)-e})}_emitEvent(e,r,i){const n=i6(this._activePointerMap);this._drag.emit(this._createPayload(e,r,n,i),void 0,this._startStateModifiers)}_handlePointerUpAndPointerLost(e){const r=e.data.native.pointerId,i=e.timestamp;this._activePointerMap.get(r)&&(this._activePointerMap.size===1?(this._updatePointer(e.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",e.data,i),this._isDragging=!1,this._isCurrentDragSuppressed=!1,this._removePointer(r)):(this._removePointer(r),this._emitEvent("removed",e.data,e.timestamp)))}_handlePointerDrag(e){const r=e.data,i=r.currentEvent,n=e.timestamp;switch(r.action){case"start":case"update":this._isDragging?this._activePointerMap.has(i.native.pointerId)?(this._updatePointer(i),!this._isCurrentDragSuppressed&&this._emitEvent("update",i,n)):(this._addPointer(i),this._emitEvent("added",i,n),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(i),this._pointerType=e.data.startEvent.pointerType,this._mouseButton=e.data.startEvent.button,this._startStateModifiers=e.modifiers,this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",i,n))}}get _isSuppressed(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&this._pointerType==="touch"&&this._activePointerMap.size===1}};function n8e(t){const e=[];return t.forEach(r=>{e.push(Oh(r.event.x,r.event.y))}),UMt(e)}function i6(t){const e=n8e(t);let r=0;return t.forEach(i=>{let n=Rz(i,e),s=n-i.lastAngle;for(;s>Math.PI;)s-=2*Math.PI;for(;s<-Math.PI;)s+=2*Math.PI;n=i.lastAngle+s,i.lastAngle=n;const o=n-i.initialAngle;r+=o}),r/=t.size||1,{angle:r,radius:e.radius,center:e.center}}function VMt(t){const e=new Map;return t.forEach((r,i)=>e.set(i,r.event)),e}function Rz(t,e){const r=t.event,i=r.x-e.center.x,n=r.y-e.center.y;return Math.atan2(n,i)}var Pwe;(function(t){t[t.Left=0]="Left",t[t.Middle=1]="Middle",t[t.Right=2]="Right",t[t.Back=3]="Back",t[t.Forward=4]="Forward",t[t.Undefined=-1]="Undefined"})(Pwe||(Pwe={}));const xw={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};let BMt=class extends Ua{constructor(e=xw.maximumDoubleClickDelay,r=xw.maximumDoubleClickDistance,i=xw.maximumDoubleTouchDelay,n=xw.maximumDoubleTouchDistance,s=z4){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",this._handleImmediateClick.bind(this)),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=yi(e.doubleClickTimer))}get hasPendingInputs(){return Pa(this._pointerState,e=>e.doubleClickTimer!=null)}_clearDoubleClickTimer(e,r){const i=this._pointerState.get(e);i&&(i.doubleClickTimer=yi(i.doubleClickTimer),r&&this._click.emit(i.event.data,void 0,i.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const r=this._pointerState.get(e);r.pointerDownCount===1&&this._click.emit(r.event.data,void 0,r.event.modifiers),r.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_getPointerId(e){const{pointerId:r,pointerType:i,button:n}=e.native;return i==="mouse"?`${r}:${n}`:`${i}`}_handleImmediateClick(e){const r=e.data,{pointerType:i}=r.native,n=this._getPointerId(r);if(!this._pointerState.has(n))return void this._startClick(e);const s=this._pointerState.get(n),{data:o,modifiers:a}=s.event,l=i==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;i8e(o,r)>l?(this._clearDoubleClickTimer(n,!0),this._startClick(e)):(this._clearDoubleClickTimer(n,!1),s.pointerDownCount===2&&this._doubleClick.emit(o,void 0,a))}_handlePointerDown(e){const r=vD(e.data),i=this._pointerState.get(r);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:r}=e,{native:{pointerType:i}}=r,n=vD(r),s=i==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(n),s),a=1;this._pointerState.set(n,{event:e,doubleClickTimer:o,pointerDownCount:a}),this.refreshHasPendingInputs()}},jMt=class extends Ua{constructor(e=xw.maximumDoubleClickDelay,r=xw.maximumDoubleClickDistance,i=xw.maximumDoubleTouchDelay,n=xw.maximumDoubleTouchDistance,s=z4){super(!1),this._maximumDoubleClickDelay=e,this._maximumDoubleClickDistance=r,this._maximumDoubleTouchDelay=i,this._maximumDoubleTouchDistance=n,this._clock=s,this._pointerState=new Map,this._immediateDoubleClick=this.registerOutgoing("immediate-double-click"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",this._handlePointerUp.bind(this))}onUninstall(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=vD(r);if(!this._pointerState.has(i)){const n={downButton:r.native.button,immediateDoubleClick:null};this._pointerState.set(i,n),this.startCapturingPointer(r.native)}}_handlePointerUp(e){const r=e.data,i=vD(r),n=this._pointerState.get(i);if(n&&n.downButton===r.native.button){const s=n.immediateDoubleClick;if(s){s.timeoutHandle.remove();const o=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;i8e(s,e.data)>o?this._startImmediateDoubleClick(e,n):(this._immediateDoubleClick.emit(e.data,void 0,s.modifiers),this._removeState(r))}else this._startImmediateDoubleClick(e,n)}}_startImmediateDoubleClick(e,r){const i=e.data.native.pointerType==="touch"?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay;r.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),i)}}_removeState(e){const r=vD(e);this._pointerState.delete(r),this.stopCapturingPointer(e.native),this.refreshHasPendingInputs()}};const KM={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};let GMt=class extends Ua{constructor(e=KM.maximumClickDelay,r=KM.movementUntilMouseDrag,i=KM.movementUntilPenDrag,n=KM.movementUntilTouchDrag,s=KM.holdDelay,o=z4){super(!1),this._maximumClickDelay=e,this._movementUntilMouseDrag=r,this._movementUntilPenDrag=i,this._movementUntilTouchDrag=n,this._holdDelay=s,this._clock=o,this._pointerState=new Map,this._pointerDrag=this.registerOutgoing("pointer-drag"),this._immediateClick=this.registerOutgoing("immediate-click"),this._pointerHold=this.registerOutgoing("hold"),this.registerIncoming("pointer-down",this._handlePointerDown.bind(this)),this.registerIncoming("pointer-up",a=>{this._handlePointerLoss(a,"pointer-up")}),this.registerIncoming("pointer-capture-lost",a=>{this._handlePointerLoss(a,"pointer-capture-lost")}),this.registerIncoming("pointer-cancel",a=>{this._handlePointerLoss(a,"pointer-cancel")}),this._moveHandle=this.registerIncoming("pointer-move",this._handlePointerMove.bind(this)),this._moveHandle.pause()}onUninstall(){this._pointerState.forEach(e=>{e.holdTimeout=yi(e.holdTimeout)}),super.onUninstall()}_handlePointerDown(e){const r=e.data,i=r.native.pointerId;let n=null;this._pointerState.size===0&&(n=this._clock.setTimeout(()=>{const o=this._pointerState.get(i);if(o){if(!o.isDragging){const a=o.previousEvent;this._pointerHold.emit(a,void 0,e.modifiers),o.holdEmitted=!0}o.holdTimeout=null}},this._holdDelay));const s={startEvent:r,previousEvent:r,startTimestamp:e.timestamp,isDragging:!1,downButton:r.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(i,s),this.startCapturingPointer(r.native),this._moveHandle.resume(),this._pointerState.size>1&&this._startDragging(e)}_createPointerDragData(e,r,i){return{action:e,startEvent:r.startEvent,previousEvent:r.previousEvent,currentEvent:i}}_handlePointerMove(e){const r=e.data,i=r.native.pointerId,n=this._pointerState.get(i);n&&(n.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",n,r),void 0,n.modifiers):kMt(r,n.startEvent)>this._getDragThreshold(r.native.pointerType)&&this._startDragging(e),n.previousEvent=r)}_getDragThreshold(e){switch(e){case"touch":return this._movementUntilTouchDrag;case"pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}}_startDragging(e){const r=e.data,i=r.native.pointerId;this._pointerState.forEach(n=>{n.holdTimeout!=null&&(n.holdTimeout.remove(),n.holdTimeout=null),n.isDragging||(n.modifiers=e.modifiers,n.isDragging=!0,i===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,r)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),e.timestamp))})}_handlePointerLoss(e,r){const i=e.data,n=i.native.pointerId,s=this._pointerState.get(n);s&&(s.holdTimeout!=null&&(s.holdTimeout.remove(),s.holdTimeout=null),s.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",s,r==="pointer-up"?i:s.previousEvent),void 0,s.modifiers):r==="pointer-up"&&s.downButton===i.native.button&&e.timestamp-s.startTimestamp<=this._maximumClickDelay&&!s.holdEmitted&&this._immediateClick.emit(i),this._pointerState.delete(n),this.stopCapturingPointer(i.native),this._pointerState.size===0&&this._moveHandle.pause())}},HMt=class{constructor(e){this._callbacks=e,this._currentCount=0,this._callbacks.condition||(this._callbacks.condition=()=>!0)}handle(e){const r=e.data,i=r.pointers.size;switch(r.action){case"start":this._currentCount=i,this._emitStart(e);break;case"added":this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"update":this._emitUpdate(e);break;case"removed":this._startEvent&&this._emitEnd(this._previousEvent),this._currentCount=i,this._emitStart(e);break;case"end":this._emitEnd(e),this._currentCount=0}this._previousEvent=e}_emitStart(e){var r,i;this._startEvent=e,(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.start(this._currentCount,e,this._startEvent)}_emitUpdate(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.update(this._currentCount,e,this._startEvent)}_emitEnd(e){var r,i;(i=(r=this._callbacks).condition)!=null&&i.call(r,this._currentCount,e)&&this._callbacks.end(this._currentCount,e,this._startEvent),this._startEvent=null}},qMt=class extends Ua{constructor(e=20,r=40){super(!1),this._threshold=e,this._maxDelta=r,this._state="ready",this._emittedArtificalEnd2=!1,this._vertical=this.registerOutgoing("vertical-two-finger-drag"),this._artificalDrag=this.registerOutgoing("drag"),this._dragEventSeparator=new HMt({start:(i,n)=>this._observeStart(i,n),update:(i,n,s)=>this._observeUpdate(i,n,s),end:(i,n)=>this._observeEnd(n)}),this.registerIncoming("drag",i=>this._dragEventSeparator.handle(i))}get failed(){return this._state==="failed"}_observeStart(e,r){e===1&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),r.stopPropagation()),this._state=e===2?"ready":"failed"}_observeUpdate(e,r,i){if(this._state!=="failed"&&e===2)return this._state==="active"?(this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"update"}),void r.stopPropagation()):void(this._checkMovementWithinLimits(r.data,i.data)?this._checkVerticalThresholdReached(r.data,i.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=r.data.center,this._artificalDrag.emit({action:"end",button:r.data.button,buttons:r.data.buttons,pointerType:r.data.pointerType,timestamp:r.data.timestamp,pointers:r.data.pointers,pointer:r.data.pointer,angle:r.data.angle,radius:r.data.radius,center:r.data.center}),this._vertical.emit({delta:r.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),r.stopPropagation()):this._state="failed")}_observeEnd(e){this._state==="active"&&(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",e.stopPropagation())}_checkMovementWithinLimits(e,r){let i=-1/0,n=1/0,s=-1/0,o=1/0;for(const{x:y,y:_}of r.pointers.values())i=Math.max(i,y),n=Math.min(n,y),s=Math.max(s,_),o=Math.min(o,_);let a=-1/0,l=1/0,c=-1/0,u=1/0;for(const{x:y,y:_}of e.pointers.values())a=Math.max(a,y),l=Math.min(l,y),c=Math.max(c,_),u=Math.min(u,_);const h=i-n,f=s-o,m=a-l,g=c-u;return Math.abs(e.center.x-r.center.x)<this._threshold&&Math.abs(m-h)<=this._maxDelta&&Math.abs(g-f)<=this._maxDelta}_checkVerticalThresholdReached(e,r){let i=Math.abs(e.center.y-r.center.y);return e.pointers.forEach((n,s)=>{const o=r.pointers.get(s);i=Math.min(i,Math.abs(n.y-o.y))}),i>=this._threshold}},Kf=class extends Ce{constructor(){super(...arguments),this._handles=new Ri}destroy(){this._handles=qe(this._handles),this.disconnect()}get primaryDragAction(){return this._get("primaryDragAction")}set primaryDragAction(e){e!=="pan"&&e!=="rotate"||e===this._get("primaryDragAction")||(this._set("primaryDragAction",e),this._updateMode())}get mode(){return this._get("mode")}set mode(e){e!=="default"&&e!=="pro"||e===this._get("mode")||(this._set("mode",e),this._updateMode())}get updating(){var e;return!!((e=this._inputManager)!=null&&e.updating)}get latestPointerType(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerType}get latestPointerLocation(){var e;return(e=this._inputManager)==null?void 0:e.latestPointerLocation}get multiTouchActive(){var e;return((e=this._inputManager)==null?void 0:e.multiTouchActive)??!1}disconnect(){this.view.viewEvents.disconnect(),this._inputManager=qe(this._inputManager)}connect(){const e=this.view;this._source=new t8e(this.view.surface,e.input);const r=[new jMt,new GMt,new BMt,new zMt(this.view.navigation),new qMt],i=new sp({eventSource:this._source,recognizers:r});this._inputManager=i,i.installHandlers("prevent-context-menu",[new FMt],Pn.INTERNAL),this._modeDragPan=new Cwe(e,"primary"),this._modeDragRotate=new wY(e,"secondary",Hu.CENTER),this._modeDragZoom=new cMt(e,"tertiary");const n={lookAround:"b",pan:{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"},resetHeading:"n",resetTilt:"p"};i.installHandlers("navigation",[new CMt(e),new X3t(e),new yMt(e),new vMt(e,n.pan),new _Mt(e),new OMt(e,n.resetTilt),new RMt(e,n.resetHeading),new wY(e,"primary",Hu.EYE,[n.lookAround]),new wY(e,"secondary",Hu.CENTER,[n.lookAround]),new Cwe(e,"tertiary",[n.lookAround]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new AMt(e)],Pn.INTERNAL),this.view.viewEvents.connect(i),this._updateMode(),this._handles.add(pe(()=>{var s;return(s=this.view.navigation)==null?void 0:s.browserTouchPanEnabled},s=>{this._source.browserTouchPanningEnabled=!s},_r))}_updateMode(){var n;const e=this.mode,r=this.primaryDragAction,i=(n=Vie.get(e))==null?void 0:n.get(r);i&&(this._modeDragPan&&(this._modeDragPan.pointerAction=i.pan),this._modeDragRotate&&(this._modeDragRotate.pointerAction=i.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=i.zoom))}get test(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}};d([p()],Kf.prototype,"view",void 0),d([p({value:"pan"})],Kf.prototype,"primaryDragAction",null),d([p({value:"default"})],Kf.prototype,"mode",null),d([p({readOnly:!0})],Kf.prototype,"updating",null),d([p()],Kf.prototype,"latestPointerType",null),d([p()],Kf.prototype,"latestPointerLocation",null),d([p()],Kf.prototype,"multiTouchActive",null),d([p()],Kf.prototype,"_inputManager",void 0),Kf=d([I("esri.views.3d.input.SceneInputManager")],Kf);const Vie=new Map,TY=new Map,EY=new Map;TY.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"}),TY.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"}),EY.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"}),EY.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"}),Vie.set("default",TY),Vie.set("pro",EY);const WMt=Kf;let ps=class extends Ce{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};d([p()],ps.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),d([p()],ps.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),d([p()],ps.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),d([p()],ps.prototype,"DECONFLICTOR_SHOW_GRID",void 0),d([p()],ps.prototype,"LABELS_SHOW_BORDER",void 0),d([p()],ps.prototype,"TEXT_SHOW_BASELINE",void 0),d([p()],ps.prototype,"TEXT_SHOW_BORDER",void 0),d([p()],ps.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),d([p()],ps.prototype,"OVERLAY_SHOW_CENTER",void 0),d([p()],ps.prototype,"SHOW_POI",void 0),d([p()],ps.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),d([p()],ps.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),d([p()],ps.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),d([p()],ps.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),d([p()],ps.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),d([p()],ps.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),d([p()],ps.prototype,"I3S_TREE_SHOW_TILES",void 0),d([p()],ps.prototype,"I3S_SHOW_MODIFICATIONS",void 0),d([p()],ps.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),d([p()],ps.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),d([p()],ps.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),d([p()],ps.prototype,"LINE_WIREFRAMES",void 0),ps=d([I("esri.views.3d.support.DebugFlags")],ps);const Di=new ps;let Kd,IA,Bie=!1,jie=!1,Gie=!1,Hie=!1,_D=null;function XMt(t,e){if(!jie||!IA)return;s8e();const r=IA;let i=0;for(let n=0;n<t.accBinsNumX;n++)for(let s=0;s<t.accBinsNumY;s++){const o=t.accBins[n][t.accBinsNumY-1-s];i+=o.length;const a=n*t.accBinsSizeX,l=(n+1)*t.accBinsSizeX,c=s*t.accBinsSizeY,u=(s+1)*t.accBinsSizeY;r.fillText(o.length.toFixed(),a+5,c+15),o8e(a,l,c,u,"blue")}r.fillText("total totalShownLabels: "+i,70,40),r.fillText("total visible labels: "+e.size,70,50),r.fillText("total numTests: "+t.accNumTests,70,30)}function YMt(t){Gie=Di.DECONFLICTOR_SHOW_VISIBLE,Hie=Di.DECONFLICTOR_SHOW_INVISIBLE,Bie=Gie||Hie,jie=Di.DECONFLICTOR_SHOW_GRID,_D=null,Bie||jie?_D=()=>ZMt(t):Kd&&(Kd.parentElement.removeChild(Kd),Kd=null)}function s8e(){_D&&(_D(),_D=null)}function ZMt(t){Kd==null&&(Kd=document.createElement("canvas"),Kd.setAttribute("id","debugCanvas2d"),t.surface.parentElement.style.position="relative",t.surface.parentElement.appendChild(Kd));const{state:e}=t,{camera:r,pixelRatio:i}=e,{width:n,height:s}=r,o=n*i,a=s*i;Kd.setAttribute("width",`${o}px`),Kd.setAttribute("height",`${a}px`),Kd.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${n}px;height:${s}px`),IA=Kd.getContext("2d"),IA.clearRect(0,0,n,s),IA.font="12px Arial"}function o8e(t,e,r,i,n){s8e();const s=Kd.height,o=IA;o.beginPath(),o.lineWidth=1,o.strokeStyle=n,o.moveTo(t,s-r),o.lineTo(e,s-r),o.stroke(),o.lineTo(e,s-i),o.stroke(),o.lineTo(e,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.lineTo(t,s-r),o.stroke(),o.closePath()}function JMt(t,e){Bie&&(e&&Gie||!e&&Hie)&&o8e(t.aabr[0],t.aabr[2],t.aabr[1],t.aabr[3],e?"green":"red")}var rl,oa;(function(t){t[t.USER=1]="USER",t[t.SCALE_RANGE=2]="SCALE_RANGE",t[t.FILTER=4]="FILTER",t[t.DECONFLICTION=8]="DECONFLICTION",t[t.ALL_GRAPHIC=15]="ALL_GRAPHIC",t[t.ALL_LABEL=255]="ALL_LABEL"})(rl||(rl={})),function(t){t[t.GRAPHIC=1]="GRAPHIC",t[t.LABEL=16]="LABEL"}(oa||(oa={}));function a8e(t,e){return new d8e(t,p8e,e)}function KMt(t,e){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:n}=p8e;return new d8e(t,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:CY.curvatureDependent.min.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:CY.curvatureDependent.max.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:n,minPixelSize:CY.minPixelSize},e)}function QMt(t){return Math.abs(t*t*t)}function l8e(t,e,r){const i=r.parameters,n=r.paddingPixelsOverride;return QM.scale=Math.min(i.divisor/(e-i.offset),1),QM.factor=QMt(t),QM.minPixelSize=i.minPixelSize,QM.paddingPixels=n,QM}function c8e(t,e){return t===0?e.minPixelSize:e.minPixelSize*(1+2*e.paddingPixels/t)}function Ehe(t,e){return Math.max(Xt(t*e.scale,t,e.factor),c8e(t,e))}function e$t(t,e,r){const i=l8e(t,e,r);return i.minPixelSize=0,i.paddingPixels=0,Ehe(1,i)}function Mwe(t,e,r,i){i.scale=e$t(t,e,r),i.factor=0,i.minPixelSize=r.parameters.minPixelSize,i.paddingPixels=r.paddingPixelsOverride}function u8e(t,e,r=[0,0]){const i=Math.min(Math.max(e.scale,c8e(t[1],e)/Math.max(1e-5,t[1])),1);return r[0]=t[0]*i,r[1]=t[1]*i,r}function t$t(t,e,r,i){return Ehe(t,l8e(e,r,i))}let d8e=class h8e{get paddingPixelsOverride(){return this._paddingPixelsOverride||this.parameters.paddingPixels}constructor(e,r,i,n=r$t(),s){this._viewingMode=e,this._description=r,this._ellipsoidRadius=i,this.parameters=n,this._paddingPixelsOverride=s,this._viewingMode===at.Local?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return(!this.parameters||this.parameters.camera.fovY!==e.fovY||this.parameters.camera.distance!==e.distance)&&(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),!0)}overridePadding(e){return e!==this.paddingPixelsOverride?new h8e(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,r,i){const{scaleStart:n,scaleFallOffRange:s,minPixelSize:o}=this._description,{fovY:a,distance:l}=e,c=this._calculateCurvatureDependentParameters(e,r),u=this._coverageCompensation(e,r,c),{tiltAngle:h,scaleFallOffFactor:f}=c,m=Math.sin(h)*l,g=.5*Math.PI-h-a*(.5-n*u),y=m/Math.cos(g),_=g+a*s*u,b=(y-f*(m/Math.cos(_)))/(1-f);return i.camera.fovY=e.fovY,i.camera.distance=e.distance,i.offset=b,i.divisor=y-b,i.minPixelSize=o,i}_calculateCurvatureDependentParametersLocal(e,r,i=$we){return i.tiltAngle=this._description.curvatureDependent.min.tiltAngle,i.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,i}_calculateCurvatureDependentParametersGlobal(e,r,i=$we){const n=this._description.curvatureDependent,s=1+e.distance/r,o=Math.sqrt(s*s-1),[a,l]=[n.min.curvature,n.max.curvature],c=Te((o-a)/(l-a),0,1),[u,h]=[n.min,n.max];return i.tiltAngle=Xt(u.tiltAngle,h.tiltAngle,c),i.scaleFallOffFactor=Xt(u.scaleFallOffFactor,h.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,r,i){return(e.fovY-i.tiltAngle)/e.fovY}_surfaceCoverageCompensationGlobal(e,r,i){const n=r*r,s=i.tiltAngle+.5*Math.PI,{fovY:o,distance:a}=e,l=a*a+n-2*Math.cos(s)*a*r,c=Math.sqrt(l),u=Math.sqrt(l-n);return(Math.acos(u/c)-Math.asin(r/(c/Math.sin(s)))+.5*o)/o}};const p8e={curvatureDependent:{min:{curvature:sr(10),tiltAngle:sr(12),scaleFallOffFactor:.5},max:{curvature:sr(70),tiltAngle:sr(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},CY={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};function r$t(){return{camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0}}const QM={scale:0,factor:0,minPixelSize:0,paddingPixels:0},$we={tiltAngle:0,scaleFallOffFactor:0};function i$t(t){return t instanceof Float32Array&&t.length>=16}function n$t(t){return Array.isArray(t)&&t.length>=16}function s$t(t){return i$t(t)||n$t(t)}function Che(t){t.vertex.code.add(T`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`),t.vertex.code.add(T`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),t.vertex.code.add(T`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`),t.vertex.code.add(T`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`),t.vertex.code.add(T`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),t.vertex.code.add(T`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`),t.vertex.code.add(T`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)}function o$t(t){t.uniforms.add(new Cr("screenSizePerspective",e=>f8e(e.screenSizePerspective)))}function DH(t){t.uniforms.add(new Cr("screenSizePerspectiveAlignment",e=>f8e(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))}function f8e(t){return Ki(a$t,t.parameters.divisor,t.parameters.offset,t.parameters.minPixelSize,t.paddingPixelsOverride)}const a$t=wr();var mn,Pp,bD,Hn,mo;(function(t){t[t.INNER=0]="INNER",t[t.OUTER=1]="OUTER"})(mn||(mn={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.HAS_NORTH_POLE=1]="HAS_NORTH_POLE",t[t.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE",t[t.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"}(Pp||(Pp={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON"}(bD||(bD={})),function(t){t[t.Color=0]="Color",t[t.ColorNoRasterImage=1]="ColorNoRasterImage",t[t.Highlight=2]="Highlight",t[t.Water=3]="Water",t[t.Occluded=4]="Occluded",t[t.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"}(Hn||(Hn={})),function(t){t[t.FADING=0]="FADING",t[t.IMMEDIATE=1]="IMMEDIATE",t[t.UNFADED=2]="UNFADED"}(mo||(mo={}));let l$t=class{constructor(e,r){this.vec3=e,this.id=r}};function GB(t,e,r,i){return new l$t(Ue(t,e,r),i)}var pc;(function(t){t[t.None=0]="None",t[t.ColorAndWater=1]="ColorAndWater",t[t.Highlight=2]="Highlight",t[t.Occluded=3]="Occluded",t[t.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(pc||(pc={}));const Rhe=1.3;let Iwe=class{get extent(){return this._extent}constructor(e,r){this.index=e,this.renderTargets=r,this._extent=lr(),this.resolution=0,this.renderLocalOrigin=GB(0,0,0,"O"),this.pixelRatio=1,this.mapUnitsPerPixel=1,this.canvasGeometries=new c$t,this.hasDrapedFeatureSource=!1,this.hasDrapedRasterSource=!1,this.hasTargetWithoutRasterImage=!1,this.index=e,this.validTargets=new Array(r.renderTargets.length).fill(!1)}getValidTexture(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null}get _needsColorWithoutRasterImage(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}getColorTexture(e){const r=e===pc.ColorAndWater?this.renderTargets.getTarget(Hn.Color):e===pc.Highlight?this.renderTargets.getTarget(Hn.Highlight):e===pc.ObjectAndLayerIdColor?this.renderTargets.getTarget(Hn.ObjectAndLayerIdColor):this.renderTargets.getTarget(Hn.Occluded);return r?r.getTexture():null}getColorTextureNoRasterImage(){return this._needsColorWithoutRasterImage?this.getValidTexture(Hn.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(Hn.Color):null}getNormalTexture(e){const r=e===pc.ColorAndWater?this.renderTargets.getTarget(Hn.Water):null;return r?r.getTexture():null}draw(e,r){const i=this.computeRenderTargetValidityBitfield();for(const n of this.renderTargets.renderTargets)n.type!==Hn.ColorNoRasterImage||this._needsColorWithoutRasterImage?this.validTargets[n.type]=e.drawTarget(this,n,r):this.validTargets[n.type]=!1;return i^this.computeRenderTargetValidityBitfield()?GP.CHANGED:GP.UNCHANGED}computeRenderTargetValidityBitfield(){const e=this.validTargets;return+e[Hn.Color]|+e[Hn.ColorNoRasterImage]<<1|+e[Hn.Highlight]<<2|+e[Hn.Water]<<3|+e[Hn.Occluded]<<4}setupGeometryViewsCyclical(e){this.setupGeometryViewsDirect();const r=.001*e.range;if(this._extent[0]-r<=e.min){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];kV(this._extent,e.range,0,i)}if(this._extent[2]+r>=e.max){const i=this.canvasGeometries.extents[this.canvasGeometries.numViews++];kV(this._extent,-e.range,0,i)}}setupGeometryViewsDirect(){this.canvasGeometries.numViews=1,A_(this.canvasGeometries.extents[0],this._extent)}hasSomeSizedView(){for(let e=0;e<this.canvasGeometries.numViews;e++){const r=this.canvasGeometries.extents[e];if(r[0]!==r[2]&&r[1]!==r[3])return!0}return!1}applyViewport(e){e.setViewport(this.index===mn.INNER?0:this.resolution,0,this.resolution,this.resolution)}},c$t=class{constructor(){this.extents=[lr(),lr(),lr()],this.numViews=0}},m8e=class extends Zn{constructor(e,r){super(e,"mat4",Ci.Draw,(i,n,s)=>i.setUniformMatrix4fv(e,r(n,s)))}};function hg(t,e){e.instancedDoublePrecision?t.constants.add("cameraPosition","vec3",Sc):t.uniforms.add(new _h("cameraPosition",(r,i)=>se(g8e,i.camera.viewInverseTransposeMatrix[3]-r.origin[0],i.camera.viewInverseTransposeMatrix[7]-r.origin[1],i.camera.viewInverseTransposeMatrix[11]-r.origin[2])))}function gd(t,e){if(!e.instancedDoublePrecision)return void t.uniforms.add(new yn("proj",(i,n)=>n.camera.projectionMatrix),new m8e("view",(i,n)=>hu(Lwe,n.camera.viewMatrix,i.origin)),new _h("localOrigin",i=>i.origin));const r=i=>se(g8e,i.camera.viewInverseTransposeMatrix[3],i.camera.viewInverseTransposeMatrix[7],i.camera.viewInverseTransposeMatrix[11]);t.uniforms.add(new yn("proj",(i,n)=>n.camera.projectionMatrix),new yn("view",(i,n)=>hu(Lwe,n.camera.viewMatrix,r(n))),new ar("localOrigin",(i,n)=>r(n)))}const Lwe=Me(),g8e=A();function XP(t){t.uniforms.add(new yn("viewNormal",(e,r)=>r.camera.viewInverseTransposeMatrix))}function Z3(t,e){t.uniforms.add(new Ye("pixelRatio",(r,i)=>i.camera.pixelRatio/(e.draped?Rhe:1)))}function y8e(t,e){const r=t.vertex;e.hasVerticalOffset?(v8e(r),e.hasScreenSizePerspective&&(t.include(Che),DH(r),hg(t.vertex,e)),r.code.add(T`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?T`vec3 worldNormal = normalize(worldPos + localOrigin);`:T`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?T`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:T`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(T`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)}const u$t=wr();function v8e(t){t.uniforms.add(new Cr("verticalOffset",(e,r)=>{const{minWorldLength:i,maxWorldLength:n,screenLength:s}=e.verticalOffset,o=Math.tan(.5*r.camera.fovY)/(.5*r.camera.fullViewport[3]),a=r.camera.pixelRatio||1;return Ki(u$t,s*a,o,i,n)}))}function NH(t){t.uniforms.add(new Jy("alignPixelEnabled",(e,r)=>r.alignPixelEnabled)),t.code.add(T`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),t.code.add(T`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)}var Bu;(function(t){t[t.Occluded=0]="Occluded",t[t.NotOccluded=1]="NotOccluded",t[t.Both=2]="Both",t[t.COUNT=3]="COUNT"})(Bu||(Bu={}));var tu;function _8e(t,e){t.include(Che),t.attributes.add(O.POSITION,"vec3"),t.attributes.add(O.NORMAL,"vec3"),t.attributes.add(O.AUXPOS1,"vec4");const r=t.vertex;gd(r,e),hg(r,e),r.uniforms.add(new Cr("viewport",(i,n)=>n.camera.fullViewport),new Ye("polygonOffset",i=>i.shaderPolygonOffset),new Ye("cameraGroundRelative",(i,n)=>n.camera.aboveGround?1:-1),new Ye("renderTransparentlyOccludedHUD",(i,n)=>n.renderTransparentlyOccludedHUD===Bu.Occluded?1:n.renderTransparentlyOccludedHUD===Bu.NotOccluded?0:.75),new Mt("hudVisibilityTexture",(i,n)=>n.hudVisibilityTexture)),e.hasVerticalOffset&&v8e(r),r.constants.add("smallOffsetAngle","float",.984807753012208),r.code.add(T`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),r.code.add(T`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`),e.draped&&!e.hasVerticalOffset||XP(r),e.draped||(r.uniforms.add(new Ye("perDistancePixelRatio",(i,n)=>Math.tan(n.camera.fovY/2)/(n.camera.fullViewport[2]/2))),r.code.add(T`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`)),e.screenCenterOffsetUnitsEnabled===tu.Screen&&Z3(r,e),e.hasScreenSizePerspective&&DH(r),r.code.add(T`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${e.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${e.hasScreenSizePerspective&&(e.hasVerticalOffset||e.screenCenterOffsetUnitsEnabled===tu.Screen)?"vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${e.hasVerticalOffset?e.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${e.hasVerticalOffset?T`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${e.screenCenterOffsetUnitsEnabled!==tu.Screen?T`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${e.screenCenterOffsetUnitsEnabled===tu.Screen?e.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${e.screenCenterOffsetUnitsEnabled===tu.Screen?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `),r.include(NH),r.code.add(T`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)}(function(t){t[t.World=0]="World",t[t.Screen=1]="Screen",t[t.COUNT=2]="COUNT"})(tu||(tu={}));const n6=To();function b8e(t,e,r,i,n,s){if(t.visible)if(t.boundingInfo){It(t.type===Wn.Mesh);const o=e.tolerance;w8e(t.boundingInfo,r,i,o,n,s)}else{const o=t.indices.get(O.POSITION),a=t.vertexAttributes.get(O.POSITION);OF(r,i,0,o.length/3,o,a,void 0,n,s)}}const d$t=A();function w8e(t,e,r,i,n,s){if(t==null)return;const o=S8e(e,r,d$t);if(B4e(n6,t.bbMin),j4e(n6,t.bbMax),n!=null&&n.applyToAabb(n6),Ahe(n6,e,o,i)){const{primitiveIndices:a,indices:l,position:c}=t,u=a?a.length:l.length/3;if(u>m$t){const h=t.getChildren();if(h!==void 0){for(const f of h)w8e(f,e,r,i,n,s);return}}OF(e,r,0,u,l,c,a,n,s)}}const x8e=A();function OF(t,e,r,i,n,s,o,a,l){if(o)return h$t(t,e,r,i,n,s,o,a,l);const{data:c,stride:u}=s,h=t[0],f=t[1],m=t[2],g=e[0]-h,y=e[1]-f,_=e[2]-m;for(let b=r,w=3*r;b<i;++b){let x=u*n[w++],S=c[x++],C=c[x++],E=c[x];x=u*n[w++];let R=c[x++],P=c[x++],D=c[x];x=u*n[w++];let L=c[x++],k=c[x++],V=c[x];a!=null&&([S,C,E]=a.applyToVertex(S,C,E,b),[R,P,D]=a.applyToVertex(R,P,D,b),[L,k,V]=a.applyToVertex(L,k,V,b));const W=R-S,G=P-C,B=D-E,Z=L-S,M=k-C,$=V-E,N=y*$-M*_,j=_*Z-$*g,J=g*M-Z*y,K=W*N+G*j+B*J;if(Math.abs(K)<=Number.EPSILON)continue;const te=h-S,ae=f-C,be=m-E,Ee=te*N+ae*j+be*J;if(K>0){if(Ee<0||Ee>K)continue}else if(Ee>0||Ee<K)continue;const Je=ae*B-G*be,ze=be*W-B*te,Ge=te*G-W*ae,Le=g*Je+y*ze+_*Ge;if(K>0){if(Le<0||Ee+Le>K)continue}else if(Le>0||Ee+Le<K)continue;const de=(Z*Je+M*ze+$*Ge)/K;de>=0&&l(de,Ohe(W,G,B,Z,M,$,x8e),b,!1)}}function h$t(t,e,r,i,n,s,o,a,l){const{data:c,stride:u}=s,h=t[0],f=t[1],m=t[2],g=e[0]-h,y=e[1]-f,_=e[2]-m;for(let b=r;b<i;++b){const w=o[b];let x=3*w,S=u*n[x++],C=c[S++],E=c[S++],R=c[S];S=u*n[x++];let P=c[S++],D=c[S++],L=c[S];S=u*n[x];let k=c[S++],V=c[S++],W=c[S];a!=null&&([C,E,R]=a.applyToVertex(C,E,R,b),[P,D,L]=a.applyToVertex(P,D,L,b),[k,V,W]=a.applyToVertex(k,V,W,b));const G=P-C,B=D-E,Z=L-R,M=k-C,$=V-E,N=W-R,j=y*N-$*_,J=_*M-N*g,K=g*$-M*y,te=G*j+B*J+Z*K;if(Math.abs(te)<=Number.EPSILON)continue;const ae=h-C,be=f-E,Ee=m-R,Je=ae*j+be*J+Ee*K;if(te>0){if(Je<0||Je>te)continue}else if(Je>0||Je<te)continue;const ze=be*Z-B*Ee,Ge=Ee*G-Z*ae,Le=ae*B-G*be,de=g*ze+y*Ge+_*Le;if(te>0){if(de<0||Je+de>te)continue}else if(de>0||Je+de<te)continue;const $e=(M*ze+$*Ge+N*Le)/te;$e>=0&&l($e,Ohe(G,B,Z,M,$,N,x8e),w,!1)}}const Dwe=A(),Nwe=A();function Ohe(t,e,r,i,n,s,o){return se(Dwe,t,e,r),se(Nwe,i,n,s),Lt(o,Dwe,Nwe),Se(o,o),o}function S8e(t,e,r){return se(r,1/(e[0]-t[0]),1/(e[1]-t[1]),1/(e[2]-t[2]))}function Ahe(t,e,r,i){return Phe(t,e,r,i,1/0)}function Phe(t,e,r,i,n){const s=(t[0]-i-e[0])*r[0],o=(t[3]+i-e[0])*r[0];let a=Math.min(s,o),l=Math.max(s,o);const c=(t[1]-i-e[1])*r[1],u=(t[4]+i-e[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0||(a=Math.max(a,Math.min(c,u)),a>l))return!1;const h=(t[2]-i-e[2])*r[2],f=(t[5]+i-e[2])*r[2];return l=Math.min(l,Math.max(h,f)),!(l<0)&&(a=Math.max(a,Math.min(h,f)),!(a>l)&&a<n)}function T8e(t,e,r,i,n){let s=(r.screenLength||0)*t.pixelRatio;n!=null&&(s=t$t(s,i,e,n));const o=s*Math.tan(.5*t.fovY)/(.5*t.fullHeight);return Te(o*e,r.minWorldLength||0,r.maxWorldLength!=null?r.maxWorldLength:1/0)}function E8e(t,e){const r=e?E8e(e):{};for(const i in t){let n=t[i];n&&n.forEach&&(n=f$t(n)),n==null&&i in r||(r[i]=n)}return r}function p$t(t,e){let r=!1;for(const i in e){const n=e[i];n!==void 0&&(Array.isArray(n)?t[i]===null?(t[i]=n.slice(),r=!0):Vle(t[i],n)&&(r=!0):t[i]!==n&&(r=!0,t[i]=n))}return r}function f$t(t){const e=[];return t.forEach(r=>e.push(r)),e}const C8e={multiply:1,ignore:2,replace:3,tint:4},m$t=1e3;let Ax=class extends EF{constructor(e,r){super(),this.type=Wn.Material,this.supportsEdges=!1,this._visible=!0,this._renderPriority=0,this._insertOrder=0,this._vertexAttributeLocations=Br,this._pp0=Ue(0,0,1),this._pp1=Ue(0,0,0),this._parameters=E8e(e,r),this.validateParameters(this._parameters)}dispose(){}get parameters(){return this._parameters}update(e){return!1}setParameters(e,r=!0){p$t(this._parameters,e)&&(this.validateParameters(this._parameters),r&&this.parametersChanged())}validateParameters(e){}get visible(){return this._visible}set visible(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}shouldRender(e){return this.isVisible()&&this.isVisibleForOutput(e.output)&&(this.renderOccluded&e.renderOccludedMask)!=0}isVisibleForOutput(e){return!0}get renderOccluded(){return this.parameters.renderOccluded}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}get insertOrder(){return this._insertOrder}set insertOrder(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}get vertexAttributeLocations(){return this._vertexAttributeLocations}isVisible(){return this._visible}parametersChanged(){this.repository!=null&&this.repository.materialChanged(this)}intersectDraped(e,r,i,n,s,o){return this._pp0[0]=this._pp1[0]=n[0],this._pp0[1]=this._pp1[1]=n[1],this.intersect(e,r,i,this._pp0,this._pp1,s)}},R8e=class extends gAt{constructor(e,r,i){super(r,i),this.camera=e}};var gn;(function(t){t[t.None=0]="None",t[t.Occlude=1]="Occlude",t[t.Transparent=2]="Transparent",t[t.OccludeAndTransparent=4]="OccludeAndTransparent",t[t.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil",t[t.Opaque=16]="Opaque"})(gn||(gn={}));let Mhe=class extends Ai{constructor(){super(...arguments),this.renderOccluded=gn.Occlude}},O8e=class{constructor(){this.factor=new Fwe,this.factorAlignment=new Fwe}},Fwe=class{constructor(){this.scale=0,this.factor=0,this.minPixelSize=0,this.paddingPixels=0}};function Evr(t,e,r,i,n=1){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n===1)for(let l=0;l<a;++l)s[i]=e[t[l]],i+=o;else for(let l=0;l<a;++l){const c=e[t[l]];for(let u=0;u<n;u++)s[i]=c,i+=o}}function kwe(t,e,r,i){const n=r.typedBuffer,s=r.typedBufferStride,o=t.length;i*=s;for(let a=0;a<o;++a){const l=2*t[a];n[i]=e[l],n[i+1]=e[l+1],i+=s}}function A8e(t,e,r,i,n){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n==null||n===1)for(let l=0;l<a;++l){const c=3*t[l];s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],i+=o}else for(let l=0;l<a;++l){const c=3*t[l];for(let u=0;u<n;++u)s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],i+=o}}function YP(t,e,r,i,n=1){const s=r.typedBuffer,o=r.typedBufferStride,a=t.length;if(i*=o,n===1)for(let l=0;l<a;++l){const c=4*t[l];s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],s[i+3]=e[c+3],i+=o}else for(let l=0;l<a;++l){const c=4*t[l];for(let u=0;u<n;++u)s[i]=e[c],s[i+1]=e[c+1],s[i+2]=e[c+2],s[i+3]=e[c+3],i+=o}}function Uwe(t,e,r){const i=t.typedBuffer,n=t.typedBufferStride;e*=n;for(let s=0;s<r;++s)i[e]=0,i[e+1]=0,i[e+2]=0,i[e+3]=0,e+=n}function $he(t,e,r,i,n,s=1){if(!r)return void A8e(t,e,i,n,s);const o=i.typedBuffer,a=i.typedBufferStride,l=t.length,c=r[0],u=r[1],h=r[2],f=r[4],m=r[5],g=r[6],y=r[8],_=r[9],b=r[10],w=r[12],x=r[13],S=r[14];n*=a;let C=0,E=0,R=0;const P=$7(r)?D=>{C=e[D]+w,E=e[D+1]+x,R=e[D+2]+S}:D=>{const L=e[D],k=e[D+1],V=e[D+2];C=c*L+f*k+y*V+w,E=u*L+m*k+_*V+x,R=h*L+g*k+b*V+S};if(s===1)for(let D=0;D<l;++D)P(3*t[D]),o[n]=C,o[n+1]=E,o[n+2]=R,n+=a;else for(let D=0;D<l;++D){P(3*t[D]);for(let L=0;L<s;++L)o[n]=C,o[n+1]=E,o[n+2]=R,n+=a}}function Ihe(t,e,r,i,n,s=1){if(!r)return void A8e(t,e,i,n,s);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,u=o[0],h=o[1],f=o[2],m=o[4],g=o[5],y=o[6],_=o[8],b=o[9],w=o[10],x=!nue(o),S=1e-6,C=1-S;n*=l;let E=0,R=0,P=0;const D=$7(o)?L=>{E=e[L],R=e[L+1],P=e[L+2]}:L=>{const k=e[L],V=e[L+1],W=e[L+2];E=u*k+m*V+_*W,R=h*k+g*V+b*W,P=f*k+y*V+w*W};if(s===1)if(x)for(let L=0;L<c;++L){D(3*t[L]);const k=E*E+R*R+P*P;if(k<C&&k>S){const V=1/Math.sqrt(k);a[n]=E*V,a[n+1]=R*V,a[n+2]=P*V}else a[n]=E,a[n+1]=R,a[n+2]=P;n+=l}else for(let L=0;L<c;++L)D(3*t[L]),a[n]=E,a[n+1]=R,a[n+2]=P,n+=l;else for(let L=0;L<c;++L){if(D(3*t[L]),x){const k=E*E+R*R+P*P;if(k<C&&k>S){const V=1/Math.sqrt(k);E*=V,R*=V,P*=V}}for(let k=0;k<s;++k)a[n]=E,a[n+1]=R,a[n+2]=P,n+=l}}function g$t(t,e,r,i,n,s=1){if(!r)return void YP(t,e,i,n,s);const o=r,a=i.typedBuffer,l=i.typedBufferStride,c=t.length,u=o[0],h=o[1],f=o[2],m=o[4],g=o[5],y=o[6],_=o[8],b=o[9],w=o[10],x=!nue(o),S=1e-6,C=1-S;if(n*=l,s===1)for(let E=0;E<c;++E){const R=4*t[E],P=e[R],D=e[R+1],L=e[R+2],k=e[R+3];let V=u*P+m*D+_*L,W=h*P+g*D+b*L,G=f*P+y*D+w*L;if(x){const B=V*V+W*W+G*G;if(B<C&&B>S){const Z=1/Math.sqrt(B);V*=Z,W*=Z,G*=Z}}a[n]=V,a[n+1]=W,a[n+2]=G,a[n+3]=k,n+=l}else for(let E=0;E<c;++E){const R=4*t[E],P=e[R],D=e[R+1],L=e[R+2],k=e[R+3];let V=u*P+m*D+_*L,W=h*P+g*D+b*L,G=f*P+y*D+w*L;if(x){const B=V*V+W*W+G*G;if(B<C&&B>S){const Z=1/Math.sqrt(B);V*=Z,W*=Z,G*=Z}}for(let B=0;B<s;++B)a[n]=V,a[n+1]=W,a[n+2]=G,a[n+3]=k,n+=l}}function P8e(t,e,r,i,n,s=1){const o=i.typedBuffer,a=i.typedBufferStride,l=t.length;if(n*=a,r!==e.length||r!==4)if(s!==1)if(r!==4)for(let c=0;c<l;++c){const u=3*t[c];for(let h=0;h<s;++h)o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=255,n+=a}else for(let c=0;c<l;++c){const u=4*t[c];for(let h=0;h<s;++h)o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=e[u+3],n+=a}else{if(r===4){for(let c=0;c<l;++c){const u=4*t[c];o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=e[u+3],n+=a}return}for(let c=0;c<l;++c){const u=3*t[c];o[n]=e[u],o[n+1]=e[u+1],o[n+2]=e[u+2],o[n+3]=255,n+=a}}else{o[n]=e[0],o[n+1]=e[1],o[n+2]=e[2],o[n+3]=e[3];const c=new Uint32Array(i.typedBuffer.buffer,i.start),u=a/4,h=c[n/=4];n+=u;const f=l*s;for(let m=1;m<f;++m)c[n]=h,n+=u}}function y$t(t,e,r,i){const n=r.typedBuffer,s=r.typedBufferStride,o=t.length,a=e[0];i*=s;for(let l=0;l<o;++l)n[i]=a,i+=s}function M8e(t,e,r,i,n=1){const s=e.typedBuffer,o=e.typedBufferStride;if(i*=o,n===1)for(let a=0;a<r;++a)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o;else for(let a=0;a<r;++a)for(let l=0;l<n;++l)s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],i+=o}function $8e(t,e,r,i,n,s){for(const o of e.fields.keys()){const a=t.vertexAttributes.get(o),l=t.indices.get(o);if(a&&l)I8e(o,a,l,r,i,n,s);else if(o===O.OBJECTANDLAYERIDCOLOR&&t.objectAndLayerIdColor!=null){const c=t.indices.get(O.POSITION);if(It(!!c,`No buffer view for ${o}`),c){const u=c.length,h=n.getField(o,zl);M8e(t.objectAndLayerIdColor,h,u,s)}}}}function I8e(t,e,r,i,n,s,o){switch(t){case O.POSITION:{It(e.size===3);const a=s.getField(t,xo);It(!!a,`No buffer view for ${t}`),a&&$he(r,e.data,i,a,o);break}case O.NORMAL:{It(e.size===3);const a=s.getField(t,xo);It(!!a,`No buffer view for ${t}`),a&&Ihe(r,e.data,n,a,o);break}case O.NORMALCOMPRESSED:{It(e.size===2);const a=s.getField(t,TF);It(!!a,`No buffer view for ${t}`),a&&kwe(r,e.data,a,o);break}case O.UV0:{It(e.size===2);const a=s.getField(t,Ox);It(!!a,`No buffer view for ${t}`),a&&kwe(r,e.data,a,o);break}case O.COLOR:case O.SYMBOLCOLOR:{const a=s.getField(t,zl);It(!!a,`No buffer view for ${t}`),It(e.size===3||e.size===4),!a||e.size!==3&&e.size!==4||P8e(r,e.data,e.size,a,o);break}case O.COLORFEATUREATTRIBUTE:{const a=s.getField(t,xH);It(!!a,`No buffer view for ${t}`),It(e.size===1),a&&e.size===1&&y$t(r,e.data,a,o);break}case O.TANGENT:{It(e.size===4);const a=s.getField(t,dg);It(!!a,`No buffer view for ${t}`),a&&g$t(r,e.data,n,a,o);break}case O.PROFILERIGHT:case O.PROFILEUP:case O.PROFILEVERTEXANDNORMAL:case O.FEATUREVALUE:{It(e.size===4);const a=s.getField(t,dg);It(!!a,`No buffer view for ${t}`),a&&YP(r,e.data,a,o)}}}function YN(t,e,r=0){const i=Te(t,0,b$t);for(let n=0;n<4;n++)e[r+n]=Math.floor(256*w$t(i*v$t[n]))}function Lhe(t,e=0){let r=0;for(let i=0;i<4;i++)r+=t[e+i]*_$t[i];return r}const v$t=[1,256,65536,16777216],_$t=[1/256,1/65536,1/16777216,1/4294967296],b$t=Lhe(new Uint8ClampedArray([255,255,255,255]));function w$t(t){return t-Math.floor(t)}async function z_(t,e){const{data:r}=await ti(t,{responseType:"image",...e});return r}function x$t(){if(RY==null){const t=e=>fi(`esri/libs/basisu/${e}`);RY=le(()=>import("./basis_transcoder-a041bc93.js"),[]).then(e=>e.b).then(({default:e})=>e({locateFile:t}).then(r=>(r.initializeBasis(),delete r.then,r)))}return RY}let RY;var jT;(function(t){t[t.ETC1_RGB=0]="ETC1_RGB",t[t.ETC2_RGBA=1]="ETC2_RGBA",t[t.BC1_RGB=2]="BC1_RGB",t[t.BC3_RGBA=3]="BC3_RGBA",t[t.BC4_R=4]="BC4_R",t[t.BC5_RG=5]="BC5_RG",t[t.BC7_M6_RGB=6]="BC7_M6_RGB",t[t.BC7_M5_RGBA=7]="BC7_M5_RGBA",t[t.PVRTC1_4_RGB=8]="PVRTC1_4_RGB",t[t.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA",t[t.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA",t[t.ATC_RGB=11]="ATC_RGB",t[t.ATC_RGBA=12]="ATC_RGBA",t[t.FXT1_RGB=17]="FXT1_RGB",t[t.PVRTC2_4_RGB=18]="PVRTC2_4_RGB",t[t.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA",t[t.ETC2_EAC_R11=20]="ETC2_EAC_R11",t[t.ETC2_EAC_RG11=21]="ETC2_EAC_RG11",t[t.RGBA32=13]="RGBA32",t[t.RGB565=14]="RGB565",t[t.BGR565=15]="BGR565",t[t.RGBA4444=16]="RGBA4444"})(jT||(jT={}));let Jm=null,s6=null;async function L8e(){return s6==null&&(s6=x$t(),Jm=await s6),s6}function S$t(t,e){if(Jm==null)return t.byteLength;const r=new Jm.BasisFile(new Uint8Array(t)),i=N8e(r)?D8e(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),e):0;return r.close(),r.delete(),i}function T$t(t,e){if(Jm==null)return t.byteLength;const r=new Jm.KTX2File(new Uint8Array(t)),i=F8e(r)?D8e(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),e):0;return r.close(),r.delete(),i}function D8e(t,e,r,i,n){const s=jde(e?ts.COMPRESSED_RGBA8_ETC2_EAC:ts.COMPRESSED_RGB8_ETC2),o=n&&t>1?(4**t-1)/(3*4**(t-1)):1;return Math.ceil(r*i*s*o)}function N8e(t){return t.getNumImages()>=1&&!t.isUASTC()}function F8e(t){return t.getFaces()>=1&&t.isETC1S()}async function E$t(t,e,r){Jm==null&&(Jm=await L8e());const i=new Jm.BasisFile(new Uint8Array(r));if(!N8e(i))return null;i.startTranscoding();const n=k8e(t,e,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(s,o)=>i.getImageTranscodedSizeInBytes(0,s,o),(s,o,a)=>i.transcodeImage(a,0,s,o,0,0));return i.close(),i.delete(),n}async function C$t(t,e,r){Jm==null&&(Jm=await L8e());const i=new Jm.KTX2File(new Uint8Array(r));if(!F8e(i))return null;i.startTranscoding();const n=k8e(t,e,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(s,o)=>i.getImageTranscodedSizeInBytes(s,0,0,o),(s,o,a)=>i.transcodeImage(a,s,0,0,o,0,-1,-1));return i.close(),i.delete(),n}function k8e(t,e,r,i,n,s,o,a){const{compressedTextureETC:l,compressedTextureS3TC:c}=t.capabilities,[u,h]=l?i?[jT.ETC2_RGBA,ts.COMPRESSED_RGBA8_ETC2_EAC]:[jT.ETC1_RGB,ts.COMPRESSED_RGB8_ETC2]:c?i?[jT.BC3_RGBA,ts.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[jT.BC1_RGB,ts.COMPRESSED_RGB_S3TC_DXT1_EXT]:[jT.RGBA32,Yt.RGBA],f=e.hasMipmap?r:Math.min(1,r),m=[];for(let g=0;g<f;g++)m.push(new Uint8Array(o(g,u))),a(g,u,m[g]);return e.internalFormat=h,e.hasMipmap=m.length>1,e.samplingMode=e.hasMipmap?Kt.LINEAR_MIPMAP_LINEAR:Kt.LINEAR,e.width=n,e.height=s,new Jt(t,e,{type:"compressed",levels:m})}const o6=re.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),R$t=542327876,O$t=131072,A$t=4;function Dhe(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}function P$t(t){return String.fromCharCode(255&t,t>>8&255,t>>16&255,t>>24&255)}const M$t=Dhe("DXT1"),$$t=Dhe("DXT3"),I$t=Dhe("DXT5"),L$t=31,D$t=0,N$t=1,F$t=2,k$t=3,U$t=4,z$t=7,V$t=20,B$t=21;function j$t(t,e,r){const i=G$t(r,e.hasMipmap??!1);if(i==null)throw new Error("DDS texture data is null");const{textureData:n,internalFormat:s,width:o,height:a}=i;return e.samplingMode=n.levels.length>1?Kt.LINEAR_MIPMAP_LINEAR:Kt.LINEAR,e.hasMipmap=n.levels.length>1,e.internalFormat=s,e.width=o,e.height=a,new Jt(t,e,n)}function G$t(t,e){const r=new Int32Array(t,0,L$t);if(r[D$t]!==R$t)return o6.error("Invalid magic number in DDS header"),null;if(!(r[V$t]&A$t))return o6.error("Unsupported format, must contain a FourCC code"),null;const i=r[B$t];let n,s;switch(i){case M$t:n=8,s=ts.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case $$t:n=16,s=ts.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case I$t:n=16,s=ts.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return o6.error("Unsupported FourCC code:",P$t(i)),null}let o=1,a=r[U$t],l=r[k$t];!(3&a)&&!(3&l)||(o6.warn("Rounding up compressed texture size to nearest multiple of 4."),a=a+3&-4,l=l+3&-4);const c=a,u=l;let h,f;r[F$t]&O$t&&e!==!1&&(o=Math.max(1,r[z$t]));let m=r[N$t]+4;const g=[];for(let y=0;y<o;++y)f=(a+3>>2)*(l+3>>2)*n,h=new Uint8Array(t,m,f),g.push(h),m+=f,a=Math.max(1,a>>1),l=Math.max(1,l>>1);return{textureData:{type:"compressed",levels:g},internalFormat:s,width:c,height:u}}let qE=class extends EF{constructor(e,r){super(),this._data=e,this.type=Wn.Texture,this._glTexture=null,this._loadingPromise=null,this._loadingController=null,this.events=new pn,this.parameters=r||{},this.parameters.mipmap=this.parameters.mipmap!==!1,this.parameters.noUnpackFlip=this.parameters.noUnpackFlip||!1,this.parameters.preMultiplyAlpha=this.parameters.preMultiplyAlpha||!1,this.parameters.wrap=this.parameters.wrap||{s:ir.REPEAT,t:ir.REPEAT},this._startPreload(e)}_startPreload(e){e!=null&&(e instanceof HTMLVideoElement?this._startPreloadVideoElement(e):e instanceof HTMLImageElement&&this._startPreloadImageElement(e))}_startPreloadVideoElement(e){if(!(qw(e.src)||e.preload==="auto"&&e.crossOrigin)){e.preload="auto",e.crossOrigin="anonymous";const r=!e.paused;if(e.src=e.src,r&&e.autoplay){const i=()=>{e.removeEventListener("canplay",i),e.play()};e.addEventListener("canplay",i)}}}_startPreloadImageElement(e){b0(e.src)||qw(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}dispose(){this._data=void 0}_createDescriptor(e){const r=new Vr;return r.wrapMode=this.parameters.wrap??ir.REPEAT,r.flipped=!this.parameters.noUnpackFlip,r.samplingMode=this.parameters.mipmap?Kt.LINEAR_MIPMAP_LINEAR:Kt.LINEAR,r.hasMipmap=!!this.parameters.mipmap,r.preMultiplyAlpha=!!this.parameters.preMultiplyAlpha,r.maxAnisotropy=this.parameters.maxAnisotropy??(this.parameters.mipmap?e.parameters.maxMaxAnisotropy:1),r}get glTexture(){return this._glTexture}get memoryEstimate(){var e;return((e=this._glTexture)==null?void 0:e.gpuMemoryUsage)||H$t(this._data,this.parameters)}load(e){if(this._glTexture!=null)return this._glTexture;if(this._loadingPromise)return this._loadingPromise;const r=this._data;return r==null?(this._glTexture=new Jt(e,this._createDescriptor(e),null),this._glTexture):typeof r=="string"?this._loadFromURL(e,r):r instanceof Image?this._loadFromImageElement(e,r):r instanceof HTMLVideoElement?this._loadFromVideoElement(e,r):r instanceof ImageData||r instanceof HTMLCanvasElement?this._loadFromImage(e,r):(Y$(r)||cw(r))&&this.parameters.encoding===n_.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(e,r)):(Y$(r)||cw(r))&&this.parameters.encoding===n_.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(e,r)):(Y$(r)||cw(r))&&this.parameters.encoding===n_.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(e,r)):cw(r)?this._loadFromPixelData(e,r):Y$(r)?this._loadFromPixelData(e,new Uint8Array(r)):null}get requiresFrameUpdates(){return this._data instanceof HTMLVideoElement}frameUpdate(e){return this._data instanceof HTMLVideoElement&&this._glTexture!=null?this._data.readyState<wD.HAVE_CURRENT_DATA||e===this._data.currentTime?e:(this._glTexture.setData(this._data),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this.parameters.updateCallback&&this.parameters.updateCallback(),this._data.currentTime):e}_loadFromDDSData(e,r){return this._glTexture=j$t(e,this._createDescriptor(e),r),this._glTexture}_loadFromKTX2(e,r){return this._loadAsync(()=>C$t(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromBasis(e,r){return this._loadAsync(()=>E$t(e,this._createDescriptor(e),r).then(i=>(this._glTexture=i,i)))}_loadFromPixelData(e,r){It(this.parameters.width>0&&this.parameters.height>0);const i=this._createDescriptor(e);return i.pixelFormat=this.parameters.components===1?Yt.LUMINANCE:this.parameters.components===3?Yt.RGB:Yt.RGBA,i.width=this.parameters.width??0,i.height=this.parameters.height??0,this._glTexture=new Jt(e,i,r),this._glTexture}_loadFromURL(e,r){return this._loadAsync(async i=>{const n=await z_(r,{signal:i});return vr(i),this._loadFromImage(e,n)})}_loadFromImageElement(e,r){return r.complete?this._loadFromImage(e,r):this._loadAsync(async i=>{const n=await FIe(r,r.src,!1,i);return vr(i),this._loadFromImage(e,n)})}_loadFromVideoElement(e,r){return r.readyState>=wD.HAVE_CURRENT_DATA?this._loadFromImage(e,r):this._loadFromVideoElementAsync(e,r)}_loadFromVideoElementAsync(e,r){return this._loadAsync(i=>new Promise((n,s)=>{const o=()=>{r.removeEventListener("loadeddata",a),r.removeEventListener("error",l),yi(c)},a=()=>{r.readyState>=wD.HAVE_CURRENT_DATA&&(o(),n(this._loadFromImage(e,r)))},l=u=>{o(),s(u||new H("Failed to load video"))};r.addEventListener("loadeddata",a),r.addEventListener("error",l);const c=Dl(i,()=>l(Wr()))}))}_loadFromImage(e,r){const i=U8e(r);this.parameters.width=i.width,this.parameters.height=i.height;const n=this._createDescriptor(e);return n.pixelFormat=this.parameters.components===3?Yt.RGB:Yt.RGBA,n.width=i.width,n.height=i.height,this._glTexture=new Jt(e,n,r),this._glTexture}_loadAsync(e){const r=new AbortController;this._loadingController=r;const i=e(r.signal);this._loadingPromise=i;const n=()=>{this._loadingController===r&&(this._loadingController=null),this._loadingPromise===i&&(this._loadingPromise=null)};return i.then(n,n),i}unload(){if(this._glTexture=pt(this._glTexture),this._loadingController!=null){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}};function H$t(t,e){if(t==null)return 0;if(Y$(t)||cw(t))return e.encoding===n_.KTX2_ENCODING?T$t(t,!!e.mipmap):e.encoding===n_.BASIS_ENCODING?S$t(t,!!e.mipmap):t.byteLength;const{width:r,height:i}=t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement?U8e(t):e;return(e.mipmap?4/3:1)*r*i*(e.components||4)||0}function U8e(t){return t instanceof HTMLVideoElement?{width:t.videoWidth,height:t.videoHeight}:t}var wD;(function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(wD||(wD={}));const ZN=128,Nhe=.5;function q$t(t,e=ZN,r=e*Nhe,i=0){const n=z8e(t,e,r,i);return new qE(n,{mipmap:!1,wrap:{s:ir.CLAMP_TO_EDGE,t:ir.CLAMP_TO_EDGE},width:e,height:e,components:4,noUnpackFlip:!0})}function z8e(t,e=ZN,r=e*Nhe,i=0){switch(t){case"circle":default:return W$t(e,r);case"square":return X$t(e,r);case"cross":return Z$t(e,r,i);case"x":return J$t(e,r,i);case"kite":return Y$t(e,r);case"triangle":return K$t(e,r);case"arrow":return Q$t(e,r)}}function W$t(t,e){const r=t/2-.5;return AF(t,j8e(r,r,e/2))}function X$t(t,e){return V8e(t,e,!1)}function Y$t(t,e){return V8e(t,e,!0)}function Z$t(t,e,r=0){return B8e(t,e,!1,r)}function J$t(t,e,r=0){return B8e(t,e,!0,r)}function K$t(t,e){return AF(t,G8e(t/2,e,e/2))}function Q$t(t,e){const r=e,i=e/2,n=t/2,s=.8*r,o=j8e(n,(t-e)/2-s,Math.sqrt(s*s+i*i)),a=G8e(n,r,i);return AF(t,(l,c)=>Math.max(a(l,c),-o(l,c)))}function V8e(t,e,r){return r&&(e/=Math.SQRT2),AF(t,(i,n)=>{let s=i-.5*t+.25,o=.5*t-n-.75;if(r){const a=(s+o)/Math.SQRT2;o=(o-s)/Math.SQRT2,s=a}return Math.max(Math.abs(s),Math.abs(o))-.5*e})}function B8e(t,e,r,i=0){e-=i,r&&(e*=Math.SQRT2);const n=.5*e;return AF(t,(s,o)=>{let a,l=s-.5*t,c=.5*t-o-1;if(r){const u=(l+c)/Math.SQRT2;c=(c-l)/Math.SQRT2,l=u}return l=Math.abs(l),c=Math.abs(c),a=l>c?l>n?Math.sqrt((l-n)*(l-n)+c*c):c:c>n?Math.sqrt(l*l+(c-n)*(c-n)):l,a-=i/2,a})}function j8e(t,e,r){return(i,n)=>{const s=i-t,o=n-e;return Math.sqrt(s*s+o*o)-r}}function G8e(t,e,r){const i=Math.sqrt(e*e+r*r);return(n,s)=>{const o=Math.abs(n-t)-r,a=s-t+e/2+.75,l=(e*o+r*a)/i,c=-a;return Math.max(l,c)}}function AF(t,e){const r=new Uint8Array(4*t*t);for(let i=0;i<t;i++)for(let n=0;n<t;n++){const s=n+t*i;let o=e(n,i);o=o/t+.5,YN(o,r,4*s)}return r}let Rvr=class extends Ai{constructor(e){super(),this.slicePlaneLocalOrigin=e}};function eIt(t,e){H8e(t,e,new ar("slicePlaneOrigin",(r,i)=>Y8e(e,r,i)),new ar("slicePlaneBasis1",(r,i)=>{var n;return HB(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new ar("slicePlaneBasis2",(r,i)=>{var n;return HB(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)}))}function as(t,e){H8e(t,e,new _h("slicePlaneOrigin",(r,i)=>Y8e(e,r,i)),new _h("slicePlaneBasis1",(r,i)=>{var n;return HB(e,r,i,(n=i.slicePlane)==null?void 0:n.basis1)}),new _h("slicePlaneBasis2",(r,i)=>{var n;return HB(e,r,i,(n=i.slicePlane)==null?void 0:n.basis2)}))}function H8e(t,e,...r){if(!e.hasSlicePlane){const o=T`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`;return e.hasSliceInVertexProgram&&t.vertex.code.add(o),void t.fragment.code.add(o)}e.hasSliceInVertexProgram&&t.vertex.uniforms.add(...r),t.fragment.uniforms.add(...r);const i=T`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`,n=T`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`,s=e.hasSliceHighlight?T`
        ${n}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:T`#define highlightSlice(_color_, _pos_) (_color_)`;e.hasSliceInVertexProgram&&t.vertex.code.add(i),t.fragment.code.add(i),t.fragment.code.add(s)}function q8e(t,e,r){return t.instancedDoublePrecision?se(tIt,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):e.slicePlaneLocalOrigin}function W8e(t,e){return t!=null?ve(qB,e.origin,t):e.origin}function X8e(t,e,r){return t.hasSliceTranslatedView?e!=null?hu(rIt,r.camera.viewMatrix,e):r.camera.viewMatrix:null}function Y8e(t,e,r){if(r.slicePlane==null)return Sc;const i=q8e(t,e,r),n=W8e(i,r.slicePlane),s=X8e(t,i,r);return s!=null?lt(qB,n,s):n}function HB(t,e,r,i){if(i==null||r.slicePlane==null)return Sc;const n=q8e(t,e,r),s=W8e(n,r.slicePlane),o=X8e(t,n,r);return o!=null?(ge(e$,i,s),lt(qB,s,o),lt(e$,e$,o),ve(e$,e$,qB)):i}const tIt=A(),qB=A(),e$=A(),rIt=Me();function PF(t,e){const r=e.output===q.ObjectAndLayerIdColor,i=e.objectAndLayerIdColorInstanced;r&&(t.varyings.add("objectAndLayerIdColorVarying","vec4"),i?t.attributes.add(O.INSTANCEOBJECTANDLAYERIDCOLOR,"vec4"):t.attributes.add(O.OBJECTANDLAYERIDCOLOR,"vec4")),t.vertex.code.add(T`
     void forwardObjectAndLayerIdColor() {
      ${r?i?T`objectAndLayerIdColorVarying = instanceObjectAndLayerIdColor * 0.003921568627451;`:T`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:T``} }`),t.fragment.code.add(T`
      void outputObjectAndLayerIdColor() {
        ${r?T`fragColor = objectAndLayerIdColorVarying;`:T``} }`)}function iIt(t,e){const{vertex:r,fragment:i}=t;r.include(NH),e.hasMultipassGeometry&&r.include(A6e),e.hasMultipassTerrain&&t.varyings.add("depth","float"),r.code.add(T`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${e.hasMultipassGeometry?T`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${e.hasMultipassTerrain?"depth = projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `),e.hasMultipassTerrain&&i.include(Ph),e.hasMultipassTerrain&&i.uniforms.add(new Mt("terrainDepthTexture",(n,s)=>s.multipassTerrain.linearDepthTexture),new Yr("nearFar",(n,s)=>s.camera.nearFar)),i.include(Od),i.code.add(T`
  void main() {
    fragColor = vec4(1);
    ${e.hasMultipassTerrain?T`
          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            fragColor.g = 0.5;
          }`:""}
  }
  `)}const nIt=nr(1,1,0,1),Z8e=nr(1,0,1,1);function s1(t){t.fragment.uniforms.add(new Mt("depthTexture",(e,r)=>r.highlightDepthTexture)),t.fragment.constants.add("occludedHighlightFlag","vec4",nIt).add("unoccludedHighlightFlag","vec4",Z8e),t.fragment.code.add(T`void outputHighlight() {
float sceneDepth = float(texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x);
if (gl_FragCoord.z > sceneDepth + 5e-7) {
fragColor = occludedHighlightFlag;
} else {
fragColor = unoccludedHighlightFlag;
}
}`)}let J8e=class extends Zn{constructor(e,r,i){super(e,"vec4",Ci.Pass,(n,s,o)=>n.setUniform4fv(e,r(s,o)),i)}},ru=class extends Zn{constructor(e,r,i){super(e,"float",Ci.Pass,(n,s,o)=>n.setUniform1fv(e,r(s,o)),i)}};var Ol,zwe;(function(t){t[t.Undefined=0]="Undefined",t[t.DefinedSize=1]="DefinedSize",t[t.DefinedScale=2]="DefinedScale"})(Ol||(Ol={})),function(t){t[t.Undefined=0]="Undefined",t[t.DefinedAngle=1]="DefinedAngle"}(zwe||(zwe={}));let Fhe=class{constructor(e){this.field=e}},sIt=class extends Fhe{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[Ol.Undefined,Ol.Undefined,Ol.Undefined]}},oIt=class extends Fhe{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0]}},aIt=class extends Fhe{constructor(e){super(e),this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}},lIt=class{};function t$(t){return t!=null}function OC(t){return typeof t=="number"}function FH(t){return typeof t=="string"}function cIt(t){return t==null||FH(t)}function yo(t,e){t&&t.push(e)}function uIt(t,e,r,i=Me()){const n=t||0,s=e||0,o=r||0;return n!==0&&bP(i,i,-n/180*Math.PI),s!==0&&_P(i,i,s/180*Math.PI),o!==0&&P7(i,i,o/180*Math.PI),i}function P1(t,e,r,i,n){const s=t.minSize,o=t.maxSize;if(t.expression)return yo(n,"Could not convert size info: expression not supported"),!1;if(t.useSymbolValue){const a=i.symbolSize[r];return e.minSize[r]=a,e.maxSize[r]=a,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Ol.DefinedSize,!0}if(t$(t.field))return t$(t.stops)?t.stops.length===2&&OC(t.stops[0].size)&&OC(t.stops[1].size)?(Vwe(t.stops[0].size,t.stops[1].size,t.stops[0].value,t.stops[1].value,e,r),e.type[r]=Ol.DefinedSize,!0):(yo(n,"Could not convert size info: stops only supported with 2 elements"),!1):OC(s)&&OC(o)&&t$(t.minDataValue)&&t$(t.maxDataValue)?(Vwe(s,o,t.minDataValue,t.maxDataValue,e,r),e.type[r]=Ol.DefinedSize,!0):t.valueUnit==="unknown"?(yo(n,"Could not convert size info: proportional size not supported"),!1):RP[t.valueUnit]!=null?(e.minSize[r]=-1/0,e.maxSize[r]=1/0,e.offset[r]=0,e.factor[r]=1/RP[t.valueUnit],e.type[r]=Ol.DefinedSize,!0):(yo(n,"Could not convert size info: scale-dependent size not supported"),!1);if(!t$(t.field)){if(t.stops&&t.stops[0]&&OC(t.stops[0].size))return e.minSize[r]=t.stops[0].size,e.maxSize[r]=t.stops[0].size,e.offset[r]=e.minSize[r],e.factor[r]=0,e.type[r]=Ol.DefinedSize,!0;if(OC(s))return e.minSize[r]=s,e.maxSize[r]=s,e.offset[r]=s,e.factor[r]=0,e.type[r]=Ol.DefinedSize,!0}return yo(n,"Could not convert size info: unsupported variant of sizeInfo"),!1}function Vwe(t,e,r,i,n,s){const o=Math.abs(i-r)>0?(e-t)/(i-r):0;n.minSize[s]=o>0?t:e,n.maxSize[s]=o>0?e:t,n.offset[s]=t-r*o,n.factor[s]=o}function dIt(t,e,r,i){if(t.normalizationField||t.valueRepresentation)return yo(i,"Could not convert size info: unsupported property"),null;if(!cIt(t.field))return yo(i,"Could not convert size info: field is not a string"),null;if(e.size){if(t.field)if(e.size.field){if(t.field!==e.size.field)return yo(i,"Could not convert size info: multiple fields in use"),null}else e.size.field=t.field}else e.size=new sIt(t.field);let n;switch(t.axis){case"width":return n=P1(t,e.size,0,r,i),n?e:null;case"height":return n=P1(t,e.size,2,r,i),n?e:null;case"depth":return n=P1(t,e.size,1,r,i),n?e:null;case"width-and-depth":return n=P1(t,e.size,0,r,i),n&&P1(t,e.size,1,r,i),n?e:null;case null:case void 0:case"all":return n=P1(t,e.size,0,r,i),n=n&&P1(t,e.size,1,r,i),n=n&&P1(t,e.size,2,r,i),n?e:null;default:return yo(i,`Could not convert size info: unknown axis "${t.axis}""`),null}}function hIt(t,e,r){for(let n=0;n<3;++n){let s=e.unitInMeters;t.type[n]===Ol.DefinedSize&&(s*=e.modelSize[n],t.type[n]=Ol.DefinedScale),t.minSize[n]=t.minSize[n]/s,t.maxSize[n]=t.maxSize[n]/s,t.offset[n]=t.offset[n]/s,t.factor[n]=t.factor[n]/s}let i;if(t.type[0]!==Ol.Undefined)i=0;else if(t.type[1]!==Ol.Undefined)i=1;else{if(t.type[2]===Ol.Undefined)return yo(r,"No size axis contains a valid size or scale"),!1;i=2}for(let n=0;n<3;++n)t.type[n]===Ol.Undefined&&(t.minSize[n]=t.minSize[i],t.maxSize[n]=t.maxSize[i],t.offset[n]=t.offset[i],t.factor[n]=t.factor[i],t.type[n]=t.type[i]);return!0}function Bwe(t,e,r){t[4*e]=r.r/255,t[4*e+1]=r.g/255,t[4*e+2]=r.b/255,t[4*e+3]=r.a}function pIt(t,e,r){if(t.normalizationField)return yo(r,"Could not convert color info: unsupported property"),null;if(FH(t.field)){if(!t.stops)return yo(r,"Could not convert color info: missing stops or colors"),null;{if(t.stops.length>8)return yo(r,"Could not convert color info: too many color stops"),null;e.color=new oIt(t.field);const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.color.values[n]=s.value,Bwe(e.color.colors,n,s.color)}}}else{if(!(t.stops&&t.stops.length>=0))return yo(r,"Could not convert color info: no field and no colors/stops"),null;{const i=t.stops&&t.stops.length>=0&&t.stops[0].color;e.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.color.values[n]=1/0,Bwe(e.color.colors,n,i)}}return e}function fIt(t,e,r){if(t.normalizationField)return yo(r,"Could not convert opacity info: unsupported property"),null;if(FH(t.field)){if(!t.stops)return yo(r,"Could not convert opacity info: missing stops or opacities"),null;{if(t.stops.length>8)return yo(r,"Could not convert opacity info: too many opacity stops"),null;e.opacity=new aIt(t.field);const i=t.stops;for(let n=0;n<8;++n){const s=i[Math.min(n,i.length-1)];e.opacity.values[n]=s.value,e.opacity.opacityValues[n]=s.opacity}}}else{if(!(t.stops&&t.stops.length>=0))return yo(r,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=t.stops&&t.stops.length>=0?t.stops[0].opacity:0;e.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};for(let n=0;n<8;n++)e.opacity.values[n]=1/0,e.opacity.opacityValues[n]=i}}return e}function OY(t,e,r){const i=r===2&&t.rotationType==="arithmetic";e.offset[r]=i?90:0,e.factor[r]=i?-1:1,e.type[r]=1}function mIt(t,e,r){if(!FH(t.field))return yo(r,"Could not convert rotation info: field is not a string"),null;if(e.rotation){if(t.field)if(e.rotation.field){if(t.field!==e.rotation.field)return yo(r,"Could not convert rotation info: multiple fields in use"),null}else e.rotation.field=t.field}else e.rotation={field:t.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(t.axis){case"tilt":return OY(t,e.rotation,0),e;case"roll":return OY(t,e.rotation,1),e;case null:case void 0:case"heading":return OY(t,e.rotation,2),e;default:return yo(r,`Could not convert rotation info: unknown axis "${t.axis}""`),null}}let MF=class{constructor(e,r=[1,1,1],i=[1,1,1],n=1,s=[0,0,0],o=[1,1,1],a=[0,0,0]){this.supports=e,this.modelSize=r,this.symbolSize=i,this.unitInMeters=n,this.anchor=s,this.scale=o,this.rotation=a}};function K8e(t,e,r){if(!t)return null;const i=t.reduce((n,s)=>{if(!n)return n;if(s.valueExpression)return yo(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(s.type){case"size":return e.supports.size?dIt(s,n,e,r):n;case"color":return e.supports.color?pIt(s,n,r):n;case"opacity":return e.supports.opacity?fIt(s,n,r):null;case"rotation":return e.supports.rotation?mIt(s,n,r):n;default:return null}},new lIt);return!(t.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i&&i.size&&!hIt(i.size,e,r)?null:i:null}let gIt=class{constructor(e,r,i){this.visualVariables=e,this.materialParameters=r,this.requiresShaderTransformation=i}};function ZP(t,e){if(!t||Di.TESTS_DISABLE_FAST_UPDATES)return null;const r=K8e(t.visualVariables,e);return r?new gIt(r,eze(r,e),!!r.size):null}function JP(t,e,r){if(!e||!t)return!1;const i=t.visualVariables,n=K8e(e.visualVariables,r);return!!n&&!!(a6(i.size,n.size,"size")&&a6(i.color,n.color,"color")&&a6(i.rotation,n.rotation,"rotation")&&a6(i.opacity,n.opacity,"opacity"))&&(t.visualVariables=n,t.materialParameters=eze(n,r),t.requiresShaderTransformation=!!n.size,!0)}function a6(t,e,r){if(!!t!=!!e||t&&t.field!==(e==null?void 0:e.field))return!1;if(t&&r==="rotation"){const i=t,n=e;for(let s=0;s<3;s++)if(i.type[s]!==n.type[s]||i.offset[s]!==n.offset[s]||i.factor[s]!==n.factor[s])return!1}return!0}let Q8e=class extends Ai{constructor(e){super(),this.vvSize=(e==null?void 0:e.size)??null,this.vvColor=(e==null?void 0:e.color)??null,this.vvOpacity=(e==null?void 0:e.opacity)??null}};function eze(t,e){const r=new Q8e(t);return r.vvSize&&(r.vvSymbolAnchor=e.anchor,af(xD),uIt(e.rotation[2],e.rotation[0],e.rotation[1],xD),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||vn(),uf(r.vvSymbolRotationMatrix,xD)),r}function qie(t,e,r){if(!t.vvSize)return r;Rs(M1,r);const i=t.vvSymbolRotationMatrix;S0(xD,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),Ii(M1,M1,xD);for(let n=0;n<3;++n){const s=t.vvSize.offset[n]+e[0]*t.vvSize.factor[n];jwe[n]=Te(s,t.vvSize.minSize[n],t.vvSize.maxSize[n])}return A7(M1,M1,jwe),hu(M1,M1,t.vvSymbolAnchor),M1}function yIt(t,e,r){if(e.vvSize)for(let i=0;i<3;++i){const n=e.vvSize.offset[i]+r[0]*e.vvSize.factor[i];t[i]=Te(n,e.vvSize.minSize[i],e.vvSize.maxSize[i])}else se(t,1,1,1)}function Km(t,e){const r=t==null?0:e.attributes[t];return typeof r=="number"&&isFinite(r)?r:0}const M1=Me(),jwe=A(),xD=Me();let $F=class extends Q8e{constructor(){super(...arguments),this.renderOccluded=gn.Occlude}};const LA=8;function o_(t,e){const{vertex:r,attributes:i}=t;e.hasVvInstancing&&(e.vvSize||e.vvColor)&&i.add(O.INSTANCEFEATUREATTRIBUTE,"vec4"),e.vvSize?(r.uniforms.add(new ar("vvSizeMinSize",n=>n.vvSize.minSize)),r.uniforms.add(new ar("vvSizeMaxSize",n=>n.vvSize.maxSize)),r.uniforms.add(new ar("vvSizeOffset",n=>n.vvSize.offset)),r.uniforms.add(new ar("vvSizeFactor",n=>n.vvSize.factor)),r.uniforms.add(new xf("vvSymbolRotationMatrix",n=>n.vvSymbolRotationMatrix)),r.uniforms.add(new ar("vvSymbolAnchor",n=>n.vvSymbolAnchor)),r.code.add(T`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),r.code.add(T`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?T`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.code.add(T`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vvColor?(r.constants.add("vvColorNumber","int",LA),r.uniforms.add(new ru("vvColorValues",n=>n.vvColor.values,LA),new J8e("vvColorColors",n=>n.vvColor.colors,LA)),r.code.add(T`
      vec4 interpolateVVColor(float value) {
        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${e.hasVvInstancing?T`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }`:"vec4 vvColor() { return vec4(1.0); }"}
    `)):r.code.add(T`vec4 vvColor() { return vec4(1.0); }`)}const WB=.1,Ma=.001;function vIt(t){const e=new jr,r=t.signedDistanceFieldEnabled;if(e.include(_8e,t),e.include(as,t),t.occlusionPass)return e.include(iIt,t),e;const{vertex:i,fragment:n}=e;e.include(Che),n.include(Od),n.include(R0),e.include(o_,t),e.include(PF,t),e.varyings.add("vcolor","vec4"),e.varyings.add("vtc","vec2"),e.varyings.add("vsize","vec2"),t.binaryHighlightOcclusionEnabled&&e.varyings.add("voccluded","float"),i.uniforms.add(new Cr("viewport",(c,u)=>u.camera.fullViewport),new Yr("screenOffset",(c,u)=>Or(tze,2*c.screenOffset[0]*u.camera.pixelRatio,2*c.screenOffset[1]*u.camera.pixelRatio)),new Yr("anchorPosition",c=>XB(c)),new Cr("materialColor",c=>c.color)),Z3(i,t),r&&(i.uniforms.add(new Cr("outlineColor",c=>c.outlineColor)),n.uniforms.add(new Cr("outlineColor",c=>Gwe(c)?c.outlineColor:Wy),new Ye("outlineSize",c=>Gwe(c)?c.outlineSize:0))),t.hasScreenSizePerspective&&(o$t(i),DH(i)),(t.debugDrawLabelBorder||t.binaryHighlightOcclusionEnabled)&&e.varyings.add("debugBorderCoords","vec4"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.COLOR,"vec4"),e.attributes.add(O.SIZE,"vec2"),e.attributes.add(O.AUXPOS2,"vec4"),i.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${t.hasScreenSizePerspective?T`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:T`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${t.vvSize?"inputSize *= vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${t.occlusionTestEnabled||t.binaryHighlightOcclusionEnabled?"bool visible = testVisibilityHUD(posProj);":""}

      ${t.binaryHighlightOcclusionEnabled?"voccluded = visible ? 0.0 : 1.0;":""}
    `);const s=T`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;t.pixelSnappingEnabled&&i.include(NH);const o=t.pixelSnappingEnabled?r?T`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:T`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:T`posProj += quadOffset;`;i.code.add(T`
    ${t.occlusionTestEnabled?"if (visible) {":""}
    ${s}
    ${t.vvColor?"vcolor = interpolateVVColor(auxpos2.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${t.output===q.ObjectAndLayerIdColor?T`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${T.float(Ma)};
    ${r?`alphaDiscard = alphaDiscard && outlineColor.a < ${T.float(Ma)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${o}
      gl_Position = posProj;
    }

    vtc = uv;

    ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${t.occlusionTestEnabled?T`} else { vtc = vec2(0.0);
      ${t.debugDrawLabelBorder?"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `),n.uniforms.add(new Mt("tex",c=>c.texture));const a=t.debugDrawLabelBorder?T`(isBorder > 0.0 ? 0.0 : ${T.float(WB)})`:T.float(WB),l=T`
    ${t.debugDrawLabelBorder?T`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${r?T`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${T.float(ZN)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${a} ||
          fillPixelColor.a + outlinePixelColor.a < ${T.float(Ma)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        fragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${a}) {
          discard;
        }

        fragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:T`
          vec4 texColor = texture(tex, vtc, -0.5);
          if (texColor.a < ${a}) {
            discard;
          }
          fragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${t.debugDrawLabelBorder?T`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;return t.output===q.Alpha&&n.code.add(T`
      void main() {
        ${l}
        fragColor = vec4(fragColor.a);
      }
      `),t.output===q.ObjectAndLayerIdColor&&n.code.add(T`
      void main() {
        ${l}
        outputObjectAndLayerIdColor();
      }
      `),t.output===q.Color&&n.code.add(T`
    void main() {
      ${l}
      ${t.transparencyPassType===kt.FrontFace?"fragColor.rgb /= fragColor.a;":""}
    }
    `),t.output===q.Highlight&&(e.include(s1,t),n.code.add(T`
    void main() {
      ${l}
      ${t.binaryHighlightOcclusionEnabled?T`
          if (voccluded == 1.0) {
            fragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            fragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `)),e}function Gwe(t){return t.outlineColor[3]>0&&t.outlineSize>0}function XB(t,e=tze){return t.textureIsSignedDistanceField?_It(t.anchorPosition,t.distanceFieldBoundingBox,e):Eo(e,t.anchorPosition),e}function _It(t,e,r){e!=null?Or(r,t[0]*(e[2]-e[0])+e[0],t[1]*(e[3]-e[1])+e[1]):Or(r,0,0)}const tze=Qe(),bIt=Object.freeze(Object.defineProperty({__proto__:null,build:vIt,calculateAnchorPosForRendering:XB},Symbol.toStringTag,{value:"Module"})),bh=Fa(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),wIt=Ed(De.ONE,De.ONE),rze=Ed(De.ZERO,De.ONE_MINUS_SRC_ALPHA);function o1(t){return t===kt.FrontFace?null:t===kt.Alpha?rze:wIt}function kH(t){return t===kt.FrontFace?fu:null}const UH=5e5,zH={factor:-1,units:-2};function VH(t){return t?zH:null}function Px(t,e=Oi.LESS){return t===kt.NONE||t===kt.FrontFace?e:Oi.LEQUAL}let ize=class nze extends si{initializeConfiguration(e,r){r.spherical=e.viewingMode===at.Global}initializeProgram(e){return new Kr(e.rctx,nze.shader.get().build(this.configuration),Br)}_setPipelineState(e){const r=this.configuration,i=e===kt.NONE,n=e===kt.FrontFace,s=this.configuration.hasPolygonOffset?xIt:null,o=(i||n)&&r.output!==q.Highlight&&(r.depthEnabled||r.occlusionPass)?fu:null;return Qt({blending:r.output===q.Color||r.output===q.Alpha||r.output===q.Highlight?i?SIt:o1(e):null,depthTest:{func:Oi.LEQUAL},depthWrite:o,colorWrite:hr,polygonOffset:s})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}get primitiveType(){return this.configuration.occlusionPass?Zt.POINTS:Zt.TRIANGLES}};ize.shader=new Jr(bIt,()=>le(()=>import("./HUDMaterial.glsl-ebe85de3.js"),[]));const xIt={factor:0,units:-4},SIt=Ed(De.ONE,De.ONE_MINUS_SRC_ALPHA);let fs=class extends tl{constructor(){super(...arguments),this.output=q.Color,this.screenCenterOffsetUnitsEnabled=tu.World,this.transparencyPassType=kt.NONE,this.spherical=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.vvSize=!1,this.vvColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.debugDrawLabelBorder=!1,this.binaryHighlightOcclusionEnabled=!0,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.depthEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.hasMultipassGeometry=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.occlusionPass=!1,this.objectAndLayerIdColorInstanced=!1}};d([X({count:q.COUNT})],fs.prototype,"output",void 0),d([X({count:tu.COUNT})],fs.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([X({count:kt.COUNT})],fs.prototype,"transparencyPassType",void 0),d([X()],fs.prototype,"spherical",void 0),d([X()],fs.prototype,"occlusionTestEnabled",void 0),d([X()],fs.prototype,"signedDistanceFieldEnabled",void 0),d([X()],fs.prototype,"vvSize",void 0),d([X()],fs.prototype,"vvColor",void 0),d([X()],fs.prototype,"hasVerticalOffset",void 0),d([X()],fs.prototype,"hasScreenSizePerspective",void 0),d([X()],fs.prototype,"debugDrawLabelBorder",void 0),d([X()],fs.prototype,"binaryHighlightOcclusionEnabled",void 0),d([X()],fs.prototype,"hasSlicePlane",void 0),d([X()],fs.prototype,"hasPolygonOffset",void 0),d([X()],fs.prototype,"depthEnabled",void 0),d([X()],fs.prototype,"pixelSnappingEnabled",void 0),d([X()],fs.prototype,"draped",void 0),d([X()],fs.prototype,"hasMultipassGeometry",void 0),d([X()],fs.prototype,"hasMultipassTerrain",void 0),d([X()],fs.prototype,"cullAboveGround",void 0),d([X()],fs.prototype,"occlusionPass",void 0),d([X()],fs.prototype,"objectAndLayerIdColorInstanced",void 0),d([X({constValue:!0})],fs.prototype,"hasSliceInVertexProgram",void 0),d([X({constValue:!1})],fs.prototype,"hasVvInstancing",void 0);let KP=class extends Ax{constructor(e){super(e,new IIt),this._configuration=new fs}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?tu.Screen:tu.World,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=this.parameters.isDraped,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.occlusionPass=r.slot===_e.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(e===q.Color||e===q.Alpha),e===q.Color&&(this._configuration.debugDrawLabelBorder=!!Di.LABELS_SHOW_BORDER),e===q.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion),this._configuration.depthEnabled=this.parameters.depthEnabled,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!i.options.hud||!e.visible)return;const a=this.parameters;let l=1,c=1;if(uf(PY,r),e.shaderTransformer!=null){const w=e.shaderTransformer(Wwe);l=w[0],c=w[5],CIt(PY)}const u=e.vertexAttributes.get(O.POSITION),h=e.vertexAttributes.get(O.SIZE),f=e.vertexAttributes.get(O.NORMAL),m=e.vertexAttributes.get(O.AUXPOS1);It(u.size>=3);const g=i.point,y=i.camera,_=XB(a);l*=y.pixelRatio,c*=y.pixelRatio;const b=this.parameters.centerOffsetUnits==="screen";for(let w=0;w<u.data.length/u.size;w++){const x=w*u.size;se(ml,u.data[x],u.data[x+1],u.data[x+2]),lt(ml,ml,r);const S=w*h.size;$1[0]=h.data[S]*l,$1[1]=h.data[S+1]*c,lt(ml,ml,y.viewMatrix);const C=w*m.size;if(se(Id,m.data[C],m.data[C+1],m.data[C+2]),!b&&(ml[0]+=Id[0],ml[1]+=Id[1],Id[2]!==0)){const R=Id[2];Se(Id,ml),ve(ml,ml,ce(Id,Id,R))}const E=w*f.size;if(se(r$,f.data[E],f.data[E+1],f.data[E+2]),this._normalAndViewAngle(r$,PY,y,MY),this._applyVerticalOffsetTransformationView(ml,MY,y,AY),y.applyProjection(ml,Yl),Yl[0]>-1){Yl[0]=Math.floor(Yl[0]),Yl[1]=Math.floor(Yl[1]),b&&(Id[0]||Id[1])&&(Yl[0]+=Id[0],Id[1]!==0&&(Yl[1]+=Ehe(Id[1],AY.factorAlignment)),y.unapplyProjection(Yl,ml)),Yl[0]+=this.parameters.screenOffset[0],Yl[1]+=this.parameters.screenOffset[1],u8e($1,AY.factor,$1);const R=PIt*y.pixelRatio;let P=0;if(a.textureIsSignedDistanceField&&(P=a.outlineSize*y.pixelRatio/2),g&&Hwe(g,Yl[0],Yl[1],$1,R,P,a,_)){const D=i.ray;if(lt(qwe,ml,Uo(AIt,y.viewMatrix)),Yl[0]=g[0],Yl[1]=g[1],y.unprojectFromRenderScreen(Yl,ml)){const L=A();oe(L,D.direction);const k=1/We(L);ce(L,L,k),o(Li(D.origin,ml)*k,L,-1,!0,1,qwe)}}}}}intersectDraped(e,r,i,n,s,o){const a=e.vertexAttributes.get(O.POSITION),l=e.vertexAttributes.get(O.SIZE),c=this.parameters,u=XB(c);let h=1,f=1;if(e.shaderTransformer!=null){const g=e.shaderTransformer(Wwe);h=g[0],f=g[5]}h*=e.screenToWorldRatio,f*=e.screenToWorldRatio;const m=MIt*e.screenToWorldRatio;for(let g=0;g<a.data.length/a.size;g++){const y=g*a.size,_=a.data[y],b=a.data[y+1],w=g*l.size;$1[0]=l.data[w]*h,$1[1]=l.data[w+1]*f;let x=0;c.textureIsSignedDistanceField&&(x=c.outlineSize*e.screenToWorldRatio/2),Hwe(n,_,b,$1,m,x,c,u)&&s(o.dist,o.normal,-1,!1)}}createBufferWriter(){return new DIt(this)}_normalAndViewAngle(e,r,i,n){return s$t(r)&&(r=uf(OIt,r)),nd(n.normal,e,r),lt(n.normal,n.normal,i.viewInverseTransposeMatrix),n.cosAngle=ye(sze,$It),n}_updateScaleInfo(e,r,i){const n=this.parameters;n.screenSizePerspective!=null?Mwe(i,r,n.screenSizePerspective,e.factor):(e.factor.scale=1,e.factor.factor=0,e.factor.minPixelSize=0,e.factor.paddingPixels=0),n.screenSizePerspectiveAlignment!=null?Mwe(i,r,n.screenSizePerspectiveAlignment,e.factorAlignment):(e.factorAlignment.factor=e.factor.factor,e.factorAlignment.scale=e.factor.scale,e.factorAlignment.minPixelSize=e.factor.minPixelSize,e.factorAlignment.paddingPixels=e.factor.paddingPixels)}applyShaderOffsetsView(e,r,i,n,s,o,a){const l=this._normalAndViewAngle(r,i,s,MY);return this._applyVerticalGroundOffsetView(e,l,s,a),this._applyVerticalOffsetTransformationView(a,l,s,o),this._applyPolygonOffsetView(a,l,n[3],s,a),this._applyCenterOffsetView(a,n,a),a}applyShaderOffsetsNDC(e,r,i,n,s){return this._applyCenterOffsetNDC(e,r,i,n),s!=null&&oe(s,n),this._applyPolygonOffsetNDC(n,r,i,n),n}_applyPolygonOffsetView(e,r,i,n,s){const o=n.aboveGround?1:-1;let a=Math.sign(i);a===0&&(a=o);const l=o*a;if(this.parameters.shaderPolygonOffset<=0)return oe(s,e);const c=Te(Math.abs(r.cosAngle),.01,1),u=1-Math.sqrt(1-c*c)/c/n.viewport[2];return ce(s,e,l>0?u:1/u),s}_applyVerticalGroundOffsetView(e,r,i,n){const s=We(e),o=i.aboveGround?1:-1,a=.5*i.computeRenderPixelSizeAtDist(s),l=ce(ml,r.normal,o*a);return ge(n,e,l),n}_applyVerticalOffsetTransformationView(e,r,i,n){const s=this.parameters;if(!s.verticalOffset||!s.verticalOffset.screenLength){if(s.screenSizePerspective||s.screenSizePerspectiveAlignment){const c=We(e);this._updateScaleInfo(n,c,r.cosAngle)}else n.factor.scale=1,n.factorAlignment.scale=1;return e}const o=We(e),a=s.screenSizePerspectiveAlignment??s.screenSizePerspective,l=T8e(i,o,s.verticalOffset,r.cosAngle,a);return this._updateScaleInfo(n,o,r.cosAngle),ce(r.normal,r.normal,l),ge(e,e,r.normal)}_applyCenterOffsetView(e,r,i){const n=this.parameters.centerOffsetUnits!=="screen";return i!==e&&oe(i,e),n&&(i[0]+=r[0],i[1]+=r[1],r[2]&&(Se(r$,i),ge(i,i,ce(r$,r$,r[2])))),i}_applyCenterOffsetNDC(e,r,i,n){const s=this.parameters.centerOffsetUnits!=="screen";return n!==e&&oe(n,e),s||(n[0]+=r[0]/i.fullWidth*2,n[1]+=r[1]/i.fullHeight*2),n}_applyPolygonOffsetNDC(e,r,i,n){const s=this.parameters.shaderPolygonOffset;if(e!==n&&oe(n,e),s){const o=i.aboveGround?1:-1,a=o*Math.sign(r[3]);n[2]-=(a||o)*s}return n}requiresSlot(e,r){if(r===q.Color||r===q.Alpha||r===q.Highlight||r===q.ObjectAndLayerIdColor){if(e===_e.DRAPED_MATERIAL)return!0;const{drawInSecondSlot:i,occlusionTest:n}=this.parameters;return e===(i?_e.LABEL_MATERIAL:_e.HUD_MATERIAL)||n&&e===_e.OCCLUSION_PIXELS}return!1}createGLMaterial(e){return new TIt(e)}calculateRelativeScreenBounds(e,r,i=lr()){return EIt(this.parameters,e,r,i),i[2]=i[0]+e[0],i[3]=i[1]+e[1],i}},TIt=class extends Hde{constructor(e){super({...e,...e.material.parameters})}selectProgram(e){return this.ensureTechnique(ize,e)}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.selectProgram(e)}};function EIt(t,e,r,i=RIt){return Eo(i,t.anchorPosition),i[0]*=-e[0],i[1]*=-e[1],i[0]+=t.screenOffset[0]*r,i[1]+=t.screenOffset[1]*r,i}function CIt(t){const e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=1/Math.sqrt(e*e+r*r+i*i),h=1/Math.sqrt(n*n+s*s+o*o),f=1/Math.sqrt(a*a+l*l+c*c);return t[0]=e*u,t[1]=r*u,t[2]=i*u,t[3]=n*h,t[4]=s*h,t[5]=o*h,t[6]=a*f,t[7]=l*f,t[8]=c*f,t}function Hwe(t,e,r,i,n,s,o,a){let l=e-n-(a[0]>0?i[0]*a[0]:0),c=l+i[0]+2*n,u=r-n-(a[1]>0?i[1]*a[1]:0),h=u+i[1]+2*n;const f=o.distanceFieldBoundingBox;return o.textureIsSignedDistanceField&&f!=null&&(l+=i[0]*f[0],u+=i[1]*f[1],c-=i[0]*(1-f[2]),h-=i[1]*(1-f[3]),l-=s,c+=s,u-=s,h+=s),t[0]>l&&t[0]<c&&t[1]>u&&t[1]<h}const AY=new O8e,RIt=Qe(),ml=A(),r$=A(),Yl=wr(),sze=A(),qwe=A(),PY=vn(),OIt=vn(),AIt=Me(),Id=A(),MY={normal:sze,cosAngle:0},Wwe=Me(),PIt=1,MIt=2,$1=[0,0],$It=Ue(0,0,1);let IIt=class extends _6e{constructor(){super(...arguments),this.renderOccluded=gn.Occlude,this.color=nr(1,1,1,1),this.texCoordScale=[1,1],this.polygonOffset=!1,this.anchorPosition=Nr(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.outlineColor=nr(1,1,1,1),this.outlineSize=0,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.binaryHighlightOcclusion=!0,this.centerOffsetUnits="world",this.drawInSecondSlot=!1,this.depthEnabled=!0,this.isDraped=!1}};const oze=On().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4u8(O.COLOR).vec2f(O.SIZE).vec4f(O.AUXPOS1).vec4f(O.AUXPOS2),LIt=oze.clone().vec4u8(O.OBJECTANDLAYERIDCOLOR);let DIt=class{constructor(e){this._material=e,this.vertexBufferLayout=he("enable-feature:objectAndLayerId-rendering")?LIt:oze}elementCount(e){return 6*e.indices.get(O.POSITION).length}write(e,r,i,n,s){$he(i.indices.get(O.POSITION),i.vertexAttributes.get(O.POSITION).data,e,n.position,s,6),Ihe(i.indices.get(O.NORMAL),i.vertexAttributes.get(O.NORMAL).data,r,n.normal,s,6);const o=i.vertexAttributes.get(O.UV0).data;let a,l,c,u;if(o==null||o.length<4){const b=this._material.parameters;a=0,l=0,c=b.texCoordScale[0],u=b.texCoordScale[1]}else a=o[0],l=o[1],c=o[2],u=o[3];c=Math.min(1.99999,c+1),u=Math.min(1.99999,u+1);let h=i.indices.get(O.POSITION).length,f=s;const m=n.uv0;for(let b=0;b<h;++b)m.set(f,0,a),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,l),f+=1,m.set(f,0,c),m.set(f,1,u),f+=1,m.set(f,0,c),m.set(f,1,u),f+=1,m.set(f,0,a),m.set(f,1,u),f+=1,m.set(f,0,a),m.set(f,1,l),f+=1;P8e(i.indices.get(O.COLOR),i.vertexAttributes.get(O.COLOR).data,4,n.color,s,6);const g=i.indices.get(O.SIZE),y=i.vertexAttributes.get(O.SIZE).data;h=g.length;const _=n.size;f=s;for(let b=0;b<h;++b){const w=y[2*g[b]],x=y[2*g[b]+1];for(let S=0;S<6;++S)_.set(f,0,w),_.set(f,1,x),f+=1}if(i.indices.get(O.AUXPOS1)&&i.vertexAttributes.get(O.AUXPOS1)?YP(i.indices.get(O.AUXPOS1),i.vertexAttributes.get(O.AUXPOS1).data,n.auxpos1,s,6):Uwe(n.auxpos1,s,6*h),i.indices.get(O.AUXPOS2)&&i.vertexAttributes.get(O.AUXPOS2)?YP(i.indices.get(O.AUXPOS2),i.vertexAttributes.get(O.AUXPOS2).data,n.auxpos2,s,6):Uwe(n.auxpos2,s,6*h),i.objectAndLayerIdColor!=null&&i.indices.get(O.POSITION)){const b=i.indices.get(O.POSITION).length,w=n.getField(O.OBJECTANDLAYERIDCOLOR,zl);M8e(i.objectAndLayerIdColor,w,b,s,6)}}};const Mg=A(),AC=wr(),i$=wr(),$Y=A(),NIt=Me(),FIt=us(),IY=la(),kIt=A(),UIt=lr();class zIt{constructor(){this.aabr=lr(),this.distance=0,this.culled=!1,this.visible=!1}}class VIt{constructor(e,r){this.graphics3DGraphic=e,this.slicePlaneEnabled=r,this.info={}}}var Vu;(function(t){t[t.Idle=0]="Idle",t[t.Process=1]="Process",t[t.Sort=2]="Sort",t[t.Deconflict=3]="Deconflict",t[t.NumStates=4]="NumStates"})(Vu||(Vu={}));class aze{constructor(){this.camera=new Bt,this.slicePlane=Z_(),this.slicePlaneEnabled=!1}copyFrom(e){this.camera.copyFrom(e.camera),VE(e.slicePlane,this.slicePlane),this.slicePlaneEnabled=e.slicePlaneEnabled}}let eA=class extends Ce{get dirty(){return this._dirty}get state(){return this._state}constructor(t){super(t),this._dirty=!1,this._runningViewState=new aze,this._state=Vu.Idle,this._active=new Map,this._visible=new Map,this._iterators=new HIt,this._accBinsNumX=15,this._accBinsNumY=20,this._accBinsSizeX=0,this._accBinsSizeY=0,this._accBins=null,this.accNumTests=0}destroy(){this._active.clear(),this._visible.clear(),this._iterators=null}setDirty(){!this._dirty&&this._active.size>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){return this._state!==Vu.Idle||this._dirty}get updatingProgress(){if(!this.updating)return 1;const t=this._state/Vu.NumStates;return this._dirty?.5*t:t}get running(){return this.view.ready&&this.view.state!=null&&this.updating}runTask(t){switch(this._state){case Vu.Idle:this._startUpdate(),t.madeProgress();case Vu.Process:if(this._state=Vu.Process,!this._processActiveGraphics(t))return;case Vu.Sort:if(this._state=Vu.Sort,!this._sortVisibleGraphics(t))return;case Vu.Deconflict:if(this._state=Vu.Deconflict,!this._deconflictVisibleGraphics(t))return;default:XMt(this,this._visible),this._state=Vu.Idle,this.notifyChange("updating")}}modifyGraphics(t,e){e?t.forEach(r=>this.addToActiveGraphics(r)):t.forEach(r=>this.removeFromActiveGraphics(r)),this.setDirty()}layerSupportsDeconfliction(t){if(t==null||t.type!=="object3d")return!1;const e=t.stageObject;if((e?e.geometries.length:0)!==1)return!1;const r=e==null?void 0:e.geometries[0];return(r==null?void 0:r.material)instanceof KP}_startUpdate(){YMt(this.view),this._dirty=!1,this._runningViewState.copyFrom(this.viewState);const{fullWidth:t,fullHeight:e}=this._runningViewState.camera;this._initBins(t,e),this._resetIterators()}addToActiveGraphics(t){t.info[this.visibilityGroup]=new zIt,this._active.set(t.graphics3DGraphic.graphic.uid,t),this.setDirty()}removeFromActiveGraphics(t){this._visible.delete(t.graphics3DGraphic.graphic.uid),BIt(t,this.visibilityGroup),delete t.info[this.visibilityGroup],this._active.delete(t.graphics3DGraphic.graphic.uid),this.setDirty()}_processActiveGraphics(t){const e=this._ensureActiveGraphicsIterator(),r=A3(NIt,this._runningViewState.camera.projectionMatrix),i=this.view.viewingMode==="global"&&this.view.map.ground.opacity===1&&this._runningViewState.camera.relativeElevation>0?FIt:null;let n=0;for(i!=null&&(lt(i,Sc,this._runningViewState.camera.viewMatrix),i[3]=Xr(this.view.spatialReference).radius,n=GFe(i,Sc));!t.done;){t.madeProgress();const s=e.next();if(s.done===!0)return this._resetActiveGraphicsIterator(),!0;const o=s.value,a=o&&o.info[this.visibilityGroup];a&&(this._collectGraphics3DGraphics(o,r,i,n),a.culled?this._visible.delete(o.graphics3DGraphic.graphic.uid):this._visible.set(o.graphics3DGraphic.graphic.uid,o))}return!1}_sortVisibleGraphics(t){const e=this._ensureSortGraphicsIterator();for(;!t.done;){const r=e.next();if(t.madeProgress(),r.done===!0)return this._resetSortGraphicsIterator(),!0}return!1}_deconflictVisibleGraphics(t){const e=this._ensureVisibleGraphicsIterator(),r=this.visibilityGroup===oa.LABEL;for(;!t.done;){t.madeProgress();const i=e.next();if(i.done===!0)return this._resetVisibleGraphicsIterator(),!0;const n=i.value,s=n.info[this.visibilityGroup];if(!s||s.culled)continue;const o=n.graphics3DGraphic,a=!r||o.isVisible();s.visible=a&&!this._isConflicted(n),s.visible&&this._addToBins(n),this._setGraphicVisibility(n,s.visible),JMt(s,s.visible)}return!1}_resetIterators(){this._iterators.active=null,this._iterators.visible=null,this._iterators.sort=null}_ensureActiveGraphicsIterator(){return this._iterators.active||(this._iterators.active=Xwe(this._active)),this._iterators.active}_resetActiveGraphicsIterator(){this._iterators.active=null}_ensureVisibleGraphicsIterator(){return this._iterators.visible||(this._iterators.visible=Xwe(this._visible)),this._iterators.visible}_resetVisibleGraphicsIterator(){this._iterators.visible=null}_ensureSortGraphicsIterator(){return this._iterators.sort||(this._iterators.sort=jIt(this._visible,this._iterators.sortArray,this.visibilityGroup)),this._iterators.sort}_resetSortGraphicsIterator(){this._iterators.sort=null}_collectGraphics3DGraphics(t,e,r,i){const n=t.graphics3DGraphic;if(n.destroyed)return;const s=t.info[this.visibilityGroup];if(!n.isVisible(oa.GRAPHIC,rl.DECONFLICTION))return void(s.culled=!0);const o=this.getGraphicsLayers(n);xd(s.aabr);let a=null;for(const l of o){if(!this.layerSupportsDeconfliction(l))continue;const c=l.stageObject.geometries[0].material;if(a==null&&(a=XIt,this._getProjectionInfo(l,e,a),a.isOutsideScreen||this._isCulledBySlice(t,Mg)||r!=null&&this._isCulledByHorizon(a,r,i)))return void(s.culled=!0);this._expandBoundingRect(s,l,c,a)}a==null?s.culled=!0:(s.distance=a.distance,s.culled=!1)}_getProjectionInfo(t,e,r){const i=this._runningViewState.camera,n=t.stageObject,s=n.geometries[0],o=s.material,a=n.boundingVolumeWorldSpace.bounds;lt(Mg,a,i.viewMatrix);const l=s.vertexAttributes,c=l.get(O.NORMAL).data,u=l.get(O.AUXPOS1).data;o.applyShaderOffsetsView(Mg,c,n.transformation,u,i,r.scaleInfo,Mg),Ki(AC,Mg[0],Mg[1],Mg[2],1),hh(i$,AC,i.projectionMatrix),ce(r.positionNDC,i$,1/i$[3]),o.applyShaderOffsetsNDC(r.positionNDC,u,i,r.positionNDC,$Y),r.distanceWithoutPolygonOffset=i.depthNDCToWorld($Y[2]),r.distance=$Y[2]===r.positionNDC[2]?r.distanceWithoutPolygonOffset:i.depthNDCToWorld(r.positionNDC[2]),Ki(i$,r.positionNDC[0],r.positionNDC[1],r.positionNDC[2],1),hh(AC,i$,e),eE(AC,AC,1/AC[3]),se(r.positionView,Mg[0],Mg[1],Mg[2])}_isCulledByHorizon(t,e,r){return oe(IY.direction,t.positionView),se(IY.origin,0,0,0),!!Cx(e,IY,kIt)&&t.distanceWithoutPolygonOffset>r}_isCulledBySlice(t,e){return t.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&ude(this._runningViewState.slicePlane,e)}_expandBoundingRect(t,e,r,{positionNDC:i,scaleInfo:n}){const s=this._runningViewState.camera,o=e.getScreenSize(qIt);u8e(o,n.factor,o),o[0]*=s.pixelRatio,o[1]*=s.pixelRatio;const a=kV(r.calculateRelativeScreenBounds(o,n.factorAlignment.scale,UIt),Xt(0,s.fullWidth,.5+.5*i[0]),Xt(0,s.fullHeight,.5+.5*i[1])),l=this.iconMarginFactor;if(l!==0){const c=l*Math.min(lh(a),og(a));a[0]-=c,a[1]-=c,a[2]+=c,a[3]+=c}Fw(t.aabr,a,t.aabr)}_isConflicted(t){const e=t.graphics3DGraphic.graphic.uid,r=t.info[this.visibilityGroup];for(let i=Math.floor(r.aabr[0]/this._accBinsSizeX);i<=Math.floor(r.aabr[2]/this._accBinsSizeX);i++)if(!(i<0||i>=this._accBinsNumX))for(let n=Math.floor(r.aabr[1]/this._accBinsSizeY);n<=Math.floor(r.aabr[3]/this._accBinsSizeY);n++){if(n<0||n>=this._accBinsNumY)continue;const s=this._accBins[i][n];for(let o=0;o<s.length;o++){const a=s.data[o],l=a.info[this.visibilityGroup];if(l&&l.visible&&a.graphics3DGraphic.graphic.uid!==e&&(this.accNumTests++,Z4(l.aabr,r.aabr)))return!0}}return!1}_initBins(t,e){if(this._accBins==null){this._accBins=[];for(let r=0;r<this._accBinsNumX;r++){this._accBins.push([]);const i=this._accBins[this._accBins.length-1];for(let n=0;n<this._accBinsNumY;n++)i.push(new dr)}}else for(let r=0;r<this._accBinsNumX;r++)for(let i=0;i<this._accBinsNumY;i++)this._accBins[r][i].clear();this._accBinsSizeX=t/this._accBinsNumX,this._accBinsSizeY=e/this._accBinsNumY,this.accNumTests=0}_addToBins(t){const e=t.info[this.visibilityGroup],r=Math.floor(e.aabr[0]/this._accBinsSizeX),i=Math.floor(e.aabr[2]/this._accBinsSizeX),n=Math.floor(e.aabr[1]/this._accBinsSizeY),s=Math.floor(e.aabr[3]/this._accBinsSizeY);for(let o=r;o<=i;o++)if(!(o<0||o>=this._accBinsNumX))for(let a=n;a<=s;a++)a<0||a>=this._accBinsNumY||this._accBins[o][a].push(t)}_setGraphicVisibility(t,e){const r=t.graphics3DGraphic;r.destroyed||(r.setVisibilityFlag(this.visibilityGroup,rl.DECONFLICTION,e),this.visibilityGroup===oa.LABEL&&this.view.labeler.setLabelGraphicVisibility(r,e))}};function BIt(t,e){const r=t.graphics3DGraphic;r.destroyed||r.setVisibilityFlag(e,rl.DECONFLICTION,!0)}function*Xwe(t){if(Map.prototype.entries){const e=t.entries();for(let r=e.next();!r.done;r=e.next())yield r.value[1]}else yield*t.values()}function*jIt(t,e,r){e.clear(),t.forEach((n,s)=>{const o=e.pushNew();o.id=s,o.visible=n.graphics3DGraphic.getVisibilityFlag(r,rl.DECONFLICTION);const a=n.info&&n.info[r];o.prio=n.graphics3DGraphic.deconflictionPriority,o.distance=a?a.distance:Number.MAX_VALUE}),yield;const i=e.iterableSort((n,s)=>n.prio!==s.prio?s.prio-n.prio:n.distance!==s.distance?n.distance-s.distance:n.visible!==s.visible?n.visible?-1:1:n.id-s.id);for(let n=i.next();!n.done;n=i.next())yield;e.forAll(n=>{const s=t.get(n.id);s&&(t.delete(n.id),t.set(n.id,s))}),e.clear()}d([p({constructOnly:!0})],eA.prototype,"view",void 0),d([p({type:Boolean,readOnly:!0})],eA.prototype,"updating",null),eA=d([I("esri.views.3d.layers.graphics.Deconflictor")],eA);class GIt{constructor(){this.id=0,this.visible=!1,this.prio=0,this.distance=0}}class HIt{constructor(e=null,r=null,i=null){this.active=e,this.visible=r,this.sort=i,this.sortArray=new dr({allocator:n=>n||new GIt})}}const qIt=Qe();class WIt{constructor(){this.positionView=A(),this.positionNDC=A(),this.distance=0,this.distanceWithoutPolygonOffset=0,this.scaleInfo=new O8e}get isOutsideScreen(){const e=this.positionNDC;return e[0]<-1||e[1]<-1||e[2]<-1||e[0]>=1||e[1]>=1}}const XIt=new WIt,YIt=2e3;let Oz=class extends eA{constructor(e){super(e),this.visibilityGroup=oa.LABEL,this.iconMarginFactor=0,this._lastDeconfliction=0}get viewState(){return this.parent.viewState}runTask(e){if(this.parent.running)return ll.YIELD;const r=performance.now();if(e.state!==ai.IDLE&&r-this._lastDeconfliction<YIt)return ll.YIELD;super.runTask(e),this.state===Vu.Idle&&(this._lastDeconfliction=r)}enabledChanged(e,r){this.modifyGraphics(r,e.labelsEnabled)}getGraphicsLayers(e){return e.labelLayers}};d([p({constructOnly:!0})],Oz.prototype,"parent",void 0),Oz=d([I("esri.views.3d.layers.graphics.LabelDeconflictor")],Oz);let Wie=class extends eA{constructor(){super(...arguments),this._handles=new Ri,this._contexts=new Map,this._viewState=new aze,this.visibilityGroup=oa.GRAPHIC,this._iconMarginFactor=-.1}get labels(){return this._labels}get viewState(){return this._viewState}initialize(){this._handles.add([pe(()=>{var e,r;return(r=(e=this.view)==null?void 0:e.state)==null?void 0:r.camera},()=>{this._updateViewState(),this.setDirty()}),pe(()=>{var e,r,i;return(i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity},(e,r)=>{e!==1&&r!==1||this.setDirty()}),pe(()=>{var e;return(e=this.view)==null?void 0:e.slicePlane},()=>{this._updateSlicePlane(),this._slicePlaneChanged()},_r)]),this._frameTask=this.view.resourceController.scheduler.registerTask(Vt.GRAPHICS_DECONFLICTOR,this),this._labels=new Oz({view:this.view,parent:this})}destroy(){this._labels.destroy(),this._labels=null,this._handles.destroy(),this._handles=null,this._frameTask&&(this._frameTask.remove(),this._frameTask=null)}get iconMarginFactor(){return this._iconMarginFactor}set iconMarginFactor(e){this._iconMarginFactor=e,this.setDirty()}setDirty(){this._contexts.size>0&&(super.setDirty(),this._labels.setDirty())}runTask(e){super.runTask(e),this.running||this._labels.setDirty()}setInitialIconVisibilityFlag(e,r){const i=!(this._graphicSupportsDeconfliction(r)&&LY(e));r.setVisibilityFlag(oa.GRAPHIC,rl.DECONFLICTION,i)}_updateViewState(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())}_updateSlicePlane(){const e=this.view?this.view.slicePlane:null;e!=null&&f5e(e,this._viewState.camera.viewMatrix,this._viewState.slicePlane),this._viewState.slicePlaneEnabled=e!=null}_slicePlaneChanged(){Pa(this._contexts,(e,r)=>r.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()}addGraphicsOwner(e){const r=this._getGraphicsContext(e);return{addGraphic:i=>this._addGraphic(e,r,i),removeGraphic:i=>this._removeGraphic(r,i),labelingInfoChange:()=>this._labels.enabledChanged(e,r),featureReductionChange:()=>this.enabledChanged(e,r),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(e,r),clear:()=>r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic))}}removeGraphicsOwner(e){const r=this._contexts.get(e);r&&(r.forEach(i=>this._removeGraphic(r,i.graphics3DGraphic)),this._contexts.delete(e),this.setDirty())}_addGraphic(e,r,i){const n=i.graphic.uid,s=new VIt(i,e.symbolCreationContext.slicePlaneEnabled);r.set(n,s),LY(e)&&this.addToActiveGraphics(s),e.labelsEnabled&&this._labels.addToActiveGraphics(s)}_removeGraphic(e,r){const i=r.graphic.uid,n=e.get(i);n&&(this.removeFromActiveGraphics(n),this._labels.removeFromActiveGraphics(n),e.delete(i),this.setDirty())}enabledChanged(e,r){const i=LY(e);i||ZIt(e),this.modifyGraphics(r,i)}_slicePlaneEnabledChanged(e,r){const i=e.symbolCreationContext.slicePlaneEnabled;r.forEach(n=>n.slicePlaneEnabled=i),this.setDirty()}getGraphicsLayers(e){return e.layers}_graphicSupportsDeconfliction(e){if(e.isDraped)return!1;const r=e.layers;if(!r||!r.length)return!1;for(const i of r)if(this.layerSupportsDeconfliction(i))return!0;return!1}_getGraphicsContext(e){const r=this._contexts.get(e);if(r)return r;const i=new Map;return this._contexts.set(e,i),this.setDirty(),i}};function LY(t){const e=t.layer;return!(!e||!e.featureReduction||e.featureReduction.type!=="selection")}function ZIt(t){const e=t.graphics3DGraphics;e&&e.forEach(r=>r.setVisibilityFlag(oa.GRAPHIC,rl.DECONFLICTION,!0))}Wie=d([I("esri.views.3d.layers.graphics.GraphicsDeconflictor")],Wie);function lze(t){return 32+t.length}function cze(t){return 16}function uze(t){if(!t)return 0;let e=pze;for(const r in t)if(t.hasOwnProperty(r)){const i=t[r];switch(typeof i){case"string":e+=lze(i);break;case"number":e+=cze();break;case"boolean":e+=4}}return e}function dze(t){if(!t)return 0;if(Array.isArray(t))return JIt(t);let e=pze;for(const r in t)t.hasOwnProperty(r)&&(e+=hze(t[r]));return e}function JIt(t){const e=t.length;if(e===0||typeof t[0]=="number")return 32+8*e;let r=fze;for(let i=0;i<e;i++)r+=hze(t[i]);return r}function hze(t){switch(typeof t){case"object":return dze(t);case"string":return lze(t);case"number":return cze();case"boolean":return 4;default:return 8}}function Wvr(t,e){return fze+t.length*e}const pze=32,fze=32,khe=(t,e,r)=>[e,r],QP=(t,e,r)=>[e,r,t[2]],Uhe=(t,e,r)=>[e,r,t[2],t[3]];function Xvr(t){return t?{originPosition:t.originPosition==="upper-left"?"upperLeft":t.originPosition==="lower-left"?"lowerLeft":t.originPosition,scale:t.tolerance?[t.tolerance,t.tolerance]:[1,1],translate:t.extent!=null?[t.extent.xmin,t.extent.ymax]:[0,0]}:null}function KIt({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function QIt({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function mze({scale:t,translate:e},r){return r*t[0]+e[0]}function gze({scale:t,translate:e},r){return e[1]-r*t[1]}function yze(t,e,r){const i=new Array(r.length);if(!r.length)return i;const[n,s]=t.scale;let o=mze(t,r[0][0]),a=gze(t,r[0][1]);i[0]=e(r[0],o,a);for(let l=1;l<r.length;l++){const c=r[l];o+=c[0]*n,a-=c[1]*s,i[l]=e(c,o,a)}return i}function vze(t,e,r){const i=new Array(r.length);for(let n=0;n<r.length;n++)i[n]=yze(t,e,r[n]);return i}function eLt(t,e,r,i){return yze(t,r?i?Uhe:QP:i?QP:khe,e)}function tLt(t,e,r,i){return vze(t,r?i?Uhe:QP:i?QP:khe,e)}function rLt(t,e,r,i){return vze(t,r?i?Uhe:QP:i?QP:khe,e)}function Yvr(t,e,r,i,n){return e.x=KIt(t,r.x),e.y=QIt(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m)),e}function _ze(t,e,r,i,n){return r!=null&&(e.points=eLt(t,r.points,i,n)),e}function bze(t,e,r,i,n){return r==null||(e.x=mze(t,r.x),e.y=gze(t,r.y),e!==r&&(i&&(e.z=r.z),n&&(e.m=r.m))),e}function wze(t,e,r,i,n){return r!=null&&(e.rings=rLt(t,r.rings,i,n)),e}function xze(t,e,r,i,n){return r!=null&&(e.paths=tLt(t,r.paths,i,n)),e}var Xie;let qI=Xie=class extends me{constructor(t){super(t),this.name=null,this.code=null}clone(){return new Xie({name:this.name,code:this.code})}};d([p({type:String,json:{write:!0}})],qI.prototype,"name",void 0),d([p({type:[String,Number],json:{write:!0}})],qI.prototype,"code",void 0),qI=Xie=d([I("esri.layers.support.CodedValue")],qI);const iLt=new ri({inherited:"inherited",codedValue:"coded-value",range:"range"});let WI=class extends me{constructor(e){super(e),this.name=null,this.type=null}};d([p({type:String,json:{write:!0}})],WI.prototype,"name",void 0),d([Rt(iLt)],WI.prototype,"type",void 0),WI=d([I("esri.layers.support.Domain")],WI);const BH=WI;var Yie;let XI=Yie=class extends BH{constructor(t){super(t),this.codedValues=null,this.type="coded-value"}getName(t){let e=null;if(this.codedValues){const r=String(t);this.codedValues.some(i=>(String(i.code)===r&&(e=i.name),!!e))}return e}clone(){return new Yie({codedValues:ie(this.codedValues),name:this.name})}};d([p({type:[qI],json:{write:!0}})],XI.prototype,"codedValues",void 0),d([Rt({codedValue:"coded-value"})],XI.prototype,"type",void 0),XI=Yie=d([I("esri.layers.support.CodedValueDomain")],XI);const Sze=XI;var Zie;let Az=Zie=class extends BH{constructor(t){super(t),this.type="inherited"}clone(){return new Zie}};d([Rt({inherited:"inherited"})],Az.prototype,"type",void 0),Az=Zie=d([I("esri.layers.support.InheritedDomain")],Az);const Tze=Az;var Jie;let HR=Jie=class extends BH{constructor(t){super(t),this.maxValue=null,this.minValue=null,this.type="range"}clone(){return new Jie({maxValue:this.maxValue,minValue:this.minValue,name:this.name})}};d([p({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[1]},write:{enabled:!1,overridePolicy(){return{enabled:this.maxValue!=null&&this.minValue==null}},target:"range",writer(t,e,r){e[r]=[this.minValue||0,t]}}}})],HR.prototype,"maxValue",void 0),d([p({type:Number,json:{type:[Number],read:{source:"range",reader:(t,e)=>e.range&&e.range[0]},write:{target:"range",writer(t,e,r){e[r]=[t,this.maxValue||0]}}}})],HR.prototype,"minValue",void 0),d([Rt({range:"range"})],HR.prototype,"type",void 0),HR=Jie=d([I("esri.layers.support.RangeDomain")],HR);const Eze=HR,Cze={key:"type",base:BH,typeMap:{range:Eze,"coded-value":Sze,inherited:Tze}};function zhe(t){if(!t||!t.type)return null;switch(t.type){case"range":return Eze.fromJSON(t);case"codedValue":return Sze.fromJSON(t);case"inherited":return Tze.fromJSON(t)}return null}var Kie;const nLt=new ri({binary:"binary",coordinate:"coordinate",countOrAmount:"count-or-amount",dateAndTime:"date-and-time",description:"description",locationOrPlaceName:"location-or-place-name",measurement:"measurement",nameOrTitle:"name-or-title",none:"none",orderedOrRanked:"ordered-or-ranked",percentageOrRatio:"percentage-or-ratio",typeOrCategory:"type-or-category",uniqueIdentifier:"unique-identifier"});let nc=Kie=class extends me{constructor(t){super(t),this.alias=null,this.defaultValue=void 0,this.description=null,this.domain=null,this.editable=!0,this.length=-1,this.name=null,this.nullable=!0,this.type=null,this.valueType=null,this.visible=!0}readDescription(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return(r==null?void 0:r.value)??null}readValueType(t,{description:e}){let r=null;try{r=e?JSON.parse(e):null}catch{}return r?nLt.fromJSON(r.fieldValueType):null}clone(){return new Kie({alias:this.alias,defaultValue:this.defaultValue,description:this.description,domain:this.domain&&this.domain.clone()||null,editable:this.editable,length:this.length,name:this.name,nullable:this.nullable,type:this.type,valueType:this.valueType,visible:this.visible})}};d([p({type:String,json:{write:!0}})],nc.prototype,"alias",void 0),d([p({type:[String,Number],json:{write:{allowNull:!0}}})],nc.prototype,"defaultValue",void 0),d([p()],nc.prototype,"description",void 0),d([ke("description")],nc.prototype,"readDescription",null),d([p({types:Cze,json:{read:{reader:zhe},write:!0}})],nc.prototype,"domain",void 0),d([p({type:Boolean,json:{write:!0}})],nc.prototype,"editable",void 0),d([p({type:hn,json:{write:!0}})],nc.prototype,"length",void 0),d([p({type:String,json:{write:!0}})],nc.prototype,"name",void 0),d([p({type:Boolean,json:{write:!0}})],nc.prototype,"nullable",void 0),d([Rt(mue)],nc.prototype,"type",void 0),d([p()],nc.prototype,"valueType",void 0),d([ke("valueType",["description"])],nc.prototype,"readValueType",null),d([p({type:Boolean,json:{read:!1}})],nc.prototype,"visible",void 0),nc=Kie=d([I("esri.layers.support.Field")],nc);const IF=nc;let Jvr=class{constructor(e,r,i){this.uid=e,this.geometry=r,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}};function Qvr(t){return t.geometry!=null}let e_r=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}};function r_r(t){var s;const e=O7.fromJSON(t.geometryType),r=dt.fromJSON(t.spatialReference),i=t.transform,n=t.features.map(o=>{const a=sLt(o,e,r,t.objectIdFieldName),l=a.geometry;if(l!=null&&i)switch(l.type){case"point":a.geometry=bze(i,l,l,l.hasZ,l.hasM);break;case"multipoint":a.geometry=_ze(i,l,l,!!l.hasZ,!!l.hasM);break;case"polygon":a.geometry=wze(i,l,l,!!l.hasZ,!!l.hasM);break;case"polyline":a.geometry=xze(i,l,l,!!l.hasZ,!!l.hasM);break;case"extent":case"mesh":a.geometry=l}return a});return{geometryType:e,features:n,spatialReference:r,fields:((s=t.fields)==null?void 0:s.map(o=>IF.fromJSON(o)))??[],objectIdFieldName:t.objectIdFieldName,globalIdFieldName:t.globalIdFieldName,geohashFieldName:t.geohashFieldName,geometryProperties:t.geometryProperties,hasZ:t.hasZ,hasM:t.hasM,exceededTransferLimit:t.exceededTransferLimit,transform:null}}function sLt(t,e,r,i){return{uid:au(),objectId:i&&t.attributes?t.attributes[i]:null,attributes:t.attributes,geometry:oLt(t.geometry,e,r),visible:!0}}function oLt(t,e,r){if(t==null)return null;switch(e){case"point":{const i=t;return{x:i.x,y:i.y,z:i.z,m:i.m,hasZ:i.z!=null,hasM:i.m!=null,type:"point",spatialReference:r}}case"polyline":{const i=t;return{paths:i.paths,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polyline",spatialReference:r}}case"polygon":{const i=t;return{rings:i.rings,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"polygon",spatialReference:r}}case"multipoint":{const i=t;return{points:i.points,hasZ:!!i.hasZ,hasM:!!i.hasM,type:"multipoint",spatialReference:r}}}}function yd(t,e,r,i){return{x:t,y:e,z:r,hasZ:r!=null,hasM:!1,spatialReference:i,type:"point"}}function aLt(t){if(t==null)return 0;let e=32;switch(t.type){case"point":e+=42;break;case"polyline":case"polygon":{let r=0;const i=2+(t.hasZ?1:0)+(t.hasM?1:0),n=t.type==="polyline"?t.paths:t.rings;for(const s of n)r+=s.length;e+=8*r*i+64,e+=128*r,e+=34,e+=32*(n.length+1);break}case"multipoint":{const r=2+(t.hasZ?1:0)+(t.hasM?1:0),i=t.points.length;e+=8*i*r+64,e+=128*i,e+=34,e+=32;break}case"extent":e+=98,t.hasM&&(e+=32),t.hasZ&&(e+=32);break;case"mesh":e+=uw(t.vertexAttributes.position),e+=uw(t.vertexAttributes.normal),e+=uw(t.vertexAttributes.uv),e+=uw(t.vertexAttributes.tangent)}return e}function i_r(t){let e=32;return e+=uze(t.attributes),e+=3,e+=8+aLt(t.geometry),e}function lLt(t){if(t==null)return 0;switch(t.type){case"point":return 1;case"polyline":{let e=0;for(const r of t.paths)e+=r.length;return e}case"polygon":{let e=0;for(const r of t.rings)e+=r.length;return e}case"multipoint":return t.points.length;case"extent":return 2;case"mesh":{const e=t.vertexAttributes&&t.vertexAttributes.position;return e?e.length/3:0}default:return}}function n_r(t){if(t==null)return!1;switch(t.type){case"extent":case"point":return!0;case"polyline":for(const e of t.paths)if(e.length>0)return!0;return!1;case"polygon":for(const e of t.rings)if(e.length>0)return!0;return!1;case"multipoint":return t.points.length>0;case"mesh":return!t.loaded||t.vertexAttributes.position.length>0}}function s_r(t,e){switch(en(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[3]=t.x,e[1]=e[4]=t.y,t.hasZ&&(e[2]=e[5]=t.z);break;case"polyline":for(let r=0;r<t.paths.length;r++)yX(e,t.paths[r],!!t.hasZ);break;case"polygon":for(let r=0;r<t.rings.length;r++)yX(e,t.rings[r],!!t.hasZ);break;case"multipoint":yX(e,t.points,!!t.hasZ);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[3]=t.xmax,e[4]=t.ymax,t.zmin!=null&&(e[2]=t.zmin),t.zmax!=null&&(e[5]=t.zmax)}}function cLt(t,e){switch(xd(e),t.type==="mesh"&&(t=t.extent),t.type){case"point":e[0]=e[2]=t.x,e[1]=e[3]=t.y;break;case"polyline":for(let r=0;r<t.paths.length;r++)QW(e,t.paths[r]);break;case"polygon":for(let r=0;r<t.rings.length;r++)QW(e,t.rings[r]);break;case"multipoint":QW(e,t.points);break;case"extent":e[0]=t.xmin,e[1]=t.ymin,e[2]=t.xmax,e[3]=t.ymax}}function o_r(t,e){return t.objectId!=null?t.objectId:t.attributes&&e?t.attributes[e]:null}function Rze(t){return"declaredClass"in t}function Ywe(t){return"declaredClass"in t}function uLt(t){return"declaredClass"in t}function dLt(t,e){return t?uLt(t)?t:new cf({layer:e,sourceLayer:e,visible:t.visible,symbol:ie(t.symbol),attributes:ie(t.attributes),geometry:Oze(t.geometry)}):null}function Oze(t){return t==null?null:Rze(t)?t:P_(hLt(t))}function hLt(t){const{wkid:e,wkt:r,latestWkid:i}=t.spatialReference,n={wkid:e,wkt:r,latestWkid:i};switch(t.type){case"point":{const{x:s,y:o,z:a,m:l}=t;return{x:s,y:o,z:a,m:l,spatialReference:n}}case"polygon":{const{rings:s,hasZ:o,hasM:a}=t;return{rings:Zwe(s),hasZ:o,hasM:a,spatialReference:n}}case"polyline":{const{paths:s,hasZ:o,hasM:a}=t;return{paths:Zwe(s),hasZ:o,hasM:a,spatialReference:n}}case"extent":{const{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:h,mmax:f,hasZ:m,hasM:g}=t;return{xmin:s,xmax:o,ymin:a,ymax:l,zmin:c,zmax:u,mmin:h,mmax:f,hasZ:m,hasM:g,spatialReference:n}}case"multipoint":{const{points:s,hasZ:o,hasM:a}=t;return{points:Pze(s)?Aze(s):s,hasZ:o,hasM:a,spatialReference:n}}default:return}}function Zwe(t){return pLt(t)?t.map(e=>Aze(e)):t}function Aze(t){return t.map(e=>Array.from(e))}function pLt(t){for(const e of t)if(e.length!==0)return Pze(e);return!1}function Pze(t){return t.length>0&&(b3(t[0])||w3(t[0]))}function fLt(t,e){if(!t)return null;let r;if(Ywe(t)){if(e==null)return t.clone();if(Ywe(e))return e.copy(t)}return e!=null?(r=e,r.x=t.x,r.y=t.y,r.spatialReference=t.spatialReference,t.hasZ?(r.z=t.z,r.hasZ=t.hasZ):(r.z=void 0,r.hasZ=!1),t.hasM?(r.m=t.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=yd(t.x,t.y,t.z,t.spatialReference),t.hasM&&(r.m=t.m,r.hasM=!0)),r}function a_r(t){const{wkid:e,wkt:r,latestWkid:i}=t,n={wkid:e,wkt:r,latestWkid:i};return dt.fromJSON(n)}const Vhe="__begin__",Bhe="__end__",mLt=new RegExp(Vhe,"ig"),gLt=new RegExp(Bhe,"ig"),Jwe=new RegExp("^"+Vhe,"i"),Kwe=new RegExp(Bhe+"$","i"),YB='"',yLt=YB+" + ",vLt=" + "+YB;function _Lt(t){return t.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function bLt(t){return t.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")}function jH(t){const e={expression:"",type:"none"};return t.labelExpressionInfo?t.labelExpressionInfo.value?(e.expression=t.labelExpressionInfo.value,e.type="conventional"):t.labelExpressionInfo.expression&&(e.expression=t.labelExpressionInfo.expression,e.type="arcade"):t.labelExpression!=null&&(e.expression=_Lt(t.labelExpression),e.type="conventional"),e}function wLt(t){const e=jH(t);if(!e)return null;switch(e.type){case"conventional":return Qie(e.expression);case"arcade":return e.expression}return null}function xLt(t){const e=jH(t);if(!e)return null;switch(e.type){case"conventional":return TLt(e.expression);case"arcade":return jhe(e.expression)}return null}function Qie(t){let e;return t?(e=d7(t,r=>Vhe+'$feature["'+r+'"]'+Bhe),e=Jwe.test(e)?e.replace(Jwe,""):YB+e,e=Kwe.test(e)?e.replace(Kwe,""):e+YB,e=e.replaceAll(mLt,yLt).replaceAll(gLt,vLt)):e='""',e}const SLt=/^\s*\{([^}]+)\}\s*$/i;function TLt(t){const e=t==null?void 0:t.match(SLt);return e&&e[1].trim()||null}const ELt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*$/i,CLt=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])([\w\s]+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,RLt=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])([\w\s]+)(\1)\s*\));?\s*$/i;function jhe(t){if(!t)return null;let e=ELt.exec(t)||CLt.exec(t);return e?e[1]||e[3]:(e=RLt.exec(t),e?e[2]:null)}const DY=re.getLogger("esri.layers.support.labelFormatUtils"),NY={type:"simple",evaluate:()=>null},OLt={getAttribute:(t,e)=>t.field(e)};async function Mze(t,e,r){if(!t||!t.symbol||!e)return NY;const i=t.where,n=jH(t),s=i?await le(()=>import("./WhereClause-50cca87e.js").then(a=>a.W),["assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js"]):null;let o;if(n.type==="arcade"){const a=await y0t(n.expression,r,e);if(a==null)return NY;o={type:"arcade",evaluate(l){try{const c=a.evaluate({$feature:"attributes"in l?a.repurposeFeature(l):l},a.services);if(c!=null)return c.toString()}catch(c){DY.error(new H("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:c,feature:l,expression:n}))}return null},needsHydrationToEvaluate:()=>jhe(n.expression)==null}}else o={type:"simple",evaluate:a=>n.expression.replaceAll(/{[^}]*}/g,l=>{const c=l.slice(1,-1),u=e.get(c);if(!u)return l;let h=null;return"attributes"in a?a&&a.attributes&&(h=a.attributes[u.name]):h=a.field(u.name),h==null?"":$ze(h,u)})};if(i){let a;try{a=s.WhereClause.create(i,e)}catch(c){return DY.error(new H("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:i,error:c})),NY}const l=o.evaluate;o.evaluate=c=>{const u="attributes"in c?void 0:OLt;try{if(a.testFeature(c,u))return l(c)}catch(h){DY.error(new H("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:i,feature:c,error:h}))}return null}}return o}function $ze(t,e){if(t==null)return"";const r=e.domain;if(r){if(r.type==="codedValue"||r.type==="coded-value"){const n=t;for(const s of r.codedValues)if(s.code===n)return s.name}else if(r.type==="range"){const n=+t,s="range"in r?r.range[0]:r.minValue,o="range"in r?r.range[1]:r.maxValue;if(s<=n&&n<=o)return r.name}}let i=t;return e.type==="date"||e.type==="esriFieldTypeDate"?i=tx(i,pI("short-date")):bue(e)&&(i=PP(+i)),i||""}const l_r=Object.freeze(Object.defineProperty({__proto__:null,createLabelFunction:Mze,formatField:$ze},Symbol.toStringTag,{value:"Module"}));let Ize=class{constructor(e=null,r="center",i="center",n=null,s=[0,0,0],o=0,a=[0,0,0,1],l=[0,0],c="world",u=0,h=0){this.verticalOffset=e,this.horizontalPlacement=r,this.verticalPlacement=i,this.text=n,this.translation=s,this.elevationOffset=o,this.centerOffset=a,this.screenOffset=l,this.centerOffsetUnits=c,this.displayWidth=u,this.displayHeight=h}};function Ghe(t,e){if(t.type==="point")return I1(t,e,!1);if(Rze(t))switch(t.type){case"extent":return I1(t.center,e,!1);case"polygon":return I1(t.centroid,e,!1);case"polyline":return I1(Qwe(t),e,!0);case"mesh":return I1(t.origin,e,!1)}else switch(t.type){case"extent":return I1(ALt(t),e,!0);case"polygon":return I1(PLt(t),e,!0);case"polyline":return I1(Qwe(t),e,!0)}}function Qwe(t){const e=t.paths[0];if(!e||e.length===0)return null;const r=TLe(e,SLe(e)/2);return yd(r[0],r[1],r[2],t.spatialReference)}function ALt(t){return yd(.5*(t.xmax+t.xmin),.5*(t.ymax+t.ymin),t.zmin!=null&&t.zmax!=null&&isFinite(t.zmin)&&isFinite(t.zmax)?.5*(t.zmax+t.zmin):void 0,t.spatialReference)}function PLt(t){const e=t.rings[0];if(!e||e.length===0)return null;const r=CLe(t.rings,!!t.hasZ);return yd(r[0],r[1],r[2],t.spatialReference)}function I1(t,e,r){const i=r?t:fLt(t);return e&&t?yDe(t,i,e)?i:null:i}function u_r(t,e,r,i=0){if(t){e||(e=lr());const n=t;let s=.5*n.width*(r-1),o=.5*n.height*(r-1);return n.width<1e-7*n.height?s+=o/20:n.height<1e-7*n.width&&(o+=s/20),Ki(e,n.xmin-s-i,n.ymin-o-i,n.xmax+s+i,n.ymax+o+i),e}return null}function Lze(t,e){for(let r=0;r<t.geometries.length;++r){const i=t.geometries[r].getMutableAttribute(O.AUXPOS1);i&&i.data[3]!==e&&(i.data[3]=e,t.geometryVertexAttrsUpdated(t.geometries[r]))}}function SD(t,e,r=null){const i=mF(Np);return t!=null&&(i[0]=t[0],i[1]=t[1],i[2]=t[2]),e!=null?i[3]=e:t!=null&&t.length>3&&(i[3]=t[3]),r&&(i[0]*=r,i[1]*=r,i[2]*=r,i[3]*=r),i}function d_r(t,e,r,i,n,s=[0,0,0,0]){for(let o=0;o<3;++o)t!=null&&t[o]!=null?s[o]=t[o]:r!=null&&r[o]!=null?s[o]=r[o]:s[o]=n[o];return s[3]=e??i??n[3],s}function exe(t=qv,e,r,i=1){const n=new Array(3);if(e==null||r==null)n[0]=1,n[1]=1,n[2]=1;else{let s,o=0;for(let a=2;a>=0;a--){const l=t[a];let c;const u=l!=null,h=a===0&&!s&&!u,f=r[a];l==="symbol-value"||h?c=f!==0?e[a]/f:1:u&&l!=="proportional"&&isFinite(l)&&(c=f!==0?l/f:1),c!=null&&(n[a]=c,s=c,o=Math.max(o,Math.abs(c)))}for(let a=2;a>=0;a--)n[a]==null?n[a]=s:n[a]===0&&(n[a]=.001*o)}for(let s=2;s>=0;s--)n[s]/=i;return mc(n)}function MLt(t){return t.isPrimitive!=null}function GH(t){return ene(MLt(t)?[t.width,t.depth,t.height]:t)?null:"Symbol sizes may not be negative values"}function ene(t){const e=r=>r==null||r>=0;return Array.isArray(t)?t.every(e):e(t)}function $Lt(t,e,r,i=Me()){return t&&bP(i,i,-t/180*Math.PI),e&&_P(i,i,e/180*Math.PI),r&&P7(i,i,r/180*Math.PI),i}function Hhe(t,e,r){if(r.minDemResolution!=null)return r.minDemResolution;const i=Pc(e),n=DE(t)*i,s=NE(t)*i,o=Ex(t)*(e.isGeographic?1:i);return n===0&&s===0&&o===0?r.minDemResolutionForPoints:.01*Math.max(n,s,o)}function Dze(t,e,r,i,n,s,o,a,l,c,u){const h=zLt[u.mode];let f,m,g=0;if(Ni(t,e,r,i,l.spatialReference,n,a))return h.requiresAlignment(u)?(g=h.applyElevationAlignmentBuffer(i,n,s,o,a,l,c,u),f=s,m=o):(f=i,m=n),Ni(f,l.spatialReference,m,s,c.spatialReference,o,a)?g:void 0}function fx(t,e,r,i,n){const s=(fB(t)?t.z:N5e(t)?t.array[t.offset+2]:t[2])||0;switch(r.mode){case"on-the-ground":{const o=Dy(e,t,"ground")??0;return n.verticalDistanceToGround=0,n.sampledElevation=o,void(n.z=o)}case"relative-to-ground":{const o=Dy(e,t,"ground")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"relative-to-scene":{const o=Dy(e,t,"scene")??0,a=r.geometryZWithOffset(s,i);return n.verticalDistanceToGround=a,n.sampledElevation=o,void(n.z=a+o)}case"absolute-height":{const o=r.geometryZWithOffset(s,i),a=Dy(e,t,"ground")??0;return n.verticalDistanceToGround=o-a,n.sampledElevation=a,void(n.z=o)}default:return void(n.z=0)}}function ILt(t,e,r,i){return fx(t,e,r,i,tA),tA.z}function LF(t,e,r){return e==null||r==null?t.definedChanged:e==="on-the-ground"&&r==="on-the-ground"?t.staysOnTheGround:e===r||e!=="on-the-ground"&&r!=="on-the-ground"?Xn.UPDATE:t.onTheGroundChanged}function mf(t){return t==="relative-to-ground"||t==="relative-to-scene"}function mx(t){return t!=="absolute-height"}function LLt(t,e,r,i,n){fx(e,r,n,i,tA),Lze(t,tA.verticalDistanceToGround);const s=tA.sampledElevation,o=Rs(VLt,t.transformation);return l6[0]=e.x,l6[1]=e.y,l6[2]=tA.z,lu(e.spatialReference,l6,o,i.spatialReference)?t.transformation=o:console.warn("Could not locate symbol object properly, it might be misplaced"),s}function DLt(t,e,r,i,n,s){let o=0;const a=s.spatialReference;e*=3,i*=3;for(let l=0;l<n;++l){const c=t[e],u=t[e+1],h=t[e+2],f=s.getElevation(c,u,h,a,"ground")??0;o+=f,r[i]=c,r[i+1]=u,r[i+2]=f,e+=3,i+=3}return o/n}function NLt(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;e*=3,i*=3;for(let f=0;f<n;++f){const m=t[e],g=t[e+1],y=t[e+2],_=s.getElevation(m,g,y,h,"ground")??0;l+=_,r[i]=m,r[i+1]=g,r[i+2]=u==null?y+_+c:_+c,e+=3,i+=3}return l/n}function FLt(t,e,r,i,n,s,o,a){let l=0;const c=a.calculateOffsetRenderUnits(o),u=a.featureExpressionInfoContext,h=s.spatialReference;e*=3,i*=3;for(let f=0;f<n;++f){const m=t[e],g=t[e+1],y=t[e+2],_=s.getElevation(m,g,y,h,"scene")??0;l+=_,r[i]=m,r[i+1]=g,r[i+2]=u==null?y+_+c:_+c,e+=3,i+=3}return l/n}function kLt(t){const e=t.meterUnitOffset,r=t.featureExpressionInfoContext;return e!==0||r!=null}function ULt(t,e,r,i,n,s,o,a){const l=a.calculateOffsetRenderUnits(o),c=a.featureExpressionInfoContext;e*=3,i*=3;for(let u=0;u<n;++u){const h=t[e],f=t[e+1],m=t[e+2];r[i]=h,r[i+1]=f,r[i+2]=c==null?m+l:l,e+=3,i+=3}return 0}let DF=class{constructor(){this.verticalDistanceToGround=0,this.sampledElevation=0,this.z=0}};var Xn;(function(t){t[t.NONE=0]="NONE",t[t.UPDATE=1]="UPDATE",t[t.RECREATE=2]="RECREATE"})(Xn||(Xn={}));const zLt={"absolute-height":{applyElevationAlignmentBuffer:ULt,requiresAlignment:kLt},"on-the-ground":{applyElevationAlignmentBuffer:DLt,requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:NLt,requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:FLt,requiresAlignment:()=>!0}},VLt=Me(),tA=new DF,l6=A();function qhe(t){return t.mapPositions!=null}function Nze(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!qhe(l))continue;const{update:c,averageGeometrySampledElevation:u}=kze(l,e,r,i,n);a+=u,c&&s.geometryVertexAttrsUpdated(l)}return a/o.length}function O2(t,e,r,i,n,s){const o=t.stageObject,a=e.centerPointInElevationSR;let l=0;o.usesVerticalDistanceToGround?(i(a,Qc),Lze(o,Qc.verticalDistanceToGround),l=Qc.sampledElevation):(i(a,Qc),e.mode!=="absolute-height"&&(l=Qc.sampledElevation));const c=Rs(BLt,s??o.transformation),u=se(Fze,c[12],c[13],c[14]);Di.TESTS_DISABLE_OPTIMIZATIONS?(Kc[0]=a.x,Kc[1]=a.y,Kc[2]=Qc.z,lu(a.spatialReference,Kc,c,n.spatialReference)&&(s?Rs(s,c):o.transformation=c)):n.setAltitudeOfTransformation(Qc.z,c);const h=Whe/n.unitInMeters;return(Math.abs(c[12]-u[0])>=h||Math.abs(c[13]-u[1])>=h||Math.abs(c[14]-u[2])>=h)&&(s?Rs(s,c):o.transformation=c),l}const BLt=Me();function jLt(t,e,r,i,n){const s=t.graphics3DSymbolLayer.lodRenderer;if(s==null)return 0;const o=e.centerPointInElevationSR;i(o,Qc);const a=e.mode!=="absolute-height"?Qc.sampledElevation:0,l=s.instanceData,c=t.instanceIndex,u=HLt;l.getGlobalTransform(c,u);const h=se(Fze,u[12],u[13],u[14]);Di.TESTS_DISABLE_OPTIMIZATIONS?(Kc[0]=o.x,Kc[1]=o.y,Kc[2]=Qc.z,lu(o.spatialReference,Kc,u,n.spatialReference)&&l.setGlobalTransform(c,u)):n.setAltitudeOfTransformation(Qc.z,u);const f=Whe/n.unitInMeters;return(Di.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(u[12]-h[0])>=f||Math.abs(u[13]-h[1])>=f||Math.abs(u[14]-h[2])>=f)&&l.setGlobalTransform(c,u),a}function GLt(t,e,r,i,n){const s=t.stageObject,o=s.geometries;if(o.length===0)return 0;let a=0,l=null,c=0,u=!1;for(const h of o){if(!qhe(h))continue;const f=h.vertexAttributes.get(O.POSITION);if(f!==l){const{update:m,averageGeometrySampledElevation:g}=kze(h,e,r,i,n);c=g,l=f,u=m}u&&s.geometryVertexAttrsUpdated(h),a+=c}return a/o.length}const Whe=.01,Kc=A(),Vh=A(),PC=A(),HLt=Me(),Fze=A(),Qc=new DF;function kze(t,e,r,i,n){let s=!1;const o=t.shaderTransformation,a=e.requiresSampledElevationInfo;Vh[0]=o[12],Vh[1]=o[13],Vh[2]=o[14],t.invalidateBoundingInfo();const l=t.getMutableAttribute(O.POSITION),c=l.data,u=l.size,h=c.length/u,f=new _de(t.mapPositions,r);let m=0,g=0;for(let y=0;y<h;y++){if(PC[0]=c[m],PC[1]=c[m+1],PC[2]=c[m+2],i(f,Qc),a&&(g+=Qc.sampledElevation),Di.TESTS_DISABLE_OPTIMIZATIONS)c[m]=f.array[f.offset],c[m+1]=f.array[f.offset+1],c[m+2]=Qc.z,Ni(c,r,m,c,n.spatialReference,m,1),c[m]-=Vh[0],c[m+1]-=Vh[1],c[m+2]-=Vh[2],s=!0;else{Kc[0]=c[m]+Vh[0],Kc[1]=c[m+1]+Vh[1],Kc[2]=c[m+2]+Vh[2],n.setAltitude(Kc,Qc.z),c[m]=Kc[0]-Vh[0],c[m+1]=Kc[1]-Vh[1],c[m+2]=Kc[2]-Vh[2];const _=Whe/n.unitInMeters;(Math.abs(PC[0]-c[m])>=_||Math.abs(PC[1]-c[m+1])>=_||Math.abs(PC[2]-c[m+2])>=_)&&(s=!0)}m+=u,f.offset+=3}return g/=h,{update:s,averageGeometrySampledElevation:g}}const qLt=re.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");function WLt(t){return{cachedResult:t.cachedResult,arcade:t.arcade?{func:t.arcade.func,context:t.arcade.modules.arcadeUtils.createExecContext(null,{sr:t.arcade.context.spatialReference}),modules:t.arcade.modules}:null}}function p_r(t){const e=t&&t.expression;if(typeof e=="string"){const r=Vze(e);if(r!=null)return{cachedResult:r}}return null}async function f_r(t,e,r,i){const n=t&&t.expression;if(typeof n!="string")return null;const s=Vze(n);if(s!=null)return{cachedResult:s};const o=await ex();vr(r);const a=o.arcadeUtils,l=a.createSyntaxTree(n);return a.dependsOnView(l)?(i!=null&&i.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:a.createFunction(l),context:a.createExecContext(null,{sr:e}),modules:o}}}function Uze(t,e,r){return t.arcadeUtils.createFeature(e.attributes,e.geometry,r)}function HH(t,e){if(t!=null&&!zze(t)){if(!e||!t.arcade)return void qLt.errorOncePerTick("Arcade support required but not provided");const r=e;r._geometry&&(r._geometry=Oze(r._geometry)),t.arcade.modules.arcadeUtils.updateExecContext(t.arcade.context,e)}}function XLt(t){if(t!=null){if(zze(t))return t.cachedResult;const e=t.arcade;let r=e==null?void 0:e.modules.arcadeUtils.executeFunction(e.func,e.context);return typeof r!="number"&&(t.cachedResult=0,r=0),r}return 0}function m_r(t,e=!1){let r=t&&t.featureExpressionInfo;const i=r&&r.expression;return e||i==="0"||(r=null),r??null}const YLt={cachedResult:0};function zze(t){return t.cachedResult!=null}function Vze(t){return t==="0"?0:null}let yg=class Bze{constructor(){this._meterUnitOffset=0,this._renderUnitOffset=0,this._unit="meters",this._metersPerElevationInfoUnit=1,this._featureExpressionInfoContext=null,this.centerPointInElevationSR=null,this.mode=null}get featureExpressionInfoContext(){return this._featureExpressionInfoContext}get meterUnitOffset(){return this._meterUnitOffset}get unit(){return this._unit}set unit(e){this._unit=e,this._metersPerElevationInfoUnit=vNe(e)}get requiresSampledElevationInfo(){return this.mode!=="absolute-height"}reset(){this.mode=null,this._meterUnitOffset=0,this._renderUnitOffset=0,this._featureExpressionInfoContext=null,this.unit="meters"}set offsetMeters(e){this._meterUnitOffset=e,this._renderUnitOffset=0}set offsetElevationInfoUnits(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit,this._renderUnitOffset=0}addOffsetRenderUnits(e){this._renderUnitOffset+=e}geometryZWithOffset(e,r){const i=this.calculateOffsetRenderUnits(r);return this.featureExpressionInfoContext!=null?i:e+i}calculateOffsetRenderUnits(e){let r=this._meterUnitOffset;const i=this.featureExpressionInfoContext;return i!=null&&(r+=XLt(i)*this._metersPerElevationInfoUnit),r/e.unitInMeters+this._renderUnitOffset}setFromElevationInfo(e){this.mode=e.mode,this.unit=ivt(e.unit)?e.unit:"meters",this.offsetElevationInfoUnits=e.offset??0}updateFeatureExpressionInfoContext(e,r,i){if(e==null)return void(this._featureExpressionInfoContext=null);const n=e&&e.arcade;n&&r!=null&&i!=null?(this._featureExpressionInfoContext=WLt(e),HH(this._featureExpressionInfoContext,Uze(n.modules,r,i))):this._featureExpressionInfoContext=e}static fromElevationInfo(e){const r=new Bze;return e!=null&&r.setFromElevationInfo(e),r}},ZLt=class{constructor(e,r,i){this.graphic=e,this.renderingInfo=r,this.layer=i}};var mr;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OPAQUE=2]="OPAQUE"})(mr||(mr={}));let JLt=class{constructor(e,r,i){this.baseMaterial=e,this.edgeMaterials=r,this.properties=i}},O0=class{get isElevationSource(){return!!this.stageObject.lastValidElevationBB}constructor(e,r,i,n,s,o,a,l=null){this.graphics3DSymbolLayer=e,this.stageObject=r,this._uniqueGeometries=i,this._uniqueMaterials=n,this._sharedResource=s,this.elevationAligner=o,this.elevationContext=a,this._edgeState=l,this.type="object3d",this._stageLayer=null,this._visible=!1,this._addedToStage=!1,this.alignedSampledElevation=0,this.needsElevationUpdates=!1,this.useObjectOriginAsAttachmentOrigin=!1}initialize(e){this._stageLayer=e;const r=e.stage;r.addMany(this._uniqueMaterials),r.addMany(this._uniqueGeometries),r.add(this.stageObject)}destroy(){if(!this._stageLayer)return;const e=this._stageLayer.stage;e.removeMany(this._uniqueMaterials),e.removeMany(this._uniqueGeometries),e.remove(this.stageObject),this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);const r=e.renderer.ensureEdgeView();r.hasObject(this.stageObject)&&r.removeObject(this.stageObject),this.stageObject.dispose(),this._sharedResource!=null&&this._sharedResource.release(),this._visible=!1,this._stageLayer=null}layerOpacityChanged(e,r){if(this._edgeState==null)return;const i=txe(this._edgeState.baseMaterial);let n=!1;for(const s of this._edgeState.edgeMaterials)s.objectTransparency!==i&&(s.objectTransparency=i,n=!0);n&&this.resetEdgeObject(r),this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[e])}slicePlaneEnabledChanged(e,r){this._edgeState!=null&&(this._stageLayer.stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:e},!r),this._edgeState.properties.hasSlicePlane=e)}setVisibility(e){if(this._stageLayer!=null&&this._visible!==e&&(this._visible=e,this.stageObject.visible=e,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),this._edgeState)){const r=this._stageLayer.stage.renderer.ensureEdgeView();r.hasObject(this.stageObject)?r.updateObjectVisibility(this.stageObject,e):e&&this._addOrUpdateEdgeObject(r,!1)}}get visible(){return this._visible}alignWithElevation(e,r,i,n){if(this.elevationAligner==null)return;i!=null&&HH(this.elevationContext.featureExpressionInfoContext,i);const s=(o,a)=>fx(o,e,this.elevationContext,r,a);this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,e.spatialReference,s,r),this.resetEdgeObject(n)}alignWithAbsoluteElevation(e,r,i){const n=(s,o)=>{o.sampledElevation=e,o.verticalDistanceToGround=0,o.z=e};this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,n,r),this.resetEdgeObject(i)}getCenterObjectSpace(e=A()){return oe(e,this.stageObject.boundingVolumeObjectSpace.bounds)}getBoundingBoxObjectSpace(e=To()){const r=this.stageObject.boundingVolumeObjectSpace;return B4e(e,r.min),j4e(e,r.max),e}computeAttachmentOrigin(e){if(this.useObjectOriginAsAttachmentOrigin){const r=this.stageObject.shaderTransformation;e.render.origin[0]+=r[12],e.render.origin[1]+=r[13],e.render.origin[2]+=r[14],e.render.num++}else for(const r of this.stageObject.geometries)r.computeAttachmentOrigin(F0)&&(lt(F0,F0,this.stageObject.shaderTransformation),ge(e.render.origin,e.render.origin,F0),e.render.num++)}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=KLt,l=jue(o)?1:a.length;for(let u=0;u<l;u++){const h=a[u];L1[0]=o[h[0]],L1[1]=o[h[1]],L1[2]=o[h[2]],lt(L1,L1,this.stageObject.transformation),Qx[3*u]=L1[0],Qx[3*u+1]=L1[1],Qx[3*u+2]=L1[2]}if(!e(Qx,0,l))return null;en(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],Qx[u+h]),o[h+3]=Math.max(o[h+3],Qx[u+h]);c&&i.push({location:Qx.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&r.service&&this.elevationContext.mode!=="absolute-height"){Fm(o,F0);const u=this.elevationContext.mode==="relative-to-scene"?"scene":"ground";let h=0;if(r.useViewElevation)h=r.service.getElevation(F0[0],F0[1],u)??0;else try{const f=Hhe(o,r.service.spatialReference,r);h=await r.service.queryElevation(F0[0],F0[1],n,f,u)??0}catch{}V4e(o,0,0,-this.alignedSampledElevation+h)}return o}addObjectState(e,r){e===k_.Highlight&&r.addObject(this.stageObject,this.stageObject.highlight()),e===k_.MaskOccludee&&r.addObject(this.stageObject,this.stageObject.maskOccludee())}removeObjectState(e){e.removeObject(this.stageObject)}resetEdgeObject(e){if(this._edgeState==null)return;const r=this._stageLayer.stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(r,e):r.removeObject(this.stageObject)}_addOrUpdateEdgeObject(e,r){const i=this._edgeState;if(i==null)return;const n=txe(i.baseMaterial);for(const s of i.edgeMaterials)s.objectTransparency=n;e.addOrUpdateObject3D(this.stageObject,i.edgeMaterials,i.properties,!r).then(()=>{var s;return(s=this._stageLayer)==null?void 0:s.sync()})}};function txe(t){return t.isVisible()?t.parameters.transparent?mr.TRANSPARENT:mr.OPAQUE:mr.INVISIBLE}const Qx=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],L1=A(),F0=A(),KLt=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];let jze=class{constructor(e,r=null){this.labelText=r,this.elevationOffset=e??0}};var Cs;(function(t){t[t.RecreateSymbol=0]="RecreateSymbol",t[t.RecreateGraphics=1]="RecreateGraphics",t[t.FastUpdate=2]="FastUpdate"})(Cs||(Cs={}));let Xhe=class{constructor(e){this.schedule=e,this._abortController=null,this._loadStatus=rh.LOADING,this._loadError=null,this._loader=null,this.logger=null}destroy(){this.abortLoad()}get loadStatus(){return this._loadStatus}load(e,r){return this._loadStatus===rh.LOADED?(e&&e(),this._loader??Promise.resolve()):this._loadStatus===rh.FAILED?(r&&r(this._loadError),this._loader??Promise.resolve()):(this._loader==null&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null,this._loadStatus=rh.LOADED},i=>{throw this._loadError=i,this._abortController=null,this._loadStatus=rh.FAILED,!Yn(i)&&this.logger&&i.message&&this.logger.warn(i.message),i})),this._loader.then(e,r).catch(()=>{}),this._loader)}abortLoad(){this._abortController!=null?this._abortController=xc(this._abortController):this._loadStatus===rh.LOADING&&(this._loadStatus=rh.FAILED),this._loader=null}};var rh;(function(t){t[t.LOADING=0]="LOADING",t[t.LOADED=1]="LOADED",t[t.FAILED=2]="FAILED"})(rh||(rh={}));const Gze=3,tne=3,Hze=10;let qze=class{constructor(e,r=null){this.geometry=e,this.textures=r}};function c6(t){const e=[];return t.levels.forEach(r=>r.components.forEach(i=>e.push(i.geometry.material))),o7(e)}function rxe(t){const e=new Array;return t.levels.forEach(r=>{r.components.forEach(i=>{i.textures!=null&&e.push(...i.textures)})}),o7(e)}function Wze(t){const e=t.components.map(r=>r.geometry);return o7(e)}function ixe(t){const e=[];return t.levels.forEach(r=>{r.components.forEach(i=>{e.push(i.geometry)})}),o7(e)}function QLt(t){switch(t){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1}function Xze(t,e){const r=(i,n,s=!1)=>({levels:i.map(o=>{const a=n(o.tesselation);return s&&eAt(a),{components:[new qze(a)],faceCount:a.indexCount/3,minScreenSpaceRadius:o.minScreenSpaceRadius}})});switch(t){case"sphere":return r([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],i=>ZOt(e,.5,i,!0));case"cube":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>VOt(e,1));case"cone":return r(FY,i=>fbe(e,1,.5,i,!1),!0);case"inverted-cone":return r(FY,i=>fbe(e,1,.5,i,!0),!0);case"cylinder":return r(FY,i=>KOt(e,1,.5,i,[0,0,1],[0,0,.5]));case"tetrahedron":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>YOt(e,1),!0);case"diamond":return r([{tesselation:0,minScreenSpaceRadius:0}],()=>HOt(e,1),!0);default:return}}const FY=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];function eDt(t){return t.type==="fill"}function tDt(t){return t.type==="extrude"}function rDt(t){return t&&t.enabled&&(tDt(t)||eDt(t))&&t.edges!=null}function iDt(t){return t&&t.enabled&&t.edges||null}function Yze(t,e){return Zze(iDt(t),e)}function Zze(t,e){if(t==null)return null;const r=t.color!=null?tde(ht.toUnitRGBA(t.color)):nr(0,0,0,0),i=Es(t.size),n=Es(t.extensionLength);switch(t.type){case"solid":return Jze({color:r,size:i,extensionLength:n,...e});case"sketch":return nDt({color:r,size:i,extensionLength:n,...e});default:return}}function Jze(t){return{...sDt,...t,type:"solid"}}function nDt(t){return{...oDt,...t,type:"sketch"}}const sDt={color:nr(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:mr.OPAQUE,hasSlicePlane:!1},oDt={color:nr(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:mr.OPAQUE,hasSlicePlane:!1},Yhe={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}};function x_r(t){return t.type==="web-style"?Yhe:Zhe(t.symbolLayers.toArray().map(e=>Kze(t,e)))}function Zhe(t){let e=0,r=0,i=0,n=!1,s=0;const o={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const a of t)a!=null&&(e+=a.primitivesPerFeature,r+=a.primitivesPerCoordinate,i+=a.drawCallsPerFeature,o.bytesPerFeature+=a.memory.bytesPerFeature,o.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.bytesPerCoordinate+=a.memory.bytesPerCoordinate,o.resourceBytes+=a.memory.resourceBytes,o.draped.bytesPerFeature+=a.memory.bytesPerFeature,o.draped.bytesPerFeatureLabel+=a.memory.bytesPerFeatureLabel,o.draped.bytesPerCoordinate+=a.memory.bytesPerCoordinate,n=n||a.estimated,++s);return{primitivesPerFeature:e,primitivesPerCoordinate:r,drawCallsPerFeature:i,estimated:n,memory:o,numComplexities:s}}function S_r(t){const e=Zhe(t);return e.numComplexities>0&&(e.primitivesPerFeature/=e.numComplexities,e.primitivesPerCoordinate/=e.numComplexities,e.drawCallsPerFeature/=e.numComplexities,e.memory.bytesPerFeature/=e.numComplexities,e.memory.bytesPerFeatureLabel/=e.numComplexities,e.memory.bytesPerCoordinate/=e.numComplexities,e.memory.resourceBytes/=e.numComplexities,e.memory.draped.bytesPerFeature/=e.numComplexities,e.memory.draped.bytesPerFeatureLabel/=e.numComplexities,e.memory.draped.bytesPerCoordinate/=e.numComplexities),e}const nxe={};function Kze(t,e){var n;const r=Qze(t,e),i=rDt(e)?2:0;switch(e.type){case"extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:i,estimated:!1,memory:r};case"fill":return t.type==="mesh-3d"?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:i,estimated:!1,memory:r}:e.outline!=null&&e.outline.size>0?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:r}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:r};case"line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:r};case"object":return(n=e.resource)!=null&&n.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:r}:{...aDt(e.resource&&e.resource.primitive||Z4e),memory:r};case"path":{let s=0,o=0;switch(e.profile){case"circle":s=Hze;break;case"quad":s=4;break;default:return void(e.profile,void 0)}switch(e.join??"simple"){case"round":o=Gze;break;case"miter":case"bevel":o=1;break;default:return}const a=2*s,l=s*o*2;let c=-2*l-a;switch(e.cap){case"none":break;case"butt":case"square":c+=2*(s-1);break;case"round":c+=2*(s*(tne-1)*2+s);break;default:return}return{primitivesPerFeature:c,primitivesPerCoordinate:l+a,drawCallsPerFeature:0,estimated:!1,memory:r}}case"text":case"icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:r};default:return}}function Qze(t,e){const r=t.type==="point-3d";switch(e.type){case"extrude":return e.edges&&e.edges.size>0?Ic.EXTRUDE_EDGES:Ic.EXTRUDE;case"fill":return e.outline!=null&&e.outline.size>0?Ic.FILL_OUTLINE:Ic.FILL;case"water":return Ic.FILL;case"line":return e.join==="round"?Ic.LINE_ROUND:Ic.LINE_MITER;case"path":switch(e.join){case"round":switch(e.profile){case"circle":return Ic.PATH_ROUND_CIRCLE;case"quad":return Ic.PATH_ROUND_QUAD;default:return void(e.profile,void 0)}case"miter":case"bevel":switch(e.profile){case"circle":return Ic.PATH_MITER_CIRCLE;case"quad":return Ic.PATH_MITER_QUAD;default:return void(e.profile,void 0)}default:return}case"object":return r?Ic.OBJECT_POINT:Ic.OBJECT_POLYGON;case"icon":case"text":return r?Ic.ICON_POINT:Ic.ICON_POLYGON;default:return}}function aDt(t){let e=nxe[t];if(e)return e;const r=Xze(t,null);return e={primitivesPerFeature:Wze(r.levels[0]).reduce((i,n)=>i+n.indices.get(O.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1},nxe[t]=e,e}const Ic={ICON_POINT:{bytesPerFeature:2321.5204640676384,bytesPerFeatureLabel:990.45722,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2169.5155951150787,bytesPerFeatureLabel:999.2598599999999,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:3822.4566594216512,bytesPerFeatureLabel:1004.4288266666666,bytesPerCoordinate:3.8232947206245864,resourceBytes:0,draped:{bytesPerFeature:3656.161389156324,bytesPerFeatureLabel:994.9227800000001,bytesPerCoordinate:3.836714603517761}},OBJECT_POINT:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1286.2669145138564,bytesPerFeatureLabel:1011.4901900000001,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487,resourceBytes:0,draped:{bytesPerFeature:2796.828455517831,bytesPerFeatureLabel:1012.9951500000002,bytesPerCoordinate:4.051546356517487}},LINE_MITER:{bytesPerFeature:4906.045480276492,bytesPerFeatureLabel:1002.8815266666666,bytesPerCoordinate:24.04850207798191,resourceBytes:0,draped:{bytesPerFeature:4315.785832179941,bytesPerFeatureLabel:998.7028333333334,bytesPerCoordinate:19.457038722015074}},LINE_ROUND:{bytesPerFeature:4893.576398024015,bytesPerFeatureLabel:1015.8812866666666,bytesPerCoordinate:24.039686621147293,resourceBytes:0,draped:{bytesPerFeature:4321.076505943878,bytesPerFeatureLabel:1008.7058400000001,bytesPerCoordinate:19.522527447599565}},PATH_MITER_CIRCLE:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645,resourceBytes:0,draped:{bytesPerFeature:27475.37385725739,bytesPerFeatureLabel:945.1915,bytesPerCoordinate:1936.190695268645}},PATH_ROUND_CIRCLE:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402,resourceBytes:0,draped:{bytesPerFeature:13432.532036888486,bytesPerFeatureLabel:949.8167000000001,bytesPerCoordinate:4250.913048917402}},PATH_MITER_QUAD:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243,resourceBytes:0,draped:{bytesPerFeature:17083.041162790672,bytesPerFeatureLabel:1006.4104,bytesPerCoordinate:1543.9135284683243}},PATH_ROUND_QUAD:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418,resourceBytes:0,draped:{bytesPerFeature:24054.406240577355,bytesPerFeatureLabel:976.0122999999999,bytesPerCoordinate:2683.863857257418}},FILL:{bytesPerFeature:5336.950602511737,bytesPerFeatureLabel:993.6785799999999,bytesPerCoordinate:9.558162275921951,resourceBytes:0,draped:{bytesPerFeature:4643.732435264264,bytesPerFeatureLabel:1003.6394400000001,bytesPerCoordinate:8.123952159573538}},FILL_OUTLINE:{bytesPerFeature:8210.8457089066,bytesPerFeatureLabel:1006.2871066666667,bytesPerCoordinate:14.496686428135353,resourceBytes:0,draped:{bytesPerFeature:6982.149803527473,bytesPerFeatureLabel:1005.1158800000001,bytesPerCoordinate:11.034666572000932}},EXTRUDE:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909,resourceBytes:0,draped:{bytesPerFeature:16336.386002724352,bytesPerFeatureLabel:1013.2957066666665,bytesPerCoordinate:40.50904192903909}},EXTRUDE_EDGES:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755,resourceBytes:0,draped:{bytesPerFeature:18251.260762353977,bytesPerFeatureLabel:1044.1864133333333,bytesPerCoordinate:40.594518397678755}}},MC=re.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");let A0=class extends Xhe{constructor(e,r,i,n){super(i.schedule),this.symbol=e,this.symbolLayer=r,this._context=i,this._elevationInfoOverride=null,this.ignoreDrivers=!1,this._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1},this.complexity=null,this.logger=MC,this._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0},this.skipHighSymbolLodsChanged=!0,this._renderPriority=n.renderPriority,this._renderPriorityStep=n.renderPriorityStep,this._elevationContext=new yg,this.complexity=this.computeComplexity(),this.ignoreDrivers=n.ignoreDrivers,this.ignoreDrivers||(this._drivenProperties=sxe(this._context.renderer)),this._updateElevationContext()}getCachedSize(){return null}get extentPadding(){return 0}_drivenPropertiesChanged(e){if(this.ignoreDrivers)return!1;const r=this._drivenProperties,i=sxe(e);return i.color!==r.color||i.opacity!==r.opacity||i.opacityAlwaysOpaque!==r.opacityAlwaysOpaque||i.size!==r.size}get needsDrivenTransparentPass(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}_logGeometryCreationWarnings(e,r,i,n){const s=e.projectionSuccess,o="polygons"in e?e.polygons:null,a=`${n} geometry failed to be created`;let l=null;s?!this._logGeometryValidationWarnings(r,i,n)&&o&&o.length===0&&i==="rings"&&r.length>0&&r[0].length>2&&(l=`${a} (filled rings should use clockwise winding - try reversing the order of vertices)`):l=`${a} (failed to project geometry to view spatial reference)`,l&&MC.warnOncePerTick(l)}_logGeometryValidationWarnings(e,r,i){const n=`${i} geometry failed to be created`;return!e.length||e.length===1&&!e[0].length?(MC.warnOncePerTick(`${n} (no ${r} were defined)`),!0):(!Array.isArray(e)||!Array.isArray(e[0]))&&(MC.warnOncePerTick(`${n} (${r} should be defined as a 2D array)`),!0)}_validateGeometry(e,r=null,i=null){if(r!=null&&!r.includes(e.type))return this.logger.warn("unsupported geometry type for "+i+` symbol: ${e.type}`),!1;if(e.type==="point"){const n=e;if(!isFinite(n.x)||!isFinite(n.y))return MC.warn("point coordinate is not a valid number, graphic skipped"),!1}return!0}_defaultElevationInfoNoZ(){return lDt}_defaultElevationInfoZ(){return cDt}_updateElevationContext(){this._elevationInfoOverride!=null?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()}getDefaultElevationInfo(e){return e.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()}getGeometryElevationMode(e,r=this.getDefaultElevationInfo(e)){return this._elevationContext.mode||r.mode}setElevationInfoOverride(e){this._elevationInfoOverride=e,this._updateElevationContext()}setGraphicElevationContext(e,r){const i=e.geometry,n=this.getDefaultElevationInfo(i);r.unit=this._elevationContext.unit!=null?this._elevationContext.unit:n.unit,r.mode=this.getGeometryElevationMode(i,n),r.offsetMeters=this._elevationContext.meterUnitOffset??n.offset??0;const s=!this._elevationOptions.supportsOnTheGround&&r.mode==="on-the-ground";s&&(r.mode="relative-to-ground",r.offsetMeters=0);const o=s?YLt:this._elevationContext.featureExpressionInfoContext;return r.updateFeatureExpressionInfoContext(o,e,this._context.layer),r}prepareSymbolLayerPatch(e){}updateGeometry(e,r){return!1}updateTransform(e,r,i,n){return!1}onRemoveGraphic(e){}_getLayerOpacity(){return this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner?this._context.graphicsCoreOwner.fullOpacity??0:this._context.layer.opacity??1}_getCombinedOpacity(e,r=oxe){let i=1;return this.draped||(i*=this._getLayerOpacity()),this._drivenProperties.opacity||(e!=null?i*=e.a:r.hasIntrinsicColor||(i=0)),i}_getCombinedOpacityAndColor(e,r=oxe){const i=this._getCombinedOpacity(e,r);if(this._drivenProperties.color)return SD(null,i);const n=e!=null?ht.toUnitRGB(e):qv;return SD(n,i)}_getVertexOpacityAndColor(e,r=null){const i=this._drivenProperties.color?e.color:null,n=this._drivenProperties.opacity?e.opacity:null,s=SD(i,n);return r&&(s[0]*=r,s[1]*=r,s[2]*=r,s[3]*=r),s}isFastUpdatesEnabled(){return this._fastUpdates!=null}computeComplexity(){return Kze(this.symbol,this.symbolLayer)}globalPropertyChanged(e,r,i){switch(e){case"opacity":return this.layerOpacityChanged(r,i),!0;case"elevationInfo":{const n=this._elevationContext.mode;return this._updateElevationContext(),this.layerElevationInfoChanged(r,i,n)!==Xn.RECREATE}case"slicePlaneEnabled":return this.slicePlaneEnabledChanged(r,i);case"physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case"pixelRatio":return this.pixelRatioChanged;case"skipHighSymbolLods":return this.skipHighSymbolLodsChanged;default:return!1}}get pixelRatioChanged(){return!0}updateGraphics3DGraphicElevationInfo(e,r,i){let n=Xn.UPDATE;return e.forEach(s=>{const o=r(s);if(o!=null){const a=s.graphic;this.setGraphicElevationContext(a,o.elevationContext),o.needsElevationUpdates=i(o.elevationContext.mode)}else n=Xn.RECREATE}),n}applyRendererDiff(e,r){return Cs.RecreateSymbol}getFastUpdateAttrValues(e){if(!this._fastUpdates)return null;const r=this._fastUpdates.visualVariables,i=r.size?Km(r.size.field,e):0,n=r.color?Km(r.color.field,e):0,s=r.opacity?Km(r.opacity.field,e):0;return nr(i,n,s,0)}get draped(){return this._draped}ensureDrapedStatus(e){return this._draped==null?(this._draped=e,!0):(e!==this.draped&&MC.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary."),!1)}test(){const e=()=>{var r,i,n,s,o,a,l,c;return{size:((i=(r=this._fastUpdates)==null?void 0:r.visualVariables.size)==null?void 0:i.field)??null,color:((s=(n=this._fastUpdates)==null?void 0:n.visualVariables.color)==null?void 0:s.field)??null,opacity:((a=(o=this._fastUpdates)==null?void 0:o.visualVariables.opacity)==null?void 0:a.field)??null,rotation:((c=(l=this._fastUpdates)==null?void 0:l.visualVariables.rotation)==null?void 0:c.field)??null}};return{drivenProperties:this._drivenProperties,getVisVarFields:e}}};function sxe(t){const e={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};return t&&"visualVariables"in t&&t.visualVariables&&t.visualVariables.forEach(r=>{switch(r.type){case"color":if(e.color=!0,r.stops)for(let i=0;i<r.stops.length;i++){const n=r.stops[i].color;n&&(e.opacity=!0,n.a<1&&(e.opacityAlwaysOpaque=!1))}break;case"opacity":e.opacity=!0,e.opacityAlwaysOpaque=!1;break;case"size":e.size=!0}}),e}const lDt={mode:"on-the-ground",offset:0,unit:"meters"},cDt={mode:"absolute-height",offset:0,unit:"meters"},oxe={hasIntrinsicColor:!1};let a1=class extends EF{get geometries(){return this._geometries}get transformation(){return this._transformation??bo}set transformation(e){this._transformation=Rs(this._transformation??Me(),e),this._invalidateBoundingVolume(),this._emit("objectTransformation",this)}get shaderTransformation(){return this._shaderTransformation??this.transformation}set shaderTransformation(e){this._shaderTransformation=Rs(this._shaderTransformation??Me(),e),this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}clearShaderTransformation(){this._shaderTransformation=void 0,this._invalidateBoundingVolume(),this._emit("objectShaderTransformation",this)}constructor(e={}){super(),this.type=Wn.Object,this._hasVolatileTransformation=!1,this._parentLayer=null,this._visible=!0,this.castShadow=e.castShadow??!0,this.usesVerticalDistanceToGround=e.usesVerticalDistanceToGround??!1,this.graphicUid=e.graphicUid,this.layerUid=e.layerUid,e.isElevationSource&&(this.lastValidElevationBB=new e9e),this._geometries=e.geometries?Array.from(e.geometries):new Array}dispose(){this._geometries.length=0}get parentLayer(){return this._parentLayer}set parentLayer(e){It(this._parentLayer==null||e==null,"Object3D can only be added to a single Layer"),this._parentLayer=e}addGeometry(e){e.visible=this._visible,this._geometries.push(e),this._hasVolatileTransformation=this._hasVolatileTransformation||e.hasVolatileTransformation,this._emit("objectGeometryAdded",{object:this,geometry:e}),this._invalidateBoundingVolume()}removeGeometry(e){const r=this._geometries.splice(e,1)[0];r&&(this._emit("objectGeometryRemoved",{object:this,geometry:r}),this._invalidateBoundingVolume())}removeAllGeometries(){for(;this._geometries.length>0;)this.removeGeometry(0)}geometryVertexAttrsUpdated(e){this._emit("objectGeometryUpdated",{object:this,geometry:e}),this._invalidateBoundingVolume()}get visible(){return this._visible}set visible(e){if(this._visible!==e){this._visible=e;for(const r of this._geometries)r.visible=this._visible;this._emit("visibilityChanged",this)}}maskOccludee(){const e=new IB(k_.MaskOccludee);for(const r of this._geometries)r.occludees=wie(r.occludees,e);return this._emit("occlusionChanged",this),e}removeOcclude(e){for(const r of this._geometries)r.occludees=xie(r.occludees,e);this._emit("occlusionChanged",this)}highlight(){const e=new IB(k_.Highlight);for(const r of this._geometries)r.highlights=wie(r.highlights,e);return this._emit("highlightChanged",this),e}removeHighlight(e){for(const r of this._geometries)r.highlights=xie(r.highlights,e);this._emit("highlightChanged",this)}getCombinedStaticTransformation(e,r){return Ii(r,this.transformation,e.transformation)}getCombinedShaderTransformation(e,r=Me()){return Ii(r,this.shaderTransformation,e.shaderTransformation)}hasVolativeTransformation(){return this._hasVolatileTransformation}get boundingVolumeWorldSpace(){return this._bvWorldSpace&&!this._hasVolatileTransformation||(this._bvWorldSpace=this._bvWorldSpace||new axe,this._validateBoundingVolume(this._bvWorldSpace,TD.WorldSpace)),this._bvWorldSpace}get boundingVolumeObjectSpace(){return this._bvObjectSpace&&!this._hasVolatileTransformation||(this._bvObjectSpace=this._bvObjectSpace||new axe,this._validateBoundingVolume(this._bvObjectSpace,TD.ObjectSpace)),this._bvObjectSpace}_validateBoundingVolume(e,r){const i=r===TD.ObjectSpace;for(const n of this._geometries){const s=n.boundingInfo;s&&uDt(s,e,i?n.shaderTransformation:this.getCombinedShaderTransformation(n))}mi(e.bounds,e.min,e.max,.5);for(const n of this._geometries){const s=n.boundingInfo;if(s==null)continue;const o=i?n.shaderTransformation:this.getCombinedShaderTransformation(n),a=OP(o);lt(lxe,s.center,o);const l=Li(lxe,e.bounds),c=s.radius*a;e.bounds[3]=Math.max(e.bounds[3],l+c)}}_invalidateBoundingVolume(){var r;const e=(r=this._bvWorldSpace)==null?void 0:r.bounds;this._bvObjectSpace=this._bvWorldSpace=void 0,this._parentLayer&&e&&this._parentLayer.notifyObjectBBChanged(this,e)}_emit(e,r){this._parentLayer&&this._parentLayer.events.emit(e,r)}get test(){const e=this;return{hasGeometry:r=>e._geometries.includes(r),getGeometryIndex:r=>e._geometries.indexOf(r)}}},e9e=class{constructor(){this.min=Ue(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this.max=Ue(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}isEmpty(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]}},axe=class extends e9e{constructor(){super(...arguments),this.bounds=us()}};function uDt(t,e,r){const i=t.bbMin,n=t.bbMax;if($7(r)){const s=se(dDt,r[12],r[13],r[14]);ge(Ld,i,s),ge(If,n,s);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Ld[o]),e.max[o]=Math.max(e.max[o],If[o])}else if(lt(Ld,i,r),gi(i,n))for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],Ld[s]),e.max[s]=Math.max(e.max[s],Ld[s]);else{lt(If,n,r);for(let s=0;s<3;++s)e.min[s]=Math.min(e.min[s],Ld[s],If[s]),e.max[s]=Math.max(e.max[s],Ld[s],If[s]);for(let s=0;s<3;++s){oe(Ld,i),oe(If,n),Ld[s]=n[s],If[s]=i[s],lt(Ld,Ld,r),lt(If,If,r);for(let o=0;o<3;++o)e.min[o]=Math.min(e.min[o],Ld[o],If[o]),e.max[o]=Math.max(e.max[o],Ld[o],If[o])}}}const dDt=A(),Ld=A(),If=A(),lxe=A();var TD;(function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ObjectSpace=1]="ObjectSpace"})(TD||(TD={}));function Jhe(t,e,r,i,n,s){const o=t.clippingExtent;if(Na(e,Sw,t.elevationProvider.spatialReference),o!=null&&!Vue(o,Sw))return null;Na(e,Sw,t.renderCoordsHelper.spatialReference),r.shaderTransformer=s,r.localOrigin=t.localOriginFactory.getOrigin(Sw);const a=new a1({geometries:[r],castShadow:!1,layerUid:t.layer.uid,graphicUid:n,usesVerticalDistanceToGround:!0});return{object:a,sampledElevation:LLt(a,e,t.elevationProvider,t.renderCoordsHelper,i)}}function JN(t,e,r){const i=t.elevationContext,n=r.spatialReference;Na(e,Sw,n),i.centerPointInElevationSR=yd(Sw[0],Sw[1],e.hasZ?Sw[2]:0,n??null)}function KN(t){switch(t.type){case"point":return t;case"polygon":case"extent":return Ghe(t);case"polyline":{const e=t.paths[0];if(!e||e.length===0)return null;const r=TLe(e,SLe(e)/2);return yd(r[0],r[1],r[2],t.spatialReference)}case"mesh":return t.origin}return null}const Sw=A();function t9e(){return new Float32Array(2)}function hDt(t){const e=new Float32Array(2);return e[0]=t[0],e[1]=t[1],e}function Mp(t,e){const r=new Float32Array(2);return r[0]=t,r[1]=e,r}function pDt(t,e){return new Float32Array(t,e,2)}function r9e(){return t9e()}function i9e(){return Mp(1,1)}function n9e(){return Mp(1,0)}function s9e(){return Mp(0,1)}const o9e=r9e(),a9e=i9e(),fDt=n9e(),mDt=s9e();Object.freeze(Object.defineProperty({__proto__:null,ONES:a9e,UNIT_X:fDt,UNIT_Y:mDt,ZEROS:o9e,clone:hDt,create:t9e,createView:pDt,fromValues:Mp,ones:i9e,unitX:n9e,unitY:s9e,zeros:r9e},Symbol.toStringTag,{value:"Module"}));function gDt(t){const e=new jr,{vertex:r,fragment:i}=e;return r.include(NH),e.include(_8e,t),e.include(as,t),e.attributes.add(O.UV0,"vec2"),r.uniforms.add(new Cr("viewport",(n,s)=>s.camera.fullViewport),new Ye("lineSize",(n,s)=>n.size>0?Math.max(1,n.size)*s.camera.pixelRatio:0),new Yr("pixelToNDC",(n,s)=>Or(uxe,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new Ye("borderSize",(n,s)=>n.borderColor!=null?s.camera.pixelRatio:0),new Yr("screenOffset",(n,s)=>Or(uxe,n.screenOffset[0]*s.camera.pixelRatio,n.screenOffset[1]*s.camera.pixelRatio))),e.varyings.add("coverageSampling","vec4"),e.varyings.add("lineSizes","vec2"),t.hasMultipassGeometry&&e.varyings.add("depth","float"),t.hasScreenSizePerspective&&DH(r),r.code.add(T`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${t.occlusionTestEnabled?T`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${t.hasScreenSizePerspective?T`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:T`vec2 screenOffsetScaled = screenOffset;`}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly used to get the
      // correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${t.hasMultipassGeometry?"depth = posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${t.depthHudEnabled?t.depthHudAlignStartEnabled?T`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:T`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${t.hasScreenSizePerspective?T`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:T`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (-halfPixelSize - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `),i.uniforms.add(new Cr("uColor",n=>cxe(n.color)),new Cr("borderColor",n=>cxe(n.borderColor))),t.hasMultipassGeometry&&(i.include(A6e,t),i.uniforms.add(new Yr("inverseViewport",(n,s)=>s.inverseViewport))),i.code.add(T`
    void main() {
      ${t.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line blends on top of the
      // border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${t.depthHudEnabled?T`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:T`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      fragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `),e}function cxe(t){return t??Wy}const uxe=Qe(),yDt=Object.freeze(Object.defineProperty({__proto__:null,build:gDt},Symbol.toStringTag,{value:"Module"}));let l9e=class c9e extends si{initializeConfiguration(e,r){r.spherical=e.viewingMode===at.Global}initializeProgram(e){return new Kr(e.rctx,c9e.shader.get().build(this.configuration),Br)}setPipelineState(e){const r=e?Oi.ALWAYS:Oi.LESS;return this.configuration.depthHudEnabled?Qt({depthTest:{func:r},depthWrite:fu}):Qt({blending:Fa(De.ONE,De.SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:r},colorWrite:hr})}initializePipeline(){return this.setPipelineState(this.configuration.hasMultipassGeometry)}};l9e.shader=new Jr(yDt,()=>le(()=>import("./LineCallout.glsl-35b568ec.js"),[]));let ap=class extends tl{constructor(){super(...arguments),this.screenCenterOffsetUnitsEnabled=tu.World,this.spherical=!1,this.occlusionTestEnabled=!0,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.depthHudEnabled=!1,this.depthHudAlignStartEnabled=!1,this.hasSlicePlane=!1,this.hasMultipassGeometry=!1}};d([X({count:tu.COUNT})],ap.prototype,"screenCenterOffsetUnitsEnabled",void 0),d([X()],ap.prototype,"spherical",void 0),d([X()],ap.prototype,"occlusionTestEnabled",void 0),d([X()],ap.prototype,"hasVerticalOffset",void 0),d([X()],ap.prototype,"hasScreenSizePerspective",void 0),d([X()],ap.prototype,"depthHudEnabled",void 0),d([X()],ap.prototype,"depthHudAlignStartEnabled",void 0),d([X()],ap.prototype,"hasSlicePlane",void 0),d([X()],ap.prototype,"hasMultipassGeometry",void 0),d([X({constValue:!0})],ap.prototype,"hasSliceInVertexProgram",void 0),d([X({constValue:!1})],ap.prototype,"draped",void 0);let u6=class rne extends Ax{get uniqueMaterialIdentifier(){return this._uniqueMaterialIdentifier}constructor(e){super(e,new u9e),this._configuration=new ap,this._uniqueMaterialIdentifier=rne.uniqueMaterialIdentifier(this.parameters)}getPassParameters(){return this.parameters}getConfiguration(e,r){const i=(r==null?void 0:r.slot)!==_e.LINE_CALLOUTS;return this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.depthHudEnabled=i,this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart,this._configuration.screenCenterOffsetUnitsEnabled=this.parameters.centerOffsetUnits==="screen"?tu.Screen:tu.World,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasMultipassGeometry=r.multipassGeometry.enabled,this._configuration}intersect(){}requiresSlot(e,r){if(r===q.Color)switch(e){case _e.LINE_CALLOUTS:case _e.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1}createGLMaterial(e){return new vDt(e)}createBufferWriter(){return new bDt}validateParameters(e){const r=rne.uniqueMaterialIdentifier(e);r!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=r)}static uniqueMaterialIdentifier(e){return JSON.stringify({screenOffset:e.screenOffset||[0,0],centerOffsetUnits:e.centerOffsetUnits||"world"})}},vDt=class extends Rx{beginSlot(e){return this.ensureTechnique(l9e,e)}},u9e=class extends Mhe{constructor(){super(...arguments),this.screenOffset=cg,this.color=[0,0,0,1],this.size=1,this.occlusionTest=!1,this.shaderPolygonOffset=1e-5,this.depthHUDAlignStart=!1,this.centerOffsetUnits="world",this.hasSlicePlane=!1}};const _Dt=On().vec3f(O.POSITION).vec3f(O.NORMAL).vec2f(O.UV0).vec4f(O.AUXPOS1),dxe=[Mp(0,0),Mp(1,0),Mp(0,1),Mp(1,0),Mp(1,1),Mp(0,1)];let bDt=class{constructor(){this.vertexBufferLayout=_Dt}elementCount(e){return 6*e.indices.get(O.POSITION).length}write(e,r,i,n,s){$he(i.indices.get(O.POSITION),i.vertexAttributes.get(O.POSITION).data,e,n.position,s,6),Ihe(i.indices.get(O.NORMAL),i.vertexAttributes.get(O.NORMAL).data,r,n.normal,s,6),YP(i.indices.get(O.AUXPOS1),i.vertexAttributes.get(O.AUXPOS1).data,n.auxpos1,s,6);for(let o=0;o<dxe.length;++o)n.uv0.setVec(s+o,dxe[o])}},d9e=class h9e extends A0{constructor(e,r){super(e,null,r,SDt),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){this._material=new u6(this._materialParameters),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}_perInstanceMaterialParameters(e){const r=this._materialParameters;return r.screenOffset=e.screenOffset||cg,r.centerOffsetUnits=e.centerOffsetUnits||"world",r}get _materialParameters(){const e=new u9e,r=this.symbol,i=r.callout;if(e.color=i.color!=null?ht.toUnitRGBA(i.color):[0,0,0,0],e.color[3]*=this._getLayerOpacity(),e.size=Es(i.size||0),r.verticalOffset){const{screenLength:o,minWorldLength:a,maxWorldLength:l}=r.verticalOffset;e.verticalOffset={screenLength:Es(o),minWorldLength:a||0,maxWorldLength:l??1/0}}e.borderColor=i.border!=null&&i.border.color!=null?ht.toUnitRGBA(i.border.color):null;const n=r.symbolLayers.at(0).type==="object",s=r.type==="label-3d";return e.occlusionTest=!n,e.shaderPolygonOffset=n?0:void 0,e.depthHUDAlignStart=s,e.hasSlicePlane=this._context.slicePlaneEnabled,e.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,e}_defaultElevationInfoNoZ(){return xDt}createGraphics3DGraphic(e){const r=e.renderingInfo,i=e.graphic,n=this.setGraphicElevationContext(i,new yg,r.elevationOffset||0),s=r.symbol,o=this._elevationContext.mode==="on-the-ground"&&(s.type==="cim"||!s.symbolLayers.some(l=>l.type==="object"||l.type==="text"));if(s.type!=="label-3d"&&o||s.type==="point-3d"&&s.symbolLayers.every(l=>l.type==="text"&&!rFe(l)))return null;const a=Ghe(i.geometry);return a==null?null:this._createAs3DShape(a,n,r,i.uid)}layerOpacityChanged(){var e;(e=this._material)==null||e.setParameters(this._materialParameters)}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=LF(h9e.elevationModeChangeTypes,i,n);return s!==Xn.UPDATE||e.forEach(o=>{const a=r(o);a!=null&&this.updateGraphicElevationContext(o.graphic,a)}),s}slicePlaneEnabledChanged(){var e;return(e=this._material)==null||e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}setGraphicElevationContext(e,r,i=0){const n=super.setGraphicElevationContext(e,r);return n.addOffsetRenderUnits(i),n}updateGraphicElevationContext(e,r){this.setGraphicElevationContext(e,r.elevationContext,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=mf(r.elevationContext.mode)}computeComplexity(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Yhe.memory}}_createVertexData(e){const{translation:r,centerOffset:i}=e,n=new ft(r?[r[0],r[1],r[2]]:[0,0,0],3,!0),s=new ft(i?[i[0],i[1],i[2],i[3]]:[0,0,0,1],4,!0);return[[O.POSITION,n],[O.NORMAL,new ft([0,0,1],3,!0)],[O.AUXPOS1,s]]}_getOrCreateMaterial(e){const r=this._perInstanceMaterialParameters(e),i=u6.uniqueMaterialIdentifier(r);if(this._material&&i===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(e.materialCollection!=null){let n=e.materialCollection.get(i);return n==null&&(n=new u6(r),e.materialCollection.add(i,n)),{material:n,isUnique:!1}}return{material:new u6(r),isUnique:!0}}_createAs3DShape(e,r,i,n){const s=this._context.layer.uid,o=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:s}),a=this._getOrCreateMaterial(i),l=new Us(a.material,this._createVertexData(i),wDt,null,Wn.Point,o),c=Jhe(this._context,e,l,r,n);if(c==null)return null;const u=new O0(this,c.object,[l],a.isUnique?[a.material]:null,null,O2,r);return u.metadata=new jze(i.elevationOffset),u.alignedSampledElevation=c.sampledElevation,u.needsElevationUpdates=mf(r.mode),JN(u,e,this._context.elevationProvider),u}};d9e.elevationModeChangeTypes={definedChanged:Xn.UPDATE,staysOnTheGround:Xn.UPDATE,onTheGroundChanged:Xn.RECREATE};const kY=[0],wDt=[[O.POSITION,kY],[O.NORMAL,kY],[O.AUXPOS1,kY]],xDt={mode:"relative-to-ground",offset:0},SDt={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};let TDt=class{constructor(e,r,i=A(),n=wr(),s=Qe(),o="world",a=0,l=null){this.renderer=e,this.symbol=r,this.translation=i,this.centerOffset=n,this.screenOffset=s,this.centerOffsetUnits=o,this.elevationOffset=a,this.materialCollection=l}},EDt=class extends ZLt{};const hxe=re.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");function CDt(t,e){if(!Xue(t))return hxe.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${t.type}' does not support callouts`),null;if(!t.callout)return null;const r=RDt[t.callout.type];return r?new r(t,e):(hxe.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${t.callout.type}`),null)}const RDt={line:d9e};let mE=class p9e{constructor(e=null,r={},i,n){this.geometry=e,this.attributes=r,this.centroid=i,this.objectId=n,this.displayId=0,this.geohashX=0,this.geohashY=0}weakClone(){const e=new p9e(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e.geohashX=this.geohashX,e.geohashY=this.geohashY,e}};function L_r(t){return!(t.geometry==null||!t.geometry.coords||!t.geometry.coords.length)}let D_r=class extends mE{},ODt=class f9e{constructor(){this.objectIdFieldName=null,this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new f9e;return e.objectIdFieldName=this.objectIdFieldName,e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}},gx=class Pz{constructor(e=[],r=[],i=!1){this.lengths=e??[],this.coords=r??[],this.hasIndeterminateRingOrder=i}static fromRect(e){const[r,i,n,s]=e,o=n-r,a=s-i;return new Pz([5],[r,i,o,0,0,a,-o,0,0,-a])}get isPoint(){return this.lengths.length===0}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,r)=>e+r)}forEachVertex(e){let r=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let i=0;i<this.lengths.length;i++){const n=this.lengths[i];for(let s=0;s<n;s++)e(this.coords[2*(s+r)],this.coords[2*(s+r)+1]);r+=n}}clone(e){return e?(e.set(this.coords),new Pz(this.lengths.slice(),e,this.hasIndeterminateRingOrder)):new Pz(this.lengths.slice(),this.coords.slice(),this.hasIndeterminateRingOrder)}};function Vl(t,e){return t?e?4:3:e?3:2}const NF=re.getLogger("esri.layers.graphics.featureConversionUtils"),m9e={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryEnvelope:0},ADt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s},pxe=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2]},PDt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+3]},MDt=(t,e,r,i,n,s)=>{t[r]=n,t[r+1]=s,t[r+2]=e[i+2],t[r+3]=e[i+3]};function Khe(t,e,r,i){if(t){if(r)return e&&i?MDt:pxe;if(e&&i)return PDt}else if(e&&i)return pxe;return ADt}function UY({scale:t,translate:e},r){return Math.round((r-e[0])/t[0])}function zY({scale:t,translate:e},r){return Math.round((e[1]-r)/t[1])}function VY({scale:t,translate:e},r,i){return r*t[i]+e[i]}function F_r(t,e,r){return t?e?r?tpe(t):Qhe(t):r?epe(t):qH(t):null}function qH(t){const e=t.coords;return{x:e[0],y:e[1]}}function g9e(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t}function Qhe(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2]}}function $Dt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t}function epe(t){const e=t.coords;return{x:e[0],y:e[1],m:e[2]}}function IDt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.m,t}function tpe(t){const e=t.coords;return{x:e[0],y:e[1],z:e[2],m:e[3]}}function LDt(t,e){return t.coords[0]=e.x,t.coords[1]=e.y,t.coords[2]=e.z,t.coords[3]=e.m,t}function DDt(t,e,r,i){let n=qH;r&&i?n=tpe:r?n=Qhe:i&&(n=epe);for(const s of e){const{geometry:o,attributes:a}=s,l=o!=null?n(o):null;t.push({attributes:a,geometry:l})}return t}function rpe(t,e){return t&&e?LDt:t?$Dt:e?IDt:g9e}function NDt(t,e,r,i,n){const s=rpe(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?s(new gx,o):null;t.push(new mE(l,a,null,n?a[n]:void 0))}return t}function k_r(t,e,r=rpe(e.z!=null,e.m!=null)){return r(t,e)}function FDt(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?y9e(n,r,i):null});return t}function y9e(t,e,r){if(t==null)return null;const i=Vl(e,r),n=[];for(let s=0;s<t.coords.length;s+=i){const o=[];for(let a=0;a<i;a++)o.push(t.coords[s+a]);n.push(o)}return e?r?{points:n,hasZ:e,hasM:r}:{points:n,hasZ:e}:r?{points:n,hasM:r}:{points:n}}function kDt(t,e,r,i,n){const s=Vl(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?v9e(new gx,o,s):null;t.push(new mE(l,a,null,n?a[n]:void 0))}return t}function v9e(t,e,r=Vl(e.hasZ,e.hasM)){t.lengths[0]=e.points.length;const i=t.coords;let n=0;for(const s of e.points)for(let o=0;o<r;o++)i[n++]=s[o];return t}function UDt(t,e,r,i){for(const{geometry:n,attributes:s}of e)t.push({attributes:s,geometry:n!=null?_9e(n,r,i):null});return t}function _9e(t,e,r){if(!t)return null;const i=Vl(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const h=[];for(let f=0;f<i;f++)h.push(n[a++]);c.push(h)}o.push(c)}return e?r?{paths:o,hasZ:e,hasM:r}:{paths:o,hasZ:e}:r?{paths:o,hasM:r}:{paths:o}}function zDt(t,e,r,i,n){const s=Vl(r,i);for(const{geometry:o,attributes:a}of e){const l=o!=null?b9e(new gx,o,s):null;t.push(new mE(l,a,null,n?a[n]:void 0))}return t}function b9e(t,e,r=Vl(e.hasZ,e.hasM)){const{lengths:i,coords:n}=t;let s=0;for(const o of e.paths){for(const a of o)for(let l=0;l<r;l++)n[s++]=a[l];i.push(o.length)}return t}function VDt(t,e,r,i){for(const{geometry:n,attributes:s,centroid:o}of e){const a=n!=null?w9e(n,r,i):null;if(o!=null){const l=qH(o);t.push({attributes:s,centroid:l,geometry:a})}else t.push({attributes:s,geometry:a})}return t}function w9e(t,e,r){if(!t)return null;const i=Vl(e,r),{coords:n,lengths:s}=t,o=[];let a=0;for(const l of s){const c=[];for(let u=0;u<l;u++){const h=[];for(let f=0;f<i;f++)h.push(n[a++]);c.push(h)}o.push(c)}return e?r?{rings:o,hasZ:e,hasM:r}:{rings:o,hasZ:e}:r?{rings:o,hasM:r}:{rings:o}}function BDt(t,e,r,i,n){for(const{geometry:s,centroid:o,attributes:a}of e){const l=s!=null?x9e(new gx,s,r,i):null,c=n?a[n]:void 0;o!=null?t.push(new mE(l,a,g9e(new gx,o),c)):t.push(new mE(l,a,null,c))}return t}function x9e(t,e,r=e.hasZ,i=e.hasM){return jDt(t,e.rings,r,i)}function jDt(t,e,r,i){const n=Vl(r,i),{lengths:s,coords:o}=t;let a=0;a_(t);for(const l of e){for(const c of l)for(let u=0;u<n;u++)o[a++]=c[u];s.push(l.length)}return t}const DA=[],ED=[];function U_r(t,e,r,i,n){DA[0]=t;const[s]=S9e(ED,DA,e,r,i,n);return pg(DA),pg(ED),s}function S9e(t,e,r,i,n,s){if(pg(t),!r){for(const o of e){const a=s?o.attributes[s]:void 0;t.push(new mE(null,o.attributes,null,a))}return t}switch(r){case"esriGeometryPoint":return NDt(t,e,i,n,s);case"esriGeometryMultipoint":return kDt(t,e,i,n,s);case"esriGeometryPolyline":return zDt(t,e,i,n,s);case"esriGeometryPolygon":return BDt(t,e,i,n,s);default:NF.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${r}'`)),pg(t)}return t}function z_r(t,e,r,i){ED[0]=t,T9e(DA,ED,e,r,i);const n=DA[0];return pg(DA),pg(ED),n}function GDt(t,e,r){if(t==null)return null;const i=new gx;return"hasZ"in t&&e==null&&(e=t.hasZ),"hasM"in t&&r==null&&(r=t.hasM),Jce(t)?rpe(e??t.z!=null,r??t.m!=null)(i,t):TA(t)?x9e(i,t,e,r):Kce(t)?b9e(i,t,Vl(e,r)):Zce(t)?v9e(i,t,Vl(e,r)):void NF.error("convertFromGeometry:unknown-geometry",new H(`Unable to parse unknown geometry type '${t}'`))}function HDt(t,e,r,i){const n=t&&("coords"in t?t:t.geometry);if(n==null)return null;switch(e){case"esriGeometryPoint":{let s=qH;return r&&i?s=tpe:r?s=Qhe:i&&(s=epe),s(n)}case"esriGeometryMultipoint":return y9e(n,r,i);case"esriGeometryPolyline":return _9e(n,r,i);case"esriGeometryPolygon":return w9e(n,r,i);default:return NF.error("convertToGeometry:unknown-geometry",new H(`Unable to parse unknown geometry type '${e}'`)),null}}function qDt(t,e){for(const r of e)t.push({attributes:r.attributes});return t}function T9e(t,e,r,i,n){if(pg(t),r==null)return qDt(t,e);switch(r){case"esriGeometryPoint":return DDt(t,e,i,n);case"esriGeometryMultipoint":return FDt(t,e,i,n);case"esriGeometryPolyline":return UDt(t,e,i,n);case"esriGeometryPolygon":return VDt(t,e,i,n);default:NF.error("convertToFeatureSet:unknown-geometry",new H(`Unable to parse unknown geometry type '${r}'`))}return t}function V_r(t){const{objectIdFieldName:e,spatialReference:r,transform:i,fields:n,hasM:s,hasZ:o,features:a,geometryType:l,exceededTransferLimit:c,uniqueIdField:u,queryGeometry:h,queryGeometryType:f}=t,m={features:T9e([],a,l,o,s),fields:n,geometryType:l,objectIdFieldName:e,spatialReference:r,uniqueIdField:u,queryGeometry:HDt(h,f,!1,!1)};return i&&(m.transform=i),c&&(m.exceededTransferLimit=c),s&&(m.hasM=s),o&&(m.hasZ=o),m}function B_r(t,e){const r=new ODt,{hasM:i,hasZ:n,features:s,objectIdFieldName:o,spatialReference:a,geometryType:l,exceededTransferLimit:c,transform:u,fields:h}=t;return h&&(r.fields=h),r.geometryType=l??null,r.objectIdFieldName=o??e??null,r.spatialReference=a??null,r.objectIdFieldName?(s&&S9e(r.features,s,l,n,i,r.objectIdFieldName),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),n&&(r.hasZ=n),u&&(r.transform=u),r):(NF.error(new H("optimized-features:invalid-objectIdFieldName","objectIdFieldName is missing")),r)}function j_r(t){const{transform:e,features:r,hasM:i,hasZ:n}=t;if(!e)return t;for(const s of r)s.geometry!=null&&mxe(s.geometry,s.geometry,i,n,e),s.centroid!=null&&mxe(s.centroid,s.centroid,i,n,e);return t.transform=null,t}function G_r(t,e){const{geometryType:r,features:i,hasM:n,hasZ:s}=e;if(!t)return e;for(let o=0;o<i.length;o++){const a=i[o],l=a.weakClone();l.geometry=new gx,fxe(l.geometry,a.geometry,n,s,r,t),a.centroid&&(l.centroid=new gx,fxe(l.centroid,a.centroid,n,s,"esriGeometryPoint",t)),i[o]=l}return e.transform=t,e}function fxe(t,e,r,i,n,s,o=r,a=i){if(a_(t),e==null||!e.coords.length)return null;const l=m9e[n],{coords:c,lengths:u}=e,h=Vl(r,i),f=Vl(r&&o,i&&a),m=Khe(r,i,o,a);if(!u.length)return m(t.coords,c,0,0,UY(s,c[0]),zY(s,c[1])),a_(t,h,0),t;let g,y,_,b,w=0,x=0,S=x;for(const C of u){if(C<l)continue;let E=0;x=S,_=g=UY(s,c[w]),b=y=zY(s,c[w+1]),m(t.coords,c,x,w,_,b),E++,w+=h,x+=f;for(let R=1;R<C;R++,w+=h)_=UY(s,c[w]),b=zY(s,c[w+1]),_===g&&b===y||(m(t.coords,c,x,w,_-g,b-y),x+=f,E++,g=_,y=b);E>=l&&(t.lengths.push(E),S=x)}return pg(t.coords,S),t.coords.length?t:null}function H_r(t,e,r,i,n,s,o=r,a=i){if(a_(t),!e||!e.coords.length)return null;const l=m9e[n],{coords:c,lengths:u}=e,h=Vl(r,i),f=Vl(r&&o,i&&a),m=Khe(r,i,o,a);if(!u.length)return m(t.coords,c,0,0,c[0],c[1]),a_(t,h,0),t;let g=0;const y=s*s;for(const _ of u){if(_<l){g+=_*h;continue}const b=t.coords.length/f,w=g,x=g+(_-1)*h;m(t.coords,c,t.coords.length,w,c[w],c[w+1]),ine(t.coords,c,h,y,m,w,x),m(t.coords,c,t.coords.length,x,c[x],c[x+1]);const S=t.coords.length/f-b;S>=l?t.lengths.push(S):pg(t.coords,b*f),g+=_*h}return t.coords.length?t:null}function WDt(t,e,r,i){const n=t[e],s=t[e+1],o=t[r],a=t[r+1],l=t[i],c=t[i+1];let u=o,h=a,f=l-u,m=c-h;if(f!==0||m!==0){const g=((n-u)*f+(s-h)*m)/(f*f+m*m);g>1?(u=l,h=c):g>0&&(u+=f*g,h+=m*g)}return f=n-u,m=s-h,f*f+m*m}function ine(t,e,r,i,n,s,o){let a,l=i,c=0;for(let u=s+r;u<o;u+=r)a=WDt(e,u,s,o),a>l&&(c=u,l=a);l>i&&(c-s>r&&ine(t,e,r,i,n,s,c),n(t,e,t.length,c,e[c],e[c+1]),o-c>r&&ine(t,e,r,i,n,c,o))}function q_r(t,e,r,i){if(e==null||!e.coords||!e.coords.length)return null;const n=Vl(r,i);let s=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&e.coords){const c=e.coords;for(let u=0;u<c.length;u+=n){const h=c[u],f=c[u+1];s=Math.min(s,h),a=Math.max(a,h),o=Math.min(o,f),l=Math.max(l,f)}}return Ste(t)?ebt(t,s,o,a,l):Hce(s,o,a,l,t),t}function mxe(t,e,r,i,n){const{coords:s,lengths:o}=e,a=Vl(r,i);if(!s.length)return t!==e&&a_(t),t;h7(n);const{originPosition:l,scale:c,translate:u}=n,h=YDt;h.originPosition=l;const f=h.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=h.translate;if(m[0]=u[0]??0,m[1]=u[1]??0,m[2]=u[2]??0,m[3]=u[3]??0,!o.length){for(let y=0;y<a;++y)t.coords[y]=VY(h,s[y],y);return t!==e&&a_(t,a,0),t}let g=0;for(let y=0;y<o.length;y++){const _=o[y];t.lengths[y]=_;for(let x=0;x<a;++x)t.coords[g+x]=VY(h,s[g+x],x);let b=t.coords[g],w=t.coords[g+1];g+=a;for(let x=1;x<_;x++,g+=a){b+=s[g]*f[0],w+=s[g+1]*f[1],t.coords[g]=b,t.coords[g+1]=w;for(let S=2;S<a;++S)t.coords[g+S]=VY(h,s[g+S],S)}}return t!==e&&a_(t,s.length,o.length),t}function W_r(t,e,r,i,n,s){if(a_(t),t.lengths.push(...e.lengths),r===n&&i===s)for(let o=0;o<e.coords.length;o++)t.coords.push(e.coords[o]);else{const o=Vl(r,i),a=Khe(r,i,n,s),l=e.coords;for(let c=0;c<l.length;c+=o)a(t.coords,l,t.coords.length,c,l[c],l[c+1])}return t}function XDt(t,e,r,i){let n=0,s=t[i*e],o=t[i*(e+1)];for(let a=1;a<r;a++){const l=s+t[i*(e+a)],c=o+t[i*(e+a)+1],u=(l-s)*(c+o);s=l,o=c,n+=u}return .5*n}function X_r(t,e){const{coords:r,lengths:i}=t;let n=0,s=0;for(let o=0;o<i.length;o++){const a=i[o];s+=XDt(r,n,a,e),n+=a}return Math.abs(s)}function a_(t,e=0,r=0){pg(t.lengths,r),pg(t.coords,e)}function pg(t,e=0){t.length!==e&&(t.length=e)}const YDt={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]},gxe=new il(Array,t=>q7(t,G4e),null,10,5),ZDt=lr();let JDt=class{get labelLayers(){return this._labelLayers||Xct}get extent(){return this._extent}get isElevationSource(){return this.layers.some(e=>e==null?void 0:e.isElevationSource)}constructor(e,r,i,n,s){this.graphic=e,this.graphics3DSymbol=r,this.layers=i,this._visibleFlags=rl.ALL_LABEL,this.deconflictionPriority=0,++r.referenced,this._featureExpressionFeature=s?Uze(s,e,n):null}initialize(e){this._layer=e,this._forEachSymbolLayerGraphic(r=>{r.initialize(e),r.setVisibility(this.isVisible())})}destroy(){this._forEachSymbolLayerGraphic(e=>e.destroy()),this._calloutLayer=null,--this.graphics3DSymbol.referenced,this.graphics3DSymbol=null}get destroyed(){return this.layers==null}clearLabelGraphics(){this._forEachLabelGraphic(e=>e.destroy()),this._labelLayers=null}addLabelGraphic(e,r){this._labelLayers||(this._labelLayers=new Array),this._labelLayers.push(e),e.initialize(r),e.setVisibility(this.isVisible(oa.LABEL))}setCalloutGraphic(e){this._calloutLayer=e,this._layer&&(e.initialize(this._layer),e.setVisibility(this.isVisible()))}get calloutLayer(){return this._calloutLayer}get isDraped(){let e=!1;return this._forEachSymbolLayerGraphic(r=>{r.type==="draped"&&(e=!0)}),e}isVisible(e=oa.GRAPHIC,r){const i=r?this._visibleFlags|r|oa.LABEL*r:this._visibleFlags;return e===oa.GRAPHIC?(i&rl.ALL_GRAPHIC)===rl.ALL_GRAPHIC:(i&rl.ALL_LABEL)===rl.ALL_LABEL}setVisibilityFlag(e,r,i){const n=this.isVisible(e);i?this._visibleFlags|=e*r:this._visibleFlags&=~(e*r);const s=this.isVisible(e);if(n===s)return!1;if(e===oa.LABEL)this._forEachLabelGraphic(o=>o.setVisibility(s));else{this._forEachSymbolLayerGraphic(a=>a.setVisibility(s));const o=this.isVisible(oa.LABEL);this._forEachLabelGraphic(a=>a.setVisibility(o))}return!0}getVisibilityFlag(e,r){return(this._visibleFlags&e*r)!=0}computeExtent(e){if(!this._extent){const r=this.graphic.geometry;if(r==null)return!1;this._extent=lr(),cLt(r,this._extent);const i=r.spatialReference;if(!So(i,e)&&!rF(this._extent,i,this._extent,e))return this._extent=null,!1}return!0}getAsOptimizedGeometry(e,r){return this._optimizedGeometry||(this._optimizedGeometry=this._convertGraphicToOptimizedGeometry(this.graphic,e,r)),this._optimizedGeometry}_convertGraphicToOptimizedGeometry(e,r,i){let n=e.geometry;return n.type!=="mesh"&&n.type!=="extent"||(n=Tc.fromExtent(n.type==="mesh"?n.extent:n)),GDt(n,r,i)}get usedMemory(){let e=uze(this.graphic.attributes);return this._forEachSymbolLayerGraphic(r=>{const i=r.graphics3DSymbolLayer.complexity;if(i==null)return;const n=r.type==="draped"?i.memory.draped:i.memory;e+=n.bytesPerFeature,n.bytesPerCoordinate&&(e+=lLt(this.graphic.geometry)*n.bytesPerCoordinate)}),e}computeAttachmentOrigin(){const e={render:{origin:A(),num:0},draped:{origin:Qe(),num:0}};for(const r of this.layers)r!=null&&r.computeAttachmentOrigin(e);return e.render.num>1&&ce(e.render.origin,e.render.origin,1/e.render.num),e.draped.num>1&&eu(e.draped.origin,e.draped.origin,1/e.draped.num),e}async getProjectedBoundingBox(e,r,i,n,s){return s||(s={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),s.boundingBox?en(s.boundingBox):s.boundingBox=en(),s.requiresDrapedElevation=!1,await b7(this.layers,async o=>{if(o==null)return;const a=o.type==="draped"?r:e,l=gxe.acquire(),c=await o.getProjectedBoundingBox(a,i,s.screenSpaceObjects,n,l);isFinite(c[2])&&isFinite(c[5])||(s.requiresDrapedElevation=!0),c&&MP(s.boundingBox,l),gxe.release(l)}),K1t(s.boundingBox)||qQ(Bue(s.boundingBox,ZDt))?s:null}needsElevationUpdates(){var e;for(const r of this.layers)if(r!=null&&(r.type==="object3d"||r.type==="lod-instance")&&r.needsElevationUpdates)return!0;return((e=this._labelLayers)==null?void 0:e.some(r=>(r==null?void 0:r.needsElevationUpdates)??!1))??!1}alignWithElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type!=="object3d"&&n.type!=="lod-instance"||n.alignWithElevation(e,r,this._featureExpressionFeature,i)})}alignWithAbsoluteElevation(e,r,i){this._forEachRenderedGraphic(n=>{n.type==="object3d"&&n.alignWithAbsoluteElevation(e,r,i)})}addObjectStateSet(e,r){this._forEachSymbolLayerGraphic(i=>i.addObjectState(e,r))}removeObjectState(e){this._forEachSymbolLayerGraphic(r=>r.removeObjectState(e))}_forEachGraphicList(e,r){e==null||e.forEach(i=>i&&r(i))}_forEachSymbolLayerGraphic(e){this._forEachGraphicList(this.layers,e),this._calloutLayer&&e(this._calloutLayer)}_forEachLabelGraphic(e){this._forEachGraphicList(this._labelLayers,e)}_forEachRenderedGraphic(e){this._forEachSymbolLayerGraphic(e),this._forEachLabelGraphic(e)}get test(){const e=this;return{addLabelLayer:r=>{e._labelLayers||(e._labelLayers=new Array),e._labelLayers.push(r)}}}},Z_r=class{constructor(e,r){this.scheduler=e,this.schedule=r,this.sharedResources=null,this.streamDataRequester=null,this.elevationProvider=null,this.renderer=null,this.stage=null,this.clippingExtent=null,this.renderCoordsHelper=null,this.overlaySR=null,this.layer=null,this.drapeSourceRenderer=null,this.graphicsCoreOwner=null,this.localOriginFactory=null,this.featureExpressionInfoContext=null,this.screenSizePerspectiveEnabled=!0,this.slicePlaneEnabled=!1,this.physicalBasedRenderingEnabled=!1,this.skipHighSymbolLods=!1,this.isAsync=!1}},KDt=class{constructor(){this.renderPriority=0,this.renderPriorityStep=1,this.ignoreDrivers=!1}};var yxe,vxe,_xe,nne={exports:{}};nne.exports,yxe=nne,vxe=function(){function t(M,$,N){N=N||2;var j,J,K,te,ae,be,Ee,Je=$&&$.length,ze=Je?$[0]*N:M.length,Ge=e(M,0,ze,N,!0),Le=[];if(!Ge||Ge.next===Ge.prev)return Le;if(Je&&(Ge=l(M,$,Ge,N)),M.length>80*N){j=K=M[0],J=te=M[1];for(var de=N;de<ze;de+=N)(ae=M[de])<j&&(j=ae),(be=M[de+1])<J&&(J=be),ae>K&&(K=ae),be>te&&(te=be);Ee=(Ee=Math.max(K-j,te-J))!==0?1/Ee:0}return i(Ge,Le,N,j,J,Ee),Le}function e(M,$,N,j,J){var K,te;if(J===Z(M,$,N,j)>0)for(K=$;K<N;K+=j)te=W(K,M[K],M[K+1],te);else for(K=N-j;K>=$;K-=j)te=W(K,M[K],M[K+1],te);if(te&&C(te,te.next)){var ae=te.next;G(te),te=ae}return te}function r(M,$){if(!M)return M;$||($=M);var N,j=M;do if(N=!1,j.steiner||!C(j,j.next)&&S(j.prev,j,j.next)!==0)j=j.next;else{var J=j.prev;if(G(j),(j=$=J)===j.next)break;N=!0}while(N||j!==$);return $}function i(M,$,N,j,J,K,te){if(M){!te&&K&&g(M,j,J,K);for(var ae,be,Ee=M;M.prev!==M.next;)if(ae=M.prev,be=M.next,K?s(M,j,J,K):n(M))$.push(ae.i/N),$.push(M.i/N),$.push(be.i/N),G(M),M=be.next,Ee=be.next;else if((M=be)===Ee){te?te===1?i(M=o(r(M),$,N),$,N,j,J,K,2):te===2&&a(M,$,N,j,J,K):i(r(M),$,N,j,J,K,1);break}}}function n(M){var $=M.prev,N=M,j=M.next;if(S($,N,j)>=0)return!1;for(var J=M.next.next;J!==M.prev;){if(w($.x,$.y,N.x,N.y,j.x,j.y,J.x,J.y)&&S(J.prev,J,J.next)>=0)return!1;J=J.next}return!0}function s(M,$,N,j){var J=M.prev,K=M,te=M.next;if(S(J,K,te)>=0)return!1;for(var ae=J.x<K.x?J.x<te.x?J.x:te.x:K.x<te.x?K.x:te.x,be=J.y<K.y?J.y<te.y?J.y:te.y:K.y<te.y?K.y:te.y,Ee=J.x>K.x?J.x>te.x?J.x:te.x:K.x>te.x?K.x:te.x,Je=J.y>K.y?J.y>te.y?J.y:te.y:K.y>te.y?K.y:te.y,ze=_(ae,be,$,N,j),Ge=_(Ee,Je,$,N,j),Le=M.prevZ,de=M.nextZ;Le&&Le.z>=ze&&de&&de.z<=Ge;){if(Le!==M.prev&&Le!==M.next&&w(J.x,J.y,K.x,K.y,te.x,te.y,Le.x,Le.y)&&S(Le.prev,Le,Le.next)>=0||(Le=Le.prevZ,de!==M.prev&&de!==M.next&&w(J.x,J.y,K.x,K.y,te.x,te.y,de.x,de.y)&&S(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;Le&&Le.z>=ze;){if(Le!==M.prev&&Le!==M.next&&w(J.x,J.y,K.x,K.y,te.x,te.y,Le.x,Le.y)&&S(Le.prev,Le,Le.next)>=0)return!1;Le=Le.prevZ}for(;de&&de.z<=Ge;){if(de!==M.prev&&de!==M.next&&w(J.x,J.y,K.x,K.y,te.x,te.y,de.x,de.y)&&S(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function o(M,$,N){var j=M;do{var J=j.prev,K=j.next.next;!C(J,K)&&E(J,j,j.next,K)&&L(J,K)&&L(K,J)&&($.push(J.i/N),$.push(j.i/N),$.push(K.i/N),G(j),G(j.next),j=M=K),j=j.next}while(j!==M);return r(j)}function a(M,$,N,j,J,K){var te=M;do{for(var ae=te.next.next;ae!==te.prev;){if(te.i!==ae.i&&x(te,ae)){var be=V(te,ae);return te=r(te,te.next),be=r(be,be.next),i(te,$,N,j,J,K),void i(be,$,N,j,J,K)}ae=ae.next}te=te.next}while(te!==M)}function l(M,$,N,j){var J,K,te,ae=[];for(J=0,K=$.length;J<K;J++)(te=e(M,$[J]*j,J<K-1?$[J+1]*j:M.length,j,!1))===te.next&&(te.steiner=!0),ae.push(b(te));for(ae.sort(c),J=0;J<ae.length;J++)N=r(N=h(ae[J],N),N.next);return N}function c(M,$){return M.x-$.x}function u(M){if(M.next.prev===M)return M;let $=M;for(;;){const N=$.next;if(N.prev===$||N===$||N===M)break;$=N}return $}function h(M,$){var N=f(M,$);if(!N)return $;var j=V(N,M),J=r(N,N.next);let K=u(j);return r(K,K.next),J=u(J),u($===N?J:$)}function f(M,$){var N,j=$,J=M.x,K=M.y,te=-1/0;do{if(K<=j.y&&K>=j.next.y&&j.next.y!==j.y){var ae=j.x+(K-j.y)*(j.next.x-j.x)/(j.next.y-j.y);if(ae<=J&&ae>te){if(te=ae,ae===J){if(K===j.y)return j;if(K===j.next.y)return j.next}N=j.x<j.next.x?j:j.next}}j=j.next}while(j!==$);if(!N)return null;if(J===te)return N;var be,Ee=N,Je=N.x,ze=N.y,Ge=1/0;j=N;do J>=j.x&&j.x>=Je&&J!==j.x&&w(K<ze?J:te,K,Je,ze,K<ze?te:J,K,j.x,j.y)&&(be=Math.abs(K-j.y)/(J-j.x),L(j,M)&&(be<Ge||be===Ge&&(j.x>N.x||j.x===N.x&&m(N,j)))&&(N=j,Ge=be)),j=j.next;while(j!==Ee);return N}function m(M,$){return S(M.prev,M,$.prev)<0&&S($.next,M,M.next)<0}function g(M,$,N,j){var J=M;do J.z===null&&(J.z=_(J.x,J.y,$,N,j)),J.prevZ=J.prev,J.nextZ=J.next,J=J.next;while(J!==M);J.prevZ.nextZ=null,J.prevZ=null,y(J)}function y(M){var $,N,j,J,K,te,ae,be,Ee=1;do{for(N=M,M=null,K=null,te=0;N;){for(te++,j=N,ae=0,$=0;$<Ee&&(ae++,j=j.nextZ);$++);for(be=Ee;ae>0||be>0&&j;)ae!==0&&(be===0||!j||N.z<=j.z)?(J=N,N=N.nextZ,ae--):(J=j,j=j.nextZ,be--),K?K.nextZ=J:M=J,J.prevZ=K,K=J;N=j}K.nextZ=null,Ee*=2}while(te>1);return M}function _(M,$,N,j,J){return(M=1431655765&((M=858993459&((M=252645135&((M=16711935&((M=32767*(M-N)*J)|M<<8))|M<<4))|M<<2))|M<<1))|($=1431655765&(($=858993459&(($=252645135&(($=16711935&(($=32767*($-j)*J)|$<<8))|$<<4))|$<<2))|$<<1))<<1}function b(M){var $=M,N=M;do($.x<N.x||$.x===N.x&&$.y<N.y)&&(N=$),$=$.next;while($!==M);return N}function w(M,$,N,j,J,K,te,ae){return(J-te)*($-ae)-(M-te)*(K-ae)>=0&&(M-te)*(j-ae)-(N-te)*($-ae)>=0&&(N-te)*(K-ae)-(J-te)*(j-ae)>=0}function x(M,$){return M.next.i!==$.i&&M.prev.i!==$.i&&!D(M,$)&&(L(M,$)&&L($,M)&&k(M,$)&&(S(M.prev,M,$.prev)||S(M,$.prev,$))||C(M,$)&&S(M.prev,M,M.next)>0&&S($.prev,$,$.next)>0)}function S(M,$,N){return($.y-M.y)*(N.x-$.x)-($.x-M.x)*(N.y-$.y)}function C(M,$){return M.x===$.x&&M.y===$.y}function E(M,$,N,j){var J=P(S(M,$,N)),K=P(S(M,$,j)),te=P(S(N,j,M)),ae=P(S(N,j,$));return J!==K&&te!==ae||!(J!==0||!R(M,N,$))||!(K!==0||!R(M,j,$))||!(te!==0||!R(N,M,j))||!(ae!==0||!R(N,$,j))}function R(M,$,N){return $.x<=Math.max(M.x,N.x)&&$.x>=Math.min(M.x,N.x)&&$.y<=Math.max(M.y,N.y)&&$.y>=Math.min(M.y,N.y)}function P(M){return M>0?1:M<0?-1:0}function D(M,$){var N=M;do{if(N.i!==M.i&&N.next.i!==M.i&&N.i!==$.i&&N.next.i!==$.i&&E(N,N.next,M,$))return!0;N=N.next}while(N!==M);return!1}function L(M,$){return S(M.prev,M,M.next)<0?S(M,$,M.next)>=0&&S(M,M.prev,$)>=0:S(M,$,M.prev)<0||S(M,M.next,$)<0}function k(M,$){var N=M,j=!1,J=(M.x+$.x)/2,K=(M.y+$.y)/2;do N.y>K!=N.next.y>K&&N.next.y!==N.y&&J<(N.next.x-N.x)*(K-N.y)/(N.next.y-N.y)+N.x&&(j=!j),N=N.next;while(N!==M);return j}function V(M,$){var N=new B(M.i,M.x,M.y),j=new B($.i,$.x,$.y),J=M.next,K=$.prev;return M.next=$,$.prev=M,N.next=J,J.prev=N,j.next=N,N.prev=j,K.next=j,j.prev=K,j}function W(M,$,N,j){var J=new B(M,$,N);return j?(J.next=j.next,J.prev=j,j.next.prev=J,j.next=J):(J.prev=J,J.next=J),J}function G(M){M.next.prev=M.prev,M.prev.next=M.next,M.prevZ&&(M.prevZ.nextZ=M.nextZ),M.nextZ&&(M.nextZ.prevZ=M.prevZ)}function B(M,$,N){this.i=M,this.x=$,this.y=N,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Z(M,$,N,j){for(var J=0,K=$,te=N-j;K<N;K+=j)J+=(M[te]-M[K])*(M[K+1]+M[te+1]),te=K;return J}return t.deviation=function(M,$,N,j){var J=$&&$.length,K=J?$[0]*N:M.length,te=Math.abs(Z(M,0,K,N));if(J)for(var ae=0,be=$.length;ae<be;ae++){var Ee=$[ae]*N,Je=ae<be-1?$[ae+1]*N:M.length;te-=Math.abs(Z(M,Ee,Je,N))}var ze=0;for(ae=0;ae<j.length;ae+=3){var Ge=j[ae]*N,Le=j[ae+1]*N,de=j[ae+2]*N;ze+=Math.abs((M[Ge]-M[de])*(M[Le+1]-M[Ge+1])-(M[Ge]-M[Le])*(M[de+1]-M[Ge+1]))}return te===0&&ze===0?0:Math.abs((ze-te)/te)},t.flatten=function(M){for(var $=M[0][0].length,N={vertices:[],holes:[],dimensions:$},j=0,J=0;J<M.length;J++){for(var K=0;K<M[J].length;K++)for(var te=0;te<$;te++)N.vertices.push(M[J][K][te]);J>0&&(j+=M[J-1].length,N.holes.push(j))}return N},t},(_xe=vxe())!==void 0&&(yxe.exports=_xe);const e3=CF(nne.exports),WH=re.getLogger("esri.views.3d.support.buffer.math");function QDt(t,e,r){t3(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function t3(t,e,r,i=3,n=i){if(t.length/i!==Math.ceil(e.length/n))return WH.error("source and destination buffers need to have the same number of elements"),t;const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[4],u=r[5],h=r[6],f=r[8],m=r[9],g=r[10],y=r[12],_=r[13],b=r[14];let w=0,x=0;for(let S=0;S<s;S++){const C=e[w],E=e[w+1],R=e[w+2];t[x]=o*C+c*E+f*R+y,t[x+1]=a*C+u*E+m*R+_,t[x+2]=l*C+h*E+g*R+b,w+=n,x+=i}return t}function E9e(t,e,r){gE(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function gE(t,e,r,i=3,n=i){if(t.length/i!==Math.ceil(e.length/n))return void WH.error("source and destination buffers need to have the same number of elements");const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],f=r[6],m=r[7],g=r[8];let y=0,_=0;for(let b=0;b<s;b++){const w=e[y],x=e[y+1],S=e[y+2];t[_]=o*w+c*x+f*S,t[_+1]=a*w+u*x+m*S,t[_+2]=l*w+h*x+g*S,y+=n,_+=i}}function eNt(t,e,r){ZB(t.typedBuffer,e,r,t.typedBufferStride)}function ZB(t,e,r,i=3){const n=Math.min(t.length/i,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=r*s[a],t[l+1]=r*s[a+1],t[l+2]=r*s[a+2],a+=o,l+=i}function tNt(t,e){XH(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function XH(t,e,r=3,i=r){const n=Math.min(t.length/r,e.length/i);let s=0,o=0;for(let a=0;a<n;a++){const l=e[s],c=e[s+1],u=e[s+2],h=l*l+c*c+u*u;if(h>0){const f=1/Math.sqrt(h);t[o]=f*l,t[o+1]=f*c,t[o+2]=f*u}s+=i,o+=r}}function rNt(t,e,r){const i=Math.min(t.count,e.count),n=t.typedBuffer,s=t.typedBufferStride,o=e.typedBuffer,a=e.typedBufferStride;let l=0,c=0;for(let u=0;u<i;u++)n[c]=o[l]>>r,n[c+1]=o[l+1]>>r,n[c+2]=o[l+2]>>r,l+=a,c+=s}Object.freeze(Object.defineProperty({__proto__:null,normalize:XH,normalizeView:tNt,scale:ZB,scaleView:eNt,shiftRight:rNt,transformMat3:gE,transformMat3View:E9e,transformMat4:t3,transformMat4View:QDt},Symbol.toStringTag,{value:"Module"}));function iNt(t,e,r){return{objectId:t,target:e,distance:r,type:"vertex"}}function bxe(t,e,r,i,n,s=!1){return{objectId:t,target:e,distance:r,type:"edge",start:i,end:n,draped:s}}var l_,Ra;function Tw(t){return t&&t.declaredClass==="esri.renderers.visualVariables.SizeVariable"}function QN(t){return t!=null&&!isNaN(t)&&isFinite(t)}function C9e(t){return t.valueExpression?l_.Expression:t.field&&typeof t.field=="string"?l_.Field:l_.Unknown}function nNt(t,e){const r=e||C9e(t),i=t.valueUnit||"unknown";return r===l_.Unknown?Ra.Constant:t.stops?Ra.Stops:t.minSize!=null&&t.maxSize!=null&&t.minDataValue!=null&&t.maxDataValue!=null?Ra.ClampedLinear:i==="unknown"?t.minSize!=null&&t.minDataValue!=null?t.minSize&&t.minDataValue?Ra.Proportional:Ra.Additive:Ra.Identity:Ra.RealWorldSize}(function(t){t.Unknown="unknown",t.Expression="expression",t.Field="field"})(l_||(l_={})),function(t){t.Unknown="unknown",t.Stops="stops",t.ClampedLinear="clamped-linear",t.Proportional="proportional",t.Additive="additive",t.Constant="constant",t.Identity="identity",t.RealWorldSize="real-world-size"}(Ra||(Ra={}));const yx=re.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),wxe=new cf,Mz=Math.PI,R9e=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i;function O9e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="color"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.ColorVariable")return void yx.warn("The visualVariable should be an instance of esri.renderers.visualVariables.ColorVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let h=i.cache.compiledFunc;if(!l&&!u){const g=i.stops;return g&&g[0]&&g[0].color}if(typeof a!="number")if(u){if(r==null||r.arcade==null)return void yx.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(g),b=y.createExecContext(s,_);if(!h){const w=y.createSyntaxTree(i.valueExpression);h=y.createFunction(w),i.cache.compiledFunc=h}a=y.executeFunction(h,b)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const g=npe(a,c);if(g){const y=g[0],_=g[1],b=y===_?i.stops[y].color:ht.blendColors(i.stops[y].color,i.stops[_].color,g[2],r!=null?r.color:void 0);return new ht(b)}}}function A9e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(g=>g.type==="opacity"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.OpacityVariable")return void yx.warn("The visualVariable should be an instance of esri.renderers.visualVariables.OpacityVariable");const n=typeof e=="number",s=n?null:e,o=s&&s.attributes;let a=n?e:null;const l=i.field,{ipData:c,hasExpression:u}=i.cache;let h=i.cache.compiledFunc;if(!l&&!u){const g=i.stops;return g&&g[0]&&g[0].opacity}if(typeof a!="number")if(u){if(r==null||r.arcade==null)return void yx.error("Use of arcade expressions requires an arcade context");const g={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},y=r.arcade.arcadeUtils,_=y.getViewInfo(g),b=y.createExecContext(s,_);if(!h){const w=y.createSyntaxTree(i.valueExpression);h=y.createFunction(w),i.cache.compiledFunc=h}a=y.executeFunction(h,b)}else o&&(a=o[l]);const f=i.normalizationField,m=o!=null&&f!=null?parseFloat(o[f]):void 0;if(a!=null&&(!f||n||!isNaN(m)&&m!==0)){isNaN(m)||n||(a/=m);const g=npe(a,c);if(g){const y=g[0],_=g[1];if(y===_)return i.stops[y].opacity;{const b=i.stops[y].opacity;return b+(i.stops[_].opacity-b)*g[2]}}}}function P9e(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(m=>m.type==="rotation"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.RotationVariable")return void yx.warn("The visualVariable should be an instance of esri.renderers.visualVariables.RotationVariable");const n=i.axis||"heading",s=n==="heading"&&i.rotationType==="arithmetic"?90:0,o=n==="heading"&&i.rotationType==="arithmetic"?-1:1,a=typeof e=="number"?null:e,l=a&&a.attributes,c=i.field,{hasExpression:u}=i.cache;let h=i.cache.compiledFunc,f=0;if(!c&&!u)return f;if(u){if(r==null||r.arcade==null)return void yx.error("Use of arcade expressions requires an arcade context");const m={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},g=r.arcade.arcadeUtils,y=g.getViewInfo(m),_=g.createExecContext(a,y);if(!h){const b=g.createSyntaxTree(i.valueExpression);h=g.createFunction(b),i.cache.compiledFunc=h}f=g.executeFunction(h,_)}else l&&(f=l[c]||0);return f=typeof f!="number"||isNaN(f)?null:s+o*f,f}function sNt(t,e,r){const i=typeof e=="number",n=i?null:e,s=n&&n.attributes;let o=i?e:null;const{isScaleDriven:a}=t.cache;let l=t.cache.compiledFunc;if(a){const u=r!=null?r.scale:void 0,h=r!=null?r.view:void 0;o=u==null||h==="3d"?oNt(t):u}else if(!i)switch(t.inputValueType){case l_.Expression:{if(r==null||r.arcade==null)return void yx.error("Use of arcade expressions requires an arcade context");const u={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},h=r.arcade.arcadeUtils,f=h.getViewInfo(u),m=h.createExecContext(n,f);if(!l){const g=h.createSyntaxTree(t.valueExpression);l=h.createFunction(g),t.cache.compiledFunc=l}o=h.executeFunction(l,m);break}case l_.Field:s&&(o=s[t.field]);break;case l_.Unknown:o=null}if(!QN(o))return null;if(i||!t.normalizationField)return o;const c=s?parseFloat(s[t.normalizationField]):null;return QN(c)&&c!==0?o/c:null}function oNt(t){let e=null,r=null;const i=t.stops;return i?(e=i[0].value,r=i[i.length-1].value):(e=t.minDataValue||0,r=t.maxDataValue||0),(e+r)/2}function YH(t,e,r){const i="visualVariables"in t&&t.visualVariables?t.visualVariables.find(s=>s.type==="size"):t;if(!i)return;if(i.declaredClass!=="esri.renderers.visualVariables.SizeVariable")return void yx.warn("The visualVariable should be an instance of esri.renderers.visualVariables.SizeVariable");const n=$9e(sNt(i,e,r),i,e,r,i.cache.ipData);return n==null||isNaN(n)?0:n}function vd(t,e,r){return t==null?null:Tw(t)?YH(t,e,r):QN(t)?t:null}function M9e(t,e,r){return QN(r)&&t>r?r:QN(e)&&t<e?e:t}function aNt(t,e,r,i){return t+((vd(e.minSize,r,i)||e.minDataValue)??0)}function lNt(t,e,r){const i=t.stops;let n=i&&i.length&&i[0].size;return n==null&&(n=t.minSize),vd(n,e,r)}function cNt(t,e,r,i){const n=(t-e.minDataValue)/(e.maxDataValue-e.minDataValue),s=vd(e.minSize,r,i),o=vd(e.maxSize,r,i),a=i!=null?i.shape:void 0;if(t<=e.minDataValue)return s;if(t>=e.maxDataValue)return o;if(s==null||o==null)return null;if(e.scaleBy==="area"&&a){const l=a==="circle",c=l?Mz*(s/2)**2:s*s,u=c+n*((l?Mz*(o/2)**2:o*o)-c);return l?2*Math.sqrt(u/Mz):Math.sqrt(u)}return s+n*(o-s)}function uNt(t,e,r,i){const n=i!=null?i.shape:void 0,s=t/e.minDataValue,o=vd(e.minSize,r,i),a=vd(e.maxSize,r,i);let l=null;return l=n==="circle"?2*Math.sqrt(s*(o/2)**2):n==="square"||n==="diamond"||n==="image"?Math.sqrt(s*o**2):s*o,M9e(l,o,a)}function dNt(t,e,r,i,n){var l,c,u;const[s,o,a]=npe(t,n);if(s===o)return vd((l=e.stops)==null?void 0:l[s].size,r,i);{const h=vd((c=e.stops)==null?void 0:c[s].size,r,i);return h+(vd((u=e.stops)==null?void 0:u[o].size,r,i)-h)*a}}function hNt(t,e,r,i){const n=(i!=null&&i.resolution?i.resolution:1)*RP[e.valueUnit],s=vd(e.minSize,r,i),o=vd(e.maxSize,r,i),{valueRepresentation:a}=e;let l=null;return l=a==="area"?2*Math.sqrt(t/Mz)/n:a==="radius"||a==="distance"?2*t/n:t/n,M9e(l,s,o)}function $9e(t,e,r,i,n){switch(e.transformationType){case Ra.Additive:return aNt(t,e,r,i);case Ra.Constant:return lNt(e,r,i);case Ra.ClampedLinear:return cNt(t,e,r,i);case Ra.Proportional:return uNt(t,e,r,i);case Ra.Stops:return dNt(t,e,r,i,n);case Ra.RealWorldSize:return hNt(t,e,r,i);case Ra.Identity:return t;case Ra.Unknown:return null}}function pNt(t,e,r){const{isScaleDriven:i}=t.cache;if(!(i&&r==="3d"||e))return null;const n={scale:e,view:r};let s=vd(t.minSize,wxe,n),o=vd(t.maxSize,wxe,n);if(s!=null||o!=null){if(s>o){const a=o;o=s,s=a}return{minSize:s,maxSize:o}}}function ipe(t,e,r){if(!t.visualVariables)return;const i=[],n=[],s=[],o=[],a=[];for(const l of t.visualVariables)switch(l.type){case"color":n.push(l);break;case"opacity":s.push(l);break;case"rotation":a.push(l);break;case"size":o.push(l)}return n.forEach(l=>{const c=O9e(l,e,r);i.push({variable:l,value:c})}),s.forEach(l=>{const c=A9e(l,e,r);i.push({variable:l,value:c})}),a.forEach(l=>{const c=P9e(l,e,r);i.push({variable:l,value:c})}),o.forEach(l=>{const c=YH(l,e,r);i.push({variable:l,value:c})}),i.filter(l=>l.value!=null)}function npe(t,e){if(!e)return;let r=0,i=e.length-1;return e.some((n,s)=>t<n?(i=s,!0):(r=s,!1)),[r,i,(t-e[r])/(e[i]-e[r])]}function fNt(t,e,r){const i=["proportional","proportional","proportional"];for(const n of t){const s=n.useSymbolValue?"symbol-value":YH(n,e,r);switch(n.axis){case"width":i[0]=s;break;case"depth":i[1]=s;break;case"height":i[2]=s;break;case"width-and-depth":i[0]=s,i[1]=s;break;case"all":case void 0:case null:i[0]=s,i[1]=s,i[2]=s;break;default:n.axis}}return i}const Q_r=Object.freeze(Object.defineProperty({__proto__:null,getAllSizes:fNt,getColor:O9e,getOpacity:A9e,getRotationAngle:P9e,getSize:YH,getSizeForValue:$9e,getSizeFromNumberOrVariable:vd,getSizeRangeAtScale:pNt,getVisualVariableValues:ipe,viewScaleRE:R9e},Symbol.toStringTag,{value:"Module"}));function ZH(t,e){if(!t||t.symbol)return null;const r=e&&e.renderer;return t&&r!=null&&r.getObservationRenderer?r.getObservationRenderer(t):r}function mNt(t,e){if(t.symbol!=null)return t.symbol;const r=ZH(t,e);return r!=null&&r.type!=="dot-density"?r.getSymbol(t,e):null}function e1r(t,e){const r=ZH(t,e),i=mNt(t,e);if(i==null)return null;const n={renderer:r,symbol:i};if(r==null||!("visualVariables"in r)||!r.visualVariables)return n;const s=ipe(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)switch(a.type){case"color":n.color=l.toRgba();break;case"size":if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;switch(c){case"width":o[0]=u;break;case"depth":o[1]=u;break;case"height":o[2]=u;break;case"width-and-depth":o[0]=o[1]=u;break;default:o[0]=o[1]=o[2]=u}}break;case"opacity":n.opacity=l;break;case"rotation":switch(a.axis){case"tilt":n.tilt=l;break;case"roll":n.roll=l;break;default:n.heading=l}}return o[0]==="proportional"&&o[1]==="proportional"&&o[2]==="proportional"||(n.size=o),n}async function gNt(t,e){if(t.symbol!=null)return t.symbol;const r=ZH(t,e);return r!=null?r.getSymbolAsync(t,e):null}async function t1r(t,e){const r=ZH(t,e),i=await gNt(t,e);if(!i)return null;const n={renderer:r,symbol:i};if(!r||!("visualVariables"in r)||!r.visualVariables)return n;const s=ipe(r,t,e)??[],o=["proportional","proportional","proportional"];for(const{variable:a,value:l}of s)if(a.type==="color")n.color=ht.toUnitRGBA(l);else if(a.type==="size")if(a.target==="outline")n.outlineSize=l;else{const c=a.axis,u=a.useSymbolValue?"symbol-value":l;c==="width"?o[0]=u:c==="depth"?o[1]=u:c==="height"?o[2]=u:o[0]=o[1]=c==="width-and-depth"?u:o[2]=u}else a.type==="opacity"?n.opacity=l:a.type==="rotation"&&a.axis==="tilt"?n.tilt=l:a.type==="rotation"&&a.axis==="roll"?n.roll=l:a.type==="rotation"&&(n.heading=l);return(isFinite(o[0])||isFinite(o[1])||isFinite(o[2]))&&(n.size=o),n}function yNt(t,e=0){const r=t[e];return typeof r=="number"&&isFinite(r)?r:null}function vNt(t){for(let e=0;e<3;e++){const r=t[e];if(typeof r=="number")return isFinite(r)?r:0}return 0}function xxe(t){const e=[[O.POSITION,t.indices]],r=[[O.POSITION,new ft(t.attributeData.position,3,!0)]];return t.attributeData.colorFeature!=null?(r.push([O.COLORFEATUREATTRIBUTE,new ft([t.attributeData.colorFeature],1,!0)]),e.push([O.COLORFEATUREATTRIBUTE,new Array(t.indices.length).fill(0)])):t.attributeData.color&&(r.push([O.COLOR,new ft(t.attributeData.color,4,!0)]),e.push([O.COLOR,q3(t.indices.length)])),t.attributeData.uvMapSpace&&(r.push([O.UVMAPSPACE,new ft(t.attributeData.uvMapSpace,4,!0)]),e.push([O.UVMAPSPACE,t.indices])),t.attributeData.boundingRect&&(r.push([O.BOUNDINGRECT,new ft(t.attributeData.boundingRect,9,!0)]),e.push([O.BOUNDINGRECT,t.indices])),new Us(t.material,r,e,t.mapPositions,Wn.Mesh,t.attributeData.objectAndLayerIdColor)}function Sxe(t,e=null){const r=[[O.POSITION,t.indices],[O.UV0,t.indices]],i=[[O.POSITION,new ft(t.attributeData.position,3,!0)],[O.UV0,new ft(t.attributeData.uv0,2,!0)]];return new Us(t.material,i,r,t.mapPositions,Wn.Mesh,e)}function e4(t){switch(t.type){case"extent":if(t instanceof $r)return Tc.fromExtent(t);break;case"polygon":return t}return null}let JH=class{constructor(e,r,i){this.renderData=e,this.layerUid=r,this.graphicUid=i,this.outGeometries=new Array}};function sne(t,e,r){const i=Array.isArray(t),n=i?t.length/e:t.byteLength/(4*e),s=i?t:new Uint32Array(t,0,n*e),o=(r==null?void 0:r.minReduction)??0,a=(r==null?void 0:r.originalIndices)||null,l=a?a.length:0,c=(r==null?void 0:r.componentOffsets)||null;let u=0;if(c)for(let E=0;E<c.length-1;E++){const R=c[E+1]-c[E];R>u&&(u=R)}else u=n;const h=Math.floor(1.1*u)+1;($g==null||$g.length<2*h)&&($g=new Uint32Array(lmt(2*h)));for(let E=0;E<2*h;E++)$g[E]=0;let f=0;const m=!!c&&!!a,g=m?l:n;let y=$B(n);const _=new Uint32Array(l),b=1.96;let w=o!==0?Math.ceil(4*b*b/(o*o)*o*(1-o)):g,x=1,S=c?c[1]:g;for(let E=0;E<g;E++){if(E===w){const V=1-f/E;if(V+b*Math.sqrt(V*(1-V)/E)<o)return null;w*=2}if(E===S){for(let V=0;V<2*h;V++)$g[V]=0;if(a)for(let V=c[x-1];V<c[x];V++)_[V]=y[a[V]];S=c[++x]}const R=m?a[E]:E,P=R*e,D=wNt(s,P,e);let L=D%h,k=f;for(;$g[2*L+1]!==0;){if($g[2*L]===D){const V=$g[2*L+1]-1;if(_Nt(s,P,V*e,e)){k=y[V];break}}L++,L>=h&&(L-=h)}k===f&&($g[2*L]=D,$g[2*L+1]=R+1,f++),y[R]=k}if(o!==0&&1-f/n<o)return null;if(m){for(let E=c[x-1];E<_.length;E++)_[E]=y[a[E]];y=Ky(_)}const C=i?new Array(f):new Uint32Array(f*e);f=0;for(let E=0;E<g;E++)y[E]===f&&(bNt(s,(m?a[E]:E)*e,C,f*e,e),f++);if(a&&!m){const E=new Uint32Array(l);for(let R=0;R<E.length;R++)E[R]=y[a[R]];y=Ky(E)}return{buffer:Array.isArray(C)?C:C.buffer,indices:y,uniqueCount:f}}function _Nt(t,e,r,i){for(let n=0;n<i;n++)if(t[e+n]!==t[r+n])return!1;return!0}function bNt(t,e,r,i,n){for(let s=0;s<n;s++)r[i+s]=t[e+s]}function wNt(t,e,r){let i=0;for(let n=0;n<r;n++)i=t[e+n]+i|0,i=i+(i<<11)+(i>>>2)|0;return i>>>0}let $g=null;function i1r(t){const e=FF(t.rings,t.hasZ,f0.CCW_IS_HOLE),r=new Array;let i=0,n=0;for(const a of e.polygons){const l=a.count,c=a.index,u=Xp(e.position,3*c,3*l),h=a.holeIndices.map(m=>m-c),f=Ky(e3(u,h,3));r.push({position:u,faces:f}),i+=u.length,n+=f.length}const s=xNt(r,i,n),o=Array.isArray(s.position)?sne(s.position,3,{originalIndices:s.faces}):sne(s.position.buffer,6,{originalIndices:s.faces});return s.position=sUe(new Float64Array(o.buffer)),s.faces=o.indices,s}function xNt(t,e,r){if(t.length===1)return t[0];const i=sl(e),n=new Array(r);let s=0,o=0,a=0;for(const l of t){for(let c=0;c<l.position.length;c++)i[s++]=l.position[c];for(const c of l.faces)n[o++]=c+a;a=s/3}return{position:i,faces:Ky(n)}}function FF(t,e,r){const i=t.length,n=new Array(i),s=new Array(i),o=new Array(i);let a=0,l=0,c=0,u=0;for(let m=0;m<i;++m)u+=t[m].length;const h=sl(3*u);let f=0;for(let m=i-1;m>=0;m--){const g=t[m],y=r===f0.CCW_IS_HOLE&&SNt(g);if(y&&i!==1)n[a++]=g;else{let _=g.length;for(let w=0;w<a;++w)_+=n[w].length;const b={index:f,pathLengths:new Array(a+1),count:_,holeIndices:new Array(a)};b.pathLengths[0]=g.length,g.length>0&&(o[c++]={index:f,count:g.length}),f=y?d6(g,g.length-1,-1,h,f,g.length,e):d6(g,0,1,h,f,g.length,e);for(let w=0;w<a;++w){const x=n[w];b.holeIndices[w]=f,b.pathLengths[w+1]=x.length,x.length>0&&(o[c++]={index:f,count:x.length}),f=d6(x,0,1,h,f,x.length,e)}a=0,b.count>0&&(s[l++]=b)}}for(let m=0;m<a;++m){const g=n[m];g.length>0&&(o[c++]={index:f,count:g.length}),f=d6(g,0,1,h,f,g.length,e)}return s.length=l,o.length=c,{position:h,polygons:s,outlines:o}}function d6(t,e,r,i,n,s,o){n*=3;for(let a=0;a<s;++a){const l=t[e];i[n++]=l[0],i[n++]=l[1],i[n++]=o?l[2]:0,e+=r}return n/3}function SNt(t){return!Gce(t,!1,!1)}var f0;(function(t){t[t.NONE=0]="NONE",t[t.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(f0||(f0={}));var CD,JB,one;(function(t){t[t.RasterImage=0]="RasterImage",t[t.Features=1]="Features"})(CD||(CD={})),function(t){t[t.MapLayer=0]="MapLayer",t[t.ViewLayer=1]="ViewLayer",t[t.Outline=2]="Outline",t[t.SnappingHint=3]="SnappingHint"}(JB||(JB={})),function(t){t[t.WithRasterImage=0]="WithRasterImage",t[t.WithoutRasterImage=1]="WithoutRasterImage"}(one||(one={}));let I9e=class{constructor(e,r){this._fbo=null;const i=new Vr;i.wrapMode=ir.CLAMP_TO_EDGE,i.samplingMode=Kt.LINEAR_MIPMAP_LINEAR,i.hasMipmap=r,i.maxAnisotropy=8,this._fbo=new wo(e,i)}dispose(){this._fbo=pt(this._fbo)}getTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}isValid(){return this._fbo!=null}resize(e,r){var i;(i=this._fbo)==null||i.resize(e,r)}bind(e){e.bindFramebuffer(this._fbo)}generateMipMap(){var r;const e=(r=this._fbo)==null?void 0:r.colorTexture;e!=null&&e.descriptor.hasMipmap&&e.generateMipmap()}disposeRenderTargetMemory(){var e;(e=this._fbo)==null||e.resize(0,0)}get gpuMemoryUsage(){var e;return((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0}},$C=class{constructor(e,r,i,n=!0){this.output=r,this.type=i,this.valid=!1,this.lastUsed=1/0,this.fbo=new I9e(e,n)}},TNt=class{constructor(e){this.renderTargets=[new $C(e,q.Color,Hn.Color),new $C(e,q.Color,Hn.ColorNoRasterImage),new $C(e,q.Highlight,Hn.Highlight,!1),new $C(e,q.Normal,Hn.Water),new $C(e,q.Color,Hn.Occluded)],he("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new $C(e,q.ObjectAndLayerIdColor,Hn.ObjectAndLayerIdColor))}getTarget(e){return this.renderTargets[e].fbo}dispose(){for(const e of this.renderTargets)e.fbo.dispose()}disposeRenderTargetMemory(){for(const e of this.renderTargets)e.fbo.disposeRenderTargetMemory()}validateUsageForTarget(e,r,i){return e?(r.lastUsed=i,!1):i-r.lastUsed>ENt?(r.fbo.disposeRenderTargetMemory(),r.lastUsed=1/0,!1):r.lastUsed<1/0}get gpuMemoryUsage(){return this.renderTargets.reduce((e,r)=>e+r.fbo.gpuMemoryUsage,0)}};const ENt=1e3;let L9e=class extends Ai{constructor(){super(...arguments),this.color=nr(1,1,1,1)}};function CNt(){const t=new jr;return t.include(wf),t.fragment.uniforms.add(new Mt("tex",e=>e.texture),new Cr("uColor",e=>e.color)),t.fragment.code.add(T`void main() {
vec4 texColor = texture(tex, uv);
fragColor = texColor * uColor;
}`),t}const RNt=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:L9e,build:CNt},Symbol.toStringTag,{value:"Module"}));let D9e=class{constructor(e){this._context=e,this._perConstructorInstances=new W3,this._frameCounter=0,this._keepAliveFrameCount=Txe}get viewingMode(){return this._context.viewingMode}get constructionContext(){return this._context}destroy(){this._perConstructorInstances.forEach(e=>e.forEach(r=>r.technique.destroy())),this._perConstructorInstances.clear()}acquire(e,r=ANt){const i=r.key;let n=this._perConstructorInstances.get(e,i);if(n==null){const s=new e(this._context,r,()=>this.release(s));n=new ONt(s),this._perConstructorInstances.set(e,i,n)}return++n.refCount,n.technique}releaseAndAcquire(e,r,i){if(i!=null){if(r.key===i.key)return i;this.release(i)}return this.acquire(e,r)}release(e){if(e==null||this._perConstructorInstances.empty)return;const r=this._perConstructorInstances.get(e.constructor,e.key);r!=null&&(--r.refCount,r.refCount===0&&(r.refZeroFrame=this._frameCounter))}frameUpdate(){this._frameCounter++,this._keepAliveFrameCount!==Txe&&this._perConstructorInstances.forEach((e,r)=>{e.forEach((i,n)=>{i.refCount===0&&i.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(i.technique.destroy(),this._perConstructorInstances.delete(r,n))})})}async reloadAll(){const e=new Array;this._perConstructorInstances.forEach((r,i)=>{const n=async(s,o)=>{const a=o.shader;a&&(await a.reload(),s.forEach(l=>l.technique.reload(this._context)))};e.push(n(r,i))}),await Promise.all(e)}},ONt=class{constructor(e){this.technique=e,this.refCount=0,this.refZeroFrame=0}};const Txe=-1,ANt=new jl;let N9e=class{constructor(e,r,i,n){this._textureRepository=e,this._techniqueRepository=r,this.materialChanged=i,this.requestRender=n,this._id2glMaterialRef=new W3}dispose(){this._textureRepository.destroy()}acquire(e,r,i){if(this._ownMaterial(e),!e.requiresSlot(r,i))return null;let n=this._id2glMaterialRef.get(i,e.id);if(n==null){const s=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:i});n=new PNt(s),this._id2glMaterialRef.set(i,e.id,n)}return n.ref(),n.glMaterial}release(e,r){const i=this._id2glMaterialRef.get(r,e.id);i!=null&&(i.unref(),i.referenced||(pt(i.glMaterial),this._id2glMaterialRef.delete(r,e.id)))}_ownMaterial(e){e.repository!=null&&e.repository!==this&&re.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository"),e.repository=this}},PNt=class{constructor(e){this.glMaterial=e,this._refCnt=0}ref(){++this._refCnt}unref(){--this._refCnt,It(this._refCnt>=0)}get referenced(){return this._refCnt>0}};const MNt={orderedRepackingEnabled:!1},$Nt=["layerObjectAdded","layerObjectRemoved","layerObjectsAdded","layerObjectsRemoved","shaderTransformationChanged","objectTransformation","visibilityChanged","occlusionChanged","highlightChanged","objectGeometryAdded","objectGeometryRemoved","objectGeometryUpdated"];let ane=class $z{get bounds(){return this._root.bounds}get halfSize(){return this._root.halfSize}get root(){return this._root.node}get maximumObjectsPerNode(){return this._maximumObjectsPerNode}get maximumDepth(){return this._maximumDepth}get objectCount(){return this._objectCount}constructor(e,r){this.objectToBoundingSphere=e,this._maximumObjectsPerNode=10,this._maximumDepth=20,this._degenerateObjects=new Set,this._root=new Qo,this._objectCount=0,r&&(r.maximumObjectsPerNode!==void 0&&(this._maximumObjectsPerNode=r.maximumObjectsPerNode),r.maximumDepth!==void 0&&(this._maximumDepth=r.maximumDepth))}destroy(){this._degenerateObjects.clear(),Qo.clearPool(),lne[0]=null,eS.prune(),iT.prune()}add(e,r=e.length){this._objectCount+=r,this._grow(e,r);const i=Qo.acquire();for(let n=0;n<r;n++){const s=e[n];this._isDegenerate(s)?this._degenerateObjects.add(s):(i.init(this._root),this._add(s,i))}Qo.release(i)}remove(e,r=null){this._objectCount-=e.length;const i=Qo.acquire();for(const n of e){const s=r??LP(this.objectToBoundingSphere(n),FNt);YI(s[3])?(i.init(this._root),this._remove(n,s,i)):this._degenerateObjects.delete(n)}Qo.release(i),this._shrink()}update(e,r){if(!YI(r[3])&&this._isDegenerate(e))return;const i=NNt(e);this.remove(i,r),this.add(i)}forEachAlongRay(e,r,i){const n=Ah(e,r);this._forEachNode(this._root,s=>{if(!this._intersectsNode(n,s))return!1;const o=s.node;return o.terminals.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),o.residents!==null&&o.residents.forAll(a=>{this._intersectsObject(n,a)&&i(a)}),!0})}forEachAlongRayWithVerticalOffset(e,r,i,n){const s=Ah(e,r);this._forEachNode(this._root,o=>{if(!this._intersectsNodeWithOffset(s,o,n))return!1;const a=o.node;return a.terminals.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),a.residents!==null&&a.residents.forAll(l=>{this._intersectsObjectWithOffset(s,l,n)&&i(l)}),!0})}forEach(e){this._forEachNode(this._root,r=>{const i=r.node;return i.terminals.forAll(e),i.residents!==null&&i.residents.forAll(e),!0}),this._degenerateObjects.forEach(e)}forEachDegenerateObject(e){this._degenerateObjects.forEach(e)}findClosest(e,r,i,n=()=>!0,s=1/0){let o=1/0,a=1/0,l=null;const c=BY(e,r),u=h=>{if(--s,!n(h))return;const f=this.objectToBoundingSphere(h);if(!bw(i,f))return;const m=jb(e,r,f),g=m-f[3],y=m+f[3];g<o&&(o=g,a=y,l=h)};return this._forEachNodeDepthOrdered(this._root,h=>{if(s<=0||!bw(i,h.bounds)||(ce(Bh,c,h.halfSize),ge(Bh,Bh,h.bounds),jb(e,r,Bh)>a))return!1;const f=h.node;return f.terminals.forAll(m=>u(m)),f.residents!==null&&f.residents.forAll(m=>u(m)),!0},e,r),l}forEachInDepthRange(e,r,i,n,s,o,a){let l=-1/0,c=1/0;const u={setRange:y=>{i===$z.DepthOrder.FRONT_TO_BACK?(l=Math.max(l,y.near),c=Math.min(c,y.far)):(l=Math.max(l,-y.far),c=Math.min(c,-y.near))}};u.setRange(n);const h=jb(r,i,e),f=BY(r,i),m=BY(r,-i),g=y=>{if(!a(y))return;const _=this.objectToBoundingSphere(y),b=_,w=jb(r,i,b)-h,x=w-_[3],S=w+_[3];x>c||S<l||!bw(o,_)||s(y,u)};this._forEachNodeDepthOrdered(this._root,y=>{if(!bw(o,y.bounds)||(ce(Bh,f,y.halfSize),ge(Bh,Bh,y.bounds),jb(r,i,Bh)-h>c)||(ce(Bh,m,y.halfSize),ge(Bh,Bh,y.bounds),jb(r,i,Bh)-h<l))return!1;const _=y.node;return _.terminals.forAll(b=>g(b)),_.residents!==null&&_.residents.forAll(b=>g(b)),!0},r,i)}forEachNode(e){this._forEachNode(this._root,r=>e(r.node,r.bounds,r.halfSize,r.depth))}forEachNeighbor(e,r){const i=t_(r),n=r,s=l=>{const c=this.objectToBoundingSphere(l),u=t_(c),h=i+u;return!(ks(c,n)-h*h<=0)||e(l)};let o=!0;const a=l=>{o&&(o=s(l))};this._forEachNode(this._root,l=>{const c=t_(l.bounds),u=i+c;if(ks(l.bounds,n)-u*u>0)return!1;const h=l.node;return h.terminals.forAll(a),o&&h.residents!==null&&h.residents.forAll(a),o}),o&&this.forEachDegenerateObject(a)}_intersectsNode(e,r){return h6(r.bounds,2*-r.halfSize,Qd),h6(r.bounds,2*r.halfSize,eh),V1e(e.origin,e.direction,Qd,eh)}_intersectsNodeWithOffset(e,r,i){return h6(r.bounds,2*-r.halfSize,Qd),h6(r.bounds,2*r.halfSize,eh),i.applyToMinMax(Qd,eh),V1e(e.origin,e.direction,Qd,eh)}_intersectsObject(e,r){const i=this.objectToBoundingSphere(r);return!(i[3]>0)||Yte(i,e)}_intersectsObjectWithOffset(e,r,i){const n=this.objectToBoundingSphere(r);return!(n[3]>0)||Yte(i.applyToBoundingSphere(n),e)}_forEachNode(e,r){let i=Qo.acquire().init(e);const n=[i];for(;n.length!==0;){if(i=n.pop(),r(i)&&!i.isLeaf())for(let s=0;s<i.node.children.length;s++)i.node.children[s]&&n.push(Qo.acquire().init(i).advance(s));Qo.release(i)}}_forEachNodeDepthOrdered(e,r,i,n=$z.DepthOrder.FRONT_TO_BACK){let s=Qo.acquire().init(e);const o=[s];for(DNt(i,n,Rxe);o.length!==0;){if(s=o.pop(),r(s)&&!s.isLeaf())for(let a=7;a>=0;--a){const l=Rxe[a];s.node.children[l]&&o.push(Qo.acquire().init(s).advance(l))}Qo.release(s)}}_remove(e,r,i){eS.clear();const n=i.advanceTo(r,(s,o)=>{eS.push(s.node),eS.push(o)})?i.node.terminals:i.node.residents;if(n.removeUnordered(e),n.length===0)for(let s=eS.length-2;s>=0;s-=2){const o=eS.data[s],a=eS.data[s+1];if(!this._purge(o,a))break}}_nodeIsEmpty(e){if(e.terminals.length!==0)return!1;if(e.residents!==null)return e.residents.length===0;for(let r=0;r<e.children.length;r++)if(e.children[r])return!1;return!0}_purge(e,r){return r>=0&&(e.children[r]=null),!!this._nodeIsEmpty(e)&&(e.residents===null&&(e.residents=new dr({shrink:!0})),!0)}_add(e,r){r.advanceTo(this.objectToBoundingSphere(e))?r.node.terminals.push(e):(r.node.residents.push(e),r.node.residents.length>this._maximumObjectsPerNode&&r.depth<this._maximumDepth&&this._split(r))}_split(e){const r=e.node.residents;e.node.residents=null;for(let i=0;i<r.length;i++){const n=Qo.acquire().init(e);this._add(r.at(i),n),Qo.release(n)}}_grow(e,r){if(r!==0&&(Exe(e,r,i=>this.objectToBoundingSphere(i),k0),YI(k0[3])&&!this._fitsInsideTree(k0)))if(this._nodeIsEmpty(this._root.node))LP(k0,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize();else{const i=this._rootBoundsForRootAsSubNode(k0);this._placingRootViolatesMaxDepth(i)?this._rebuildTree(k0,i):this._growRootAsSubNode(i),Qo.release(i)}}_rebuildTree(e,r){oe(GY,r.bounds),GY[3]=r.halfSize,Exe([e,GY],2,n=>n,HY);const i=Qo.acquire().init(this._root);this._root.initFrom(null,HY,HY[3]),this._root.increaseHalfSize(1.25),this._forEachNode(i,n=>(this.add(n.node.terminals.data,n.node.terminals.length),n.node.residents!==null&&this.add(n.node.residents.data,n.node.residents.length),!0)),Qo.release(i)}_placingRootViolatesMaxDepth(e){const r=Math.log(e.halfSize/this._root.halfSize)*Math.LOG2E;let i=0;return this._forEachNode(this._root,n=>(i=Math.max(i,n.depth),i+r<=this._maximumDepth)),i+r>this._maximumDepth}_rootBoundsForRootAsSubNode(e){const r=e[3],i=e;let n=-1/0;const s=this._root.bounds,o=this._root.halfSize;for(let l=0;l<3;l++){const c=s[l]-o-(i[l]-r),u=i[l]+r-(s[l]+o),h=Math.max(0,Math.ceil(c/(2*o))),f=Math.max(0,Math.ceil(u/(2*o)))+1,m=2**Math.ceil(Math.log(h+f)*Math.LOG2E);n=Math.max(n,m),p6[l].min=h,p6[l].max=f}for(let l=0;l<3;l++){let c=p6[l].min,u=p6[l].max;const h=(n-(c+u))/2;c+=Math.ceil(h),u+=Math.floor(h);const f=s[l]-o-c*o*2;jY[l]=f+(u+c)*o}const a=n*o;return jY[3]=a*k9e,Qo.acquire().initFrom(null,jY,a,0)}_growRootAsSubNode(e){const r=this._root.node;oe(k0,this._root.bounds),k0[3]=this._root.halfSize,this._root.init(e),e.advanceTo(k0,null,!0),e.node.children=r.children,e.node.residents=r.residents,e.node.terminals=r.terminals}_shrink(){for(;;){const e=this._findShrinkIndex();if(e===-1)break;this._root.advance(e),this._root.depth=0}}_findShrinkIndex(){if(this._root.node.terminals.length!==0||this._root.isLeaf())return-1;let e=null;const r=this._root.node.children;let i=0,n=0;for(;n<r.length&&e==null;)i=n++,e=r[i];for(;n<r.length;)if(r[n++])return-1;return i}_isDegenerate(e){return!YI(this.objectToBoundingSphere(e)[3])}_fitsInsideTree(e){const r=this._root.bounds,i=this._root.halfSize;return e[3]<=i&&e[0]>=r[0]-i&&e[0]<=r[0]+i&&e[1]>=r[1]-i&&e[1]<=r[1]+i&&e[2]>=r[2]-i&&e[2]<=r[2]+i}toJSON(){const{maximumDepth:e,maximumObjectsPerNode:r,_objectCount:i}=this,n=this._nodeToJSON(this._root.node);return{maximumDepth:e,maximumObjectsPerNode:r,objectCount:i,root:{bounds:this._root.bounds,halfSize:this._root.halfSize,depth:this._root.depth,node:n}}}_nodeToJSON(e){var s,o;const r=e.children.map(a=>a?this._nodeToJSON(a):null),i=(s=e.residents)==null?void 0:s.map(a=>this.objectToBoundingSphere(a)),n=(o=e.terminals)==null?void 0:o.map(a=>this.objectToBoundingSphere(a));return{children:r,residents:i,terminals:n}}static fromJSON(e){const r=new $z(i=>i,{maximumDepth:e.maximumDepth,maximumObjectsPerNode:e.maximumObjectsPerNode});return r._objectCount=e.objectCount,r._root.initFrom(e.root.node,e.root.bounds,e.root.halfSize,e.root.depth),r}},Qo=class qR{constructor(){this.bounds=us(),this.halfSize=0,this.initFrom(null,null,0,0)}init(e){return this.initFrom(e.node,e.bounds,e.halfSize,e.depth)}initFrom(e,r,i,n=this.depth){return this.node=e??qR.createEmptyNode(),r!=null&&LP(r,this.bounds),this.halfSize=i,this.depth=n,this}increaseHalfSize(e){this.halfSize*=e,this.updateBoundsRadiusFromHalfSize()}updateBoundsRadiusFromHalfSize(){this.bounds[3]=this.halfSize*k9e}advance(e){let r=this.node.children[e];r||(r=qR.createEmptyNode(),this.node.children[e]=r),this.node=r,this.halfSize/=2,this.depth++;const i=F9e[e];return this.bounds[0]+=i[0]*this.halfSize,this.bounds[1]+=i[1]*this.halfSize,this.bounds[2]+=i[2]*this.halfSize,this.updateBoundsRadiusFromHalfSize(),this}advanceTo(e,r,i=!1){for(;;){if(this.isTerminalFor(e))return r&&r(this,-1),!0;if(this.isLeaf()){if(!i)return r&&r(this,-1),!1;this.node.residents=null}const n=this._childIndex(e);r&&r(this,n),this.advance(n)}}isLeaf(){return this.node.residents!=null}isTerminalFor(e){return e[3]>this.halfSize/2}_childIndex(e){const r=this.bounds;return(r[0]<e[0]?1:0)+(r[1]<e[1]?2:0)+(r[2]<e[2]?4:0)}static createEmptyNode(){return{children:[null,null,null,null,null,null,null,null],terminals:new dr({shrink:!0}),residents:new dr({shrink:!0})}}static acquire(){return qR._pool.acquire()}static release(e){qR._pool.release(e)}static clearPool(){qR._pool.prune()}};function INt(t,e){t[0]=Math.min(t[0],e[0]-e[3]),t[1]=Math.min(t[1],e[1]-e[3]),t[2]=Math.min(t[2],e[2]-e[3])}function LNt(t,e){t[0]=Math.max(t[0],e[0]+e[3]),t[1]=Math.max(t[1],e[1]+e[3]),t[2]=Math.max(t[2],e[2]+e[3])}function h6(t,e,r){r[0]=t[0]+e,r[1]=t[1]+e,r[2]=t[2]+e}function Exe(t,e,r,i){if(e===1){const n=r(t[0]);LP(n,i)}else{Qd[0]=1/0,Qd[1]=1/0,Qd[2]=1/0,eh[0]=-1/0,eh[1]=-1/0,eh[2]=-1/0;for(let n=0;n<e;n++){const s=r(t[n]);YI(s[3])&&(INt(Qd,s),LNt(eh,s))}mi(i,Qd,eh,.5),i[3]=Math.max(eh[0]-Qd[0],eh[1]-Qd[1],eh[2]-Qd[2])/2}}function DNt(t,e,r){if(!iT.length)for(let i=0;i<8;++i)iT.push({index:0,distance:0});for(let i=0;i<8;++i){const n=F9e[i];iT.data[i].index=i,iT.data[i].distance=jb(t,e,n)}iT.sort((i,n)=>i.distance-n.distance);for(let i=0;i<8;++i)r[i]=iT.data[i].index}function BY(t,e){let r,i=1/0;for(let n=0;n<8;++n){const s=jb(t,e,Cxe[n]);s<i&&(i=s,r=Cxe[n])}return r}function jb(t,e,r){return e*(t[0]*r[0]+t[1]*r[1]+t[2]*r[2])}function YI(t){return!isNaN(t)&&t!==-1/0&&t!==1/0&&t>0}Qo._pool=new il(Qo),function(t){var e;(e=t.DepthOrder||(t.DepthOrder={}))[e.FRONT_TO_BACK=1]="FRONT_TO_BACK",e[e.BACK_TO_FRONT=-1]="BACK_TO_FRONT"}(ane||(ane={}));const F9e=[Ue(-1,-1,-1),Ue(1,-1,-1),Ue(-1,1,-1),Ue(1,1,-1),Ue(-1,-1,1),Ue(1,-1,1),Ue(-1,1,1),Ue(1,1,1)],Cxe=[Ue(-1,-1,-1),Ue(-1,-1,1),Ue(-1,1,-1),Ue(-1,1,1),Ue(1,-1,-1),Ue(1,-1,1),Ue(1,1,-1),Ue(1,1,1)],k9e=Math.sqrt(3),lne=[null];function NNt(t){return lne[0]=t,lne}const jY=us(),Bh=A(),Qd=A(),eh=A(),eS=new dr,FNt=us(),k0=us(),GY=us(),HY=us(),p6=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],iT=new dr,Rxe=[0,0,0,0,0,0,0,0],Vm=ane;var Vw;(function(t){t[t.ASYNC=0]="ASYNC",t[t.SYNC=1]="SYNC"})(Vw||(Vw={}));let U9e=class extends EF{get objects(){return this._objects}constructor(e,r,i=""){super(),this.stage=e,this.apiLayerUid=i,this.type=Wn.Layer,this.events=new pn,this.sliceable=!1,this._objects=new dr,this._objectsAdded=new dr,this._handles=new Ri,this.apiLayerUid=i,this.visible=(r==null?void 0:r.visible)??!0,this.pickable=(r==null?void 0:r.pickable)??!0,this.updatePolicy=(r==null?void 0:r.updatePolicy)??Vw.ASYNC,this._disableOctree=(r==null?void 0:r.disableOctree)??!1,e.add(this);for(const n of $Nt)this._handles.add(this.events.on(n,s=>e.handleEvent(n,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.remove(this),this.invalidateSpatialQueryAccelerator())}add(e){this._objects.push(e),e.parentLayer=this,this.events.emit("layerObjectAdded",{layer:this,object:e}),this._octree!=null&&this._objectsAdded.push(e)}remove(e){this._objects.removeUnordered(e)&&(e.parentLayer=null,this.events.emit("layerObjectRemoved",{layer:this,object:e}),this._octree!=null&&(this._objectsAdded.removeUnordered(e)||this._octree.remove([e])))}addMany(e){this._objects.pushArray(e);for(const r of e)r.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:e}),this._octree!=null&&this._objectsAdded.pushArray(e)}removeMany(e){const r=new Array;if(this._objects.removeUnorderedMany(e,e.length,r),r.length!==0){for(const i of r)i.parentLayer=null;if(this.events.emit("layerObjectsRemoved",{layer:this,objects:r}),this._octree!=null){for(let i=0;i<r.length;)this._objectsAdded.removeUnordered(r[i])?(r[i]=r[r.length-1],r.length-=1):++i;this._octree.remove(r)}}}sync(){this.updatePolicy!==Vw.SYNC&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,r){this._octree==null||this._objectsAdded.includes(e)||this._octree.update(e,r)}getSpatialQueryAccelerator(){return this._octree==null&&this._objects.length>50&&!this._disableOctree?(this._octree=new Vm(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):this._octree!=null&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear()),this._octree}shaderTransformationChanged(){this.invalidateSpatialQueryAccelerator(),this.events.emit("shaderTransformationChanged",this)}invalidateSpatialQueryAccelerator(){this._octree=qe(this._octree),this._objectsAdded.clear()}};function KB(t){return t!=null&&t.type===Wn.Layer}var wh,yE;(function(t){t[t.Draped=0]="Draped",t[t.Screen=1]="Screen",t[t.World=2]="World",t[t.COUNT=3]="COUNT"})(wh||(wh={})),function(t){t[t.Center=0]="Center",t[t.Tip=1]="Tip",t[t.COUNT=2]="COUNT"}(yE||(yE={}));let wa=class extends tl{constructor(){super(...arguments),this.output=q.Color,this.transparencyPassType=kt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.writeDepth=!1,this.space=wh.Screen,this.hideOnShortSegments=!1,this.hasCap=!1,this.anchor=yE.Center,this.hasTip=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}get draped(){return this.space===wh.Draped}};d([X({count:q.COUNT})],wa.prototype,"output",void 0),d([X({count:kt.COUNT})],wa.prototype,"transparencyPassType",void 0),d([X()],wa.prototype,"occluder",void 0),d([X()],wa.prototype,"hasSlicePlane",void 0),d([X()],wa.prototype,"writeDepth",void 0),d([X({count:wh.COUNT})],wa.prototype,"space",void 0),d([X()],wa.prototype,"hideOnShortSegments",void 0),d([X()],wa.prototype,"hasCap",void 0),d([X({count:yE.COUNT})],wa.prototype,"anchor",void 0),d([X()],wa.prototype,"hasTip",void 0),d([X()],wa.prototype,"vvSize",void 0),d([X()],wa.prototype,"vvColor",void 0),d([X()],wa.prototype,"vvOpacity",void 0),d([X()],wa.prototype,"hasOccludees",void 0),d([X()],wa.prototype,"hasMultipassTerrain",void 0),d([X()],wa.prototype,"cullAboveGround",void 0),d([X({constValue:!0})],wa.prototype,"hasVvInstancing",void 0),d([X({constValue:!0})],wa.prototype,"hasSliceTranslatedView",void 0);const Oxe=8;function z9e(t,e){const r=t.vertex;r.uniforms.add(new Ye("intrinsicWidth",i=>i.width)),e.vvSize?(t.attributes.add(O.SIZEFEATUREATTRIBUTE,"float"),r.uniforms.add(new ar("vvSizeMinSize",i=>i.vvSize.minSize),new ar("vvSizeMaxSize",i=>i.vvSize.maxSize),new ar("vvSizeOffset",i=>i.vvSize.offset),new ar("vvSizeFactor",i=>i.vvSize.factor)),r.code.add(T`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(t.attributes.add(O.SIZE,"float"),r.code.add(T`float getSize(){
return intrinsicWidth * size;
}`)),e.vvOpacity?(t.attributes.add(O.OPACITYFEATUREATTRIBUTE,"float"),r.constants.add("vvOpacityNumber","int",8),r.uniforms.add(new ru("vvOpacityValues",i=>i.vvOpacity.values,Oxe),new ru("vvOpacityOpacities",i=>i.vvOpacity.opacityValues,Oxe)),r.code.add(T`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):r.code.add(T`vec4 applyOpacity( vec4 color ){
return color;
}`),e.vvColor?(t.include(o_,e),t.attributes.add(O.COLORFEATUREATTRIBUTE,"float"),r.code.add(T`vec4 getColor(){
return applyOpacity(interpolateVVColor(colorFeatureAttribute));
}`)):(t.attributes.add(O.COLOR,"vec4"),r.code.add(T`vec4 getColor(){
return applyOpacity(color);
}`))}function V_(t,e){switch(t.fragment.include(Od),e.output){case q.Shadow:case q.ShadowHighlight:case q.ShadowExcludeHighlight:t.fragment.code.add(T`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
fragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case q.Depth:t.fragment.code.add(T`void outputDepth(float _linearDepth) {
fragColor = float2rgba(_linearDepth);
}`)}}let V9e=class{constructor(e,r,i){this._createTexture=e,this._parametersKey=r,this._repository=new Map,this._orphanCache=i.newCache(`procedural-texture-repository:${au()}`,n=>n.dispose())}destroy(){for(const[e,{texture:r}]of this._repository)r.dispose();this._repository.clear(),this._orphanCache.destroy()}swap(e,r=null){const i=this._acquire(e);return this.release(r),i}release(e){if(e==null)return;const r=this._parametersKey(e),i=this._repository.get(r);if(i&&(i.refCount--,i.refCount===0)){this._repository.delete(r);const{texture:n}=i,s=n.gpuMemoryUsage;this._orphanCache.put(r,n,s)}}_acquire(e){if(e==null)return null;const r=this._parametersKey(e),i=this._repository.get(r);if(i)return i.refCount++,i.texture;const n=this._orphanCache.pop(r)??this._createTexture(e),s=new kNt(n);return this._repository.set(r,s),n}},kNt=class{constructor(e){this.texture=e,this.refCount=1}};function UNt(t,e){return new V9e(r=>{const{encodedData:i,paddedPixels:n}=zNt(r),s=new Vr;return s.internalFormat=Yt.RGBA,s.width=n,s.height=1,s.wrapMode=ir.CLAMP_TO_EDGE,new Jt(t,s,i)},r=>`${r.pattern.join(",")}-r${r.pixelRatio}`,e)}function zNt(t){const e=spe(t),r=1/t.pixelRatio,i=B9e(t),n=j9e(t),s=(Math.floor(.5*(n-1))+.5)*r,o=[];let a=1;for(const m of e){for(let g=0;g<m;g++){const y=a*(Math.min(g,m-1-g)+.5)*r/s*.5+.5;o.push(y)}a=-a}const l=Math.round(e[0]/2),c=[...o.slice(l),...o.slice(0,l)],u=i+G9e,h=new Uint8Array(4*u);let f=4;for(const m of c)YN(m,h,f),f+=4;return h.copyWithin(0,f-4,f),h.copyWithin(f,4,8),{encodedData:h,paddedPixels:u}}function spe(t){return t.pattern.map(e=>Math.round(e*t.pixelRatio))}function B9e(t){if(t==null)return 1;const e=spe(t);return Math.floor(e.reduce((r,i)=>r+i))}function j9e(t){return spe(t).reduce((e,r)=>Math.max(e,r))}const G9e=2;function VNt(t){return t==null?Wy:t.length===4?t:Ki(BNt,t[0],t[1],t[2],1)}const BNt=wr();function H9e(t,e){t.constants.add("stippleAlphaColorDiscard","float",.001),t.constants.add("stippleAlphaHighlightDiscard","float",.5),e.stippleEnabled?jNt(t,e):GNt(t)}function jNt(t,e){const r=!(e.draped&&e.stipplePreferContinuous),{vertex:i,fragment:n}=t;n.include(Od),e.draped||(hg(i,e),i.uniforms.add(new Ye("worldToScreenPerDistanceRatio",(s,o)=>1/o.camera.perScreenPixelRatio)),i.code.add(T`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`)),t.varyings.add("vStippleDistance","float"),e.stippleRequiresClamp&&t.varyings.add("vStippleDistanceLimits","vec2"),e.stippleRequiresStretchMeasure&&t.varyings.add("vStipplePatternStretch","float"),i.code.add(T`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${qNt};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `),i.code.add(T`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`),i.code.add(T`
    if (segmentLengthPseudoScreen >= ${r?"patternLength":"1e4"}) {
  `),Z3(i,e),i.code.add(T`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${e.stippleRequiresStretchMeasure?T`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `),n.constants.add("stippleTexturePadding","float",G9e),n.uniforms.add(new Mt("stipplePatternTexture",s=>s.stippleTexture),new Ye("stipplePatternSDFNormalizer",s=>HNt(s.stipplePattern)),new Ye("stipplePatternPixelSizeInv",s=>1/ope(s))),n.code.add(T`float padStippleTexture(float u) {
float paddedTextureSize = float(textureSize(stipplePatternTexture, 0).x);
float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;
return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
}`),n.code.add(T`
    float getStippleSDF(out bool isClamped) {
      ${e.stippleRequiresClamp?T`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:T`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${e.stippleScaleWithLineWidth?T`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${e.stippleRequiresStretchMeasure?T`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:T`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${e.stippleScaleWithLineWidth?T`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:T`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `),e.stippleOffColorEnabled?(n.uniforms.add(new Cr("stippleOffColor",s=>VNt(s.stippleOffColor))),n.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):n.code.add(T`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function GNt(t){t.fragment.code.add(T`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)}function HNt(t){return t?(Math.floor(.5*(j9e(t)-1))+.5)/t.pixelRatio:1}function ope(t){const e=t.stipplePattern;return e?B9e(t.stipplePattern)/e.pixelRatio:1}const qNt=T.float(.4),A2=64,ape=A2/2,q9e=ape/5,WNt=A2/q9e,XNt=.25;function YNt(t,e){const r=z8e(t,A2,ape,q9e),i=new Vr;return i.internalFormat=Yt.RGBA,i.width=A2,i.height=A2,i.wrapMode=ir.CLAMP_TO_EDGE,new Jt(e,i,r)}function W9e(t,e){const{vertex:r,constants:i}=t;i.add("markerSizePerLineWidth","float",WNt),Z3(r,e),r.uniforms.get("markerScale")==null&&r.constants.add("markerScale","float",1),r.code.add(T`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`),e.space===wh.World&&(r.constants.add("maxSegmentLengthFraction","float",.45),r.uniforms.add(new Ye("perRenderPixelRatio",(n,s)=>s.camera.perRenderPixelRatio)),r.code.add(T`bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}
float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}`))}var Yp;(function(t){t[t.BUTT=0]="BUTT",t[t.SQUARE=1]="SQUARE",t[t.ROUND=2]="ROUND",t[t.COUNT=3]="COUNT"})(Yp||(Yp={}));let wn=class extends tl{constructor(){super(...arguments),this.output=q.Color,this.capType=Yp.BUTT,this.transparencyPassType=kt.NONE,this.occluder=!1,this.hasSlicePlane=!1,this.hasPolygonOffset=!1,this.writeDepth=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.roundJoins=!1,this.applyMarkerOffset=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.falloffEnabled=!1,this.innerColorEnabled=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.wireframe=!1,this.objectAndLayerIdColorInstanced=!1}};d([X({count:q.COUNT})],wn.prototype,"output",void 0),d([X({count:Yp.COUNT})],wn.prototype,"capType",void 0),d([X({count:kt.COUNT})],wn.prototype,"transparencyPassType",void 0),d([X()],wn.prototype,"occluder",void 0),d([X()],wn.prototype,"hasSlicePlane",void 0),d([X()],wn.prototype,"hasPolygonOffset",void 0),d([X()],wn.prototype,"writeDepth",void 0),d([X()],wn.prototype,"draped",void 0),d([X()],wn.prototype,"stippleEnabled",void 0),d([X()],wn.prototype,"stippleOffColorEnabled",void 0),d([X()],wn.prototype,"stippleScaleWithLineWidth",void 0),d([X()],wn.prototype,"stipplePreferContinuous",void 0),d([X()],wn.prototype,"roundJoins",void 0),d([X()],wn.prototype,"applyMarkerOffset",void 0),d([X()],wn.prototype,"vvSize",void 0),d([X()],wn.prototype,"vvColor",void 0),d([X()],wn.prototype,"vvOpacity",void 0),d([X()],wn.prototype,"falloffEnabled",void 0),d([X()],wn.prototype,"innerColorEnabled",void 0),d([X()],wn.prototype,"hasOccludees",void 0),d([X()],wn.prototype,"hasMultipassTerrain",void 0),d([X()],wn.prototype,"cullAboveGround",void 0),d([X()],wn.prototype,"wireframe",void 0),d([X({constValue:!0})],wn.prototype,"stippleRequiresClamp",void 0),d([X({constValue:!0})],wn.prototype,"stippleRequiresStretchMeasure",void 0),d([X({constValue:!0})],wn.prototype,"hasVvInstancing",void 0),d([X({constValue:!0})],wn.prototype,"hasSliceTranslatedView",void 0),d([X()],wn.prototype,"objectAndLayerIdColorInstanced",void 0);const QB=1;function ZNt(t){const e=new jr,{vertex:r,fragment:i}=e,n=t.hasMultipassTerrain&&(t.output===q.Color||t.output===q.Alpha);e.include(wF),e.include(z9e,t),e.include(H9e,t);const s=t.applyMarkerOffset&&!t.draped;s&&(r.uniforms.add(new Ye("markerScale",m=>m.markerScale)),e.include(W9e,{space:wh.World,draped:!1})),t.output===q.Depth&&e.include(V_,t),e.include(PF,t),gd(r,t),r.uniforms.add(new yn("inverseProjectionMatrix",(m,g)=>g.camera.inverseProjectionMatrix),new Yr("nearFar",(m,g)=>g.camera.nearFar),new Ye("miterLimit",m=>m.join!=="miter"?0:m.miterLimit),new Cr("viewport",(m,g)=>g.camera.fullViewport)),r.constants.add("LARGE_HALF_FLOAT","float",65500),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.SUBDIVISIONFACTOR,"float"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"vec3"),e.attributes.add(O.AUXPOS2,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),cx(e),n&&e.varyings.add("depth","float");const o=t.stippleEnabled&&t.stippleScaleWithLineWidth;o&&e.varyings.add("vLineSizeInv","float");const a=t.capType===Yp.ROUND,l=o||a;l&&e.varyings.add("vLineWidth","float");const c=t.innerColorEnabled||a;c&&e.varyings.add("vLineDistance","float");const u=t.stippleEnabled&&a,h=t.falloffEnabled||u;h&&e.varyings.add("vLineDistanceNorm","float"),a&&(e.varyings.add("vSegmentSDF","float"),e.varyings.add("vReverseSegmentSDF","float")),r.code.add(T`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`),r.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),wH(e),r.code.add(T`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${n?"depth = pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `),Z3(r,t),r.code.add(T`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${l?T`vLineWidth = lineWidth;`:""}
      ${o?T`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `),s&&r.code.add(T`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`),r.code.add(T`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`),(t.stippleEnabled||a)&&r.code.add(T`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${a?T`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `),r.code.add(T`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`),t.roundJoins?r.code.add(T`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${t.stippleEnabled?T`min(1.0, subdivisionFactor * ${T.float((QB+2)/(QB+1))})`:T`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):r.code.add(T`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);const f=t.capType!==Yp.BUTT;return r.code.add(T`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${f?T`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `),r.code.add(T`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${h||c?T`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${c?T`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${h?T`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `),a&&r.code.add(T`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`),t.stippleEnabled&&(t.draped?r.uniforms.add(new Ye("worldToScreenRatio",(m,g)=>1/g.screenToPCSRatio)):r.code.add(T`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(T`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),t.draped?r.code.add(T`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):r.code.add(T`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ye("stipplePatternPixelSize",m=>ope(m))),r.code.add(T`
      float patternLength = ${t.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `)),r.code.add(T`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${t.wireframe&&!t.draped?"pos.z -= 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `),n&&e.include(Mh,t),e.include(as,t),i.include(R0),i.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${n?"terrainDepthTest(gl_FragCoord, depth);":""}
  `),t.wireframe?i.code.add(T`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(a&&i.code.add(T`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${T.float(Ma)}) {
        discard;
      }
    `),u?i.code.add(T`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${T.float(Ma)}, stippleCoverage);
      `):i.code.add(T`float stippleAlpha = getStippleAlpha();`),i.uniforms.add(new Cr("intrinsicColor",m=>m.color)),t.output!==q.ObjectAndLayerIdColor&&i.code.add(T`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),i.code.add(T`vec4 color = intrinsicColor * vColor;`),t.innerColorEnabled&&(i.uniforms.add(new Cr("innerColor",m=>m.innerColor??m.color),new Ye("innerWidth",(m,g)=>m.innerWidth*g.camera.pixelRatio)),i.code.add(T`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),i.code.add(T`vec4 finalColor = blendStipple(color, stippleAlpha);`),t.falloffEnabled&&(i.uniforms.add(new Ye("falloff",m=>m.falloff)),i.code.add(T`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`))),i.code.add(T`
    ${t.output===q.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.float(Ma)}) {
      discard;
    }

    ${t.output===q.Alpha?T`fragColor = vec4(finalColor.a);`:""}
    ${t.output===q.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===q.Color&&t.transparencyPassType===kt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===q.Highlight?T`fragColor = vec4(1.0);`:""}
    ${t.output===q.Depth?T`outputDepth(linearDepth);`:""}
    ${t.output===q.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const JNt=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:QB,build:ZNt},Symbol.toStringTag,{value:"Module"})),lpe={func:Oi.LESS},ej={func:Oi.ALWAYS},m0={mask:255},X9e={mask:0},KNt=t=>({function:{func:Oi.NOTEQUAL,ref:t,mask:t},operation:{fail:cs.KEEP,zFail:cs.KEEP,zPass:cs.KEEP}}),QNt=t=>({function:{func:Oi.ALWAYS,ref:t,mask:t},operation:{fail:cs.KEEP,zFail:cs.KEEP,zPass:cs.REPLACE}}),Mx={function:{func:Oi.ALWAYS,ref:cu.OutlineVisualElementMask,mask:cu.OutlineVisualElementMask},operation:{fail:cs.KEEP,zFail:cs.KEEP,zPass:cs.ZERO}},vx={function:{func:Oi.ALWAYS,ref:cu.OutlineVisualElementMask,mask:cu.OutlineVisualElementMask},operation:{fail:cs.KEEP,zFail:cs.KEEP,zPass:cs.REPLACE}},Y9e={function:{func:Oi.EQUAL,ref:cu.OutlineVisualElementMask,mask:cu.OutlineVisualElementMask},operation:{fail:cs.KEEP,zFail:cs.KEEP,zPass:cs.KEEP}},Z9e={function:{func:Oi.NOTEQUAL,ref:cu.OutlineVisualElementMask,mask:cu.OutlineVisualElementMask},operation:{fail:cs.KEEP,zFail:cs.KEEP,zPass:cs.KEEP}},J9e=new Map([[O.POSITION,0],[O.SUBDIVISIONFACTOR,1],[O.UV0,2],[O.AUXPOS1,3],[O.AUXPOS2,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7],[O.OBJECTANDLAYERIDCOLOR,8]]);let K9e=class Q9e extends si{initializeProgram(e){return new Kr(e.rctx,Q9e.shader.get().build(this.configuration),J9e)}_makePipelineState(e,r){const i=this.configuration,n=e===kt.NONE,s=e===kt.FrontFace;return Qt({blending:i.output===q.Color||i.output===q.Alpha?n?bh:o1(e):null,depthTest:{func:Px(e)},depthWrite:n?i.writeDepth?fu:null:kH(e),colorWrite:hr,stencilWrite:i.hasOccludees?m0:null,stencilTest:i.hasOccludees?r?vx:Mx:null,polygonOffset:n||s?i.hasPolygonOffset?Axe:null:zH})}initializePipeline(){const e=this.configuration;if(e.occluder){const r=e.hasPolygonOffset?Axe:null;this._occluderPipelineTransparent=Qt({blending:bh,polygonOffset:r,depthTest:ej,depthWrite:null,colorWrite:hr,stencilWrite:null,stencilTest:Z9e}),this._occluderPipelineOpaque=Qt({blending:bh,polygonOffset:r,depthTest:ej,depthWrite:null,colorWrite:hr,stencilWrite:X9e,stencilTest:Y9e}),this._occluderPipelineMaskWrite=Qt({blending:null,polygonOffset:r,depthTest:lpe,depthWrite:null,colorWrite:null,stencilWrite:m0,stencilTest:vx})}return this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}get primitiveType(){return this.configuration.wireframe?Zt.LINES:Zt.TRIANGLE_STRIP}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===_e.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===_e.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};K9e.shader=new Jr(JNt,()=>le(()=>import("./RibbonLine.glsl-b41a7135.js"),[]));const Axe={factor:0,units:-4};var ku;(function(t){t[t.LEFT_JOIN_START=-2]="LEFT_JOIN_START",t[t.LEFT_JOIN_END=-1]="LEFT_JOIN_END",t[t.LEFT_CAP_START=-4]="LEFT_CAP_START",t[t.LEFT_CAP_END=-5]="LEFT_CAP_END",t[t.RIGHT_JOIN_START=2]="RIGHT_JOIN_START",t[t.RIGHT_JOIN_END=1]="RIGHT_JOIN_END",t[t.RIGHT_CAP_START=4]="RIGHT_CAP_START",t[t.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(ku||(ku={}));let rA=class extends Ax{constructor(e){super(e,new t4t),this._configuration=new wn,this._vertexAttributeLocations=J9e}isClosed(e,r){return tVe(this.parameters,e,r)}getConfiguration(e,r){this._configuration.output=e,this._configuration.draped=r.slot===_e.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null&&e!==q.Highlight;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.stippleScaleWithLineWidth=i&&this.parameters.stippleScaleWithLineWidth,this._configuration.stipplePreferContinuous=i&&this.parameters.stipplePreferContinuous,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.roundJoins=this.parameters.join==="round",this._configuration.capType=this.parameters.cap,this._configuration.applyMarkerOffset=this.parameters.markerParameters!=null&&i4t(this.parameters.markerParameters),this._configuration.hasPolygonOffset=this.parameters.hasPolygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.innerColorEnabled=this.parameters.innerWidth>0&&this.parameters.innerColor!=null,this._configuration.falloffEnabled=this.parameters.falloff>0,this._configuration.occluder=this.parameters.renderOccluded===gn.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.wireframe=this.parameters.wireframe,this._configuration}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(O.POSITION).data,l=e.vertexAttributes.get(O.SIZE);let c=this.parameters.width;if(this.parameters.vvSize){const y=e.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=Te(this.parameters.vvSize.offset[0]+y*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else l&&(c*=l.data[0]);const u=n[0],h=n[1],f=(c/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const _=a[y],b=a[y+1],w=u-_,x=h-b,S=a[y+3]-_,C=a[y+4]-b,E=Te((S*w+C*x)/(S*S+C*C),0,1),R=S*E-w,P=C*E-x,D=R*R+P*P;D<m&&(m=D,g=y/3)}m<f*f&&s(o.dist,o.normal,g,!1)}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!Kke(r))return void re.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes,l=a.get(O.POSITION).data;let c=this.parameters.width;if(this.parameters.vvSize){const w=a.get(O.SIZEFEATUREATTRIBUTE).data[0];c*=Te(this.parameters.vvSize.offset[0]+w*this.parameters.vvSize.factor[0],this.parameters.vvSize.minSize[0],this.parameters.vvSize.maxSize[0])}else a.has(O.SIZE)&&(c*=a.get(O.SIZE).data[0]);const u=i.camera,h=n4t;Eo(h,i.point);const f=c*u.pixelRatio/2+4*u.pixelRatio;se(n$[0],h[0]-f,h[1]+f,0),se(n$[1],h[0]+f,h[1]+f,0),se(n$[2],h[0]+f,h[1]-f,0),se(n$[3],h[0]-f,h[1]-f,0);for(let w=0;w<4;w++)if(!u.unprojectFromRenderScreen(n$[w],U0[w]))return;Rl(u.eye,U0[0],U0[1],WY),Rl(u.eye,U0[1],U0[2],XY),Rl(u.eye,U0[2],U0[3],YY),Rl(u.eye,U0[3],U0[0],ZY);let m=Number.MAX_VALUE,g=0;const y=eVe(this.parameters,a,e.indices)?l.length-2:l.length-5;for(let w=0;w<y;w+=3){Lc[0]=l[w]+r[12],Lc[1]=l[w+1]+r[13],Lc[2]=l[w+2]+r[14];const x=(w+3)%l.length;if(Dc[0]=l[x]+r[12],Dc[1]=l[x+1]+r[13],Dc[2]=l[x+2]+r[14],zi(WY,Lc)<0&&zi(WY,Dc)<0||zi(XY,Lc)<0&&zi(XY,Dc)<0||zi(YY,Lc)<0&&zi(YY,Dc)<0||zi(ZY,Lc)<0&&zi(ZY,Dc)<0)continue;if(u.projectToRenderScreen(Lc,rS),u.projectToRenderScreen(Dc,iS),rS[2]<0&&iS[2]>0){ve(Ig,Lc,Dc);const C=u.frustum,E=-zi(C[Ui.NEAR],Lc)/ye(Ig,C[Ui.NEAR]);ce(Ig,Ig,E),ge(Lc,Lc,Ig),u.projectToRenderScreen(Lc,rS)}else if(rS[2]>0&&iS[2]<0){ve(Ig,Dc,Lc);const C=u.frustum,E=-zi(C[Ui.NEAR],Dc)/ye(Ig,C[Ui.NEAR]);ce(Ig,Ig,E),ge(Dc,Dc,Ig),u.projectToRenderScreen(Dc,iS)}else if(rS[2]<0&&iS[2]<0)continue;rS[2]=0,iS[2]=0;const S=ode(S2(rS,iS,$xe),h);S<m&&(m=S,oe(Pxe,Lc),oe(Mxe,Dc),g=w/3)}const _=i.rayBegin,b=i.rayEnd;if(m<f*f){let w=Number.MAX_VALUE;if(n5e(S2(Pxe,Mxe,$xe),S2(_,b,s4t),tS)){ve(tS,tS,_);const x=We(tS);ce(tS,tS,1/x),w=x/Li(_,b)}o(w,tS,g,!1)}}get _layout(){const e=On().vec3f(O.POSITION).f32(O.SUBDIVISIONFACTOR).vec2f(O.UV0).vec3f(O.AUXPOS1).vec3f(O.AUXPOS2);return this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),he("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}createBufferWriter(){return new r4t(this._layout,this.parameters)}requiresSlot(e,r){return r===q.Color||r===q.Alpha||r===q.Highlight||r===q.Depth||r===q.ObjectAndLayerIdColor?e===_e.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===gn.OccludeAndTransparentStencil?e===_e.OPAQUE_MATERIAL||e===_e.OCCLUDER_MATERIAL||e===_e.TRANSPARENT_OCCLUDER_MATERIAL:r===q.Color||r===q.Alpha?e===(this.parameters.writeDepth?_e.TRANSPARENT_MATERIAL:_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===_e.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new e4t(e)}validateParameters(e){e.join!=="miter"&&(e.miterLimit=0),e.markerParameters!=null&&(e.markerScale=e.markerParameters.width/e.width)}},e4t=class extends Rx{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==q.Color&&this._output!==q.Alpha||this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(K9e,e)}},t4t=class extends $F{constructor(){super(...arguments),this.width=0,this.color=Np,this.join="miter",this.cap=Yp.BUTT,this.miterLimit=5,this.writeDepth=!0,this.hasPolygonOffset=!1,this.stippleTexture=null,this.stippleScaleWithLineWidth=!1,this.stipplePreferContinuous=!0,this.markerParameters=null,this.markerScale=1,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.isClosed=!1,this.falloff=0,this.innerWidth=0,this.hasOccludees=!1,this.wireframe=!1}},r4t=class{constructor(e,r){this._parameters=r,this.numJoinSubdivisions=0,this.vertexBufferLayout=e;const i=r.stipplePattern?1:0;switch(this._parameters.join){case"miter":case"bevel":this.numJoinSubdivisions=i;break;case"round":this.numJoinSubdivisions=QB+i}}_isClosed(e){return eVe(this._parameters,e.vertexAttributes,e.indices)}allocate(e){return this.vertexBufferLayout.createBuffer(e)}elementCount(e){const i=e.indices.get(O.POSITION).length/2+1,n=this._isClosed(e);let s=n?2:2*2;return s+=((n?i:i-1)-(n?0:1))*(2*this.numJoinSubdivisions+4),s+=2,this._parameters.wireframe&&(s=2+4*(s-2)),s}write(e,r,i,n,s){var B;const o=o4t,a=a4t,l=l4t,c=i.vertexAttributes.get(O.POSITION).data,u=i.indices&&i.indices.get(O.POSITION),h=(B=i.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:B.data;u&&u.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let f=1,m=0;this._parameters.vvSize?m=i.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.SIZE)&&(f=i.vertexAttributes.get(O.SIZE).data[0]);let g=[1,1,1,1],y=0;this._parameters.vvColor?y=i.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.COLOR)&&(g=i.vertexAttributes.get(O.COLOR).data);const _=he("enable-feature:objectAndLayerId-rendering")?i.objectAndLayerIdColor:null;let b=0;this._parameters.vvOpacity&&(b=i.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const w=c.length/3,x=new Float32Array(n.buffer),S=he("enable-feature:objectAndLayerId-rendering")?new Uint8Array(n.buffer):null,C=this.vertexBufferLayout.stride/4;let E=s*C;const R=E;let P=0;const D=h?(Z,M,$)=>P=h[$]:(Z,M,$)=>P+=Li(Z,M),L=he("enable-feature:objectAndLayerId-rendering"),k=(Z,M,$,N,j,J,K)=>{if(x[E++]=M[0],x[E++]=M[1],x[E++]=M[2],x[E++]=N,x[E++]=K,x[E++]=j,x[E++]=Z[0],x[E++]=Z[1],x[E++]=Z[2],x[E++]=$[0],x[E++]=$[1],x[E++]=$[2],x[E++]=this._parameters.vvSize?m:f,this._parameters.vvColor)x[E++]=y;else{const te=Math.min(4*J,g.length-4);x[E++]=g[te],x[E++]=g[te+1],x[E++]=g[te+2],x[E++]=g[te+3]}this._parameters.vvOpacity&&(x[E++]=b),L&&(_!=null&&(S[4*E]=_[0],S[4*E+1]=_[1],S[4*E+2]=_[2],S[4*E+3]=_[3]),E++)};E+=C,se(a,c[0],c[1],c[2]),e&&lt(a,a,e);const V=this._isClosed(i);if(V){const Z=c.length-3;se(o,c[Z],c[Z+1],c[Z+2]),e&&lt(o,o,e)}else se(l,c[3],c[4],c[5]),e&&lt(l,l,e),k(a,a,l,1,ku.LEFT_CAP_START,0,0),k(a,a,l,1,ku.RIGHT_CAP_START,0,0),oe(o,a),oe(a,l);const W=V?0:1,G=V?w:w-1;for(let Z=W;Z<G;Z++){const M=(Z+1)%w*3;se(l,c[M],c[M+1],c[M+2]),e&&lt(l,l,e),D(o,a,Z),k(o,a,l,0,ku.LEFT_JOIN_END,Z,P),k(o,a,l,0,ku.RIGHT_JOIN_END,Z,P);const $=this.numJoinSubdivisions;for(let N=0;N<$;++N){const j=(N+1)/($+1);k(o,a,l,j,ku.LEFT_JOIN_END,Z,P),k(o,a,l,j,ku.RIGHT_JOIN_END,Z,P)}k(o,a,l,1,ku.LEFT_JOIN_START,Z,P),k(o,a,l,1,ku.RIGHT_JOIN_START,Z,P),oe(o,a),oe(a,l)}V?(se(l,c[3],c[4],c[5]),e&&lt(l,l,e),P=D(o,a,G),k(o,a,l,0,ku.LEFT_JOIN_END,W,P),k(o,a,l,0,ku.RIGHT_JOIN_END,W,P)):(P=D(o,a,G),k(o,a,a,0,ku.LEFT_CAP_END,G,P),k(o,a,a,0,ku.RIGHT_CAP_END,G,P)),qY(x,R+C,x,R,C),E=qY(x,E-C,x,E,C),this._parameters.wireframe&&this._addWireframeVertices(n,R,E,C)}_addWireframeVertices(e,r,i,n){const s=new Float32Array(e.buffer,i*Float32Array.BYTES_PER_ELEMENT),o=new Float32Array(e.buffer,r*Float32Array.BYTES_PER_ELEMENT,i-r);let a=0;const l=c=>a=qY(o,c,s,a,n);for(let c=0;c<o.length-1;c+=2*n)l(c),l(c+2*n),l(c+1*n),l(c+2*n),l(c+1*n),l(c+3*n)}};function qY(t,e,r,i,n){for(let s=0;s<n;s++)r[i++]=t[e++];return i}function eVe(t,e,r){return tVe(t,e.get(O.POSITION).data,r?r.get(O.POSITION):null)}function tVe(t,e,r){return!!t.isClosed&&(r?r.length>2:e.length>6)}function i4t(t){return t.anchor===yE.Tip&&t.hideOnShortSegments&&t.placement==="begin-end"&&t.worldSpace}const Lc=A(),Dc=A(),Ig=A(),tS=A(),n4t=A(),rS=ua(),iS=ua(),Pxe=A(),Mxe=A(),$xe=fg(),s4t=fg(),o4t=A(),a4t=A(),l4t=A(),n$=[ua(),ua(),ua(),ua()],U0=[A(),A(),A(),A()],WY=oi(),XY=oi(),YY=oi(),ZY=oi();let cpe=class{constructor(e){this._originSR=e,this._origins=new Map,this._objects=new Map,this._gridSize=5e5,this._rootOriginId="root/"+au()}getOrigin(e){const r=this._origins.get(this._rootOriginId);if(r==null){const u=GB(e[0]+Math.random()-.5,e[1]+Math.random()-.5,e[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,u),u}const i=this._gridSize,n=Math.round(e[0]/i),s=Math.round(e[1]/i),o=Math.round(e[2]/i),a=`${n}/${s}/${o}`;let l=this._origins.get(a);const c=.5*i;if(ve(fa,e,r.vec3),fa[0]=Math.abs(fa[0]),fa[1]=Math.abs(fa[1]),fa[2]=Math.abs(fa[2]),fa[0]<c&&fa[1]<c&&fa[2]<c){if(l){const u=Math.max(...fa);if(ve(fa,e,l.vec3),fa[0]=Math.abs(fa[0]),fa[1]=Math.abs(fa[1]),fa[2]=Math.abs(fa[2]),Math.max(...fa)<u)return l}return r}return l||(l=GB(n*i,s*i,o*i,a),this._origins.set(a,l)),l}_drawOriginBox(e,r=nr(1,1,0,1)){const i=window.view,n=i._stage,s=r.toString();if(!this._objects.has(s)){this._material=new rA({width:2,color:r}),n.add(this._material);const m=new U9e(n,{pickable:!1}),g=new a1({castShadow:!1});n.add(g),m.add(g),this._objects.set(s,g)}const o=this._objects.get(s),a=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],l=a.length,c=new Array(3*l),u=new Array,h=.5*this._gridSize;for(let m=0;m<l;m++)c[3*m]=e[0]+(1&a[m]?h:-h),c[3*m+1]=e[1]+(2&a[m]?h:-h),c[3*m+2]=e[2]+(4&a[m]?h:-h),m>0&&u.push(m-1,m);Ni(c,this._originSR,0,c,i.renderSpatialReference,0,l);const f=new Us(this._material,[[O.POSITION,new ft(c,3,!0)]],[[O.POSITION,u]],null,Wn.Line);n.add(f),o.addGeometry(f)}get test(){const e=this;return{set gridSize(r){e._gridSize=r}}}};const fa=A();let rVe=class{constructor(e,r,i,n=null){this.rctx=e,this.sliceHelper=n,this.lastFrameCamera=new Bt,this.output=q.Color,this.renderOccludedMask=Ixe,this.bindParameters=new bH(r,i,n!=null?n.plane:null),this.bindParameters.alignPixelEnabled=!0}resetRenderOccludedMask(){this.renderOccludedMask=Ixe}},c4t=class extends rVe{constructor(e,r,i,n,s){super(e,i,n,s),this.offscreenRenderingHelper=r,this.sliceHelper=s,this.time=0}};const Ixe=gn.Occlude|gn.OccludeAndTransparent|gn.OccludeAndTransparentStencil;let ZI=class extends Bt{constructor(){super(...arguments),this._projectionMatrix=Me()}get projectionMatrix(){return this._projectionMatrix}};d([p()],ZI.prototype,"_projectionMatrix",void 0),d([p({readOnly:!0})],ZI.prototype,"projectionMatrix",null),ZI=d([I("esri.views.3d.webgl-engine.lib.CascadeCamera")],ZI);const Lxe=16;function upe(t){return Math.ceil(t/Lxe)*Lxe}var r3;(function(t){t[t.Highlight=0]="Highlight",t[t.Default=1]="Default"})(r3||(r3={}));let f6=class{constructor(){this.camera=new ZI,this.lightMat=Me()}},u4t=class{constructor(){this.maxNumCascadesHighQuality=4,this.maxNumCascadesLowQuality=4,this.textureSizeModHighQuality=1.3,this.textureSizeModLowQuality=.9,this.splitSchemeLambda=0}},dpe=class{get depthTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get textureSize(){return this._textureSize}get numCascades(){return this._numCascades}get cascadeDistances(){return Ki(this._usedCascadeDistances,this._cascadeDistances[0],this._numCascades>1?this._cascadeDistances[1]:1/0,this._numCascades>2?this._cascadeDistances[2]:1/0,this._numCascades>3?this._cascadeDistances[3]:1/0)}constructor(e,r){this._rctx=e,this._viewingMode=r,this._enabled=!1,this._snapshots=new Array,this._textureSize=0,this._numCascades=1,this.settings=new u4t,this._projectionView=Me(),this._projectionViewInverse=Me(),this._modelViewLight=Me(),this._cascadeDistances=[0,0,0,0,0],this._usedCascadeDistances=wr(),this._cascades=[new f6,new f6,new f6,new f6],this._lastOrigin=null,this._maxTextureSize=Math.min(he("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}dispose(){this.enabled=!1,this.disposeOffscreenBuffers()}disposeOffscreenBuffers(){this._fbo=pt(this._fbo),this._discardAllSnapshots()}set maxCascades(e){this.settings.maxNumCascadesHighQuality=Te(Math.floor(e),1,4)}get maxCascades(){return this.settings.maxNumCascadesHighQuality}set enabled(e){this._enabled=e,e||this.disposeOffscreenBuffers()}get enabled(){return this._enabled}get ready(){return this._enabled&&this.depthTexture!=null}getSnapshot(e){return this.enabled?this._snapshots[e]:null}get cascades(){for(let e=0;e<this._numCascades;++e)KY[e]=this._cascades[e];return KY.length=this._numCascades,KY}start(e,r,i,n,s){It(this.enabled),this._textureSize=this._computeTextureSize(e,s,n),this._ensureDepthTexture();const{near:o,far:a}=this._clampNearFar(i);this._computeCascadeDistances(a,o,n),this._setupMatrices(e,r);const{viewMatrix:l,projectionMatrix:c}=e;for(let u=0;u<this._numCascades;++u)this._constructCascade(u,c,l,r);this._lastOrigin=null,this.clear()}finish(e){It(this.enabled),this._rctx.bindFramebuffer(e)}getShadowMapMatrices(e){if(!this._lastOrigin||!gi(e,this._lastOrigin)){this._lastOrigin=this._lastOrigin||A(),oe(this._lastOrigin,e);for(let r=0;r<this._numCascades;++r){hu(zxe,this._cascades[r].lightMat,e);for(let i=0;i<16;++i)Vxe[16*r+i]=zxe[i]}}return Vxe}takeCascadeSnapshotTo(e,r){It(this.enabled);const i=this._ensureSnapshot(r);this._bindFbo();const n=this._rctx,s=n.bindTexture(i,Jt.TEXTURE_UNIT_FOR_UPDATES);n.gl.copyTexSubImage2D(qn.TEXTURE_2D,0,e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[0],e.camera.viewport[1],e.camera.viewport[2],e.camera.viewport[3]),n.bindTexture(s,Jt.TEXTURE_UNIT_FOR_UPDATES)}clear(){const e=this._rctx;this._bindFbo(),e.setClearColor(1,1,1,1),e.clearSafe(Qi.COLOR_BUFFER_BIT|Qi.DEPTH_BUFFER_BIT)}_computeTextureSize(e,r,i){const n=Math.min(window.devicePixelRatio,r)/e.pixelRatio,s=Math.max(e.fullWidth,e.fullHeight)*n,o=i?this.settings.textureSizeModHighQuality:this.settings.textureSizeModLowQuality;return Math.floor(Math.min(this._maxTextureSize,upe((this.numCascades===1?1:2)*s*o)))}_ensureDepthTexture(){var r,i;if(((r=this._fbo)==null?void 0:r.width)===this._textureSize)return;const e=new Vr(this._textureSize);e.wrapMode=ir.CLAMP_TO_EDGE,e.samplingMode=Kt.NEAREST,(i=this._fbo)==null||i.dispose(),this._fbo=new wo(this._rctx,e,new RB(Hs.DEPTH_COMPONENT16,this._textureSize))}_ensureSnapshot(e){let r=this._snapshots[e];if(r!=null&&r.descriptor.width===this._textureSize)return r;this._discardSnapshot(e);const i=new Vr;return i.wrapMode=ir.CLAMP_TO_EDGE,i.samplingMode=Kt.NEAREST,i.width=this._textureSize,i.height=this._textureSize,r=new Jt(this._rctx,i),this._snapshots[e]=r,r}_discardSnapshot(e){this._snapshots[e]=pt(this._snapshots[e])}_discardAllSnapshots(){for(let e=0;e<this._snapshots.length;++e)this._discardSnapshot(e);this._snapshots.length=0}_bindFbo(){const e=this._rctx;e.unbindTexture(this.depthTexture),e.bindFramebuffer(this._fbo)}_constructCascade(e,r,i,n){const s=this._cascades[e],o=-this._cascadeDistances[e],a=-this._cascadeDistances[e+1],l=(r[10]*o+r[14])/Math.abs(r[11]*o+r[15]),c=(r[10]*a+r[14])/Math.abs(r[11]*a+r[15]);It(l<c);for(let m=0;m<8;++m){Ki(Dxe,m%4==0||m%4==3?-1:1,m%4==0||m%4==1?-1:1,m<4?l:c,1);const g=wp[m];hh(g,Dxe,this._projectionViewInverse),g[0]/=g[3],g[1]/=g[3],g[2]/=g[3]}Nl(JY,wp[0]),s.camera.viewMatrix=hu(d4t,this._modelViewLight,JY);for(let m=0;m<8;++m)lt(wp[m],wp[m],s.camera.viewMatrix);let u=wp[0][2],h=wp[0][2];for(let m=1;m<8;++m)u=Math.min(u,wp[m][2]),h=Math.max(h,wp[m][2]);u-=200,h+=200,s.camera.near=-h,s.camera.far=-u,m4t(i,n,u,h,s.camera),Ii(s.lightMat,s.camera.projectionMatrix,s.camera.viewMatrix);const f=this._textureSize/(this.numCascades===1?1:2);s.camera.viewport=[e%2==0?0:f,Math.floor(e/2)===0?0:f,f,f]}_setupMatrices(e,r){Ii(this._projectionView,e.projectionMatrix,e.viewMatrix),Uo(this._projectionViewInverse,this._projectionView);const i=this._viewingMode===at.Global?e.eye:se(JY,0,0,1);M7(this._modelViewLight,[0,0,0],[-r[0],-r[1],-r[2]],i)}_clampNearFar(e){let{near:r,far:i}=e;return r<2&&(r=2),i<2&&(i=2),r>=i&&(r=2,i=4),{near:r,far:i}}_computeCascadeDistances(e,r,i){const n=i?this.settings.maxNumCascadesHighQuality:this.settings.maxNumCascadesLowQuality;this._numCascades=Math.min(1+Math.floor($Ct(e/r,4)),n);const s=(e-r)/this._numCascades,o=(e/r)**(1/this._numCascades);let a=r,l=r;for(let c=0;c<this._numCascades+1;++c)this._cascadeDistances[c]=Xt(a,l,this.settings.splitSchemeLambda),a*=o,l+=s}get gpuMemoryUsage(){var e;return this._snapshots.reduce((r,i)=>r+((i==null?void 0:i.gpuMemoryUsage)??0),((e=this._fbo)==null?void 0:e.gpuMemoryUsage)??0)}get test(){return{cascades:this._cascades,textureSize:this._textureSize}}};const d4t=Me(),Dxe=wr(),wp=[];for(let t=0;t<8;++t)wp.push(wr());const Nxe=Qe(),Fxe=Qe(),h4t=Qe(),kxe=Qe(),Uxe=Qe(),JY=A(),KY=[],zxe=Me(),Vxe=new Array(64),Dd=Qe(),IC=Qe(),nS=[Qe(),Qe(),Qe(),Qe()],Ro=Qe(),QY=Qe(),D1=Qe(),s$=Qe(),LC=Qe(),DC=Qe(),m6=Qe();function p4t(t,e,r,i,n,s,o,a){Or(Dd,0,0);for(let C=0;C<4;++C)Tp(Dd,Dd,t[C]);eu(Dd,Dd,.25),Or(IC,0,0);for(let C=4;C<8;++C)Tp(IC,IC,t[C]);eu(IC,IC,.25),ih(nS[0],t[4],t[5],.5),ih(nS[1],t[5],t[6],.5),ih(nS[2],t[6],t[7],.5),ih(nS[3],t[7],t[4],.5);let l=0,c=ug(nS[0],Dd);for(let C=1;C<4;++C){const E=ug(nS[C],Dd);E<c&&(c=E,l=C)}os(Ro,nS[l],t[l+4]);const u=Ro[0];let h,f;Ro[0]=-Ro[1],Ro[1]=u,os(QY,IC,Dd),Mn(QY,Ro)<0&&Nde(Ro,Ro),ih(Ro,Ro,QY,r),BP(Ro,Ro),h=f=Mn(os(D1,t[0],Dd),Ro);for(let C=1;C<8;++C){const E=Mn(os(D1,t[C],Dd),Ro);E<h?h=E:E>f&&(f=E)}Eo(i,Dd),eu(D1,Ro,h-e),Tp(i,i,D1);let m=-1,g=1,y=0,_=0;for(let C=0;C<8;++C){os(s$,t[C],i),BP(s$,s$);const E=Ro[0]*s$[1]-Ro[1]*s$[0];E>0?E>m&&(m=E,y=C):E<g&&(g=E,_=C)}mC(m>0,"leftArea"),mC(g<0,"rightArea"),eu(LC,Ro,h),Tp(LC,LC,Dd),eu(DC,Ro,f),Tp(DC,DC,Dd),m6[0]=-Ro[1],m6[1]=Ro[0];const b=Rk(i,t[_],DC,Tp(D1,DC,m6),1,n),w=Rk(i,t[y],DC,D1,1,s),x=Rk(i,t[y],LC,Tp(D1,LC,m6),1,o),S=Rk(i,t[_],LC,D1,1,a);mC(b,"rayRay"),mC(w,"rayRay"),mC(x,"rayRay"),mC(S,"rayRay")}function Ur(t,e){return 3*e+t}const Bxe=Qe();function xu(t,e){return Or(Bxe,t[e],t[e+3]),Bxe}const Nc=Qe(),St=vn();function f4t(t,e,r,i,n){os(Nc,r,i),eu(Nc,Nc,.5),St[0]=Nc[0],St[1]=Nc[1],St[2]=0,St[3]=Nc[1],St[4]=-Nc[0],St[5]=0,St[6]=Nc[0]*Nc[0]+Nc[1]*Nc[1],St[7]=Nc[0]*Nc[1]-Nc[1]*Nc[0],St[8]=1,St[Ur(0,2)]=-Mn(xu(St,0),t),St[Ur(1,2)]=-Mn(xu(St,1),t);let s=Mn(xu(St,0),r)+St[Ur(0,2)],o=Mn(xu(St,1),r)+St[Ur(1,2)],a=Mn(xu(St,0),i)+St[Ur(0,2)],l=Mn(xu(St,1),i)+St[Ur(1,2)];s=-(s+a)/(o+l),St[Ur(0,0)]+=St[Ur(1,0)]*s,St[Ur(0,1)]+=St[Ur(1,1)]*s,St[Ur(0,2)]+=St[Ur(1,2)]*s,s=1/(Mn(xu(St,0),r)+St[Ur(0,2)]),o=1/(Mn(xu(St,1),r)+St[Ur(1,2)]),St[Ur(0,0)]*=s,St[Ur(0,1)]*=s,St[Ur(0,2)]*=s,St[Ur(1,0)]*=o,St[Ur(1,1)]*=o,St[Ur(1,2)]*=o,St[Ur(2,0)]=St[Ur(1,0)],St[Ur(2,1)]=St[Ur(1,1)],St[Ur(2,2)]=St[Ur(1,2)],St[Ur(1,2)]+=1,s=Mn(xu(St,1),e)+St[Ur(1,2)],o=Mn(xu(St,2),e)+St[Ur(2,2)],a=Mn(xu(St,1),r)+St[Ur(1,2)],l=Mn(xu(St,2),r)+St[Ur(2,2)],s=-.5*(s/o+a/l),St[Ur(1,0)]+=St[Ur(2,0)]*s,St[Ur(1,1)]+=St[Ur(2,1)]*s,St[Ur(1,2)]+=St[Ur(2,2)]*s,s=Mn(xu(St,1),e)+St[Ur(1,2)],o=Mn(xu(St,2),e)+St[Ur(2,2)],a=-o/s,St[Ur(1,0)]*=a,St[Ur(1,1)]*=a,St[Ur(1,2)]*=a,n[0]=St[0],n[1]=St[1],n[2]=0,n[3]=St[2],n[4]=St[3],n[5]=St[4],n[6]=0,n[7]=St[5],n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=St[6],n[13]=St[7],n[14]=0,n[15]=St[8]}function m4t(t,e,r,i,n){const s=1/wp[0][3],o=1/wp[4][3];It(s<o);let a=s+Math.sqrt(s*o);const l=Math.sin(Vo(t[2]*e[0]+t[6]*e[1]+t[10]*e[2]));a/=l,p4t(wp,a,l,Nxe,Fxe,h4t,kxe,Uxe),f4t(Nxe,Fxe,kxe,Uxe,n.projectionMatrix),n.projectionMatrix[10]=2/(r-i),n.projectionMatrix[14]=-(r+i)/(r-i)}function g4t(t){return mg(t)&&t.intersector===Sn.TERRAIN&&!!t.target}let y4t=class extends nH{constructor(e,r,i){super(e,r),this.triangleNr=i}};function iVe(t){return mg(t)&&t.intersector===Sn.OVERLAY&&!!t.target}let cne=class{constructor(){this.adds=new dr,this.removes=new dr,this.updates=new dr({allocator:e=>e||new v4t,deallocator:e=>(e.renderGeometry=null,e)})}clear(){this.adds.clear(),this.removes.clear(),this.updates.clear()}prune(){this.adds.prune(),this.removes.prune(),this.updates.prune()}get empty(){return this.adds.length===0&&this.removes.length===0&&this.updates.length===0}},v4t=class{},_4t=class{constructor(){this.adds=new Array,this.removes=new Array,this.updates=new Array}};var An,Lo;(function(t){t[t.ADD=0]="ADD",t[t.UPDATE=1]="UPDATE",t[t.REMOVE=2]="REMOVE"})(An||(An={})),function(t){t[t.NONE=0]="NONE",t[t.VISIBILITY=1]="VISIBILITY",t[t.GEOMETRY=2]="GEOMETRY",t[t.TRANSFORMATION=4]="TRANSFORMATION",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.OCCLUDEE=16]="OCCLUDEE"}(Lo||(Lo={}));function nVe(t){const e=new Map,r=i=>{let n=e.get(i);return n||(n=new _4t,e.set(i,n)),n};return t.removes.forAll(i=>{eZ(i)&&r(i.material).removes.push(i)}),t.adds.forAll(i=>{eZ(i)&&r(i.material).adds.push(i)}),t.updates.forAll(i=>{eZ(i.renderGeometry)&&r(i.renderGeometry.material).updates.push(i)}),e}function eZ(t){return t.geometry.indexCount>=1}let sVe=class{constructor(e,r){this._material=e,this._repository=r,this._map=new Map}destroy(){this._map.forEach((e,r)=>{e!=null&&this._repository.release(this._material,r)})}load(e,r,i){if(!this._material.requiresSlot(r,i))return null;this._map.has(i)||this._map.set(i,this._repository.acquire(this._material,r,i));const n=this._map.get(i);if(n!=null){if(n.ensureResources(e)===i_.LOADED)return n;this._repository.requestRender()}return null}};function kF(t,e){switch(e.normalType){case ei.Compressed:t.attributes.add(O.NORMALCOMPRESSED,"vec2"),t.vertex.code.add(T`vec3 normalModel() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
return vec3(normalCompressed + sign(normalCompressed) * min(z, 0.0), z);
}`);break;case ei.Attribute:t.attributes.add(O.NORMAL,"vec3"),t.vertex.code.add(T`vec3 normalModel() {
return normal;
}`);break;case ei.ScreenDerivative:t.fragment.code.add(T`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:e.normalType;case ei.COUNT:case ei.Ground:}}var ei;(function(t){t[t.Attribute=0]="Attribute",t[t.Compressed=1]="Compressed",t[t.Ground=2]="Ground",t[t.ScreenDerivative=3]="ScreenDerivative",t[t.COUNT=4]="COUNT"})(ei||(ei={}));function KH(t,e){switch(e.normalType){case ei.Attribute:case ei.Compressed:t.include(kF,e),t.varyings.add("vNormalWorld","vec3"),t.varyings.add("vNormalView","vec3"),t.vertex.uniforms.add(new BN("transformNormalGlobalFromModel",r=>r.transformNormalGlobalFromModel),new xf("transformNormalViewFromGlobal",r=>r.transformNormalViewFromGlobal)),t.vertex.code.add(T`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case ei.Ground:t.include(OA,e),t.varyings.add("vNormalWorld","vec3"),t.vertex.code.add(T`
        void forwardNormal() {
          vNormalWorld = ${e.spherical?T`normalize(vPositionWorldCameraRelative);`:T`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case ei.ScreenDerivative:t.vertex.code.add(T`void forwardNormal() {}`);break;default:e.normalType;case ei.COUNT:}}let oVe=class extends k6e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=vn()}},aVe=class extends U6e{constructor(){super(...arguments),this.transformNormalGlobalFromModel=vn(),this.toMapSpace=wr()}},une=class extends aVe{constructor(e=A()){super(),this.origin=e,this.slicePlaneLocalOrigin=this.origin}},J3=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(O.POSITION).length}write(e,r,i,n,s){$8e(i,this.vertexBufferLayout,e,r,n,s)}};const b4t=On().vec3f(O.POSITION),w4t=On().vec3f(O.POSITION).vec2f(O.UV0),x4t=On().vec3f(O.POSITION).vec4u8(O.COLOR);On().vec3f(O.POSITION).vec4u8(O.OBJECTANDLAYERIDCOLOR);const S4t=On().vec3f(O.POSITION).vec2f(O.UV0).vec4u8(O.OBJECTANDLAYERIDCOLOR);On().vec3f(O.POSITION).vec4u8(O.COLOR).vec4u8(O.OBJECTANDLAYERIDCOLOR);let hpe=class extends Ax{intersect(e,r,i,n,s,o){return b8e(e,i,n,s,void 0,o)}};function T4t(t){t.fragment.code.add(T`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)}function E4t(t){t.fragment.code.add(T`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)}let UF=class extends Zn{constructor(e,r){super(e,"int",Ci.Pass,(i,n,s)=>i.setUniform1i(e,r(n,s)))}},C4t=class extends Zn{constructor(e,r,i){super(e,"mat4",Ci.Draw,(n,s,o,a)=>n.setUniformMatrix4fv(e,r(s,o,a)),i)}},R4t=class extends Zn{constructor(e,r,i){super(e,"mat4",Ci.Pass,(n,s,o)=>n.setUniformMatrix4fv(e,r(s,o)),i)}},O4t=class extends Ai{constructor(){super(...arguments),this.origin=A()}},A4t=class extends O4t{},P4t=class extends Ai{constructor(){super(...arguments),this.modelTransformation=bo}},ppe=class extends P4t{constructor(){super(...arguments),this.origin=A()}};function QH(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new R4t("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),lVe(t))}function vE(t,e){e.receiveShadows&&(t.fragment.uniforms.add(new C4t("shadowMapMatrix",(r,i)=>i.shadowMap.getShadowMapMatrices(r.origin),4)),lVe(t))}function lVe(t){const e=t.fragment;e.include(Od),e.uniforms.add(new Mt("shadowMapTex",(r,i)=>i.shadowMap.depthTexture),new UF("numCascades",(r,i)=>i.shadowMap.numCascades),new Cr("cascadeDistances",(r,i)=>i.shadowMap.cascadeDistances)),e.code.add(T`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + (numCascades == 1 ? 1.0 : 0.5) * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float texSize, sampler2D _depthTex) {
float halfPixelSize = 0.5 / texSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, float(textureSize(shadowMapTex, 0).x), shadowMapTex);
}`)}function jxe(t){t.fragment.uniforms.add(new Mt("texWaveNormal",e=>e.waveNormal),new Mt("texWavePerturbation",e=>e.wavePertubation),new Cr("waveParams",e=>Ki(M4t,e.waveStrength,e.waveTextureRepeat,e.flowStrength,e.flowOffset)),new Yr("waveDirection",e=>Or($4t,e.waveDirection[0]*e.waveVelocity,e.waveDirection[1]*e.waveVelocity))),t.include(T4t),t.fragment.code.add(T`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)}const M4t=wr(),$4t=Qe();function t4(t,e){e.spherical?t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):t.vertex.code.add(T`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`),e.spherical?t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):t.vertex.code.add(T`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)}function I4t(t){const e=t.fragment.code;e.add(T`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.add(T`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.add(T`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)}function fpe(t,e){const r=t.fragment.code;t.include(wF),e.pbrMode!==Nt.Normal&&e.pbrMode!==Nt.Schematic&&e.pbrMode!==Nt.Terrain&&e.pbrMode!==Nt.TerrainWithWater||(r.add(T`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),r.add(T`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),e.pbrMode!==Nt.Normal&&e.pbrMode!==Nt.Schematic||(t.include(I4t),r.add(T`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),r.add(T`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),r.add(T`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),r.add(T`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`))}function L4t(t,e){const r=t.fragment.code;t.include(wF),r.add(T`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${e.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),r.add(T`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),r.add(T`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),r.add(T`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),r.add(T`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)}function cVe(t,e){t.include(L4t,e),t.include(vH),t.include(E4t),e.hasCloudsReflections&&t.include(b6e,e),e.hasScreenSpaceReflections&&t.include(WRt,e);const r=t.fragment;r.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3e5).add("ssrHeightFadeEnd","float",5e5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]),r.code.add(T`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`),r.uniforms.add(new Ye("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new Ye("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)),r.code.add(T`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`),e.hasCloudsReflections&&r.code.add(T`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y * cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`),e.hasScreenSpaceReflections?(r.uniforms.add(new yn("view",(i,n)=>n.ssr.camera.viewMatrix),new Mt("lastFrameColorTexture",(i,n)=>n.ssr.lastFrameColorTexture),new Ye("fadeFactorSSR",(i,n)=>n.ssr.fadeFactor)),r.code.add(T`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactorSSR;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):r.code.add(T`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`),e.hasCloudsReflections?e.hasScreenSpaceReflections?r.code.add(T`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):r.code.add(T`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):r.code.add(T`return waterRenderedColor;
}`)}function D4t(t){const e=new jr,{vertex:r,fragment:i}=e;gd(r,t),e.include(nu,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2");const n=new Cr("waterColor",s=>s.color);if(t.output===q.Color&&t.isDraped)return e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(Ma)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(n),i.code.add(T`void main() {
fragColor = waterColor;
}`),e;switch(t.output!==q.Color&&t.output!==q.Alpha||(e.include(t4,t),e.include(H3,t),e.varyings.add("vuv","vec2"),e.varyings.add("vpos","vec3"),e.varyings.add("vnormal","vec3"),e.varyings.add("vtbnMatrix","mat3"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.uniforms.add(n),r.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Ma)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${t.output===q.Color?"forwardLinearDepth();":""}
      }
    `)),e.include(Mh,t),t.output){case q.Alpha:e.include(as,t),i.uniforms.add(n),i.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          fragColor = vec4(waterColor.a);
        }
      `);break;case q.Color:e.include(TB),e.include(Wde,{pbrMode:Nt.Disabled,lightingSphericalHarmonicsOrder:2}),e.include(jxe),e.include(as,t),e.include(vE,t),e.include(cVe,t),i.uniforms.add(n,new Ye("timeElapsed",s=>s.timeElapsed),r.uniforms.get("view"),r.uniforms.get("localOrigin")),hg(i,t),i.include(R0),J_(i),C0(i),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${t.receiveShadows?T`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        fragColor = delinearizeGamma(final);
        fragColor = highlightSlice(fragColor, vpos);
        ${t.transparencyPassType===kt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `);break;case q.Normal:e.include(t4,t),e.include(jxe,t),e.include(as,t),e.varyings.add("vpos","vec3"),e.varyings.add("vuv","vec2"),r.uniforms.add(n),r.code.add(T`
        void main(void) {
          if (waterColor.a < ${T.float(Ma)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),i.uniforms.add(new Ye("timeElapsed",s=>s.timeElapsed)),i.code.add(T`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
fragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case q.Highlight:e.include(s1,t),e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Ma)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),e.include(as,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`);break;case q.ObjectAndLayerIdColor:e.include(PF,t),e.varyings.add("vpos","vec3"),r.uniforms.add(n),r.code.add(T`
      void main(void) {
        if (waterColor.a < ${T.float(Ma)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
        forwardObjectAndLayerIdColor();
      }
    `),e.include(as,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputObjectAndLayerIdColor();
}`)}return e}const N4t=Object.freeze(Object.defineProperty({__proto__:null,build:D4t},Symbol.toStringTag,{value:"Module"}));let uVe=class dVe extends si{initializeConfiguration(e,r){r.spherical=e.viewingMode===at.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Kr(e.rctx,dVe.shader.get().build(this.configuration),Br)}_setPipelineState(e){const r=this.configuration,i=e===kt.NONE,n=e===kt.FrontFace;return Qt({blending:r.output!==q.Normal&&r.output!==q.Highlight&&r.output!==q.ObjectAndLayerIdColor&&r.transparent?i?bh:o1(e):null,depthTest:{func:Px(e)},depthWrite:i?r.writeDepth?fu:null:kH(e),colorWrite:hr,polygonOffset:i||n?null:VH(r.enableOffset)})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};uVe.shader=new Jr(N4t,()=>le(()=>import("./WaterSurface.glsl-5cc825fe.js"),[]));let Ho=class extends tl{constructor(){super(...arguments),this.output=q.Color,this.transparencyPassType=kt.NONE,this.spherical=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!1,this.hasScreenSpaceReflections=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasCloudsReflections=!1,this.objectAndLayerIdColorInstanced=!1,this.isDraped=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}};d([X({count:q.COUNT})],Ho.prototype,"output",void 0),d([X({count:kt.COUNT})],Ho.prototype,"transparencyPassType",void 0),d([X()],Ho.prototype,"spherical",void 0),d([X()],Ho.prototype,"receiveShadows",void 0),d([X()],Ho.prototype,"hasSlicePlane",void 0),d([X()],Ho.prototype,"transparent",void 0),d([X()],Ho.prototype,"enableOffset",void 0),d([X()],Ho.prototype,"writeDepth",void 0),d([X()],Ho.prototype,"hasScreenSpaceReflections",void 0),d([X()],Ho.prototype,"doublePrecisionRequiresObfuscation",void 0),d([X()],Ho.prototype,"hasCloudsReflections",void 0),d([X()],Ho.prototype,"objectAndLayerIdColorInstanced",void 0),d([X()],Ho.prototype,"isDraped",void 0),d([X()],Ho.prototype,"hasMultipassTerrain",void 0),d([X()],Ho.prototype,"cullAboveGround",void 0),d([X({constValue:Nt.Water})],Ho.prototype,"pbrMode",void 0),d([X({constValue:!0})],Ho.prototype,"useCustomDTRExponentForWater",void 0),d([X({constValue:!0})],Ho.prototype,"highStepCount",void 0),d([X({constValue:!1})],Ho.prototype,"useFillLights",void 0);let F4t=class extends Rx{_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})}_updateSSRState(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})}_updateCloudsReflectionState(e){const r=e.cloudsFade.data!=null;r!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:r})}ensureResources(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)}beginSlot(e){return this._output===q.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e)),this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters),this.ensureTechnique(uVe,e)}},hVe=class extends hpe{constructor(e){super(e,new pVe),this._configuration=new Ho,this.animation=new pUe}getConfiguration(e,r){return this._configuration.output=e,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections,this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections,this._configuration.isDraped=this.parameters.isDraped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<UH,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}update(e){const r=Math.min(e.camera.relativeElevation,e.camera.distance);this.animation.enabled=Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*r<k4t;const i=this.animation.advance(e);return this.setParameters({timeElapsed:lce(this.animation.time)*this.parameters.animationSpeed},!1),this.animation.enabled&&i}requiresSlot(e,r){switch(r){case q.Normal:return e===_e.DRAPED_WATER;case q.Color:if(this.parameters.isDraped)return e===_e.DRAPED_MATERIAL;break;case q.Alpha:break;case q.Highlight:case q.ObjectAndLayerIdColor:return e===_e.OPAQUE_MATERIAL||e===_e.DRAPED_MATERIAL;default:return!1}let i=_e.OPAQUE_MATERIAL;return this.parameters.transparent&&(i=this.parameters.writeDepth?_e.TRANSPARENT_MATERIAL:_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),e===i}createGLMaterial(e){return new F4t(e)}createBufferWriter(){return new J3(he("enable-feature:objectAndLayerId-rendering")?S4t:w4t)}},pVe=class extends Mhe{constructor(){super(...arguments),this.waveStrength=.06,this.waveTextureRepeat=32,this.waveDirection=Nr(1,0),this.waveVelocity=.05,this.flowStrength=.015,this.flowOffset=-.5,this.animationSpeed=.35,this.timeElapsed=0,this.color=nr(0,0,0,0),this.transparent=!0,this.writeDepth=!0,this.hasSlicePlane=!1,this.isDraped=!1,this.receiveShadows=!0,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.origin=A(),this.modelTransformation=null}};const k4t=35e3;let mpe=class{constructor(e=0,r=0){this.from=e,this.to=r}get numElements(){return this.to-this.from}};function Gxe(t){const e=new Map;t.forAll(i=>e.set(i.from,i));let r=!0;for(;r;)r=!1,t.forEach(i=>{const n=e.get(i.to);n&&(i.to=n.to,e.delete(n.from),t.removeUnordered(n),r=!0)})}let Hxe=class extends mpe{constructor(e,r,i){super(r,i),this.geometry=e}get isVisible(){return this.geometry.visible}get hasHighlights(){return this.geometry.highlights!=null&&this.isVisible}get hasOccludees(){return this.geometry.occludees!=null}},U4t=class{constructor(){this.first=0,this.count=0}},z4t=class{constructor(){this._numElements=0,this._instances=new Map,this.holes=new dr({allocator:e=>e||new mpe,deallocator:null}),this.hasHiddenInstances=!1,this.hasHighlights=!1,this.hasOccludees=!1,this.drawCommandsDirty=!0,this.drawCommandsDefault=g6(),this.drawCommandsHighlight=g6(),this.drawCommandsOccludees=g6(),this.drawCommandsShadowHighlightRest=g6()}get numElements(){return this._numElements}get instances(){return this._instances}addInstance(e,r){this.deleteInstance(e),this._instances.set(e,r),this._numElements+=r.numElements}deleteInstance(e){const r=this._instances.get(e);r&&(this._numElements-=r.numElements,this._instances.delete(e))}updateInstance(e,r,i){const n=this._instances.get(e);n&&(this._numElements-=n.numElements,n.from=r,n.to=i,this._numElements+=n.numElements)}updateDrawState(e){e.isVisible?(e.hasHighlights&&(this.hasHighlights=!0),e.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0}updateDrawCommands(e){if(this.drawCommandsDefault.clear(),this.drawCommandsHighlight.clear(),this.drawCommandsOccludees.clear(),this.drawCommandsShadowHighlightRest.clear(),this.drawCommandsDirty=!1,this._instances.size===0)return;if(!this.needsMultipleCommands()){const i=this.drawCommandsDefault.pushNew(),n=this.holes.front();return this.vao!=null&&this.holes.length===1&&n.to===Math.floor(this.vao.byteSize/e)?(i.first=0,void(i.count=n.from)):(i.first=1/0,i.count=0,this._instances.forEach(s=>{i.first=Math.min(i.first,s.from),i.count=Math.max(i.count,s.to)}),void(i.count-=i.first))}const r=Array.from(this._instances.values()).sort((i,n)=>i.from===n.from?i.to-n.to:i.from-n.from);for(const i of r)i.isVisible&&(qxe(i.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,i),qxe(i.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,i))}needsMultipleCommands(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances}};function V4t(t){return t.vao!=null}function g6(){return new dr({allocator:t=>t||new U4t,deallocator:t=>t})}function qxe(t,e){const r=t.back();if(r==null){const i=t.pushNew();return i.first=e.from,void(i.count=e.numElements)}if(B4t(r,e)){const i=e.from-r.first+e.numElements;r.count=i}else{const i=t.pushNew();i.first=e.from,i.count=e.numElements}}function B4t(t,e){return t.first+t.count>=e.from}let j4t=class{constructor(e){this.origin=e,this.buffers=new Array}dispose(){this.buffers.forEach(e=>e.vao.dispose()),this.buffers.length=0}findBuffer(e){return this.buffers.find(r=>r.instances.has(e))}};const Iz=-3;var Fv;(function(t){t[t.ALL=0]="ALL",t[t.SOME=1]="SOME"})(Fv||(Fv={}));let G4t=class{constructor(e,r,i){this.name=e,this._storage=r,this.id=H4t+++":",this.size=0,this.maxSize=0,this._removeFunc=!1,this._hit=0,this._miss=0,this._storage.register(this),i&&(this._storage.registerRemoveFunc(this.id,i),this._removeFunc=!0)}destroy(){this._storage.clear(this),this._removeFunc&&this._storage.deregisterRemoveFunc(this.id),this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get sizeAll(){return this._storage.size}resetHitRate(){this._hit=this._miss=0}put(e,r,i,n=0){this._storage.put(this,e,r,i,n)}get(e){const r=this._storage.get(this,e);return r===void 0?++this._miss:++this._hit,r}pop(e){const r=this._storage.pop(this,e);return r===void 0?++this._miss:++this._hit,r}updateSize(e,r,i){this._storage.updateSize(this,e,r,i)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}},fVe=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._removeFuncs=new dr,this._users=new dr}destroy(){this.clearAll(),this._removeFuncs.clear(),this._users.clear(),this._db=null}register(e){this._users.push(e)}deregister(e){this._users.removeUnordered(e)}registerRemoveFunc(e,r){this._removeFuncs.push([e,r])}deregisterRemoveFunc(e){this._removeFuncs.filterInPlace(r=>r[0]!==e)}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,0),this._checkSizeLimits()}put(e,r,i,n,s){r=e.id+r;const o=this._db.get(r);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(r),o.entry!==i&&this._notifyRemove(r,o.entry,Fv.ALL)),n>this._maxSize)return void this._notifyRemove(r,i,Fv.ALL);if(i===void 0)return void console.warn("Refusing to cache undefined entry ");if(!n||n<0)return void console.warn("Refusing to cache entry with invalid size "+n);const a=1+Math.max(s,Iz)-Iz;this._db.set(r,{entry:i,size:n,lifetime:a,lives:a}),this._size+=n,e.size+=n,this._checkSizeLimits()}updateSize(e,r,i,n){r=e.id+r;const s=this._db.get(r);if(s&&s.entry===i){for(this._size-=s.size,e.size-=s.size;n>this._maxSize;){const o=this._notifyRemove(r,i,Fv.SOME);if(!(o!=null&&o>0))return void this._db.delete(r);n=o}s.size=n,this._size+=n,e.size+=n,this._checkSizeLimits()}}pop(e,r){r=e.id+r;const i=this._db.get(r);if(i)return this._size-=i.size,e.size-=i.size,this._db.delete(r),++this._hit,i.entry;++this._miss}get(e,r){r=e.id+r;const i=this._db.get(r);if(i!==void 0)return this._db.delete(r),i.lives=i.lifetime,this._db.set(r,i),++this._hit,i.entry;++this._miss}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},r={},i=new Array;this._db.forEach((o,a)=>{const l=o.lifetime;i[l]=(i[l]||0)+o.size,this._users.forAll(c=>{const{id:u,name:h}=c;if(a.startsWith(u)){const f=r[h]||0;r[h]=f+o.size}})});const n={};this._users.forAll(o=>{const a=o.name;if("hitRate"in o&&typeof o.hitRate=="number"&&!isNaN(o.hitRate)&&o.hitRate>0){const l=r[a]||0;r[a]=l,n[a]=Math.round(100*o.hitRate)+"%"}else n[a]="0%"});const s=Object.keys(r);s.sort((o,a)=>r[a]-r[o]),s.forEach(o=>e[o]=Math.round(r[o]/2**20)+"MB / "+n[o]);for(let o=i.length-1;o>=0;--o){const a=i[o];a&&(e["Priority "+(o+Iz-1)]=Math.round(a/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forAll(e=>e.resetHitRate())}clear(e){const r=e.id;this._db.forEach((i,n)=>{n.startsWith(r)&&(this._size-=i.size,this._db.delete(n),this._notifyRemove(n,i.entry,Fv.ALL))}),e.size=0}clearAll(){this._db.forEach((e,r)=>this._notifyRemove(r,e.entry,Fv.ALL)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,r,i){let n;return this._removeFuncs.some(s=>{if(e.startsWith(s[0])){const o=s[1](r,i);return typeof o=="number"&&(n=o),!0}return!1}),n}_checkSizeLimits(){if(this._size>this._maxSize){for(const[e,r]of this._db)if(this._purgeItem(e,r),this._size<=.9*this.maxSize)return}this._users.forEach(e=>{if(e.maxSize>0&&e.size>e.maxSize){for(const[r,i]of this._db)if(r.startsWith(e.id)&&(this._purgeItem(r,i,e),e.size<=.9*e.maxSize))return}})}_purgeItem(e,r,i=this._users.find(n=>e.startsWith(n.id))){if(this._db.delete(e),r.lives<=1){this._size-=r.size,i&&(i.size-=r.size);const n=this._notifyRemove(e,r.entry,Fv.SOME);n!=null&&n>0&&(this._size+=n,i&&(i.size+=n),r.lives=r.lifetime,r.size=n,this._db.set(e,r))}else--r.lives,this._db.set(e,r)}},H4t=0;const q4t=Iz+1;let W4t=class{constructor(e,r,i){this._rctx=e,this._locations=r,this._layout=i,this._cache=e.newCache("VaoCache",X4t)}dispose(){this._cache.destroy()}newVao(e){const r=e.toString(),i=this._cache.pop(r);if(i!=null){const s=i.pop();return i.length>0&&this._cache.put(r,i,e*i.length,q4t),s}const n=new gg(this._rctx,this._locations,{geometry:this._layout},{geometry:ci.createVertex(this._rctx,qr.STATIC_DRAW)});return n.vertexBuffers.geometry.setSize(e),n}deleteVao(e){if(e==null)return null;const r=e.byteSize,i=r.toString(),n=this._cache.pop(i);return n!=null?(n.push(e),this._cache.put(i,n,r*n.length,-1)):this._cache.put(i,[e],r,-1),null}};function X4t(t,e){if(e===Fv.ALL)return void t.forEach(n=>n.dispose());const r=t.pop(),i=t.length*r.byteSize;return r.dispose(),i}let mVe=class{constructor(e,r,i){this._rctx=e,this._materialRepository=r,this.material=i,this._dataByOrigin=new Map,this._hasHighlights=!1,this._hasOccludees=!1,this._glMaterials=new sVe(this.material,this._materialRepository),this._bufferWriter=i.createBufferWriter(),this._vaoCache=new W4t(e,i.vertexAttributeLocations,Ad(this._bufferWriter.vertexBufferLayout))}dispose(){this._glMaterials.destroy(),this._dataByOrigin.forEach(e=>e.dispose()),this._dataByOrigin.clear(),this._vaoCache.dispose()}get isEmpty(){return this._dataByOrigin.size===0}get hasHighlights(){return this._hasHighlights}get hasOccludees(){return this._hasOccludees}get hasWater(){return!this.isEmpty&&this.material instanceof hVe}get rendersOccluded(){return!this.isEmpty&&this.material.renderOccluded!==gn.Occlude}get numGeometries(){let e=0;return this._dataByOrigin.forEach(r=>e+=r.buffers.reduce((i,n)=>i+n.instances.size,0)),e}forEachGeometry(e){this._dataByOrigin.forEach(r=>r.buffers.forEach(i=>i.instances.forEach(n=>e(n.geometry))))}modify(e){this._updateGeometries(e.updates),this._addAndRemoveGeometries(e.adds,e.removes),this._updateDrawCommands()}_updateGeometries(e){const r=this._bufferWriter,i=r.vertexBufferLayout.stride/4;for(const n of e){const s=n.renderGeometry,o=this._dataByOrigin.get(s.localOrigin.id),a=o==null?void 0:o.findBuffer(s.id);if(a==null)return;const l=a.instances.get(s.id);if(n.updateType&(Lo.GEOMETRY|Lo.TRANSFORMATION)){const c=b6(r.elementCount(l.geometry.geometry)*i),u=r.vertexBufferLayout.createView(c.buffer);this._writeGeometry(s,u,0),a.vao.vertexBuffers.geometry.setSubData(c,l.from*i,0,l.numElements*i),w6()}n.updateType&(Lo.HIGHLIGHT|Lo.OCCLUDEE|Lo.VISIBILITY)&&(a.drawCommandsDirty=!0)}}_computeDeltas(e,r){const i=new W3;for(const n of e){const s=n.localOrigin;if(s==null)continue;let o=i.get(s.id,null);o==null&&(o=new Wxe(s.vec3),i.set(s.id,null,o)),o.changes.push(n)}for(const n of r){const s=n.localOrigin;if(s==null)continue;const o=this._dataByOrigin.get(s.id),a=o==null?void 0:o.findBuffer(n.id);if(a==null)continue;let l=i.get(s.id,a);l==null&&(l=new Wxe(s.vec3),i.set(s.id,a,l)),l.changes.push(n)}return i}_addAndRemoveGeometries(e,r){const{_bufferWriter:i,_dataByOrigin:n}=this,s=i.vertexBufferLayout.stride/4,o=this._computeDeltas(e,r);o.forEach((a,l)=>{const c=a.get(null),u=c!=null?c.changes:[];o.delete(l,null);let h=n.get(l);if(a.forEach((f,m)=>{if(o.delete(l,m),m==null)return void It(!1,"No VAO for removed geometries");if(m.instances.size===f.changes.length)return this._vaoCache.deleteVao(m.vao),fN(h.buffers,m),void(h.buffers.length===0&&u.length===0&&n.delete(l));const g=m.numElements,y=m.vao.byteSize/4,_=u.reduce((S,C)=>S+i.elementCount(C.geometry),0),b=f.changes.reduce((S,C)=>S+i.elementCount(C.geometry),0),w=Math.min((g+_-b)*s,_6),x=w>y;w>tj&&w<y/2?(f.changes.forEach(({id:S})=>m.deleteInstance(S)),m.instances.forEach(({geometry:S})=>u.push(S)),this._vaoCache.deleteVao(m.vao),fN(h.buffers,m)):x?this._applyAndRebuild(m,u,f):this._applyRemoves(m,f)}),u.length>0)for(h==null&&(h=new j4t(c.origin),n.set(l,h)),h.buffers.forEach(f=>this._applyAdds(f,u));u.length>0;)h.buffers.push(this._applyAndRebuild(new z4t,u,null))})}_updateDrawCommands(){this._hasHighlights=!1,this._hasOccludees=!1,this._dataByOrigin.forEach(e=>{e.buffers.forEach(r=>{r.drawCommandsDirty&&(r.hasHiddenInstances=!1,r.hasHighlights=!1,r.hasOccludees=!1,Pa(r.instances,i=>(r.updateDrawState(i),r.hasHiddenInstances&&r.hasHighlights&&r.hasOccludees)),r.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride)),this._hasHighlights=this._hasHighlights||r.hasHighlights,this._hasOccludees=this._hasOccludees||r.hasOccludees})})}_applyAndRebuild(e,r,i){if(i!=null)for(const g of i.changes)e.deleteInstance(g.id);const n=this._bufferWriter,s=n.vertexBufferLayout.stride,o=s/4,a=Math.floor(_6/o);let l=e.numElements;for(;r.length>0;){const g=r.pop(),y=n.elementCount(g.geometry);if(l+y>a&&l>0){r.push(g);break}l+=y;const _=new Hxe(g,0,0);It(e.instances.get(g.id)==null),e.addInstance(g.id,_)}const c=l*o,u=b6(c),h=n.vertexBufferLayout.createView(u.buffer);let f=0;e.hasHiddenInstances=!1,e.hasHighlights=!1,e.hasOccludees=!1,e.instances.forEach((g,y)=>{this._writeGeometry(g.geometry,h,f);const _=f;f+=n.elementCount(g.geometry.geometry),e.updateInstance(y,_,f),e.updateDrawState(g)}),this._vaoCache.deleteVao(e.vao),e.vao=this._vaoCache.newVao(Zxe(c)),e.vao.vertexBuffers.geometry.setSubData(u,0,0,f*o),w6(),e.holes.clear();const m=e.holes.pushNew();return m.from=f,m.to=Math.floor(e.vao.byteSize/s),e.updateDrawCommands(s),e}_applyRemoves(e,r){if(r.changes.length===0)return;for(const a of r.changes){const l=a.id,c=e.instances.get(l);if(!c)continue;e.deleteInstance(l);const u=Lg.back();if(u){if(u.to===c.from){u.to=c.to;continue}if(u.from===c.to){u.from=c.from;continue}}const h=Lg.pushNew();h.from=c.from,h.to=c.to}Gxe(Lg);const i=this._bufferWriter.vertexBufferLayout.stride/4,n=Lg.reduce((a,l)=>Math.max(a,l.numElements),0)*i,s=b6(n);s.fill(0,0,n);const o=e.vao.vertexBuffers.geometry;Lg.forAll(a=>o.setSubData(s,a.from*i,0,a.numElements*i)),w6(),e.holes.pushArray(Lg.data,Lg.length),Lg.forAll((a,l)=>Lg.data[l]=null),Lg.clear(),e.drawCommandsDirty=!0}_applyAdds(e,r){if(r.length===0)return;if(!V4t(e))return void this._applyAndRebuild(e,r,null);const i=this._bufferWriter,n=i.vertexBufferLayout.stride/4,s=e.numElements,o=r.reduce((b,w)=>b+i.elementCount(w.geometry),0),a=Math.min((s+o)*n,_6),l=4*a;if(e.vao.byteSize<Zxe(_6-tj)&&l>e.vao.byteSize)return void this._applyAndRebuild(e,r,null);Gxe(e.holes);const c=new Array;for(const b of r){const w=i.elementCount(b.geometry),x=Y4t(e.holes,w);c.push(x)}const u=e.vao.vertexBuffers.geometry;let h=0,f=0,m=0;const g=b6(a),y=i.vertexBufferLayout.createView(g.buffer);r.forEach((b,w)=>{const x=c[w];if(x==null)return;if(m!==x){const E=m-f;E>0&&u.setSubData(g,f*n,0,E*n),f=x,h=0}const S=i.elementCount(b.geometry);this._writeGeometry(b,y,h),h+=S,m=x+S;const C=new Hxe(b,x,x+S);It(e.instances.get(b.id)==null),e.addInstance(b.id,C),e.drawCommandsDirty=!0});const _=m-f;_>0&&u.setSubData(g,f*n,0,_*n),qct(r,(b,w)=>c[w]==null),w6()}_writeGeometry(e,r,i){const n=e.localOrigin.vec3;ICt(Xxe,-n[0],-n[1],-n[2]);const s=Ii(Z4t,Xxe,e.transformation);Uo(y6,s),Td(y6,y6),this._bufferWriter.write(s,y6,e.geometry,r,i)}updateAnimation(e){return this.material.update(e)}requiresSlot(e,r){return this.material.requiresSlot(e,r)}prepareTechnique(e){const{output:r,bindParameters:i}=e;if(!this.requiresSlot(i.slot,r))return null;const n=r===q.Highlight||r===q.ShadowHighlight;if(n&&!this._hasHighlights)return null;const s=r===q.ShadowExcludeHighlight,o=!(n||s);for(const a of this._dataByOrigin.values())for(const l of a.buffers){if(n&&!l.hasHighlights)continue;const c=(n?l.drawCommandsHighlight:s&&l.needsMultipleCommands()?l.drawCommandsShadowHighlightRest:l.drawCommandsDefault)||null,u=o&&l.drawCommandsOccludees||null;if(c!=null&&c.length||u!=null&&u.length){const h=this._glMaterials.load(e.rctx,i.slot,r),f=h!=null?h.beginSlot(i):null;if(f!=null)return f}}return null}render(e,r){var c;const{output:i,bindParameters:n}=e,s=i===q.Highlight||i===q.ShadowHighlight,o=i===q.ShadowExcludeHighlight,a=!(s||o),l=this._rctx;(c=l.appleAmdDriverHelper)==null||c.resetIndicesType(),l.bindTechnique(r,this.material.parameters,n);for(const u of this._dataByOrigin.values())for(const h of u.buffers){if(s&&!h.hasHighlights)continue;const f=(s?h.drawCommandsHighlight:o&&h.needsMultipleCommands()?h.drawCommandsShadowHighlightRest:h.drawCommandsDefault)||null,m=a&&h.drawCommandsOccludees||null;(f!=null&&f.length||m!=null&&m.length)&&(r.program.bindDraw(new une(u.origin),n,this.material.parameters),r.ensureAttributeLocations(h.vao),l.bindVAO(h.vao),f!=null&&f.length&&(r.bindPipelineState(l,n.slot,!1),f.forAll(g=>l.drawArrays(r.primitiveType,g.first,g.count))),m!=null&&m.length&&(r.bindPipelineState(l,n.slot,!0),m.forAll(g=>l.drawArrays(r.primitiveType,g.first,g.count))))}}get test(){return{material:this.material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}},Wxe=class{constructor(e){this.origin=e,this.changes=new Array}};function Y4t(t,e){let r;if(!t.some(n=>!(n.numElements<e)&&(r=n,!0)))return null;const i=r.from;return r.from+=e,r.from>=r.to&&t.removeUnordered(r),i}const Xxe=Me(),Z4t=Me(),y6=Me(),Lg=new dr({allocator:t=>t||new mpe,deallocator:null}),tj=65536,v6=4*tj,Yxe=1024,gVe=16777216,_6=gVe/4;let Lz=new Float32Array(tj);function b6(t){return Lz.length<t&&(Lz=new Float32Array(t)),Lz}function Zxe(t){const e=4*t;return e<=Yxe?Yxe:e<v6?v6:Math.max(Math.min(Math.ceil(1.5*e/v6)*v6,gVe),e)}function w6(){Lz=new Float32Array(2)}let Wd=class extends Ce{constructor(e){super(e),this._pending=new J4t,this._changes=new cne,this._materialRenderers=new Map,this._sortedMaterialRenderers=new dr,this._geometries=new Map,this._hasHighlights=!1,this._hasWater=!1}destroy(){this._changes.prune(),this._materialRenderers.forEach(e=>e.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear(),this._geometries.clear(),this._pending.clear()}get updating(){return!this._pending.empty||this._changes.updates.length>0}get rctx(){return this.rendererContext.rctx}get _materialRepository(){return this.rendererContext.materialRepository}get _localOriginFactory(){return this.rendererContext.localOriginFactory}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return Pa(this._materialRenderers,e=>e.rendersOccluded)}get isEmpty(){return!this.updating&&this._materialRenderers.size===0&&this._geometries.size===0}commitChanges(){if(!this.updating)return!1;this._processAddsRemoves();const e=nVe(this._changes);let r=!1,i=!1,n=!1;return e.forEach((s,o)=>{let a=this._materialRenderers.get(o);if(!a&&s.adds.length>0&&(a=new mVe(this.rctx,this._materialRepository,o),this._materialRenderers.set(o,a),r=!0,i=!0,n=!0),!a)return;const l=i||a.hasHighlights,c=n||a.hasWater;a.modify(s),i=i||l!==a.hasHighlights,n=n||c!==a.hasWater,a.isEmpty&&(this._materialRenderers.delete(o),a.dispose(),r=!0)}),this._changes.clear(),r&&this._updateSortedMaterialRenderers(),i&&(this._hasHighlights=Pa(this._materialRenderers,s=>s.hasHighlights)),n&&(this._hasWater=Pa(this._materialRenderers,s=>s.hasWater)),this.notifyChange("updating"),!0}addGeometries(e,r){if(e.length===0)return;const i=this._validateRenderGeometries(e);for(const s of i)this._geometries.set(s.id,s);const n=this._pending.empty;for(const s of i)this._pending.adds.add(s);n&&this.notifyChange("updating"),r===An.UPDATE&&this._notifyGraphicGeometryChanged(e)}removeGeometries(e,r){const i=this._pending.empty,n=this._pending.adds;for(const s of e)n.has(s)?(this._pending.removed.add(s),n.delete(s)):this._pending.removed.has(s)||this._pending.removes.add(s),this._geometries.delete(s.id);i&&!this._pending.empty&&this.notifyChange("updating"),r===An.UPDATE&&this._notifyGraphicGeometryChanged(e)}modifyGeometries(e,r){const i=this._changes.updates.length===0;for(const n of e){const s=this._changes.updates.pushNew();s.renderGeometry=this._validateRenderGeometry(n),s.updateType=r}switch(i&&this._changes.updates.length>0&&this.notifyChange("updating"),r){case Lo.TRANSFORMATION:case Lo.GEOMETRY:return this._notifyGraphicGeometryChanged(e);case Lo.VISIBILITY:return this._notifyGraphicVisibilityChanged(e)}}updateAnimation(e){let r=!1;return this._sortedMaterialRenderers.forAll(i=>r=i.updateAnimation(e)||r),r}render(e){this._sortedMaterialRenderers.forAll(r=>{if(r.material.shouldRender(e)){const i=r.prepareTechnique(e);i!=null&&r.render(e,i)}})}intersect(e,r,i,n,s){return this._geometries.forEach(o=>{if(n&&!n(o))return;this._intersectRenderGeometry(o,i,r,0,e,s);const a=this.rendererContext.longitudeCyclical;a&&(o.boundingSphere[0]-o.boundingSphere[3]<a.min&&this._intersectRenderGeometry(o,i,r,a.range,e,s),o.boundingSphere[0]+o.boundingSphere[3]>a.max&&this._intersectRenderGeometry(o,i,r,-a.range,e,s)),s++}),s}_updateSortedMaterialRenderers(){this._sortedMaterialRenderers.clear();let e=0;this._materialRenderers.forEach((r,i)=>{i.insertOrder=e++,this._sortedMaterialRenderers.push(r)}),this._sortedMaterialRenderers.sort((r,i)=>{const n=i.material.renderPriority-r.material.renderPriority;return n!==0?n:r.material.insertOrder-i.material.insertOrder})}_processAddsRemoves(){this._changes.adds.clear(),this._changes.removes.clear(),this._changes.adds.pushArray(Array.from(this._pending.adds)),this._changes.removes.pushArray(Array.from(this._pending.removes));for(let e=0;e<this._changes.updates.length;){const r=this._changes.updates.data[e];this._pending.has(r.renderGeometry)?this._changes.updates.removeUnorderedIndex(e):e++}this._pending.clear()}_intersectRenderGeometry(e,r,i,n,s,o){if(!e.visible)return;let a=0;n+=e.transformation[12],a=e.transformation[13],tZ[0]=i[0]-n,tZ[1]=i[1]-a,e.screenToWorldRatio=this.rendererContext.screenToWorldRatio,e.material.intersectDraped(e,null,s,tZ,(l,c,u)=>{K4t(r,u,e.material.renderPriority,o,s,e.layerUid,e.graphicUid)},r)}_notifyGraphicGeometryChanged(e){if(this.drapeSource.notifyGraphicGeometryChanged==null)return;let r;for(const i of e){const n=i.graphicUid;n!=null&&n!==r&&(this.drapeSource.notifyGraphicGeometryChanged(n),r=n)}}_notifyGraphicVisibilityChanged(e){if(this.drapeSource.notifyGraphicVisibilityChanged==null)return;let r;for(const i of e){const n=i.graphicUid;n!=null&&n!==r&&(this.drapeSource.notifyGraphicVisibilityChanged(n),r=n)}}_validateRenderGeometries(e){for(const r of e)this._validateRenderGeometry(r);return e}_validateRenderGeometry(e){return e.localOrigin==null&&(e.localOrigin=this._localOriginFactory.getOrigin(e.boundingSphere)),e}get test(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}};d([p()],Wd.prototype,"drapeSource",void 0),d([p()],Wd.prototype,"updating",null),d([p()],Wd.prototype,"rctx",null),d([p()],Wd.prototype,"rendererContext",void 0),d([p()],Wd.prototype,"_materialRepository",null),d([p()],Wd.prototype,"_localOriginFactory",null),d([p({readOnly:!0})],Wd.prototype,"isEmpty",null),d([p()],Wd.prototype,"_materialRenderers",void 0),d([p()],Wd.prototype,"_geometries",void 0),Wd=d([I("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],Wd);let J4t=class{constructor(){this.adds=new Set,this.removes=new Set,this.removed=new Set}get empty(){return this.adds.size===0&&this.removes.size===0&&this.removed.size===0}has(e){return this.adds.has(e)||this.removes.has(e)||this.removed.has(e)}clear(){this.adds.clear(),this.removes.clear(),this.removed.clear()}};function K4t(t,e,r,i,n,s,o){const a=new y4t(s,o,e),l=c=>{c.set(Sn.OVERLAY,a,t.dist,t.normal,t.transformation,r,i)};if((n.results.min.drapedLayerOrder==null||r>=n.results.min.drapedLayerOrder)&&(n.results.min.dist==null||n.results.ground.dist<=n.results.min.dist)&&l(n.results.min),n.options.store!==Ia.MIN&&(n.results.max.drapedLayerOrder==null||r<n.results.max.drapedLayerOrder)&&(n.results.max.dist==null||n.results.ground.dist>n.results.max.dist)&&l(n.results.max),n.options.store===Ia.ALL){const c=yde(n.ray);l(c),n.results.all.push(c)}}const tZ=Qe();let gpe=class extends Zn{constructor(e,r){super(e,"vec2",Ci.Draw,(i,n,s,o)=>i.setUniform2fv(e,r(n,s,o)))}};const rZ=4;function Q4t(){const t=new jr,e=t.fragment;t.include(wf);const r=(rZ+1)/2,i=1/(2*r*r);return e.include(Ph),e.uniforms.add(new Mt("depthMap",n=>n.depthTexture),new Wp("tex",n=>n.colorTexture),new gpe("blurSize",n=>n.blurSize),new Ye("projScale",(n,s)=>{const o=Li(s.camera.eye,s.camera.center);return o>5e4?Math.max(0,n.projScale-(o-5e4)):n.projScale}),new Yr("nearFar",(n,s)=>s.camera.nearFar)),e.code.add(T`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${T.float(i)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.code.add(T`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${T.int(rZ)}; r <= ${T.int(rZ)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      fragColor = vec4(b / w_total);
    }
  `),t}const eFt=Object.freeze(Object.defineProperty({__proto__:null,build:Q4t},Symbol.toStringTag,{value:"Module"}));let yVe=class vVe extends si{initializeProgram(e){return new Kr(e.rctx,vVe.shader.get().build(),Br)}initializePipeline(){return Qt({colorWrite:hr})}};yVe.shader=new Jr(eFt,()=>le(()=>import("./SSAOBlur.glsl-e85a7434.js"),[]));const tFt="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";function eq(t){t.fragment.uniforms.add(new Cr("projInfo",(e,r)=>rFt(r))),t.fragment.uniforms.add(new Yr("zScale",(e,r)=>_Ve(r))),t.fragment.code.add(T`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)}function rFt(t){const e=t.camera.projectionMatrix;return e[11]===0?Ki(Jxe,2/(t.camera.fullWidth*e[0]),2/(t.camera.fullHeight*e[5]),(1+e[12])/e[0],(1+e[13])/e[5]):Ki(Jxe,-2/(t.camera.fullWidth*e[0]),-2/(t.camera.fullHeight*e[5]),(1-e[8])/e[0],(1-e[9])/e[5])}const Jxe=wr();function _Ve(t){return t.camera.projectionMatrix[11]===0?Or(Kxe,0,1):Or(Kxe,1,0)}const Kxe=Qe(),Qxe=16;function iFt(){const t=new jr,e=t.fragment;return t.include(wf),e.include(Ph),t.include(eq),e.uniforms.add(new Ye("radius",(r,i)=>ype(i.camera))),e.code.add(T`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),e.code.add(T`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.uniforms.add(new Yr("nearFar",(r,i)=>i.camera.nearFar),new Mt("normalMap",r=>r.normalTexture),new Mt("depthMap",r=>r.depthTexture),new Yr("zScale",(r,i)=>_Ve(i)),new Ye("projScale",r=>r.projScale),new Mt("rnm",r=>r.noiseTexture),new Yr("rnmScale",(r,i)=>Or(eSe,i.camera.fullWidth/r.noiseTexture.descriptor.width,i.camera.fullHeight/r.noiseTexture.descriptor.height)),new Ye("intensity",r=>r.intensity),new Yr("screenSize",(r,i)=>Or(eSe,i.camera.fullWidth,i.camera.fullHeight))),e.code.add(T`
    void main(void) {
      fillSphere();
      vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        fragColor = vec4(0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w < 0.5;

      float sum = 0.0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${T.int(Qxe)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
          continue;
        }

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          if (texture(normalMap, tcTap).w < 0.5) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${T.int(Qxe)}), 0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      fragColor = vec4(A);
    }
  `),t}function ype(t){return Math.max(10,20*t.computeScreenPixelSizeAtDist(Math.abs(4*t.relativeElevation)))}const eSe=Qe(),nFt=Object.freeze(Object.defineProperty({__proto__:null,build:iFt,getRadius:ype},Symbol.toStringTag,{value:"Module"}));let bVe=class wVe extends si{initializeProgram(e){return new Kr(e.rctx,wVe.shader.get().build(),Br)}initializePipeline(){return Qt({colorWrite:hr})}};bVe.shader=new Jr(nFt,()=>le(()=>import("./SSAO.glsl-cc877de9.js"),[]));let sFt=class extends Ai{constructor(){super(...arguments),this.projScale=1}},oFt=class extends sFt{constructor(){super(...arguments),this.intensity=1}},aFt=class extends Ai{},lFt=class extends aFt{constructor(){super(...arguments),this.blurSize=Qe()}};const JI=2;let xVe=class{constructor(e,r,i,n){this._view=e,this._techniqueRepository=r,this._rctx=i,this._requestRender=n,this._quadVAO=null,this._passParameters=new oFt,this._drawParameters=new lFt}dispose(){this.enabled=!1,this._quadVAO=pt(this._quadVAO)}destroy(){this.dispose()}disposeOffscreenBuffers(){var e,r;(e=this._ssaoFBO)==null||e.resize(0,0),(r=this._blurFBO)==null||r.resize(0,0)}set enabled(e){e?this._enable():this._disable()}get enabled(){return this._enableTime!=null}get active(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}get colorTexture(){var e;return(e=this._ssaoFBO)==null?void 0:e.colorTexture}render(e,r,i,n){if(this._enableTime==null||i==null||n==null||this._ssaoFBO==null||this._blurFBO==null)return;if(!this.active)return this._enableTime=r,void this._requestRender();this._enableTime===0&&(this._enableTime=r);const s=this._rctx,o=e.camera,a=this._view.qualitySettings.fadeDuration,l=a>0?Math.min(a,r-this._enableTime)/a:1;this._passParameters.normalTexture=n,this._passParameters.depthTexture=i,this._passParameters.projScale=1/o.computeRenderPixelSizeAtDist(1),this._passParameters.intensity=4*cFt/ype(o)**6*l;const c=o.fullViewport,u=c[2],h=c[3],f=u/JI,m=h/JI;this._ssaoFBO.resize(u,h),this._blurFBO.resize(f,m),this._quadVAO==null&&(this._quadVAO=vu(this._rctx)),s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,u,h),s.bindTechnique(this._ssaoTechnique,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),s.bindVAO(this._quadVAO);const g=el(this._quadVAO,"geometry");s.drawArrays(Zt.TRIANGLE_STRIP,0,g);const y=s.bindTechnique(this._blurTechnique,this._passParameters,e);s.setViewport(0,0,f,m),s.bindFramebuffer(this._blurFBO),this._drawParameters.colorTexture=this._ssaoFBO.colorTexture,Or(this._drawParameters.blurSize,0,JI/h),y.bindDraw(this._drawParameters,e,this._passParameters),s.setViewport(0,0,f,m),s.drawArrays(Zt.TRIANGLE_STRIP,0,g),s.bindFramebuffer(this._ssaoFBO),s.setViewport(0,0,u,h),s.setClearColor(1,1,1,0),s.clear(Qi.COLOR_BUFFER_BIT),s.setViewport(0,0,f,m),this._drawParameters.colorTexture=this._blurFBO.colorTexture,Or(this._drawParameters.blurSize,JI/u,0),y.bindDraw(this._drawParameters,e,this._passParameters),s.drawArrays(Zt.TRIANGLE_STRIP,0,g),s.setViewport(c[0],c[1],c[2],c[3]),l<1&&this._requestRender()}_enable(){if(this._enableTime!=null)return;const e=new Vr;e.wrapMode=ir.CLAMP_TO_EDGE,this._ssaoFBO=new wo(this._rctx,e),this._blurFBO=new wo(this._rctx,e);const r=Uint8Array.from(atob(tFt),i=>i.charCodeAt(0));e.pixelFormat=Yt.RGB,e.wrapMode=ir.REPEAT,e.hasMipmap=!0,e.width=32,e.height=32,this._passParameters.noiseTexture=new Jt(this._rctx,e,r),this._ssaoTechnique==null&&(this._ssaoTechnique=this._techniqueRepository.acquire(bVe)),this._blurTechnique==null&&(this._blurTechnique=this._techniqueRepository.acquire(yVe)),this._enableTime=0,this._requestRender()}_disable(){this._enableTime=null,this._passParameters.noiseTexture=pt(this._passParameters.noiseTexture),this._blurFBO=pt(this._blurFBO),this._ssaoFBO=pt(this._ssaoFBO)}get gpuMemoryUsage(){var e,r;return(((e=this._blurFBO)==null?void 0:e.gpuMemoryUsage)??0)+(((r=this._ssaoFBO)==null?void 0:r.gpuMemoryUsage)??0)}};const cFt=.5;let vpe=class SVe extends si{initializeProgram(e){return new Kr(e.rctx,SVe.shader.get().build(),Br)}initializePipeline(){return this.configuration.hasAlpha?Qt({blending:Fa(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),colorWrite:hr}):Qt({colorWrite:hr})}};vpe.shader=new Jr(RNt,()=>le(()=>import("./TextureOnly.glsl-77c092d5.js"),[]));let _pe=class extends jl{constructor(){super(...arguments),this.hasAlpha=!1}};d([X()],_pe.prototype,"hasAlpha",void 0);let sy=class extends Ce{get _bindParameters(){return this._renderContext.bindParameters}get _rctx(){return this.view._stage.renderView.renderingContext}get rctx(){return this._rctx}get materialRepository(){return this._materialRepository}get screenToWorldRatio(){return this._screenToWorldRatio}get localOriginFactory(){return this._localOriginFactory}constructor(e){super(e),this._overlays=null,this._overlayRenderTarget=null,this._hasHighlights=!1,this._rendersOccluded=!1,this._hasWater=!1,this._handles=new Ri,this._renderers=new Map,this._sortedDrapeSourceRenderersDirty=!1,this._sortedRenderers=new dr,this._passParameters=new L9e,this._materialRepository=null,this._screenToWorldRatio=1,this._localOriginFactory=null,this._camera=new Bt,this.worldToPCSRatio=1,this.events=new pn,this.longitudeCyclical=null}initialize(){const e=this.view._stage.renderView,{waterTextureRepository:r,stippleTextureRepository:i,markerTextureRepository:n}=e;this._shaderTechniqueRepository=new D9e({rctx:this._rctx,viewingMode:at.Local,stippleTextureRepository:i,markerTextureRepository:n,waterTextureRepository:r}),this._renderContext=new rVe(this._rctx,new dpe(this._rctx,this.view.state.viewingMode),new xVe(this.view,this._shaderTechniqueRepository,this._rctx,()=>{})),this._handles.add([pe(()=>r.updating,()=>this.events.emit("content-changed"),Bi),pe(()=>this.spatialReference,s=>this._localOriginFactory=new cpe(s),Bi),da(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]),this._materialRepository=new N9e(e.textureRepository,this._shaderTechniqueRepository,s=>{(s.renderOccluded&rj)>0!==this._rendersOccluded&&this._updateRendersOccluded(),this.events.emit("content-changed"),this.notifyChange("updating"),this.notifyChange("isEmpty")},()=>this.events.emit("content-changed")),this._bindParameters.slot=_e.DRAPED_MATERIAL,this._bindParameters.highlightDepthTexture=y6e(this._rctx),this._camera.near=1,this._camera.far=1e4,this._camera.relativeElevation=null,this._bindParameters.camera=this._camera,this._bindParameters.transparencyPassType=kt.NONE,this._bindParameters.newLighting.noonFactor=0,this._bindParameters.newLighting.globalFactor=0,this._bindParameters.newLighting.set([new Yde(Ue(1,1,1))]),this._handles.add(this.view.resourceController.scheduler.registerTask(Vt.STAGE,this))}destroy(){this._handles.destroy(),this._renderers.forEach(e=>e.destroy()),this._renderers.clear(),this._debugTextureTechnique=xn(this._debugTextureTechnique),this._passParameters.texture=pt(this._passParameters.texture),this._bindParameters.highlightDepthTexture=pt(this._bindParameters.highlightDepthTexture),this._shaderTechniqueRepository=qe(this._shaderTechniqueRepository),this._temporaryFBO=pt(this._temporaryFBO),this._quadVAO=pt(this._quadVAO),this.disposeOverlays()}get updating(){return this._sortedDrapeSourceRenderersDirty||Pa(this._renderers,e=>e.updating)}get hasOverlays(){return this._overlays!=null&&this._overlayRenderTarget!=null}get gpuMemoryUsage(){return this._overlayRenderTarget!=null?this._overlayRenderTarget.gpuMemoryUsage:0}createGeometryDrapeSourceRenderer(e){return this.createDrapeSourceRenderer(e,Wd)}createDrapeSourceRenderer(e,r,i){const n=this._renderers.get(e);n!=null&&n.destroy();const s=new r({...i,rendererContext:this,drapeSource:e});return this._renderers.set(e,s),this._sortedDrapeSourceRenderersDirty=!0,"fullOpacity"in e&&this._handles.add(pe(()=>e.fullOpacity,()=>this.events.emit("content-changed")),e),s}removeDrapeSourceRenderer(e){if(e==null)return;const r=this._renderers.get(e);r!=null&&(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(e),this._handles.remove(e),r.destroy())}collectUnusedRenderTargetMemory(){let e=!1;const r=udt();if(this._overlayRenderTarget!=null)for(const i of this._overlayRenderTarget.renderTargets){const n=this.overlays[mn.INNER].validTargets[i.type];e=this._overlayRenderTarget.validateUsageForTarget(n,i,r)||e}return e}get overlays(){return this._overlays??[]}ensureDrapeTargets(e){this._overlays!=null&&this._overlays.forEach(r=>r.hasTargetWithoutRasterImage=b8(e,i=>i.drapeTargetType===one.WithoutRasterImage))}ensureDrapeSources(e){this._overlays!=null&&this._overlays.forEach(r=>{r.hasDrapedFeatureSource=b8(e,i=>i.drapeSourceType===CD.Features),r.hasDrapedRasterSource=b8(e,i=>i.drapeSourceType===CD.RasterImage)})}ensureOverlays(e,r){this._overlays==null&&(this._overlayRenderTarget=new TNt(this._rctx),this._overlays=[new Iwe(mn.INNER,this._overlayRenderTarget),new Iwe(mn.OUTER,this._overlayRenderTarget)]),this.ensureDrapeTargets(e),this.ensureDrapeSources(r)}disposeOverlays(){this._overlays=null,this._overlayRenderTarget=pt(this._overlayRenderTarget),this.events.emit("textures-disposed")}get running(){return this.updating}runTask(e){this._processDrapeSources(e,()=>!0)}_processDrapeSources(e,r){let i=!1;for(const[n,s]of this._renderers){if(e.done)break;(n.destroyed||r(n))&&s.commitChanges()&&(i=!0,e.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,i=!0,this._updateSortedDrapeSourceRenderers()),i&&(this._overlays!=null&&this._renderers.size===0&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())}processSyncDrapeSources(){this._processDrapeSources(bc,e=>e.updatePolicy===Vw.SYNC)}get isEmpty(){return!Di.OVERLAY_DRAW_DEBUG_TEXTURE&&!Pa(this._renderers,e=>!e.isEmpty)}get hasHighlights(){return this._hasHighlights}get hasWater(){return this._hasWater}get rendersOccluded(){return this._rendersOccluded}updateAnimation(e){let r=!1;return this._renderers.forEach(i=>r=i.updateAnimation(e)||r),r}updateDrapeSourceOrder(){this._sortedDrapeSourceRenderersDirty=!0}drawTarget(e,r,i){const n=e.canvasGeometries;if(n.numViews===0)return!1;const{alignPixelEnabled:s,contentPixelRatio:o}=i;this._screenToWorldRatio=o*e.mapUnitsPerPixel/Rhe;const a=r.output;if(this.isEmpty||a===q.Highlight&&!this.hasHighlights||a===q.Normal&&!this.hasWater||!e.hasSomeSizedView())return!1;const l=r.fbo;if(!l.isValid())return!1;const c=2*e.resolution,u=e.resolution;l.resize(c,u);const h=this._rctx;if(this._camera.pixelRatio=e.pixelRatio*o,this._renderContext.output=a,this._bindParameters.alignPixelEnabled=s,this._bindParameters.screenToWorldRatio=this._screenToWorldRatio,this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio,this._bindParameters.slot=a===q.Normal?_e.DRAPED_WATER:_e.DRAPED_MATERIAL,e.applyViewport(this._rctx),l.bind(h),e.index===mn.INNER&&(h.setClearColor(0,0,0,0),h.clearSafe(Qi.COLOR_BUFFER_BIT)),r.type===Hn.Occluded&&(this._renderContext.renderOccludedMask=rj),Di.OVERLAY_DRAW_DEBUG_TEXTURE&&r.type!==Hn.Occluded)for(let f=0;f<n.numViews;f++)this._setViewParameters(n.extents[f],e),this._drawDebugTexture(e.resolution,dFt[e.index]);return this._renderers.size>0&&this._sortedRenderers.forAll(({drapeSource:f,renderer:m})=>{if(r.type===Hn.ColorNoRasterImage&&f.drapeSourceType===CD.RasterImage)return;const{fullOpacity:g}=f,y=g!=null&&g<1&&a===q.Color;y&&(this.bindTemporaryFramebuffer(this._rctx,c,u),h.clearSafe(Qi.COLOR_BUFFER_BIT));for(let _=0;_<n.numViews;_++)this._setViewParameters(n.extents[_],e),m.render(this._renderContext);y&&this._temporaryFBO!=null&&(l.bind(h),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),g,e.index))}),h.bindFramebuffer(null),l.generateMipMap(),this._renderContext.resetRenderOccludedMask(),!0}bindTemporaryFramebuffer(e,r,i){this._temporaryFBO==null&&(this._temporaryFBO=new I9e(e,!1)),this._temporaryFBO.resize(r,i),this._temporaryFBO.bind(e)}async reloadShaders(){await this._shaderTechniqueRepository.reloadAll()}notifyContentChanged(){this.events.emit("content-changed")}intersect(e,r,i,n){var o;let s=0;for(const a of this._renderers.values())s=((o=a.intersect)==null?void 0:o.call(a,e,r,i,n,s))??s}_updateSortedDrapeSourceRenderers(){if(this._sortedRenderers.clear(),this._renderers.size===0)return;const e=this.view.map.allLayers;this._renderers.forEach((r,i)=>{const n=e.indexOf(i.layer),s=n>=0,o=this._renderers.size*(i.renderGroup??(s?JB.MapLayer:JB.ViewLayer))+(s?n:0);this._sortedRenderers.push(new uFt(i,r,o))}),this._sortedRenderers.sort((r,i)=>r.index-i.index)}_setViewParameters(e,r){const i=this._camera;i.viewport=[0,0,r.resolution,r.resolution],nDe(i.projectionMatrix,0,e[2]-e[0],0,e[3]-e[1],i.near,i.far),eF(i.viewMatrix,[-e[0],-e[1],0])}_updateHasWater(){const e=Pa(this._renderers,r=>r.hasWater);e!==this._hasWater&&(this._hasWater=e,this.events.emit("has-water",e))}_updateHasHighlights(){const e=Pa(this._renderers,r=>r.hasHighlights);e!==this._hasHighlights&&(this._hasHighlights=e,this.events.emit("has-highlights",e))}_updateRendersOccluded(){const e=Pa(this._renderers,r=>r.rendersOccluded);e!==this._rendersOccluded&&(this._rendersOccluded=e,this.events.emit("renders-occluded",e))}_drawDebugTexture(e,r){this._ensureDebugPatternResources(e,r);const i=this._rctx;i.bindTechnique(this._debugTextureTechnique,this._passParameters,null),i.bindVAO(this._quadVAO),i.drawArrays(Zt.TRIANGLE_STRIP,0,el(this._quadVAO,"geometry"))}_ensureDebugPatternResources(e,r){if(se(this._passParameters.color,r[0],r[1],r[2]),this._passParameters.texture)return;const i=new Uint8Array(e*e*4);let n=0;for(let a=0;a<e;a++)for(let l=0;l<e;l++){const c=Math.floor(l/10),u=Math.floor(a/10);c<2||u<2||10*c>e-20||10*u>e-20?(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=255):(i[n++]=255,i[n++]=255,i[n++]=255,i[n++]=1&c&&1&u?1&l^1&a?0:255:1&c^1&u?0:128)}const s=new Vr(e);s.samplingMode=Kt.NEAREST,this._passParameters.texture=new Jt(this._rctx,s,i);const o=new _pe;o.hasAlpha=!0,this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(vpe,o),this._quadVAO=vu(this._rctx)}get test(){return{drapedRenderers:Array.from(this._renderers.values()),getDrapeSourceRenderer:e=>this._renderers.get(e)}}};d([p()],sy.prototype,"_sortedDrapeSourceRenderersDirty",void 0),d([p({autoDestroy:!0})],sy.prototype,"_shaderTechniqueRepository",void 0),d([p({constructOnly:!0})],sy.prototype,"view",void 0),d([p()],sy.prototype,"worldToPCSRatio",void 0),d([p()],sy.prototype,"spatialReference",void 0),d([p({type:Boolean,readOnly:!0})],sy.prototype,"updating",null),d([p()],sy.prototype,"isEmpty",null),sy=d([I("esri.views.3d.terrain.OverlayRenderer")],sy);let uFt=class{constructor(e,r,i){this.drapeSource=e,this.renderer=r,this.index=i}};const dFt=[[1,.5,.5],[.5,.5,1]],bpe=-2,rj=gn.OccludeAndTransparent;function wpe(t,e,r,i){const n=FF(t.rings,!!t.hasZ,f0.CCW_IS_HOLE),s=sl(n.position.length),o=Dze(n.position,t.spatialReference,0,s,0,n.position,0,n.position.length/3,e,r,i),a=o!=null;return new fFt(n.position,s,CVe(n.polygons,n.position,s),EVe(n.outlines,n.position,s),a,o)}function TVe(t,e){const r=FF(t.rings,!1,f0.CCW_IS_HOLE),i=Ni(r.position,t.spatialReference,0,r.position,e,0,r.position.length/3);for(let n=2;n<r.position.length;n+=3)r.position[n]=bpe;return{position:r.position,polygons:CVe(r.polygons,r.position),outlines:EVe(r.outlines,r.position),projectionSuccess:i}}function EVe(t,e,r=null){return t.filter(({count:i})=>i>1).map(({index:i,count:n})=>{const s=3*i,o=3*n;return r!=null?new RVe(i,n,Xp(e,s,o),Xp(r,s,o)):new xpe(i,n,Xp(e,s,o))})}function CVe(t,e,r=null){const i=new Array;for(const{index:n,count:s,holeIndices:o,pathLengths:a}of t){if(s<=1)continue;const l=3*n,c=3*s,u=o.map(f=>f-n),h=r!=null?new hFt(n,s,Xp(e,3*n,3*s),Xp(r,l,c),u,a):new pFt(n,s,Xp(e,3*n,3*s),u,a);i.push(h)}return i}let xpe=class{constructor(e,r,i){this.index=e,this.count=r,this.position=i}},RVe=class extends xpe{constructor(e,r,i,n){super(e,r,i),this.mapPositions=n}},hFt=class extends RVe{constructor(e,r,i,n,s,o){super(e,r,i,n),this.holeIndices=s,this.pathLengths=o}},pFt=class extends xpe{constructor(e,r,i,n,s){super(e,r,i),this.holeIndices=n,this.pathLengths=s}},fFt=class{constructor(e,r,i,n,s,o){this.position=e,this.mapPositions=r,this.polygons=i,this.outlines=n,this.projectionSuccess=s,this.sampledElevation=o}};function _E(t,e,r,i,n,s=2){const o=1/(Math.abs(r)+Math.abs(i)+Math.abs(n)),a=r*o,l=i*o,c=n<=0?(a>=0?1:-1)*(1-Math.abs(l)):a,u=n<=0?(l>=0?1:-1)*(1-Math.abs(a)):l,h=e*s;t[h]=tSe(c),t[h+1]=tSe(u)}function mFt(t){const e=t.length/3,r=new Int16Array(2*e);let i=0;for(let n=0;n<e;++n)_E(r,n,t[i++],t[i++],t[i++]);return r}function gFt(t,e,r,i=2){const n=r*i,s=rSe(e[n]),o=rSe(e[n+1]),a=1-Math.abs(s)-Math.abs(o);t[2]=a,a<0?(t[0]=(s>=0?1:-1)*(1-Math.abs(o)),t[1]=(o>=0?1:-1)*(1-Math.abs(s))):(t[0]=s,t[1]=o),Se(t,t)}function tSe(t){return Te(Math.round(32767*t),-32767,32767)}function rSe(t){return Te(t/32767,-1,1)}function OVe(t,e){const r=t.fragment;switch(r.code.add(T`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),e.doubleSidedMode){case Nn.None:r.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case Nn.View:r.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case Nn.WindingOrder:r.code.add(T`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:e.doubleSidedMode;case Nn.COUNT:}}var Nn;(function(t){t[t.None=0]="None",t[t.View=1]="View",t[t.WindingOrder=2]="WindingOrder",t[t.COUNT=3]="COUNT"})(Nn||(Nn={}));function AVe({normalTexture:t,metallicRoughnessTexture:e,metallicFactor:r,roughnessFactor:i,emissiveTexture:n,emissiveFactor:s,occlusionTexture:o}){return t==null&&e==null&&n==null&&(s==null||gi(s,Sc))&&o==null&&(i==null||i===1)&&(r==null||r===1||r===0)}const tq=[1,1,.5],Spe=[0,.6,.2],yFt=[0,1,.2];function PVe(t){t.vertex.code.add(T`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)}let vFt=class extends jl{constructor(){super(...arguments),this.instancedDoublePrecision=!1}};function MVe(t,e){e.instanced&&e.instancedDoublePrecision&&(t.attributes.add(O.MODELORIGINHI,"vec3"),t.attributes.add(O.MODELORIGINLO,"vec3"),t.attributes.add(O.MODEL,"mat3"),t.attributes.add(O.MODELNORMAL,"mat3"));const r=t.vertex;e.instancedDoublePrecision&&(r.include(AB,e),r.uniforms.add(new _h("viewOriginHi",(i,n)=>IOt(se(x6,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),x6)),new _h("viewOriginLo",(i,n)=>LOt(se(x6,n.camera.viewInverseTransposeMatrix[3],n.camera.viewInverseTransposeMatrix[7],n.camera.viewInverseTransposeMatrix[11]),x6)))),r.code.add(T`
    vec3 calculateVPos() {
      ${e.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `),r.code.add(T`
    vec3 subtractOrigin(vec3 _pos) {
      ${e.instancedDoublePrecision?T`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),r.code.add(T`
    vec3 dpNormal(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `),e.output===q.Normal&&(XP(r),r.code.add(T`
    vec3 dpNormalView(vec4 _normal) {
      ${e.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `)),e.hasVertexTangents&&r.code.add(T`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${e.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)}d([X()],vFt.prototype,"instancedDoublePrecision",void 0);const x6=A();var Ds;function $Ve(t){switch(t){case"multiply":default:return Ds.Multiply;case"ignore":return Ds.Ignore;case"replace":return Ds.Replace;case"tint":return Ds.Tint}}function IVe(t,e,r){if(t==null||e===Ds.Ignore)return r[0]=255,r[1]=255,r[2]=255,void(r[3]=255);const i=Te(Math.round(t[3]*ij),0,ij),n=i===0||e===Ds.Tint?0:e===Ds.Replace?_Ft:bFt;r[0]=Te(Math.round(t[0]*NC),0,NC),r[1]=Te(Math.round(t[1]*NC),0,NC),r[2]=Te(Math.round(t[2]*NC),0,NC),r[3]=i+n}(function(t){t[t.Multiply=1]="Multiply",t[t.Ignore=2]="Ignore",t[t.Replace=3]="Replace",t[t.Tint=4]="Tint"})(Ds||(Ds={}));const NC=255,ij=85,_Ft=ij,bFt=2*ij;function LVe(t){t.vertex.code.add(T`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${T.int(Ds.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${T.int(Ds.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${T.int(Ds.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${T.int(Ds.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)}function DVe(t,e){e.hasSymbolColors?(t.include(LVe),t.attributes.add(O.SYMBOLCOLOR,"vec4"),t.varyings.add("colorMixMode","mediump float"),t.vertex.code.add(T`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(t.fragment.uniforms.add(new UF("colorMixMode",r=>C8e[r.colorMixMode])),t.vertex.code.add(T`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))}function WE(t,e){e.hasVertexColors?(t.attributes.add(O.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(T`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(T`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):t.vertex.code.add(T`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)}function wFt(t){t.fragment.code.add(T`
    #define discardOrAdjustAlpha(color) { if (color.a < ${T.float(Ma)}) { discard; } }
  `)}let P2=class extends Zn{constructor(e,r){super(e,"float",Ci.Draw,(i,n,s)=>i.setUniform1f(e,r(n,s)))}};function M2(t,e){NVe(t,e,new Ye("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function xFt(t,e){NVe(t,e,new P2("textureAlphaCutoff",r=>r.textureAlphaCutoff))}function NVe(t,e,r){const i=t.fragment;switch(e.alphaDiscardMode!==Si.Mask&&e.alphaDiscardMode!==Si.MaskBlend||i.uniforms.add(r),e.alphaDiscardMode){case Si.Blend:return t.include(wFt);case Si.Opaque:i.code.add(T`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case Si.Mask:i.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case Si.MaskBlend:t.fragment.code.add(T`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}function FVe(t,e){const{vertex:r,fragment:i}=t,n=e.hasModelTransformation;if(n){const o=vn();r.uniforms.add(new yn("model",a=>a.modelTransformation??bo)),r.uniforms.add(new xf("normalTransform",a=>(ix(o,a.modelTransformation??bo),o)))}const s=e.hasColorTexture&&e.alphaDiscardMode!==Si.Opaque;switch(e.output){case q.Depth:case q.Shadow:case q.ShadowHighlight:case q.ShadowExcludeHighlight:case q.ObjectAndLayerIdColor:gd(r,e),t.include(nu,e),t.include(Zy,e),t.include(o_,e),t.include(V_,e),t.include(as,e),t.include(PF,e),hE(t),t.varyings.add("depth","float"),s&&i.uniforms.add(new Mt("tex",o=>o.texture)),r.code.add(T`
          void main(void) {
            vpos = calculateVPos();
            ${n?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `),t.include(M2,e),i.code.add(T`
          void main(void) {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${e.output===q.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:T`outputDepth(depth);`}
          }
        `);break;case q.Normal:{gd(r,e),t.include(nu,e),t.include(kF,e),t.include(KH,e),t.include(Zy,e),t.include(o_,e),s&&i.uniforms.add(new Mt("tex",a=>a.texture)),e.normalType===ei.ScreenDerivative&&t.varyings.add("vPositionView","vec3");const o=e.normalType===ei.Attribute||e.normalType===ei.Compressed;r.code.add(T`
          void main(void) {
            vpos = calculateVPos();
            ${n?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}

            ${o?T`vNormalWorld = ${n?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormalView(vvLocalNormal(normalModel()))"};`:T`
                  // Get vertex position in camera space for screen-space derivative normals
                  vPositionView = (view * vec4(vpos, 1.0)).xyz;
                `}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(as,e),t.include(M2,e),i.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${e.normalType===ei.ScreenDerivative?T`vec3 normal = screenDerivativeNormal(vPositionView);`:T`
                  vec3 normal = normalize(vNormalWorld);
                  if (gl_FrontFacing == false){
                    normal = -normal;
                  }`}
            fragColor = vec4(0.5 + 0.5 * normal, 1.0);
          }
        `);break}case q.Highlight:gd(r,e),t.include(nu,e),t.include(Zy,e),t.include(o_,e),s&&i.uniforms.add(new Mt("tex",o=>o.texture)),r.code.add(T`
          void main(void) {
            vpos = calculateVPos();
            ${n?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            forwardTextureCoordinates();
          }
        `),t.include(as,e),t.include(M2,e),t.include(s1,e),i.code.add(T`
          void main() {
            discardBySlice(vpos);
            ${s?T`
                    vec4 texColor = texture(tex, ${e.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}}function kVe(t,e){const r=t.fragment;e.hasVertexTangents?(t.attributes.add(O.TANGENT,"vec4"),t.varyings.add("vTangent","vec4"),e.doubleSidedMode===Nn.WindingOrder?r.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):r.code.add(T`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):r.code.add(T`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),e.textureCoordinateType!==xs.None&&(t.include(Gde,e),r.uniforms.add(e.pbrTextureBindType===Ci.Pass?new Mt("normalTexture",i=>i.textureNormal):new Wp("normalTexture",i=>i.textureNormal)),r.code.add(T`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;
return tangentSpace * rawNormal;
}`))}function zF(t,e){const r=t.fragment;e.receiveAmbientOcclusion?(r.uniforms.add(new Mt("ssaoTex",(i,n)=>n.ssaoHelper.colorTexture)),r.constants.add("blurSizePixelsInverse","float",1/JI),r.code.add(T`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):r.code.add(T`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)}function VF(t){t.constants.add("ambientBoostFactor","float",L6e)}function K3(t){t.uniforms.add(new Ye("lightingGlobalFactor",(e,r)=>r.lighting.globalFactor))}function bE(t,e){const r=t.fragment;switch(t.include(zF,e),e.pbrMode!==Nt.Disabled&&t.include(fpe,e),t.include(Wde,e),t.include(wF),r.code.add(T`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${e.pbrMode===Nt.Disabled?"":"const vec3 GROUND_REFLECTANCE = vec3(0.2);"}
  `),VF(r),K3(r),J_(r),r.code.add(T`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${e.spherical?T`normalize(vPosWorld)`:T`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),C0(r),r.code.add(T`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),e.pbrMode){case Nt.Disabled:case Nt.WaterOnIntegratedMesh:case Nt.Water:t.include(TB),r.code.add(T`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case Nt.Normal:case Nt.Schematic:r.code.add(T`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),r.code.add(T`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),e.useFillLights?r.uniforms.add(new Jy("hasFillLights",(i,n)=>n.enableFillLights)):r.constants.add("hasFillLights","bool",!1),r.code.add(T`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),r.uniforms.add(new Ye("lightingSpecularStrength",(i,n)=>n.lighting.mainLight.specularStrength),new Ye("lightingEnvironmentStrength",(i,n)=>n.lighting.mainLight.environmentStrength)),r.code.add(T`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),r.code.add(T`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${e.pbrMode===Nt.Schematic?T`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:T`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case Nt.Terrain:case Nt.TerrainWithWater:t.include(TB),r.code.add(T`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:e.pbrMode;case Nt.COUNT:}}function uu(){const t=new Float32Array(9);return t[0]=1,t[4]=1,t[8]=1,t}function UVe(t){const e=new Float32Array(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Dz(t,e,r,i,n,s,o,a,l){const c=new Float32Array(9);return c[0]=t,c[1]=e,c[2]=r,c[3]=i,c[4]=n,c[5]=s,c[6]=o,c[7]=a,c[8]=l,c}function SFt(t,e){return new Float32Array(t,e,9)}Object.freeze(Object.defineProperty({__proto__:null,clone:UVe,create:uu,createView:SFt,fromValues:Dz},Symbol.toStringTag,{value:"Module"}));function TFt(t){t.vertex.uniforms.add(new xf("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix!=null?e.colorTextureTransformMatrix:uu())),t.varyings.add("colorUV","vec2"),t.vertex.code.add(T`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function EFt(t){t.vertex.uniforms.add(new xf("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix!=null?e.normalTextureTransformMatrix:uu())),t.varyings.add("normalUV","vec2"),t.vertex.code.add(T`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function CFt(t){t.vertex.uniforms.add(new xf("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix!=null?e.emissiveTextureTransformMatrix:uu())),t.varyings.add("emissiveUV","vec2"),t.vertex.code.add(T`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function RFt(t){t.vertex.uniforms.add(new xf("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix!=null?e.occlusionTextureTransformMatrix:uu())),t.varyings.add("occlusionUV","vec2"),t.vertex.code.add(T`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function OFt(t){t.vertex.uniforms.add(new xf("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix!=null?e.metallicRoughnessTextureTransformMatrix:uu())),t.varyings.add("metallicRoughnessUV","vec2"),t.vertex.code.add(T`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)}function r4(t){t.include(R0),t.code.add(T`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${T.int(Ds.Multiply)}) {
        return allMixed;
      }
      if (mode == ${T.int(Ds.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(Ds.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${T.int(Ds.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${T.int(Ds.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)}function AFt(t){const e=new jr,{vertex:r,fragment:i,varyings:n}=e;if(gd(r,t),e.include(xF),n.add("vpos","vec3"),e.include(o_,t),e.include(MVe,t),e.include(y8e,t),t.hasColorTextureTransform&&e.include(TFt),t.output===q.Color||t.output===q.Alpha){t.hasNormalTextureTransform&&e.include(EFt),t.hasEmissionTextureTransform&&e.include(CFt),t.hasOcclusionTextureTransform&&e.include(RFt),t.hasMetallicRoughnessTextureTransform&&e.include(OFt),hg(r,t),e.include(kF,t),e.include(nu,t);const s=t.normalType===ei.Attribute||t.normalType===ei.Compressed;s&&t.offsetBackfaces&&e.include(PVe),e.include(kVe,t),e.include(KH,t),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),n.add("vPositionLocal","vec3"),e.include(Zy,t),e.include(H3,t),e.include(DVe,t),e.include(WE,t),r.uniforms.add(new Cr("externalColor",a=>a.externalColor)),n.add("vcolorExt","vec4"),t.hasMultipassTerrain&&n.add("depth","float");const o=t.hasModelTransformation;if(o){const a=vn();r.uniforms.add(new yn("model",l=>l.modelTransformation??bo)),r.uniforms.add(new xf("normalTransform",l=>(ix(a,l.modelTransformation??bo),a)))}r.code.add(T`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${T.float(Ma)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          ${o?"vpos = (model * vec4(vpos, 1.0)).xyz;":""}
          vPositionLocal = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${s?T`vNormalWorld = ${o?"normalize(normalTransform * dpNormal(vvLocalNormal(normalModel())))":"dpNormal(vvLocalNormal(normalModel()))"};`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${t.hasVertexTangents?"vTangent = dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${s&&t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${t.hasColorTextureTransform?T`forwardColorUV();`:""}
        ${t.hasNormalTextureTransform?T`forwardNormalUV();`:""}
        ${t.hasEmissionTextureTransform?T`forwardEmissiveUV();`:""}
        ${t.hasOcclusionTextureTransform?T`forwardOcclusionUV();`:""}
        ${t.hasMetallicRoughnessTextureTransform?T`forwardMetallicRoughnessUV();`:""}
      }
    `)}switch(t.output){case q.Alpha:e.include(as,t),e.include(M2,t),e.include(Mh,t),i.uniforms.add(new Ye("opacity",s=>s.opacity),new Ye("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Mt("tex",s=>s.texture)),i.include(r4),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?T`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        fragColor = vec4(opacity_);
      }
    `);break;case q.Color:e.include(as,t),e.include(bE,t),e.include(zF,t),e.include(M2,t),e.include(t.instancedDoublePrecision?QH:vE,t),e.include(Mh,t),hg(i,t),i.uniforms.add(r.uniforms.get("localOrigin"),new ar("ambient",s=>s.ambient),new ar("diffuse",s=>s.diffuse),new Ye("opacity",s=>s.opacity),new Ye("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Mt("tex",s=>s.texture)),e.include(qde,t),e.include(fpe,t),i.include(r4),e.include(OVe,t),VF(i),K3(i),C0(i),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${t.normalType===ei.ScreenDerivative?T`
                vec3 normal = screenDerivativeNormal(vPositionLocal);`:T`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${t.pbrMode===Nt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${t.receiveShadows?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.hasNormalTexture?T`
                mat3 tangentSpace = ${t.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, ${t.hasNormalTextureTransform?T`normalUV`:"vuv0"});`:T`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${t.spherical?T`normalize(posWorld);`:T`vec3(0.0, 0.0, 1.0);`}

        ${t.snowCover?T`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${t.pbrMode===Nt.Normal||t.pbrMode===Nt.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===kt.Color?T`fragColor = premultiplyAlpha(fragColor);`:""}
      }
    `)}return e.include(FVe,t),e}const PFt=Object.freeze(Object.defineProperty({__proto__:null,build:AFt},Symbol.toStringTag,{value:"Module"}));let MFt=class extends oVe{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=mc(tq),this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=Hi.Back,this.isInstanced=!1,this.hasInstancedColor=!1,this.emissiveFactor=Ue(0,0,0),this.instancedDoublePrecision=!1,this.normalType=ei.Attribute,this.receiveSSAO=!0,this.receiveShadows=!0,this.castShadows=!0,this.shadowMappingEnabled=!1,this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.externalColor=nr(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=A(),this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.transparent=!1,this.writeDepth=!0,this.customDepthTest=cE.Less,this.textureAlphaMode=Si.Blend,this.textureAlphaCutoff=WB,this.textureAlphaPremultiplied=!1,this.hasOccludees=!1,this.renderOccluded=gn.Occlude}},$Ft=class extends aVe{constructor(){super(...arguments),this.origin=A(),this.slicePlaneLocalOrigin=this.origin}},Tpe=class zVe extends si{initializeConfiguration(e,r){r.spherical=e.viewingMode===at.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result,r.textureCoordinateType=r.hasColorTexture||r.hasMetallicRoughnessTexture||r.hasEmissionTexture||r.hasOcclusionTexture||r.hasNormalTexture?xs.Default:xs.None,r.objectAndLayerIdColorInstanced=r.instanced}initializeProgram(e){return this._initializeProgram(e,zVe.shader)}_initializeProgram(e,r){return new Kr(e.rctx,r.get().build(this.configuration),Br)}_convertDepthTestFunction(e){return e===cE.Lequal?Oi.LEQUAL:Oi.LESS}_makePipeline(e,r){const i=this.configuration,n=e===kt.NONE,s=e===kt.FrontFace;return Qt({blending:i.output!==q.Color&&i.output!==q.Alpha||!i.transparent?null:n?bh:o1(e),culling:IFt(i)?_H(i.cullFace):null,depthTest:{func:Px(e,this._convertDepthTestFunction(i.customDepthTest))},depthWrite:(n||s)&&i.writeDepth?fu:null,colorWrite:hr,stencilWrite:i.hasOccludees?m0:null,stencilTest:i.hasOccludees?r?vx:Mx:null,polygonOffset:n||s?null:VH(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0),this._makePipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};function IFt(t){return t.cullFace!==Hi.None||!t.hasSlicePlane&&!t.transparent&&!t.doubleSidedMode}Tpe.shader=new Jr(PFt,()=>le(()=>import("./DefaultMaterial.glsl-3c0d561d.js"),[]));let fr=class extends tl{constructor(){super(...arguments),this.output=q.Color,this.alphaDiscardMode=Si.Opaque,this.doubleSidedMode=Nn.None,this.pbrMode=Nt.Disabled,this.cullFace=Hi.None,this.transparencyPassType=kt.NONE,this.normalType=ei.Attribute,this.textureCoordinateType=xs.None,this.customDepthTest=cE.Less,this.spherical=!1,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasSlicePlane=!1,this.hasSliceHighlight=!0,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.vvSize=!1,this.vvColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instanced=!1,this.instancedColor=!1,this.objectAndLayerIdColorInstanced=!1,this.instancedDoublePrecision=!1,this.doublePrecisionRequiresObfuscation=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.cullAboveGround=!1,this.snowCover=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1}};d([X({count:q.COUNT})],fr.prototype,"output",void 0),d([X({count:Si.COUNT})],fr.prototype,"alphaDiscardMode",void 0),d([X({count:Nn.COUNT})],fr.prototype,"doubleSidedMode",void 0),d([X({count:Nt.COUNT})],fr.prototype,"pbrMode",void 0),d([X({count:Hi.COUNT})],fr.prototype,"cullFace",void 0),d([X({count:kt.COUNT})],fr.prototype,"transparencyPassType",void 0),d([X({count:ei.COUNT})],fr.prototype,"normalType",void 0),d([X({count:xs.COUNT})],fr.prototype,"textureCoordinateType",void 0),d([X({count:cE.COUNT})],fr.prototype,"customDepthTest",void 0),d([X()],fr.prototype,"spherical",void 0),d([X()],fr.prototype,"hasVertexColors",void 0),d([X()],fr.prototype,"hasSymbolColors",void 0),d([X()],fr.prototype,"hasVerticalOffset",void 0),d([X()],fr.prototype,"hasSlicePlane",void 0),d([X()],fr.prototype,"hasSliceHighlight",void 0),d([X()],fr.prototype,"hasColorTexture",void 0),d([X()],fr.prototype,"hasMetallicRoughnessTexture",void 0),d([X()],fr.prototype,"hasEmissionTexture",void 0),d([X()],fr.prototype,"hasOcclusionTexture",void 0),d([X()],fr.prototype,"hasNormalTexture",void 0),d([X()],fr.prototype,"hasScreenSizePerspective",void 0),d([X()],fr.prototype,"hasVertexTangents",void 0),d([X()],fr.prototype,"hasOccludees",void 0),d([X()],fr.prototype,"hasMultipassTerrain",void 0),d([X()],fr.prototype,"hasModelTransformation",void 0),d([X()],fr.prototype,"offsetBackfaces",void 0),d([X()],fr.prototype,"vvSize",void 0),d([X()],fr.prototype,"vvColor",void 0),d([X()],fr.prototype,"receiveShadows",void 0),d([X()],fr.prototype,"receiveAmbientOcclusion",void 0),d([X()],fr.prototype,"textureAlphaPremultiplied",void 0),d([X()],fr.prototype,"instanced",void 0),d([X()],fr.prototype,"instancedColor",void 0),d([X()],fr.prototype,"objectAndLayerIdColorInstanced",void 0),d([X()],fr.prototype,"instancedDoublePrecision",void 0),d([X()],fr.prototype,"doublePrecisionRequiresObfuscation",void 0),d([X()],fr.prototype,"writeDepth",void 0),d([X()],fr.prototype,"transparent",void 0),d([X()],fr.prototype,"enableOffset",void 0),d([X()],fr.prototype,"cullAboveGround",void 0),d([X()],fr.prototype,"snowCover",void 0),d([X()],fr.prototype,"hasColorTextureTransform",void 0),d([X()],fr.prototype,"hasEmissionTextureTransform",void 0),d([X()],fr.prototype,"hasNormalTextureTransform",void 0),d([X()],fr.prototype,"hasOcclusionTextureTransform",void 0),d([X()],fr.prototype,"hasMetallicRoughnessTextureTransform",void 0),d([X({constValue:!0})],fr.prototype,"hasVvInstancing",void 0),d([X({constValue:!1})],fr.prototype,"useCustomDTRExponentForWater",void 0),d([X({constValue:!1})],fr.prototype,"supportsTextureAtlas",void 0),d([X({constValue:!0})],fr.prototype,"useFillLights",void 0);function LFt(t){const e=new jr,{vertex:r,fragment:i,varyings:n}=e;return gd(r,t),e.include(xF),n.add("vpos","vec3"),e.include(o_,t),e.include(MVe,t),e.include(y8e,t),t.output!==q.Color&&t.output!==q.Alpha||(hg(e.vertex,t),e.include(kF,t),e.include(nu,t),t.offsetBackfaces&&e.include(PVe),t.instancedColor&&e.attributes.add(O.INSTANCECOLOR,"vec4"),n.add("vNormalWorld","vec3"),n.add("localvpos","vec3"),t.hasMultipassTerrain&&n.add("depth","float"),e.include(Zy,t),e.include(H3,t),e.include(DVe,t),e.include(WE,t),r.uniforms.add(new Cr("externalColor",s=>s.externalColor)),n.add("vcolorExt","vec4"),r.code.add(T`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${t.instancedColor?"vcolorExt *= instanceColor * 0.003921568627451;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${T.float(Ma)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${t.offsetBackfaces?"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${t.hasMultipassTerrain?T`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `)),t.output===q.Alpha&&(e.include(as,t),e.include(M2,t),e.include(Mh,t),i.uniforms.add(new Ye("opacity",s=>s.opacity),new Ye("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Mt("tex",s=>s.texture)),i.include(r4),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        ${t.hasVertexColors?T`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        fragColor = vec4(opacity_);
      }
    `)),t.output===q.Color&&(e.include(as,t),e.include(bE,t),e.include(zF,t),e.include(M2,t),e.include(t.instancedDoublePrecision?QH:vE,t),e.include(Mh,t),hg(e.fragment,t),J_(i),VF(i),K3(i),i.uniforms.add(r.uniforms.get("localOrigin"),r.uniforms.get("view"),new ar("ambient",s=>s.ambient),new ar("diffuse",s=>s.diffuse),new Ye("opacity",s=>s.opacity),new Ye("layerOpacity",s=>s.layerOpacity)),t.hasColorTexture&&i.uniforms.add(new Mt("tex",s=>s.texture)),e.include(qde,t),e.include(fpe,t),i.include(r4),C0(i),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${t.hasColorTexture?T`
                vec4 texColor = texture(tex, ${t.hasColorTextureTransform?T`colorUV`:T`vuv0`});
                ${t.textureAlphaPremultiplied?"texColor.rgb /= texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:T`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${t.pbrMode===Nt.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${t.hasVertexColors?T`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:T`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${t.snowCover?T`albedo = mix(albedo, vec3(1), 0.9);`:T``}
        ${T`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${t.pbrMode===Nt.Normal||t.pbrMode===Nt.Schematic?t.spherical?T`vec3 normalGround = normalize(vpos + localOrigin);`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:T``}
        ${t.pbrMode===Nt.Normal||t.pbrMode===Nt.Schematic?T`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${t.snowCover?T`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:T`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        fragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${t.transparencyPassType===kt.Color?T`fragColor = premultiplyAlpha(fragColor);`:T``}
      }
    `)),e.include(FVe,t),e}const DFt=Object.freeze(Object.defineProperty({__proto__:null,build:LFt},Symbol.toStringTag,{value:"Module"}));let VVe=class BVe extends Tpe{initializeConfiguration(e,r){super.initializeConfiguration(e,r),r.hasMetallicRoughnessTexture=!1,r.hasEmissionTexture=!1,r.hasOcclusionTexture=!1,r.hasNormalTexture=!1,r.hasModelTransformation=!1,r.normalType=ei.Attribute,r.doubleSidedMode=Nn.WindingOrder,r.hasVertexTangents=!1}initializeProgram(e){return this._initializeProgram(e,BVe.shader)}};VVe.shader=new Jr(DFt,()=>le(()=>import("./RealisticTree.glsl-73e6a61a.js"),[]));let g0=class extends Ax{constructor(e){super(e,kFt),this.supportsEdges=!0,this._configuration=new fr,this._vertexBufferLayout=UFt(this.parameters)}isVisibleForOutput(e){return e!==q.Shadow&&e!==q.ShadowExcludeHighlight&&e!==q.ShadowHighlight||this.parameters.castShadows}isVisible(){const e=this.parameters;if(!super.isVisible()||e.layerOpacity===0)return!1;const{hasInstancedColor:r,hasVertexColors:i,hasSymbolColors:n,vvColor:s}=e,o=e.colorMixMode==="replace",a=e.opacity>0,l=e.externalColor&&e.externalColor[3]>0,c=r||s||n;return i&&c?o||a:i?o?l:a:c?o||a:o?l:a}getConfiguration(e,r){return this._configuration.output=e,this._configuration.hasNormalTexture=!!this.parameters.normalTextureId,this._configuration.hasColorTexture=!!this.parameters.textureId,this._configuration.hasVertexTangents=this.parameters.hasVertexTangents,this._configuration.instanced=this.parameters.isInstanced,this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.hasVerticalOffset=this.parameters.verticalOffset!=null,this._configuration.hasScreenSizePerspective=this.parameters.screenSizePerspective!=null,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasSliceHighlight=this.parameters.hasSliceHighlight,this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode,this._configuration.normalType=this.parameters.normalType,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this.parameters.customDepthTest!=null&&(this._configuration.customDepthTest=this.parameters.customDepthTest),this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.cullFace=this.parameters.hasSlicePlane?Hi.None:this.parameters.cullFace,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.hasModelTransformation=this.parameters.modelTransformation!=null,e!==q.Color&&e!==q.Alpha||(this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this.parameters.treeRendering?this._configuration.doubleSidedMode=Nn.WindingOrder:this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Nn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Nn.WindingOrder:Nn.None,this._configuration.instancedColor=this.parameters.hasInstancedColor,this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?Nt.Schematic:Nt.Normal:Nt.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<UH,this._configuration.snowCover=this.hasSnowCover(r),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix),this._configuration}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}intersect(e,r,i,n,s,o){if(this.parameters.verticalOffset!=null){const a=i.camera;se(nZ,r[12],r[13],r[14]);let l=null;switch(i.viewingMode){case at.Global:l=Se(iSe,nZ);break;case at.Local:l=oe(iSe,BFt)}let c=0;const u=ve(jFt,nZ,a.eye),h=We(u),f=ce(u,u,1/h);let m=null;this.parameters.screenSizePerspective&&(m=ye(l,f)),c+=T8e(a,h,this.parameters.verticalOffset,m??0,this.parameters.screenSizePerspective),ce(l,l,c),nd(iZ,l,i.transform.inverseRotation),n=ve(zFt,n,iZ),s=ve(VFt,s,iZ)}b8e(e,i,n,s,tre(i.verticalOffset),o)}requiresSlot(e,r){return r===q.Color||r===q.Alpha||r===q.Depth||r===q.Normal||r===q.Shadow||r===q.ShadowHighlight||r===q.ShadowExcludeHighlight||r===q.Highlight||r===q.ObjectAndLayerIdColor?e===(this.parameters.transparent?this.parameters.writeDepth?_e.TRANSPARENT_MATERIAL:_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:_e.OPAQUE_MATERIAL)||e===_e.DRAPED_MATERIAL:!1}createGLMaterial(e){return new NFt(e)}createBufferWriter(){return new J3(this._vertexBufferLayout)}},NFt=class extends Hde{constructor(e){super({...e,...e.material.parameters})}_updateShadowState(e){e.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:e.shadowMap.enabled})}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output!==q.Color&&this._output!==q.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e));const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return se(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(r.treeRendering?VVe:Tpe,e)}},FFt=class extends MFt{constructor(){super(...arguments),this.initTextureTransparent=!1,this.treeRendering=!1,this.hasVertexTangents=!1}};const kFt=new FFt;function UFt(t){const e=On().vec3f(O.POSITION);return t.normalType===ei.Compressed?e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}):e.vec3f(O.NORMAL),t.hasVertexTangents&&e.vec4f(O.TANGENT),(t.textureId||t.normalTextureId||t.metallicRoughnessTextureId||t.emissiveTextureId||t.occlusionTextureId)&&e.vec2f(O.UV0),t.hasVertexColors&&e.vec4u8(O.COLOR),t.hasSymbolColors&&e.vec4u8(O.SYMBOLCOLOR),he("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),e}const zFt=A(),VFt=A(),BFt=Ue(0,0,1),iSe=A(),iZ=A(),nZ=A(),jFt=A(),GFt=["polygon","extent"];let HFt=class extends A0{constructor(e,r,i,n){super(e,r,i,n),this.ensureDrapedStatus(!1)}async doLoad(){var a,l;if(!this._drivenProperties.size){const c=GH(this._getSymbolSize());if(c)throw new H("graphics3dextrudesymbollayer:invalid-size",c)}const e=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,r=this._getCombinedOpacityAndColor(e),i=mc(r),n=r[3],s=n<1||this.needsDrivenTransparentPass,o={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:i,ambient:i,opacity:n,transparent:s,cullFace:s?Hi.None:Hi.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0,normalType:ei.Compressed};this._material=new g0(o),this._bottomMaterial=new g0({...o,cullFace:Hi.Back}),this._context.stage.add(this._material),this._context.stage.add(this._bottomMaterial)}destroy(){super.destroy(),this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,GFt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r,new yg);return this._createAs3DShape(r,e.renderingInfo,i,n,r.uid)}layerOpacityChanged(e,r){var a,l;const i=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,n=this._getCombinedOpacity(i),s=n<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:n,transparent:s}),this._bottomMaterial.setParameters({opacity:n,transparent:s});const o=this._getLayerOpacity();e.forEach(c=>{const u=r(c);u!=null&&u.layerOpacityChanged(o,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,mx)}slicePlaneEnabledChanged(e,r){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),e.forEach(i=>{const n=r(i);n!=null&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}_getExtrusionSize(e){let r;return r=e.size&&this._drivenProperties.size?yNt(e.size,2)??0:this._getSymbolSize(),r/=this._context.renderCoordsHelper.unitInMeters,r}applyRendererDiff(e,r){return this._drivenPropertiesChanged(r)?Cs.RecreateSymbol:Cs.RecreateGraphics}async queryForSnapping(e,r,i,n){const s=this._getExtrusionSize(i)*this._context.renderCoordsHelper.unitInMeters/SN(r),{objectId:o,target:a}=e,l=ie(a);switch(l.z=(l.z??0)+s,e.type){case"edge":{const{start:c,end:u}=e,h=ie(c),f=ie(u);return h.z=(h.z??0)+s,f.z=(f.z??0)+s,[bxe(o,l,1/0,h,f)]}case"vertex":return[iNt(o,l,1/0),bxe(o,a,1/0,a,l)];default:return[]}}_getSymbolSize(){return this.symbolLayer.size??1}_createAs3DShape(e,r,i,n,s){const o=e4(e.geometry);if(o==null)return null;if(o.rings.length===0||!o.rings.some(P=>P.length>0))return this._logGeometryValidationWarnings(o.rings,"rings","ExtrudeSymbol3DLayer"),null;const a=wpe(o,this._context.elevationProvider,this._context.renderCoordsHelper,n);this._logGeometryCreationWarnings(a,o.rings,"rings","ExtrudeSymbol3DLayer");const l=Ghe(o);if(l==null)return null;const c=new Array,u=new Array,h=To(),f=Me(),m=A(),g=this._context.renderCoordsHelper.viewingMode===at.Global;g||this._context.renderCoordsHelper.worldUpAtPosition(null,m),lu(o.spatialReference,[l.x,l.y,0],f,this._context.renderCoordsHelper.spatialReference);const y=Me();Uo(y,f);const _=vn();ix(_,y);const{polygons:b,mapPositions:w,position:x}=a;for(const P of b){const D=P.count;if(this._context.clippingExtent&&(en(h),ph(h,P.mapPositions),!km(h,this._context.clippingExtent)))continue;const L=e3(P.mapPositions,P.holeIndices,3);if(L.length===0)continue;const k=L.length,V=6*D,W=$B(V+k),G=$B(k),B=sl(3*V),Z=sl(3*V),M=sl(3*V),$=sl(V);qFt(x,w,L,P,B,M,Z,$,W,G,this._getExtrusionSize(r),m,g),t3(B,B,y);const N=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:s,layerUid:this._context.layer.uid}),j=new JFt(B,M,mFt(Z),$);c.push(nSe(this._material,W,W.length-G.length,j,i,N),nSe(this._bottomMaterial,G,0,j,i,N)),u.push(j.heights)}if(c.length===0)return null;const S=new a1({geometries:c,layerUid:this._context.layer.uid,graphicUid:s,isElevationSource:!0});S.transformation=f;const C=Yze(this.symbolLayer,{opacity:this._getLayerOpacity()}),E=C!=null?{baseMaterial:this._material,edgeMaterials:[C],properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null,R=new O0(this,S,c,null,null,(P,D,L,k,V)=>YFt(P,D,L,k,V,u),n,E);return R.alignedSampledElevation=a.sampledElevation,R.needsElevationUpdates=mx(n.mode),R}};function nSe(t,e,r,i,n,s){const o=q3(e.length),a=[[O.POSITION,new ft(i.positions,3,!0)],[O.NORMALCOMPRESSED,new ft(i.normals,2,!0)],[O.COLOR,new ft(n,4,!0)]],l=[[O.POSITION,e],[O.NORMALCOMPRESSED,e],[O.COLOR,o]];return new Us(t,a,l,i.elevation,Wn.Mesh,s,r)}function qFt(t,e,r,i,n,s,o,a,l,c,u,h,f){const m=r.length/3;let g=0,y=2*i.count;WFt(t,e,i.index,i.count,r,0,m,n,s,o,a,l,c,y,u,h,f);let _=2*i.count;y=0,sSe(n,s,a,o,g,i.pathLengths[0],i.count,_,l,y,u),_+=4*i.pathLengths[0],y+=2*i.pathLengths[0],g+=i.pathLengths[0];for(let b=1;b<i.pathLengths.length;++b)sSe(n,s,a,o,g,i.pathLengths[b],i.count,_,l,y,u),_+=4*i.pathLengths[b],y+=2*i.pathLengths[b],g+=i.pathLengths[b]}function WFt(t,e,r,i,n,s,o,a,l,c,u,h,f,m,g,y,_){oe(Fc,y);const b=g>0?1:-1;let w=3*r,x=0,S=3*x,C=i,E=3*C;for(let D=0;D<i;++D)_&&(Fc[0]=t[w],Fc[1]=t[w+1],Fc[2]=t[w+2],Se(Fc,Fc)),a[S]=t[w],a[S+1]=t[w+1],a[S+2]=t[w+2],l[S]=e[w],l[S+1]=e[w+1],l[S+2]=e[w+2],c[S]=-b*Fc[0],c[S+1]=-b*Fc[1],c[S+2]=-b*Fc[2],u[x]=0,a[E]=t[w]+g*Fc[0],a[E+1]=t[w+1]+g*Fc[1],a[E+2]=t[w+2]+g*Fc[2],l[E]=e[w],l[E+1]=e[w+1],l[E+2]=e[w+2],c[E]=b*Fc[0],c[E+1]=b*Fc[1],c[E+2]=b*Fc[2],u[C]=g,S+=3,E+=3,w+=3,x+=1,C+=1;w=3*s,S=0,E=3*m;const R=g<0?dSe:uSe,P=g<0?uSe:dSe;for(let D=0;D<o;++D)f[S]=n[w+R[0]],f[S+1]=n[w+R[1]],f[S+2]=n[w+R[2]],h[E]=n[w+P[0]]+i,h[E+1]=n[w+P[1]]+i,h[E+2]=n[w+P[2]]+i,S+=3,E+=3,w+=3}function S6(t,e,r,i,n,s,o){i[s]=i[o],o*=3,t[s*=3]=t[o],t[s+1]=t[o+1],t[s+2]=t[o+2],e[s]=e[o],e[s+1]=e[o+1],e[s+2]=e[o+2],r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2]}const o$=A();function sSe(t,e,r,i,n,s,o,a,l,c,u){let h=n,f=n+1,m=n+o,g=n+o+1,y=a,_=a+1,b=a+2*s,w=a+2*s+1;u<0&&(h=n+o+1,g=n),c*=3;for(let x=0;x<s;++x)x===s-1&&(u>0?(f=n,g=n+o):(f=n,h=n+o)),XFt(t,h,f,m,o$),S6(t,e,i,r,o$,y,h),S6(t,e,i,r,o$,_,f),S6(t,e,i,r,o$,b,m),S6(t,e,i,r,o$,w,g),l[c++]=y,l[c++]=b,l[c++]=w,l[c++]=y,l[c++]=w,l[c++]=_,h++,f++,m++,g++,y+=2,_+=2,b+=2,w+=2}const sZ=A(),oSe=A(),aSe=A(),lSe=A(),cSe=A();function XFt(t,e,r,i,n){e*=3,r*=3,i*=3,se(sZ,t[e++],t[e++],t[e++]),se(oSe,t[r++],t[r++],t[r++]),se(aSe,t[i++],t[i++],t[i++]),ve(lSe,oSe,sZ),ve(cSe,aSe,sZ),Lt(n,cSe,lSe),Se(n,n)}const FC=A();function YFt(t,e,r,i,n,s){const o=t.stageObject,a=o.geometries,l=a.length,c=e.mode!=="absolute-height";let u=0;const h=o.transformation,f=A3(Me(),h);for(let m=0;m<l;m+=2){const g=a[m];if(!qhe(g))continue;const y=g.getMutableAttribute(O.POSITION).data,_=s[m/2],b=new _de(g.mapPositions),w=y.length/3;let x=0,S=!1,C=0;for(let E=0;E<w;E++){FC[0]=y[x],FC[1]=y[x+1],FC[2]=y[x+2],i(b,T6),c&&(C+=T6.sampledElevation),Di.TESTS_DISABLE_OPTIMIZATIONS?(se(Su,b.array[b.offset],b.array[b.offset+1],T6.z+_[x/3]),r!=null&&n.toRenderCoords(Su,r,Su),lt(Su,Su,f)):(se(Su,y[x],y[x+1],y[x+2]),lt(Su,Su,h),n.setAltitude(Su,T6.z+_[x/3]),lt(Su,Su,f)),y[x]=Su[0],y[x+1]=Su[1],y[x+2]=Su[2];const R=ZFt/n.unitInMeters;(Math.abs(FC[0]-y[x])>=R||Math.abs(FC[1]-y[x+1])>=R||Math.abs(FC[2]-y[x+2])>=R)&&(S=!0),b.offset+=3,x+=3}S&&(g.invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m]),a[m+1].invalidateBoundingInfo(),o.geometryVertexAttrsUpdated(a[m+1])),u+=C/w}return u/l}const Su=A(),Fc=A(),T6=new DF,uSe=[0,2,1],dSe=[0,1,2],ZFt=.01;let JFt=class{constructor(e,r,i,n){this.positions=e,this.elevation=r,this.normals=i,this.heights=n}};function rq(){const t=new Float32Array(16);return t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function KFt(t){const e=new Float32Array(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function QFt(t,e,r,i,n,s,o,a,l,c,u,h,f,m,g,y){const _=new Float32Array(16);return _[0]=t,_[1]=e,_[2]=r,_[3]=i,_[4]=n,_[5]=s,_[6]=o,_[7]=a,_[8]=l,_[9]=c,_[10]=u,_[11]=h,_[12]=f,_[13]=m,_[14]=g,_[15]=y,_}function e5t(t,e){return new Float32Array(t,e,16)}const t5t=rq();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:t5t,clone:KFt,create:rq,createView:e5t,fromValues:QFt},Symbol.toStringTag,{value:"Module"}));const r5t=(t,e)=>{const r=S0(t,e,0,0,0,0,e,0,0,0,0,e,0,0,0,0,1);return Td(r,r)},i5t=(t,e)=>{const r=S0(t,e,0,0,.5-.5*e,0,e,0,.5-.5*e,0,0,e,.5-.5*e,0,0,0,1);return Td(r,r)},n5t=(t,e)=>{const r=1-e,i=S0(t,.2126+.7874*r,.7152-.7152*r,.0722-.0722*r,0,.2126-.2126*r,.7152+.2848*r,.0722-.0722*r,0,.2126-.2126*r,.7152-.7152*r,.0722+.9278*r,0,0,0,0,1);return Td(i,i)},s5t=(t,e)=>{const r=Math.sin(e*Math.PI/180),i=Math.cos(e*Math.PI/180),n=S0(t,.213+.787*i-.213*r,.715-.715*i-.715*r,.072-.072*i+.928*r,0,.213-.213*i+.143*r,.715+.285*i+.14*r,.072-.072*i-.283*r,0,.213-.213*i-.787*r,.715-.715*i+.715*r,.072+.928*i+.072*r,0,0,0,0,1);return Td(n,n)},o5t=(t,e)=>{const r=1-2*e,i=S0(t,r,0,0,e,0,r,0,e,0,0,r,e,0,0,0,1);return Td(i,i)},a5t=(t,e)=>{const r=S0(t,.213+.787*e,.715-.715*e,.072-.072*e,0,.213-.213*e,.715+.285*e,.072-.072*e,0,.213-.213*e,.715-.715*e,.072+.928*e,0,0,0,0,1);return Td(r,r)},l5t=(t,e)=>{const r=1-e,i=S0(t,.393+.607*r,.769-.769*r,.189-.189*r,0,.349-.349*r,.686+.314*r,.168-.168*r,0,.272-.272*r,.534-.534*r,.131+.869*r,0,0,0,0,1);return Td(i,i)};let jVe=class GVe{constructor(e,r,i){this.strength=e,this.radius=r,this.threshold=i,this.type="bloom"}interpolate(e,r,i){this.strength=Yu(e.strength,r.strength,i),this.radius=Yu(e.radius,r.radius,i),this.threshold=Yu(e.threshold,r.threshold,i)}clone(){return new GVe(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:RD(this.radius),strength:this.strength,threshold:this.threshold}}},HVe=class qVe{constructor(e){this.radius=e,this.type="blur"}interpolate(e,r,i){this.radius=Math.round(Yu(e.radius,r.radius,i))}clone(){return new qVe(this.radius)}toJSON(){return{type:"blur",radius:RD(this.radius)}}},dne=class WVe{constructor(e,r){this.type=e,this.amount=r,this.type!=="invert"&&this.type!=="grayscale"&&this.type!=="sepia"||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.amount=Yu(e.amount,r.amount,i),this._updateMatrix()}clone(){return new WVe(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||rq();switch(this.type){case"brightness":this._colorMatrix=r5t(e,this.amount);break;case"contrast":this._colorMatrix=i5t(e,this.amount);break;case"grayscale":this._colorMatrix=n5t(e,this.amount);break;case"invert":this._colorMatrix=o5t(e,this.amount);break;case"saturate":this._colorMatrix=a5t(e,this.amount);break;case"sepia":this._colorMatrix=l5t(e,this.amount)}}},XVe=class YVe{constructor(e,r,i,n){this.offsetX=e,this.offsetY=r,this.blurRadius=i,this.color=n,this.type="drop-shadow"}interpolate(e,r,i){this.offsetX=Yu(e.offsetX,r.offsetX,i),this.offsetY=Yu(e.offsetY,r.offsetY,i),this.blurRadius=Yu(e.blurRadius,r.blurRadius,i),this.color[0]=Math.round(Yu(e.color[0],r.color[0],i)),this.color[1]=Math.round(Yu(e.color[1],r.color[1],i)),this.color[2]=Math.round(Yu(e.color[2],r.color[2],i)),this.color[3]=Yu(e.color[3],r.color[3],i)}clone(){return new YVe(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:RD(this.offsetX),yoffset:RD(this.offsetY),blurRadius:RD(this.blurRadius),color:e}}},ZVe=class JVe{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,r,i){this.angle=Yu(e.angle,r.angle,i),this._updateMatrix()}clone(){return new JVe(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||rq();this._colorMatrix=s5t(e,this.angle)}},KVe=class QVe{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,r,i){this.amount=Yu(e.amount,r.amount,i)}clone(){return new QVe(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}};function Yu(t,e,r){return t+(e-t)*r}function RD(t){return Math.round(1e3*Rh(t))/1e3}function c5t(t){switch(t.type){case"grayscale":case"sepia":case"invert":return new dne(t.type,0);case"saturate":case"brightness":case"contrast":return new dne(t.type,1);case"opacity":return new KVe(1);case"hue-rotate":return new ZVe(0);case"blur":return new HVe(0);case"drop-shadow":return new XVe(0,0,0,[...$ce("transparent")]);case"bloom":return new jVe(0,0,1)}}function u5t(t,e){const r=t.length>e.length?t:e;return(t.length>e.length?e:t).every((i,n)=>i.type===r[n].type)}function d5t(t,e){const r=t.length>e.length?t:e,i=t.length>e.length?e:t;for(let n=i.length;n<r.length;n++)i.push(c5t(r[n]))}function h5t(t){const e=t[0];return!!e&&"type"in e}var hSe,pSe,hne={exports:{}};hne.exports,pSe=function(){function t(n,s){function o(){this.constructor=n}o.prototype=s.prototype,n.prototype=new o}function e(n,s,o,a){var l=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(l,e.prototype),l.expected=s,l.found=o,l.location=a,l.name="SyntaxError",l}function r(n,s,o){return o=o||" ",n.length>s?n:(s-=n.length,n+(o+=o.repeat(s)).slice(0,s))}function i(n,s){var o,a={},l=(s=s!==void 0?s:{}).grammarSource,c={start:Ar},u=Ar,h="none",f=")",m=",",g="(",y="%",_="px",b="cm",w="mm",x="in",S="pt",C="pc",E="deg",R="rad",P="grad",D="turn",L="#",k=".",V="e",W=/^[ \t\n\r]/,G=/^[a-z\-]/,B=/^[0-9a-fA-F]/,Z=/^[+\-]/,M=/^[0-9]/,$=Ba("none"),N=Vs("none",!1),j=Vs(")",!1),J=Vs(",",!1),K=Ba("whitespace"),te=bg([" ","	",`
`,"\r"],!1,!1),ae=Ba("function"),be=Vs("(",!1),Ee=Ba("identifier"),Je=bg([["a","z"],"-"],!1,!1),ze=Ba("percentage"),Ge=Vs("%",!1),Le=Ba("length"),de=Vs("px",!1),$e=Vs("cm",!1),Be=Vs("mm",!1),we=Vs("in",!1),Ie=Vs("pt",!1),je=Vs("pc",!1),fe=Ba("angle"),Ae=Vs("deg",!1),gt=Vs("rad",!1),Re=Vs("grad",!1),He=Vs("turn",!1),Dt=Ba("number"),Fe=Ba("color"),nt=Vs("#",!1),Ke=bg([["0","9"],["a","f"],["A","F"]],!1,!1),mt=bg(["+","-"],!1,!1),wt=bg([["0","9"]],!1,!1),xt=Vs(".",!1),st=Vs("e",!1),Xe=function(){return[]},it=function(Q,xe){return{type:"function",name:Q,parameters:xe||[]}},Oe=function(Q,xe){return xe.length>0?lM(Q,xe,3):[Q]},Ze=function(Q){return{type:"quantity",value:Q.value,unit:Q.unit}},At=function(Q){return{type:"color",colorType:Q.type,value:Q.value}},_t=function(Q){return Q},cr=function(){return Va()},pr=function(Q){return{value:Q,unit:"%"}},kr=function(Q){return{value:Q,unit:"px"}},Gr=function(Q){return{value:Q,unit:"cm"}},Ir=function(Q){return{value:Q,unit:"mm"}},_i=function(Q){return{value:Q,unit:"in"}},Wi=function(Q){return{value:Q,unit:"pt"}},Qs=function(Q){return{value:Q,unit:"pc"}},eo=function(Q){return{value:Q,unit:"deg"}},to=function(Q){return{value:Q,unit:"rad"}},ro=function(Q){return{value:Q,unit:"grad"}},tn=function(Q){return{value:Q,unit:"turn"}},rn=function(Q){return{value:Q,unit:null}},pi=function(){return{type:"hex",value:Va()}},io=function(Q){return{type:"function",value:Q}},no=function(){return{type:"named",value:Va()}},za=function(){return parseFloat(Va())},ue=0,bi=0,zs=[{line:1,column:1}],Jn=0,Pd=[],yt=0;if("startRule"in s){if(!(s.startRule in c))throw new Error(`Can't start parsing from rule "`+s.startRule+'".');u=c[s.startRule]}function Va(){return n.substring(bi,ue)}function Vs(Q,xe){return{type:"literal",text:Q,ignoreCase:xe}}function bg(Q,xe,Ve){return{type:"class",parts:Q,inverted:xe,ignoreCase:Ve}}function wg(){return{type:"end"}}function Ba(Q){return{type:"other",description:Q}}function Ef(Q){var xe,Ve=zs[Q];if(Ve)return Ve;for(xe=Q-1;!zs[xe];)xe--;for(Ve={line:(Ve=zs[xe]).line,column:Ve.column};xe<Q;)n.charCodeAt(xe)===10?(Ve.line++,Ve.column=1):Ve.column++,xe++;return zs[Q]=Ve,Ve}function $0(Q,xe,Ve){var Lr=Ef(Q),Bs=Ef(xe),Xi={source:l,start:{offset:Q,line:Lr.line,column:Lr.column},end:{offset:xe,line:Bs.line,column:Bs.column}};return Ve&&l&&typeof l.offset=="function"&&(Xi.start=l.offset(Xi.start),Xi.end=l.offset(Xi.end)),Xi}function gr(Q){ue<Jn||(ue>Jn&&(Jn=ue,Pd=[]),Pd.push(Q))}function xg(Q,xe,Ve){return new e(e.buildMessage(Q,xe),Q,xe,Ve)}function Ar(){var Q;return(Q=so())===a&&(Q=Gl()),Q}function so(){var Q,xe;return yt++,Q=ue,Un(),n.substr(ue,4)===h?(xe=h,ue+=4):(xe=a,yt===0&&gr(N)),xe!==a?(Un(),bi=Q,Q=Xe()):(ue=Q,Q=a),yt--,Q===a&&yt===0&&gr($),Q}function Gl(){var Q,xe;if(Q=[],(xe=_u())!==a)for(;xe!==a;)Q.push(xe),xe=_u();else Q=a;return Q}function _u(){var Q,xe,Ve,Lr;return Q=ue,Un(),(xe=d1())!==a?(Un(),(Ve=Sg())===a&&(Ve=null),Un(),n.charCodeAt(ue)===41?(Lr=f,ue++):(Lr=a,yt===0&&gr(j)),Lr!==a?(Un(),bi=Q,Q=it(xe,Ve)):(ue=Q,Q=a)):(ue=Q,Q=a),Q}function Sg(){var Q,xe,Ve,Lr,Bs,Xi,Hl,Fx;if(Q=ue,(xe=Bo())!==a){for(Ve=[],Lr=ue,Bs=Un(),n.charCodeAt(ue)===44?(Xi=m,ue++):(Xi=a,yt===0&&gr(J)),Xi===a&&(Xi=null),Hl=Un(),(Fx=Bo())!==a?Lr=Bs=[Bs,Xi,Hl,Fx]:(ue=Lr,Lr=a);Lr!==a;)Ve.push(Lr),Lr=ue,Bs=Un(),n.charCodeAt(ue)===44?(Xi=m,ue++):(Xi=a,yt===0&&gr(J)),Xi===a&&(Xi=null),Hl=Un(),(Fx=Bo())!==a?Lr=Bs=[Bs,Xi,Hl,Fx]:(ue=Lr,Lr=a);bi=Q,Q=Oe(xe,Ve)}else ue=Q,Q=a;return Q}function Bo(){var Q,xe;return Q=ue,(xe=Dx())===a&&(xe=KE())===a&&(xe=Nx())===a&&(xe=h1()),xe!==a&&(bi=Q,xe=Ze(xe)),(Q=xe)===a&&(Q=ue,(xe=s5())!==a&&(bi=Q,xe=At(xe)),Q=xe),Q}function Un(){var Q,xe;for(yt++,Q=[],W.test(n.charAt(ue))?(xe=n.charAt(ue),ue++):(xe=a,yt===0&&gr(te));xe!==a;)Q.push(xe),W.test(n.charAt(ue))?(xe=n.charAt(ue),ue++):(xe=a,yt===0&&gr(te));return yt--,xe=a,yt===0&&gr(K),Q}function d1(){var Q,xe,Ve;return yt++,Q=ue,(xe=Lx())!==a?(n.charCodeAt(ue)===40?(Ve=g,ue++):(Ve=a,yt===0&&gr(be)),Ve!==a?(bi=Q,Q=_t(xe)):(ue=Q,Q=a)):(ue=Q,Q=a),yt--,Q===a&&(xe=a,yt===0&&gr(ae)),Q}function Lx(){var Q,xe,Ve;if(yt++,Q=ue,xe=[],G.test(n.charAt(ue))?(Ve=n.charAt(ue),ue++):(Ve=a,yt===0&&gr(Je)),Ve!==a)for(;Ve!==a;)xe.push(Ve),G.test(n.charAt(ue))?(Ve=n.charAt(ue),ue++):(Ve=a,yt===0&&gr(Je));else xe=a;return xe!==a&&(bi=Q,xe=cr()),yt--,(Q=xe)===a&&(xe=a,yt===0&&gr(Ee)),Q}function Dx(){var Q,xe,Ve;return yt++,Q=ue,Un(),(xe=Mc())!==a?(n.charCodeAt(ue)===37?(Ve=y,ue++):(Ve=a,yt===0&&gr(Ge)),Ve!==a?(bi=Q,Q=pr(xe)):(ue=Q,Q=a)):(ue=Q,Q=a),yt--,Q===a&&yt===0&&gr(ze),Q}function KE(){var Q,xe,Ve;return yt++,Q=ue,Un(),(xe=Mc())!==a?(n.substr(ue,2)===_?(Ve=_,ue+=2):(Ve=a,yt===0&&gr(de)),Ve!==a?(bi=Q,Q=kr(xe)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,Un(),(xe=Mc())!==a?(n.substr(ue,2)===b?(Ve=b,ue+=2):(Ve=a,yt===0&&gr($e)),Ve!==a?(bi=Q,Q=Gr(xe)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,Un(),(xe=Mc())!==a?(n.substr(ue,2)===w?(Ve=w,ue+=2):(Ve=a,yt===0&&gr(Be)),Ve!==a?(bi=Q,Q=Ir(xe)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,Un(),(xe=Mc())!==a?(n.substr(ue,2)===x?(Ve=x,ue+=2):(Ve=a,yt===0&&gr(we)),Ve!==a?(bi=Q,Q=_i(xe)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,Un(),(xe=Mc())!==a?(n.substr(ue,2)===S?(Ve=S,ue+=2):(Ve=a,yt===0&&gr(Ie)),Ve!==a?(bi=Q,Q=Wi(xe)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,Un(),(xe=Mc())!==a?(n.substr(ue,2)===C?(Ve=C,ue+=2):(Ve=a,yt===0&&gr(je)),Ve!==a?(bi=Q,Q=Qs(xe)):(ue=Q,Q=a)):(ue=Q,Q=a)))))),yt--,Q===a&&yt===0&&gr(Le),Q}function Nx(){var Q,xe,Ve;return yt++,Q=ue,(xe=Mc())!==a?(n.substr(ue,3)===E?(Ve=E,ue+=3):(Ve=a,yt===0&&gr(Ae)),Ve!==a?(bi=Q,Q=eo(xe)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,(xe=Mc())!==a?(n.substr(ue,3)===R?(Ve=R,ue+=3):(Ve=a,yt===0&&gr(gt)),Ve!==a?(bi=Q,Q=to(xe)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,(xe=Mc())!==a?(n.substr(ue,4)===P?(Ve=P,ue+=4):(Ve=a,yt===0&&gr(Re)),Ve!==a?(bi=Q,Q=ro(xe)):(ue=Q,Q=a)):(ue=Q,Q=a),Q===a&&(Q=ue,(xe=Mc())!==a?(n.substr(ue,4)===D?(Ve=D,ue+=4):(Ve=a,yt===0&&gr(He)),Ve!==a?(bi=Q,Q=tn(xe)):(ue=Q,Q=a)):(ue=Q,Q=a)))),yt--,Q===a&&(xe=a,yt===0&&gr(fe)),Q}function h1(){var Q,xe;return yt++,Q=ue,Un(),(xe=Mc())!==a?(bi=Q,Q=rn(xe)):(ue=Q,Q=a),yt--,Q===a&&yt===0&&gr(Dt),Q}function s5(){var Q,xe,Ve,Lr;if(yt++,Q=ue,n.charCodeAt(ue)===35?(xe=L,ue++):(xe=a,yt===0&&gr(nt)),xe!==a){if(Ve=[],B.test(n.charAt(ue))?(Lr=n.charAt(ue),ue++):(Lr=a,yt===0&&gr(Ke)),Lr!==a)for(;Lr!==a;)Ve.push(Lr),B.test(n.charAt(ue))?(Lr=n.charAt(ue),ue++):(Lr=a,yt===0&&gr(Ke));else Ve=a;Ve!==a?(bi=Q,Q=pi()):(ue=Q,Q=a)}else ue=Q,Q=a;return Q===a&&(Q=ue,(xe=_u())!==a&&(bi=Q,xe=io(xe)),(Q=xe)===a&&(Q=ue,(xe=Lx())!==a&&(bi=Q,xe=no()),Q=xe)),yt--,Q===a&&(xe=a,yt===0&&gr(Fe)),Q}function Mc(){var Q,xe,Ve,Lr,Bs,Xi,Hl;for(Q=ue,Z.test(n.charAt(ue))?(n.charAt(ue),ue++):yt===0&&gr(mt),xe=ue,Ve=[],M.test(n.charAt(ue))?(Lr=n.charAt(ue),ue++):(Lr=a,yt===0&&gr(wt));Lr!==a;)Ve.push(Lr),M.test(n.charAt(ue))?(Lr=n.charAt(ue),ue++):(Lr=a,yt===0&&gr(wt));if(n.charCodeAt(ue)===46?(Lr=k,ue++):(Lr=a,yt===0&&gr(xt)),Lr!==a){if(Bs=[],M.test(n.charAt(ue))?(Xi=n.charAt(ue),ue++):(Xi=a,yt===0&&gr(wt)),Xi!==a)for(;Xi!==a;)Bs.push(Xi),M.test(n.charAt(ue))?(Xi=n.charAt(ue),ue++):(Xi=a,yt===0&&gr(wt));else Bs=a;Bs!==a?xe=Ve=[Ve,Lr,Bs]:(ue=xe,xe=a)}else ue=xe,xe=a;if(xe===a)if(xe=[],M.test(n.charAt(ue))?(Ve=n.charAt(ue),ue++):(Ve=a,yt===0&&gr(wt)),Ve!==a)for(;Ve!==a;)xe.push(Ve),M.test(n.charAt(ue))?(Ve=n.charAt(ue),ue++):(Ve=a,yt===0&&gr(wt));else xe=a;if(xe!==a){if(Ve=ue,n.charCodeAt(ue)===101?(Lr=V,ue++):(Lr=a,yt===0&&gr(st)),Lr!==a){if(Z.test(n.charAt(ue))?(Bs=n.charAt(ue),ue++):(Bs=a,yt===0&&gr(mt)),Bs===a&&(Bs=null),Xi=[],M.test(n.charAt(ue))?(Hl=n.charAt(ue),ue++):(Hl=a,yt===0&&gr(wt)),Hl!==a)for(;Hl!==a;)Xi.push(Hl),M.test(n.charAt(ue))?(Hl=n.charAt(ue),ue++):(Hl=a,yt===0&&gr(wt));else Xi=a;Xi!==a?Ve=Lr=[Lr,Bs,Xi]:(ue=Ve,Ve=a)}else ue=Ve,Ve=a;Ve===a&&(Ve=null),bi=Q,Q=za()}else ue=Q,Q=a;return Q}function aM(Q,xe){return Q.map(function(Ve){return Ve[xe]})}function lM(Q,xe,Ve){return[Q].concat(aM(xe,Ve))}if((o=u())!==a&&ue===n.length)return o;throw o!==a&&ue<n.length&&gr(wg()),xg(Pd,Jn<n.length?n.charAt(Jn):null,Jn<n.length?$0(Jn,Jn+1):$0(Jn,Jn))}return t(e,Error),e.prototype.format=function(n){var s="Error: "+this.message;if(this.location){var o,a=null;for(o=0;o<n.length;o++)if(n[o].source===this.location.source){a=n[o].text.split(/\r\n|\n|\r/g);break}var l=this.location.start,c=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(l):l,u=this.location.source+":"+c.line+":"+c.column;if(a){var h=this.location.end,f=r("",c.line.toString().length," "),m=a[l.line-1],g=(l.line===h.line?h.column:m.length+1)-l.column||1;s+=`
 --> `+u+`
`+f+` |
`+c.line+" | "+m+`
`+f+" | "+r("",l.column-1," ")+r("",g,"^")}else s+=`
 at `+u}return s},e.buildMessage=function(n,s){var o={literal:function(m){return'"'+l(m.text)+'"'},class:function(m){var g=m.parts.map(function(y){return Array.isArray(y)?c(y[0])+"-"+c(y[1]):c(y)});return"["+(m.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(m){return m.description}};function a(m){return m.charCodeAt(0).toString(16).toUpperCase()}function l(m){return m.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function c(m){return m.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+a(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+a(g)})}function u(m){return o[m.type](m)}function h(m){var g,y,_=m.map(u);if(_.sort(),_.length>0){for(g=1,y=1;g<_.length;g++)_[g-1]!==_[g]&&(_[y]=_[g],y++);_.length=y}switch(_.length){case 1:return _[0];case 2:return _[0]+" or "+_[1];default:return _.slice(0,-1).join(", ")+", or "+_[_.length-1]}}function f(m){return m?'"'+l(m)+'"':"end of input"}return"Expected "+h(n)+" but "+f(s)+" found."},{SyntaxError:e,parse:i}},(hSe=hne).exports&&(hSe.exports=pSe());var p5t=hne.exports;function eBe(t){if(!t||t.length===0)return null;if(typeof t=="string"){const r=fSe(t);return r&&r.length!==0?r:null}const e=t.map(r=>{if(!Number.isFinite(r.scale)||r.scale<=0)throw new H("effect:invalid-scale","scale must be finite and greater than 0",{stop:r});return{scale:r.scale,effects:fSe(r.value)}});e.sort((r,i)=>i.effects.length-r.effects.length);for(let r=0;r<e.length-1;r++){if(!u5t(e[r].effects,e[r+1].effects))throw new H("effect:interpolation-impossible","Cannot interpolate by scale between 2 lists of mixed effects",{a:e[r].effects,b:e[r+1].effects});d5t(e[r].effects,e[r+1].effects)}return e.sort((r,i)=>i.scale-r.scale),e}function fSe(t){let e;if(!t)return[];try{e=p5t.parse(t)}catch(r){throw new H("effect:invalid-syntax","Invalid effect syntax",{value:t,error:r})}return e.map(r=>f5t(r))}function f5t(t){try{switch(t.name){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":return m5t(t);case"opacity":return g5t(t);case"hue-rotate":return y5t(t);case"blur":return v5t(t);case"drop-shadow":return _5t(t);case"bloom":return b5t(t)}}catch(e){throw e.details.filter=t,e}throw new H("effect:unknown-effect",`Effect '${t.name}' is not supported`,{effect:t})}function m5t(t){let e=1;return Q3(t.parameters,1),t.parameters.length===1&&(e=wm(t.parameters[0])),new dne(t.name,e)}function g5t(t){let e=1;return Q3(t.parameters,1),t.parameters.length===1&&(e=wm(t.parameters[0])),new KVe(e)}function y5t(t){let e=0;return Q3(t.parameters,1),t.parameters.length===1&&(e=C5t(t.parameters[0])),new ZVe(e)}function v5t(t){let e=0;return Q3(t.parameters,1),t.parameters.length===1&&(e=Rpe(t.parameters[0]),BF(e,t.parameters[0])),new HVe(e)}function _5t(t){const e=[];let r=null;for(const i of t.parameters)if(i.type==="color"){if(e.length&&Object.freeze(e),r)throw new H("effect:type-error","Accepts only one color",{});r=R5t(i)}else{const n=Rpe(i);if(Object.isFrozen(e))throw new H("effect:type-error","<length> parameters not consecutive",{lengths:e});e.push(n),e.length===3&&BF(n,i)}if(e.length<2||e.length>3)throw new H("effect:type-error",`Expected <length>{2,3}, Actual: <length>{${e.length}}`,{lengths:e});return new XVe(e[0],e[1],e[2]||0,r||tBe("black"))}function b5t(t){let e=1,r=0,i=0;return Q3(t.parameters,3),t.parameters[0]&&(e=wm(t.parameters[0])),t.parameters[1]&&(r=Rpe(t.parameters[1]),BF(r,t.parameters[1])),t.parameters[2]&&(i=wm(t.parameters[2])),new jVe(e,r,i)}function Q3(t,e){if(t.length>e)throw new H("effect:type-error",`Function supports up to ${e} parameters, Actual: ${t.length}`,{parameters:t})}function iq(t){if(t.type==="color")return"<color>";if(t.unit){if(t.unit in Cpe)return"<length>";if(t.unit in Epe)return"<angle>";if(t.unit==="%")return"<percentage>"}return"<double>"}function BF(t,e){if(t<0)throw new H("effect:type-error",`Negative values are not allowed, Actual: ${t}`,{term:e})}function w5t(t){if(t.type!=="quantity"||t.unit!==null)throw new H("effect:type-error",`Expected <double>, Actual: ${iq(t)}`,{term:t})}function x5t(t){if(t.type!=="quantity"||t.unit!==null&&t.unit!=="%")throw new H("effect:type-error",`Expected <double> or <percentage>, Actual: ${iq(t)}`,{term:t})}const Epe={deg:1,grad:.9,rad:180/Math.PI,turn:360};function S5t(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Epe[t.unit]!=null))throw new H("effect:type-error",`Expected <angle>, Actual: ${iq(t)}`,{term:t})}const Cpe={px:1,cm:96/2.54,mm:96/2.54/10,in:96,pc:16,pt:96/72};function T5t(t){if(t.type!=="quantity"||!(t.value===0&&t.unit===null||t.unit&&Cpe[t.unit]!=null))throw new H("effect:type-error",`Expected <length>, Actual: ${iq(t)}`,{term:t})}function wm(t){x5t(t);const e=t.value;return BF(e,t),t.unit==="%"?.01*e:e}function E5t(t){return w5t(t),BF(t.value,t),t.value}function C5t(t){return S5t(t),t.value*Epe[t.unit]||0}function Rpe(t){return T5t(t),t.value*Cpe[t.unit]||0}function R5t(t){switch(t.colorType){case"hex":return Eft(t.value);case"named":return tBe(t.value);case"function":return P5t(t.value)}}function tBe(t){if(!eLe(t))throw new H("effect:unknown-color",`color '${t}' isn't valid`,{namedColor:t});return Tft(t)}const O5t=/^rgba?/i,A5t=/^hsla?/i;function P5t(t){if(Q3(t.parameters,4),O5t.test(t.name))return[wm(t.parameters[0]),wm(t.parameters[1]),wm(t.parameters[2]),t.parameters[3]?wm(t.parameters[3]):1];if(A5t.test(t.name))return tLe(E5t(t.parameters[0]),wm(t.parameters[1]),wm(t.parameters[2]),t.parameters[3]?wm(t.parameters[3]):1);throw new H("effect:syntax-error",`Invalid color function '${t.name}'`,{colorFunction:t})}function Ope(t,e,r){var i;try{return $5t(t)}catch(n){(i=r==null?void 0:r.messages)==null||i.push(n)}return null}function Ape(t,e,r,i){try{const n=M5t(t);Rc(r,n,e)}catch(n){i.messages&&i.messages.push(n)}}function M5t(t){const e=eBe(t);return e?h5t(e)?e.map(r=>r.toJSON()):e.map(({scale:r,effects:i})=>({scale:r,value:i.map(n=>n.toJSON())})):null}function $5t(t){if(!t||t.length===0)return null;if(I5t(t)){const e=[];for(const r of t)e.push({scale:r.scale,value:pne(r.value)});return e}return pne(t)}function I5t(t){const e=t[0];return!!e&&"scale"in e}function pne(t){if(!t||!t.length)return"";const e=[];for(const r of t){let i=[];switch(r.type){case"grayscale":case"sepia":case"saturate":case"invert":case"brightness":case"contrast":case"opacity":i=[z0(r,"amount")];break;case"blur":i=[z0(r,"radius","pt")];break;case"hue-rotate":i=[z0(r,"angle","deg")];break;case"drop-shadow":i=[z0(r,"xoffset","pt"),z0(r,"yoffset","pt"),z0(r,"blurRadius","pt"),L5t(r,"color")];break;case"bloom":i=[z0(r,"strength"),z0(r,"radius","pt"),z0(r,"threshold")]}const n=`${r.type}(${i.filter(Boolean).join(" ")})`;eBe(n),e.push(n)}return e.join(" ")}function z0(t,e,r){if(t[e]==null)throw new H("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});return r?t[e]+r:""+t[e]}function L5t(t,e){if(t[e]==null)throw new H("effect:missing-parameter",`Missing parameter '${e}' in ${t.type} effect`,{effect:t});const r=t[e];return`rgba(${r[0]||0}, ${r[1]||0}, ${r[2]||0}, ${r[3]/255||0})`}function D5t(t){return typeof t=="function"}function Mbr(t,e,r,i){return D5t(t)?t(e,r,i):t}function $br(t){return[t.r,t.g,t.b,t.a]}const N5t=` /-,
`;function mSe(t){let e=t.length;for(;e--;)if(!N5t.includes(t.charAt(e)))return!1;return!0}function F5t(t,e){const r=[];let i=0,n=-1;do if(n=t.indexOf("[",i),n>=i){if(n>i){const s=t.substr(i,n-i);r.push([s,null,mSe(s)])}if(i=n+1,n=t.indexOf("]",i),n>=i){if(n>i){const s=e[t.substr(i,n-i)];s&&r.push([null,s,!1])}i=n+1}}while(n!==-1);if(i<t.length-1){const s=t.substr(i);r.push([s,null,mSe(s)])}return r}function k5t(t,e,r){let i="",n=null;for(const s of e){const[o,a,l]=s;if(o)l?n=o:(n&&(i+=n,n=null),i+=o);else{const c=t.attributes[a];c&&(n&&(i+=n,n=null),i+=c)}}return U5t(i,r)}function Ibr(t,e,r){const i=F5t(e,t);return n=>k5t(n,i,r)}function U5t(t,e){switch(typeof t!="string"&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function Lbr(t,e,r,i,n,s,o=!0){const a=e/n,l=r/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let h=0;h<s;h++)for(let f=0;f<n;f++){const m=4*(f+(o?s-h-1:h)*n);let g=0,y=0,_=0,b=0,w=0,x=0,S=0;const C=(h+.5)*l;for(let E=Math.floor(h*l);E<(h+1)*l;E++){const R=Math.abs(C-(E+.5))/u,P=(f+.5)*a,D=R*R;for(let L=Math.floor(f*a);L<(f+1)*a;L++){let k=Math.abs(P-(L+.5))/c;const V=Math.sqrt(D+k*k);V>=-1&&V<=1&&(g=2*V*V*V-3*V*V+1,g>0&&(k=4*(L+E*e),S+=g*t[k+3],_+=g,t[k+3]<255&&(g=g*t[k+3]/250),b+=g*t[k],w+=g*t[k+1],x+=g*t[k+2],y+=g))}}i[m]=b/y,i[m+1]=w/y,i[m+2]=x/y,i[m+3]=S/_}}function rBe(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}function iBe(t){var e;return((e=t.data)==null?void 0:e.symbol)??null}function fne(t){return t.type==="CIMVectorMarker"||t.type==="CIMPictureMarker"||t.type==="CIMBarChartMarker"||t.type==="CIMCharacterMarker"||t.type==="CIMPieChartMarker"||t.type==="CIMStackedBarChartMarker"}function mne(t){return t.type==="CIMGradientStroke"||t.type==="CIMPictureStroke"||t.type==="CIMSolidStroke"}function z5t(t){return t!=null&&(t.type==="CIMGradientFill"||t.type==="CIMHatchFill"||t.type==="CIMPictureFill"||t.type==="CIMSolidFill"||t.type==="CIMWaterFill")}function nj(t){return t!=null&&(t.type==="CIMMarkerPlacementAlongLineRandomSize"||t.type==="CIMMarkerPlacementAlongLineSameSize"||t.type==="CIMMarkerPlacementAlongLineVariableSize"||t.type==="CIMMarkerPlacementAtExtremities"||t.type==="CIMMarkerPlacementAtMeasuredUnits"||t.type==="CIMMarkerPlacementAtRatioPositions"||t.type==="CIMMarkerPlacementOnLine"||t.type==="CIMMarkerPlacementOnVertices")}const Dbr=(t,e=0)=>t==null||isNaN(t)?e:t,Nbr=t=>t.tintColor?rBe(t.tintColor):{r:255,g:255,b:255,a:1},Fbr=t=>{if(!t)return!1;for(const e of t)switch(e.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return!0}return!1};function kbr(){return le(()=>import("./geometryEngineJSON-13f5b377.js"),["assets/geometryEngineJSON-13f5b377.js","assets/geometryEngineBase-3a3551e4.js","assets/geometryEngineJSON-53578afa.js","assets/json-48e3ea08.js"])}function Ubr(t){if(!t)return"normal";switch(t.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}}function zbr(t){if(!t)return"normal";switch(t.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}}function Vbr(t){let e="normal",r="normal";if(t){const i=t.toLowerCase();i.includes("italic")?e="italic":i.includes("oblique")&&(e="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:e,weight:r}}function Bbr(t){return t.underline?"underline":t.strikethrough?"line-through":"none"}function gSe(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=gSe(e);if(r!=null)return r}break;case"CIMTextSymbol":return gSe(t.symbol);case"CIMSolidFill":return t.color}}function ySe(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const e=t.symbolLayers;if(e)for(const r of e){const i=ySe(r);if(i!=null)return i}break}case"CIMTextSymbol":return ySe(t.symbol);case"CIMSolidStroke":return t.color}}function vSe(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const e of t.symbolLayers){const r=vSe(e);if(r!==void 0)return r}break;case"CIMTextSymbol":return vSe(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}}function jbr(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}}function Gbr(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function Hbr(t){return(t?Object.keys(t):[]).map(e=>({name:e,alias:e,type:typeof t[e]=="string"?"esriFieldTypeString":"esriFieldTypeDouble"}))}const qbr=t=>t.includes("data:image/svg+xml");function Wbr(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}}function nBe(t,e,r,i){if(t)if(t.type!=="CIMTextSymbol"){if(r&&t.effects)for(const n of t.effects)j5t(n,e);if(t.symbolLayers)for(const n of t.symbolLayers)switch(n.type){case"CIMPictureMarker":case"CIMVectorMarker":V5t(n,e,i);break;case"CIMPictureStroke":case"CIMSolidStroke":!(i!=null&&i.preserveOutlineWidth)&&n.width&&(n.width*=e);break;case"CIMPictureFill":n.height&&(n.height*=e),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e);break;case"CIMHatchFill":nBe(n.lineSymbol,e,!0,{...i,preserveOutlineWidth:!1}),n.offsetX&&(n.offsetX*=e),n.offsetY&&(n.offsetY*=e),n.separation&&(n.separation*=e)}}else t.height!=null&&(t.height*=e)}function V5t(t,e,r){if(t&&(t.markerPlacement&&B5t(t.markerPlacement,e),t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.anchorPoint&&t.anchorPointUnits==="Absolute"&&(t.anchorPoint={x:t.anchorPoint.x*e,y:t.anchorPoint.y*e}),t.size=t.size!=null?t.size*e:0,t.type==="CIMVectorMarker"&&t.markerGraphics))for(const i of t.markerGraphics)t.scaleSymbolsProportionally||nBe(i.symbol,e,!0,r)}function B5t(t,e){switch(nj(t)&&t.offset&&(t.offset*=e),t.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(t.maxRandomOffset&&(t.maxRandomOffset*=e),t.placementTemplate&&t.placementTemplate.length){const r=t.placementTemplate.map(i=>i*e);t.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":t.startPointOffset&&(t.startPointOffset*=e);break;case"CIMMarkerPlacementAtExtremities":t.offsetAlongLine&&(t.offsetAlongLine*=e);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":t.beginPosition&&(t.beginPosition*=e),t.endPosition&&(t.endPosition*=e);break;case"CIMMarkerPlacementPolygonCenter":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMMarkerPlacementInsidePolygon":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e),t.stepX&&(t.stepX*=e),t.stepY&&(t.stepY*=e)}}function j5t(t,e){switch(t.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":t.width&&(t.width*=e);break;case"CIMGeometricEffectBuffer":t.size&&(t.size*=e);break;case"CIMGeometricEffectCut":t.beginCut&&(t.beginCut*=e),t.endCut&&(t.endCut*=e),t.middleCut&&(t.middleCut*=e);break;case"CIMGeometricEffectDashes":if(t.customEndingOffset&&(t.customEndingOffset*=e),t.offsetAlongLine&&(t.offsetAlongLine*=e),t.dashTemplate&&t.dashTemplate.length){const r=t.dashTemplate.map(i=>i*e);t.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":t.length&&(t.length*=e);break;case"CIMGeometricEffectMove":t.offsetX&&(t.offsetX*=e),t.offsetY&&(t.offsetY*=e);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":t.offset&&(t.offset*=e);break;case"CIMGeometricEffectRegularPolygon":t.radius&&(t.radius*=e);break;case"CIMGeometricEffectTaperedPolygon":t.fromWidth&&(t.fromWidth*=e),t.length&&(t.length*=e),t.toWidth&&(t.toWidth*=e);break;case"CIMGeometricEffectWave":t.amplitude&&(t.amplitude*=e),t.period&&(t.period*=e)}}function sBe(t){const e=[];return gne(iBe(t),e),e.length?new ht(rBe(e[0])):null}function gne(t,e){var n;if(!t)return;let r;r=t.type==="CIMTextSymbol"?t.symbol:t;const i=t.type==="CIMPolygonSymbol";if(r!=null&&r.symbolLayers){for(const s of r.symbolLayers)if(!(s.colorLocked||i&&(mne(s)||fne(s)&&s.markerPlacement&&nj(s.markerPlacement))))switch(s.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":s.tintColor&&_Se(e,s.tintColor);break;case"CIMVectorMarker":(n=s.markerGraphics)==null||n.forEach(o=>{gne(o.symbol,e)});break;case"CIMSolidStroke":case"CIMSolidFill":_Se(e,s.color);break;case"CIMHatchFill":gne(s.lineSymbol,e)}}}function _Se(t,e){for(const r of t)if(r.join(".")===e.join("."))return;t.push(e)}function Xbr(t,e,r){e instanceof ht||(e=new ht(e));const i=iBe(t);i&&yne(i,e,r)}function yne(t,e,r){var s;if(!t)return;let i;i=t.type==="CIMTextSymbol"?t.symbol:t;const n=(i==null?void 0:i.type)==="CIMPolygonSymbol";if(i!=null&&i.symbolLayers)for(const o of i.symbolLayers){if(o.colorLocked)continue;if(n){if(r){const{layersToColor:l}=r;if((mne(o)||fne(o)&&o.markerPlacement&&nj(o.markerPlacement))&&l==="fill"||z5t(o)&&l==="outline")continue}else if(mne(o)||fne(o)&&o.markerPlacement&&nj(o.markerPlacement))continue}const a=e.toArray();switch(o.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":o.tintColor=a;break;case"CIMVectorMarker":(s=o.markerGraphics)==null||s.forEach(l=>{yne(l.symbol,e,r)});break;case"CIMSolidStroke":case"CIMSolidFill":o.color=a;break;case"CIMHatchFill":yne(o.lineSymbol,e,r)}}}let oBe=class{constructor(e,r){this._storage=new fVe,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this),r&&this._storage.registerRemoveFunc("",r)}destroy(){this._storage.deregister(this),this._storage.destroy()}put(e,r,i=1){this._storage.put(this,e,r,i,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}};const aBe="picture-fill",lBe="simple-fill",G5t="simple-line",cBe="simple-marker",H5t="text",q5t="cim",oZ=new oBe(1e3);function Zbr(t){const e=t.style;let r=null;if(t)switch(t.type){case cBe:e!=="cross"&&e!=="x"&&(r=t.color);break;case lBe:e==="solid"?r=t.color:e!=="none"&&(r={type:"pattern",x:0,y:0,src:fi(`esri/symbols/patterns/${e}.png`),width:5,height:5});break;case aBe:r={type:"pattern",src:t.url,width:Es(t.width)*t.xscale,height:Es(t.height)*t.yscale,x:Es(t.xoffset),y:Es(t.yoffset)};break;case H5t:r=t.color;break;case q5t:r=sBe(t)}return r}function Jbr(t,e){const r=t+"-"+e;return oZ.get(r)!==void 0?Promise.resolve(oZ.get(r)):ti(t,{responseType:"image"}).then(i=>{const n=i.data,s=n.naturalWidth,o=n.naturalHeight,a=document.createElement("canvas");a.width=s,a.height=o;const l=a.getContext("2d");l.fillStyle=e,l.fillRect(0,0,s,o),l.globalCompositeOperation="destination-in",l.drawImage(n,0,0);const c=a.toDataURL();return oZ.put(r,c),c})}function uBe(t){if(!t)return null;let e=null;switch(t.type){case lBe:case aBe:case cBe:e=uBe(t.outline);break;case G5t:{const r=Es(t.width);t.style!=null&&t.style!=="none"&&r!==0&&(e={color:t.color,style:W5t(t.style),width:r,cap:t.cap,join:t.join==="miter"?Es(t.miterLimit):t.join});break}default:e=null}return e}const W5t=(()=>{const t={};return e=>{if(t[e])return t[e];const r=e.replaceAll("-","");return t[e]=r,r}})(),Kbr=new ht([128,128,128]),X5t=new ht("white");function Y5t(t){var r,i;const e=(r=t.symbolLayers)==null?void 0:r.at(-1);if(e&&"outline"in e)return(i=e==null?void 0:e.outline)==null?void 0:i.size}function Qbr(t){var e;if(!t)return 0;if(rx(t)){const r=Y5t(t);return r??0}return Rh((e=uBe(t))==null?void 0:e.width)}function ewr(t){if(t==null||!("symbolLayers"in t)||t.symbolLayers==null)return!1;switch(t.type){case"point-3d":return t.symbolLayers.some(e=>e.type==="object");case"line-3d":return t.symbolLayers.some(e=>e.type==="path");case"polygon-3d":return t.symbolLayers.some(e=>e.type==="object"||e.type==="extrude");default:return!1}}function Z5t(t){return qu(t.resource).href}function twr(t,e){if(!t)return null;let r=null;return rx(t)?r=J5t(t):Z7(t)&&(r=t.type==="cim"?sBe(t):t.color?new ht(t.color):null),r?i4(r,e):null}function J5t(t){const e=t.symbolLayers;if(!e)return null;let r=null;return e.forEach(i=>{var n;i.type==="object"&&((n=i.resource)!=null&&n.href)||(r=i.type==="water"?i.color:i.material?i.material.color:null)}),r?new ht(r):null}function i4(t,e){if(e==null||t==null)return t;const r=t.toRgba();return r[3]=r[3]*e,new ht(r)}function K5t(t,e,r){const i=t.symbolLayers;if(!i)return;const n=s=>i4(e=e??s??(r!=null?X5t:null),r);i.forEach(s=>{var o;if(s.type!=="object"||!((o=s.resource)!=null&&o.href)||e)if(s.type==="water")s.color=n(s.color);else{const a=s.material!=null?s.material.color:null,l=n(a);s.material==null?s.material=new vh({color:l}):s.material.color=l,r!=null&&"outline"in s&&s.outline!=null&&s.outline.color!=null&&(s.outline.color=i4(s.outline.color,r))}})}function Q5t(t,e,r){(e=e??t.color)&&(t.color=i4(e,r)),r!=null&&"outline"in t&&t.outline&&t.outline.color&&(t.outline.color=i4(t.outline.color,r))}function rwr(t,e,r){t&&(e||r!=null)&&(e&&(e=new ht(e)),rx(t)?K5t(t,e,r):Z7(t)&&Q5t(t,e,r))}async function ekt(t,e){const r=t.symbolLayers;r&&await b7(r,async i=>tkt(i,e))}async function tkt(t,e){switch(t.type){case"extrude":ikt(t,e);break;case"icon":case"line":case"text":rkt(t,e);break;case"path":skt(t,e);break;case"object":await nkt(t,e)}}function rkt(t,e){const r=dBe(e);r!=null&&(t.size=r)}function dBe(t){for(const e of t)if(typeof e=="number")return e;return null}function ikt(t,e){t.size=typeof e[2]=="number"?e[2]:0}async function nkt(t,e){const{resourceSize:r,symbolSize:i}=await okt(t),n=hBe(e,r,i);t.width=OD(e[0],i[0],r[0],n),t.depth=OD(e[1],i[1],r[1],n),t.height=OD(e[2],i[2],r[2],n)}function skt(t,e){const r=hBe(e,qv,[t.width,void 0,t.height]);t.width=OD(e[0],t.width,1,r),t.height=OD(e[2],t.height,1,r)}function hBe(t,e,r){for(let i=0;i<3;i++){const n=t[i];switch(n){case"symbol-value":{const s=r[i];return s!=null?s/e[i]:1}case"proportional":break;default:if(n&&e[i])return n/e[i]}}return 1}async function okt(t){const{computeObjectLayerResourceSize:e}=await le(()=>import("./symbolLayerUtils-3c0a259e.js"),[]),r=await e(t,10),{width:i,height:n,depth:s}=t,o=[i,s,n];let a=1;for(let l=0;l<3;l++){const c=o[l];if(c!=null){a=c/r[l];break}}for(let l=0;l<3;l++)o[l]==null&&(o[l]=r[l]*a);return{resourceSize:r,symbolSize:o}}function OD(t,e,r,i){switch(t){case"proportional":return r*i;case"symbol-value":return e??r;default:return t}}function akt(t,e){const r=dBe(e);if(r!=null)switch(t.type){case"simple-marker":t.size=r;break;case"picture-marker":{const i=t.width/t.height;i>1?(t.width=r,t.height=r*i):(t.width=r*i,t.height=r);break}case"simple-line":t.width=r;break;case"text":t.font.size=r}}async function iwr(t,e){if(t&&e)return rx(t)?ekt(t,e):void(Z7(t)&&akt(t,e))}function nwr(t,e,r){if(t&&e!=null)if(rx(t)){const i=t.symbolLayers;i&&i.forEach(n=>{if(n&&n.type==="object")switch(r){case"tilt":n.tilt=e;break;case"roll":n.roll=e;break;default:n.heading=e}})}else Z7(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle=e))}function swr(t){if(!t)return null;const e=t.effects.filter(r=>r.type!=="bloom").map(r=>r.toJSON());return pne(e)}function owr(t){return t!=null&&t.type==="polygon-3d"&&t.symbolLayers.some(e=>e.type==="extrude")}async function awr(t,e){return await t.fetchSymbol(e)||t.fetchCIMSymbol(e)}function lkt(t,e,r,i,n){if(t==null)return null;const s=t.referencesGeometry()&&n?ckt(e,i,n):e,o=t.repurposeFeature(s);try{return t.evaluate({...r,$feature:o},t.services)}catch(a){return re.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",a),null}}const aZ=new Map;function ckt(t,e,r){const{transform:i,hasZ:n,hasM:s}=r;aZ.has(e)||aZ.set(e,ukt(e));const o=aZ.get(e)(t.geometry,i,n,s);return{...t,geometry:o}}function ukt(t){const e={};switch(t){case"esriGeometryPoint":return(r,i,n,s)=>bze(i,e,r,n,s);case"esriGeometryPolygon":return(r,i,n,s)=>wze(i,e,r,n,s);case"esriGeometryPolyline":return(r,i,n,s)=>xze(i,e,r,n,s);case"esriGeometryMultipoint":return(r,i,n,s)=>_ze(i,e,r,n,s);default:return re.getLogger("esri.views.2d.support.arcadeOnDemand").error(new H("mapview-arcade",`Unable to handle geometryType: ${t}`)),r=>r}}const lwr=1.2,dkt=Wy;let nq=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.renderGeometries=r,this.boundingBox=i,this._drapeSourceRenderer=n,this.type="draped",this.stage=null,this._visible=!1,this._addedToStage=!1,this.isElevationSource=!1}initialize(e){this.stage=e.stage}setVisibility(e){if(this.stage!=null&&this._visible!==e){if(this._visible=e,e&&!this._addedToStage)return this._addedToStage=!0,void this._drapeSourceRenderer.addGeometries(this.renderGeometries,An.ADD);if(e||this._addedToStage){for(const r of this.renderGeometries)r.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Lo.VISIBILITY)}}}destroy(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,An.REMOVE),this._addedToStage=!1,this._visible=!1,this.stage=null}getCenterObjectSpace(e=A()){return se(e,0,0,0)}getBoundingBoxObjectSpace(e=To()){return en(e)}addObjectState(e,r){e===k_.Highlight&&(this.renderGeometries.forEach(i=>{const n=i.geometry.addHighlight();r.addRenderGeometry(i,n,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Lo.HIGHLIGHT))}removeObjectState(e){this.renderGeometries.forEach(r=>{e.removeRenderGeometry(r)})}removeRenderGeometryObjectState(e,r){e.geometry.removeHighlight(r),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,Lo.HIGHLIGHT)}computeAttachmentOrigin(e){for(const r of this.renderGeometries)r.geometry.computeAttachmentOrigin(kC)&&(e.draped.origin[0]+=kC[0],e.draped.origin[1]+=kC[1],e.draped.num++)}async getProjectedBoundingBox(e,r,i,n,s){en(s);for(let o=0;o<this.renderGeometries.length;o++){const a=this.renderGeometries[o];this._getRenderGeometryProjectedBoundingRect(a,e,bSe,i),J1t(s,bSe)}if(r){let o;Fm(s,kC);const a=Hhe(s,r.service.spatialReference,r);try{o=await r.service.queryElevation(kC[0],kC[1],n,a,"ground")}catch{}o!=null&&(s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o))}return s}_getRenderGeometryProjectedBoundingRect(e,r,i,n){if(this.boundingBox)q7(Dg,this.boundingBox);else{const s=e.boundingSphere,o=s[3];Dg[0]=s[0]-o,Dg[1]=s[1]-o,Dg[2]=s[2]-o,Dg[3]=s[0]+o,Dg[4]=s[1]+o,Dg[5]=s[2]+o}return r(Dg,0,2),this.calculateRelativeScreenBounds&&n.push({location:Fm(Dg),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()}),Bue(Dg,i)}};const bSe=lr(),Dg=To(),kC=A();let pBe=class{constructor(e,r,i,n=2048){this.text=e,this._alignment=r,this._parameters=i,this._maxSize=n,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${e}`,this._lines=e.split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}get displayHeight(){const e=this._lineSpacing*(this._lines.length-1),r=this._lineHeight;return Math.ceil(e+r+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}get renderedWidth(){return Math.ceil(this._toRenderUnit(this.displayWidth))}get renderedHeight(){return Math.ceil(this._toRenderUnit(this.displayHeight))}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}get _firstLineYOffset(){return this._backgroundTopPadding+this._haloSize}get _metrics(){if(this._metricsCached==null){const e=vne(wSe,E6,E6).getContext("2d");this._setFontProperties(e,this._fontSize);let r=2*this._haloSize;const i=this._parameters.definition.font;i.style!=="italic"&&i.style!=="oblique"&&i.weight!=="bold"&&i.weight!=="bolder"||(r+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let n,s,o=0,a=0,l=0;this._lines.forEach((g,y)=>{const _=e.measureText(g),b=_.width,w=b+r;this._textWidths.push(b),this._lineWidths.push(w),o=Math.max(o,w),a=Math.max(a,_.actualBoundingBoxAscent),l=Math.max(l,_.actualBoundingBoxDescent),y===0&&(n=_),y===this._lines.length-1&&(s=_)});const c=e.font;let u=SSe.get(c);if(!u){const g=e.measureText(pkt);u=new mkt(g.actualBoundingBoxAscent,g.actualBoundingBoxDescent),SSe.set(c,u)}a=Math.max(a,u.actualBoundingBoxAscent),l=Math.max(l,u.actualBoundingBoxDescent);const h=a+l,f=this._hasBackground?n.actualBoundingBoxAscent:a,m=this._hasBackground?s.actualBoundingBoxDescent:l;this._metricsCached=new fkt(a-f,l-m,h,o,a)}return this._metricsCached}get _lineSpacing(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _lineHeight(){return this._metrics.lineHeight}get _linePadding(){return this._lineHeight*hkt}get _baselinePosition(){return this._metrics.baselinePosition}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _backgroundHorizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _backgroundVerticalPadding(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}get _backgroundTopPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}get _backgroundBottomPadding(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(this._renderPixelRatio==null){const e=this._parameters.definition.pixelRatio;this._maxSize>0?this._renderPixelRatio=Math.min(e,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):this._renderPixelRatio=e}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case Bw.Left:return this._backgroundHorizontalPadding;case Bw.Center:return(this.displayWidth-this._lineWidths[e])/2;case Bw.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[e]}}render(e,r=0,i=0){e.save();const n=r/=this.renderPixelRatio,s=i/=this.renderPixelRatio,o=this._haloSize,a=this._firstLineYOffset;r+=o,i+=a+this._baselinePosition;const l=this._haloSize>0;l&&this._renderHalo(e,n,s,o,a),this._setFontProperties(e,this._renderedFontSize);for(let c=0;c<this._lines.length;++c){const u=this._lines[c],h=this._getLineXOffset(c);l&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,u,r+h,i),this._renderLineDecoration(e,r+h,i,this._textWidths[c])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,u,r+this._getLineXOffset(c),i),this._renderLineDecoration(e,r+h,i,this._textWidths[c]),i+=this._lineSpacing}if(Di.TEXT_SHOW_BASELINE){e.strokeStyle=xSe,e.setLineDash([2,2]),e.lineWidth=1;let c=s+a;for(let u=0;u<this._lines.length;++u){const h=c+this._baselinePosition;this._drawLine(e,[n,h],[n+this.displayWidth,h]),c+=this._lineSpacing}}if(Di.TEXT_SHOW_BORDER&&(e.strokeStyle=xSe,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[n,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const c=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,n,s,c),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,r,i,n,s=!1){if(this._parameters.definition.font.decoration==="none"||n===0)return;const o=1,a=Math.max(this._parameters.definition.size/16,o);switch(this._parameters.definition.font.decoration){case"underline":i+=2*a;break;case"line-through":i-=.33*this._baselinePosition}const l=s?this._haloSize:0;e.strokeStyle=s?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(a+2*l),e.beginPath(),e.moveTo(this._toRenderUnit(r-l),this._toRenderUnit(i)),e.lineTo(this._toRenderUnit(r+n+l),this._toRenderUnit(i)),e.stroke()}_roundedRect(e,r,i,n){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const s=this.renderedWidth,o=this.renderedHeight;n!==0?(n=Te(n,0,Math.floor(o/2)),e.beginPath(),e.moveTo(r,i+n),e.arcTo(r,i,r+n,i,n),e.lineTo(r+s-n,i),e.arcTo(r+s,i,r+s,i+n,n),e.lineTo(r+s,i+o-n),e.arcTo(r+s,i+o,r+s-n,i+o,n),e.lineTo(r+n,i+o),e.arcTo(r,i+o,r,i+o-n,n),e.closePath()):e.rect(r,i,s,o)}_renderHalo(e,r,i,n,s){const o=this.renderedWidth,a=this.renderedHeight,l=vne(wSe,Math.max(o,E6),Math.max(a,E6)),c=l.getContext("2d");c.clearRect(0,0,o,a),this._setFontProperties(c,this._renderedFontSize),c.fillStyle=this._parameters.haloStyle,c.strokeStyle=this._parameters.haloStyle;const u=this._renderedHaloSize<3;c.lineJoin=u?"miter":"round",u?this._renderHaloEmulated(c,n,s):this._renderHaloNative(c,n,s);let h=s+this._baselinePosition;for(let f=0;f<this._lines.length;++f){const m=this._getLineXOffset(f);this._renderLineDecoration(c,n+m,h,this._textWidths[f],!0),h+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(l,0,0,o,a,this._toRenderUnit(r),this._toRenderUnit(i),o,a),e.globalAlpha=1}_renderHaloEmulated(e,r,i){i+=this._baselinePosition;for(let n=0;n<this._lines.length;++n){const s=this._lines[n],o=this._getLineXOffset(n);for(const[a,l]of fBe)this._fillText(e,s,r+o+this._haloSize*a,i+this._haloSize*l);i+=this._lineSpacing}}_renderHaloNative(e,r,i){const n=2*this._haloSize;i+=this._baselinePosition;for(let s=0;s<this._lines.length;++s){const o=this._lines[s],a=this._getLineXOffset(s),l=5,c=.1;for(let u=0;u<l;u++){const h=1-(l-1)*c+u*c;e.lineWidth=this._toRenderUnit(h*n),this._strokeText(e,o,r+a,i)}i+=this._lineSpacing}}_setFontProperties(e,r){e.font=this._parameters.fontString(r),e.textAlign="left",e.textBaseline="alphabetic"}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,r,i,n){e.fillText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_strokeText(e,r,i,n){e.strokeText(r,this._toRenderUnit(i),this._toRenderUnit(n))}_drawLine(e,r,i){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.lineTo(this._toRoundedRenderUnit(i[0])+.5,this._toRoundedRenderUnit(i[1])+.5),e.stroke()}_drawBox(e,r,i){const n=this._toRenderUnit(r[0]),s=this._toRenderUnit(r[1]),o=this._toRenderUnit(i[0]),a=this._toRenderUnit(i[1]),l=Math.floor(n)+.5,c=Math.ceil(n+o)-.5,u=Math.floor(s)+.5,h=Math.ceil(s+a)-.5;e.beginPath(),e.moveTo(l,u),e.lineTo(c,u),e.lineTo(c,h),e.lineTo(l,h),e.lineTo(l,u),e.stroke()}};const fBe=[];for(let e=0;e<360;e+=360/16)fBe.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);var Bw;function vne(t,e,r){return t.canvas||(t.canvas=document.createElement("canvas")),t.canvas.width=e,t.canvas.height=r,t.canvas}(function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"})(Bw||(Bw={}));const wSe={canvas:null},hkt=.2,E6=512,xSe="rgb(255, 0, 255, 0.5)",pkt=(()=>{let t="";for(let e=32;e<127;e++)t+=String.fromCharCode(e);return t})();let fkt=class{constructor(e,r,i,n,s){this.paddingTop=e,this.paddingBottom=r,this.lineHeight=i,this.displayWidth=n,this.baselinePosition=s}},mkt=class{constructor(e,r){this.actualBoundingBoxAscent=e,this.actualBoundingBoxDescent=r}};const SSe=new Map,gkt=Object.freeze({left:0,center:.5,right:1}),Nz=Object.freeze({"bottom-left":Nr(0,0),bottom:Nr(.5,0),"bottom-right":Nr(1,0),left:Nr(0,.5),center:Nr(.5,.5),right:Nr(1,.5),"top-left":Nr(0,1),top:Nr(.5,1),"top-right":Nr(1,1)});function mBe(t){switch(t){case"left":return Bw.Left;case"right":return Bw.Right;default:return Bw.Center}}function TSe(t){switch(t){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}}function ykt(t){switch(t){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}}function vkt(t,e){switch(e){case"bottom":return t==="left"?"bottom-left":t==="right"?"bottom-right":"bottom";case"center":return t;case"top":return t==="left"?"top-left":t==="right"?"top-right":"top"}}function _kt(t){return t==="middle"?"center":t}let i3=class{constructor(e,r={}){this.geometry=e,this.screenToWorldRatio=1,this._transformation=Me(),this._shaderTransformation=null,this._boundingSphere=null,this.id=au(),this.layerUid=r.layerUid,this.graphicUid=r.graphicUid,this.shaderTransformer=r.shaderTransformer,this.castShadow=r.castShadow??!1}get transformation(){return this._transformation}get boundingInfo(){return this.geometry.boundingInfo}updateTransformation(e){e(this._transformation),this._shaderTransformation=this._boundingSphere=null}shaderTransformationChanged(){this._shaderTransformation=null}get boundingSphere(){return this._boundingSphere?this._boundingSphere:this.boundingInfo?(this._boundingSphere=lt(us(),this.boundingInfo.center,this.shaderTransformation),this._boundingSphere[3]=this.boundingInfo.radius*OP(this.shaderTransformation),this._boundingSphere):zFe}get hasShaderTransformation(){return this.shaderTransformer!=null}get material(){return this.geometry.material}get type(){return this.geometry.type}get shaderTransformation(){return this.shaderTransformer==null?this.transformation:(this._shaderTransformation||(this._shaderTransformation=Rs(Me(),this.shaderTransformer(this.transformation))),this._shaderTransformation)}get indices(){return this.geometry.indices}get vertexAttributes(){return this.geometry.vertexAttributes}get highlights(){return this.geometry.highlights}get occludees(){return this.geometry.occludees}get visible(){return this.geometry.visible}set visible(e){this.geometry.visible=e}};const bkt=Me(),ESe=Ue(0,0,1),wkt=16,xkt=1.5,u2=Nhe,Skt=[u2/2,u2/2,1-u2/2,1-u2/2],Tkt=[ZN*u2,ZN*u2];let _ne=class gBe extends A0{getCachedSize(){return{size:this._getIconSize()}}constructor(e,r,i,n){super(e,r,i,n),this._cimLayers=null,this._cimSymbolMaterials=new Map,this._cimSymbolTextures=new Map,this._cimMaterialParametersInfo=null,this._cimRequiredFields=null,this._cimScaleFactorOrFunction=null,this._size=null,this._symbolTextureRatio=1,this._outlineSize=0,this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0}}async doLoad(e){this._validateOrThrow();const r=this._prepareMaterialParameters(),i=this._getPrimitive();if(i!=null)this._prepareResourcesPrimitive(r,i);else{const n=Z5t(this.symbolLayer),s=q2(n);s&&s.mediaType==="application/json"?await this._prepareResourcesCIM(r,JSON.parse(s.data),e):await this._prepareResourcesHref(r,n,e)}}_validateOrThrow(){if(this._drivenProperties.size)return;const e=GH(this._getIconSize());if(e)throw new H("graphics3diconsymbollayer:invalid-size",e)}_getIconSize(){const e=this.symbolLayer,r=Math.round(e.size!=null?Es(e.size):wkt);return this._drivenProperties.size?Math.max(r,64):r}_generateTextureCIM(e){const r=this._getGraphicHash(e);let i=r===""?null:this._cimSymbolTextures.get(r);if(!i){const n={scaleFactor:this._cimScaleFactorOrFunction},s=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,e,"esriGeometryPoint",n,void 0,void 0);this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",s.anchorPosition);const o={width:s.imageData.width,height:s.imageData.height};i=new qE(s.imageData,o),this._cimSymbolTextures.set(r,i),this._context.stage.add(i)}return i}_prepareMaterialParameters(){const e={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},r=this.symbol;if(Ekt(r)){const{screenLength:i,minWorldLength:n,maxWorldLength:s}=r.verticalOffset;e.verticalOffset={screenLength:Es(i),minWorldLength:n||0,maxWorldLength:s??1/0}}return this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),e.occlusionTest=!0,e.hasSlicePlane=this._context.slicePlaneEnabled,e}_prepareResourcesPrimitive(e,r){const i=this._getOutlineSize();if(lZ(r)&&i===0)throw new Error("Nothing to render");if(this._outlineSize=i,e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,this._context.sharedResources.textures!=null){const s=this._context.sharedResources.textures.fromData(`${r}-icon`,()=>q$t(r));this._texture=s.texture,this._releaseTexture=s,e.textureId=this._texture.id}e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=Skt;const n=this._getIconSize();this._size=[n,n],this._symbolTextureRatio=1/u2,this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesHref(e,r,i){this._outlineSize=this._getOutlineSize(),e.color=this._getFillColor(),e.outlineColor=this._getOutlineColor(),e.outlineSize=this._outlineSize,e.textureIsSignedDistanceField=!1;const n=this._getIconSize(),s=n*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(this._context.sharedResources.textures!=null){const o=await wd(this._context.sharedResources.textures.fromUrl(r,s,{signal:i}));if(o.ok===!1)throw Oa(o.error),new H("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${r})`);this._releaseTexture=o.value;const a=o.value.texture,l=a.parameters.width/a.parameters.height;this._size=l>1?[n,Math.round(n/l)]:[Math.round(n*l),n],e.textureId=a.id}this._createMaterialAndAddToStage(e,this._context.stage)}async _prepareResourcesCIM(e,r,i){const n=new N3({data:r});if(!this._context.sharedResources.cimSymbolRasterizer){const u=(await le(()=>import("./CIMSymbolRasterizer-b575d6d0.js"),["assets/CIMSymbolRasterizer-b575d6d0.js","assets/cimAnalyzer-99e34336.js","assets/TileClipper-ae6eca9e.js","assets/definitions-77bd9395.js","assets/number-e491b09e.js","assets/BidiEngine-9a40f2f4.js","assets/imageutils-7ad0e0c0.js","assets/rasterizingUtils-fc723d1a.js"])).CIMSymbolRasterizer;vr(i),this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new u(this._context.renderCoordsHelper.spatialReference,!0))}const s=this._context.layer.fields?this._context.layer.fields.map(u=>u.toJSON()):null;let o,a;if(this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol3D(n,s,this._context.renderer&&this._context.renderer.type==="dictionary"?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:i}),this._context.renderer&&this._context.renderer.type==="dictionary"&&this._context.renderer.scaleExpression){const u=this._context.renderer;if(isNaN(u.scaleExpression)){const h=u.scaleExpression,f=await v0t(h,this._context.layer.spatialReference,s);a=(m,g,y)=>{const _=lkt(f,m,{$view:y},"esriGeometryPoint",g);return _!==null?_:1}}else o=Number(u.scaleExpression)}this._cimScaleFactorOrFunction=o||a||1;const l=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];vr(i);const c=this._context.layer.fieldsIndex;this._cimRequiredFields=l.map(u=>c.get(u).name),this._cimMaterialParametersInfo=e,this._cimMaterialParametersInfo.color=this._getFillColor(),this._cimMaterialParametersInfo.outlineColor=[0,0,0,0],this._cimMaterialParametersInfo.outlineSize=0,this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1}_getPrimitive(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||fbt}_getOutlineSize(){let e=0;const r=this.symbolLayer;return r.outline!=null&&r.outline.size!=null?Math.max(Es(r.outline.size),0):(e=lZ(this._getPrimitive())?xkt:0,Math.max(e,0))}_getOutlineColor(){var n;const e=this._getLayerOpacity(),r=this.symbolLayer,i=(n=r==null?void 0:r.outline)==null?void 0:n.color;if(i!=null){const s=ht.toUnitRGB(i),o=i.a*e;return[s[0],s[1],s[2],o]}return[0,0,0,0]}_getFillColor(){var i,n;if(lZ(this._getPrimitive()))return dkt;const e=this._getPrimitive()==null,r=(n=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:n.color;return this._getCombinedOpacityAndColor(r,{hasIntrinsicColor:e})}_getAnchorPos(e,r){return e==="relative"?Nr((r.x||0)+.5,.5-(r.y||0)):e in Nz?Nz[e]:Nz.center}_createMaterialAndAddToStage(e,r){if(this._cimLayers){this._fastUpdates=null;let i=e.textureId?this._cimSymbolMaterials.get(e.textureId):null;return i||(i=new KP(e),this._cimSymbolMaterials.set(e.textureId??0,i),r.add(i)),i}return this._fastUpdates=ZP(this._context.renderer,this._fastVisualVariableConvertOptions()),this._fastUpdates&&(e={...e,...this._fastUpdates.materialParameters}),this._material=new KP(e),r.add(this._material),this._material}_setDrapingDependentMaterialParameters(){this.draped&&(this._forEachMaterial(e=>{e.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._material=null,this._cimSymbolMaterials.clear(),this._cimSymbolTextures.forEach(e=>this._context.stage.remove(e)),this._cimSymbolTextures.clear(),this._releaseTexture=xn(this._releaseTexture)}_getScaleFactor(e,r){if(this._drivenProperties.size&&e.size){for(let i=0;i<3;i++){const n=e.size[i];n&&n!=="symbol-value"&&n!=="proportional"&&(e.size[i]=Es(n))}if(e.size[0]==="symbol-value")return 1;if(isFinite(+e.size[0]))return+e.size[0]/r;if(isFinite(+e.size[2]))return+e.size[2]/r}return 1}createGraphics3DGraphic(e){var h;const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;let i,n=[0,0];if(this._cimLayers){if(!this._cimLayers.length)return null;const f=this._generateTextureCIM(r),m={textureId:f.id,...this._cimMaterialParametersInfo};i=this._createMaterialAndAddToStage(m,this._context.stage),n=[f.parameters.width,f.parameters.height]}else n=this._size,i=this._material;const s=KN(r.geometry);if(s==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const o=e.renderingInfo,a=this._getVertexOpacityAndColor(o);let l=1;if(!((h=this._fastUpdates)!=null&&h.visualVariables.size)){const f=n[0]>n[1]?n[0]:n[1];l=this._getScaleFactor(o,f)}l*=this._symbolTextureRatio;const c=Nr(n[0]*l,n[1]*l),u=this.setGraphicElevationContext(r,new yg);return this.ensureDrapedStatus(u.mode==="on-the-ground")&&this._setDrapingDependentMaterialParameters(),this.draped?this._createAsOverlay(r,s,i,a,c,e.layer.uid):this._createAs3DShape(r,s,i,a,c,u,r.uid)}layerOpacityChanged(){const e=this._getFillColor(),r=this._getOutlineColor();this._forEachMaterial(i=>{i.setParameters({color:e}),i.setParameters({outlineColor:r})})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=LF(gBe.elevationModeChangeTypes,i,n);if(s!==Xn.UPDATE)return s;const o=mf(n)||n==="absolute-height";return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this.draped||this._forEachMaterial(e=>{e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return this._getPrimitive()!=null}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!JP(this._fastUpdates,r,this._fastVisualVariableConvertOptions()))return Cs.RecreateSymbol;this._material!=null&&this._material.setParameters(this._fastUpdates.materialParameters)}return Cs.FastUpdate}_defaultElevationInfoNoZ(){return Ckt}_createAs3DShape(e,r,i,n,s,o,a){const l=this.getFastUpdateAttrValues(e),c=l&&this._fastUpdates?y=>qie(this._fastUpdates.materialParameters,l,y):void 0,u=this._context.layer.uid,h=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:u}),f=Sie(i,ESe,null,n,s,Rkt,null,l,h),m=Jhe(this._context,r,f,o,a,c);if(m==null)return null;const g=new O0(this,m.object,[f],null,null,O2,o);return g.alignedSampledElevation=m.sampledElevation,g.needsElevationUpdates=mf(o.mode)||o.mode==="absolute-height",g.getScreenSize=this._createScreenSizeGetter(s,c),g.calculateRelativeScreenBounds=y=>i.calculateRelativeScreenBounds(g.getScreenSize(),1,y),JN(g,r,this._context.elevationProvider),g}_createAsOverlay(e,r,i,n,s,o){i.renderPriority=this._renderPriority;const a=wr();Na(r,a,this._context.overlaySR),a[2]=bpe;const l=this._context.clippingExtent;if(l!=null&&!Vue(l,a))return null;const c=this.getFastUpdateAttrValues(e),u=c&&this._fastUpdates?y=>qie(this._fastUpdates.materialParameters,c,y):void 0,h=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:e.uid,layerUid:this._context.layer.uid}),f=Sie(i,ESe,a,n,s,null,null,c,h),m=new i3(f,{layerUid:o,graphicUid:e.uid,shaderTransformer:u}),g=new nq(this,[m],null,this._context.drapeSourceRenderer);return g.getScreenSize=this._createScreenSizeGetter(s,u),g.calculateRelativeScreenBounds=y=>i.calculateRelativeScreenBounds(g.getScreenSize(),1,y),g}_createScreenSizeGetter(e,r){const i=this._outlineSize+2;if(this._fastUpdates&&r){const n=e[0]/this._symbolTextureRatio,s=e[1]/this._symbolTextureRatio;return(o=Qe())=>{const a=r(bkt);return o[0]=a[0]*n+i,o[1]=a[5]*s+i,o}}{const n=e[0]/this._symbolTextureRatio+i,s=e[1]/this._symbolTextureRatio+i;return(o=Qe())=>(o[0]=n,o[1]=s,o)}}_fastVisualVariableConvertOptions(){const e=Math.max(this._size[0],this._size[1]),r=Ue(e,e,e),i=Rh(1),n=e*i,s=Ue(n,n,n);return new MF({size:!0,color:!0,rotation:!0,opacity:!1},r,s,i)}_getGraphicHash(e){let r="";for(const i of this._cimRequiredFields)r+=i+e.attributes[i];return r}_forEachMaterial(e){this._material!=null&&e(this._material),this._cimSymbolMaterials.forEach(e)}test(){return{...super.test(),material:this._material}}};function Ekt(t){return t&&t.type==="point-3d"&&t.hasVisibleVerticalOffset()}function lZ(t){return t!=null&&(t==="cross"||t==="x")}_ne.PRIMITIVE_SIZE=Tkt,_ne.elevationModeChangeTypes={definedChanged:Xn.UPDATE,staysOnTheGround:Xn.NONE,onTheGroundChanged:Xn.RECREATE};const Ckt={mode:"relative-to-ground",offset:0},Rkt=nr(0,0,0,1);function bne(t){switch(t){case"butt":return Yp.BUTT;case"square":return Yp.SQUARE;case"round":return Yp.ROUND;default:return null}}function CSe(t){return t==="diamond"?"kite":t}function wne(t,e,r=null){const i=[],n=[],s=e.mapPositions;Okt(e,n,i);const o=n[0][1].data,a=i[0][1].length,l=q3(a);return Akt(e,n,i,l),$kt(e,n,i,l),Pkt(e,n,i,l),Mkt(e,n,i,l),Ikt(e,n,i,l),Lkt(e,n,i,l),Dkt(e,n,i,o),new Us(t,n,i,s,Wn.Line,r)}function Okt(t,e,r){const{attributeData:{position:i},removeDuplicateStartEnd:n}=t,s=Nkt(i)&&n,o=i.length/3-(s?1:0),a=new Array(2*(o-1)),l=s?i.slice(0,i.length-3):i;let c=0;for(let u=0;u<o-1;u++)a[c++]=u,a[c++]=u+1;e.push([O.POSITION,new ft(l,3,s)]),r.push([O.POSITION,a])}function Akt(t,e,r,i){if(t.attributeData.colorFeature!=null)return;const n=t.attributeData.color;e.push([O.COLOR,new ft(n??Np,4)]),r.push([O.COLOR,i])}function Pkt(t,e,r,i){if(t.attributeData.normal==null)return;const n=t.attributeData.normal;e.push([O.NORMAL,new ft(n,3)]),r.push([O.NORMAL,i])}function Mkt(t,e,r,i){t.attributeData.colorFeature!=null&&(e.push([O.COLORFEATUREATTRIBUTE,new ft([t.attributeData.colorFeature],1,!0)]),r.push([O.COLOR,i]))}function $kt(t,e,r,i){t.attributeData.sizeFeature==null&&(e.push([O.SIZE,new ft([t.attributeData.size??1],1,!0)]),r.push([O.SIZE,i]))}function Ikt(t,e,r,i){t.attributeData.sizeFeature!=null&&(e.push([O.SIZEFEATUREATTRIBUTE,new ft([t.attributeData.sizeFeature],1,!0)]),r.push([O.SIZEFEATUREATTRIBUTE,i]))}function Lkt(t,e,r,i){const n=t.attributeData.opacityFeature;n!=null&&(e.push([O.OPACITYFEATUREATTRIBUTE,new ft([n],1,!0)]),r.push([O.OPACITYFEATUREATTRIBUTE,i]))}function Dkt(t,e,r,i){if(t.overlayInfo==null||t.overlayInfo.renderCoordsHelper.viewingMode!==at.Global||!t.overlayInfo.spatialReference.isGeographic)return;const n=sl(i.length),s=Xr(t.overlayInfo.spatialReference);for(let f=0;f<n.length;f+=3)L7(i,f,n,f,s);const o=i.length/3,a=Dn(o+1);let l=Fkt,c=kkt,u=0,h=0;se(l,n[h++],n[h++],n[h++]),a[0]=0;for(let f=1;f<o+1;++f)f===o&&(h=0),se(c,n[h++],n[h++],n[h++]),u+=Jke(l,c),a[f]=u,[l,c]=[c,l];e.push([O.DISTANCETOSTART,new ft(a,1,!0)]),r.push([O.DISTANCETOSTART,r[0][1]])}function Nkt(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}const Fkt=A(),kkt=A();function fwr(t,e){if(t==null||t.length===0)return[];const r=[];return t.forEach(i=>{const n=i.length,s=sl(3*n);i.forEach((a,l)=>{s[3*l]=a[0],s[3*l+1]=a[1],s[3*l+2]=a[2]});const o={attributeData:{position:s,normal:e},removeDuplicateStartEnd:!1};r.push(o)}),r}function Ukt(t,e,r,i){const n=t.type==="polygon"?f0.CCW_IS_HOLE:f0.NONE,s=t.type==="polygon"?t.rings:t.paths,{position:o,outlines:a}=FF(s,!!t.hasZ,n),l=sl(o.length),c=Dze(o,t.spatialReference,0,l,0,o,0,o.length/3,e,r,i),u=c!=null;return{lines:u?yBe(a,o,l):[],projectionSuccess:u,sampledElevation:c}}function zkt(t,e){const r=t.type==="polygon"?f0.CCW_IS_HOLE:f0.NONE,i=t.type==="polygon"?t.rings:t.paths,{position:n,outlines:s}=FF(i,!1,r),o=Ni(n,t.spatialReference,0,n,e,0,n.length/3);for(let a=2;a<n.length;a+=3)n[a]=bpe;return{lines:o?yBe(s,n):[],projectionSuccess:o}}function yBe(t,e,r=null){const i=new Array;for(const{index:n,count:s}of t){if(s<=1)continue;const o=3*n,a=3*s;i.push({position:Xp(e,3*n,3*s),mapPositions:r!=null?Xp(r,o,a):void 0})}return i}function Vkt(t){const e=new jr,r=t.hasMultipassTerrain&&(t.output===q.Color||t.output===q.Alpha),i=t.space===wh.World;e.include(z9e,t),e.include(W9e,t),t.output===q.Depth&&e.include(V_,t);const{vertex:n,fragment:s}=e;return s.include(Od),gd(n,t),e.attributes.add(O.POSITION,"vec3"),e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"vec3"),e.varyings.add("vColor","vec4"),e.varyings.add("vpos","vec3"),e.varyings.add("vUV","vec2"),e.varyings.add("vSize","float"),cx(e),r&&e.varyings.add("depth","float"),t.hasTip&&e.varyings.add("vLineWidth","float"),n.uniforms.add(new Yr("nearFar",(o,a)=>a.camera.nearFar),new Cr("viewport",(o,a)=>a.camera.fullViewport)),n.code.add(T`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`),n.code.add(T`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`),i?(e.attributes.add(O.NORMAL,"vec3"),XP(n),n.constants.add("tiltThreshold","float",.7),n.code.add(T`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):n.code.add(T`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`),n.code.add(T`
      #define vecN ${i?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${i?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${t.anchor===yE.Tip?"pos -= 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `),t.space===wh.Screen&&(n.uniforms.add(new yn("inverseProjectionMatrix",(o,a)=>a.camera.inverseProjectionMatrix)),n.code.add(T`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),n.code.add(T`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),n.uniforms.add(new Ye("perScreenPixelRatio",(o,a)=>a.camera.perScreenPixelRatio)),n.code.add(T`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${t.hasCap?`
                if(prev.z > posLeft.z) {
                  vec2 diff = posLeft.xy - posRight.xy;
                  planeOrigin.xy += perpendicular(diff) / 2.0;
                }
              `:""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `)),Z3(n,t),wH(e),n.code.add(T`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`),i?(t.hideOnShortSegments&&n.code.add(T`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),n.code.add(T`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(n.code.add(T`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),t.space===wh.Screen&&n.code.add(T`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`)),n.code.add(T`
        ${r?"depth = pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${i?"":"vUV *= displacedPosScreen.w;"}

        ${t.hasTip?"vLineWidth = lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `),r&&e.include(Mh,t),e.include(as,t),s.uniforms.add(new Cr("intrinsicColor",o=>o.color),new Mt("tex",o=>o.markerTexture)),s.include(R0),e.constants.add("texelSize","float",1/A2),s.code.add(T`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`),t.hasTip&&(e.constants.add("relativeMarkerSize","float",ape/A2),e.constants.add("relativeTipLineWidth","float",XNt),s.code.add(T`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${i?"halfTipLineWidth *= fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `)),e.constants.add("symbolAlphaCutoff","float",Ma),s.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${r?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${i?"vec2 samplePos = vUV;":"vec2 samplePos = vUV * gl_FragCoord.w;"}

    ${t.hasTip?"finalColor.a *= max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *= markerAlpha(samplePos);"}

    ${t.output===q.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${t.output===q.Alpha?T`fragColor = vec4(finalColor.a);`:""}
    ${t.output===q.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===q.Color&&t.transparencyPassType===kt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
    ${t.output===q.Highlight?T`fragColor = vec4(1.0);`:""}
    ${t.output===q.Depth?T`outputDepth(linearDepth);`:""}
  }
  `),e}const Bkt=Object.freeze(Object.defineProperty({__proto__:null,build:Vkt},Symbol.toStringTag,{value:"Module"})),vBe=new Map([[O.POSITION,0],[O.UV0,2],[O.AUXPOS1,3],[O.NORMAL,4],[O.COLOR,5],[O.COLORFEATUREATTRIBUTE,5],[O.SIZE,6],[O.SIZEFEATUREATTRIBUTE,6],[O.OPACITYFEATUREATTRIBUTE,7]]);let _Be=class bBe extends si{initializeProgram(e){return new Kr(e.rctx,bBe.shader.get().build(this.configuration),vBe)}_makePipelineState(e,r){const i=this.configuration,n=e===kt.NONE;return Qt({blending:i.output===q.Color||i.output===q.Alpha?n?bh:o1(e):null,depthTest:{func:Px(e)},depthWrite:n?i.writeDepth?fu:null:kH(e),colorWrite:hr,stencilWrite:i.hasOccludees?m0:null,stencilTest:i.hasOccludees?r?vx:Mx:null,polygonOffset:{factor:0,units:-10}})}initializePipeline(){return this.configuration.occluder&&(this._occluderPipelineTransparent=Qt({blending:bh,depthTest:ej,depthWrite:null,colorWrite:hr,stencilWrite:null,stencilTest:Z9e}),this._occluderPipelineOpaque=Qt({blending:bh,depthTest:ej,depthWrite:null,colorWrite:hr,stencilWrite:X9e,stencilTest:Y9e}),this._occluderPipelineMaskWrite=Qt({blending:null,depthTest:lpe,depthWrite:null,colorWrite:null,stencilWrite:m0,stencilTest:vx})),this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0),this._makePipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:this.configuration.occluder?e===_e.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:e===_e.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:super.getPipelineState(e,r)}};_Be.shader=new Jr(Bkt,()=>le(()=>import("./LineMarker.glsl-19319d3e.js"),[]));let jkt=class extends Ax{constructor(e){super(e,new Hkt),this._vertexAttributeLocations=vBe,this._configuration=new wa,this._layout=this.createLayout()}dispose(){}getConfiguration(e,r){return this._configuration.output=e,this._configuration.space=r.slot===_e.DRAPED_MATERIAL?wh.Draped:this.parameters.worldSpace?wh.World:wh.Screen,this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments,this._configuration.hasCap=this.parameters.cap!==Yp.BUTT,this._configuration.anchor=this.parameters.anchor,this._configuration.hasTip=this.parameters.hasTip,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.occluder=this.parameters.renderOccluded===gn.OccludeAndTransparentStencil,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}intersect(){}createLayout(){const e=On().vec3f(O.POSITION).vec2f(O.UV0).vec3f(O.AUXPOS1);return this.parameters.worldSpace&&e.vec3f(O.NORMAL),this.parameters.vvSize?e.f32(O.SIZEFEATUREATTRIBUTE):e.f32(O.SIZE),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4f(O.COLOR),this.parameters.vvOpacity&&e.f32(O.OPACITYFEATUREATTRIBUTE),e}createBufferWriter(){return new qkt(this._layout,this.parameters)}requiresSlot(e,r){return r===q.Color||r===q.Alpha||r===q.Highlight||r===q.Depth?e===_e.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===gn.OccludeAndTransparentStencil?e===_e.OPAQUE_MATERIAL||e===_e.OCCLUDER_MATERIAL||e===_e.TRANSPARENT_OCCLUDER_MATERIAL:r===q.Color||r===q.Alpha?e===(this.parameters.writeDepth?_e.TRANSPARENT_MATERIAL:_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):e===_e.OPAQUE_MATERIAL:!1}createGLMaterial(e){return new Gkt(e)}},Gkt=class extends Hde{constructor(){super(...arguments),this._markerPrimitive=null}dispose(){super.dispose(),this._markerTextureRepository.release(this._markerPrimitive),this._markerPrimitive=null}_updateParameters(e){const r=this._material.parameters.markerPrimitive;return r!==this._markerPrimitive&&(this._material.setParameters({markerTexture:this._markerTextureRepository.swap(r,this._markerPrimitive)}),this._markerPrimitive=r),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(_Be,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==q.Color&&this._output!==q.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Hkt=class extends $F{constructor(){super(...arguments),this.width=0,this.color=[1,1,1,1],this.markerPrimitive="arrow",this.placement="end",this.cap=Yp.BUTT,this.anchor=yE.Center,this.hasTip=!1,this.worldSpace=!1,this.hideOnShortSegments=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.vvFastUpdate=!1,this.hasOccludees=!1,this.markerTexture=null}},qkt=class{constructor(e,r){this.vertexBufferLayout=e,this._parameters=r}elementCount(){return this._parameters.placement==="begin-end"?12:6}write(e,r,i,n,s){const o=i.vertexAttributes.get(O.POSITION).data,a=o.length/3;let l=[1,0,0];const c=i.vertexAttributes.get(O.NORMAL);this._parameters.worldSpace&&c!=null&&(l=c.data);let u=1,h=0;this._parameters.vvSize?h=i.vertexAttributes.get(O.SIZEFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.SIZE)&&(u=i.vertexAttributes.get(O.SIZE).data[0]);let f=[1,1,1,1],m=0;this._parameters.vvColor?m=i.vertexAttributes.get(O.COLORFEATUREATTRIBUTE).data[0]:i.vertexAttributes.has(O.COLOR)&&(f=i.vertexAttributes.get(O.COLOR).data);let g=0;this._parameters.vvOpacity&&(g=i.vertexAttributes.get(O.OPACITYFEATUREATTRIBUTE).data[0]);const y=new Float32Array(n.buffer);let _=s*(this.vertexBufferLayout.stride/4);const b=(C,E,R,P)=>{if(y[_++]=C[0],y[_++]=C[1],y[_++]=C[2],y[_++]=R[0],y[_++]=R[1],y[_++]=E[0],y[_++]=E[1],y[_++]=E[2],this._parameters.worldSpace&&(y[_++]=l[0],y[_++]=l[1],y[_++]=l[2]),this._parameters.vvSize?y[_++]=h:y[_++]=u,this._parameters.vvColor)y[_++]=m;else{const D=Math.min(4*P,f.length-4);y[_++]=f[D],y[_++]=f[D+1],y[_++]=f[D+2],y[_++]=f[D+3]}this._parameters.vvOpacity&&(y[_++]=g)};let w;(function(C){C[C.ASCENDING=1]="ASCENDING",C[C.DESCENDING=-1]="DESCENDING"})(w||(w={}));const x=(C,E)=>{const R=se(Wkt,o[3*C],o[3*C+1],o[3*C+2]),P=Xkt;let D=C+E;do se(P,o[3*D],o[3*D+1],o[3*D+2]),D+=E;while(Ww(R,P)&&D>=0&&D<a);e&&(lt(R,R,e),lt(P,P,e)),b(R,P,[-1,-1],C),b(R,P,[1,-1],C),b(R,P,[1,1],C),b(R,P,[-1,-1],C),b(R,P,[1,1],C),b(R,P,[-1,1],C)},S=this._parameters.placement;S!=="begin"&&S!=="begin-end"||x(0,w.ASCENDING),S!=="end"&&S!=="begin-end"||x(a-1,w.DESCENDING)}};const Wkt=A(),Xkt=A(),gl={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},Ykt={dash:gl.dash,"dash-dot":[...gl.dash,...gl.dot],dot:gl.dot,"long-dash":gl["long-dash"],"long-dash-dot":[...gl["long-dash"],...gl.dot],"long-dash-dot-dot":[...gl["long-dash"],...gl.dot,...gl.dot],none:null,"short-dash":gl["short-dash"],"short-dash-dot":[...gl["short-dash"],...gl["short-dot"]],"short-dash-dot-dot":[...gl["short-dash"],...gl["short-dot"],...gl["short-dot"]],"short-dot":gl["short-dot"],solid:null},Zkt=8;function Jkt(t,e){return t==null?t:{pattern:t.slice(),pixelRatio:e}}function _wr(t){return{pattern:[t,t],pixelRatio:2}}function wBe(t){return t!=null&&t.type==="style"?Kkt(t.style):null}function Kkt(t){return t!=null?Jkt(Ykt[t],Zkt):null}const Qkt=["polyline","polygon","extent"],RSe=new MF({size:!0,color:!0,rotation:!1,opacity:!0});let xBe=class SBe extends A0{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){if(this._fastUpdates=ZP(this._context.renderer,RSe),!this._drivenProperties.size&&(this.symbolLayer.size!=null?this.symbolLayer.size:Rh(1))<0)throw new H("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values")}_getMaterialParameters(e,r=!1){var s,o;const i=this._getCombinedOpacityAndColor(r&&this._markerColor||this._materialColor);this._patternHidesLine&&!r&&(i[3]=0);const n={width:this._computeMaterialWidth((s=this.symbolLayer)==null?void 0:s.size),color:i,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:bne(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:e,stipplePattern:wBe(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return(o=this._fastUpdates)!=null&&o.visualVariables?{...n,...this._fastUpdates.materialParameters}:n}get _materialColor(){var e;return(e=this.symbolLayer.material)==null?void 0:e.color}get _markerColor(){var e;return(e=this.symbolLayer.marker)==null?void 0:e.color}get _lineMaterial(){return this._lineMaterialCached==null&&(this._lineMaterialCached=new rA(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached)),this._lineMaterialCached}get _ringMaterial(){return this._ringMaterialCached==null&&(this._ringMaterialCached=new rA(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached)),this._ringMaterialCached}get _wireframeLineMaterial(){return this._wireframeLineMaterialCached==null&&(this._wireframeLineMaterialCached=new rA({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached)),this._wireframeLineMaterialCached}get _wireframeRingMaterial(){return this._wireframeRingMaterialCached==null&&(this._wireframeRingMaterialCached=new rA({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached)),this._wireframeRingMaterialCached}get _markerMaterial(){return this._markerMaterialCached==null&&this.symbolLayer.marker!=null&&(this._markerMaterialCached=new jkt({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,markerPrimitive:CSe(this.symbolLayer.marker.style)}),this._context.stage.add(this._markerMaterialCached)),this._markerMaterialCached}destroy(){super.destroy(),this._forEachMaterial(e=>this._context.stage.remove(e)),this._lineMaterialCached=null,this._ringMaterialCached=null,this._wireframeLineMaterialCached=null,this._wireframeRingMaterialCached=null,this._markerMaterialCached=null}_getDrivenSize(e){return this._drivenProperties.size&&e.size?Es(vNt(e.size)):1}_getDrivenColor(e){const r=nr(1,1,1,1);return this._drivenProperties.color&&e.color&&(r[0]=e.color[0],r[1]=e.color[1],r[2]=e.color[2],e.color.length>0&&(r[3]=e.color[3])),this._drivenProperties.opacity&&e.opacity&&(r[3]=e.opacity),r}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Qkt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new yg);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.draped?this._createAsOverlay(e,this._context.layer.uid):this._createAs3DShape(e,i,r.uid)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables")return Cs.RecreateSymbol;{const n=this._fastUpdates;if(!JP(n,r,RSe))return Cs.RecreateSymbol;this._forEachMaterial(s=>s.setParameters(n.materialParameters))}}return Cs.FastUpdate}prepareSymbolLayerPatch(e){var s,o;if(e.diff.type!=="partial")return;const r=e.diff.diff,i={};((s=r.size)==null?void 0:s.type)==="complete"&&(i.width=this._computeMaterialWidth(r.size.newValue),delete r.size),((o=r.cap)==null?void 0:o.type)==="complete"&&(i.cap=bne(r.cap.newValue??"butt"),delete r.cap);const n=this._prepareMarkerPatch(e,r);this._prepareMaterialPatch(e,r,n),e.symbolLayerStatePatches.push(()=>this._forEachMaterial(a=>a.setParameters(i)))}layerOpacityChanged(){this._forEachMaterial((e,r)=>this._updateMaterialLayerOpacity(e,r))}_forEachMaterial(e){this._lineMaterialCached!=null&&e(this._lineMaterialCached),this._ringMaterialCached!=null&&e(this._ringMaterialCached),this._wireframeLineMaterialCached!=null&&e(this._wireframeLineMaterialCached),this._wireframeRingMaterialCached!=null&&e(this._wireframeRingMaterialCached),this._markerMaterialCached!=null&&e(this._markerMaterialCached,!0)}_updateMaterialLayerOpacity(e,r=!1){var a,l;const i=e.parameters.color,n=(l=(a=this.symbolLayer)==null?void 0:a.material)==null?void 0:l.color,s=this._patternHidesLine&&!r?0:this._getCombinedOpacity(n),o=nr(i[0],i[1],i[2],s);e.setParameters({color:o})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=LF(SBe.elevationModeChangeTypes,i,n);if(s!==Xn.UPDATE)return s;const o=mf(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){const e={hasSlicePlane:this._context.slicePlaneEnabled};return this._forEachMaterial(r=>r.setParameters(e)),!0}physicalBasedRenderingChanged(){return!0}_getGeometryAsPolygonOrPolyline(e){switch(e.type){case"extent":if(e instanceof $r)return Tc.fromExtent(e);break;case"polygon":case"polyline":return e}return null}_createAs3DShape(e,r,i){const n=e.graphic,s=this._getGeometryAsPolygonOrPolyline(n.geometry),o=s.type==="polygon"?s.rings:s.paths,a=new Array,l=To(),c=Ukt(s,this._context.elevationProvider,this._context.renderCoordsHelper,r),u=s.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(c,o,u,"LineSymbol3DLayer");for(let m=0;m<c.lines.length;m++){const g=c.lines[m],y=g.position,_=g.mapPositions;if(this._context.clippingExtent!=null&&(en(l),ph(l,_),!km(l,this._context.clippingExtent)))continue;const b=this._createGeometry(s.type==="polygon"?this._ringMaterial:this._lineMaterial,e,y,_,s.type,AD.ELEVATED,i);a.push(b),Di.LINE_WIREFRAMES&&a.push(b.instantiate({material:s.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial})),this._markerMaterial!=null&&a.push(b.instantiate({material:this._markerMaterial}))}if(a.length===0)return null;const h=new a1({geometries:a,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),f=new O0(this,h,a,null,null,GLt,r);return f.alignedSampledElevation=c.sampledElevation,f.needsElevationUpdates=mf(r.mode),f}_createGeometry(e,r,i,n,s,o,a){var y,_,b;const l=o===AD.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,c=s==="polygon",u=(y=this._fastUpdates)==null?void 0:y.visualVariables.color,h=(_=this._fastUpdates)==null?void 0:_.visualVariables.size,f=(b=this._fastUpdates)==null?void 0:b.visualVariables.opacity,m=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:a,layerUid:this._context.layer.uid}),g={position:i,size:h?null:this._getDrivenSize(r.renderingInfo),color:u?null:this._getDrivenColor(r.renderingInfo),sizeFeature:h?Km(h.field,r.graphic):null,colorFeature:u?Km(u.field,r.graphic):null,opacityFeature:f?Km(f.field,r.graphic):null};return wne(e,{overlayInfo:l,removeDuplicateStartEnd:c,mapPositions:n,attributeData:g},m)}_createAsOverlay(e,r){const i=e.graphic,n=this._getGeometryAsPolygonOrPolyline(i.geometry),s=n.type==="polygon"?n.rings:n.paths,o=n.type==="polygon"?this._ringMaterial:this._lineMaterial;o.renderPriority=this._renderPriority;const a=Di.LINE_WIREFRAMES?n.type==="polygon"?this._wireframeRingMaterial:this._wireframeLineMaterial:null,l=this._markerMaterial;a!=null&&(a.renderPriority=this._renderPriority-.001),l!=null&&(l.renderPriority=this._renderPriority-.002);const c=new Array,u=To(),h=en(),f=zkt(n,this._context.overlaySR),m=n.type==="polygon"?"rings":"paths";this._logGeometryCreationWarnings(f,s,m,"LineSymbol3DLayer");for(const g of f.lines){if(en(u),ph(u,g.position),!km(u,this._context.clippingExtent))continue;MP(h,u);const y=_=>{const b=this._createGeometry(_,e,g.position,void 0,n.type,AD.DRAPED,i.uid),w=new i3(b,{layerUid:r,graphicUid:i.uid});c.push(w)};if(l!=null){y(l);const _=this.symbolLayer.marker.placement;_!=="begin"&&_!=="begin-end"||ph(u,g.position,0,1),_!=="end"&&_!=="begin-end"||ph(u,g.position,g.position.length-3,1)}y(o),Di.LINE_WIREFRAMES&&y(a)}return new nq(this,c,h,this._context.drapeSourceRenderer)}get _patternHidesLine(){const e=this.symbolLayer.pattern;return e!=null&&e.type==="style"&&e.style==="none"}_computeMaterialWidth(e){var r;return e=e??Rh(1),this._drivenProperties.size?(r=this._fastUpdates)!=null&&r.visualVariables.size?Es(1):1:Es(e)}_prepareMaterialPatch(e,r,i){var a,l;const n=r.material;if(n==null)return void(i.changed&&i.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,e));if(n.type==="collection")return;const s=n.type==="complete"?(a=n.newValue)==null?void 0:a.color:((l=n.diff.color)==null?void 0:l.type)==="complete"?n.diff.color.newValue:null,o=this._getCombinedOpacityAndColor(s);i.useMaterialColor&&this._patchMaterialColor(mF(o),this._markerMaterialCached,e),this._patternHidesLine&&(o[3]=0),this._patchMaterialColor(o,this._lineMaterialCached,e),delete r.material}_prepareMarkerPatch(e,r){var u;const i=r.marker,n=this._markerMaterial;if(i==null||i.type!=="partial"||i.diff==null||i.diff.placement!=null||i.diff.style!=null&&i.diff.style.type!=="complete"||i.diff.color!=null&&i.diff.color.type!=="complete"||n==null)return{changed:!1,useMaterialColor:this._markerColor==null};const s=i.diff.color,o=s!=null,a=o?s.newValue:null,l=a==null&&this._markerColor==null;a&&this._patchMaterialColor(this._getCombinedOpacityAndColor(a),n,e);const c=(u=i.diff.style)==null?void 0:u.newValue;return c&&e.symbolLayerStatePatches.push(()=>n.setParameters({markerPrimitive:CSe(c)})),delete r.marker,{changed:o,useMaterialColor:l}}_patchMaterialColor(e,r,i){r!=null&&i.symbolLayerStatePatches.push(()=>r.setParameters({color:e}))}};var AD;xBe.elevationModeChangeTypes={definedChanged:Xn.RECREATE,staysOnTheGround:Xn.NONE,onTheGroundChanged:Xn.RECREATE},function(t){t[t.DRAPED=0]="DRAPED",t[t.ELEVATED=1]="ELEVATED"}(AD||(AD={}));let a$=null,sj=!0;function cZ(t,e,r){if(!t||!e)throw new Error("Cannot construct image data without dimensions");if(sj)try{return new ImageData(t,e)}catch{sj=!1}return TBe(t,e,r)}function e6t(t,e,r,i){if(!e||!r)throw new Error("Cannot construct image data without dimensions");if(sj)try{return new ImageData(t,e,r)}catch{sj=!1}const n=TBe(e,r,i);return n.data.set(t,0),n}function t6t(){return a$||(a$=document.createElement("canvas"),a$.width=1,a$.height=1),a$}function TBe(t,e,r){return r||(r=t6t()),r.getContext("2d").createImageData(t,e)}var WR;const uZ=new WeakMap;let r6t=0,oy=WR=class extends me{constructor(t){super(t),this.wrap="repeat"}get url(){return this._get("url")||null}set url(t){this._set("url",t),t&&this._set("data",null)}get data(){return this._get("data")||null}set data(t){this._set("data",t),t&&this._set("url",null)}writeData(t,e,r,i){if(t instanceof HTMLImageElement){const n={type:"image-element",src:I_(t.src,i),crossOrigin:t.crossOrigin};e[r]=n}else if(t instanceof HTMLCanvasElement){const n=t.getContext("2d").getImageData(0,0,t.width,t.height),s={type:"canvas-element",imageData:this._encodeImageData(n)};e[r]=s}else if(t instanceof HTMLVideoElement){const n={type:"video-element",src:I_(t.src,i),autoplay:t.autoplay,loop:t.loop,muted:t.muted,crossOrigin:t.crossOrigin,preload:t.preload};e[r]=n}else if(t instanceof ImageData){const n={type:"image-data",imageData:this._encodeImageData(t)};e[r]=n}}readData(t){switch(t.type){case"image-element":{const e=new Image;return e.src=t.src,e.crossOrigin=t.crossOrigin,e}case"canvas-element":{const e=this._decodeImageData(t.imageData),r=document.createElement("canvas");return r.width=e.width,r.height=e.height,r.getContext("2d").putImageData(e,0,0),r}case"image-data":return this._decodeImageData(t.imageData);case"video-element":{const e=document.createElement("video");return e.src=t.src,e.crossOrigin=t.crossOrigin,e.autoplay=t.autoplay,e.loop=t.loop,e.muted=t.muted,e.preload=t.preload,e}default:return}}get transparent(){const t=this.data,e=this.url;if(t instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(t.getContext("2d").getImageData(0,0,t.width,t.height));if(t instanceof ImageData)return this._imageDataContainsTransparent(t);if(e){const r=e.substr(e.length-4,4).toLowerCase(),i=e.substr(0,15).toLocaleLowerCase();if(r===".png"||i==="data:image/png;")return!0}return!1}set transparent(t){this._overrideIfSome("transparent",t)}get contentHash(){const t=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",e=(r="")=>`d:${r},t:${this.transparent},w:${t}`;return this.url!=null?e(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?e(this.data.src):(uZ.has(this.data)||uZ.set(this.data,++r6t),e(uZ.get(this.data))):e()}get memoryUsage(){let t=0;if(t+=this.url!=null?this.url.length:0,this.data!=null){const e=this.data;"data"in e?t+=e.data.byteLength:e instanceof HTMLImageElement?t+=e.naturalWidth*e.naturalHeight*3:e instanceof HTMLCanvasElement&&(t+=e.width*e.height*3)}return t}clone(){const t={url:this.url,data:this.data,wrap:this._cloneWrap()};return new WR(t)}cloneWithDeduplication(t){const e=t.get(this);if(e)return e;const r=this.clone();return t.set(this,r),r}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(t){let e="";for(let r=0;r<t.data.length;r++)e+=String.fromCharCode(t.data[r]);return{data:btoa(e),width:t.width,height:t.height}}_decodeImageData(t){const e=atob(t.data),r=new Uint8ClampedArray(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return e6t(r,t.width,t.height)}_imageDataContainsTransparent(t){for(let e=3;e<t.data.length;e+=4)if(t.data[e]!==255)return!0;return!1}static from(t){return typeof t=="string"?new WR({url:t}):t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof ImageData||t instanceof HTMLVideoElement?new WR({data:t}):X2(WR,t)}};d([p({type:String,json:{write:Qw}})],oy.prototype,"url",null),d([p({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),p()],oy.prototype,"data",null),d([tt("data")],oy.prototype,"writeData",null),d([ke("data")],oy.prototype,"readData",null),d([p({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],oy.prototype,"transparent",null),d([p({json:{write:!0}})],oy.prototype,"wrap",void 0),d([p({readOnly:!0})],oy.prototype,"contentHash",null),oy=WR=d([I("esri.geometry.support.MeshTexture")],oy);const PD=oy;let XR=class extends Rn(me){constructor(e){super(e),this.offset=[0,0],this.rotation=0,this.scale=[1,1]}};d([p({type:[Number],nonNullable:!0,json:{write:!0}})],XR.prototype,"offset",void 0),d([p({type:Number,nonNullable:!0,json:{write:!0}})],XR.prototype,"rotation",void 0),d([p({type:[Number],nonNullable:!0,json:{write:!0}})],XR.prototype,"scale",void 0),XR=d([I("esri.geometry.support.MeshTextureTransform")],XR);const NA=XR;var xne;let Qf=xne=class extends me{constructor(t){super(t),this.color=null,this.colorTexture=null,this.colorTextureTransform=null,this.normalTexture=void 0,this.normalTextureTransform=void 0,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new xne(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}clonePropertiesWithDeduplication(t){var e,r,i,n;return{color:this.color!=null?this.color.clone():null,colorTexture:(e=this.colorTexture)==null?void 0:e.cloneWithDeduplication(t),normalTexture:(r=this.normalTexture)==null?void 0:r.cloneWithDeduplication(t),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:(i=this.colorTextureTransform)==null?void 0:i.clone(),normalTextureTransform:(n=this.normalTextureTransform)==null?void 0:n.clone()}}get memoryUsage(){return this.getMemoryUsage()}getMemoryUsage(){let t=0;return t+=this.color!=null?16:0,this.colorTexture!=null&&(t+=this.colorTexture.memoryUsage),t+=this.colorTextureTransform!=null?20:0,this.normalTexture!=null&&(t+=this.normalTexture.memoryUsage),t+=this.normalTextureTransform!=null?20:0,t}};d([p({type:ht,json:{write:!0}})],Qf.prototype,"color",void 0),d([p({type:PD,json:{write:!0}})],Qf.prototype,"colorTexture",void 0),d([p({type:NA,json:{write:!0}})],Qf.prototype,"colorTextureTransform",void 0),d([p({type:PD,json:{write:!0}})],Qf.prototype,"normalTexture",void 0),d([p({type:NA,json:{write:!0}})],Qf.prototype,"normalTextureTransform",void 0),d([p({nonNullable:!0,json:{write:!0}})],Qf.prototype,"alphaMode",void 0),d([p({nonNullable:!0,json:{write:!0}})],Qf.prototype,"alphaCutoff",void 0),d([p({nonNullable:!0,json:{write:!0}})],Qf.prototype,"doubleSided",void 0),Qf=xne=d([I("esri.geometry.support.MeshMaterial")],Qf);const Ppe=Qf;var Sne;let lp=Sne=class extends Ppe{constructor(t){super(t),this.emissiveColor=null,this.emissiveTexture=null,this.emissiveTextureTransform=void 0,this.occlusionTexture=null,this.occlusionTextureTransform=void 0,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null,this.metallicRoughnessTextureTransform=void 0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(t,e){const r=t!=null?t.get(this):null;if(r)return r;const i=new Sne(this.clonePropertiesWithDeduplication(e));return t!=null&&t.set(this,i),i}getMemoryUsage(){let t=super.getMemoryUsage();return t+=this.emissiveColor!=null?16:0,this.emissiveTexture!=null&&(t+=this.emissiveTexture.memoryUsage),t+=this.emissiveTextureTransform!=null?20:0,this.occlusionTexture!=null&&(t+=this.occlusionTexture.memoryUsage),t+=this.occlusionTextureTransform!=null?20:0,this.metallicRoughnessTexture!=null&&(t+=this.metallicRoughnessTexture.memoryUsage),t+=this.metallicRoughnessTextureTransform!=null?20:0,t}clonePropertiesWithDeduplication(t){var e,r,i,n,s,o,a;return{...super.clonePropertiesWithDeduplication(t),emissiveColor:(e=this.emissiveColor)==null?void 0:e.clone(),emissiveTexture:(r=this.emissiveTexture)==null?void 0:r.cloneWithDeduplication(t),emissiveTextureTransform:(i=this.emissiveTextureTransform)==null?void 0:i.clone(),occlusionTexture:(n=this.occlusionTexture)==null?void 0:n.cloneWithDeduplication(t),occlusionTextureTransform:(s=this.occlusionTextureTransform)==null?void 0:s.clone(),metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:(o=this.metallicRoughnessTexture)==null?void 0:o.cloneWithDeduplication(t),metallicRoughnessTextureTransform:(a=this.metallicRoughnessTextureTransform)==null?void 0:a.clone()}}};d([p({type:ht,json:{write:!0}})],lp.prototype,"emissiveColor",void 0),d([p({type:PD,json:{write:!0}})],lp.prototype,"emissiveTexture",void 0),d([p({type:NA,json:{write:!0}})],lp.prototype,"emissiveTextureTransform",void 0),d([p({type:PD,json:{write:!0}})],lp.prototype,"occlusionTexture",void 0),d([p({type:NA,json:{write:!0}})],lp.prototype,"occlusionTextureTransform",void 0),d([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],lp.prototype,"metallic",void 0),d([p({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],lp.prototype,"roughness",void 0),d([p({type:PD,json:{write:!0}})],lp.prototype,"metallicRoughnessTexture",void 0),d([p({type:NA,json:{write:!0}})],lp.prototype,"metallicRoughnessTextureTransform",void 0),lp=Sne=d([I("esri.geometry.support.MeshMaterialMetallicRoughness")],lp);const EBe=lp;var Fz;const CBe="esri.geometry.support.MeshVertexAttributes",UC=re.getLogger(CBe);let jh=Fz=class extends me{constructor(t){super(t),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(t){return YR(t,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},UC)}castPosition(t){return t&&t instanceof Float32Array&&UC.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),YR(t,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},UC)}castUv(t){return YR(t,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},UC)}castNormal(t){return YR(t,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},UC)}castTangent(t){return YR(t,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},UC)}clone(){const t={position:ie(this.position),uv:ie(this.uv),normal:ie(this.normal),tangent:ie(this.tangent),color:ie(this.color)};return new Fz(t)}clonePositional(){const t={position:ie(this.position),normal:ie(this.normal),tangent:ie(this.tangent),uv:this.uv,color:this.color};return new Fz(t)}get memoryUsage(){let t=0;return t+=this.position.byteLength,this.uv!=null&&(t+=this.uv.byteLength),this.normal!=null&&(t+=this.normal.byteLength),this.tangent!=null&&(t+=this.tangent.byteLength),this.color!=null&&(t+=this.color.byteLength),t}};function dZ(t,e,r,i){const{loggerTag:n,stride:s}=e;return t.length%s!=0?(i.error(n,`Invalid array length, expected a multiple of ${s}`),new r([])):t}function YR(t,e,r,i,n){if(!t)return t;if(t instanceof e)return dZ(t,i,e,n);for(const s of r)if(t instanceof s)return dZ(new e(t),i,e,n);if(Array.isArray(t))return dZ(new e(t),i,e,n);{const s=r.map(o=>`'${o.name}'`);return n.error(`Failed to set property, expected one of ${s}, but got ${t.constructor.name}`),new e([])}}function l$(t,e,r){e[r]=i6t(t)}function i6t(t){const e=new Array(t.length);for(let r=0;r<t.length;r++)e[r]=t[r];return e}d([p({json:{write:l$}})],jh.prototype,"color",void 0),d([ur("color")],jh.prototype,"castColor",null),d([p({nonNullable:!0,json:{write:l$}})],jh.prototype,"position",void 0),d([ur("position")],jh.prototype,"castPosition",null),d([p({json:{write:l$}})],jh.prototype,"uv",void 0),d([ur("uv")],jh.prototype,"castUv",null),d([p({json:{write:l$}})],jh.prototype,"normal",void 0),d([ur("normal")],jh.prototype,"castNormal",null),d([p({json:{write:l$}})],jh.prototype,"tangent",void 0),d([ur("tangent")],jh.prototype,"castTangent",null),jh=Fz=d([I(CBe)],jh);var KI;const RBe="esri.geometry.support.MeshComponent",n6t=re.getLogger(RBe);let dv=KI=class extends me{static from(t){return X2(KI,t)}constructor(t){super(t),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}castFaces(t){return YR(t,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},n6t)}castMaterial(t){return X2(t&&typeof t=="object"&&("metallic"in t||"roughness"in t||"metallicRoughnessTexture"in t)?EBe:Ppe,t)}clone(){return new KI({faces:ie(this.faces),shading:this.shading,material:ie(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(t,e){const r={faces:ie(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(t,e):null,trustSourceNormals:this.trustSourceNormals};return new KI(r)}get memoryUsage(){let t=0;return this.faces!=null&&(t+=this.faces.byteLength),this.material!=null&&(t+=this.material.memoryUsage),t}};d([p({json:{write:!0}})],dv.prototype,"faces",void 0),d([ur("faces")],dv.prototype,"castFaces",null),d([p({type:Ppe,json:{write:!0}})],dv.prototype,"material",void 0),d([ur("material")],dv.prototype,"castMaterial",null),d([p({type:String,json:{write:!0}})],dv.prototype,"shading",void 0),d([p({type:Boolean})],dv.prototype,"trustSourceNormals",void 0),dv=KI=d([I(RBe)],dv);const s6t=dv,sq=re.getLogger("esri.geometry.support.meshUtils.normalProjection");function o6t(t,e,r,i,n){return aq(i)?(oq(c_.TO_PCPF,xo.fromTypedArray(t),ff.fromTypedArray(e),ff.fromTypedArray(r),i,xo.fromTypedArray(n)),n):(sq.error("Cannot convert spatial reference to PCPF"),n)}function wwr(t,e,r,i,n){return aq(i)?(oq(c_.FROM_PCPF,xo.fromTypedArray(t),ff.fromTypedArray(e),ff.fromTypedArray(r),i,xo.fromTypedArray(n)),n):(sq.error("Cannot convert to spatial reference from PCPF"),n)}function xwr(t,e,r){return Ni(t,e,0,r,d0(e),0,t.length/3),r}function Swr(t,e,r){return Ni(t,d0(r),0,e,r,0,t.length/3),e}function a6t(t,e,r){return ix(ea,r),gE(e,t,ea),Que(ea)||XH(e,e),e}function l6t(t,e,r){if(ix(ea,r),gE(e,t,ea,4),Que(ea)||XH(e,e,4),t!==e)for(let i=3;i<t.length;i+=4)e[i]=t[i];return e}function c6t(t,e,r,i,n){if(!aq(i))return sq.error("Cannot convert spatial reference to PCPF"),n;oq(c_.TO_PCPF,xo.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT),ff.fromTypedArray(e),ff.fromTypedArray(r),i,xo.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function Twr(t,e,r,i,n){if(!aq(i))return sq.error("Cannot convert to spatial reference from PCPF"),n;oq(c_.FROM_PCPF,xo.fromTypedArray(t,16),ff.fromTypedArray(e),ff.fromTypedArray(r),i,xo.fromTypedArray(n,16));for(let s=3;s<t.length;s+=4)n[s]=t[s];return n}function oq(t,e,r,i,n,s){if(!e)return;const o=r.count,a=d0(n);if(OBe(n))for(let l=0;l<o;l++)i.getVec(l,C6),e.getVec(l,Ng),lu(a,C6,R6,a),uf(ea,R6),t===c_.FROM_PCPF&&df(ea,ea),nd(Ng,Ng,ea),s.setVec(l,Ng);else for(let l=0;l<o;l++){i.getVec(l,C6),e.getVec(l,Ng),lu(a,C6,R6,a),uf(ea,R6);const c=PV(r.get(l,1));let u=Math.cos(c);t===c_.TO_PCPF&&(u=1/u),ea[0]*=u,ea[1]*=u,ea[2]*=u,ea[3]*=u,ea[4]*=u,ea[5]*=u,t===c_.FROM_PCPF&&df(ea,ea),nd(Ng,Ng,ea),Se(Ng,Ng),s.setVec(l,Ng)}return s}function aq(t){return OBe(t)||u6t(t)}function OBe(t){return t.isWGS84||TIe(t)||w0(t)||x0(t)}function u6t(t){return t.isWebMercator}var c_;(function(t){t[t.TO_PCPF=0]="TO_PCPF",t[t.FROM_PCPF=1]="FROM_PCPF"})(c_||(c_={}));const C6=A(),Ng=A(),R6=Me(),ea=vn();var MD;(function(t){t[t.EnableFastUpdates=0]="EnableFastUpdates",t[t.DisableFastUpdates=1]="DisableFastUpdates",t[t.UpdateFastLocalOrigin=2]="UpdateFastLocalOrigin"})(MD||(MD={}));let ABe=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=n_.KTX2_ENCODING}};function $2(t){return(t==null?void 0:t.type)==="encoded-mesh-texture"}async function d6t(t){return new Promise((e,r)=>{const i=new Blob([t]),n=new FileReader;n.onload=()=>{const s=n.result;e(JSON.parse(s))},n.onerror=s=>{r(s)},n.readAsText(i)})}async function h6t(t,e){return e===n_.KTX2_ENCODING?new ABe(t):new Promise((r,i)=>{const n=new Blob([t],{type:e}),s=URL.createObjectURL(n),o=new Image,a=()=>{URL.revokeObjectURL(s),"decode"in o?o.decode().then(()=>r(o),()=>r(o)).then(c):(r(o),c())},l=u=>{URL.revokeObjectURL(s),i(u),c()},c=()=>{o.removeEventListener("load",a),o.removeEventListener("error",l)};o.addEventListener("load",a),o.addEventListener("error",l),o.src=s})}function My(t){if(t==null)return null;const e=t.offset!=null?t.offset:o9e,r=t.rotation!=null?t.rotation:0,i=t.scale!=null?t.scale:a9e,n=Dz(1,0,0,0,1,0,e[0],e[1],1),s=Dz(Math.cos(r),-Math.sin(r),0,Math.sin(r),Math.cos(r),0,0,0,1),o=Dz(i[0],0,0,0,i[1],0,0,0,1),a=uu();return $P(a,s,o),$P(a,n,a),a}re.getLogger("esri.views.3d.layers.graphics.Graphics3DMeshObject3DGraphicLayer");let p6t=class extends O0{constructor(){super(...arguments),this._originalGeometries=[],this._fastTransformUpdatesEnabled=!1}get fastTransformUpdatesEnabled(){return this._fastTransformUpdatesEnabled}enableFastTransformUpdates(e,r){if(this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!0;const{stageObject:i}=this,n=i.geometries.slice();i.removeAllGeometries();const s=tee(hZ,i.transformation),o=r.getOrigin(s);for(const a of n){const l=e(a.material),c=a.instantiate({material:l});c.localOrigin=o,i.addGeometry(c)}this._originalGeometries=n}disableFastTransformUpdates(e){if(!this._fastTransformUpdatesEnabled)return;this._fastTransformUpdatesEnabled=!1;const{stageObject:r}=this,i=r.geometries.map(n=>e(n.material));r.removeAllGeometries();for(let n=0;n<this._originalGeometries.length;n++){const s=this._originalGeometries[n],o=i[n];o.setParameters({modelTransformation:null}),o===s.material?r.addGeometry(s):r.addGeometry(s.instantiate({material:o}))}this._originalGeometries.length=0}updateFastLocalOrigin(e,r,i){if(!this._fastTransformUpdatesEnabled)return;const{stageObject:n}=this;if(n.geometries.length===0)return;const s=n.geometries[0].localOrigin,o=tee(hZ,e),a=i.getOrigin(o);if(a===s)return;const l=(r==null?void 0:r.localMatrix)??bo;n.clearShaderTransformation(),n.transformation=e,n.geometries.forEach(c=>{c.transformation=l,c.localOrigin=a})}updateTransform(e,r,i){const{stageObject:n}=this,s=(r==null?void 0:r.localMatrix)??bo;if(!this._fastTransformUpdatesEnabled)return n.clearShaderTransformation(),n.transformation=e,n.geometries.forEach(m=>{m.transformation=s}),void this.resetEdgeObject(i);const o=n.transformation,a=n.geometries[0].transformation,l=e,c=s,u=Ii(OSe,o,a),h=Ii(ASe,l,c);n.shaderTransformation=l,this._setFastMaterialTransformation({matA:u,matB:h});const f=()=>c;for(const m of n.geometries)m.shaderTransformer=f;this.resetEdgeObject(i)}alignWithElevation(e,r,i,n){if(!this._fastTransformUpdatesEnabled)return void super.alignWithElevation(e,r,i,n);i!=null&&HH(this.elevationContext.featureExpressionInfoContext,i);const s=(m,g)=>fx(m,e,this.elevationContext,r,g),{stageObject:o}=this;if(!o.geometries[0].material.parameters.modelTransformation)return;const a=o.transformation,l=o.geometries[0].transformation,c=Ii(OSe,a,l),u=Rs(f6t,o.shaderTransformation);this.alignedSampledElevation=O2(this,this.elevationContext,e.spatialReference,s,r,u),o.shaderTransformation=u;const h=o.geometries[0].shaderTransformation,f=Ii(ASe,u,h);this._setFastMaterialTransformation({matA:c,matB:f}),this.resetEdgeObject(n)}_setFastMaterialTransformation({matA:e,matB:r}){const{stageObject:i}=this;if(i.geometries.length===0)return;const n=i.geometries[0].localOrigin,s=eF(m6t,ce(hZ,n.vec3,-1)),o=Ii(PSe,s,e),a=Ii(MSe,s,r),l=Uo(PSe,o),c=Ii(MSe,a,l);for(const u of i.geometries)u.material.setParameters({modelTransformation:c})}};const hZ=A(),OSe=Me(),ASe=Me(),f6t=Me(),PSe=Me(),MSe=Me(),m6t=Me();let g6t=class{constructor(){this._fastTransformOriginalMaterials=new Map,this._fastTransformClonedMaterials=new Map,this._graphicReferenceCount=0}enable(e,r,i){e.enableFastTransformUpdates(n=>{if(this._graphicReferenceCount<=1){if(this._fastTransformOriginalMaterials.has(n))return n;const o=r.byMaterial(n);return this._fastTransformOriginalMaterials.set(n,o),r.delete(n),n}const s=new g0(n.parameters);return i.stage.add(s),this._fastTransformClonedMaterials.set(s,n),s},i.localOriginFactory)}disable(e,r,i){const n=new Set,s=new Set;e.disableFastTransformUpdates(o=>{if(!this._fastTransformClonedMaterials.has(o)){const c=o,u=this._fastTransformOriginalMaterials.get(c);return r.has(u.uid)?(n.add(c),r.byUid(u.uid).material):(s.add(c),u.material)}const a=o,l=this._fastTransformClonedMaterials.get(a);return this._fastTransformClonedMaterials.delete(a),i.stage.remove(a),a.dispose(),l});for(const o of n)this._fastTransformOriginalMaterials.delete(o),i.stage.remove(o),o.dispose();for(const o of s){const a=this._fastTransformOriginalMaterials.get(o);this._fastTransformOriginalMaterials.delete(o),r.set(a.uid,a)}}onAddGraphic(){this._graphicReferenceCount++}onRemoveGraphic(e,r,i){this._graphicReferenceCount--,this.disable(e,r,i)}forEachMaterialInfo(e){this._fastTransformOriginalMaterials.forEach(e)}forEachClonedMaterial(e){this._fastTransformClonedMaterials.forEach(e)}destroy(e){e.removeMany(Array.from(this._fastTransformClonedMaterials.keys())),e.removeMany(Array.from(this._fastTransformOriginalMaterials.values(),({material:r})=>r)),this._fastTransformClonedMaterials.clear(),this._fastTransformOriginalMaterials.clear()}},y6t=class{constructor(){this._byUid=new Map,this._byMaterial=new Map}get materials(){return Array.from(this._byUid.values(),e=>e.material)}byUid(e){return this._byUid.get(e)}byMaterial(e){return this._byMaterial.get(e)}set(e,r){this._byUid.set(e,r),this._byMaterial.set(r.material,r)}delete(e){var i;const r=(i=this._byMaterial.get(e))==null?void 0:i.uid;r&&(this._byUid.delete(r),this._byMaterial.delete(e))}has(e){return this._byUid.has(e)}forEachMaterialInfo(e){this._byUid.forEach(e)}clear(){this._byUid.clear(),this._byMaterial.clear()}};function v6t(t){const e=new jr,{vertex:r,fragment:i}=e;return e.include(nu,t),e.include(WE,t),e.include(H9e,t),gd(r,t),t.stippleEnabled&&(e.attributes.add(O.UV0,"vec2"),e.attributes.add(O.AUXPOS1,"vec3"),r.uniforms.add(new Cr("viewport",(n,s)=>s.camera.fullViewport))),e.attributes.add(O.POSITION,"vec3"),e.varyings.add("vpos","vec3"),r.code.add(T`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`),t.stippleEnabled&&(r.code.add(T`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),t.draped?r.uniforms.add(new Ye("worldToScreenRatio",(n,s)=>1/s.screenToPCSRatio)):r.code.add(T`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),r.code.add(T`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),t.draped?r.code.add(T`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):r.code.add(T`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),r.uniforms.add(new Ye("stipplePatternPixelSize",n=>ope(n))),r.code.add(T`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`)),r.code.add(T`}`),t.output===q.Highlight&&e.include(s1,t),e.include(as,t),i.uniforms.add(new Ye("alphaCoverage",(n,s)=>Math.min(1,n.width*s.camera.pixelRatio))),t.hasVertexColors||i.uniforms.add(new Cr("constantColor",n=>n.color)),i.code.add(T`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${t.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${t.output===q.ObjectAndLayerIdColor?T`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${T.float(Ma)}) {
      discard;
    }

    ${t.output===q.Color?T`fragColor = highlightSlice(finalColor, vpos);`:""}
    ${t.output===q.Highlight?T`outputHighlight();`:""}
  }
  `),e}const _6t=Object.freeze(Object.defineProperty({__proto__:null,build:v6t},Symbol.toStringTag,{value:"Module"}));let PBe=class MBe extends si{get _stippleEnabled(){return this.configuration.stippleEnabled&&this.configuration.output!==q.Highlight}initializeProgram(e){return new Kr(e.rctx,MBe.shader.get().build(this.configuration),Br)}initializePipeline(){const e=this.configuration,r=Fa(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),i=(n,s=null,o=null)=>Qt({blending:s,depthTest:lpe,depthWrite:o,colorWrite:hr,stencilWrite:e.hasOccludees?m0:null,stencilTest:e.hasOccludees?n?vx:Mx:null});return e.output===q.Color?(this._occludeePipelineState=i(!0,e.transparent||this._stippleEnabled?r:null,fu),i(!1,e.transparent||this._stippleEnabled?r:null,fu)):i(!1)}get primitiveType(){return Zt.LINES}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};PBe.shader=new Jr(_6t,()=>le(()=>import("./NativeLine.glsl-9149de7c.js"),[]));let Vd=class extends tl{constructor(){super(...arguments),this.output=q.Color,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.draped=!1,this.stippleEnabled=!1,this.stippleOffColorEnabled=!1,this.stipplePreferContinuous=!0,this.hasOccludees=!1}};d([X({count:q.COUNT})],Vd.prototype,"output",void 0),d([X()],Vd.prototype,"hasSlicePlane",void 0),d([X()],Vd.prototype,"hasVertexColors",void 0),d([X()],Vd.prototype,"transparent",void 0),d([X()],Vd.prototype,"draped",void 0),d([X()],Vd.prototype,"stippleEnabled",void 0),d([X()],Vd.prototype,"stippleOffColorEnabled",void 0),d([X()],Vd.prototype,"stipplePreferContinuous",void 0),d([X()],Vd.prototype,"hasOccludees",void 0),d([X({constValue:!1})],Vd.prototype,"stippleRequiresClamp",void 0),d([X({constValue:!1})],Vd.prototype,"stippleScaleWithLineWidth",void 0),d([X({constValue:!1})],Vd.prototype,"stippleRequiresStretchMeasure",void 0);var oj;(function(t){t[t.START=0]="START",t[t.END=1]="END"})(oj||(oj={}));let $Se=class extends Ax{constructor(e){super(e,new x6t),this._configuration=new Vd}getConfiguration(e,r){this._configuration.output=e,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.transparent=this.parameters.color[3]<1||this.parameters.width<1,this._configuration.draped=r.slot===_e.DRAPED_MATERIAL;const i=this.parameters.stipplePattern!=null;return this._configuration.stippleEnabled=i,this._configuration.stippleOffColorEnabled=i&&this.parameters.stippleOffColor!=null,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous,this._configuration}intersect(e,r,i,n,s,o){if(!i.options.selectionMode||!e.visible)return;if(!Kke(r))return void re.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix");const a=e.vertexAttributes.get(O.POSITION).data,l=i.camera,c=T6t;Eo(c,i.point);const u=2;se(c$[0],c[0]-u,c[1]+u,0),se(c$[1],c[0]+u,c[1]+u,0),se(c$[2],c[0]+u,c[1]-u,0),se(c$[3],c[0]-u,c[1]-u,0);for(let y=0;y<4;y++)if(!l.unprojectFromRenderScreen(c$[y],V0[y]))return;Rl(l.eye,V0[0],V0[1],pZ),Rl(l.eye,V0[1],V0[2],fZ),Rl(l.eye,V0[2],V0[3],mZ),Rl(l.eye,V0[3],V0[0],gZ);let h=Number.MAX_VALUE,f=0;for(let y=0;y<a.length-5;y+=3){if(sc[0]=a[y]+r[12],sc[1]=a[y+1]+r[13],sc[2]=a[y+2]+r[14],oc[0]=a[y+3]+r[12],oc[1]=a[y+4]+r[13],oc[2]=a[y+5]+r[14],zi(pZ,sc)<0&&zi(pZ,oc)<0||zi(fZ,sc)<0&&zi(fZ,oc)<0||zi(mZ,sc)<0&&zi(mZ,oc)<0||zi(gZ,sc)<0&&zi(gZ,oc)<0)continue;if(l.projectToRenderScreen(sc,oS),l.projectToRenderScreen(oc,aS),oS[2]<0&&aS[2]>0){ve(Fg,sc,oc);const b=l.frustum,w=-zi(b[Ui.NEAR],sc)/ye(Fg,b[Ui.NEAR]);ce(Fg,Fg,w),ge(sc,sc,Fg),l.projectToRenderScreen(sc,oS)}else if(oS[2]>0&&aS[2]<0){ve(Fg,oc,sc);const b=l.frustum,w=-zi(b[Ui.NEAR],oc)/ye(Fg,b[Ui.NEAR]);ce(Fg,Fg,w),ge(oc,oc,Fg),l.projectToRenderScreen(oc,aS)}else if(oS[2]<0&&aS[2]<0)continue;oS[2]=0,aS[2]=0;const _=ode(S2(oS,aS,DSe),c);_<h&&(h=_,oe(ISe,sc),oe(LSe,oc),f=y/3)}const m=i.rayBegin,g=i.rayEnd;if(h<u*u){let y=Number.MAX_VALUE;if(n5e(S2(ISe,LSe,DSe),S2(m,g,S6t),sS)){ve(sS,sS,m);const _=We(sS);ce(sS,sS,1/_),y=_/Li(m,g)}o(y,sS,f,!1)}}intersectDraped(e,r,i,n,s,o){if(!i.options.selectionMode)return;const a=e.vertexAttributes.get(O.POSITION).data,l=e.vertexAttributes.get(O.SIZE),c=l?l.data[0]:0,u=n[0],h=n[1],f=((c+1)/2+4)*e.screenToWorldRatio;let m=Number.MAX_VALUE,g=0;for(let y=0;y<a.length-5;y+=3){const _=a[y],b=a[y+1],w=u-_,x=h-b,S=a[y+3]-_,C=a[y+4]-b,E=Te((S*w+C*x)/(S*S+C*C),0,1),R=S*E-w,P=C*E-x,D=R*R+P*P;D<m&&(m=D,g=y/3)}m<f*f&&s(o.dist,o.normal,g,!1)}requiresSlot(e,r){return!(r!==q.Color&&r!==q.Highlight&&r!==q.ObjectAndLayerIdColor||e!==_e.OPAQUE_MATERIAL&&e!==_e.DRAPED_MATERIAL)}createGLMaterial(e){return new b6t(e)}createBufferWriter(){const e=this.parameters.hasVertexColors?x4t:b4t;return this.parameters.stipplePattern==null?new J3(e):new w6t(e.clone().vec3f(O.AUXPOS1).vec2f(O.UV0))}},b6t=class extends Rx{constructor(){super(...arguments),this._stipplePattern=null}dispose(){super.dispose(),this._stippleTextureRepository.release(this._stipplePattern),this._stipplePattern=null}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){this._output===q.Color&&this._updateOccludeeState(e);const r=this._material.parameters.stipplePattern;return this._stipplePattern!==r&&(this._material.setParameters({stippleTexture:this._stippleTextureRepository.swap(r,this._stipplePattern)}),this._stipplePattern=r),this.ensureTechnique(PBe,e)}},w6t=class{constructor(e){this.vertexBufferLayout=e}elementCount(e){return e.indices.get(O.POSITION).length}write(e,r,i,n,s){$8e(i,this.vertexBufferLayout,e,r,n,s),this._writeAuxpos1(e,i,n,s),this._writeUV0(e,i,n,s)}_writeAuxpos1(e,r,i,n){const s=i.getField(O.AUXPOS1,xo),o=r.indices.get(O.POSITION),a=r.vertexAttributes.get(O.POSITION).data,l=e,c=s.typedBufferStride,u=s.typedBuffer;n*=c;for(let h=0;h<o.length-1;h+=2)for(const f of[1,0]){const m=3*o[h+f],g=a[m],y=a[m+1],_=a[m+2],b=l[0]*g+l[4]*y+l[8]*_+l[12],w=l[1]*g+l[5]*y+l[9]*_+l[13],x=l[2]*g+l[6]*y+l[10]*_+l[14];u[n]=b,u[n+1]=w,u[n+2]=x,n+=c}}_writeUV0(e,r,i,n){var x;const s=i.getField(O.UV0,Ox),o=r.indices.get(O.POSITION),a=r.vertexAttributes.get(O.POSITION).data,l=(x=r.vertexAttributes.get(O.DISTANCETOSTART))==null?void 0:x.data,c=s.typedBufferStride,u=s.typedBuffer;let h=0;u[n*=c]=oj.START,u[n+1]=h,n+=c;const f=3*o[0],m=se(sc,a[f],a[f+1],a[f+2]);e&&lt(m,m,e);const g=oc,y=o.length-1;let _=1;const b=l?(S,C,E)=>h=l[E]:(S,C,E)=>h+=Li(S,C);for(let S=1;S<y;S+=2){const C=3*o[S];se(g,a[C],a[C+1],a[C+2]),e&&lt(g,g,e),b(m,g,_++);for(let E=0;E<2;++E)u[n]=1-E,u[n+1]=h,n+=c;oe(m,g)}const w=3*o[y];se(g,a[w],a[w+1],a[w+2]),e&&lt(g,g,e),b(m,g,_),u[n]=oj.END,u[n+1]=h}},x6t=class extends Mhe{constructor(){super(...arguments),this.color=Np,this.hasVertexColors=!1,this.hasSlicePlane=!1,this.width=1,this.stipplePreferContinuous=!0,this.hasOccludees=!1,this.stippleTexture=null}};const sc=A(),oc=A(),Fg=A(),sS=A(),oS=ua(),aS=ua(),ISe=A(),LSe=A(),DSe=fg(),S6t=fg(),T6t=A(),c$=[ua(),ua(),ua(),ua()],V0=[A(),A(),A(),A()],pZ=oi(),fZ=oi(),mZ=oi(),gZ=oi(),E6t=["mesh"];let C6t=class extends A0{constructor(e,r,i,n){super(e,r,i,n),this._materialInfoCache=new y6t,this._fastUpdateProcessor=new g6t,this._textures=new Map,this.ensureDrapedStatus(!1)}async doLoad(){Di.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new $Se({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new $Se({color:[0,1,1,1]}))}destroy(){super.destroy(),this._context.stage.removeMany(this._materialInfoCache.materials),this._context.stage.removeMany(Array.from(this._textures.values())),this._materialInfoCache.clear(),this._textures.clear(),this._fastUpdateProcessor.destroy(this._context.stage)}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,E6t,"fill on mesh-3d"))return null;const i=this.setGraphicElevationContext(r,new yg),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}onRemoveGraphic(e){this._fastUpdateProcessor.onRemoveGraphic(e,this._materialInfoCache,this._context)}layerOpacityChanged(e,r){const i=this._getLayerOpacity();this._updateMaterialParameters(n=>{n.material.setParameters({layerOpacity:i});const s=n.material.parameters;this._setMaterialTransparentParameter(s,n),n.material.setParameters({transparent:s.transparent})}),e.forEach(n=>{const s=r(n);s!=null&&s.layerOpacityChanged(i,this._context.isAsync)})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,mx)}slicePlaneEnabledChanged(e,r){return this._updateMaterialParameters(({material:i})=>{i.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),e.forEach(i=>{const n=r(i);n!=null&&n.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)}),!0}physicalBasedRenderingChanged(){const e=this._usePBR();return this._updateMaterialParameters(({material:r})=>r.setParameters({usePBR:e})),!0}updateTransform(e,r,i,n){const s=this._context.renderCoordsHelper.spatialReference,o=R6t,{origin:a,transform:l}=i;switch(lu(r,se(ma,a.x,a.y,a.z??0),o,s),n){case MD.EnableFastUpdates:this._fastUpdateProcessor.enable(e,this._materialInfoCache,this._context);break;case MD.DisableFastUpdates:this._fastUpdateProcessor.disable(e,this._materialInfoCache,this._context);break;case MD.UpdateFastLocalOrigin:e.updateFastLocalOrigin(o,l,this._context.localOriginFactory)}const{elevationContext:c}=e;c.centerPointInElevationSR=this._getCenterPointInElevationSR(o);const{elevationProvider:u,renderCoordsHelper:h}=this._context,f=(m,g)=>fx(m,u,c,h,g);return e.alignedSampledElevation=O2(e,c,u.spatialReference,f,h,o),e.updateTransform(o,l,this._context.isAsync),!0}_requiresSymbolVertexColors(){return this._drivenProperties.color||this._drivenProperties.opacity}_colorOrTextureUid(e){return e==null?"-":e instanceof ht?e.toHex():e.contentHash}_materialPropertiesDefault(e,r){const i=this._requiresSymbolVertexColors(),n=!!e.vertexAttributes.color,s=!!e.vertexAttributes.tangent;return{hasSymbolVertexColors:i,hasVertexColors:n,hasVertexTangents:s,uid:`vc:${n},vt:${s},vct${r},svc:${i}`}}_textureTransformUid(e){const{offset:r,scale:i,rotation:n}=e??A6t;return`${r[0]},${r[1]},${n},${i[0]},${i[1]}`}_materialProperties(e,r,i){const n=this._materialPropertiesDefault(e,i);if(!r.material)return n;const{color:s,colorTexture:o,colorTextureTransform:a,normalTexture:l,normalTextureTransform:c,doubleSided:u,alphaCutoff:h,alphaMode:f}=r.material,m=this._colorOrTextureUid(s),g=this._colorOrTextureUid(o),y=this._textureTransformUid(a),_=this._colorOrTextureUid(l),b=this._textureTransformUid(c);if(n.color=s,n.colorTexture=o,n.normalTexture=l,n.uid=`${n.uid},cmuid:${m},ctmuid:${g},cttuid:${y},ntmuid:${_},nttuid:${b},ds:${u},ac:${h},am:${f}`,r.material instanceof EBe){const{metallic:w,roughness:x,metallicRoughnessTexture:S,metallicRoughnessTextureTransform:C,emissiveColor:E,emissiveTexture:R,emissiveTextureTransform:P,occlusionTexture:D,occlusionTextureTransform:L}=r.material,k=this._colorOrTextureUid(S),V=this._textureTransformUid(C),W=this._colorOrTextureUid(E),G=this._colorOrTextureUid(R),B=this._textureTransformUid(P),Z=this._colorOrTextureUid(D),M=this._textureTransformUid(L);n.metallic=w,n.roughness=x,n.metallicRoughnessTexture=S,n.emissiveColor=E,n.emissiveTexture=R,n.occlusionTexture=D,n.colorTextureTransform=this._convertTextureTransform(a),n.normalTextureTransform=this._convertTextureTransform(c),n.emissiveTextureTransform=this._convertTextureTransform(P),n.occlusionTextureTransform=this._convertTextureTransform(L),n.metallicRoughnessTextureTransform=this._convertTextureTransform(C),n.uid=`${n.uid},mrm:${w},mrr:${x},mrt:${k},mrtt:${V},emuid:${W},etmuid:${G},ett:${B},otmuid:${Z},ott:${M}`}return n}_convertTextureTransform(e){if(!e)return null;const{scale:r,offset:i,rotation:n}=e;return{scale:r,offset:i,rotation:sr(n)}}_setInternalColorValueParameters(e,r){r.diffuse=ht.toUnitRGB(e),r.opacity=e.a}_getLoadableTextureResource(e){return e.data?e.data:e.url}_getInternalTextureId(e){const r=this._getInternalTexture(e,Si.Opaque);return r!=null?r.id:null}_getInternalTexture(e,r){const i=this._getLoadableTextureResource(e);if(!i)return null;const n=`${e.contentHash}/${r}`;let s=this._textures.get(n);return s||(s=new qE($2(i)?i.data:i,{mipmap:!0,wrap:this._castTextureWrap(e.wrap),noUnpackFlip:!0,preMultiplyAlpha:!$2(i)&&r!==Si.Opaque,encoding:$2(i)&&i.encoding!=null?i.encoding:void 0}),this._textures.set(n,s),this._context.stage.add(s),this._context.stage.loadImmediate(s)),s}_castTextureWrap(e="repeat"){if(typeof e=="string"){const r=this._castTextureWrapIndividual(e);return{s:r,t:r}}return{s:this._castTextureWrapIndividual(e.horizontal),t:this._castTextureWrapIndividual(e.vertical)}}_castTextureWrapIndividual(e){switch(e){case"clamp":return ir.CLAMP_TO_EDGE;case"mirror":return ir.MIRRORED_REPEAT;default:return ir.REPEAT}}_setInternalMaterialParameters(e,r){if(e.color!=null&&this._setInternalColorValueParameters(e.color,r),e.colorTexture!=null){const i=this._getInternalTexture(e.colorTexture,r.textureAlphaMode);i!=null?(r.textureId=i.id,r.textureAlphaPremultiplied=!!i.parameters.preMultiplyAlpha):r.textureId=void 0}e.normalTexture!=null&&(r.normalTextureId=this._getInternalTextureId(e.normalTexture)),e.emissiveColor!=null&&(r.emissiveFactor=ht.toUnitRGB(e.emissiveColor)),e.emissiveTexture!=null&&(r.emissiveTextureId=this._getInternalTextureId(e.emissiveTexture)),e.occlusionTexture!=null&&(r.occlusionTextureId=this._getInternalTextureId(e.occlusionTexture)),e.metallicRoughnessTexture!=null&&(r.metallicRoughnessTextureId=this._getInternalTextureId(e.metallicRoughnessTexture)),r.colorTextureTransformMatrix=My(e.colorTextureTransform),r.normalTextureTransformMatrix=My(e.normalTextureTransform),r.occlusionTextureTransformMatrix=My(e.occlusionTextureTransform),r.emissiveTextureTransformMatrix=My(e.emissiveTextureTransform),r.metallicRoughnessTextureTransformMatrix=My(e.metallicRoughnessTextureTransform)}_setExternalMaterialParameters(e){const r=this._drivenProperties.color;let i=this.symbolLayer.material!=null?this.symbolLayer.material.colorMixMode:null;if(r)e.externalColor=Np;else{const n=this.symbolLayer.material!=null?this.symbolLayer.material.color:null;n!=null?e.externalColor=ht.toUnitRGBA(n):(i=null,e.externalColor=Np)}i&&(e.colorMixMode=i),e.castShadows=!!this.symbolLayer.castShadows}_hasTransparentVertexColors(e){const r=e.vertexAttributes.color;if(r==null)return!1;for(let i=3;i<r.length;i+=4)if(r[i]!==255)return!0;return!1}_getOrCreateMaterial(e,r){var g,y,_;const i=(g=r.material)==null?void 0:g.color,n=(y=r.material)==null?void 0:y.colorTexture,s=(_=r.material)==null?void 0:_.alphaMode,o=s==="blend",a=s!=="opaque"&&(this._hasTransparentVertexColors(e)||i!=null&&i.a<1||n!=null&&n.transparent||o),l=this._materialProperties(e,r,a),c=this._materialInfoCache.byUid(l.uid);if(c)return c.material;const u={uid:l.uid,material:null,isComponentTransparent:a,alphaMode:r.material?r.material.alphaMode:"opaque"},h=AVe({normalTexture:l.normalTexture,metallicRoughnessTexture:l.metallicRoughnessTexture,metallicFactor:l.metallic,roughnessFactor:l.roughness,emissiveTexture:l.emissiveTexture,emissiveFactor:ht.toUnitRGB(l.emissiveColor),occlusionTexture:l.occlusionTexture}),f={usePBR:this._usePBR(),isSchematic:h,hasVertexColors:l.hasVertexColors,hasSymbolColors:l.hasSymbolVertexColors,hasVertexTangents:l.hasVertexTangents,ambient:Sc,diffuse:qv,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:Hi.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};f.mrrFactors=h?[...Spe]:[l.metallic,l.roughness,tq[2]],r.material&&(f.doubleSided=r.material.doubleSided,f.cullFace=r.material.doubleSided?Hi.None:Hi.Back,f.textureAlphaCutoff=r.material.alphaCutoff),this._setExternalMaterialParameters(f),this._setMaterialTransparentParameter(f,u),this._setInternalMaterialParameters(l,f);const m=new g0(f);return u.material=m,this._materialInfoCache.set(l.uid,u),this._context.stage.add(m),m}_usePBR(){return this._context.physicalBasedRenderingEnabled}_setMaterialTransparentParameter(e,r){e.transparent=this.needsDrivenTransparentPass||r.isComponentTransparent||e.layerOpacity<1||e.opacity<1||e.externalColor&&e.externalColor[3]<1,r.alphaMode==="auto"?e.textureAlphaMode=e.transparent?Si.MaskBlend:Si.Opaque:e.textureAlphaMode=r.alphaMode==="opaque"?Si.Opaque:r.alphaMode==="mask"?Si.Mask:Si.Blend}_addDebugNormals(e,r){const i=r.length,n=e.spatialReference.isGeographic?20015077/180:1,s=.1*Math.max(e.extent.width*n,e.extent.height*n,e.extent.zmax-e.extent.zmin),o=[],a=[],l=[],c=[];for(let m=0;m<i;m++){const g=r[m],y=g.vertexAttributes.get(O.POSITION),_=g.vertexAttributes.get(O.NORMAL),b=g.indices.get(O.POSITION),w=g.indices.get(O.NORMAL),x=y.data,S=_.data;for(let C=0;C<b.length;C++){const E=3*b[C],R=3*w[C];for(let P=0;P<3;P++)o.push(x[E+P]);for(let P=0;P<3;P++)o.push(x[E+P]+S[R+P]*s);if(a.push(a.length),a.push(a.length),C%3==0){this._calculateFaceNormal(x,b,C,BC),this._getFaceVertices(x,b,C,ma,zC,VC),ge(ma,ma,zC),ge(ma,ma,VC),ce(ma,ma,1/3);for(let P=0;P<3;P++)l.push(ma[P]);for(let P=0;P<3;P++)l.push(ma[P]+BC[P]*s);c.push(c.length),c.push(c.length)}}}const u=r[0].transformation,h=new Us(this._debugVertexNormalMaterial,[[O.POSITION,new ft(o,3,!0)]],[[O.POSITION,a]],null,Wn.Line);r.push(h),h.transformation=u;const f=new Us(this._debugFaceNormalMaterial,[[O.POSITION,new ft(l,3,!0)]],[[O.POSITION,c]],null,Wn.Line);f.transformation=u,r.push(f)}_createAs3DShape(e,r,i,n){const s=e.geometry;if(s.type!=="mesh")return null;const o=this._createGeometryInfo(s,r,n);if(o==null)return null;const{geometries:a,objectTransformation:l}=o;Di.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(s,a);const c=new a1({geometries:a,layerUid:this._context.layer.uid,graphicUid:n});c.transformation=l;const u=Yze(this.symbolLayer,{opacity:this._getLayerOpacity()}),h=u!=null?new JLt(a[0].material,[u],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null,f=new p6t(this,c,a,null,null,O2,i,h);this._fastUpdateProcessor.onAddGraphic(),f.needsElevationUpdates=mx(i.mode),f.useObjectOriginAsAttachmentOrigin=!0,i.centerPointInElevationSR=this._getCenterPointInElevationSR(c.transformation);const{elevationProvider:m,renderCoordsHelper:g}=this._context,y=(_,b)=>fx(_,m,i,g,b);return f.alignedSampledElevation=O2(f,i,m.spatialReference,y,g),f}_getCenterPointInElevationSR(e){const r=yd(0,0,0,this._context.elevationProvider.spatialReference!=null?this._context.elevationProvider.spatialReference:null);return aue([e[12],e[13],e[14]],this._context.renderCoordsHelper.spatialReference,r),r}_createComponentNormals(e,r,i,n){switch(i.shading||"flat"){default:case"source":return this._createComponentNormalsSource(e,r,i,n);case"flat":return this._createComponentNormalsFlat(e,n);case"smooth":return this._createComponentNormalsSmooth(e,n)}}_createComponentNormalsSource(e,r,i,n){if(r==null)return this._createComponentNormalsFlat(e,n);let s=!1;if(!i.trustSourceNormals)for(let o=0;o<n.length;o+=3){this._calculateFaceNormal(e,n,o,BC);for(let a=0;a<3;a++){const l=3*n[o+a];ma[0]=r[l],ma[1]=r[l+1],ma[2]=r[l+2],ye(BC,ma)<0&&(r[l]=-r[l],r[l+1]=-r[l+1],r[l+2]=-r[l+2],s=!0)}}return new yZ(r,n,s)}_createComponentNormalsFlat(e,r){const i=Dn(r.length),n=new Array(3*r.length);for(let s=0;s<r.length;s+=3){const o=this._calculateFaceNormal(e,r,s,BC);for(let a=0;a<3;a++)i[s+a]=o[a],n[s+a]=s/3}return new yZ(i,n,!1)}_createComponentNormalsSmooth(e,r){const i={};for(let o=0;o<r.length;o+=3){const a=this._calculateFaceNormal(e,r,o,BC);for(let l=0;l<3;l++){const c=r[o+l];let u=i[c];u||(u={normal:A(),count:0},i[c]=u),ge(u.normal,u.normal,a),u.count++}}const n=Dn(3*r.length),s=new Array(3*r.length);for(let o=0;o<r.length;o++){const a=i[r[o]];a.count!==1&&(Se(a.normal,a.normal),a.count=1);for(let l=0;l<3;l++)n[3*o+l]=a.normal[l];s[o]=o}return new yZ(n,s,!1)}_getFaceVertices(e,r,i,n,s,o){const a=3*r[i],l=3*r[i+1],c=3*r[i+2];n[0]=e[a],n[1]=e[a+1],n[2]=e[a+2],s[0]=e[l],s[1]=e[l+1],s[2]=e[l+2],o[0]=e[c],o[1]=e[c+1],o[2]=e[c+2]}_calculateFaceNormal(e,r,i,n){return this._getFaceVertices(e,r,i,ma,zC,VC),ve(zC,zC,ma),ve(VC,VC,ma),Lt(ma,zC,VC),Se(n,ma),n}_getOrCreateComponents(e){return e.components??O6t}_createPositionBuffer(e,r){let i=e.vertexAttributes.position;const n=r.reprojection===Uu.ECEF?r.transformBeforeProject:null;if(n!=null&&(i=t3(new Float64Array(i.length),i,n)),r.reprojection===Uu.NONE)return r.needsBufferCopy?new Float64Array(i):i;const s=n!=null?i:new Float64Array(i.length);return Ni(i,e.spatialReference,0,s,this._context.renderCoordsHelper.spatialReference,0,i.length/3),s}_createNormalBuffer(e,r,i){let n=e.vertexAttributes.normal;if(n==null)return null;const s=i.reprojection===Uu.ECEF?i.transformBeforeProject:null;if(s!=null&&(n=a6t(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Uu.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s!=null?n:new Float32Array(n.length);return o6t(n,o,r,e.spatialReference,a)}_createTangentBuffer(e,r,i){let n=e.vertexAttributes.tangent;if(n==null)return null;const s=i.reprojection===Uu.ECEF?i.transformBeforeProject:null;if(s!=null&&(n=l6t(n,new Float32Array(n.length),s)),this._context.graphicsCoreOwner.view.viewingMode==="local"||i.reprojection===Uu.NONE)return i.needsBufferCopy&&e.vertexAttributes.normal===n?new Float32Array(n):n;const o=e.vertexAttributes.position,a=s!=null?n:new Float32Array(n.length);return c6t(n,o,r,e.spatialReference,a)}_createColorBuffer(e){return e.vertexAttributes.color}_createSymbolColorBuffer(e){var r,i;if(this._requiresSymbolVertexColors()){const n=this._getVertexOpacityAndColor(e),s=$Ve((i=(r=this.symbolLayer)==null?void 0:r.material)==null?void 0:i.colorMixMode),o=new Uint8Array(4);return IVe(n,s,o),o}return null}_createBuffers(e,r){const i=e.vertexAttributes&&e.vertexAttributes.position;if(!i)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;const n=e.vertexAttributes.normal,s=e.vertexAttributes.uv,o=e.vertexAttributes.tangent;if(n!=null&&n.length!==i.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(o!=null&&o.length/4!=i.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(s!=null&&s.length/2!=i.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;const a=this._computeReprojectionInfo(e),l=this._createPositionBuffer(e,a),c=this._createColorBuffer(e),u=this._createSymbolColorBuffer(r),h=this._createNormalBuffer(e,l,a),f=this._createTangentBuffer(e,l,a);return{positionBuffer:l,normalBuffer:h,tangentBuffer:f,uvBuffer:s,colorBuffer:c,symbolColorBuffer:u,objectTransformation:a.reprojection===Uu.NONE&&a.objectTransformation!=null?a.objectTransformation:this._transformOriginLocal(e,l,h,f),geometryTransformation:a.reprojection===Uu.NONE&&a.geometryTransformation!=null?a.geometryTransformation:Me()}}_computeReprojectionInfo(e){var s;const{vertexSpace:r}=e,i=r.isRelative,n=r.isGeoreferenced?this._context.renderCoordsHelper.viewingMode===at.Local?Uu.NONE:Uu.ECEF:Uu.NONE;if(i){const{origin:o}=r,a=Me(),l=((s=e.transform)==null?void 0:s.localMatrix)??bo;if(n===Uu.NONE)return lu(e.spatialReference,o,a,this._context.renderCoordsHelper.spatialReference),{reprojection:n,objectTransformation:a,geometryTransformation:IP(l),needsBufferCopy:!1};const c=eF(Me(),o);return Ii(c,c,l),{reprojection:n,transformBeforeProject:c,needsBufferCopy:!0}}return{reprojection:n,needsBufferCopy:!0}}_transformOriginLocal(e,r,i,n){const s=this._context.renderCoordsHelper.spatialReference,o=e.anchor;O6[0]=o.x,O6[1]=o.y,O6[2]=o.z??0;const a=Me();return lu(e.spatialReference,O6,a,s),Uo(NSe,a),t3(r,r,NSe),i==null&&n==null||(uf(u$,a),df(u$,u$),i!=null&&gE(i,i,u$),n!=null&&gE(n,n,u$,4)),a}_validateFaces(e,r){const i=e.vertexAttributes.position.length/3,n=r.faces;if(n){let s=-1;for(let o=0;o<n.length;o++){const a=n[o];a>s&&(s=a)}if(i<=s)return this.logger.warn(`Vertex index ${s} is out of bounds of the mesh position buffer`),!1}else if(i%3!=0)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0}_getOrCreateFaces(e,r){return r.faces??qP(e.vertexAttributes.position.length/3)}_isOutsideClippingArea(e){if(!this._context.clippingExtent)return!1;const r=e.vertexAttributes&&e.vertexAttributes.position;if(!r)return!1;const i=this._context.elevationProvider.spatialReference;let n;const s=r.length/3;return i==null||e.spatialReference.equals(i)?n=r:(n=new Float64Array(r.length),Ni(e.vertexAttributes.position,e.spatialReference,0,n,i,0,s)),en(vZ),ph(vZ,n,0,s),!km(vZ,this._context.clippingExtent)}_createGeometryInfo(e,r,i){if(!lf(e.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(e))return null;const n=this._createBuffers(e,r);if(n==null)return null;const{positionBuffer:s,uvBuffer:o,colorBuffer:a,symbolColorBuffer:l,normalBuffer:c,tangentBuffer:u,objectTransformation:h,geometryTransformation:f}=n,m=this._getOrCreateComponents(e),g=new Array;let y=!1;for(const _ of m){if(!this._validateFaces(e,_))return null;const b=this._getOrCreateFaces(e,_);if(b.length===0)continue;const w=this._createComponentNormals(s,c,_,b);w.didFlipNormals&&(y=!0);const x=[[O.POSITION,new ft(s,3,!0)],[O.NORMAL,new ft(w.normals,3,!0)]],S=[[O.POSITION,b],[O.NORMAL,w.indices]];a!=null&&(x.push([O.COLOR,new ft(a,4,!0)]),S.push([O.COLOR,b])),l!=null&&(x.push([O.SYMBOLCOLOR,new ft(l,4,!0)]),S.push([O.SYMBOLCOLOR,q3(b.length)])),o!=null&&(x.push([O.UV0,new ft(o,2,!0)]),S.push([O.UV0,b])),u!=null&&(x.push([O.TANGENT,new ft(u,4,!0)]),S.push([O.TANGENT,b]));const C=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:i,layerUid:this._context.layer.uid}),E=this._getOrCreateMaterial(e,_),R=new Us(E,x,S,null,Wn.Mesh,C);R.transformation=f,g.push(R)}return y&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals."),{geometries:g,objectTransformation:h}}_updateMaterialParameters(e){this._materialInfoCache.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachMaterialInfo(e),this._fastUpdateProcessor.forEachClonedMaterial((r,i)=>{i.setParameters(r.parameters)})}test(){return{...super.test(),materials:this._materialInfoCache.materials}}},yZ=class{constructor(e,r,i){this.normals=e,this.indices=r,this.didFlipNormals=i}};const O6=A(),ma=A(),zC=A(),VC=A(),BC=A(),NSe=Me(),u$=vn(),R6t=Me(),vZ=To(),O6t=[new s6t],A6t=new NA;var Uu;(function(t){t[t.NONE=0]="NONE",t[t.ECEF=1]="ECEF"})(Uu||(Uu={}));let P6t=class{constructor(e,r,i,n){this.graphics3DSymbolLayer=e,this.instanceIndex=r,this.elevationAligner=i,this.elevationContext=n,this.type="lod-instance",this._highlights=new Set,this.alignedSampledElevation=0,this.isElevationSource=!1,this.needsElevationUpdates=!1}initialize(){}setVisibility(e){const r=this._lodRenderer.instanceData;e!==r.getVisible(this.instanceIndex)&&r.setVisible(this.instanceIndex,e)}destroy(){this.instanceIndex!=null&&(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))}alignWithElevation(e,r,i){if(this.elevationAligner){HH(this.elevationContext.featureExpressionInfoContext,i);const n=(o,a)=>fx(o,e,this.elevationContext,r,a),s=this.elevationAligner(this,this.elevationContext,e.spatialReference,n,r);s!=null&&(this.alignedSampledElevation=s)}}getCenterObjectSpace(e=A()){return this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,kg),lt(e,this._lodRenderer.baseBoundingSphere.center,kg)}getBoundingBoxObjectSpace(e=To()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,kg);const r=this._lodRenderer.baseBoundingBox;en(e);for(let i=0;i<8;++i)se(Gh,1&i?r[3]:r[0],2&i?r[4]:r[1],4&i?r[5]:r[2]),lt(Gh,Gh,kg),c0(e,Gh);return e}computeAttachmentOrigin(e){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,kg),e.render.origin[0]+=kg[12],e.render.origin[1]+=kg[13],e.render.origin[2]+=kg[14],e.render.num++}async getProjectedBoundingBox(e,r,i,n,s){const o=this.getBoundingBoxObjectSpace(s),a=M6t,l=jue(o)?1:a.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,kg);for(let u=0;u<l;u++){const h=a[u];Gh[0]=o[h[0]],Gh[1]=o[h[1]],Gh[2]=o[h[2]],lt(Gh,Gh,kg),lS[3*u]=Gh[0],lS[3*u+1]=Gh[1],lS[3*u+2]=Gh[2]}if(!e(lS,0,l))return null;en(o);let c=null;this.calculateRelativeScreenBounds&&(c=this.calculateRelativeScreenBounds());for(let u=0;u<3*l;u+=3){for(let h=0;h<3;h++)o[h]=Math.min(o[h],lS[u+h]),o[h+3]=Math.max(o[h+3],lS[u+h]);c&&i.push({location:lS.slice(u,u+3),screenSpaceBoundingRect:c})}if(r&&(Fm(o,_Z),this.elevationContext.mode!=="absolute-height")){let u;const h=Hhe(o,r.service.spatialReference,r);try{u=await r.service.queryElevation(_Z[0],_Z[1],n,h,"ground")}catch{}u!=null&&V4e(o,0,0,-this.alignedSampledElevation+u)}return o}addObjectState(e,r){if(e===k_.Highlight){const i=new IB(e);this._addHighlightId(i),r.addExternal(n=>{this._removeHighlightId(n)},i)}}removeObjectState(e){this._highlights.forEach(r=>e.remove(r))}_addHighlightId(e){this._highlights.add(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)}_removeHighlightId(e){this._highlights.delete(e),this._lodRenderer.instanceData.setHighlight(this.instanceIndex,this._highlights.size>0)}get _lodRenderer(){return this.graphics3DSymbolLayer.lodRenderer}};const lS=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Gh=A(),_Z=A(),M6t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],kg=Me();function $6t(t){const e=new Array;return t.stageResources.geometries.forEach(r=>{const i=t.stageResources.textures;e.push(new qze(r,i))}),{components:e,minScreenSpaceRadius:t.lodThreshold??0,pivotOffset:t.pivotOffset}}function I6t(t){return{levels:t.map(e=>$6t(e))}}function L6t(t){return t=t||globalThis.location.hostname,D6t.some(e=>(t==null?void 0:t.match(e))!=null)}function Tne(t,e){return t&&(e=e||globalThis.location.hostname)?e.match($Be)!=null||e.match(LBe)!=null?t.replace("static.arcgis.com","staticdev.arcgis.com"):e.match(IBe)!=null||e.match(DBe)!=null?t.replace("static.arcgis.com","staticqa.arcgis.com"):t:t}const $Be=/^devext.arcgis.com$/,IBe=/^qaext.arcgis.com$/,LBe=/^[\w-]*\.mapsdevext.arcgis.com$/,DBe=/^[\w-]*\.mapsqa.arcgis.com$/,D6t=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,$Be,IBe,/^jsapps.esri.com$/,LBe,DBe];function N6t(t,e,r){if(t.count!==e.count)return void WH.error("source and destination buffers need to have the same number of elements");const i=t.count,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],h=r[7],f=r[8],m=r[9],g=r[10],y=r[11],_=r[12],b=r[13],w=r[14],x=r[15],S=t.typedBuffer,C=t.typedBufferStride,E=e.typedBuffer,R=e.typedBufferStride;for(let P=0;P<i;P++){const D=P*C,L=P*R,k=E[L],V=E[L+1],W=E[L+2],G=E[L+3];S[D]=n*k+l*V+f*W+_*G,S[D+1]=s*k+c*V+m*W+b*G,S[D+2]=o*k+u*V+g*W+w*G,S[D+3]=a*k+h*V+y*W+x*G}}function F6t(t,e,r){Mpe(t.typedBuffer,e.typedBuffer,r,t.typedBufferStride,e.typedBufferStride)}function Mpe(t,e,r,i=4,n=i){if(t.length/i!=e.length/n)return void WH.error("source and destination buffers need to have the same number of elements");const s=t.length/i,o=r[0],a=r[1],l=r[2],c=r[3],u=r[4],h=r[5],f=r[6],m=r[7],g=r[8];let y=0,_=0;for(let b=0;b<s;b++){const w=e[y],x=e[y+1],S=e[y+2],C=e[y+3];t[_]=o*w+c*x+f*S,t[_+1]=a*w+u*x+m*S,t[_+2]=l*w+h*x+g*S,t[_+3]=C,y+=n,_+=i}}function k6t(t,e){const r=Math.min(t.count,e.count),i=t.typedBuffer,n=t.typedBufferStride,s=e.typedBuffer,o=e.typedBufferStride;for(let a=0;a<r;a++){const l=a*n,c=a*o,u=s[c],h=s[c+1],f=s[c+2],m=u*u+h*h+f*f;if(m>0){const g=1/Math.sqrt(m);i[l]=g*u,i[l+1]=g*h,i[l+2]=g*f}}}function U6t(t,e,r){aj(t.typedBuffer,e,r,t.typedBufferStride)}function aj(t,e,r,i=4){const n=Math.min(t.length/i,e.count),s=e.typedBuffer,o=e.typedBufferStride;let a=0,l=0;for(let c=0;c<n;c++)t[l]=r*s[a],t[l+1]=r*s[a+1],t[l+2]=r*s[a+2],t[l+3]=r*s[a+3],a+=o,l+=i}Object.freeze(Object.defineProperty({__proto__:null,normalize:k6t,scale:aj,scaleView:U6t,transformMat3:Mpe,transformMat3View:F6t,transformMat4:N6t},Symbol.toStringTag,{value:"Module"}));function z6t(t,e){$pe(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function $pe(t,e,r=2,i=r){const n=e.length/2;let s=0,o=0;if(ig(e)||Zct(e)){for(let l=0;l<n;++l)t[s]=e[o],t[s+1]=e[o+1],s+=r,o+=i;return}const a=Jct(e);if(Yct(e))for(let l=0;l<n;++l)t[s]=Math.max(e[o]/a,-1),t[s+1]=Math.max(e[o+1]/a,-1),s+=r,o+=i;else for(let l=0;l<n;++l)t[s]=e[o]/a,t[s+1]=e[o+1]/a,s+=r,o+=i}function V6t(t,e,r,i){const n=t.typedBuffer,s=t.typedBufferStride,o=(i==null?void 0:i.count)??t.count;let a=((i==null?void 0:i.dstIndex)??0)*s;for(let l=0;l<o;++l)n[a]=e,n[a+1]=r,a+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:V6t,normalizeIntegerBuffer:$pe,normalizeIntegerBufferView:z6t},Symbol.toStringTag,{value:"Module"}));function B6t(t,e){jF(t.typedBuffer,e.typedBuffer,t.typedBufferStride,e.typedBufferStride)}function jF(t,e,r=3,i=r){const n=e.length/i;let s=0,o=0;for(let a=0;a<n;++a)t[s]=e[o],t[s+1]=e[o+1],t[s+2]=e[o+2],s+=r,o+=i}function j6t(t,e,r,i,n){const s=t.typedBuffer,o=t.typedBufferStride,a=(n==null?void 0:n.count)??t.count;let l=((n==null?void 0:n.dstIndex)??0)*o;for(let c=0;c<a;++c)s[l]=e,s[l+1]=r,s[l+2]=i,l+=o}Object.freeze(Object.defineProperty({__proto__:null,copy:jF,copyView:B6t,fill:j6t},Symbol.toStringTag,{value:"Module"}));function G6t(t,e){Ipe(t.typedBuffer,e,t.typedBufferStride)}function Ipe(t,e,r=4){const i=e.typedBuffer,n=e.typedBufferStride,s=e.count;let o=0,a=0;for(let l=0;l<s;++l)t[o]=i[a],t[o+1]=i[a+1],t[o+2]=i[a+2],t[o+3]=i[a+3],o+=r,a+=n}function H6t(t,e,r,i,n,s){const o=t.typedBuffer,a=t.typedBufferStride,l=(s==null?void 0:s.count)??t.count;let c=((s==null?void 0:s.dstIndex)??0)*a;for(let u=0;u<l;++u)o[c]=e,o[c+1]=r,o[c+2]=i,o[c+3]=n,c+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:Ipe,copyView:G6t,fill:H6t},Symbol.toStringTag,{value:"Module"}));let NBe=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,r){return this._load("json",e,r)}async loadBinary(e,r){return b0(e)?(vr(r),Kle(e)):this._load("binary",e,r)}async loadImage(e,r){return this._load("image",e,r)}async _load(e,r,i){if(this._streamDataRequester==null)return(await ti(r,{responseType:q6t[e]})).data;const n=await wd(this._streamDataRequester.request(r,e,i));if(n.ok===!0)return n.value;throw Oa(n.error),new H("",`Request for resource failed: ${n.error}`)}};const q6t={image:"image",binary:"array-buffer",json:"json","image+type":void 0};function W6t(t={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...t}}function X6t(t,e={}){return{data:t,parameters:{wrap:{s:ir.REPEAT,t:ir.REPEAT,...e.wrap},noUnpackFlip:!0,mipmap:!1,...e}}}function kz(t,e){const r=t.count;e||(e=new t.TypedArrayConstructor(r));for(let i=0;i<r;i++)e[i]=t.get(i);return e}Object.freeze(Object.defineProperty({__proto__:null,makeDense:kz},Symbol.toStringTag,{value:"Module"}));let FSe=class{constructor(e){this._data=e,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const e=this._offset4;return this._offset4+=1,this._dataUint32[e]}readUint8Array(e){const r=4*this._offset4;return this._offset4+=e/4,new Uint8Array(this._data,r,e)}remainingBytes(){return this._data.byteLength-4*this._offset4}};var $D,kSe;(function(t){t.SCALAR="SCALAR",t.VEC2="VEC2",t.VEC3="VEC3",t.VEC4="VEC4",t.MAT2="MAT2",t.MAT3="MAT3",t.MAT4="MAT4"})($D||($D={})),function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(kSe||(kSe={}));const FBe={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},Y6t={pbrMetallicRoughness:FBe,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},Z6t={ESRI_externalColorMixMode:"tint"},USe=(t={})=>{const e={...FBe,...t.pbrMetallicRoughness},r=J6t({...Z6t,...t.extras});return{...Y6t,...t,pbrMetallicRoughness:e,extras:r}};function J6t(t){switch(t.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:t.ESRI_externalColorMixMode,t.ESRI_externalColorMixMode="tint"}return t}const K6t={magFilter:Kt.LINEAR,minFilter:Kt.LINEAR_MIPMAP_LINEAR,wrapS:ir.REPEAT,wrapT:ir.REPEAT},Q6t=t=>({...K6t,...t});function eUt(t){let e,r;return t.replace(/^(.*\/)?([^/]*)$/,(i,n,s)=>(e=n||"",r=s||"","")),{dirPart:e,filePart:r}}const A6={MAGIC:1179937895,CHUNK_TYPE_JSON:1313821514,CHUNK_TYPE_BIN:5130562,MIN_HEADER_LENGTH:20};let tUt=class wb{constructor(e,r,i,n){if(this._context=e,this.uri=r,this.json=i,this._glbBuffer=n,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=eUt(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),i.scenes==null)throw new H("gltf-loader-unsupported-feature","Scenes must be defined.");if(i.meshes==null)throw new H("gltf-loader-unsupported-feature","Meshes must be defined");if(i.nodes==null)throw new H("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static async load(e,r,i){if(b0(r)){const o=q2(r);if(o&&o.mediaType!=="model/gltf-binary")try{const l=JSON.parse(o.isBase64?atob(o.data):o.data);return new wb(e,r,l)}catch{}const a=Kle(r);if(wb._isGLBData(a))return this._fromGLBData(e,r,a)}if(r.endsWith(".gltf")){const o=await e.loadJSON(r,i);return new wb(e,r,o)}const n=await e.loadBinary(r,i);if(wb._isGLBData(n))return this._fromGLBData(e,r,n);const s=await e.loadJSON(r,i);return new wb(e,r,s)}static _isGLBData(e){if(e==null)return!1;const r=new FSe(e);return r.remainingBytes()>=4&&r.readUint32()===A6.MAGIC}static async _fromGLBData(e,r,i){const n=await wb._parseGLBData(i);return new wb(e,r,n.json,n.binaryData)}static async _parseGLBData(e){const r=new FSe(e);if(r.remainingBytes()<12)throw new H("gltf-loader-error","GLB binary data is insufficiently large.");const i=r.readUint32(),n=r.readUint32(),s=r.readUint32();if(i!==A6.MAGIC)throw new H("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(e.byteLength<s)throw new H("gltf-loader-error","GLB binary data is smaller than header specifies.");if(n!==2)throw new H("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let o,a,l=0;for(;r.remainingBytes()>=8;){const c=r.readUint32(),u=r.readUint32();if(l===0){if(u!==A6.CHUNK_TYPE_JSON)throw new H("gltf-loader-error","First GLB chunk must be JSON.");if(c<0)throw new H("gltf-loader-error","No JSON data found.");o=await d6t(r.readUint8Array(c))}else if(l===1){if(u!==A6.CHUNK_TYPE_BIN)throw new H("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");a=r.readUint8Array(c)}else re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");l+=1}if(!o)throw new H("gltf-loader-error","No GLB JSON chunk detected.");return{json:o,binaryData:a}}async getBuffer(e,r){const i=this.json.buffers[e];if(i.uri==null){if(this._glbBuffer==null)throw new H("gltf-loader-error","GLB buffer not present");return this._glbBuffer}const n=await this._getBufferLoader(e,r);if(n.byteLength!==i.byteLength)throw new H("gltf-loader-error","Buffer byte lengths should match.");return n}async _getBufferLoader(e,r){const i=this._bufferLoaders.get(e);if(i)return i;const n=this.json.buffers[e].uri,s=this._context.loadBinary(this._resolveUri(n),r).then(o=>new Uint8Array(o));return this._bufferLoaders.set(e,s),s}async getAccessor(e,r){if(!this.json.accessors)throw new H("gltf-loader-unsupported-feature","Accessors missing.");const i=this.json.accessors[e];if((i==null?void 0:i.bufferView)==null)throw new H("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(i.type in[$D.MAT2,$D.MAT3,$D.MAT4])throw new H("gltf-loader-unsupported-feature",`AttributeType ${i.type} is not supported`);const n=this.json.bufferViews[i.bufferView],s=await this.getBuffer(n.buffer,r),o=nUt[i.type],a=sUt[i.componentType],l=o*a,c=n.byteStride||l;return{raw:s.buffer,byteStride:c,byteOffset:s.byteOffset+(n.byteOffset||0)+(i.byteOffset||0),entryCount:i.count,isDenselyPacked:c===l,componentCount:o,componentByteSize:a,componentType:i.componentType,min:i.min,max:i.max,normalized:!!i.normalized}}async getIndexData(e,r){if(e.indices==null)return;const i=await this.getAccessor(e.indices,r);if(i.isDenselyPacked)switch(i.componentType){case $t.UNSIGNED_BYTE:return new Uint8Array(i.raw,i.byteOffset,i.entryCount);case $t.UNSIGNED_SHORT:return new Uint16Array(i.raw,i.byteOffset,i.entryCount);case $t.UNSIGNED_INT:return new Uint32Array(i.raw,i.byteOffset,i.entryCount)}else switch(i.componentType){case $t.UNSIGNED_BYTE:return kz(this._wrapAccessor(HP,i));case $t.UNSIGNED_SHORT:return kz(this._wrapAccessor(CH,i));case $t.UNSIGNED_INT:return kz(this._wrapAccessor(OH,i))}}async getPositionData(e,r){if(e.attributes.POSITION==null)throw new H("gltf-loader-unsupported-feature","No POSITION vertex data found.");const i=await this.getAccessor(e.attributes.POSITION,r);if(i.componentType!==$t.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+$t[i.componentType]);if(i.componentCount!==3)throw new H("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(xo,i)}async getNormalData(e,r){if(e.attributes.NORMAL==null)throw new H("gltf-loader-error","No NORMAL vertex data found.");const i=await this.getAccessor(e.attributes.NORMAL,r);if(i.componentType!==$t.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+$t[i.componentType]);if(i.componentCount!==3)throw new H("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+i.componentCount.toFixed());return this._wrapAccessor(xo,i)}async getTangentData(e,r){if(e.attributes.TANGENT==null)throw new H("gltf-loader-error","No TANGENT vertex data found.");const i=await this.getAccessor(e.attributes.TANGENT,r);if(i.componentType!==$t.FLOAT)throw new H("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+$t[i.componentType]);if(i.componentCount!==4)throw new H("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+i.componentCount.toFixed());return new dg(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}async getTextureCoordinates(e,r){if(e.attributes.TEXCOORD_0==null)throw new H("gltf-loader-error","No TEXCOORD_0 vertex data found.");const i=await this.getAccessor(e.attributes.TEXCOORD_0,r);if(i.componentCount!==2)throw new H("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+i.componentCount.toFixed());if(i.componentType===$t.FLOAT)return this._wrapAccessor(Ox,i);if(!i.normalized)throw new H("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return oUt(i)}async getVertexColors(e,r){if(e.attributes.COLOR_0==null)throw new H("gltf-loader-error","No COLOR_0 vertex data found.");const i=await this.getAccessor(e.attributes.COLOR_0,r);if(i.componentCount!==4&&i.componentCount!==3)throw new H("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+i.componentCount.toFixed());if(i.componentCount===4){if(i.componentType===$t.FLOAT)return this._wrapAccessor(dg,i);if(i.componentType===$t.UNSIGNED_BYTE)return this._wrapAccessor(zl,i);if(i.componentType===$t.UNSIGNED_SHORT)return this._wrapAccessor(SF,i)}else if(i.componentCount===3){if(i.componentType===$t.FLOAT)return this._wrapAccessor(xo,i);if(i.componentType===$t.UNSIGNED_BYTE)return this._wrapAccessor(EH,i);if(i.componentType===$t.UNSIGNED_SHORT)return this._wrapAccessor(RH,i)}throw new H("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+$t[i.componentType])}hasPositions(e){return e.attributes.POSITION!==void 0}hasNormals(e){return e.attributes.NORMAL!==void 0}hasVertexColors(e){return e.attributes.COLOR_0!==void 0}hasTextureCoordinates(e){return e.attributes.TEXCOORD_0!==void 0}hasTangents(e){return e.attributes.TANGENT!==void 0}async getMaterial(e,r,i){var s,o,a,l,c,u,h,f,m,g;let n=e.material?this._materialCache.get(e.material):void 0;if(!n){const y=e.material!=null?USe(this.json.materials[e.material]):USe(),_=y.pbrMetallicRoughness,b=this.hasVertexColors(e),w=this.getTexture(_.baseColorTexture,r),x=this.getTexture(y.normalTexture,r),S=i?this.getTexture(y.occlusionTexture,r):void 0,C=i?this.getTexture(y.emissiveTexture,r):void 0,E=i?this.getTexture(_.metallicRoughnessTexture,r):void 0,R=e.material!=null?e.material:-1;n={alphaMode:y.alphaMode,alphaCutoff:y.alphaCutoff,color:_.baseColorFactor,doubleSided:!!y.doubleSided,colorTexture:await w,normalTexture:await x,name:y.name,id:R,occlusionTexture:await S,emissiveTexture:await C,emissiveFactor:y.emissiveFactor,metallicFactor:_.metallicFactor,roughnessFactor:_.roughnessFactor,metallicRoughnessTexture:await E,hasVertexColors:b,ESRI_externalColorMixMode:y.extras.ESRI_externalColorMixMode,colorTextureTransform:(o=(s=_==null?void 0:_.baseColorTexture)==null?void 0:s.extensions)==null?void 0:o.KHR_texture_transform,normalTextureTransform:(l=(a=y.normalTexture)==null?void 0:a.extensions)==null?void 0:l.KHR_texture_transform,occlusionTextureTransform:(u=(c=y.occlusionTexture)==null?void 0:c.extensions)==null?void 0:u.KHR_texture_transform,emissiveTextureTransform:(f=(h=y.emissiveTexture)==null?void 0:h.extensions)==null?void 0:f.KHR_texture_transform,metallicRoughnessTextureTransform:(g=(m=_==null?void 0:_.metallicRoughnessTexture)==null?void 0:m.extensions)==null?void 0:g.KHR_texture_transform}}return n}async getTexture(e,r){if(!e)return;if((e.texCoord||0)!==0)throw new H("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const i=e.index,n=this.json.textures[i],s=Q6t(n.sampler!=null?this.json.samplers[n.sampler]:{}),o=this._getTextureSourceId(n),a=this.json.images[o],l=await this._loadTextureImageData(i,n,r);return Z$e(this._textureCache,i,()=>{const c=h=>h===33071||h===33648||h===10497,u=h=>{throw new H("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${h}`)};return{data:l,wrapS:c(s.wrapS)?s.wrapS:u(s.wrapS),wrapT:c(s.wrapT)?s.wrapT:u(s.wrapT),minFilter:s.minFilter,name:a.name,id:i}})}getNodeTransform(e){if(e===void 0)return rUt;let r=this._nodeTransformCache.get(e);if(!r){const i=this.getNodeTransform(this._getNodeParent(e)),n=this.json.nodes[e];n.matrix?r=Ii(Me(),i,n.matrix):n.translation||n.rotation||n.scale?(r=IP(i),n.translation&&hu(r,r,n.translation),n.rotation&&(P6[3]=fde(P6,n.rotation),sd(r,r,P6[3],P6)),n.scale&&A7(r,r,n.scale)):r=IP(i),this._nodeTransformCache.set(e,r)}return r}_wrapAccessor(e,r){return new e(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(e){return ah(e,this._baseUri)}_getNodeParent(e){return this._nodeParentMap.get(e)}_checkVersionSupported(){const e=nx.parse(this.json.asset.version,"glTF");iUt.validate(e)}_checkRequiredExtensionsSupported(){const e=this.json;if(e.extensionsRequired&&!e.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new H("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+e.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((e,r)=>{e.children&&e.children.forEach(i=>{this._nodeParentMap.set(i,r)})})}async _loadTextureImageData(e,r,i){const n=this._textureLoaders.get(e);if(n)return n;const s=this._createTextureLoader(r,i);return this._textureLoaders.set(e,s),s}_getTextureSourceId(e){if(e.extensions!==void 0&&e.extensions.KHR_texture_basisu!==null)return e.extensions.KHR_texture_basisu.source;if(e.source!==null)return e.source;throw new H("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}async _createTextureLoader(e,r){const i=this._getTextureSourceId(e),n=this.json.images[i];if(n.uri){if(n.uri.endsWith(".ktx2")){const l=await this._context.loadBinary(this._resolveUri(n.uri),r);return new ABe(new Uint8Array(l))}return this._context.loadImage(this._resolveUri(n.uri),r)}if(n.bufferView==null)throw new H("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(n.mimeType==null)throw new H("gltf-loader-unsupported-feature","Image mimeType must be defined.");const s=this.json.bufferViews[n.bufferView],o=await this.getBuffer(s.buffer,r);if(s.byteStride!=null)throw new H("gltf-loader-unsupported-feature","byteStride not supported for image buffer");const a=o.byteOffset+(s.byteOffset||0);return h6t(new Uint8Array(o.buffer,a,s.byteLength),n.mimeType)}async getLoadedBuffersSize(){if(this._glbBuffer)return this._glbBuffer.byteLength;const e=await gV(Array.from(this._bufferLoaders.values())),r=await gV(Array.from(this._textureLoaders.values()));return e.reduce((i,n)=>i+((n==null?void 0:n.byteLength)??0),0)+r.reduce((i,n)=>i+(n?$2(n)?n.data.byteLength:n.width*n.height*4:0),0)}};const rUt=QLe(Me(),Math.PI/2),iUt=new nx(2,0,"glTF"),P6=bf(),nUt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},sUt={[$t.BYTE]:1,[$t.UNSIGNED_BYTE]:1,[$t.SHORT]:2,[$t.UNSIGNED_SHORT]:2,[$t.FLOAT]:4,[$t.INT]:4,[$t.UNSIGNED_INT]:4};function oUt(t){switch(t.componentType){case $t.BYTE:return new AH(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case $t.UNSIGNED_BYTE:return new TH(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case $t.SHORT:return new TF(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case $t.UNSIGNED_SHORT:return new nhe(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case $t.UNSIGNED_INT:return new she(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case $t.FLOAT:return new Ox(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount)}}let aUt=0;async function kBe(t,e,r={},i=!0){const n=await tUt.load(t,e,r),s="gltf_"+aUt++,o={lods:[],materials:new Map,textures:new Map,meta:lUt(n)},a=!(!n.json.asset.extras||n.json.asset.extras.ESRI_type!=="symbolResource"),l=new Map;await cUt(n,async(u,h,f,m)=>{const g=l.get(f)??0;l.set(f,g+1);const y=u.mode!==void 0?u.mode:Zt.TRIANGLES,_=y===Zt.TRIANGLES||y===Zt.TRIANGLE_STRIP||y===Zt.TRIANGLE_FAN?y:null;if(_==null)return void re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+Zt[y]+"). Skipping primitive.");if(!n.hasPositions(u))return void re.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const b=n.getPositionData(u,r),w=n.getMaterial(u,r,i),x=n.hasNormals(u)?n.getNormalData(u,r):null,S=n.hasTangents(u)?n.getTangentData(u,r):null,C=n.hasTextureCoordinates(u)?n.getTextureCoordinates(u,r):null,E=n.hasVertexColors(u)?n.getVertexColors(u,r):null,R=n.getIndexData(u,r),P={transform:IP(h),attributes:{position:await b,normal:x?await x:null,texCoord0:C?await C:null,color:E?await E:null,tangent:S?await S:null},indices:await R,primitiveType:_,material:dUt(o,await w,s)};let D=null;o.meta!=null&&o.meta.ESRI_lod!=null&&o.meta.ESRI_lod.metric==="screenSpaceRadius"&&(D=o.meta.ESRI_lod.thresholds[f]),o.lods[f]=o.lods[f]||{parts:[],name:m,lodThreshold:D},o.lods[f].parts[g]=P});for(const u of o.lods)u.parts=u.parts.filter(h=>!!h);const c=await n.getLoadedBuffersSize();return{model:o,meta:{isEsriSymbolResource:a,uri:n.uri},customMeta:{},size:c}}function lUt(t){const e=t.json;let r=null;return e.nodes.forEach(i=>{const n=i.extras;n!=null&&(n.ESRI_proxyEllipsoid||n.ESRI_lod)&&(r=n)}),r}async function cUt(t,e){const r=t.json,i=r.scenes[r.scene||0].nodes,n=i.length>1,s=[];for(const a of i){const l=r.nodes[a];s.push(o(a,0)),uUt(l)&&!n&&l.extensions.MSFT_lod.ids.forEach((c,u)=>o(c,u+1))}async function o(a,l){const c=r.nodes[a],u=t.getNodeTransform(a);if(c.weights!=null&&re.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),c.mesh!=null){const h=r.meshes[c.mesh];for(const f of h.primitives)s.push(e(f,u,l,h.name))}for(const h of c.children||[])s.push(o(h,l))}await Promise.all(s)}function uUt(t){return t.extensions&&t.extensions.MSFT_lod&&Array.isArray(t.extensions.MSFT_lod.ids)}function dUt(t,e,r){const i=s=>{const o=`${r}_tex_${s&&s.id}${s&&s.name?"_"+s.name:""}`;if(s&&!t.textures.has(o)){const a=X6t(s.data,{wrap:{s:s.wrapS,t:s.wrapT},mipmap:hUt.includes(s.minFilter),noUnpackFlip:!0});t.textures.set(o,a)}return o},n=`${r}_mat_${e.id}_${e.name}`;if(!t.materials.has(n)){const s=W6t({color:[e.color[0],e.color[1],e.color[2]],opacity:e.color[3],alphaMode:e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,colorMixMode:e.ESRI_externalColorMixMode,textureColor:e.colorTexture?i(e.colorTexture):void 0,textureNormal:e.normalTexture?i(e.normalTexture):void 0,textureOcclusion:e.occlusionTexture?i(e.occlusionTexture):void 0,textureEmissive:e.emissiveTexture?i(e.emissiveTexture):void 0,textureMetallicRoughness:e.metallicRoughnessTexture?i(e.metallicRoughnessTexture):void 0,emissiveFactor:[e.emissiveFactor[0],e.emissiveFactor[1],e.emissiveFactor[2]],colorTextureTransform:e.colorTextureTransform,normalTextureTransform:e.normalTextureTransform,occlusionTextureTransform:e.occlusionTextureTransform,emissiveTextureTransform:e.emissiveTextureTransform,metallicRoughnessTextureTransform:e.metallicRoughnessTextureTransform,metallicFactor:e.metallicFactor,roughnessFactor:e.roughnessFactor});t.materials.set(n,s)}return n}const hUt=[Kt.LINEAR_MIPMAP_LINEAR,Kt.LINEAR_MIPMAP_NEAREST];function pUt(t,e){switch(e){case Zt.TRIANGLES:return fUt(t);case Zt.TRIANGLE_STRIP:return mUt(t);case Zt.TRIANGLE_FAN:return gUt(t)}}function fUt(t){return typeof t=="number"?qP(t):cw(t)?new Uint16Array(t):t}function mUt(t){const e=typeof t=="number"?t:t.length;if(e<3)return[];const r=e-2,i=$B(3*r);if(typeof t=="number"){let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=s,i[n++]=s+1,i[n++]=s+2):(i[n++]=s+1,i[n++]=s,i[n++]=s+2)}else{let n=0;for(let s=0;s<r;s+=1)s%2==0?(i[n++]=t[s],i[n++]=t[s+1],i[n++]=t[s+2]):(i[n++]=t[s+1],i[n++]=t[s],i[n++]=t[s+2])}return i}function gUt(t){const e=typeof t=="number"?t:t.length;if(e<3)return new Uint16Array(0);const r=e-2,i=r<=65536?new Uint16Array(3*r):new Uint32Array(3*r);if(typeof t=="number"){let a=0;for(let l=0;l<r;++l)i[a++]=0,i[a++]=l+1,i[a++]=l+2;return i}const n=t[0];let s=t[1],o=0;for(let a=0;a<r;++a){const l=t[a+2];i[o++]=n,i[o++]=s,i[o++]=l,s=l}return i}let yUt=class{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}},vUt=class{constructor(e,r,i){this.name=e,this.lodThreshold=r,this.pivotOffset=i,this.stageResources=new yUt,this.numberOfVertices=0}};const hv=re.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");async function UBe(t,e){const r=await _Ut(t,e),i=await TUt(r.textureDefinitions??{},e);let n=0;for(const s in i)if(i.hasOwnProperty(s)){const o=i[s];n+=o!=null&&o.image?o.image.width*o.image.height*4:0}return{resource:r,textures:i,size:n+dze(r)}}async function _Ut(t,e){const r=e!=null&&e.streamDataRequester;if(r)return bUt(t,r,e);const i=await wd(ti(t,e));if(i.ok===!0)return i.value.data;Oa(i.error),zBe(i.error)}async function bUt(t,e,r){const i=await wd(e.request(t,"json",r));if(i.ok===!0)return i.value;Oa(i.error),zBe(i.error.details.url)}function zBe(t){throw new H("",`Request for object resource failed: ${t}`)}function wUt(t){const e=t.params,r=e.topology;let i=!0;switch(e.vertexAttributes||(hv.warn("Geometry must specify vertex attributes"),i=!1),e.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=e.faces;if(s){if(e.vertexAttributes)for(const o in e.vertexAttributes){const a=s[o];a&&a.values?(a.valueType!=null&&a.valueType!=="UInt32"&&(hv.warn(`Unsupported indexed geometry indices type '${a.valueType}', only UInt32 is currently supported`),i=!1),a.valuesPerElement!=null&&a.valuesPerElement!==1&&(hv.warn(`Unsupported indexed geometry values per element '${a.valuesPerElement}', only 1 is currently supported`),i=!1)):(hv.warn(`Indexed geometry does not specify face indices for '${o}' attribute`),i=!1)}}else hv.warn("Indexed geometries must specify faces"),i=!1;break}default:hv.warn(`Unsupported topology '${r}'`),i=!1}t.params.material||(hv.warn("Geometry requires material"),i=!1);const n=t.params.vertexAttributes;for(const s in n)n[s].values||(hv.warn("Geometries with externally defined attributes are not yet supported"),i=!1);return i}function xUt(t,e){var g;const r=new Array,i=new Array,n=new Array,s=new W3,o=t.resource,a=nx.parse(o.version||"1.0","wosr");CUt.validate(a);const l=o.model.name,c=o.model.geometries,u=o.materialDefinitions??{},h=t.textures;let f=0;const m=new Map;for(let y=0;y<c.length;y++){const _=c[y];if(!wUt(_))continue;const b=EUt(_),w=_.params.vertexAttributes,x=[];for(const V in w){const W=w[V],G=W.values;x.push([V,new ft(G,W.valuesPerElement,!0)])}const S=[];if(_.params.topology!=="PerAttributeArray"){const V=_.params.faces;for(const W in V)S.push([W,V[W].values])}const C=b.texture,E=h&&h[C];if(E&&!m.has(C)){const{image:V,parameters:W}=E,G=new qE(V,W);i.push(G),m.set(C,G)}const R=m.get(C),P=R?R.id:void 0,D=b.material;let L=s.get(D,C);if(L==null){const V=u[D.substring(D.lastIndexOf("/")+1)].params;V.transparency===1&&(V.transparency=0);const W=E&&E.alphaChannelUsage,G=V.transparency>0||W==="transparency"||W==="maskAndTransparency",B=E?VBe(E.alphaChannelUsage):void 0,Z={ambient:mc(V.diffuse),diffuse:mc(V.diffuse),opacity:1-(V.transparency||0),transparent:G,textureAlphaMode:B,textureAlphaCutoff:.33,textureId:P,initTextureTransparent:!0,doubleSided:!0,cullFace:Hi.None,colorMixMode:V.externalColorMixMode||"tint",textureAlphaPremultiplied:(E==null?void 0:E.parameters.preMultiplyAlpha)??!1};e!=null&&e.materialParamsMixin&&Object.assign(Z,e.materialParamsMixin),L=new g0(Z),s.set(D,C,L)}n.push(L);const k=new Us(L,x,S);f+=((g=S.find(V=>V[0]===O.POSITION))==null?void 0:g[1].length)??0,r.push(k)}return{engineResources:[{name:l,stageResources:{textures:i,materials:n,geometries:r},pivotOffset:o.model.pivotOffset,numberOfVertices:f,lodThreshold:null}],referenceBoundingBox:SUt(r)}}function SUt(t){const e=en();return t.forEach(r=>{const i=r.boundingInfo;i!=null&&(c0(e,i.bbMin),c0(e,i.bbMax))}),e}async function TUt(t,e){const r=new Array;for(const s in t){const o=t[s],a=o.images[0].data;if(!a){hv.warn("Externally referenced texture data is not yet supported");continue}const l=o.encoding+";base64,"+a,c="/textureDefinitions/"+s,u=o.channels==="rgba"?o.alphaChannelUsage||"transparency":"none",h={noUnpackFlip:!0,wrap:{s:ir.REPEAT,t:ir.REPEAT},preMultiplyAlpha:VBe(u)!==Si.Opaque},f=e!=null&&e.disableTextures?Promise.resolve(null):z_(l,e);r.push(f.then(m=>({refId:c,image:m,parameters:h,alphaChannelUsage:u})))}const i=await Promise.all(r),n={};for(const s of i)n[s.refId]=s;return n}function VBe(t){switch(t){case"mask":return Si.Mask;case"maskAndTransparency":return Si.MaskBlend;case"none":return Si.Opaque;default:return Si.Blend}}function EUt(t){const e=t.params;return{id:1,material:e.material,texture:e.texture,region:e.texture}}const CUt=new nx(1,2,"wosr"),jC=2.1;async function BBe(t,e){var h;const r=jBe(Tne(t));if(r.fileType==="wosr"){const f=await(e.cache?e.cache.loadWOSR(r.url,e):UBe(r.url,e)),{engineResources:m,referenceBoundingBox:g}=xUt(f,e);return{lods:m,referenceBoundingBox:g,isEsriSymbolResource:!1,isWosr:!0}}const i=await(e.cache?e.cache.loadGLTF(r.url,e,!!e.usePBR):kBe(new NBe(e.streamDataRequester),r.url,e,e.usePBR)),n=(h=i.model.meta)==null?void 0:h.ESRI_proxyEllipsoid,s=i.meta.isEsriSymbolResource&&n!=null&&i.meta.uri.includes("/RealisticTrees/");s&&!i.customMeta.esriTreeRendering&&(i.customMeta.esriTreeRendering=!0,PUt(i,n));const o=!!e.usePBR,a=i.meta.isEsriSymbolResource?{usePBR:o,isSchematic:!1,treeRendering:s,mrrFactors:[...yFt]}:{usePBR:o,isSchematic:!1,treeRendering:!1,mrrFactors:[...tq]},l={...e.materialParamsMixin,treeRendering:s},{engineResources:c,referenceBoundingBox:u}=GBe(i,a,l,e.skipHighLods&&r.specifiedLodIndex==null?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:r.specifiedLodIndex});return{lods:c,referenceBoundingBox:u,isEsriSymbolResource:i.meta.isEsriSymbolResource,isWosr:!1}}function jBe(t){const e=t.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return e?{fileType:"gltf",url:e[1],specifiedLodIndex:e[4]!=null?Number(e[4]):null}:t.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:t,specifiedLodIndex:null}:{fileType:"unknown",url:t,specifiedLodIndex:null}}function GBe(t,e,r,i){const n=t.model,s=new Array,o=new Map,a=new Map,l=n.lods.length,c=en();return n.lods.forEach((u,h)=>{const f=i.skipHighLods===!0&&(l>1&&h===0||l>3&&h===1)||i.skipHighLods===!1&&i.singleLodIndex!=null&&h!==i.singleLodIndex;if(f&&h!==0)return;const m=new vUt(u.name,u.lodThreshold,[0,0,0]);u.parts.forEach(g=>{const y=f?new g0({}):RUt(n,g,m,e,r,o,a),{geometry:_,vertexCount:b}=OUt(g,y??new g0({})),w=_.boundingInfo;w!=null&&h===0&&(c0(c,w.bbMin),c0(c,w.bbMax)),y!=null&&(m.stageResources.geometries.push(_),m.numberOfVertices+=b)}),f||s.push(m)}),{engineResources:s,referenceBoundingBox:c}}function RUt(t,e,r,i,n,s,o){const a=e.material+(e.attributes.normal?"_normal":"")+(e.attributes.color?"_color":"")+(e.attributes.texCoord0?"_texCoord0":"")+(e.attributes.tangent?"_tangent":""),l=t.materials.get(e.material),c=e.attributes.texCoord0!=null,u=e.attributes.normal!=null;if(l==null)return null;const h=AUt(l.alphaMode);if(!s.has(a)){if(c){const C=(E,R=!1)=>{if(E!=null&&!o.has(E)){const P=t.textures.get(E);if(P!=null){const D=P.data;o.set(E,new qE($2(D)?D.data:D,{...P.parameters,preMultiplyAlpha:!$2(D)&&R,encoding:$2(D)&&D.encoding!=null?D.encoding:void 0}))}}};C(l.textureColor,h!==Si.Opaque),C(l.textureNormal),C(l.textureOcclusion),C(l.textureEmissive),C(l.textureMetallicRoughness)}const m=l.color[0]**(1/jC),g=l.color[1]**(1/jC),y=l.color[2]**(1/jC),_=l.emissiveFactor[0]**(1/jC),b=l.emissiveFactor[1]**(1/jC),w=l.emissiveFactor[2]**(1/jC),x=l.textureColor!=null&&c?o.get(l.textureColor):null,S=AVe({normalTexture:l.textureNormal,metallicRoughnessTexture:l.textureMetallicRoughness,metallicFactor:l.metallicFactor,roughnessFactor:l.roughnessFactor,emissiveTexture:l.textureEmissive,emissiveFactor:l.emissiveFactor,occlusionTexture:l.textureOcclusion});s.set(a,new g0({...i,transparent:h===Si.Blend,customDepthTest:cE.Lequal,textureAlphaMode:h,textureAlphaCutoff:l.alphaCutoff,diffuse:[m,g,y],ambient:[m,g,y],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",cullFace:l.doubleSided?Hi.None:Hi.Back,hasVertexColors:!!e.attributes.color,hasVertexTangents:!!e.attributes.tangent,normalType:u?ei.Attribute:ei.ScreenDerivative,castShadows:!0,receiveSSAO:!0,textureId:x!=null?x.id:void 0,colorMixMode:l.colorMixMode,normalTextureId:l.textureNormal!=null&&c?o.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:x!=null&&!!x.parameters.preMultiplyAlpha,occlusionTextureId:l.textureOcclusion!=null&&c?o.get(l.textureOcclusion).id:void 0,emissiveTextureId:l.textureEmissive!=null&&c?o.get(l.textureEmissive).id:void 0,metallicRoughnessTextureId:l.textureMetallicRoughness!=null&&c?o.get(l.textureMetallicRoughness).id:void 0,emissiveFactor:[_,b,w],mrrFactors:S?[...Spe]:[l.metallicFactor,l.roughnessFactor,i.mrrFactors[2]],isSchematic:S,colorTextureTransformMatrix:My(l.colorTextureTransform),normalTextureTransformMatrix:My(l.normalTextureTransform),occlusionTextureTransformMatrix:My(l.occlusionTextureTransform),emissiveTextureTransformMatrix:My(l.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:My(l.metallicRoughnessTextureTransform),...n}))}const f=s.get(a);if(r.stageResources.materials.push(f),c){const m=g=>{g!=null&&r.stageResources.textures.push(o.get(g))};m(l.textureColor),m(l.textureNormal),m(l.textureOcclusion),m(l.textureEmissive),m(l.textureMetallicRoughness)}return f}function OUt(t,e){const r=t.attributes.position.count,i=pUt(t.indices||r,t.primitiveType),n=Dn(3*r),{typedBuffer:s,typedBufferStride:o}=t.attributes.position;t3(n,s,t.transform,3,o);const a=[[O.POSITION,new ft(n,3,!0)]],l=[[O.POSITION,i]];if(t.attributes.normal!=null){const c=Dn(3*r),{typedBuffer:u,typedBufferStride:h}=t.attributes.normal;ix(M6,t.transform),gE(c,u,M6,3,h),a.push([O.NORMAL,new ft(c,3,!0)]),l.push([O.NORMAL,i])}if(t.attributes.tangent!=null){const c=Dn(4*r),{typedBuffer:u,typedBufferStride:h}=t.attributes.tangent;ix(M6,t.transform),Mpe(c,u,M6,4,h),a.push([O.TANGENT,new ft(c,4,!0)]),l.push([O.TANGENT,i])}if(t.attributes.texCoord0!=null){const c=Dn(2*r),{typedBuffer:u,typedBufferStride:h}=t.attributes.texCoord0;$pe(c,u,2,h),a.push([O.UV0,new ft(c,2,!0)]),l.push([O.UV0,i])}if(t.attributes.color!=null){const c=new Uint8Array(4*r);t.attributes.color.elementCount===4?t.attributes.color instanceof dg?aj(c,t.attributes.color,255):t.attributes.color instanceof zl?Ipe(c,t.attributes.color):t.attributes.color instanceof SF&&aj(c,t.attributes.color,1/256):(c.fill(255),t.attributes.color instanceof xo?ZB(c,t.attributes.color,255,4):t.attributes.color instanceof EH?jF(c,t.attributes.color.typedBuffer,4,t.attributes.color.typedBufferStride):t.attributes.color instanceof RH&&ZB(c,t.attributes.color,1/256,4)),a.push([O.COLOR,new ft(c,4,!0)]),l.push([O.COLOR,i])}return{geometry:new Us(e,a,l),vertexCount:r}}const M6=vn();function AUt(t){switch(t){case"BLEND":return Si.Blend;case"MASK":return Si.Mask;case"OPAQUE":case null:case void 0:return Si.Opaque}}function PUt(t,e){for(let r=0;r<t.model.lods.length;++r){const i=t.model.lods[r];for(const n of i.parts){const s=n.attributes.normal;if(s==null)return;const o=n.attributes.position,a=o.count,l=A(),c=A(),u=A(),h=new Uint8Array(4*a),f=new Float64Array(3*a),m=Uo(Me(),n.transform);let g=0,y=0;for(let _=0;_<a;_++){o.getVec(_,c),s.getVec(_,l),lt(c,c,n.transform),ve(u,c,e.center),IV(u,u,e.radius);const b=u[2],w=We(u),x=Math.min(.45+.55*w*w,1);IV(u,u,e.radius),m!==null&&lt(u,u,m),Se(u,u),r+1!==t.model.lods.length&&t.model.lods.length>1&&mi(u,u,l,b>-1?.2:Math.min(-4*b-3.8,1)),f[g]=u[0],f[g+1]=u[1],f[g+2]=u[2],g+=3,h[y]=255*x,h[y+1]=255*x,h[y+2]=255*x,h[y+3]=255,y+=4}n.attributes.normal=new xo(f),n.attributes.color=new zl(h)}}}const Vwr=Object.freeze(Object.defineProperty({__proto__:null,fetch:BBe,gltfToEngineResources:GBe,parseUrl:jBe},Symbol.toStringTag,{value:"Module"})),MUt=()=>!!he("enable-feature:force-wosr"),Bwr=()=>!!he("enable-feature:direct-3d-object-feature-layer-display"),$Ut=()=>he.add("enable-feature:direct-3d-object-feature-layer-display",!0,!0,!0),IUt=()=>he.add("enable-feature:direct-3d-object-feature-layer-display",!1,!0,!0),jwr=()=>!!he("enable-i3s-patching"),LUt=()=>he.add("enable-i3s-patching",!0,!0,!0),DUt=()=>he.add("enable-i3s-patching",!1,!0,!0),zSe=()=>!!he("enable-feature:SceneLayer-editing"),NUt=(t="i3s-patching")=>{switch(DUt(),IUt(),he.add("enable-feature:SceneLayer-editing",!0,!0,!0),t){case"feature-layer-view":$Ut();break;case"i3s-patching":LUt()}};NUt("i3s-patching");let bZ={};async function FUt(t,e){try{return{data:(await Dpe(t,e)).data,baseUrl:tce(t),styleUrl:t}}catch(r){return Oa(r),null}}function kUt(t,e,r){const i=e.portal!=null?e.portal:Ns.getDefault();let n;const s=`${i.url} - ${i.user&&i.user.username} - ${t}`;return bZ[s]||(bZ[s]=UUt(t,i,r).then(o=>(n=o,o.fetchData())).then(o=>({data:o,baseUrl:n.itemUrl??"",styleName:t}))),bZ[s]}function UUt(t,e,r){return e.load(r).then(()=>{const i=new Ry({disableExtraQuery:!0,query:`owner:${VSe} AND type:${BSe} AND typekeywords:"${t}"`});return e.queryItems(i,r)}).then(({results:i})=>{var o;let n=null;const s=t.toLowerCase();if(i&&Array.isArray(i)){for(const a of i)if(((o=a.typeKeywords)==null?void 0:o.some(c=>c.toLowerCase()===s))&&a.type===BSe&&a.owner===VSe){n=a;break}}if(!n)throw new H("symbolstyleutils:style-not-found",`The style '${t}' could not be found`,{styleName:t});return n.load(r)})}function Lpe(t,e,r){return t&&t.styleUrl!=null?FUt(t.styleUrl,r):t&&t.styleName!=null?kUt(t.styleName,e,r):Promise.reject(new H("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))}function HBe(t){return t===null||t.type==="CIMSymbolReference"?t:{type:"CIMSymbolReference",symbol:t}}function qBe(t,e,r=["gltf"]){if(e==="cimRef")return t.cimRef;if(t.formatInfos&&!MUt())for(const i of r){const n=t.formatInfos.find(s=>s.type===i);if(n)return n.href}return t.webRef}function Dpe(t,e){const r={responseType:"json",query:{f:"json"},...e};return ti(qp(t),r)}const VSe="esri_en",BSe="Style",zUt="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",d$={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};function VUt(t,e=d$){var a,l;if(!t)return{symbol:null};const{retainId:r=d$.retainId,ignoreDrivers:i=d$.ignoreDrivers,hasLabelingContext:n=d$.hasLabelingContext,retainCIM:s=d$.retainCIM}=e;let o=null;if(rx(t)||t instanceof kE)o=t.clone();else if(t.type==="cim"){const c=(l=(a=t.data)==null?void 0:a.symbol)==null?void 0:l.type;if(c!=="CIMPointSymbol")return{error:new H("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${c||"unknown"}' is unsupported in 3D`,{symbol:t})};o=s?t.clone():_w.fromCIMSymbol(t)}else if(t instanceof Rd)o=hF.fromSimpleLineSymbol(t);else if(t instanceof lg)o=_w.fromSimpleMarkerSymbol(t);else if(t instanceof Y7)o=_w.fromPictureMarkerSymbol(t);else if(t instanceof X_)o=e.geometryType&&e.geometryType==="mesh"?pF.fromSimpleFillSymbol(t):fF.fromSimpleFillSymbol(t);else{if(!(t instanceof U3))return{error:new H("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${t.type||t.declaredClass}' is unsupported in 3D`,{symbol:t})};o=n?X7.fromTextSymbol(t):_w.fromTextSymbol(t)}return r&&o&&o.type!=="cim"&&(o.id=t.id),i&&rx(o)&&o.symbolLayers.forEach(c=>c.ignoreDrivers=!0),{symbol:o}}function lj(t,e,r,i){const n=WBe(t,{},{context:i,isLabelSymbol:!1});n!=null&&(e[r]=n)}function jSe(t,e,r,i){const n=WBe(t,{},{context:i,isLabelSymbol:!0});n!=null&&(e[r]=n)}function GSe(t){return t instanceof k3||t instanceof kE}function WBe(t,e,r){if(t==null)return null;const{context:i,isLabelSymbol:n}=r,s=i==null?void 0:i.origin,o=i==null?void 0:i.messages;if(s==="web-scene"&&!GSe(t)){const a=VUt(t,{retainCIM:!0,hasLabelingContext:n});return a.symbol!=null?a.symbol.write(e,i):(o==null||o.push(new H("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:t,context:i,error:a.error})),null)}return(s==="web-map"||s==="portal-item"&&!ZIe(i==null?void 0:i.layer))&&GSe(t)?(o==null||o.push(new H("symbol:unsupported",`Symbols of type '${t.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:t,context:i})),null):t.write(e,i)}function XBe(t,e){return Cbt(t,null,e)}function BUt(t,e,r,i){const n=t.name;return n==null?Promise.reject(new H("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):t.styleName&&t.styleName==="Esri2DPointSymbolsStyle"?jUt(n,e,i):Lpe(t,e,i).then(s=>Fpe(qu(s),n,e,r,qBe,i))}function Npe(t,e){return e.items.find(r=>r.name===t)}function Fpe(t,e,r,i,n,s){var m;const o=r&&r.portal!=null?r.portal:Ns.getDefault(),a={portal:o,url:Ts(t.baseUrl),origin:"portal-item"},l=Npe(e,t.data);if(!l){const g=`The symbol name '${e}' could not be found`;return Promise.reject(new H("symbolstyleutils:symbol-name-not-found",g,{symbolName:e}))}let c=$_(n(l,i),a),u=((m=l.thumbnail)==null?void 0:m.href)??null;const h=l.thumbnail&&l.thumbnail.imageData;L6t()&&(c=Tne(c)??"",u=Tne(u));const f={portal:o,url:Ts(tce(c)),origin:"portal-item"};return Dpe(c,s).then(g=>{const y=i==="cimRef"?HBe(g.data):g.data,_=XBe(y,f);if(_&&rx(_)){if(u){const b=$_(u,a);_.thumbnail=new x2({url:b})}else h&&(_.thumbnail=new x2({url:`data:image/png;base64,${h}`}));t.styleUrl?_.styleOrigin=new $N({portal:r.portal,styleUrl:t.styleUrl,name:e}):t.styleName&&(_.styleOrigin=new $N({portal:r.portal,styleName:t.styleName,name:e}))}return _})}function jUt(t,e,r){const i=zUt.replaceAll(/\{SymbolName\}/gi,t),n=e.portal!=null?e.portal:Ns.getDefault();return Dpe(i,r).then(s=>{const o=HBe(s.data);return XBe(o,{portal:n,url:Ts(tce(i)),origin:"portal-item"})})}const GUt=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:Fpe,getStyleItemFromStyle:Npe,resolveWebStyleSymbol:BUt},Symbol.toStringTag,{value:"Module"}));async function HUt(t){var a;if(t===null||t.styleName==null&&t.styleUrl==null)return null;const e=t.name;if(e==null)throw new H("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference");const r={portal:t.portal},i=await Lpe(t,r).catch(()=>null);if(i===null)return null;const n=Npe(e,i.data);if(n&&!((a=n.formatInfos)!=null&&a.some(l=>l.type==="gltf_basisu")))return null;const s=await Fpe(i,e,r,"webRef",(l,c)=>qBe(l,c,["gltf_basisu","gltf"])).catch(()=>null);if(s===null||s.type!=="point-3d")return null;const o=s.symbolLayers.items[0];return o.type==="object"?o.resource:null}let qUt=class{constructor(e,r,i){this._elementSize=r,this._buffer=ci.createVertex(e,qr.STATIC_DRAW),this.resize(i)}destroy(){this._buffer.dispose()}get elementSize(){return this._elementSize}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get memoryUsage(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}copyRange(e,r,i,n=0){const s=new Uint8Array(this.array,e*this.elementSize,(r-e)*this.elementSize);new Uint8Array(i.array,n*this.elementSize).set(s)}transferAll(){this._buffer.setData(this._array)}transferRange(e,r){const i=e*this._elementSize,n=r*this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),i,i,n)}resize(e){const r=e*this._elementSize,i=new ArrayBuffer(r);this._array&&(e>=this._capacity?new Uint8Array(i).set(new Uint8Array(this._array)):new Uint8Array(i).set(new Uint8Array(this._array).subarray(0,e*this._elementSize))),this._array=i,this._buffer.setSize(r),this._capacity=e}},WUt=class{constructor(e){this.modelOriginHi=e.getField(O.MODELORIGINHI,xo),this.modelOriginLo=e.getField(O.MODELORIGINLO,xo),this.model=e.getField(O.MODEL,ux),this.modelNormal=e.getField(O.MODELNORMAL,ux),this.featureAttribute=e.getField(O.INSTANCEFEATUREATTRIBUTE,dg),this.color=e.getField(O.INSTANCECOLOR,zl),this.objectAndLayerIdColor=e.getField(O.INSTANCEOBJECTANDLAYERIDCOLOR,zl)}},HSe=class{constructor(e,r){this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._rctx=e,this._instanceBufferLayout=r,this._elementSize=r.stride,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,r=this._tailIndex;return e>=r?e-r:e+this._capacity-r}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get memoryUsage(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){It(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){It(this._updating,"not updating"),this.size<Uct*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){It(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),It(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){It(this._updating,"not updating"),It(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(cj,Math.floor(this._capacity*s7));this._resize(e)}_shrink(){const e=Math.max(cj,Math.floor(this._capacity*kct));this._resize(e)}_resize(e){if(It(this._updating,"not updating"),e===this._capacity)return;const r=new qUt(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const i=this.size,n=this._compactInstances(r);It(n===i,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=n,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=r,this._view=new WUt(this._instanceBufferLayout.createView(this._buffer.array))}_compactInstances(e){const r=this._headIndex,i=this._tailIndex;return i<r?(this._buffer.copyRange(i,r,e),r-i):i>r?(this._buffer.copyRange(i,this._capacity,e),r>0&&this._buffer.copyRange(0,r,e,this._capacity-i),r+(this._capacity-i)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,r){e<r?this._buffer.transferRange(e,r):e>r&&(r>0&&this._buffer.transferRange(0,r),this._buffer.transferRange(e,this._capacity))}};const cj=64;var fn;function XUt(t){let e=On().mat4f64(O.LOCALTRANSFORM).mat4f64(O.GLOBALTRANSFORM).vec4f64(O.BOUNDINGSPHERE).vec3f64(O.MODELORIGIN).mat3f(O.MODEL).mat3f(O.MODELNORMAL).vec2f(O.MODELSCALEFACTORS);return t.includes(O.FEATUREATTRIBUTE)&&(e=e.vec4f(O.FEATUREATTRIBUTE)),t.includes(O.COLOR)&&(e=e.vec4u8(O.COLOR)),t.includes(O.OBJECTANDLAYERIDCOLOR)&&(e=e.vec4u8(O.OBJECTANDLAYERIDCOLOR)),e=e.u8(O.STATE).u8(O.LODLEVEL),e}(function(t){t[t.ALLOCATED=1]="ALLOCATED",t[t.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE",t[t.VISIBLE=4]="VISIBLE",t[t.HIGHLIGHT=8]="HIGHLIGHT",t[t.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE",t[t.REMOVE=32]="REMOVE",t[t.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED",t[t.ACTIVE=18]="ACTIVE"})(fn||(fn={}));let qSe=class{constructor(e){this.localTransform=e.getField(O.LOCALTRANSFORM,jN),this.globalTransform=e.getField(O.GLOBALTRANSFORM,jN),this.modelOrigin=e.getField(O.MODELORIGIN,ff),this.model=e.getField(O.MODEL,ux),this.modelNormal=e.getField(O.MODELNORMAL,ux),this.modelScaleFactors=e.getField(O.MODELSCALEFACTORS,Ox),this.boundingSphere=e.getField(O.BOUNDINGSPHERE,SH),this.featureAttribute=e.getField(O.FEATUREATTRIBUTE,dg),this.color=e.getField(O.COLOR,zl),this.objectAndLayerIdColor=e.getField(O.OBJECTANDLAYERIDCOLOR,zl),this.state=e.getField(O.STATE,HP),this.lodLevel=e.getField(O.LODLEVEL,HP)}},ZR=class extends Ce{constructor(e,r){super(e),this.events=new pn,this._capacity=0,this._size=0,this._next=0,this._layout=XUt(r),this._capacity=cj,this._buffer=this._layout.createBuffer(this._capacity),this._view=new qSe(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,fn.ALLOCATED),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const r=this._view.state;It(e>=0&&e<this._capacity&&(r.get(e)&fn.ALLOCATED)!=0,"invalid instance handle"),this._getStateFlag(e,fn.ACTIVE)?this._setStateFlags(e,fn.REMOVE):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const r=this._view.state;It(e>=0&&e<this._capacity&&(r.get(e)&fn.ALLOCATED)!=0,"invalid instance handle"),r.set(e,0),this._size--}setLocalTransform(e,r,i=!0){this._view.localTransform.setMat(e,r),i&&this.updateModelTransform(e)}getLocalTransform(e,r){this._view.localTransform.getMat(e,r)}setGlobalTransform(e,r,i=!0){this._view.globalTransform.setMat(e,r),i&&this.updateModelTransform(e)}getGlobalTransform(e,r){this._view.globalTransform.getMat(e,r)}updateModelTransform(e){const r=this._view,i=Tu,n=Lf;r.localTransform.getMat(e,WSe),r.globalTransform.getMat(e,wZ);const s=Ii(wZ,wZ,WSe);se(i,s[12],s[13],s[14]),r.modelOrigin.setVec(e,i),uf(n,s),r.model.setMat(e,n);const o=uvt(Tu,s);o.sort(),r.modelScaleFactors.set(e,0,o[1]),r.modelScaleFactors.set(e,1,o[2]),UE(n,n),df(n,n),r.modelNormal.setMat(e,n),this._setStateFlags(e,fn.TRANSFORM_CHANGED),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,r){const i=this._view;i.model.getMat(e,Lf),i.modelOrigin.getVec(e,Tu),r[0]=Lf[0],r[1]=Lf[1],r[2]=Lf[2],r[3]=0,r[4]=Lf[3],r[5]=Lf[4],r[6]=Lf[5],r[7]=0,r[8]=Lf[6],r[9]=Lf[7],r[10]=Lf[8],r[11]=0,r[12]=Tu[0],r[13]=Tu[1],r[14]=Tu[2],r[15]=1}applyShaderTransformation(e,r){this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedModelTransform(e,r){return this.getModelTransform(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r),r}getCombinedLocalTransform(e,r){this._view.localTransform.getMat(e,r),this.shaderTransformation!=null&&this.shaderTransformation.applyTransform(this,e,r)}getCombinedMaxScaleFactor(e){let r=this._view.modelScaleFactors.get(e,1);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Tu,this,e),r*=Math.max(Tu[0],Tu[1],Tu[2])),r}getCombinedMedianScaleFactor(e){let r=this._view.modelScaleFactors.get(e,0);return this.shaderTransformation!=null&&(this.shaderTransformation.scaleFactor(Tu,this,e),r*=YUt(Tu[0],Tu[1],Tu[2])),r}getModel(e,r){this._view.model.getMat(e,r)}setFeatureAttribute(e,r){this._view.featureAttribute.setVec(e,r)}getFeatureAttribute(e,r){this._view.featureAttribute.getVec(e,r)}setColor(e,r){this._view.color.setVec(e,r)}setObjectAndLayerIdColor(e,r){this._view.objectAndLayerIdColor.setVec(e,r)}setVisible(e,r){r!==this.getVisible(e)&&(this._setStateFlag(e,fn.VISIBLE,r),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,fn.VISIBLE)}setHighlight(e,r){r!==this.getHighlight(e)&&(this._setStateFlag(e,fn.HIGHLIGHT,r),this.events.emit("instance-highlight-changed"))}getHighlight(e){return this._getStateFlag(e,fn.HIGHLIGHT)}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let r=0;for(let i=0;i<this._capacity;++i)this.getState(i)&e&&++r;return r}_setStateFlags(e,r){const i=this._view.state;r=i.get(e)|r,i.set(e,r)}_clearStateFlags(e,r){const i=this._view.state;r=i.get(e)&~r,i.set(e,r)}_setStateFlag(e,r,i){i?this._setStateFlags(e,r):this._clearStateFlags(e,r)}_getStateFlag(e,r){return!!(this._view.state.get(e)&r)}_grow(){this._capacity=Math.max(cj,Math.floor(this._capacity*s7)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new qSe(this._buffer)}_findSlot(){const e=this._view.state;let r=this._next;for(;e.get(r)&fn.ALLOCATED;)r=r+1===this._capacity?0:r+1;return this._next=r+1===this._capacity?0:r+1,r}};function YUt(t,e,r){return Math.max(Math.min(t,e),Math.min(Math.max(t,e),r))}d([p({constructOnly:!0})],ZR.prototype,"shaderTransformation",void 0),d([p()],ZR.prototype,"_size",void 0),d([p({readOnly:!0})],ZR.prototype,"size",null),ZR=d([I("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],ZR);const Tu=A(),Lf=vn(),WSe=Me(),wZ=Me();let ZUt=class extends Vm{constructor(e,r){super(i=>this._instanceData.view.boundingSphere.getVec(i,this._tmpSphere),{maximumDepth:25}),this._instanceData=e,this._boundingSphere=r,this._tmpSphere=us(),this._tmpMat4=Me()}addInstance(e){const r=this._instanceData.view.boundingSphere,i=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);lt(this._tmpSphere,this._boundingSphere.center,i),this._tmpSphere[3]=this._boundingSphere.radius*OP(i),r.setVec(e,this._tmpSphere),this.add([e])}removeInstance(e){this.remove([e])}},JUt=class{constructor(e,r){this._worldSpaceRadius=e,this._minScreenSpaceRadii=r}selectLevel(e,r,i){const n=i.computeScreenPixelSizeAt(e),s=this._worldSpaceRadius*r/n;let o=0;for(let a=1;a<this._minScreenSpaceRadii.length;++a)s>=this._minScreenSpaceRadii[a]&&(o=a);return o}},KUt=class extends nH{constructor(e,r,i,n,s,o){super(e,r),this.layerUid=e,this.graphicUid=r,this.geometryId=i,this.triangleNr=n,this.baseBoundingSphere=s,this.numLodLevels=o}};function kpe(t){return mg(t)&&t.intersector===Sn.LOD&&!!t.target}let QUt=class{constructor(e,r){const i=e.renderContext.rctx,n=r.geometry;this._materialRepository=e.materialRepository,n.material.setParameters({instancedDoublePrecision:!0});const s=n.material.createBufferWriter(),o=s.vertexBufferLayout,a=s.elementCount(n),l=o.createBuffer(a);s.write(null,null,n,l,0),this.geometry=n,this.material=n.material,this.glMaterials=new sVe(n.material,this._materialRepository),this.vertexBufferLayout=o,this.vbo=ci.createVertex(i,qr.STATIC_DRAW,l.buffer),this.vao=new gg(i,Br,{geometry:Ad(o)},{geometry:this.vbo}),this.vertexCount=a}destroy(){this.glMaterials.destroy(),this.vbo.dispose(),this.vao.dispose()}get boundingInfo(){return this.geometry.boundingInfo}get triangleCount(){return this.vertexCount/3}intersect(e,r,i,n,s,o,a,l){const c=this.geometry.id;this.material.intersect(this.geometry,e.transform.transform,e,i,n,(u,h,f,m,g)=>{if(u>=0){if(r!=null&&!r(e.rayBegin,e.rayEnd,u))return;const y=new KUt(o.layerUid,o.graphicUid(s),c,f,a,l);if((e.results.min.drapedLayerOrder==null||g>=e.results.min.drapedLayerOrder)&&(e.results.min.dist==null||u<e.results.min.dist)&&e.results.min.set(Sn.LOD,y,u,h,e.transform.transform,g),e.options.store!==Ia.MIN&&(e.results.max.drapedLayerOrder==null||g>=e.results.max.drapedLayerOrder)&&(e.results.max.dist==null||u>e.results.max.dist)&&e.results.max.set(Sn.LOD,y,u,h,e.transform.transform,g),e.options.store===Ia.ALL){const _=yde(e.results.min.ray);_.set(Sn.LOD,y,u,h,e.transform.transform,g),e.results.all.push(_)}}})}},e8t=class YBe{static async create(e,r,i){const n=await Promise.allSettled(r.components.map(o=>e.controller.schedule(()=>new QUt(e,o),i))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(_0);if(go(i)||s.length!==n.length){s.forEach(o=>o.destroy()),vr(i);for(const o of n)if(o.status==="rejected")throw o.reason}return new YBe(r.minScreenSpaceRadius,s)}constructor(e,r){this.minScreenSpaceRadius=e,this.components=r}destroy(){this.components.forEach(e=>e.destroy())}intersect(e,r,i,n,s,o,a){this.components.forEach(l=>l.intersect(e,r,i,n,s,o,this.boundingSphere,a))}get boundingBox(){if(this._boundingBox==null){const e=en();this.components.forEach(r=>{r.boundingInfo!=null&&(c0(e,r.boundingInfo.bbMin),c0(e,r.boundingInfo.bbMax))}),this._boundingBox=e}return this._boundingBox}get boundingSphere(){if(this._boundingSphere==null){const e=this.boundingBox,r=A();Fm(e,r),this._boundingSphere={center:r,radius:.5*z4e(e)}}return this._boundingSphere}get triangleCount(){return this.components.reduce((e,r)=>e+r.triangleCount,0)}};const t8t=t=>{const e=t.baseBoundingSphere.radius,r=t.levels.map(i=>i.minScreenSpaceRadius);return new JUt(e,r)};let cp=class extends Ce{constructor(e,r){super(e),this.type=Sn.LOD,this.isGround=!1,this._handles=new Ri,this._levels=[],this._defaultRenderInstanceData=[new Array],this._highlightRenderInstanceData=[new Array],this._allRenderInstanceData=[this._defaultRenderInstanceData[0],this._highlightRenderInstanceData[0]],this._instanceIndex=0,this._cycleStartIndex=0,this._slicePlane=!1,this._camera=new Bt,this._updateCyclesWithStaticCamera=-1,this._needFullCycle=!1,this.slots=[_e.OPAQUE_MATERIAL,_e.TRANSPARENT_MATERIAL],this.canRender=!0,this._instanceData=new ZR({shaderTransformation:e.shaderTransformation},e.optionalFields),this._handles.add(r.registerTask(Vt.LOD_RENDERER,this))}initialize(){this._instanceBufferLayout=i8t(this.optionalFields),this._glInstanceBufferLayout=Ad(this._instanceBufferLayout,1),this._handles.add([this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle()),this._instanceData.events.on("instance-transform-changed",({index:e})=>{this._requestUpdateCycle(),this.metadata.notifyGraphicGeometryChanged(e)}),this._instanceData.events.on("instance-visibility-changed",({index:e})=>{this._requestUpdateCycle(!0),this.metadata.notifyGraphicVisibilityChanged(e)}),this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))])}destroy(){this._handles.destroy()}get _enableLevelSelection(){return this.symbol.levels.length>1}get levels(){return this._levels}get baseBoundingBox(){return this._levels[this._levels.length-1].boundingBox}get baseBoundingSphere(){return this._levels[this._levels.length-1].boundingSphere}get baseMaterial(){return this._levels[this._levels.length-1].components[0].material}get slicePlaneEnabled(){return this._slicePlane}set slicePlaneEnabled(e){this._slicePlane=e}get layerUid(){return this.metadata.layerUid}get instanceData(){return this._instanceData}get memoryUsage(){const e={cpu:0,gpu:0};return this._allRenderInstanceData.forEach(r=>r.forEach(i=>{e.cpu+=i.memoryUsage.cpu,e.gpu+=i.memoryUsage.gpu})),e}get renderStats(){const e=this._instanceData.size,r=[];return this._levels.forEach((i,n)=>{const s=this._allRenderInstanceData[0][n].size+this._allRenderInstanceData[1][n].size,o=i.triangleCount;r.push({renderedInstances:s,renderedTriangles:s*o,trianglesPerInstance:o})}),{totalInstances:e,renderedInstances:r.reduce((i,n)=>i+n.renderedInstances,0),renderedTriangles:r.reduce((i,n)=>i+n.renderedTriangles,0),levels:r}}async initializeRenderContext(e,r){this._context=e;const i=e.renderContext.rctx,n=await Promise.allSettled(this.symbol.levels.map(o=>(this._defaultRenderInstanceData[0].push(new HSe(i,this._instanceBufferLayout)),this._highlightRenderInstanceData[0].push(new HSe(i,this._instanceBufferLayout)),e8t.create(e,o,r)))),s=n.map(o=>o.status==="fulfilled"?o.value:null).filter(_0);if(go(r)||s.length!==n.length){s.forEach(o=>o.destroy()),vr(r);for(const o of n)if(o.status==="rejected")throw o.reason}this._levels=s,this._levelSelector=t8t(this)}uninitializeRenderContext(){this._invalidateOctree(),this._levels.forEach(e=>e.destroy()),this._defaultRenderInstanceData[0].forEach(e=>e.destroy()),this._highlightRenderInstanceData[0].forEach(e=>e.destroy())}get needsTransparentPass(){return this._levels.some(e=>e.components.some(r=>r.material.requiresSlot(_e.TRANSPARENT_MATERIAL,q.Color)))}get needsHighlight(){return this._highlightRenderInstanceData[0].some(e=>e.size>0)}prepareRender(e){if(!Di.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const r=e.bindParameters.contentCamera.equals(this._camera);this._camera.copyFrom(e.bindParameters.contentCamera),r||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(bc),this._needFullCycle=!1)}}prepareTechniques(e){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleForOutput(e.output))return null;const r=this._getInstanceDatas(e.output);if(!r)return null;const i=new Array;return r.forEach(n=>this.levels.forEach((s,o)=>{s.components.forEach(a=>i.push(this._beginComponent(e,n[o],a)))})),i}render(e,r){const i=this._getInstanceDatas(e.output);if(!i)return;let n=0;e.rctx.bindVAO(),i.forEach(s=>this.levels.forEach((o,a)=>{o.components.forEach(l=>this._renderComponent(e,r[n++],s[a],l,a))}))}_getInstanceDatas(e){const r=e!==q.Highlight&&e!==q.ShadowHighlight,i=e!==q.ShadowExcludeHighlight;return r&&i?this._allRenderInstanceData:r?this._defaultRenderInstanceData:i?this._highlightRenderInstanceData:null}intersect(e,r,i,n){if(!this.baseMaterial.isVisible()||this._octree==null)return;const s=A();ve(s,n,i);const o=a=>{this._instanceData.getCombinedModelTransform(a,ZSe),e.transform.set(ZSe),lt(JSe,i,e.transform.inverse),lt(KSe,n,e.transform.inverse);const l=this._instanceData.getState(a),c=this._instanceData.getLodLevel(a),u=this._levels.length;It((l&fn.ACTIVE)!=0,"invalid instance state"),It(c>=0&&c<u,"invaid lod level"),this._levels[c].intersect(e,r,JSe,KSe,a,this.metadata,u)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(o):this._octree.forEachAlongRay(i,s,o)}queryDepthRange(e){return this._queryDepthRangeOctree(e)}notifyShaderTransformationChanged(){this._invalidateOctree(),this._requestUpdateCycle()}get _octree(){var e;if(this._octreeCached==null){const r=this._instanceData,i=(e=r.view)==null?void 0:e.state;if(!i)return null;this._octreeCached=new ZUt(r,this.baseBoundingSphere);for(let n=0;n<r.capacity;++n)i.get(n)&fn.ACTIVE&&this._octreeCached.addInstance(n)}return this._octreeCached}_invalidateOctree(){this._octreeCached=qe(this._octreeCached)}_queryDepthRangeOctree(e){if(this._octree==null)return{near:1/0,far:-1/0};const r=e.viewForward,i=this._octree.findClosest(r,Vm.DepthOrder.FRONT_TO_BACK,e.frustum),n=this._octree.findClosest(r,Vm.DepthOrder.BACK_TO_FRONT,e.frustum);if(i==null||n==null)return{near:1/0,far:-1/0};const s=e.eye,o=this._instanceData.view;o.boundingSphere.getVec(i,Ug),ve(Ug,Ug,s);const a=ye(Ug,r)-Ug[3];o.boundingSphere.getVec(n,Ug),ve(Ug,Ug,s);const l=ye(Ug,r)+Ug[3];return{near:Math.max(e.near,a),far:Math.min(e.far,l)}}_requestUpdateCycle(e=!1){this._updateCyclesWithStaticCamera=-1,this._cycleStartIndex=this._instanceIndex,e&&(this._needFullCycle=!0,this._context.requestRender())}_startUpdateCycle(){this._updateCyclesWithStaticCamera++,this._allRenderInstanceData.forEach(e=>e.forEach(r=>r.startUpdateCycle()))}get running(){return this._instanceData.size>0&&this._updateCyclesWithStaticCamera<1}runTask(e){const{_enableLevelSelection:r,_camera:i,_levelSelector:n}=this;this._allRenderInstanceData.forEach(u=>u.forEach(h=>h.beginUpdate()));const s=this._instanceData,o=s.view;let a=s.size;const l=s.capacity;let c=this._instanceIndex;for(let u=0;u<a&&!e.done;++u){c===this._cycleStartIndex&&this._startUpdateCycle();const h=o.state.get(c);let f=0;if(!(h&fn.ALLOCATED)){c=c+1===l?0:c+1,a++;continue}const m=o.lodLevel.get(c);if(h&fn.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[0][m].freeTail(),h&fn.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[0][m].freeTail(),h&fn.REMOVE)s.freeInstance(c);else if(h&fn.VISIBLE){let g=0;r&&(o.modelOrigin.getVec(c,YSe),g=n.selectLevel(YSe,s.getCombinedMedianScaleFactor(c),i)),f=h&~(fn.ACTIVE|fn.TRANSFORM_CHANGED),g>=0&&(h&fn.HIGHLIGHT?(XSe(this._highlightRenderInstanceData[0][g],o,c),f|=fn.HIGHLIGHT_ACTIVE):(XSe(this._defaultRenderInstanceData[0][g],o,c),f|=fn.DEFAULT_ACTIVE)),o.state.set(c,f),o.lodLevel.set(c,g)}else f=h&~(fn.ACTIVE|fn.TRANSFORM_CHANGED),o.state.set(c,f);if(this._octreeCached!=null){const g=!!(h&fn.ACTIVE),y=!!(f&fn.ACTIVE);!g&&y?this._octreeCached.addInstance(c):g&&!y?this._octreeCached.removeInstance(c):g&&y&&h&fn.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(c),this._octreeCached.addInstance(c))}c=c+1===l?0:c+1,e.madeProgress()}this._instanceIndex=c,this._allRenderInstanceData.forEach(u=>u.forEach(h=>h.endUpdate())),this._context.requestRender()}_beginComponent(e,r,i){const{bindParameters:n,rctx:s,output:o}=e;if(r.size===0||!i.material.requiresSlot(n.slot,e.output))return null;const a=i.glMaterials.load(s,n.slot,o);return a!=null?a.beginSlot(n):null}_renderComponent(e,r,i,n,s){var _;if(!r)return;const{bindParameters:o,rctx:a}=e;(_=a.appleAmdDriverHelper)==null||_.resetIndicesType();const l=a.bindTechnique(r,n.material.parameters,o);a.bindVAO(n.vao),r.ensureAttributeLocations(n.vao),l.bindDraw(n8t,o,n.material.parameters),Di.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&e.output===q.Color&&(l.setUniform4fv("externalColor",QSe[Math.min(s,QSe.length-1)]),l.setUniform1i("colorMixMode",C8e.replace));const c=a.capabilities.instancing,u=i.capacity,h=i.headIndex,f=i.tailIndex,m=i.firstIndex,g=this._glInstanceBufferLayout,y=(b,w)=>{Vde(a,Br,i.buffer,g,b),c.drawArraysInstanced(r.primitiveType,0,n.vertexCount,w-b),Bde(a,Br,i.buffer,g)};n.material.parameters.transparent&&m!=null?h>f?(It(m>=f&&m<=h,"invalid firstIndex"),y(m,h),y(f,m)):h<f&&(m<=h?(It(m>=0&&m<=h,"invalid firstIndex"),y(m,h),y(f,u),y(0,m)):(It(m>=f&&m<=u,"invalid firstIndex"),y(m,u),y(0,h),y(f,m))):h>f?y(f,h):h<f&&(y(0,h),y(f,u)),a.bindVAO(null)}};function XSe(t,e,r){const i=t.allocateHead();r8t(e,r,t.view,i)}function r8t(t,e,r,i){DOt(t.modelOrigin,e,r.modelOriginHi,r.modelOriginLo,i),r.model.copyFrom(i,t.model,e),r.modelNormal.copyFrom(i,t.modelNormal,e),t.color&&r.color&&r.color.copyFrom(i,t.color,e),t.objectAndLayerIdColor&&r.objectAndLayerIdColor&&r.objectAndLayerIdColor.copyFrom(i,t.objectAndLayerIdColor,e),t.featureAttribute&&r.featureAttribute&&r.featureAttribute.copyFrom(i,t.featureAttribute,e)}function i8t(t){let e=On().vec3f(O.MODELORIGINHI).vec3f(O.MODELORIGINLO).mat3f(O.MODEL).mat3f(O.MODELNORMAL);return t!=null&&t.includes("featureAttribute")&&(e=e.vec4f(O.INSTANCEFEATUREATTRIBUTE)),t!=null&&t.includes("color")&&(e=e.vec4u8(O.INSTANCECOLOR)),t!=null&&t.includes("objectAndLayerIdColor")&&(e=e.vec4u8(O.INSTANCEOBJECTANDLAYERIDCOLOR)),e}d([p({constructOnly:!0})],cp.prototype,"symbol",void 0),d([p({constructOnly:!0})],cp.prototype,"optionalFields",void 0),d([p({constructOnly:!0})],cp.prototype,"metadata",void 0),d([p({constructOnly:!0})],cp.prototype,"shaderTransformation",void 0),d([p()],cp.prototype,"_instanceData",void 0),d([p()],cp.prototype,"_cycleStartIndex",void 0),d([p({readOnly:!0})],cp.prototype,"_enableLevelSelection",null),d([p()],cp.prototype,"_updateCyclesWithStaticCamera",void 0),d([p({readOnly:!0})],cp.prototype,"running",null),cp=d([I("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],cp);const YSe=A(),Ug=wr(),ZSe=Me(),JSe=A(),KSe=A(),QSe=[nr(1,0,1,1),nr(0,0,1,1),nr(0,1,0,1),nr(1,1,0,1),nr(1,0,0,1)],n8t=new $Ft;let eTe=class{constructor(e,r,i,n,s,o,a,l,c,u,h,f){this.lodResources=e,this.lodRenderer=r,this.stageResources=i,this.originalMaterialParameters=n,this.resourceSize=s,this.isEsriSymbolResource=o,this.isWosr=a,this.resourceBoundingBox=l,this.symbolSize=c,this.extentPadding=u,this.physicalBasedRenderingEnabled=h,this.pivotOffset=f}},s8t=class extends A0{getCachedSize(){const[e,r,i]=this._resources!=null?this._resources.symbolSize:[1,1,1];return{width:e,depth:r,height:i}}constructor(e,r,i,n){super(e,r,i,n),this._resources=null,this._optionalFields=new Array,this._instanceIndexToGraphicUid=new Map,this._hasLoadedPBRTextures=!1,this._disposeResourceHandles=new Array,this.skipHighSymbolLodsChanged=!1,this.ensureDrapedStatus(!1),this._hasLoadedPBRTextures=i.physicalBasedRenderingEnabled}async doLoad(e){if(!this._drivenProperties.size&&GH(this.symbolLayer))throw new Error;if(this._isPrimitive){const r=this.symbolLayer.resource,i=r&&QLt(r.primitive)?r.primitive:Z4e;this._resources=await this._createResourcesForPrimitive(i,e)}else{const r=await HUt(this.symbol.styleOrigin),i=(r==null?void 0:r.href)??this.symbolLayer.resource.href;this._resources=await this._createResourcesForUrl(i,e)}this.layerOpacityChanged(),this.slicePlaneEnabledChanged(),this.physicalBasedRenderingChanged(),this.complexity=this.computeComplexity()}get extentPadding(){return this._resources!=null?this._resources.extentPadding:0}get _isPrimitive(){var e;return!((e=this.symbolLayer.resource)!=null&&e.href)}get lodRenderer(){var e;return(e=this._resources)==null?void 0:e.lodRenderer}_setMaterialTransparencyParams(e,r=(n=>(n=(i=>(i=this.symbolLayer)==null?void 0:i.material)())==null?void 0:n.color)()){const s=this._getCombinedOpacity(r),o=s<1||this.needsDrivenTransparentPass;return e.transparent=o,e.opacity=s,e.cullFace=o?Hi.None:Hi.Back,e}async _createResourcesForPrimitive(e,r){const i=this.symbolLayer,n=To(obt(e)),s=mc(rk(n)),o=mc(vX(s,i)),a=We(o),l=!1,c=!1,u={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,mrrFactors:[...Spe],ambient:qv,diffuse:qv,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive},h=!!u.usePBR;this._setMaterialTransparencyParams(u);const f=this.symbol;if(f.type==="point-3d"&&f.verticalOffset){const{screenLength:w,minWorldLength:x,maxWorldLength:S}=f.verticalOffset;u.verticalOffset={screenLength:Es(w),minWorldLength:x||0,maxWorldLength:S??1/0},u.castShadows=!1}if(this._context.screenSizePerspectiveEnabled&&(u.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings),this._drivenProperties.color)u.externalColor=Np;else{const w=i.material!=null?i.material.color:null,x=w!=null?ht.toUnitRGBA(w):Np;u.externalColor=x}this._fastUpdates=ZP(this._context.renderer,this._fastVisualVariableConvertOptions(n,o,s,null)),u.isInstanced=!0,this._fastUpdates?(Object.assign(u,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(u.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),he("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const m=new g0(u),g=Xze(e,m);if(!g)throw new Error(`Unknown object symbol primitive: ${e}`);const y=c6(g).map(w=>({opacity:1,transparent:w.parameters.transparent})),_=await this._createStageResources(g,h,r),b=await this._createLodRenderer(g,r);return new eTe(g,b,_,y,s,l,c,n,o,a,h,null)}async _createResourcesForUrl(e,r){var L,k;const i={materialParamsMixin:{isInstanced:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=ZP(this._context.renderer,this._fastVisualVariableConvertOptions(null,null,null,null)),this._fastUpdates?(Object.assign(i.materialParamsMixin,this._fastUpdates.materialParameters),this._optionalFields.push(O.FEATUREATTRIBUTE)):this._hasPerInstanceColor()&&(i.materialParamsMixin.hasInstancedColor=!0,this._optionalFields.push(O.COLOR)),he("enable-feature:objectAndLayerId-rendering")&&this._optionalFields.push(O.OBJECTANDLAYERIDCOLOR);const n=this.symbol;if(n.type==="point-3d"&&n.verticalOffset){const{screenLength:V,minWorldLength:W,maxWorldLength:G}=n.verticalOffset;i.materialParamsMixin.verticalOffset={screenLength:Es(V),minWorldLength:W||0,maxWorldLength:G??1/0},i.materialParamsMixin.castShadows=!1}i.signal=r,i.usePBR=this._context.physicalBasedRenderingEnabled,i.skipHighLods=this._context.skipHighSymbolLods;const s=i.usePBR,o=await BBe(e,i),a=o.isEsriSymbolResource,l=o.isWosr,c=I6t(o.lods);c.levels.sort((V,W)=>V.minScreenSpaceRadius-W.minScreenSpaceRadius);const u=this._context,h=this.symbolLayer.material,f=this._getExternalColorParameters(h),m=(k=(L=this.symbolLayer)==null?void 0:L.material)==null?void 0:k.color,g=this._getCombinedOpacity(m,{hasIntrinsicColor:!0}),y=this.needsDrivenTransparentPass,_=c6(c),b=c6(c).map(V=>({opacity:V.parameters.opacity||1,transparent:V.parameters.transparent}));_.forEach(V=>{const W=V.parameters;V.setParameters(f);const G=W.opacity*g,B=G<1||y||W.transparent;V.setParameters({opacity:G,transparent:B}),u.screenSizePerspectiveEnabled&&V.setParameters({screenSizePerspective:u.sharedResources.screenSizePerspectiveSettings})});const w=o.referenceBoundingBox,x=mc(rk(w)),S=mc(c.levels[0].pivotOffset),C=mc(vX(x,this.symbolLayer)),E=We(C),R=this._fastUpdates;JP(R,this._context.renderer,this._fastVisualVariableConvertOptions(w,C,x,S))&&_.forEach(V=>V.setParameters(R.materialParameters));const P=await this._createStageResources(c,s,r),D=await this._createLodRenderer(c,r);return new eTe(c,D,P,b,x,a,l,w,C,E,s,S)}_addDisposeResource(e){this._disposeResourceHandles.push(e)}async _createStageResources(e,r,i){const n=this._context.stage,s=c6(e);r!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged(),n.addMany(s),this._addDisposeResource(()=>n.removeMany(s));const o=rxe(e);n.addMany(o),this._addDisposeResource(()=>n.removeMany(o)),await n.load(o,i),vr(i);const a=ixe(e);return n.addMany(a),this._addDisposeResource(()=>n.removeMany(a)),{materials:s,textures:o,geometries:a}}async _createLodRenderer(e,r){const i=this._context.stage,n={layerUid:this._context.layer.uid,graphicUid:l=>this._instanceIndexToGraphicUid.get(l),notifyGraphicGeometryChanged:l=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(l)),notifyGraphicVisibilityChanged:l=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(l))},s=this._fastUpdates,o=s?{applyTransform:(l,c,u)=>{l.getFeatureAttribute(c,$6),Rs(u,qie(s.materialParameters,$6,u))},scaleFactor:(l,c,u)=>{c.getFeatureAttribute(u,$6),yIt(l,s.materialParameters,$6)}}:null,a=new cp({symbol:e,optionalFields:this._optionalFields,metadata:n,shaderTransformation:o},this._context.scheduler);return a.slicePlaneEnabled=this._context.slicePlaneEnabled,this._addDisposeResource(()=>{i.removeRenderPlugin(a),a.destroy()}),await i.addRenderPlugin(a.slots,a,r),a}_getExternalColorParameters(e){const r={};return this._drivenProperties.color?r.externalColor=Np:e!=null&&e.color!=null?r.externalColor=ht.toUnitRGBA(e.color):(r.externalColor=Np,r.colorMixMode="ignore"),r}destroy(){super.destroy(),this._cleanupResources()}_cleanupResources(){this._disposeResourceHandles.forEach(e=>e()),this._disposeResourceHandles.length=0,this._resources=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry))return null;const i=KN(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for icon symbol: ${r.geometry.type}`),null;const n=this.setGraphicElevationContext(r,new yg),s=e.renderingInfo;return this._createAs3DShape(r,i,s,n,r.uid,e.layer.uid)}notifyDestroyGraphicLayer(e){this._instanceIndexToGraphicUid.delete(e.instanceIndex)}graphicLayerToGraphicId(){return 0}layerOpacityChanged(){var s,o;if(this._resources==null)return;const e=this._drivenProperties.opacity,r=!this._isPrimitive,i=this._resources.stageResources.materials,n=this._resources.originalMaterialParameters;for(let a=0;a<i.length;a++){const l=i[a],c=(o=(s=this.symbolLayer)==null?void 0:s.material)==null?void 0:o.color,u=n[a],h=this._getCombinedOpacity(c,{hasIntrinsicColor:r})*u.opacity,f=h<1||e||u.transparent;l.setParameters({opacity:h,transparent:f}),this._isPrimitive&&l.setParameters({cullFace:f?Hi.None:Hi.Back})}}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,mx)}slicePlaneEnabledChanged(){if(this._resources==null)return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const e of this._resources.stageResources.materials)e.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0}physicalBasedRenderingChanged(){if(this._resources==null)return!0;const{stageResources:e,isWosr:r}=this._resources;for(const i of e.materials)this._isPrimitive?i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):r||i.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return this._hasLoadedPBRTextures!==!1||this._context.physicalBasedRenderingEnabled!==!0||(this._hasLoadedPBRTextures=!0,!1)}applyRendererDiff(e,r){if(this._resources==null)return Cs.RecreateSymbol;const{stageResources:{materials:i},lodRenderer:n,resourceBoundingBox:s,symbolSize:o,resourceSize:a,pivotOffset:l}=this._resources;for(const c in e.diff){if(c!=="visualVariables"||!JP(this._fastUpdates,r,this._fastVisualVariableConvertOptions(s,o,a,l)))return Cs.RecreateSymbol;for(const u of i)u.setParameters(this._fastUpdates.materialParameters);n.notifyShaderTransformationChanged()}return Cs.FastUpdate}computeComplexity(){if(this._resources==null)return super.computeComplexity();const e=this._resources.lodResources,r=Wze(e.levels[0]).reduce((s,o)=>s+o.indices.get(O.POSITION).length,0)/3,i=s=>Array.from(s.vertexAttributes.values()).reduce((o,a)=>o+uw(a.data),0)+Array.from(s.indices.values()).reduce((o,a)=>o+uw(a),0),n=rxe(e).reduce((s,o)=>s+(o.parameters.encoding&&o.parameters.encoding==="image/ktx2"?o.memoryEstimate:o.memoryEstimate/4),0)+ixe(e).reduce((s,o)=>s+i(o),0);return{primitivesPerFeature:r,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:{...Qze(this.symbol,this.symbolLayer),resourceBytes:n}}}_hasLodRenderer(){return this._resources!=null}_createAs3DShape(e,r,i,n,s,o){if(!this._hasLodRenderer()||this._resources==null)return null;const a=this.getFastUpdateAttrValues(e),l=this._context.clippingExtent;if(Na(r,GC,this._context.elevationProvider.spatialReference),l!=null&&!Vue(l,GC))return null;const c=this._requiresTerrainElevation(n),u=this._computeGlobalTransform(r,n,xZ,I6),h=this._computeLocalTransform(this._resources,this.symbolLayer,i,tTe),f=this._resources.lodRenderer.instanceData,m=f.addInstance();this._instanceIndexToGraphicUid.set(m,s),f.setLocalTransform(m,h,!1),f.setGlobalTransform(m,u),a&&f.setFeatureAttribute(m,a),this._fastUpdates==null&&this._hasPerInstanceColor()&&f.setColor(m,SD(i.color,i.opacity,255)),this._context.stage.renderView.objectAndLayerIdRenderHelper!=null&&f.setObjectAndLayerIdColor(m,this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:s,layerUid:o}));const g=new P6t(this,m,jLt,n);return c&&(g.alignedSampledElevation=I6.sampledElevation),g.needsElevationUpdates=mx(n.mode),JN(g,r,this._context.elevationProvider),g}_computeGlobalTransform(e,r,i,n){return fx(e,this._context.elevationProvider,r,this._context.renderCoordsHelper,n),GC[0]=e.x,GC[1]=e.y,GC[2]=n.z,lu(e.spatialReference,GC,i,this._context.renderCoordsHelper.spatialReference),i}_computeLocalTransform(e,r,i,n){return af(n),this._applyObjectRotation(i,!1,n),this._applyObjectRotation(r,!0,n),this._applyObjectScale(e,i,n),this._applyAnchor(e,r,n),n}_applyObjectScale(e,r,i){var o;if((o=this._fastUpdates)!=null&&o.requiresShaderTransformation)return;const n=this._drivenProperties.size&&r.size?r.size:e.symbolSize,s=exe(n,e.symbolSize,e.resourceSize,this._context.renderCoordsHelper.unitInMeters);s[0]===1&&s[1]===1&&s[2]===1||A7(i,i,s)}prepareSymbolLayerPatch(e){if(e.diff.type!=="partial")return;const r=e.diff.diff;this._preparePatchTransform(e,r),this._preparePatchColor(e,r)}updateGeometry(e,r){if(this._resources==null)return!0;const i=r&&KN(r);if(i==null)return!1;const n=this.getGeometryElevationMode(r);return e.elevationContext.mode===n&&(this._computeGlobalTransform(i,e.elevationContext,xZ,I6),this._requiresTerrainElevation(e.elevationContext)&&(e.alignedSampledElevation=I6.sampledElevation),this._resources.lodRenderer.instanceData.setGlobalTransform(e.instanceIndex,xZ,!0),JN(e,i,this._context.elevationProvider),!0)}_preparePatchTransform(e,r){if(!(r.heading||r.tilt||r.roll||r.width||r.height||r.depth||r.anchor||r.anchorPosition)||this._resources==null)return;const i=(g,y,_)=>(g!=null&&g.type==="complete"?g.newValue:y)??_,n=i(r.heading,this.symbolLayer.heading,0),s=i(r.tilt,this.symbolLayer.tilt,0),o=i(r.roll,this.symbolLayer.roll,0),a=i(r.width,this.symbolLayer.width,void 0),l=i(r.height,this.symbolLayer.height,void 0),c=i(r.depth,this.symbolLayer.depth,void 0),u=i(r.anchor,this.symbolLayer.anchor,void 0),h=i(r.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete r.heading,delete r.tilt,delete r.roll,delete r.width,delete r.height,delete r.depth,delete r.anchor,delete r.anchorPosition;const f={heading:n,tilt:s,roll:o,anchor:u,anchorPosition:h},m=this._resources;this.loadStatus===rh.LOADED&&e.symbolLayerStatePatches.push(()=>{m.symbolSize=mc(vX(m.resourceSize,{width:a,height:l,depth:c,isPrimitive:this.symbolLayer.isPrimitive}))}),e.graphics3DGraphicPatches.push((g,y)=>{const _=this._computeLocalTransform(m,f,y,tTe),b=g.instanceIndex;m.lodRenderer.instanceData.setLocalTransform(b,_,!0)})}_preparePatchColor(e,r){if(!r.material||r.material.type!=="partial")return;const i=r.material.diff;if(!i.color||i.color.type!=="complete"||i.color.newValue==null||i.color.oldValue==null)return;const n=i.color.newValue,s=n!=null?ht.toUnitRGBA(n):Np;delete i.color;const o=this._resources;o!=null&&e.graphics3DGraphicPatches.push(a=>{let l;this._hasPerInstanceColor()?(o.lodRenderer.instanceData.setColor(a.instanceIndex,s),l=this._setMaterialTransparencyParams({},n)):l=this._setMaterialTransparencyParams({externalColor:s},n);for(const c of o.stageResources.materials)c.setParameters(l)})}_requiresTerrainElevation(e){return e.mode!=="absolute-height"}_applyObjectRotation(e,r,i){var n;if(!((n=this._fastUpdates)!=null&&n.requiresShaderTransformation)||!r)return $Lt(e.heading,e.tilt,e.roll,i)}_computeAnchor(e,r,i){const n=A();switch(i.anchor){case"center":oe(n,Fm(e)),Nl(n,n);break;case"top":{const s=Fm(e);se(n,-s[0],-s[1],-e[5]);break}case"bottom":{const s=Fm(e);se(n,-s[0],-s[1],-e[2]);break}case"relative":{const s=Fm(e),o=rk(e),a=i.anchorPosition,l=a?Ue(a.x,a.y,a.z):Sc;x7(n,o,l),ge(n,n,s),Nl(n,n);break}default:r!=null?Nl(n,r):oe(n,Sc)}return n}_applyAnchor(e,r,i){var s;if((s=this._fastUpdates)!=null&&s.requiresShaderTransformation)return;const n=this._computeAnchor(e.resourceBoundingBox,e.pivotOffset,r);n&&hu(i,i,n)}_hasPerInstanceColor(){return this._drivenProperties.color||this._drivenProperties.opacity}_fastVisualVariableConvertOptions(e,r,i,n){const s=e!=null?mc(rk(e)):qv,o=e!=null?this._computeAnchor(e,n,this.symbolLayer):Sc,a=this._context.renderCoordsHelper.unitInMeters,l=exe(r??void 0,r,i,a),c=Ue(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return new MF({size:!0,color:!0,rotation:!0,opacity:!1},s,r??qv,a,o,l,c)}};const GC=A(),tTe=Me(),xZ=Me(),$6=wr(),I6=new DF;let o8t=class{constructor(e,r,i,n){this.vertices=e,this.positionsES=r,this.offset=n;const s=e.length,o=Math.floor(s/2),a=this.offset+3*o,l=i[a],c=i[a+1],u=i[a+2];this.origin=Ue(l,c,u),this.positions=Dn(3*s);const h=this.offset+3*s;for(let f=this.offset;f<h;f+=3)this.positions[f]=i[f]-l,this.positions[f+1]=i[f+1]-c,this.positions[f+2]=i[f+2]-u;this.updatePathVertexInformation()}updatePathVertexInformation(){const e=this.vertices.length,r=this.vertices[0];let i=this.offset;const n=this.positions;r.vRight[0]=n[i+3]-n[i],r.vRight[1]=n[i+4]-n[i+1],r.vRight[2]=n[i+5]-n[i+2],i+=3;let s=We(r.vRight);r.vMinSiblingLength=s,Se(r.vRight,r.vRight);let o=r;for(let a=1;a<e;++a){const l=this.vertices[a];if(l.vLeft=o.vRight,a<e-1){l.vRight[0]=n[i+3]-n[i],l.vRight[1]=n[i+4]-n[i+1],l.vRight[2]=n[i+5]-n[i+2];const c=We(l.vRight);l.vMinSiblingLength=Math.min(s,c),s=c,Se(l.vRight,l.vRight)}else oe(l.vRight,l.vLeft),l.vMinSiblingLength=s;o=l,i+=3}}},a8t=class{constructor(e,r,i,n,s,o={}){this.path=e,this.profile=r,this.extruder=i,this.startCap=n,this.endCap=s,this.options=o,this._extrusionVertexCount=0;const a=this.path.vertices.length-2;this.numExtrusionProfiles=i.numProfilesPerJoin()*a+2,this.numVerticesTotal=r.vertices.length*this.numExtrusionProfiles,this.startCap.vertexBufferStart=this.numVerticesTotal;const l=this.startCap.numVertices;this.numVerticesTotal+=l,this.endCap.vertexBufferStart=this.numVerticesTotal;const c=this.endCap.numVertices;this.numVerticesTotal+=c,this.pathVertexData=COt(1*this.numVerticesTotal),this.profileRightAxes=Dn(4*this.numVerticesTotal),this.profileUpAxes=Dn(4*this.numVerticesTotal),this.profileVertexAndNormals=Dn(4*this.numVerticesTotal),this.positions=MB(e.positions,e.offset,3*e.vertices.length),this._rebuildGeometry(),this.buildTopology()}emitVertex(e,r,i,n,s){const o=4*this._extrusionVertexCount;if(this.profileRightAxes[o]=r.right[0],this.profileRightAxes[o+1]=r.right[1],this.profileRightAxes[o+2]=r.right[2],this.profileUpAxes[o]=r.up[0],this.profileUpAxes[o+1]=r.up[1],this.profileUpAxes[o+2]=r.up[2],this.profileVertexAndNormals[o]=i[0],this.profileVertexAndNormals[o+1]=i[1],this.profileVertexAndNormals[o+2]=n[0],this.profileVertexAndNormals[o+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,s){const a=this.path.vertices[e],l=a.maxStretchDistance;this.profileRightAxes[o+3]=a.rotationRight[0]*l,this.profileUpAxes[o+3]=a.rotationRight[1]*l}else this.profileRightAxes[o+3]=0,this.profileUpAxes[o+3]=0;++this._extrusionVertexCount}emitCapVertex(e,r,i,n,s,o){const a=4*this._extrusionVertexCount;this.profileRightAxes[a]=r.right[0],this.profileRightAxes[a+1]=r.right[1],this.profileRightAxes[a+2]=r.right[2],this.profileRightAxes[a+3]=s,this.profileUpAxes[a]=r.up[0],this.profileUpAxes[a+1]=r.up[1],this.profileUpAxes[a+2]=r.up[2],this.profileUpAxes[a+3]=o,this.profileVertexAndNormals[a]=i[0],this.profileVertexAndNormals[a+1]=i[1],this.profileVertexAndNormals[a+2]=n[0],this.profileVertexAndNormals[a+3]=n[1],this.pathVertexData[this._extrusionVertexCount]=e,++this._extrusionVertexCount}_rebuildGeometry(){this._extrusionVertexCount=0;const{positions:e,offset:r,vertices:i}=this.path;this.positions=MB(e,r,3*i.length);let n=0;const s=(a,l,c,u,h)=>this.emitCapVertex(n,a,l,c,u,h),o=(a,l,c,u)=>this.emitVertex(n,a,l,c,u);for(this.startCap.rebuildConnectingProfileGeometry(i[n],this.profile,s),n=1;n<i.length-1;++n)this.extruder.extrude(i[n],this.profile,o);this.endCap.rebuildConnectingProfileGeometry(i[n],this.profile,s),n=0,this.startCap.rebuildCapGeometry(i[n],s),n=i.length-1,this.endCap.rebuildCapGeometry(i[n],s)}buildTopology(){const e=this.profile.vertices.length,r=this.profile.numSegments,i=this.numExtrusionProfiles-1;let n=3*(2*(r*i));this.startCap.indexBufferStart=n,this.startCap.firstProfileVertexIndex=0,n+=this.startCap.numIndices,this.endCap.indexBufferStart=n,this.endCap.firstProfileVertexIndex=e*(this.numExtrusionProfiles-1);const s=new Array,o=new Array,a=new Array,l=(c,u,h)=>{s.push(c),s.push(u),s.push(h),o.push(c),o.push(u),o.push(h),a.push(this.pathVertexData[c]),a.push(this.pathVertexData[u]),a.push(this.pathVertexData[h])};for(let c=0;c<r;++c){const u=this.profile.indices[2*c],h=this.profile.indices[2*c+1];for(let f=0;f<i;++f){const m=f*e+u,g=(f+1)*e+h,y=f*e+h;l(m,(f+1)*e+u,g),l(m,g,y)}}this.startCap.buildTopology(this.path.vertices[0],l),this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],l),this.vertexIndices=Ky(s),this.normalIndices=Ky(o),this.pathVertexIndices=Ky(a)}onPathChanged(){this._rebuildGeometry()}},Upe=class{rebuildConnectingProfileGeometry(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],0,0)}},rTe=class extends Upe{constructor(){super(),this.numVertices=0,this.numIndices=0}rebuildCapGeometry(){}buildTopology(){}},L6=class extends Upe{constructor(e,r=0,i=!1){super(),this.profile=e,this.profilePlaneOffset=r,this.flip=i}get numVertices(){return this.profile.vertices.length}get numIndices(){return 3*this.profile.numSegments}rebuildConnectingProfileGeometry(e,r,i){const n=this.profilePlaneOffset;for(let s=0;s<r.vertices.length;++s)i(e.frame,r.vertices[s],r.normals[s],n,0)}rebuildCapGeometry(e,r){const i=this.profile,n=this.flip?1:-1,s=this.profilePlaneOffset,o=ZBe;Or(o,0,0);for(let a=0;a<i.vertices.length;++a)r(e.frame,i.vertices[a],o,s,n)}buildTopology(e,r){const i=this.profile,n=this.vertexBufferStart+i.indices[0];for(let s=1;s<i.numSegments;++s){const o=i.indices[2*s],a=i.indices[2*s+1],l=this.vertexBufferStart+o,c=this.vertexBufferStart+a;this.flip?r(c,l,n):r(n,l,c)}}},iTe=class extends Upe{constructor(e){super(),this.flip=!1,this.sign=0,this.breakNormals=!1,this.numSegments=3,this.profile=e.profile,this.flip=e.flip,this.sign=this.flip?1:-1,this.breakNormals=e.breakNormals,this.numSegments=e.subdivisions}get numVertices(){let e=this.profile.vertices.length*(this.numSegments-1)+this.profile.poles.length;return this.breakNormals&&(e+=this.profile.vertices.length),e}get numIndices(){let e=0;const r=this.profile;e+=2*r.numSegments*(this.numSegments-1);for(let i=0;i<r.numSegments;++i){const n=r.indices[2*i],s=r.indices[2*i+1];r.poleIndices[n]===r.poleIndices[s]?e+=1:e+=2}return 3*e}rebuildCapGeometry(e,r){const i=this.profile,n=e.frame,s=.5*this.sign,o=l8t,a=ZBe;Or(a,0,0);for(const l of i.poles)l.normal?r(n,l.position,l.normal,s,0):r(n,l.position,a,s,this.sign);if(this.breakNormals)for(let l=0;l<i.vertices.length;++l)r(n,i.vertices[l],i.normals[l],0,0);for(let l=0;l<this.numSegments-1;++l){const c=(1-(l+1)/this.numSegments)*Math.PI*.5,u=Math.sin(c),h=Math.cos(c);for(let f=0;f<i.vertices.length;++f){const m=i.poles[i.poleIndices[f]];os(o,i.vertices[f],m.position),eu(o,o,u),m.normal?(Tp(o,o,m.position),r(n,o,m.normal,s*h,0)):(BP(a,o),eu(a,a,u),Tp(o,o,m.position),r(n,o,a,s*h,this.sign*h))}}}buildTopology(e,r){const i=this.profile,n=this.breakNormals?this.vertexBufferStart+i.poles.length:this.firstProfileVertexIndex,s=this.breakNormals?this.vertexBufferStart+i.poles.length+i.vertices.length:this.vertexBufferStart+i.poles.length;for(let o=0;o<i.numSegments;++o){const a=i.indices[2*o],l=i.indices[2*o+1],c=this.vertexBufferStart+i.poleIndices[a],u=this.vertexBufferStart+i.poleIndices[l];let h=n+a,f=n+l;for(let m=0;m<this.numSegments-1;++m){const g=s+m*i.vertices.length+a,y=s+m*i.vertices.length+l;this.flip?(r(g,f,h),r(f,g,y)):(r(h,f,g),r(y,g,f)),h=g,f=y}this.flip?(r(c,f,h),c!==u&&r(c,u,f)):(r(h,f,c),c!==u&&r(f,u,c))}}};const l8t=Qe(),ZBe=Qe();let c8t=class{numProfilesPerJoin(){return 1}extrude(e,r,i){for(let n=0;n<r.vertices.length;++n)i(e.frame,r.vertices[n],r.normals[n],!1)}},SZ=class{constructor(e,r){this.cutoffAngle=e,this.numBendSubdivisions=r}numProfilesPerJoin(){return this.numBendSubdivisions+1}extrude(e,r,i){const n=d8t,{rotationAngle:s,rotationRight:o,frame:a}=e;if(Math.abs(s)>=this.cutoffAngle){const l=e.rotationFrameUp;for(let c=0;c<this.numBendSubdivisions+1;++c){Ch(sTe,.5*-s+c*s/this.numBendSubdivisions,l),u8t(n,a,sTe);for(let u=0;u<r.vertices.length;++u)Mn(r.vertices[u],o)*s>=0?i(n,r.vertices[u],r.normals[u],!1):i(a,e.applyMiterStretch(nTe,r.vertices[u]),r.normals[u],!0)}}else for(let l=0;l<this.numBendSubdivisions+1;++l)for(let c=0;c<r.vertices.length;++c){const u=Mn(r.vertices[c],o)*s>=0;i(a,e.applyMiterStretch(nTe,r.vertices[c]),r.normals[c],!u)}}},JBe=class{constructor(){this.up=A(),this.right=A()}};function u8t(t,e,r){lt(t.up,e.up,r),lt(t.right,e.right,r)}const nTe=Qe(),sTe=Me(),d8t=new JBe;let h8t=class extends Us{constructor(e,r,i,n,s,o,a){super(e,r,i,null,Wn.Mesh,a),this.path=n,this.geometrySR=s,this.stencilWidth=o}};var Qy;function KBe(t){return"path"in t}(function(t){t[t.World=0]="World",t[t.Path=1]="Path"})(Qy||(Qy={}));let QBe=class{constructor(e){this.builder=e}onPathChanged(e){this.builder.onPathChanged()}},eje=class extends QBe{constructor(e){super(e),this.vertexAttributeColor=nr(255,255,255,255),this.size=new Array,this.vertexAttributePosition=Dn(3*this.builder.numVerticesTotal),this.vertexAttributeNormal=new Int16Array(2*this.builder.numVerticesTotal)}bakeVertexColors(e){this.vertexAttributeColor[0]=255*e[0],this.vertexAttributeColor[1]=255*e[1],this.vertexAttributeColor[2]=255*e[2],this.vertexAttributeColor[3]=255*(e.length>3?e[3]:1)}bake(e){this.size=e;const{numVerticesTotal:r,pathVertexData:i,path:n,positions:s,profileRightAxes:o,profileUpAxes:a,profileVertexAndNormals:l}=this.builder;for(let c=0;c<r;++c){let u=i[c];const h=u===0||u===n.vertices.length-1;u*=3;const f=y8t;let m=0,g=0;const y=4*c,_=se(v8t,o[y],o[y+1],o[y+2]),b=se(_8t,a[y],a[y+1],a[y+2]),w=Or(oTe,l[y]*e[0],l[y+1]*e[1]);if(h)Lt(f,b,_),m=o[y+3]*e[0],g=a[y+3];else{const E=f8t,R=m8t;Or(E,o[y+3],a[y+3]);const P=_F(E);BP(E,E);const D=Mn(w,E);if(Math.abs(D)>P){Or(R,-E[1],E[0]);const L=Mn(w,R);eu(E,E,P*Math.sign(D)),eu(R,R,L),Tp(w,E,R)}se(f,0,0,0)}const x=se(g8t,_[0]*w[0]+b[0]*w[1],_[1]*w[0]+b[1]*w[1],_[2]*w[0]+b[2]*w[1]),S=3*c;this.vertexAttributePosition[S]=s[u]+x[0]+f[0]*m,this.vertexAttributePosition[S+1]=s[u+1]+x[1]+f[1]*m,this.vertexAttributePosition[S+2]=s[u+2]+x[2]+f[2]*m;const C=Or(oTe,l[y+2],l[y+3]);_E(this.vertexAttributeNormal,c,_[0]*C[0]+b[0]*C[1]+f[0]*g,_[1]*C[0]+b[1]*C[1]+f[1]*g,_[2]*C[0]+b[2]*C[1]+f[2]*g)}}createGeometryData(){const e=this.builder.vertexIndices.length;return new tje([[O.POSITION,new ft(this.vertexAttributePosition,3,!0)],[O.NORMALCOMPRESSED,new ft(this.vertexAttributeNormal,2,!0)],[O.COLOR,new ft(this.vertexAttributeColor,4)]],[[O.POSITION,this.builder.vertexIndices],[O.NORMALCOMPRESSED,this.builder.normalIndices],[O.COLOR,q3(e)]])}onPathChanged(e){super.onPathChanged(e),this.bake(this.size)}intersect(e,r,i){const n=this.builder.vertexIndices,s=new ft(this.vertexAttributePosition,3),o=n.length/3;OF(e,r,0,o,n,s,void 0,void 0,i)}},p8t=class extends QBe{constructor(e,r,i,n){super(e),this.sizeAttributeValue=r,this.colorAttributeValue=i,this.opacityAttributeValue=n,this.vvData=null,this.baked=new eje(e),this.vvData=Dn(4*this.builder.path.vertices.length);for(let s=0;s<this.builder.path.vertices.length;++s){this.vvData[4*s]=r,this.vvData[4*s+1]=i,this.vvData[4*s+2]=n;const o=s===0||s===this.builder.path.vertices.length-1;this.vvData[4*s+3]=o?1:0}}createGeometryData(){return new tje([[O.POSITION,new ft(this.builder.positions,3,!0)],[O.PROFILERIGHT,new ft(this.builder.profileRightAxes,4,!0)],[O.PROFILEUP,new ft(this.builder.profileUpAxes,4,!0)],[O.PROFILEVERTEXANDNORMAL,new ft(this.builder.profileVertexAndNormals,4,!0)],[O.FEATUREVALUE,new ft(this.vvData,4,!0)]],[[O.POSITION,this.builder.pathVertexIndices],[O.PROFILERIGHT,this.builder.vertexIndices],[O.PROFILEUP,this.builder.vertexIndices],[O.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[O.FEATUREVALUE,this.builder.pathVertexIndices]])}onPathChanged(e){super.onPathChanged(e);const r=e.getMutableAttribute(O.POSITION);r&&(r.data=this.builder.positions)}},tje=class{constructor(e,r){this.vertexAttributes=e,this.indices=r}};const oTe=Qe(),f8t=Qe(),m8t=Qe(),g8t=A(),y8t=A(),v8t=A(),_8t=A();function b8t(t,e){let r=null;const i=t.vertices.length,n=.99619469809,s=A(),o=A(),a=A(),l=A(),c=A(),u=A(),h=oi();let f=t.vertices[0];oe(o,e),se(s,0,1,0),LB(f.vRight,o,s,s,a,o,n),oe(f.frame.up,o),oe(f.frame.right,a);const m=t.positions;let g=t.offset;r=f;for(let y=1;y<i;++y){f=t.vertices[y],ge(c,f.vLeft,f.vRight);let _=We(c);_>0?(_=1/Math.sqrt(_),c[0]=c[0]*_,c[1]=c[1]*_,c[2]=c[2]*_):(c[0]=f.vRight[0],c[1]=f.vRight[1],c[2]=f.vRight[2]),u[0]=m[g]+r.frame.up[0],u[1]=m[g+1]+r.frame.up[1],u[2]=m[g+2]+r.frame.up[2],g+=3;const b=se(w8t,m[g],m[g+1],m[g+2]);gF(b,c,h),zE(h,Ah(u,f.vLeft),l)?(l[0]-=m[g],l[1]-=m[g+1],l[2]-=m[g+2],Se(o,l),Lt(a,c,o),Se(a,a)):LB(c,r.frame.up,r.frame.right,s,a,o,n),oe(f.frame.up,o),oe(f.frame.right,a),r=f}}const w8t=A();let rje=class{constructor(){this.vertices=new Array,this.normals=new Array,this.indices=new Array,this.poles=new Array,this.poleIndices=new Array}addVertex(e,r){return this.vertices.push(BO(e)),this.normals.push(BO(r)),this.vertices.length-1}addPole(e,r=null){return this.poles.push({position:BO(e),normal:r?BO(r):null}),this.poles.length-1}addSegment(e,r=null){this.indices.push(e.v0),this.indices.push(e.v1),r&&(this.poleIndices.push(r.v0),this.poleIndices.push(r.v1))}get numSegments(){return this.indices.length/2}translate(e,r){for(const i of this.vertices)i[0]+=e,i[1]+=r;for(const i of this.poles)i.position[0]+=e,i.position[1]+=r}};const ije={top:[0,-.5],bottom:[0,.5]};function TZ(t){const r=Hze,i=new rje,n={v0:0,v1:0};i.addPole(Nr(0,0));for(let o=0;o<r;++o){const a=2*o*Math.PI/r,l=Math.cos(a),c=Math.sin(a),u=Nr(l*.5,c*.5),h=Nr(l,c);i.addVertex(u,h)}for(let o=0;o<r-1;++o){const a={v0:o,v1:o+1};i.addSegment(a,n)}const s={v0:r-1,v1:0};if(i.addSegment(s,n),t!=="center"){const o=ije[t];i.translate(o[0],o[1])}return i}const x8t={center:TZ("center"),top:TZ("top"),bottom:TZ("bottom")},S8t={center:EZ("center"),top:EZ("top"),bottom:EZ("bottom")};function EZ(t){const i=new rje,n=Nr(.5*-1,.5*-1),s=Nr(.5*1,.5*-1),o=Nr(.5*1,.5*1),a=Nr(.5*-1,.5*1),l=Nr(0,-1),c=Nr(1,0),u=Nr(0,1),h=Nr(-1,0);if(i.addPole(Nr(0,.5*1),u),i.addPole(Nr(0,.5*1)),i.addPole(Nr(0,.5*-1)),i.addPole(Nr(0,.5*-1),l),i.addVertex(n,l),i.addVertex(s,l),i.addSegment({v0:0,v1:1},{v0:3,v1:3}),i.addVertex(s,c),i.addVertex(o,c),i.addSegment({v0:2,v1:3},{v0:2,v1:1}),i.addVertex(o,u),i.addVertex(a,u),i.addSegment({v0:4,v1:5},{v0:0,v1:0}),i.addVertex(a,h),i.addVertex(n,h),i.addSegment({v0:6,v1:7},{v0:1,v1:2}),t!=="center"){const f=ije[t];i.translate(f[0],f[1])}return i}function T8t(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function E8t(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function nje(t,e,r,i,n){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t}function C8t(t,e){if(t===e){const r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function R8t(t,e){const r=e[0],i=e[1],n=e[2],s=e[3];let o=r*s-n*i;return o?(o=1/o,t[0]=s*o,t[1]=-i*o,t[2]=-n*o,t[3]=r*o,t):null}function O8t(t,e){const r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function A8t(t){return t[0]*t[3]-t[2]*t[1]}function sje(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1],c=r[2],u=r[3];return t[0]=i*a+s*l,t[1]=n*a+o*l,t[2]=i*c+s*u,t[3]=n*c+o*u,t}function P8t(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=Math.sin(r),l=Math.cos(r);return t[0]=i*l+s*a,t[1]=n*l+o*a,t[2]=i*-a+s*l,t[3]=n*-a+o*l,t}function M8t(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=r[0],l=r[1];return t[0]=i*a,t[1]=n*a,t[2]=s*l,t[3]=o*l,t}function $8t(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t}function I8t(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function L8t(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function D8t(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2)}function N8t(t,e,r,i){return t[2]=i[2]/i[0],r[0]=i[0],r[1]=i[1],r[3]=i[3]-t[2]*r[1],[t,e,r]}function F8t(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function oje(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function k8t(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function U8t(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=e[0],a=e[1],l=e[2],c=e[3],u=Bl();return Math.abs(r-o)<=u*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-a)<=u*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-l)<=u*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(s-c)<=u*Math.max(1,Math.abs(s),Math.abs(c))}function z8t(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function V8t(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t}const B8t=sje,j8t=oje;Object.freeze(Object.defineProperty({__proto__:null,LDU:N8t,add:F8t,adjoint:O8t,copy:T8t,determinant:A8t,equals:U8t,exactEquals:k8t,frob:D8t,fromRotation:$8t,fromScaling:I8t,identity:E8t,invert:R8t,mul:B8t,multiply:sje,multiplyScalar:z8t,multiplyScalarAndAdd:V8t,rotate:P8t,scale:M8t,set:nje,str:L8t,sub:j8t,subtract:oje,transpose:C8t},Symbol.toStringTag,{value:"Module"}));function aje(){return[1,0,0,1]}function G8t(t){return[t[0],t[1],t[2],t[3]]}function H8t(t,e,r,i){return[t,e,r,i]}function q8t(t,e){return new Float64Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:G8t,create:aje,createView:q8t,fromValues:H8t},Symbol.toStringTag,{value:"Module"}));let lje=class{constructor(){this.vLeft=A(),this.vRight=A(),this.vMinSiblingLength=0,this.frame=new JBe}setFrameFromUpVector(e){oe(this.frame.up,e),ge(p$,this.vLeft,this.vRight),Se(p$,p$),ce(cTe,this.frame.up,ye(p$,this.frame.up)),ve(D6,p$,cTe),Se(D6,D6),Lt(this.frame.right,D6,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}},W8t=class extends lje{get rotationFrameUp(){return this.frame.up}get rotationRight(){return NFe}get rotationAngle(){return ce(N1,this.frame.up,ye(this.frame.up,this.vLeft)),ve(N1,this.vLeft,N1),Nl(N1,N1),Se(N1,N1),ce(qC,this.frame.up,ye(this.frame.up,this.vRight)),ve(qC,this.vRight,qC),Se(qC,qC),Lt(uj,this.rotationFrameUp,this.vLeft),Math.sign(ye(uj,this.vRight))*(Math.PI-Vo(ye(N1,qC)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)<=0)return r;const n=zQ(Math.cos(.5*i));return Or(e,(n-1+1)*r[0],r[1])}},X8t=class extends lje{get rotationFrameUp(){const e=Math.sign(ye(this.frame.right,this.vRight));return Lt(h$,this.vRight,this.vLeft),ce(h$,h$,e),Se(h$,h$)}get rotationRight(){const e=this.rotationFrameUp,r=ye(e,this.frame.up),i=ye(e,this.frame.right);return ce(HC,this.frame.up,-i),ce(lTe,this.frame.right,r),ge(HC,HC,lTe),Se(HC,HC),Y8t(aTe,this.frame,HC),aTe}get rotationAngle(){const e=Math.sign(ye(this.frame.right,this.vRight));return Nl(uj,this.vLeft),-e*(Math.PI-Vo(ye(uj,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*zQ(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(e,r){const i=this.rotationAngle;if(Math.abs(i)===0)return r;const n=zQ(Math.cos(.5*i)),s=this.rotationRight,o=nje(J8t,1+(n-1)*s[0]*s[0],(n-1)*s[0]*s[1],(n-1)*s[0]*s[1],1+(n-1)*s[1]*s[1]);return Xke(e,r,o)}};function Y8t(t,e,r){Or(t,ye(r,e.right),ye(r,e.up))}function Z8t(t){switch(t){case Qy.World:return new W8t;case Qy.Path:return new X8t}}const h$=A(),aTe=Qe(),HC=A(),lTe=A(),uj=A(),N1=A(),qC=A(),cTe=A(),p$=A(),D6=A(),J8t=aje(),CZ=8;function K8t(t,e){const r=O.FEATUREVALUE;t.attributes.add(r,"vec4");const i=t.vertex;i.code.add(T`
  bool isCapVertex() {
    return ${r}.w == 1.0;
  }
  `),i.uniforms.add(new Yr("size",n=>n.size)),e.vvSize?(i.uniforms.add(new ar("vvSizeMinSize",n=>n.vvSize.minSize),new ar("vvSizeMaxSize",n=>n.vvSize.maxSize),new ar("vvSizeOffset",n=>n.vvSize.offset),new ar("vvSizeFactor",n=>n.vvSize.factor)),i.code.add(T`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${r}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):i.code.add(T`vec2 getSize(){
return size;
}`),e.vvOpacity?(i.constants.add("vvOpacityNumber","int",CZ),i.uniforms.add(new ru("vvOpacityValues",n=>n.vvOpacity.values,CZ),new ru("vvOpacityOpacities",n=>n.vvOpacity.opacityValues,CZ)),i.code.add(T`
    vec4 applyOpacity(vec4 color) {
      float value = ${r}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):i.code.add(T`vec4 applyOpacity(vec4 color){
return color;
}`),e.vvColor?(i.constants.add("vvColorNumber","int",LA),i.uniforms.add(new ru("vvColorValues",n=>n.vvColor.values,LA),new J8e("vvColorColors",n=>n.vvColor.colors,LA)),i.code.add(T`
    vec4 getColor() {
      float value = ${r}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):i.code.add(T`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`),t.include(xF),t.attributes.add(O.PROFILERIGHT,"vec4"),t.attributes.add(O.PROFILEUP,"vec4"),t.attributes.add(O.PROFILEVERTEXANDNORMAL,"vec4"),i.code.add(T`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`),i.code.add(T`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`),i.code.add(T`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`),i.code.add(T`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)}let Q8t=class extends $F{constructor(){super(...arguments),this.size=Nr(1,1)}};function ezt(t){const e=new jr,{vertex:r,fragment:i}=e;switch(gd(r,t),e.varyings.add("vpos","vec3"),e.include(K8t,t),t.output!==q.Color&&t.output!==q.Alpha||(e.include(nu,t),e.include(vE,t),e.include(H3,t),e.varyings.add("vnormal","vec3"),e.varyings.add("vcolor","vec4"),t.hasMultipassTerrain&&e.varyings.add("depth","float"),r.code.add(T`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${t.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${t.output===q.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `)),e.include(Mh,t),t.output){case q.Alpha:e.include(as,t),i.uniforms.add(new Ye("opacity",n=>n.opacity)),i.code.add(T`
      void main() {
        discardBySlice(vpos);
        ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        fragColor = vec4(combinedOpacity);
      }
    `);break;case q.Color:e.include(as,t),e.include(bE,t),e.include(zF,t),e.include(vE,t),e.include(OVe,t),hg(i,t),VF(i),K3(i),i.uniforms.add(r.uniforms.get("localOrigin"),new ar("ambient",n=>n.ambient),new ar("diffuse",n=>n.diffuse),new ar("specular",n=>n.specular),new Ye("opacity",n=>n.opacity)),i.include(R0),C0(i),i.code.add(T`
        void main() {
          discardBySlice(vpos);
          ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${t.receiveShadows?"float shadow = readShadowMap(vpos, linearDepth);":t.spherical?"float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow = 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          fragColor = vec4(shadedColor, combinedOpacity);
          fragColor = highlightSlice(fragColor, vpos);
          ${t.transparencyPassType===kt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
        }
      `);break;case q.Depth:case q.Shadow:case q.ShadowHighlight:case q.ShadowExcludeHighlight:e.include(nu,t),hE(e),e.varyings.add("depth","float"),r.code.add(T`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),e.include(as,t),e.include(V_,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case q.Normal:e.include(nu,t),e.include(t4,t),XP(r),e.varyings.add("vnormal","vec3"),r.code.add(T`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(as,t),i.code.add(T`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
fragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case q.Highlight:e.include(nu,t),e.include(t4,t),e.varyings.add("vnormal","vec3"),r.code.add(T`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),e.include(as,t),e.include(s1,t),i.code.add(T`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return e}const tzt=Object.freeze(Object.defineProperty({__proto__:null,build:ezt},Symbol.toStringTag,{value:"Module"})),cje=new Map([[O.POSITION,0],[O.PROFILERIGHT,1],[O.PROFILEUP,2],[O.PROFILEVERTEXANDNORMAL,3],[O.FEATUREVALUE,4]]);let rzt=class extends Q8t{constructor(){super(...arguments),this.ambient=Ue(.2,.2,.2),this.diffuse=Ue(.8,.8,.8),this.specular=Ue(0,0,0),this.opacity=1,this.origin=A(),this.modelTransformation=null}},uje=class dje extends si{initializeConfiguration(e,r){r.spherical=e.viewingMode===at.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Kr(e.rctx,dje.shader.get().build(this.configuration),cje)}initializePipeline(){const e=this.configuration.transparencyPassType,r=this.configuration,i=e===kt.NONE,n=e===kt.FrontFace;return Qt({blending:r.output!==q.Color&&r.output!==q.Alpha||!r.transparent?null:i?bh:o1(e),culling:r.hasSlicePlane&&!r.transparent&&r.doubleSidedMode!==Nn.None?i6e:null,depthTest:{func:Px(e)},depthWrite:i||n?fu:null,colorWrite:hr,stencilWrite:r.hasOccludees?m0:null,stencilTest:r.hasOccludees?Mx:null,polygonOffset:i||n?null:zH})}};uje.shader=new Jr(tzt,()=>le(()=>import("./Path.glsl-b7049c33.js"),[]));let qo=class extends tl{constructor(){super(...arguments),this.output=q.Color,this.doubleSidedMode=Nn.None,this.transparencyPassType=kt.NONE,this.spherical=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.vvSize=!1,this.vvColor=!1,this.vvOpacity=!1,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.doublePrecisionRequiresObfuscation=!1}};d([X({count:q.COUNT})],qo.prototype,"output",void 0),d([X({count:Nn.COUNT})],qo.prototype,"doubleSidedMode",void 0),d([X({count:kt.COUNT})],qo.prototype,"transparencyPassType",void 0),d([X()],qo.prototype,"spherical",void 0),d([X()],qo.prototype,"receiveShadows",void 0),d([X()],qo.prototype,"receiveAmbientOcclusion",void 0),d([X()],qo.prototype,"vvSize",void 0),d([X()],qo.prototype,"vvColor",void 0),d([X()],qo.prototype,"vvOpacity",void 0),d([X()],qo.prototype,"hasSlicePlane",void 0),d([X()],qo.prototype,"transparent",void 0),d([X()],qo.prototype,"hasOccludees",void 0),d([X()],qo.prototype,"hasMultipassTerrain",void 0),d([X()],qo.prototype,"cullAboveGround",void 0),d([X()],qo.prototype,"doublePrecisionRequiresObfuscation",void 0),d([X({constValue:Nt.Disabled})],qo.prototype,"pbrMode",void 0),d([X({constValue:!0})],qo.prototype,"hasVvInstancing",void 0),d([X({constValue:!1})],qo.prototype,"useCustomDTRExponentForWater",void 0),d([X({constValue:!1})],qo.prototype,"useFillLights",void 0);let izt=class hje extends Ax{constructor(e){super(e,new szt),this.supportsEdges=!0,this._vertexAttributeLocations=cje,this._configuration=new qo,this._vertexBufferLayout=hje.getVertexBufferLayout()}getConfiguration(e,r){return this._configuration.output=e,this._configuration.vvSize=!!this.parameters.vvSize,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration.vvOpacity=!!this.parameters.vvOpacity,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.hasOccludees=this.parameters.hasOccludees,e!==q.Color&&e!==q.Alpha||(this._configuration.doubleSidedMode=this.parameters.doubleSided&&this.parameters.doubleSidedType==="normal"?Nn.View:this.parameters.doubleSided&&this.parameters.doubleSidedType==="winding-order"?Nn.WindingOrder:Nn.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=!!r.ssaoHelper.active&&this.parameters.receiveSSAO),this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration}isVisibleForOutput(e){return e!==q.Shadow&&e!==q.ShadowExcludeHighlight&&e!==q.ShadowHighlight||this.parameters.castShadows}isVisible(){return super.isVisible()&&this.parameters.opacity>0}intersect(e,r,i,n,s,o){const a=e;if(!KBe(a))return;const l=a.path,c=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSize){const{offset:_,factor:b,minSize:w,maxSize:x}=this.parameters.vvSize,S=l.sizeAttributeValue;c[0]*=Te(_[0]+S*b[0],w[0],x[0]),c[1]*=Te(_[2]+S*b[2],w[2],x[2])}const u=Math.max(c[0],c[1]),h=e.boundingInfo;if(h==null)return void this._intersectTriangles(l,c,n,s,o);const f=sE(h.bbMin[0]-u,h.bbMin[1]-u,h.bbMin[2]-u,h.bbMax[0]+u,h.bbMax[1]+u,h.bbMax[2]+u),m=[s[0]-n[0],s[1]-n[1],s[2]-n[2]],g=Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]),y=[g/m[0],g/m[1],g/m[2]];Ahe(f,n,y,i.tolerance)&&this._intersectTriangles(l,c,n,s,o)}_intersectTriangles(e,r,i,n,s){e.baked.size&&e.baked.size[0]===r[0]&&e.baked.size[1]===r[1]||e.baked.bake(r),e.baked.intersect(i,n,s)}createBufferWriter(){return new J3(this._vertexBufferLayout)}requiresSlot(e,r){switch(r){case q.Shadow:case q.ShadowHighlight:case q.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case q.Color:case q.Alpha:case q.Depth:case q.Normal:case q.Highlight:case q.ObjectAndLayerIdColor:return e===(this.parameters.transparent?_e.TRANSPARENT_MATERIAL:_e.OPAQUE_MATERIAL)||e===_e.DRAPED_MATERIAL;default:return!1}}createGLMaterial(e){return new nzt(e)}static getVertexBufferLayout(){return On().vec3f(O.POSITION).vec4f(O.PROFILERIGHT).vec4f(O.PROFILEUP).vec4f(O.PROFILEVERTEXANDNORMAL).vec4f(O.FEATUREVALUE)}},nzt=class extends Rx{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}_updateShadowState(e){this.technique!=null&&e.shadowMap.enabled===this.technique.configuration.receiveShadows||this._material.setParameters({receiveShadows:e.shadowMap.enabled})}beginSlot(e){return this._output!==q.Color&&this._output!==q.Alpha||(this._updateShadowState(e),this._updateOccludeeState(e)),this.ensureTechnique(uje,e)}},szt=class extends rzt{constructor(){super(...arguments),this.doubleSided=!1,this.doubleSidedType="normal",this.receiveSSAO=!0,this.receiveShadows=!1,this.castShadows=!0,this.hasSlicePlane=!1,this.transparent=!1,this.hasOccludees=!1}};const ozt=["polyline"];let azt=class extends A0{constructor(e,r,i,n){super(e,r,i,n),this._intrinsicSize=Nr(1,1),this._upVectorAlignment=Qy.Path,this._stencilWidth=.1,this.ensureDrapedStatus(!1)}async doLoad(){var f,m,g,y;const e=this.symbolLayer.width!=null?this.symbolLayer.width:this.symbolLayer.height,r=this.symbolLayer.height!=null?this.symbolLayer.height:e;this._vvConvertOptions=new MF({size:!0,color:!0,rotation:!1,opacity:!0},[1,1,1],[e,1,r],this._context.renderCoordsHelper.unitInMeters),this._fastUpdates=((m=(f=this._context.renderer)==null?void 0:f.visualVariables)==null?void 0:m.length)>0?ZP(this._context.renderer,this._vvConvertOptions):null;const i=this.symbolLayer.anchor||"center";this._upVectorAlignment=this.symbolLayer.profileRotation==="heading"?Qy.World:Qy.Path;const n=this.symbolLayer.profile||"circle";switch(n){default:case"circle":this._profile=x8t[i];break;case"quad":this._profile=S8t[i]}switch(this.symbolLayer.join){case"round":this._extruder=new SZ(0,Gze);break;case"bevel":this._extruder=new SZ(0,1);break;case"miter":this._extruder=new SZ(.8*Math.PI,1);break;default:this._extruder=new c8t}const s=this.symbolLayer.cap||"butt";switch(s){case"none":this._startCap=new rTe,this._endCap=new rTe;break;case"butt":default:this._startCap=new L6(this._profile,0),this._endCap=new L6(this._profile,0,!0);break;case"square":this._startCap=new L6(this._profile,-.5),this._endCap=new L6(this._profile,.5,!0);break;case"round":{const _=n==="quad";this._startCap=new iTe({profile:this._profile,flip:!1,breakNormals:_,subdivisions:tne}),this._endCap=new iTe({profile:this._profile,flip:!0,breakNormals:_,subdivisions:tne});break}}const o=(y=(g=this.symbolLayer)==null?void 0:g.material)==null?void 0:y.color,a=this._getCombinedOpacityAndColor(o),l=mc(a),c=a[3],u=c<1||this.needsDrivenTransparentPass,h={diffuse:l,ambient:l,opacity:c,transparent:u,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:u||s==="none"?Hi.None:Hi.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(Or(this._intrinsicSize,e,r),!ene(this._intrinsicSize[0])||!ene(this._intrinsicSize[1])))throw new H("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");if(this._fastUpdates&&this._fastUpdates.visualVariables.size||eu(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters),this._fastUpdates){const _={...h,...this._fastUpdates.materialParameters,size:PFe(this._intrinsicSize)};this._material=new izt(_)}else h.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,h.normalType=ei.Compressed,this._material=new g0(h);this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),this._context.stage.add(this._material)}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,ozt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new yg),n=e.renderingInfo;return this._createAs3DShape(r,n,i,r.uid)}layerOpacityChanged(){var n,s;const e=(s=(n=this.symbolLayer)==null?void 0:n.material)==null?void 0:s.color,r=this._getCombinedOpacity(e),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({opacity:r,transparent:i})}layerElevationInfoChanged(e,r){return this.updateGraphics3DGraphicElevationInfo(e,r,mx)}slicePlaneEnabledChanged(){return this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}),!0}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!JP(this._fastUpdates,r,this._vvConvertOptions))return Cs.RecreateSymbol;this._material.setParameters(this._fastUpdates.materialParameters)}return Cs.FastUpdate}_getVertexData(e){let r=0;const i=e.paths,n=[],s=e.spatialReference,o=this._context.elevationProvider.spatialReference,a=this._context.renderCoordsHelper.spatialReference;for(const h of i)r+=h.length;const l=sl(3*r);let c,u=0;for(const h of i){n.push({offset:u,numVertices:h.length});for(const f of h)l[u++]=f[0],l[u++]=f[1],l[u++]=e.hasZ?f[2]:0}return o==null||s.equals(o)||Ni(l,s,0,l,o,0,r)?(o==null||o.equals(a)?c=sUe(l):(c=sl(3*r),Ni(l,o,0,c,a,0,r)),{pathVertexDataInfos:n,vertexDataES:l,vertexDataRS:c}):null}_createAs3DShape(e,r,i,n){var g,y,_;const s=e.geometry,o=this._getVertexData(s);if(o==null)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(o.pathVertexDataInfos.length===0)return s.paths.length!==0&&s.paths.some(b=>b.length>0)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;const a=new Array,l=s.spatialReference,c=To(),u=this._context.renderCoordsHelper,h=new _de(o.vertexDataES);for(const b of o.pathVertexDataInfos){const w=b.numVertices;if(w<2)continue;const x=b.offset;if(this._context.clippingExtent!=null&&(en(c),ph(c,o.vertexDataES,x,w),!km(c,this._context.clippingExtent)))continue;const S=new Array,C=x+3*w;for(let W=x;W<C;W+=3){h.offset=W;const G=ILt(h,this._context.elevationProvider,i,u);se(rs,o.vertexDataRS[W],o.vertexDataRS[W+1],o.vertexDataRS[W+2]),u.setAltitude(rs,G),o.vertexDataRS[W]=rs[0],o.vertexDataRS[W+1]=rs[1],o.vertexDataRS[W+2]=rs[2],S.push(Z8t(this._upVectorAlignment))}const E=new o8t(S,o.vertexDataES,o.vertexDataRS,x);pje(E,this._upVectorAlignment,this._context.renderCoordsHelper);const R=new a8t(E,this._profile,this._extruder,this._startCap,this._endCap);let P=null;if(this._fastUpdates){const W=this._fastUpdates.visualVariables,G=Km((g=W.size)==null?void 0:g.field,e)??0,B=Km((y=W.color)==null?void 0:y.field,e)??0,Z=Km((_=W.opacity)==null?void 0:_.field,e)??0;P=new p8t(R,G,B,Z)}else{const W=[this._intrinsicSize[0],this._intrinsicSize[1]];if(this._drivenProperties.size){const Z=r.size;W[0]*=uTe(Z[0],Z[2]==="symbol-value"?this.symbolLayer.height||0:Z[2],this.symbolLayer.width||0),W[1]*=uTe(Z[2],Z[0]==="symbol-value"?this.symbolLayer.width||0:Z[0],this.symbolLayer.height||0)}let G;this._drivenProperties.color&&(G=r.color),this._drivenProperties.opacity&&r.opacity!=null&&(G=G?[G[0],G[1],G[2],r.opacity]:[1,1,1,r.opacity]);const B=new eje(R);B.bake(W),G&&B.bakeVertexColors(G),P=B}const{vertexAttributes:D,indices:L}=P.createGeometryData(),k=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:n,layerUid:this._context.layer.uid}),V=new h8t(this._material,D,L,P,l,this._stencilWidth,k);V.transformation=hu(Me(),bo,R.path.origin),a.push(V)}if(a.length===0)return null;const f=new a1({geometries:a,layerUid:this._context.layer.uid,graphicUid:n}),m=new O0(this,f,a,null,null,(b,w,x,S,C)=>czt(b,w,S,C,this._upVectorAlignment),i);return m.alignedSampledElevation=0,m.needsElevationUpdates=mx(i.mode),m}};function pje(t,e,r){const{origin:i,positions:n}=t;let s=t.offset;switch(e){default:case Qy.World:for(const o of t.vertices)rs[0]=n[s++]+i[0],rs[1]=n[s++]+i[1],rs[2]=n[s++]+i[2],r.worldUpAtPosition(rs,rs),o.setFrameFromUpVector(rs);break;case Qy.Path:rs[0]=n[s]+i[0],rs[1]=n[s+1]+i[1],rs[2]=n[s+2]+i[2],r.worldUpAtPosition(rs,rs),b8t(t,rs)}}function uTe(t,e,r){switch(t){case"symbol-value":return r;case"proportional":return e;default:return t}}function lzt(t,e,r,i){let n=0;const{origin:s,vertices:o,positions:a,positionsES:l}=t,c=t.offset+3*o.length;for(let u=t.offset;u<c;u+=3)se(rs,l[u],l[u+1],l[u+2]),r(rs,RZ),n+=RZ.sampledElevation,rs[0]=a[u]+s[0],rs[1]=a[u+1]+s[1],rs[2]=a[u+2]+s[2],i.setAltitude(rs,RZ.z),a[u]=rs[0]-s[0],a[u+1]=rs[1]-s[1],a[u+2]=rs[2]-s[2];return t.updatePathVertexInformation(),n/o.length}function czt(t,e,r,i,n){const s=t.stageObject,o=s.geometries;let a=0;for(const l of o){if(!KBe(l))continue;const c=l.path,u=c.builder.path;a+=lzt(u,e,r,i),n!==Qy.World&&pje(u,n,i),c.onPathChanged(l),l.invalidateBoundingInfo(),s.geometryVertexAttrsUpdated(l)}return a/o.length}const rs=A(),RZ=new DF;function uzt(t,e,r,i,n=1){if(r.isGeographic&&i===at.Global){const c=sl(e.length),u=e.length,h=Xr(r);for(let f=0;f<u;f+=3)L7(e,f,c,f,h);e=c}Or(po,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<e.length;c+=3)po[0]=Math.min(po[0],e[c]),po[1]=Math.min(po[1],e[c+1]);const s=po[0]%n,o=po[1]%n,a=po[0]-s,l=po[1]-o;for(let c=0;c<e.length;c+=3){const u=c/3*4;t[u]=(e[c]-a)/n,t[u+1]=(e[c+1]-l)/n,t[u+2]=a/n,t[u+3]=l/n}}function fje(t,e,r,i,n=1){se(cS,1,0,0),se(uS,0,1,0),se(XC,0,0,1),pzt(OZ,r),dzt(r,dTe)&&hzt(dTe,cS,uS,XC,i,OZ),Or(po,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),Or(dS,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let u=0;u<r.length;u+=3){se(WC,r[u],r[u+1],r[u+2]);const h=ye(cS,WC),f=ye(uS,WC);po[0]=Math.min(po[0],h),po[1]=Math.min(po[1],f),dS[0]=Math.max(dS[0],h),dS[1]=Math.max(dS[1],f)}const s=ye(XC,OZ);PZ(F1,po[0],po[1],s,cS,uS,XC),PZ(hS,dS[0],po[1],s,cS,uS,XC),PZ(pS,po[0],dS[1],s,cS,uS,XC),ve(hS,hS,F1),ce(hS,hS,.5),ve(pS,pS,F1),ce(pS,pS,.5),ge(F1,F1,hS),ge(F1,F1,pS);const o=po[0]%n,a=po[1]%n,l=po[0]-o,c=po[1]-a;for(let u=0;u<r.length;u+=3){se(WC,r[u],r[u+1],r[u+2]);const h=u/3,f=4*h;t[f]=(ye(cS,WC)-l)/n,t[f+1]=(ye(uS,WC)-c)/n,t[f+2]=l/n,t[f+3]=c/n;const m=9*h;for(let g=0;g<3;g++)e[m+g]=F1[g],e[m+g+3]=hS[g],e[m+g+6]=pS[g]}}const OZ=A(),WC=A(),dTe=oi(),cS=A(),uS=A(),XC=A(),po=Qe(),dS=Qe(),F1=A(),hS=A(),pS=A();function dzt(t,e){const r=t.length/3-1;return YFe(t,e,0,Math.floor(r/3),Math.floor(r*(2/3)))}function hzt(t,e,r,i,n,s){n!=null?(n.basisMatrixAtPosition(s,zg),se(N6,zg[0],zg[1],zg[2]),se(F6,zg[4],zg[5],zg[6]),se(AZ,zg[8],zg[9],zg[10])):(se(N6,1,0,0),se(F6,0,1,0),se(AZ,0,0,1));const o=t;ye(o,AZ)<0&&ce(o,o,-1),oe(i,o);const a=ye(o,F6),l=ye(o,N6);Math.abs(a)<Math.abs(l)?(id(e,N6,o,-l),Se(e,e),Lt(r,e,o),Se(r,r),ce(r,r,-1)):(id(r,F6,o,-a),Se(r,r),Lt(e,r,o),Se(e,e))}const zg=Me(),N6=A(),F6=A(),AZ=A();function pzt(t,e){se(f$,0,0,0);for(let r=0;r<e.length-3;r+=3)f$[0]+=e[r],f$[1]+=e[r+1],f$[2]+=e[r+2];ce(t,f$,1/(e.length/3-1))}const f$=A();function PZ(t,e,r,i,n,s,o){se(t,e*n[0]+r*s[0]+i*o[0],e*n[1]+r*s[1]+i*o[1],e*n[2]+r*s[2]+i*o[2])}function fzt(t){const e=new jr,{vertex:r,fragment:i,attributes:n,varyings:s}=e;gd(r,t),e.include(nu,t),e.include(WE,t),e.include(o_,t),e.include(PF,t),n.add(O.POSITION,"vec3"),t.vvColor&&n.add(O.COLORFEATUREATTRIBUTE,"float"),s.add("vColor","vec4"),s.add("vpos","vec3");const o=t.hasMultipassTerrain&&(t.output===q.Color||t.output===q.Alpha);o&&s.add("depth","float"),r.uniforms.add(new Cr("eColor",c=>c.color));const a=t.output===q.Depth;a&&(e.include(V_,t),hE(e),cx(e)),r.code.add(T`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${t.hasVertexColors?"vColor *= eColor;":t.vvColor?"vColor = eColor * interpolateVVColor(colorFeatureAttribute);":"vColor = eColor;"}
      ${o?"depth = (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${a?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),e.include(as,t),o&&e.include(Mh,t),i.include(R0);const l=t.output===q.Highlight;return l&&e.include(s1,t),i.code.add(T`
  void main() {
    discardBySlice(vpos);
    ${o?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = vColor;

    ${t.output===q.ObjectAndLayerIdColor?T`fColor.a = 1.0;`:""}

    if (fColor.a < ${T.float(Ma)}) {
      discard;
    }

    ${t.output===q.Alpha?T`fragColor = vec4(fColor.a);`:""}

    ${t.output===q.Color?T`fragColor = highlightSlice(fColor, vpos); ${t.transparencyPassType===kt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
    ${l?T`outputHighlight();`:""};
    ${t.output===q.Depth?T`outputDepth(linearDepth);`:""};
    ${t.output===q.ObjectAndLayerIdColor?T`outputObjectAndLayerIdColor();`:""}
  }
  `),e}const mzt=Object.freeze(Object.defineProperty({__proto__:null,build:fzt},Symbol.toStringTag,{value:"Module"}));let mje=class gje extends si{initializeProgram(e){return new Kr(e.rctx,gje.shader.get().build(this.configuration),Br)}_createPipeline(e,r){const i=this.configuration,n=e===kt.NONE,s=e===kt.FrontFace;return Qt({blending:i.output!==q.Color&&i.output!==q.Alpha||!i.transparent?null:n?bh:o1(e),culling:_H(i.cullFace),depthTest:{func:Px(e)},depthWrite:(n||s)&&i.writeDepth?fu:null,colorWrite:hr,stencilWrite:i.hasOccludees?m0:null,stencilTest:i.hasOccludees?r?vx:Mx:null,polygonOffset:n||s?i.polygonOffset?gzt:null:VH(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0),this._createPipeline(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};mje.shader=new Jr(mzt,()=>le(()=>import("./ColorMaterial.glsl-56cd186a.js"),[]));const gzt={factor:1,units:1};let qa=class extends tl{constructor(){super(...arguments),this.output=q.Color,this.cullFace=Hi.None,this.transparencyPassType=kt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.transparent=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.objectAndLayerIdColorInstanced=!1,this.vvColor=!1}};d([X({count:q.COUNT})],qa.prototype,"output",void 0),d([X({count:Hi.COUNT})],qa.prototype,"cullFace",void 0),d([X({count:kt.COUNT})],qa.prototype,"transparencyPassType",void 0),d([X()],qa.prototype,"hasSlicePlane",void 0),d([X()],qa.prototype,"hasVertexColors",void 0),d([X()],qa.prototype,"transparent",void 0),d([X()],qa.prototype,"polygonOffset",void 0),d([X()],qa.prototype,"enableOffset",void 0),d([X()],qa.prototype,"writeDepth",void 0),d([X()],qa.prototype,"hasOccludees",void 0),d([X()],qa.prototype,"hasMultipassTerrain",void 0),d([X()],qa.prototype,"cullAboveGround",void 0),d([X()],qa.prototype,"objectAndLayerIdColorInstanced",void 0),d([X()],qa.prototype,"vvColor",void 0),d([X({constValue:!0})],qa.prototype,"hasVvInstancing",void 0),d([X({constValue:!1})],qa.prototype,"vvSize",void 0),d([X({constValue:!1})],qa.prototype,"vvOpacity",void 0);let hTe=class extends hpe{constructor(e){super(e,new vzt),this.supportsEdges=!0,this._configuration=new qa}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<UH,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===q.Color||r===q.Alpha||r===q.Highlight||r===q.Depth&&this.parameters.writeLinearDepth||r===q.ObjectAndLayerIdColor?e===_e.DRAPED_MATERIAL?!0:r===q.Highlight?e===_e.OPAQUE_MATERIAL:e===(this.parameters.transparent?this.parameters.writeDepth?_e.TRANSPARENT_MATERIAL:_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:_e.OPAQUE_MATERIAL):!1}createGLMaterial(e){return new yzt(e)}createBufferWriter(){const e=On().vec3f(O.POSITION);return he("enable-feature:objectAndLayerId-rendering")&&e.vec4u8(O.OBJECTANDLAYERIDCOLOR),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),new J3(e)}},yzt=class extends Rx{_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==q.Color&&this._output!==q.Alpha||this._updateOccludeeState(e),this.ensureTechnique(mje,e)}},vzt=class extends $F{constructor(){super(...arguments),this.color=Wy,this.transparent=!1,this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Hi.None,this.hasOccludees=!1}};var Aa;(function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical",t[t.Cross=2]="Cross",t[t.ForwardDiagonal=3]="ForwardDiagonal",t[t.BackwardDiagonal=4]="BackwardDiagonal",t[t.DiagonalCross=5]="DiagonalCross",t[t.COUNT=6]="COUNT"})(Aa||(Aa={}));const Ene=.70710678118,pTe=Ene,_zt=.08715574274;function bzt(t){const e=new jr,r=t.hasMultipassTerrain&&(t.output===q.Color||t.output===q.Alpha),{vertex:i,fragment:n,attributes:s,varyings:o}=e;gd(i,t),e.include(nu,t),e.include(WE,t),e.include(o_,t),t.draped?i.uniforms.add(new Ye("worldToScreenRatio",(c,u)=>1/u.screenToPCSRatio)):s.add(O.BOUNDINGRECT,"mat3"),s.add(O.POSITION,"vec3"),s.add(O.UVMAPSPACE,"vec4"),t.vvColor&&s.add(O.COLORFEATUREATTRIBUTE,"float"),o.add("vColor","vec4"),o.add("vpos","vec3"),o.add("vuv","vec2"),r&&o.add("depth","float"),i.uniforms.add(new Cr("uColor",c=>c.color));const a=t.style===Aa.ForwardDiagonal||t.style===Aa.BackwardDiagonal||t.style===Aa.DiagonalCross;a&&i.code.add(T`
      const mat2 rotate45 = mat2(${T.float(Ene)}, ${T.float(-pTe)},
                                 ${T.float(pTe)}, ${T.float(Ene)});
    `),t.draped||(hg(i,t),i.uniforms.add(new Ye("worldToScreenPerDistanceRatio",(c,u)=>1/u.camera.perScreenPixelRatio)),i.code.add(T`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),i.code.add(T`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),i.code.add(T`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${T.float(_zt)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `)),i.code.add(T`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${a?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${a?" * rotate45":""};

      ${t.draped?"":T`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${T.float(t.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);const l=t.output===q.Depth;return l&&(e.include(V_,t),hE(e),cx(e)),i.code.add(T`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${r?"depth = (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      ${t.hasVertexColors?"vColor *= uColor;":t.vvColor?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      gl_Position = ${l?T`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:T`transformPosition(proj, view, vpos);`}
    }
  `),e.include(as,t),n.include(R0),t.draped&&n.uniforms.add(new Ye("texelSize",(c,u)=>1/u.camera.pixelRatio)),t.output===q.Highlight&&e.include(s1,t),r&&e.include(Mh,t),t.output!==q.Highlight&&(n.code.add(T`
      const float lineWidth = ${T.float(t.lineWidth)};
      const float spacing = ${T.float(t.patternSpacing)};
      const float spacingINV = ${T.float(1/t.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),t.draped||n.code.add(T`const int maxSamples = 5;
float sampleAA(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`)),n.code.add(T`
    void main() {
      discardBySlice(vpos);
      ${r?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = vColor;
      color = highlightSlice(color, vpos);

      ${t.output!==q.Highlight?T`color.a *= ${wzt(t)};`:""}

      ${t.output===q.ObjectAndLayerIdColor?T`color.a = 1.0;`:""}

      if (color.a < ${T.float(Ma)}) {
        discard;
      }

      ${t.output===q.Alpha?T`fragColor = vec4(color.a);`:""}

      ${t.output===q.Color?T`fragColor = color; ${t.transparencyPassType===kt.Color?"fragColor = premultiplyAlpha(fragColor);":""}`:""}
      ${t.output===q.Highlight?T`outputHighlight();`:""}
      ${t.output===q.Depth?T`outputDepth(linearDepth);`:""};
    }
  `),e}function wzt(t){function e(r){return t.draped?T`coverage(vuv.${r}, texelSize)`:T`sampleAA(vuv.${r})`}switch(t.style){case Aa.ForwardDiagonal:case Aa.Horizontal:return e("y");case Aa.BackwardDiagonal:case Aa.Vertical:return e("x");case Aa.DiagonalCross:case Aa.Cross:return T`
        1.0 - (1.0 - ${e("x")}) * (1.0 - ${e("y")})
      `;default:return"0.0"}}const xzt=Object.freeze(Object.defineProperty({__proto__:null,build:bzt},Symbol.toStringTag,{value:"Module"}));let yje=class vje extends si{initializeProgram(e){return new Kr(e.rctx,vje.shader.get().build(this.configuration),_je)}_setPipelineState(e,r){const i=this.configuration,n=e===kt.NONE,s=e===kt.FrontFace;return Qt({blending:i.output===q.Color||i.output===q.Alpha?n?bh:o1(e):null,culling:_H(i.cullFace),depthTest:{func:Px(e)},depthWrite:n?i.writeDepth?fu:null:kH(e),colorWrite:hr,stencilWrite:i.hasOccludees?m0:null,stencilTest:i.hasOccludees?r?vx:Mx:null,polygonOffset:n||s?i.polygonOffset?Szt:null:VH(i.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e,r){return r?this._occludeePipelineState:super.getPipelineState(e,r)}};yje.shader=new Jr(xzt,()=>le(()=>import("./Pattern.glsl-924b7806.js"),[]));const Szt={factor:1,units:1};let Wo=class extends tl{constructor(){super(...arguments),this.output=q.Color,this.cullFace=Hi.None,this.transparencyPassType=kt.NONE,this.hasSlicePlane=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.writeDepth=!0,this.hasOccludees=!1,this.enableOffset=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.vvColor=!1}};d([X({count:q.COUNT})],Wo.prototype,"output",void 0),d([X({count:Hi.COUNT})],Wo.prototype,"cullFace",void 0),d([X({count:Aa.COUNT})],Wo.prototype,"style",void 0),d([X({count:kt.COUNT})],Wo.prototype,"transparencyPassType",void 0),d([X()],Wo.prototype,"hasSlicePlane",void 0),d([X()],Wo.prototype,"hasVertexColors",void 0),d([X()],Wo.prototype,"polygonOffset",void 0),d([X()],Wo.prototype,"writeDepth",void 0),d([X()],Wo.prototype,"hasOccludees",void 0),d([X()],Wo.prototype,"patternSpacing",void 0),d([X()],Wo.prototype,"lineWidth",void 0),d([X()],Wo.prototype,"enableOffset",void 0),d([X()],Wo.prototype,"draped",void 0),d([X()],Wo.prototype,"hasMultipassTerrain",void 0),d([X()],Wo.prototype,"cullAboveGround",void 0),d([X()],Wo.prototype,"vvColor",void 0),d([X({constValue:!1})],Wo.prototype,"hasVvInstancing",void 0),d([X({constValue:!1})],Wo.prototype,"vvSize",void 0),d([X({constValue:!1})],Wo.prototype,"vvOpacity",void 0);const _je=new Map([[O.POSITION,0],[O.COLOR,3],[O.UVMAPSPACE,4],[O.COLORFEATUREATTRIBUTE,5],[O.BOUNDINGRECT,6]]);let zpe=class extends hpe{constructor(e){super(e,new Czt),this.supportsEdges=!0,this._vertexAttributeLocations=_je,this._configuration=new Wo}getConfiguration(e,r){return this._configuration.output=e,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.style=this.parameters.style,this._configuration.patternSpacing=this.parameters.patternSpacing,this._configuration.lineWidth=this.parameters.lineWidth,this._configuration.draped=this.parameters.draped,this._configuration.transparencyPassType=r.transparencyPassType,this._configuration.enableOffset=r.camera.relativeElevation<UH,this._configuration.hasMultipassTerrain=r.multipassTerrain.enabled,this._configuration.cullAboveGround=r.multipassTerrain.cullAboveGround,this._configuration.vvColor=!!this.parameters.vvColor,this._configuration}requiresSlot(e,r){return r===q.Color||r===q.Alpha||r===q.Highlight||r===q.Depth&&this.parameters.writeLinearDepth?e===_e.DRAPED_MATERIAL?!0:r===q.Highlight?e===_e.OPAQUE_MATERIAL:e===(this.parameters.writeDepth?_e.TRANSPARENT_MATERIAL:_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):!1}createGLMaterial(e){return new Tzt(e)}createBufferWriter(){const e=On().vec3f(O.POSITION).vec4f(O.UVMAPSPACE);return this.parameters.draped||e.mat3f(O.BOUNDINGRECT),this.parameters.vvColor?e.f32(O.COLORFEATUREATTRIBUTE):e.vec4u8(O.COLOR),new Ezt(e)}},Tzt=class extends Rx{_updateParameters(e){return this.ensureTechnique(yje,e)}_updateOccludeeState(e){e.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:e.hasOccludees})}beginSlot(e){return this._output!==q.Color&&this._output!==q.Alpha||this._updateOccludeeState(e),this._updateParameters(e)}},Ezt=class extends J3{write(e,r,i,n,s){for(const o of this.vertexBufferLayout.fields.keys()){const a=i.vertexAttributes.get(o),l=i.indices.get(o);if(a&&l)switch(o){case O.UVMAPSPACE:{It(a.size===4);const c=n.getField(o,dg);c&&YP(l,a.data,c,s);break}case O.BOUNDINGRECT:{It(a.size===9);const c=n.getField(o,ux);c&&this.writeBoundingRect(l,a.data,e,c,s);break}default:I8e(o,a,l,e,r,n,s)}}}writeBoundingRect(e,r,i,n,s){const o=i,a=n.typedBuffer,l=n.typedBufferStride,c=e.length;s*=l;for(let u=0;u<c;++u){const h=9*e[u],f=r[h],m=r[h+1],g=r[h+2];a[s]=o[0]*f+o[4]*m+o[8]*g+o[12],a[s+1]=o[1]*f+o[5]*m+o[9]*g+o[13],a[s+2]=o[2]*f+o[6]*m+o[10]*g+o[14];for(let y=3;y<9;++y)a[s+y]=r[h+y];s+=l}}},Czt=class extends $F{constructor(){super(...arguments),this.color=nr(1,1,1,1),this.writeDepth=!0,this.writeLinearDepth=!1,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=Hi.None,this.hasOccludees=!1,this.style=Aa.Cross,this.patternSpacing=10,this.lineWidth=1,this.draped=!0}};function Rzt(t,e){const r=(t==null?void 0:t.pattern)??null;return r==null?new hTe(e):r.style==="none"||r.style==="solid"?(r.style==="none"&&(e.color=nr(0,0,0,0),e.transparent=!0),new hTe(e)):(e.style=Ozt(r.style),new zpe(e))}function Ozt(t){switch(t){case"horizontal":return Aa.Horizontal;case"vertical":return Aa.Vertical;case"cross":return Aa.Cross;case"forward-diagonal":return Aa.ForwardDiagonal;case"backward-diagonal":return Aa.BackwardDiagonal;case"diagonal-cross":return Aa.DiagonalCross;default:return}}function Azt(t){return t.material instanceof zpe&&!t.material.parameters.draped}function Pzt(t,e){if(Azt(t)){const r=t.vertexAttributes.get(O.POSITION).data,i=t.getMutableAttribute(O.UVMAPSPACE).data,n=t.getMutableAttribute(O.BOUNDINGRECT).data;fje(i,n,r,e)}}function Mzt(t,e,r,i,n){const s=Nze(t,e,r,i,n),o=t.stageObject.geometries;for(const a of o)Pzt(a,n);return s}const $zt=["polyline","polygon","extent"],fTe=new MF({size:!1,color:!0,rotation:!1,opacity:!1});let bje=class wje extends A0{constructor(e,r,i,n){super(e,r,i,n),this._needsUV=!1,this._hasOutline=!1}async doLoad(){this._fastUpdates=ZP(this._context.renderer,fTe)}_ensureMaterials(){this._ensureFillMaterial(),this._ensureOutlineMaterial()}_ensureFillMaterial(){var i,n,s;if(this._material!=null)return;const e=(n=(i=this.symbolLayer)==null?void 0:i.material)==null?void 0:n.color,r=this._getCombinedOpacityAndColor(e);this._material=Rzt(this.symbolLayer,{color:r,transparent:r[3]<1||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,draped:this.draped,hasSlicePlane:this._context.slicePlaneEnabled,...(s=this._fastUpdates)==null?void 0:s.materialParameters}),this._needsUV=this._material instanceof zpe,this._context.stage.add(this._material)}_ensureOutlineMaterial(){const e=this.symbolLayer.outline;if(this._outlineMaterial||!this._isValidOutline(e))return;this._hasOutline=!0;const r=i=>{const n=wBe(e.pattern);return new rA({width:i,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:n,stippleScaleWithLineWidth:!0,cap:bne(e.patternCap||"butt")})};this._outlineMaterial=r(Es(e.size)),this._context.stage.add(this._outlineMaterial)}_isValidOutline(e){return e!=null&&e.size!=null&&e.size>0&&e.color!=null&&(e.pattern==null||e.pattern.type!=="style"||e.pattern.style!=="none")}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null,this._context.stage.remove(this._outlineMaterial),this._outlineMaterial=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,$zt,this.symbolLayer.type))return null;const i=this._getVertexOpacityAndColor(e.renderingInfo,255),n=this.setGraphicElevationContext(r,new yg);return this.ensureDrapedStatus(n.mode==="on-the-ground"),this._ensureMaterials(),this.draped?this._createAsOverlay(r,i):this._createAs3DShape(r,i,n)}applyRendererDiff(e,r){for(const i in e.diff){if(i!=="visualVariables"||!JP(this._fastUpdates,r,fTe))return Cs.RecreateSymbol;this._material&&this._material.setParameters(this._fastUpdates.materialParameters)}return Cs.FastUpdate}layerOpacityChanged(){var e,r;if(this._material!=null){const i=this._material.parameters.color,n=(r=(e=this.symbolLayer)==null?void 0:e.material)==null?void 0:r.color,s=this._getCombinedOpacity(n);this._material.setParameters({color:[i[0],i[1],i[2],s],transparent:s<1||this.needsDrivenTransparentPass})}if(this._outlineMaterial!=null){const i=this._outlineMaterial.parameters.color;this._outlineMaterial.setParameters({color:[i[0],i[1],i[2],this._getOutlineOpacity()]})}}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=LF(wje.elevationModeChangeTypes,i,n);if(s!==Xn.UPDATE)return s;const o=mf(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){if(this._material&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),this._outlineMaterial){const e={hasSlicePlane:this._context.slicePlaneEnabled};this._outlineMaterial.setParameters(e)}return!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var u;const n=e4(e.geometry);if(!n)return null;const s=wpe(n,this._context.elevationProvider,this._context.renderCoordsHelper,i),o=new Izt(s,r,this._context.layer.uid,e.uid),a=o.renderData.position.length/3;if(this._needsUV&&(o.uvMapSpace=Dn(4*a,!0),o.boundingRect=sl(9*a,!0),fje(o.uvMapSpace,o.boundingRect,o.renderData.position,this._context.renderCoordsHelper)),o.objectAndLayerIdColor=(u=this._context.stage.renderView)==null?void 0:u.getObjectAndLayerIdColor(o),this._createAs3DShapeFill(e,o),this._hasOutline&&this._createAs3DShapeOutline(o),this._logGeometryCreationWarnings(o.renderData,n.rings,"rings","FillSymbol3DLayer"),o.outGeometries.length===0)return null;const l=new a1({geometries:o.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:e.uid}),c=new O0(this,l,o.outGeometries,null,null,Mzt,i);return c.alignedSampledElevation=o.renderData.sampledElevation,c.needsElevationUpdates=mf(i.mode),c}_createAs3DShapeFill(e,r){var n;const i=r.renderData.polygons;for(const{position:s,mapPositions:o,holeIndices:a,index:l,count:c}of i){if(this._context.clippingExtent!=null&&(en(Df),ph(Df,o),!km(Df,this._context.clippingExtent)))continue;const u=e3(o,a,3);if(u.length===0)continue;const h=(n=this._fastUpdates)==null?void 0:n.visualVariables.color,f=xxe({material:this._material,indices:u,mapPositions:o,attributeData:{position:s,color:h?null:r.color,colorFeature:h?Km(h.field,e):null,uvMapSpace:this._needsUV?MB(r.uvMapSpace,4*l,4*c):null,boundingRect:this._needsUV?Xp(r.boundingRect,9*l,9*c):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(f)}}_createAs3DShapeOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{mapPositions:n,position:s}=r[i];if(this._context.clippingExtent!=null&&(en(Df),ph(Df,n),!km(Df,this._context.clippingExtent)))continue;const o=wne(this._outlineMaterial,{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:n,attributeData:{position:s}},e.objectAndLayerIdColor);e.outGeometries.push(o)}}_createAsOverlay(e,r){var a;const i=e4(e.geometry);if(i==null)return null;this._material.renderPriority=this._renderPriority+this._renderPriorityStep/2,this._outlineMaterial!=null&&(this._outlineMaterial.renderPriority=this._renderPriority);const n=TVe(i,this._context.overlaySR),s=new Lzt(n,r,this._context.layer.uid,e.uid),o=s.renderData.position.length/3;return this._needsUV&&(s.uvMapSpace=Dn(4*o,!0),uzt(s.uvMapSpace,s.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode)),s.outBoundingBox=en(),s.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(s),this._createAsOverlayFill(e,s),this._hasOutline&&this._createAsOverlayOutline(s),this._logGeometryCreationWarnings(s.renderData,i.rings,"rings","FillSymbol3DLayer"),s.outGeometries.length===0?null:new nq(this,s.outGeometries,s.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayFill(e,r){var n;const i=r.renderData.polygons;for(const{position:s,holeIndices:o,index:a,count:l}of i){const c=en(Df);if(ph(c,s),!km(c,this._context.clippingExtent))continue;const u=e3(s,o,3);if(u.length===0)continue;MP(r.outBoundingBox,c);const h=(n=this._fastUpdates)==null?void 0:n.visualVariables.color,f=xxe({material:this._material,indices:u,attributeData:{position:s,color:h?null:r.color,colorFeature:h?Km(h.field,e):null,uvMapSpace:this._needsUV?MB(r.uvMapSpace,4*a,4*l):null,objectAndLayerIdColor:r.objectAndLayerIdColor}});r.outGeometries.push(new i3(f,r))}}_createAsOverlayOutline(e){if(!this._hasOutline)return;const r=e.renderData.outlines;for(let i=0;i<r.length;++i){const{position:n}=r[i];if(en(Df),ph(Df,n),!km(Df,this._context.clippingExtent))continue;MP(e.outBoundingBox,Df);const s=wne(this._outlineMaterial,{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:n}},e.objectAndLayerIdColor);e.outGeometries.push(new i3(s,e))}}_getOutlineOpacity(){var r,i;const e=(i=(r=this.symbolLayer)==null?void 0:r.outline)==null?void 0:i.color;return(this.draped?1:this._getLayerOpacity())*(e!=null?e.a:0)}_getOutlineColor(){var i,n;const e=(n=(i=this.symbolLayer)==null?void 0:i.outline)==null?void 0:n.color,r=this._getOutlineOpacity();return SD(e!=null?ht.toUnitRGB(e):null,r)}test(){return{...super.test(),createAsOverlay:(e,r)=>this._createAsOverlay(e,r),createAs3DShape:(e,r,i)=>this._createAs3DShape(e,r,i)}}};bje.elevationModeChangeTypes={definedChanged:Xn.RECREATE,staysOnTheGround:Xn.NONE,onTheGroundChanged:Xn.RECREATE};const Df=To();let Izt=class extends JH{constructor(e,r,i,n){super(e,i,n),this.color=r}},Lzt=class extends JH{constructor(e,r,i,n){super(e,i,n),this.color=r}};const Dzt="arial-unicode-ms",mTe="woff2",gTe=new Map,xje=new Set;let Nzt=class{constructor(e,r){this.fontFace=e,this.promise=r}};async function Fzt(t){const e=zzt(t),r=gTe.get(e);if(r)return r.promise;const i=new FontFace(t.family,`url('${Ti.fontsUrl}/woff2/${e}.${mTe}') format('${mTe}')`,{style:t.style,weight:t.weight}),n=document.fonts;if(n.has(i)&&i.status==="loading")return i.loaded;const s=i.load().then(()=>(n.add(i),i));return gTe.set(e,new Nzt(i,s)),xje.add(i),s}function kzt(t){return xje.has(t)}function Uzt(t){if(!t)return Dzt;const e=t.toLowerCase().split(" ").join("-");switch(e){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return e}}function zzt(t){const e=Vzt(t)+Bzt(t);return Uzt(t.family)+(e.length>0?e:"-regular")}function Vzt(t){if(!t.weight)return"";switch(t.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function Bzt(t){if(!t.style)return"";switch(t.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}let Sje=class Tje{constructor(e){this.definition=e,this.key=JSON.stringify(e),this.haloSize=Math.round(e.halo.size),this.textStyle=this._colorToRGBA(e.color),this.haloStyle=this._colorToRGB(e.halo.color),this.backgroundStyle=e.background.color[3]!==0?this._colorToRGBA(e.background.color):null}fontString(e){const r=this.definition.font;return`${r.style} ${r.weight} ${e}px ${r.family}, sans-serif`}_colorToRGB(e){return`rgb(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()})`}_colorToRGBA(e){return`rgba(${e.slice(0,3).map(r=>Math.floor(255*r)).toString()},${e[3]})`}static async fromSymbol(e,r){var f,m,g,y,_;const i=(f=e==null?void 0:e.material)==null?void 0:f.color,n=ht.toUnitRGBA(i)??Wy,s=e.size!=null?Es(e.size):12,o=e.lineHeight,a=e.background!=null?ht.toUnitRGBA(e.background.color):Wy,l={family:((m=e.font)==null?void 0:m.family)??"sans-serif",decoration:((g=e.font)==null?void 0:g.decoration)??"none",weight:((y=e.font)==null?void 0:y.weight)??"normal",style:((_=e.font)==null?void 0:_.style)??"normal"},c=e.halo,u=c!=null&&c.color!=null&&c.size>0?{size:Es(c.size),color:ht.toUnitRGBA(c.color)}:{size:0,color:Wy},h=new Tje({color:n,size:s,background:{color:a,padding:e.background!=null?[.65*s,.5*s]:[0,0],borderRadius:e.background!=null?s*(6/16):0},lineSpacingFactor:o,font:l,halo:u,pixelRatio:r});if(e.font){let b=!1;const w=h.fontString(s);try{b=(await document.fonts.load(w)).some(x=>!kzt(x))}catch{re.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${w}'. Some text symbology may be rendered using the default browser font.`)}if(!b&&!jzt.has(e.font.family))try{await Fzt(e.font)}catch{}}return h}};const jzt=new Set(["Arial","Times New Roman","Courier New","serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);let Gzt=class{constructor(e,r,i){this._renderer=new pBe(e,r,i)}get key(){return this._renderer.key}get baselineAnchorY(){return 1-this._renderer.firstRenderedBaselinePosition/this._renderer.renderedHeight}get displayWidth(){return this._renderer.displayWidth}get displayHeight(){return this._renderer.displayHeight}create(){const e=vne(Hzt,this._renderer.renderedWidth,this._renderer.renderedHeight),r=e.getContext("2d");return r.save(),this._renderer.render(r,0,0),r.restore(),new qE(e,{wrap:{s:ir.CLAMP_TO_EDGE,t:ir.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0})}};const Hzt={canvas:null},qzt=[0,0,1];let Wzt=class extends A0{constructor(e,r,i,n){super(e,r,i,n),this._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1},this.ensureDrapedStatus(!1)}async doLoad(){if(!this._drivenProperties.size){const e=GH(this.symbolLayer.size);if(e)throw new H("graphics3dtextsymbollayer:invalid-size",e)}await this._createTextRenderParameters()}async _createTextRenderParameters(){const e=this._context.graphicsCoreOwner.view.state.rasterPixelRatio;this._textRenderParameters=await Sje.fromSymbol(this.symbolLayer,e)}destroy(){super.destroy()}createGraphics3DGraphic(e){const r=e.graphic,i=KN(r.geometry);if(i==null)return this.logger.warn(`unsupported geometry type for text symbol: ${r.geometry.type}`),null;const n=this.symbolLayer.text;if(n==null||n==="")return null;const s=Xue(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(s!=null&&!rFe(this.symbolLayer))return this.logger.errorOncePerTick(`Callouts and vertical offset on text symbols are currently only supported with 'center' horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;const o=new Ize(s,this.symbolLayer.horizontalAlignment,_kt(this.symbolLayer.verticalAlignment));return this._createAs3DShape(r,i,n,o)}createLabel(e,r,i,n){const s=e.graphic,o=KN(s.geometry);if(o==null)return this.logger.warn(`unsupported geometry type for label: ${s.geometry.type}`),null;const a=r.text;return!a||/^\s+$/.test(a)?null:this._createAs3DShape(s,o,a,r,i,n)}setGraphicElevationContext(e,r,i=0){const n=super.setGraphicElevationContext(e,r);return n.addOffsetRenderUnits(i),n}layerOpacityChanged(){return this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer"),!1}layerElevationInfoChanged(e,r){return yTe(e,r,(i,n)=>{this.updateGraphicElevationContext(n,i)}),Xn.UPDATE}slicePlaneEnabledChanged(e,r){return yTe(e,r,i=>{for(const n of i.stageObject.geometries)n.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})}),!0}physicalBasedRenderingChanged(){return!0}get pixelRatioChanged(){return!1}updateGraphicElevationContext(e,r){const i=r.elevationContext;this.setGraphicElevationContext(e,i,r.metadata!=null?r.metadata.elevationOffset:0),r.needsElevationUpdates=mf(i.mode)||i.mode==="absolute-height"}_defaultElevationInfoNoZ(){return Yzt}_createAs3DShape(e,r,i,n,s,o){var P;const a=this.setGraphicElevationContext(e,new yg,n.elevationOffset),l=((P=e.geometry)==null?void 0:P.type)==="polyline",c=e.uid;let u=null,h=null;if(o==null){const D=mBe(n.horizontalPlacement);u=new Gzt(i,D,this._textRenderParameters);let L=null;if(this._context.sharedResources.textures!=null){h=this._context.sharedResources.textures.fromData(u.key,()=>u.create(),()=>{L!=null&&L.release()});const k=this._context.stage.renderView.textureRepository.acquire(h.texture.id);if(k==null||Dh(k))return h.release(),null;L=k}}const f=Xzt(u,n),m={occlusionTest:!0,screenOffset:n.screenOffset,anchorPosition:f,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:n.centerOffsetUnits,drawInSecondSlot:!0};if(o!=null?m.textureId=o.id:h!=null&&(m.textureId=h.texture.id),n.verticalOffset!=null){const{screenLength:D,minWorldLength:L,maxWorldLength:k}=n.verticalOffset;m.verticalOffset={screenLength:Es(D),minWorldLength:L||0,maxWorldLength:k??1/0}}if(this._context.screenSizePerspectiveEnabled){const{screenSizePerspectiveSettings:D,screenSizePerspectiveSettingsLabels:L}=this._context.sharedResources;m.screenSizePerspective=L.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]),m.screenSizePerspectiveAlignment=D}let g;if(l&&(m.shaderPolygonOffset=1e-4),m.hasSlicePlane=this._context.slicePlaneEnabled,s!=null){const D=JSON.stringify(m);g=s.get(D),g==null&&(g=new KP(m),s.add(D,g))}else g=new KP(m);const y=n.translation,_=u?Nr(u.displayWidth,u.displayHeight):cg,b=n.centerOffset,w=Sie(g,qzt,y,null,_,b,[0,0],null),x=Jhe(this._context,r,w,a,c);if(x==null)return null;const S=new O0(this,x.object,[w],s==null?[g]:null,h,O2,a);S.alignedSampledElevation=x.sampledElevation,S.needsElevationUpdates=mf(a.mode)||a.mode==="absolute-height";const{displayWidth:C,displayHeight:E}=u??n;S.getScreenSize=(D=Qe())=>(D[0]=C,D[1]=E,D);const R=new jze(n.elevationOffset,i);return S.metadata=R,JN(S,r,this._context.elevationProvider),S}};function yTe(t,e,r){t&&t.forEach(i=>{const n=e(i);n!=null&&r(n,i.graphic)})}function Xzt(t,e){if(e.verticalPlacement==="baseline"){const i=gkt[e.horizontalPlacement],n=t!=null?t.baselineAnchorY:0;return Nr(i,n)}const r=vkt(e.horizontalPlacement,e.verticalPlacement);return Nz[r]}const Yzt={mode:"relative-to-ground",offset:0},Zzt={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}},Jzt=["polyline","polygon","extent"];let Cne=class nT extends A0{constructor(e,r,i,n){super(e,r,i,n)}async doLoad(){}destroy(){super.destroy(),this._context.stage.remove(this._material),this._material=null}createGraphics3DGraphic(e){const r=e.graphic;if(!this._validateGeometry(r.geometry,Jzt,this.symbolLayer.type))return null;const i=this.setGraphicElevationContext(r,new yg);return this.ensureDrapedStatus(i.mode==="on-the-ground"),this.ensureMaterial(),this.draped?this._createAsOverlay(r):this._createAs3DShape(r,i,r.uid)}ensureMaterial(){if(this._material!=null)return;const e=new pVe,r=this.symbolLayer.color;r!=null&&(e.color=ht.toUnitRGBA(r));const i=this._getCombinedOpacity(r,{hasIntrinsicColor:!0});e.color=[e.color[0],e.color[1],e.color[2],i],e.transparent=i<1||this.needsDrivenTransparentPass,e.waveDirection=this.symbolLayer.waveDirection!=null?nT.headingVectorFromAngle(this.symbolLayer.waveDirection):Nr(0,0);const n=this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize,s=Zzt[n];e.waveStrength=s.waveStrength,e.waveTextureRepeat=s.textureRepeat,e.waveVelocity=s.waveVelocity,e.flowStrength=s.perturbationStrength,e.hasSlicePlane=this._context.slicePlaneEnabled,e.isDraped=this.draped,this._material=new hVe(e),this._context.stage.add(this._material)}layerOpacityChanged(){if(this._material==null)return;const e=this._material.parameters.color,r=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0}),i=r<1||this.needsDrivenTransparentPass;this._material.setParameters({color:[e[0],e[1],e[2],r],transparent:i})}layerElevationInfoChanged(e,r,i){const n=this._elevationContext.mode,s=LF(nT.elevationModeChangeTypes,i,n);if(s!==Xn.UPDATE)return s;const o=mf(n);return this.updateGraphics3DGraphicElevationInfo(e,r,()=>o)}slicePlaneEnabledChanged(){return this._material!=null&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled}),!0}physicalBasedRenderingChanged(){return!0}_createAs3DShape(e,r,i){var h;const n=e4(e.geometry);if(n==null)return null;const s=wpe(n,this._context.elevationProvider,this._context.renderCoordsHelper,r),o=s.position.length/3,a=sl(2*o);this._createUVCoordsFromVertices(a,s.mapPositions,o,this._context.elevationProvider.spatialReference);const l=new Kzt(s,a,this._context.layer.uid,e.uid);if(l.objectAndLayerIdColor=(h=this._context.stage.renderView)==null?void 0:h.getObjectAndLayerIdColor(l),this._create3DShapeGeometries(l),this._logGeometryCreationWarnings(l.renderData,n.rings,"rings","WaterSymbol3DLayer"),l.outGeometries.length===0)return null;const c=new a1({geometries:l.outGeometries,castShadow:!1,layerUid:this._context.layer.uid,graphicUid:i}),u=new O0(this,c,l.outGeometries,null,null,Nze,r);return u.alignedSampledElevation=l.renderData.sampledElevation,u.needsElevationUpdates=mf(r.mode),u}_createUVCoordsFromVertices(e,r,i,n){const s=Pc(n);xd(k1);for(let l=0;l<i;l++)Or(vTe,r[3*l],r[3*l+1]),SA(k1,vTe);eE(k1,k1,s);const o=k1[0]%nT.unitSizeOfTexture,a=k1[1]%nT.unitSizeOfTexture;k6[0]=k1[0]-o,k6[1]=k1[1]-a;for(let l=0;l<i;l++)e[2*l]=(r[3*l]*s-k6[0])/nT.unitSizeOfTexture,e[2*l+1]=(r[3*l+1]*s-k6[1])/nT.unitSizeOfTexture}_create3DShapeGeometries(e){const r=e.renderData.polygons,i=e.uvCoords;for(const{count:n,index:s,position:o,mapPositions:a,holeIndices:l}of r){if(this._context.clippingExtent!=null&&(en(fS),ph(fS,a),!km(fS,this._context.clippingExtent)))continue;const c=e3(a,l,3);if(c.length===0)continue;const u=Xp(i,2*s,2*n),h=Sxe({material:this._material,indices:c,mapPositions:a,attributeData:{position:o,uv0:u}},e.objectAndLayerIdColor);e.outGeometries.push(h)}}_createAsOverlay(e){var a;const r=e4(e.geometry);if(r==null)return null;this._material.renderPriority=this._renderPriority;const i=TVe(r,this._context.overlaySR),n=i.position.length/3,s=sl(2*n);this._createUVCoordsFromVertices(s,i.position,n,this._context.overlaySR);const o=new Qzt(i,s,this._context.layer.uid,e.uid);return o.objectAndLayerIdColor=(a=this._context.stage.renderView)==null?void 0:a.getObjectAndLayerIdColor(o),o.outBoundingBox=en(),this._createAsOverlayWater(o),this._logGeometryCreationWarnings(o.renderData,r.rings,"rings","WaterSymbol3DLayer"),o.outGeometries.length===0?null:new nq(this,o.outGeometries,o.outBoundingBox,this._context.drapeSourceRenderer)}_createAsOverlayWater(e){const r=e.uvCoords,i=e.renderData.polygons;for(const{position:n,holeIndices:s,index:o,count:a}of i){if(en(fS),ph(fS,n),!km(fS,this._context.clippingExtent))continue;MP(e.outBoundingBox,fS);const l=e3(n,s,3);if(l.length===0)continue;const c=Xp(r,2*o,2*a),u=Sxe({material:this._material,indices:l,attributeData:{position:n,uv0:c}},e.objectAndLayerIdColor);e.outGeometries.push(new i3(u,e))}}static headingVectorFromAngle(e){const r=Qe(),i=w7(e);return r[0]=Math.sin(i),r[1]=Math.cos(i),r}test(){return{...super.test(),create3DShape:e=>this._createAs3DShape(e.graphic,e.elevationContext,e.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}};Cne.unitSizeOfTexture=100,Cne.elevationModeChangeTypes={definedChanged:Xn.RECREATE,staysOnTheGround:Xn.NONE,onTheGroundChanged:Xn.RECREATE};const k6=Qe(),k1=lr(),vTe=Qe(),fS=To();let Kzt=class extends JH{constructor(e,r,i,n){super(e,i,n),this.uvCoords=r}},Qzt=class extends JH{constructor(e,r,i,n){super(e,i,n),this.uvCoords=r}};function e9t(t,e,r,i){var s;const n=((s=r9t[t.type])==null?void 0:s[e.type])||t9t[e.type];return n?new n(t,e,r,i):(re.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",`unknown symbol type ${e.type}`),null)}const t9t={icon:_ne,object:s8t,line:xBe,path:azt,fill:bje,extrude:HFt,text:Wzt,water:Cne},r9t={"mesh-3d":{fill:C6t}};let i9t=class extends Xhe{set symbol(e){this._symbol=e,e.symbolLayers.forEach((r,i)=>{const n=this.symbolLayers[i];n!=null&&(n.symbol=e,n.symbolLayer=r)})}get symbol(){return this._symbol}constructor(e,r,i){super(r.schedule),this._symbol=e,this._context=r,this._backgroundLayers=i,this._destroyed=!1,this.symbolLayers=new Array,this.referenced=0,this._extentPadding=0}async doLoad(e){let r=this._symbol.symbolLayers;this._extentPadding=0,this._backgroundLayers&&(r=this._backgroundLayers.concat(r));const i=r.length;for(;this.symbolLayers.length<r.length;)this.symbolLayers.push(null);this.symbolLayers.length=r.length;const n=[];for(let s=0;s<i;s++){const o=r.at(s);if(o.enabled===!1)continue;U6.renderPriority=1-(1+s)/i,U6.renderPriorityStep=1/i,U6.ignoreDrivers=o.ignoreDrivers;const a=e9t(this.symbol,o,this._context,U6),l=g7(e,()=>{this.symbolLayers[s]=null,a.destroy()});l&&n.push(l),this.symbolLayers[s]=a}if(await b7(this.symbolLayers,async(s,o)=>{if(s!=null)try{await s.load(),this._extentPadding+=Math.max(this._extentPadding,s.extentPadding)}catch{this.symbolLayers[o]=null}}),n.forEach(s=>s.remove()),vr(e),this.symbolLayers.length&&!this.symbolLayers.some(s=>!!s))throw new Error}getSymbolLayerSize(e){const r=this.symbolLayers[e];return r!=null?r.getCachedSize():null}get extentPadding(){return this._extentPadding}get symbologySnappingSupported(){return this.symbolLayers.some(e=>e!=null&&e.queryForSnapping)}createGraphics3DGraphic(e,r){const i=e.graphic,n=this.symbolLayers.map(o=>(o==null?void 0:o.createGraphics3DGraphic(e))??null),s=this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null;return new JDt(i,r||this,n,e.layer,s)}get complexity(){return Zhe(this.symbolLayers.map(e=>e!=null?e.complexity:null))}globalPropertyChanged(e,r){const i=this.symbolLayers.length;for(let n=0;n<i;n++){const s=this.symbolLayers[n],o=a=>{const l=a.layers[n];return l instanceof O0?l:null};if(s!=null&&!s.globalPropertyChanged(e,r,o))return!1}return!0}applyRendererDiff(e,r){return this.loadStatus!==rh.LOADED?Cs.RecreateSymbol:this.symbolLayers.reduce((i,n)=>i!==Cs.RecreateSymbol&&n!=null?Math.min(i,n.applyRendererDiff(e,r)):i,Cs.FastUpdate)}prepareSymbolPatch(e){if(this.loadStatus===rh.FAILED||e.diff.type!=="partial")return;const r=e.diff.diff;if(!r.symbolLayers||r.symbolLayers.type!=="partial")return;const i=r.symbolLayers.diff;this.symbolLayers.forEach((n,s)=>{if(n==null)return;const o=i[s];if(o){const a={diff:o,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};n.prepareSymbolLayerPatch(a),e.symbolStatePatches.push(...a.symbolLayerStatePatches),a.graphics3DGraphicPatches.length&&e.graphics3DGraphicPatches.push((l,c)=>{const u=l.layers[s];u!=null&&a.graphics3DGraphicPatches.forEach(h=>h(u,c))})}})}updateGeometry(e,r){return this._updateGeometryOrTransform(e,(i,n)=>i.updateGeometry(n,r))}updateTransform(e,r,i,n){return this._updateGeometryOrTransform(e,(s,o)=>s.updateTransform(o,r,i,n))}_updateGeometryOrTransform(e,r){for(let i=0;i<this.symbolLayers.length;i++){const n=this.symbolLayers[i];if(n==null)continue;const s=e.layers[i];if(!s||!r(n,s))return!1}return!0}onRemoveGraphic(e){for(let r=0;r<this.symbolLayers.length;r++){const i=this.symbolLayers[r];if(i==null)continue;const n=e.layers[r];n!=null&&i.onRemoveGraphic(n)}}getFastUpdateStatus(){let e=0,r=0,i=0;return this.symbolLayers.forEach(n=>{n!=null&&(n.loadStatus===rh.LOADING?e++:n.isFastUpdatesEnabled()?i++:r++)}),{loading:e,slow:r,fast:i}}async queryForSnapping(e,r,i,n){const s=this.symbolLayers.filter(_0).filter(a=>a.queryForSnapping!=null).map(a=>a.queryForSnapping(e,r,i,n)),o=await Promise.all(s);return vr(n),o.flat()}destroy(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{super.destroy();for(const e of this.symbolLayers)e!=null&&e.destroy();this.symbolLayers.length=0,this._destroyed=!0}}get destroyed(){return this._destroyed}};const U6=new KDt;let n9t=class extends Xhe{constructor(e,r,i){super(r),this.symbol=e,this._convert=i,this.symbologySnappingSupported=!1,this.graphics3DSymbol=null,this.referenced=0}getSymbolLayerSize(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getSymbolLayerSize(e):null}get symbolLayers(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.symbolLayers:[]}get extentPadding(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.extentPadding:0}async doLoad(e){const r=await this.symbol.fetchSymbol({signal:e});r.id=this.symbol.id,this.graphics3DSymbol=this._convert(r),this.graphics3DSymbol!=null&&await this.graphics3DSymbol.load()}createGraphics3DGraphic(e){return this.graphics3DSymbol!=null?this.graphics3DSymbol.createGraphics3DGraphic(e,this):null}get complexity(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.complexity:Yhe}globalPropertyChanged(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.globalPropertyChanged(e,r)}applyRendererDiff(e,r){return this.graphics3DSymbol!=null?this.graphics3DSymbol.applyRendererDiff(e,r):Cs.RecreateSymbol}prepareSymbolPatch(e){this.graphics3DSymbol!=null&&this.graphics3DSymbol.prepareSymbolPatch(e)}updateGeometry(e,r){return this.graphics3DSymbol!=null&&this.graphics3DSymbol.updateGeometry(e,r)}updateTransform(e,r,i,n){var s;return((s=this.graphics3DSymbol)==null?void 0:s.updateTransform(e,r,i,n))??!1}onRemoveGraphic(){}getFastUpdateStatus(){return this.graphics3DSymbol!=null?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}}destroy(){this.graphics3DSymbol!=null&&this.graphics3DSymbol.destroy(),this.graphics3DSymbol=void 0,super.destroy()}get destroyed(){return this.graphics3DSymbol===void 0}};function Vpe(t){return t instanceof n9t?t.graphics3DSymbol:t instanceof i9t?t:null}const n4=re.getLogger("esri.views.3d.layers.graphics.labelPlacement");function s9t(t){const e=f9t(t);if(e==null)return null;const r=o9t(t,e);if(r==null)return null;const i=r.anchor,n=!!e.hasLabelVerticalOffset;return l9t({anchor:i,verticalOffset:e.verticalOffset,screenOffset:Qe(),centerOffset:nr(0,0,0,-1),centerOffsetUnits:"world",translation:A(),elevationOffset:0,hasLabelVerticalOffset:n},r,t)}function o9t(t,e){if(e.anchor)return e;const r=t.labelClass.labelPlacement,i=Bm[r],n=i||dj(t);return r&&!i&&n4.warnOncePerTick(`the requested label placement '${r}' is currently unsupported in SceneView.`),a9t(n,t)}function Bpe(t){const e=t.graphics3DGraphic.graphics3DSymbol,r=Vpe(e);return r!=null?r.symbol.symbolLayers.at(0):null}function a9t(t,e){const r=e.graphics3DGraphic.graphic.geometry;if(r==null)return null;if(e.disablePlacement!=null)return e.labelClass.labelPlacement?(n4.warnOncePerTick(_Te(t==null?void 0:t.placement,e.disablePlacement.logEntityDescription)),dj(e)):t;const i=r.type;switch(i){case"polyline":case"polygon":case"extent":case"multipoint":if(e.labelClass.labelPlacement)return n4.warnOncePerTick(_Te(t==null?void 0:t.placement,`'${i}' geometries`)),dj(e);break;case"point":case"mesh":return t}return t}function _Te(t,e){return`the requested label placement '${t}' is currently unsupported for ${e} in SceneView.`}function dj(t){const e=t.graphics3DGraphic.graphic.geometry;if(e==null)return null;switch(e.type){case"polyline":case"extent":case"multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case"polygon":{const r=Bpe(t);return r!=null&&r.type==="extrude"?Bm["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"}}case"point":case"mesh":return Bm["above-center"];default:return}}function l9t(t,e,r){const i=r.graphics3DGraphic.graphic.geometry;if(i==null)return null;switch(i.type){case"point":u9t(t,e,r);break;case"polygon":c9t(t,e,r);break;case"mesh":jpe(t,e,r.graphics3DGraphic.layers[0])}return t}function c9t(t,e,r){const i=Bpe(r);if(i!=null)switch(i.type){case"extrude":{const n=r.graphics3DGraphic.layers[0];n!=null?(n.getBoundingBoxObjectSpace(ID),Fm(ID,t.translation),t.translation[2]=Ex(ID)/2):se(t.translation,0,0,0),jpe(t,e,n);break}}}function u9t(t,e,r){const i=Bpe(r);if(i==null)return;const n=r.graphics3DGraphic.layers[0];switch(n!=null?n.getCenterObjectSpace(t.translation):se(t.translation,0,0,0),i.type){case"icon":case"text":d9t(t,e,r,n);break;case"object":jpe(t,e,n)}}function d9t(t,e,r,i){const{graphics3DGraphic:n}=r,s=i!=null?i.getScreenSize():null;if(n.isDraped||s==null)t.hasLabelVerticalOffset||t.anchor==="center"||(Bm[r.labelClass.labelPlacement]&&n4.warnOncePerTick(`the requested placement '${e.placement}' is currently unsupported for draped graphics`),t.anchor="center");else{const o=h9t(r);t.screenOffset[0]=s[0]/2*(e.normalizedOffset[0]-o[0]);const a=s[1]/2*(e.normalizedOffset[1]-o[1]);t.hasLabelVerticalOffset?(t.centerOffset[1]=a,t.centerOffsetUnits="screen"):t.screenOffset[1]=a}}function h9t(t,e=m9t){const{graphics3DGraphic:r}=t,i=r.layers[0],n=i!=null?i.stageObject.geometries[0].material:null;if(n&&n instanceof KP){const s=n.parameters.anchorPosition;e[0]=2*(s[0]-.5),e[1]=2*(s[1]-.5)}else e[0]=0,e[1]=0;return e}function jpe(t,e,r){const i=r!=null?r.getBoundingBoxObjectSpace(ID):ID,n=Ue(i[3]-i[0],i[4]-i[1],i[5]-i[2]),s=Math.sqrt(n[0]*n[0]+n[1]*n[1]);t.centerOffset[0]=s/2*e.normalizedOffset[0];const o=t.translation[2],a=n[2]/2*e.normalizedOffset[1];t.translation[2]=0,t.elevationOffset=o+a;const l=We(n);t.centerOffset[2]=l/2*e.normalizedOffset[2]}function p9t(t){return t==="above-center"}function f9t(t){const e=t.labelClass.labelPlacement,{labelSymbol:r,graphics3DGraphic:i}=t,n=Vpe(i.graphics3DSymbol),s=rd(n,a=>a.symbol.type==="point-3d"?a.symbol:null),o=Bm[e]||dj(t);return s!=null&&s.supportsCallout()&&s.hasVisibleVerticalOffset()&&!i.isDraped?{placement:null,hasLabelVerticalOffset:!1,verticalOffset:bTe(s.verticalOffset),anchor:null,normalizedOffset:null}:!r||!r.hasVisibleVerticalOffset()||s!=null&&s.supportsCallout()&&s.verticalOffset&&!i.isDraped?{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}:o&&p9t(o.placement)?{placement:"above-center",verticalOffset:bTe(r.verticalOffset),anchor:"bottom",normalizedOffset:[0,o.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(n4.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+e+" placement)"),null)}function bTe(t){const{screenLength:e,minWorldLength:r,maxWorldLength:i}=t;return{screenLength:e,minWorldLength:r,maxWorldLength:i}}const Bm={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},wTe={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in wTe){const e=wTe[t],r=Bm[t];e.forEach(i=>{Bm[i]=r})}Object.freeze&&(Object.freeze(Bm),Object.keys(Bm).forEach(t=>{var e;Object.freeze(Bm[t]),Object.freeze((e=Bm[t])==null?void 0:e.normalizedOffset)}));const m9t=[0,0],ID=To();let xTe=class{constructor(e){this._stage=e,this._materials=new Map}get(e){return this._materials.get(e)}add(e,r){this._materials.set(e,r),this._stage.add(r)}dispose(){this._stage.removeMany(Array.from(this._materials.values())),this._materials.clear()}};const z6=4096;let g9t=class{constructor(){this.offset={x:0,y:0},this.uvMinMax=wr()}},y9t=class{constructor(e,r){this.textId=e,this.textRenderer=r,this.placement=new g9t,this.rendered=!1}},v9t=class{constructor(e,r,i){this.size=e,this.cursor=r,this.lineHeight=i}resize(e){this.size.height=e}resetCursor(){this.cursor.x=LD,this.cursor.y=LD+Eje,this.lineHeight=0}getUsage(){return(this.cursor.x+this.cursor.y*this.size.width)/(this.size.width*this.size.height)}},QI=class extends Ce{constructor(e){super(e),this.type=Wn.Texture,this.id=au(),this.events=new pn,this._glTexture=null,this._needsClear=!1,this._elementsToAddOrUpdate=new Map,this._elementsToRemove=new Map,this._elementsToRender=new Map,this._elements=new Map,this._stageObjects=new Map,this.updating=!1}initialize(){this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","textAtlasCanvas"),this._canvas.setAttribute("style","display:none"),this._ctx=this._canvas.getContext("2d"),this._stage=this.view._stage,this._stage.add(this),this._atlas=new v9t({width:z6,height:256},{x:0,y:0},0),this._updateCanvasElementSize(this._atlas),this._resetAtlasCursor()}unload(){this._glTexture=pt(this._glTexture),this.updating=!1,this.events.emit("unloaded")}get requiresFrameUpdates(){return!1}_createDescriptor(e){const r=new Vr;return r.wrapMode=ir.CLAMP_TO_EDGE,r.flipped=!0,r.samplingMode=Kt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.preMultiplyAlpha=!0,r.maxAnisotropy=e.parameters.maxMaxAnisotropy,r}get glTexture(){return this._glTexture}load(e){return this._glTexture!=null||(this._glTexture=new Jt(e,this._createDescriptor(e),this._canvas),this._frameWorker=this.view.resourceController.scheduler.registerTask(Vt.TEXT_TEXTURE_ATLAS,this),this.setDirty()),this._glTexture}dispose(){this._elements=null,this._elementsToAddOrUpdate=null,this._elementsToRemove=null,this._elementsToRender=null,this._frameWorker=yi(this._frameWorker),this._glTexture&&(this._stage.remove(this),this._glTexture=pt(this._glTexture)),this._canvas.width=0,this._canvas.height=0,this._canvas=null,this._ctx=null}_updateCanvasElementSize(e){this._canvas.setAttribute("width",e.size.width.toString()),this._canvas.setAttribute("height",e.size.height.toString())}_resizeAtlas(e){this._atlas.resize(e),this._glTexture!=null&&this._glTexture.resize(this._atlas.size.width,e),this._updateCanvasElementSize(this._atlas)}_resetAtlasCursor(){this._atlas.resetCursor(),this._needsClear=!0}_addAtlasElement(e,r,i,n){const s=this._atlas,{renderedWidth:o,renderedHeight:a}=e.textRenderer;e.placement.offset.x=s.cursor.x,e.placement.offset.y=s.cursor.y,Ki(e.placement.uvMinMax,e.placement.offset.x/s.size.width,1-(e.placement.offset.y+a)/s.size.height,(e.placement.offset.x+o)/s.size.width,1-e.placement.offset.y/s.size.height),s.cursor.x+=i,s.lineHeight=Math.max(s.lineHeight,n),this._elements.set(r,e)}_removeAtlasElement(e){if(e&&this._elements.has(e.textId)){const r=e.placement.offset;this._ctx.clearRect(r.x,r.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),this._elements.delete(e.textId)}}_ensureStageObjects(e){const r=this._stageObjects.get(e);if(r)return r;const i=new Set;return this._stageObjects.set(e,i),i}_addStageObject(e,r){this._ensureStageObjects(e).add(r)}_removeStageObject(e,r){const i=this._stageObjects.get(e);i&&i.delete(r)&&(r.geometries[0].setAttributeData(O.SIZE,[0,0]),r.geometryVertexAttrsUpdated(r.geometries[0]))}_processAddition(e,r){const i=this._atlas,n=e.textId,s=e.textRenderer.renderedWidth,o=e.textRenderer.renderedHeight,a=s+LD,l=o+LD+Eje;if(i.cursor.x+a<i.size.width&&i.cursor.y+l<i.size.height)this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n);else{if(!(i.cursor.y+l+i.lineHeight<i.size.height)){const c=i.cursor.y+l+i.lineHeight-i.size.height,u=i.size.height+c<z6;if(u){const h=Math.ceil(i.size.height*Math.max(1.3,(c+i.size.height)/i.size.height));this._resizeAtlas(Math.min(upe(h),z6))}return!r||!u&&i.size.height===z6?(this._processRemovals(),iA.OK):(this._repack(),iA.REPACK)}i.cursor.x=LD,i.cursor.y+=i.lineHeight,i.lineHeight=0,this._addAtlasElement(e,n,a,l),this._elementsToRender.set(n,e),this._elementsToAddOrUpdate.delete(n)}return iA.OK}_processRemovals(){this._elementsToRemove.forEach((e,r)=>{const i=this._stageObjects.get(r);i&&i.size!==0||this._removeAtlasElement(e),i&&i.size===0&&this._stageObjects.delete(r)}),this._elementsToRemove.clear()}_repack(){this._processRemovals(),this._elements.forEach((e,r)=>{e.rendered=!1,this._elementsToAddOrUpdate.set(r,e)}),this._elements.clear(),this._resetAtlasCursor(),this._elementsToRender.clear()}_processRenderingRequest(e){this._ctx.clearRect(e.placement.offset.x,e.placement.offset.y,e.textRenderer.renderedWidth,e.textRenderer.renderedHeight),e.textRenderer.render(this._ctx,e.placement.offset.x,e.placement.offset.y);const r=this._stageObjects.get(e.textId);r&&r.forEach(i=>{i.geometries[0].setAttributeData(O.UV0,e.placement.uvMinMax),i.geometries[0].setAttributeData(O.SIZE,[e.textRenderer.displayWidth,e.textRenderer.displayHeight]),i.geometryVertexAttrsUpdated(i.geometries[0])}),e.rendered=!0}get running(){return this.updating}runTask(e,r=!0){if(this._glTexture==null)return ll.YIELD;let i=!1;if(Pa(this._elementsToAddOrUpdate,(s,o)=>{const a=this._elements.get(o);if(a!=null&&a.rendered){const l=this._stageObjects.get(o);return l&&l.forEach(c=>{const u=c.geometries[0],h=this._elements.get(o);u.setAttributeData(O.UV0,h.placement.uvMinMax),u.setAttributeData(O.SIZE,[h.textRenderer.displayWidth,h.textRenderer.displayHeight]),c.geometryVertexAttrsUpdated(c.geometries[0])}),this._elementsToAddOrUpdate.delete(o),e.madeProgress(),!1}return this._processAddition(this._elementsToAddOrUpdate.get(o),r)===iA.REPACK&&(i=!0,!0)}),i)return this.runTask(bc,!1),void e.madeProgress();let n=!1;this._elementsToRender.size>0&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._needsClear=!1),Pa(this._elementsToRender,(s,o)=>(this._processRenderingRequest(s),this._elementsToRender.delete(o),n=!0,e.madeProgress(),e.done)),n&&this._glTexture.setData(this._canvas),this.updating=this._elementsToRender.size>0,!this.updating&&MNt.orderedRepackingEnabled&&(this.repackOrdered(),e.madeProgress())}addTextTexture(e,r){const i=e.key;this._elementsToAddOrUpdate.has(i)||this._elementsToAddOrUpdate.set(i,new y9t(i,e)),this._addStageObject(i,r),this._elementsToRemove.delete(i),this.setDirty()}removeTextTexture(e,r){const i=e.key;this._elementsToRemove.set(i,this._elements.get(i)),this._removeStageObject(i,r)}setDirty(){this._glTexture&&(this.updating=!0)}repackOrdered(){if(this._elements.size===0)return;const e=[];this._elements.forEach((i,n)=>e.push({element:i,key:n}));let r=!0;for(let i=0;i<e.length-1;i++)if(e[i].key.localeCompare(e[i+1].key)>0){r=!1;break}if(!r||this._elementsToRemove.size){e.sort((i,n)=>i.key.localeCompare(n.key)),this._elements.clear();for(const{element:i,key:n}of e)this._elements.set(n,i);this._repack(),this.setDirty()}}get test(){const{_elements:e,_stageObjects:r,_elementsToRemove:i,_atlas:n}=this,s=this;return{elements:e,stageObjects:r,elementsToRemove:i,atlas:n,resizeAtlas:o=>s._resizeAtlas(o),run:(o,a)=>s.runTask(o,a)}}};d([p({constructOnly:!0})],QI.prototype,"view",void 0),d([p({type:Boolean})],QI.prototype,"updating",void 0),QI=d([I("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],QI);const LD=2,Eje=2;var iA;(function(t){t[t.OK=0]="OK",t[t.REPACK=1]="REPACK"})(iA||(iA={}));let STe=class{constructor(e,r){this.labelingContext=e,this.graphics3DGraphic=r,this.hasGraphics3DResources=!1,this.visible=!1,this.rendered=!1,this.textInitialized=!1,this.textRenderers=new Array,this.textLabelPlacements=new Array}},_9t=class{constructor(e,r,i,n,s){this.labelClass=e,this.graphics3DSymbol=r,this.graphics3DCalloutSymbolLayer=i,this.textRenderParameters=n,this.labelFunction=s,this.calloutSymbolLayerIndex=0}},b9t=class{constructor(e,r,i,n,s,o,a,l){this.layer=r,this.graphics3DCore=i,this.scaleVisibility=n,this.emptySymbolLabelSupported=s,this.elevationInfoOverride=o,this.disablePlacement=a,this.active=l,this.labelClassAbortController=new AbortController,this.labelClassContexts=new Array,this.graphics=new Map,this.labelsToInitialize=new Map,this.stageLayer=new U9e(e,{pickable:!0,disableOctree:!0},r.uid)}destroy(){this.stageLayer.destroy()}},sT=class extends Ce{constructor(e){super(e),this._dirty=!1,this._labels=new Map,this._labelsToAdd=new Map,this._labelsToRemove=new Map,this._labelingContexts=new Array}setup(){this.dispose(),this._handles=new Ri,this._handles.add([pe(()=>{var e;return(e=this.view.state)==null?void 0:e.camera},()=>this.setDirty()),pe(()=>{var e;return(e=this.view.state)==null?void 0:e.rasterPixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(Vt.LABELER,this)]),this._textTextureAtlas=new QI({view:this.view}),this._hudMaterialCollection=new xTe(this.view._stage),this._calloutMaterialCollection=new xTe(this.view._stage)}dispose(){this._handles=qe(this._handles),this._textTextureAtlas=pt(this._textTextureAtlas),this._hudMaterialCollection=pt(this._hudMaterialCollection),this._calloutMaterialCollection=pt(this._calloutMaterialCollection),this._labelingContexts.length=0,this._labels.clear(),this._labelsToAdd.clear(),this._labelsToRemove.clear()}destroy(){this.dispose(),Nf.graphic=null,Nf.renderingInfo=null,Nf.layer=null}_activateLabelingContext(e){e.graphics.forEach((r,i)=>{const n=new STe(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n),r.setVisibilityFlag(oa.LABEL,rl.USER,!0)}),e.active=!0}_deactivateLabelingContext(e){e.graphics.forEach((r,i)=>{r.setVisibilityFlag(oa.LABEL,rl.USER,!1),this.setLabelGraphicVisibility(r,!1),this._labels.delete(i)}),e.active=!1}_addLabelTextureToAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i&&this._textTextureAtlas.addTextTexture(i,r.stageObject)}e.rendered=!0}_removeLabelTextureFromAtlas(e){for(const r of e.graphics3DGraphic.labelLayers){if(!r._labelClass)continue;const i=e.textRenderers[r._labelIndex];i!=null&&this._textTextureAtlas.removeTextTexture(i,r.stageObject)}e.rendered=!1}get running(){return this.view.ready&&(this._dirty||this.deconflictor.running)}runTask(e){return this._updateLabels(e),!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(e),ll.YIELD}_updateLabels(e){if(this._dirty){this._dirty=!1;for(const r of this._labelingContexts)if(r.active){if(!TTe(r)){if(w9t(r)){this._deactivateLabelingContext(r);continue}if(this._createLabelClassContext(r),MZ(r)){this._dirty=!0;continue}if(!TTe(r))continue}Pa(r.labelsToInitialize,(i,n)=>(this._ensureGraphics3DResources(i)&&(this._labels.set(n,i),this.deconflictor.setDirty(),e.madeProgress()),(i.visible&&i.textInitialized||!i.visible&&i.hasGraphics3DResources)&&(r.labelsToInitialize.delete(n),e.madeProgress()),e.done))&&(this._dirty=!0)}this._labelsToRemove.forEach(r=>this._removeLabelTextureFromAtlas(r)),this._labelsToAdd.forEach(r=>this._addLabelTextureToAtlas(r)),this._labelsToRemove.clear(),this._labelsToAdd.clear(),this._dirty||this.notifyChange("updating")}}async _createLabelClassContextAsync(e){var o,a,l;const r=(o=e.labelClassAbortController)==null?void 0:o.signal;await((l=(a=e.layer).when)==null?void 0:l.call(a)),vr(r),e.scaleVisibility&&e.scaleVisibility.updateScaleRangeActive();const i=e.graphics3DCore,n=i.layer,s=n.labelingInfo&&n.labelingInfo.filter(c=>!!c.symbol);!s||s.length===0||(await b7(s,async(c,u)=>{const h=c.symbol,f=Vpe(i.getOrCreateGraphics3DSymbol(h));if(f==null)return void re.getLogger(this).error("Failed to create Graphics3DSymbol for label");await f.load(),vr(r);let m=null;Xue(h)&&h.hasVisibleCallout()&&(m=CDt(h,i.symbolCreationContext),await m.load(),vr(r));const g=await wd(Mze(c,e.layer.fieldsIndex,this.view.spatialReference));if(vr(r),g.ok===!0){const y=await this._createTextRenderParameters(f.symbol);vr(r),e.labelClassContexts[u]=new _9t(c,f,m,y,g.value)}else re.getLogger(this).error(`Label expression failed to evaluate: ${g.error}`)}),vr(r))}async _createLabelClassContext(e){return e.labelClassPromise==null&&(e.labelClassPromise=this._createLabelClassContextAsync(e).catch(r=>{if(Yn(r))throw r;e.labelClassContexts.length=0}).then(()=>{e.labelClassAbortController=null,this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating")),e.labelClassPromise}async _createTextRenderParameters(e){const r=e.symbolLayers.at(0);return(r==null?void 0:r.type)!=="text"?null:Sje.fromSymbol(r,this.view.state.rasterPixelRatio)}_destroyLabelClassContext(e){for(const i of e.labelClassContexts)--i.graphics3DSymbol.referenced;const r=e.labelClassAbortController;e.labelClassAbortController=new AbortController,xc(r),e.labelClassContexts.length=0,e.labelClassPromise=null,this.notifyChange("updating")}_createTextSymbolGraphic(e,r,i,n,s){const o=new Ize(i.verticalOffset,TSe(i.anchor),ykt(i.anchor),e.text,i.translation,i.elevationOffset,i.centerOffset,i.screenOffset,i.centerOffsetUnits,e.displayWidth,e.displayHeight);return Nf.graphic=r,Nf.renderingInfo=null,Nf.layer=n,s.createLabel(Nf,o,this._hudMaterialCollection,this._textTextureAtlas)}_createLineCalloutGraphic(e,r,i,n,s){return Nf.graphic=e,Nf.layer=s,Nf.renderingInfo=new TDt(null,r,n.translation,n.centerOffset,n.screenOffset,n.centerOffsetUnits,n.elevationOffset,this._calloutMaterialCollection),i.createGraphics3DGraphic(Nf)}_ensureGraphics3DResources(e){var c;if(e.hasGraphics3DResources)return!1;const r=e.graphics3DGraphic;if(r.destroyed)return!1;this._ensureTextTextureResources(e);const i=e.labelingContext,n=i.labelClassContexts;if(!n||n.length===0||!i.emptySymbolLabelSupported&&r.layers.length===0)return!1;let s=!1;const o=r.graphic,a=i.layer,l=V6(i.layer);for(let u=0;u<n.length;u++){const h=e.textRenderers[u],f=e.textLabelPlacements[u];if(h==null||f==null)continue;const m=n[u],g=m.graphics3DSymbol,y=g.symbol&&g.symbol.type==="label-3d"?g.symbol:null,_=g.symbolLayers[0];if(!_)continue;_.setElevationInfoOverride(i.elevationInfoOverride);const b=this._createTextSymbolGraphic(h,o,f,a,_);if(b==null)return!1;b._labelClass=m.labelClass,b._labelIndex=u,r.addLabelGraphic(b,i.stageLayer),r.deconflictionPriority=((c=m.textRenderParameters)==null?void 0:c.definition.size)??0,r.setVisibilityFlag(oa.LABEL,rl.USER,l),r.setVisibilityFlag(oa.LABEL,rl.SCALE_RANGE,!0),r.setVisibilityFlag(oa.LABEL,rl.DECONFLICTION,!1),s=!0;const w=m.graphics3DCalloutSymbolLayer;if(w&&f.hasLabelVerticalOffset){w.setElevationInfoOverride(i.elevationInfoOverride);const x=this._createLineCalloutGraphic(o,y,w,f,a);x!=null&&(m.calloutSymbolLayerIndex=r.labelLayers.length,r.addLabelGraphic(x,i.stageLayer))}break}return i.scaleVisibility&&s&&i.scaleVisibility.updateGraphicLabelScaleVisibility(r),e.hasGraphics3DResources=!0,!0}_destroyGraphics3DResources(e){const r=e.labelingContext.labelClassContexts;for(const i of e.graphics3DGraphic.labelLayers){if(i._labelClass==null)continue;const n=r[i._labelIndex].graphics3DSymbol.symbolLayers[0];n!=null&&n.onRemoveGraphic(i)}e.graphics3DGraphic.deconflictionPriority=0,e.graphics3DGraphic.clearLabelGraphics(),e.hasGraphics3DResources=!1}_ensureTextTextureResources(e){var s;if(e.textInitialized)return;const r=e.labelingContext,i=r.labelClassContexts;if(!i||i.length===0)return;const n=e.graphics3DGraphic.graphic;for(let o=0;o<i.length;o++){const a=i[o];if(e.textRenderers[o]=null,e.textLabelPlacements[o]=null,(a==null?void 0:a.textRenderParameters)==null)continue;const l=a.labelFunction;let c;if(l.type==="arcade")try{const w=l.needsHydrationToEvaluate()?dLt(n,r.layer):n;c=l.evaluate(w)}catch{c=null}else c=l.evaluate(n);if(c==null||c===""||/^\s+$/.test(c))continue;const u=a.graphics3DSymbol,h=((s=u.symbol)==null?void 0:s.type)==="label-3d"?u.symbol:null;if(!u.symbolLayers[0])continue;const f=e.graphics3DGraphic,m=a.labelClass,g=r.disablePlacement,y=s9t({graphics3DGraphic:f,labelSymbol:h,labelClass:m,disablePlacement:g});if(y==null)continue;const _=TSe(y.anchor),b=mBe(_);e.textRenderers[o]=new pBe(c,b,a.textRenderParameters),e.textLabelPlacements[o]=y}e.textInitialized=!0}_destroyTextTextureResources(e){e.textInitialized=!1,e.textRenderers.length=0,e.textLabelPlacements.length=0}_addGraphic(e,r){const i=r.graphic.uid;if(e.graphics.set(i,r),e.active){const n=new STe(e,r);this._labels.set(i,n),e.labelsToInitialize.set(i,n)}this.setDirty(),this.deconflictor.setDirty()}_removeGraphic(e,r){const i=r.graphic.uid,n=this._labels.get(i);e.graphics.delete(i),n&&(this._destroyGraphic(n,i),e.labelsToInitialize.delete(i),this.setDirty(),this.deconflictor.setDirty())}_destroyGraphic(e,r){this._labels.has(r)&&(this._labels.delete(r),this._labelsToAdd.delete(r),this._labelsToRemove.delete(r)),e.textInitialized&&(this._removeLabelTextureFromAtlas(e),this._destroyTextTextureResources(e)),e.hasGraphics3DResources&&this._destroyGraphics3DResources(e)}async _labelingInfoChange(e,r){if(!r)return this._visibilityInfoChange(e),this._resetLabels(e),this._createLabelClassContext(e);for(const i of r){const n=e.graphics.get(i);n&&(this._removeGraphic(e,n),this._addGraphic(e,n))}}_globalPropertyChanged(e,r){for(const i of r.labelClassContexts){const n=new Map;r.graphics.forEach(o=>n.set(o.graphic.uid,o));const s=o=>o.labelLayers[0];if(i.graphics3DSymbol.symbolLayers[0].globalPropertyChanged(e,n,s),i.graphics3DCalloutSymbolLayer){const o=a=>a.labelLayers[i.calloutSymbolLayerIndex];i.graphics3DCalloutSymbolLayer.globalPropertyChanged(e,n,o)}}}_visibilityInfoChange(e){const r=V6(e.layer);r&&!e.active&&this._activateLabelingContext(e),!r&&e.active&&this._deactivateLabelingContext(e),this.setDirty()}_resetAllLabels(){for(const e of this._labelingContexts)this._resetLabels(e)}_resetLabels(e){e.graphics.forEach((r,i)=>{const n=this._labels.get(i);n&&(this._destroyGraphic(n,i),n.visible=!1,n.rendered=!1,e.labelsToInitialize.set(i,n))}),this._destroyLabelClassContext(e),this.setDirty(),this.deconflictor.setDirty()}_findLabelingContext(e){for(const r of this._labelingContexts)if(r.graphics3DCore===e)return r;return null}addGraphicsOwner(e,r,i){const n=i&&i.emptySymbolLabelSupported||!1,s=i&&i.elevationInfoOverride||null,o=i&&i.disablePlacement||null;if(this._findLabelingContext(e))return;const a=e.layer,l=new b9t(this.view._stage,a,e,r,n,s,o,V6(a));return this._labelingContexts.push(l),this.setDirty(),{addGraphic:c=>this._addGraphic(l,c),removeGraphic:c=>this._removeGraphic(l,c),featureReductionChange:()=>{},layerLabelsEnabled:()=>V6(l.layer),labelingInfoChange:c=>this._labelingInfoChange(l,c),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",l),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",l),visibilityInfoChange:()=>this._visibilityInfoChange(l),reset:()=>this._resetLabels(l),clear:()=>{}}}removeGraphicsOwner(e){const r=this._findLabelingContext(e);if(!r)return;const i=this._labelingContexts.indexOf(r);this._labelingContexts.splice(i,1),r.graphics.forEach(n=>this._removeGraphic(r,n)),r.destroy(),this.setDirty()}setLabelGraphicVisibility(e,r){const i=e.graphic.uid,n=this._labels.get(i);n&&n.visible!==r&&(r&&!n.rendered?(this._labelsToAdd.set(i,n),this._labelsToRemove.delete(i),n.textInitialized||n.labelingContext.labelsToInitialize.set(i,n)):!r&&n.rendered&&(this._labelsToRemove.set(i,n),this._labelsToAdd.delete(i)),n.visible=r,this.setDirty())}setDirty(){!this._dirty&&this._labelingContexts.length>0&&(this._dirty=!0,this.notifyChange("updating"))}get updating(){var e;return this._dirty||((e=this._textTextureAtlas)==null?void 0:e.updating)||this.deconflictor.updating||this._labelingContexts.some(r=>MZ(r))}get updatingProgress(){if(!this.updating||!this._textTextureAtlas)return 1;const e=this._labelingContexts.length>0?this._labelingContexts.reduce((r,i)=>r+(MZ(i)?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*e+.5*this.deconflictor.updatingProgress}get test(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}};function MZ(t){return!!t.labelClassPromise&&!!t.labelClassAbortController}function TTe(t){return t.labelClassContexts&&t.labelClassContexts.length}function w9t(t){return t.labelClassContexts===null}function V6(t){var e;return t.labelsVisible===!0&&!!((e=t.labelingInfo)!=null&&e.some(r=>!!r.symbol))}d([p({constructOnly:!0})],sT.prototype,"view",void 0),d([p({constructOnly:!0})],sT.prototype,"deconflictor",void 0),d([p()],sT.prototype,"_textTextureAtlas",void 0),d([p({type:Boolean,readOnly:!0})],sT.prototype,"updating",null),sT=d([I("esri.views.3d.layers.graphics.Labeler")],sT);const Nf=new EDt(null,null,null);let eL=class JR{constructor(e,r,i,n=null){this.lij=[0,0,0],this.extent=lr(),this.resolution=0,this.loadPriority=0,this.measures={visibility:Tl.VISIBLE_ON_SURFACE,screenRect:lr(),distance:0,shouldSplit:!1},this.used=!1,n&&this.acquire(e,r,i,n)}acquire(e,r,i,n){this.tilingScheme=n,this.id=JR.id(e,r,i),this.lij[0]=e,this.lij[1]=r,this.lij[2]=i,n.getExtent(e,r,i,this.extent),this.resolution=n.resolutionAtLevel(e)}release(){this.tilingScheme=null}getChildren(e){const r=this.lij[0]+1,i=2*this.lij[1],n=2*this.lij[2];return e?(e[0].acquire(r,i,n,this.tilingScheme),e[1].acquire(r,i+1,n,this.tilingScheme),e[2].acquire(r,i,n+1,this.tilingScheme),e[3].acquire(r,i+1,n+1,this.tilingScheme),e):[new JR(r,i,n,this.tilingScheme),new JR(r,i+1,n,this.tilingScheme),new JR(r,i,n+1,this.tilingScheme),new JR(r,i+1,n+1,this.tilingScheme)]}copyMeasurementsFrom(e){this.measures.visibility=e.measures.visibility,this.measures.shouldSplit=e.measures.shouldSplit,this.measures.distance=e.measures.distance,A_(e.measures.screenRect,this.measures.screenRect)}static id(e,r,i){return`${e}/${r}/${i}`}};var Tl;(function(t){t[t.INVISIBLE=0]="INVISIBLE",t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(Tl||(Tl={}));const Cje=.5*Math.PI,x9t=Cje/Math.PI*180;let S9t=class{constructor(e){this._renderCoordsHelper=e.renderCoordsHelper,this._extent=new Array(4),this._planes=new Array(6),this._maxSpan=0,this._center={origin:A(),direction:A()};for(let r=0;r<4;r++)this._extent[r]={origin:A(),direction:A(),cap:{next:null,direction:A()}},this._planes[r]=oi();this._planes[Ui.NEAR]=oi(),this._planes[Ui.FAR]=oi(),this._planesWithoutFar=this._planes.slice(0,5)}update(e,r,i,n=!0){const s=this._extent;this._toRenderBoundingExtent(e,r,i),ge(this._center.origin,s[0].origin,s[2].origin),ce(this._center.origin,this._center.origin,.5),this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction),n||ce(this._center.direction,this._center.direction,-1);for(let o=0;o<4;o++){const a=s[o];this._renderCoordsHelper.worldUpAtPosition(a.origin,a.direction);const l=s[o===3?0:o+1];a.cap.next=l.origin,H_(a.cap.direction,a.origin,l.origin),IN(a.direction,a.cap.direction,a.origin,this._planes[o]),n||ce(a.direction,a.direction,-1)}IN(s[0].cap.direction,s[1].cap.direction,s[0].origin,this._planes[Ui.NEAR]),n?Kte(this._planes[Ui.NEAR],this._planes[Ui.FAR]):(rH(this._planes[Ui.FAR],this._planes[Ui.NEAR]),Kte(this._planes[Ui.NEAR],this._planes[Ui.NEAR])),this._maxSpan=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),this._maxSpanSpatialReference=r,this._minGlobalAltitude=.9*Xr(this._maxSpanSpatialReference).radius}isVisibleInFrustum(e,r,i=!1){if(e==null)return!1;if(this._renderCoordsHelper.viewingMode===at.Global){const s=this._maxSpanSpatialReference.isGeographic?x9t:Cje*r;if(this._maxSpan>s)return!0;if(e.altitude!=null&&e.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(e)}if(this._maxSpan===0){const s=this._extent[0];return!(i||!e.intersectsRay(Ah(s.origin,s.direction)))}for(let s=0;s<this._extent.length;s++){const o=this._extent[s];if(!i&&e.intersectsRay(Ah(o.origin,o.direction))||e.intersectsLineSegment(S2(o.origin,o.cap.next,E9t),o.cap.direction))return!0}const n=i?this._planes:this._planesWithoutFar;for(let s=0;s<e.lines.length;s++){const o=e.lines[s];if(QAt(n,o.origin,o.endpoint,o.direction))return!0}return!1}_toRenderBoundingExtentGlobal(e,r,i){qce(e,Ff),Ff[2]=i,lu(r,Ff,$Z,this._renderCoordsHelper.spatialReference),Uo(ETe,$Z),en(Eu);for(const{x0:s,x1:o,y0:a,y1:l}of T9t)for(let c=0;c<5;c++){const u=c/4;Ff[0]=Xt(e[s],e[o],u),Ff[1]=Xt(e[a],e[l],u),Ff[2]=i,Ys(Ff,r,Ff,this._renderCoordsHelper.spatialReference),lt(Ff,Ff,ETe),c0(Eu,Ff)}se(this._extent[0].origin,Eu[0],Eu[1],Eu[2]),se(this._extent[1].origin,Eu[3],Eu[1],Eu[2]),se(this._extent[2].origin,Eu[3],Eu[4],Eu[2]),se(this._extent[3].origin,Eu[0],Eu[4],Eu[2]);for(let s=0;s<4;++s)lt(this._extent[s].origin,this._extent[s].origin,$Z)}_toRenderBoundingExtentLocal(e,r,i){rF(e,r,B0,this._renderCoordsHelper.spatialReference),se(this._extent[0].origin,B0[0],B0[1],i),se(this._extent[1].origin,B0[2],B0[1],i),se(this._extent[2].origin,B0[2],B0[3],i),se(this._extent[3].origin,B0[0],B0[3],i)}_toRenderBoundingExtent(e,r,i){switch(this._renderCoordsHelper.viewingMode){case at.Global:this._toRenderBoundingExtentGlobal(e,r,i);break;case at.Local:this._toRenderBoundingExtentLocal(e,r,i);break;default:this._renderCoordsHelper.viewingMode}}_isVisibleInFrustumGlobal(e){if(zi(e.planes[Ui.NEAR],this._center.origin)<0&&ye(this._center.direction,e.direction)<0)return!0;for(let r=0;r<4;r++){const i=this._extent[r];if(zi(e.planes[Ui.NEAR],i.origin)<0&&ye(i.direction,e.direction)<0)return!0}return!1}};const T9t=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],Ff=A(),$Z=Me(),ETe=Me(),Eu=To(),B0=lr(),E9t=fg();let C9t=class{constructor(e){this._renderCoordsHelper=e,this._surfaceElevation=0,this._cache=new Map,this._frustum=new rw(e),this._extendedFrustum=new rw(e),this._intersector=new S9t({renderCoordsHelper:e}),this._renderCoordsHelper=e}begin(e,r){this._surfaceElevation=r,this._aboveGround=this._renderCoordsHelper.getAltitude(e.eye)>r,this._frustum.update(e),this._shortenFrustumFarPlane(this._frustum),this._updateExtendedFrustum(e)}end(){this._cache.clear()}calculate(e){if(this._allTilesInvisible)return Tl.INVISIBLE;const r=this._renderCoordsHelper.viewingMode===at.Global&&e.lij[0]>=R9t&&e.lij[0]<O9t,i=this._getOrCalculateSingleTileVisibility(e,!r);return i!==Tl.INVISIBLE&&r?this._calculateAggregatedChildrenVisibility(e):i}_shortenFrustumFarPlane(e){const r=rw.nearFarLineIndices,i=e.mutablePoints;for(const n of r){const[s,o]=n,a=i[s],l=i[o];ve(Nd,l,a),ce(Nd,Nd,P9t),ge(i[o],a,Nd)}e.updatePoints(i)}_calculateAggregatedChildrenVisibility(e){let r=Tl.INVISIBLE;const i=this._cache.get(e.id);if(i!=null)return i;const n=ATe.acquire();e.getChildren(n);for(const s of n){const o=this.calculate(s);if(o!==Tl.INVISIBLE&&(r=o,o===Tl.VISIBLE_ON_SURFACE))break}return ATe.release(n),this._cache.set(e.id,r),r}_getOrCalculateSingleTileVisibility(e,r){const i=this._cache.get(e.id);if(i!=null)return i;const n=this._calculateSingleTileVisibility(e);return r&&this._cache.set(e.id,n),n}_calculateSingleTileVisibility(e){return!this._aboveGround&&this._renderCoordsHelper.viewingMode===at.Global&&e.lij[0]<A9t?this._calculateSingleTileVisibilitySided(e,!1)===Tl.INVISIBLE?this._calculateSingleTileVisibilitySided(e,!0):void 0:this._calculateSingleTileVisibilitySided(e,this._aboveGround)}_calculateSingleTileVisibilitySided(e,r){this._intersector.update(e.extent,e.tilingScheme.spatialReference,this._surfaceElevation,r);const i=Xr(e.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,i)?this._intersector.isVisibleInFrustum(this._frustum,i,!0)?Tl.VISIBLE_ON_SURFACE:Tl.VISIBLE_WHEN_EXTENDED:Tl.INVISIBLE}_updateExtendedFrustum(e){this._extendedFrustum.update(e),this._shortenFrustumFarPlane(this._extendedFrustum);const r=this._renderCoordsHelper.worldUpAtPosition(e.eye,Nd);this._aboveGround||Nl(r,r);const i=Vo(-ye(r,e.viewForward));if(this._allTilesInvisible=i>(Math.PI+e.fovY)/2,this._allTilesInvisible||(this._hasExtendedFrustum=i>e.fovY/2,!this._hasExtendedFrustum))return;const n=this._extendedFrustumParameters(),s=this._extendedFrustum.mutablePoints;for(let o=0;o<4;o++){const a=n.pointIndices[o],l=s[a],c=this._renderCoordsHelper.getAltitude(l);if(n.needsAltitudeAdjustment(c)){switch(this._renderCoordsHelper.worldUpAtPosition(l,Nd),a){case Ct.FAR_BOTTOM_LEFT:case Ct.FAR_TOP_LEFT:case Ct.NEAR_BOTTOM_LEFT:case Ct.NEAR_TOP_LEFT:Qte(this._extendedFrustum.planes[Ui.LEFT],Nd,Nd);break;case Ct.FAR_BOTTOM_RIGHT:case Ct.FAR_TOP_RIGHT:case Ct.NEAR_BOTTOM_RIGHT:case Ct.NEAR_TOP_RIGHT:Qte(this._extendedFrustum.planes[Ui.RIGHT],Nd,Nd)}ce(Nd,Nd,n.direction),this._renderCoordsHelper.intersectInfiniteManifold(Ah(l,Nd),n.zWithMargin,l)}}if(this._extendedFrustum.updatePoints(s),Rl(s[Ct.NEAR_BOTTOM_LEFT],s[Ct.NEAR_BOTTOM_RIGHT],s[Ct.NEAR_TOP_RIGHT],RTe),Rl(s[Ct.NEAR_BOTTOM_RIGHT],s[Ct.NEAR_TOP_RIGHT],s[Ct.NEAR_TOP_LEFT],OTe),ye(RTe,OTe)<0){const o=this._extendedFrustum.mutablePoints;this._aboveGround?[o[Ct.NEAR_BOTTOM_LEFT],o[Ct.NEAR_BOTTOM_RIGHT]]=[o[Ct.NEAR_BOTTOM_RIGHT],o[Ct.NEAR_BOTTOM_LEFT]]:[o[Ct.NEAR_TOP_LEFT],o[Ct.NEAR_TOP_RIGHT]]=[o[Ct.NEAR_TOP_RIGHT],o[Ct.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(o)}}_extendedFrustumParameters(){return this._aboveGround?this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()}_extendedFrustumParametersAboveSurface(){const e=this._surfaceElevation-CTe;return{zWithMargin:e,pointIndices:rw.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment:r=>r>e}}_extendedFrustumParametersBelowSurface(){const e=this._surfaceElevation+CTe;return{zWithMargin:e,pointIndices:rw.planePointIndices.top,direction:1,needsAltitudeAdjustment:r=>r<e}}};const R9t=2,O9t=6,A9t=12,P9t=.95,CTe=1,Nd=A(),RTe=oi(),OTe=oi(),ATe=new il(Array,t=>{t.length!==4&&(t[0]=new eL,t[1]=new eL,t[2]=new eL,t[3]=new eL)},t=>{t[0].release(),t[1].release(),t[2].release(),t[3].release()});let M9t=class{constructor(e){this._camera=new Bt,this._focusOnMap=[0,0],this._screenRect=lr(),this._tileSize=e.tileSize,this._renderCoordsHelper=e.renderCoordsHelper,this._tilingScheme=e.tilingScheme,this._visibility=new C9t(e.renderCoordsHelper)}begin(e,r,i){this._camera.copyFrom(e),this._surfaceElevation=i,this._focusOnMap[0]=r.x,this._focusOnMap[1]=r.y,Hce(0,0,e.fullWidth,e.fullHeight,this._screenRect),this._visibility.begin(this._camera,i)}end(){this._visibility.end()}updateTile(e){e.measures.visibility=this._visibility.calculate(e),e.measures.distance=qmt(e.extent,this._focusOnMap),e.measures.visibility!==Tl.INVISIBLE&&this._updateScreenMeasure(e)}_updateScreenMeasure(e){const r=$9t,i=1<<r,n=e.measures.screenRect;xd(n);let s=0;const o=e.lij[0]+r,a=e.lij[1]<<r,l=e.lij[2]<<r,c=this._tileSizeWithBias(e),u=c*c;for(let h=0;h<i;h++)for(let f=0;f<i;f++)if(s+=this._computeScreenArea(e,o,a+h,l+f,n),s>u)return void(e.measures.shouldSplit=!0);e.measures.shouldSplit=!1}_tileSizeWithBias(e){return e.measures.visibility===Tl.VISIBLE_WHEN_EXTENDED?this._tileSize*I9t:this._tileSize}_computeScreenArea(e,r,i,n,s){const o=e.measures.visibility===Tl.VISIBLE_WHEN_EXTENDED;this._projectToScreen(r,i,n,o,U1),xd(IZ);for(let a=0;a<4;a++)SA(IZ,U1[a]);return Fw(s,IZ,s),hbe(U1[0],U1[1],U1[2])+hbe(U1[0],U1[2],U1[3])}_projectToScreen(e,r,i,n,s){this._tilingScheme.ensureMaxLod(e),this._tilingScheme.getExtent(e,r,i,m$),this._toRenderCoords(m$,0,3,z1[0]),this._toRenderCoords(m$,2,3,z1[1]),this._toRenderCoords(m$,2,1,z1[2]),this._toRenderCoords(m$,0,1,z1[3]),n&&(this._projectToPlane(z1,this._camera.frustum[Ui.NEAR]),this._projectToPlane(z1,this._camera.frustum[Ui.TOP]),this._projectToPlane(z1,this._camera.frustum[Ui.BOTTOM]));for(let o=0;o<4;o++)this._camera.projectToRenderScreen(z1[o],PTe),this._camera.renderToScreen(PTe,s[o])}_projectToPlane(e,r){for(let n=0;n<4;n++)y$[n]=zi(r,e[n]);const i=Math.max(y$[0],y$[1],y$[2],y$[3]);if(i>0){const n=ce(g$,r,-i);for(let s=0;s<4;s++)ge(e[s],e[s],n)}}_toRenderCoords(e,r,i,n){return g$[0]=e[r],g$[1]=e[i],g$[2]=this._surfaceElevation,this._renderCoordsHelper.toRenderCoords(g$,this._tilingScheme.spatialReference,n),n}};const IZ=lr(),$9t=2,I9t=5,U1=[Tn(),Tn(),Tn(),Tn()],m$=lr(),g$=A(),z1=[A(),A(),A(),A()],y$=[0,0,0,0],PTe=ua();function rSr(t,e,r){if(t==null||r==null)return!1;let i=!0;return ho[0]=t.xmin!=null?t.xmin:0,ho[1]=t.ymin!=null?t.ymin:0,ho[2]=t.zmin!=null?t.zmin:0,i=i&&Ni(ho,t.spatialReference,0,e,r,0,1),ho[0]=t.xmax!=null?t.xmax:0,ho[1]=t.ymax!=null?t.ymax:0,ho[2]=t.zmax!=null?t.zmax:0,i=i&&Ni(ho,t.spatialReference,0,e,r,3,1),t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.zmin==null&&(e[2]=-1/0),t.xmax==null&&(e[3]=1/0),t.ymax==null&&(e[4]=1/0),t.zmax==null&&(e[5]=1/0),i}function Rje(t,e,r){if(t==null||r==null)return!1;let i=!0;return ho[0]=t.xmin!=null?t.xmin:0,ho[1]=t.ymin!=null?t.ymin:0,ho[2]=t.zmin!=null?t.zmin:0,i=i&&Ni(ho,t.spatialReference,0,ho,r,0,1),e[0]=ho[0],e[1]=ho[1],ho[0]=t.xmax!=null?t.xmax:0,ho[1]=t.ymax!=null?t.ymax:0,ho[2]=t.zmax!=null?t.zmax:0,i=i&&Ni(ho,t.spatialReference,0,ho,r,0,1),e[2]=ho[0],e[3]=ho[1],t.xmin==null&&(e[0]=-1/0),t.ymin==null&&(e[1]=-1/0),t.xmax==null&&(e[2]=1/0),t.ymax==null&&(e[3]=1/0),i}const ho=A();let Sa=class extends Ce{get tilingScheme(){const e=this.tilingSchemeOwner.tilingScheme;return e?e.clone():null}set filterExtent(e){if(e!=null&&!e.spatialReference.equals(this.viewState.spatialReference))return void re.getLogger(this).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");const r=this._get("filterExtent");if(r===e||r!=null&&e&&r.equals(e))return;const i=e!=null?e.clone():null;this._set("filterExtent",i),this._setDirty()}get _filterExtentRect(){if(this.filterExtent==null)return null;const e=lr();return Rje(this.filterExtent,e,this.tilingScheme.spatialReference),e}get _rootTileIds(){const{tilingScheme:e}=this;return this._filterExtentRect&&e?e.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}set suspended(e){e!==this._get("suspended")&&(this._set("suspended",e),this._setDirty())}get updating(){return this._dirty||!!this._pendingTiles}constructor(e){super(e),this.tiles=new vt,this.tileSize=512,this._idToTile=new Map,this._handles=new Ri,this._clients=new Set,this._dirty=!1,this._pendingTiles=null,this._newTiles=new dr}initialize(){this._handles.add([pe(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),li),pe(()=>{var e,r,i;return[this.tileSize,(e=this.cameraOnSurface)==null?void 0:e.location,this.tilingScheme,(r=this.viewState)==null?void 0:r.contentCamera,(i=this.focus)==null?void 0:i.location]},()=>this._setDirty(),Bi)]),this.scheduler&&(this._frameWorker=this.scheduler.registerTask(Vt.FEATURE_TILE_TREE,this))}destroy(){this._frameWorker=yi(this._frameWorker),this._handles=qe(this._handles)}addClient(){const e=D9t();return this._clients.add(e),this._clients.size===1&&this._setDirty(),kl(()=>this._removeClient(e))}_removeClient(e){this._clients.delete(e),this._hasClients||this._clear()}get _hasClients(){return this._clients.size>0}_setDirty(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(bc))}_clear(){this.tiles.removeAll(),this._idToTile.clear(),this._reset(),this._dirty=!1,this.notifyChange("updating")}get running(){return this.updating}runTask(e){this._dirty=!1,this._pendingTiles||(this._startUpdate(),this._frameWorker!=null&&(this._frameWorker.priority=Vt.FEATURE_TILE_TREE_ACTIVE)),this._subdivideTilesForView(e),this._pendingTiles||this._frameWorker==null||(this._frameWorker.priority=Vt.FEATURE_TILE_TREE),this.notifyChange("updating")}_startUpdate(){if(this.suspended)return;if(!this.tilingScheme)return void this._clear();this._tileMeasurements||(this._tileMeasurements=new M9t({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize}));const e=this.viewState.contentCamera;this._tileMeasurements.begin(e,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()}_reset(){this._newTiles.clear(),this._tileMeasurements=null,this._pendingTiles=null,this._setDirty()}_getRootTiles(){const{tilingScheme:e}=this;return this._rootTileIds.map(r=>new eL(r[0],r[1],r[2],e))}_purgeHorizonTiles(e){e.sort((r,i)=>{const n=r.measures.screenRect,s=i.measures.screenRect;return n[1]+n[3]-(s[1]+s[3])}),xd(B6);for(let r=0;r<e.length;r++)if(Fw(B6,e.data[r].measures.screenRect,B6),og(B6)>N9t)return e.data.slice(r,e.length);return[]}_subdivideTilesForView(e){if(!this._pendingTiles)return;const{tilingScheme:r}=this;for(;this._pendingTiles.length>0&&!e.done;){const i=this._pendingTiles.pop();e.madeProgress(),this._filterExtentRect&&!Z4(this._filterExtentRect,i.extent)||(this._tileMeasurements.updateTile(i),i.measures.visibility!==Tl.INVISIBLE&&(i.measures.shouldSplit?(r.ensureMaxLod(i.lij[0]+1),this._pendingTiles.push(...i.getChildren())):this._newTiles.push(i)))}this._pendingTiles.length===0&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}_updateTiles(e){for(const n of this.tiles.items)n.used=!1;const r=e.filter(n=>{const s=this._idToTile.get(n.id);return s?(s.copyMeasurementsFrom(n),s.used=!0):this._idToTile.set(n.id,n),!s}),i=this.tiles.items.filter(n=>!n.used&&(this._idToTile.delete(n.id),!0));this.tiles.removeMany(i),this.tiles.addMany(r),this._sortTiles()}_sortTiles(){this.viewState.fixedContentCamera||this.tiles.sort((e,r)=>e.measures.visibility!==r.measures.visibility?e.measures.visibility===Tl.VISIBLE_ON_SURFACE?-1:1:e.measures.distance-r.measures.distance),this.tiles.forEach((e,r)=>e.loadPriority=r)}};d([p({constructOnly:!0})],Sa.prototype,"scheduler",void 0),d([p({constructOnly:!0})],Sa.prototype,"renderCoordsHelper",void 0),d([p({constructOnly:!0})],Sa.prototype,"tilingSchemeOwner",void 0),d([p({constructOnly:!0})],Sa.prototype,"cameraOnSurface",void 0),d([p({constructOnly:!0})],Sa.prototype,"focus",void 0),d([p({constructOnly:!0})],Sa.prototype,"viewState",void 0),d([p({constructOnly:!0})],Sa.prototype,"terrain",void 0),d([p()],Sa.prototype,"tiles",void 0),d([p()],Sa.prototype,"tileSize",void 0),d([p({readOnly:!0})],Sa.prototype,"tilingScheme",null),d([p()],Sa.prototype,"filterExtent",null),d([p({readOnly:!0})],Sa.prototype,"_filterExtentRect",null),d([p({readOnly:!0})],Sa.prototype,"_rootTileIds",null),d([p({value:!1})],Sa.prototype,"suspended",null),d([p({readOnly:!0})],Sa.prototype,"updating",null),Sa=d([I("esri.views.3d.layers.support.FeatureTileTree3D")],Sa);let L9t=0;function D9t(){return L9t++}const B6=lr(),N9t=10;let zn=class extends Ce{constructor(){super(...arguments),this._propertiesPool=new N_({camera:Bt},this),this._lastSeenCameraProjectionValues=new Bt,this.mode=ai.ANIMATING,this._cssCamera=new Bt,this._camera=new Bt,this.rasterPixelRatio=1,this.contentPixelRatio=1,this.events=new pn,this.viewingMode=at.Global,this._cameraChanged=!1,this._updateQueue=new Array,this._processingUpdates=!1}init(e,r){this._set("viewingMode",e),this._set("spatialReference",r),this._set("constraints",new uv({mode:this.viewingMode}))}exit(){var e;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,this._propertiesPool.destroy(),this._propertiesPool=new N_({camera:Bt},this)}destroy(){var e,r;(e=this.cameraController)==null||e.destroy(),this.cameraController=null,(r=this._propertiesPool)==null||r.destroy(),this._propertiesPool=null}createInitialCamera(){if(this.viewingMode===at.Global){const e=Xr(this.spatialReference).radius;this.camera=new Bt({eye:Ue(4*e,0,0),center:Ue(e,0,0),up:Ue(0,0,1)})}else this.camera=new Bt({eye:Ue(0,0,100),center:Ue(0,0,0),up:Ue(0,1,0)})}get animation(){return this.cameraController instanceof qN&&this.cameraController.viewAnimation!=null?this.cameraController.viewAnimation:null}get camera(){return this._camera}get cssCamera(){const e=this._cssCamera.copyFrom(this.camera),{height:r,width:i,pixelRatio:n}=this.camera;return e.pixelRatio=1,e.height=Math.round(r/n),e.width=Math.round(i/n),e}set camera(e){e!==Hh&&Hh.copyFrom(e),Hh.computeUp(this.viewingMode),this.events.emit("before-camera-change",Hh);const r=this._camera;if(this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,Hh)&&(this._lastSeenCameraProjectionValues.copyFrom(Hh),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues)),!r.equals(Hh)&&(this._camera=this._propertiesPool.get("camera").copyFrom(Hh),this._cameraChanged=!r.almostEquals(Hh),this._cameraChanged)){const i=Y$e(()=>{this._cameraChanged=!1,i.remove()})}}get pixelRatio(){return this.camera.pixelRatio}get alignPixelEnabled(){return this.pixelRatio===this.rasterPixelRatio&&this.mode===ai.IDLE}get updating(){return!this.alignPixelEnabled}get contentCamera(){return this._contentCamera??this.camera}set contentCamera(e){this._contentCamera=e!=null?e.clone():null}get fixedContentCamera(){return this._contentCamera!=null}get isGlobal(){return this.viewingMode===at.Global}get isLocal(){return this.viewingMode===at.Local}get navigating(){return!(!this.cameraController||!this.cameraController.isInteractive)}get stationary(){return!this._cameraChanged&&!this.navigating}get cameraController(){return this._get("cameraController")}set cameraController(e){var r;this.stopActiveCameraController()?((r=this.cameraController)==null||r.destroy(),e&&(this.removeHandles(MTe),this.addHandles(du(()=>e.state===In.Finished||e.state===In.Stopped,()=>{this._set("cameraController",null),this.updateCamera(i=>e.onControllerEnd(i))},{sync:!0,once:!0}),MTe),e.onControllerStart(this.camera)),this._set("cameraController",e)):e&&(e.state=In.Rejected)}switchCameraController(e){return this.cameraController=e,e.state!==In.Rejected}stopActiveCameraController(){return!(this.cameraController&&!this.cameraController.stopController())}updateCamera(e){this._updateQueue.push(e),this._processUpdateQueue()}_processUpdateQueue(){if(this._updateQueue.length===0||this._processingUpdates)return;this._processingUpdates=!0;const e=this._updateQueue.shift();Hh.copyFrom(this._get("camera")),e(Hh),this.camera=Hh,this._processingUpdates=!1,this._processUpdateQueue()}_cameraProjectionChanged(e,r){return e.fov!==r.fov||e.fullViewport[0]!==r.fullViewport[0]||e.fullViewport[1]!==r.fullViewport[1]||e.fullViewport[2]!==r.fullViewport[2]||e.fullViewport[3]!==r.fullViewport[3]||e.padding[Tr.TOP]!==r.padding[Tr.TOP]||e.padding[Tr.RIGHT]!==r.padding[Tr.RIGHT]||e.padding[Tr.BOTTOM]!==r.padding[Tr.BOTTOM]||e.padding[Tr.LEFT]!==r.padding[Tr.LEFT]}};d([p()],zn.prototype,"mode",void 0),d([p({readOnly:!0,type:VP})],zn.prototype,"animation",null),d([p({type:Bt})],zn.prototype,"camera",null),d([p({type:Bt})],zn.prototype,"cssCamera",null),d([p()],zn.prototype,"_cssCamera",void 0),d([p()],zn.prototype,"_camera",void 0),d([p({readOnly:!0})],zn.prototype,"pixelRatio",null),d([p()],zn.prototype,"rasterPixelRatio",void 0),d([p()],zn.prototype,"contentPixelRatio",void 0),d([p({readOnly:!0})],zn.prototype,"alignPixelEnabled",null),d([p({readOnly:!0})],zn.prototype,"updating",null),d([p({})],zn.prototype,"_contentCamera",void 0),d([p({type:Bt})],zn.prototype,"contentCamera",null),d([p({readOnly:!0})],zn.prototype,"fixedContentCamera",null),d([p({readOnly:!0})],zn.prototype,"constraints",void 0),d([p({readOnly:!0})],zn.prototype,"events",void 0),d([p({readOnly:!0})],zn.prototype,"isGlobal",null),d([p({readOnly:!0})],zn.prototype,"isLocal",null),d([p({readOnly:!0})],zn.prototype,"viewingMode",void 0),d([p({readOnly:!0})],zn.prototype,"spatialReference",void 0),d([p()],zn.prototype,"navigating",null),d([p()],zn.prototype,"stationary",null),d([p()],zn.prototype,"_cameraChanged",void 0),d([p()],zn.prototype,"cameraController",null),zn=d([I("esri.views.3d.state.ViewState")],zn);const F9t=zn,Hh=new Bt,MTe="ViewStateHandles";let k9t=class{constructor(e,r,i){this.viewingMode=e,this._forEachLayer=r,this._view=i,this._externalIntersectionHandlers=new dr,this._tolerance=DP,this._tmpRay=la(),this._tmpRegion=lr(),this._validateHUDIntersector=hf(this.viewingMode),this._validateHUDIntersector.options.hud=!1}intersectScreen(e,r,i){return this.intersectRay(this._getPickRay(e,this._tmpRay),$Te(this.viewingMode),r,i)}intersectScreenFreePointFallback(e,r,i){return this.intersectRayFreePointFallback(this._getPickRay(e,this._tmpRay),r,i)}intersectRayFreePointFallback(e,r,i){return this.intersectRay(e,$Te(this.viewingMode),r,i)||this._intersectRayFreePointLocal(e,r)}intersectRay(e,r,i,n){return r.options.selectionMode=!1,r.options.store=Ia.MIN,this.computeIntersection(e,r,n),!!r.results.min&&r.results.min.getIntersectionPoint(i)}getCenterRayWithSubpixelOffset(e,r,i=.5,n=.5){return e.getRenderCenter(H6,i,n),H6[0]+=.0466,H6[1]-=.0123,_he(e,H6,r)}intersectIntersectorScreen(e,r,i){this.computeIntersection(this._getPickRay(e,this._tmpRay),r,i)}intersectToolIntersectorScreen(e,r,i){const n=this._getPickRay(e,this._tmpRay);this.intersectToolIntersectorRay(n,r,i)}intersectToolIntersectorRay(e,r,i){r.options.selectionMode=!0,this.computeIntersection(e,r,i);const n=r.results.min;this._view.basemapTerrain&&this._view.basemapTerrain.opaque||mg(n)&&n.intersector!==Sn.TERRAIN||(r.options.selectionMode=!1,this.computeIntersection(e,r,i))}setTolerance(e=DP){this._tolerance=e}addIntersectionHandler(e){this._externalIntersectionHandlers.push(e),this._externalIntersectionHandlers.sort((r,i)=>r.type===Sn.TERRAIN?1:i.type===Sn.TERRAIN?-1:0)}removeIntersectionHandler(e){this._externalIntersectionHandlers.removeUnordered(e)!=null&&this._externalIntersectionHandlers.sort((r,i)=>r.type===Sn.TERRAIN?1:i.type===Sn.TERRAIN?-1:0)}_getPickRay(e,r){const i=this._view.state.camera;return MUe(i,e,r)}_intersectRayFreePointLocal(e,r){return this.viewingMode!==at.Local||e==null||ge(r,e.origin,Se(ut.get(),e.direction)),!1}intersectElevationFromScreen(e,r,i=0,n=null){return this._intersectElevation(this._getPickRay(e,this._tmpRay),r,i,n)}_intersectElevation(e,r,i=0,n=null){if(e==null)return null;const s=r!=null?r.mode:"absolute-height",o=(r==null?void 0:r.offset)??0,a=s!=="on-the-ground"?o+i:0,l=a/this._view.renderCoordsHelper.unitInMeters;if(s==="absolute-height"){if(this._view.renderCoordsHelper.intersectInfiniteManifold(e,a,G6)){const w=this._view.computeMapPointFromVec3d(G6);return w.z??(w.z=0),w.z-=o,w}return null}const c=this._view.state.camera,u=ut.get();c.projectToRenderScreen(e.origin,u);const h=new ITe(null,this._forEachLayer),f=this._view.slicePlane,m=f!=null?T_e(f):null,g=hf(this.viewingMode);g.options.store=Ia.MIN,g.options.verticalOffset=l;const y=e.origin,_=ge(ut.get(),y,e.direction);g.reset(y,_,c),g.point=u;const b=n?"type"in n&&n.type==="graphics"?w=>w.layerUid!==n.uid:w=>w.graphicUid!==n.uid:null;switch(s){case"relative-to-scene":{const w=x=>(!b||b(x))&&!!x.lastValidElevationBB;g.intersect(h.layers,u,this._tolerance,null,w),this._externalIntersectionHandlers.forAll(x=>{if(x.type===Sn.I3S||x.type===Sn.TERRAIN){const S=x.slicePlaneEnabled?m:null;x.intersect(g,S,g.rayBegin,g.rayEnd,u)}});break}case"on-the-ground":case"relative-to-ground":this._externalIntersectionHandlers.forAll(w=>{if(w.isGround){const x=w.slicePlaneEnabled?m:null;w.intersect(g,x,g.rayBegin,g.rayEnd,u)}})}if(g.results.min.getIntersectionPoint(G6)){const w=this._view.computeMapPointFromVec3d(G6);return w.z=i,w}return null}computeIntersection(e,r,i){var g;if(e==null)return;const n=this._view.state.camera,s=ut.get();n.projectToRenderScreen(e.origin,s);const o=new ITe(i,this._forEachLayer);r.options.selectOpaqueTerrainOnly=!i||!("include"in i||"exclude"in i);const a=e.origin,l=ge(ut.get(),e.origin,e.direction);r.reset(a,l,n),r.intersect(o.layers,s,this._tolerance);const c=this._view.slicePlane,u=c!=null?T_e(c):null;r.intersect(o.sliceableLayers,s,this._tolerance,u);const h=i&&(i.requiresGroundFeedback||i.enableDraped);this._externalIntersectionHandlers.forAll(y=>{const _=y.layerUid,b=Array.isArray(_),w=b?_:[_];b&&(r.options.filteredLayerUids=[]);let x=!1;for(const S of w)o.filterLayerUid(S)?x=!0:b&&r.options.filteredLayerUids.push(S);if(r.options.isFiltered=!x,y.isGround&&h||!r.options.isFiltered){const S=y.slicePlaneEnabled?u:null;y.intersect(r,S,a,l,s)}});const f=ut.get(),m=this._view.basemapTerrain;if(i&&i.enableDraped&&m.spatialReference!=null&&r.results.ground.getIntersectionPoint(f)){const y=m.overlayManager.renderer,_=this._view.renderCoordsHelper.spatialReference,b=ut.get();this._view.renderCoordsHelper.fromRenderCoords(f,b,m.spatialReference),b[2]=((g=this._view.elevationProvider)==null?void 0:g.getElevation(f[0],f[1],f[2],_,"ground"))??0,y.intersect(r,b,r.results.ground,w=>o.filterRenderGeometry(w))}r.sortResults(),this._processHUDResults(r)}_processHUDResults(e){const r=e.results.hud;A_(this._tmpRegion,YQ);const i=this._view.state.camera,n=[],s=this._tmpRegion,o=b=>{const w=new z9t(b);i.projectToRenderScreen(b.target.center,w.screenPoint),w.screenPoint[0]=Math.floor(w.screenPoint[0]),w.screenPoint[1]=Math.floor(w.screenPoint[1]),n.push(w),SA(s,w.screenPoint)};e.sortResults(r.all),r.min.dist!=null&&o(r.min);for(const b of r.all)r.min.target.object!==b.target.object&&r.max.target.object!==b.target.object&&o(b);if(r.max.dist!=null&&r.max.target.object!==r.min.target.object&&o(r.max),!n.length)return;s[0]===s[2]&&(s[2]+=1),s[1]===s[3]&&(s[3]+=1);const a=i.fullWidth,l=i.fullHeight,c=Math.max(0,s[0]-tL),u=Math.max(0,s[1]-tL),h=Math.min(lh(s)+2*tL,a-c),f=Math.min(og(s)+2*tL,l-u),m=new Uint8Array(h*f*4);this._view._stage.renderer.readHUDVisibility(c,u,h,f,m);let g=!0;const y=e.results.max.dist==null;let _=0;for(const b of n)for(const w of U9t)if(m[4*(Math.min(b.screenPoint[0]+w[0],a)-s[0]+(Math.min(b.screenPoint[1]+w[1],l)-s[1])*h)]){g&&(e.results.min.copy(b.result),g=!1),y&&e.results.max.copy(b.result),e.options.store===Ia.ALL&&e.results.all.splice(_++,0,b.result);break}}};const tL=1,U9t=(()=>{const t=[],e=tL;for(let r=-e;r<=e;r++)for(let i=-e;i<=e;i++)t.push([i+e,r+e]);return t})();let z9t=class{constructor(e){this.result=e,this.screenPoint=ua()}},j6;function $Te(t){return j6&&j6.viewingMode===t||(j6=hf(t)),j6}let ITe=class{constructor(e,r){this.layers=new Array,this.sliceableLayers=new Array,this.include=e==null?void 0:e.include,this.exclude=e==null?void 0:e.exclude,r(i=>{i.pickable&&this.filterLayerUid(i.apiLayerUid)&&(i.sliceable?this.sliceableLayers:this.layers).push(i)})}filterLayerUid(e){const{include:r,exclude:i}=this;return e==null?r==null&&i==null:(r==null||r.has(e))&&(i==null||!i.has(e))}filterRenderGeometry(e){return this.filterLayerUid(e.layerUid)}};function LTe(t){return typeof t=="object"&&"intersect"in t}const G6=A(),H6=ua();let lSr=class{constructor(e,r){this.spatialReference=e,this._view=r}getElevation(e,r,i){return this._view.elevationProvider.getElevation(e,r,0,this.spatialReference,i)}async queryElevation(e,r,i,n,s){return this._view.elevationProvider.queryElevation(e,r,0,this.spatialReference,s,i,n)}},V9t=class{constructor(e,r,i,n){this.spatialReference=r,this._getElevationQueryProvider=i,this._queries=new Array,this._queryOptions={...n,ignoreInvisibleLayers:!0},this._frameTask=e.registerTask(Vt.ELEVATION_QUERY,this)}destroy(){this._frameTask.remove()}queryElevation(e,r,i,n=0){const s=Da(),o={x:e,y:r,minDemResolution:n,result:s,signal:i};return this._queries.push(o),Dl(i,()=>{Ble(this._queries,o),s.reject(Wr())}),s.promise}get running(){return this._queries.length>0}runTask(e){const r=this._queries;this._queries=[];const i=this._getElevationQueryProvider();if(!i)return r.forEach(u=>u.result.reject()),void e.madeProgress();const n=r.map(u=>[u.x,u.y]),s=r.reduce((u,h)=>Math.min(u,h.minDemResolution),1/0),o=new Y4({points:n,spatialReference:this.spatialReference}),a=r.length>1&&r.some(u=>!!u.signal)?new AbortController:null,l=a!=null?a.signal:r[0].signal;if(a!=null){let u=0;r.forEach(h=>Dl(h.signal,()=>{u++,h.result.reject(Wr()),u===r.length&&a.abort()}))}const c={...this._queryOptions,minDemResolution:s,signal:l};i.queryElevation(o,c).then(u=>{r.forEach((h,f)=>{h.signal!=null&&h.signal.aborted?h.result.reject(Wr()):h.result.resolve(u.geometry.points[f][2])})}).catch(u=>{r.forEach(h=>h.result.reject(u))}),e.madeProgress()}get test(){const e=this;return{update:()=>e._queries.length>0&&e.runTask(bc)}}},rL=class extends pn.EventedMixin(Ce){get spatialReference(){var e,r;return(r=(e=this.view)==null?void 0:e.basemapTerrain)==null?void 0:r.spatialReference}constructor(e){super(e),this._im=new Array,this._ground=new Array,this._scene=new Array,this._handles=new Map,this.lastElevationQuery=null,this.elevationCacheEnabled=!1}destroy(){this._elevationQueryCached=qe(this._elevationQueryCached)}get _elevationQuery(){return this._elevationQueryCached==null&&(this._elevationQueryCached=new V9t(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4})),this._elevationQueryCached}enableElevationCache(e){e||(this.lastElevationQuery=null),this.elevationCacheEnabled=e}getElevation(e,r,i,n,s){if(this.elevationCacheEnabled&&this.lastElevationQuery!=null){const a=this.lastElevationQuery;if(e===a.x&&r===a.y&&i===a.z&&So(n,a.spatialReference)&&s===a.queryContext)return a.result}let o=null;return o=q6(o,this._im,e,r,i,n,s),o==null&&(o=q6(o,this._ground,e,r,i,n,s)),s==="scene"&&(o=q6(o,this._scene,e,r,i,n,s)),this.elevationCacheEnabled&&(this.lastElevationQuery={x:e,y:r,z:i,spatialReference:n,queryContext:s,result:o}),o}getSphereElevationBounds(e,r){let i=1/0,n=-1/0;for(const s of[this._im,this._ground,this._scene])s.forEach(o=>{if(o.getSphereElevationBounds){const a=o.getSphereElevationBounds(e,r);a!=null&&(i=Math.min(i,a.min),n=Math.max(n,a.max))}});return{min:i,max:n}}queryElevation(e,r,i,n,s,o=null,a=0){const l=Da();return this._elevationQuery.queryElevation(e,r,o,a).then(c=>{s==="scene"&&(c=q6(c,this._scene,e,r,i,n,s)),l.resolve(c)}).catch(c=>{Yn(c)?l.reject(c):l.resolve(this.getElevation(e,r,i,n,s))}),l.promise}register(e,r){this._handles.set(r,r.on("elevation-change",i=>this.emit("elevation-change",i))),this._providersFromContext(e).push(r)}unregister(e){var r;this._handles.has(e)&&((r=this._handles.get(e))==null||r.remove(),this._handles.delete(e));for(const i of[this._im,this._ground,this._scene]){const n=i.indexOf(e);n>-1&&i.splice(n,1)}}_providersFromContext(e){switch(e){case"ground":return this._ground;case"im":return this._im;case"scene":return this._scene}}};function q6(t,e,r,i,n,s,o){for(const a of e){const l=a.getElevation(r,i,n,s,o);l!=null&&(t=t!=null?Math.max(l,t):l)}return t}d([p({constructOnly:!0})],rL.prototype,"view",void 0),d([p()],rL.prototype,"spatialReference",null),rL=d([I("esri.views.3d.support.CombinedElevationProvider")],rL);let iL=class Rne{static isValidProfile(e){return e in Rne.profiles}static getDefaultProfile(){return he("esri-iPhone")?"low":"medium"}static apply(e,r){const i=Rne.profiles[e];r.graphics3D.maxTotalNumberOfFeatures=i.graphics3D.maxTotalNumberOfFeatures,r.graphics3D.maxTotalNumberOfPrimitives=i.graphics3D.maxTotalNumberOfPrimitives,r.graphics3D.polygonLodFactor=i.graphics3D.polygonLodFactor,r.graphics3D.polylineLodFactor=i.graphics3D.polylineLodFactor,r.graphics3D.snapshotAvailable=i.graphics3D.snapshotAvailable,r.graphics3D.skipHighSymbolLods=i.graphics3D.skipHighSymbolLods;const n=r.sceneService.object,s=i.sceneService.object;n.lodFactor=s.lodFactor,n.lodCrossfadeinDuration=s.lodCrossfadeinDuration,n.lodCrossfadeoutDuration=s.lodCrossfadeoutDuration,n.lodCrossfadeUncoveredDuration=s.lodCrossfadeUncoveredDuration,r.sceneService.point.lodFactor=i.sceneService.point.lodFactor,r.sceneService.integratedMesh.lodFactor=i.sceneService.integratedMesh.lodFactor,r.sceneService.pointCloud.lodFactor=i.sceneService.pointCloud.lodFactor,r.sceneService.uncompressedTextureDownsamplingEnabled=i.sceneService.uncompressedTextureDownsamplingEnabled,r.tiledSurface.lodBias=i.tiledSurface.lodBias,r.tiledSurface.angledSplitBias=i.tiledSurface.angledSplitBias,r.tiledSurface.reduceTileLevelDifferences=i.tiledSurface.reduceTileLevelDifferences,r.tiledSurface.textureFadeDuration=i.tiledSurface.textureFadeDuration,r.heatmap.pixelRatio=i.heatmap.pixelRatio,r.heatmap.maxTotalNumberOfFeatures=i.heatmap.maxTotalNumberOfFeatures,r.fadeDuration=i.fadeDuration,r.antialiasingEnabled=i.antialiasingEnabled,r.physicallyBasedRenderingEnabled=i.physicalBasedRenderingEnabled,r.highQualityTransparency=i.highQualityTransparency,r.highResolutionAtmosphere=i.highResolutionAtmosphere,r.reflections=i.reflections,r.ambientOcclusion=i.ambientOcclusion,r.memoryLimit=i.memoryLimit,r.additionalCacheMemory=i.additionalCacheMemory,r.frameRate=i.frameRate,r.maximumPixelRatio=i.maximumPixelRatio}};function DTe(){const t=!!he("esri-mobile"),e=!!he("ios"),r=400;return{low:{graphics3D:{maxTotalNumberOfFeatures:25e3,maxTotalNumberOfPrimitives:85e4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25e3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},fadeDuration:0,antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?.8:1,polylineLodFactor:t?1.2:1.5,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:t},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!1,reflections:!1,ambientOcclusion:!1,memoryLimit:t?600:750,additionalCacheMemory:t?-100:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5e4,maxTotalNumberOfPrimitives:17e5,polygonLodFactor:t?1.2:2,polylineLodFactor:t?1.2:2,snapshotAvailable:!e,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5e4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:r},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!he("disable-feature:reduce-map-tile-levels"),textureFadeDuration:r},fadeDuration:r,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,highResolutionAtmosphere:!0,reflections:!0,ambientOcclusion:!0,memoryLimit:t?900:1500,additionalCacheMemory:t?-150:0,frameRate:0,maximumPixelRatio:t?1:1/0}}}iL.test={reset(){const t=DTe();for(const e of Object.keys(t))iL.profiles[e]=t[e]}},function(t){t.profiles=DTe()}(iL||(iL={}));const Uz=iL;function Oje(){return new Float32Array(4)}function B9t(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function y0(t,e,r,i){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function j9t(t,e){return new Float32Array(t,e,4)}function Aje(){return Oje()}function Pje(){return y0(1,1,1,1)}function Mje(){return y0(1,0,0,0)}function $je(){return y0(0,1,0,0)}function Ije(){return y0(0,0,1,0)}function Lje(){return y0(0,0,0,1)}const G9t=Aje(),H9t=Pje(),q9t=Mje(),W9t=$je(),X9t=Ije(),Y9t=Lje();Object.freeze(Object.defineProperty({__proto__:null,ONES:H9t,UNIT_W:Y9t,UNIT_X:q9t,UNIT_Y:W9t,UNIT_Z:X9t,ZEROS:G9t,clone:B9t,create:Oje,createView:j9t,fromValues:y0,ones:Pje,unitW:Lje,unitX:Mje,unitY:$je,unitZ:Ije,zeros:Aje},Symbol.toStringTag,{value:"Module"}));const NTe=new ht([0,255,255]),FTe=new ht([0,0,0]),kTe=1,UTe=.25,zTe=.4,VTe=.2;let ay=class extends Ce{constructor(){super(...arguments),this.color=NTe.clone(),this.haloColor=null,this.haloOpacity=kTe,this.fillOpacity=UTe,this.shadowOpacity=zTe,this.shadowColor=FTe.clone(),this.shadowDifference=VTe}static toEngineOptions(e){const r=ht.toUnitRGBA(e.color??NTe),i=e.haloColor!=null?ht.toUnitRGBA(e.haloColor):r,n=ht.toUnitRGBA(e.shadowColor??FTe),s=e.haloOpacity??kTe,o=e.fillOpacity??UTe,a=e.shadowOpacity??zTe,l=e.shadowDifference??VTe;return{color:y0(r[0],r[1],r[2],r[3]),haloColor:y0(i[0],i[1],i[2],i[3]),haloOpacity:s,haloOpacityOccluded:.25*s,fillOpacity:o,fillOpacityOccluded:.25*o,shadowOpacity:a,shadowColor:nr(n[0],n[1],n[2],n[3]),occludedShadowOpacity:a*(1-l)}}};d([p({type:ht})],ay.prototype,"color",void 0),d([p({type:ht})],ay.prototype,"haloColor",void 0),d([p()],ay.prototype,"haloOpacity",void 0),d([p()],ay.prototype,"fillOpacity",void 0),d([p()],ay.prototype,"shadowOpacity",void 0),d([p({type:ht})],ay.prototype,"shadowColor",void 0),d([p()],ay.prototype,"shadowDifference",void 0),ay=d([I("esri.views.3d.support.HighlightOptions")],ay);const One=ay;function Z9t(t,e){return e?{...e,query:{...t??{},...e.query}}:{query:t}}function J9t(t){return typeof t=="string"?Ts(t):ie(t)}function K9t(t,e,r){const i={};for(const n in t){if(n==="declaredClass")continue;const s=t[n];if(s!=null&&typeof s!="function")if(Array.isArray(s)){i[n]=[];for(let o=0;o<s.length;o++)i[n][o]=K9t(s[o])}else if(typeof s=="object")if(s.toJSON){const o=s.toJSON(r&&r[n]);i[n]=e?o:JSON.stringify(o)}else i[n]=e?s:JSON.stringify(s);else i[n]=s}return i}function pSr(t){return{geometryType:Qce(t[0]),geometries:t.map(e=>e.toJSON())}}function Q9t(t,e,r){const i=sgt(e);return t.map(n=>{const s=i.fromJSON(n);return s.spatialReference=r,s})}let oT=class extends me{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(n=>n.toJSON()),r=this.geometries[0],i={};return i.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON()),i.inSR=r.spatialReference.wkid||JSON.stringify(r.spatialReference.toJSON()),i.geometries=JSON.stringify({geometryType:Qce(r),geometries:e}),this.transformation&&(i.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),this.transformForward!=null&&(i.transformForward=this.transformForward),i}};d([p()],oT.prototype,"geometries",void 0),d([p({json:{read:{source:"outSR"}}})],oT.prototype,"outSpatialReference",void 0),d([p()],oT.prototype,"transformation",void 0),d([p()],oT.prototype,"transformForward",void 0),oT=d([I("esri.rest.support.ProjectParameters")],oT);const Gpe=oT,eVt=ls(Gpe);async function Dje(t,e,r){e=eVt(e);const i=J9t(t),n={...i.query,f:"json",...e.toJSON()},s=e.outSpatialReference,o=Qce(e.geometries[0]),a=Z9t(n,r);return ti(i.path+"/project",a).then(({data:{geometries:l}})=>Q9t(l,o,s))}async function Hpe(t=null,e){var n,s;if(Ti.geometryServiceUrl)return Ti.geometryServiceUrl;if(!t)throw new H("internal:geometry-service-url-not-configured");let r;r="portal"in t?t.portal||Ns.getDefault():t,await r.load({signal:e});const i=(s=(n=r.helperServices)==null?void 0:n.geometry)==null?void 0:s.url;if(!i)throw new H("internal:geometry-service-url-not-configured");return i}async function tVt(t,e,r=null,i){const n=await Hpe(r,i),s=new Gpe;s.geometries=[t],s.outSpatialReference=e;const o=await Dje(n,s,{signal:i});if(o&&Array.isArray(o)&&o.length===1)return o[0];throw new H("internal:geometry-service-projection-failed")}const rVt=Object.freeze(Object.defineProperty({__proto__:null,getGeometryServiceURL:Hpe,projectGeometry:tVt},Symbol.toStringTag,{value:"Module"}));let iVt=class{constructor(e,r){this.spatialReference=r,this.unitInMeters=Pc(this.spatialReference,Xr(this.spatialReference).metersPerDegree),this._geometryServiceURLPromise=Hpe(e&&e.get("portalItem")).catch(()=>{throw new H("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config")})}async toGeographic(e){const r=await this._geometryServiceURLPromise;let i,n=!0;Array.isArray(e[0])&&typeof e[0]!="number"?i=e:(i=[e],n=!1);const s=i.map(l=>l instanceof Gt?l:new Gt(l,this.spatialReference)),o=new Gpe({geometries:s,outSpatialReference:dt.WGS84}),a=(await Dje(r,o)).map(l=>l.type==="point"?[l.x,l.y]:void 0).filter(l=>!!l);return n?a:a[0]}},mm=class extends Ce{constructor(){super(...arguments),this.minTotalNumberOfFeatures=2e3,this.maxTotalNumberOfFeatures=5e4,this.maxTotalNumberOfPrimitives=17e5,this.snapshotAvailable=!0,this.polygonLodFactor=1,this.polylineLodFactor=1,this.skipHighSymbolLods=!1}};d([p()],mm.prototype,"minTotalNumberOfFeatures",void 0),d([p()],mm.prototype,"maxTotalNumberOfFeatures",void 0),d([p()],mm.prototype,"maxTotalNumberOfPrimitives",void 0),d([p()],mm.prototype,"snapshotAvailable",void 0),d([p()],mm.prototype,"polygonLodFactor",void 0),d([p()],mm.prototype,"polylineLodFactor",void 0),d([p()],mm.prototype,"skipHighSymbolLods",void 0),mm=d([I("esri.views.3d.support.QualitySettings.Graphics3DSettings")],mm);let e0=class extends Ce{constructor(){super(...arguments),this.lodFactor=1}};d([p()],e0.prototype,"lodFactor",void 0),e0=d([I("esri.views.3d.support.QualitySettings.LoDFactorSettings")],e0);let hj=class extends e0{constructor(){super(...arguments),this.lodCrossfadeinDuration=0,this.lodCrossfadeoutDuration=0,this.lodCrossfadeUncoveredDuration=0}};hj=d([I("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],hj);let Pv=class extends Ce{constructor(){super(...arguments),this.object=new hj,this.point=new e0,this.integratedMesh=new e0,this.pointCloud=new e0,this.uncompressedTextureDownsamplingEnabled=!1}};d([p({type:hj})],Pv.prototype,"object",void 0),d([p({type:e0})],Pv.prototype,"point",void 0),d([p({type:e0})],Pv.prototype,"integratedMesh",void 0),d([p({type:e0})],Pv.prototype,"pointCloud",void 0),d([p()],Pv.prototype,"uncompressedTextureDownsamplingEnabled",void 0),Pv=d([I("esri.views.3d.support.QualitySettings.SceneServiceSettings")],Pv);let Gb=class extends Ce{constructor(){super(...arguments),this.lodBias=0,this.angledSplitBias=1,this.reduceTileLevelDifferences=!0,this.textureFadeDuration=400}};d([p()],Gb.prototype,"lodBias",void 0),d([p()],Gb.prototype,"angledSplitBias",void 0),d([p()],Gb.prototype,"reduceTileLevelDifferences",void 0),d([p()],Gb.prototype,"textureFadeDuration",void 0),Gb=d([I("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],Gb);let nA=class extends Ce{constructor(){super(...arguments),this.pixelRatio=1,this.maxTotalNumberOfFeatures=5e4}};d([p()],nA.prototype,"pixelRatio",void 0),d([p()],nA.prototype,"maxTotalNumberOfFeatures",void 0),nA=d([I("esri.views.3d.support.QualitySettings.HeatmapSettings")],nA);let Wa=class extends Ce{constructor(){super(...arguments),this.graphics3D=new mm,this.sceneService=new Pv,this.tiledSurface=new Gb,this.heatmap=new nA,this.fadeDuration=400,this.antialiasingEnabled=!0,this.physicallyBasedRenderingEnabled=!1,this.highQualityTransparency=!0,this.highResolutionAtmosphere=!1,this.reflections=!1,this.ambientOcclusion=!1,this.memoryLimit=750,this.additionalCacheMemory=0,this.frameRate=void 0,this.maximumPixelRatio=1/0}};d([p({type:mm})],Wa.prototype,"graphics3D",void 0),d([p({type:Pv})],Wa.prototype,"sceneService",void 0),d([p({type:Gb})],Wa.prototype,"tiledSurface",void 0),d([p({type:nA})],Wa.prototype,"heatmap",void 0),d([p()],Wa.prototype,"fadeDuration",void 0),d([p()],Wa.prototype,"antialiasingEnabled",void 0),d([p()],Wa.prototype,"physicallyBasedRenderingEnabled",void 0),d([p()],Wa.prototype,"highQualityTransparency",void 0),d([p()],Wa.prototype,"highResolutionAtmosphere",void 0),d([p()],Wa.prototype,"reflections",void 0),d([p()],Wa.prototype,"ambientOcclusion",void 0),d([p()],Wa.prototype,"memoryLimit",void 0),d([p()],Wa.prototype,"additionalCacheMemory",void 0),d([p()],Wa.prototype,"frameRate",void 0),d([p()],Wa.prototype,"maximumPixelRatio",void 0),Wa=d([I("esri.views.3d.support.QualitySettings.QualitySettings")],Wa);const BTe=Wa;function nVt(t){return b3(t)&&t.length>=3}function sVt(t){return(w3(t)||Array.isArray(t))&&t.length>=3}function oVt(t){return nVt(t)||sVt(t)}let aVt=class Ane{constructor(e,r,i,n){this.viewingMode=e,this.spatialReference=r,this.unitInMeters=i,this._coordinateSystem=n,this._tmpCoordinateSystem=ITt(n)}set extent(e){e&&LTt(this._coordinateSystem,e,this._coordinateSystem)}getAltitude(e){return BTt(this._coordinateSystem,e)}setAltitude(e,r,i=e){return ske(this._coordinateSystem,i,r,e)}setAltitudeOfTransformation(e,r){jTt(this._coordinateSystem,r,e,r)}worldUpAtPosition(e,r){return kTt(this._coordinateSystem,e,r)}worldBasisAtPosition(e,r,i){return UTt(this._coordinateSystem,e,r,i)}basisMatrixAtPosition(e,r){const i=this.worldBasisAtPosition(e,od.X,ut.get()),n=this.worldBasisAtPosition(e,od.Y,ut.get()),s=this.worldBasisAtPosition(e,od.Z,ut.get());return S0(r,i[0],i[1],i[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,0,0,0,1),r}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,ut.get()),n=this.worldBasisAtPosition(e,od.Y,ut.get()),s=UFe(r,n,i);return Oc(s)}intersectManifoldClosestSilhouette(e,r,i){return AX(this._coordinateSystem,r,this._tmpCoordinateSystem),VTt(this._tmpCoordinateSystem,e,i),i}intersectManifold(e,r,i){AX(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=ut.get();return zTt(this._tmpCoordinateSystem,e,n)?oe(i,n):null}intersectInfiniteManifold(e,r,i){if(this.viewingMode===at.Global)return this.intersectManifold(e,r,i);AX(this._coordinateSystem,r,this._tmpCoordinateSystem);const n=this._tmpCoordinateSystem.value,s=ut.get();return zE(n.plane,e,s)?oe(i,s):null}toRenderCoords(e,r,i){return fB(e)?Na(e,r,this.spatialReference):Ys(e,r,i,this.spatialReference)}fromRenderCoords(e,r,i=null){return fB(r)?(i!=null&&(r.spatialReference=i),aue(e,this.spatialReference,r)):oVt(r)?Ys(e,this.spatialReference,r,i)?r:null:M_(e,this.spatialReference,r)}static create(e,r){switch(e){case at.Local:return new Ane(at.Local,r,Pc(r),FTt());case at.Global:return new Ane(at.Global,r,1,NTt(r))}}static renderUnitScaleFactor(e,r){return V0e(e)/V0e(r)}};var $y;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.BASEMAP=1]="BASEMAP",t[t.I3S_INDEX=2]="I3S_INDEX",t[t.I3S_DATA=3]="I3S_DATA",t[t.SYMBOLOGY=4]="SYMBOLOGY"})($y||($y={}));const lVt=(()=>{const t=new Array;return t[$y.ELEVATION]=10,t[$y.BASEMAP]=10,t[$y.I3S_INDEX]=10,t[$y.I3S_DATA]=10,t[$y.SYMBOLOGY]=5,t})(),cVt=30;function Nje(t){return"usedMemory"in t&&"unloadedMemory"in t&&"ignoresMemoryFactor"in t}function uVt(t){return new Gc({view:t})}const W6=1,LZ=1,dVt=.75,hVt=.6,jTe=1.3;let Gc=class extends Ce{constructor(e){super(e),this._quality=1,this._usedMemory=0,this._updating=!1,this.minQuality=.1,this._stableQuality=0,this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._memoryPredicted=0,this._cacheStorage=new fVe,this._warnMemoryUsage=null,this._numQualityChanges=0,this._maxMemory=750,this._additionalCacheMemory=0}destroy(){this._cacheStorage.destroy()}set maxMemory(e){e==null||e<=0||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<e&&this._updateQuality(W6),this._maxMemory=e)}get maxMemory(){return this._maxMemory}set additionalCacheMemory(e){e!=null&&(this._additionalCacheMemory=e)}get additionalCacheMemory(){return this._additionalCacheMemory}get memoryFactor(){return this._quality}get updating(){return this._updating}get usedMemory(){return this._usedMemory}newCache(e,r){return new G4t(e,this._cacheStorage,r)}resetStableQuality(){this._stableQuality=0}disableMemCache(){this.additionalCacheMemory=-4096}update(){if(this._updateMemory(),this._memoryPredicted<=0&&!this._updating)return;let e=this._layersUpdating();if(this._memoryPredicted<hVt&&this._canFastRecover)this._downscaleMemoryUsed=0,this._stableQuality=0,this._canFastRecover=!1,this._updateQuality(W6);else if(e)(this._memoryPredicted>1.1*LZ||this._usedMemory>LZ)&&(this._stableQuality>0?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._usedMemory&&(this._updateQuality(this._quality/jTe),this._downscaleMemoryUsed=this._usedMemory,this._canFastRecover=!1));else if(this._downscaleMemoryUsed=0,this._usedMemory>LZ)this._stableQuality=0,this._canFastRecover=!1,e=this._updateQuality(this._quality/jTe),this._downscaleMemoryUsed=this._memoryPredicted;else if(this._stableQuality!==this._quality)if(this._usedMemory<dVt&&this._quality<W6){this._stableQuality=this._quality;const r=.05;e=this._updateQuality(this._quality+r)}else this._quality<1&&(this._canFastRecover=!0);this._updating=e}_updateQuality(e){return(e=Math.min(Math.max(e,this.minQuality),W6))!==this._quality&&(this._quality=e,++this._numQualityChanges,!0)}_layersUpdating(){return this.view.allLayerViews.some(e=>!!e.updating)}_updateMemory(){var a,l;if(!this.view)return;let e=0;this.view.basemapTerrain&&(e+=this.view.basemapTerrain.usedMemory);const r=((a=this.view)==null?void 0:a._stage)&&this.view._stage.renderView&&((l=this.view._stage.renderer)==null?void 0:l.edgeView);r!=null&&(e+=r.usedMemory);let i=0;this.view.allLayerViews&&this.view.allLayerViews.forEach(c=>{if(Nje(c)){const u=c.ignoresMemoryFactor?this._quality:1;e+=c.usedMemory*u,i+=c.unloadedMemory*u}});const n=this._warnMemoryUsage==null||Math.round(10*e)!==Math.round(10*this._warnMemoryUsage),s=1048576*this.maxMemory;if(e>s&&n){this._warnMemoryUsage=e;const c=h=>(h/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB",u=Math.round(100*this._quality);re.getLogger(this).warn(`Memory Limit exceeded! Limit: ${c(s)} Current: ${c(e)} Projected: ${c(e+i)} Quality: ${u}%`)}this._usedMemory=e/s,this._memoryPredicted=(e+i)/s;const o=s-e;this._cacheStorage.maxSize=Math.max(0,o+1048576*this.additionalCacheMemory)}get test(){const e=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const r=e._numQualityChanges;return e._numQualityChanges=0,r}}}};d([p({constructOnly:!0})],Gc.prototype,"view",void 0),d([p()],Gc.prototype,"maxMemory",null),d([p()],Gc.prototype,"additionalCacheMemory",null),d([p()],Gc.prototype,"memoryFactor",null),d([p()],Gc.prototype,"updating",null),d([p()],Gc.prototype,"usedMemory",null),d([p()],Gc.prototype,"_quality",void 0),d([p()],Gc.prototype,"_usedMemory",void 0),d([p()],Gc.prototype,"_updating",void 0),d([p()],Gc.prototype,"_stableQuality",void 0),d([p()],Gc.prototype,"_maxMemory",void 0),d([p()],Gc.prototype,"_additionalCacheMemory",void 0),Gc=d([I("esri.views.3d.support.MemoryController")],Gc);let pVt=class{constructor(e){this.client=e,this._cancelled=!1,this.size=0,this.duration=0}},fVt=class{constructor(e){this.typeWorkerQuota=e,this.tasks=new Array,this.numWorkers=0,this.statistics=new mVt}},mVt=class{constructor(){this.requests=0,this.size=0,this.duration=0,this.speed=0}},gVt=class{constructor(e,r,i,n){this._workerFunc=e,this._callbackFunc=r,this._maxTotalNumWorkers=i,this._totalNumWorkers=0,this._clients=n.map(s=>new fVt(s))}destroy(){this._clients.length=0}hasQuota(e){const r=this._clients[e];return!!r&&(this._totalNumWorkers<this._maxTotalNumWorkers||r.numWorkers+r.tasks.length<r.typeWorkerQuota)}push(e){const r=this._clients[e.client];r&&(this._totalNumWorkers<this._maxTotalNumWorkers?(r.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(i,n)=>this._taskCallback(i,n))):r.tasks.push(e))}cancel(e){this._taskFinished(e),e._cancelled=!0}_taskFinished(e){const r=this._clients[e.client];this._totalNumWorkers--,r&&(r.numWorkers--,r.statistics.requests++,r.statistics.size+=e.size||0,r.statistics.duration+=e.duration||0,r.statistics.speed=r.statistics.duration>0?r.statistics.size/r.statistics.duration:0,It(r.numWorkers>=0)),this._next()}_next(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))return}_processQueue(e){for(;e.tasks.length>0;)if(this._workerFunc(e.tasks.shift(),(r,i)=>this._taskCallback(r,i)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1}_taskCallback(e,r){e._cancelled||(this._callbackFunc(e,r),this._taskFinished(e))}getStatsForType(e){const r=this._clients[e];return r?{quota:r.typeWorkerQuota,workers:r.numWorkers,queueSize:r.tasks.length,requestStats:r.statistics}:null}get test(){const e=this;return{set workerFunc(r){e._workerFunc=r}}}},zz=class extends Ce{constructor(){super(...arguments),this._tasks=new Map,this._onLoadQueue=new Array,this._doneQueue=new Array,this.updating=!1}setup(e,r,i){this._loadQueue=new gVt((n,s)=>this._startLoading(n,s),(n,s)=>this._doneLoadingCB(n,s),e,r),i&&(this._frameTask=i.registerTask(Vt.STREAM_DATA_LOADER,this))}destroy(){this._frameTask=yi(this._frameTask),this._tasks.forEach(e=>xc(e.abortController)),this._loadQueue=qe(this._loadQueue),this._onLoadQueue=null,this._doneQueue=null,this._tasks=null}hasDownloadSlots(e){return this._loadQueue.hasQuota(e)}request(e,r,i,n={}){const s=Da();s.__signal=n!=null?n.signal:null;const o=this._createOrUpdateTask(e,r,i,n,s);return Dl(n,()=>this._cancelRequest(o,s)),s.promise}_createTask(e,r,i,n,s,o){const a=new _Vt(e,r,i,n,s);return this._updateTask(a,o),this._tasks.set(s,a),this._tasks.size===1&&this._set("updating",!0),this._loadQueue.push(a),a}_cancelRequest(e,r){var i;fN(e.resolvers,r),r.reject(Wr()),e.resolvers.length===0&&(e.status===yp.DOWNLOADING&&(e.status=yp.CANCELLED,this._loadQueue.cancel(e),(i=e.abortController)==null||i.abort(),e.request=null,e.abortController=null),e.status=yp.CANCELLED,this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1))}_updateTask(e,r){e.resolvers.push(r)}_createOrUpdateTask(e,r,i,n,s){const o=bVt(n!=null&&n.uid||e,r,i),a=this._tasks.get(o);return a?(this._updateTask(a,s),a):this._createTask(e,n,r,i,o,s)}_doneLoadingCB(e,r){this._loadQueue&&(It(e.status===yp.DOWNLOADING),e.status=yp.DOWNLOADED,this._frameTask?this._doneQueue.push({task:e,err:r}):this._doneLoading(e,r))}get running(){return this._doneQueue.length>0||this._onLoadQueue.length>0}runTask(e){for(;!e.done&&this._onLoadQueue.length>0;){const r=this._onLoadQueue.shift();vr(r.task.abortController),r.task.abortController=null,r.callback(r.task),e.madeProgress()}for(;!e.done&&this._doneQueue.length>0;){const r=this._doneQueue.shift();r.task.status!==yp.DOWNLOADED&&(r.err=r.err||Wr()),this._doneLoading(r.task,r.err),e.madeProgress()}}_doneLoading(e,r){if(r&&!Yn(r)&&e.numRetries>0)return--e.numRetries,void this._loadQueue.push(e);let i=e.result instanceof HTMLImageElement?0:e.resolvers.length;for(const n of e.resolvers)if(r)Yn(r)?n.reject(r):n.reject(new H("stream-data-loader:request-error",`Failed to request resource at '${e.url}'. ${r}`,{url:e.url,error:r}));else{--i;const s=i<=0?e.result:ie(e.result);n.resolve(s)}this._tasks.delete(e.key),this._tasks.size===0&&this._set("updating",!1)}_startLoading(e,r){if(e.status===yp.CANCELLED)return!1;let i,n;switch(e.startTime=performance.now(),e.status=yp.DOWNLOADING,e.docType){case"binary":n="array-buffer",i=0;break;case"image":n="image";break;case"image+type":n="array-buffer";break;default:n="json"}e.abortController=new AbortController;const s=e.abortController.signal;e.request=ti(e.url,{...e.options,responseType:n,timeout:i,signal:s});let o=()=>{};const a=c=>{e.duration=performance.now()-e.startTime,e.size=c instanceof ArrayBuffer?c.byteLength:e.size||0,e.result=c,this._frameTask?this._onLoadQueue.push({callback:r,task:e}):(e.abortController=null,r(e))},l=c=>{e.status===yp.DOWNLOADING&&r(e,c),o()};return e.docType!=="image+type"?(e.request.then(c=>a(c.data),l),!0):(e.request.then(c=>{const u=c.data,h=vVt(u);if(n="image",e.size=u.byteLength,h==="unknown")return e.request=ti(e.url,{responseType:n,timeout:i,signal:s}),void e.request.then(g=>a(g.data),l);const f=new Blob([u],{type:h}),m=window.URL.createObjectURL(f);o=()=>window.URL.revokeObjectURL(m),e.request=ti(m,{responseType:n,timeout:i,signal:s}),e.request.then(g=>a(new lq(g.data,h,o)),l)},l),!0)}get test(){return{loadQueue:this._loadQueue}}};d([p({readOnly:!0})],zz.prototype,"updating",void 0),zz=d([I("esri.views.3d.support.StreamDataLoader")],zz);const yVt={numRetries:0};function vVt(t){if(t.byteLength<2)return"unknown";const e=new Uint8Array(t,0,t.byteLength);return e[0]===137&&e[1]===80?"image/png":e[0]===71&&e[1]===73?"image/gif":e[0]===66&&e[1]===77?"image/bmp":e[0]===255&&e[1]===216?"image/jpeg":"unknown"}let lq=class{constructor(e,r,i){this.image=e,this.type=r,this.release=i}get isOpaque(){return this.type==="image/jpeg"}},_Vt=class extends pVt{constructor(e,r,i,n,s){super(n),this.url=e,this.options=r,this.docType=i,this.key=s,this.result=null,this.status=yp.QUEUED,this.request=null,this.abortController=null,this.resolvers=new Array,this.startTime=0,this.numRetries=yVt.numRetries}};function bVt(t,e,r){return`${t}:${e}:${r}`}var yp;(function(t){t[t.QUEUED=1]="QUEUED",t[t.DOWNLOADING=2]="DOWNLOADING",t[t.DOWNLOADED=3]="DOWNLOADED",t[t.CANCELLED=4]="CANCELLED"})(yp||(yp={}));let Vz=class extends Ce{constructor(){super(...arguments),this.updating=!1}};function wVt(t){return new em({view:t})}d([p({readOnly:!0})],Vz.prototype,"updating",void 0),Vz=d([I("esri.views.3d.support.ResourceControllerMain")],Vz);let em=class extends Vz{constructor(){super(...arguments),this._immediateTask=FP,this._normalTask=FP,this._updatingObjects=NN([]),this._frameTask=null}get immediate(){return this._immediateTask}get normal(){return this._normalTask}initialize(){this._scheduler=qSt(),this._memoryController=uVt(this.view),this._streamDataLoader=new zz,this._streamDataLoader.setup(cVt,lVt,this._scheduler),this.addHandles([pe(()=>{var e;return(e=this.view.state)==null?void 0:e.mode},e=>{e!=null&&(this._scheduler.state=e)},li),pe(()=>this.view.stationary,()=>this._stationaryChangedHandler())]),this._frameTask=hP({update:e=>this._frame(e)}),this._immediateTask=this._scheduler.registerTask(Vt.RESOURCE_CONTROLLER_IMMEDIATE),this._normalTask=this._scheduler.registerTask(Vt.RESOURCE_CONTROLLER)}destroy(){this._immediateTask.remove(),this._normalTask.remove(),this._frameTask=yi(this._frameTask),this._streamDataLoader=qe(this._streamDataLoader),this._memoryController=qe(this._memoryController),this._scheduler=qe(this._scheduler),this.view=null}get updating(){var e,r,i,n;return!!((e=this._memoryController)!=null&&e.updating||(r=this._streamDataLoader)!=null&&r.updating||(i=this._immediateTask)!=null&&i.updating)||((n=this._updatingObjects)==null?void 0:n.value.some(s=>s.updating))}get scheduler(){return this._scheduler}get memoryController(){return this._memoryController}createStreamDataRequester(e){const r=this._streamDataLoader;return{request:(i,n,s)=>r.request(i,n,e,s),get busy(){return!r.hasDownloadSlots(e)}}}addUpdatingObject(e){const r=this._updatingObjects;return r.value=[...r.value,e],kl(()=>{r.value=r.value.filter(i=>i!==e)})}_frame(e){this.view.suspended||this.view.stateManager&&(this.view.stateManager.step(lce(e.deltaTime)),!this._scheduler)||(this._scheduler.updateBudget(e)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update())}_stationaryChangedHandler(){this.memoryController.resetStableQuality()}get test(){return{getQueueStats:e=>this._streamDataLoader.test.loadQueue.getStatsForType(e)}}};d([p()],em.prototype,"view",void 0),d([p()],em.prototype,"_scheduler",void 0),d([p()],em.prototype,"_memoryController",void 0),d([p()],em.prototype,"_streamDataLoader",void 0),d([p()],em.prototype,"_immediateTask",void 0),d([p()],em.prototype,"_normalTask",void 0),d([p()],em.prototype,"_updatingObjects",void 0),d([p({readOnly:!0})],em.prototype,"updating",null),em=d([I("esri.views.3d.support.ResourceControllerImpl")],em);function xVt(t){return Nje(t)}function SVt(t){return"performanceInfo"in t}var Cl,Ft;(function(t){t[t.INSIDE=0]="INSIDE",t[t.INTERSECTS=1]="INTERSECTS",t[t.OUTSIDE=2]="OUTSIDE"})(Cl||(Cl={})),function(t){t[t.NORTH=0]="NORTH",t[t.NORTH_EAST=1]="NORTH_EAST",t[t.EAST=2]="EAST",t[t.SOUTH_EAST=3]="SOUTH_EAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTH_WEST=5]="SOUTH_WEST",t[t.WEST=6]="WEST",t[t.NORTH_WEST=7]="NORTH_WEST"}(Ft||(Ft={}));const YC=A(),TVt=A(),j0=A(),G0=A();function EVt(t,e,r=0){const i=t.extent;if(i==null)return!1;if(r===0)return PLe(i,e);const n=Math.min(i[2]-i[0],i[3]-i[1]);return Hmt(i,e,r*n)}function X6(t,e,r,i){oe(YC,r),YC[i]=e[i];const n=ve(YC,YC,e),s=ve(TVt,t,e),o=ye(s,n),a=ye(n,n);let l;l=o<=0?e:a<=o?r:ge(YC,e,ce(n,n,o/a));const c=ve(YC,t,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function CVt(t,e,r){const i=t.extent;if(i==null)return 0;j0[0]=i[0],j0[1]=i[1],j0[2]=r,G0[0]=i[2],G0[1]=i[3],G0[2]=r;let n=1/0,s=1/0;return e[0]<j0[0]?n=X6(e,j0,G0,0):e[0]>G0[0]&&(n=X6(e,G0,j0,0)),e[1]<j0[1]?s=X6(e,j0,G0,1):e[1]>G0[1]&&(s=X6(e,G0,j0,1)),Math.min(n,s)}function RVt(t,e,r){if(t==null)return Ide();if(t.spatialReference.isGeographic&&!Kw(t.spatialReference))return new H("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");const i=Qu.checkUnsupported(t);if(i!=null)return i;if(r==null)return new H("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");const n=OVt(t,r);if(n)return n;const s=t.spatialReference;return e==null||s.equals(e)||e.isWGS84&&s.isWebMercator?null:new H("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}function OVt(t,e){const r=t.lods,i=r[0].resolution*2**r[0].level,n=[i*t.size[0],i*t.size[1]],s=[t.origin.x,t.origin.y],o=OLe(e),a=lr();Qu.computeRowColExtent(o,n,s,a);const l=(a[2]-a[0])*(a[3]-a[1]);if(l>WO){const c=r[0].scale*2**r[0].level;let u=Math.max((o[3]-o[1])/t.size[1],(o[2]-o[0])/t.size[0])*c/i;const h=Math.floor(Math.log(u)/Math.log(10));return u=Math.ceil(u/10**h)*10**h,new H("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+u.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:u,requiredNumRootTiles:l,allowedNumRootTiles:WO})}return null}const AVt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:RVt,isInsideExtent:EVt,tiltToExtentEdge:CVt},Symbol.toStringTag,{value:"Module"}));function PVt(){return!0}function MVt(){return 0}function $Vt(t,e){if(t==null)return Ide();const r=t.lods.length-1,i=t.spatialReference,n=Kw(i)||w0(i)||x0(i);if(i.isWebMercator){if(!Qu.makeWebMercatorAuxiliarySphere(r).compatibleWith(t))return new H("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!n)return new H("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!Qu.makeGCSWithTileSize(t.spatialReference,t.size[0],r).compatibleWith(t))return t.spatialReference.isWGS84?new H("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new H("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}return e==null||t.spatialReference.equals(e)?void 0:new H("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}const IVt=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:$Vt,isInsideExtent:PVt,tiltToExtentEdge:MVt},Symbol.toStringTag,{value:"Module"})),LVt={[at.Global]:IVt,[at.Local]:AVt};function xy(t,e){t||console.warn("Terrain: "+e)}let _o=!1,pj=!1;function DVt(t){pj=t,_o=_o||t}function NVt(t){_o=t}function Ne(t,e){var r;if(_o&&!t){const i=(r=new Error().stack)==null?void 0:r.slice(5);throw console.warn("Terrain internal: "+(e??"")+" at "+i),new Error("Assertion failed"+(e?": "+e:""))}}function Pne(t){return cq(t)?{fullExtent:t.fullExtent,minScale:t.layer.minScale,maxScale:t.layer.maxScale,tilemapCache:null}:t.layer}function fj(t){return(t==null?void 0:t.type)==="imagery-tile"||(t==null?void 0:t.type)==="wcs"}function cq(t){return(t==null?void 0:t.type)==="imagery-tile-3d"}function qpe(t){return(t==null?void 0:t.type)==="tile-3d"}function s4(t){return(t==null?void 0:t.type)==="vector-tile-3d"}function Fje(t){return(t==null?void 0:t.type)==="wmts-3d"}function Mne(t){return(t==null?void 0:t.type)==="elevation-3d"}function v$(t){return(t==null?void 0:t.type)==="group"}function mj(t){return t&&(qpe(t)||Fje(t)||cq(t)||s4(t))}function $ne(t){return t&&(qpe(t)||cq(t)||s4(t)||Fje(t))}function o4(t){return $ne(t)||Mne(t)}function FVt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="raster-tile"}function kje(t){return Uje(t==null?void 0:t.sourceLayerInfo)}function kVt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e!=null&&"type"in e&&e.type==="tile-texture"}function UVt(t){var r;const e=(r=t==null?void 0:t.sourceLayerInfo)==null?void 0:r.data;return e instanceof HTMLImageElement||e instanceof lq||e instanceof HTMLCanvasElement||e instanceof ImageData}function Uje(t){return(t==null?void 0:t.data)!=null&&"type"in t.data&&t.data.type==="vector-tile"}function FA(t){return t!=null&&"release"in t&&t.release(),null}function GTe(t){return t.fetchTile&&t.hasOverriddenFetchTile!==!1}function Wpe(t,e,r,i){return LVt[i].checkIfTileInfoSupportedForViewSR(t,r,e)}function uq(t,e,r){let i=null,n=null;if((t==null?void 0:t.type)==="wmts"){const s=zVt(t,e,r);i=s.tileInfo,n=s.fullExtent}else{n=fj(t)?t.getCompatibleFullExtent(e):t.fullExtent;const s=r===at.Local;if(fj(t))i=t.getCompatibleTileInfo(e,n,s);else if((t==null?void 0:t.type)==="vector-tile"){const o=s&&!VVt(e)||BVt.force512VTL,a=t.tileInfo.spatialReference.isGeographic;i=o?t.tileInfo:t.tileInfo.getOrCreateCompatible(256,a?1:2)}else i=t.tileInfo}return i!=null&&n!=null&&Wpe(i,n,e,r)==null?{tileInfo:i,fullExtent:n}:null}function zVt(t,e,r){const i=cft(t);if(i!=null){if(!vt.isCollection(i))return{tileInfo:i.tileInfo,fullExtent:i.fullExtent};{const n=i.find(s=>Wpe(s.tileInfo,s.fullExtent,e,r)==null);if(n)return{tileInfo:n.tileInfo,fullExtent:n.fullExtent}}}return{tileInfo:null,fullExtent:null}}function VVt(t){return t.isWGS84||t.isWebMercator||TIe(t)||!pP(t)}const BVt={force512VTL:!1};function HTe(t){return"["+t[0]+","+t[1]+","+t[2]+"]"}function H0(t){return"("+t[0]+","+t[1]+","+t[2]+")"}function $p(t,e,r=HVt){return Math.abs(t-e)<r}function gj(t){return t===Ft.NORTH_EAST?Ft.SOUTH_WEST:t===Ft.NORTH_WEST?Ft.SOUTH_EAST:t===Ft.SOUTH_WEST?Ft.NORTH_EAST:Ft.NORTH_WEST}function yj(t){return t===Ft.NORTH?Ft.SOUTH:t===Ft.EAST?Ft.WEST:t===Ft.SOUTH?Ft.NORTH:Ft.EAST}function jVt(t){return t===Ft.NORTH_WEST||t===Ft.SOUTH_WEST}function GVt(t){return t===Ft.NORTH_WEST||t===Ft.NORTH_EAST}function qTe(t){return t===Ft.NORTH_WEST||t===Ft.WEST||t===Ft.SOUTH_WEST}function WTe(t){return t===Ft.NORTH_EAST||t===Ft.EAST||t===Ft.SOUTH_EAST}function XTe(t){return t===Ft.SOUTH_EAST||t===Ft.SOUTH||t===Ft.SOUTH_WEST}function YTe(t){return t===Ft.NORTH_EAST||t===Ft.NORTH||t===Ft.NORTH_WEST}const Fy=[Ft.NORTH,Ft.EAST,Ft.SOUTH,Ft.WEST],a4=[Ft.NORTH_EAST,Ft.SOUTH_EAST,Ft.SOUTH_WEST,Ft.NORTH_WEST],HVt=1e-5;let qVt=class{constructor(e,r){if(this.layer=null,this.memory=0,this.displayedNumberOfFeatures=0,this.maximumNumberOfFeatures=null,this.totalNumberOfFeatures=null,this.layer=e.layer,this.memory=o4(e)?r.basemapTerrain.getUsedMemoryForLayerView(e):e.usedMemory,SVt(e)){const i=e.performanceInfo;this.displayedNumberOfFeatures=i.displayedNumberOfFeatures,this.maximumNumberOfFeatures=i.maximumNumberOfFeatures,this.totalNumberOfFeatures=i.totalNumberOfFeatures}}},WVt=class{constructor(e){var i;if(this.totalMemory=0,this.usedMemory=0,this.quality=1,this.load=0,this.terrainMemory=0,this.edgesMemory=0,this.layerPerformanceInfos=new Array,e.resourceController!=null){const n=e.resourceController.memoryController;this.totalMemory=(n.maxMemory??0)*oB.MEGABYTES,this.usedMemory=Math.round(n.usedMemory*this.totalMemory),this.quality=n.memoryFactor,this.load=e.resourceController.scheduler.load}this.terrainMemory=((i=e.basemapTerrain)==null?void 0:i.usedMemory)??0;const r=e._stage&&e._stage.renderView&&e._stage.renderer.edgeView;this.edgesMemory=r!=null?r.usedMemory:0,e.allLayerViews.items.forEach(n=>{(xVt(n)||o4(n))&&this.layerPerformanceInfos.push(new qVt(n,e))}),this.layerPerformanceInfos.sort((n,s)=>s.memory-n.memory)}},XVt=class{constructor(e){this._gltfLoading=new Map,this._wosrLoading=new Map,this._gltfMemCache=e("gltf-resources",()=>{}),this._wosrMemCache=e("wosr-resources",()=>{})}destroy(){this._gltfLoading.forEach(e=>e.abortController.abort()),this._wosrLoading.forEach(e=>e.abortController.abort()),this._gltfMemCache.destroy(),this._wosrMemCache.destroy()}loadGLTF(e,r,i){const n=i?`gltfPBR:${e}`:`gltf:${e}`,s=this._gltfMemCache.get(n);return s!=null?Promise.resolve(s):this._loadOnce(this._gltfLoading,this._gltfMemCache,n,o=>kBe(new NBe(o.streamDataRequester),e,o,i),r)}loadWOSR(e,r){const i=`wosr:${e}:${r.disableTextures}`,n=this._wosrMemCache.get(i);return n!=null?Promise.resolve(n):this._loadOnce(this._wosrLoading,this._wosrMemCache,i,s=>UBe(e,s),r)}async _loadOnce(e,r,i,n,s){vr(s);const o=Dl(s,()=>this._abortLoad(e,i));let a=e.get(i);if(a)a.refCount++;else{const l=new AbortController;a={refCount:1,abortController:l,promise:n({...s,signal:l.signal})},e.set(i,a)}try{const l=await a.promise;return r.put(i,l,l.size),e.delete(i),vr(s),l}finally{yi(o)}}_abortLoad(e,r){const i=e.get(r);i!=null&&--i.refCount>0||(e.delete(r),i!=null&&i.abortController.abort())}},YVt=class extends XO{constructor(e,r,i){super(r,i),this._streamDataRequester=e}async fromUrl(e,r,i){vr(i);const n=i!=null?i.signal:null,s=this.makeUid(e,r);let o=this._textureRequests.get(s);if(!o){const a=new AbortController,l=this._streamDataRequester.request(e,"image",{uid:s,signal:a.signal});o=new Nke,o.abortController=a;const c=o;this._textureRequests.set(s,o),o.textureAsync=l.then(async u=>{const h=this._createTexture(e,u,r);return c.texture=h,c.abortController=null,this._stage.add(h),await this._stage.load(h),{uid:s,texture:h,release:()=>this._release(s)}},u=>{throw c.abortController=null,u})}o.referenceCount++;try{return await ace(o.textureAsync,n)}catch(a){throw this._release(s),a}}_createTexture(e,r,i){var s;const n={width:r.width,height:r.height,wrap:{s:ir.CLAMP_TO_EDGE,t:ir.CLAMP_TO_EDGE},preMultiplyAlpha:!0};if(w$e(e)){if(i||r.width===0&&r.height===0){const o=r.width?r.height/r.width:1;i=i||64,o>1?(r.width=Math.round(i/o),r.height=i):(r.width=i,r.height=Math.round(i*o))}(s=this._stage.renderView)!=null&&s.renderingContext.driverTest.svgPremultipliesAlpha.result&&(n.preMultiplyAlpha=!1)}return new qE(r,n)}},ZVt=class{constructor(e){this.streamDataRequester=null,this._graphicsOwners=[],this._screenSizePerspectiveHandles=null,this.cimSymbolRasterizer=null,this._viewState=e.viewState,this._view=e.view,this._pointsOfInterest=e.pointsOfInterest,this.streamDataRequester=e.resourceController.createStreamDataRequester($y.SYMBOLOGY),this.objectResourceCache=new XVt((i,n)=>e.resourceController.memoryController.newCache(i,n)),this.textures=new YVt(this.streamDataRequester,e.view._stage,e.resourceController.scheduler);const r=Xr(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=a8e(e.viewingMode,r),this.screenSizePerspectiveSettingsLabels=KMt(e.viewingMode,r)}destroy(){this.textures.destroy(),this.streamDataRequester=null}addGraphicsOwner(e){if(!e)return kl();this._graphicsOwners.push(e);const r=pe(()=>{var i;return(i=e.layer)==null?void 0:i.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());return this._updateScreenSizePerspectiveEnabled(),kl(()=>{r.remove(),fN(this._graphicsOwners,e),this._updateScreenSizePerspectiveEnabled()})}_updateScreenSizePerspectiveEnabled(){const e=this._graphicsOwners.some(r=>{var i;return((i=r.layer)==null?void 0:i.screenSizePerspectiveEnabled)===!0});if(e&&!this._screenSizePerspectiveHandles){this._screenSizePerspectiveHandles=new Ri;const r=()=>this._updateScreenSizePerspectiveSettings();this._screenSizePerspectiveHandles.add([pe(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,r,li),this._viewState.events.on("camera-projection-changed",r)]),this._updateScreenSizePerspectiveSettings()}else e||(this._screenSizePerspectiveHandles=qe(this._screenSizePerspectiveHandles))}_updateScreenSizePerspectiveSettings(){const e=this._pointsOfInterest;Y6.distance=e.centerOnSurfaceInfrequent.distance,Y6.fovY=this._viewState.camera.fovY,this.screenSizePerspectiveSettings.update(Y6),this.screenSizePerspectiveSettingsLabels.update(Y6),this._view._stage.renderView.requestRender()}get test(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}};const Y6={distance:0,fovY:0};let KR=class{constructor(e,r,i=""){this.graphics=e,this._symbol=new _w({symbolLayers:[new vw({material:{color:r},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new FE({text:i,halo:{color:"white",size:1/.75},material:{color:r},size:12})]})}show(e,r){if(r==null)return;this.hide();const i=new Gt({x:e[0],y:e[1],z:e[2],spatialReference:r});this._graphic=new cf({geometry:i,symbol:this._symbol}),this.graphics.add(this._graphic)}hide(){this._graphic!=null&&(this.graphics.remove(this._graphic),this._graphic=null)}},iw=class extends Ce{constructor(e){super(e),this.handles=new Ri}destroy(){this.handles.destroy()}};d([p({constructOnly:!0})],iw.prototype,"renderCoordsHelper",void 0),d([p({constructOnly:!0})],iw.prototype,"surface",void 0),d([p({constructOnly:!0})],iw.prototype,"state",void 0),iw=d([I("esri.views.3d.support.PointOfInterest")],iw);const JVt=Array;let tm=class extends iw{constructor(e){super(e),this._dirty=!1,this._propertiesPool=new N_({location:Gt,renderLocation:JVt},this),this._estimatedSurfaceAltitude=0,this._pendingElevationQueryController=null,this.renderLocation=A(),this._tmpPoint=new Gt}initialize(){if(this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this)),this.runTask(),this.map){const e=()=>this._setDirty();this.handles.add(da(()=>{var r,i;return(i=(r=this.map)==null?void 0:r.ground)==null?void 0:i.layers},"change",e,{onListenerAdd:e,onListenerRemove:e}))}this._updateRenderLocation()}destroy(){this._cancelPendingRequest(),this._propertiesPool=qe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get scale(){const e=this._camera,r=Li(e.eye,this.renderLocation),i={renderCoordsHelper:this.renderCoordsHelper,state:{camera:e}};return oE(i,r,0)}get updating(){return this._dirty||this._pendingElevationQueryController!=null}updateRenderLocation(){this._setDirty(),this._updateRenderLocation()}_setDirty(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))}_cancelPendingRequest(){const e=this._pendingElevationQueryController;e&&(this._pendingElevationQueryController=null,e.abort(),this.notifyChange("updating"))}get running(){return!this._pendingElevationQueryController&&this._dirty}runTask(){if(this._cancelPendingRequest(),this._dirty=!1,this.notifyChange("updating"),!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),ll.YIELD;const e=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,e);const r=(this._tmpPoint.z??0)>KVt&&this.renderCoordsHelper.viewingMode===at.Global&&(e.isWGS84||e.isWebMercator);let i=new AbortController;return this.map.ground.queryElevation(this._tmpPoint,{signal:i.signal,cache:this.cache,minDemResolution:r?QVt:0}).then(n=>this._updateSurfaceAltitude(n.geometry.z??0)).catch(n=>{Yn(n)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===i&&(this._pendingElevationQueryController=null,this.notifyChange("updating")),i=null}),this._pendingElevationQueryController=i,ll.YIELD}_updateSurfaceAltitude(e){this._estimatedSurfaceAltitude!==e&&(this._estimatedSurfaceAltitude=e,this._updateRenderLocation())}_updateRenderLocation(){this.renderCoordsHelper.setAltitude(DZ,this._estimatedSurfaceAltitude,this._camera.eye),gi(this._get("renderLocation"),DZ)||(this._set("renderLocation",oe(this._propertiesPool.get("renderLocation"),DZ)),this.notifyChange("renderLocation"))}};d([p({constructOnly:!0})],tm.prototype,"scheduler",void 0),d([p({constructOnly:!0})],tm.prototype,"cache",void 0),d([p({constructOnly:!0})],tm.prototype,"task",void 0),d([p({readOnly:!0})],tm.prototype,"location",null),d([p({constructOnly:!0})],tm.prototype,"map",void 0),d([p({readOnly:!0})],tm.prototype,"renderLocation",void 0),d([p({readOnly:!0})],tm.prototype,"scale",null),d([p({readOnly:!0})],tm.prototype,"updating",null),tm=d([I("esri.views.3d.support.CameraOnSurface")],tm);const DZ=A(),KVt=1e5,QVt=1e6,eBt=Array;let vp=class extends iw{constructor(e){super(e),this._propertiesPool=new N_({location:Gt,renderLocation:eBt},this),this._currentSurfaceAltitude=0,this._latestSurfaceAltitude=0,this.distance=0,this.renderLocation=A(),this.updating=!1}initialize(){this._frameWorker=this.scheduler.registerTask(this.task,this),this.runTask()}destroy(){this._frameWorker=yi(this._frameWorker),this._propertiesPool=qe(this._propertiesPool)}get _camera(){return this.state.contentCamera}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}updateRenderLocation(){this.updating=!0,this._updateRenderLocation()}get estimatedSurfaceAltitude(){return this._latestSurfaceAltitude}get running(){return this.updating}runTask(){return this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter(),this._updateRenderLocation(),this.updating=!1,ll.YIELD}_updateRenderLocation(){const e=rBt;let r=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,e);const i=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!r&&i&&(r=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,e),r&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude));const n=iBt;r&&this._latestSurfaceAltitudeChangesDistanceSignificantly(e,n)&&(oe(e,n),this._currentSurfaceAltitude=this._latestSurfaceAltitude),r?this.distance=Li(this._camera.eye,e):(ce(e,this._camera.viewForward,this._get("distance")),ge(e,e,this._camera.eye)),gi(this._get("renderLocation"),e)||this._set("renderLocation",oe(this._propertiesPool.get("renderLocation"),e))}_calculateSurfaceIntersection(e,r){var n,s;const i=this._camera;if(!this.renderCoordsHelper.intersectManifold(i.ray,e,r))return!1;if(this.state.isGlobal){const o=Xr(this.renderCoordsHelper.spatialReference).radius,a=o+e,l=Al(i.eye),c=l<a*a,u=Li(i.eye,r);if(c&&u>o/4){const h=a-Math.sqrt(l);return ce(r,i.viewForward,h),ge(r,r,i.eye),!0}}else{const o=(n=this.surface)!=null&&n.ready?this.surface.extent:null;o!=null&&rF(o,(s=this.surface)==null?void 0:s.spatialReference,_$,this.renderCoordsHelper.spatialReference)&&(r[0]=Te(r[0],_$[0],_$[2]),r[1]=Te(r[1],_$[1],_$[3]))}return!0}_latestSurfaceAltitudeChangesDistanceSignificantly(e,r){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||e==null)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,r)){if(Di.TESTS_DISABLE_OPTIMIZATIONS)return!0;const i=this._camera.eye,n=Li(i,e),s=Li(i,r);if(Math.abs(s-n)/n>tBt)return!0}return!1}};d([p({constructOnly:!0})],vp.prototype,"scheduler",void 0),d([p({constructOnly:!0})],vp.prototype,"task",void 0),d([p()],vp.prototype,"distance",void 0),d([p({constructOnly:!0})],vp.prototype,"estimateSurfaceAltitudeAtCenter",void 0),d([p({readOnly:!0})],vp.prototype,"location",null),d([p({readOnly:!0})],vp.prototype,"renderLocation",void 0),d([p()],vp.prototype,"updating",void 0),vp=d([I("esri.views.3d.support.CenterOnSurface")],vp);const tBt=.05,rBt=A(),iBt=A(),_$=lr();let nBt=class{constructor(e){this._handles=new Ri,this.events=new pn,this._contentLayerViews=e.contentLayerViews,this._handles.add(this._contentLayerViews.on("change",r=>this._layerViewsChanged(r))),this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}destroy(){this._handles=qe(this._handles),this._contentLayerViews.destroy()}_layerViewsChanged(e){e.added.forEach(r=>{r.declaredClass==="esri.views.3d.layers.SceneLayerView3D"&&this._handles.add(r.on("visible-geometry-changed",()=>this._contentChanged()),r.uid)}),e.removed.forEach(r=>this._handles.remove(r.uid))}_contentChanged(){this.events.emit("request-update",sBt)}};const sBt={},oBt=Array;let ly=class extends iw{constructor(e){super(e),this._propertiesPool=new N_({location:Gt,renderLocation:oBt},this),this._dirty=!0,this.renderLocation=this._propertiesPool.get("renderLocation")}initialize(){this.handles.add([pe(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),pe(()=>this.state.contentCamera,()=>this.updateRenderLocation())]),this.scheduler&&this.handles.add(this.scheduler.registerTask(Vt.POINT_OF_INTEREST_FREQUENT,this))}destroy(){this._propertiesPool=qe(this._propertiesPool)}get updating(){return this._dirty||this.centerOnSurface.updating}get location(){const e=this._propertiesPool.get("location");return this.renderCoordsHelper.fromRenderCoords(this.renderLocation,e,this.state.spatialReference),e}get running(){return this._dirty}runTask(){const e=this._get("renderLocation"),r=this.centerOnSurface.renderLocation,i=this.renderCoordsHelper,n=this.state.contentCamera;this._dirty=!1,i.worldUpAtPosition(r,ZTe);const s=Math.max(0,(Math.acos(ye(ZTe,n.viewForward))-.5*Math.PI)*(n.aboveGround?1:-1));if(Number.isNaN(s)){if(!e||!Ww(e,r)){const c=this._propertiesPool.get("renderLocation");oe(c,r),this._set("renderLocation",c)}return ll.YIELD}const o=1-Te(s/(.5*Math.PI),0,1),a=o*o*o;this._calculateScreenHorizontalEdgeOnSurface(JTe);const l=this._propertiesPool.get("renderLocation");return mi(l,r,JTe,a),e&&Ww(e,l)||this._set("renderLocation",l),ll.YIELD}_calculateScreenHorizontalEdgeOnSurface(e){const r=this.state.contentCamera,i=r.getRenderCenter(ua());if(i[1]=r.aboveGround?r.padding[Tr.BOTTOM]:r.fullHeight-r.padding[Tr.TOP],this.estimateSurfaceIntersectionAtRenderPoint(i,e))return e;const n=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);if(r.unprojectFromRenderScreen(i,b$)){ve(b$,b$,r.eye);const s=Se(b$,b$);if(this.renderCoordsHelper.intersectManifold(Ah(r.eye,s),n,e))return e}return this.renderCoordsHelper.setAltitude(e,n,r.eye)}updateRenderLocation(){this._dirty=!0}};d([p()],ly.prototype,"_dirty",void 0),d([p({constructOnly:!0})],ly.prototype,"scheduler",void 0),d([p({constructOnly:!0})],ly.prototype,"centerOnSurface",void 0),d([p({constructOnly:!0})],ly.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0),d([p({readOnly:!0})],ly.prototype,"updating",null),d([p({readOnly:!0})],ly.prototype,"location",null),d([p({readOnly:!0})],ly.prototype,"renderLocation",void 0),ly=d([I("esri.views.3d.support.pointsOfInterest.Focus")],ly);const ZTe=A(),b$=A(),JTe=A();let pv=class extends Ce{get surface(){var e;return(e=this.view.map)==null?void 0:e.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=A();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null,this._handles=new Ri}initialize(){this.view.state.isLocal&&(this._handles.add([pe(()=>{var e,r;return[(e=this.surfaceView)==null?void 0:e.spatialReference,(r=this.surfaceView)==null?void 0:r.extent]},()=>this._update()),da(()=>{var e;return(e=this.surface)==null?void 0:e.layers},"change",()=>this._update())]),this._update())}destroy(){this._handles.destroy()}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),!this.surfaceView||this.surfaceView.extent==null||this.surfaceView.spatialReference==null)return void this._set("location",null);const e=qce(this.surfaceView.extent),r=new Gt({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(r,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(i=>{this._updateController=null,this._set("location",i.geometry)}).catch(i=>{Yn(i)||i&&i.name==="elevation-query:invalid-layer"||console.error("StableSurfaceCenter failed to update: ",i)})):this._set("location",r)}};d([p({constructOnly:!0})],pv.prototype,"view",void 0),d([p({constructOnly:!0})],pv.prototype,"cache",void 0),d([p()],pv.prototype,"surface",null),d([p()],pv.prototype,"surfaceView",null),d([p({readOnly:!0})],pv.prototype,"location",void 0),d([p({readOnly:!0})],pv.prototype,"renderLocation",null),pv=d([I("esri.views.3d.terrain.StableSurfaceCenter")],pv);let fv=class extends Ce{constructor(e){super(e),this._tileGeometryUpdateExtent=xd(),this._tileGeometryUpdateSpatialReference=null,this.events=new pn,this.updating=!1}initialize(){this.addHandles([this.surface.on("elevation-change",e=>this._tileGeometryChanged(e)),this.scheduler.registerTask(Vt.SURFACE_GEOMETRY_UPDATES,this)])}get running(){return this.updating}runTask(){return this.updating&&(this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",aBt),xd(this._tileGeometryUpdateExtent),this._set("updating",!1)),ll.YIELD}_tileGeometryChanged(e){this._tileGeometryUpdateSpatialReference=e.spatialReference,Fw(this._tileGeometryUpdateExtent,e.extent,this._tileGeometryUpdateExtent),this._set("updating",!0)}_furthestCenterOnSurface(){let e=this.centerOnSurfaces[0];for(let r=1;r<this.centerOnSurfaces.length;r++){const i=this.centerOnSurfaces[r];i.distance>e.distance&&(e=i)}return e}_centerIntersectsExtent(e,r){const i=this.state.contentCamera.eye,n=lBt,s=this._furthestCenterOnSurface();return this.renderCoordsHelper.fromRenderCoords(i,mS,r),this.renderCoordsHelper.fromRenderCoords(s.renderLocation,gS,r),mS[0]<gS[0]?(n[0]=mS[0],n[2]=gS[0]):(n[0]=gS[0],n[2]=mS[0]),mS[1]<gS[1]?(n[1]=mS[1],n[3]=gS[1]):(n[1]=gS[1],n[3]=mS[1]),Z4(n,e)}};d([p({constructOnly:!0})],fv.prototype,"state",void 0),d([p({constructOnly:!0})],fv.prototype,"centerOnSurfaces",void 0),d([p({constructOnly:!0})],fv.prototype,"renderCoordsHelper",void 0),d([p({constructOnly:!0})],fv.prototype,"scheduler",void 0),d([p({constructOnly:!0})],fv.prototype,"surface",void 0),d([p({readOnly:!0})],fv.prototype,"updating",void 0),fv=d([I("esri.views.3d.support.SurfaceGeometryUpdates")],fv);const aBt={},mS=A(),gS=A(),lBt=xd();let Xc=class extends Ce{constructor(e){super(e),this._handles=new Ri,this._tmpRay=la(),this._centerRayDirty=!0,this._surfaceAltitudeAtCenter=0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenter=0,this._contentAltitudeAtCenterDirty=!0,this._propertiesPool=new N_({renderPointOfView:cBt},this),this.renderPointOfView=A(),this._pois=new Array,this._debugCenters=new Map}initialize(){var u;const{state:e,basemapTerrain:r,renderCoordsHelper:i,map:n}=this.view;this._surfaceIntersector=hf(e.viewingMode),e.isGlobal?this._surfaceIntersector.options.backfacesTerrain=!1:this._surfaceIntersector.options.backfacesTerrain=!0,this._surfaceIntersector.options.invisibleTerrain=!1,this._surfaceIntersector.options.store=Ia.MIN,this._contentIntersector=hf(e.viewingMode);const s=()=>this._estimateSurfaceAltitudeAtCenter(),o=this.view.resourceController.scheduler,a=(u=this.view.basemapTerrain)==null?void 0:u.elevationQueryCache,l={state:e,scheduler:o,surface:r,renderCoordsHelper:i};this._set("centerOnSurfaceInfrequent",new vp({...l,task:Vt.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnSurfaceFrequent",new vp({...l,task:Vt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:s})),this._set("centerOnContent",new vp({...l,task:Vt.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()})),this._set("cameraOnSurface",new tm({...l,cache:a,task:Vt.POINT_OF_INTEREST_INFREQUENT,map:n})),this._set("surfaceGeometryUpdates",new fv({...l,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]})),this._set("contentGeometryUpdates",new nBt({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:i})),this._set("surfaceOrigin",new pv({cache:a,view:this.view})),this._set("focus",new ly({state:e,scheduler:o,surface:r,renderCoordsHelper:i,centerOnSurface:this.centerOnSurfaceFrequent,estimateSurfaceIntersectionAtRenderPoint:(h,f)=>this._estimateSurfaceIntersectionAtRenderPoint(h,this.view.state.contentCamera,f)})),this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);const c=this.view.graphics;this._debugCenters.set(this.centerOnContent,new KR(c,"red","CenterOnContent")),this._debugCenters.set(this.centerOnSurfaceFrequent,new KR(c,"red","CenterOnSurface")),this._debugCenters.set(this.centerOnSurfaceInfrequent,new KR(c,"red","CenterOnSurface")),this._debugCenters.set(this.cameraOnSurface,new KR(c,"blue","CameraOnSurface")),this._debugCenters.set(this.focus,new KR(c,"green","Focus")),this._handles.add([pe(()=>e.contentCamera,h=>this._cameraChanged(h),li),pe(()=>r.extent,()=>this._updateCenterPointsOfInterest()),du(()=>!r.updating,()=>this._updateCenterPointsOfInterest(),li),da(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),da(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),du(()=>Di.SHOW_POI,h=>this._setDebug(h),_r)]),this._cameraChanged(this.view.state.contentCamera);for(const h of this._pois)h.runTask()}destroy(){this._setDebug(!1),this._handles.destroy(),this._propertiesPool.destroy();for(const e of this._pois)e.destroy();this.surfaceOrigin.destroy()}get updating(){var e;return!(!((e=this.surfaceGeometryUpdates)!=null&&e.updating)&&!this._pois.some(r=>r.updating))}get _centerRay(){return this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1),this._centerRayCached}_estimateContentAltitudeAtCenter(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const e=this._centerRay;return e==null||(this.view.sceneIntersectionHelper.intersectRay(e,this._contentIntersector,ZC,dBt)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(ZC):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter()),this._contentAltitudeAtCenter}_estimateSurfaceAltitudeAtCenter(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const e=this._centerRay;if(e==null)return this._surfaceAltitudeAtCenter;const r=e.origin,i=ge(ZC,e.origin,e.direction);return this._surfaceIntersector.resetWithRay(e,this.view.state.contentCamera),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,r,i),this._surfaceIntersector.results.min.getIntersectionPoint(ZC)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(ZC)),this._surfaceAltitudeAtCenter}_estimateSurfaceIntersectionAtRenderPoint(e,r,i){const n=_he(r,e,uBt);if(n==null)return null;const s=n.origin,o=ge(ZC,n.origin,n.direction);return this._surfaceIntersector.resetWithRay(n,r),this.view.basemapTerrain.intersect(this._surfaceIntersector,null,s,o),this._surfaceIntersector.results.min.getIntersectionPoint(i)?i:null}_cameraChanged(e){this._updateCenterPointsOfInterest();const r=e.eye;gi(this.renderPointOfView,r)||this._set("renderPointOfView",oe(this._propertiesPool.get("renderPointOfView"),r))}_updateCenterPointsOfInterest(){this._centerRayDirty=!0,this._surfaceAltitudeAtCenterDirty=!0,this._contentAltitudeAtCenterDirty=!0;for(const e of this._pois)e.updateRenderLocation()}_updateCenterOnContent(){this._contentAltitudeAtCenterDirty=!0,this.centerOnContent.updateRenderLocation()}_setDebug(e){if(!e)return this._debugCenters.forEach(r=>r.hide()),void this._handles.remove("debug");for(const r of this._pois)this._handles.add(pe(()=>r.renderLocation,i=>{var n;return(n=this._debugCenters.get(r))==null?void 0:n.show(i,r.renderCoordsHelper.spatialReference)},_r),"debug")}get test(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const e of this._pois)e.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}};d([p({readOnly:!0})],Xc.prototype,"centerOnContent",void 0),d([p({readOnly:!0})],Xc.prototype,"centerOnSurfaceFrequent",void 0),d([p({readOnly:!0})],Xc.prototype,"centerOnSurfaceInfrequent",void 0),d([p({readOnly:!0})],Xc.prototype,"cameraOnSurface",void 0),d([p({readOnly:!0})],Xc.prototype,"focus",void 0),d([p({readOnly:!0})],Xc.prototype,"renderPointOfView",void 0),d([p({readOnly:!0})],Xc.prototype,"surfaceOrigin",void 0),d([p({readOnly:!0})],Xc.prototype,"contentGeometryUpdates",void 0),d([p({readOnly:!0})],Xc.prototype,"surfaceGeometryUpdates",void 0),d([p({constructOnly:!0})],Xc.prototype,"view",void 0),d([p({readOnly:!0})],Xc.prototype,"updating",null),Xc=d([I("esri.views.3d.support.PointsOfInterest")],Xc);const cBt=Array,ZC=A(),uBt=la(),dBt={exclude:new Set([Kb])},l4=new vt,DD=new WeakMap;function hBt(t){zje(t)&&l4.push(t)}function pBt(t){zje(t)&&l4.includes(t)&&l4.remove(t)}function zje(t){return t!=null&&typeof t=="object"&&"refreshInterval"in t&&"refresh"in t}function Vje(t,e){return Number.isFinite(t)&&Number.isFinite(e)?e<=0?t:Vje(e,t%e):0}let NZ=0,Z6=0;function fBt(){const t=Date.now();for(const e of l4)e.refreshInterval&&t-(DD.get(e)??0)+5>=6e4*e.refreshInterval&&(DD.set(e,t),e.refresh(t))}q$e(()=>{const t=Date.now();let e=0;for(const r of l4)e=Vje(Math.round(6e4*r.refreshInterval),e),r.refreshInterval?DD.get(r)||DD.set(r,t):DD.delete(r);if(e!==Z6){if(Z6=e,clearInterval(NZ),Z6===0)return void(NZ=0);NZ=setInterval(fBt,Z6)}});function mBt(t){return t!=null&&typeof t=="object"&&"refreshTimestamp"in t&&"refresh"in t}const Bje=t=>{let e=class extends t{constructor(...r){super(...r),this.refreshInterval=0,this.refreshTimestamp=0,this._debounceHasDataChanged=B4(()=>this.hasDataChanged()),this.when().then(()=>{this.destroyed||hBt(this)},()=>{})}destroy(){pBt(this)}get refreshParameters(){return{_ts:this.refreshTimestamp||null}}refresh(r=Date.now()){gQ(this._debounceHasDataChanged()).then(i=>{i&&this._set("refreshTimestamp",r),this.emit("refresh",{dataChanged:i})},i=>{re.getLogger(this).error(i),this.emit("refresh",{dataChanged:!1,error:i})})}async hasDataChanged(){return!0}};return d([p({type:Number,cast:r=>r>=.1?r:r<=0?0:.1,json:{write:!0}})],e.prototype,"refreshInterval",void 0),d([p({readOnly:!0})],e.prototype,"refreshTimestamp",void 0),d([p()],e.prototype,"refreshParameters",null),e=d([I("esri.layers.mixins.RefreshableLayer")],e),e};let gBt=class{constructor(e){this._store=e}destroy(){this._store.destroy()}get(e){return this._store.get(e)}put(e,r){this._store.put(e,r,r.values.byteLength+256)}},yBt=class{constructor(e,r,i,n){this._hasNoDataValues=null,this._minValue=null,this._maxValue=null,"pixelData"in e?(this.values=e.pixelData,this.width=e.width,this.height=e.height,this.noDataValue=e.noDataValue):(this.values=e,this.width=r,this.height=i,this.noDataValue=n)}get hasNoDataValues(){if(this._hasNoDataValues==null){const e=this.noDataValue;this._hasNoDataValues=this.values.includes(e)}return this._hasNoDataValues}get minValue(){return this._ensureBounds(),this._minValue}get maxValue(){return this._ensureBounds(),this._maxValue}_ensureBounds(){if(this._minValue!=null)return;const{noDataValue:e,values:r}=this;let i=1/0,n=-1/0,s=!0;for(const o of r)o===e?this._hasNoDataValues=!0:(i=o<i?o:i,n=o>n?o:n,s=!1);s?(this._minValue=0,this._maxValue=0):(this._minValue=i,this._maxValue=n>-3e38?n:0)}},jje=class{constructor(e,r,i,n,s={}){this._mainMethod=r,this._transferLists=i,this._listeners=[],this._promise=Ode(e,{...s,schedule:n}).then(o=>{if(this._thread===void 0){this._thread=o,this._promise=null,s.hasInitialize&&this.broadcast({},"initialize");for(const a of this._listeners)this._connectListener(a)}else o.close()}),this._promise.catch(o=>re.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${o}`))}on(e,r){const i={removed:!1,eventName:e,callback:r,threadHandle:null};return this._listeners.push(i),this._connectListener(i),kl(()=>{i.removed=!0,Ble(this._listeners,i),this._thread&&i.threadHandle!=null&&i.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,r){return this.invokeMethod(this._mainMethod,e,r)}invokeMethod(e,r,i){if(this._thread){const n=this._transferLists[e],s=n?n(r):[];return this._thread.invoke(e,r,{transferList:s,signal:i})}return this._promise?this._promise.then(()=>(vr(i),this.invokeMethod(e,r,i))):Promise.reject(null)}broadcast(e,r){return this._thread?Promise.all(this._thread.broadcast(r,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,r)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(r=>{e.removed||(e.threadHandle=r)})}},KTe=class extends jje{constructor(e=null){super("LercWorker","_decode",{_decode:r=>[r.buffer]},e,{strategy:"dedicated"}),this.schedule=e,this.ref=0}decode(e,r,i){return e&&e.byteLength!==0?this.invoke({buffer:e,options:r},i):Promise.resolve(null)}release(){--this.ref<=0&&(ND.forEach((e,r)=>{e===this&&ND.delete(r)}),this.destroy())}};const ND=new Map;function vBt(t=null){let e=ND.get(t);return e||(t!=null?(e=new KTe(r=>t.immediate.schedule(r)),ND.set(t,e)):(e=new KTe,ND.set(null,e))),++e.ref,e}var Zu,QTe,e2e;(function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(Zu||(Zu={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(QTe||(QTe={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(e2e||(e2e={}));let _Bt=class{constructor(e){this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}},KSr=class{constructor(){this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}};function eTr(t,e,r,i,n,s){const o=r-n;if(o>=0)return(e>>o)+(i-(s<<o))*(t>>o);const a=-o;return e-(s-(i<<a))*(t>>a)<<a}let tTr=class{constructor(e,r,i){this._rows=Math.ceil(r/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(let s=0;s<this._columns;s++)this.cells[n][s]=[]}}getCell(e,r){const i=Math.min(Math.max(Math.floor(r/this._cellSize),0),this._rows-1),n=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][n]||null}getCellSpan(e,r,i,n){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}};function bBt(t,e,r,i,n,s){const o=e[i++];for(let a=0;a<o;a++){const l=new _Bt(s);l.xTile=e[i++],l.yTile=e[i++],l.hash=e[i++],l.priority=e[i++];const c=e[i++];for(let f=0;f<c;f++){const m=e[i++],g=e[i++],y=e[i++],_=e[i++],b=!!e[i++],w=e[i++],x=r[i++],S=r[i++],C=e[i++],E=e[i++];l.colliders.push({xTile:m,yTile:g,dxPixels:y,dyPixels:_,hard:b,partIndex:w,width:C,height:E,minLod:x,maxLod:S})}const u=t[i++];for(let f=0;f<u;f++)l.textVertexRanges.push([t[i++],t[i++]]);const h=t[i++];for(let f=0;f<h;f++)l.iconVertexRanges.push([t[i++],t[i++]]);n.push(l)}return i}function iTr(t,e,r){for(const[i,n]of t.symbols)wBt(t,e,r,n,i)}function wBt(t,e,r,i,n){const s=t.layerData.get(n);if(s.type===Zu.SYMBOL){for(const o of i){const a=o.unique;let l;if(o.selectedForRendering){const c=a.parts[0],u=c.startOpacity,h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const f=r?Math.floor(127*u)|h<<7:h?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,u]of o.iconVertexRanges)for(let h=c;h<c+u;h+=4)s.iconOpacity[h/4]=l;if(o.selectedForRendering){const c=a.parts[1],u=c.startOpacity,h=c.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&h===0;const f=r?Math.floor(127*u)|h<<7:h?255:0;l=f<<24|f<<16|f<<8|f}else l=0;for(const[c,u]of o.textVertexRanges)for(let h=c;h<c+u;h+=4)s.textOpacity[h/4]=l}s.lastOpacityUpdate=e,s.opacityChanged=!0}}let dq=class{constructor(e,r){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const n=new Uint32Array(e);this.layerUIDs=[];const s=n[i++];for(let o=0;o<s;o++)this.layerUIDs[o]=n[i++];this.bufferDataOffset=i,r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return this._data==null}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)}prepareForRendering(e){this._data!=null&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}},xBt=class extends dq{constructor(e,r){super(e,r),this.type=Zu.LINE,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.lineIndexStart=i[n++],this.lineIndexCount=i[n++];const s=i[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=i[n++],l=i[n++],c=i[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.memoryEstimate)??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=pt(this.vao)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=ci.createVertex(e,qr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=ci.createIndex(e,qr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=this.layer.lineMaterial;this.vao=new pf(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}},SBt=class extends dq{constructor(e,r){super(e,r),this.type=Zu.FILL,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.fillIndexStart=i[n++],this.fillIndexCount=i[n++],this.outlineIndexStart=i[n++],this.outlineIndexCount=i[n++];const s=i[n++];if(s>0){this.patternMap=new Map;for(let o=0;o<s;o++){const a=i[n++],l=i[n++],c=i[n++];this.patternMap.set(a,[l,c])}}this.bufferDataOffset=n}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.fillVAO)==null?void 0:r.memoryEstimate)??0)+(((i=this.outlineVAO)==null?void 0:i.memoryEstimate)??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=pt(this.fillVAO),this.outlineVAO=pt(this.outlineVAO)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=ci.createVertex(e,qr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=ci.createIndex(e,qr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=n[i++],h=ci.createVertex(e,qr.STATIC_DRAW,new Int32Array(s.buffer,4*i,u));i+=u;const f=n[i++],m=ci.createIndex(e,qr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,f));i+=f;const g=this.layer,y=g.fillMaterial,_=g.outlineMaterial;this.fillVAO=new pf(e,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:a},c),this.outlineVAO=new pf(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:h},m)}},TBt=class extends dq{constructor(e,r,i){super(e,r),this.type=Zu.SYMBOL,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const n=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let a=this.bufferDataOffset;this.isIconSDF=!!n[a++];const l=n[a++];for(let f=0;f<l;f++){const m=n[a++],g=n[a++],y=n[a++];this.iconPerPageElementsMap.set(m,[g,y])}const c=n[a++];for(let f=0;f<c;f++){const m=n[a++],g=n[a++],y=n[a++];this.glyphPerPageElementsMap.set(m,[g,y])}const u=n[a++],h=n[a++];this.iconOpacity=new Int32Array(u),this.textOpacity=new Int32Array(h),a=bBt(n,s,o,a,this.symbols,i),this.bufferDataOffset=a}get memoryUsed(){var e,r,i;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.iconVAO)==null?void 0:r.memoryEstimate)??0)+(((i=this.textVAO)==null?void 0:i.memoryEstimate)??0)+uw(this.iconOpacity)+uw(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const[r,i]of this.iconPerPageElementsMap)e+=i[1];for(const[r,i]of this.glyphPerPageElementsMap)e+=i[1];return e/3}doDestroy(){this.iconVAO=pt(this.iconVAO),this.textVAO=pt(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,r=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===r.byteLength&&r.setSubData(e,0,0,e.length);const i=this.textOpacity,n=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===n.byteLength&&n.setSubData(i,0,0,i.length)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=ci.createVertex(e,qr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=ci.createIndex(e,qr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=n[i++],h=ci.createVertex(e,qr.STATIC_DRAW,new Int32Array(s.buffer,4*i,u));i+=u;const f=n[i++],m=ci.createIndex(e,qr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,f));i+=f;const g=ci.createVertex(e,qr.STATIC_DRAW,this.iconOpacity.buffer),y=ci.createVertex(e,qr.STATIC_DRAW,this.textOpacity.buffer),_=this.layer,b=_.iconMaterial,w=_.textMaterial;this.iconVAO=new pf(e,b.getAttributeLocations(),b.getLayoutInfo(),{geometry:a,opacity:g},c),this.textVAO=new pf(e,w.getAttributeLocations(),w.getLayoutInfo(),{geometry:h,opacity:y},m)}},EBt=class extends dq{constructor(e,r){super(e,r),this.type=Zu.CIRCLE,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let n=this.bufferDataOffset;this.circleIndexStart=i[n++],this.circleIndexCount=i[n++],this.bufferDataOffset=n}get memoryUsed(){var e,r;return(((e=this.data)==null?void 0:e.byteLength)??0)+(((r=this.vao)==null?void 0:r.memoryEstimate)??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=pt(this.vao)}doPrepareForRendering(e,r,i){const n=new Uint32Array(r),s=new Int32Array(n.buffer),o=n[i++],a=ci.createVertex(e,qr.STATIC_DRAW,new Int32Array(s.buffer,4*i,o));i+=o;const l=n[i++],c=ci.createIndex(e,qr.STATIC_DRAW,new Uint32Array(n.buffer,4*i,l));i+=l;const u=this.layer.circleMaterial;this.vao=new pf(e,u.getAttributeLocations(),u.getLayoutInfo(),{geometry:a},c)}};const cTr=!0,uTr=32,t2e=200,CBt=1/he("mapview-transitions-duration");let RBt=class extends pn{constructor(){super(...arguments),this._fadeOutResolver=null,this._fadeInResolver=null,this._clips=null,this.computedVisible=!0,this.computedOpacity=1,this.fadeTransitionEnabled=!1,this.inFadeTransition=!1,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this.requestRender())}get stage(){return this._stage}set stage(e){var i;if(this._stage===e)return;const r=this._stage;this._stage=e,e?(i=this._stage)!=null&&i.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):r==null||r.trashDisplayObject(this)}get transforms(){return this._getTransforms()}_getTransforms(){return this._transforms==null&&(this._transforms=this._createTransforms()),this._transforms}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this.requestRender())}fadeIn(){return this._fadeInResolver||(this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.opacity=1,this.computedOpacity=0,this.fadeTransitionEnabled=!0,this._fadeInResolver=Da(),this.requestRender()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this.fadeTransitionEnabled=!0,this._fadeOutResolver=Da(),this.requestRender()),this._fadeOutResolver.promise}endTransitions(){var e,r;(e=this._fadeInResolver)==null||e.call(this),this._fadeInResolver=null,(r=this._fadeOutResolver)==null||r.call(this),this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0,this.requestRender()}beforeRender(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)}afterRender(e){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&this.computedOpacity===0&&(this._fadeOutResolver(),this._fadeOutResolver=null)}remove(){var e;(e=this.parent)==null||e.removeChild(this)}setTransform(e){}processRender(e){this.stage&&this.computedVisible&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null),this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null),this.onDetach(),this.emit("detach")}updateTransitionProperties(e,r){if(this.fadeTransitionEnabled){const i=this._fadeOutResolver||!this.visible?0:this.opacity,n=this.computedOpacity;if(n===i)this.computedVisible=this.visible;else{const s=e*CBt;this.computedOpacity=n>i?Math.max(i,n-s):Math.min(i,n+s),this.computedVisible=this.computedOpacity>0;const o=i===this.computedOpacity;this.inFadeTransition=!o,o||this.requestRender()}}else this.computedOpacity=this.opacity,this.computedVisible=this.visible}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}},Ine=class aT{static getId(e,r,i,n){return typeof e=="object"?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${r}/${i}/${n}`}constructor(e,r,i,n){this.set(e,r,i,n)}get key(){return this}get id(){return this.toString()}set id(e){this.set(e)}get hash(){const e=4095&this.row,r=4095&this.col,i=63&this.level;return(3&this.world)<<30|r<<22|e<<8|i}acquire(e,r,i,n){this.set(e,r,i,n)}contains(e){const r=e.level-this.level;return r>=0&&this.row===e.row>>r&&this.col===e.col>>r&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new aT(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,r,i,n){if(e==null)this.level=0,this.row=0,this.col=0,this.world=0;else if(typeof e=="object")this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if(typeof e=="string"){const[s,o,a,l]=e.split("/");this.level=parseFloat(s),this.row=parseFloat(o),this.col=parseFloat(a),this.world=parseFloat(l)}else this.level=+e,this.row=+r,this.col=+i,this.world=+n||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new aT(this.level-1,this.row>>1,this.col>>1,this.world)}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,n=this.world;return[new aT(e,r,i,n),new aT(e,r,i+1,n),new aT(e,r+1,i,n),new aT(e,r+1,i+1,n)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}};Ine.pool=new il(Ine,null,null,25,50);let OBt=class extends RBt{constructor(e,r,i,n,s,o,a=s,l=o){super(),this.triangleCountReportedInDebug=0,this.triangleCount=0,this.texture=null,this.key=new Ine(e),this.resolution=r,this.x=i,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){this.texture&&(this.texture.dispose(),this.texture=null)}setTransform(e){const r=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*r,a=this.height/this.rangeY*r;Yue(i,o,0,0,0,a,0,n,s,1),$P(this.transforms.dvs,e.displayViewMat3,i)}},FZ=class Gje extends OBt{constructor(e,r,i,n,s,o,a,l=null){super(e,r,i,n,s,o,4096,4096),this.styleRepository=a,this._memCache=l,this.type="vector-tile",this._referenced=0,this._hasSymbolBuckets=!1,this._memoryUsedByLayerData=0,this.layerData=new Map,this.layerCount=0,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.invalidating=!1,this.parentTile=null,this.childrenTiles=new Set,this._processed=!1,this._referenced=1,this.id=e.id}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<t2e}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<t2e)}get wasRequested(){return this.status==="errored"||this.status==="loaded"||this.status==="reloading"}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this.invalidating=!1,this._processed=!0}deleteLayerData(e){var i;let r=!1;for(const n of e)if(this.layerData.has(n)){const s=this.layerData.get(n);this._memoryUsedByLayerData-=s.memoryUsed,s.type===Zu.SYMBOL&&this.symbols.has(n)&&(this.symbols.delete(n),r=!0),s.destroy(),this.layerData.delete(n),this.layerCount--}(i=this._memCache)==null||i.updateSize(this.key.id,this,this._memoryUsedByLayerData),r&&this.emit("symbols-changed"),this.requestRender()}processed(){return this._processed}hasData(){return this.layerCount>0}dispose(){this.status!=="unloaded"&&(Hje.delete(this),Gje._destroyRenderBuckets(this.layerData),this.layerData=null,this.layerCount=0,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}release(){return--this._referenced==0&&(this.dispose(),this.stage=null,!0)}retain(){++this._referenced}get referenced(){return this._referenced}get memoryUsed(){return this._memoryUsedByLayerData+256}changeDataImpl(e){var i;let r=!1;if(e){const{bucketsWithData:n,emptyBuckets:s}=e,o=this._createRenderBuckets(n);if(s&&s.byteLength>0){const a=new Uint32Array(s);for(const l of a)this._deleteLayerData(l)}for(const[a,l]of o)this._deleteLayerData(a),l.type===Zu.SYMBOL&&(this.symbols.set(a,l.symbols),r=!0),this._memoryUsedByLayerData+=l.memoryUsed,this.layerData.set(a,l),this.layerCount++;(i=this._memCache)==null||i.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;for(const[n,s]of this.layerData)s.type===Zu.SYMBOL&&(this._hasSymbolBuckets=!0);r&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(r){r.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const r=this.resolution/(e.resolution*e.pixelRatio),i=this.width/this.rangeX*r,n=this.height/this.rangeY*r,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;Zue(o),sB(o,o,s),Jue(o,o,Math.PI*e.rotation/180),Kue(o,o,[i,n,1])}_createTransforms(){return{dvs:uu(),tileMat3:uu(),tileUnitsToPixels:uu()}}static _destroyRenderBuckets(e){if(!e)return;const r=new Set;e.forEach(i=>{r.has(i)||(i.destroy(),r.add(i))}),e.clear()}_createRenderBuckets(e){const r=new Map,i=new Map;for(const n of e){const s=this._deserializeBucket(n,i);for(const o of s.layerUIDs)r.set(o,s)}return r}_deserializeBucket(e,r){let i=r.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case Zu.FILL:i=new SBt(e,this.styleRepository);break;case Zu.LINE:i=new xBt(e,this.styleRepository);break;case Zu.SYMBOL:i=new TBt(e,this.styleRepository,this);break;case Zu.CIRCLE:i=new EBt(e,this.styleRepository)}return r.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const r=this.layerData.get(e);this._memoryUsedByLayerData-=r.memoryUsed,r.destroy(),this.layerData.delete(e),this.layerCount--}};const Hje=new Map;function ABt(){Hje.forEach((t,e)=>{console.log(`
${e.key}:`),t[0].forEach(r=>console.log(r)),console.log("========"),t[1].forEach(r=>console.log(r))})}const pTr={value:.5,readOnly:!0},PBt={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};let sA=class{constructor(e=0,r=0){this.min=e,this.max=r,this.level=0,this.hasNoDataValues=!1}copyFrom(e){this.min=e.min,this.max=e.max,this.level=e.level,this.hasNoDataValues=e.hasNoDataValues}},MBt=class{constructor(e,r){this.data=e,this.safeWidth=.99999999*(e.width-1),this.dx=(e.width-1)/(r[2]-r[0]),this.dy=(e.width-1)/(r[3]-r[1]),this.x0=r[0],this.y1=r[3]}},$Bt=class{constructor(e,r,i){this.type="elevation",this.level=e[0],this.i=e[1],this.j=e[2],this.extent=r,this.samplerData=new MBt(i,r)}computeMinMaxValue(e,r,i,n){n.min=1/0,n.max=-1/0,n.hasNoDataValues=!1;const s=e-this.level;if(s<=0)return n;const o=2**s;if(!(Math.floor(r/o)===this.i&&Math.floor(i/o)===this.j))return n;let a=1/0,l=-1/0;const c=this.samplerData.data.width,u=this.samplerData.data.values,h=.5*zN;let f=(c-1)/o,m=(i-this.j*o)*f,g=(r-this.i*o)*f;if(f<1){const y=Math.floor(m),_=Math.floor(g),b=y+_*c,w=u[b],x=u[b+1],S=u[b+c],C=u[b+c+1];if(w+x+S+C<h){const E=m-y,R=g-_,P=Y5(w,x,S,C,E,R),D=Y5(w,x,S,C,E+f,R),L=Y5(w,x,S,C,E,R+f),k=Y5(w,x,S,C,E+f,R+f);return n.min=Math.min(P,D,L,k),n.max=Math.max(P,D,L,k),n}m=y,g=_,f=1}else m=Math.floor(m),g=Math.floor(g),f=Math.ceil(f);for(let y=m;y<=m+f;y++)for(let _=g;_<=g+f;_++){const b=u[y+_*c];b<h?(a=Math.min(a,b),l=Math.max(l,b)):n.hasNoDataValues=!0}return n.min=a,n.max=l,n}};const IBt=.5*zN;function Ln(t,e,r){if(r==null)return null;for(const i of r){if(!i)continue;const n=i.safeWidth;let s=Te(i.dy*(i.y1-e),0,n),o=Te(i.dx*(t-i.x0),0,n);const a=Math.floor(s),l=Math.floor(o),c=i.data.width,u=a*c+l,h=i.data.values,f=h[u],m=h[u+1],g=u+c,y=h[g],_=h[g+1];if(f+y+m+_<IBt){s-=a,o-=l;const b=f+(m-f)*o;return b+(y+(_-y)*o-b)*s}}return null}let mp=class extends Ce{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(r=>{const i=r.layer;if(i.operationalLayerType==="IntegratedMeshLayer"&&this.viewSpatialReference!=null){const n=qje(i.fullExtent,this.viewSpatialReference);n!=null&&e.push(OLe(n))}}),e}};function LBt(t,e){return t===at.Global?new Lne(e):new Dne(e)}d([p({readOnly:!0})],mp.prototype,"layerViewsExtent",null),d([p({readOnly:!0})],mp.prototype,"tiledLayersExtent",null),d([p({readOnly:!0})],mp.prototype,"stencilEnabledExtents",null),d([p()],mp.prototype,"viewSpatialReference",void 0),d([p()],mp.prototype,"tilingScheme",void 0),d([p()],mp.prototype,"defaultTiledLayersExtent",void 0),d([p({constructOnly:!0})],mp.prototype,"layers",void 0),d([p({constructOnly:!0})],mp.prototype,"layerViews",void 0),mp=d([I("esri.views.3d.terrain.ExtentHelper")],mp);let Lne=class extends mp{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?Lke:bEt}};Lne=d([I("esri.views.3d.terrain.ExtentHelperGlobal")],Lne);let Dne=class extends mp{_computeLayerViewsExtent(){const e=xd(),r=this.viewSpatialReference;this.layerViews.forEach(s=>{const o=s.layer;if(s.isResolved()&&(o.type!=="graphics"||!o.internal)){const a=qje("fullExtentInLocalViewSpatialReference"in s&&s.fullExtentInLocalViewSpatialReference||s.layer.fullExtent,r);Fw(e,a,e)}});const i=qQ(e)?e:null,n=this._get("layerViewsExtent");return v2(i,n)?n:i}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const r=this.viewSpatialReference,i=xd();this.layers.forEach(o=>{if(o.loaded&&tD(o)){const a=uq(o,r,at.Local);if(a==null)return;const{tileInfo:l,fullExtent:c}=a;l!=null&&c!=null&&(fj(o)||e.compatibleWith(l)&&c.spatialReference.equals(e.spatialReference))&&Fw(i,c,i)}}),Fw(i,this.defaultTiledLayersExtent,i);const n=qQ(i)?i:null,s=this._get("tiledLayersExtent");return v2(n,s)?s:n}};function qje(t,e){return t==null||t.spatialReference.equals(e)?t:oue(t,t.spatialReference,e)}Dne=d([I("esri.views.3d.terrain.ExtentHelperLocal")],Dne);var Er;(function(t){t[t.ELEVATION=0]="ELEVATION",t[t.MAP=1]="MAP"})(Er||(Er={}));const lT=[Er.ELEVATION,Er.MAP];function Wje(){var e;const t=(e=globalThis.require)==null?void 0:e.modules;if(t){const r=Object.keys(t);for(const i of r)i.search(".glsl")!==-1&&delete t[i]}}const DBt=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let V1,ac=class extends Ce{get running(){return this._placementDirty&&(this._drapeSources.size>0||this.view.graphics.length>0||Di.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}get _isSpherical(){return this.view.state.isGlobal}get _worldToPCSRatio(){return this._spatialReference!=null&&this._spatialReference.isGeographic&&!this.view.state.isLocal?Xr(this._spatialReference).metersPerDegree:1}get suspended(){return this.surface.suspended}get updating(){return this.running||this.renderer.updating||this._contentUpdated}get hasHighlights(){return this.renderer.hasHighlights}get rendersOccluded(){return this.renderer.rendersOccluded}constructor(e){super(e),this._handles=new Ri,this._spatialReference=null,this._renderSR=null,this._overlaySREqualsRenderSR=!0,this._drapeSources=new Set,this._drapeTargets=new Set,this._placementDirty=!1,this._contentUpdated=!1,this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1,this._hasUnusedRenderTargets=!1,this._longitudeCyclical=null,this._latestOriginId=0,this._maxResolution=he("esri-mobile")?2048:4096,this._animationTimeLast=0,this._removeRenderOverlayCallback=()=>{}}initialize(){var n;const e=this.view;this.renderer=new sy({view:e,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});const r=()=>this.setDrawTexturesDirty();this._groundIntersector=hf(this.view.state.viewingMode),this._groundIntersector.options.backfacesTerrain=!0,this._groundIntersector.options.invisibleTerrain=!0,this._groundIntersector.options.hud=!1,this._handles.add([this.renderer.events.on("has-highlights",()=>{r(),this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",s=>{var o;return(o=e._stage)==null?void 0:o.renderer.setParameters({hasOverlayWater:s})}),this.renderer.events.on("renders-occluded",()=>{r(),this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",r),pe(()=>e.state.camera.pixelRatio,r),pe(()=>e.state.alignPixelEnabled,r),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),pe(()=>{var s,o,a;return[(s=e.pointsOfInterest)==null?void 0:s.renderPointOfView,(a=(o=e.pointsOfInterest)==null?void 0:o.centerOnSurfaceFrequent)==null?void 0:a.location]},()=>this.setPlacementDirty()),pe(()=>{var s,o;return[(s=e.state)==null?void 0:s.pixelRatio,(o=e.state)==null?void 0:o.contentPixelRatio]},()=>this.setPlacementDirty(),li),this.surface.on("elevation-change",()=>this.setPlacementDirty()),e.on("resize",()=>this.setPlacementDirty()),e.resourceController.scheduler.registerTask(Vt.OVERLAY,this),e._stage.renderView.events.on("force-camera-for-screenshot",s=>{this._updateOverlays(bc,s.camera,is.BACKGROUND),this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,is.BACKGROUND,s)})]);let i=s=>this._renderOverlayCallback(s);this._removeRenderOverlayCallback=()=>{i=()=>{}},(n=e._stage)==null||n.renderer.setParameters({renderOverlay:s=>i(s)})}_renderOverlayCallback(e){this._contentUpdated=!1;const r=this.renderer;r.processSyncDrapeSources(),r.hasOverlays&&(this._dispatchAnimationUpdate(e),this._drawOverlayTextures(r.overlays,is.UPDATE,this.view.state)),this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}destroy(){var e,r;this._handles=qe(this._handles),this._removeRenderOverlayCallback(),(r=(e=this.view)==null?void 0:e._stage)==null||r.renderer.setParameters({renderOverlay:()=>{}}),V1!=null&&(V1.hide(),V1=null)}get hasOverlays(){return this.renderer.hasOverlays}setSpatialReference(e){this._spatialReference=e,this.renderer.spatialReference=e,this._longitudeCyclical=null;const r=this.view.renderSpatialReference;e!=null&&r!=null?(this._renderSR=r,this._overlaySREqualsRenderSR=e.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=e.isWebMercator?new Xw(-20037508342787e-6,20037508342787e-6):new Xw(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()}get gpuMemoryUsage(){return this.renderer.gpuMemoryUsage}registerDrapeSource(e,r,i){this._drapeSources.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const n=this.renderer.createDrapeSourceRenderer(e,r,i);return this._updateDrapeSourceExtent(e),this._setContentDirty(),this.notifyChange("running"),n}registerGeometryDrapeSource(e){return this.registerDrapeSource(e,Wd)}_updateDrapeSourceExtent(e){this.renderer.overlays.length===2&&e.setDrapingExtent!=null&&this._spatialReference!=null&&e.setDrapingExtent(this.renderer.overlays,this._spatialReference)}unregisterDrapeSource(e){this._drapeSources.has(e)&&(this._drapeSources.delete(e),this.renderer.removeDrapeSourceRenderer(e),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))}registerDrapeTarget(e){this._drapeTargets.add(e),this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)}updateOverlayResult(){var e;(e=this.view._stage)==null||e.renderer.setParameters({overlays:this.renderer.overlays})}unregisterDrapeTarget(e){this._drapeTargets.delete(e),this.renderer.ensureDrapeTargets(this._drapeTargets)}_setContentDirty(){this.setPlacementDirty(),this.setDrawTexturesDirty()}setPlacementDirty(){this._placementDirty=!0}runTask(e){return this._updateOverlays(e,this.view.state.contentCamera,is.UPDATE)}_updateOverlays(e,r,i){if(!this._spatialReference)return ll.YIELD;const n=this._computeOverlayResolution(r);this._computeOverlayExtents(r,n,q0);const s=lh(q0.inner)/lh(q0.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);const o=this._updateOverlay(mn.INNER,q0.inner,n,1*q0.pixelRatioAdjustment,q0.mapUnitsPerPixel),a=this._updateOverlay(mn.OUTER,q0.outer,n,s*q0.pixelRatioAdjustment,q0.mapUnitsPerPixel);o!==yy.EXTENT&&a!==yy.EXTENT||(this._drapeSources.forEach(l=>this._updateDrapeSourceExtent(l)),this.surface.updateTileOverlayParams(i)),o===yy.NONE&&a===yy.NONE||this.setDrawTexturesDirty(),this._placementDirty=!1,e.madeProgress()}_computeOverlayResolution(e){const r=this.view.state.contentPixelRatio,i=e.fullWidth/e.pixelRatio*r,n=e.fullHeight/e.pixelRatio*r,s=Math.ceil(1.5*Math.max(i,n));return Math.min(upe(s),this._maxResolution)}_updateOverlay(e,r,i,n,s){if(this.renderer.overlays.length===0)return yy.NONE;const o=this.renderer.overlays[e],a=o.mapUnitsPerPixel;if(o.mapUnitsPerPixel=s,o.pixelRatio=n,NBt(r,o.extent)&&i===o.resolution)return a===s?yy.NONE:yy.RERENDER_ONLY;A_(o.extent,r),o.resolution=i;const l=qce(o.extent);return o.renderLocalOrigin=GB(l[0],l[1],0,"OV_"+this._latestOriginId++),yy.EXTENT}setTileParameters(e){const r=e.renderData.overlay;if(this.renderer.overlays.length>0){const i=this.renderer.overlays[mn.INNER],n=this.renderer.overlays[mn.OUTER],s=e.extent;this._rectInsideRect(i.extent,s)||this._rectanglesOverlap(s,i.extent)||this._rectanglesOverlap(s,n.extent)?(this._setTileOverlayData(s,mn.INNER,r),this._setTileOverlayData(s,mn.OUTER,r)):(this._clearTileOverlayData(mn.INNER,r),this._clearTileOverlayData(mn.OUTER,r))}else this._clearTileOverlayData(mn.INNER,r),this._clearTileOverlayData(mn.OUTER,r)}overlayPixelSizeInMapUnits(e){if(this.renderer.overlays.length===0)return 0;const r=this.renderer.overlays[mn.INNER],i=this.renderer.overlays[mn.OUTER],n=this._pointIsInExtent(e,r.extent)?r:i;return(n.extent[2]-n.extent[0])/n.resolution}_setTileOverlayData(e,r,i){if(this.renderer.overlays.length===0)return;const n=this.renderer.overlays[r].extent,s=lh(n),o=og(n);let a=e[0];if(this._longitudeCyclical){a=this._longitudeCyclical.minimalMonotonic(n[0],a);const l=this._longitudeCyclical.minimalMonotonic(n[0],e[2]);a>l&&(a=l-(e[2]-e[0]))}i.setScale(r,lh(e)/s,og(e)/o),i.setOffset(r,(a-n[0])/s,(e[1]-n[1])/o)}_clearTileOverlayData(e,r){r.setScale(e,-1,-1),r.setOffset(e,-1,-1)}async reloadShaders(){Wje(),await this.renderer.reloadShaders(),this.setDrawTexturesDirty(),this.runTask(bc)}_dispatchAnimationUpdate(e){const r=e-this._animationTimeLast;if(r>=this.surface.view._stage.renderer.animationTimestep||this.view.state.forcedAnimationTime!=null||this._drawTexturesDirty||this._drawTexturesAnimateDirty){const i=r/this.surface.view._stage.renderer.animationTimeDilation,n=new R8e(this.view.state.camera,i,this.view.state.forcedAnimationTime);this.renderer.updateAnimation(n)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=e}}setDrawTexturesDirty(){this.renderer.hasOverlays?(this._contentUpdated=!0,this._drawTexturesDirty=!0,this.view._stage.renderView.requestRender()):this.setPlacementDirty()}_intersectGroundFromView(e,r,i,n){const s=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(e,UBt,r,i);if(s==null)return!1;const o=s.origin,a=ge(J6,s.origin,s.direction);return this._groundIntersector.reset(o,a,e),this._groundIntersector.intersect([]),this.view.basemapTerrain.intersect(this._groundIntersector,null,o,a),this._groundIntersector.results.min.getIntersectionPoint(n)}_findHorizonBasedPointOfInterest(e,r){let i=.5;const n=.55,s=this.view.renderCoordsHelper.getAltitude(e.eye),o=this.view.pointsOfInterest.centerOnSurfaceFrequent,a=1e-5,l=Te(o.estimatedSurfaceAltitude,e.aboveGround?-1/0:s+a,e.aboveGround?s-a:1/0),c=e.aboveGround;if(this.view.viewingMode==="global"){const u=J6;V3(eH(tH,Xr(this.view.spatialReference).radius+l),Ah(e.eye,e.viewForward),u),ve(u,u,e.eye);const h=Yw.normalize(UFe(e.viewForward,u,e.viewRight))/e.fovY+.5,f=h<=0||h>=1?.5:n;i=c?f*h:h+f*(1-h)}else{const u=.5*Math.PI-Math.acos(-e.viewForward[2]),h=Math.tan(u),f=nr(0,h,1,0),m=hh(f,f,e.projectionMatrix)[1],g=Te(.5+.5*m,0,1);i=g===1||g===0?.5:c?g*n:1-(1-g)*n}return!!this._intersectGroundFromView(e,.5,i,r)&&S7(r,e.eye)<o.distance*o.distance}_computeOverlayExtents(e,r,i){const n=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,s=A();this._findHorizonBasedPointOfInterest(e,s)||oe(s,n),Di.OVERLAY_SHOW_CENTER?(V1==null&&(V1=new KR(this.view.graphics,"red")),V1.show(s,this._renderSR)):V1!=null&&V1.hide();const o=Math.max(.1,Li(e.eye,s)),a=hx(this.view.renderCoordsHelper,n,e.eye);this._overlaySREqualsRenderSR||Ys(s,this._renderSR,s,this._spatialReference);const l=this.surface.extent,c=!this._isSpherical&&this._spatialReference!=null&&this._spatialReference.isGeographic,u=c&&this._spatialReference!=null?1/Xr(this._spatialReference).metersPerDegree:1,h=this.view.state.contentPixelRatio,f=e.perScreenPixelRatio/h*o*u;i.mapUnitsPerPixel=f/this._worldToPCSRatio;let m=r*f/2*Rhe,g=!1,y=c?90:1/0;this._isSpherical&&l!=null&&this._spatialReference!=null&&(this._spatialReference.isWebMercator?(m/=Math.cos(PV(s[1])),y=l[3]):(g=!0,m/=Xr(this._spatialReference).metersPerDegree,y=90),m>=y&&(m=y,s[1]=0,this._spatialReference.isWebMercator&&(s[0]=0)));let _=1;g&&(_=1/Math.max(.2,Math.cos(Math.abs(sr(s[1])))),m*_>180&&(_=180/m),i.mapUnitsPerPixel*=_);const b=Math.log(2)/12;m=Math.exp(Math.round(Math.log(m)/b)*b);const w=m*_,x=32,S=.5*r/(x*w),C=.5*r/(x*m);s[0]=Math.round(s[0]*S)/S,s[1]=Math.round(s[1]*C)/C;const E=i.inner;E[0]=s[0]-w,E[1]=s[1]-m,E[2]=s[0]+w,E[3]=s[1]+m,this._isSpherical&&this._shiftExtentToFitBounds(E,1/0,y);const R=i.outer;if(6*w>lh(l))A_(R,l);else if(Math.PI/2-Math.abs(a-Math.PI/2)<=.25*Math.PI)R[0]=E[0]-w,R[1]=E[1]-m,R[2]=E[2]+w,R[3]=E[3]+m;else{Ys(e.eye,this._renderSR,J6,this._spatialReference),os(yS,s,J6);let D=-Math.atan2(yS[1],yS[0])+.125*Math.PI;D<0&&(D+=2*Math.PI);const L=Math.floor(D/(.25*Math.PI));eE(yS,DBt[L],2*m),yS[0]*=_,yS[2]*=_,kce(R,E,yS)}if(this._isSpherical)R[0]=this._longitudeCyclical.clamp(R[0]),R[2]=this._longitudeCyclical.clamp(R[2]),R[1]=Math.max(R[1],-y),R[3]=Math.min(R[3],y);else{const D=WQ(E,l,FBt),L=WQ(R,l,kBt);vve(D,L)&&(R[2]=R[0],R[3]=R[1])}const P=Math.abs(E[2]-E[0])/r;i.mapUnitsPerPixel=Math.max(i.mapUnitsPerPixel,P),i.pixelRatioAdjustment=i.mapUnitsPerPixel/P}_drawOverlayTextures(e,r,i){if(e.length===0||!this._drawTexturesDirty&&!this._drawTexturesAnimateDirty)return;const n=this._drawTexturesDirty;this._drawTexturesDirty=!1,this._drawTexturesAnimateDirty=!1;const s=this._drawOverlay(e[mn.INNER],i),o=this._drawOverlay(e[mn.OUTER],i);s!==GP.CHANGED&&o!==GP.CHANGED||this.surface.updateTileOverlayParams(is.UPDATE),this._collectUnusedRenderTargetMemory(),this.updateOverlayResult(),n?(this.surface.requestRender(r),r===is.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(is.BACKGROUND)}_drawOverlay(e,r){return this._longitudeCyclical?e.setupGeometryViewsCyclical(this._longitudeCyclical):e.setupGeometryViewsDirect(),e.draw(this.renderer,r)}_collectUnusedRenderTargetMemory(){this._hasUnusedRenderTargets=!1,this.renderer.hasOverlays&&(this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory())}_rectanglesOverlap(e,r){return e!=null&&(this._longitudeCyclical?(this._longitudeCyclical.contains(r[0],r[2],e[0])||this._longitudeCyclical.contains(r[0],r[2],e[2])||this._longitudeCyclical.contains(e[0],e[2],r[0]))&&!(e[1]>r[3]||e[3]<r[1]):Z4(e,r))}_rectInsideRect(e,r){return r!=null&&(this._longitudeCyclical?this._longitudeCyclical.contains(e[0],e[2],r[0])&&this._longitudeCyclical.contains(e[0],e[2],r[2])&&r[1]>e[1]&&r[3]<e[3]:vve(e,r))}_pointIsInExtent(e,r){if(this._longitudeCyclical)return this._longitudeCyclical.contains(r[0],r[2],e.x)&&e.y>=r[1]&&e.y<=r[3];const i=e.x,n=e.y;return i>r[0]&&i<r[2]&&n>r[1]&&n<r[3]}_shiftExtentToFitBounds(e,r,i){let n=0,s=0;e[0]<-r?n=e[0]+r:e[2]>r&&(n=r-e[2]),e[1]<-i?s=e[1]+i:e[3]>i&&(s=i-e[3]),kV(e,n,s)}get test(){return{renderer:this.renderer,update:()=>this.runTask(bc)}}};function NBt(t,e){const i=Di.TESTS_DISABLE_OPTIMIZATIONS?0:1e-5*Math.max(t[2]-t[0],t[3]-t[1],e[2]-e[0],e[3]-e[1]);return Math.abs(e[0]-t[0])<=i&&Math.abs(e[1]-t[1])<=i&&Math.abs(e[2]-t[2])<=i&&Math.abs(e[3]-t[3])<=i}d([p()],ac.prototype,"_spatialReference",void 0),d([p({readOnly:!0})],ac.prototype,"running",null),d([p()],ac.prototype,"_placementDirty",void 0),d([p()],ac.prototype,"_contentUpdated",void 0),d([p()],ac.prototype,"_isSpherical",null),d([p()],ac.prototype,"_worldToPCSRatio",null),d([p({autoDestroy:!0})],ac.prototype,"renderer",void 0),d([p({constructOnly:!0})],ac.prototype,"view",void 0),d([p({constructOnly:!0})],ac.prototype,"surface",void 0),d([p()],ac.prototype,"suspended",null),d([p()],ac.prototype,"updating",null),d([p({type:Boolean})],ac.prototype,"hasHighlights",null),d([p({type:Boolean})],ac.prototype,"rendersOccluded",null),ac=d([I("esri.views.3d.terrain.OverlayManager")],ac);const yS=wr(),J6=A(),q0={inner:lr(),outer:lr(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},FBt=lr(),kBt=lr(),UBt=la();var yy;(function(t){t[t.NONE=0]="NONE",t[t.EXTENT=1]="EXTENT",t[t.RERENDER_ONLY=2]="RERENDER_ONLY"})(yy||(yy={}));let Xje=class Nne{constructor(e,r){this._factoryCallback=e,this._lengthCallback=r,this._pool=new Map}acquire(e){if(!Nne.test.disabled){const r=this._pool.get(e);if(r&&r.length!==0)return r.pop()}try{return this._factoryCallback(e)}catch(r){const i=window.performance&&window.performance.memory;let n="";throw i&&(n=`
  totalJSHeapSize: ${i.totalJSHeapSize}, usedJSHeapSize: ${i.usedJSHeapSize}, jsHeapSizeLimit: ${i.jsHeapSizeLimit}`),console.log("Array allocation of size "+e+" failed: "+r+n),r}}release(e){if(Nne.test.disabled)return;const r=this._lengthCallback(e);let i=this._pool.get(r);i||(i=new dr({shrink:!0}),this._pool.set(r,i)),i.push(e)}clear(){this._pool.clear()}get test(){return{size:this._pool.size}}};Xje.test={disabled:!1};let zBt=class{constructor(){this.indices=null,this.vertexAttributes=null,this.boundingBox=en(),this.indexCount=0,this.numVerticesPerSide=0,this.uvRange=[0,0,1,1],this.outerEdges=[null,null,null,null],this.innerEdges=[null,null,null,null]}},r2e=class{constructor(e,r,i,n,s){this.attributes=e,this.localOrigin=r,this.index0=i,this.stride=n,this.count=s}getVertexIndex(e){return this.getAttributeIndex(e)}getAttributeIndex(e){return Ne(0<=e&&e<this.count),this.index0+this.stride*e}_getVertexRaw(e,r){this.attributes.position.getVec(e,r)}getVertexPos(e,r){this._getVertexRaw(this.getAttributeIndex(r),e),ge(e,e,this.localOrigin)}getNormal(e,r){const{typedBuffer:i,typedBufferStride:n}=this.attributes.normalCompressed;gFt(e,i,this.getAttributeIndex(r),n)}_setNormal(e,r,i,n){const{typedBuffer:s,typedBufferStride:o}=this.attributes.normalCompressed;_E(s,e,r,i,n,o)}_setUV(e,r,i){Qm(this.attributes.uv0,e,r,i)}setNormalFromValues(e,r,i,n){this._setNormal(this.getAttributeIndex(e),r,i,n)}setVertexFromValuesRawPositionUV(e,r,i,n,s,o){const a=this.getAttributeIndex(e);this.attributes.position.setValues(a,r,i,n),this._setUV(a,s,o)}setVertexFromValuesRawPositionUVNormal(e,r,i,n,s,o,a,l,c){const u=this.getAttributeIndex(e);this.attributes.position.setValues(u,r,i,n),this._setUV(u,s,o),this._setNormal(u,a,l,c)}};const VBt=On().vec3f(O.POSITION).vec2i16(O.UV0).vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),Xpe=new Xje(t=>VBt.createBuffer(t),t=>t.count);function BBt(){Xpe.clear()}function Yje(t){return Xpe.acquire(t)}function jBt(t){Xpe.release(t.vertexAttributes),t.vertexAttributes=null,t.indices=null}const i2e=16384;function Qm(t,e,r,i){t.setValues(e,r*i2e,i*i2e)}function Zp(t,e,r,i){t<i[0]?i[0]=t:t>i[3]&&(i[3]=t),e<i[1]?i[1]=e:e>i[4]&&(i[4]=e),r<i[2]?i[2]=r:r>i[5]&&(i[5]=r)}let GBt=class{constructor(){this.sinLonLUT=new Array(DI+1),this.cosLonLUT=new Array(DI+1),this.sinLatLUT=new Array(DI+1),this.cosLatLUT=new Array(DI+1)}update(e,r,i){const n=r[0],s=r[2];for(let o=0;o<=e;o++){const a=o/e,l=n*(1-a)+s*a;this.sinLonLUT[o]=Math.sin(l),this.cosLonLUT[o]=Math.cos(l);const c=i(a);this.sinLatLUT[o]=Math.sin(c),this.cosLatLUT[o]=Math.cos(c)}}},K6=class{constructor(){this.cornerTiles=[null,null,null,null],this.cornerTileSamplerVersions=[-1,-1,-1,-1]}},HBt=class{constructor(){this.cornerNeighborData=[new K6,new K6,new K6,new K6],this.edgeResolutions=[-1,-1,-1,-1],this.edgePeerNeighbors=[null,null,null,null],this.edgePeerNeighborSamplerVersions=[-1,-1,-1,-1],this.cornerPeerNeighbors=[null,null,null,null]}},qBt=class{constructor(){this.numVerticesPerSide=0,this.samplerData=null,this.clippingArea=null,this.wireframe=!1,this.samplerDataVersion=0,this.neighborData=new HBt}},Zje=class Bz{constructor(e){this._getFadeDuration=e,this._fadeStart=0,this._delayedTime=0}clear(){this._current=qe(this._current),this._next=qe(this._next),this._waiting=qe(this._waiting),this._delayed=qe(this._delayed)}get current(){if(this._current==null)return null;if(!this._isFadingEnabled){const r=this._delayed||this._waiting||this._next||this._current;r!==this._current&&(this._current=null,this.clear(),this._current=r)}let e=Bz.test.fadeMoment;if(this._delayed!=null&&(e=e||performance.now(),e>=this._delayedTime&&(this._push(this._delayed,u_.Immediate),this._delayed=null)),this._next!=null){e=e||performance.now();const r=this._fadeDuration,i=this._current!=null&&this._next.texture===this._current.texture,n=this._next.type!==mo.FADING,s=e-this._fadeStart>=r;(i||n||s)&&(qe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(e))}return this._current}get next(){return this._next}get fadeFactor(){if(this._next==null)return 1;const e=Bz.test.fadeMoment||performance.now(),r=Math.max(0,e-this._fadeStart),i=this._fadeDuration;return r>i?0:1-r/i}get isFading(){return this._next!=null||this._delayed!=null}push(e,r=u_.Immediate){this._delayed=qe(this._delayed),this._push(e,r)}_push(e,r){if(this._isFadingEnabled||this.clear(),this._current==null)return void(this._current=e);const i=Bz.test.fadeMoment||performance.now();return r!==u_.Immediate?(this._delayed=e,void(this._delayedTime=i+r)):this._next==null?(this._next=e,void(this._fadeStart=this._alignFadeStart(i))):void(e!=null&&(qe(this._waiting),this._waiting=e))}get _fadeDuration(){return this._waiting==null?this._getFadeDuration():.5*this._getFadeDuration()}_alignFadeStart(e){const r=this._getFadeDuration();return e+r-e%r}get _isFadingEnabled(){return this._getFadeDuration()>0}};var u_;Zje.test={fadeMoment:0},function(t){t[t.Immediate=0]="Immediate",t[t.Delayed=5e3]="Delayed"}(u_||(u_={}));var n3;(function(t){t[t.BACK_TO_FRONT=-1]="BACK_TO_FRONT",t[t.NONE=0]="NONE",t[t.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(n3||(n3={}));let Jje=class{constructor(){this._queue=new dr,this.remove=()=>{}}get done(){return this._queue.length===0&&(!this._last||this._last.isLeaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),e!=null&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){var r;const e=(r=this._last)==null?void 0:r.children;return e&&e[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},WBt=class{constructor(){this._q=new dr}get done(){return this._q.length===0}reset(e){if(this._q.clear(),e!=null){this._q.pushArray(e);for(let r=0;r<this._q.length;++r){const i=this._q.data[r];i.isLeaf||this._q.pushArray(i.children)}}}next(){return this._q.pop()}};function FD(t,e,r){if(e==null||e.fullExtent==null)return!1;const i=e.fullExtent,n=t.extent;if(r){if(n[0]<i.xmin||n[1]<i.ymin||n[2]>i.xmax||n[3]>i.ymax)return!1}else if(i.xmin>n[2]||i.ymin>n[3]||i.xmax<n[0]||i.ymax<n[1])return!1;const s=t.surface.tilingScheme.levels[t.level].scale,o=e.minScale;if(o>0&&s>1.00000001*o)return!1;const a=e.maxScale;return!(a>0&&s<.99999999*a)}function d_(t,e){const r=t.lij,i=e.lij;return r[0]-i[0]||r[1]-i[1]||r[2]-i[2]}function Kje(t,e,r=null){r==null||r.length===0?t===n3.BACK_TO_FRONT?e.sort(XBt):e.sort(YBt):e.sort((i,n)=>ZBt(i,n,t,r))}function XBt(t,e){const r=e.screenDepth-t.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function YBt(t,e){const r=t.screenDepth-e.screenDepth;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function Qje(t,e,r){const i=t.screenDepth,n=e.screenDepth;return i<n?-r:i>n?r:d_(t,e)}function ZBt(t,e,r,i){return n2e(t,i)===n2e(e,i)?Qje(t,e,r):t?r:-r}function n2e(t,e){for(const r of e)if(t.intersectsExtent(r))return!0;return!1}function JBt(t,e){const r=t.distanceToPOI-e.distanceToPOI;if(r!==0)return r;const i=t.lij,n=e.lij;return i[0]-n[0]||i[1]-n[1]||i[2]-n[2]}function KBt(t,e){const r=t.length;for(let i=0;i<r;++i)t.at(i).updateDistanceToPOI(e);t.sort(JBt)}function QBt(t,e,r){let i=1,n=0,s=0;for(;t!==e;)if(i*=.5,n*=.5,s*=.5,1&t.lij[2]&&(n+=.5),!(1&t.lij[1])&&(s+=.5),(t=t.parent)==null)throw new Error("tile was not a descendant of upsampleTile");r.init(e,n,s,i)}function ejt(t){for(let e=0;e<t.length;e++){const r=t[e],i=r.parent;if(i)for(let n=0;n<4;n++){const s=i.children[n];if(s&&s!==r)return!0}}return!1}function ATr(t,e){if(!t||!e||t[0]===e[0])return!1;const r=t[0]<e[0],i=r?t:e,n=r?e:t,s=1<<n[0]-i[0];return Math.floor(n[1]/s)===i[1]&&Math.floor(n[2]/s)===i[2]}let Ype=class{get updating(){return!!this._tileRequested}init(e,r,i,n){this.tile=e,this._layerIdx=r,this._layerClass=i,this._suspended=n,this._tileLayerInfo=e.getLayerInfo(r,i),this._tileRequested=null;const s=this._findAncestorWithData();this._setUpsampleTile(s)}startLoading(){return this._requestNext()}dispose(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null),this.tile=null,this._tileLayerInfo=null}setSuspension(e){e!==this._suspended&&(this._suspended=e,e?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())}update(){const e=this._findAncestorWithData();return this._setUpsampleTile(e),this._requestNext()}dataArrived(e,r){this._setUpsampleTile(e,r),this._tileRequested=null,e===this.tile?this.tile.updateRenderData(this._layerClass,mo.FADING,r):this._requestNext()}dataMissing(){this._tileRequested=null,this._tileLayerInfo.data=null,this._requestNext()}_agentDone(){this.tile.agentDone(this._layerIdx,this._layerClass),this.dispose()}_requestNext(){if(this._suspended)return!0;const e=this._findNextDownload();if(this._tileRequested){if(e===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null}return e!=null?e.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=e):this._agentDone(),!!this._tileRequested}_findNextDownload(){const e=this._layerIdx,r=this._layerClass,i=this.tile.surface.layerViewByIndex(e,r),n=Pne(i),{minLevel:s,maxLevel:o}=i.dataLevelRange,a=this._desiredMinLevelDelta,l=this._progressiveLevelModulo+a,c=this._scaleRangeEnabled?FD:()=>!0;let u=this.tile;const h=u.level;let f;const m=this._tileLayerInfo.upsampleInfo,g=m!=null?m.tile.level:-1,y=m!=null&&g-h>=a,_=n==null?void 0:n.tilemapCache,b=i.type==="vector-tile-3d"?i.schemaHelper:null;for(;u&&c(u,n,!1)&&u.level>=s;){const w=u.level,x=h-w,S=u.layerInfo[r][e];if(S.data&&x>=a){(!y||w>g)&&this._setUpsampleTile(u),S.dataInvalidated&&(f=u);break}const C=(b==null?void 0:b.getLevelRowColumn(u.lij))??u.lij;if((_==null?void 0:_.getAvailability(C[0],C[1],u.lij[2]))!=="unavailable"&&w<=o&&!S.data&&!S.dataMissing&&((!f||u.level===s||w%Ike==0||h-f.level<a)&&(f=u),x>=l))break;u=u.parent}if(f!=null&&h-f.level<a)if(m)f=null;else{const w=this._findAncestorWithData();w!=null&&(this._setUpsampleTile(w),f=w.layerInfo[r][e].dataInvalidated?w:null)}return f}_findAncestorWithData(){const e=this.tile.elevationLevel,r=this._desiredMinLevelDelta;let i;for(let n=this.tile;n;n=n.parent)if(n.hasLayerData(this._layerIdx,this._layerClass)){if(e-n.level>=r)return n;i=n}return i}_setUpsampleTile(e,r){this._tileLayerInfo.setUpsampleInfo(this.tile,e),this.tile.updateRenderData(this._layerClass,mo.FADING,r)}get test(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}},tjt=class extends Ype{get _desiredMinLevelDelta(){throw s2e}get _progressiveLevelModulo(){throw s2e}dispose(){}};const s2e=new Error("Abstract method called on TileAgent"),Cu=new tjt;let eGe=class extends Ype{constructor(){super(...arguments),this._scaleRangeEnabled=!1}get _desiredMinLevelDelta(){return Sre(this.tile.level)-(this.tile.elevationLevel-this.tile.level)}get _progressiveLevelModulo(){return 0}},tGe=class extends Ype{constructor(){super(),this._scaleRangeEnabled=!0}get _desiredMinLevelDelta(){return 0}get _progressiveLevelModulo(){return Ike}};var I2,wE;(function(t){t[t.Stretch=0]="Stretch",t[t.Lut=1]="Lut",t[t.Hillshade=2]="Hillshade",t[t.COUNT=3]="COUNT"})(I2||(I2={})),function(t){t[t.Noop=0]="Noop",t[t.PerBand=1]="PerBand",t[t.COUNT=2]="COUNT"}(wE||(wE={}));function rjt(t){t.fragment.uniforms.add(new Mt("u_colormap",e=>e.u_colormap),new Ye("u_colormapOffset",e=>e.colormap.u_colormapOffset),new Ye("u_colormapMaxIndex",e=>e.colormap.u_colormapMaxIndex),new Ye("u_opacity",e=>e.common.u_opacity)),t.fragment.code.add(T`vec4 colormap(vec4 currentPixel, bool isFloat) {
float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
result = texelFetch(u_colormap, ivec2(texelCoordinates), 0);
}
return result;
}`)}function ijt(t){t.fragment.uniforms.add(new Mt("u_transformGrid",e=>e.u_transformGrid),new Yr("u_transformSpacing",e=>e.common.u_transformSpacing),new Yr("u_targetImageSize",e=>e.common.u_targetImageSize)),t.fragment.code.add(T`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(4.0, 1.0);
vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;
vec2 pos = fract((index_image + 0.5) / u_transformSpacing);
vec2 transform_location = index_transform + 0.5;
vec2 srcLocation;
if (pos.s <= pos.t) {
vec3 ll_abc = texelFetch(u_transformGrid, ivec2(transform_location), 0).rgb;
vec3 ll_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 1.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
srcLocation.t = dot(ll_def, vec3(pos, 1.0));
} else {
vec3 ur_abc = texelFetch(u_transformGrid, ivec2(transform_location.s + 2.0, transform_location.t), 0).rgb;
vec3 ur_def = texelFetch(u_transformGrid, ivec2(transform_location.s + 3.0, transform_location.t), 0).rgb;
srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
srcLocation.t = dot(ur_def, vec3(pos, 1.0));
}
return srcLocation;
}`)}let rGe=class extends Ai{constructor(){super(...arguments),this.scale=1,this.offset=cg}};function iGe(t){t.attributes.add(O.POSITION,"vec2"),t.attributes.add(O.UV0,"vec2"),t.vertex.uniforms.add(new Ye("scale",e=>e.scale)),t.vertex.uniforms.add(new Yr("offset",e=>e.offset)),t.varyings.add("uv","vec2"),t.varyings.add("vuv","vec2"),t.vertex.code.add(T`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)}let njt=class extends rGe{constructor(e,r,i){super(),this.common=e,this.u_image=r,this.u_transformGrid=i}};function sjt(t,e){t.include(ijt),t.fragment.uniforms.add(new Mt("u_image",i=>i.u_image),new Jy("u_flipY",i=>i.common.u_flipY),new Jy("u_applyTransform",i=>i.common.u_applyTransform));const{requireBilinearWithNN:r}=e;r&&t.fragment.uniforms.add(new Yr("u_srcImageSize",i=>i.common.u_srcImageSize)),t.fragment.code.add(T`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}`),r?t.fragment.code.add(T`vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {
vec2 texelStart = floor(coords * texSize);
vec2 coord0 = texelStart / texSize;
vec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;
vec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;
vec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;
vec4 color0 = texture(sampler, coord0);
vec4 color1 = texture(sampler, coord1);
vec4 color2 = texture(sampler, coord2);
vec4 color3 = texture(sampler, coord3);
vec2 blend = fract(coords * texSize);
vec4 color01 = mix(color0, color1, blend.x);
vec4 color23 = mix(color2, color3, blend.x);
vec4 color = mix(color01, color23, blend.y);
float alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);
color = color * alpha + (1.0 - alpha) * texture(sampler, coords);
return color;
}
vec4 getPixel(vec2 pixelLocation) {
return sampleBilinear(u_image, pixelLocation, u_srcImageSize);
}`):t.fragment.code.add(T`vec4 getPixel(vec2 pixelLocation) {
return texture(u_image, pixelLocation);
}`)}var et;(function(t){t[t.Normal=0]="Normal",t[t.Average=1]="Average",t[t.Lighten=2]="Lighten",t[t.Lighter=3]="Lighter",t[t.Plus=4]="Plus",t[t.Screen=5]="Screen",t[t.ColorDodge=6]="ColorDodge",t[t.Darken=7]="Darken",t[t.Multiply=8]="Multiply",t[t.ColorBurn=9]="ColorBurn",t[t.Overlay=10]="Overlay",t[t.SoftLight=11]="SoftLight",t[t.HardLight=12]="HardLight",t[t.VividLight=13]="VividLight",t[t.Hue=14]="Hue",t[t.Saturation=15]="Saturation",t[t.Luminosity=16]="Luminosity",t[t.Color=17]="Color",t[t.DestinationOver=18]="DestinationOver",t[t.DestinationAtop=19]="DestinationAtop",t[t.DestinationIn=20]="DestinationIn",t[t.DestinationOut=21]="DestinationOut",t[t.SourceAtop=22]="SourceAtop",t[t.SourceIn=23]="SourceIn",t[t.SourceOut=24]="SourceOut",t[t.Xor=25]="Xor",t[t.Difference=26]="Difference",t[t.Exclusion=27]="Exclusion",t[t.Minus=28]="Minus",t[t.Invert=29]="Invert",t[t.Reflect=30]="Reflect",t[t.COUNT=31]="COUNT"})(et||(et={}));const Fne={normal:et.Normal,average:et.Average,lighten:et.Lighten,lighter:et.Lighter,screen:et.Screen,plus:et.Plus,"color-dodge":et.ColorDodge,darken:et.Darken,multiply:et.Multiply,"color-burn":et.ColorBurn,overlay:et.Overlay,"soft-light":et.SoftLight,"hard-light":et.HardLight,"vivid-light":et.VividLight,hue:et.Hue,saturation:et.Saturation,luminosity:et.Luminosity,color:et.Color,difference:et.Difference,exclusion:et.Exclusion,minus:et.Minus,invert:et.Invert,reflect:et.Reflect,"destination-over":et.DestinationOver,"destination-atop":et.DestinationAtop,"destination-in":et.DestinationIn,"destination-out":et.DestinationOut,"source-atop":et.SourceAtop,"source-in":et.SourceIn,"source-out":et.SourceOut,xor:et.Xor};function ojt(t){return t===et.DestinationOver||t===et.DestinationAtop||t===et.DestinationIn||t===et.DestinationOut||t===et.SourceAtop||t===et.SourceIn||t===et.SourceOut||t===et.Xor}function Zpe(t){t.code.add(T`
    float lineFactorAtPosition(float value) {
      float pos = value * ${T.float(257)};
      if(pos < 0.5 || pos > ${T.float(257-.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)}function ajt(t,e){const r=e.blendMode;r!==et.Normal&&(r===et.Reflect&&t.code.add(T`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`),r!==et.ColorDodge&&r!==et.VividLight||t.code.add(T`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`),r!==et.ColorBurn&&r!==et.VividLight||t.code.add(T`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`),r===et.Overlay&&t.code.add(T`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`),r===et.HardLight&&t.code.add(T`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`),r===et.SoftLight&&t.code.add(T`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`),r===et.VividLight&&t.code.add(T`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`),r!==et.Hue&&r!==et.Saturation&&r!==et.Color&&r!==et.Luminosity||(t.code.add(T`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),r!==et.Hue&&r!==et.Saturation||t.code.add(T`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`)),t.code.add(T`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${r===et.Multiply?T`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Average?T`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Lighten?T`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Darken?T`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Lighter?T`return vec4(cl * ol + cb * ob, ol + ob);`:r===et.Plus?T`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:r===et.Minus?T`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:r===et.Screen?T`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Difference?T`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Invert?T`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:r===et.DestinationOver?T`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:r===et.DestinationAtop?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:r===et.DestinationOut?T`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:r===et.SourceAtop?T`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:r===et.SourceOut?T`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:r===et.Xor?T`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:r===et.DestinationIn?T`return vec4(cb * ob * ol, ol * ob);`:r===et.SourceIn?T`return vec4(cl * ol * ob, ol * ob);`:r===et.Hue?T`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Saturation?T`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Color?T`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Luminosity?T`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Exclusion?T`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Reflect?T`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.ColorDodge?T`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.ColorBurn?T`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.Overlay?T`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.SoftLight?T`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.HardLight?T`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:r===et.VividLight?T`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:T``}
    }
  `))}var Do,jm,xm;(function(t){t[t.Composite=0]="Composite",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.GroupBackgroundComposite=3]="GroupBackgroundComposite",t[t.COUNT=4]="COUNT"})(Do||(Do={})),function(t){t[t.NotRequired=0]="NotRequired",t[t.Required=1]="Required",t[t.COUNT=2]="COUNT"}(jm||(jm={})),function(t){t[t.Off=0]="Off",t[t.On=1]="On",t[t.COUNT=2]="COUNT"}(xm||(xm={}));function nGe(t,e){const r=e.output===Do.GridComposite,i=e.output===Do.ColorComposite,n=e.output===Do.GroupBackgroundComposite,s=e.output===Do.Composite;r&&t.fragment.include(Zpe),i&&t.fragment.uniforms.add(new ar("backgroundColor",c=>c.backgroundColor));const o=e.baseOpacityMode===jm.Required;o&&t.fragment.uniforms.add(new Ye("baseOpacity",c=>c.baseOpacity)),s&&t.fragment.uniforms.add(new Mt("fboColor",c=>c.fboTexture));const a=e.blendMode!==et.Normal,l=e.premultipliedSource===xm.On;t.fragment.include(ajt,e),t.fragment.code.add(T`
    vec4 getBackground(vec2 uv) {
      return ${o?T`baseOpacity *`:""} ${n?T`vec4(0.0, 0.0, 0.0, 0.0)`:i?T`vec4(backgroundColor, 1.0)`:r?T`vec4(gridColor(uv), 1.0)`:T`texelFetch(fboColor, ivec2(gl_FragCoord.xy), 0)`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${a?T`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:T`
          float composeAlpha = colorLayer.a * opacity;
          return ${!l&&(s&&!o||n)?T`colorLayer * opacity;`:T`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)}let hq=class extends njt{constructor(e,r,i,n,s,o){super(e,n,s),this.colormap=r,this.symbolizer=i,this.u_colormap=o,this.backgroundColor=Sc,this.fboTexture=null,this.baseOpacity=1}},ljt=class extends hq{},cjt=class extends hq{};function ujt(t){const e=new jr;return e.include(iGe),e.include(sjt,t),e.include(rjt,t),e.include(nGe,t),e.fragment.code.add(T`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`),t.colorizerType===I2.Stretch?hjt(e,t):t.colorizerType===I2.Lut?djt(e):t.colorizerType===I2.Hillshade&&pjt(e,t),e}function djt(t){t.fragment.code.add(T`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
fragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`)}function hjt(t,e){t.fragment.uniforms.add(new UF("u_bandCount",i=>i.symbolizer.u_bandCount),new ru("u_minCutOff",i=>i.symbolizer.u_minCutOff,3),new ru("u_maxCutOff",i=>i.symbolizer.u_maxCutOff,3),new ru("u_factor",i=>i.symbolizer.u_factor,3),new Ye("u_minOutput",i=>i.symbolizer.u_minOutput),new Ye("u_maxOutput",i=>i.symbolizer.u_maxOutput),new Jy("u_useGamma",i=>i.symbolizer.u_useGamma),new ru("u_gamma",i=>i.symbolizer.u_gamma,3),new ru("u_gammaCorrection",i=>i.symbolizer.u_gammaCorrection,3),new Ye("u_opacity",i=>i.common.u_opacity)),t.fragment.code.add(T`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const r=e.applyColormap?T`fragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:T`fragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;t.fragment.code.add(T`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${e.stretchType===wE.Noop?T`
        fragColor = applyBackgroundBlend(currentPixel);`:T`
        if (currentPixel.a == 0.0) {
          fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${r}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          fragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function pjt(t,e){const r=t.fragment;r.uniforms.add(new Mt("u_image",n=>n.u_image),new UF("u_hillshadeType",n=>n.symbolizer.u_hillshadeType),new ru("u_sinZcosAs",n=>n.symbolizer.u_sinZcosAs,6),new ru("u_sinZsinAs",n=>n.symbolizer.u_sinZsinAs,6),new ru("u_cosZs",n=>n.symbolizer.u_cosZs,6),new ru("u_weights",n=>n.symbolizer.u_weights,6),new Yr("u_factor",n=>n.symbolizer.u_factor),new Ye("u_minValue",n=>n.symbolizer.u_minValue),new Ye("u_maxValue",n=>n.symbolizer.u_maxValue),new Yr("u_srcImageSize",n=>n.common.u_srcImageSize)),r.include(R0),r.code.add(T`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`),r.code.add(T`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);const i=e.applyColormap?T`fragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:T`hillshade *= alpha;
fragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;r.code.add(T`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        fragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture(u_image, pixelLocation);
      vec4 vf = texture(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${i}
    }
  `)}const fjt=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:cjt,ColorizerStretchUniforms:ljt,ColorizerUniforms:hq,build:ujt},Symbol.toStringTag,{value:"Module"}));function mjt(t,e,r="nearest",i=!1){var c;const n=!(i&&e.pixelType==="u8"),s=n?Fs.FLOAT:Fs.UNSIGNED_BYTE,o=e.pixels==null||e.pixels.length===0?null:n?e.getAsRGBAFloat():e.getAsRGBA(),a=(c=t.capabilities.textureFloat)==null?void 0:c.textureFloatLinear,l=new Vr;return l.width=e.width,l.height=e.height,l.internalFormat=t.type===Mr.WEBGL2&&n?Et.RGBA32F:Yt.RGBA,l.samplingMode=!a||r!=="bilinear"&&r!=="cubic"?Kt.NEAREST:Kt.LINEAR,l.dataType=s,l.wrapMode=ir.CLAMP_TO_EDGE,new Jt(t,l,o)}function gjt(t,e){const{spacing:r,offsets:i,coefficients:n,size:[s,o]}=e,a=r[0]>1,l=new Vr;l.width=a?4*s:s,l.height=o,l.internalFormat=t.type===Mr.WEBGL2?Et.RGBA32F:Yt.RGBA,l.dataType=Fs.FLOAT,l.samplingMode=Kt.NEAREST,l.wrapMode=ir.CLAMP_TO_EDGE;const c=new Float32Array(a?s*o*16:2*i.length);if(a&&n!=null)for(let u=0,h=0;u<n.length;u++)c[h++]=n[u],u%3==2&&(c[h++]=1);else for(let u=0;u<o;u++)for(let h=0;h<s;h++){const f=4*(u*s+h),m=2*(h*o+u);c[f]=i[m],c[f+1]=i[m+1],c[f+3]=i[m]===-1?0:1}return new Jt(t,l,c)}function o2e(t,e){const r=new Vr;return r.internalFormat=Yt.RGBA,r.width=e.length/4,r.height=1,r.samplingMode=Kt.NEAREST,r.wrapMode=ir.CLAMP_TO_EDGE,new Jt(t,r,e)}function yjt(t,e,r,i=1,n=!0){return{u_flipY:n,u_applyTransform:!!t,u_opacity:i,u_transformSpacing:t?t.spacing:cg,u_transformGridSize:t?t.size:cg,u_targetImageSize:e,u_srcImageSize:r}}function vjt(t,e){return{u_colormapOffset:e||0,u_colormapMaxIndex:t?t.length/4-1:0}}function _jt(t){return{u_bandCount:t.bandCount,u_minOutput:t.outMin,u_maxOutput:t.outMax,u_minCutOff:t.minCutOff,u_maxCutOff:t.maxCutOff,u_factor:t.factor,u_useGamma:t.useGamma,u_gamma:t.gamma,u_gammaCorrection:t.gammaCorrection}}function bjt(t){return{u_hillshadeType:t.hillshadeType,u_sinZcosAs:t.sinZcosAs,u_sinZsinAs:t.sinZsinAs,u_cosZs:t.cosZs,u_weights:t.weights,u_factor:t.factor,u_minValue:t.minValue,u_maxValue:t.maxValue}}const a2e={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};let wjt=class{constructor(e,r,i=null,n=null){this.type="raster-tile",this._memoryUsed=null,this._source=null,this._symbolizerParameters=null,this._bandIds=null,this._interpolation=null,this._dirty=!1,this._transformGrid=null,this.isRendereredSource=!1,this.symbolizerRenderer=null,this.rawPixelData=null,this.lij=null,this.opacity=1,this.lij=e,this.source=r,this.width=i||r.width,this.height=n||r.height}get source(){return this._source}set source(e){this._source=e,this._rasterTexture=pt(this._rasterTexture),this._memoryUsed=null}get symbolizerParameters(){return this.isRendereredSource?{...a2e,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||a2e}set symbolizerParameters(e){this._symbolizerParameters=e}get bandIds(){return this._bandIds}set bandIds(e){e!=null&&e.length>0?this._bandIds&&e.every((r,i)=>{var n;return!!((n=this._bandIds)!=null&&n[i])&&r===this._bandIds[i]})||(this._bandIds=e,this._dirty=!0):this._bandIds=null}get interpolation(){return this._interpolation||"nearest"}set interpolation(e){if(this._interpolation=e,this._rasterTexture!=null){const r=this._getRasterTextureInterpolation(e);this._rasterTexture.setSamplingMode(r==="bilinear"?Kt.LINEAR:Kt.NEAREST)}}get transformGrid(){return this._transformGrid}set transformGrid(e){this._transformGrid=e,this._transformGridTexture=pt(this._transformGridTexture),this._memoryUsed=null}bind(e){return!!(this.source&&this.source.pixels&&this.source.pixels.length>0)&&((this._rasterTexture==null||this._dirty)&&this._updateRasterTexture(e,this.bandIds),this._rasterTexture!=null&&(this._updateColormapTexture(e),this.transformGrid&&this._transformGridTexture==null&&(this._transformGridTexture=gjt(e,this.transformGrid))),!0)}getUniforms(){const{symbolizerParameters:e,transformGrid:r,width:i,height:n,opacity:s}=this,o=yjt(r,[i,n],[this.source.width,this.source.height],s),a=vjt(e.colormap,e.colormapOffset),l=this.symbolizerParameters.type==="stretch"?_jt(this.symbolizerParameters):null,c=this.symbolizerParameters.type==="hillshade"?bjt(this.symbolizerParameters):null;return new hq(o,a,l||c,this._rasterTexture,this._transformGridTexture,this._colormapTexture)}get isBilinearWithStretchColorRamp(){const{symbolizerParameters:e}=this;return this.interpolation==="bilinear"&&e.colormap!=null&&e.type==="stretch"}get memoryUsage(){if(this._memoryUsed==null){const e=[this._rasterTexture,this._transformGridTexture,this._colormapTexture];this._memoryUsed=e.map(r=>r!=null?r.descriptor.width*r.descriptor.height*4:0).reduce((r,i)=>r+i,0)}return this._memoryUsed}release(){return this._rasterTexture=pt(this._rasterTexture),this._transformGridTexture=pt(this._transformGridTexture),this._colormapTexture=pt(this._colormapTexture),this.source=null,this.transformGrid=null,this.rawPixelData=null,!0}_updateRasterTexture(e,r){const i=this.source?this.source.extractBands(r):null;if(!(i&&i.pixels&&i.pixels.length>0))return void(this._rasterTexture=pt(this._rasterTexture));const n=r==null&&this.bandIds==null||r!=null&&this.bandIds!=null&&r.join("")===this.bandIds.join("");if(this._rasterTexture!=null&&n)return;this._rasterTexture=pt(this._rasterTexture);const s=this._getRasterTextureInterpolation(this.interpolation);this._rasterTexture=mjt(e,i,s,this.isRendereredSource||this.hasStretchTypeNone())}hasStretchTypeNone(){return"stretchType"in this.symbolizerParameters&&this.symbolizerParameters.stretchType==="none"&&!this.symbolizerParameters.useGamma&&this.source.pixelType==="u8"}_getRasterTextureInterpolation(e){return this.symbolizerParameters.type==="lut"||e==="nearest"||e==="majority"||this.isBilinearWithStretchColorRamp?"nearest":"bilinear"}_updateColormapTexture(e){const r=this._colormap,i=this.symbolizerParameters.colormap;return i?r?i.length!==r.length||i.some((n,s)=>n!==r[s])?(this._colormapTexture=pt(this._colormapTexture),this._colormapTexture=o2e(e,i),void(this._colormap=i)):void 0:(this._colormapTexture=o2e(e,i),void(this._colormap=i)):(this._colormapTexture=pt(this._colormapTexture),void(this._colormap=null))}},jz=class{constructor(){this.waitingAgents=new dr,this._upsampleInfo=null,this.loadingAgent=null,this.requestPromise=null,this.requestAbort=null,this.pendingUpdates=0}static acquire(e){const r=kZ.acquire();return r._init(e),r}release(){this.dispose(),Gz.delete(this),kZ.release(this)}dispose(){this.loadingAgent=pt(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=FA(this._data)}static prune(){kZ.prune(0)}_init(e){this.waitingAgents.clear(),this._data=FA(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=xc(this.requestAbort),this.requestPromise=null}get upsampleInfo(){return this._upsampleInfo}_unsetUpsampleInfo(){this._upsampleInfo!=null&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)}setUpsampleInfo(e,r){if(e!==r&&r!=null){if(this._upsampleInfo==null)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===r)return;this._upsampleInfo.tile.unrefMapData()}r.refMapData(),QBt(e,r,this._upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){FA(this._data),this._data=e}};const kZ=new il(jz,null,()=>{}),Gz=new Map;function xjt(){Gz.size>0&&(console.log(`${Gz.size} live TilePerLayerInfo allocations:`),Gz.forEach(t=>console.log(t,`
`)))}let QR=class{constructor(e){this._texture=e,this.type="tile-texture",this._refCount=1}retain(){++this._refCount}release(){--this._refCount,this._refCount===0&&this._texture.dispose()}get texture(){return this._texture}generateMipmap(){this._texture.generateMipmap()}get descriptor(){return this._texture.descriptor}get gpuMemoryUsage(){return this._texture.gpuMemoryUsage}};var qt;(function(t){t[t.NONE=0]="NONE",t[t.SPLIT=1]="SPLIT",t[t.ELEVATION=2]="ELEVATION",t[t.MERGE=4]="MERGE",t[t.RENDERDATA=8]="RENDERDATA",t[t.GEOMETRY=16]="GEOMETRY",t[t.TEXTURE_NOFADING=32]="TEXTURE_NOFADING",t[t.TEXTURE_FADING=64]="TEXTURE_FADING"})(qt||(qt={}));const Sjt=.1;let Jpe=class{constructor(){this.lij=[0,0,0],this._children=[null,null,null,null],this._pendingUpdates=0,this.renderData=null,this._dirty=!0,this._previouslyRendered=!1,this.extent=lr(),this._elevationBounds=Qe(),this.layerInfo=[[],[]],this.extentInRadians=lr(),this.centerAtSeaLevel=A(),this._center=[A(),us(),A()],this.up=Lce(),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._maxTesselation=0,this._usedMemory=null,this._mapTileMemoryInternal=0,this._mapDataRefCount=0,this.screenDepth=0,this.renderOrder=0,this._edgeLen=0,this._edgeLen2=0,this._curvatureHeight=0,this.extentMidX=0,this.extentMidY=0,this.distanceToPOI=-1,this._lastPOI=A()}static prune(){Kpe.prune(0),Qpe.prune(0),jz.prune()}get _isCached(){return!this.shouldLoad&&this._mapDataRefCount<=0}get maxTesselation(){return this._maxTesselation}get isWithinClippingArea(){return this._isWithinClippingArea}get intersectsClippingArea(){return this._intersectsClippingArea}get clippingArea(){return this._clippingArea}get parent(){return this._parent}get children(){return this._children}get surface(){return this._surface}get elevationBounds(){return this._elevationBounds}get level(){return this.lij[0]}get key(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}get edgeLen(){return this._edgeLen}get radius(){return this._center[Is.MIDDLE][3]}get visible(){return this._dirty&&this.computeVisibility(),this._visible}get frustumVisibility(){return this._dirty&&this.computeVisibility(),this._frustumVisibility}computeVisibility(){this._dirty=!1;const e=this.parent,r=(e==null?void 0:e.frustumVisibility)??Cl.INTERSECTS;this._frustumVisibility=r===Cl.INSIDE?Cl.INSIDE:r===Cl.OUTSIDE?Cl.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);const i=this._frustumVisibility!==Cl.OUTSIDE&&this._intersectsClippingArea;i!==this._visible&&(this._visible=i,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())}get loadable(){return this.visible||this._surface.view.state.fixedContentCamera}get rendered(){const e=!!this.renderData;return e!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=e,this._surface.renderer.setDirty()),e}get shouldLoad(){return this.isLeaf}init(e,r,i){this.lij[0]=e[0],this.lij[1]=e[1],this.lij[2]=e[2],this.ellipsoid=Xr(i.tilingScheme.spatialReference),i.tilingScheme.getExtent(e[0],e[1],e[2],this.extent),i.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians),this.extentMidX=.5*(this.extent[0]+this.extent[2]),this.extentMidY=.5*(this.extent[1]+this.extent[3]),this._isWithinClippingArea=!0,this._intersectsClippingArea=!0,this._clippingArea=null,this._mapDataRefCount=0,i.upsampleMapCache.pop(this.key),this._edgeLen=0,this._edgeLen2=0,this._center[Is.MIDDLE][3]=0,this.elevationLevel=e?e[0]:0,r&&r.elevationBounds?Eo(this._elevationBounds,r.elevationBounds):Or(this._elevationBounds,0,0),this._pendingUpdates=0,this.renderData=null,this.screenDepth=0,this._visible=!1,this._previouslyRendered=!1,this._parent=r,this.unsetChildren(),this._surface=i,this.updateVisibility();for(const n of lT){const s=i.numLayers(n),o=this.layerInfo[n];for(const a of o)a.release();o.length=s;for(let a=0;a<s;a++)o[a]=jz.acquire(this._surface.upsampleInfoPool),n===Er.ELEVATION&&this.findElevationBoundsForLayer(a,-1)}this.computeElevationBounds(),this._maxTesselation=Math.min(i.tilingScheme.pixelSize,DI)}release(){xy(!this.renderData,"tile.renderData was not unloaded"),this._surface.upsampleMapCache.pop(this.key);for(const e of lT){for(const r of this.layerInfo[e])r.release();this.layerInfo[e].length=0}this._parent=null;for(let e=0;e<4;++e)this._children[e]=null;this._surface=null,this.setMemoryDirty()}refMapData(){++this._mapDataRefCount,this._isCached||this._surface.upsampleMapCache.pop(this.key)}unrefMapData(){if(--this._mapDataRefCount,this._isCached){this.setMemoryDirty();const e=this._cachedMemory;e>0&&this._surface.upsampleMapCache.put(this.key,this,e)}}setMemoryDirty(){this._usedMemory=null}get usedMemory(){return this._ensureUsedMemory()+(this._isCached?0:this._mapTileMemoryInternal)}get _cachedMemory(){return this._isCached?this._mapTileMemory:0}get _mapTileMemory(){return this._ensureUsedMemory(),this.layerInfo[Er.MAP].reduce((e,r)=>e+(r instanceof FZ?r.memoryUsed/r.referenced:0),this._mapTileMemoryInternal)}get _cpuImageMemorySize(){const r=this._surface.tilingScheme.pixelSize;return r*r*4}_ensureUsedMemory(){var i;if(this._usedMemory!=null)return this._usedMemory;this._usedMemory=0,this._mapTileMemoryInternal=0;let e=0;for(const{data:n}of this.layerInfo[Er.MAP])n instanceof FZ?e+=this._getTerrainDataMemory(n):this._mapTileMemoryInternal+=this._getTerrainDataMemory(n);const r=this._cpuImageMemorySize;for(const n of this.layerInfo[Er.ELEVATION])this._usedMemory+=n.data?r:0;return this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=((i=this.renderData.texture)==null?void 0:i.gpuMemoryUsage)??0),this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+e),this._usedMemory}getUsedMemoryForLayer(e,r){const i=this.layerInfo[e][r];return i!=null&&i.data?e===Er.MAP?this._isCached?0:this._getTerrainDataMemory(i.data):e===Er.ELEVATION?this._cpuImageMemorySize:0:0}_getTerrainDataMemory(e){return e instanceof QR?e.texture.gpuMemoryUsage:e instanceof HTMLImageElement||e instanceof lq?this._cpuImageMemorySize:e instanceof wjt?e.memoryUsage:e instanceof FZ?e.memoryUsed/e.referenced:0}updateScreenDepth(e){const r=this._center[Is.MIDDLE],i=e,n=r[0],s=r[1],o=r[2],a=i[2]*n+i[6]*s+i[10]*o+i[14];this.screenDepth=a<0?0:a/(i[3]*n+i[7]*s+i[11]*o+i[15])}shouldSplit(e,r,i){if(!this.visible||e.frustum!=null&&(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(e.frustum)===Cl.OUTSIDE))return qt.NONE;const n=this.level;ve(eU,this._center[Is.MIDDLE],r);let s=Al(eU),o=eU,a=Is.MIDDLE;ve(UZ,this._center[Is.TOP],r);const l=Al(UZ);l<s&&(s=l,o=UZ,a=Is.TOP),ve(zZ,this._center[Is.BOTTOM],r);const c=Al(zZ);if(c<s&&(s=c,o=zZ,a=Is.BOTTOM),this._edgeLen2>s&&n<e.maxLod)return qt.SPLIT;const u=i!=null?i-n:1/0,h=Math.sqrt(s),f=e.fovX*h*2,m=this._edgeLen/f,g=()=>{if(n<e.maxLod)return this.elevationLevel=n,qt.NONE;const R=n+Math.ceil(-Math.log2(e.relativeWidthLimit/m));return R!==this.elevationLevel?(this.elevationLevel=R,qt.ELEVATION):qt.NONE};if(u<=.5)return g();const y=ye(this.up,eU),_=this._elevationBounds[1]-this._elevationBounds[0],b=_/this.edgeLen;if(e.aboveGround&&y>0&&b<.001&&y/h-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-b>0)return qt.NONE;const w=i!=null?3-Math.min(u,2):1;if(m*w<e.relativeWidthLimit||n>=e.maxLod)return g();if(n<7)return qt.SPLIT;ce(ga,this.up,y),ve(ga,ga,o);const x=Al(ga);if(x<=this.radius*this.radius)return qt.SPLIT;ce(ga,ga,this.radius/Math.sqrt(x)),ge(ga,ga,this._center[a]),ve(ga,r,ga);const S=Math.min(1,(Math.abs(ye(ga,this.up))+.5*_+this._curvatureHeight)/We(ga)),C=Sjt/e.angledSplitBias,E=e.fovY*h*2;return S*(this._edgeLen/E*w)<C*e.relativeHeightLimit?qt.NONE:qt.SPLIT}setChildren(e,r,i,n){xy(!!(e&&r&&i&&n),"Null child passed"),this._children[0]=e,this._children[1]=r,this._children[2]=i,this._children[3]=n}unsetChildren(){this._children[0]=null,this._children[1]=null,this._children[2]=null,this._children[3]=null}get isLoaded(){var e;return((e=this.renderData)==null?void 0:e.hasGeometry)??!1}load(){this.refMapData();for(const e of lT)this._createOrUpdateAgents(0,e);this.surface.renderer.loadTile(this)}unload(e){e.unloadTile(this);for(const r of lT){const i=this.layerInfo[r];for(const n of i)n.loadingAgent&&n.loadingAgent!==Cu&&(Q6(n.loadingAgent),n.loadingAgent=null),n.pendingUpdates=0}this.resetPendingUpdate(qt.GEOMETRY),this.resetPendingUpdate(qt.TEXTURE_NOFADING),this.resetPendingUpdate(qt.TEXTURE_FADING),this.unrefMapData()}unloadMapData(){const e=this.layerInfo[Er.MAP];for(const r of e)r.loadingAgent&&r.loadingAgent!==Cu&&(Q6(r.loadingAgent),r.loadingAgent=null),r.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture(),this.setMemoryDirty()}updateClippingStatus(e){if(v2(e,this._clippingArea))return!1;const r=this._intersectsClippingArea,i=this._isWithinClippingArea;e!=null?(this._intersectsClippingArea=this.intersectsExtent(e),this._isWithinClippingArea=this._isWithinExtent(e)):(this._intersectsClippingArea=!0,this._isWithinClippingArea=!0),this._clippingArea=e,this.updateVisibility();const n=i&&this._isWithinClippingArea,s=!(i||r||this._isWithinClippingArea||this._intersectsClippingArea);return!this.renderData||n||s||this.setPendingUpdate(qt.GEOMETRY),!0}updateVisibility(){this._dirty=!0,this._surface.setTileTreeDirty()}getLayerInfo(e,r){return this.layerInfo[r][e]}hasLayerData(e,r){const i=this.layerInfo[r][e];return!(!i||!i.data||i.dataInvalidated)}get updating(){if(this.hasPendingUpdates)return!0;for(const e of lT){const r=this.layerInfo[e];for(const i of r)if(i.loadingAgent&&i.loadingAgent!==Cu&&i.loadingAgent.updating)return!0}return!1}_isSuspended(e){return!!this.hasPendingUpdate(qt.SPLIT)||e!==Er.ELEVATION&&!this.loadable}get hasPendingUpdates(){return this._pendingUpdates!==0}hasPendingUpdate(e){return(this._pendingUpdates&e)===e}setPendingUpdate(e){this._pendingUpdates|=e,e===qt.SPLIT||e===qt.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()}resetPendingUpdate(e){return!!this.hasPendingUpdate(e)&&(this._pendingUpdates&=~e,!0)}requestLayerData(e,r,i){const n=this.layerInfo[r][e];if(n.waitingAgents.has(i))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e),!0;if(n.waitingAgents.push(i),n.data&&!n.dataInvalidated){console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),i.tile.lij.toString(),r,e);const a=n.data&&"type"in n.data&&n.data.type==="vector-tile";return i.dataArrived(this,a),!0}if(n.requestPromise)return!0;xc(n.requestAbort),n.requestAbort=new AbortController;const s=this._surface.requestTileData(this,e,r,n.requestAbort);if(!s)return n.requestAbort=null,!1;const o=()=>{n.requestPromise===s&&(n.requestPromise=null,n.requestAbort=null)};return n.requestPromise=s,s.then(o,o),!0}get isLeaf(){return this._children[0]==null}hasLij(e){return this.lij[0]===e[0]&&this.lij[1]===e[1]&&this.lij[2]===e[2]}findByLij(e){if(this.hasLij(e))return this;const r=this._children;return r[0]?r[0].findByLij(e)||r[1].findByLij(e)||r[2].findByLij(e)||r[3].findByLij(e):null}distanceToSquared(e){return Al(ve(ga,this._center[Is.MIDDLE],e))}containsPoint(e){const r=this.extent;return e[0]>=r[0]&&e[1]>=r[1]&&e[0]<=r[2]&&e[1]<=r[3]}containsPointXY(e,r){const i=this.extent;return e>=i[0]&&r>=i[1]&&e<=i[2]&&r<=i[3]}unrequestLayerData(e,r,i){const n=this.layerInfo[r][e],s=n.waitingAgents,o=s.removeUnordered(i)!=null;xy(o,"agent has not requested this piece of map data"),s.length<1&&(n.abortRequest(),this.setMemoryDirty())}dataArrived(e,r,i){const n=i!=null&&"type"in i&&i.type==="vector-tile",s=this.layerInfo[r][e];s.data=i,s.dataInvalidated=!1,s.waitingAgents.forAll(o=>o.dataArrived(this,n)),s.waitingAgents.clear(),this.setMemoryDirty()}dataMissing(e,r,i){i.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${r}/${e} error ${i}`);const n=this.layerInfo[r][e];n.dataMissing=!0,n.waitingAgents.forAll(s=>s.dataMissing()),n.waitingAgents.clear(),this.setMemoryDirty()}updateRenderData(e,r,i){switch(i&&this.forEachLoadedNeighbor(n=>n.updateRenderData(e,r)),e){case Er.MAP:return this._updateTexture(r);case Er.ELEVATION:return this._updateGeometry()}}_updateTexture(e){this.renderData&&(this.resetPendingUpdate(e===mo.FADING?qt.TEXTURE_NOFADING:qt.TEXTURE_FADING),this.setPendingUpdate(e===mo.FADING?qt.TEXTURE_FADING:qt.TEXTURE_NOFADING))}_updateGeometry(){this.setPendingUpdate(qt.GEOMETRY);for(const e of this.layerInfo[Er.ELEVATION])e.pendingUpdates|=qt.GEOMETRY}invalidateLayerData(e,r){this.layerInfo[r][e].invalidateSourceData(),this.restartAgents(r)}computeElevationBounds(){const e=this._elevationBounds,r=e[0],i=e[1];Or(e,1/0,-1/0);const n=this.layerInfo[Er.ELEVATION];let s=!0;for(const o of n)o.elevationBounds!=null&&(e[0]=Math.min(e[0],o.elevationBounds.min),e[1]=Math.max(e[1],o.elevationBounds.max),o.elevationBounds.hasNoDataValues||(s=!1));s&&(e[0]=Math.min(e[0],0),e[1]=Math.max(e[1],0)),r===e[0]&&i===e[1]||(this.updateRadiusAndCenter(),this._surface.setTileTreeDirty())}_updateCenter(){const e=this._elevationBounds,r=.5*(e[0]+e[1]),i=this._center;ce(ga,this.up,r),ge(i[Is.MIDDLE],this.centerAtSeaLevel,ga),ce(ga,this.up,e[0]),ge(i[Is.TOP],this.centerAtSeaLevel,ga),ce(ga,this.up,e[1]),ge(i[Is.BOTTOM],this.centerAtSeaLevel,ga)}findElevationBoundsForLayer(e,r){const i=this.layerInfo[Er.ELEVATION][e],n=Sre(this.level),s=Math.max(this.elevationLevel-n,0),o=i.elevationBounds;if(o!=null&&o.level>=r&&o.level<=s)return;const a=this._surface.layerViewByIndex(e,Er.ELEVATION),l=Pne(a);if(!FD(this,l,!1))return;const c=Ejt;let u=!1;const h=i.data;if(h&&h.level<=s){const f=i.data;c.min=f.samplerData.data.minValue,c.max=f.samplerData.data.maxValue,c.hasNoDataValues=f.samplerData.data.hasNoDataValues,c.level=this.level,u=!0}else{let f,m,g=0;for(let y=this._parent;y&&(!m||g<n)&&(g=this.elevationLevel-y.level,f=m||f,m=y.layerInfo[Er.ELEVATION][e].data,!(!m&&f&&y.level<=s));y=y.parent);m=m||f,m&&(m.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],c),c.min!==1/0&&(c.level=m.level,u=!0))}u&&(i.elevationBounds==null&&(i.elevationBounds=new sA),i.elevationBounds.copyFrom(c))}modifyLayers(e,r,i){const n=this.layerInfo[i];for(const a of n)a.loadingAgent&&a.loadingAgent!==Cu&&(Q6(a.loadingAgent),a.loadingAgent=null),a.waitingAgents.clear();for(let a=0;a<n.length;++a)e[a]===void 0&&n[a].release();const s=new Array(...n),o=r.length;n.length=o;for(let a=0;a<o;a++){const l=r[a];n[a]=l>-1?s[l]:jz.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()}restartAgents(e){this.renderData&&(this._createOrUpdateAgents(0,e),this.updateRenderData(e,mo.FADING))}updateAgents(e){if(this.renderData){const r=this.layerInfo[e];for(const i of r)i.loadingAgent===Cu&&(i.loadingAgent=null);this._createOrUpdateAgents(0,e)}}updateAgentSuspension(){for(const e of lT){const r=this._isSuspended(e);for(const i of this.layerInfo[e])i.loadingAgent&&i.loadingAgent!==Cu&&(i.loadingAgent.setSuspension(r),i.loadingAgent===Cu&&this.updateRenderData(e,mo.FADING))}}removeLayerAgent(e,r){const i=this.layerInfo[r][e];i.loadingAgent&&i.loadingAgent!==Cu&&i.loadingAgent.dispose(),i.loadingAgent=null}agentDone(e,r){const i=this.layerInfo[r][e];i.loadingAgent=Cu,i.data||i.upsampleInfo!=null||this._createOrUpdateAgents(e+1,r)}_hasBlendableAncestor(e){return e.blendMode!=="normal"||mP(e.parent)&&this._hasBlendableAncestor(e.parent)}_hasBlendModes(e,r,i){var n,s,o;for(let a=e;a<r;++a){const l=this._surface.layerViewByIndex(a,i);if(mj(l)&&((n=l==null?void 0:l.layer)==null?void 0:n.blendMode)!=="normal"||mP((s=l==null?void 0:l.layer)==null?void 0:s.parent)&&this._hasBlendableAncestor((o=l==null?void 0:l.layer)==null?void 0:o.parent))return!0}return!1}_createOrUpdateAgents(e,r){const i=this.layerInfo[r];if(i.length===0)return;const n=this._isSuspended(r);for(let s=e;s<i.length;++s){const o=i[s];let a=!1;const l=this._surface.layerViewByIndex(s,r),c=Pne(l);if(o.loadingAgent?FD(this,c,!1)?(o.loadingAgent!==Cu&&o.loadingAgent.setSuspension(n),o.loadingAgent!==Cu&&(a=o.loadingAgent.update())):o.dispose():FD(this,c,!1)&&(o.loadingAgent=Tjt(this,s,r,n),a=o.loadingAgent.startLoading(),a?o.loadingAgent===Cu&&this.setPendingUpdate(qt.GEOMETRY):(Q6(o.loadingAgent),o.loadingAgent=Cu)),o.loadingAgent===Cu&&this.updateRenderData(r,mo.FADING),!this._hasBlendModes(e,i.length,r)&&a&&l.isOpaque)return}}_isWithinExtent(e){const r=this.extent;return r[0]>=e[0]&&e[2]>=r[2]&&r[1]>=e[1]&&e[3]>=r[3]}intersectsExtent(e){const r=this.extent;return r[2]>=e[0]&&e[2]>=r[0]&&r[3]>=e[1]&&e[3]>=r[1]}getElevationVerticesPerSide(e){const r=this.elevationLevel-this.level,i=Math.max(this.level-e,Sre(this.level)-r),n=Te(1+(this.maxTesselation>>i),2,this.maxTesselation+1),s=this.getDefaultVerticesPerSide();return Math.max(n,s)}get test(){return{cachedMemory:this._cachedMemory}}_findLIJ(e,r){if(!e)return null;const i=this.surface.rootTiles;if(i!=null){for(const n of i)if(Cjt(n,e)){let s=n,o=e[0]-s.level-1;for(;o>=0&&!s.isLeaf&&!r(s);){const a=e[1]>>o&1,l=e[2]>>o&1;s=s.children[2*a+l],o--}return r(s)?s:null}}return null}findNeighborTile(e,r){const i=this.lij,n=this.getNeighborLIJ(i,e);return n?Rjt(i,n)?r(this)?this:null:this._findLIJ(n,r):null}findCorner(e,r){const i=e===Ft.NORTH_EAST?1:e===Ft.NORTH_WEST?0:e===Ft.SOUTH_WEST?2:3;let n=this;for(;n.children[0]&&(!r||!r(n));)n=n.children[i];return n}findNeighborCornerTileExact(e,r){var i;return((i=this.findNeighborTile(e,n=>r(n)||n.level===this.level))==null?void 0:i.findCorner(gj(e),r))||null}forAllSubtreeOnSide(e,r){const i=e===Ft.NORTH?[0,1]:e===Ft.NORTH_EAST?[1]:e===Ft.EAST?[1,3]:e===Ft.SOUTH_EAST?[3]:e===Ft.SOUTH?[2,3]:e===Ft.SOUTH_WEST?[2]:e===Ft.WEST?[0,2]:[0],n=s=>{const o=s.children;!r(s)&&o[0]&&i.forEach(a=>n(o[a]))};n(this)}forallNeighbors(e){a4.forEach(r=>this.findNeighborCornerTileExact(r,e)),Fy.forEach(r=>{var i;return(i=this.findNeighborTile(r,n=>n.level===this.level||e(n)))==null?void 0:i.forAllSubtreeOnSide(yj(r),e)})}getNeighborEdgeStartVertexIndex(e,r){if(!r)return 0;const i=this.level-r.level;if(Ne(!_o||i>=0),i===0)return 0;const n=2**i,s=(1&e)==1,o=s?0:1,a=r.lij[o+1]*n,l=this.lij[o+1],c=l-a,u=s?n-1-c:c;return _o&&(Ne(a<=l&&l<a+n),Ne(0<=u&&u<n)),u}forEachLoadedNeighbor(e){const r=this.level,i=n=>n.level===r||n.isLoaded;Fy.forEach(n=>{const s=this.findNeighborTile(n,i);s!=null&&s!==this&&s.forAllSubtreeOnSide(yj(n),o=>!!o.isLoaded&&(e(o,n),!0))}),a4.forEach(n=>{var o;const s=(o=this.findNeighborTile(n,i))==null?void 0:o.findCorner(gj(n),a=>a.isLoaded);Ne(!s||kne(this,s,n)),s!=null&&s.isLoaded&&e(s,n)})}getNeighborLIJ(e,r){const i=YTe(r)?-1:XTe(r)?1:0,n=qTe(r)?-1:WTe(r)?1:0,s=[e[0],e[1]+i,e[2]+n];return s[1]<0?null:this.surface.isGlobal?this.wrapLIJ(s):s[2]<0?null:s}wrapLIJ(e){return!e||e[1]<0||e[1]>=2**e[0]?null:this.surface.wrapEastWest(e)}get westNeighborWestExtent(){return this.extent[0]*(this.isWestEnd?-1:1)}get eastNeighborEastExtent(){return this.extent[2]*(this.isEastEnd?-1:1)}get isEastEnd(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}get isWestEnd(){return this.lij[2]===0}get isNorthEnd(){return this.lij[1]===0}get isSouthEnd(){const e=this.surface.extent,r=(e==null?void 0:e[1])??null;return r!=null&&this.extent[1]+Bl()>=r}checkGeometryWaterproofness(){var e;pj&&(Ne(this.isLoaded),(e=this.renderData)==null||e.checkGeometryWaterproofness())}shouldHaveNeighbor(e){const r=this.extent,i=this.surface.rootTilesExtent,n=.25*(r[2]-r[0]);if(YTe(e)&&r[3]+n>=i[3]||XTe(e)&&r[1]-n<=i[1])return!1;const s=this.surface.isGlobal;return!(!s&&qTe(e)&&r[0]-n<=i[0])&&!(!s&&WTe(e)&&r[2]+n>=i[2])}updateDistanceToPOI(e){const r=this._lastPOI;if(this.distanceToPOI>=0&&r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2])return;oe(this._lastPOI,e);const i=this._center[Is.MIDDLE],n=e[0]-i[0],s=e[1]-i[1],o=e[2]-i[2];this.distanceToPOI=n*n+s*s+o*o}};function Tjt(t,e,r,i){const n=r===Er.ELEVATION?Qpe.acquire():Kpe.acquire();return n.init(t,e,r,i),n}function Q6(t){t.dispose(),t instanceof eGe?Qpe.release(t):t instanceof tGe&&Kpe.release(t)}const Kpe=new il(tGe),Qpe=new il(eGe),Ejt=new sA;var Is;function Cjt(t,e){const r=t.level,i=e[0];if(r>i)return!1;const n=i-r,s=Math.floor(e[1]/2**n),o=Math.floor(e[2]/2**n);return s===t.lij[1]&&o===t.lij[2]}function Rjt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Ojt(t,e,r){if(t==null||e==null)return!1;if(t.level===0&&e.level===0&&(t.isEastEnd&&e.isWestEnd&&r===Ft.EAST||t.isWestEnd&&e.isEastEnd&&r===Ft.WEST))return!0;const i=Math.max(1e-6*(t.extent[2]-t.extent[0]),1);switch(r){case Ft.NORTH:return $p(t.extent[3],e.extent[1],i);case Ft.SOUTH:return $p(t.extent[1],e.extent[3],i);case Ft.EAST:return $p(t.extent[2],e.extent[0],i)||$p(t.extent[2],-e.extent[0],i);case Ft.WEST:return $p(t.extent[0],e.extent[2],i)||$p(t.extent[0],-e.extent[2],i)}}function kne(t,e,r){return t!=null&&e!=null&&e!==t&&(t.level>=e.level?l2e(t,e,r):l2e(e,t,gj(r)))}function l2e(t,e,r){Ne(t.level>=e.level);const i=jVt(r),n=GVt(r),s=t.extent,o=e.extent,a=[i?s[0]:s[2],n?s[3]:s[1]],l=[i?o[2]:o[0],n?o[1]:o[3]],c=1e-5*(s[2]-s[0]),u=$p(a[0],l[0],c)||t.surface.isGlobal&&$p(a[0],-l[0],c),h=$p(a[1],l[1],c);if(u&&h)return!0;if(t.level===e.level||!u&&!h)return Ne(!1),!1;const f=u?c2e(o[1],o[3],s[1],s[3],c):c2e(o[0],o[2],s[0],s[2],c);return Ne(f),f}function c2e(t,e,r,i,n){return t-n<=r&&r<=i&&i<=e+n}(function(t){t[t.TOP=0]="TOP",t[t.MIDDLE=1]="MIDDLE",t[t.BOTTOM=2]="BOTTOM"})(Is||(Is={}));const eU=A(),UZ=A(),zZ=A(),ga=A();let Ajt=class{constructor(){this._scales=nr(-1,-1,-1,-1),this._offsets=nr(-1,-1,-1,-1)}clear(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1,this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1}setScale(e,r,i){this._scales[2*e]=r,this._scales[2*e+1]=i}setOffset(e,r,i){this._offsets[2*e]=r,this._offsets[2*e+1]=i}get scales(){return this._scales}get offsets(){return this._offsets}};function Pjt(t,e){t.varyings.add("tbnTangent","vec3"),t.varyings.add("tbnBiTangent","vec3"),e.spherical?t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):t.vertex.code.add(T`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`),t.fragment.code.add(T`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)}let efe=class extends oVe{constructor(){super(...arguments),this.slicePlaneLocalOrigin=A(),this.origin=this.slicePlaneLocalOrigin,this.modelTransformation=null}};var ed;(function(t){t[t.Material=0]="Material",t[t.ShadowMap=1]="ShadowMap",t[t.Highlight=2]="Highlight"})(ed||(ed={}));let Mjt=class extends efe{constructor(){super(...arguments),this.identifier=ed.Material,this.output=q.Color,this.transparent=!1,this.integratedMesh=!1}},$jt=class extends efe{constructor(){super(...arguments),this.identifier=ed.ShadowMap}},Ijt=class extends efe{constructor(){super(...arguments),this.identifier=ed.Highlight}},vj=class extends Zn{constructor(e,r){super(e,"vec4",Ci.Draw,(i,n,s)=>i.setUniform4fv(e,r(n,s)))}};var h_;function Ljt(t,e){const{vertex:r,fragment:i}=t;r.uniforms.add(new vj("overlayTexOffset",(n,s)=>Djt(n,s)),new vj("overlayTexScale",(n,s)=>Njt(n,s))),i.constants.add("overlayOpacity","float",1),i.uniforms.add(new Mt("ovColorTex",(n,s)=>Une(n,s))),sGe(t,e)}function sGe(t,e){e.pbrMode!==Nt.Water&&e.pbrMode!==Nt.WaterOnIntegratedMesh&&e.pbrMode!==Nt.TerrainWithWater||t.include(cVe,e);const{vertex:r,fragment:i}=t;t.varyings.add("vtcOverlay","vec4"),r.code.add(T`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`),i.code.add(T`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),i.code.add(T`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`),i.code.add(T`vec4 getOverlayColorTexel(vec4 texCoords) {
vec2 texDim =  vec2(textureSize(ovColorTex, 0));
vec4 color0 = texelFetch(ovColorTex, ivec2(vec2(texCoords.x * 0.5, texCoords.y)*texDim), 0);
vec4 color1 = texelFetch(ovColorTex, ivec2(vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim), 0);
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`),e.pbrMode!==Nt.Water&&e.pbrMode!==Nt.WaterOnIntegratedMesh&&e.pbrMode!==Nt.TerrainWithWater||(J_(i),C0(i),i.code.add(T`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`))}function Une(t,e){return e.overlays.length===0?null:t.identifier===ed.Material&&t.output===q.Color?e.overlays[mn.INNER].getColorTextureNoRasterImage():t.identifier===ed.Material&&t.output===q.ObjectAndLayerIdColor?e.overlays[mn.INNER].getColorTexture(pc.ObjectAndLayerIdColor):t.identifier===ed.Highlight?e.overlays[mn.INNER].getValidTexture(Hn.Highlight):null}function Djt(t,e){for(const r of e.overlays){const{index:i,extent:n}=r;ALe(n)>0&&(kA[2*i]=t.toMapSpace[0]/lh(n)-n[0]/lh(n),kA[2*i+1]=t.toMapSpace[1]/og(n)-n[1]/og(n))}return kA}function Njt(t,e){for(const r of e.overlays){const{index:i,extent:n}=r;ALe(n)>0&&(kA[2*i]=t.toMapSpace[2]/lh(n),kA[2*i+1]=t.toMapSpace[3]/og(n))}return kA}(function(t){t[t.Disabled=0]="Disabled",t[t.Enabled=1]="Enabled",t[t.EnabledWithWater=2]="EnabledWithWater",t[t.COUNT=3]="COUNT"})(h_||(h_={}));const kA=wr();var ky;(function(t){t[t.LayerOnly=0]="LayerOnly",t[t.ColorComposite=1]="ColorComposite",t[t.GridComposite=2]="GridComposite",t[t.COUNT=3]="COUNT"})(ky||(ky={}));let Fjt=class extends ppe{constructor(){super(...arguments),this.overlayOpacity=1,this.overlaySource=pc.None}};function w$(t,e){t.vertex.uniforms.add(new _j("overlayTexOffset"),new _j("overlayTexScale")),t.fragment.uniforms.add(new Ye("overlayOpacity",r=>r.overlayOpacity),new Mt("ovColorTex",(r,i)=>i.overlays.length===0?null:i.overlays[mn.INNER].getColorTexture(r.overlaySource))),sGe(t,e)}function kjt(t,e){const{vertex:r,fragment:i,varyings:n}=t;n.add("vtc","vec2"),r.uniforms.add(new _j("texOffsetAndScale")),i.uniforms.add(new u2e("tex")),i.uniforms.add(new VZ("textureOpacities"));const s=e.textureFadingEnabled&&!e.renderOccluded;s&&(r.uniforms.add(new _j("nextTexOffsetAndScale")),n.add("nvtc","vec2"),i.uniforms.add(new u2e("texNext")),i.uniforms.add(new VZ("nextTexOpacities")),i.uniforms.add(new Ujt("fadeFactor")));const o=e.tileBlendInput===ky.ColorComposite,a=e.tileBlendInput===ky.GridComposite;a&&i.include(Zpe),o&&i.uniforms.add(new VZ("backgroundColor")),r.code.add(T`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${s?T`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:T``}
  }`),i.code.add(T`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${a||o?T`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${o?T`backgroundColor`:T`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:T`return color;`}
    }`),s?i.code.add(T`vec4 getTileColor() {
vec4 color = getColor(texture(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):i.code.add(T`vec4 getTileColor() {
return getColor(texture(tex, vtc), vtc, textureOpacities);
}`)}let Ujt=class extends Zn{constructor(e){super(e,"float")}},VZ=class extends Zn{constructor(e){super(e,"vec3")}},_j=class extends Zn{constructor(e){super(e,"vec4")}},u2e=class extends Zn{constructor(e){super(e,"sampler2D")}},oGe=class extends Fjt{};function zjt(t){const e=new jr,{vertex:r,fragment:i,varyings:n}=e;e.include(xF),e.include(kF,t),e.include(Zy,t);const s=()=>{e.include(t4,t),r.code.add(T`vec3 getNormal() {
float z = 1.0 - abs(normalCompressed.x) - abs(normalCompressed.y);
vec3 n = vec3(normalCompressed + vec2(normalCompressed.x >= 0.0 ? 1.0 : -1.0,
normalCompressed.y >= 0.0 ? 1.0 : -1.0) * min(z, 0.0), z);
return normalize(n);
}`)};gd(r,t),e.include(nu,t);const o=t.overlayMode!==h_.Disabled,a=o&&t.invisible;switch(t.output){case q.Color:{e.include(kjt,t),e.include(bE,t),o&&e.include(w$,{...t,pbrMode:t.pbrMode===Nt.Terrain?Nt.TerrainWithWater:Nt.Water});const l=t.overlayMode===h_.EnabledWithWater;l&&e.include(Pjt,t),n.add("vnormal","vec3"),n.add("vpos","vec3"),n.add("vup","vec3"),s(),t.screenSizePerspective&&XP(r);const c=t.receiveShadows&&!t.renderOccluded;c&&e.include(H3,t),t.screenSizePerspective&&(n.add("screenSizeDistanceToCamera","float"),n.add("screenSizeCosAngle","float")),r.code.add(T`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${l?T`forwardVertexTangent(vnormal);`:T``}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${o?T`setOverlayVTC(uv);`:""}
          ${t.tileBorders?T`forwardTextureCoordinates();`:""}

          ${t.screenSizePerspective?T`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${c?T`forwardLinearDepth();`:""}

        }
      `),e.include(as,t),e.include(bE,t),e.include(zF,t),e.include(vE,t),hg(i,t),VF(i),K3(i),i.uniforms.add(r.uniforms.get("localOrigin"),new ar("viewDirection",(u,h)=>Se(d2e,se(d2e,h.camera.viewMatrix[12],h.camera.viewMatrix[13],h.camera.viewMatrix[14])))),l&&i.uniforms.add(new Mt("ovWaterTex",(u,h)=>h.overlays.length===0?null:h.overlays[mn.INNER].getNormalTexture(u.overlaySource)),new m8e("view",(u,h)=>hu(Vjt,h.camera.viewMatrix,u.origin))),i.code.add(T`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`),J_(i),C0(i),i.code.add(T`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${t.receiveShadows&&!t.renderOccluded?"readShadowMap(vpos, linearDepth)":t.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${o?T`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${t.invisible?T`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }

          vec3 albedo = tileColor.rgb;

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${t.pbrMode===Nt.Terrain||t.pbrMode===Nt.TerrainWithWater?T`fragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:T`fragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${l?T`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                fragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${t.screenSizePerspective?T`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              fragColor = mix(fragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              fragColor = mix(fragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${t.visualizeNormals?t.spherical?T`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:T`
                  vec3 tNormal = normalize(normal);
                  fragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${t.tileBorders?T`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              fragColor = mix(fragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          fragColor = highlightSlice(fragColor, vpos);
        }
      `)}break;case q.Depth:a&&e.include(w$,t),e.include(V_,t),cx(e),hE(e),r.code.add(T`
              void main(void) {
                ${a?T`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `),i.code.add(T`
              void main() {
                ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case q.Shadow:case q.ShadowHighlight:case q.ShadowExcludeHighlight:e.include(V_,t),cx(e),hE(e),r.code.add(T`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),i.code.add(T`void main() {
outputDepth(linearDepth);
}`);break;case q.Normal:a&&e.include(w$,t),n.add("vnormal","vec3"),XP(r),s(),r.code.add(T`
            void main(void) {
              ${a?T`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `),i.code.add(T`
            void main() {
              ${a?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              fragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case q.Highlight:o&&e.include(w$,t),r.code.add(T`
          void main() {
            ${o?T`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),e.include(s1,t),i.code.add(T`
          void main() {
            ${o?T`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}return t.output===q.ObjectAndLayerIdColor&&(e.include(w$,{...t,pbrMode:Nt.Disabled}),r.code.add(T`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),i.code.add(T`void main() {
fragColor = getOverlayColorTexel(vtcOverlay);
}`)),e}const Vjt=Me(),d2e=A(),Bjt=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:oGe,build:zjt},Symbol.toStringTag,{value:"Module"}));let aGe=class lGe extends si{constructor(){super(...arguments),this.useStencil=!1}initializeConfiguration(e,r){r.spherical=e.viewingMode===at.Global}initializeProgram(e){return new Kr(e.rctx,lGe.shader.get().build(this.configuration),cGe)}initializePipeline(){return this._stencilPipelineState=this._createPipeline(!0),this._createPipeline(!1)}_createPipeline(e){const r=this.configuration,i=r.backfaceCullingEnabled&&!r.renderOccluded;return Qt({blending:r.renderOccluded?Ed(De.ONE,De.ONE_MINUS_SRC_ALPHA):null,culling:i?Ude:null,depthTest:r.renderOccluded?null:{func:Oi.LESS},depthWrite:r.renderOccluded?null:fu,colorWrite:hr,stencilTest:e?KNt(cu.IntegratedMeshMaskExcluded):null})}getPipelineState(e,r){return this.useStencil?this._stencilPipelineState:super.getPipelineState(e,r)}};aGe.shader=new Jr(Bjt,()=>le(()=>import("./Terrain.glsl-9cc3ad85.js"),[]));const cGe=new Map([[O.POSITION,0],[O.UV0,1],[O.NORMALCOMPRESSED,2]]);let jjt=class{constructor(){this.geometry=new zBt,this.intersectionData=null,this.geometryState=null,this._textureRef=new Zje(()=>this.tile.surface.textureFadeDuration),this.overlay=new Ajt,this._geometryStateChangedSinceLastUpdate=!0,this._hasGeometry=!1,this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._clippingAreaChanged=!1,this._wireframeChanged=!1,this._dirtyEdgeResolutions=15,this._dirtyEdges=15,this._dirtyCorners=15}get tile(){return this._tile}init(e){this.clear(),this._tile=e;const r=this.geometry;r.indices=null,r.vertexAttributes=null,en(r.boundingBox),r.indexCount=0,r.numVerticesPerSide=0,this.intersectionData=null,this.geometryState=new qBt,this.localOrigin=null,this.overlay.clear()}clear(){this.releaseGeometry(),this.releaseTexture(),this._textureRef.clear(),this._tile=null,this.intersectionData=null,this.geometryState=null}updateGeometryIfNeeded(e){if((!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)&&(this._updateGeometry(e),this._geometryStateChangedSinceLastUpdate=!1),_o&&this.tile.intersectsClippingArea)for(let r=0;r<4;++r)Ne(this.geometry.outerEdges[r].count===this.geometryState.neighborData.edgeResolutions[r]+1)}_calculateEdgeResolution(e,r){var l;const i=this.tile,n=this.geometryState.numVerticesPerSide-1;if(!i.surface.isGlobal){const c=i.surface.extent;if(c!=null&&(e===0&&i.extent[3]>c[3]||e===1&&i.extent[2]>c[2]||e===2&&i.extent[1]<c[1]||e===3&&i.extent[0]<c[0]))return n}const s=i.level,o=Fy[e];if(!r)return Ne(((l=i.surface)==null?void 0:l.rootTiles)==null||i.surface.updatingRootTiles||!i.shouldHaveNeighbor(o)),n;if(r.isLoaded){const c=r,u=c.renderData.geometryState,h=s-c.level;if(Ne(h>=0),h===0){const g=u.numVerticesPerSide-1;return Math.max(g,n)}const f=2**h,m=u.neighborData.edgeResolutions[(e+2)%4]/f;return Math.max(1,m)}Ne(!r.isLeaf);let a=n;return r.forAllSubtreeOnSide(yj(o),c=>c===i||(c.isLoaded?(a=Math.max(a,2**(c.level-s)),!0):(Ne(!c.isLeaf),!1))),a}updateNeighborData(){var a;const e=this.tile;if(!e.intersectsClippingArea)return;const r=e.renderData.geometryState.neighborData,i=l=>(l.isLoaded||l.level===e.level)&&(l==null?void 0:l.intersectsClippingArea),n=r.edgePeerNeighbors,s=r.edgePeerNeighborSamplerVersions;for(let l=0;l<4;++l){const c=e.findNeighborTile(Fy[l],i),u=GT(e,c),h=((a=u==null?void 0:u.renderData)==null?void 0:a.geometryState.samplerDataVersion)??-1,f=n[l],m=u!==GT(e,f),g=s[l]!==h;n[l]=c,(m||g)&&(s[l]=h,this._markEdgeDirty(l));const y=r.edgeResolutions[l],_=this._calculateEdgeResolution(l,c);Ne(tE(_)),Ne(_>=1),r.edgeResolutions[l]=_,y!==_&&this._markEdgeResolutionDirty(l)}const o=r.cornerPeerNeighbors;for(let l=0;l<4;++l){const c=e.findNeighborTile(a4[l],i);o[l]=c;const u=GT(e,n[l]),h=GT(e,n[(l+1)%4]),f=GT(e,c);kf[l]=f,kf[(l+1)%4]=h,kf[(l+2)%4]=e,kf[(l+3)%4]=u,Ne(kf.some(_=>(_==null?void 0:_.isLoaded)||_===e));const m=kf.reduce((_,b)=>Math.min(_,(b==null?void 0:b.level)??1/0),1/0);kf.forEach((_,b)=>{_&&(_==null?void 0:_.level)>m&&(kf[b]=null)}),Ne(kf.some(_=>(_==null?void 0:_.isLoaded)||_===e));const g=r.cornerNeighborData[l].cornerTiles,y=r.cornerNeighborData[l].cornerTileSamplerVersions;for(let _=0;_<4;++_){const b=kf[_],w=(b==null?void 0:b.renderData.geometryState.samplerDataVersion)??-1,x=g[_]!==b,S=!x&&y[_]!==w;(x||S)&&(g[_]=b,y[_]=w,this._markCornerDirty(l))}Ne(g.some(_=>(_==null?void 0:_.isLoaded)||_===e))}_o&&Ne(this.geometryState.neighborData.edgeResolutions.every(l=>l>0));for(let l=0;l<4;++l)kf[l]=null}_updateGeometry(e){if(!this.tile.intersectsClippingArea)return;_o&&Ne(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(l=>l>0)),this.intersectionData=null;const r=this.tile,i=this._vao,n=this.geometry.vertexAttributes,s=!i||!n||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions,o=!s&&(this._dirtyEdges!==0||this._dirtyEdgeResolutions!==0),a=!o&&this._dirtyCorners!==0;s?(this.releaseGeometry(),this._createGeometry(e)):o||a?r.updateEdgeElevations():a?r.updateCornerElevations():console.warn("Update for no reason?"),this._numVerticesPerSideChanged=!1,this._samplerDataChanged=!1,this._dirtyEdgeResolutions=0,this._dirtyEdges=0,this._dirtyCorners=0,this._clippingAreaChanged=!1,this._wireframeChanged=!1}get hasGeometry(){return this._hasGeometry}releaseGeometry(){return this._hasGeometry=!1,this.intersectionData=null,!!this._vao&&(this._vao.dispose(),this._vao=null,jBt(this.geometry),!0)}ensureTexture(e,r){return this._texture!=null&&this._texture.descriptor.width!==e&&this.releaseTexture(),this._texture==null&&(this._texture=r(),this.tile.setMemoryDirty()),this._texture}releaseTexture(){this._texture!=null&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())}_markCornerDirty(e){const r=1<<e;this._dirtyCorners|=r}_markEdgeDirty(e){const r=1<<e;this._dirtyEdges|=r,this._markCornerDirty((e+0)%4),this._markCornerDirty((e+3)%4)}_markEdgeResolutionDirty(e){const r=1<<e;this._dirtyEdgeResolutions|=r,this._markEdgeDirty(e)}_markAllEdgesAndCornersDirty(){this._dirtyCorners=15,this._dirtyEdges=15,this._dirtyEdgeResolutions=15}updateGeometryState(){const e=this._getElevationInfo(),r=this.tile,i=e.samplerData?r.getElevationVerticesPerSide(e.maxTileLevel):r.getDefaultVerticesPerSide(),n=Math.max(i,5);let s=r.clippingArea;r.intersectsClippingArea&&!r.isWithinClippingArea||(s=null);const o=this.geometryState;let a=!1;o.numVerticesPerSide!==n&&(this._numVerticesPerSideChanged=!0,o.numVerticesPerSide=n,o.samplerDataVersion++,a=!0),e.changed&&(this._samplerDataChanged=!0,o.samplerData=e.samplerData,o.samplerDataVersion++,a=!0),T_(o.clippingArea,s)||(this._clippingAreaChanged=!0,o.clippingArea=s,a=!0);const l=r.surface.wireframe;return o.wireframe!==l&&(this._wireframeChanged=!0,o.wireframe=l,a=!0),this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=a),a&&this._markAllEdgesAndCornersDirty(),this._hasGeometry=!0,this._geometryStateChangedSinceLastUpdate}_createGeometry(e){this.tile.createGeometry();const r=this.geometry.vertexAttributes,i=this.geometry.indices,n=e.gl;this._vao=new gg(e,cGe,{geometry:Ad(r.layout)},{geometry:ci.createVertex(e,n.STATIC_DRAW,r.buffer)},ci.createIndex(e,n.STATIC_DRAW,i)),this._hasGeometry=!0}get vao(){return this._vao}setTextureReference(e,r=u_.Immediate){e!=null&&e.texture!==this._texture&&this.releaseTexture(),this._textureRef.push(e,r)}get textureReference(){return this._textureRef.current}get nextTextureReference(){return this._textureRef.next}get textureFadeFactor(){return this._textureRef.fadeFactor}get textureIsFading(){return this._textureRef.isFading}_getElevationInfo(){const e=this.geometryState.samplerData,r=this.tile.layerInfo[Er.ELEVATION],i=r.length,n=new Array(i);let s=0,o=0,a=!1;for(let u=0;u<i;u++){const h=r[u];if(h.upsampleInfo!=null){const f=h.upsampleInfo.tile,m=f.layerInfo[Er.ELEVATION][u].data,g=m&&m.samplerData;e&&e[s]===g||(a=!0),n[s++]=g,o=Math.max(o,f.lij[0])}else if(h.data){const f=this.tile.surface.layerViewByIndex(u,Er.ELEVATION);if(FD(this.tile,f.layer,!1)){const m=h.data;e&&e[s]===m.samplerData||(a=!0),n[s++]=m.samplerData,o=this.tile.level}}}e!=null&&e.length!==s&&(a=!0);const l=s>0,c=l?n:null;return l&&(n.length=s),{changed:a,samplerData:c,maxTileLevel:o}}get estimatedGeometryMemoryUsage(){var r,i,n;const e=((r=this.intersectionData)==null?void 0:r.estimatedMemoryUsage)??0;return(((i=this.geometry.indices)==null?void 0:i.byteLength)??0)+(((n=this.geometry.vertexAttributes)==null?void 0:n.byteLength)??0)+e}get texture(){return this._texture}get test(){return{hasTexture:this._texture!=null}}checkGeometryWaterproofness(){if(!_o)return;const e=this.tile;if(!e.isLoaded||!e.intersectsClippingArea||e.level===0)return void Ne(e==null?void 0:e.isLoaded);const r=e.surface.extent;if(r!=null&&!e.intersectsExtent(r))return;const i=Fy.map((a,l)=>r!=null&&(l<2?-1:1)*(e.extent[3-l]-r[3-l])<0),n=e.level;Ne(this._dirtyCorners===0),Ne(this._dirtyEdges===0),Ne(this._dirtyEdgeResolutions===0),Ne(!this._numVerticesPerSideChanged),Ne(!this._samplerDataChanged),Ne(!this._clippingAreaChanged),Ne(!this._wireframeChanged);const s=a4.map(a=>e.findNeighborCornerTileExact(a,l=>!l.intersectsClippingArea||l.isLoaded||l.level===e.level)??null).map(a=>a!=null&&a.intersectsClippingArea?a:null),o=this.geometryState.neighborData;for(let a=0;a<4;++a){const l=o.cornerPeerNeighbors[a],c=s[a];Ne(c===l,`Tile[${e.lij}].corner[${a}] out of date: cur=[${l==null?void 0:l.lij}] exp=[${c==null?void 0:c.lij}]`)}Fy.forEach((a,l)=>{if(i[l])return;const c=e.findNeighborTile(a,N=>(N.level===n||(N==null?void 0:N.isLoaded))&&(N==null?void 0:N.intersectsClippingArea));if(!c){const N=!e.surface.updatingRootTiles&&e.surface.rootTiles!=null&&e.surface.rootTiles.length>0&&e.shouldHaveNeighbor(a);return void Ne(!N)}Ne(c.isLoaded||c.level===e.level),Ne(c===this.geometryState.neighborData.edgePeerNeighbors[l]);const u=n-c.level;if(!c.isLoaded)return Ne(!c.isLeaf),void Ne(u===0);const h=c.renderData;Ne(Ojt(e,c,a)),Ne(u>=0);const f=2**u;if(u<0)return void Ne(!1);const m=e.renderData,g=m.geometry,y=g.outerEdges[l],_=g.numVerticesPerSide-1,b=h.geometry;if(!b)return void Ne(!1);const w=this.geometryState.neighborData.edgePeerNeighbors[l];if(w!=null&&w.isLoaded){const N=w.renderData;Ne(w==w),Ne(m.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===N.geometryState.samplerDataVersion),Ne(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[l]===N.geometryState.samplerDataVersion)}const x=(l+2)%4,S=b.outerEdges[x],C=y.count-1,E=S.count-1;Ne(C*f===E,`Tile[${e.lij}]:e${l},res=${C} edgeRes mismatch with Neighbor[${c.lij}]:e${x},res=${E} (expected:${C*f})`);const R=e.extent,P=a===Ft.NORTH||a===Ft.SOUTH,D=S.count-1,L=D/2**u,k=y.count-1;if(L<1)return void Ne(k===1);Ne(L===k),Ne(tE(L));const V=b.numVerticesPerSide-1;Ne(u>0||L===Math.max(V,_));const W=e.getNeighborEdgeStartVertexIndex(l,c);Ne(0<=W&&W<f);const G=W*L;Ne(0<=G&&G<=D-L);let B=0,Z=G;y.getVertexPos(Vg,0),y.getVertexPos(Bg,y.count-1);const M=Li(Vg,Bg),$=Math.max(Gjt,1e-4*M);for(let N=0;N<=L;++N){y.getVertexPos(Vg,B),S.getVertexPos(Bg,Z);const j=N/L,J=P?R[0]+j*(R[2]-R[0]):a===Ft.WEST?R[0]:R[2],K=P?a===Ft.SOUTH?R[1]:R[3]:R[1]+j*(R[3]-R[1]),te=e.surface.extent;if(te==null||R7(te,J,K)){const ae=W4(Vg,Bg),be=ju(Vg)-Rr.radius,Ee=ju(Bg)-Rr.radius,Je=ae<$;if(!Je){console.warn(`Tile edge vertex position mismatch: between [${e.lij}].edge${l}[${B}/${y.count}] and [${c.lij}].edge${x}[${Z}/${S.count}]`),te!=null&&console.warn("  surface extent= ",te," x,y=",J,",",K);const Le=A();ve(Le,m.localOrigin,h.localOrigin),ju(Le)>0&&console.warn(`   localOrigins: ${m.localOrigin} vs ${h.localOrigin} d=${ju(Le)} [${Le}]`),(()=>{const de=qi(Vg),$e=qi(Bg);e.updateEdgeElevations(),c.updateEdgeElevations(),y.getVertexPos(Vg,B),S.getVertexPos(Bg,Z);const Be=A();Gi(Be,Vg,de),ju(Be)>0&&console.warn(`  XXX Tile[${e.lij}] edge out of date: ${de} vs ${Vg} d=${ju(Be)} [${Be}]`),Gi(Be,Bg,$e),ju(Be)>0&&console.warn(`  XXX Neighbor[${c.lij}] edge out of date: ${$e} vs ${Bg} d=${ju(Be)} [${Be}]`)})(),Ne(Je,`Mismatch in tile [${e.lij}].edge[${l}][${B}/${y.count}] vs neighbor [${c.lij}].edge[${x}][${Z}/${S.count}] ${H0(Vg)} vs ${H0(Bg)}  dist=${ae} h(t|n|d)=${be}|${Ee}|${Ee-be}`)}y.getNormal(JC,B),S.getNormal(KC,Z),Se(h2e,JC),Se(p2e,KC);const ze=ye(h2e,p2e),Ge=1-ze<.01||!1||e===c;if(!Ge){const Le=A();Gi(Le,JC,KC);const de=()=>`Mismatch in tile edge normal ${HTe(e.lij)} (${B}/${y.count-1}) edge ${l} vs neighbor ${HTe(c.lij)}  (${Z}/${S.count-1}) nedge ${x} :${H0(JC)} vs ${H0(KC)}  dot = ${ze} : ${H0(Le)}`;console.warn("Mismatch in tile edge normal: ",de());{e.updateEdgeElevations(),c.updateEdgeElevations();const $e=A(),Be=A();y.getNormal($e,B),S.getNormal(Be,Z),Ww(JC,$e)||console.warn("Missing update in tile normal: ",H0(JC)," => ",H0($e)),Ww(KC,Be)||console.warn("Missing update in neighbor normal: ",H0(KC)," => ",H0(Be))}Ne(Ge,de())}}B+=1,Z+=1}})}};const Vg=A(),Bg=A(),JC=A(),KC=A(),h2e=A(),p2e=A(),Gjt=1,kf=[null,null,null,null];function GT(t,e){return e!=null&&e.isLoaded||e===t?e:null}const Hjt=65536;function qjt(t,e){const r=t.tile,{extent:i,extentInRadians:n,surface:s}=r,o=t.localOrigin,a=t.geometryState,l=s.isWebMercator,c=a.numVerticesPerSide,u=c-1,h=(c-2)**2,f=l&&(e===Pp.HAS_SOUTH_POLE||e===Pp.HAS_BOTH_POLES),m=l&&(e===Pp.HAS_NORTH_POLE||e===Pp.HAS_BOTH_POLES),g=6,y=((f?1:0)+(m?1:0))*g*(u+1),_=a.neighborData,b=_.edgeResolutions.reduce((R,P)=>R+P+1,0),w=Yje(h+y+b),x=t.geometry;x.numVerticesPerSide=a.numVerticesPerSide,x.vertexAttributes=w;const S=x.boundingBox;en(S);const C=tfe(t);Ta.update(u,n,C),Wjt(t),_Ge(t,h),uGe(t);const E=[];if((()=>{let R=h+b;const P=o[0],D=o[1],L=o[2],k=r.ellipsoid.radius,V=i[1],W=i[3],G=(B,Z)=>{const M=Z*c;Zp(-P,-D,B*k-L,S),E.push({connectedRowOffset:M,connectedOuterEdgeOffset:B===1?0:2,rowOffset:R,latitudeResolution:g});const $=pGe(B===-1?V:W,k),N=B*Math.PI/2-$,j=.99*(B===1?1:-1),J=k+0,K=w.position,te=w.uv0,{typedBuffer:ae,typedBufferStride:be}=w.normalCompressed;for(let Ee=1;Ee<=g;++Ee){const Je=$+N*(Ee/g),ze=Math.cos(Je),Ge=Math.sin(Je);for(let Le=0;Le<=u;Le++){const de=Le/u,$e=Ta.sinLonLUT[Le],Be=Ta.cosLonLUT[Le]*ze,we=$e*ze,Ie=Ge,je=Be*J-P,fe=we*J-D,Ae=Ie*J-L;Zp(je,fe,Ae,S),K.setValues(R,je,fe,Ae),Qm(te,R,de,j),_E(ae,R,Be,we,Ie,be),++R}}};f&&G(-1,0),m&&G(1,u)})(),vGe(x,a.numVerticesPerSide,E,[0,c-1],[0,c-1],a.wireframe),t.intersectionData=null,_o)for(let R=0;R<4;++R)Ne(x.outerEdges[R].count===_.edgeResolutions[R]+1)}function Wjt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=t.geometryState,i=r.numVerticesPerSide,n=i-2,s=i-1,o=t.geometry,a=o.vertexAttributes,l=a.position,c=a.uv0,{typedBuffer:u,typedBufferStride:h}=a.normalCompressed,f=e.extent,m=f[0],g=f[2],y=f[1],_=f[3],b=e.ellipsoid.radius,w=r.samplerData,x=t.localOrigin,S=x[0],C=x[1],E=x[2],R=l.typedBuffer,P=l.typedBufferStride,D=1/s,L=o.boundingBox;let k=0;if(1<=n){const V=D,W=y*(1-V)+_*V,G=Ta.sinLatLUT[1],B=Ta.cosLatLUT[1];for(let Z=1;Z<=n;Z++){const M=Z*D,$=m*(1-M)+g*M,N=Ta.sinLonLUT[Z],j=Ta.cosLonLUT[Z],J=b+Ln($,W,w),K=J*j*B-S,te=J*N*B-C,ae=J*G-E;Zp(K,te,ae,L);const be=(Z-1)*P;R[be]=K,R[be+1]=te,R[be+2]=ae,Qm(c,Z-1,M,V)}}for(let V=1;V<=n;V++){const W=V*D,G=y*(1-W)+_*W,B=Ta.sinLatLUT[V],Z=Ta.cosLatLUT[V],M=V+1,$=M*D,N=y*(1-$)+_*$,j=Ta.sinLatLUT[M],J=Ta.cosLatLUT[M],K=Ta.sinLonLUT[0],te=Ta.cosLonLUT[0],ae=b+Ln(m,G,w);let be=te*Z*ae-S,Ee=K*Z*ae-C,Je=B*ae-E;const ze=k*P;let Ge=R[ze],Le=R[ze+1],de=R[ze+2];for(let $e=1;$e<=n;$e++){const Be=$e*D,we=m*(1-Be)+g*Be,Ie=Ta.sinLonLUT[$e],je=Ta.cosLonLUT[$e];let fe=0,Ae=0,gt=0;if($e<n){const Ir=(k+1)*P;fe=R[Ir],Ae=R[Ir+1],gt=R[Ir+2]}else{const Ir=Ta.sinLonLUT[s],_i=Ta.cosLonLUT[s],Wi=b+Ln(g,G,w);fe=_i*Z*Wi-S,Ae=Ir*Z*Wi-C,gt=B*Wi-E}const Re=be,He=Ee,Dt=Je;be=Ge,Ee=Le,Je=de,Ge=fe,Le=Ae,de=gt;const Fe=fe-Re,nt=Ae-He,Ke=gt-Dt;let mt=0,wt=0,xt=0;if(V>1){const Ir=(k-n)*P;mt=R[Ir],wt=R[Ir+1],xt=R[Ir+2]}else{const Ir=Ta.sinLatLUT[0],_i=Ta.cosLatLUT[0],Wi=b+Ln(we,y,w);mt=je*_i*Wi-S,wt=Ie*_i*Wi-C,xt=Ir*Wi-E}const st=b+Ln(we,N,w),Xe=je*J*st-S,it=Ie*J*st-C,Oe=j*st-E;if(V<n){const Ir=k+n,_i=Ir*P;R[_i]=Xe,R[_i+1]=it,R[_i+2]=Oe,Zp(Xe,it,Oe,L),Qm(c,Ir,Be,$)}const Ze=mt-Xe,At=wt-it,_t=xt-Oe;let cr=je*Z,pr=Ie*Z,kr=B;kr*kr<.999&&(cr=Ke*At-nt*_t,pr=Fe*_t-Ke*Ze,kr=nt*Ze-Fe*At);const Gr=1/Math.sqrt(cr*cr+pr*pr+kr*kr);_E(u,k,cr*Gr,pr*Gr,kr*Gr,h),++k}}}function Xjt(t){t.tile.intersectsClippingArea&&(uGe(t),pq(t))}function Yjt(t){t.tile.intersectsClippingArea&&(hGe(t),dGe(t,!0),pq(t))}function uGe(t){t.tile.intersectsClippingArea&&(hGe(t),dGe(t))}function dGe(t,e=!1){const r=t.geometryState,i=t.geometry,n=r.neighborData,s=t.tile,o=s.level,a=s.extent,l=s.ellipsoid.radius,c=s.extentInRadians,u=c[0],h=c[2],f=c[1],m=c[3],g=r.samplerData,y=a[0],_=a[2],b=a[1],w=a[3],x=tfe(t),S=i.boundingBox,C=t.localOrigin,E=C[0],R=C[1],P=C[2],D=i.vertexAttributes,L=D.position,k=L.typedBuffer,V=L.typedBufferStride,W=D.uv0;for(let G=0;G<4;++G){const B=G===1||G===3,Z=n.edgeResolutions[G];Ne(tE(Z));const M=Z+1,$=GT(s,n.edgePeerNeighbors[G]);if(xGe(s,$,G)){bGe(t,G,$);continue}const N=$!=null;Ne(!N||$.level===s.level),Ne(!N||d_(s,$)<=0);const j=$==null?void 0:$.renderData,J=j==null?void 0:j.geometryState;if(_o){const Fe=s.surface;if(!$&&Fe&&!Fe.updatingRootTiles){const nt=Fy[G],Ke=s.findNeighborTile(nt,mt=>mt.isLoaded||mt.isLeaf||mt.level===s.level);Ke?Ke.intersectsClippingArea&&(Ne(!Ke.isLoaded),Ne(!Ke.isLeaf),Ne(Ke.level===o)):Ne((Fe==null?void 0:Fe.rootTiles)==null||!s.shouldHaveNeighbor(nt))}}const K=G===1?a[2]:a[0],te=$==null?void 0:$.extent,ae=te&&B?G===1?te[0]:te[2]:K,be=G===0?a[3]:a[1],Ee=G===1?1:0,Je=G===0?1:0,ze=G===1?h:u,Ge=G===0?m:f,Le=Math.sin(ze),de=Math.cos(ze),$e=Math.sin(Ge),Be=Math.cos(Ge),we=J==null?void 0:J.samplerData,Ie=N?(Fe,nt,Ke)=>.5*(Ln(Fe,nt,g)+Ln(Ke,nt,we)):(Fe,nt,Ke)=>Ln(Fe,nt,g),je=i.outerEdges[G],fe=e&&M>3?M-3:1,Ae=g!=null&&g.some(Fe=>Fe!=null),gt=we!=null&&we.some(Fe=>Fe!=null),Re=Ae||gt,He=1/Z,Dt=je.index0;Ne(!te||$p(te[2]-te[0],a[2]-a[0])),(()=>{const Fe=G===1?-1:G===3?1:0,nt=G===0?-1:G===2?1:0,Ke=(a[2]-a[0])*He,mt=Fe*Ke,wt=nt*Ke,xt=B?Fe*((h-u)*He):0,st=B?0:nt*He,Xe=Je,it=B?ze+xt:ze,Oe=B?Math.sin(it):Le,Ze=B?Math.cos(it):de,At=B?ze-xt:ze,_t=B?Math.sin(At):Le,cr=B?Math.cos(At):de,pr=B?Ge:x(Xe+st),kr=B?$e:Math.sin(pr),Gr=B?Be:Math.cos(pr),Ir=B?Ge:x(Xe-st),_i=B?$e:Math.sin(Ir),Wi=B?Be:Math.cos(Ir);let Qs=0,eo=0,to=0;{const pi=0*He,io=B?K:y*(1-pi)+_*pi,no=B?ae:io,za=B?b*(1-pi)+w*pi:be,ue=B?ze:u*(1-pi)+h*pi,bi=B?Le:Math.sin(ue),zs=B?de:Math.cos(ue),Jn=B?x(pi):Ge,Pd=B?Math.sin(Jn):$e,yt=B?Math.cos(Jn):Be,Va=l+Ie(io,za,no);Qs=zs*yt*Va,eo=bi*yt*Va,to=Pd*Va}let ro=0,tn=0,rn=0;{const pi=1*He,io=B?K:y*(1-pi)+_*pi,no=B?ae:io,za=B?b*(1-pi)+w*pi:be,ue=B?ze:u*(1-pi)+h*pi,bi=B?Le:Math.sin(ue),zs=B?de:Math.cos(ue),Jn=B?x(pi):Ge,Pd=B?Math.sin(Jn):$e,yt=B?Math.cos(Jn):Be,Va=l+Ie(io,za,no);ro=zs*yt*Va,tn=bi*yt*Va,rn=Pd*Va}for(let pi=1;pi<M-1;pi+=fe){let io=0,no=0,za=0;{const Gl=(pi+1)*He,_u=B?K:y*(1-Gl)+_*Gl,Sg=B?ae:_u,Bo=B?b*(1-Gl)+w*Gl:be,Un=B?ze:u*(1-Gl)+h*Gl,d1=B?Le:Math.sin(Un),Lx=B?de:Math.cos(Un),Dx=B?x(Gl):Ge,KE=B?Math.sin(Dx):$e,Nx=B?Math.cos(Dx):Be,h1=l+Ie(_u,Bo,Sg);io=Lx*Nx*h1,no=d1*Nx*h1,za=KE*h1}const ue=io,bi=no,zs=za,Jn=ro,Pd=tn,yt=rn;ro=ue,tn=bi,rn=zs;{const Gl=Dt+pi,_u=Gl*V,Sg=Jn-E,Bo=Pd-R,Un=yt-P;k[_u]=Sg,k[_u+1]=Bo,k[_u+2]=Un,Zp(Sg,Bo,Un,S);const d1=pi*He;Qm(W,Gl,B?Ee:d1,B?d1:Je)}const Va=Qs,Vs=eo,bg=to;Qs=Jn,eo=Pd,to=yt;const wg=Jn,Ba=Pd,Ef=yt,$0=1/Math.sqrt(wg*wg+Ba*Ba+Ef*Ef),gr=Ef*$0;let xg=0,Ar=0,so=0;if(Re&&gr*gr<.999){let Gl=0,_u=0,Sg=0;{const Bo=G===0?-1:1;Gl=Bo*(ue-Va),_u=Bo*(bi-Vs),Sg=Bo*(zs-bg)}{const Bo=pi*He,Un=B?K:y*(1-Bo)+_*Bo,d1=B?ae:Un,Lx=B?b*(1-Bo)+w*Bo:be,Dx=B?ze:u*(1-Bo)+h*Bo,KE=B?Le:Math.sin(Dx),Nx=B?de:Math.cos(Dx),h1=B?x(Bo):Ge,s5=B?Math.sin(h1):$e,Mc=B?Math.cos(h1):Be;let aM=wg,lM=Ba,Q=Ef;if(N){const xe=l+Ln(d1-mt,Lx-wt,we),Ve=B?Mc:Wi;aM=(B?cr:Nx)*Ve*xe,lM=(B?_t:KE)*Ve*xe,Q=(B?s5:_i)*xe}{const xe=l+Ln(Un+mt,Lx+wt,g),Ve=B?Mc:Gr,Lr=(B?Ze:Nx)*Ve*xe,Bs=(B?Oe:KE)*Ve*xe,Xi=(B?s5:kr)*xe;N||(aM=2*wg-Lr,lM=2*Ba-Bs,Q=2*Ef-Xi);const Hl=G===3?-1:1,Fx=Hl*(aM-Lr),Bme=Hl*(lM-Bs),jme=Hl*(Q-Xi);xg=Sg*Bme-_u*jme,Ar=Gl*jme-Sg*Fx,so=_u*Fx-Gl*Bme;const iW=1/Math.sqrt(xg*xg+Ar*Ar+so*so);xg*=iW,Ar*=iW,so*=iW}}}else xg=wg*$0,Ar=Ba*$0,so=Ef*$0;je.setNormalFromValues(pi,xg,Ar,so)}})()}}function hGe(t){wGe(t)}function pGe(t,e){return Math.PI/2-2*Math.atan(Math.exp(-t/e))}function Zjt(t,e,r,i){return pGe(t*(1-i)+e*i,r)}function Jjt(t,e,r){return t*(1-r)+e*r}function tfe(t){const e=t.tile;if(e.surface.isWebMercator){const i=e.extent,n=e.ellipsoid.radius;return s=>Zjt(i[1],i[3],n,s)}const r=e.extentInRadians;return i=>Jjt(r[1],r[3],i)}function Kjt(t,e){const r=t.tile.extent,i=t.geometryState,n=r[0],s=r[1],o=r[2]-n,a=r[3]-s,l=i.clippingArea,c=l!=null?Math.max(0,(l[0]-n)/o):0,u=l!=null?Math.max(0,(l[1]-s)/a):0,h=l!=null?Math.min(1,(l[2]-n)/o):1,f=l!=null?Math.min(1,(l[3]-s)/a):1,m=i.numVerticesPerSide,g=(m-2)**2,y=i.neighborData.edgeResolutions.reduce((x,S)=>x+S+1,0),_=Yje(g+y),b=t.geometry,w=b.boundingBox;en(w),b.numVerticesPerSide=i.numVerticesPerSide,b.vertexAttributes=_,Ki(b.uvRange,c,u,h,f),Qjt(t),_Ge(t,g),fGe(t),vGe(b,i.numVerticesPerSide,[],[0,m-1],[0,m-1],i.wireframe),t.intersectionData=null}function Qjt(t){const e=t.tile;if(!e.intersectsClippingArea)return;const r=e.surface,i=t.geometryState,n=i.samplerData,s=t.localOrigin,o=r.isWebMercatorOnPlateeCarree,a=i.clippingArea,l=a??rfe,c=e.extent,u=c[0],h=c[1],f=c[2],m=c[3],g=Math.max(u,l[0]),y=Math.min(f,l[2]),_=Math.max(h,l[1]),b=Math.min(m,l[3]),w=e.ellipsoid.radius,x=e.horizontalScale,S=i.numVerticesPerSide,C=S-1,E=S-2,R=t.geometry,P=R.vertexAttributes,D=P.position,L=P.uv0,{typedBuffer:k,typedBufferStride:V}=P.normalCompressed,W=R.uvRange,G=W[0],B=W[1],Z=W[2],M=W[3],$=R.boundingBox,N=s[0],j=s[1],J=s[2],K=D.typedBuffer,te=D.typedBufferStride;let ae=0;const be=Te(h,_,b),Ee=o?(Math.PI/2-2*Math.atan(Math.exp(-be/w)))*w:be*x,Je=1/C,ze=Te(h*(1-Je)+m*Je,_,b);let Ge=Ee,Le=o?(Math.PI/2-2*Math.atan(Math.exp(-ze/w)))*w:ze*x;for(let de=1;de<=E;de++){const $e=de/C,Be=Te(h*(1-$e)+m*$e,_,b),we=Te($e,B,M),Ie=Le,je=(de-1)/C,fe=Te(h*(1-je)+m*je,_,b),Ae=Ge,gt=(de+1)/C,Re=Te(h*(1-gt)+m*gt,_,b),He=o?(Math.PI/2-2*Math.atan(Math.exp(-Re/w)))*w:Re*x,Dt=Te(gt,B,M);Ge=Le,Le=He;const Fe=Te(u,g,y);let nt=Fe*x,Ke=Ln(Fe,Be,n);const mt=1/C,wt=Te(mt,G,Z),xt=Te(u*(1-wt)+f*wt,g,y);let st=wt,Xe=xt,it=xt*x,Oe=Ln(xt,Be,n);if(de===1){const Ze=it-N,At=Ge-j,_t=Oe-J,cr=0*te;K[cr]=Ze,K[cr+1]=At,K[cr+2]=_t,Zp(Ze,At,_t,$);const pr=Te(mt,G,Z);Qm(L,ae,pr,we)}for(let Ze=1;Ze<=E;Ze++){const At=it,_t=Oe,cr=(Ze+1)/C,pr=Te(cr,G,Z),kr=Te(u*(1-cr)+f*cr,g,y),Gr=Xe;Xe=kr;{const tn=ae+1,rn=tn*te;if(de===1||Ze===E){const pi=kr*x,io=Ln(kr,Be,n);if(de===1&&Ze<E){const no=pi-N,za=Ie-j,ue=io-J;K[rn]=no,K[rn+1]=za,K[rn+2]=ue,Zp(no,za,ue,$),Qm(L,tn,pr,we)}it=pi,Oe=io}else it=K[rn]+N,Oe=K[rn+2]+J}const Ir=it,_i=Oe,Wi=nt,Qs=Ke;nt=At,Ke=_t;const eo=(ae-E)*te,to=de===1?Ln(Gr,fe,n):K[eo+2]+J,ro=Ln(Gr,Re,n);if(de<E){const tn=ae+E,rn=tn*te,pi=At-N,io=He-j,no=ro-J;K[rn]=pi,K[rn+1]=io,K[rn+2]=no,Zp(pi,io,no,$);const za=st;st=pr,Qm(L,tn,za,Dt)}{const tn=Ir-Wi,rn=Ae-He,pi=rn*(_i-Qs),io=tn*(to-ro),no=-rn*tn,za=pi*pi+io*io+no*no;if(za===0)_E(k,ae,0,0,1,V);else{const ue=1/Math.sqrt(za);_E(k,ae,pi*ue,io*ue,no*ue,V)}}++ae}}}function eGt(t,e){t.tile.intersectsClippingArea&&(gGe(t),mGe(t,!0),pq(t))}function tGt(t,e){t.tile.intersectsClippingArea&&(fGe(t),pq(t))}function fGe(t,e){t.tile.intersectsClippingArea&&(gGe(t),mGe(t,!1))}function mGe(t,e){const r=t.geometryState,i=r.neighborData,n=t.tile,s=n.surface,o=n.extent,a=r.clippingArea,l=a??rfe,c=o[0],u=o[2],h=o[1],f=o[3],m=[f>l[3],u>l[2],h<l[1],c<l[0]],g=t.geometry,y=n.horizontalScale,_=yGe(s.isWebMercatorOnPlateeCarree,n.ellipsoid.radius,y),b=g.boundingBox,w=g.uvRange[0],x=g.uvRange[1],S=g.uvRange[2],C=g.uvRange[3],E=Math.max(c,l[0]),R=Math.min(u,l[2]),P=Math.max(h,l[1]),D=Math.min(f,l[3]),L=t.localOrigin,k=L[0],V=L[1],W=L[2],G=r.samplerData;for(let B=0;B<4;++B){const Z=B===1||B===3,M=i.edgeResolutions[B];Ne(tE(M));const $=M+1,N=m[B],j=GT(n,i.edgePeerNeighbors[B]);if(!N&&xGe(n,j,B)){bGe(t,B,j);continue}const J=j!=null&&!N,K=j==null?void 0:j.renderData,te=K==null?void 0:K.geometryState;if(_o&&(Ne(!J||j.level===n.level),Ne(!J||d_(n,j)<=0),n&&!j&&!s.updatingRootTiles)){const Fe=Fy[B],nt=n.findNeighborTile(Fe,Ke=>Ke.isLoaded||Ke.isLeaf||Ke.level===n.level);s.updatingRootTiles||(nt?nt.intersectsClippingArea&&(Ne(!nt.isLoaded),Ne(!nt.isLeaf),Ne(nt.level===n.level)):Ne((s==null?void 0:s.rootTiles)==null||!n.shouldHaveNeighbor(Fe)))}const ae=Te(B===1?u:c,E,R),be=Te(B===0?f:h,P,D),Ee=te==null?void 0:te.samplerData,Je=g.outerEdges[B],ze=e&&$>3?$-3:1,Ge=Te(B===1?1:0,w,S),Le=Te(B===0?1:0,x,C),de=J?(Fe,nt)=>.5*(Ln(Fe,nt,Ee)+Ln(Fe,nt,G)):(Fe,nt)=>Ln(Fe,nt,G),$e=(u-c)/M,Be=Z?B===1?$e:-$e:0,we=Z?0:B===0?$e:-$e,Ie=-Be,je=-we;let fe=0,Ae=0,gt=0;{const Fe=0/M,nt=Z?ae:Te(c*(1-Fe)+u*Fe,E,R),Ke=Z?Te(h*(1-Fe)+f*Fe,P,D):be,mt=de(nt,Ke);fe=nt*y,Ae=_(Ke),gt=mt}let Re=0,He=0,Dt=0;{const Fe=1/M,nt=Z?ae:Te(c*(1-Fe)+u*Fe,E,R),Ke=Z?Te(h*(1-Fe)+f*Fe,P,D):be,mt=de(nt,Ke);Re=nt*y,He=_(Ke),Dt=mt}for(let Fe=1;Fe<$-1;Fe+=ze){const nt=Fe/M,Ke=Re,mt=He,wt=Dt;{const pr=Z?Ge:Te(nt,w,S),kr=Z?Te(nt,x,C):Le,Gr=Ke-k,Ir=mt-V,_i=wt-W;Zp(Ke,Ir,_i,b),Je.setVertexFromValuesRawPositionUV(Fe,Gr,Ir,_i,pr,kr)}{const pr=(Fe+1)/M,kr=Z?ae:Te(c*(1-pr)+u*pr,E,R),Gr=Z?Te(h*(1-pr)+f*pr,P,D):be,Ir=de(kr,Gr);Re=kr*y,He=_(Gr),Dt=Ir}const xt=Re,st=Dt,Xe=fe,it=Ae,Oe=gt;fe=Ke,Ae=mt,gt=wt;let Ze=0,At=0,_t=0;if(Z){const pr=He-mt,kr=st-wt,Gr=it-mt,Ir=Oe-wt,_i=Te(h*(1-nt)+f*nt,P,D),Wi=ae+Ie,Qs=Wi*y-Ke,eo=Ln(Wi,_i,G)-wt,to=B===3?-1:1;if(Ze=to*(-Gr+pr)*eo,At=to*Qs*(-Ir+kr),_t=-to*Qs*(-Gr+pr),J){const ro=ae+Be,tn=ro*y-Ke;Ze=(-Gr+pr)*(eo-(Ln(ro,_i,Ee)-wt)),At=(Qs-tn)*(-Ir+kr),_t=-(Qs-tn)*(-Gr+pr)}}else{const pr=xt-Ke,kr=st-wt,Gr=Xe-Ke,Ir=Oe-wt,_i=Te(c*(1-nt)+u*nt,E,R),Wi=be+je,Qs=Ln(_i,Wi,G)-wt,eo=_(Wi)-mt,to=B===2?-1:1;if(Ze=to*eo*(-Ir+kr),At=to*(-Gr+pr)*Qs,_t=-to*eo*(-Gr+pr),J){const ro=_i,tn=be+we,rn=_(tn)-mt;Ze=(-eo+rn)*(-Ir+kr),At=(-Gr+pr)*(-Qs+(Ln(ro,tn,Ee)-wt)),_t=-(-eo+rn)*(-Gr+pr)}}const cr=1/Math.sqrt(Ze*Ze+At*At+_t*_t);Je.setNormalFromValues(Fe,Ze*cr,At*cr,_t*cr)}}}function gGe(t,e){wGe(t)}function rGt(t,e){return(Math.PI/2-2*Math.atan(Math.exp(-t/e)))*e}function iGt(t,e){return t*e}function yGe(t,e,r){return t?i=>rGt(i,e):i=>iGt(i,r)}function vGe(t,e,r,i,n,s){const o=e-1,a=t.vertexAttributes.count,l=2*(Math.min(e-2,i[1])-Math.max(1,i[0]))*(Math.min(e-2,n[1])-Math.max(1,n[0])),c=Fy.map((x,S)=>S===0&&n[1]<e-2||S===1&&i[1]<e-2||S===2&&n[0]>1||S===3&&i[0]>1),u=t.outerEdges.reduce((x,S,C)=>x+(c[C]?0:o-2+S.count-1),0),h=r.reduce((x,S)=>x+o*(2*(S.latitudeResolution-1)+1),0),f=s?2:1,m=3*(l+u+h)*f,g=a>=Hjt?new Uint32Array(m):new Uint16Array(m);let y=0;const _=e-2,b=o-2;Ne(b>=0);const w=(x,S,C,E,R,P)=>{const D=x*R,L=P[D],k=P[D+1],V=P[D+2],W=S*R,G=P[W],B=P[W+1],Z=P[W+2],M=C*R,$=P[M],N=P[M+1],j=P[M+2],J=E*R,K=P[J],te=P[J+1],ae=P[J+2];return(G-K)*(G-K)+(B-te)*(B-te)+(Z-ae)*(Z-ae)>(L-$)*(L-$)+(k-N)*(k-N)+(V-j)*(V-j)};if(s){const x=(C,E,R)=>{g[y++]=C,g[y++]=E,g[y++]=E,g[y++]=R,g[y++]=R,g[y++]=C,_o&&(Ne(C<a),Ne(E<a),Ne(R<a),Ne(y<=m))};(()=>{for(let C=Math.max(n[0],1)-1;C<Math.min(n[1],e-2)-1;++C){const E=C*_;for(let R=Math.max(i[0],1)-1;R<Math.min(i[1],e-2)-1;++R){const P=C*_+R,D=P+1,L=D+_,k=L-1,V=E+R,W=V+1,G=W+_,B=G-1,Z=t.vertexAttributes.position.typedBuffer,M=t.vertexAttributes.position.typedBufferStride;w(V,W,G,B,M,Z)?(x(P,D,L),x(L,k,P)):(x(P,D,k),x(k,L,D))}}})(),Ne(y===3*l*f),(()=>{for(let C=0;C<4;++C){const E=y;if(c[C])continue;const R=t.outerEdges[C],P=t.innerEdges[C];let D=0,L=0;const k=R.count,V=P.count;Ne(V===o-1);let W=0;const G=C===1||C===2?(B,Z,M)=>x(B,Z,M):(B,Z,M)=>x(B,M,Z);for(;D<k-1||L<V-1;){const B=P.getVertexIndex(L),Z=R.getVertexIndex(D),M=D<k-1,$=L<V-1;M&&(!$||(M?0+o*(D+.5)/(k-1):0)<=($?1+b*(L+.5)/(V-1):0))?(++D,_o&&Ne(D<k),G(B,Z,R.getVertexIndex(D)),W++):(++L,_o&&Ne(L<V),G(B,Z,P.getVertexIndex(L)),W++)}_o&&(Ne(D===k-1),Ne(L===V-1),Ne(W===k+V-2),Ne(W===o-2+R.count-1),Ne(y===E+3*W*f))}})(),Ne(y===3*(l+u)*f);const S=C=>{const E=t.outerEdges[C.connectedOuterEdgeOffset];let R=E.getVertexIndex(0),P=E.stride;for(let D=0;D<C.latitudeResolution;++D){const L=D===0?C.rowOffset:R+e;for(let k=0;k<o;k++)x(R,R+1,L+k),D<C.latitudeResolution-1&&x(R+1,L+k+1,L+k),R+=P;R=L,P=1}};r.forEach(S)}else{(()=>{const S=Math.max(n[0],1)-1,C=Math.min(n[1],e-2)-1,E=Math.max(i[0],1)-1,R=Math.min(i[1],e-2)-1;for(let P=S;P<C;++P){const D=P*_;for(let L=E;L<R;++L){const k=D+L,V=k+1,W=V+_,G=W-1,B=t.vertexAttributes.position.typedBuffer,Z=t.vertexAttributes.position.typedBufferStride;w(k,V,W,G,Z,B)?(g[y]=k,g[y+1]=V,g[y+2]=W,g[y+3]=W,g[y+4]=G,g[y+5]=k):(g[y]=k,g[y+1]=V,g[y+2]=G,g[y+3]=G,g[y+4]=V,g[y+5]=W),y+=6}}})(),Ne(y===3*l*f),(()=>{for(let S=0;S<4;++S){if(c[S])continue;const C=t.outerEdges[S],E=t.innerEdges[S];let R=0,P=0;const D=C.count,L=E.count;Ne(L===o-1);const k=S===1||S===2,V=k?1:2,W=k?2:1,G=C.index0,B=C.stride,Z=E.index0,M=E.stride;for(;R<D-1||P<L-1;){const $=Z+P*M,N=G+R*B,j=R<D-1,J=P<L-1,K=j&&(!J||(j?0+o*(R+.5)/(D-1):0)<=(J?1+b*(P+.5)/(L-1):0));K?++R:++P;const te=K?N+B:$+M;g[y]=$,g[y+V]=N,g[y+W]=te,y+=3}}})(),Ne(y===3*(l+u)*f);const x=S=>{const C=t.outerEdges[S.connectedOuterEdgeOffset];let E=C.getVertexIndex(0),R=C.stride;for(let P=0;P<S.latitudeResolution;++P){const D=P===0?S.rowOffset:E+e;for(let L=0;L<o;L++){const k=D+L;g[y]=E,g[y+1]=E+1,g[y+2]=k,P<S.latitudeResolution-1?(g[y+3]=E+1,g[y+4]=k+1,g[y+5]=k,y+=6):y+=3,E+=R}E=D,R=1}};r.forEach(x)}Ne(y===m),t.indices=g,t.indexCount=m}function _Ge(t,e){const r=t.localOrigin,i=t.geometry,n=t.geometryState.neighborData.edgeResolutions,s=i.numVerticesPerSide-2,o=i.vertexAttributes;let a=e;for(let l=0;l<4;++l){{const c=l===0||l===2,u=(l===0?s-1:0)*s+(l===1?s-1:0),h=(c?0:1)*s+(c?1:0);i.innerEdges[l]=new r2e(o,r,u,h,s)}{const c=a,u=n[l]+1;i.outerEdges[l]=new r2e(o,r,c,1,u),a+=u}}}function bGe(t,e,r){const i=(e+2)%4,n=t.geometryState,s=t.tile,o=n.neighborData,a=s.level-r.level,l=e===1||e===3,c=o.edgeResolutions[e];Ne(tE(c));const u=c+1,h=t.geometry,f=h.boundingBox,m=h.outerEdges[e],g=h.uvRange[0],y=h.uvRange[1],_=h.uvRange[2],b=h.uvRange[3],w=Te(e===1?1:0,g,_),x=Te(e===0?1:0,y,b),S=r.renderData,C=S.geometryState,E=S.geometry.outerEdges[i],R=s.getNeighborEdgeStartVertexIndex(e,r)*c,P=c*2**a;Ne(C.neighborData.edgeResolutions[i]===P),Ne(E.count-1===P);const D=S.localOrigin[0]-t.localOrigin[0],L=S.localOrigin[1]-t.localOrigin[1],k=S.localOrigin[2]-t.localOrigin[2],V=m.attributes,W=m.index0,G=m.stride,B=V.position.typedBuffer,Z=V.position.typedBufferStride,M=V.normalCompressed.typedBuffer,$=V.normalCompressed.typedBufferStride,N=V.uv0,j=E.attributes,J=E.index0,K=E.stride,te=j.position.typedBuffer,ae=j.position.typedBufferStride,be=j.normalCompressed.typedBuffer,Ee=j.normalCompressed.typedBufferStride;for(let Je=1;Je<u-1;++Je){const ze=W+G*Je,Ge=J+K*(R+Je),Le=ze*Z,de=Ge*ae,$e=te[de]+D,Be=te[de+1]+L,we=te[de+2]+k;B[Le]=$e,B[Le+1]=Be,B[Le+2]=we,Zp($e,Be,we,f);const Ie=ze*$,je=Ge*Ee;M[Ie]=be[je],M[Ie+1]=be[je+1];const fe=Je/c,Ae=l?w:Te(fe,g,_),gt=l?Te(fe,y,b):x;Qm(N,ze,Ae,gt)}}function wGe(t){var Le;const e=t.geometryState,r=e.neighborData,i=t.localOrigin,n=r.cornerNeighborData,s=t.geometry,o=s.outerEdges,a=s.boundingBox,l=t.tile,c=((Le=t.tile.surface.view)==null?void 0:Le.viewingMode)==="local",u=l.ellipsoid.radius,h=l.extentInRadians,f=l.horizontalScale;let m=0,g=0,y=0;const _=(de,$e,Be)=>{const we=h[$e===0?1:3],Ie=h[de===0?0:2],je=Math.cos(we),fe=Math.sin(we),Ae=Math.sin(Ie),gt=Math.cos(Ie),Re=u+Be;m=gt*je*Re,g=Ae*je*Re,y=fe*Re},b=c?(()=>{const de=t.geometryState.clippingArea,$e=l.extent,Be=de!=null&&($e[3]>de[3]||$e[2]>de[2]||$e[1]<de[1]||$e[0]<de[0]),we=yGe(l.surface.isWebMercatorOnPlateeCarree,l.ellipsoid.radius,f);return(Ie,je,fe)=>{const Ae=Ie===0?W[0]:W[2],gt=je===0?W[1]:W[3],Re=Be?Te(Ae,de[0],de[2]):Ae,He=Be?Te(gt,de[1],de[3]):gt,Dt=fe;m=Re*f,g=we(He),y=Dt}})():_;let w=0,x=0,S=0,C=0,E=0,R=0,P=0,D=0,L=0;const k=c&&t.tile.surface.isWebMercatorOnPlateeCarree,V=(de,$e,Be,we,Ie)=>{let je=0,fe=0,Ae=0;if(c){const gt=$e*f,Re=k?(Math.PI/2-2*Math.atan(Math.exp(-Be/u)))*u:Be*f;je=gt-m,fe=Re-g,Ae=we-y}else{const gt=tfe(de),Re=de.tile,He=Re.extent,Dt=Re.extentInRadians,Fe=($e-He[0])/(He[2]-He[0]),nt=(Be-He[1])/(He[3]-He[1]),Ke=Dt[0]*(1-Fe)+Dt[2]*Fe,mt=gt(nt),wt=Math.cos(mt),xt=Math.sin(mt),st=Math.sin(Ke),Xe=Math.cos(Ke),it=u+we;je=Xe*wt*it-m,fe=st*wt*it-g,Ae=xt*it-y}switch(Ie){case 0:P+=je,D+=fe,L+=Ae;break;case 1:C-=je,E-=fe,R-=Ae;break;case 2:P-=je,D-=fe,L-=Ae;break;case 3:C+=je,E+=fe,R+=Ae}},W=l.extent,G=e.clippingArea,B=G??rfe,Z=W[0],M=W[2],$=W[1],N=W[3],j=[N>B[3],M>B[2],$<B[1],Z<B[0]],J=Math.max(Z,B[0]),K=Math.min(M,B[2]),te=Math.max($,B[1]),ae=Math.min(N,B[3]),be=s.uvRange[0],Ee=s.uvRange[1],Je=s.uvRange[2],ze=s.uvRange[3],Ge=de=>{var gt;const $e=n[de].cornerTiles;w=0,x=0,S=1,C=0,E=0,R=0,P=0,D=0,L=0;let Be=1/0;for(let Re=0;Re<4;++Re)Be=Math.min(Be,((gt=$e[Re])==null?void 0:gt.level)??1/0);for(let Re=0;Re<4;++Re){const He=$e[Re];x$[Re]=(He==null?void 0:He.level)===Be?He:null}let we=1,Ie=0;for(let Re=0;Re<4;++Re){const He=x$[Re];He&&(we=Math.max(we,He==null?void 0:He.renderData.geometryState.numVerticesPerSide),Ie=He.extent[2]-He.extent[0])}const je=Ie,fe=we;Ne(fe>1);const Ae=je/fe;for(let Re=0;Re<4;++Re){const He=x$[(Re+3)%4],Dt=x$[Re%4];if(!He&&!Dt)continue;const Fe=Re===0?1:Re===1?2:Re===2?3:0,nt=Re===0?2:Re===1?3:Re===2?0:1;if(He&&Dt){const Ke=BZ[Re][0]*Ae,mt=BZ[Re][1]*Ae,wt=He.extent,xt=wt[Fe===0||Fe===1?2:0]+Ke,st=wt[Fe===0||Fe===3?3:1]+mt,Xe=Dt.extent,it=Xe[nt===0||nt===1?2:0]+Ke,Oe=Xe[nt===0||nt===3?3:1]+mt,Ze=He.renderData,At=Dt.renderData,_t=Ln(xt,st,Ze.geometryState.samplerData),cr=Ln(it,Oe,At.geometryState.samplerData);V(Ze,xt,st,.5*(_t+cr),Re)}else{const Ke=He??Dt,mt=He?Fe:nt,wt=Ke.extent,xt=BZ[Re],st=wt[mt===0||mt===1?2:0]+xt[0]*Ae,Xe=wt[mt===0||mt===3?3:1]+xt[1]*Ae,it=Ke.renderData,Oe=Ln(st,Xe,it.geometryState.samplerData);V(it,st,Xe,Oe,Re)}}if(!c){const Re=Math.sqrt(m*m+g*g+y*y);w=m/Re,x=g/Re,S=y/Re}if(c||S*S<.999){const Re=Math.sqrt(C*C+E*E+R*R);C/=Re,E/=Re,R/=Re;const He=Math.sqrt(P*P+D*D+L*L);P/=He,D/=He,L/=He,w=R*D-E*L,x=C*L-R*P,S=E*P-C*D;const Dt=1/Math.sqrt(w*w+x*x+S*S);w*=Dt,x*=Dt,S*=Dt}};for(let de=0;de<4;++de){const $e=de,Be=(de+1)%4,we=de===0||de===1?1:0,Ie=de===0||de===3?1:0,je=Te(we,be,Je),fe=Te(Ie,Ee,ze),Ae=o[$e],gt=de===0||de===3?Ae.count-1:0,Re=o[Be],He=de===0||de===1?Re.count-1:0,Dt=n[de].cornerTiles;let Fe=-1;for(let mt=0;mt<4;++mt){const wt=Dt[mt];wt&&(Fe===-1||d_(Dt[Fe],wt)>0)&&(Fe=mt)}const nt=Fe,Ke=Dt[nt];if(Ke!==l){const mt=l.level-Ke.level,wt=2**mt,xt=[Ke.lij[0]+mt,Ke.lij[1]*wt,Ke.lij[2]*wt],st=[xt[1]+wt===l.lij[1],de===0&&(nt===1||nt===0&&Ke!==Dt[3])||de===1&&(nt===0||nt===1&&Ke!==Dt[2]),xt[1]===l.lij[1]+1,de===2&&(nt===3||nt===2&&Ke!==Dt[1])||de===3&&(nt===2||nt===3&&Ke!==Dt[0])],Xe=st.reduce((_t,cr)=>_t+(cr?1:0),0);Ne(Xe===1||Xe===2);let it=-1,Oe=-1;const Ze=Ke.renderData;if(Xe===1){const _t=st.findIndex(pr=>pr);Ne(0<=_t&&_t<=3),it=(_t+2)%4;const cr=t.geometryState.neighborData.edgeResolutions[_t];Oe=l.getNeighborEdgeStartVertexIndex(_t,Ke)*cr+cr*(_t===0&&de===0||_t===1&&de===0||_t===2&&de===1||_t===3&&de===3?1:0)}else{Ne(st[1]||st[3]),it=st[1]?3:1;const _t=Ze.geometryState.neighborData.edgeResolutions[it];Oe=de===0||de===3?0:_t}const At=Ze.geometry.outerEdges[it];{const _t=Ae.index0+gt*Ae.stride,cr=Re.index0+He*Re.stride,pr=At.index0+Oe*At.stride;{const kr=At.attributes.position,Gr=kr.typedBuffer,Ir=pr*kr.typedBufferStride,_i=t.localOrigin,Wi=At.localOrigin,Qs=Gr[Ir]+Wi[0]-_i[0],eo=Gr[Ir+1]+Wi[1]-_i[1],to=Gr[Ir+2]+Wi[2]-_i[2];Zp(Qs,eo,to,a);{const ro=Ae.attributes.position,tn=ro.typedBuffer,rn=_t*ro.typedBufferStride;tn[rn]=Qs,tn[rn+1]=eo,tn[rn+2]=to}{const ro=Re.attributes.position,tn=ro.typedBuffer,rn=cr*ro.typedBufferStride;tn[rn]=Qs,tn[rn+1]=eo,tn[rn+2]=to}}Qm(Ae.attributes.uv0,_t,je,fe),Qm(Re.attributes.uv0,cr,je,fe);{const kr=At.attributes.normalCompressed.typedBuffer,Gr=pr*At.attributes.normalCompressed.typedBufferStride;{const Ir=Ae.attributes.normalCompressed,_i=Ir.typedBuffer,Wi=_t*Ir.typedBufferStride;_i[Wi]=kr[Gr],_i[Wi+1]=kr[Gr+1]}{const Ir=Re.attributes.normalCompressed,_i=Ir.typedBuffer,Wi=cr*Ir.typedBufferStride;_i[Wi]=kr[Gr],_i[Wi+1]=kr[Gr+1]}}}}else{const mt=j[$e],wt=j[Be];let xt;if(mt||wt){const Oe=Te(Z*(1-we)+M*we,J,K),Ze=Te($*(1-Ie)+N*Ie,te,ae),At=e.samplerData;xt=Ln(Oe,Ze,At)}else xt=nGt(Dt);b(we,Ie,xt),Ge(de);const st=m-i[0],Xe=g-i[1],it=y-i[2];Zp(st,Xe,it,a),Ae.setVertexFromValuesRawPositionUVNormal(gt,st,Xe,it,je,fe,w,x,S),Re.setVertexFromValuesRawPositionUVNormal(He,st,Xe,it,je,fe,w,x,S)}}for(let de=0;de<4;++de)x$[de]=null}function nGt(t){var s,o;const e=t.reduce((a,l)=>Math.min(a,(l==null?void 0:l.level)??1/0),1/0);_o&&(Ne(!t[0]||!t[2]||kne(t[0],t[2],Ft.SOUTH_WEST)),Ne(!t[1]||!t[3]||kne(t[1],t[3],Ft.NORTH_WEST)));let r=0,i=0;for(let a=0;a<4;++a){const l=t[a];if(l&&l.level===e){const c=a===0||a===1,u=a===0||a===3,h=l.extent,f=h[c?0:2],m=h[u?1:3],g=(o=(s=l.renderData)==null?void 0:s.geometryState)==null?void 0:o.samplerData;i+=Ln(f,m,g),r++}}const n=r?i/r:0;return Ne(n!=null),n}function pq(t){const e=t.vao,r=t.geometry.vertexAttributes.position.typedBuffer;e.vertexBuffers.geometry.setSubData(r,0,0,r.length)}const BZ=[[0,1],[1,0],[0,-1],[-1,0]],Ta=new GBt,rfe=Hce(-1/0,-1/0,1/0,1/0),x$=[null,null,null,null];function xGe(t,e,r){if(!e)return!1;const i=d_(t,e);return i>0||i===0&&r>=2}let sGt=class extends Jpe{get horizontalScale(){return this._horizontalScaleFactor}constructor(e,r,i){super(),this._horizontalScaleFactor=1,this._extentInRenderSR=lr(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const n=i.view.renderSpatialReference,s=i.spatialReference,o=n!=null&&wN(n)&&s!=null&&s.isGeographic?this.ellipsoid.radius*Math.PI/180:1;this._horizontalScaleFactor=o;const a=this.surface.isWebMercatorOnPlateeCarree,l=this._extentInRenderSR,c=this.extent;if(a){const u=Ue(c[0],c[1],0);Ys(u,dt.WebMercator,u,dt.PlateCarree);const h=Ue(c[2],c[3],0);Ys(h,dt.WebMercator,h,dt.PlateCarree),l[0]=u[0],l[1]=u[1],l[2]=h[0],l[3]=h[1]}else for(let u=0;u<4;++u)l[u]=c[u]*o;this.centerAtSeaLevel[0]=.5*(l[0]+l[2]),this.centerAtSeaLevel[1]=.5*(l[1]+l[3]),this.centerAtSeaLevel[2]=0,this._edgeLen=Math.max(l[2]-l[0],l[3]-l[1]),this._edgeLen2=this._edgeLen*this._edgeLen,this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateCenter();const e=this._extentInRenderSR,r=.5*(e[2]-e[0]),i=.5*(e[3]-e[1]),n=Math.sqrt(r*r+i*i),s=.5*(this.elevationBounds[0]-this.elevationBounds[1]),o=Math.max(n,s);this._center[Is.MIDDLE][3]=o}_calculateFrustumVisibilityStatus(e){const r=this._aabb(),i=r[0],n=r[1],s=r[2],o=r[3],a=r[4],l=r[5];let c=!0;for(let u=0;u<6;u++){const h=e[u],f=h[0],m=h[1],g=h[2],y=h[3];if(f*(f>0?i:o)+m*(m>0?n:a)+g*(g>0?s:l)+y>=0)return Cl.OUTSIDE;c=c&&f*(f<0?i:o)+m*(m<0?n:a)+g*(g<0?s:l)+y<=0}return c?Cl.INSIDE:Cl.INTERSECTS}_aabb(){const e=this._extentInRenderSR;return tbt(e[0],e[1],this.elevationBounds[0],e[2],e[3],this.elevationBounds[1])}intersectsRay(e,r,i,n){return tU[0]=1/r[0],tU[1]=1/r[1],tU[2]=1/r[2],Phe(this._aabb(),e,tU,i,n)}createGeometry(){Kjt(this.renderData,this._horizontalScaleFactor),this.setMemoryDirty()}getDefaultVerticesPerSide(){return this.level<9?3:2}updateCornerElevations(){eGt(this.renderData,this._horizontalScaleFactor)}updateEdgeElevations(){tGt(this.renderData,this._horizontalScaleFactor)}};const tU=A();let oGt=class{constructor(){this.extent=wr(),this.minLevel=0,this.maxLevel=0,this.callback=null}},Hz=class extends Ce{constructor(){super(...arguments),this._queries=new dr({initialSize:10}),this._queriesInvPtr=0,this._queryQueue=new dr({initialSize:30}),this._queryPool=new il(oGt)}queryVisibleLevelRange(e,r,i,n){const s=this._queryPool.acquire();Up(s.extent,e),s.minLevel=r??-Number.MAX_VALUE,s.maxLevel=i??Number.MAX_VALUE,s.callback=n,this._queryQueue.push(s),this.notifyChange("updating")}get updating(){return this._queryQueue.length!==0}prepare(){for(;this._queries.length<this._queries.data.length&&this._queryQueue.length>0;){const e=this._queryQueue.pop();this._queries.push(e)}this._queriesInvPtr=this._queries.length}process(){for(let e=0;e<this._queries.length;e++){const r=this._queries.data[e];this._queryPool.release(r),r.callback(e>=this._queriesInvPtr),r.callback=null}this._queries.clear(),this.notifyChange("updating")}queriesForTile(e){const r=e.level;let i=0;for(;i<this._queriesInvPtr;){const n=this._queries.data[i],s=n.extent;r>=n.minLevel&&r<=n.maxLevel&&s[0]<=e.extent[2]&&s[2]>=e.extent[0]&&s[1]<=e.extent[3]&&s[3]>=e.extent[1]?(this._queries.swapElements(i,this._queriesInvPtr-1),this._queriesInvPtr--):i++}}};d([p()],Hz.prototype,"updating",null),Hz=d([I("esri.views.3d.terrain.ScaleRangeQueries")],Hz);let aGt=class extends Jpe{get convexHull(){return this._convexHull}constructor(e,r,i){super(),this._convexHull=new Array(24),this._boundingSphere=us(),e!==void 0&&this.init(e,r,i)}init(e,r,i){super.init(e,r,i);const n=this.ellipsoid.radius,s=this.extentInRadians[0],o=this.extentInRadians[1],a=this.extentInRadians[2],l=this.extentInRadians[3],c=e[0],u=Xt(o,l,.5),h=Xt(s,a,.5),f=c===0?0:Math.min(Math.abs(o),Math.abs(l));this._edgeLen=(a-s)*Math.cos(f)*n,this._edgeLen2=this._edgeLen*this._edgeLen,this._curvatureHeight=n-Math.sqrt(n*n-this._edgeLen2/4),MDe(this.centerAtSeaLevel,h,u,this.ellipsoid.radius),Se(this.up,this.centerAtSeaLevel),this.updateRadiusAndCenter()}updateRadiusAndCenter(){this._updateBoundingVolumes();const e=this._center;if(this.lij[0]===0)se(e[Is.MIDDLE],0,0,0),se(e[Is.TOP],0,0,0),se(e[Is.BOTTOM],0,0,0),e[Is.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const r=e[Is.MIDDLE],i=this.convexHull;let n=0;for(let s=0;s<8;++s)n=Math.max(n,lGt(r,i,3*s));e[Is.MIDDLE][3]=Math.sqrt(n)}}_calculateFrustumVisibilityStatus(e){if(!bw(e,this._boundingSphere))return Cl.OUTSIDE;if(this.lij[0]<10)return Cl.INTERSECTS;const r=this.convexHull,i=this.surface.view.state.camera.near;let n=!0;for(let s=0;s<B3;s++){const o=s===Ui.NEAR,a=e[s],l=a[0],c=a[1],u=a[2],h=a[3]-(o?i:0);let f=!1;for(let m=0;m<8;++m){const g=3*m;if(l*r[g]+c*r[g+1]+u*r[g+2]+h<0){if(f=!0,!n)break}else n=!1}if(!f)return Cl.OUTSIDE}return n?Cl.INSIDE:Cl.INTERSECTS}computeElevationBounds(){super.computeElevationBounds(),this._updateBoundingVolumes()}createGeometry(){qjt(this.renderData,this._getPatchType()),this._updateBoundingVolumes(),this.setMemoryDirty()}_updateBoundingVolumes(){this._updateConvexHull(),this._updateBoundingSphere(),_o&&this._checkBVs()}_updateBoundingSphere(){const e=this._boundingSphere,r=e,i=this.elevationBounds,n=this.ellipsoid.radius,s=i[1];if(this.level===0)se(r,0,0,0),e[3]=n+s;else{const o=this.extentInRadians,a=.5*(o[0]+o[2]),l=o[1],c=o[3];vS(g2e,a,l,n),vS(y2e,a,c,n),ge(r,g2e,y2e);const u=.5*(i[0]+i[1]);ce(r,r,(n+u)/ju(r));const h=this.convexHull;let f=0;const m=(y,_)=>{const b=y[0]-h[3*_],w=y[1]-h[3*_+1],x=y[2]-h[3*_+2];return Math.sqrt(b*b+w*w+x*x)};for(let y=0;y<8;++y){const _=m(r,y);f=Math.max(f,_)}const g=f;e[3]=g+2}}_updateConvexHull(){const e=this.extentInRadians,r=this.ellipsoid.radius;if(this.level===0)return;const i=this.elevationBounds,n=this._getPatchType(),s=this.surface.isWebMercator,o=s&&n===Pp.HAS_NORTH_POLE,a=s&&n===Pp.HAS_SOUTH_POLE,l=a||o,c=Math.PI/2,u=e[0],h=e[2],f=a?-c:e[1],m=o?c:e[3],g=.5*(u+h),y=i[0],_=r+(l?Math.min(0,y-1):y),b=(Z,M,$)=>vS(Z,M,$,_),w=A(),x=A(),S=A(),C=A();b(w,u,f),b(x,u,m),b(S,h,m),b(C,h,f);const E=(Z,M)=>{for(let $=0;$<3;++$)this._convexHull[3*M+$]=Z[$]};E(w,0),E(x,1),E(S,2),E(C,3);const R=i[1],P=r+(l?Math.max(0,R+1):R),D=A(),L=A(),k=A();vS(L,g,m,_),vS(k,g,f,_),ge(D,L,k),Se(D,D);const V=A(),W=A(),G=(Z,M)=>{Gi(W,Z,M),Se(W,W);const $=-ye(Z,V)/ye(W,V);Ne($>=0),ce(W,W,$),ge(Z,Z,W)};if(2**this.lij[0]>2*this.lij[1]){const Z=k,M=A();Lt(M,m2e,Z),Se(M,M),Lt(V,Z,M),Se(V,V),Ne($p(ye(V,Z)/ju(Z),0)),G(w,x),G(C,S),E(w,0),E(C,3)}else if(2**this.lij[0]!==2*this.lij[1]){const Z=L,M=A();Lt(M,m2e,Z),Se(M,M),Lt(V,M,Z),Se(V,V),G(x,w),G(S,C),E(x,1),E(S,2)}const B=(Z,M)=>{const $=P/ye(M,D);for(let N=0;N<3;++N)this._convexHull[3*Z+N]=M[N]*$};B(4,w),B(5,x),B(6,S),B(7,C)}_getPatchType(){const e=this.lij[1],r=e===0,i=e===(1<<this.level)-1;return r?i?Pp.HAS_BOTH_POLES:Pp.HAS_NORTH_POLE:i?Pp.HAS_SOUTH_POLE:Pp.REGULAR}intersectsRay(e,r,i,n){const s=this._boundingSphere,o=s[3]+i,a=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=s[0]-e[0],c=s[1]-e[1],u=s[2]-e[2],h=(l*r[0]+c*r[1]+u*r[2])/a,f=r[0]*h-l,m=r[1]*h-c,g=r[2]*h-u;return f*f+m*m+g*g<o*o}getDefaultVerticesPerSide(){return this.level<f2e.length?f2e[this.level]+1:2}updateCornerElevations(){Yjt(this.renderData),this._updateBoundingVolumes()}updateEdgeElevations(){Xjt(this.renderData),this._updateBoundingVolumes()}_checkBVs(){var Be;if(!_o||this.level<=2)return;const e=this._boundingSphere,r=e[3],i=e,n=A(),s=this.ellipsoid.radius,o=this.elevationBounds;o[1],o[0];const a=s+o[0],l=1,c=0,u=this._center[Is.MIDDLE][3],h=this.convexHull,f=(we,Ie)=>{for(let je=0;je<3;++je)we[je]=h[3*Ie+je]};{const we=A(),Ie=A(),je=A(),fe=A(),Ae=A(),gt=(Re,He,Dt,Fe)=>{f(Ie,Re),f(je,He),f(fe,Dt),Gi(Ie,Ie,je),Gi(fe,fe,je),Lt(we,Ie,fe),Se(we,we);const nt=ye(we,je);f(Ae,Fe);const Ke=ye(we,Ae),mt=Math.abs(Ke-nt);Ne($p(mt,0),`Non coplanar ${Re},${He},${Dt},${Fe} diff = ${mt}`)};gt(0,1,2,3),gt(4,5,6,7),gt(0,1,4,5),gt(1,2,5,6),gt(2,3,6,7),gt(3,0,7,4)}const m=sl(24),g=(we,Ie,je)=>{const fe=4*we;for(let Ae=0;Ae<3;++Ae)m[fe+Ae]=Ie[Ae];m[fe+3]=je},y=A(),_=A(),b=A(),w=A(),x=(we,Ie,je,fe)=>{f(y,Ie),f(_,je),f(b,fe),Gi(y,y,_),Se(y,y),Gi(b,b,_),Se(b,b),Lt(w,y,b),Se(w,w);const Ae=ye(w,_);g(we,w,Ae)};x(0,0,1,2),x(1,1,0,4),x(2,1,5,2),x(3,3,2,6),x(4,4,0,3),x(5,4,6,5);const S=1,C=(we,Ie,je,fe)=>{const Ae=4*we;return m[Ae]*Ie+m[Ae+1]*je+m[Ae+2]*fe-m[Ae+3]},E=(we,Ie,je,fe)=>C(we,Ie,je,fe)>=-S,R=(we,Ie)=>E(we,Ie[0],Ie[1],Ie[2]),P=2**this.lij[0]>2*this.lij[1],D=(we,Ie,je)=>Math.sqrt(SGe(we,Ie,je,i[0],i[1],i[2]))<r,L=we=>D(we[0],we[1],we[2]),k=(we,Ie)=>D(we[Ie],we[Ie+1],we[Ie+2]),V=this.extentInRadians,W=.5*(V[0]+V[2]),G=V[1],B=V[3],Z=A(),M=A();vS(Z,W,B,a),vS(M,W,G,a);const $=P?"Upper":"Lower";let N=!0;for(let we=0;we<6;++we){for(let Ie=0;Ie<8;++Ie){const je=3*Ie,fe=E(we,h[je],h[je+1],h[je+2]);N&&(N=fe),Ne(fe,`Tile[${this.lij}] Convex hull point ${Ie} outside of plane ${we}`)}Ne(R(we,M),`Tile[${this.lij}] (${$}) bottom mid outside of plane ${we}`),Ne(R(we,Z),`Tile[${this.lij}] (${$}) top mid outside of plane ${we}`)}Ne(N,"Not all convex hull points are inside  convex hull polyhedron"),Ne(L(M),`Tile[${this.lij}] (${$}) bottom mid outside of bounding sphere`),Ne(L(Z),`Tile[${this.lij}] (${$}) top mid outside of bounding sphere`);for(let we=0;we<8;++we){const Ie=k(h,3*we);Ne(Ie,`Tile[${this.lij}] Convex hull point ${we} outside of bounding sphere`)}for(let we=0;we<6;++we)for(let Ie=0;Ie<8;++Ie){const je=3*Ie;E(we,h[je],h[je+1],h[je+2])||console.error(`Tile[${this.lij}] Convex hull point ${Ie} outside of plane ${we}`)}const j=this.extentInRadians,J=Math.max(j[2]-j[0],j[3]-j[1]),K=Math.round(J*s),te=this.renderData;if(!te)return;const{geometry:ae,localOrigin:be}=te,Ee=(Be=ae.vertexAttributes)==null?void 0:Be.position;if(!Ee)return;const Je=Ee.count,ze=A(),Ge=ae.numVerticesPerSide-2,Le=Ge*Ge,de=te.geometryState.neighborData,$e=de.edgeResolutions.reduce((we,Ie)=>we+Ie+1,0);for(let we=0;we<Je;++we){const Ie=we<Le,je=!Ie&&we<Le+$e;let fe=!1,Ae=-1;if(je){let it=Le;for(let Oe=0;Oe<4;++Oe){const Ze=de.edgeResolutions[Oe];if(we===it||we===it+Ze-1){fe=!0;break}if(it+=Ze,we<it){Ae=Oe;break}}}const gt=je?de.edgePeerNeighbors[Ae]:null,Re=je&&gt&&d_(this,gt)>0;Ee.getVec(we,n),ge(ze,n,be);const He=ju(ze)-s;let Dt=0,Fe=!1;const nt=o[0]-He,Ke=He-o[1],mt=nt>l,wt=Ke>l,xt=mt||wt,st=()=>{const it=Ie?"internal":je&&!fe?"edge":fe?"corner":"pole";return`Tile[${this.lij}].vertex[${we}]:${it}`+(mt?"(below)":wt?"(above)":"")+(Re?"(Neighbor)":"")},Xe=W4(ze,i);if(Xe>=r+c){const it=Xe-r;xt||(console.error(`${st()} is out of the bounding sphere by ${it.toFixed(0)} / ${r.toFixed(0)}[tol=${c}] h=${He.toFixed(0)} / [${o[0].toFixed(0)}..${o[1].toFixed(0)}] (${(it/r).toFixed(0)})`),Fe=!0)}for(let it=0;it<6;++it)if(!E(it,ze[0],ze[1],ze[2])){const Oe=C(it,ze[0],ze[1],ze[2]),Ze=we%Ge,At=(we-Ze)/Ge;it===0&&nt||it===5&&Ke||(console.error(`${st()} (${Ze},${At})|${Ge}] is out of the bounding trapezoid plane ${it} h=${Math.round(He)} / [${Math.round(o[0])}..${Math.round(o[1])}] dist=${Math.round(Oe)} radii = ${Math.round(r)}/${Math.round(u)}} : maxL = ${K}`),++Dt)}if(Fe||Dt>0)break}}};const f2e=[128,64,64,32,16,8,8,4];function lGt(t,e,r){return SGe(t[0],t[1],t[2],e[r],e[r+1],e[r+2])}function SGe(t,e,r,i,n,s){const o=i-t,a=n-e,l=s-r;return o*o+a*a+l*l}const vS=(t,e,r,i)=>{const n=Math.cos(e),s=Math.sin(e),o=Math.cos(r),a=Math.sin(r);t[0]=i*o*n,t[1]=i*o*s,t[2]=i*a},m2e=[0,0,1],g2e=A(),y2e=A();let rm=class extends Ce{constructor(){super(...arguments),this.fovX=0,this.fovY=0,this.relativeWidthLimit=0,this.relativeHeightLimit=0,this.maxLod=0,this.angledSplitBias=0,this.aboveGround=!0}};d([p()],rm.prototype,"fovX",void 0),d([p()],rm.prototype,"fovY",void 0),d([p()],rm.prototype,"relativeWidthLimit",void 0),d([p()],rm.prototype,"relativeHeightLimit",void 0),d([p()],rm.prototype,"maxLod",void 0),d([p()],rm.prototype,"angledSplitBias",void 0),d([p()],rm.prototype,"aboveGround",void 0),d([p()],rm.prototype,"frustum",void 0),rm=d([I("esri.views.3d.terrain.SplitLimits")],rm);let TGe=class extends jl{constructor(){super(...arguments),this.blendMode=et.Normal}};d([X({count:et.COUNT})],TGe.prototype,"blendMode",void 0);let kD=class extends TGe{constructor(){super(...arguments),this.output=Do.Composite,this.baseOpacityMode=jm.NotRequired,this.premultipliedSource=xm.Off}};d([X({count:Do.COUNT})],kD.prototype,"output",void 0),d([X({count:jm.COUNT})],kD.prototype,"baseOpacityMode",void 0),d([X()],kD.prototype,"premultipliedSource",void 0);var xE;function cGt(t){const e=new jr;if(e.include(iGe),t.background===xE.Only){const r=t.output===Do.ColorComposite;return r?e.fragment.uniforms.add(new ar("backgroundColor",i=>i.backgroundColor)):e.fragment.include(Zpe),e.fragment.code.add(T`
    void main() {
      fragColor = vec4(${r?T`backgroundColor`:T`gridColor(uv)`}, 1.0);
    }
  `),e}return e.include(nGe,t),e.fragment.uniforms.add(new Mt("tex",r=>r.texture)),e.fragment.uniforms.add(new Ye("opacity",r=>r.opacity)),e.fragment.code.add(T`void main() {
vec4 bgColor = getBackground(uv);
fragColor = blendLayers(bgColor, texture(tex, uv), opacity);
}`),e}(function(t){t[t.BelowLayer=0]="BelowLayer",t[t.Only=1]="Only",t[t.COUNT=2]="COUNT"})(xE||(xE={}));const uGt=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return xE},build:cGt},Symbol.toStringTag,{value:"Module"}));let dGt=class extends rGe{constructor(){super(...arguments),this.opacity=1,this.baseOpacity=1,this.texture=null,this.fboTexture=null,this.backgroundColor=Sc}},EGe=class CGe extends si{initializeProgram(e){return new Kr(e.rctx,CGe.shader.get().build(this.configuration),Br)}initializePipeline(){return Qt({blending:Ed(De.ONE,De.ONE_MINUS_SRC_ALPHA),colorWrite:hr})}};EGe.shader=new Jr(uGt,()=>le(()=>import("./BlendLayers.glsl-dcc803c3.js"),[]));let RGe=class extends kD{constructor(){super(...arguments),this.background=xE.BelowLayer}};d([X()],RGe.prototype,"background",void 0);let jZ=class{constructor(e,r,i,n,s,o){this.texture=e,this.type=r,e.retain(),this.offsetAndScale=nr(i.offset[0],i.offset[1],i.scale,i.scale),this.opacities=Ue(n,s,o)}destroy(){this.texture.release()}};function hGt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function pGt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function fGt(t,e,r,i,n,s,o){return t[0]=e,t[1]=r,t[2]=i,t[3]=n,t[4]=s,t[5]=o,t}function OGe(t,e){const r=e[0],i=e[1],n=e[2],s=e[3],o=e[4],a=e[5];let l=r*s-i*n;return l?(l=1/l,t[0]=s*l,t[1]=-i*l,t[2]=-n*l,t[3]=r*l,t[4]=(n*a-s*o)*l,t[5]=(i*o-r*a)*l,t):null}function mGt(t){return t[0]*t[3]-t[1]*t[2]}function AGe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1],h=r[2],f=r[3],m=r[4],g=r[5];return t[0]=i*c+s*u,t[1]=n*c+o*u,t[2]=i*h+s*f,t[3]=n*h+o*f,t[4]=i*m+s*g+a,t[5]=n*m+o*g+l,t}function ife(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=Math.sin(r),u=Math.cos(r);return t[0]=i*u+s*c,t[1]=n*u+o*c,t[2]=i*-c+s*u,t[3]=n*-c+o*u,t[4]=a,t[5]=l,t}function PGe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i*c,t[1]=n*c,t[2]=s*u,t[3]=o*u,t[4]=a,t[5]=l,t}function nfe(t,e,r){const i=e[0],n=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1];return t[0]=i,t[1]=n,t[2]=s,t[3]=o,t[4]=i*c+s*u+a,t[5]=n*c+o*u+l,t}function gGt(t,e){const r=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=r,t[2]=-r,t[3]=i,t[4]=0,t[5]=0,t}function yGt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function sfe(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function vGt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function _Gt(t){return Math.sqrt(t[0]**2+t[1]**2+t[2]**2+t[3]**2+t[4]**2+t[5]**2+1)}function bGt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function MGe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function wGt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function xGt(t,e,r,i){return t[0]=e[0]+r[0]*i,t[1]=e[1]+r[1]*i,t[2]=e[2]+r[2]*i,t[3]=e[3]+r[3]*i,t[4]=e[4]+r[4]*i,t[5]=e[5]+r[5]*i,t}function SGt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function TGt(t,e){const r=t[0],i=t[1],n=t[2],s=t[3],o=t[4],a=t[5],l=e[0],c=e[1],u=e[2],h=e[3],f=e[4],m=e[5],g=Bl();return Math.abs(r-l)<=g*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(i-c)<=g*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-u)<=g*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(s-h)<=g*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-f)<=g*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(a-m)<=g*Math.max(1,Math.abs(a),Math.abs(m))}const EGt=AGe,CGt=MGe;Object.freeze(Object.defineProperty({__proto__:null,add:bGt,copy:hGt,determinant:mGt,equals:TGt,exactEquals:SGt,frob:_Gt,fromRotation:gGt,fromScaling:yGt,fromTranslation:sfe,identity:pGt,invert:OGe,mul:EGt,multiply:AGe,multiplyScalar:wGt,multiplyScalarAndAdd:xGt,rotate:ife,scale:PGe,set:fGt,str:vGt,sub:CGt,subtract:MGe,translate:nfe},Symbol.toStringTag,{value:"Module"}));function $Ge(){const t=new Float32Array(6);return t[0]=1,t[3]=1,t}function RGt(t){const e=new Float32Array(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function OGt(t,e,r,i,n,s){const o=new Float32Array(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=i,o[4]=n,o[5]=s,o}function AGt(t,e){return new Float32Array(t,e,6)}function IGe(t,e,r,i){const n=e[i],s=e[i+1];t[i]=r[0]*n+r[2]*s+r[4],t[i+1]=r[1]*n+r[3]*s+r[5]}function PGt(t,e,r,i=0,n=0,s=2){const o=n||e.length/s;for(let a=i;a<o;a++)IGe(t,e,r,a*s)}Object.freeze(Object.defineProperty({__proto__:null,clone:RGt,create:$Ge,createView:AGt,fromValues:OGt,transform:IGe,transformMany:PGt},Symbol.toStringTag,{value:"Module"}));function qz(){return[1,0,0,1,0,0]}function MGt(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function $Gt(t,e,r,i,n,s){return[t,e,r,i,n,s]}function IGt(t,e){return new Float64Array(t,e,6)}Object.freeze(Object.defineProperty({__proto__:null,clone:MGt,create:qz,createView:IGt,fromValues:$Gt},Symbol.toStringTag,{value:"Module"}));function LGt(t){return t instanceof Float32Array&&t.length>=2}function DGt(t){return Array.isArray(t)&&t.length>=2}function GZ(t){return LGt(t)||DGt(t)}const NGt=96,FGt=39.37;function ofe(t,e){return e.type?Or(t,e.x,e.y):Eo(t,e)}function kGt(t){return Pc(t)}function UGt(t,e){const r=t.targetGeometry,i=e.targetGeometry;return r.x=i.x,r.y=i.y,r.spatialReference=i.spatialReference,t.scale=e.scale,t.rotation=e.rotation,t}const zGt=function(){const t=Qe();return function(e,r,i){const n=r.targetGeometry;ofe(t,n);const s=.5*fq(r);return e.xmin=t[0]-s*i[0],e.ymin=t[1]-s*i[1],e.xmax=t[0]+s*i[0],e.ymax=t[1]+s*i[1],e.spatialReference=n.spatialReference,e}}();function fq(t){return t.scale*VGt(t.targetGeometry)}function VGt(t){return t!=null&&$l(t.spatialReference)?1/(kGt(t.spatialReference)*FGt*NGt):1}function BGt(t){return w7(t.rotation)||0}const afe=function(){const t=Qe(),e=Qe(),r=Qe();return function(i,n,s,o,a,l){return Nde(t,n),eu(e,s,.5*l),Or(r,1/o*l,-1/o*l),sfe(i,e),a&&ife(i,i,a),PGe(i,i,r),nfe(i,i,t),i}}(),jGt=function(){const t=Qe();return function(e,r,i,n){const s=fq(r),o=BGt(r);return ofe(t,r.targetGeometry),afe(e,t,i,s,o,n)}}(),GGt=function(){const t=Qe();return function(e,r,i,n){const s=fq(r);return ofe(t,r.targetGeometry),afe(e,t,i,s,0,n)}}();function HGt(t){const e=Dw(t);return e?e.valid[1]-e.valid[0]:0}function qGt(t,e){return Math.round(HGt(t)/e)}var zne;const W0=[0,0];let xb=zne=class extends me{constructor(t){super(t),this._viewpoint2D={center:Qe(),rotation:0,scale:0,spatialReference:void 0},this.center=[0,0],this.extent=new $r,this.id=0,this.inverseTransform=qz(),this.resolution=0,this.rotation=0,this.scale=0,this.transform=qz(),this.transformNoRotation=qz(),this.displayMat3=uu(),this.displayViewMat3=uu(),this.viewMat3=uu(),this.viewMat2d=$Ge(),this.worldScreenWidth=0,this.size=[0,0]}set pixelRatio(t){this._set("pixelRatio",t),this._update()}set size(t){this._set("size",t),this._update()}set viewpoint(t){if(t){const e=this._viewpoint2D,r=t.targetGeometry;e.center[0]=r.x,e.center[1]=r.y,e.rotation=t.rotation,e.scale=t.scale,e.spatialReference=r.spatialReference}this._update()}copy(t){const e=this.size,r=this.viewpoint;return r&&e?(this.viewpoint=UGt(r,t.viewpoint),this._set("size",Eo(e,t.size))):(this.viewpoint=t.viewpoint.clone(),this._set("size",[t.size[0],t.size[1]])),this._set("pixelRatio",t.pixelRatio),this}clone(){return new zne({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})}toMap(t,e,r){return GZ(e)?ZS(t,e,this.inverseTransform):(W0[0]=e,W0[1]=r,ZS(t,W0,this.inverseTransform))}toScreen(t,e,r){return GZ(e)?ZS(t,e,this.transform):(W0[0]=e,W0[1]=r,ZS(t,W0,this.transform))}toScreenNoRotation(t,e,r){return GZ(e)?ZS(t,e,this.transformNoRotation):(W0[0]=e,W0[1]=r,ZS(t,W0,this.transformNoRotation))}getScreenTransform(t,e){const{center:r}=this._viewpoint2D,i=this._get("pixelRatio")||1,n=this._get("size");return afe(t,r,n,e,0,i),t}_update(){const{center:t,spatialReference:e,scale:r,rotation:i}=this._viewpoint2D,n=this._get("pixelRatio")||1,s=this._get("size"),o=new Sd({targetGeometry:new Gt(t[0],t[1],e),scale:r,rotation:i});if(this._set("viewpoint",o),!s||!e||!r)return;this.resolution=fq(o),this.rotation=i,this.scale=r,this.spatialReference=e,Eo(this.center,t);const a=s[0]!==0?2/s[0]:0,l=s[1]!==0?-2/s[1]:0;Yue(this.displayMat3,a,0,0,0,l,0,-1,1,1);const c=Zue(this.viewMat3),u=Mp(s[0]/2,s[1]/2),h=Mp(-s[0]/2,-s[1]/2),f=w7(i);sB(c,c,u),Jue(c,c,f),sB(c,c,h),$P(this.displayViewMat3,this.displayMat3,c);const m=sfe(this.viewMat2d,u);return ife(m,m,f),nfe(m,m,h),zGt(this.extent,o,s),jGt(this.transform,o,s,n),OGe(this.inverseTransform,this.transform),GGt(this.transformNoRotation,o,s,n),this.worldScreenWidth=qGt(this.spatialReference,this.resolution),this._set("id",this.id+1),this}};d([p({readOnly:!0})],xb.prototype,"id",void 0),d([p({value:1,json:{write:!0}})],xb.prototype,"pixelRatio",null),d([p({json:{write:!0}})],xb.prototype,"size",null),d([p()],xb.prototype,"spatialReference",void 0),d([p({type:Sd,json:{write:!0}})],xb.prototype,"viewpoint",null),xb=zne=d([I("esri.views.2d.ViewState")],xb);const WGt=xb;var Vne,Bne,v2e,_2e,b2e,w2e,x2e,S2e,T2e,E2e,C2e,R2e,O2e,A2e,P2e,M2e,$2e,I2e,L2e,D2e,N2e,F2e,k2e,U2e,z2e,V2e,B2e,j2e,G2e,H2e,q2e,W2e,X2e,Y2e,Z2e,J2e,K2e,Q2e,eEe,tEe,rEe,iEe,nEe,sEe,oEe,aEe,lEe,cEe,uEe,dEe,hEe,pEe,fEe,mEe,gEe,yEe,vEe,_Ee,bEe,wEe,xEe;(function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE",t[t.UNKNOWN=4]="UNKNOWN"})(Vne||(Vne={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER",t[t.UNKNOWN=4]="UNKNOWN"}(Bne||(Bne={})),function(t){t[t.SCREEN=0]="SCREEN",t[t.MAP=1]="MAP"}(v2e||(v2e={})),function(t){t[t.Tint=0]="Tint",t[t.Ignore=1]="Ignore",t[t.Multiply=99]="Multiply"}(_2e||(_2e={})),function(t){t.Both="Both",t.JustBegin="JustBegin",t.JustEnd="JustEnd",t.None="None"}(b2e||(b2e={})),function(t){t[t.Mosaic=0]="Mosaic",t[t.Centered=1]="Centered"}(w2e||(w2e={})),function(t){t[t.Normal=0]="Normal",t[t.Superscript=1]="Superscript",t[t.Subscript=2]="Subscript"}(x2e||(x2e={})),function(t){t[t.MSSymbol=0]="MSSymbol",t[t.Unicode=1]="Unicode"}(S2e||(S2e={})),function(t){t[t.Unspecified=0]="Unspecified",t[t.TrueType=1]="TrueType",t[t.PSOpenType=2]="PSOpenType",t[t.TTOpenType=3]="TTOpenType",t[t.Type1=4]="Type1"}(T2e||(T2e={})),function(t){t[t.Display=0]="Display",t[t.Map=1]="Map"}(E2e||(E2e={})),function(t){t.None="None",t.Loop="Loop",t.Oscillate="Oscillate"}(C2e||(C2e={})),function(t){t[t.Z=0]="Z",t[t.X=1]="X",t[t.Y=2]="Y"}(R2e||(R2e={})),function(t){t[t.XYZ=0]="XYZ",t[t.ZXY=1]="ZXY",t[t.YXZ=2]="YXZ"}(O2e||(O2e={})),function(t){t[t.Rectangle=0]="Rectangle",t[t.RoundedRectangle=1]="RoundedRectangle",t[t.Oval=2]="Oval"}(A2e||(A2e={})),function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Screen=2]="Screen",t[t.Multiply=3]="Multiply",t[t.Add=4]="Add"}(P2e||(P2e={})),function(t){t[t.TTB=0]="TTB",t[t.RTL=1]="RTL",t[t.BTT=2]="BTT"}(M2e||(M2e={})),function(t){t[t.None=0]="None",t[t.SignPost=1]="SignPost",t[t.FaceNearPlane=2]="FaceNearPlane"}($2e||($2e={})),function(t){t[t.Float=0]="Float",t[t.String=1]="String",t[t.Boolean=2]="Boolean"}(I2e||(I2e={})),function(t){t[t.Intersect=0]="Intersect",t[t.Subtract=1]="Subtract"}(L2e||(L2e={})),function(t){t.OpenEnded="OpenEnded",t.Block="Block",t.Crossed="Crossed"}(D2e||(D2e={})),function(t){t.FullGeometry="FullGeometry",t.PerpendicularFromFirstSegment="PerpendicularFromFirstSegment",t.ReversedFirstSegment="ReversedFirstSegment",t.PerpendicularToSecondSegment="PerpendicularToSecondSegment",t.SecondSegmentWithTicks="SecondSegmentWithTicks",t.DoublePerpendicular="DoublePerpendicular",t.OppositeToFirstSegment="OppositeToFirstSegment",t.TriplePerpendicular="TriplePerpendicular",t.HalfCircleFirstSegment="HalfCircleFirstSegment",t.HalfCircleSecondSegment="HalfCircleSecondSegment",t.HalfCircleExtended="HalfCircleExtended",t.OpenCircle="OpenCircle",t.CoverageEdgesWithTicks="CoverageEdgesWithTicks",t.GapExtentWithDoubleTicks="GapExtentWithDoubleTicks",t.GapExtentMidline="GapExtentMidline",t.Chevron="Chevron",t.PerpendicularWithArc="PerpendicularWithArc",t.ClosedHalfCircle="ClosedHalfCircle",t.TripleParallelExtended="TripleParallelExtended",t.ParallelWithTicks="ParallelWithTicks",t.Parallel="Parallel",t.PerpendicularToFirstSegment="PerpendicularToFirstSegment",t.ParallelOffset="ParallelOffset",t.OffsetOpposite="OffsetOpposite",t.OffsetSame="OffsetSame",t.CircleWithArc="CircleWithArc",t.DoubleJog="DoubleJog",t.PerpendicularOffset="PerpendicularOffset",t.LineExcludingLastSegment="LineExcludingLastSegment",t.MultivertexArrow="MultivertexArrow",t.CrossedArrow="CrossedArrow",t.ChevronArrow="ChevronArrow",t.ChevronArrowOffset="ChevronArrowOffset",t.PartialFirstSegment="PartialFirstSegment",t.Arch="Arch",t.CurvedParallelTicks="CurvedParallelTicks",t.Arc90Degrees="Arc90Degrees"}(N2e||(N2e={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square",t.TrueBuffer="TrueBuffer"}(F2e||(F2e={})),function(t){t.ClosePath="ClosePath",t.ConvexHull="ConvexHull",t.RectangularBox="RectangularBox"}(k2e||(k2e={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(U2e||(U2e={})),function(t){t.Mitered="Mitered",t.Bevelled="Bevelled",t.Rounded="Rounded",t.Square="Square"}(z2e||(z2e={})),function(t){t.Fast="Fast",t.Accurate="Accurate"}(V2e||(V2e={})),function(t){t.BeginningOfLine="BeginningOfLine",t.EndOfLine="EndOfLine"}(B2e||(B2e={})),function(t){t.Sinus="Sinus",t.Square="Square",t.Triangle="Triangle",t.Random="Random"}(j2e||(j2e={})),function(t){t[t.None=0]="None",t[t.Default=1]="Default",t[t.Force=2]="Force"}(G2e||(G2e={})),function(t){t[t.Buffered=0]="Buffered",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.AlongLine=3]="AlongLine"}(H2e||(H2e={})),function(t){t[t.Linear=0]="Linear",t[t.Rectangular=1]="Rectangular",t[t.Circular=2]="Circular",t[t.Buffered=3]="Buffered"}(q2e||(q2e={})),function(t){t[t.Discrete=0]="Discrete",t[t.Continuous=1]="Continuous"}(W2e||(W2e={})),function(t){t[t.AcrossLine=0]="AcrossLine",t[t.AloneLine=1]="AloneLine"}(X2e||(X2e={})),function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Center=2]="Center",t[t.Justify=3]="Justify"}(Y2e||(Y2e={})),function(t){t[t.Base=0]="Base",t[t.MidPoint=1]="MidPoint",t[t.ThreePoint=2]="ThreePoint",t[t.FourPoint=3]="FourPoint",t[t.Underline=4]="Underline",t[t.CircularCW=5]="CircularCW",t[t.CircularCCW=6]="CircularCCW"}(Z2e||(Z2e={})),function(t){t.Butt="Butt",t.Round="Round",t.Square="Square"}(J2e||(J2e={})),function(t){t.NoConstraint="NoConstraint",t.HalfPattern="HalfPattern",t.HalfGap="HalfGap",t.FullPattern="FullPattern",t.FullGap="FullGap",t.Custom="Custom"}(K2e||(K2e={})),function(t){t[t.None=-1]="None",t[t.Custom=0]="Custom",t[t.Circle=1]="Circle",t[t.OpenArrow=2]="OpenArrow",t[t.ClosedArrow=3]="ClosedArrow",t[t.Diamond=4]="Diamond"}(Q2e||(Q2e={})),function(t){t[t.ExtraLeading=0]="ExtraLeading",t[t.Multiple=1]="Multiple",t[t.Exact=2]="Exact"}(eEe||(eEe={})),function(t){t.Bevel="Bevel",t.Round="Round",t.Miter="Miter"}(tEe||(tEe={})),function(t){t[t.Default=0]="Default",t[t.String=1]="String",t[t.Numeric=2]="Numeric"}(rEe||(rEe={})),function(t){t[t.InsidePolygon=0]="InsidePolygon",t[t.PolygonCenter=1]="PolygonCenter",t[t.RandomlyInsidePolygon=2]="RandomlyInsidePolygon"}(iEe||(iEe={})),function(t){t[t.Tint=0]="Tint",t[t.Replace=1]="Replace",t[t.Multiply=2]="Multiply"}(nEe||(nEe={})),function(t){t[t.ClipAtBoundary=0]="ClipAtBoundary",t[t.RemoveIfCenterOutsideBoundary=1]="RemoveIfCenterOutsideBoundary",t[t.DoNotTouchBoundary=2]="DoNotTouchBoundary",t[t.DoNotClip=3]="DoNotClip"}(sEe||(sEe={})),function(t){t.NoConstraint="NoConstraint",t.WithMarkers="WithMarkers",t.WithFullGap="WithFullGap",t.WithHalfGap="WithHalfGap",t.Custom="Custom"}(oEe||(oEe={})),function(t){t.Fixed="Fixed",t.Random="Random",t.RandomFixedQuantity="RandomFixedQuantity"}(aEe||(aEe={})),function(t){t.LineMiddle="LineMiddle",t.LineBeginning="LineBeginning",t.LineEnd="LineEnd",t.SegmentMidpoint="SegmentMidpoint"}(lEe||(lEe={})),function(t){t.OnPolygon="OnPolygon",t.CenterOfMass="CenterOfMass",t.BoundingBoxCenter="BoundingBoxCenter"}(cEe||(cEe={})),function(t){t[t.Low=0]="Low",t[t.Medium=1]="Medium",t[t.High=2]="High"}(uEe||(uEe={})),function(t){t[t.MarkerCenter=0]="MarkerCenter",t[t.MarkerBounds=1]="MarkerBounds"}(dEe||(dEe={})),function(t){t[t.None=0]="None",t[t.PropUniform=1]="PropUniform",t[t.PropNonuniform=2]="PropNonuniform",t[t.DifUniform=3]="DifUniform",t[t.DifNonuniform=4]="DifNonuniform"}(hEe||(hEe={})),function(t){t.Tube="Tube",t.Strip="Strip",t.Wall="Wall"}(pEe||(pEe={})),function(t){t[t.Random=0]="Random",t[t.Increasing=1]="Increasing",t[t.Decreasing=2]="Decreasing",t[t.IncreasingThenDecreasing=3]="IncreasingThenDecreasing"}(fEe||(fEe={})),function(t){t[t.Relative=0]="Relative",t[t.Absolute=1]="Absolute"}(mEe||(mEe={})),function(t){t[t.Normal=0]="Normal",t[t.LowerCase=1]="LowerCase",t[t.Allcaps=2]="Allcaps"}(gEe||(gEe={})),function(t){t[t.LTR=0]="LTR",t[t.RTL=1]="RTL"}(yEe||(yEe={})),function(t){t.Draft="Draft",t.Picture="Picture",t.Text="Text"}(vEe||(vEe={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Baseline=2]="Baseline",t[t.Bottom=3]="Bottom"}(_Ee||(_Ee={})),function(t){t[t.Right=0]="Right",t[t.Upright=1]="Upright"}(bEe||(bEe={})),function(t){t[t.Small=0]="Small",t[t.Medium=1]="Medium",t[t.Large=2]="Large"}(wEe||(wEe={})),function(t){t[t.Calm=0]="Calm",t[t.Rippled=1]="Rippled",t[t.Slight=2]="Slight",t[t.Moderate=3]="Moderate"}(xEe||(xEe={}));var jne,HT,Gne,bj,Hne,wj,qne,qT,Wne;(function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"})(jne||(jne={})),function(t){t[t.VISIBLE=0]="VISIBLE",t[t.NONE=1]="NONE"}(HT||(HT={})),function(t){t[t.POINT=0]="POINT",t[t.LINE=1]="LINE",t[t.LINE_CENTER=2]="LINE_CENTER"}(Gne||(Gne={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT",t[t.AUTO=2]="AUTO"}(bj||(bj={})),function(t){t[t.AUTO=0]="AUTO",t[t.LEFT=1]="LEFT",t[t.CENTER=2]="CENTER",t[t.RIGHT=3]="RIGHT"}(Hne||(Hne={})),function(t){t[t.CENTER=0]="CENTER",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.TOP=3]="TOP",t[t.BOTTOM=4]="BOTTOM",t[t.TOP_LEFT=5]="TOP_LEFT",t[t.TOP_RIGHT=6]="TOP_RIGHT",t[t.BOTTOM_LEFT=7]="BOTTOM_LEFT",t[t.BOTTOM_RIGHT=8]="BOTTOM_RIGHT"}(wj||(wj={})),function(t){t[t.NONE=0]="NONE",t[t.UPPERCASE=1]="UPPERCASE",t[t.LOWERCASE=2]="LOWERCASE"}(qne||(qne={})),function(t){t[t.MAP=0]="MAP",t[t.VIEWPORT=1]="VIEWPORT"}(qT||(qT={})),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Wne||(Wne={}));let Uf=class{};Uf.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:HT.VISIBLE}},Uf.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:HT.VISIBLE}},Uf.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:HT.VISIBLE},"line-cap":{type:"enum",values:["butt","round","square"],default:Vne.BUTT},"line-join":{type:"enum",values:["bevel","round","miter"],default:Bne.MITER},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}},Uf.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:HT.VISIBLE},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:Gne.POINT},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:wj.CENTER},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:bj.AUTO},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:wj.CENTER},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:Hne.CENTER},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:bj.AUTO},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:qne.NONE},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[Wne.HORIZONTAL]}},Uf.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:HT.VISIBLE}},Uf.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}},Uf.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:qT.MAP}},Uf.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:qT.MAP},"line-width":{type:"number",minimum:0,default:1}},Uf.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:qT.MAP},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:qT.MAP}},Uf.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}},Uf.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:qT.MAP}};const XGt=.125;let YGt=class{constructor(){this._renderParams={context:null,drawPhase:1,state:new WGt({viewpoint:new Sd({targetGeometry:new Gt(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,highlightGradient:null}}dispose(){this._renderParams=null}render(e,r,i,n,s,o,a,l,c,u,h){this._render(e,r,i,n,s,o,a,l,c,u,h)}renderSymbols(e,r,i,n,s,o,a,l,c,u,h){this._render(e,r,i,n,s,o,a,l,c,u,h,jne.SYMBOL)}_render(e,r,i,n,s,o,a,l,c,u,h,f){const m=r[0]-o.getLevelShift(r[0]),g=this._renderParams;g.context=e,g.painter=n,g.glyphMosaic=n.glyphMosaic,g.spriteMosaic=n.spriteMosaic,g.pixelRatio=u*h,g.displayLevel=m,g.requiredLevel=m;const y=o.getScale(r[0]),[_,b]=o.getOffset(r,a*y),w=XGt*a*y/c,x=i.transforms.dvs;x[0]=w,x[4]=-w,x[6]=-1-_-l[0]*a*2,x[7]=1+b+(1-l[1])*a*2-2,g.state.size[0]=c/h,g.state.size[1]=c/h,g.state.pixelRatio=h,i.stage||i.attachWithContext(e),i.triangleCount=0,n.drawTile(g,i,s,f)}},LGe=class DGe extends si{initializeProgram(e){return new Kr(e.rctx,DGe.shader.get().build(this.configuration),Br)}initializePipeline(){return Qt({blending:Ed(De.ONE,De.ONE_MINUS_SRC_ALPHA),colorWrite:hr})}};LGe.shader=new Jr(fjt,()=>le(()=>import("./RasterColorizer.glsl-a9642081.js"),[]));let nL=class extends kD{constructor(){super(...arguments),this.colorizerType=I2.Stretch,this.stretchType=wE.Noop,this.applyColormap=!0,this.requireBilinearWithNN=!1}};d([X({count:I2.COUNT})],nL.prototype,"colorizerType",void 0),d([X({count:wE.COUNT})],nL.prototype,"stretchType",void 0),d([X()],nL.prototype,"applyColormap",void 0),d([X()],nL.prototype,"requireBilinearWithNN",void 0);let SEe=class{constructor(e){this._rctx=e,this._fbos=new Map}get(e){return this._getPool(e)}dispose(){this._fbos.forEach(e=>e.dispose()),this._fbos.clear()}_getPool(e){const r=this._fbos.get(e);if(r)return r;const i=new wo(this._rctx,new Vr(e),new RB(Hs.DEPTH_COMPONENT16,e));return this._fbos.set(e,i),i}};const ZGt=re.getLogger("esri.views.3d.terrain");let JGt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._fbos=[],this._vectorTileHelper=new YGt,this._bindParameters=new bH(null,null,null),this._blendLayersTechniqueConfig=new RGe,this._current=0,this._lastUsedIds=new Array,this._lastCreatedBufferId=0,this._onHoldIds=new Array,this._vaoQuad=vu(this._rctx,bF)}dispose(){this._fbos.forEach(pt),this._fbos=null,this._vtFBO=pt(this._vtFBO),this._vaoQuad=pt(this._vaoQuad),this._vectorTileHelper=pt(this._vectorTileHelper),this._backgroundTechnique=xn(this._backgroundTechnique),this._applyOpacityTechnique=xn(this._applyOpacityTechnique),this._blendLayersTechnique=xn(this._blendLayersTechnique)}_getBlendLayersTechnique(e,r,i,n=xm.Off,s=xE.BelowLayer){return this._blendLayersTechniqueConfig.output=r,this._blendLayersTechniqueConfig.blendMode=e,this._blendLayersTechniqueConfig.baseOpacityMode=i,this._blendLayersTechniqueConfig.premultipliedSource=n,this._blendLayersTechniqueConfig.background=s,this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(EGe,this._blendLayersTechniqueConfig,this._blendLayersTechnique),this._blendLayersTechnique}drawBackground(e,r){const i=this._getBlendLayersTechnique(et.Normal,r?Do.ColorComposite:Do.GridComposite,jm.NotRequired,xm.Off,xE.Only),n=this._rctx.bindTechnique(i,e,this._bindParameters);this._render(n)}_render(e){this._rctx.bindVAO(this._vaoQuad),e.assertCompatibleVertexAttributeLocations(this._vaoQuad),this._rctx.drawArrays(Zt.TRIANGLE_STRIP,0,el(this._vaoQuad,"geometry"))}drawGroup(e,r,i,n,s,o=xm.On){r===Do.Composite&&(e.fboTexture=this._fbos[this.getLastOnHoldId()].get(i).colorTexture),e.texture=this.currentFBO(i).colorTexture,this.closeGroup(i);const a=this._getBlendLayersTechnique(n,r,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawRasterData(e,r,i,n,s,o=xm.Off){if(e.texture==null)return;e.fboTexture=r===Do.GroupBackgroundComposite||n===et.Normal&&s===jm.NotRequired&&o===xm.Off?null:this.switch(i).colorTexture;const a=this._getBlendLayersTechnique(n,r,s,o),l=this._rctx.bindTechnique(a,e,this._bindParameters);this._render(l)}drawImageryTileData(e,r,i,n,s,o){const a=o.sourceLayerInfo.data;if(!a.source||(o.tile.surface.layerViewByIndex(o.layerIndex,Er.MAP).ensureSymbolizerParameters(a),!a.bind(this._rctx)))return;e.fboTexture=n===et.Normal&&s===jm.NotRequired?null:this.switch(i).colorTexture;const l=this._getRasterColorizerTechnique(a,r,n,s);a.opacity=e.opacity;const c=a.getUniforms();c.scale=o.scale,c.offset=o.offset,c.backgroundColor=e.backgroundColor,c.fboTexture=e.fboTexture,c.baseOpacity=e.baseOpacity;const u=this._rctx.bindTechnique(l,c,null);this._render(u)}_getRasterColorizerTechnique(e,r,i,n){const s=e.symbolizerParameters,o=["stretch","lut","hillshade"].indexOf(s.type);return this._rasterColorizerConfig==null&&(this._rasterColorizerConfig=new nL,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float")),this._rasterColorizerConfig.output=r,this._rasterColorizerConfig.blendMode=i,this._rasterColorizerConfig.baseOpacityMode=n,this._rasterColorizerConfig.colorizerType=o,this._rasterColorizerConfig.applyColormap=!!s.colormap,this._rasterColorizerConfig.requireBilinearWithNN=e.isBilinearWithStretchColorRamp,this._rasterColorizerConfig.stretchType=e.hasStretchTypeNone()?wE.Noop:wE.PerBand,this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(LGe,this._rasterColorizerConfig,this._rasterColorizerTechnique),this._rasterColorizerTechnique}drawVectorData(e,r,i,n,s,o,a,l,c){const u=this._rctx,h=o.sourceLayerInfo.data,f=o.tile.surface.layerViewByIndex(o.layerIndex,Er.MAP),m=s===jm.Required||e.opacity<1||n!==et.Normal||r!==Do.Composite,g=m?xm.On:xm.Off;this._getBlendLayersTechnique(n,r,s,g).bindPipelineState(u);let y=null,_=null;m?(_=this.currentFBO(i),this._vtFBO==null&&(this._vtFBO=new SEe(this._rctx)),y=this._vtFBO.get(i),u.bindFramebuffer(y),this._clearCurrentFBO()):c&&u.clearSafe(Qi.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(u,o.sourceLod,h,f.painter,f.layer.styleRepository,f.schemaHelper,Math.round(1/o.scale),o.offset,l,a,f.contentZoom),o.vtlNeighborInfos.forAll(b=>this._vectorTileHelper.renderSymbols(u,b.sourceLod,b.sourceLayerInfo.data,f.painter,f.layer.styleRepository,f.schemaHelper,1,b.offset,l,a,f.contentZoom))}catch(b){ZGt.warnOnce("A render call containing vector tiles did not resolve correctly.",b)}return y==null||(u.bindFramebuffer(_),e.texture=y.colorTexture,e.offset=cg,e.scale=1,this.drawRasterData(e,r,i,n,s,g),c)}copyFBOToTexture(e){const r=this._rctx,i=r.bindTexture(e.texture,Jt.TEXTURE_UNIT_FOR_UPDATES),n=e.descriptor;r.gl.copyTexImage2D(qn.TEXTURE_2D,0,n.pixelFormat,0,0,n.width,n.height,0),e.generateMipmap(),r.bindTexture(i,Jt.TEXTURE_UNIT_FOR_UPDATES)}_clearCurrentFBO(){this._rctx.setClearColor(0,0,0,0),this._rctx.setClearDepth(1),this._rctx.clearSafe(Qi.COLOR_BUFFER_BIT|Qi.DEPTH_BUFFER_BIT)}_initFBO(e,r,i){this._rctx.bindFramebuffer(e),i&&(this._rctx.setViewport(0,0,r,r),this._clearCurrentFBO())}ensureBuffer(e){this._lastUsedIds.length=0,this._lastUsedIds.push(1),this._lastCreatedBufferId=1,this._onHoldIds.length=0,this.bind(e)}bind(e,r=0,i=!0){if(this._current=r,r>=this._fbos.length)for(let n=this._fbos.length;n<=r;n++)this._fbos.push(new SEe(this._rctx));this._initFBO(this._fbos[r].get(e),e,i)}_bindNextFreeBuffer(e){this._lastUsedIds.length>0?this.bind(e,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(e,this._lastCreatedBufferId))}openGroup(e){this._onHoldIds.push(this._current),this._bindNextFreeBuffer(e)}switch(e){const r=this.currentFBO(e),i=this._current;return this._bindNextFreeBuffer(e),this._lastUsedIds.push(i),r}getLastOnHoldId(){return this._onHoldIds[this._onHoldIds.length-1]}closeGroup(e){const r=this._current;this._bindNextFreeBuffer(e),this._lastUsedIds.push(r),this._lastUsedIds.push(this._onHoldIds.pop())}unbind(){this._rctx.bindFramebuffer(null)}currentFBO(e){return this._fbos[this._current].get(e)}},KGt=class{constructor(){this.sourceLod=[0,0,0],this.offset=[0,0],this.scale=1,this.layerIndex=0,this.vtlNeighborInfos=new dr({allocator:e=>e||new QGt})}},QGt=class{constructor(){this.sourceLayerInfo=null,this.sourceLod=[0,0,0],this.offset=[-1,0]}},e7t=class{constructor(e,r,i,n){this.start=e,this.end=r,this.blendMode=i,this.opacity=n}},t7t=class{constructor(e,r,i){this._rctx=e,this.tileSize=r,this._techniqueRepository=i,this._passParameters=new dGt,this._backgroundTexture=null,this._backgroundColor=null,this._backgroundDirty=!1,this._blackTex=null,this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy,this._composition=new JGt(this._rctx,this._techniqueRepository),this._blackTex=new QR(TRt(this._rctx,[0,0,0,1])),this._ensureBackgroundTexture(this.tileSize)}dispose(){this._composition=pt(this._composition),this._backgroundTexture=xn(this._backgroundTexture),this._blackTex=xn(this._blackTex)}get backgroundIsGrid(){return this._backgroundColor==null}get backgroundColor(){return this._backgroundColor}updateTileTexture(e,r){if(!e.renderData)return;const i=e.surface,n=i.baseOpacity;let s=0,o=0,a=this.tileSize,l=!1;const c=i.view.state.contentPixelRatio;let u=!1;xj.clear(),QC.length=0;const h=e.layerInfo[Er.MAP];let f=h.length,m=0,g=null;for(;m<h.length;m++){const _=i.layerViewByIndex(m,Er.MAP),b=_.layer.opacity;TEe[m]=b;const w=_.fullOpacity;if(EEe[m]=w,JIe(_.layer)&&f>=h.length&&(f=m),mj(_)){CEe[m]=_.layer.blendMode;let S=_.layer.blendMode!=="normal";if(mP(_.layer.parent)){const C=Xne(_.layer.parent);C!=null&&C!==""&&(S=NGe(_.layer.parent)||S)}S&&(u=S,l=!1)}if(b===0&&!u){h[m].pendingUpdates&=~(qt.TEXTURE_NOFADING&qt.TEXTURE_FADING);continue}++o;const x=HZ(e,m);if(x){if(h[m].pendingUpdates&=~(qt.TEXTURE_NOFADING&qt.TEXTURE_FADING),mP(_.layer.parent)){const S=Xne(_.layer.parent);S!=null&&S!==""&&FGe(_.layer.parent,m)}s4(_)?a=Math.max(a,this.tileSize*c):n===1&&w===1&&(_.isOpaque||this._dataToTexture(x)&&x.sourceLayerInfo.data.descriptor.isOpaque)&&(l=!0),++s,g===null&&(g=m)}}const y=a/this.tileSize;this._ensureBackgroundTexture(this.tileSize),s!==0&&g!==null?s===1&&!u&&this._useLayerTexture(e,g,f,EEe[g])||this._composeMapLayers(e,r,m-1,f,TEe,CEe,a,y,!l||u,xj,u):this._useBackgroundTexture(e,o)}_ensureBackgroundTexture(e){this._backgroundTexture==null&&(this._backgroundTexture=this._buildTexture(e),this._backgroundDirty=!0),this._backgroundDirty&&(this._composition.bind(e),this._passParameters.offset=cg,this._passParameters.scale=1,this._passParameters.opacity=1,this.backgroundColor!=null&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,this.backgroundColor!=null),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)}_useBackgroundTexture(e,r){let i=u_.Immediate;(e.surface.view.layerViewManager.updating||r>0)&&(i=u_.Delayed);const n=e.renderData;this._backgroundTexture&&n.textureReference==null&&(i=u_.Immediate),n.setTextureReference(this._backgroundTexture!=null?new jZ(this._backgroundTexture,mo.FADING,REe,e.surface.baseOpacity,0,1):null,i)}_useLayerTexture(e,r,i,n){const s=r<i,o=s?1:e.surface.baseOpacity,a=s?e.surface.baseOpacity:1,l=HZ(e,r);return!!this._dataToTexture(l)&&(e.renderData.setTextureReference(new jZ(l.sourceLayerInfo.data,mo.FADING,l,o,a,n)),!0)}_composeMapLayers(e,r,i,n,s,o,a,l,c,u,h){this._composition.ensureBuffer(a);const f=e.surface.baseOpacity;let m=!1,g=Kt.LINEAR_MIPMAP_LINEAR,y=!1,_=0;for(let x=i;x>=0;x--){const S=HZ(e,x);if(!S||s[x]===0&&!h)continue;const C=x<n&&f<1&&!m;this._passParameters.baseOpacity=C?f:1;const E=this._passParameters.baseOpacity<1?jm.Required:jm.NotRequired;C&&(m=!0);let R=!1;u.forEach(k=>{k.start===x&&(QC.push(k),this._composition.openGroup(a),R=!0)});const P=_===0,D=R?Do.GroupBackgroundComposite:c&&P?this.backgroundIsGrid?Do.GridComposite:Do.ColorComposite:Do.Composite,L=Fne[o[x]];for(kje(S)?(this._passParameters.opacity=s[x],y=this._composition.drawVectorData(this._passParameters,D,a,L,E,S,l,this.tileSize,y)):FVt(S)?(this._passParameters.opacity=s[x],this._composition.drawImageryTileData(this._passParameters,D,a,L,E,S),this._hasNearestInterpolation(S)&&(g=Kt.NEAREST)):this._dataToTexture(S)&&(this._passParameters.texture=S.sourceLayerInfo.data.texture,this._passParameters.offset=S.offset,this._passParameters.scale=S.scale,this._passParameters.opacity=s[x],this._composition.drawRasterData(this._passParameters,D,a,L,E));QC.length>0&&QC[QC.length-1].end===x;){const k=QC.pop();this._passParameters.opacity=k.opacity,this._passParameters.offset=cg,this._passParameters.scale=1;const V=c&&P?this.backgroundIsGrid?Do.GridComposite:Do.ColorComposite:Do.Composite;this._composition.drawGroup(this._passParameters,V,a,Fne[k.blendMode],E)}_++}const b=e.renderData,w=b.ensureTexture(a,()=>this._buildTexture(a,g));this._composition.copyFBOToTexture(w),this._composition.unbind(),b.setTextureReference(new jZ(w,r,REe,m?1:f,0,1))}_hasNearestInterpolation(e){const r=e.sourceLayerInfo.data;return!!r.source&&r.interpolation==="nearest"}_dataToTexture(e){if(UVt(e)){const r=e.sourceLayerInfo;r.data=this._buildTexture(r.data),e.tile.setMemoryDirty()}return kVt(e)}setBackground(e){this._backgroundColor!==e&&(this._backgroundColor=e,this._backgroundDirty=!0)}_buildTexture(e,r=Kt.LINEAR_MIPMAP_LINEAR){if(e==null)return null;const i=new Vr;i.wrapMode=ir.CLAMP_TO_EDGE,i.samplingMode=r,i.maxAnisotropy=this._maxAnisotropy,i.preMultiplyAlpha=!0,i.flipped=!0,i.hasMipmap=!0;const n=this._rctx;let s;if(typeof e=="number")i.width=i.height=e,s=new QR(new Jt(n,i));else if(e instanceof lq)i.isOpaque=e.isOpaque,s=new QR(new Jt(n,i,e.image)),e.release();else try{i.width=e.width,i.height=e.height,s=new QR(new Jt(n,i,e))}catch{s=new QR(g6e(n)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}const o=n.bindTexture(s.texture,Jt.TEXTURE_UNIT_FOR_UPDATES);return s.generateMipmap(),n.bindTexture(o,Jt.TEXTURE_UNIT_FOR_UPDATES),s}get test(){return{backgroundTexture:this._backgroundTexture}}};function HZ(t,e){Zl.layerIndex=e,Zl.vtlNeighborInfos.clear();const r=t.layerInfo[Er.MAP][e];if(r.data)return Or(Zl.offset,0,0),Zl.tile=t,Zl.scale=1,Zl.sourceLod=t.lij,Zl.sourceLayerInfo=r,kje(Zl)&&t.forEachLoadedNeighbor((n,s)=>{if(n.level!==t.level)return;const o=n.layerInfo[Er.MAP][e];if(!Uje(o)||r.data===o.data)return;const a=Zl.vtlNeighborInfos.pushNew();a.offset=mv[s],a.sourceLod=n.lij,a.sourceLayerInfo=o}),Zl;const i=r.upsampleInfo;if(i){const n=i.tile.layerInfo[Er.MAP][e];return Zl.tile=i.tile,Eo(Zl.offset,i.offset),Zl.scale=i.scale,Zl.sourceLod=i.tile.lij,Zl.sourceLayerInfo=n,Zl}return null}function Xne(t){return t.get("uid")}function NGe(t){let e=t.blendMode!=="normal";return mP(t.parent)&&(e=NGe(t.parent)||e),e}function FGe(t,e){mP(t.parent)&&FGe(t.parent,e);const r=Xne(t);if(r!=null&&r!==""){const i=xj.get(r);i?i.start=e:xj.set(r,new e7t(e,e,t.blendMode,t.opacity))}}const TEe=new Array,EEe=new Array,CEe=new Array,xj=new Map,QC=new Array,Zl=new KGt,REe={offset:[0,0],scale:1},mv=new Array;mv[Ft.NORTH]=[0,-1],mv[Ft.NORTH_EAST]=[-1,-1],mv[Ft.EAST]=[-1,0],mv[Ft.SOUTH_EAST]=[-1,1],mv[Ft.SOUTH]=[0,1],mv[Ft.SOUTH_WEST]=[1,1],mv[Ft.WEST]=[1,0],mv[Ft.NORTH_WEST]=[1,-1];const kGe=200,qZ=40,r7t=.8,i7t=10,sL=1e-6;function n7t(t,e,r){const i=e,n=r;let s=0,o=1/0;for(let a=0;a<3;++a){{const l=t[a];if(i[a]<l){if(n[a]<=sL)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]<=-sL){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}{const l=t[a+3];if(i[a]>l){if(n[a]>=-sL)return!1;const c=(l-i[a])/n[a];s=Math.max(s,c)}else if(n[a]>=sL){const c=(l-i[a])/n[a];o=Math.min(o,c)}if(s>o)return!1}}return!0}let OEe=class{constructor(e,r,i,n,s){this.aabb=e,this.axis=r,this.d=i,this.midStartIndex=n,this.rightStartIndex=s}},lfe=class Yne{constructor(e,r,i,n){this.globalTriangleVertexIndices=e,this.firstTriangleIndex=r,this.positionAttribute=n,this._rayDirection=A(),this.bspNodeTree=new Array;const s=i-r,o=s<=UGe?new Uint16Array(s):new Uint32Array(s);this.indices=o;for(let a=0;a<s;++a)o[a]=a;{const a=c7t(e,r,i,n.data,n.stride),l=Te(Math.log2(s/qZ),2,i7t),c=(u,h,f)=>{const m=a7t(o,a,u,h),g=h-u;if(g<=qZ){const S=new OEe(m,void 0,0,u,h);return this.bspNodeTree.push(S),S}const{axis:y,midValue:_}=l7t(m),b=o7t(o,a,u,h,y,_),w=(S,C)=>{if(f>l)return;const E=C-S;return E<qZ||E>=r7t*g?void 0:c(S,C,f+1)},x=new OEe(m,y,_,b.next,b.mid);return this.bspNodeTree.push(x),x.leftNode=w(u,b.next),x.rightNode=w(b.mid,h),x};c(0,s,0),this.triangleVertexIndices=u7t(o,e,r,i)}}intersectRayTriangleRange(e,r){{if(e>=r)return;const i=this.triangleVertexIndices,n=this.positionAttribute.data,s=this.positionAttribute.stride,o=this._rayOrigin,a=o[0],l=o[1],c=o[2],u=this._rayDirection,h=u[0],f=u[1],m=u[2];for(let g=e,y=3*e;g<r;++g){let _=i[y++]*s;const b=n[_++],w=n[_++],x=n[_];_=i[y++]*s;const S=n[_++],C=n[_++],E=n[_];_=i[y++]*s;const R=S-b,P=C-w,D=E-x,L=n[_++]-b,k=n[_++]-w,V=n[_]-x,W=f*V-k*m,G=m*L-V*h,B=h*k-L*f,Z=R*W+P*G+D*B;if(Math.abs(Z)<=Number.EPSILON)continue;const M=a-b,$=l-w,N=c-x,j=M*W+$*G+N*B;if(Z>0){if(j<0||j>Z)continue}else if(j>0||j<Z)continue;const J=$*D-P*N,K=N*R-D*M,te=M*P-R*$,ae=h*J+f*K+m*te;if(Z>0){if(ae<0||j+ae>Z)continue}else if(ae>0||j+ae<Z)continue;const be=(L*J+k*K+V*te)/Z;if(be>=0){const Ee=this.indices[g]+this.firstTriangleIndex,Je=Ohe(R,P,D,L,k,V,s7t);this._callback(be,Je,Ee,!1)}}}Yne.numFacesTested+=r-e}intersectRay(e,r){Yne.numFacesTested=0;const i=Ue(e.r0[0],e.r0[1],e.r0[2]),n=Ue(e.r1[0],e.r1[1],e.r1[2]),s=n[0]-i[0],o=n[1]-i[1],a=n[2]-i[2];if(s*s+o*o+a*a<sL)return;this._rayOrigin=i;const l=this._rayDirection;l[0]=s,l[1]=o,l[2]=a;const c=this.triangleVertexIndices.length/3;this._callback=r;const u=this.bspNodeTree[0];this.intersectRayBSP(u,0,c)}intersectRayBSP(e,r,i){const n=this._rayOrigin,s=this._rayDirection;if(!n7t(e.aabb,n,s))return;const o=e.axis,a=e.d;if(n[o]<a||s[o]<0){const l=r,c=e.midStartIndex;if(l<c){const u=e.leftNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}if(this.intersectRayTriangleRange(e.midStartIndex,e.rightStartIndex),n[o]>a||s[o]>0){const l=e.rightStartIndex,c=i;if(l<c){const u=e.rightNode;u!==void 0?this.intersectRayBSP(u,l,c):this.intersectRayTriangleRange(l,c)}}}get estimatedMemoryUsage(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}};lfe.numFacesTested=0;const s7t=A(),eR=[1/0,1/0,1/0],tR=[-1/0,-1/0,-1/0];function o7t(t,e,r,i,n,s){let o=r,a=i;for(;o<a;){const c=t[o];e[6*c+n+3]<=s?++o:(--a,t[o]=t[a],t[a]=c)}let l=o;for(a=i;l<a;){const c=t[a-1];e[6*c+n]>=s?--a:(t[a-1]=t[l],t[l]=c,++l)}return{next:o,mid:l}}function a7t(t,e,r,i){if(i<=r)return sE(NaN,NaN,NaN,NaN,NaN,NaN);{const n=6*t[r];for(let s=0;s<3;++s)eR[s]=e[n+0+s],tR[s]=e[n+3+s]}for(let n=r+1;n<i;++n){const s=6*t[n];for(let o=0;o<3;++o)eR[o]=Math.min(eR[o],e[s+0+o]),tR[o]=Math.max(tR[o],e[s+3+o])}return sE(eR[0],eR[1],eR[2],tR[0],tR[1],tR[2])}function l7t(t){const e=t[3]-t[0],r=t[4]-t[1],i=t[5]-t[2],n=e>r?e>i?0:r>i?1:2:r>i?1:i>e?2:0;return{axis:n,midValue:(t[n]+t[n+3])/2}}function c7t(t,e,r,i,n){const s=r-e,o=new Float32Array(6*s);for(let a=0;a<s;++a){const l=3*(a+e),c=t[l]*n,u=t[l+1]*n,h=t[l+2]*n;for(let f=0;f<3;++f){const m=i[c+f],g=i[u+f],y=i[h+f];o[6*a+f]=Math.min(m,g,y),o[6*a+3+f]=Math.max(m,g,y)}}return o}function u7t(t,e,r,i){const n=i-r;let s=0;for(let a=r;a<i;++a)for(let l=0;l<3;++l)s=Math.max(e[3*a+l],s);const o=s<=UGe?new Uint16Array(3*n):new Uint32Array(3*n);for(let a=0;a<n;++a){const l=3*(t[a]+r);for(let c=0;c<3;++c){const u=e[l+c];o[3*a+c]=u}}return o}const UGe=65535;let Ps=class extends tl{constructor(){super(...arguments),this.output=q.Color,this.overlayMode=h_.Disabled,this.tileBlendInput=ky.LayerOnly,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.receiveShadows=!1,this.hasSlicePlane=!1,this.backfaceCullingEnabled=!1,this.textureFadingEnabled=!1,this.renderOccluded=!1,this.hasScreenSpaceReflections=!1,this.hasCloudsReflections=!1,this.invisible=!1,this.tileBorders=!1,this.visualizeNormals=!1,this.screenSizePerspective=!1,this.receiveAmbientOcclusion=!1,this.pbrMode=Nt.Terrain}};d([X({count:q.COUNT})],Ps.prototype,"output",void 0),d([X({count:h_.COUNT})],Ps.prototype,"overlayMode",void 0),d([X({count:ky.COUNT})],Ps.prototype,"tileBlendInput",void 0),d([X()],Ps.prototype,"spherical",void 0),d([X()],Ps.prototype,"doublePrecisionRequiresObfuscation",void 0),d([X()],Ps.prototype,"receiveShadows",void 0),d([X()],Ps.prototype,"hasSlicePlane",void 0),d([X()],Ps.prototype,"backfaceCullingEnabled",void 0),d([X()],Ps.prototype,"textureFadingEnabled",void 0),d([X()],Ps.prototype,"renderOccluded",void 0),d([X()],Ps.prototype,"hasScreenSpaceReflections",void 0),d([X()],Ps.prototype,"hasCloudsReflections",void 0),d([X()],Ps.prototype,"invisible",void 0),d([X()],Ps.prototype,"tileBorders",void 0),d([X()],Ps.prototype,"visualizeNormals",void 0),d([X()],Ps.prototype,"screenSizePerspective",void 0),d([X()],Ps.prototype,"receiveAmbientOcclusion",void 0),d([X({count:Nt.COUNT})],Ps.prototype,"pbrMode",void 0),d([X({constValue:ei.Compressed})],Ps.prototype,"normalType",void 0),d([X({constValue:xs.Compressed})],Ps.prototype,"textureCoordinateType",void 0),d([X({constValue:!1})],Ps.prototype,"highStepCount",void 0),d([X({constValue:!1})],Ps.prototype,"useCustomDTRExponentForWater",void 0),d([X({constValue:!1})],Ps.prototype,"useFillLights",void 0);const WZ=7,d7t=10,XZ=To();var $o;(function(t){t[t.Opaque=0]="Opaque",t[t.Semitransparent=1]="Semitransparent",t[t.TransparentWithDraped=2]="TransparentWithDraped",t[t.Empty=3]="Empty"})($o||($o={}));let $u=class extends Ce{get _isGlobal(){return this._stage.viewingMode===at.Global}constructor(e){super(e),this.type=Sn.TERRAIN,this.isGround=!0,this._tileSize=256,this._techniqueConfiguration=new Ps,this._passParameters=new oGe,this._rctx=null,this._renderDataPool=new il(jjt),this._patchGroups=new Map,this._patchGroupsDirty=!0,this._patchSortingDirty=!0,this._tileIterator=new Jje,this._highestVisibleLODTile=null,this._visible=!0,this._transparencyState=$o.Opaque,this._castShadows=!0,this._emptyTex=null,this._tileRenderer=null,this._stencilEnabledLayerExtents=new Array,this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this.needsHighlight=!1,this.renderOccludedFlags=gn.Occlude}initialize(){const e=[_e.OPAQUE_TERRAIN,_e.TRANSPARENT_TERRAIN,_e.OCCLUDED_TERRAIN];this._stage.addRenderPlugin(e,this)}destroy(){this._stage.removeRenderPlugin(this),BBt()}get canRender(){return this._visible&&!!this._rootTiles&&!this.renderingDisabled}set renderingDisabled(e){this._set("renderingDisabled",!!e),this.setDirty()}set transparency(e){this._transparencyState!==e&&(this._techniqueConfiguration.invisible=e===$o.TransparentWithDraped||e===$o.Empty,this._transparencyState=e,this.setNeedsRender())}get transparency(){return this._transparencyState}get needsLinearDepth(){return this._overlayRenderer.hasWater}get renderPatchBorders(){return!!this._techniqueConfiguration.tileBorders}set renderPatchBorders(e){this._techniqueConfiguration.tileBorders!==e&&(this._techniqueConfiguration.tileBorders=e,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}get visualizeNormals(){return!!this._techniqueConfiguration.visualizeNormals}set visualizeNormals(e){this._techniqueConfiguration.visualizeNormals!==e&&(this._techniqueConfiguration.visualizeNormals=e,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}get cullBackFaces(){return this._techniqueConfiguration.backfaceCullingEnabled}set cullBackFaces(e){this._techniqueConfiguration.backfaceCullingEnabled!==e&&(this._techniqueConfiguration.backfaceCullingEnabled=e,this.notifyChange("cullBackFaces"),this.setNeedsRender())}set renderOrder(e){this._set("renderOrder",e),this._setSortingDirty()}get layerUid(){return Kb}get slicePlaneEnabled(){return this._techniqueConfiguration.hasSlicePlane}set slicePlaneEnabled(e){this._techniqueConfiguration.hasSlicePlane!==e&&(this._techniqueConfiguration.hasSlicePlane=e,this.setNeedsRender())}set textureFadingEnabled(e){this._techniqueConfiguration.textureFadingEnabled!==e&&(this._techniqueConfiguration.textureFadingEnabled=e,this.setNeedsRender())}set pbrMode(e){this._techniqueConfiguration.pbrMode!==e&&(this._techniqueConfiguration.pbrMode=e,this.setNeedsRender())}setDebugScreenSizePerspective(e){this._techniqueConfiguration.screenSizePerspective!==e&&(this._techniqueConfiguration.screenSizePerspective=e,this.setNeedsRender())}setRootTiles(e){this._rootTiles=e,this.setDirty()}setNeedsHighlight(e){this.needsHighlight=e,this.setNeedsRender()}setRenderOccludedOverlay(e){this.renderOccludedFlags=e?rj:gn.Occlude,this.setNeedsRender()}setStencilEnabledLayerExtents(e){this._stencilEnabledLayerExtents=e,this._setSortingDirty()}setTileSize(e){this._tileSize=e,this._tileRenderer!=null&&(this._tileRenderer.tileSize=e),this.setDirty()}_prepareTileForLoading(e){e.renderData||(e.renderData=this._renderDataPool.acquire(),e.renderData.init(e),e.renderData.localOrigin=this._getLocalOriginOfTile(e))}loadTile(e){this._prepareTileForLoading(e),this.updateTileGeometryState(e),this.updateTileTexture(e,qt.TEXTURE_FADING)}updateTileTexture(e,r){this._tileRenderer!=null&&(this._tileRenderer.updateTileTexture(e,r===qt.TEXTURE_FADING?mo.FADING:mo.UNFADED),this.setNeedsRender(),e.resetPendingUpdate(r))}updateTileGeometryState(e){for(const i of e.layerInfo[Er.ELEVATION])i.pendingUpdates&=~qt.GEOMETRY;e.resetPendingUpdate(qt.GEOMETRY);const r=e.renderData.updateGeometryState();return r&&this.setDirty(),r}updateGeometryIfNeeded(e){e.isLoaded&&e.renderData.updateGeometryIfNeeded(this._rctx)}unloadTile(e){const r=e.renderData;r&&(r.releaseGeometry(),this._renderDataPool.release(r),r.clear(),e.renderData=null,e.setMemoryDirty(),this.setDirty())}_getLocalOriginOfTile(e){const r=d7t-WZ,i=Math.max(0,Math.floor((e.level-r)/WZ)*WZ);if(this._isGlobal&&i===0)return Sc;for(;e.parent&&e.level>i;)e=e.parent;return e.centerAtSeaLevel}setVisibility(e){this._visible=e,this.setDirty()}getStats(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}}set wireframe(e){this._get("wireframe")!==e&&(this._set("wireframe",e),this.setNeedsRender())}setDirty(e=is.UPDATE){this._patchGroupsDirty=!0,this._context.requestRender(e)}_setSortingDirty(e=is.UPDATE){this._patchSortingDirty=!0,this._context.requestRender(e)}setNeedsRender(e=is.UPDATE){this._context.requestRender(e)}initializeRenderContext(e){this._context=e,this._rctx=e.renderContext.rctx,this._techniqueRepository=e.techniqueRepository,this._tileRenderer=new t7t(this._rctx,this._tileSize,this._techniqueRepository),this.updateTileBackground(),this._emptyTex=g6e(this._rctx)}uninitializeRenderContext(){this._emptyTex=pt(this._emptyTex),this._tileRenderer=pt(this._tileRenderer)}intersect(e,r,i,n){if(!this._rootTiles||e.options.selectOpaqueTerrainOnly&&e.options.selectionMode&&this.transparency!==$o.Opaque)return;const s=h7t,o=p7t;ve(s,n,i),se(o,1/s[0],1/s[1],1/s[2]);const a=e.results.min,l=e.results.max,c=e.results.ground,u=e.options.store===Ia.MIN,h=!!e.results.ground.target,f=Bxt(e.verticalOffset),m=e.tolerance;let g,y=u&&a.dist!=null?a.dist:1/0;const _=w=>{const x=w.renderData;if(!(x!=null&&x.vao))return;const S=x.geometry;q7(XZ,S.boundingBox);const C=x.localOrigin;f!=null&&(f.localOrigin=C,f.applyToAabb(XZ));const E=XZ;if(rR[0]=i[0]-C[0],rR[1]=i[1]-C[1],rR[2]=i[2]-C[2],!Phe(E,rR,o,m,y))return;const R=(B,Z,M)=>{B.set(this.type,w,Z,M,bo),y=u&&a.dist!=null?a.dist:1/0},P=(B,Z)=>{if(Z!=null&&B>=0&&(e.options.backfacesTerrain||ye(Z,s)<0)&&(e.options.invisibleTerrain||!e.options.selectionMode||r==null||r(i,n,B))){if((c.dist==null||B<c.dist)&&R(c,B,Z),e.options.isFiltered)return;e.options.store===Ia.ALL&&(g==null?(g=yde(e.ray),R(g,B,Z),e.results.all.push(g)):B<g.dist&&R(g,B,Z)),(a.dist==null||B<a.dist)&&R(a,B,Z),e.options.store!==Ia.MIN&&(l.dist==null||B>l.dist)&&R(l,B,Z)}},D=f7t;ve(D,n,C);const L=S.indices,k=S.vertexAttributes,V=k.getField(O.POSITION,xo),W=new ft(V.typedBuffer,3,!1,k.stride/4),G=S.indexCount/3;if(!f&&G>kGe){const B=w.renderData;B.intersectionData==null&&(B.intersectionData=new lfe(L,0,G,W)),B.intersectionData.intersectRay({r0:rR,r1:D},P)}else OF(rR,D,0,G,L,W,null,f,P)},b=this._rootTiles;b!=null&&(()=>{const w=this._tileIterator;w.reset(b);const x=e.options.invisibleTerrain;for(let S=w.next();S;S=w.next())!(S.visible||x&&S.intersectsClippingArea)||f==null&&!S.intersectsRay(i,s,m,y)||h&&this._useStencilForTile(S)?w.skipSubtree():_(S)})()}processScaleRangeQueries(e,r){var i;if(!r.done)for(this._updatePatchGroups();e.updating&&!r.done;){e.prepare();for(const n of this._patchGroups.values())for(const s of n)((i=s.renderData)==null?void 0:i.textureReference)!=null&&e.queriesForTile(s);e.process(),r.madeProgress()}}prepareTechnique(e){if(e.bindParameters.slot===_e.OCCLUDED_TERRAIN){if(!(e.renderOccludedMask&rj))return null}else{const r=this.transparency===$o.Opaque?_e.OPAQUE_TERRAIN:_e.TRANSPARENT_TERRAIN;if(e.bindParameters.slot!==r)return null}switch(e.output){case q.Color:return this.transparency===$o.Empty?null:(this._techniqueConfiguration.hasScreenSpaceReflections=e.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=e.bindParameters.cloudsFade.data!=null,this._techniqueConfiguration.receiveShadows=e.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=e.bindParameters.ssaoHelper.active,this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?h_.Disabled:this._overlayRenderer.hasWater?h_.EnabledWithWater:h_.Enabled,this._updateTechnique(q.Color,e.bindParameters.slot===_e.OCCLUDED_TERRAIN));case q.Shadow:case q.ShadowExcludeHighlight:return this._castShadows&&e.bindParameters.lighting.globalFactor===1?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(q.Shadow,!1)):null;case q.Depth:return this.transparency===$o.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(q.Depth,!1));case q.Normal:return this.transparency===$o.Empty?null:(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(q.Normal,!1));case q.ObjectAndLayerIdColor:return this.transparency===$o.Empty?null:this._updateTechnique(q.ObjectAndLayerIdColor,!1);case q.Highlight:return this.transparency!==$o.Empty&&this.needsHighlight?(this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(q.Highlight,!1)):null}return null}render(e,r){const i=e.bindParameters.lighting.globalFactor===1;switch(this._updatePatchGroups(),r.useStencil=!1,e.output){case q.Color:{const n=e.bindParameters.slot===_e.OCCLUDED_TERRAIN?pc.Occluded:pc.ColorAndWater;this.transparency===$o.Opaque?this._renderMaterialPass(e,r,n):e.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(e,r,n),e.offscreenRenderingHelper.tmpColor,e.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break}case q.Depth:case q.Normal:this._renderAuxiliaryPass(e,r,pc.ColorAndWater);break;case q.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(e,r,pc.Highlight);break;case q.Shadow:case q.ShadowExcludeHighlight:this._castShadows&&i&&this._renderAuxiliaryPass(e,r,pc.None);break;case q.ObjectAndLayerIdColor:this._renderAuxiliaryPass(e,r,pc.ObjectAndLayerIdColor)}}_renderMaterialPass(e,r,i){const{rctx:n}=e;this._passParameters.overlaySource=i,n.bindTechnique(r,this._passParameters,e.bindParameters),this._numTilesRendered=0,this._numTilesCulled=0,this._numOriginsRendered=0,this._renderPatchGroups(e,r,i)}_renderAuxiliaryPass(e,r,i){const n=e.rctx;this._passParameters.overlaySource=i,n.bindTechnique(r,this._passParameters,e.bindParameters),this._renderPatchGroupsAuxiliary(e,r,i)}updateTileBackground(e=null){if(this._tileRenderer==null)return;const r=this._tileRenderer;let i=null;if(e!=null){const n=ht.toUnitRGBA(e);i=Ue(n[0]||0,n[1]||0,n[2]||0)}r.setBackground(i),this._allTiles.forAll(n=>r.updateTileTexture(n,mo.FADING)),this._techniqueConfiguration.tileBlendInput=r.backgroundIsGrid?ky.GridComposite:r.backgroundColor!=null?ky.ColorComposite:ky.LayerOnly,this.setNeedsRender()}_updatePatchGroups(){if(this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0),this._patchSortingDirty&&this.renderOrder!==n3.NONE){const e=Array.from(this._patchGroups.values()),r=this._stencilEnabledLayerExtents;for(const i of e)Kje(this.renderOrder,i,r);e.sort((i,n)=>Qje(i[0],n[0],this.renderOrder)),this._patchGroups=new Map(e.map(i=>[i[0].renderData.localOrigin,i])),this._patchSortingDirty=!1}}_rebuildPatchGroups(){var r;const e=this._rootTiles;if(e!=null){(r=e[0])==null||r.surface.checkAllTilesWaterproofness(),this._patchGroups.clear();for(const i of e)this._rebuildPatchGroupsForRootTile(i)}}_rebuildPatchGroupsForRootTile(e){const r=this._tileIterator;for(r.resetOne(e);!r.done;){const i=r.next(),n=i.renderData;if(!n){this._numTilesCulled++;continue}if(!i.visible){this._numTilesCulled++,r.skipSubtree();continue}const s=n.localOrigin;let o=this._patchGroups.get(s);o||(o=new Array,this._patchGroups.set(s,o)),o.push(i),(!this._highestVisibleLODTile||i.elevationLevel>this._highestVisibleLODTile.elevationLevel)&&(this._highestVisibleLODTile=i),r.skipSubtree()}}_useStencilForTile(e){for(const r of this._stencilEnabledLayerExtents)if(e.intersectsExtent(r))return!0;return!1}_renderPatchGroupsAuxiliary(e,r,i){const n=this._stencilEnabledLayerExtents.length>0;this._patchGroups.forEach(s=>{const o=s[0].renderData.localOrigin;r.program.bindDraw(new une(o),e.bindParameters,this._passParameters);for(let a=0;a<s.length;a++)this._renderPatch(e,r,s[a],Zt.TRIANGLES,n,i)}),e.rctx.bindVAO(null)}_renderPatchGroups(e,r,i){const n=e.bindParameters.camera,s=r.program;if(this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest){const h=a8e(this._stage.viewingMode,this._ellipsoidRadius),f=this.pointsOfInterest.centerOnSurfaceFrequent.distance;h.update({distance:f,fovY:n.fovY})}const o=this._stencilEnabledLayerExtents.length>0,a=i===pc.Occluded;a&&(s.bindTexture("tex",this._emptyTex),s.setUniform3fv("textureOpacities",Sc),s.setUniform4fv("texOffsetAndScale",Wy));const l=this._tileRenderer!=null&&this._tileRenderer.backgroundColor!=null?this._tileRenderer.backgroundColor:Sc;this._techniqueConfiguration.tileBlendInput===ky.ColorComposite&&s.setUniform3fv("backgroundColor",l);const c=this.wireframe?Zt.LINES:Zt.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&s.bindTexture("texNext",this._emptyTex);const u=this._patchGroups;for(const h of u.values()){const f=h[0].renderData.localOrigin;r.program.bindDraw(new une(f),e.bindParameters,this._passParameters),this._numOriginsRendered++;for(const m of h){const g=m.renderData,y=g.textureReference;if(y!=null){if(!a){s.setUniform4fv("texOffsetAndScale",y.offsetAndScale),s.bindTexture("tex",y.texture.texture);const _=g.textureFadeFactor,b=_<1?g.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&b!=null&&_<1?(s.setUniform1f("fadeFactor",_),s.setUniform4fv("nextTexOffsetAndScale",b.offsetAndScale),s.setUniform3fv("nextTexOpacities",b.opacities),s.bindTexture("texNext",b.texture.texture)):s.setUniform1f("fadeFactor",1),g.textureIsFading&&this.setNeedsRender(),s.setUniform3fv("textureOpacities",y.opacities)}this._renderPatch(e,r,m,c,o,i),m.renderOrder=this._numTilesRendered,this._numTilesRendered++}}}e.rctx.bindVAO(null)}_renderPatch(e,r,i,n,s,o){const a=i.renderData,l=a.vao,c=l.indexBuffer;if(c==null)return void(_o&&console.error("Rendered tile with no indices: ",i.lij," : ",a));const u=r.program;o===pc.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(u,a.overlay),s&&(r.useStencil=this._useStencilForTile(i),r.bindPipelineState(e.rctx,e.bindParameters.slot));const h=a.geometry.indexCount;e.rctx.bindVAO(l),u.assertCompatibleVertexAttributeLocations(l),e.rctx.drawElements(n,h,c.indexType,0)}_bindOverlayPatchData(e,r){e.setUniform4fv("overlayTexOffset",r.offsets),e.setUniform4fv("overlayTexScale",r.scales)}_updateTechnique(e,r){return this._techniqueConfiguration.output=e,this._techniqueConfiguration.renderOccluded=r,this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(aGe,this._techniqueConfiguration,this._shaderTechnique),this._shaderTechnique}get test(){return{tileRenderer:this._tileRenderer}}};d([p({constructOnly:!0})],$u.prototype,"_overlayRenderer",void 0),d([p({constructOnly:!0})],$u.prototype,"_stage",void 0),d([p({readOnly:!0})],$u.prototype,"_isGlobal",null),d([p({constructOnly:!0})],$u.prototype,"_allTiles",void 0),d([p({constructOnly:!0})],$u.prototype,"_ellipsoidRadius",void 0),d([p({value:!1})],$u.prototype,"renderingDisabled",null),d([p()],$u.prototype,"renderPatchBorders",null),d([p()],$u.prototype,"visualizeNormals",null),d([p()],$u.prototype,"cullBackFaces",null),d([p({value:n3.FRONT_TO_BACK})],$u.prototype,"renderOrder",null),d([p()],$u.prototype,"wireframe",null),$u=d([I("esri.views.3d.terrain.TerrainRenderer")],$u);const h7t=A(),p7t=A(),rR=A(),f7t=A();let m7t=class{constructor(){this.numNodes=0,this.numLeaves=0,this.numVisible=0,this.numRendered=0,this.numSplit=0,this.numMerged=0,this.numRenderedPerLevel=new Array,this.numLoadedPerLevel=new Array}},cy=class extends Ce{constructor(e){super(e),this._handles=new Ri}initialize(){this._handles.add(this.layers.on("change",()=>this._update())),this._handles.add(pe(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme())),this._update(),this.tilingSchemeLocked||this._setAdHocTilingScheme()}destroy(){this._handles=qe(this._handles),this._waitTask=null,this.layers.destroy()}_update(){if(this._waitTask=null,this.tilingSchemeLocked)return;let e;if(this.layers.some(r=>!(!tD(r)||r.isRejected())&&!(r.isFulfilled()&&!g7t(r,this.viewSpatialReference,this.viewingMode))&&(e=r,!((r==null?void 0:r.type)==="vector-tile"||fj(r)))),e)if(e.isResolved()){const r=uq(e,this.viewSpatialReference,this.viewingMode);if(r!=null){const i=new Qu(r.tileInfo);this._lockTilingScheme(i)}}else this._updateWhen(e)}_updateWhen(e){const r=e.when().catch(()=>{}).then(()=>{r!==this._waitTask||this.destroyed||this._update()});this._waitTask=r}_lockTilingScheme(e){if(this.viewingMode===at.Global){const r=e.levels.length-1;e.spatialReference.isWebMercator?e=Qu.makeWebMercatorAuxiliarySphere(r):Kw(e.spatialReference)&&(e=Qu.makeGCSWithTileSize(e.spatialReference,e.pixelSize,r))}this.tilingSchemeLocked=!0,this.tilingScheme=e,this.extentHelper.tilingScheme=this.tilingScheme,this._updateTiledLayerExtent(),this._handles.removeAll(),this._handles.add(pe(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))}_updateTiledLayerExtent(){this._set("extent",this.extentHelper.tiledLayersExtent)}_setAdHocTilingScheme(){if(this.viewingMode===at.Global){const e=this.extentHelper.viewSpatialReference,r=Kw(e)||w0(e)||x0(e);e.isWebMercator?this.tilingScheme=Qu.WebMercatorAuxiliarySphere:r&&(this.tilingScheme=Qu.makeGCSWithTileSize(e,256)),this._set("extent",this.extentHelper.layerViewsExtent)}else{const e=this.extentHelper.layerViewsExtent;e==null||v2(e,this.extent)||(this.tilingScheme=Qu.fromExtent(e,this.extentHelper.viewSpatialReference),this._set("extent",e))}}get test(){return{lockTilingScheme:e=>this._lockTilingScheme(e),done:!this._waitTask}}};function g7t(t,e,r){return uq(t,e,r)!=null}d([p()],cy.prototype,"tilingScheme",void 0),d([p({readOnly:!0})],cy.prototype,"extent",void 0),d([p({value:!1})],cy.prototype,"tilingSchemeLocked",void 0),d([p({constructOnly:!0})],cy.prototype,"viewSpatialReference",void 0),d([p({constructOnly:!0})],cy.prototype,"layers",void 0),d([p({constructOnly:!0})],cy.prototype,"extentHelper",void 0),d([p({constructOnly:!0})],cy.prototype,"viewingMode",void 0),cy=d([I("esri.views.3d.terrain.TilingSchemeLogic")],cy);let y7t=class{constructor(){this.offset=Qe(),this.scale=0,this.tile=null}init(e,r,i,n){this.tile=e,this.offset[0]=r,this.offset[1]=i,this.scale=n}dispose(){this.tile=null,this.offset[0]=0,this.offset[1]=0,this.scale=0}},yr=class extends pn.EventedMixin(Ce){constructor(e){var r,i;super(e),this._scaleRangeQueries=new Hz,this._iteratorPool=new il(Jje,n=>n.remove=()=>this._iteratorPool.release(n)),this._postorderIterator=new WBt,this._hasPendingUpdates=!1,this._pendingUpdates=0,this._asyncWorkItems=0,this._allTilesDirty=!0,this._allTilesSorted=!0,this._visibleCached=!1,this._usedMemory=null,this._performanceInfo=new m7t,this._viewChanged=!1,this._inFrameTask=!1,this._viewChangeUpdateDirty=!1,this._eyePosRenderSR=A(),this._eyePosSurfaceSR=A(),this._splitLimits=new rm,this._frustum=LN(),this._viewProjectionMatrix=Me(),this._layerViews=[new Array,new Array],this._layerIndexByUid=[new Map,new Map],this._basemapLayerViewHandles=new Map,this._handles=new Ri,this._watchUpdatingTracking=new Yy,this._frameTask=FP,this._allTiles=new dr,this._upsampleInfoPool=new il(y7t),this._rootTilesExtent=lr(),this.updatingProgress=.5,this._maxNumUpdating=1,this.maxTextureScale=1.2,this._spatialReference=dt.WebMercator,this.visibleElevationBounds=new sA(1/0,-1/0),this.rootTileElevationBounds=new sA(1/0,-1/0),this._updatingRootTiles=!1,this._pendingTilesForElevationUpdateEvent=new Set,this._pendingTilesToUpdate=new Set,this.totalGeometryUpdates=0,this.totalTileUpdates=0,this.oneBatchPerFrameTask=!0,this._layerViewsDirty=!1,this.unloadedMemory=0,this.ignoresMemoryFactor=!1,this._isWebMercator=!1,this._isWebMercatorOnPlateeCarree=!1,this.overlayManager=new ac({...e,surface:this}),this._isGlobal=!((i=(r=e.view)==null?void 0:r.state)!=null&&i.isLocal)}initialize(){this._lercDecoder=vBt(this.view.resourceController),this._tilePool=this.view.state.isLocal?new il(sGt):new il(aGt);const e=this.view.resourceController.memoryController;this._upsampleMapCache=e.newCache("terrain-upsample",o=>o.unloadMapData()),this._elevationQueryCache=new gBt(e.newCache("elevation-query")),this._handles.add([pe(()=>this.overlayManager.hasHighlights,o=>this._renderer.setNeedsHighlight(o)),pe(()=>this.overlayManager.rendersOccluded,o=>this._renderer.setRenderOccludedOverlay(o)),pe(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager"),this._renderer=new $u({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:Xr(this.view.spatialReference).radius,_stage:this.view._stage,_allTiles:this._allTiles}),this._handles.add([pe(()=>this.baseOpacity,()=>{this._handleLayerViewChanges(),this._updateTileTextures(this._evaluateTransparency()?mo.UNFADED:mo.IMMEDIATE)},Bi),pe(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?mo.UNFADED:mo.IMMEDIATE),Bi),pe(()=>this.renderingDisabled,()=>{var o,a;return(a=(o=this.view)==null?void 0:o._stage)==null?void 0:a.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled})},li),pe(()=>this.backgroundColor,o=>{this._handleLayerViewChanges(),this._renderer.updateTileBackground(o)},Bi),pe(()=>this.snapLevel,()=>this._viewChanged=!0,li),pe(()=>this.view.pointsOfInterest,o=>{this._renderer.pointsOfInterest=o,this._watchUpdatingTracking.removeAll(),o&&this._watchUpdatingTracking.add(()=>o.focus.renderLocation,()=>this._allTilesSorted=!1)}),pe(()=>Di.TERRAIN_TILE_TREE_SHOW_TILES,o=>{o&&!this._treeDebugger?le(()=>import("./TerrainTileTree3DDebugger-7960a279.js"),["assets/TerrainTileTree3DDebugger-7960a279.js","assets/TileTreeDebugger-3f75e0c2.js"]).then(({TerrainTileTree3DDebugger:a})=>{!this._treeDebugger&&Di.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new a({view:this.view}))}):o||(this._treeDebugger=qe(this._treeDebugger))},_r)]);const{spatialReference:r}=this.view;this._extentHelper=LBt(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:r});const i=new RN({getCollections:()=>{var o,a,l;return(l=(a=(o=this.view)==null?void 0:o.defaultsFromMap)==null?void 0:a.mapCollections)==null?void 0:l.map(({layers:c})=>c)},getChildrenFunction:o=>o&&"layers"in o?o.layers:null}),n=new cy({layers:i,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:r});this._set("tilingSchemeLogic",n),this._updateTilingScheme(),this._elevationDataRequester=this.view.resourceController.createStreamDataRequester($y.ELEVATION),this._mapDataRequester=this.view.resourceController.createStreamDataRequester($y.BASEMAP);const s=this.view.resourceController.scheduler;this._frameTask=s.registerTask(Vt.TERRAIN_SURFACE,this),this._handles.add([pe(()=>this._extentHelper.stencilEnabledExtents,o=>this._renderer.setStencilEnabledLayerExtents(o),_r),pe(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),li),pe(()=>this.extent,()=>this._updateRootTiles(),_r),this.view.on("resize",()=>this._viewChangeUpdate()),pe(()=>{var l,c;const o=this.view,a=o.state;return[this._lodBias,this.lodSnapping,(c=(l=o.resourceController)==null?void 0:l.memoryController)==null?void 0:c.memoryFactor,a.camera,a.contentCamera,a.fixedContentCamera]},()=>this._viewChangeUpdate(),Bi),pe(()=>{var o,a;return(a=(o=this.view.qualitySettings)==null?void 0:o.tiledSurface)==null?void 0:a.textureFadeDuration},o=>this._renderer.textureFadingEnabled=o>0,_r),pe(()=>{var o;return(o=this.view.qualitySettings)==null?void 0:o.physicallyBasedRenderingEnabled},o=>this._renderer.pbrMode=o?Nt.Terrain:Nt.Disabled,_r),pe(()=>this._userClippingExtent,()=>this._updateClippingExtent(),li)]),this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0)),this._layerViewsDirty=!0,this._handleLayerViewChanges()}destroy(){this._frameTask.remove(),this._handles.destroy(),this._watchUpdatingTracking.destroy(),this._lercDecoder=xn(this._lercDecoder),this._removeAllTiles(),this._upsampleMapCache=qe(this._upsampleMapCache),this._elevationQueryCache=qe(this._elevationQueryCache),this._set("tilingSchemeLogic",qe(this.tilingSchemeLogic)),this._basemapLayerViewHandles.forEach((e,r)=>this._unregisterTiledLayerView(r)),this._elevationDataRequester=null,this._mapDataRequester=null,this._set("overlayManager",qe(this.overlayManager)),this._tilePool=qe(this._tilePool),Jpe.prune(),this._treeDebugger=qe(this._treeDebugger),this._renderer=qe(this._renderer),this._iteratorPool=qe(this._iteratorPool),this._set("view",null),this._extentHelper=qe(this._extentHelper),this._upsampleInfoPool=qe(this._upsampleInfoPool),ABt(),xjt()}get renderer(){return this._renderer}get frustum(){return this._frustum}get snapLevel(){var e,r;if(this.lodSnapping===bD.ON){const i=this.view,n=this.tilingScheme,s=(r=(e=i.pointsOfInterest)==null?void 0:e.cameraOnSurface)==null?void 0:r.scale;if(n&&s){const o=i.state.contentCamera;let a=dH(i,o.eye,o.viewForward,o.up).tilt;a>90&&(a=180-a);const l=2*(a/90)**2,c=n.levelAtScale(s)-l,u=Math.min(c,this._splitLimits.maxLod||1/0);return u<=0?null:u}}return null}get lodSnapping(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?bD.ON:bD.OFF}get upsampleInfoPool(){return this._upsampleInfoPool}get upsampleMapCache(){return this._upsampleMapCache}get elevationQueryCache(){return this._elevationQueryCache}get mapTileRequester(){return this._mapDataRequester}get _userClippingExtent(){const{spatialReference:e}=this,{clippingArea:r}=this.view;if(r==null||e==null)return null;const i=lr(),n=Rje(r,i,e)?i:null,s=this._get("extent");return v2(n,s)?s:n}get rootTilesExtent(){return this._rootTilesExtent}get extent(){const e=WQ(this.groundExtent,this._userClippingExtent,lr()),r=this._get("extent");return v2(e,r)?r:e}get groundExtent(){return this._tilingSchemeExtent!=null?this._tilingSchemeExtent:this._rootTilesExtent}get _tilingSchemeExtent(){var e;return(e=this.tilingSchemeLogic)==null?void 0:e.extent}get updating(){var e,r;return this._hasPendingUpdates||(this._maxNumUpdating=1),!!((this.running||(e=this._watchUpdatingTracking)!=null&&e.updating||this._asyncWorkItems>0)&&this.ready&&!this.suspended||(r=this.overlayManager)!=null&&r.updating)}get running(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}get updatingProgressValue(){return this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating),1-this._pendingUpdates/this._maxNumUpdating}get baseOpacity(){var e,r,i;return((i=(r=(e=this.view)==null?void 0:e.map)==null?void 0:r.ground)==null?void 0:i.opacity)??1}set baseOpacity(e){this.view.map.ground.opacity=e}get viewingMode(){return this.view.state.viewingMode}get ready(){return this._rootTiles!=null}set renderOrder(e){this._renderer.renderOrder=e,this._set("renderOrder",e)}get rootTiles(){return this._rootTiles}get spatialReference(){var e;return((e=this.tilingScheme)==null?void 0:e.spatialReference)??null}get backgroundColor(){return this.view.map.ground.surfaceColor}set backgroundColor(e){this.view.map.ground.surfaceColor=e}set slicePlaneEnabled(e){this._renderer.slicePlaneEnabled=e,this._set("slicePlaneEnabled",e),this._evaluateTransparency()}get tilingSchemeLocked(){var e;return((e=this.tilingSchemeLogic)==null?void 0:e.tilingSchemeLocked)??!1}get wireframe(){var e;return(e=this._renderer)==null?void 0:e.wireframe}set wireframe(e){e!==this._renderer.wireframe&&(this._renderer.wireframe=e,this._updateAllTileGeometries())}set _visible(e){e!==this._visibleCached&&(this._visibleCached=e,this._renderer.setVisibility(e),this.suspended=!e)}get opaque(){return this._renderer.transparency===$o.Opaque}set suspended(e){this._set("suspended",e),this._viewChangeUpdate()}get textureFadeDuration(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??0}intersect(e,r,i,n){this._renderer.intersect(e,r,i,n)}getElevation(e,r,i,n){const s=this._rootTiles;if(s==null||!s.length||s[0].layerInfo[Er.ELEVATION].length===0)return null;const o=kc;return o[0]=e,o[1]=r,o[2]=i,Ys(o,n,o,this._spatialReference)?PEe(s,o[0],o[1]):(re.getLogger(this).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null)}getElevations(e,r,i){const n=this._rootTiles,s=n?n[0].layerInfo[Er.ELEVATION].length:0;if(n!=null&&n.length&&s!==0)for(let o=0;o<r;++o){const a=3*o;i(o,PEe(n,e[a],e[a+1]))}else for(let o=0;o<r;++o)i(o,null)}getScale(e){if(!this.tilingScheme)return null;if(!Na(e,kc,this.spatialReference))return re.getLogger(this).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;const r=this._rootTiles;if(r!=null){for(const i of r)if(i!=null&&i.containsPoint(kc)){let n=i;for(;n.children[0]&&!n.rendered;){const s=n.children[0].extent;let o=0;kc[0]>s[2]&&(o+=1),kc[1]<s[1]&&(o+=2),n=n.children[o]}return this._getLodBiasCorrectedScale(n.level)}}return 1/0}getSphereElevationBounds(e,r){var a;if(kc[0]=e[0],kc[1]=e[1],kc[2]=e[2],kc[3]=e[3],!Ys(kc,r,kc,(a=this.tilingScheme)==null?void 0:a.spatialReference))return re.getLogger(this).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let i=1/0,n=-1/0;const s=l=>{if(l&&yve(l.extent,kc))if(l.isLeaf||l.rendered)i=Math.min(i,l.elevationBounds[0]),n=Math.max(n,l.elevationBounds[1]);else for(const c of l.children)s(c)},o=this._rootTiles;if(o!=null)for(const l of o)s(l);return{min:i,max:n}}getSphereScale(e,r){if(!this.tilingScheme)return null;if(!Na(e,kc,this.spatialReference))return re.getLogger(this).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;kc[3]=r;let i=null;const n=o=>{if(o&&yve(o.extent,kc)){const a=o.children;if(a[0]&&!o.rendered)for(const l of a)n(l);else{const l=this._getLodBiasCorrectedScale(o.level);i=i==null?l:Math.min(i,l)}}},s=this._rootTiles;if(s!=null)for(const o of s)n(o);return i}queryVisibleScaleRange(e,r,i,n){const s=r?this.tilingScheme.levelAtScale(r):0,o=i?this.tilingScheme.levelAtScale(i):1/0,a=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(e,s+a,o+a,n)}_evaluateTransparency(){var o,a;const e=this.baseOpacity,r=this.overlayManager.renderer.isEmpty,i=this._renderer.transparency,n=this._allSurfaceLayersTransparent()?r?$o.Empty:$o.TransparentWithDraped:e>=1&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?$o.Opaque:$o.Semitransparent,s=i!==n;return s&&(this._renderer.transparency=n,(a=(o=this.view)==null?void 0:o._stage)==null||a.renderer.setParameters({terrainTransparency:this._renderer.transparency})),s}_updateTilingScheme(){var i,n,s;const e=this.tilingSchemeLogic.tilingScheme;if(e===this.tilingScheme)return;xy(!!e,"tiling scheme cannot be reset to undefined"),this._isGlobal=!((n=(i=this.view)==null?void 0:i.state)!=null&&n.isLocal),this.tilingScheme&&this._removeAllTiles();const r=(e==null?void 0:e.spatialReference)??dt.WebMercator;this._spatialReference=r,this._isWebMercator=!!(r!=null&&r.isWebMercator),this._isWebMercatorOnPlateeCarree=this._isWebMercator&&wN((s=this.view)==null?void 0:s.renderSpatialReference),this._set("tilingScheme",e),this._updateClippingExtent(),e&&(this._updateTiledLayers(),this._renderer.setTileSize(e.pixelSize),this.overlayManager.setSpatialReference(e.spatialReference),this._updateRootTiles())}_acquireTile(e,r,i,n){const s=this._tilePool.acquire();return rU[0]=e,rU[1]=r,rU[2]=i,s.init(rU,n,this),s}get updatingRootTiles(){return this._updatingRootTiles}_updateRootTiles(){const{extent:e,tilingScheme:r}=this;if(!r)return;const i=b7t;let n=r.rootTilesInExtent(e,i,5*WO);if(this._rootTiles!=null){if(n.length>WO)return void re.getLogger(this).warn(wEt);const s=this._rootTiles.map(a=>a.lij),o=zct(s,n,AEe);if(this._updatingRootTiles=!0,o.removed.length>0||o.added.length>0){const a=this._rootTiles.filter(l=>!(o.removed.findIndex(c=>AEe(c,l.lij))>-1)||(this._purgeTile(l),!1));o.added.forEach(l=>a.push(this._newRootTile(l))),this._setRootTiles(a)}}else this._updatingRootTiles=!0,n.length>WO&&(re.getLogger(this).warn(xEt),n=r.rootTilesInExtent(e,i,WO)),this._setRootTiles(n.map(s=>this._newRootTile(s)));v2(i,this._rootTilesExtent)||(this._rootTilesExtent=lr(i)),this._visible=!0,this._viewChangeUpdate(),this.overlayManager.setPlacementDirty(),this.notifyChange("ready"),this._updateAllTileGeometries(),this._updatingRootTiles=!1,this.checkAllTilesWaterproofness()}_updateAllTileGeometries(){const e=this._allTiles.filter(r=>r.isLoaded&&r.intersectsClippingArea);e.forEach(r=>this._renderer.updateTileGeometryState(r)),e.forEach(r=>r.renderData.updateNeighborData()),this._updateTilesGeometries(e),this._pendingTilesToUpdate.clear()}_updateTilesGeometries(e){if(e.length===0)return;e.sort(d_);const r=this.renderer;e.forEach(i=>r.updateGeometryIfNeeded(i)),e.forEach(i=>this._pendingTilesForElevationUpdateEvent.add(i))}_shouldSplit(e){return e.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===qt.SPLIT}_newRootTile(e){const r=this._acquireTile(0,e[1],e[2],null);return this._shouldSplit(r)&&r.setPendingUpdate(qt.SPLIT),this._loadTile(r),this._markTileToUpdate(r),this._updateRootTileElevationBounds(),r}_setRootTiles(e){if(this._rootTiles=e,this._allTiles.clear(),e!=null){const r=this._iteratorPool.acquire();for(r.reset(e);!r.done;)this._allTiles.push(r.next());r.remove()}this._renderer.setRootTiles(this._rootTiles),this._updateTilesVisibility(e)}_runViewChangeUpdateIfDirty(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())}_viewChangeUpdate(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))}_updateClippingStatus(e){e.updateClippingStatus(this.extent)&&e.resetPendingUpdate(qt.GEOMETRY)&&this._updateTileGeometryState(e)}_updateTilesVisibility(e){if(e==null)return;const r=ejt(e),i=this.visibleElevationBounds;let n=r?i.min:1/0,s=r?i.max:-1/0;const o=this.extent,a=this._viewProjectionMatrix;this.setTileTreeDirty();const l=this._iteratorPool.acquire();for(l.reset(e);!l.done;){const c=l.next();c.updateClippingStatus(o)&&c.resetPendingUpdate(qt.GEOMETRY)&&this._updateTileGeometryState(c),c.setPendingUpdate(qt.RENDERDATA),c.computeVisibility(),c.updateScreenDepth(a),c.renderData&&(n=Math.min(c.elevationBounds[0],n),s=Math.max(c.elevationBounds[1],s))}l.remove(),this._viewChanged=!0,this._allTilesDirty=!0,this._batchUpdatePendingTileGeometries(),isFinite(n)&&isFinite(s)&&(i.min!==n||i.max!==s)&&(this.visibleElevationBounds=new sA(n,s))}_updateRootTileElevationBounds(){let e=1/0,r=-1/0;const i=this._rootTiles;i!=null&&i.forEach(({elevationBounds:s})=>{e=Math.min(e,s[0]),r=Math.max(r,s[1])});const n=this.rootTileElevationBounds;n.min===e&&n.max===r||(this.rootTileElevationBounds=new sA(e,r))}_updateViewDependentParameters(){const{camera:e,contentCamera:r}=this.view.state,i=Math.tan(.5*r.fovX),n=Math.tan(.5*r.fovY),s=this.tilingScheme.pixelSize,o=2**-this._lodBias*e.pixelRatio;this._splitLimits.aboveGround=e.aboveGround,this._splitLimits.fovX=i,this._splitLimits.fovY=n,this._splitLimits.relativeWidthLimit=s/e.width*this.maxTextureScale*o,this._splitLimits.relativeHeightLimit=s/e.height*this.maxTextureScale*o,this._splitLimits.maxLod=this.tilingScheme.getMaxLod(),this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias,this.view.state.fixedContentCamera?(this._splitLimits.frustum==null&&(this._splitLimits.frustum=LN()),lB(this._splitLimits.frustum,r.frustum)):this._splitLimits.frustum=null,lB(this._frustum,e.frustum),Ii(this._viewProjectionMatrix,r.projectionMatrix,r.viewMatrix),oe(this._eyePosRenderSR,r.eye),Ys(e.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)}_updateRenderData(e){e.rendered&&!e.shouldLoad&&(zGe(e)?this._loadChildren(e):_7t(e)&&this._loadParent(e))}_updateTileGeometryState(e){e.updateVisibility(),this._renderer.updateTileGeometryState(e)&&this._markTileToUpdate(e),this._usedMemory=null}_markAllTileNeighborsForGeometryUpdate(e){const r=this._pendingTilesToUpdate;e.forEachLoadedNeighbor(i=>{r.add(i)})}_updateTileTexture(e,r){const i=e.resetPendingUpdate(qt.TEXTURE_FADING)?qt.TEXTURE_FADING:!!e.resetPendingUpdate(qt.TEXTURE_NOFADING)&&qt.TEXTURE_NOFADING;i&&(this._renderer.updateTileTexture(e,i),this._usedMemory=null,r.madeProgress())}_emitElevationUpdateEventForTiles(){const e=ZZ.extent;xd(e),this._pendingTilesForElevationUpdateEvent.forEach(r=>Fw(e,r.extent,e)),this._pendingTilesForElevationUpdateEvent.clear(),ZZ.spatialReference=this.spatialReference,this.emit("elevation-change",ZZ)}runTask(e){this._handleLayerViewChanges(e),this._frameTask.processQueue(e),this.renderer.processScaleRangeQueries(this._scaleRangeQueries,e),this._inFrameTask=!0,this._pendingUpdates=0,this._hasPendingUpdates=!1,this._updateAllTilesStatus(e),this._sortTiles(e);const r=!this.view.state.fixedContentCamera;this._mergeAndSplit(e,r),this._updateElevation(e),this._updateTextures(e),r||this._mergeAndSplit(e,!0),this._inFrameTask=!1,this._runViewChangeUpdateIfDirty(),this._batchUpdatePendingTileGeometries(),this._emitElevationUpdateEventForTiles(),e.done&&e.hasProgressed&&this.requestUpdate(),this.notifyChange("updatingProgressValue")}_updateAllTilesStatus(e){if(!this._viewChanged||!this._rootTiles||e.done)return;this._viewChanged=!1;const r=this._iteratorPool.acquire();r.reset(this._rootTiles);const i=this.snapLevel,n=this._splitLimits,s=this._eyePosRenderSR;for(;!r.done;){const o=r.next(),a=o.shouldSplit(n,s,i);if(a!==qt.SPLIT){if(o.resetPendingUpdate(qt.SPLIT)&&o.updateAgentSuspension(),a===qt.ELEVATION&&o.updateAgents(Er.ELEVATION),r.skipSubtree(),!o.isLeaf){o.setPendingUpdate(qt.MERGE),o.resetPendingUpdate(qt.SPLIT);const l=this._iteratorPool.acquire();l.resetOne(o);const c=this._viewProjectionMatrix;for(let u=l.next();!l.done;u=l.next())this._updateClippingStatus(u),u.updateVisibility(),u.updateScreenDepth(c);l.remove()}}else o.resetPendingUpdate(qt.MERGE),o.isLeaf&&(o.setPendingUpdate(qt.SPLIT),r.skipSubtree()),o.rendered&&o.setPendingUpdate(qt.RENDERDATA)}r.remove(),this.requestUpdate(),(this.shortBatches||!this.oneBatchPerFrameTask)&&this._batchUpdatePendingTileGeometries(),e.madeProgress()}_sortTiles(e){e.done||this._allTilesSorted||(KBt(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),e.madeProgress())}_markTileToUpdate(e){Ne(e.isLoaded),e.intersectsClippingArea&&(this._pendingTilesToUpdate.add(e),this._markAllTileNeighborsForGeometryUpdate(e))}_batchUpdatePendingTileGeometries(){const e=this._pendingTilesToUpdate;if(e.size===0)return;const r=Array.from(this._pendingTilesToUpdate.keys()).filter(s=>s.isLoaded&&s.intersectsClippingArea),i=(s,o)=>{!(o!=null&&o.isLoaded)||!o.intersectsClippingArea||o.level<s.level||e.has(o)||(e.add(o),r.push(o),o.renderData.updateNeighborData())};r.sort(d_);const n=r.length;for(let s=0;s<n;++s){const o=r[s];Ne(o.isLoaded),Ne(o.intersectsClippingArea);const a=o.renderData;a.updateNeighborData();const l=a._dirtyEdgeResolutions,c=a.geometryState.neighborData.cornerPeerNeighbors,u=h=>{var m;const f=a4[h];i(o,(m=c[h])==null?void 0:m.findCorner(gj(f),g=>g.isLoaded))};for(let h=0;h<4;++h)if(l&1<<h){const f=a.geometryState.neighborData.edgePeerNeighbors[h];f&&(f==null?void 0:f.level)>=o.level&&f.forAllSubtreeOnSide(yj(Fy[h]),m=>!(!m.isLoaded||!m.intersectsClippingArea)&&(Ne(e.has(m)||d_(o,m)<0),i(o,m),!0)),u((h+1)%4),u(h)}}e.clear(),this._updateTilesGeometries(r),_o&&pj&&this.checkAllTilesWaterproofness()}_mergeAndSplit(e,r){if(this.suspended||e.done||!this._allTilesDirty)return;this._allTilesDirty=!1,this.requestUpdate();let i=!1;const n=this.view.state.fixedContentCamera;let s=!1;for(;!e.done;){s=!0;let o=!1;const a=!this._allTiles.some(l=>{var u;if(!i&&!n&&!l.visible)return e.done;let c=l;if(l.resetPendingUpdate(qt.MERGE)){if(!r)return l.setPendingUpdate(qt.MERGE),e.done;for(;(u=c.parent)!=null&&u.resetPendingUpdate(qt.MERGE);)c=c.parent;this._mergeTile(c),o=!0,e.madeProgress()}else l.resetPendingUpdate(qt.SPLIT)&&(this._splitTile(l),o=!0,e.madeProgress());return!e.done&&c===l&&l.resetPendingUpdate(qt.RENDERDATA)&&(this._updateRenderData(l),e.madeProgress()),e.done});if(o&&(this._allTilesSorted=!1,this._allTilesDirty=!0),a){if(!i){i=!0;continue}if(!o)break}else this._allTilesDirty=!0}s?e.madeProgress():this._allTilesDirty=!0,!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries(),this._sortTiles(e)}_updateElevation(e){e.done||(this._allTiles.some(r=>(r.resetPendingUpdate(qt.GEOMETRY)&&(this._updateTileGeometryState(r),this._updateTileTexture(r,e),this.shortBatches&&this._batchUpdatePendingTileGeometries(),e.madeProgress()),e.done)),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())}_updateTextures(e){e.done||this._allTiles.some(r=>(this._updateTileTexture(r,e),e.done))}_updateClippingExtent(){this.spatialReference&&(this.updateTileOverlayParams(is.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())}get _lodBias(){const e=this.view.resourceController.memoryController.memoryFactor;return this.view.qualitySettings.tiledSurface.lodBias-(1-e)*_Et}_getLodBiasCorrectedScale(e){const r=this.tilingScheme.levels,i=Te(e-this._lodBias,0,r.length-1),n=i-Math.floor(i);return r[Math.floor(i)].scale*(1-n)+r[Math.ceil(i)].scale*n}_removeAllTiles(){this._rootTiles!=null&&(this._rootTiles.forEach(e=>this._purgeTile(e)),this._setRootTiles(null),this.notifyChange("ready")),this._allTiles.clear(),this._visible=!1}_purgeDescendantTiles(e){if(!e.children[0])return!1;let r=!1;for(let i=0;i<4;++i)r=this._purgeTile(e.children[i])||r;return e.unsetChildren(),r}_purgeTile(e){const r=this._purgeDescendantTiles(e)||e.rendered;return this._allTiles.removeUnordered(e),this._unloadTile(e),this._tilePool.release(e),r}_unloadTile(e){this._pendingTilesToUpdate.delete(e),this._pendingTilesForElevationUpdateEvent.delete(e),e.unload(this._renderer)}_splitTile(e){xy(e.isLeaf,"tile that is already split should not be split again!");const r=e.level+1,i=2*e.lij[1],n=2*e.lij[2];e.setChildren(this._createTile(r,i,n,e),this._createTile(r,i,n+1,e),this._createTile(r,i+1,n,e),this._createTile(r,i+1,n+1,e)),e.setPendingUpdate(qt.RENDERDATA),e.updateAgentSuspension(),this._allTiles.pushArray(e.children),this._allTilesDirty=!0,++this._performanceInfo.numSplit}_emitTileScaleChange(e,r=e.level){iU.spatialReference=this.spatialReference,iU.extent=e.extent,iU.scale=this._getLodBiasCorrectedScale(r),this.emit("scale-change",iU)}_createTile(e,r,i,n){xy(!!n,"_createTile sanity check");const s=this._acquireTile(e,r,i,n);return s.updateClippingStatus(this.extent),s.updateScreenDepth(this._viewProjectionMatrix),this._shouldSplit(s)&&s.setPendingUpdate(qt.SPLIT),s}get shortBatches(){return this.view.state.mode!==ai.IDLE}_mergeTile(e){xy(!e.hasPendingUpdate(qt.SPLIT),"_mergeTile sanity check"),this._purgeDescendantTiles(e)&&(xy(!e.renderData,"_mergeTile sanity check"),this._loadTile(e),this._markTileToUpdate(e),this._emitTileScaleChange(e),this.shortBatches&&this._batchUpdatePendingTileGeometries()),this._allTilesDirty=!0,++this._performanceInfo.numMerged}_loadChildren(e){xy(e.rendered,"parent should be rendered"),this._unloadTile(e);const r=e.children;r.forEach(i=>this._loadTile(i)),r.forEach(i=>this._pendingTilesToUpdate.add(i)),this._markAllTileNeighborsForGeometryUpdate(e),this._emitTileScaleChange(e,e.level+1),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_loadParent(e){const r=e.parent;this._unloadChildren(r),this._loadTile(r),this._markTileToUpdate(r),this._emitTileScaleChange(r,r.level),this.shortBatches&&this._batchUpdatePendingTileGeometries()}_unloadChildren(e){const r=e.children;if(r[0])for(let i=0;i<4;++i){const n=r[i];this._unloadChildren(n),this._unloadTile(n)}}_loadTile(e){e.load(),e.setPendingUpdate(qt.RENDERDATA),this.requestUpdate(),this._allTilesDirty=!0,this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(e)}_elevationDataArrived(e,r,i){const n=new $Bt(e.lij,e.extent,i);e.dataArrived(r,Er.ELEVATION,n);const s=[e],o=e.level,a=this._iteratorPool.acquire();for(a.reset(s);!a.done;){const l=a.next();l.findElevationBoundsForLayer(r,o),l.computeElevationBounds()}o===0&&this._updateRootTileElevationBounds(),a.remove(),this._updateTilesVisibility(s)}_handleLayerViewChanges(e=bc){if(!this._layerViewsDirty)return;this._layerViewsDirty=!1;let r=!1;const i=new Set;let n=-1;for(const s of this.view.allLayerViews.items)if(i.add(s.uid),o4(s)||v$(s))if(this._basemapLayerViewHandles.has(s.uid)&&!v$(s)){const o=this._layerClassFromLayerView(s),a=this._getLayerIdxByUID(o,s.uid);a!=null&&((a<n||n==null)&&(r=!0),n=a)}else this._registerTiledLayerView(s),s.layer.loaded&&(r=!0);this._basemapLayerViewHandles.forEach((s,o)=>{i.has(o)||(this._unregisterTiledLayerView(o),r=!0)}),r&&this._updateTiledLayers(),this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._evaluateTransparency(),e.madeProgress()}_allSurfaceLayersTransparent(){var r,i;let e=((i=(r=this.view.map)==null?void 0:r.ground)==null?void 0:i.opacity)===0;for(const n of this.view.allLayerViews.items)if($ne(n)&&!JIe(n.layer)&&n.fullOpacity!==0)return e=!1,e;return e}_hasCompositeBlendMode(){for(const e of this.view.allLayerViews.items)if((mj(e)||v$(e))&&ojt(Fne[e.layer.blendMode]))return!0;return!1}_layerClassFromLayerView(e){return Mne(e)?Er.ELEVATION:Er.MAP}_registerTiledLayerView(e){const r=[];if((mj(e)||v$(e))&&r.push(pe(()=>e.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode(),this._updateTileTextures(mo.UNFADED)})),!v$(e)){const i=this._layerClassFromLayerView(e);r.push(pe(()=>e.suspended,()=>this._updateTiledLayers())),r.push(pe(()=>e.fullOpacity,()=>this._updateTileTextures(mo.UNFADED))),r.push(pe(()=>"effectiveScaleRange"in e.layer?e.layer.effectiveScaleRange:null,()=>this._restartAllAgents(i))),r.push(e.on("data-changed",()=>{const n=this._getLayerIdxByUID(i,e.uid);n!=null&&this._invalidateLayerData(n,i)}))}this._unregisterTiledLayerView(e.uid),this._basemapLayerViewHandles.set(e.uid,r)}_unregisterTiledLayerView(e){const r=this._basemapLayerViewHandles.get(e);if(r){for(const i of r)i.remove();this._basemapLayerViewHandles.delete(e)}}_updateTiledLayers(){if(!this.tilingScheme||this.view.suspended)return;const e=this.view.allLayerViews,r=[[],[]];let i=null;e.forEach(n=>{if(!n.layer||n.suspended||!o4(n)||!n.fullExtent)return;const s=this._layerClassFromLayerView(n);if(s===Er.MAP){const o=n.displayLevelRange.maxLevel;o!==1/0&&(i===null||o>i)&&(i=o)}r[s].push(n)});for(const n of lT){const s=this._layerViews[n],o=r[n];o.reverse();const a=o.length;let l=s.length!==a;const c=new Array(a),u=new Array(s.length);this._layerIndexByUid[n].clear();for(let h=0;h<a;h++){const f=o[h].uid;this._layerIndexByUid[n].set(f,h);const m=s.indexOf(o[h]);c[h]=m,h!==m&&(l=!0),m>-1&&(u[m]=h)}if(l){const h=this._postorderIterator;for(h.reset(this._rootTiles);!h.done;)h.next().modifyLayers(u,c,n);this._layerViews[n]=o,this._restartAllAgents(n),this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(i)&&this._viewChangeUpdate()}_restartAllAgents(e){const r=this._postorderIterator;for(r.reset(this._rootTiles);!r.done;){const i=r.next();i.restartAgents(e),e===Er.ELEVATION&&i.computeElevationBounds()}this._updateRootTileElevationBounds()}layerViewByIndex(e,r){return this._layerViews[r][e]}numLayers(e){return this._layerViews[e].length}_updateTileTextures(e){this._allTiles.forAll(r=>{r.updateAgents(Er.MAP),e===mo.IMMEDIATE?this.renderer.updateTileTexture(r,qt.TEXTURE_NOFADING):r.updateRenderData(Er.MAP,e)}),this._evaluateTransparency()}_invalidateLayerData(e,r){this._allTiles.forAll(i=>i.removeLayerAgent(e,r)),this._allTiles.forAll(i=>i.invalidateLayerData(e,r))}setTileTreeDirty(){this._allTilesDirty=!0}requestRender(e=is.UPDATE){this.renderer.setNeedsRender(e)}requestUpdate(){++this._pendingUpdates==1&&(this._hasPendingUpdates=!0)}requestTileData(e,r,i,n){const s=this.layerViewByIndex(r,i),o=s.layer;return!o.tilemapCache||s4(s)?this._requestTileData(e,i,s,n):(++this._asyncWorkItems,o.tilemapCache.fetchAvailability(e.lij[0],e.lij[1],e.lij[2],{...n,timeout:6e3}).then(()=>--this._asyncWorkItems).catch(a=>{throw--this._asyncWorkItems,vr(n),Yn(a)||this._dataMissing(e,i,s,{notInTilemap:!0}),a}).then(()=>this._frameTask.schedule(()=>this._requestTileData(e,i,s,n),n.signal)))}_requestTileData(e,r,i,n){return r===Er.ELEVATION?Mne(i)?this._requestElevationTileData(e,i,n):Promise.reject():$ne(i)?this._requestMapTileData(e,i,n):Promise.reject()}_requestElevationTileData(e,r,i){++this._asyncWorkItems;const n=a=>{if(go(i))return;const l=this._layerIndexByUid[Er.ELEVATION].get(r.uid);l!=null?(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(e,l,a)):re.getLogger(this).warn("TerrainSurface: received data from unknown layer %d %s",Er.ELEVATION,e.lij.toString())},s=a=>{Yn(a)||(this._dataMissing(e,Er.ELEVATION,r,a),this.requestUpdate())};if(GTe(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],{noDataValue:zN,signal:i.signal}).then(a=>{if(!go(i))return this._frameTask.schedule(()=>n(a),i.signal,s);re.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.")},s).finally(()=>{--this._asyncWorkItems});const o=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);return this._elevationDataRequester.request(o,"binary",i).then(a=>this._lercDecoder.decode(a,{noDataValue:zN},i.signal)).then(a=>{a?n(new yBt(a)):s(new Error("LERC decoding failed"))},s).finally(()=>{--this._asyncWorkItems})}_requestMapTileData(e,r,i){++this._asyncWorkItems;const n=(u,h)=>{--this._asyncWorkItems,FA(h),go(i)||(this._dataMissing(e,Er.MAP,r,u),this.requestUpdate())},s=u=>h=>n(h,u),o=u=>this._frameTask.schedule(()=>{--this._asyncWorkItems,this.requestUpdate(),go(i)?FA(u):this._mapTileDataArrived(e,r,u)},i.signal,s(u)).catch(s(u)),a=(u,h=null)=>this._frameTask.schedule(()=>n(u,h));if(s4(r)){const u=r.schemaHelper.getLevelRowColumn(e.lij);return r.fetchTile(u[0],u[1],u[2],i).then(o,a)}if(cq(r))return r.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(o,a);if(qpe(r)&&GTe(r.layer))return r.layer.fetchTile(e.lij[0],e.lij[1],e.lij[2],i).then(u=>{if(go(i))return re.getLogger(this).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),void a(Wr());o(u)},a);let l=r.getTileUrl(e.lij[0],e.lij[1],e.lij[2]);mBt(r.layer)&&r.layer.refreshTimestamp&&(l+=`${l.includes("?")?"&":"?"}_ts=${r.layer.refreshTimestamp}`);const c=r.hasMixedImageFormats?"image+type":"image";return this._mapDataRequester.request(l,c,i).then(o,a)}_mapTileDataArrived(e,r,i){const n=this._getLayerIdxByUID(Er.MAP,r.uid);n!=null?e.dataArrived(n,Er.MAP,i):(FA(i),re.getLogger(this).warn("TerrainSurface: received data from unknown layer"))}_getLayerIdxByUID(e,r){return this._layerIndexByUid[e].get(r)}_dataMissing(e,r,i,n){const s=this._getLayerIdxByUID(r,i.uid);s!=null?e.dataMissing(s,r,n):re.getLogger(this).warn("TerrainSurface: received data from unknown layer")}updateTileOverlayParams(e){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(r=>{r.renderData&&this.overlayManager.setTileParameters(r)}),this._renderer.setNeedsRender(e))}get performanceInfo(){const e=this._performanceInfo;return e.numNodes=this._allTiles.length,e.numLeaves=e.numVisible=e.numRendered=e.numLoadedPerLevel.length=e.numRenderedPerLevel.length=0,this._allTiles.forAll(r=>{r.isLeaf&&e.numLeaves++;const i=r.level;r.renderData&&(e.numLoadedPerLevel[i]=(e.numLoadedPerLevel[i]||0)+1),r.visible&&(e.numVisible++,r.rendered&&(e.numRenderedPerLevel[i]=(e.numRenderedPerLevel[i]||0)+1,e.numRendered++))}),e}get usedMemory(){return this.tilingScheme?(this._usedMemory==null&&(this._usedMemory=this._recalculateUsedMemory()),this._usedMemory!=null?this._usedMemory:0):0}_recalculateUsedMemory(){return this.tilingScheme?this._allTiles.reduce((e,r)=>e+r.usedMemory,0):null}getUsedMemoryForLayerView(e){let r=this.overlayManager.gpuMemoryUsage;const i=this._layerClassFromLayerView(e),n=this._getLayerIdxByUID(i,e.uid);return n!=null&&this._allTiles.forAll(s=>r+=s.getUsedMemoryForLayer(i,n)),r}getTile(e){if(e==null||this._rootTiles==null)return null;const r=e.split("/").map(a=>+a);if(r[0]===0)return this._rootTiles.find(a=>a.lij[1]===r[1]&&a.lij[2]===r[2]);const i=2**r[0],n=Math.floor(r[1]/i),s=Math.floor(r[2]/i);let o;if(this._rootTiles.some(a=>a.lij[1]===n&&a.lij[2]===s&&(o=a,!0)),o){let a=1<<r[0]-1;for(;o.lij[0]<r[0];){let l=r[1]&a?2:0;if((r[2]&a)>0&&l++,!o.children[l])return null;o=o.children[l],a>>=1}return xy(o.lij[0]===r[0]&&o.lij[1]===r[1]&&o.lij[2]===r[2],"not the right tile?"),o}return null}get renderPatchBorders(){return this._renderer.renderPatchBorders}set renderPatchBorders(e){this._renderer.renderPatchBorders=e}get visualizeNormals(){return this._renderer.visualizeNormals}set visualizeNormals(e){this._renderer.visualizeNormals=e}get renderingDisabled(){return this._renderer.renderingDisabled}set renderingDisabled(e){this._renderer.renderingDisabled=e}get test(){const e=this;return{renderer:e._renderer,lercDecoder:e._lercDecoder,forceReload:()=>{e._rootTiles!=null&&e._rootTiles.length>0&&(e._mergeTile(e._rootTiles[0]),e._viewChangeUpdate())},getTiles:()=>e._allTiles.toArray(),getRenderedTiles(){YZ.clear(),e._allTiles.forAll(i=>{i.visible&&i.rendered&&YZ.push(i)});const r=YZ.toArray();return Kje(e.renderOrder,r),r},lockTilingScheme(r,i){e._extentHelper.defaultTiledLayersExtent=i,e.tilingSchemeLogic.test.lockTilingScheme(r)}}}checkAllTilesWaterproofness(){if(!pj)return;const e=this._rootTiles;if(e==null)return;const r=o=>{var a,l,c;return((c=(l=(a=o==null?void 0:o.renderData)==null?void 0:a.geometry)==null?void 0:l.indices)==null?void 0:c.length)>0},i=(o,a)=>{r(o)&&console.error("Tile[",o.lij,"] has geometry although parent[",a.lij,"] has geom")},n=o=>{var a,l;if(o.intersectsClippingArea)if(o.renderData&&!o.renderData.geometryState&&console.error("Tile[",o.lij,"] has renderData but not geometryState"),o.renderData&&!o.renderData.geometry&&console.error("Tile[",o.lij,"] has renderData but not geometryInfo"),!((a=o.renderData)!=null&&a.geometry)||(((l=o.renderData.geometry.indices)==null?void 0:l.length)??0)>0||console.error("Tile[",o.lij,"] has renderData but no indices - geometryInfo: ",o.renderData.geometry),r(o)){o.checkGeometryWaterproofness();for(const c of o.children)i(c,o)}else if(o.isLeaf)console.error("Tile[",o.lij,"] has no geometry and no children, from root to leaf");else for(const c of o.children)n(c)},s=o=>{var u;const a=((u=o.parent)==null?void 0:u.visible)??!0,l=o.visible;o.computeVisibility();const c=o.visible;if(l!==c&&a&&console.error(" Tile[",o.lij,"] has out of date visibility: ",l," instead of ",c),!o.isLeaf)for(const h of o.children)s(h)};for(const o of e)n(o),s(o)}get isGlobal(){return this._isGlobal}get isWebMercator(){return this._isWebMercator}get isWebMercatorOnPlateeCarree(){return this._isWebMercatorOnPlateeCarree}isEastEndWrap(e){return this.isGlobal&&e[2]===this.lijEastEnd(e[0])-1}isWestEndWrap(e){return this.isGlobal&&e[2]===0}lijEastEnd(e){return 2**(e+(this.spatialReference!=null&&this.spatialReference.isGeographic?1:0))}wrapEastWest(e){const r=this.lijEastEnd(e[0]),i=e[2];if(0<=i&&i<r)return e;if(!this.isGlobal)return null;const n=(i+(i<0?r:0))%r;return[e[0],e[1],n]}enableInternalChecks(e){NVt(e)}enableWaterproofnessChecks(e){DVt(e)}};d([p()],yr.prototype,"_renderer",void 0),d([p({constructOnly:!0})],yr.prototype,"_scaleRangeQueries",void 0),d([p({constructOnly:!0})],yr.prototype,"view",void 0),d([p({constructOnly:!0})],yr.prototype,"overlayManager",void 0),d([p()],yr.prototype,"_hasPendingUpdates",void 0),d([p()],yr.prototype,"_asyncWorkItems",void 0),d([p()],yr.prototype,"_allTilesDirty",void 0),d([p()],yr.prototype,"_allTilesSorted",void 0),d([p()],yr.prototype,"_viewChanged",void 0),d([p()],yr.prototype,"_splitLimits",void 0),d([p({readOnly:!0})],yr.prototype,"_watchUpdatingTracking",void 0),d([p()],yr.prototype,"_frameTask",void 0),d([p({readOnly:!0})],yr.prototype,"snapLevel",null),d([p({readOnly:!0})],yr.prototype,"lodSnapping",null),d([p()],yr.prototype,"_userClippingExtent",null),d([p()],yr.prototype,"_rootTilesExtent",void 0),d([p({readOnly:!0})],yr.prototype,"extent",null),d([p({readOnly:!0})],yr.prototype,"groundExtent",null),d([p({readOnly:!0})],yr.prototype,"_tilingSchemeExtent",null),d([p({readOnly:!0})],yr.prototype,"updating",null),d([p({readOnly:!0})],yr.prototype,"running",null),d([p(PBt)],yr.prototype,"updatingProgress",void 0),d([p({readOnly:!0})],yr.prototype,"updatingProgressValue",null),d([p()],yr.prototype,"_maxNumUpdating",void 0),d([p()],yr.prototype,"baseOpacity",null),d([p()],yr.prototype,"hasCompositeBlendMode",void 0),d([p({readOnly:!0})],yr.prototype,"viewingMode",null),d([p()],yr.prototype,"maxTextureScale",void 0),d([p({readOnly:!0})],yr.prototype,"ready",null),d([p({value:n3.FRONT_TO_BACK})],yr.prototype,"renderOrder",null),d([p({readOnly:!0})],yr.prototype,"rootTiles",null),d([p()],yr.prototype,"_rootTiles",void 0),d([p({readOnly:!0})],yr.prototype,"spatialReference",null),d([p({type:ht})],yr.prototype,"backgroundColor",null),d([p({value:!1})],yr.prototype,"slicePlaneEnabled",null),d([p({readOnly:!0})],yr.prototype,"tilingScheme",void 0),d([p({readOnly:!0})],yr.prototype,"tilingSchemeLocked",null),d([p({readOnly:!0})],yr.prototype,"tilingSchemeLogic",void 0),d([p()],yr.prototype,"wireframe",null),d([p({value:!1})],yr.prototype,"suspended",null),d([p()],yr.prototype,"textureFadeDuration",null),d([p()],yr.prototype,"visibleElevationBounds",void 0),d([p()],yr.prototype,"rootTileElevationBounds",void 0),d([p()],yr.prototype,"_layerViewsDirty",void 0),d([p()],yr.prototype,"renderPatchBorders",null),d([p()],yr.prototype,"visualizeNormals",null),d([p()],yr.prototype,"renderingDisabled",null),yr=d([I("esri.views.3d.terrain.TerrainSurface")],yr);const v7t=yr;function AEe(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function zGe(t){const e=t.children;if(!e[0])return!1;for(const r of e)if(r.shouldLoad)return!0;for(const r of e)if(zGe(r))return!0;return!1}function _7t(t){var e;return t.isLeaf&&(((e=t.parent)==null?void 0:e.shouldLoad)??!1)}const kc=wr(),b7t=lr(),rU=[0,0,0],YZ=new dr,ZZ={spatialReference:null,extent:lr(),context:"ground"},iU={spatialReference:null,extent:null,scale:0};function PEe(t,e,r){var i;for(const n of t){if(!n.containsPointXY(e,r))continue;let s=n;for(;s&&!s.renderData;){const a=(e>s.extentMidX?1:0)+(r<s.extentMidY?2:0);s=s.children[a]}const o=((i=s==null?void 0:s.renderData)==null?void 0:i.geometryState.samplerData)??null;return Ln(e,r,o)}return null}let w7t=class{constructor(e,r,i){this.operation=e,this.geometry=r,this.states=i}},oL=class extends Ce{constructor(e){super(e),this._residentGeomRecords=new Map,this._dirtyGeomRecords=new Map,this.dirty=!1}commitLayer(e,r){const i=this._dirtyGeomRecords.get(e);i&&(i.forEach((n,s)=>{const o=this._ensureGeomRecord(e,s);n.forEach(({geometry:a,operation:l,states:c},u)=>{let h=!1;if(l===An.UPDATE){const f=o.get(u);if(f){if(c&Lo.TRANSFORMATION){const m=this.model.getObject(s);this.model.updateRenderGeometryTransformation(m,a,f)&&(h=!0)}h||r.updates.push({renderGeometry:f,updateType:c})}else It(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(l===An.REMOVE||h){const f=o.get(u);f?(r.removes.push(f),o.delete(u)):l===An.REMOVE&&It(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove")}if(l===An.ADD||h){const f=this.model.getObject(s);if(f!=null){const m=this.model.getRenderGeometry(f,a);r.adds.push(m),o.set(u,m)}}}),o.size===0&&this._residentGeomRecords.get(e).delete(s)}),this._residentGeomRecords.get(e).size===0&&this._residentGeomRecords.delete(e),this._dirtyGeomRecords.delete(e),this.dirty=this._hasDirtyGeometryRecords)}getResidentRenderGeometries(e,r){const i=this._residentGeomRecords.get(e);i&&i.forEach(n=>n.forEach(s=>r.push(s)))}_objectStateChanged(e,r){for(const i of r.geometries)this._updateOrCreateDirtyRecord(r,i,null,An.UPDATE,e)}visibilityChanged(e){this._objectStateChanged(Lo.VISIBILITY,e)}highlightChanged(e){this._objectStateChanged(Lo.HIGHLIGHT,e)}occlusionChanged(e){this._objectStateChanged(Lo.OCCLUDEE,e)}objectGeometryUpdated(e){this._updateOrCreateDirtyRecord(e.object,e.geometry,null,An.UPDATE,Lo.GEOMETRY)}layerAdded(e){e.objects.forAll(r=>this._layerObjectAdded(e,r))}layerRemoved(e){e.objects.forAll(r=>this._layerObjectRemoved(e,r))}layerObjectAdded(e){this._layerObjectAdded(e.layer,e.object)}_layerObjectAdded(e,r){const i=e.id;for(const n of r.geometries)this._objectGeometryAdded(r,n,i)}layerObjectRemoved(e){this._layerObjectRemoved(e.layer,e.object)}layerObjectsAdded(e){for(const r of e.objects)this._layerObjectAdded(e.layer,r)}layerObjectsRemoved(e){for(const r of e.objects)this._layerObjectRemoved(e.layer,r)}_layerObjectRemoved(e,r){const i=e.id;for(const n of r.geometries)this._objectGeometryRemoved(r,n,i)}shaderTransformationChanged(e){const r=this._residentGeomRecords.get(e.id);r&&r.forEach((i,n)=>{const s=this.model.getObject(n);s&&s.hasVolativeTransformation()&&i.forEach(o=>o.shaderTransformationChanged())})}objectTransformation(e){const r=this._getParentLayerId(e),i=e.id;this._ensureGeomRecord(r,i).forEach(n=>{this._updateOrCreateDirtyRecord(e,n.geometry,r,An.UPDATE,Lo.TRANSFORMATION)})}objectShaderTransformation(){}objectGeometryAdded(e){this._objectGeometryAdded(e.object,e.geometry)}_objectGeometryAdded(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,An.ADD)}objectGeometryRemoved(e){this._objectGeometryRemoved(e.object,e.geometry)}_objectGeometryRemoved(e,r,i=null){this._updateOrCreateDirtyRecord(e,r,i,An.REMOVE)}_updateOrCreateDirtyRecord(e,r,i,n,s=Lo.NONE){i=i??this._getParentLayerId(e);const o=e.id,a=r.id,l=this._ensureDirtyRecord(i,o),c=l.get(a);if(c){const u=c.operation;u===An.REMOVE&&n===An.ADD&&c.states!==Lo.NONE?c.operation=An.UPDATE:u===An.REMOVE&&n===An.ADD||u===An.ADD&&n===An.REMOVE?l.delete(a):u!==An.UPDATE||n!==An.REMOVE&&n!==An.UPDATE?(It((u===An.REMOVE||u===An.ADD)&&n===An.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"),c.states|=s):(c.operation=n,c.states|=s)}else l.set(a,new w7t(n,r,s));this.dirty=this._hasDirtyGeometryRecords}_ensureGeomRecord(e,r){let i=this._residentGeomRecords.get(e);i||(i=new Map,this._residentGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}get _hasDirtyGeometryRecords(){return Pa(this._dirtyGeomRecords,e=>Pa(e,r=>r&&r.size>0))}_ensureDirtyRecord(e,r){let i=this._dirtyGeomRecords.get(e);i||(i=new Map,this._dirtyGeomRecords.set(e,i));let n=i.get(r);return n||(n=new Map,i.set(r,n)),n}_getParentLayerId(e){return e.parentLayer?e.parentLayer.id:bdt}formatDebugInfo(){const e=["ADD","UPD",void 0,"REM"];let r="";return this._dirtyGeomRecords.forEach((i,n)=>{i.forEach((s,o)=>{r.length>0&&(r+=`
`),r+=n+"."+o;const a=[];s.forEach(l=>{const c=l.operation;a[c]||(a[c]=[]),a[c].push(l.geometry.id)});for(let l=0;l<a.length;l++)if(a[l]){r+=" "+e[l-1]+": ";for(let c=0;c<a[l].length;c++)r+=a[l][c]+", "}})}),r}get test(){const e=this;return{get residentLayerCount(){return e._residentGeomRecords.size},get residentObjectCount(){return Array.from(e._residentGeomRecords.values()).reduce((r,i)=>r+i.size,0)},commit:r=>e._dirtyGeomRecords.forEach((i,n)=>e.commitLayer(n,r))}}};d([p({constructOnly:!0})],oL.prototype,"model",void 0),d([p()],oL.prototype,"dirty",void 0),oL=d([I("esri.views.3d.webgl-engine.lib.ModelDirtySet")],oL);const x7t=oL;let Wz=class extends Ce{constructor(){super(...arguments),this.dirtySet=new x7t({model:this}),this._content=new Map,this._originFactory=new cpe(null)}getObject(e){return this._content.get(e)}add(e){const r=e.id;It(!this._content.has(r),"Model/Stage already contains object to be added"),this._content.set(r,e),KB(e)&&this.dirtySet.layerAdded(e)}remove(e){It(this._content.has(e.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(e.id),e.unload(),KB(e)&&this.dirtySet.layerRemoved(e)}addMany(e){for(const r of e)r!=null&&(It(!this._content.has(r.id),"Model/Stage already contains object to be added"),this._content.set(r.id,r))}removeMany(e){for(const r of e)It(this._content.has(r.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(r.id),r.unload()}has(e){return this._content.has(e.id)}forEachOfType(e,r){this._content.forEach(i=>{i.type===e&&r(i)})}getRenderGeometry(e,r){const{shaderTransformer:i,localOrigin:n}=r,s=new i3(r,{shaderTransformer:i,castShadow:e.castShadow});return s.updateTransformation(o=>e.getCombinedStaticTransformation(r,o)),s.localOrigin=n??this._originFactory.getOrigin(s.boundingSphere),s}updateRenderGeometryTransformation(e,r,i){if(e==null)return!1;i.updateTransformation(s=>e.getCombinedStaticTransformation(r,s));const n=this._originFactory.getOrigin(i.boundingSphere);return i.localOrigin!==n}getStats(){const e={},r=Array.from(this._content.values());for(let i=0;i<Wn.COUNT;++i)e[i]=r.filter(n=>n.type===i).length;return{contentTypes:e,dirtySet:this.dirtySet.formatDebugInfo()}}get test(){return{content:Array.from(this._content.values())}}};d([p({constructOnly:!0})],Wz.prototype,"dirtySet",void 0),Wz=d([I("esri.views.3d.webgl-engine.parts.Model")],Wz);function VGe(){const t=new Float32Array(4);return t[3]=1,t}function BGe(t){const e=new Float32Array(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function S7t(t,e,r,i){const n=new Float32Array(4);return n[0]=t,n[1]=e,n[2]=r,n[3]=i,n}function jGe(t,e){return new Float32Array(t,e,4)}Object.freeze(Object.defineProperty({__proto__:null,clone:BGe,create:VGe,createView:jGe,fromValues:S7t},Symbol.toStringTag,{value:"Module"}));const s3=1e-6,S$=[0,0,0],nU=[0,0,0];function T7t(t,e){const{data:r,size:i}=t,n=r.length/i;if(n<=0)return;const s=new I7t(t);Xz(S$,s.minProj,s.maxProj),WT(S$,S$,.5),Ip(nU,s.maxProj,s.minProj);const o=Zne(nU),a=new L7t;a.quality=o,n<14&&(t=new ft(new Float64Array(s.buffer,112,42),3));const l=[0,0,0],c=[0,0,0],u=[0,0,0],h=[0,0,0],f=[0,0,0],m=[0,0,0],g=[0,0,0];switch(E7t(s,t,g,l,c,u,h,f,m,a)){case 1:return void LEe(S$,nU,e);case 2:return void $7t(t,h,e)}C7t(t,g,l,c,u,h,f,m,a),GGe(t,a.b0,a.b1,a.b2,zA,VA);const y=[0,0,0];Ip(y,VA,zA),a.quality=Zne(y),a.quality<o?HGe(a.b0,a.b1,a.b2,zA,VA,y,e):LEe(S$,nU,e)}function E7t(t,e,r,i,n,s,o,a,l,c){return R7t(t,i,n),Jne(i,n)<s3?1:(Ip(o,i,n),Za(o,o),O7t(e,i,o,s)<s3?2:(Ip(a,n,s),Za(a,a),Ip(l,s,i),Za(l,l),Lp(r,a,o),Za(r,r),cT(e,r,o,a,l,c),0))}const T$=[0,0,0],E$=[0,0,0],qh=[0,0,0],Wh=[0,0,0],Xh=[0,0,0],B1=[0,0,0],j1=[0,0,0],G1=[0,0,0];function C7t(t,e,r,i,n,s,o,a,l){A7t(t,e,r,T$,E$),T$[0]!==void 0&&(Ip(qh,T$,r),Za(qh,qh),Ip(Wh,T$,i),Za(Wh,Wh),Ip(Xh,T$,n),Za(Xh,Xh),Lp(B1,Wh,s),Za(B1,B1),Lp(j1,Xh,o),Za(j1,j1),Lp(G1,qh,a),Za(G1,G1),cT(t,B1,s,Wh,qh,l),cT(t,j1,o,Xh,Wh,l),cT(t,G1,a,qh,Xh,l)),E$[0]!==void 0&&(Ip(qh,E$,r),Za(qh,qh),Ip(Wh,E$,i),Za(Wh,Wh),Ip(Xh,E$,n),Za(Xh,Xh),Lp(B1,Wh,s),Za(B1,B1),Lp(j1,Xh,o),Za(j1,j1),Lp(G1,qh,a),Za(G1,G1),cT(t,B1,s,Wh,qh,l),cT(t,j1,o,Xh,Wh,l),cT(t,G1,a,qh,Xh,l))}function R7t(t,e,r){let i=Jne(t.maxVert[0],t.minVert[0]),n=0;for(let s=1;s<7;++s){const o=Jne(t.maxVert[s],t.minVert[s]);o>i&&(i=o,n=s)}ad(e,t.minVert[n]),ad(r,t.maxVert[n])}const Yh=[0,0,0];function O7t(t,e,r,i){const{data:n,size:s}=t;let o=Number.NEGATIVE_INFINITY,a=0;for(let l=0;l<n.length;l+=s){Yh[0]=n[l]-e[0],Yh[1]=n[l+1]-e[1],Yh[2]=n[l+2]-e[2];const c=r[0]*Yh[0]+r[1]*Yh[1]+r[2]*Yh[2],u=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],h=Yh[0]*Yh[0]+Yh[1]*Yh[1]+Yh[2]*Yh[2]-c*c/u;h>o&&(o=h,a=l)}return ad(i,n,a),o}const Io=[0,0];function A7t(t,e,r,i,n){M7t(t,e,Io,n,i);const s=WGe(r,e);Io[1]-s3<=s&&(i[0]=void 0),Io[0]+s3>=s&&(n[0]=void 0)}const MEe=[0,0,0],$Ee=[0,0,0],IEe=[0,0,0],iR=[0,0,0],nR=[0,0,0],sU=[0,0,0];function cT(t,e,r,i,n,s){if(qGe(e)<s3)return;Lp(MEe,r,e),Lp($Ee,i,e),Lp(IEe,n,e),UA(t,e,Io),nR[1]=Io[0],iR[1]=Io[1],sU[1]=iR[1]-nR[1];const o=[r,i,n],a=[MEe,$Ee,IEe];for(let l=0;l<3;++l){UA(t,o[l],Io),nR[0]=Io[0],iR[0]=Io[1],UA(t,a[l],Io),nR[2]=Io[0],iR[2]=Io[1],sU[0]=iR[0]-nR[0],sU[2]=iR[2]-nR[2];const c=Zne(sU);c<s.quality&&(ad(s.b0,o[l]),ad(s.b1,e),ad(s.b2,a[l]),s.quality=c)}}const P7t=[0,0,0];function UA(t,e,r){const{data:i,size:n}=t;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let s=0;s<i.length;s+=n){const o=i[s]*e[0]+i[s+1]*e[1]+i[s+2]*e[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function M7t(t,e,r,i,n){const{data:s,size:o}=t;ad(i,s),ad(n,i),r[0]=WGe(P7t,e),r[1]=r[0];for(let a=o;a<s.length;a+=o){const l=s[a]*e[0]+s[a+1]*e[1]+s[a+2]*e[2];l<r[0]&&(r[0]=l,ad(i,s,a)),l>r[1]&&(r[1]=l,ad(n,s,a))}}function LEe(t,e,r){ad(r.center,t),WT(r.halfSize,e,.5),r.quaternion[0]=0,r.quaternion[1]=0,r.quaternion[2]=0,r.quaternion[3]=1}const X0=[0,0,0],sR=[0,0,0],C$=[0,0,0],zA=[0,0,0],VA=[0,0,0],DEe=[0,0,0];function $7t(t,e,r){ad(X0,e),Math.abs(e[0])>Math.abs(e[1])&&Math.abs(e[0])>Math.abs(e[2])?X0[0]=0:Math.abs(e[1])>Math.abs(e[2])?X0[1]=0:X0[2]=0,qGe(X0)<s3&&(X0[0]=X0[1]=X0[2]=1),Lp(sR,e,X0),Za(sR,sR),Lp(C$,e,sR),Za(C$,C$),GGe(t,e,sR,C$,zA,VA),Ip(DEe,VA,zA),HGe(e,sR,C$,zA,VA,DEe,r)}function GGe(t,e,r,i,n,s){UA(t,e,Io),n[0]=Io[0],s[0]=Io[1],UA(t,r,Io),n[1]=Io[0],s[1]=Io[1],UA(t,i,Io),n[2]=Io[0],s[2]=Io[1]}const oU=[0,0,0],jg=[1,0,0,0,1,0,0,0,1],oR=[0,0,0];function HGe(t,e,r,i,n,s,o){jg[0]=t[0],jg[1]=t[1],jg[2]=t[2],jg[3]=e[0],jg[4]=e[1],jg[5]=e[2],jg[6]=r[0],jg[7]=r[1],jg[8]=r[2],D7t(o.quaternion,jg),Xz(oR,i,n),WT(oR,oR,.5),WT(o.center,t,oR[0]),WT(oU,e,oR[1]),Xz(o.center,o.center,oU),WT(oU,r,oR[2]),Xz(o.center,o.center,oU),WT(o.halfSize,s,.5)}const Fd=7;let I7t=class{constructor(e){this.minVert=new Array(Fd),this.maxVert=new Array(Fd);const r=64*Fd;this.buffer=new ArrayBuffer(r);let i=0;this.minProj=new Float64Array(this.buffer,i,Fd),i+=8*Fd,this.maxProj=new Float64Array(this.buffer,i,Fd),i+=8*Fd;for(let l=0;l<Fd;++l)this.minVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Fd;++l)this.maxVert[l]=new Float64Array(this.buffer,i,3),i+=24;for(let l=0;l<Fd;++l)this.minProj[l]=Number.POSITIVE_INFINITY,this.maxProj[l]=Number.NEGATIVE_INFINITY;const n=new Array(Fd),s=new Array(Fd),{data:o,size:a}=e;for(let l=0;l<o.length;l+=a){let c=o[l];c<this.minProj[0]&&(this.minProj[0]=c,n[0]=l),c>this.maxProj[0]&&(this.maxProj[0]=c,s[0]=l),c=o[l+1],c<this.minProj[1]&&(this.minProj[1]=c,n[1]=l),c>this.maxProj[1]&&(this.maxProj[1]=c,s[1]=l),c=o[l+2],c<this.minProj[2]&&(this.minProj[2]=c,n[2]=l),c>this.maxProj[2]&&(this.maxProj[2]=c,s[2]=l),c=o[l]+o[l+1]+o[l+2],c<this.minProj[3]&&(this.minProj[3]=c,n[3]=l),c>this.maxProj[3]&&(this.maxProj[3]=c,s[3]=l),c=o[l]+o[l+1]-o[l+2],c<this.minProj[4]&&(this.minProj[4]=c,n[4]=l),c>this.maxProj[4]&&(this.maxProj[4]=c,s[4]=l),c=o[l]-o[l+1]+o[l+2],c<this.minProj[5]&&(this.minProj[5]=c,n[5]=l),c>this.maxProj[5]&&(this.maxProj[5]=c,s[5]=l),c=o[l]-o[l+1]-o[l+2],c<this.minProj[6]&&(this.minProj[6]=c,n[6]=l),c>this.maxProj[6]&&(this.maxProj[6]=c,s[6]=l)}for(let l=0;l<Fd;++l){let c=n[l];ad(this.minVert[l],o,c),c=s[l],ad(this.maxVert[l],o,c)}}},L7t=class{constructor(){this.b0=[1,0,0],this.b1=[0,1,0],this.b2=[0,0,1],this.quality=0}};function Zne(t){return t[0]*t[1]+t[0]*t[2]+t[1]*t[2]}function Xz(t,e,r){t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2]}function Ip(t,e,r){t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2]}function WT(t,e,r){t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}function ad(t,e,r=0){t[0]=e[r],t[1]=e[r+1],t[2]=e[r+2]}function Lp(t,e,r){const i=e[0],n=e[1],s=e[2],o=r[0],a=r[1],l=r[2];t[0]=n*l-s*a,t[1]=s*o-i*l,t[2]=i*a-n*o}function Za(t,e){const r=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(r>0){const i=1/Math.sqrt(r);t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i}}function qGe(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]}function Jne(t,e){const r=e[0]-t[0],i=e[1]-t[1],n=e[2]-t[2];return r*r+i*i+n*n}function WGe(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function D7t(t,e){const r=e[0]+e[4]+e[8];if(r>0){let i=Math.sqrt(r+1);t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i}else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);const n=(i+1)%3,s=(i+2)%3;let o=Math.sqrt(e[3*i+i]-e[3*n+n]-e[3*s+s]+1);t[i]=.5*o,o=.5/o,t[3]=(e[3*n+s]-e[3*s+n])*o,t[n]=(e[3*n+i]+e[3*i+n])*o,t[s]=(e[3*s+i]+e[3*i+s])*o}}const L2=bf(),hc=A(),Kne=A(),N7t=vn();let I2r=class{constructor(e){const o=e*56;this.buffer=new ArrayBuffer(o),this.obbs=new Array(e);for(let a=0;a<e;a++)this.obbs[a]={center:Ice(this.buffer,56*a+0),halfSize:w5e(this.buffer,56*a+24),quaternion:jGe(this.buffer,56*a+36)}}};function cfe(t=[0,0,0],e=[-1,-1,-1],r=bf()){return{center:qi(t),halfSize:hB(e),quaternion:BGe(r)}}function NEe(t){return cfe(t.center,t.halfSize,t.quaternion)}function D2r(t,e){oe(e.center,t.center),oe(e.halfSize,t.halfSize),yF(e.quaternion,t.quaternion)}function XGe(t,e){return e=e||cfe(),T7t(t,e),e}function uT(t,e){const r=zi(e,t.center),i=mq(t,e);return r>i?1:r<-i?-1:0}function N2r(t,e){return hc[0]=t.center[0]-e[0],hc[1]=t.center[1]-e[1],hc[2]=t.center[2]-e[2],u0(L2,t.quaternion),md(hc,hc,L2),LV(hc,hc),Fce(Kne,hc,t.halfSize),S7(Kne,hc)<e[3]*e[3]}function F2r(t,e){e||(e=To());const r=J7(N7t,t.quaternion),i=t.halfSize[0]*Math.abs(r[0])+t.halfSize[1]*Math.abs(r[3])+t.halfSize[2]*Math.abs(r[6]),n=t.halfSize[0]*Math.abs(r[1])+t.halfSize[1]*Math.abs(r[4])+t.halfSize[2]*Math.abs(r[7]),s=t.halfSize[0]*Math.abs(r[2])+t.halfSize[1]*Math.abs(r[5])+t.halfSize[2]*Math.abs(r[8]);return e[0]=t.center[0]-i,e[1]=t.center[1]-n,e[2]=t.center[2]-s,e[3]=t.center[0]+i,e[4]=t.center[1]+n,e[5]=t.center[2]+s,e}function k2r(t,e){return zi(e,t.center)-mq(t,e)}function U2r(t,e){return zi(e,t.center)+mq(t,e)}function z2r(t,e){return uT(t,e[0])<=0&&uT(t,e[1])<=0&&uT(t,e[2])<=0&&uT(t,e[3])<=0&&uT(t,e[4])<=0&&uT(t,e[5])<=0}function V2r(t,e,r,i=0){u0(L2,t.quaternion),ve(hc,e,t.center);const n=md(hc,hc,L2),s=md(Kne,r,L2);let o=-1/0,a=1/0;for(let l=0;l<3;l++)if(Math.abs(s[l])>1e-6){const c=(i+t.halfSize[l]-n[l])/s[l],u=(-i-t.halfSize[l]-n[l])/s[l];o=Math.max(o,Math.min(c,u)),a=Math.min(a,Math.max(c,u))}else if(n[l]>t.halfSize[l]+i||n[l]<-t.halfSize[l]-i)return!1;return o<=a}(()=>{const t=new Int8Array(162);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),t})();function mq(t,e){u0(L2,t.quaternion),md(hc,e,L2);const r=t.halfSize;return Math.abs(hc[0]*r[0])+Math.abs(hc[1]*r[1])+Math.abs(hc[2]*r[2])}function YGe(t,e){for(let r=0;r<8;++r){const i=e[r];i[0]=1&r?-t.halfSize[0]:t.halfSize[0],i[1]=2&r?-t.halfSize[1]:t.halfSize[1],i[2]=4&r?-t.halfSize[2]:t.halfSize[2],md(i,i,t.quaternion),ge(i,i,t.center)}}function F7t(t){return ju(t.halfSize)}function k7t(t,e,r,i,n){if(yF(n.quaternion,t.quaternion),i===at.Global){u0(aU,t.quaternion),md(H1,t.center,aU),LV(aR,H1),Fce(lR,aR,t.halfSize),Gi(lR,aR,lR);const s=We(lR);ge(lR,aR,t.halfSize);const o=We(lR);if(s<r)oe(n.center,t.center),se(H1,r,r,r),ge(n.halfSize,t.halfSize,H1);else{const a=o>0?1+e/o:1,l=s>0?1+r/s:1,c=(l+a)/2,u=(l-a)/2;ce(n.halfSize,aR,u),id(n.halfSize,n.halfSize,t.halfSize,c),ce(n.center,aR,c),id(n.center,n.center,t.halfSize,u),cLe(H1,H1),x7(n.center,n.center,H1),md(n.center,n.center,n.quaternion)}}else{const s=se(H1,0,0,1);id(n.center,t.center,s,(r+e)/2),u0(aU,t.quaternion),md(s,s,aU),LV(s,s),id(n.halfSize,t.halfSize,s,(r-e)/2)}return n}const H1=A(),aR=A(),lR=A(),aU=bf();let U7t=class{constructor(e){this._totalCount=e,this._indexRanges=[0,e]}allVisible(){return this.componentCount()===this._totalCount}allInvisible(){return this._indexRanges.length===0}componentCount(){const e=this._indexRanges;let r=0;for(let i=0;i<e.length;i+=2)r+=e[i+1];return r}reset(e){e==="all"||e.length===this._totalCount?this._indexRanges=[0,this._totalCount]:this._indexRanges=z7t(e)}forEachComponent(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i],s=n+r[i+1];for(let o=n;o<s;o++)if(!e(o))return!1}return!0}forEachComponentRange(e){const r=this._indexRanges;for(let i=0;i<r.length;i+=2){const n=r[i];if(!e(n,n+r[i+1]))return!1}return!0}computeOffsetRanges(e){const r=new Array(this._indexRanges.length),i=this._indexRanges;for(let n=0;n<i.length;n+=2){const s=i[n],o=s+i[n+1],a=e[s],l=e[o];r[n]=a,r[n+1]=l-a}return r}};function z7t(t){const e=new Array;if(t.length===0)return e;let r=t[0],i=1;for(let n=1;n<t.length;n++){const s=t[n];r+i===s?i+=1:(e.push(r),e.push(i),r=s,i=1)}return e.push(r),e.push(i),e}let V7t=class{constructor(e,r){this.offsets=r,this.pickability=null,this.highlightCounts=null,this.verticalOffsets=null,this.cachedGeometryRanges=null,this.cachedHighlightRanges=null,this.cachedDefaultRanges=null;const i=this.count;this.visibility=new U7t(i),this.materialDataBuffer=e.getBuffer(i),this.materialDataIndices=new Uint16Array(i);for(let n=0;n<i;n++)this.materialDataIndices[n]=this.materialDataBuffer.acquireIndex()}destroy(){for(let e=0;e<this.count;e++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[e])}get count(){return this.offsets.length-1}get geometryRanges(){return this.cachedGeometryRanges==null&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets)),this.cachedGeometryRanges}get highlightRanges(){return this.highlightCounts==null?null:(this._updateCachedHighlightRanges(),this.cachedHighlightRanges)}get defaultShadowMapRanges(){return this.highlightCounts==null?this.geometryRanges:(this._updateCachedHighlightRanges(),this.cachedDefaultRanges)}highlightsDirty(){this.cachedHighlightRanges=null,this.cachedDefaultRanges=null}visibilityDirty(){this.cachedGeometryRanges=null,this.highlightsDirty()}_updateCachedHighlightRanges(){if((this.cachedHighlightRanges==null||this.cachedDefaultRanges==null)&&this.highlightCounts!=null){const{highlightRanges:e,defaultRanges:r}=B7t(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=e,this.cachedDefaultRanges=r}}};function B7t(t,e,r){const i=[],n=[];let s=r.length,o=r.length;return e.forEachComponent(a=>(t[a]>0?(s!==a-1&&(i.length&&i.push(r[s+1]-i[i.length-1]),i.push(r[a])),s=a):(o!==a-1&&(n.length&&n.push(r[o+1]-n[n.length-1]),n.push(r[a])),o=a),!0)),i.length&&i.push(r[s+1]-i[i.length-1]),n.length&&n.push(r[o+1]-n[n.length-1]),{highlightRanges:i,defaultRanges:n}}let aL=class extends Ce{constructor(){super(...arguments),this.visible=BA.Hidden}};var BA;d([p({autoDestroy:!0})],aL.prototype,"renderable",void 0),d([p({autoDestroy:!0})],aL.prototype,"components",void 0),aL=d([I("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],aL),function(t){t[t.Hidden=0]="Hidden",t[t.Visible=1]="Visible"}(BA||(BA={}));function j7t(t,e,r,i){if(r>=e)return t;t==null&&(t=G7t());const n=t.isVisibleBit;let s=t.data;const o=JGe(s),a=r/o|0,l=r-o*a,c=(e-1)/o|0,u=s,h=i===n;if(!(r<u.length*o)&&h){const f=a+1,m=Math.ceil(u.length*s7),g=c+1;let y=Math.max(f,m);y=Math.min(y,g),s=new Uint32Array(y),s.set(u)}return a<s.length&&(s[a]=q7t(s[a],l,h)),t.data=s,t}function ZGe(t,e){if(t==null)return!0;const{isVisibleBit:r,data:i}=t,n=JGe(i);return e<i.length*n?H7t(r,i,e,n):!t.isVisibleBit}function G7t(t=!0){return{isVisibleBit:!t,data:new Uint32Array(0)}}function H7t(t,e,r,i){const n=r/i|0,s=r-n*i;return W7t(e[n],s)===t}function JGe(t){return t.BYTES_PER_ELEMENT*8}function q7t(t,e,r){return t&~(1<<e)|(r?1:0)<<e}function W7t(t,e){return(t&1<<e)!=0}let X7t=class{constructor(e,r){this._components=r,this._indices=e.indices!=null?Ky(e.indices):qP(e.positions.length/3),this._positions=e.positions,this._componentIntersectionData=new Array(r.count)}getComponentAabb(e,r){this._perComponentAabbs||(this._perComponentAabbs=this._computePerComponentAabbs());for(let i=0;i<6;i++)r[i]=this._perComponentAabbs[6*e+i];return r}getComponentPositions(e,r){r.indices=this._indices,r.data=this._positions,r.stride=3,r.startIndex=this._components.offsets[e],r.endIndex=this._components.offsets[e+1]}intersect(e,r,i,n,s,o,a){const l=new ft(this._positions,3,!1,3),c=this._indices,u=this._components.offsets,h=S8e(e,r,Y7t),f=e[2],m=r[2];this._components.visibility.forEachComponent(g=>{if(!ZGe(this._components.pickability,g))return!0;const y=this.getComponentAabb(g,Z7t);if(o!=null){const x=o[g];s!=null?s.componentOffset=x:(e[2]=f-x,r[2]=m-x)}if(s!=null&&s.applyToAabb(y),!Ahe(y,e,h,i))return!0;const _=u[g]/3,b=u[g+1]/3,w=(x,S,C)=>a(g,x,nd(S,S,n),C);return s==null&&b-_>kGe?(this._componentIntersectionData[g]==null&&(this._componentIntersectionData[g]=new lfe(this._indices,_,b,l)),this._componentIntersectionData[g].intersectRay({r0:e,r1:r},w)):OF(e,r,_,b,c,l,void 0,s,w),!0})}_computePerComponentAabbs(){const e=this._components.count,r=Dn(6*e),i=this._indices,n=this._positions,s=this._components.offsets;let o=0;for(let a=0;a<e;a++){const l=s[a],c=s[a+1];let u=1/0,h=1/0,f=1/0,m=-1/0,g=-1/0,y=-1/0;for(let _=l;_<c;_++){const b=3*i[_],w=n[b],x=n[b+1],S=n[b+2];u=Math.min(u,w),h=Math.min(h,x),f=Math.min(f,S),m=Math.max(m,w),g=Math.max(g,x),y=Math.max(y,S)}r[o++]=u,r[o++]=h,r[o++]=f,r[o++]=m,r[o++]=g,r[o++]=y}return r}get positions(){return this._positions}get indices(){return this._indices}};const Y7t=A(),Z7t=To();let J7t=class{constructor(e,r,i){this.material=e,this.geometry=r,this.meta=i}destroy(){this.material.dispose(),this.geometry.dispose()}},K7t=class{constructor(e,r,i,n){this.vao=e,this.primitiveType=r,this.parameters=i,this.indexed=n}dispose(){this.vao.dispose()}},Q7t=class{constructor(){this.near=Number.MAX_VALUE,this.far=-Number.MAX_VALUE}};function eHt(t,e){return{near:t,far:e}}function GF(t){return t?c4(t,1/0,-1/0):eHt(1/0,-1/0)}function c4(t,e,r){return t.near=e,t.far=r,t}function o3(t,e,r=t){return e!=null&&(r.near=Math.min(t.near,e.near),r.far=Math.max(t.far,e.far)),r}function lU(t,e){return t.near<=e&&e<=t.far}const Qne={near:0,far:0};function tHt(t,e){const r=GF(),{eye:i,frustum:n,viewForward:s}=t;e.forAll(o=>{const a=o.offsetObb!=null?o.offsetObb:o.obb,l=ye(Gi(Bd,a.center,i),s),c=mq(a,s);if(lU(r,l-c)&&lU(r,l+c))return;const u=oHt(a,n);if(u===-1)return;if(u===0)return Y0.far=l+c,Y0.near=l-c,void o3(r,Y0);const h=cU.pushNew();h.near=l-c,h.far=l+c,h.mask=u,h.object=o});for(let o=0;o<cU.length;o++){const a=cU.data[o];if(lU(r,a.near)&&lU(r,a.far))continue;Y0.far=a.far,Y0.near=1/0,sHt(a.object.offsetObb!=null?a.object.offsetObb:a.object.obb,i,rHt,c=>{let u=iHt;for(let h=0;h<KGe&&c.length>0;h++){if(!(a.mask&1<<h))continue;nHt(n[h],c,u);const f=c;c=u,u=f}for(let h=0;h<c.length;h+=3){se(Yc,c.data[h],c.data[h+1],c.data[h+2]);const f=ye(Gi(Yc,Yc,i),s);Y0.near=Math.min(Y0.near,f)}})===0&&(Y0.near=0),o3(r,Y0)}return cU.length=0,r}const cU=new dr({allocator:t=>t||{near:1/0,far:-1/0,mask:0,object:null},deallocator:t=>(t.object=x3(t.object),t)}),Y0=GF(),Yc=A(),_S=A(),rHt=new dr({deallocator:null}),iHt=new dr({deallocator:null});function nHt(t,e,r){r.length=0;const i=e.length-3;JZ(Yc,e,i);const n=zi(t,Yc);n<=0&&(r.push(Yc[0]),r.push(Yc[1]),r.push(Yc[2]));let s=0,o=n;for(;s<i;s+=3){JZ(_S,e,s);const a=zi(t,_S);o*a<0&&(mi(Yc,_S,Yc,a/(a-o)),Zc(r,Yc)),a<=0&&Zc(r,_S),o=a,oe(Yc,_S)}o*n<0&&(JZ(_S,e,i),mi(Yc,_S,Yc,n/(n-o)),Zc(r,Yc))}function JZ(t,e,r){return se(t,e.data[r],e.data[r+1],e.data[r+2])}function Zc(t,e){t.push(e[0]),t.push(e[1]),t.push(e[2])}function sHt(t,e,r,i){u0(kEe,t.quaternion),Gi(Bd,e,t.center),md(Bd,Bd,kEe);const n=8*((Bd[0]<-t.halfSize[0]?-1:Bd[0]>t.halfSize[0]?1:0)+3*(Bd[1]<-t.halfSize[1]?-1:Bd[1]>t.halfSize[1]?1:0)+9*(Bd[2]<-t.halfSize[2]?-1:Bd[2]>t.halfSize[2]?1:0)+13),s=FEe[n];if(s===0)return s;J7(uU,t.quaternion),Kue(uU,uU,t.halfSize);const o=(a,l)=>{const c=FEe[n+l+1];return se(a,((1&c)<<1)-1,(2&c)-1,((4&c)>>1)-1),nd(a,a,uU),ge(a,t.center,a)};return r.length=0,Zc(r,o(KZ,0)),Zc(r,o(UEe,1)),Zc(r,o(Bd,2)),Zc(r,o(zEe,3)),i(r),s===1||(r.length=0,Zc(r,KZ),Zc(r,zEe),Zc(r,o(Bd,4)),Zc(r,o(VEe,5)),i(r),s===2||(r.length=0,Zc(r,KZ),Zc(r,VEe),Zc(r,o(Bd,6)),Zc(r,UEe),i(r))),s}const FEe=(()=>{const t=new Array(216);let e=0;const r=i=>{for(let n=0;n<i.length;n++)t[e+n]=i[n];e+=8};return r([3,0,6,2,3,1,5,4]),r([2,0,2,3,1,5,4,0]),r([3,1,0,2,3,7,5,4]),r([2,0,1,3,2,6,4,0]),r([1,0,1,3,2,0,0,0]),r([2,1,5,7,3,2,0,0]),r([3,2,0,1,3,7,6,4]),r([2,2,0,1,3,7,6,0]),r([3,3,0,1,5,7,6,2]),r([2,0,1,5,4,6,2,0]),r([1,0,1,5,4,0,0,0]),r([2,1,3,7,5,4,0,0]),r([1,0,2,6,4,0,0,0]),r([0,0,0,0,0,0,0,0]),r([1,1,3,7,5,0,0,0]),r([2,2,3,7,6,4,0,0]),r([1,2,3,7,6,0,0,0]),r([2,3,1,5,7,6,2,0]),r([3,4,0,1,5,7,6,2]),r([2,5,7,6,4,0,1,0]),r([3,5,0,1,3,7,6,4]),r([2,4,5,7,6,2,0,0]),r([1,4,5,7,6,0,0,0]),r([2,5,1,3,7,6,4,0]),r([3,6,0,2,3,7,5,4]),r([2,6,2,3,7,5,4,0]),r([3,7,6,2,3,1,5,4]),t})(),KGe=4;function oHt(t,e){let r=0;for(let i=0;i<KGe;i++){const n=uT(t,e[i]);if(n>0)return-1;n===0&&(r|=1<<i)}return r}const uU=vn(),kEe=bf(),Bd=A(),KZ=A(),UEe=A(),zEe=A(),VEe=A();let aHt=class{constructor(e){this._objects=e}submit(e,r){this._objects.preSubmit(r),this._objects.visibleObjects.forAll(i=>i.renderable.material.submit(e,r,i))}queryShadowCasterDepthRange(e){return this._objects.visibleObjects.length?tHt(e,this._objects.visibleObjects):null}};function lHt(t){const e=On().vec3f(O.POSITION);return t.normals&&e.vec2i16(O.NORMALCOMPRESSED,{glNormalized:!0}),t.textureCoordinates===xs.Default?e.vec2f(O.UV0):t.textureCoordinates===xs.Atlas&&(e.vec2f(O.UV0),e.vec4u16(O.UVREGION,{glNormalized:!0})),t.colors&&e.vec4u8(O.COLOR,{glNormalized:!0}),e}let cHt=class{constructor(){this.externalColor=wr(),this.externalColorMixMode=Ds.Multiply,this.castShadows=!0,this.pickable=!0,this.elevationOffset=0}},uHt=class extends Zn{constructor(e,r){super(e,"int",Ci.Draw,(i,n,s)=>i.setUniform1i(e,r(n,s)))}};var t0;(function(t){t[t.Uniform=0]="Uniform",t[t.Varying=1]="Varying",t[t.COUNT=2]="COUNT"})(t0||(t0={}));const ufe=429496.7296;function QGe(t,e){YN(t/ufe*.5+.5,e)}function dHt(t,e){switch(e.componentData){case t0.Varying:return hHt(t,e);case t0.Uniform:return pHt(t);case t0.COUNT:return;default:e.componentData}}function hHt(t,e){const{vertex:r,fragment:i}=t;r.include(Od),r.uniforms.add(new Wp("componentColorTex",s=>s.componentParameters.texture.texture)),t.attributes.add(O.COMPONENTINDEX,"float"),t.varyings.add("vExternalColorMixMode","mediump float"),t.varyings.add("vExternalColor","vec4");const n=e.output===q.ObjectAndLayerIdColor;n&&t.varyings.add("vObjectAndLayerIdColor","vec4"),t.include(LVe),r.constants.add("elevationScale","float",2*ufe),r.constants.add("stride","float",he("enable-feature:objectAndLayerId-rendering")?3:2),r.code.add(T`vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
float index = componentIndex * stride + typeOffset;
float texSize = float(textureSize(componentColorTex, 0).x);
float coordX = mod(index, texSize);
float coordY = floor(index / texSize);
return vec2(coordX, coordY) + 0.5;
}`),r.code.add(T`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${n?T`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = texelFetch(componentColorTex, ivec2(textureCoordinates), 0);
          }`:T`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`),i.code.add(T`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${n?T`fragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function pHt(t){const{vertex:e,fragment:r}=t;e.uniforms.add(new vj("externalColor",i=>i.componentParameters.externalColor)),r.uniforms.add(new uHt("externalColorMixMode",i=>i.componentParameters.externalColorMixMode)),t.varyings.add("vExternalColor","vec4"),e.code.add(T`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`),r.code.add(T`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
fragColor = vec4(1.0,0.0,0.0,0.0);
}`)}var Fp;function fHt(t,e){const r=t.vertex;switch(r.code.add(T`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`),e.vertexDiscardMode){case Fp.None:r.code.add(T`#define vertexDiscardByOpacity(_opacity_) {}`);break;case Fp.Opaque:r.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);break;case Fp.Transparent:r.code.add(T`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}}(function(t){t[t.None=0]="None",t[t.Transparent=1]="Transparent",t[t.Opaque=2]="Opaque",t[t.COUNT=3]="COUNT"})(Fp||(Fp={}));var r0;function K2r(t){return t&&w0(t)?r0.Mars:t&&x0(t)?r0.Moon:r0.Earth}(function(t){t[t.Earth=1]="Earth",t[t.Mars=2]="Mars",t[t.Moon=3]="Moon",t[t.COUNT=4]="COUNT"})(r0||(r0={}));var sh;(function(t){t[t.None=0]="None",t[t.NoOverlay=1]="NoOverlay",t[t.ColorOverlay=2]="ColorOverlay",t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater",t[t.COUNT=4]="COUNT"})(sh||(sh={}));let Dr=class extends jl{constructor(){super(...arguments),this.output=q.Color,this.textureCoordinateType=xs.None,this.componentData=t0.Uniform,this.cullFace=Hi.Back,this.vertexDiscardMode=Fp.None,this.doubleSidedMode=Nn.WindingOrder,this.alphaDiscardMode=Si.Opaque,this.integratedMeshMode=sh.None,this.transparencyPassType=kt.NONE,this.ellipsoidMode=r0.Earth,this.pbrMode=Nt.Disabled,this.normalType=ei.Attribute,this.spherical=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasVertexColors=!1,this.hasNormals=!1,this.hasSlicePlane=!1,this.hasBaseColorTexture=!1,this.receiveAmbientOcclusion=!0,this.receiveShadows=!0,this.blendingEnabled=!0,this.hasScreenSpaceReflections=!1,this.hasPolygonOffset=!1,this.hasMetallicRoughnessTexture=!1,this.hasEmissionTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasOccludees=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.hasCloudsReflections=!0,this.snowCover=!1,this.objectAndLayerIdColor=!1}};d([X({count:q.COUNT})],Dr.prototype,"output",void 0),d([X({count:xs.COUNT})],Dr.prototype,"textureCoordinateType",void 0),d([X({count:t0.COUNT})],Dr.prototype,"componentData",void 0),d([X({count:Hi.COUNT})],Dr.prototype,"cullFace",void 0),d([X({count:Fp.COUNT})],Dr.prototype,"vertexDiscardMode",void 0),d([X({count:Nn.COUNT})],Dr.prototype,"doubleSidedMode",void 0),d([X({count:Si.COUNT})],Dr.prototype,"alphaDiscardMode",void 0),d([X({count:sh.COUNT})],Dr.prototype,"integratedMeshMode",void 0),d([X({count:kt.COUNT})],Dr.prototype,"transparencyPassType",void 0),d([X({count:r0.COUNT})],Dr.prototype,"ellipsoidMode",void 0),d([X({count:Nt.COUNT})],Dr.prototype,"pbrMode",void 0),d([X({count:ei.COUNT})],Dr.prototype,"normalType",void 0),d([X()],Dr.prototype,"spherical",void 0),d([X()],Dr.prototype,"doublePrecisionRequiresObfuscation",void 0),d([X()],Dr.prototype,"hasVertexColors",void 0),d([X()],Dr.prototype,"hasNormals",void 0),d([X()],Dr.prototype,"hasSlicePlane",void 0),d([X()],Dr.prototype,"hasBaseColorTexture",void 0),d([X()],Dr.prototype,"receiveAmbientOcclusion",void 0),d([X()],Dr.prototype,"receiveShadows",void 0),d([X()],Dr.prototype,"blendingEnabled",void 0),d([X()],Dr.prototype,"hasScreenSpaceReflections",void 0),d([X()],Dr.prototype,"hasPolygonOffset",void 0),d([X()],Dr.prototype,"hasMetallicRoughnessTexture",void 0),d([X()],Dr.prototype,"hasEmissionTexture",void 0),d([X()],Dr.prototype,"hasOcclusionTexture",void 0),d([X()],Dr.prototype,"hasNormalTexture",void 0),d([X()],Dr.prototype,"hasOccludees",void 0),d([X()],Dr.prototype,"hasMultipassTerrain",void 0),d([X()],Dr.prototype,"cullAboveGround",void 0),d([X()],Dr.prototype,"hasCloudsReflections",void 0),d([X()],Dr.prototype,"snowCover",void 0),d([X()],Dr.prototype,"objectAndLayerIdColor",void 0),d([X({constValue:Ci.Draw})],Dr.prototype,"pbrTextureBindType",void 0),d([X({constValue:!0})],Dr.prototype,"hasSliceHighlight",void 0),d([X({constValue:!1})],Dr.prototype,"hasSliceInVertexProgram",void 0),d([X({constValue:!1})],Dr.prototype,"useCustomDTRExponentForWater",void 0),d([X({constValue:!1})],Dr.prototype,"hasVertexTangents",void 0),d([X({constValue:!0})],Dr.prototype,"supportsTextureAtlas",void 0),d([X({constValue:!1})],Dr.prototype,"highStepCount",void 0),d([X({constValue:!1})],Dr.prototype,"instancedDoublePrecision",void 0),d([X({constValue:!0})],Dr.prototype,"useFillLights",void 0),d([X({constValue:!1})],Dr.prototype,"objectAndLayerIdColorInstanced",void 0);function BEe(t,e){t.include(WE,e),t.fragment.include(r4);const r=t.fragment;r.uniforms.add(new vj("baseColor",i=>i.baseColor)),r.uniforms.add(new P2("objectOpacity",i=>i.objectOpacity)),e.hasVertexColors?r.code.add(T`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):r.code.add(T`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`),r.code.add(T`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)}function jEe(t,e){const r=t.fragment;switch(e.doubleSidedMode){case Nn.None:r.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case Nn.View:t.include(OA,e),r.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case Nn.WindingOrder:r.code.add(T`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:e.doubleSidedMode;case Nn.COUNT:}switch(e.normalType){case ei.Attribute:case ei.Compressed:t.include(KH,e),r.code.add(T`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case ei.ScreenDerivative:t.include(OA,e),r.code.add(T`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case ei.Ground:e.spherical?(t.include(OA,e),r.code.add(T`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):r.code.add(T`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`),r.code.add(T`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:e.normalType;case ei.COUNT:}}function mHt(t,e){const r=t.fragment;if(e.hasBaseColorTexture&&(e.output===q.Color||e.alphaDiscardMode!==Si.Opaque)){t.include(Gde,e);const i=e.textureCoordinateType===xs.Atlas;r.uniforms.add(new Wp("baseColorTexture",n=>n.texture)),i?(t.include(v6e),r.code.add(T`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, vuv0, vuvRegion);
}`)):r.code.add(T`vec4 readBaseColorTexture() {
return texture(baseColorTexture, vuv0);
}`)}else r.code.add(T`vec4 readBaseColorTexture() { return vec4(1.0); }`)}function gHt(t){const e=new jr;e.include(OA,t),e.include(KH,t),e.include(WE,t),e.include(Zy,t),e.include(H3,t),e.include(dHt,t),e.include(xFt,t),e.include(eIt,t),e.include(mHt,t),e.include(fHt,t);const{vertex:r,fragment:i}=e;t.pbrMode!==Nt.Normal&&t.pbrMode!==Nt.Schematic||(e.include(qde,t),t.hasNormalTexture&&e.include(kVe,t));const n=t.output===q.Shadow||t.output===q.ShadowHighlight||t.output===q.ShadowExcludeHighlight;n&&t.componentData===t0.Varying?r.code.add(T`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):r.code.add(T`#define discardShadows(castShadows) {}`);const s=t.integratedMeshMode===sh.ColorOverlay||t.integratedMeshMode===sh.ColorOverlayWithWater,o=s&&t.output===q.Color&&t.pbrMode===Nt.WaterOnIntegratedMesh;return s&&(e.include(bE,t),e.include(Ljt,t),t.spherical?r.code.add(T`
      const float invEllipsoidRadius = ${T.float(1/(t.ellipsoidMode===r0.Earth?Rr.radius:t.ellipsoidMode===r0.Mars?Hy.radius:O_.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):r.code.add(T`vec2 projectOverlay(vec3 pos) { return pos.xy; }`)),o&&(e.varyings.add("tbnTangent","vec3"),e.varyings.add("tbnBiTangent","vec3"),e.varyings.add("groundNormal","vec3")),r.code.add(T`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${t.output===q.ObjectAndLayerIdColor?T`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${T.float(Ma)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${t.output===q.ObjectAndLayerIdColor?T`forwardObjectAndLayerIdColor();`:""}
      ${o?t.spherical?T`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:T`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${s?T`setOverlayVTC(projectOverlay(position));`:""}
    }
  `),t.output===q.Alpha&&(i.include(Ph),e.include(Mh,t),e.include(BEe,t),s&&i.uniforms.add(new Mt("ovColorTex",(a,l)=>Une(a,l))),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?T`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        fragColor = vec4(materialColor.a);
      }
    `)),t.output===q.Color&&(i.include(Ph),e.include(Mh,t),e.include(BEe,t),e.include(jEe,t),e.include(bE,t),t.receiveShadows?(e.include(QH,t),i.code.add(T`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):i.code.add(T`float evaluateShadow() { return 0.0; }`),s&&i.uniforms.add(new Mt("ovColorTex",(a,l)=>Une(a,l))),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${t.hasMultipassTerrain?T`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${s?T`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),t.pbrMode===Nt.Normal||t.pbrMode===Nt.Schematic?(C0(i),i.code.add(T`
        ${t.pbrMode===Nt.Normal?T`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),t.hasNormalTexture?i.code.add(T`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):i.code.add(T`vec3 shadingNormal = normalVertex;`),i.code.add(T`${t.spherical?T`vec3 normalGround = normalize(positionWorld());`:T`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),i.code.add(T`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${t.snowCover?T`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${s?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(t.receiveShadows?i.code.add(T`float shadow = evaluateShadow();`):t.spherical?(K3(i),i.code.add(T`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):i.code.add(T`float shadow = 0.0;`),o&&i.uniforms.add(new Mt("ovNormalTex",(a,l)=>dfe(l))),t.snowCover&&i.code.add(T`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`),i.code.add(T`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${s?T` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${o?T`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),i.code.add(T`
        fragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${t.transparencyPassType===kt.Color?"fragColor = premultiplyAlpha(fragColor);":""}
      }
    `)),(t.output===q.Depth||n)&&(e.include(V_,t),i.code.add(T`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`)),t.output===q.Normal&&(e.include(jEe,t),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${t.normalType===ei.Ground?"0.0":"1.0"};
        fragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `)),t.output===q.ObjectAndLayerIdColor&&e.fragment.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?T`fragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `),t.output===q.Highlight&&(e.include(s1,t),i.code.add(T`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${s?T`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  fragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `)),e}function dfe(t){return t.overlays.length===0?null:t.overlays[mn.INNER].getValidTexture(Hn.Water)}const yHt=Object.freeze(Object.defineProperty({__proto__:null,build:gHt,getOverlayNormalTexture:dfe},Symbol.toStringTag,{value:"Module"}));let e7e=class t7e extends si{initializeConfiguration(e,r){r.spherical=e.viewingMode===at.Global,r.doublePrecisionRequiresObfuscation=e.rctx.driverTest.doublePrecisionRequiresObfuscation.result}initializeProgram(e){return new Kr(e.rctx,t7e.shader.get().build(this.configuration),r7e)}_setPipelineState(e){const r=this.configuration,i=r.integratedMeshMode!==sh.None,n=e===kt.NONE,s=e===kt.FrontFace;return Qt({blending:r.output!==q.Color&&r.output!==q.Alpha||!r.blendingEnabled?null:n?bh:o1(e),culling:_H(r.cullFace),depthTest:{func:Px(e)},depthWrite:n||s?fu:null,colorWrite:hr,stencilWrite:i||r.hasOccludees?m0:null,stencilTest:i?QNt(cu.IntegratedMeshMaskExcluded):r.hasOccludees?Mx:null,polygonOffset:n||s?r.hasPolygonOffset?{factor:2,units:2}:null:zH})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}};e7e.shader=new Jr(yHt,()=>le(()=>import("./ComponentShader.glsl-42e01ecc.js"),[]));const r7e=new Map([[O.POSITION,0],[O.NORMAL,1],[O.NORMALCOMPRESSED,1],[O.COLOR,2],[O.UV0,3],[O.UVREGION,4],[O.COMPONENTINDEX,5]]);let vHt=class extends Ai{constructor(){super(...arguments),this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){if(this._dirty=!1,this._parameterBlocks!=null)for(const e of this._parameterBlocks)this[e]._setClean()}get dirty(){return this._dirty||this._checkParameterBlocksDirty()}_checkParameterBlocksDirty(){if(this._parameterBlocks==null)return!1;for(const e of this._parameterBlocks)if(this[e].dirty)return!0;return!1}},hfe=class{constructor(){this._dirty=!0}_setDirty(){this._dirty=!0}_setClean(){this._dirty=!1}get dirty(){return this._dirty}};function jn(t={}){return(e,r)=>{const i=e._parameterCount??0;if(e._parameterCount=i+1,t.vectorOps){const n=t.vectorOps;Object.defineProperty(e,r,{get(){return this[i]},set(s){const o=this[i];if(o==null)this[i]=s;else{if(n.equals(o,s))return;n.copy(o,s)}this._setDirty()}})}else Object.defineProperty(e,r,{get(){return this[i]},set(n){this[i]!==n&&(t.dispose&&this[i]&&this[i].dispose(),this[i]=n,this._setDirty())}})}}function GEe(){return(t,e)=>{const r=t._parameterCount??0;t._parameterCount=r+1,t._parameterBlocks=t._parameterBlocks||[],t._parameterBlocks.push(r),Object.defineProperty(t,e,{get(){return this[r]},set(i){this[r]!==i&&(this[r]=i,this._setDirty())}})}}let gq=class{constructor(e){this._low=A(),this._high=A(),e&&this.set(e)}get low(){return this._low}get high(){return this._high}set(e){oe(this._low,oe(HEe,e));const r=Gi(HEe,e,this._low);oe(this._high,r)}get(e){return ge(e,this._low,this._high)}getLowScaled(e){return ce(e,this._low,1)}};const HEe=$n();let Xo=class extends vHt{constructor(e,r){super(),this.toMapSpace=r,this.baseColor=nr(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=mc(tq),this.emissiveFactor=Ue(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.objectOpacity=1,this.commonMaterialParameters=new Yz,this.componentParameters=new UD,this.textureAlphaCutoff=WB,this.alphaDiscardMode=Si.Opaque,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=r0.Earth,this.hasOccludees=!1,this._techniqueConfiguration=new Dr;const i=new gq(e.position),n=UVe(e.rotationScale);UE(n,n),this.transformNormalGlobalFromModel=_Fe(df(n,n)),this.transformWorldFromModelTL=i.low,this.transformWorldFromModelTH=i.high,this.transformWorldFromModelRS=e.rotationScale}dispose(){this._technique=xn(this._technique),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}get texture(){return this.baseColorTexture!=null?this.baseColorTexture.glTexture:null}get textureMetallicRoughness(){return this.metallicRoughnessTexture!=null?this.metallicRoughnessTexture.glTexture:null}get textureEmissive(){return this.emissionTexture!=null?this.emissionTexture.glTexture:null}get textureOcclusion(){return this.occlusionTexture!=null?this.occlusionTexture.glTexture:null}get textureNormal(){return this.normalTexture!=null?this.normalTexture.glTexture:null}prepareTechnique(e,r,i,n){const s=this._techniqueConfiguration;s.hasVertexColors=n.colors,s.hasNormals=n.normals,s.textureCoordinateType=n.textureCoordinates,s.hasMetallicRoughnessTexture=this.metallicRoughnessTexture!=null,s.hasEmissionTexture=this.emissionTexture!=null,s.hasOcclusionTexture=this.occlusionTexture!=null,s.hasNormalTexture=this.normalTexture!=null,s.transparencyPassType=r.identifier===ed.Material&&i.transparencyPassType!=null?i.transparencyPassType:kt.NONE,s.hasMultipassTerrain=r.identifier===ed.Material&&i.multipassTerrain!=null&&i.multipassTerrain.enabled,s.cullAboveGround=r.identifier===ed.Material&&i.multipassTerrain!=null&&i.multipassTerrain.cullAboveGround,s.ellipsoidMode=this.ellipsoidMode,s.componentData=this.componentParameters.type,s.cullFace=this.commonMaterialParameters.cullFace,s.doubleSidedMode=this.commonMaterialParameters.doubleSided?Nn.View:Nn.None,s.hasBaseColorTexture=this.baseColorTexture!=null;const o=this._computeWhichMaterialPass();s.blendingEnabled=o===uc.Transparent||o===uc.OpaqueAndTransparent,s.alphaDiscardMode=this.alphaDiscardMode,s.integratedMeshMode=this.isIntegratedMesh?bHt(i)?dfe(i)?sh.ColorOverlayWithWater:sh.ColorOverlay:sh.NoOverlay:sh.None,s.hasPolygonOffset=this.polygonOffsetEnabled;const a=this.hasParametersFromSource&&this.baseColorTexture==null;if(s.pbrMode=s.integratedMeshMode===sh.ColorOverlayWithWater?Nt.WaterOnIntegratedMesh:this.usePBR?a?Nt.Schematic:Nt.Normal:Nt.Disabled,s.normalType=s.integratedMeshMode===sh.None?s.hasNormals?ei.Compressed:ei.ScreenDerivative:ei.Ground,s.hasSlicePlane=i.slicePlane!=null&&this.commonMaterialParameters.hasSlicePlane,r.identifier===ed.ShadowMap)s.output=q.Shadow,s.vertexDiscardMode=Fp.None;else if(r.identifier===ed.Highlight)s.output=q.Highlight,s.vertexDiscardMode=Fp.None;else{switch(this._computeWhichMaterialPass()===uc.OpaqueAndTransparent?s.vertexDiscardMode=r.transparent?Fp.Opaque:Fp.Transparent:s.vertexDiscardMode=Fp.None,s.output=r.output,s.receiveAmbientOcclusion=!1,s.receiveShadows=!1,r.output){case q.Color:s.receiveAmbientOcclusion=i.ssaoHelper.active,s.hasOccludees=i.hasOccludees,s.receiveShadows=i.shadowMap.ready,s.hasScreenSpaceReflections=i.ssr.enabled,s.hasCloudsReflections=i.cloudsFade.data!=null;break;case q.Alpha:s.hasOccludees=i.hasOccludees;break;case q.ObjectAndLayerIdColor:s.objectAndLayerIdColor=!0}s.snowCover=this.hasSnowCover(i)}return this._technique=e.releaseAndAcquire(e7e,s,this._technique),this._setClean(),this._technique}hasSnowCover(e){return e.weather!=null&&e.weatherVisible&&e.weather.type==="snowy"&&e.weather.snowCover==="enabled"}submit(e,r,i){if(this.objectOpacity===0)return;const n=i.renderable.geometry,s=i.components,o=i.renderable.meta.cameraDepthSquared,a=s.geometryRanges,l=s.highlightRanges,c=s.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case uc.Opaque:e.materialOpaque.submitDraw(this,n,a,o);break;case uc.Transparent:e.materialTransparent.submitDraw(this,n,a,o);break;case uc.OpaqueAndTransparent:e.materialOpaque.submitDraw(this,n,a,o),e.materialTransparent.submitDraw(this,n,a,o);break;case uc.IntegratedMesh:e.materialIntegratedMesh.submitDraw(this,n,a,o),_Ht(r)&&e.highlightIntegratedMesh.submitDraw(this,n,a,o)}const u=this.componentParameters.castShadows!==No.None;u&&e.shadowMap.submitDraw(this,n,a,o),l!=null&&(e.highlight.submitDraw(this,n,l,o),u&&e.highlightShadowMap.submitDraw(this,n,l,o)),u&&c!=null&&e.defaultShadowMap.submitDraw(this,n,c,o)}_computeWhichMaterialPass(){return this.isIntegratedMesh?uc.IntegratedMesh:this.objectOpacity<1?uc.Transparent:this.componentParameters.opaqueOverride===No.All?uc.Opaque:this.baseColor[3]<1||this.alphaDiscardMode===Si.Blend||this.alphaDiscardMode===Si.MaskBlend?uc.Transparent:this.componentParameters.transparent===No.None?uc.Opaque:this.componentParameters.transparent===No.All?uc.Transparent:uc.OpaqueAndTransparent}};var uc,No;d([jn({vectorOps:yLe})],Xo.prototype,"baseColor",void 0),d([jn()],Xo.prototype,"usePBR",void 0),d([jn()],Xo.prototype,"hasParametersFromSource",void 0),d([jn({vectorOps:ave})],Xo.prototype,"mrrFactors",void 0),d([jn({vectorOps:ave})],Xo.prototype,"emissiveFactor",void 0),d([jn({dispose:!0})],Xo.prototype,"baseColorTexture",void 0),d([jn({dispose:!0})],Xo.prototype,"metallicRoughnessTexture",void 0),d([jn({dispose:!0})],Xo.prototype,"emissionTexture",void 0),d([jn({dispose:!0})],Xo.prototype,"occlusionTexture",void 0),d([jn({dispose:!0})],Xo.prototype,"normalTexture",void 0),d([jn()],Xo.prototype,"objectOpacity",void 0),d([GEe()],Xo.prototype,"commonMaterialParameters",void 0),d([GEe()],Xo.prototype,"componentParameters",void 0),d([jn()],Xo.prototype,"textureAlphaCutoff",void 0),d([jn()],Xo.prototype,"alphaDiscardMode",void 0),d([jn()],Xo.prototype,"isIntegratedMesh",void 0),d([jn()],Xo.prototype,"polygonOffsetEnabled",void 0),d([jn()],Xo.prototype,"ellipsoidMode",void 0),d([jn()],Xo.prototype,"hasOccludees",void 0),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent",t[t.OpaqueAndTransparent=2]="OpaqueAndTransparent",t[t.IntegratedMesh=3]="IntegratedMesh"}(uc||(uc={}));let Yz=class extends hfe{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=Hi.Back,this.hasSlicePlane=!0}};d([jn()],Yz.prototype,"doubleSided",void 0),d([jn()],Yz.prototype,"cullFace",void 0),d([jn()],Yz.prototype,"hasSlicePlane",void 0);let UD=class extends hfe{constructor(){super(...arguments),this.externalColor=nr(1,1,1,1),this.externalColorMixMode=Ds.Multiply,this.castShadows=No.All}get transparent(){return this.externalColor[3]<1?No.All:No.None}get opaqueOverride(){return this.externalColorMixMode===Ds.Replace&&this.externalColor[3]===1?No.All:No.None}get visible(){return this.externalColor[3]>0?No.All:No.None}get type(){return t0.Uniform}};d([jn({vectorOps:yLe})],UD.prototype,"externalColor",void 0),d([jn()],UD.prototype,"externalColorMixMode",void 0),d([jn()],UD.prototype,"castShadows",void 0),function(t){t[t.All=0]="All",t[t.Some=1]="Some",t[t.None=2]="None"}(No||(No={}));let lL=class extends hfe{constructor(){super(...arguments),this.texture=null,this.transparent=No.None,this.opaqueOverride=No.None,this.castShadows=No.None}get type(){return t0.Varying}};function _Ht(t){return t.overlays.length!==0&&t.overlays[mn.INNER].getValidTexture(Hn.Highlight)!=null}function bHt(t){return t.overlays.length!==0&&t.overlays[mn.INNER].getColorTextureNoRasterImage()!=null}d([jn()],lL.prototype,"texture",void 0),d([jn()],lL.prototype,"transparent",void 0),d([jn()],lL.prototype,"opaqueOverride",void 0),d([jn()],lL.prototype,"castShadows",void 0);const Sj=On().vec3f(O.POSITION).u16(O.COMPONENTINDEX).u16(O.U16PADDING),i7e=On().vec2u8(O.SIDENESS),wHt=Ad(i7e),n7e=On().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u8(O.VARIANTOFFSET,{glNormalized:!0}).u8(O.VARIANTSTROKE).u8(O.VARIANTEXTENSION,{glNormalized:!0}).u8(O.U8PADDING,{glPadding:!0}).u16(O.U16PADDING,{glPadding:!0}),ese=n7e.clone().vec3f(O.NORMAL),tse=n7e.clone().vec3f(O.NORMALA).vec3f(O.NORMALB),s7e=new Map([[O.POSITION0,0],[O.POSITION1,1],[O.COMPONENTINDEX,2],[O.VARIANTOFFSET,3],[O.VARIANTSTROKE,4],[O.VARIANTEXTENSION,5],[O.NORMAL,6],[O.NORMALA,6],[O.NORMALB,7],[O.SIDENESS,8]]);function qEe(t,e,r){const i=e/3,n=new Uint32Array(r+1),s=new Uint32Array(r+1),o=(b,w)=>{b<w?n[b+1]++:s[w+1]++};for(let b=0;b<i;b++){const w=t[3*b],x=t[3*b+1],S=t[3*b+2];o(w,x),o(x,S),o(S,w)}let a=0,l=0;for(let b=0;b<r;b++){const w=n[b+1],x=s[b+1];n[b+1]=a,s[b+1]=l,a+=w,l+=x}const c=new Uint32Array(6*i),u=n[r],h=(b,w,x)=>{if(b<w){const S=n[b+1]++;c[2*S]=w,c[2*S+1]=x}else{const S=s[w+1]++;c[2*u+2*S]=b,c[2*u+2*S+1]=x}};for(let b=0;b<i;b++){const w=t[3*b],x=t[3*b+1],S=t[3*b+2];h(w,x,b),h(x,S,b),h(S,w,b)}const f=(b,w)=>{const x=2*b,S=w-b;for(let C=1;C<S;C++){const E=c[x+2*C],R=c[x+2*C+1];let P=C-1;for(;P>=0&&c[x+2*P]>E;P--)c[x+2*P+2]=c[x+2*P],c[x+2*P+3]=c[x+2*P+1];c[x+2*P+2]=E,c[x+2*P+3]=R}};for(let b=0;b<r;b++)f(n[b],n[b+1]),f(u+s[b],u+s[b+1]);const m=new Int32Array(3*i),g=(b,w)=>b===t[3*w]?0:b===t[3*w+1]?1:b===t[3*w+2]?2:-1,y=(b,w)=>{const x=g(b,w);m[3*w+x]=-1},_=(b,w,x,S)=>{const C=g(b,w);m[3*w+C]=S;const E=g(x,S);m[3*S+E]=w};for(let b=0;b<r;b++){let w=n[b];const x=n[b+1];let S=s[b];const C=s[b+1];for(;w<x&&S<C;){const E=c[2*w],R=c[2*u+2*S];E===R?(_(b,c[2*w+1],R,c[2*u+2*S+1]),w++,S++):E<R?(y(b,c[2*w+1]),w++):(y(R,c[2*u+2*S+1]),S++)}for(;w<x;)y(b,c[2*w+1]),w++;for(;S<C;)y(c[2*u+2*S],c[2*u+2*S+1]),S++}return m}let o7e=class{updateSettings(e){this.settings=e,this._edgeHashFunction=e.reducedPrecision?SHt:xHt}write(e,r,i){const n=this._edgeHashFunction(i);hU.seed=n;const s=hU.getIntRange(0,255),o=hU.getIntRange(0,this.settings.variants-1),a=.7,l=hU.getFloat(),c=255*(.5*THt(-(1-Math.min(l/a,1))+Math.max(0,l-a)/(1-a),1.2)+.5);e.position0.setVec(r,i.position0),e.position1.setVec(r,i.position1),e.componentIndex.set(r,i.componentIndex),e.variantOffset.set(r,s),e.variantStroke.set(r,o),e.variantExtension.set(r,c)}trim(e,r){return e.slice(0,r)}};const pfe=new Float32Array(6),Tj=new Uint32Array(pfe.buffer),Ew=new Uint32Array(1);function xHt(t){const e=pfe;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],Ew[0]=5381;for(let r=0;r<Tj.length;r++)Ew[0]=31*Ew[0]+Tj[r];return Ew[0]}function SHt(t){const e=pfe;e[0]=cR(t.position0[0]),e[1]=cR(t.position0[1]),e[2]=cR(t.position0[2]),e[3]=cR(t.position1[0]),e[4]=cR(t.position1[1]),e[5]=cR(t.position1[2]),Ew[0]=5381;for(let r=0;r<Tj.length;r++)Ew[0]=31*Ew[0]+Tj[r];return Ew[0]}const WEe=1e4;function cR(t){return Math.round(t*WEe)/WEe}function THt(t,e){const r=t<0?-1:1;return Math.abs(t)**e*r}let Ej=class{constructor(){this._commonWriter=new o7e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return ese.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),ge(dU,i.faceNormal0,i.faceNormal1),Se(dU,dU),e.normal.setVec(r,dU)}trim(e,r){return this._commonWriter.trim(e,r)}};Ej.Layout=ese,Ej.glLayout=Ad(ese,1);let Cj=class{constructor(){this._commonWriter=new o7e}updateSettings(e){this._commonWriter.updateSettings(e)}allocate(e){return tse.createBuffer(e)}write(e,r,i){this._commonWriter.write(e,r,i),e.normalA.setVec(r,i.faceNormal0),e.normalB.setVec(r,i.faceNormal1)}trim(e,r){return this._commonWriter.trim(e,r)}};Cj.Layout=tse,Cj.glLayout=Ad(tse,1);const dU=A(),hU=new YL,dT=-1;var Rj;function EHt(t,e,r,i=MHt){const n=t.vertices.position,s=t.vertices.componentIndex,o=sr(i.anglePlanar),a=sr(i.angleSignificantEdge),l=Math.cos(a),c=Math.cos(o),u=rse.edge,h=u.position0,f=u.position1,m=u.faceNormal0,g=u.faceNormal1,y=PHt(t),_=AHt(t),b=_.length/4,w=e.allocate(b);let x=0;const S=b,C=r.allocate(S);let E=0,R=0,P=0;const D=Gct(0,b),L=new Float32Array(b);L.forEach((B,Z,M)=>{n.getVec(_[4*Z],h),n.getVec(_[4*Z+1],f),M[Z]=Li(h,f)}),D.sort((B,Z)=>L[Z]-L[B]);const k=new Array,V=new Array;for(let B=0;B<b;B++){const Z=D[B],M=L[Z],$=_[4*Z],N=_[4*Z+1],j=_[4*Z+2],J=_[4*Z+3],K=J===dT;if(n.getVec($,h),n.getVec(N,f),K)se(m,y[3*j],y[3*j+1],y[3*j+2]),oe(g,m),u.componentIndex=s.get($),u.cosAngle=ye(m,g);else{if(se(m,y[3*j],y[3*j+1],y[3*j+2]),se(g,y[3*J],y[3*J+1],y[3*J+2]),u.componentIndex=s.get($),u.cosAngle=ye(m,g),RHt(u,c))continue;u.cosAngle<-.9999&&oe(g,m)}R+=M,P++,K||CHt(u,l)?(e.write(w,x++,u),k.push(M)):OHt(u,o)&&(r.write(C,E++,u),V.push(M))}const W=new Float32Array(k.reverse()),G=new Float32Array(V.reverse());return{regular:{instancesData:e.trim(w,x),lodInfo:{lengths:W}},silhouette:{instancesData:r.trim(C,E),lodInfo:{lengths:G}},averageEdgeLength:R/P}}function CHt(t,e){return t.cosAngle<e}function RHt(t,e){return t.cosAngle>e}function OHt(t,e){const r=Vo(t.cosAngle),i=rse.fwd,n=rse.ortho;return H_(i,t.position1,t.position0),r*(ye(Lt(n,t.faceNormal0,t.faceNormal1),i)>0?-1:1)>e}function AHt(t){const e=t.faces.length/3,r=t.faces,i=t.neighbors;let n=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],h=r[3*a],f=r[3*a+1],m=r[3*a+2];n+=l===dT||h<f?1:0,n+=c===dT||f<m?1:0,n+=u===dT||m<h?1:0}const s=new Int32Array(4*n);let o=0;for(let a=0;a<e;a++){const l=i[3*a],c=i[3*a+1],u=i[3*a+2],h=r[3*a],f=r[3*a+1],m=r[3*a+2];(l===dT||h<f)&&(s[o++]=h,s[o++]=f,s[o++]=a,s[o++]=l),(c===dT||f<m)&&(s[o++]=f,s[o++]=m,s[o++]=a,s[o++]=c),(u===dT||m<h)&&(s[o++]=m,s[o++]=h,s[o++]=a,s[o++]=u)}return s}function PHt(t){const e=t.faces.length/3,r=t.vertices.position,i=t.faces,n=QZ.v0,s=QZ.v1,o=QZ.v2,a=new Float32Array(3*e);for(let l=0;l<e;l++){const c=i[3*l],u=i[3*l+1],h=i[3*l+2];r.getVec(c,n),r.getVec(u,s),r.getVec(h,o),ve(s,s,n),ve(o,o,n),Lt(n,s,o),Se(n,n),a[3*l]=n[0],a[3*l+1]=n[1],a[3*l+2]=n[2]}return a}(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"})(Rj||(Rj={}));const rse={edge:{position0:A(),position1:A(),faceNormal0:A(),faceNormal1:A(),componentIndex:0,cosAngle:0},ortho:A(),fwd:A()},QZ={v0:A(),v1:A(),v2:A()},MHt={anglePlanar:4,angleSignificantEdge:35};function $Ht(t){const e=IHt(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return XEe.updateSettings(t.writerSettings),YEe.updateSettings(t.writerSettings),EHt(e,XEe,YEe)}function IHt(t,e,r,i){if(e){const o=qEe(r,i,t.count);return new LHt(r,i,o,t)}const n=sne(t.buffer,t.stride/4,{originalIndices:r,originalIndicesLength:i}),s=qEe(n.indices,i,n.uniqueCount);return{faces:n.indices,facesLength:n.indices.length,neighbors:s,vertices:Sj.createView(n.buffer)}}let LHt=class{constructor(e,r,i,n){this.faces=e,this.facesLength=r,this.neighbors=i,this.vertices=n}};const XEe=new Ej,YEe=new Cj,dEr=On().vec3f(O.POSITION0).vec3f(O.POSITION1),DHt=On().vec3f(O.POSITION0).vec3f(O.POSITION1).u16(O.COMPONENTINDEX).u16(O.U16PADDING,{glPadding:!0});let NHt=class{constructor(e){this._maxCount=e,this._nextIndex=0,this._recycledIndices=[]}get activeCount(){return this._nextIndex-this._recycledIndices.length}get availableCount(){return this._recycledIndices.length+this._maxCount-this._nextIndex}acquire(){return this._recycledIndices.length>0?this._recycledIndices.pop():this.availableCount?this._nextIndex++:void 0}release(e){this._recycledIndices.push(e)}},FHt=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this.textureWidth=4096,this._dirty=!0;const i=new Vr;i.samplingMode=Kt.NEAREST,i.wrapMode=ir.CLAMP_TO_EDGE,i.width=this.textureWidth,i.height=1,this._texture=new Jt(this._rctx,i),this._data=new zl(new ArrayBuffer(4*this.textureWidth))}dispose(){this._texture.dispose(),this._texture=void 0,this._data=void 0}setData(e,r,i,n,s,o){const a=e*this._fieldCount+r;this._dirty=!0,this._data.set(a,0,i),this._data.set(a,1,n),this._data.set(a,2,s),this._data.set(a,3,o)}setDataElement(e,r,i,n){const s=e*this._fieldCount+r;this._dirty=!0,this._data.set(s,i,n)}getDataElement(e,r,i){const n=e*this._fieldCount+r;return this._dirty=!0,this._data.get(n,i)}resizeToFit(e){const r=(e+1)*this._fieldCount;if(r>this._data.count){const i=Math.ceil(r/this.textureWidth)*this.textureWidth,n=new zl(new ArrayBuffer(4*i));n.typedBuffer.set(this._data.typedBuffer),this._data=n}}updateTexture(){if(!this._dirty)return;const e=this._texture.descriptor.width,r=this._texture.descriptor.height;this._data.count>e*r&&this._texture.resize(e,this._data.count/e),this._texture.setData(this._data.typedBuffer),this._dirty=!1}get texture(){return this._texture}};const a7e=65536;let kHt=class{constructor(e,r=1){this.textureBuffer=new FHt(e,r),this._indexManager=new NHt(a7e)}dispose(){this.textureBuffer.dispose(),this.textureBuffer=void 0}get availableCount(){return this._indexManager.availableCount}get activeCount(){return this._indexManager.activeCount}acquireIndex(){const e=this._indexManager.acquire();return this.textureBuffer.resizeToFit(e),e}releaseIndex(e){this._indexManager.release(e)}},l7e=class{constructor(e,r=1){this._rctx=e,this._fieldCount=r,this._buffers=[]}garbageCollect(){this._buffers=this._buffers.filter(e=>e.activeCount!==0||(e.dispose(),!1))}destroy(){this._buffers.forEach(e=>e.dispose()),this._buffers=[]}getBuffer(e){for(const i of this._buffers)if(i.availableCount>=e)return i;if(e>a7e)return null;const r=new kHt(this._rctx,this._fieldCount);return this._buffers.push(r),r}updateTextures(){for(const e of this._buffers)e.textureBuffer.updateTexture()}};const ZEe=re.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");let UHt=class{constructor(e,r){this._renderManager=e,this._viewingMode=r,this._objects=[new dr,new dr],this._renderSubmit=new aHt(this),this._renderManager.register(this._renderSubmit),this._hasObjectAndLayerId=he("enable-feature:objectAndLayerId-rendering"),this._componentBufferManager=new l7e(e.rctx,2+(this._hasObjectAndLayerId?1:0))}destroy(){It(this._objects[BA.Hidden].length===0&&this._objects[BA.Visible].length===0,"ObjectCollection should be empty upon disposal"),this._componentBufferManager.destroy();const e=this._objects.flatMap(r=>r.toArray());for(const r of e)r==null||r.destroy()}createObject(e){const r=new aL;return r.toMapSpace=e.toMapSpace,r.transform=e.transform,r.obb=NEe(e.obb),r.components=new V7t(this._componentBufferManager,Ky(e.geometry.componentOffsets)),r.renderable=this._createRenderable(e,r.components),r.intersectionGeometry=new X7t(e.geometry.positionData,r.components),this._objects[r.visible].push(r),r}destroyObject(e){const r=e;this._objects[r.visible].removeUnordered(r),r.destroy(),this._notifyDirty()}setObjectVisibility(e,r){const i=e;r!==i.visible&&(this._objects[i.visible].removeUnordered(i),this._objects[r].push(i),i.visible=r,this._notifyDirty())}preSubmit(e){const r=e.camera.eye;this.visibleObjects.forAll(i=>i.renderable.meta.cameraDepthSquared=ks(r,i.obb.center))}getMaterial(e){return e.renderable.material}updateMaterial(e,r){const i=e.renderable.material;r(i),i.dirty&&this._notifyDirty()}setAllComponentVisibilities(e,r){const i=e;i.components.visibility.reset(r),i.components.visibilityDirty(),this._notifyDirty()}forEachVisibleComponent(e,r){return e.components.visibility.forEachComponent(r)}getComponentCount(e){const r=e,i=r.components.visibility.componentCount();return{visible:i,invisible:r.components.count-i}}setComponentData(e,r){const i=e,n=i.renderable.material,s=i.components,o=s.materialDataBuffer,a=s.materialDataIndices,l=new cHt,c=o.textureBuffer,u=new Uint8Array(4),h=new Uint32Array(u.buffer);let f=0,m=0,g=0,y=s.verticalOffsets,_=1/0,b=-1/0,w=!1,x=!1,S=0;for(let C=0;C<s.count;C++){r(C,l),f+=+(l.externalColor[3]<1),m+=+(l.externalColorMixMode===Ds.Replace&&l.externalColor[3]===1),g+=+l.castShadows,IVe(l.externalColor,l.externalColorMixMode,u),u[2]=254&u[2]|+l.castShadows,c.setData(a[C],0,u[0],u[1],u[2],u[3]),w||(w=C>0&&S!==h[0]),S=h[0],x||(x=l.elevationOffset!==0),x&&y==null&&(y=new Array(C).fill(0)),y!=null&&(y[C]=l.elevationOffset),_=Math.min(_,l.elevationOffset),b=Math.max(b,l.elevationOffset),QGe(l.elevationOffset,u),c.setData(a[C],1,u[0],u[1],u[2],u[3]);const E=l.objectAndLayerIdColor;E!=null&&c.setData(a[C],2,E[0],E[1],E[2],E[3]),l.pickable!==ZGe(s.pickability,C)&&(s.pickability=j7t(s.pickability,s.count,C,l.pickable))}s.verticalOffsets=x?y:null,i.offsetObb=x?k7t(i.obb,_,b,this._viewingMode,i.offsetObb!=null?i.offsetObb:NEe(i.obb)):null,w||x||this._hasObjectAndLayerId?(n.componentParameters=new lL,n.componentParameters.castShadows=eJ(g,s.count),n.componentParameters.transparent=eJ(f,s.count),n.componentParameters.opaqueOverride=eJ(m,s.count),n.componentParameters.texture=c,c.updateTexture()):(n.componentParameters=new UD,n.componentParameters.castShadows=l.castShadows?No.All:No.None,n.componentParameters.externalColor=l.externalColor,n.componentParameters.externalColorMixMode=l.externalColorMixMode),this._notifyDirty()}getComponentAabb(e,r,i,n=!1){e.intersectionGeometry.getComponentAabb(r,i);const s=e,o=s.components.verticalOffsets;if(n||o==null)return i;const a=o[r];if(this._viewingMode===at.Local||a===0)return i[2]+=a,i[5]+=a,i;const l=Vxt(a);return l.localOrigin=s.transform.position,l.applyToAabb(i)}getComponentObb(e){return e.obb}getObjectTransform(e){return e.transform}getComponentPositions(e,r,i){return e.intersectionGeometry.getComponentPositions(r,i)}intersect(e,r,i,n,s,o){const a=e;s!=null&&(s.localOrigin=a.transform.position);const l=UE(JEe,a.transform.rotationScale);Gi(pU,r,a.transform.position),Gi(fU,i,a.transform.position),nd(pU,pU,l),nd(fU,fU,l);const c=df(JEe,l);return a.intersectionGeometry.intersect(pU,fU,n,c,s,a.components.verticalOffsets,o)}addEdges(e,r,i,n){const s=e,{indices:o,positions:a}=s.intersectionGeometry,l=s.components.offsets;return r.addComponentObject(e,s.transform,{center:s.obb.center,radius:F7t(s.obb)},a,o,l,i,n)}async extractEdgeInformation(e,r,i){const n=e,s=n.components.visibility;if(s.allInvisible())return{buffer:DHt.createBuffer(0),origin:[0,0,0]};const{indices:o,positions:a}=n.intersectionGeometry,l=n.components.offsets,c=Sj.createBuffer(a.length/3);jF(c.position.typedBuffer,a,c.position.typedBufferStride,3),E9e(c.position,c.position,n.transform.rotationScale),this._setComponentIndices(c.componentIndex,o,l);const u=c.count,h=this._computeVisibilityIndices(o,s,l,u);return{origin:qi(n.transform.position),buffer:await r.extractComponentsEdgeLocations({indices:h,indicesLength:h.length,skipDeduplicate:!0,data:c,writerSettings:{reducedPrecision:!1,variants:0}},i)}}_setComponentIndices(e,r,i){let n=0;for(let s=0;s<i.length-1;s++){const o=i[s],a=i[s+1];for(let l=o;l<a;l++){const c=r?r[l]:l;e.set(c,n)}n++}}_computeVisibilityIndices(e,r,i,n){if(e&&r.allVisible())return e;let s=0;r.forEachComponentRange((l,c)=>(s+=i[c]-i[l],!0));const o=ig(e)?new Array(s):(e==null?void 0:e.BYTES_PER_ELEMENT)===2||n<=65536?new Uint16Array(s):new Uint32Array(s);let a=0;return r.forEachComponentRange((l,c)=>{const u=i[l],h=i[c];for(let f=u;f<h;f++)o[a++]=e?e[f]:f;return!0}),o}addComponentHighlight(e,r){const i=e.components;i.highlightCounts==null&&(i.highlightCounts=new Uint32Array(i.count+1)),i.highlightCounts[r]++===0&&(i.highlightsDirty(),this._notifyDirty()),i.highlightCounts[i.count]++}removeComponentHighlight(e,r){const i=e.components;if(i.highlightCounts==null)return void ZEe.warn("Removing non-existing highlight.");const n=i.highlightCounts[r],s=i.highlightCounts[i.count];if(n!==0){if(n>1)return i.highlightCounts[r]=n-1,void(i.highlightCounts[i.count]=s-1);i.highlightCounts[r]=0,i.highlightsDirty(),this._notifyDirty(),s===1?i.highlightCounts=null:i.highlightCounts[i.count]=s-1}else ZEe.warn("Removing non-existing highlight.")}clearHighlights(e){const r=e.components;r.highlightCounts!=null&&(r.highlightCounts=null,r.highlightsDirty(),this._notifyDirty())}getObjectGPUMemoryUsage(e){return e.renderable.meta.gpuMemoryEstimate}get visibleObjects(){return this._objects[BA.Visible]}_createRenderable(e,r){const i=this._renderManager.rctx,n=e.geometry,s=n.vertices.layoutParameters,o=ci.createVertex(i,qr.STATIC_DRAW,n.vertices.data),a=rd(n.indices,y=>ci.createIndex(i,qr.STATIC_DRAW,y)),l=Ad(lHt(s)),c=new Uint16Array(n.vertices.count);for(let y=0;y<r.count;y++){const _=r.offsets[y],b=r.offsets[y+1],w=r.materialDataIndices[y];if(n.indices!=null)for(let x=_;x<b;x++)c[n.indices[x]]=w;else for(let x=_;x<b;x++)c[x]=w}const u=ci.createVertex(i,qr.STATIC_DRAW,c.buffer),h=new Xo(e.transform,e.toMapSpace),f=new pf(i,r7e,{data:l,componentIndices:zHt},{data:o,componentIndices:u},a),m=new K7t(f,Zt.TRIANGLES,s,a!=null),g={cameraDepthSquared:.5,gpuMemoryEstimate:o.byteLength+u.byteLength+(a!=null?a.byteLength:0)};return new J7t(h,m,g)}_notifyDirty(){this._renderManager.notifyDirty()}};const zHt=Ad(On().u16(O.COMPONENTINDEX));function eJ(t,e){return t===e?No.All:t===0?No.None:No.Some}const JEe=uu(),pU=A(),fU=A();let c7e=class extends Ai{constructor(){super(...arguments),this.scale=Qe()}};function VHt(t){const e=new jr;e.attributes.add(O.POSITION,"vec2"),e.varyings.add("uv0","vec2"),e.varyings.add("uv1","vec2"),e.vertex.uniforms.add(new Yr("scale",i=>i.scale)),e.vertex.code.add(T`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv0 = position * 0.5 + vec2(0.5);
uv1 = (position * 0.5 + vec2(0.5)) * scale;
}`),e.fragment.uniforms.add(new Mt("tex",i=>i.texture),new Mt("depthTexture",i=>i.depthTexture),new Yr("scale",i=>i.scale),new Yr("clampUV",i=>BHt(i)));const r=t.haze;return e.fragment.code.add(T`
    void main() {
      ${r?T`vec4`:T`float`} depthSample = texture(depthTexture, uv0) ${r?"":T`.r`};
      if (depthSample ${r?T`== vec4(0)`:T`!= 1.0`} ) {
          fragColor = vec4(0);
          return;
      }
      fragColor = texture(tex, min(uv1, clampUV));
    }
    `),e}function BHt(t){if(!t.texture)return KEe;const e=Or(KEe,t.texture.descriptor.width,t.texture.descriptor.height),r=Dde(e,e,t.scale),i=Wke(r,r);return Fde(i,t.scale,i)}const KEe=Qe(),jHt=Object.freeze(Object.defineProperty({__proto__:null,AtmosphereCompositingPassParameters:c7e,build:VHt},Symbol.toStringTag,{value:"Module"}));let u7e=class d7e extends si{initializeProgram(e){return new Kr(e.rctx,d7e.shader.get().build(this.configuration),Br)}initializePipeline(){return this.configuration.haze?Qt({blending:Fa(De.ONE,De.ZERO,De.ONE_MINUS_SRC_COLOR,De.ONE),depthTest:{func:Oi.ALWAYS},colorWrite:hr}):Qt({blending:Ed(De.SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),depthTest:{func:Oi.ALWAYS},colorWrite:hr})}};u7e.shader=new Jr(jHt,()=>le(()=>import("./AtmosphereCompositing.glsl-5530f5a7.js"),[]));let h7e=class extends Ai{constructor(){super(...arguments),this.opacity=1}};function GHt(t){const e=new jr;return e.include(wf),e.fragment.uniforms.add(new Mt("tex",r=>r.texture)),t.hasOpacityFactor&&e.fragment.uniforms.add(new Ye("opacity",r=>r.opacity)),e.fragment.code.add(T`
    void main() {
      fragColor = texture(tex, uv) ${t.hasOpacityFactor?"* opacity":""};
    }`),e}const HHt=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:h7e,build:GHt},Symbol.toStringTag,{value:"Module"}));var Pl;(function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.PremultipliedAlpha=2]="PremultipliedAlpha",t[t.COUNT=3]="COUNT"})(Pl||(Pl={}));let ise=class extends jl{constructor(){super(...arguments),this.alphaMode=Pl.None,this.hasOpacityFactor=!1}};d([X({count:Pl.COUNT})],ise.prototype,"alphaMode",void 0),d([X()],ise.prototype,"hasOpacityFactor",void 0);let p7e=class f7e extends si{initializeProgram(e){return new Kr(e.rctx,f7e.shader.get().build(this.configuration),Br)}initializePipeline(){switch(this.configuration.alphaMode){case Pl.None:return Qt({colorWrite:hr});case Pl.Alpha:return Qt({blending:Fa(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),colorWrite:hr});case Pl.PremultipliedAlpha:case Pl.COUNT:return Qt({blending:Ed(De.ONE,De.ONE_MINUS_SRC_ALPHA),colorWrite:hr})}}};p7e.shader=new Jr(HHt,()=>le(()=>import("./Compositing.glsl-b9601f10.js"),[]));let m7e=class extends Ai{};function qHt(){const t=new jr;return t.include(wf),t.fragment.uniforms.add(new Mt("tex",e=>e.texture)),t.fragment.code.add(T`void main() {
fragColor = vec4(1.0 - texture(tex, uv).a);
}`),t}const WHt=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:m7e,build:qHt},Symbol.toStringTag,{value:"Module"}));let g7e=class y7e extends si{initializeProgram(e){return new Kr(e.rctx,y7e.shader.get().build(),Br)}initializePipeline(){return Qt({colorWrite:{r:!1,g:!0,b:!1,a:!1}})}};g7e.shader=new Jr(WHt,()=>le(()=>import("./HUDCompositing.glsl-315a6157.js"),[]));let v7e=class extends Ai{};function XHt(){const t=new jr;return t.include(wf),t.fragment.uniforms.add(new Mt("colorTexture",e=>e.colorTexture),new Mt("alphaTexture",e=>e.alphaTexture),new Mt("frontFaceTexture",e=>e.frontFaceTexture)),t.fragment.code.add(T`void main() {
vec4 srcColor = texture(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture(alphaTexture, uv).r;
vec4 frontFace = texture(frontFaceTexture, uv);
fragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`),t}const YHt=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:v7e,build:XHt},Symbol.toStringTag,{value:"Module"}));let _7e=class b7e extends si{initializeProgram(e){return new Kr(e.rctx,b7e.shader.get().build(),Br)}initializePipeline(){return Qt({blending:Fa(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),colorWrite:hr})}};_7e.shader=new Jr(YHt,()=>le(()=>import("./OITCompositing.glsl-b1324f87.js"),[]));let w7e=class extends Ai{constructor(){super(...arguments),this.overlayIndex=mn.INNER,this.opacity=1}};function ZHt(){const t=new jr;return t.include(wf),t.fragment.uniforms.add(new Mt("tex",e=>e.texture)),t.fragment.uniforms.add(new UF("overlayIdx",e=>e.overlayIndex)),t.fragment.uniforms.add(new Ye("opacity",e=>e.opacity)),t.fragment.code.add(T`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
fragColor = texture(tex, overlayUV) * opacity;
}`),t}const JHt=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:w7e,build:ZHt},Symbol.toStringTag,{value:"Module"}));let x7e=class S7e extends si{initializeProgram(e){return new Kr(e.rctx,S7e.shader.get().build(),Br)}initializePipeline(){return Qt({blending:Ed(De.ONE,De.ONE_MINUS_SRC_ALPHA),colorWrite:hr})}};x7e.shader=new Jr(JHt,()=>le(()=>import("./OverlayCompositing.glsl-767ab963.js"),[]));let KHt=class{constructor(e,r){this._rctx=e,this._techniqueRepository=r,this._configuration=new ise,this._atmosphereConfiguration=new CB,this._passParameters=new h7e,this._atmosphereParameters=new c7e,this._oitParameters=new v7e,this._hudParameters=new m7e,this._overlayParameters=new w7e}destroy(){this._vao=pt(this._vao)}compositeOIT(e,r,i,n){this._oitParameters.colorTexture=r,this._oitParameters.alphaTexture=i,this._oitParameters.frontFaceTexture=n;const s=this._rctx,o=this._techniqueRepository.acquire(_7e);s.bindTechnique(o,this._oitParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Zt.TRIANGLE_STRIP,0,el(a,"geometry")),o.release()}compositeHUD(e,r){this._hudParameters.texture=r;const i=this._rctx,n=this._techniqueRepository.acquire(g7e);i.bindTechnique(n,this._hudParameters,e);const s=this._ensureVAO();i.bindVAO(s),i.drawArrays(Zt.TRIANGLE_STRIP,0,el(s,"geometry")),n.release()}compositeOverlay(e,r,i,n){this._overlayParameters.texture=r,this._overlayParameters.opacity=i,this._overlayParameters.overlayIndex=n;const s=this._rctx,o=this._techniqueRepository.acquire(x7e);s.bindTechnique(o,this._overlayParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Zt.TRIANGLE_STRIP,0,el(a,"geometry")),o.release()}compositeAtmosphere(e,r,i,n,s){const o=this._rctx;this._atmosphereParameters.texture=r,this._atmosphereParameters.depthTexture=i,this._atmosphereParameters.scale=n,this._atmosphereConfiguration.haze=s;const a=this._techniqueRepository.acquire(u7e,this._atmosphereConfiguration);o.bindTechnique(a,this._atmosphereParameters,e);const l=this._ensureVAO();o.bindVAO(l),o.drawArrays(Zt.TRIANGLE_STRIP,0,el(l,"geometry")),a.release()}composite(e,r,i=Pl.None,n=1){const s=this._rctx;this._configuration.alphaMode=i,this._configuration.hasOpacityFactor=n!==1,this._passParameters.texture=r,this._passParameters.opacity=n;const o=this._techniqueRepository.acquire(p7e,this._configuration);s.bindTechnique(o,this._passParameters,e);const a=this._ensureVAO();s.bindVAO(a),s.drawArrays(Zt.TRIANGLE_STRIP,0,el(a,"geometry")),o.release()}_ensureVAO(){return this._vao==null&&(this._vao=vu(this._rctx)),this._vao}};const QHt=1e4,nse=100,eqt=500,tqt=500,rqt=.1;function iqt(t,e,r){return Lhe(e,t)*(r[1]-r[0])+r[0]}function nqt(t,e,r){let i=0;if(!e.some(s=>(i+=s.numGeometries,i>=QHt)))return hqt.compute(t,e);const n=GF();return r.forAll(s=>{s.visible&&o3(n,sqt(t,s))}),n}function sqt(t,e){if(!e.visible)return;const r=GF(),i=e.getSpatialQueryAccelerator();return i!=null?oqt(r,t,i):aqt(r,t,e.objects),r}function oqt(t,e,r){const i=e.eye,n=e.viewForward,s=e.frustum,o=l=>l.visible,a=r.objectCount;if(a<eqt)c4(xp,e.near,Math.min(t.near,e.far)),r.forEachInDepthRange(i,n,Vm.DepthOrder.FRONT_TO_BACK,xp,(l,c)=>{sse(t,e,l),xp.far=t.near,c.setRange(xp)},s,o),c4(xp,Math.max(t.far,e.near),e.far),r.forEachInDepthRange(i,n,Vm.DepthOrder.BACK_TO_FRONT,xp,(l,c)=>{sse(t,e,l),xp.near=t.far,c.setRange(xp)},s,o);else{const l=Math.max(Math.min(a,tqt),Math.ceil(a*rqt)),c=r.findClosest(n,Vm.DepthOrder.FRONT_TO_BACK,s,o,l),u=r.findClosest(n,Vm.DepthOrder.BACK_TO_FRONT,s,o,l);c&&u&&(QEe(t,e,c.boundingVolumeWorldSpace.bounds),QEe(t,e,u.boundingVolumeWorldSpace.bounds))}}function aqt(t,e,r){uR.clear(),r.forAll(i=>{i.visible&&i.geometries.length!==0&&uR.add(i)}),uR.empty||(uR.sort(e),c4(xp,e.near,Math.min(t.near,e.far)),uR.forEachInDepthRange(xp,Vm.DepthOrder.FRONT_TO_BACK,(i,n)=>{n<t.near&&sse(t,e,i)}),c4(xp,Math.max(t.far,e.near),e.far),uR.forEachInDepthRange(xp,Vm.DepthOrder.BACK_TO_FRONT,(i,n,s)=>{t.far=Math.max(t.far,s)}))}function sse(t,e,r){if(!r.visible||!bw(e.frustum,r.boundingVolumeWorldSpace.bounds))return;const i=r.transformation,n=dqt;r.geometries.forEach(s=>{Ii(n,i,s.shaderTransformation);const o=OP(n);T7e(t,e,s.boundingInfo,n,o)})}function T7e(t,e,r,i,n){if(r==null)return;lt(fc,r.center,i);const{eye:s,viewForward:o}=e,a=o[0]*(fc[0]-s[0])+o[1]*(fc[1]-s[1])+o[2]*(fc[2]-s[2]);if(fc[3]=r.radius*n,!(a-fc[3]>t.near&&a+fc[3]<t.far)&&bw(e.frustum,fc))if(r.radius>nse&&r.getChildren())for(const l of r.getChildren())T7e(t,e,l,i,n);else ose.unionDepthRangeWithAABB(t,e.viewProjectionMatrix,i,r.bbMin,r.bbMax)}function QEe(t,e,r){const i=e.eye,n=e.viewForward,s=(r[0]-i[0])*n[0]+(r[1]-i[1])*n[1]+(r[2]-i[2])*n[2];t.near=Math.min(t.near,s-r[3]),t.far=Math.max(t.far,s+r[3])}let lqt=class{constructor(){this._items=new dr({allocator:e=>e||{obj:null,distance:0,near:0,far:0},deallocator:e=>(e.obj=null,e.distance=0,e.near=0,e.far=0,e)})}get length(){return this._items.length}get empty(){return this._items.length===0}clear(){this._items.clear()}add(e){this._items.pushNew().obj=e}sort(e){const r=e.eye,i=e.viewForward;this._items.forAll(n=>{const s=n.obj.boundingVolumeWorldSpace.bounds,o=(s[0]-r[0])*i[0]+(s[1]-r[1])*i[1]+(s[2]-r[2])*i[2];n.distance=o,n.near=o-s[3],n.far=o+s[3]}),this._items.sort((n,s)=>n.distance-s.distance)}forEachInDepthRange(e,r,i){if(r===Vm.DepthOrder.FRONT_TO_BACK)for(let n=0;n<this._items.length;++n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.obj,s.near,s.far)}else for(let n=this._items.length-1;n>=0;--n){const s=this._items.data[n];s.far<e.near||s.near>e.far||i(s.obj,s.near,s.far)}}},cqt=class{constructor(){this._view=Me(),this._viewProj=Me(),this._frustum=LN(),this._geometries=new Array,this._near=[],this._far=[],this._nearCandidates=[],this._farCandidates=[],this._looseRange={near:0,far:0}}compute(e,r){this._reset(),Rs(this._view,e.viewMatrix),Ii(this._viewProj,e.projectionMatrix,this._view),lB(this._frustum,e.frustum);const i=this._view,n=i[2],s=i[6],o=i[10],a=i[14];r.forAll(f=>f.forEachGeometry(m=>{if(!m.visible||!m.castShadow)return;const g=m.boundingSphere,y=n*g[0]+s*g[1]+o*g[2]+a,_=y-g[3],b=y+g[3];this._geometries.push(m),this._near.push(-b),this._far.push(-_)}));const l=new Q7t;if(this._geometries.length===0)return l;for(let f=0;f<this._geometries.length;++f)this._near[f]>l.far&&(l.far=this._near[f]),this._near[f]>2&&this._far[f]<l.near&&(l.near=this._far[f]);const c=this._looseRange;c.near=Math.max(.5*l.near,2),c.far=2*l.far;let u=0,h=0;for(let f=0;f<this._geometries.length;++f)this._near[f]<l.near&&(this._near[f]>=c.near?l.near=this._near[f]:this._nearCandidates[u++]=f),this._far[f]>l.far&&(this._far[f]<=c.far?l.far=this._far[f]:this._farCandidates[h++]=f);if(this._nearCandidates.length===0&&this._farCandidates.length===0)return l;this._nearCandidates.sort((f,m)=>this._near[f]<this._near[m]?-1:this._near[f]>this._near[m]?1:0),this._farCandidates.sort((f,m)=>this._far[f]<this._far[m]?1:this._far[f]>this._far[m]?-1:0);for(let f=0;f<this._nearCandidates.length;++f){const m=this._nearCandidates[f];if(this._near[m]<l.near){const g=this._geometries[m],y=g.boundingInfo;this._includeNearBoundingInfoRec(y,g.shaderTransformation,l)}}for(let f=0;f<this._farCandidates.length;++f){const m=this._farCandidates[f];if(this._far[m]>l.far){const g=this._geometries[m],y=g.boundingInfo;this._includeFarBoundingInfoRec(y,g.shaderTransformation,l)}}return this._reset(),l}_reset(){this._geometries.length=0,this._near.length=0,this._far.length=0,this._nearCandidates.length=0,this._farCandidates.length=0}_includeNearBoundingInfoRec(e,r,i){if(e==null)return;const n=e.center;lt(fc,n,r);const s=OP(r),o=fc[0],a=fc[1],l=fc[2],c=e.radius*s,u=this._frustum;if(u[0][0]*o+u[0][1]*a+u[0][2]*l+u[0][3]>c||u[1][0]*o+u[1][1]*a+u[1][2]*l+u[1][3]>c||u[2][0]*o+u[2][1]*a+u[2][2]*l+u[2][3]>c||u[3][0]*o+u[3][1]*a+u[3][2]*l+u[3][3]>c)return;const h=this._view[2]*o+this._view[6]*a+this._view[10]*l+this._view[14],f=h+c;if(!(-(h-c)<2||-f>=i.near))if(-f>this._looseRange.near)i.near=-f;else{if(c>nse){const m=e.getChildren();if(m!==void 0){for(const g of m)this._includeNearBoundingInfoRec(g,r,i);return}}ose.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}_includeFarBoundingInfoRec(e,r,i){if(e==null)return;let n=e.radius;const s=e.center;lt(fc,s,r);const o=OP(r),a=fc[0],l=fc[1],c=fc[2];n*=o;const u=this._frustum;if(u[0][0]*a+u[0][1]*l+u[0][2]*c+u[0][3]>n||u[1][0]*a+u[1][1]*l+u[1][2]*c+u[1][3]>n||u[2][0]*a+u[2][1]*l+u[2][2]*c+u[2][3]>n||u[3][0]*a+u[3][1]*l+u[3][2]*c+u[3][3]>n)return;const h=this._view[2]*a+this._view[6]*l+this._view[10]*c+this._view[14]-n;if(!(-h<=i.far))if(-h<this._looseRange.far)i.far=-h;else{if(n>nse){const f=e.getChildren();if(f!==void 0){for(const m of f)this._includeFarBoundingInfoRec(m,r,i);return}}ose.unionDepthRangeWithAABB(i,this._viewProj,r,e.bbMin,e.bbMax)}}},uqt=class{constructor(){this._modelViewProj=Me(),this._clipPosition=[wr(),wr(),wr(),wr(),wr(),wr(),wr(),wr()]}unionDepthRangeWithAABB(e,r,i,n,s){const o=this._modelViewProj;Ii(o,r,i);let a=!1;for(let l=0;l<8;++l){const c=this._clipPosition[l],u=l===0||l===3||l===4||l===7?n[0]:s[0],h=l===0||l===1||l===4||l===5?n[1]:s[1],f=l<4?n[2]:s[2];c[0]=o[0]*u+o[4]*h+o[8]*f+o[12],c[1]=o[1]*u+o[5]*h+o[9]*f+o[13],c[2]=o[2]*u+o[6]*h+o[10]*f+o[14],c[3]=o[3]*u+o[7]*h+o[11]*f+o[15]}for(let l=0;l<12;++l){const c=this._clipPosition[tJ[l][0]],u=this._clipPosition[tJ[l][1]],h=this._clipPosition[tJ[l][2]],f=this._clipTriangle(c,u,h);let m=!0;for(let g=0;g<f.length;++g)if(f[g][3]>=2){m=!1;break}if(!m){a=!0;for(let g=0;g<f.length;++g){const y=f[g][3];Number.isFinite(y)&&(e.near=Math.min(y,e.near),e.far=Math.max(y,e.far))}}}return a}_inside(e,r){return r===0?e[0]>=-e[3]:r===1?e[1]>=-e[3]:r===2?e[0]<=e[3]:r===3?e[1]<=e[3]:void It(!1)}_intersect(e,r,i){let n=0;return i===0?n=(-e[3]-e[0])/(r[0]-e[0]+r[3]-e[3]):i===1?n=(-e[3]-e[1])/(r[1]-e[1]+r[3]-e[3]):i===2?n=(e[3]-e[0])/(r[0]-e[0]-r[3]+e[3]):i===3&&(n=(e[3]-e[1])/(r[1]-e[1]-r[3]+e[3])),T7(wr(),e,r,n)}_clipTriangle(e,r,i){let n=[e,r,i];for(let s=0;s<4;++s){const o=n;n=[];for(let a=0;a<o.length;++a){const l=o[a],c=o[(a+1)%o.length];this._inside(c,s)?(this._inside(l,s)||n.push(this._intersect(l,c,s)),n.push(c)):this._inside(l,s)&&n.push(this._intersect(l,c,s))}}return n}};const tJ=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],fc=us(),dqt=Me(),xp=GF(),uR=new lqt,hqt=new cqt,ose=new uqt;let pqt=class{},fqt=class extends Ai{constructor(){super(...arguments),this.textures=new pqt}};function mqt(){const t=new jr;return t.attributes.add(O.POSITION,"vec2"),t.vertex.uniforms.add(new Cr("drawPosition",(e,r)=>gqt(e,r))),t.varyings.add("vUV","vec2"),t.vertex.code.add(T`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`),t.fragment.uniforms.add(new Mt("textureInput",e=>e.textures.input)),t.fragment.uniforms.add(new Mt("textureMask",e=>e.textures.mask)),t.fragment.uniforms.add(new Mt("textureOverlay",e=>e.textures.overlay)),t.fragment.uniforms.add(new Jy("maskEnabled",e=>e.magnifier.maskEnabled)),t.fragment.uniforms.add(new Jy("overlayEnabled",e=>e.magnifier.overlayEnabled)),t.fragment.code.add(T`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture(textureMask, vUV).a : 1.0;
vec4 inputColor = texture(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture(textureOverlay, vUV) : vec4(0);
fragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`),t}function gqt(t,e){const r=e.camera.pixelRatio,i=t.magnifier.offset.x*r,n=t.magnifier.offset.y*r;Oy(t.magnifier.position,eCe);const s=e.camera.screenToRender(eCe,yqt),o=Math.ceil(r*t.magnifier.size),a=e.camera.fullWidth,l=e.camera.fullHeight;return Ki(vqt,(s[0]+i)/a*2-1,(s[1]-n)/l*2-1,o/a*2,o/l*2)}const eCe=Tn(),yqt=aNe(),vqt=wr();async function _qt(t){const e=le(()=>import("./mask-svg-023bbc42.js"),[]),r=le(()=>import("./overlay-svg-d62383f3.js"),[]),i=z_((await e).default,{signal:t}),n=z_((await r).default,{signal:t}),s={mask:await i,overlay:await n};return vr(t),s}let eO=class extends Ce{constructor(){super(...arguments),this._handles=new Ri,this._magnifier=null,this._imageSources=null,this._imageLoadTask=null,this._resources=null,this._passParameters=new fqt,this.events=new pn,this.attributeLocations=new Map([[O.POSITION,0]]),this._tmpScreenPoint=Tn(),this._tmpRenderPoint=aNe()}get updating(){return this._imageSources==null&&this._imageLoadTask!=null&&!this._imageLoadTask.task.finished}get magnifier(){return this._magnifier}set magnifier(e){if(e===this._magnifier)return;this._handles.removeAll(),this._magnifier=e;const r=()=>{this._updateResourceLoading(),this.events.emit("request-render")};this._magnifier!=null&&this._handles.add(pe(()=>rd(this._magnifier,i=>i.version),r)),r()}get enabled(){return this._validMagnifier!=null}get _validMagnifier(){return this._magnifier!=null&&this._magnifier.visible&&this._magnifier.position!=null&&this._magnifier.size>0?this._magnifier:null}get _factor(){return this._magnifier!=null&&this._magnifier.factor||1}destroy(){this._magnifier=null,this._handles.destroy(),this._imageLoadTask!=null&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null),this._disposeResources()}render(e,r){const i=this._validMagnifier;if(i==null)return;const n=r.camera.pixelRatio,s=Math.ceil(n*i.size);if(this._updateResources(e,s),this._resources==null)return;const o=this._passParameters.textures,a=Math.ceil(1/this._factor*s);o.input.resize(a,a),Oy(i.position,this._tmpScreenPoint);const l=r.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),c=r.camera.fullWidth,u=r.camera.fullHeight,h=.5*a,f=.5*a;l[0]=Te(l[0],h,c-h-1),l[1]=Te(l[1],f,u-f-1);const m=Math.floor(l[0]-h),g=Math.floor(l[1]-f),y=this._resources.program;y.bindTexture("textureInput",o.input),e.gl.copyTexImage2D(o.input.descriptor.target,0,o.input.descriptor.pixelFormat,m,g,a,a,0),this._passParameters.magnifier=i,e.useProgram(y),y.bindPass(this._passParameters,r),e.bindVAO(this._resources.vao),e.setPipelineState(this._resources.pipelineState),e.drawArrays(Zt.TRIANGLE_STRIP,0,4)}_updateResourceLoading(){const e=this._validMagnifier;if(e==null)return;const r=e.maskUrl,i=e.overlayUrl;this._imageLoadTask==null||this._imageLoadTask.maskUrl===r&&this._imageLoadTask.overlayUrl===i||(this._imageLoadTask.task.abort(),this._imageLoadTask=null,this._imageSources=null),this._imageSources==null&&this._imageLoadTask==null&&(this._imageLoadTask={maskUrl:r,overlayUrl:i,task:R3(async n=>{const s=r==null||i==null?_qt(n):null,o=r!=null?z_(r,{signal:n}):s.then(l=>l.mask),a=i!=null?z_(i,{signal:n}):s.then(l=>l.overlay);this._imageSources={mask:await o,overlay:await a},this._disposeResources(),this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}_updateResources(e,r){if(!this.enabled)return void this._disposeResources();if(this._resources!=null){if(this._passParameters.textures.size!==r){const n=this._createTextureResources(e,r);if(n==null)return void this._disposeResources();this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=n}return}const i=this._createTextureResources(e,r);i!=null&&(this._resources={program:this._createProgram(e),vao:vu(e,zde,this.attributeLocations,0,1),pipelineState:Qt({blending:Ed(De.ONE,De.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:hr})},this._passParameters.textures=i)}_disposeResources(){this._resources!=null&&(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)}_disposeTextureResources(e){e.mask.dispose(),e.overlay.dispose(),e.input.dispose()}_createTextureResources(e,r){if(this._imageSources==null)return null;this._imageSources.overlay.width=r,this._imageSources.overlay.height=r,this._imageSources.mask.width=r,this._imageSources.mask.height=r;const i=new Vr;i.internalFormat=Yt.RGBA,i.wrapMode=ir.CLAMP_TO_EDGE,i.flipped=!0,i.preMultiplyAlpha=!w$e(this._imageSources.overlay.src)||!e.driverTest.svgPremultipliesAlpha.result;const n=new Jt(e,i,this._imageSources.overlay);i.pixelFormat=i.internalFormat=Yt.ALPHA,i.preMultiplyAlpha=!1;const s=new Jt(e,i,this._imageSources.mask);return i.pixelFormat=i.internalFormat=Yt.RGBA,i.flipped=!1,{input:new Jt(e,i),mask:s,overlay:n,size:r}}_createProgram(e){return new Kr(e,mqt(),this.attributeLocations)}};d([p()],eO.prototype,"_imageSources",void 0),d([p()],eO.prototype,"_imageLoadTask",void 0),d([p({readOnly:!0})],eO.prototype,"updating",null),eO=d([I("esri/views/3d/webgl-engine/lib/MagnifierHelper")],eO);let bqt=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new zl(new ArrayBuffer(4)),this._uidToRenderColor=new Map,this._colorToUID=new Map,this._layerUidToGraphicsUidToObjectId=new Map,this._layerUidToId=new Map,this._layerUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,i,n,s,o=null,a=null,l=null){if(!(e&&r&&i&&n)||(this._layerUidToId.set(n,i),this._layerUidToPopupEnabled.set(n,s),!s))return;let c=this._layerUidToGraphicsUidToObjectId.get(n);c||(c=new Map,this._layerUidToGraphicsUidToObjectId.set(n,c)),c.set(r,{objectId:e,attributeNodeId:o,attributeIndex:a,subLayerId:l})}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return nr(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerUid||!e.graphicUid)return this.colorZero;const r=this._layerUidToPopupEnabled.get(e.layerUid);if(r===void 0)return re.getLogger(this).warn("popupEnabled is undefined for layerUid "+e.layerUid),this.colorZero;if(r===!1)return this.colorZero;let i=this._uidToRenderColor.get(e.layerUid);i||(i=new Map,this._uidToRenderColor.set(e.layerUid,i));let n=i.get(e.graphicUid);if(!n){for(;!n;){const o=Math.floor(16777214*Math.random())+1;this._colorToUID.has(o)||(n=o)}if(n>16777215)throw new Error("Object ID Overflow");i.set(e.graphicUid,n),this._colorToUID.set(n,e)}const s=new ArrayBuffer(4);return new DataView(s).setUint32(0,n,!1),new zl(s)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,i]of this._colorToUID.entries()){const n=this._layerUidToGraphicsUidToObjectId.get(i.layerUid);let s=null;n?(s=n.get(i.graphicUid),s||re.getLogger(this).warn("getColorMapping: no entry found for graphicsId "+i.graphicUid)):re.getLogger(this).warn("getColorMapping: no entry found for layerUid "+i.layerUid);const o=this._layerUidToId.get(i.layerUid);o||re.getLogger(this).warn("no layerId found for uid "+i.layerUid),s&&o&&e.set(r,s.attributeNodeId?{type:"object-and-layer-and-i3s-id",oid:s.objectId,lid:o,attrId:s.attributeNodeId,attrIdx:s.attributeIndex,subLayerId:s.subLayerId}:{type:"object-and-layer-id",oid:s.objectId,lid:o})}return e}};var u4;(function(t){t[t.FrontToBack=0]="FrontToBack",t[t.BackToFront=1]="BackToFront"})(u4||(u4={}));let q1=class{constructor(e,r,i=u4.FrontToBack){this._rctx=e,this._techniqueRepository=r,this._sorting=i,this._draws=new dr({initialSize:32,allocator:n=>n||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,r,i,n){const s=this._draws.pushNew();s.geometry=r,s.geometryRanges=i,s.material=e,s.depthSquaredHint=n,s.indexType=(r.indexed?r.vao.indexBuffer.indexType:null)??0}prepare(e,r){return this._draws.map(i=>i.material.prepareTechnique(this._techniqueRepository,e,r,i.geometry.parameters))}dispatch(e,r,i){const n=this._rctx;this._previouslyBoundDraw.clear();let s=null;const o=this._draws.length;for(let a=0;a<o;a++){const l=i[a];l===s&&l.configuration.transparencyPassType===kt.NONE||(n.bindTechnique(l,e,r),s=l);const c=this._draws.data[a],u=c.geometry;n.bindVAO(u.vao),this._previouslyBoundDraw.get(l)!==c.material&&(l.program.bindDraw(c.material,r,e),this._previouslyBoundDraw.set(l,c.material));const h=c.geometryRanges,f=h.length;if(c.indexType!==0){const m=Zz.get(c.indexType);for(let g=0;g<f;g+=2){const y=h[g],_=h[g+1];n.drawElements(u.primitiveType,_,c.indexType,y*m)}}else for(let m=0;m<f;m+=2){const g=h[m],y=h[m+1];n.drawArrays(u.primitiveType,g,y)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=this._sorting===u4.FrontToBack?1:-1;this._draws.sort((r,i)=>{const n=e*(r.depthSquaredHint-i.depthSquaredHint);return n!==0?n:r.geometry.vao.byteSize-i.geometry.vao.byteSize})}get count(){return this._draws.length}};const Zz=new Map;Zz.set($t.UNSIGNED_BYTE,1),Zz.set($t.UNSIGNED_SHORT,2),Zz.set($t.UNSIGNED_INT,4);let wqt=class{constructor(e,r){this.rctx=e,this.shaderTechniqueRepository=r,this.canRender=!0,this._materialPassParameters=new Mjt,this._shadowPassParameters=new $jt,this._highlightPassParameters=new Ijt,this._systems=new Set,this._passes={materialOpaque:new q1(e,r),materialTransparent:new q1(e,r,u4.BackToFront),materialIntegratedMesh:new q1(e,r),shadowMap:new q1(e,r),highlight:new q1(e,r),highlightIntegratedMesh:new q1(e,r),highlightShadowMap:new q1(e,r),defaultShadowMap:new q1(e,r)}}destroy(){this._context=null,this._systems.clear()}register(e){this._systems.add(e)}prepareRender(e){if(this._systems.size!==0){for(const r of Object.values(this._passes))r.prepareSubmit();this._systems.forEach(r=>r.submit(this._passes,e.bindParameters));for(const r of Object.values(this._passes))r.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}}prepareTechniques(e){return this._systems.size===0?null:(this._configure(e),this._materialPassParameters.output=e.output,this._invoke(e,(r,i)=>r.prepare(i,e.bindParameters)))}render(e,r){this._invoke(e,(i,n)=>i.dispatch(n,e.bindParameters,r))}_invoke(e,r){switch(e.bindParameters.slot){case _e.OPAQUE_MATERIAL:switch(e.output){case q.Color:case q.Depth:case q.Normal:case q.ObjectAndLayerIdColor:return r(this._passes.materialOpaque,this._materialPassParameters);case q.Highlight:return r(this._passes.highlight,this._highlightPassParameters);case q.Shadow:return r(this._passes.shadowMap,this._shadowPassParameters);case q.ShadowHighlight:return r(this._passes.highlightShadowMap,this._shadowPassParameters);case q.ShadowExcludeHighlight:return r(this._passes.defaultShadowMap,this._shadowPassParameters)}break;case _e.TRANSPARENT_MATERIAL:switch(e.output){case q.Color:case q.Alpha:case q.Depth:case q.Normal:case q.ObjectAndLayerIdColor:return r(this._passes.materialTransparent,this._materialPassParameters)}break;case _e.INTEGRATED_MESH:switch(e.output){case q.Color:case q.Depth:case q.Normal:case q.ObjectAndLayerIdColor:return r(this._passes.materialIntegratedMesh,this._materialPassParameters);case q.Highlight:return r(this._passes.highlightIntegratedMesh,this._highlightPassParameters)}}return null}notifyDirty(){this._context.requestRender()}slots(){return[_e.OPAQUE_MATERIAL,_e.TRANSPARENT_MATERIAL,_e.INTEGRATED_MESH]}initializeRenderContext(e){this._context=e}uninitializeRenderContext(){}queryDepthRange(e){const r={near:1/0,far:-1/0};return this._systems.forEach(i=>{const n=i.queryShadowCasterDepthRange(e);n!=null&&o3(r,n,r)}),r}_configure(e){const r=e.output===q.Shadow||e.output===q.ShadowHighlight||e.output===q.ShadowExcludeHighlight?this._shadowPassParameters:e.output===q.Highlight?this._highlightPassParameters:this._materialPassParameters;this._updateParameters(e,r)}_updateParameters(e,r){const i=e.bindParameters.camera,n=i.viewInverseTransposeMatrix;se(rJ,n[3],n[7],n[11]),iJ.set(rJ),oe(r.transformWorldFromViewTH,iJ.high),oe(r.transformWorldFromViewTL,iJ.low),oe(r.slicePlaneLocalOrigin,rJ),uf(r.transformViewFromCameraRelativeRS,i.viewMatrix),Rs(r.transformProjFromView,i.projectionMatrix),r.identifier===ed.Material&&(this._materialPassParameters.transparent=e.bindParameters.slot===_e.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=e.bindParameters.slot===_e.INTEGRATED_MESH,df(tCe,r.transformViewFromCameraRelativeRS),UE(r.transformNormalViewFromGlobal,tCe))}get needsHighlight(){return this._passes.highlight.count>0||this._passes.highlightIntegratedMesh.count>0}get needsTransparentPass(){return this._passes.materialTransparent.count>0}};const rJ=A(),tCe=vn(),iJ=new gq;let xqt=class{constructor(){this._step=nCe,this._dilation=1,this._firstIdleTime=0}frame(e,r){if(r?this._firstIdleTime===0&&(this._firstIdleTime=performance.now()):this._firstIdleTime=0,he("disable-feature:high-quality-idle"))this._dilation=1;else{const n=r?performance.now()-this._firstIdleTime:0;if(n>=rCe+Tqt)return this._step=1/0,void(this._dilation=1);this._dilation=n>=rCe?Eqt:1}const i=Te(e/Sqt,nCe,Rqt);this._step===1/0?this._step=i:this._step=this._step*iCe+i*(1-iCe)}get value(){return this._step}get timeDilation(){return this._dilation}clear(){this._step=this._firstIdleTime=0}};const Sqt=.5,rCe=12e4,Tqt=1e4,Eqt=10,iCe=.9,Cqt=30,nCe=1e3/1,Rqt=1e3/Cqt,Oqt=8.6,Aqt=.4;function Pqt(){const t=new jr,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(O.POSITION,"vec2"),t.varyings.add("uv","vec2"),t.attributes.add(O.UV0,"vec2"),e.uniforms.add(new Mt("coverageTex",s=>s.coverageTexture)),i.add(T`void main() {
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`),r.uniforms.add(new Mt("tex",s=>s.blurColorTexture),new Mt("origin",s=>s.highlightColorTexture),new Cr("uColor",s=>s.color),new Cr("haloColor",s=>s.haloColor),new Cr("opacities",s=>Ki(Mqt,s.haloOpacity,s.haloOpacityOccluded,s.fillOpacity,s.fillOpacityOccluded))),r.constants.add("outlineSize","float",Oqt),r.constants.add("blurSize","float",Aqt),n.add(T`void main() {
vec4 blurredHighlightValue = texture(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
fragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`),t}const Mqt=wr(),$qt=Object.freeze(Object.defineProperty({__proto__:null,build:Pqt},Symbol.toStringTag,{value:"Module"}));let E7e=class C7e extends si{initializeProgram(e){return new Kr(e.rctx,C7e.shader.get().build(),Br)}initializePipeline(){return Qt({blending:Fa(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),colorWrite:hr})}};E7e.shader=new Jr($qt,()=>le(()=>import("./HighlightApply.glsl-faef2840.js"),[]));let R7e=class extends Ai{constructor(){super(...arguments),this.blurSize=Qe()}};function Iqt(){const t=new jr,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(O.POSITION,"vec2"),t.attributes.add(O.UV0,"vec2"),t.varyings.add("blurCoordinate","vec3"),e.uniforms.add(new Mt("coverageTex",s=>s.coverageTexture)),r.uniforms.add(new gpe("blurSize",s=>s.blurSize)),i.add(T`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`),r.uniforms.add(new Wp("tex",s=>s.blurInputTexture)),n.add(T`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture(tex, uv);
if (blurCoordinate.z == 1.0) {
fragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture(tex, uv - blurSize * 3.294215) * 0.093913;
fragColor = sum;
}
}`),t}const Lqt=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:R7e,build:Iqt},Symbol.toStringTag,{value:"Module"}));let O7e=class A7e extends si{initializeProgram(e){return new Kr(e.rctx,A7e.shader.get().build(),Br)}initializePipeline(){return Qt({colorWrite:hr})}};O7e.shader=new Jr(Lqt,()=>le(()=>import("./HighlightBlur.glsl-19e0c2c2.js"),[]));let P7e=class extends Ai{constructor(){super(...arguments),this.invFramebufferDim=Qe()}};function Dqt(){const t=new jr,{vertex:e,fragment:r}=t,i=e.code,n=r.code;return t.attributes.add(O.POSITION,"vec2"),i.add(T`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`),r.uniforms.add(new Wp("tex",s=>s.inputTexture)),r.uniforms.add(new gpe("invFramebufferDim",s=>s.invFramebufferDim)),n.add(T`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture(tex, coord);
float mx = floor(max(value.g, value.b));
fragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`),t}const Nqt=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:P7e,build:Dqt},Symbol.toStringTag,{value:"Module"}));let M7e=class $7e extends si{initializeProgram(e){return new Kr(e.rctx,$7e.shader.get().build(),Br)}initializePipeline(){return Qt({colorWrite:hr})}};M7e.shader=new Jr(Nqt,()=>le(()=>import("./HighlightDownsample.glsl-bca2d088.js"),[]));let sCe=class extends Ai{constructor(){super(...arguments),this.color=y0(1,0,1,1),this.haloColor=y0(1,0,1,1),this.haloOpacity=1,this.haloOpacityOccluded=.25,this.fillOpacity=.2,this.fillOpacityOccluded=.05,this.shadowColor=nr(1,0,1,1),this.shadowOpacity=.15,this.occludedShadowOpacity=.075}};const Fqt=32;let kqt=class{constructor(e,r){this._techniqueRep=e,this._rctx=r,this._viewportToRestore=wr(),this._passParameters=new sCe,this._downsampleDrawParameters=new P7e,this._blurDrawParameters=new R7e,this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}_assertResources(){if(this._quadVAO)return;this._quadVAO=vu(this._rctx);const e=new Vr;e.wrapMode=ir.CLAMP_TO_EDGE,this._blur0Fbo=new wo(this._rctx,e),this._blur1Fbo=new wo(this._rctx,e),this._blurTechnique=this._techniqueRep.acquire(O7e),this._downsampleTechnique=this._techniqueRep.acquire(M7e),this._applyTechnique=this._techniqueRep.acquire(E7e)}dispose(){if(this._blurTechnique=xn(this._blurTechnique),this._downsampleTechnique=xn(this._downsampleTechnique),this._applyTechnique=xn(this._applyTechnique),this._grid.coverageMipmap)for(let e=1;e<this._grid.coverageMipmap.length;e++)this._grid.coverageMipmap[e].dispose();this._grid.vao&&this._grid.vao.dispose(),this._quadVAO&&(this._quadVAO.dispose(),this._quadVAO=null),this._blur0Fbo=pt(this._blur0Fbo),this._blur1Fbo=pt(this._blur1Fbo)}setDefaultOptions(e){this._passParameters={...new sCe,...e}}render(e,r,i){this._passParameters.highlightColorTexture=r.colorTexture,this._assertResources();const n=e.camera;Up(this._viewportToRestore,n.fullViewport);const s=n.fullWidth,o=n.fullHeight,a=n.pixelRatio,l=Math.ceil(s/a),c=Math.ceil(o/a);this._blur0Fbo.resize(l,c),this._blur1Fbo.resize(l,c);const u=this._rctx;u.bindVAO(this._quadVAO);let h=null;this._gridUpdateResources(r,Fqt),this._gridComputeMipmap(e),this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,h=this._grid.vao;const f=u.bindTechnique(this._blurTechnique,this._passParameters,e);u.bindVAO(h),u.bindFramebuffer(this._blur0Fbo),u.setViewport(0,0,l,c),u.setClearColor(0,0,0,0),u.clear(Qi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=r.colorTexture,Or(this._blurDrawParameters.blurSize,1/l,0),f.bindDraw(this._blurDrawParameters,e,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,el(h,"geometry")),u.bindFramebuffer(this._blur1Fbo),u.clear(Qi.COLOR_BUFFER_BIT),this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture,Or(this._blurDrawParameters.blurSize,0,1/c),f.bindDraw(this._blurDrawParameters,e,this._passParameters),u.drawArrays(this._blurTechnique.primitiveType,0,el(h,"geometry")),u.bindFramebuffer(i),u.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]),this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture,u.bindTechnique(this._applyTechnique,this._passParameters,e),u.drawArrays(this._applyTechnique.primitiveType,0,el(h,"geometry")),u.bindVAO(null)}_gridUpdateResources(e,r){const i=this._rctx,n=this._grid;let s=!1;if(n.coverageMipmap===null&&(n.coverageMipmap=[e],s=!0),n.viewportWidth===e.width&&n.viewportHeight===e.height||(s=!0,n.viewportWidth=e.width,n.viewportHeight=e.height),n.coverageMipmap[0]=e,n.cellPixelSize!==r&&(n.cellPixelSize=r,s=!0),s){for(let l=1;l<n.coverageMipmap.length;l++)n.coverageMipmap[l].dispose();n.mipmapLevels=Math.ceil(Math.log(n.cellPixelSize)*Math.LOG2E),n.coverageMipmap.length=n.mipmapLevels+1;for(let l=0;l<n.mipmapLevels;l++){const c=n.coverageMipmap[l],u=new Vr(Math.ceil(c.width/2),Math.ceil(c.height/2));u.pixelFormat=Yt.RGB,u.dataType=Fs.UNSIGNED_SHORT_5_6_5,u.wrapMode=ir.CLAMP_TO_EDGE,n.coverageMipmap[l+1]=new wo(i,u)}}const o=Math.ceil(e.height/n.cellPixelSize),a=Math.ceil(e.width/n.cellPixelSize);if(!n.vao||n.verticalCellCount!==o||n.horizontalCellCount!==a){n.verticalCellCount=o,n.horizontalCellCount=a;const l=o+1,c=a+1,u=1/o,h=1/a,f=6,m=4,g=new Float32Array(f*m*l*c);let y=0;for(let _=0;_<l;_++)for(let b=0;b<c;b++)g[y]=(b-.5)*h*2-1,g[y+1]=(_-.5)*u*2-1,g[y+2]=b*h,g[y+3]=_*u,g[y+4]=(b+.5)*h*2-1,g[y+5]=(_-.5)*u*2-1,g[y+6]=b*h,g[y+7]=_*u,g[y+8]=(b-.5)*h*2-1,g[y+9]=(_+.5)*u*2-1,g[y+10]=b*h,g[y+11]=_*u,g[y+12]=(b-.5)*h*2-1,g[y+13]=(_+.5)*u*2-1,g[y+14]=b*h,g[y+15]=_*u,g[y+16]=(b+.5)*h*2-1,g[y+17]=(_-.5)*u*2-1,g[y+18]=b*h,g[y+19]=_*u,g[y+20]=(b+.5)*h*2-1,g[y+21]=(_+.5)*u*2-1,g[y+22]=b*h,g[y+23]=_*u,y+=f*m;n.vao&&n.vao.dispose(),n.vao=new gg(i,Br,{geometry:bF},{geometry:ci.createVertex(i,qr.STATIC_DRAW,g)})}}_gridComputeMipmap(e){const r=this._rctx,i=this._grid,n=r.bindTechnique(this._downsampleTechnique,this._passParameters,e);r.bindVAO(this._quadVAO);for(let s=0;s<i.mipmapLevels;s++){r.bindFramebuffer(i.coverageMipmap[s+1]);const o=i.coverageMipmap[s+1].width,a=i.coverageMipmap[s+1].height;this._downsampleDrawParameters.inputTexture=i.coverageMipmap[s].colorTexture,Or(this._downsampleDrawParameters.invFramebufferDim,1/o,1/a),n.bindDraw(this._downsampleDrawParameters,e,this._passParameters),r.setViewport(0,0,o,a),r.drawArrays(Zt.TRIANGLE_STRIP,0,el(this._quadVAO,"geometry"))}}get gpuMemoryUsage(){let e=(this._blur0Fbo!=null?this._blur0Fbo.gpuMemoryUsage:0)+(this._blur1Fbo!=null?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const r of this._grid.coverageMipmap)e+=r.gpuMemoryUsage;return e}get test(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}};const Uqt={dataType:Fs.UNSIGNED_BYTE,internalFormat:Yt.RGBA},zqt={};let Vqt=class{constructor(e){this._rctx=e,this._activeTargets=new Set,this._colorTextures=new Map,this._depthTextures=new Map,this._fbos=new Map}dispose(){this._depthTextures.forEach(e=>e.dispose()),this._depthTextures.clear(),this._colorTextures.forEach(e=>e.dispose()),this._colorTextures.clear(),this._fbos.forEach(e=>e.dispose()),this._fbos.clear(),this._activeTargets.clear()}disposeTargetResource(e){const r=e.id;this._activeTargets.has(r)&&(this._activeTargets.delete(r),this._disposeWithFramebuffers(this._depthTextures,r),this._disposeWithFramebuffers(this._colorTextures,r))}_disposeWithFramebuffers(e,r){const i=e.get(r);i&&(this._fbos.forEach((n,s)=>{n.colorTexture!==i&&n.depthStencilAttachment!==i||(n.detachColorTexture(),n.detachDepthStencilTexture(),n.dispose(),this._fbos.delete(s))}),i.dispose(),e.delete(r))}_getDepthTexture(e,r,i){let n=this._depthTextures.get(e.id);if(!n||n.descriptor.width===r&&n.descriptor.height===i||(n.dispose(),n=null),!n){const s=new Vr(r,i);s.pixelFormat=Yt.DEPTH_STENCIL,s.dataType=Fs.UNSIGNED_INT_24_8,s.samplingMode=Kt.NEAREST,s.wrapMode=ir.CLAMP_TO_EDGE,n=new Jt(this._rctx,s),this._depthTextures.set(e.id,n),this._activeTargets.add(e.id)}return n}getAllocatedDepthTexture(e){return this._depthTextures.get(e.id)}getColorTexture(e,r,i){let n=this._colorTextures.get(e.id);if(n&&(n.descriptor.width===r&&n.descriptor.height===i||(n.dispose(),n=x3())),!n){const s=new Vr(r,i);s.internalFormat=e.internalFormat,s.dataType=e.dataType,s.samplingMode=e.samplingMode!=null?e.samplingMode:Kt.LINEAR,s.wrapMode=ir.CLAMP_TO_EDGE,n=new Jt(this._rctx,s),this._colorTextures.set(e.id,n),this._activeTargets.add(e.id)}return n}getAllocatedColorTexture(e){return this._colorTextures.get(e.id)}registerDepthTarget(e={}){return{id:au(),...zqt,...e}}registerColorTarget(e={}){return{id:au(),...Uqt,...e}}getFramebuffer(e,r,i,n){const s=this._getKey(i,n);let o=this._fbos.get(s);const a=this.getColorTexture(i,e,r),l=n?this._getDepthTexture(n,e,r):void 0;return o?((o.width!==e||o.height!==r||o.colorTexture!==a||o.depthStencilAttachment!==l)&&(o.detachColorTexture(),o.detachDepthStencilTexture(),o.resize(e,r),o.attachColorTexture(a),o.attachDepthStencil(l)),o):(o=new wo(this._rctx,a,l),this._fbos.set(s,o),o)}_getKey(e,r){return`${e.id}_${r?r.id:"X"}_${e.name}${r?"_"+r.name:""}`}get gpuMemoryUsage(){let e=0;const r=new Set,i=n=>{r.has(n)||(r.add(n),e+=n.gpuMemoryUsage)};return this._colorTextures.forEach(i),this._depthTextures.forEach(i),e}},Bqt=class{constructor(e,r){this._rctx=e,this._compositingHelper=r,this._mainColorTarget=0,this.width=4,this.height=4,this._background={type:"color",color:[0,0,0,1]},this._renderTargetHelper=new Vqt(e);const i=this._renderTargetHelper;this._mainColorTargets=[i.registerColorTarget({name:"mainColorTarget0"}),i.registerColorTarget({name:"mainColorTarget1"})],this.frontFaceTarget=i.registerColorTarget({name:"frontFaceTarget"}),this.colorFloatTarget=i.registerColorTarget({name:"colorFloatTarget",dataType:Fs.HALF_FLOAT,internalFormat:Et.RGBA16F,samplingMode:Kt.NEAREST}),this.alphaFloatTarget=i.registerColorTarget({name:"alphaFloatTarget",dataType:Fs.HALF_FLOAT,internalFormat:Et.R16F,samplingMode:Kt.NEAREST}),this.mainDepth=i.registerDepthTarget({name:"mainDepth"}),this.linearDepth=i.registerColorTarget({name:"linearDepth",samplingMode:Kt.NEAREST}),this.terrainLinearDepth=i.registerColorTarget({name:"terrainLinearDepth"}),this.geometryLinearDepth=i.registerColorTarget({name:"geometryLinearDepth"}),this.normal=i.registerColorTarget({name:"normal"}),this.highlight=i.registerColorTarget({name:"highlight",internalFormat:Et.RGBA4,dataType:Fs.UNSIGNED_SHORT_4_4_4_4}),this.hudVisibility=i.registerColorTarget({name:"hudVisibility",internalFormat:Et.RGBA4,dataType:Fs.UNSIGNED_SHORT_4_4_4_4}),this.tmpColor=i.registerColorTarget({name:"tmpColor"}),this.tmpDepth=i.registerDepthTarget({name:"tmpDepth"}),this.hudColor=i.registerColorTarget({name:"hudColor"})}dispose(){this._renderTargetHelper.dispose()}set background(e){this._background=e}get background(){return this._background}get currentColorTarget(){return this._mainColorTargets[this._mainColorTarget]}get previousColorTarget(){return this._mainColorTargets[1-this._mainColorTarget]}get framebuffer(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}getFramebuffer(e,r){return this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r)}get colorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}get depthTexture(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}get linearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}get terrainLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}get geometryLinearDepthTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}get lastFrameColorTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}get normalTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}get highlightTexture(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}get hudVisibilityTexture(){return this._getColorTexture(this.hudVisibility)}get tmpColorTexture(){return this._getColorTexture(this.tmpColor)}get hudColorTexture(){return this._getColorTexture(this.hudColor)}get mainColorTexture(){return this._getColorTexture(this.currentColorTarget)}setupRenderTarget(e){e?this._mainColorTarget=this._mainColorTarget?0:1:(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]))}initializeFrame(e){const r=this._rctx;this.width=e.fullWidth,this.height=e.fullHeight,l2(this,r.parameters.maxTextureSize),this.bindTarget(this.currentColorTarget,this.mainDepth),r.setClearStencil(0);const i=this._background.color;r.setClearColor(i[0]*i[3],i[1]*i[3],i[2]*i[3],i[3]),r.clearSafe(Qi.COLOR_BUFFER_BIT|Qi.DEPTH_BUFFER_BIT|Qi.STENCIL_BUFFER_BIT)}composite(e){this.colorTexture!=null&&this._compositingHelper.composite(e,this.colorTexture,Pl.None)}renderTmpAndCompositeToMain(e,r,i,n=!1){this.renderToTargets(e,this.tmpColor,n?this.tmpDepth:this.mainDepth,jqt),this._compositingHelper.composite(r,this._getColorTexture(this.tmpColor),i)}compositeAtmosphereToMain(e,r,i,n){this.bindTarget(this.currentColorTarget),this._compositingHelper.compositeAtmosphere(e,this._renderTargetHelper.getColorTexture(this.tmpColor,this.width,this.height),i,n,r),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderHUDVisibility(e,r=!1){this.renderToTargets(e,this.hudVisibility,r?this.tmpDepth:this.mainDepth,Gqt)}compositeTransparentTerrainOntoHUDVisibility(e){this.renderToTargets(()=>this._compositingHelper.compositeHUD(e,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)}renderOITPass(e,r,i){let n,s;switch(r){case kt.Color:n=this.colorFloatTarget,s=[0,0,0,0];break;case kt.Alpha:n=this.alphaFloatTarget,s=[1,1,1,1];break;case kt.FrontFace:n=this.frontFaceTarget,s=[0,0,0,0];break;case kt.NONE:case kt.COUNT:return}i?this.renderToTargets(e,n,this.tmpDepth,s,!0,!0):this.renderToTargets(e,n,this.mainDepth,s,!1)}compositeTransparentTerrainOntoMain(e){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),Pl.PremultipliedAlpha)}compositeOccludedOntoMain(e,r){this.bindFramebuffer(),this._compositingHelper.composite(e,this._getColorTexture(this.tmpColor),Pl.PremultipliedAlpha,r)}compositeTransparentOntoOpaque(e,r){r?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1e-13),this._rctx.clearSafe(Qi.COLOR_BUFFER_BIT)):this.bindFramebuffer(),this._compositingHelper.compositeOIT(e,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))}bindFramebuffer(){this._rctx.bindFramebuffer(this.framebuffer)}renderDepthDetached(e){this.bindTarget(this.currentColorTarget),e(),this.bindTarget(this.currentColorTarget,this.mainDepth)}disposeTarget(e){this._renderTargetHelper.disposeTargetResource(e)}renderToFBO(e,r,i=!1,n=!1){const s=this._rctx;let o=0;if(r){const l=Math.max(1e-13,r[3]);s.setClearColor(r[0],r[1],r[2],l),o|=Qi.COLOR_BUFFER_BIT}i&&(o|=Qi.DEPTH_BUFFER_BIT),n===!1?n=0:(n===!0&&(n=255),o|=Qi.STENCIL_BUFFER_BIT),o&&s.clearSafe(o,n),e(),s.gl.flush(),this.bindTarget(this.currentColorTarget,this.mainDepth)}renderToTargets(e,r,i,n,s=!1,o=!1){const a=this.bindTarget(r,i);return this.renderToFBO(e,n,s,o),a}bindTarget(e,r){const i=this._renderTargetHelper.getFramebuffer(this.width,this.height,e,r);return this._rctx.bindFramebuffer(i),i}_getColorTexture(e){return this._renderTargetHelper.getColorTexture(e,this.width,this.height)}get gpuMemoryUsage(){let e=0;return this._renderTargetHelper&&(e+=this._renderTargetHelper.gpuMemoryUsage),e}};const jqt=[0,0,0,0],Gqt=[0,1,0,1];let cL=class extends Ce{constructor(e){super({}),this._context=e,this._renderPlugins=new dr,this._slots=[];for(let r=0;r<_e.MAX_SLOTS;++r)this._slots[r]=[]}normalizeCtorArgs(){return{}}add(e,r,i){const n=()=>{if(i!=null&&i.aborted)throw r.uninitializeRenderContext(),Wr();this._renderPlugins.push(r);for(const o of e)this._slots[o].push(r);this._context.requestRender()},s=r.initializeRenderContext(this._context,i);if(Dh(s))return s.then(n);n(),this.notifyChange("_renderPlugins")}remove(e){if(this._renderPlugins.removeUnordered(e)!=null){for(let r=0;r<this._slots.length;++r)this._slots[r]=this._slots[r].filter(i=>i!==e);e.uninitializeRenderContext(),this._context.requestRender(),this.notifyChange("_renderPlugins")}}prepareRender(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this._context.renderContext)})}updateAnimation(e){let r=!1;return this._renderPlugins.forAll(i=>{i.updateAnimation&&(r=i.updateAnimation(e)||r)}),r}prepareSlots(e){for(const r of e)this._context.renderContext.bindParameters.slot=r,this._slots[r].filter(i=>{i.canRender&&(oCe(i)&&i.prepareTechnique(this._context.renderContext),aCe(i)&&i.prepareTechniques(this._context.renderContext))})}render(){const e=this._slots[this._context.renderContext.bindParameters.slot],r=new Array;e.filter(i=>{if(!i.canRender)return!1;if(oCe(i)){const n=i.prepareTechnique(this._context.renderContext);return n!=null&&(r.push(n),!0)}if(aCe(i)){const n=i.prepareTechniques(this._context.renderContext);return n!=null&&(r.push(n),!0)}return r.push(null),!0}).forEach((i,n)=>i.render(this._context.renderContext,r[n]))}queryDepthRange(e){const r=Hqt;return r.near=1/0,r.far=-1/0,this._renderPlugins.forAll(i=>{if(i.queryDepthRange){const n=i.queryDepthRange(e);n&&o3(r,n,r)}}),r}get updating(){return this._renderPlugins.some(e=>e.running)}get needsTransparentPass(){return this._renderPlugins.some(e=>e.needsTransparentPass)}get needsHighlight(){return this._renderPlugins.some(e=>e.needsHighlight)}get needsLinearDepth(){return this._renderPlugins.some(e=>e.needsLinearDepth)}get needsLaserlineWithContrastControl(){const e=this._slots[_e.LASERLINES_CONTRAST_CONTROL];return!!e&&e.length>0}get renderOccludedFlags(){return this._renderPlugins.reduce((e,r)=>e|r.renderOccludedFlags,gn.None)}};function oCe(t){return"prepareTechnique"in t}function aCe(t){return"prepareTechniques"in t}d([p()],cL.prototype,"_renderPlugins",void 0),d([p({readOnly:!0})],cL.prototype,"updating",null),cL=d([I("esri.views.3d.webgl-engine.lib.RenderPluginManager")],cL);const Hqt={near:0,far:0};let I7e=class extends ppe{};const yq=255,qqt=1/yq;function Wqt(t){const e=new jr,r=e.fragment;return r.include(Od),r.include(Ph),e.include(eq),e.include(wf),e.include(QH,t),r.uniforms.add(new Mt("depthMap",i=>i.linearDepthTexture),new yn("inverseViewMatrix",(i,n)=>Uo(lCe,hu(lCe,n.camera.viewMatrix,n.camera.center))),new Yr("nearFar",(i,n)=>n.camera.nearFar)),r.constants.add("sampleValue","float",qqt),r.code.add(T`void main(void) {
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
fragColor = vec4(sampleValue);
}`),e}const lCe=Me(),Xqt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:I7e,ShadowCastMaxSamples:yq,build:Wqt},Symbol.toStringTag,{value:"Module"}));var SE;(function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"})(SE||(SE={}));let ase=class extends jl{constructor(){super(...arguments),this.visualization=SE.Gradient,this.bandsEnabled=!1}};d([X({count:SE.COUNT})],ase.prototype,"visualization",void 0),d([X()],ase.prototype,"bandsEnabled",void 0);let L7e=class extends Ai{constructor(e){super(),this._data=e,this.sampleScale=0,this.opacityFromElevation=1,this.color=mF(Yqt),this.bandSize=.1,this.threshold=.5}get shadowCastMap(){return this._data.shadowCastTexture}};const Yqt=nr(.01,0,.25,1);function Zqt(t){const e=new jr,r=e.fragment;r.include(Od),r.include(Ph),e.include(eq),e.include(wf);const{visualization:i,bandsEnabled:n}=t;r.constants.add("inverseSampleValue","float",yq),r.uniforms.add(new Mt("shadowCastMap",a=>a.shadowCastMap),new Ye("sampleScale",a=>a.sampleScale),new Ye("opacityFromElevation",a=>a.opacityFromElevation),new Cr("uColor",a=>a.color));const s=i===SE.Gradient,o=i===SE.Threshold;return s&&n?r.uniforms.add(new Ye("bandSize",a=>a.bandSize)):o&&r.uniforms.add(new Ye("threshold",a=>a.threshold)),r.code.add(T`
      void main(void) {
        vec4 record = texture(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${o?T`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${s&&n?T`strength = ceil(strength / bandSize) * bandSize;`:""}

        fragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${s?T`* strength`:""});
      }
    `),e}const Jqt=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:L7e,build:Zqt},Symbol.toStringTag,{value:"Module"}));let D7e=class N7e extends si{constructor(e,r){super(e,r,()=>this.destroy())}initializeProgram(e){return new Kr(e.rctx,N7e.shader.get().build(this.configuration),Br)}initializePipeline(){return Qt({blending:bh,colorWrite:hr,depthTest:null,depthWrite:null})}get primitiveType(){return Zt.TRIANGLE_STRIP}};D7e.shader=new Jr(Jqt,()=>le(()=>import("./ShadowCastVisualize.glsl-872c84bd.js"),[]));const Kqt=4e4,Qqt=5e4,F7e=1/512;let Jz=class extends Ce{constructor(e,r,i,n){super({}),this._techniqueRepository=e,this._rctx=r,this._data=i,this._requestRender=n,this._passParameters=new L7e(this._data),this._techniqueConfig=new ase,this._enabled=!1,this._vao=vu(r),this._techniqueConfig.visualization=SE.Gradient}normalizeCtorArgs(){return{}}dispose(){this._stop(),this._vao=pt(this._vao),this._techniqueRepository.release(this._technique),this._technique=null}get _visualizeShadowCastTechnique(){return this._technique=this._techniqueRepository.releaseAndAcquire(D7e,this._techniqueConfig,this._technique),this._technique}render(e){if(!this._showVisualization)return;this._passParameters.sampleScale=1/this._data.computedSamples;const r=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(r,this._passParameters,e),this._rctx.drawArrays(r.primitiveType,0,el(this._vao,"geometry"))}setOptions(e){e.enabled!==void 0&&this._setEnabled(e.enabled),e.color!==void 0&&this._setColor(e.color),e.threshold!==void 0&&(this._threshold=e.threshold),e.visualization!==void 0&&(this._visualization=e.visualization),e.bandSize!==void 0&&(this._bandSize=e.bandSize),e.bandsEnabled!==void 0&&(this._bandsEnabled=e.bandsEnabled)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&this._data.computedSamples>0&&this.opacityFromElevation>F7e}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfRunning())}get _visualization(){return this._techniqueConfig.visualization}set _visualization(e){e!==this._visualization&&(this._techniqueConfig.visualization=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfRunning())}get _bandsEnabled(){return this._techniqueConfig.bandsEnabled}set _bandsEnabled(e){e!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=e,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}_setColor(e){const r=this._passParameters.color;xA(e,r)||(Up(this._passParameters.color,e),this._requestRenderIfRunning())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfRunning(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}};d([p()],Jz.prototype,"opacityFromElevation",null),Jz=d([I("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],Jz);let ffe=class extends jl{constructor(){super(...arguments),this.receiveShadows=!0}};d([X()],ffe.prototype,"receiveShadows",void 0);let k7e=class U7e extends si{constructor(e){super(e,new ffe,()=>this.destroy())}initializeProgram(e){return new Kr(e.rctx,U7e.shader.get().build(this.configuration),Br)}initializePipeline(){return Qt({blending:Fa(De.ONE,De.ONE,De.ONE,De.ONE),colorWrite:hr,depthTest:null,depthWrite:null})}get primitiveType(){return Zt.TRIANGLE_STRIP}};k7e.shader=new Jr(Xqt,()=>le(()=>import("./ShadowCastAccumulate.glsl-4ea4d0c4.js"),[]));let Hc=class extends Ce{constructor(e,r,i,n,s,o){super({}),this._rctx=e,this._stage=i,this._prepareForShadowMapPass=n,this._renderToShadowMap=s,this._requestRender=o,this._progress=0,this._sampleCount=0,this._passParameters=new I7e,this._cachedLightDirections=[],this._depthRange=Qne,this._previewing=!1,this._handles=new Ri,this._cameraForcedForScreenshot=!1,this._bindParameters=new bH(new dpe(e,i.viewingMode),null,null),this._bindParameters.shadowMap.enabled=!0,this._vao=vu(e),this._accumulationRenderer=new Jz(r,e,this,o);const a=this._stage.view.resourceController.scheduler;this._handles.add([a.registerTask(Vt.SHADOW_ACCUMULATOR,this),pe(()=>i.renderView,l=>{this._handles.remove(cCe),l!=null&&this._handles.add(l.events.on("force-camera-for-screenshot",()=>this._cameraForcedForScreenshot=!0),cCe)},Bi),pe(()=>this._previewing,()=>this._requestRenderIfEnabled(),li)])}normalizeCtorArgs(){return{}}dispose(){this._disable(),this._handles.destroy(),this._accumulationRenderer=pt(this._accumulationRenderer),this._bindParameters.shadowMap.dispose(),this._fbo=pt(this._fbo),this._vao=pt(this._vao),this._accumulationTechniqueCached=xn(this._accumulationTechniqueCached),this._cachedLightDirections.length=0,this._sampleCount=0}get computedSamples(){return this._progress}get shadowCastTexture(){var e;return(e=this._fbo)==null?void 0:e.colorTexture}get isAccumulating(){return this._isPreviewing||this._isRefining}get _accumulationTechnique(){if(this._accumulationTechniqueCached==null){const e={rctx:this._rctx,viewingMode:this._stage.viewingMode};this._accumulationTechniqueCached=new k7e(e)}return this._accumulationTechniqueCached}get _isRefining(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}get _isPreviewing(){return this._isActive&&this._previewing}get _isActive(){return this._fbo!=null&&this._sampleCount>0}get canAccumulate(){return this._passParameters.linearDepthTexture!==null&&this._depthRange!==Qne&&this._opacityFromElevation>F7e}get _isDoneAccumulating(){return this._progress>=this._sampleCount}get _lightDirections(){return this._cachedLightDirections}set _lightDirections(e){const r=this._cachedLightDirections;if(T_(r,e,Ww))return;const i=Math.min(yq,e.length);r.length=i,this._sampleCount=i;for(let n=0;n<i;++n)r[n]=oe(r[n]??A(),e[n]);this._invalidate()}get _opacityFromElevation(){return this._accumulationRenderer.opacityFromElevation}set _opacityFromElevation(e){this._accumulationRenderer.opacityFromElevation=e}get running(){return this._isRefining&&this.canAccumulate&&this._progress>0}runTask(e){for(this._prepareForShadowMapPass(this._bindParameters);!e.done&&!this._isDoneAccumulating;)this._accumulateShadow(),e.madeProgress();this._requestRender()}renderAccumulation(e,r,i,n){if(this._depthRange=r,this._updateCamera(i),this._bindParameters.contentCamera=n,this._passParameters.linearDepthTexture=e,this._passParameters.origin=this._bindParameters.camera.center,this.notifyChange("canAccumulate"),!this.isAccumulating||!this.canAccumulate)return;(this._previewing||this._progress===0||this._cameraForcedForScreenshot)&&this._clear();const s=this._cameraForcedForScreenshot?this._sampleCount:Math.min(eWt,this._sampleCount-this._progress);for(let o=0;o<s;++o)this._accumulateShadow();this._cameraForcedForScreenshot=!1,this._requestRender()}render(e){this._accumulationRenderer.render(e)}setOptions(e){if(e.enabled!==void 0){const r=this._fbo!=null;e.enabled!==r&&(e.enabled?this._enable():this._disable())}e.previewing!==void 0&&(this._previewing=e.previewing),e.lightDirections!==void 0&&(this._lightDirections=e.lightDirections),this._accumulationRenderer.setOptions(e)}readAccumulatedShadow(e,r){return!this._isActive||!this._fbo||this._progress<1||e<0||e>=this._fbo.width||r<0||r>=this._fbo.height?0:(this._fbo.readPixels(e,r,1,1,Yt.RGBA,Fs.UNSIGNED_BYTE,uCe),uCe[0]/this._progress)}_enable(){this._progress=0;const e=new Vr;e.wrapMode=ir.CLAMP_TO_EDGE,this._fbo=new wo(this._rctx,e)}_disable(){this._fbo=pt(this._fbo)}_invalidate(){this._progress=0,this._requestRenderIfEnabled()}_clear(){this._rctx.bindFramebuffer(this._fbo),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(Qi.COLOR_BUFFER_BIT),this._progress=0}_accumulateShadow(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const e=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo),this._rctx.bindTechnique(e,this._passParameters,this._bindParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(e.primitiveType,0,el(this._vao,"geometry"))}_sampleLightDirection(){return this._progress++,this._lightDirections[this._progress*tWt%this._lightDirections.length]}_updateCamera(e){!e.equals(this._bindParameters.camera)&&this._fbo&&(this._bindParameters.camera.copyFrom(e),this._fbo.resize(e.fullWidth,e.fullHeight),this._opacityFromElevation=1-EN(Kqt,Qqt,e.relativeElevation))}_requestRenderIfEnabled(){this._fbo&&this._requestRender()}get test(){const e=this;return{lightDirections:this._lightDirections,get isDone(){return e._isDoneAccumulating},get isActive(){return e._isActive}}}};d([p()],Hc.prototype,"_progress",void 0),d([p()],Hc.prototype,"_sampleCount",void 0),d([p()],Hc.prototype,"_fbo",void 0),d([p()],Hc.prototype,"_depthRange",void 0),d([p()],Hc.prototype,"_previewing",void 0),d([p()],Hc.prototype,"_accumulationRenderer",void 0),d([p()],Hc.prototype,"_isRefining",null),d([p()],Hc.prototype,"_isActive",null),d([p()],Hc.prototype,"canAccumulate",null),d([p()],Hc.prototype,"_isDoneAccumulating",null),d([p()],Hc.prototype,"_opacityFromElevation",null),d([p()],Hc.prototype,"running",null),Hc=d([I("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],Hc);const eWt=6,cCe="renderView",tWt=104729,uCe=new Uint8Array(4),dCe={highlightedThreshold:.99999,selfShadowThreshold:.025};function rWt(t){const e=new jr;e.include(vE,t);const r=e.fragment;return r.include(Od),r.include(Ph),e.include(eq),e.include(wf),r.uniforms.add(new Mt("defaultDepthTex",(i,n)=>n.shadowMap.getSnapshot(r3.Default)),new Mt("highlightDepthTex",(i,n)=>n.shadowMap.getSnapshot(r3.Highlight)),new Mt("depthMap",(i,n)=>n.linearDepthTexture),new Mt("highlightMap",(i,n)=>n.highlightColorTexture),new Cr("uColor",i=>i.shadowColor),new Yr("nearFar",(i,n)=>n.camera.nearFar),new Ye("opacity",i=>i.shadowOpacity),new Ye("occludedOpacity",i=>i.occludedShadowOpacity),new Ye("terminationFactor",i=>i.opacityElevation*i.dayNightTerminator),new ar("lightingMainDirectionView",(i,n)=>Se(pCe,lt(pCe,n.lighting.mainLight.direction,n.camera.viewInverseTransposeMatrix))),new Yr("texelSize",(i,n)=>n.linearDepthTexture!=null?Or(iWt,1/n.linearDepthTexture.descriptor.width,1/n.linearDepthTexture.descriptor.height):cg),new yn("inverseViewMatrix",(i,n)=>Uo(hCe,hu(hCe,n.camera.viewMatrix,n.camera.center)))),r.constants.add("unoccludedHighlightFlag","vec4",Z8e).add("highlightedThreshold","float",dCe.highlightedThreshold).add("selfShadowThreshold","float",dCe.selfShadowThreshold),r.code.add(T`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`),r.code.add(T`void main(void) {
vec4 highlightInfo = texture(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
fragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`),e}const hCe=Me(),pCe=A(),iWt=Qe(),nWt=Object.freeze(Object.defineProperty({__proto__:null,build:rWt},Symbol.toStringTag,{value:"Module"}));let sWt=class extends ppe{constructor(){super(...arguments),this.shadowColor=nr(1,0,1,1),this.shadowOpacity=.2,this.occludedShadowOpacity=.1,this.opacityElevation=1,this.dayNightTerminator=1}},z7e=class V7e extends si{constructor(e){super(e,new ffe,()=>this.destroy())}initializeProgram(e){return new Kr(e.rctx,V7e.shader.get().build(this.configuration),Br)}initializePipeline(){return Qt({blending:Fa(De.SRC_ALPHA,De.ONE,De.ONE_MINUS_SRC_ALPHA,De.ONE_MINUS_SRC_ALPHA),colorWrite:hr,depthTest:null,depthWrite:null})}get primitiveType(){return Zt.TRIANGLE_STRIP}};z7e.shader=new Jr(nWt,()=>le(()=>import("./ShadowHighlight.glsl-31e6506c.js"),[]));const oWt=.001953125,aWt=4e4,lWt=5e4;let cWt=class{constructor(e,r){this._rctx=e,this._viewingMode=r,this._maxOpacity=1,this._passParameters=new sWt,this._drawParameters=new A4t,this._vao=vu(this._rctx)}get _technique(){return this._techniqueCached==null&&(this._techniqueCached=new z7e({rctx:this._rctx,viewingMode:this._viewingMode})),this._techniqueCached}render(e,r){if(!e.shadowMap.enabled||!e.linearDepthTexture||!this.isVisible)return;const i=this._technique;this._drawParameters.origin=e.camera.center,this._rctx.bindFramebuffer(r),this._rctx.bindTechnique(i,this._passParameters,e).bindDraw(this._drawParameters,e,this._passParameters),this._rctx.bindVAO(this._vao),this._rctx.drawArrays(i.primitiveType,0,el(this._vao,"geometry"))}get gpuMemoryUsage(){var e;return((e=this._vao)==null?void 0:e.memoryEstimate)??0}setDefaultOptions(e){this._passParameters={...this._passParameters,...e},this._updateMaxOpacity()}updateParameters(e,r){this._passParameters.opacityElevation=1-EN(aWt,lWt,e.relativeElevation);const i=this._viewingMode===at.Global?Se(fCe,e.center):se(fCe,0,0,1),n=ye(i,r);this._passParameters.dayNightTerminator=EN(0,1,Te(30*n,0,1))}dispose(){this._vao=pt(this._vao),this._techniqueCached=xn(this._techniqueCached)}get isVisible(){const{opacityElevation:e,dayNightTerminator:r}=this._passParameters;return this._maxOpacity*e*r>=oWt}_updateMaxOpacity(){const e=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity);this._maxOpacity=e*this._passParameters.shadowColor[3]}};const fCe=A(),mCe=Z_();let uWt=class{constructor(){this._plane=Z_()}get isEnabled(){return!p5e(this.plane,mCe)}get plane(){return this._plane}set plane(e){VE(e||mCe,this._plane)}},dWt=class extends Ai{};function d4(t){t.uniforms.add(new Cr("resolution",e=>{const{descriptor:r}=e.colorTexture,i=r.width,n=r.height;return Ki(hWt,1/i,1/n,i,n)}))}const hWt=wr(),dR={maxSearchSteps:8,maxDistanceAreaTex:16};function pWt(){const t=new jr,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(O.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),r.add("maxOffset","vec4"),r.add("pixelCoord","vec2"),d4(i),i.code.add(T`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${T.int(dR.maxSearchSteps)} );
      }
    `),n.uniforms.add(new Mt("edgesTexture",s=>s.edges.colorTexture)),n.uniforms.add(new Mt("areaTexture",s=>s.areaTexture)),n.uniforms.add(new Mt("searchTexture",s=>s.searchTexture)),d4(n),n.code.add(T`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D tex, vec2 coord, vec2 offset) {
        return texture(tex, coord + offset.x * resolution.xy, 0.0);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${T.int(dR.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${T.int(dR.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${T.int(dR.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${T.int(dR.maxSearchSteps)}; i ++ ) {
          e = texture( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${T.int(dR.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        fragColor = weights;
      }
    `),t}const fWt=Object.freeze(Object.defineProperty({__proto__:null,build:pWt},Symbol.toStringTag,{value:"Module"}));let B7e=class j7e extends si{initializeProgram(e){return new Kr(e.rctx,j7e.shader.get().build(),Br)}initializePipeline(){return Qt({colorWrite:hr})}};B7e.shader=new Jr(fWt,()=>le(()=>import("./BlendWeights.glsl-318aaad0.js"),[]));function mWt(){const t=new jr,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(O.POSITION,"vec2"),r.add("uv","vec2"),r.add("offsets[2]","vec4"),d4(i),i.code.add(T`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`),n.uniforms.add(new Mt("blendWeightsTexture",s=>s.blend.colorTexture),new Mt("colorTexture",s=>s.colorTexture)),d4(n),n.code.add(T`void main() {
vec4 a;
a.rb = texture(blendWeightsTexture, uv).rb;
a.g = texture(blendWeightsTexture, offsets[1].zw).g;
a.a = texture(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
fragColor = texture( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture( colorTexture, uv, 0.0 );
vec4 Cop = texture( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
fragColor = mix(C, Cop, s);
}
}`),t}const gWt=Object.freeze(Object.defineProperty({__proto__:null,build:mWt},Symbol.toStringTag,{value:"Module"}));let G7e=class H7e extends si{initializeProgram(e){return new Kr(e.rctx,H7e.shader.get().build(),Br)}initializePipeline(){return Qt({colorWrite:hr})}};G7e.shader=new Jr(gWt,()=>le(()=>import("./Blur.glsl-330c0057.js"),[]));const gCe={threshold:.05,localConstrastAdaption:2};function yWt(){const t=new jr,{attributes:e,varyings:r,vertex:i,fragment:n}=t;return e.add(O.POSITION,"vec2"),d4(i),r.add("uv","vec2"),r.add("offsets[3]","vec4"),i.code.add(T`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`),n.uniforms.add(new Mt("colorTexture",s=>s.colorTexture)),n.code.add(T`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture(colorTexture, uv).rgb;

      vec3 Cleft = texture(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${T.float(gCe.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${T.float(gCe.localConstrastAdaption)}) * delta.xy);

      fragColor = vec4(edges, 0.0, 0.0);
    }
  `),t}const vWt=Object.freeze(Object.defineProperty({__proto__:null,build:yWt},Symbol.toStringTag,{value:"Module"}));let q7e=class W7e extends si{initializeProgram(e){return new Kr(e.rctx,W7e.shader.get().build(),Br)}initializePipeline(){return Qt({colorWrite:hr})}};q7e.shader=new Jr(vWt,()=>le(()=>import("./EdgeDetect.glsl-c394a2af.js"),[]));let uL=class extends Ce{constructor(e,r){super({}),this._rctx=e,this._techniqueRep=r,this._passParameters=new dWt,this._isEnabled=!1}normalizeCtorArgs(){return{}}dispose(){this._abortController=xc(this._abortController),this.disable()}_loadResources(e){if(this._abortController!=null)return!1;if(this._passParameters.searchTexture!=null)return!0;this._abortController=new AbortController;const r=this._abortController.signal;return le(()=>import("./SmaaRenderPassData-660b7d34.js"),[]).then(i=>this._loadTextures(i,r)).then(()=>e()).finally(()=>this._abortController=null),!1}_loadTextures(e,r){return vr(r),Promise.all([this._loadTextureFromBase64(e.areaTexture,Kt.LINEAR,Yt.RGB),this._loadTextureFromBase64(e.searchTexure,Kt.NEAREST,Yt.LUMINANCE)]).then(([i,n])=>{go(r)?(i.dispose(),n.dispose(),vr(r)):(this._passParameters.areaTexture=i,this._passParameters.searchTexture=n)})}get updating(){return this._abortController!=null}enable(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const n=new jl;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(q7e,n,this._edgeDetectTechnique),this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(B7e,n,this._blendWeightsTechnique),this._blurTechnique=this._techniqueRep.releaseAndAcquire(G7e,n,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=SRt(this._rctx);const r=new Vr(4,4);r.pixelFormat=Yt.RG,r.internalFormat=Et.RG8,r.wrapMode=ir.CLAMP_TO_EDGE,this._passParameters.edges=new wo(this._rctx,r);const i=new Vr(4,4);return i.pixelFormat=Yt.RGBA,i.wrapMode=ir.CLAMP_TO_EDGE,this._passParameters.blend=new wo(this._rctx,i),this._isEnabled=!0,!0}disable(){this._isEnabled&&(this._vao=pt(this._vao),this._passParameters.areaTexture=pt(this._passParameters.areaTexture),this._passParameters.searchTexture=pt(this._passParameters.searchTexture),this._passParameters.blend=pt(this._passParameters.blend),this._passParameters.edges=pt(this._passParameters.edges),this._isEnabled=!1)}get _validPassParameters(){return this._isEnabled?this._passParameters:null}render(e){const r=this._validPassParameters;if(r==null)return;r.colorTexture=e;const i=this._rctx,n=i.getBoundFramebufferObject(),s=e.descriptor.width,o=e.descriptor.height;i.bindVAO(this._vao),i.setViewport(0,0,s,o),r.edges.resize(s,o),i.bindFramebuffer(r.edges),i.setClearColor(0,0,0,1),i.clear(Qi.COLOR_BUFFER_BIT),i.bindTechnique(this._edgeDetectTechnique,r,null),i.drawArrays(Zt.TRIANGLES,0,3),r.blend.resize(s,o),i.bindFramebuffer(r.blend),i.setClearColor(0,0,1,1),i.clear(Qi.COLOR_BUFFER_BIT),i.bindTechnique(this._blendWeightsTechnique,r,null),i.drawArrays(Zt.TRIANGLES,0,3),i.bindFramebuffer(n),i.setClearColor(0,1,0,1),i.clear(Qi.COLOR_BUFFER_BIT),i.bindTechnique(this._blurTechnique,r,null),i.drawArrays(Zt.TRIANGLES,0,3)}_loadTextureFromBase64(e,r,i){return z_(e).then(n=>{const s=new Vr;return s.pixelFormat=i,s.wrapMode=ir.CLAMP_TO_EDGE,s.width=n.width,s.height=n.height,s.samplingMode=r,new Jt(this._rctx,s,n)})}};d([p()],uL.prototype,"_abortController",void 0),d([p({readOnly:!0})],uL.prototype,"updating",null),uL=d([I("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],uL);function _Wt(t,e){const r=-t[0],i=-t[1],n=-t[2],s=e[3],o=e[7],a=e[11],l=e[15];e[0]+=s*r,e[1]+=s*i,e[2]+=s*n,e[4]+=o*r,e[5]+=o*i,e[6]+=o*n,e[8]+=a*r,e[9]+=a*i,e[10]+=a*n,e[12]+=l*r,e[13]+=l*i,e[14]+=l*n}function bWt(t,e){const r=t[0],i=t[1],n=t[2];e[12]+=r*e[0]+i*e[4]+n*e[8],e[13]+=r*e[1]+i*e[5]+n*e[9],e[14]+=r*e[2]+i*e[6]+n*e[10],e[14]+=r*e[3]+i*e[7]+n*e[11]}let wWt=class{constructor(e){this._factory=e,this._originData=new Map}acquire(e){return this.register(this._factory.getOrigin(e))}register(e){const r=this._originData.get(e.id)||new xWt(e);return r.refCount++,this._originData.has(r.origin.id)||this._originData.set(r.origin.id,r),r}release(e){e.refCount--,e.refCount===0&&this._originData.delete(e.origin.id)}updateViewMatrices(e){this._originData.forEach(r=>{Rs(r.viewMatrix,e),bWt(r.origin.vec3,r.viewMatrix)})}},xWt=class{constructor(e){this.origin=e,this.refCount=0,this.viewMatrix=Me()}},SWt=class extends k6e{constructor(e,r){super(),this.distanceFalloffFactor=e,this.transparency=r,this.transformNormalViewFromGlobal=vn()}},TWt=class extends U6e{constructor(){super(...arguments),this.transformNormalViewFromGlobal=vn(),this.slicePlaneLocalOrigin=A(),this.transformNormalGlobalFromModel=vn()}};function EWt(t){const e=T`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;t.code.add(e)}const CWt=Nr(.5,-4e-4);function RWt(t,e){const r=t.vertex;r.include(EWt),r.constants.add("depthBias","vec2",CWt),r.uniforms.add(new Yr("inverseViewport",(i,n)=>n.inverseViewport)),e.legacy?(r.uniforms.add(new yn("proj",(i,n)=>n.camera.projectionMatrix)),r.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(r.uniforms.add(new xf("transformNormalViewFromGlobal",i=>i.transformNormalViewFromGlobal),new yn("transformProjFromView",i=>i.transformProjFromView)),r.code.add(T`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)),r.code.add(T`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)}function OWt(t,e){const r=t.fragment;r.constants.add("coverageTestThreshold","float",.01),e.antialiasing?r.code.add(T`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):r.code.add(T`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)}function AWt(t,e){const r=t.vertex;e.silhouette?(r.code.add(T`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),e.legacy?r.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):r.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):r.code.add(T`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)}function PWt(t,e){const r=t.vertex;r.include(Od),r.uniforms.add(new Ye("distanceFalloffFactor",i=>i.distanceFalloffFactor)),r.code.add(T`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`),r.uniforms.add(new Wp("componentDataTex",i=>i.componentDataTexture)),t.attributes.add(O.COMPONENTINDEX,"float"),r.constants.add("componentColorFieldOffset","float",0),r.constants.add("componentOtherFieldOffset","float",1),r.constants.add("componentVerticalOffsetFieldOffset","float",2),r.constants.add("componentFieldCount","float",3),r.constants.add("lineWidthFractionFactor","float",8),r.constants.add("extensionLengthOffset","float",128),r.constants.add("verticalOffsetScale","float",2*ufe),r.code.add(T`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float texSize = float(textureSize(componentDataTex, 0).x);
float colIndex = mod(fieldIndex, texSize);
float rowIndex = floor(fieldIndex / texSize);
return vec2(colIndex, rowIndex) + 0.5;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texelFetch(componentDataTex, ivec2(colorIndex), 0);
vec4 otherValue = texelFetch(componentDataTex, ivec2(otherIndex), 0);
float verticalOffset = (rgba2float(texelFetch(componentDataTex, ivec2(verticalOffsetIndex), 0)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`),e.legacy?r.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new BN("transformNormalGlobalFromModel",i=>i.transformNormalGlobalFromModel)),r.code.add(T`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`)),e.silhouette?(t.attributes.add(O.NORMALA,"vec3"),t.attributes.add(O.NORMALB,"vec3"),r.code.add(T`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(t.attributes.add(O.NORMAL,"vec3"),r.code.add(T`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`)),e.legacy?r.code.add(T`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(AB,e),r.include(AB,e),r.uniforms.add(new xf("transformViewFromCameraRelativeRS",i=>i.transformViewFromCameraRelativeRS),new BN("transformWorldFromModelRS",i=>i.transformWorldFromModelRS),new _h("transformWorldFromModelTL",i=>i.transformWorldFromModelTL),new _h("transformWorldFromModelTH",i=>i.transformWorldFromModelTH),new ar("transformWorldFromViewTL",i=>i.transformWorldFromViewTL),new ar("transformWorldFromViewTH",i=>i.transformWorldFromViewTH)),r.code.add(T`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${e.spherical?T`normalize(transformWorldFromModelTL + rotatedModelPosition);`:T`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `)),r.uniforms.add(new yn("transformProjFromView",(i,n)=>n.camera.projectionMatrix)),r.code.add(T`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`),r.code.add(T`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)}function MWt(t){return t.mode===vo.SKETCH||t.mode===vo.MIXED}var vo,XT;(function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH",t[t.MIXED=2]="MIXED",t[t.COUNT=3]="COUNT"})(vo||(vo={})),function(t){t[t.REGULAR=0]="REGULAR",t[t.SILHOUETTE=1]="SILHOUETTE"}(XT||(XT={}));function mfe(t,e){const r=t.vertex;switch(t.attributes.add(O.SIDENESS,"vec2"),e.mode===vo.MIXED?r.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):r.code.add(T`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`),e.mode){case vo.MIXED:r.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case vo.SKETCH:r.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case vo.SOLID:r.code.add(T`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case vo.COUNT:break;default:e.mode}}function $Wt(t,e){const r=t.vertex;switch(t.include(mfe,e),e.mode){case vo.SOLID:r.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case vo.SKETCH:r.uniforms.add(new P2("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case vo.MIXED:r.uniforms.add(new P2("strokesAmplitude",i=>i.strokesTexture.amplitude)),r.code.add(T`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}}function IWt(t,e){t.include(mfe,e);const{vertex:r,fragment:i}=t;switch(MWt(e)&&(r.uniforms.add(new Wp("strokesTexture",n=>n.strokesTexture.texture)),r.uniforms.add(new P2("strokesLog2Resolution",n=>Math.log2(n.strokesTexture.resolution)),new P2("strokeVariants",n=>n.strokesTexture.variants)),t.varyings.add("vStrokeUV","vec2"),i.uniforms.add(new Wp("strokesTexture",n=>n.strokesTexture.texture),new P2("strokesNormalizationScale",n=>n.strokesTexture.normalizationScale)),r.code.add(T`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) / vec2(textureSize(strokesTexture, 0));
vStrokeUV.x += variantOffset;
}`),t.fragment.include(Od),i.code.add(T`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`)),e.mode){case vo.SOLID:r.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`),i.code.add(T`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case vo.SKETCH:r.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`),i.code.add(T`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case vo.MIXED:t.varyings.add("vType","float"),r.code.add(T`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),i.code.add(T`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}}function LWt(t){const e=new jr,{vertex:r,fragment:i}=e;return t.legacy&&r.uniforms.add(new yCe("model"),new yCe("localView")),e.include(RWt,t),e.include(PWt,t),e.include($Wt,t),e.include(mfe,t),e.include(IWt,t),e.include(as,t),e.include(AWt,t),e.include(OWt,t),e.include(Mh,t),e.varyings.add("vColor","vec4"),e.varyings.add("vRadius","float"),e.varyings.add("vPosition","vec3"),e.varyings.add("vWorldPosition","vec3"),e.varyings.add("vViewPos","vec3"),e.varyings.add("vLineLengthPixels","float"),e.varyings.add("vSizeFalloffFactor","float"),r.uniforms.add(new Yr("pixelToNDC",(n,s)=>Or(DWt,2/s.camera.fullViewport[2],2/s.camera.fullViewport[3])),new Cr("viewport",(n,s)=>s.camera.fullViewport),new Ye("pixelRatio",(n,s)=>s.camera.pixelRatio)),e.attributes.add(O.POSITION0,"vec3"),e.attributes.add(O.POSITION1,"vec3"),e.attributes.add(O.VARIANTOFFSET,"float"),e.attributes.add(O.VARIANTSTROKE,"float"),e.attributes.add(O.VARIANTEXTENSION,"float"),r.code.add(T`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${t.antialiasing?T`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:T`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${t.mode===vo.SKETCH?T`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:t.mode===vo.MIXED?T`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `),i.code.add(T`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${t.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      fragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `),e}const DWt=Qe();let yCe=class extends Zn{constructor(e){super(e,"mat4")}};const NWt=Object.freeze(Object.defineProperty({__proto__:null,build:LWt},Symbol.toStringTag,{value:"Module"}));let X7e=class Y7e extends si{initializeProgram(e){return new Kr(e.rctx,Y7e.shader.get().build(this.configuration),s7e)}initializePipeline(e){return e.blendMinMax?Qt({blending:Fa(De.ONE,De.ONE,De.ZERO,De.ONE,h0.ADD,e.blendMinMax.MAX),depthTest:{func:Oi.LEQUAL},colorWrite:hr}):Qt({depthTest:{func:Oi.LEQUAL},depthWrite:fu,colorWrite:hr})}};X7e.shader=new Jr(NWt,()=>le(()=>import("./EdgeShader.glsl-90359ffa.js"),[]));let uy=class extends tl{constructor(){super(...arguments),this.mode=vo.SOLID,this.hasSlicePlane=!1,this.silhouette=!1,this.legacy=!1,this.antialiasing=!1,this.doublePrecisionRequiresObfuscation=!1,this.hasMultipassTerrain=!1,this.cullAboveGround=!1,this.spherical=!1}};d([X({count:vo.COUNT})],uy.prototype,"mode",void 0),d([X()],uy.prototype,"hasSlicePlane",void 0),d([X()],uy.prototype,"silhouette",void 0),d([X()],uy.prototype,"legacy",void 0),d([X()],uy.prototype,"antialiasing",void 0),d([X()],uy.prototype,"doublePrecisionRequiresObfuscation",void 0),d([X()],uy.prototype,"hasMultipassTerrain",void 0),d([X()],uy.prototype,"cullAboveGround",void 0),d([X()],uy.prototype,"spherical",void 0);const FWt=8,nJ=128,kWt={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},UWt={solid:vo.SOLID,sketch:vo.SKETCH,uber:vo.MIXED};let sJ=class Z7e{constructor(e,r,i){this._rctx=e,this._shaderTechniqueRepository=r,this._configuration=new uy,this.refCount=0,this._renderables=new Set,this._sortedRenderables={[mr.TRANSPARENT]:{[mr.TRANSPARENT]:new dr,[mr.OPAQUE]:new dr},[mr.OPAQUE]:{[mr.TRANSPARENT]:new dr,[mr.OPAQUE]:new dr}},this._renderablesDirty=!1,this._drawParameters=new TWt,this._settings={...kWt,...i},this.key=Z7e.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);const n=this._settings.strokesTexture.variants;this.writerSettings={variants:n,reducedPrecision:Di.TESTS_DISABLE_OPTIMIZATIONS},this._configuration.legacy=this._settings.legacy,this._configuration.mode=UWt[this._settings.type],this._configuration.silhouette=!1,this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax,this._configuration.hasSlicePlane=this._settings.hasSlicePlane,this._configuration.doublePrecisionRequiresObfuscation=e.driverTest.doublePrecisionRequiresObfuscation.result,this._configuration.spherical=i.spherical}dispose(){this._technique=xn(this._technique)}addRenderable(e){this._renderables.add(e),this._renderablesDirty=!0}removeRenderable(e){this._renderables.delete(e),this._renderablesDirty=!0}setRenderablesDirty(){this._renderablesDirty=!0}forEachRenderable(e,r){if(this._renderablesDirty&&this._sortRenderables(),r!==mr.INVISIBLE){const i=this._sortedRenderables[r];i[mr.TRANSPARENT].forAll(e),i[mr.OPAQUE].forAll(e)}}updateTechnique(e,r){return this._configuration.hasMultipassTerrain=!!e.multipassTerrain.enabled,this._configuration.cullAboveGround=!!e.multipassTerrain.cullAboveGround,this._configuration.silhouette=r,this._technique=this._shaderTechniqueRepository.releaseAndAcquire(X7e,this._configuration,this._technique),this._technique}bindRegularEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!1),e,r)}bindSilhouetteEdges(e,r){return this._lastOriginId=null,this._rctx.bindTechnique(this.updateTechnique(r,!0),e,r)}renderRegularEdges(e,r,i,n,s){this._render(e,r,r.regular.vao,i,n,s)}renderSilhouetteEdges(e,r,i,n,s){this._render(e,r,r.silhouette.vao,i,n,s)}_render(e,r,i,n,s,o){o>0&&(this._bindDraw(e,r,n,s),this._rctx.bindVAO(i),this._rctx.capabilities.instancing.drawArraysInstanced(Zt.TRIANGLE_FAN,0,4,o))}_bindDraw(e,r,i,n){if(this._drawParameters.componentDataTexture=r.components.buffer.textureBuffer.texture,this._drawParameters.strokesTexture=this._settings.strokesTexture,"origin"in r.transform)this._lastOriginId!==r.transform.origin.origin.id&&(e.setUniformMatrix4fv("localView",r.transform.origin.viewMatrix),this._lastOriginId=r.transform.origin.origin.id),e.setUniformMatrix4fv("model",r.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=r.transform.origin.origin.vec3;else{const s=new gq(r.transform.position),o=df(vCe,UE(vCe,r.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=s.low,this._drawParameters.transformWorldFromModelTH=s.high,this._drawParameters.transformWorldFromModelRS=r.transform.rotationScale,this._drawParameters.transformNormalGlobalFromModel=o;const a=n.camera.viewInverseTransposeMatrix;se(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}e.bindDraw(this._drawParameters,n,i)}_sortRenderables(){this._renderablesDirty=!1,this._sortedRenderables[mr.TRANSPARENT][mr.TRANSPARENT].clear(),this._sortedRenderables[mr.TRANSPARENT][mr.OPAQUE].clear(),this._sortedRenderables[mr.OPAQUE][mr.TRANSPARENT].clear(),this._sortedRenderables[mr.OPAQUE][mr.OPAQUE].clear(),this._renderables.forEach(r=>{r.objectTransparency!==mr.INVISIBLE&&r.edgeTransparency!==mr.INVISIBLE&&this._sortedRenderables[r.objectTransparency][r.edgeTransparency].push(r)});const e=(r,i)=>"origin"in r.transform?"origin"in i.transform?r.transform.origin.origin.id<i.transform.origin.origin.id?-1:r.transform.origin.origin.id>i.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[mr.TRANSPARENT][mr.TRANSPARENT].sort(e),this._sortedRenderables[mr.TRANSPARENT][mr.OPAQUE].sort(e),this._sortedRenderables[mr.OPAQUE][mr.TRANSPARENT].sort(e),this._sortedRenderables[mr.OPAQUE][mr.OPAQUE].sort(e)}static getKey(e,r,i){return`edges-t:${e}:${r}:${i}`}};const vCe=uu();function nCr(t,e){return e.push(t.buffer),{buffer:t.buffer,layout:new SOt(t.layout)}}function mU(t){return new tUe(t.layout).createView(t.buffer)}let zWt=class extends jje{constructor(e){super("EdgeProcessingWorker","extract",{extract:r=>[r.dataBuffer],extractComponentsEdgeLocations:r=>[r.dataBuffer],extractEdgeLocations:r=>[r.dataBuffer]},e)}async process(e,r,i){if(i)return $Ht(e);const n=await this.invoke(new oJ(e),r);return this._unpackOutput(n)}async extractEdgeLocations(e,r){const i=await this.invokeMethod("extractEdgeLocations",new oJ(e),r);return mU(i)}async extractComponentsEdgeLocations(e,r){const i=await this.invokeMethod("extractComponentsEdgeLocations",new oJ(e),r);return mU(i)}_unpackOutput(e){return{regular:{instancesData:mU(e.regular.instancesData),lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:mU(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}}},oJ=class{constructor(e){this.dataBuffer=e.data.buffer,this.writerSettings=e.writerSettings,this.skipDeduplicate=e.skipDeduplicate,this.indices=ig(e.indices)?e.indices:e.indices.buffer,this.indicesType=ig(e.indices)?"Array":u7(e.indices)?"Uint32Array":"Uint16Array",this.indicesLength=e.indicesLength}};function VWt(t){const r=R$.resolution,i=r/2,n=new Uint8Array(4*r*r),s=4*r*i,o=R$.amplitude,a=2*o,l=4*r,c=Math.log2(r)+1,u=R$.strokes.length;let h=(c-1)*u*l;for(const{distance:g,pressure:y}of R$.strokes){let _=g,b=y,w=h;for(let x=0;x<c;x++){x!==0&&(_=_Ce(_,h4.DISTANCE),b=_Ce(b,h4.PRESSURE));for(let S=0;S<R$.resolution;S++){const C=.5+(_?_[S%_.length]/a:0),E=b?b[S%b.length]:1;YN(C,n,w),YN(E,n,w+s),w+=4}w-=l*(u+1)}h+=l}const f=new Vr;f.width=f.height=r;const m=new Jt(t,f,n);return new jWt(r,a,o,u,m)}function _Ce(t,e){if(!t)return null;const r=t.length/2,i=BWt*r,n=new Array(r);let s=0;const o=e===h4.PRESSURE;for(let a=0;a<t.length;a+=2){const l=(t[a]+t[a+1])/2;n[s++]=o?Math.min(i,1-(1-l)*bCe):Math.min(i,l*bCe)}return n}var h4;(function(t){t[t.DISTANCE=0]="DISTANCE",t[t.PRESSURE=1]="PRESSURE"})(h4||(h4={}));const BWt=.1,bCe=.5;let jWt=class{constructor(e,r,i,n,s){this.resolution=e,this.normalizationScale=r,this.amplitude=i,this.variants=n,this.texture=s}dispose(){this.texture=pt(this.texture)}};const R$={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-76e-5,27e-5,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};function wCe(t){let e=null;for(const r of t){const i=r.type;if(GWt(r)){if(e==null)e=i;else if(e!==i)return"uber"}}return e??"uber"}function xCe(t){let e=mr.INVISIBLE;for(const{material:r}of t)if(J7e(r)){if(r.color[3]*r.opacity<1)return mr.TRANSPARENT;e=mr.OPAQUE}return e}function SCe(t){let e=mr.INVISIBLE;for(const{material:r}of t)if(J7e(r)){switch(r.objectTransparency){case mr.TRANSPARENT:case mr.INVISIBLE:return mr.TRANSPARENT;case mr.OPAQUE:if(r.opacity<1)return mr.TRANSPARENT}e=mr.OPAQUE}return e}function J7e(t){return t.size*t.color[3]*t.opacity>0}function GWt(t){return t.size*t.color[3]>0}function TCe(t,e,r,i){for(let n=0;n<t.length;n++){const s=t[n].index,o=e[n],a=e[n+1];if(i)for(let l=o;l<a;l++){const c=i[l];r.set(c,s)}else for(let l=o;l<a;l++)r.set(l,s)}}let im=class extends Ce{constructor(e){super(e),this._updatingHandles=new Yy,this._perObjectData=new Map,this._perObjectDataEvictionCache=new Set,this._renderers=new Map,this._gpuMemoryUsage=0,this._workerAbort=new AbortController,this._tmpModelPosition=A(),this._localOrigins=new wWt(new cpe(e.renderSR))}initialize(){this._worker=new zWt(this.schedule),this._componentColorManager=new l7e(this.rctx,3);const e=i7e.createBuffer(4);for(let r=0;r<4;r++)e.sideness.set(r,0,r===0||r===3?0:1),e.sideness.set(r,1,r===0||r===1?0:1);this._verticesBufferObject=ci.createVertex(this.rctx,qr.STATIC_DRAW,e.buffer)}destroy(){this.destroyed||(this._perObjectData.forEach(e=>this._discardObjectEntry(e)),this._perObjectData.clear(),this._strokesTexture=pt(this._strokesTexture),this._componentColorManager=qe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=pt(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy(),this._set("schedule",ZWt))}get updating(){return this._updatingHandles.updating}get usedMemory(){return this._gpuMemoryUsage}shouldRender(){return this._renderers.size>0}async addComponentObject(e,r,i,n,s,o,a,l){if(this.hasObject(e))return this.getObjectMemoryUsage(e);let c;const u=new CCe(new Promise(f=>c=f),i.center,i.radius);this._perObjectData.set(e,u);const h=await this._updatingHandles.addPromise(this._addComponentGeometry(r,u,n,s,o,a,l));return this.setNeedsRender(),c(),h}async addOrUpdateObject3D(e,r,i,n){if(this.destroyed)return void re.getLogger(this).warn("Attempt to add an object to a destroyed instance");const s=this._perObjectData.get(e);let o;(s==null?void 0:s.renderables.length)>0&&this._perObjectDataEvictionCache.add(s);const a=e.boundingVolumeWorldSpace.bounds,l=new CCe(new Promise(u=>o=u),a,t_(a));this._perObjectData.set(e,l);const c=new Array;if(i.mergeGeometries&&e.geometries.length>1&&HWt(e))c.push(this._addObjectMergedGeometries(e,l,r,i,n));else for(let u=0;u<e.geometries.length;u++){const h=e.geometries[u];h.material.supportsEdges&&c.push(this._addGeometry(e,l,h,r[0],i,n))}await this._updatingHandles.addPromise(Promise.all(c)),this._perObjectDataEvictionCache.delete(l),this._discardObjectEntry(s),this.setNeedsRender(),o()}_discardObjectEntry(e){e&&(e.renderables.length&&(e.renderables.forEach(r=>this._removeRenderable(r)),this.setNeedsRender()),e.loaded=null)}hasObject(e){return this._perObjectData.has(e)}async updateAllComponentOpacities(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));if(i==null)return;const n=r instanceof Array?s=>r[s]:()=>r;i.renderables.forEach(s=>{const o=s.components.meta.length;for(let a=0;a<o;a++){const l=n(a),c=s.components.meta[a],u=c.index;c.material.opacity=l,s.components.buffer.textureBuffer.setDataElement(u,1,3,255*l)}this._updateTransparency(s)}),this.setNeedsRender()}async getObjectMemoryUsage(e){const r=await this._getObjectEntry(e);return r!=null?r.renderables.reduce((i,n)=>i+n.statistics.gpuMemoryUsage,0):0}async updateAllComponentMaterials(e,r,i,n){const s=e instanceof a1,o=!!i.hasSlicePlane,a=wCe(r),l=sJ.getKey(a,o,s),c=await this._updatingHandles.addPromise(this._getObjectEntry(e));c!=null&&(c.renderables.forEach(u=>{if(l!==u.rendererKey){const h=this._renderers.get(u.rendererKey),f=this._acquireRenderer(a,o,s);h.removeRenderable(u),--h.refCount,u.rendererKey=l,f.addRenderable(u)}for(let h=0;h<r.length;h++)u.components.meta[h].material=r[h];n&&this._updateComponentBuffer(u.components),this._updateTransparency(u)}),this.setNeedsRender())}async updateAllVerticalOffsets(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));i!=null&&(i.renderables.forEach(n=>{const s=n.components.meta;for(let o=0;o<s.length;o++)n.components.meta[o].verticalOffset=(r==null?void 0:r[o])??0;this._updateComponentBuffer(n.components)}),this.setNeedsRender())}async updateObjectVisibility(e,r){const i=await this._updatingHandles.addPromise(this._getObjectEntry(e));i!=null&&(i.renderables.forEach(n=>n.visible=r),this.setNeedsRender())}removeObject(e){const r=this._perObjectData.get(e);r&&(this._perObjectData.delete(e),this._discardObjectEntry(r))}async _getObjectEntry(e){const r=this._perObjectData.get(e);if(!r)throw new Error("no object");return await r.loaded,r.loaded==null?null:r}render(e,r){if(this._componentColorManager==null)return;this._localOrigins.updateViewMatrices(e.camera.viewMatrix);const i=e.camera.viewInverseTransposeMatrix,n=A(),s=new gq;let o=0,a=0;if(this._renderers.forEach(c=>{if(c.refCount===0)this._renderers.delete(c.key),c.dispose();else{let u=!0,h=!0;c.forEachRenderable(f=>{f.visible&&(o+=f.statistics.averageEdgeLength,a++,u&&f.regular&&(c.updateTechnique(e,!1),u=!1),h&&f.silhouette&&(c.updateTechnique(e,!0),h=!1))},r)}}),this._componentColorManager.garbageCollect(),this._componentColorManager.updateTextures(),a===0)return;const l=new SWt(40*o/a,r);se(n,i[3],i[7],i[11]),s.set(n),oe(l.transformWorldFromViewTH,s.high),oe(l.transformWorldFromViewTL,s.low),uf(l.transformViewFromCameraRelativeRS,e.camera.viewMatrix),df(PCe,l.transformViewFromCameraRelativeRS),UE(l.transformNormalViewFromGlobal,PCe),l.transformProjFromView=e.camera.projectionMatrix,this._updateObjectCameraDistances(e),this._renderers.forEach(c=>{this._renderRegularEdges(c,e,l),this._renderSilhouetteEdges(c,e,l)})}_updateTransparency(e){const r=xCe(e.components.meta),i=SCe(e.components.meta);r===e.edgeTransparency&&i===e.objectTransparency||(e.edgeTransparency=r,e.objectTransparency=i,this._renderers.get(e.rendererKey).setRenderablesDirty())}_computeModelTransformWithLocalOrigin(e,r,i){e.getCombinedShaderTransformation(r,i);const n=r.localOrigin!=null?this._localOrigins.register(r.localOrigin):this._localOrigins.acquire(se(this._tmpModelPosition,i[12],i[13],i[14]));return r.localOrigin=n.origin,_Wt(n.origin.vec3,i),n}_updateComponentBuffer(e){const{meta:r,buffer:i}=e,n=new Uint8Array(4);for(let s=0;s<r.length;s++){const o=r[s].material,a=r[s].index,l=Te(Math.round(o.size*FWt),0,255),c=Te(o.extensionLength,-nJ,255-nJ)+nJ,u=o.type==="solid"?Rj.SOLID:Rj.SKETCH,h=255*o.opacity,f=o.color,m=255*f[0],g=255*f[1],y=255*f[2],_=255*f[3];i.textureBuffer.setData(a,0,m,g,y,_),i.textureBuffer.setData(a,1,l,c,u,h),QGe(r[s].verticalOffset,n),i.textureBuffer.setData(a,2,n[0],n[1],n[2],n[3])}}_createComponentBuffers(e){if(this._componentColorManager==null)return null;const r=new Array,i=this._componentColorManager.getBuffer(e.length);for(let s=0;s<e.length;s++){const o=e[s],a=i.acquireIndex();r.push({index:a,verticalOffset:0,material:o})}const n=new qWt(i,r);return this._updateComponentBuffer(n),n}_extractEdges(e,r,i,n,s,o=s.length){return this._worker.process({data:r,indices:s,indicesLength:o,writerSettings:e,skipDeduplicate:i},this._workerAbort.signal,n)}_createRenderable(e,r,i,n,s){const o=u=>this._verticesBufferObject!=null?new WWt(new gg(this.rctx,s7e,{vertices:wHt,instances:u===XT.REGULAR?Ej.glLayout:Cj.glLayout},{vertices:this._verticesBufferObject,instances:ci.createVertex(this.rctx,qr.STATIC_DRAW,u===XT.REGULAR?e.regular.instancesData.buffer:e.silhouette.instancesData.buffer)}),u===XT.REGULAR?e.regular.lodInfo:e.silhouette.lodInfo):null,a=e.regular.lodInfo.lengths.length>0?o(XT.REGULAR):null,l=e.silhouette.lodInfo.lengths.length>0?o(XT.SILHOUETTE):null,c=((a==null?void 0:a.vao.memoryEstimate)??0)+((l==null?void 0:l.vao.memoryEstimate)??0);return new YWt(a,l,{gpuMemoryUsage:c,externalMemoryUsage:s,averageEdgeLength:e.averageEdgeLength},i,xCe(r.meta),SCe(r.meta),r,n)}async _addGeometry(e,r,i,n,s,o){const a=i.vertexAttributes.get(O.POSITION),l=i.indices.get(O.POSITION),c=Me(),u=this._computeModelTransformWithLocalOrigin(e,i,c),h=new ACe(a,l,c,u);return this._addPositionData(r,h,i.edgeIndicesLength,n,s,o)}async _addPositionData(e,r,i,n,s,o=!1){if(e.loaded==null)return;const a=this._createComponentBuffers([n]);if(a==null||i<=0)return;const l=this._acquireRenderer(n.type,!!s.hasSlicePlane,!0),{modelTransform:c,origin:u}=r,h=r.indices,f=r.position,m=f.data.length/f.size,g=Sj.createBuffer(m);for(let b=0;b<m;b++)g.position.set(b,0,f.data[b*f.size]),g.position.set(b,1,f.data[b*f.size+1]),g.position.set(b,2,f.data[b*f.size+2]);TCe(a.meta,[0,g.componentIndex.count],g.componentIndex);const y=await this._updatingHandles.addPromise(this._extractEdges(l.writerSettings,g,!1,o,h,i));if(e.loaded==null)return;const _=this._createRenderable(y,a,new XWt(c,u),l.key,!1);e.renderables.push(_),l.addRenderable(_),this._gpuMemoryUsage+=_.statistics.gpuMemoryUsage}async _addComponentGeometry(e,r,i,n,s,o,a){if(r.loaded==null)return 0;const l=this._createComponentBuffers(o);if(l==null)return 0;const c=wCe(o),u=this._acquireRenderer(c,a.hasSlicePlane||!1,!1),h=Sj.createBuffer(i.length/3);jF(h.position.typedBuffer,i,h.position.typedBufferStride,3),TCe(l.meta,s,h.componentIndex,n);const f=!0,m=u.writerSettings,g=await this._updatingHandles.addPromise(this._extractEdges(m,h,f,!1,n));if(r.loaded==null)return 0;const y=this._createRenderable(g,l,e,u.key,!0);return r.renderables.push(y),u.addRenderable(y),y.statistics.gpuMemoryUsage}async _addObjectMergedGeometries(e,r,i,n,s){const o=new Map;let a=0,l=null,c=0;for(let w=0;w<e.geometries.length;w++){const x=e.geometries[w];if(!x.material.supportsEdges)continue;!l&&x.localOrigin&&(l=x);const S=x.vertexAttributes.get(O.POSITION);c+=S.data.length/S.size,a+=x.edgeIndicesLength}const u=c>=65536?Uint32Array:Uint16Array,h=a?new u(a):null,f=[];let m=0;for(let w=0;w<e.geometries.length;w++){const x=e.geometries[w];if(!x.material.supportsEdges)continue;const S=x.vertexAttributes.get(O.POSITION),C=x.indices.get(O.POSITION);let E=o.get(S.data);if(E==null){E=f.length/3;for(let R=0;R<S.data.length;R+=S.size)f.push(S.data[R]),f.push(S.data[R+1]),f.push(S.data[R+2]);o.set(S.data,E)}if(C)for(let R=0;R<x.edgeIndicesLength;R++)h[m++]=E+C[R]}const g=l||e.geometries[0],y=Me(),_=this._computeModelTransformWithLocalOrigin(e,g,y);for(let w=0;w<e.geometries.length;w++)e.geometries[w].localOrigin=_.origin;const b=new ACe({data:f,size:3},h,y,_);await this._updatingHandles.addPromise(this._addPositionData(r,b,h.length,i[0],n,s))}_acquireRenderer(e,r,i){const n=sJ.getKey(e,r,i);let s=this._renderers.get(n);return this._strokesTexture==null&&(this._strokesTexture=VWt(this.rctx)),s||(s=new sJ(this.rctx,this.techniqueRepository,{type:e,hasSlicePlane:r,strokesTexture:this._strokesTexture,legacy:i,spherical:this.viewingMode===at.Global}),this._renderers.set(n,s)),++s.refCount,s}_removeRenderable(e){ECe(e.regular),ECe(e.silhouette);const r=this._renderers.get(e.rendererKey);if(r){r.removeRenderable(e),--r.refCount,"origin"in e.transform&&this._localOrigins.release(e.transform.origin),this._gpuMemoryUsage-=e.statistics.externalMemoryUsage?0:e.statistics.gpuMemoryUsage;for(const i of e.components.meta)e.components.buffer.releaseIndex(i.index)}}_updateObjectCameraDistances(e){const r=e.camera.eye,i=e.camera.viewForward,n=A(),s=o=>{Gi(n,o.center,r);const a=ye(n,i),l=o.radius,c=a<-l?1/0:a<l?0:a-l;o.renderables.forEach(u=>u.distanceToCamera=c)};this._perObjectData.forEach(s),this._perObjectDataEvictionCache.forEach(s)}_renderRegularEdges(e,r,i){const n=e.bindRegularEdges(i,r),s=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!RCe(a)||!a.visible)return;const l=gU(a.regular.lod.lengths,a.distanceToCamera,o);e.renderRegularEdges(n,a,i,r,l)},s)}_renderSilhouetteEdges(e,r,i){const n=e.bindSilhouetteEdges(i,r),s=i.transparency,o=r.camera.perScreenPixelRatio;e.forEachRenderable(a=>{if(!OCe(a)||!a.visible)return;const l=gU(a.silhouette.lod.lengths,a.distanceToCamera,o);e.renderSilhouetteEdges(n,a,i,r,l)},s)}get test(){return{hasRenderedPrimitives:e=>{let r=!1;const i=e.perScreenPixelRatio,n=(s,o)=>s.forEachRenderable(a=>{a.visible&&!r&&(RCe(a)&&(r=gU(a.regular.lod.lengths,a.distanceToCamera,i)>0),!r&&OCe(a)&&(r=gU(a.silhouette.lod.lengths,a.distanceToCamera,i)>0))},o);return this._renderers.forEach(s=>{r||(n(s,mr.OPAQUE),n(s,mr.TRANSPARENT))}),r}}}};function ECe(t){t!=null&&(t.vao.vertexBuffers.instances.dispose(),t.vao.disposeVAOOnly(),t.vao=null)}function HWt(t){let e=null,r=null;for(let i=0;i<t.geometries.length;i++){const n=t.geometries[i];if(n.material.supportsEdges){if(e){if(!T_(e,n.transformation))return!1}else e=n.transformation;if(r||n.localOrigin==null){if(r&&r.localOrigin!=null&&n.localOrigin!=null&&r.localOrigin.id!==n.localOrigin.id)return!1}else r=n}}return!0}d([p({constructOnly:!0})],im.prototype,"rctx",void 0),d([p({constructOnly:!0})],im.prototype,"renderSR",void 0),d([p({constructOnly:!0})],im.prototype,"viewingMode",void 0),d([p({constructOnly:!0})],im.prototype,"techniqueRepository",void 0),d([p({constructOnly:!0})],im.prototype,"setNeedsRender",void 0),d([p({constructOnly:!0})],im.prototype,"schedule",void 0),d([p({readOnly:!0})],im.prototype,"_updatingHandles",void 0),d([p({readOnly:!0})],im.prototype,"updating",null),im=d([I("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],im);let CCe=class{constructor(e,r,i){this.center=r,this.radius=i,this.renderables=new Array,this.loaded=e,this.loaded.then(()=>{this.loaded!=null&&(this.loaded=!0)})}},qWt=class{constructor(e,r){this.buffer=e,this.meta=r}},WWt=class{constructor(e,r){this.vao=e,this.lod=r}},XWt=class{constructor(e,r){this.modelMatrix=e,this.origin=r}},YWt=class{constructor(e,r,i,n,s,o,a,l){this.regular=e,this.silhouette=r,this.statistics=i,this.transform=n,this.edgeTransparency=s,this.objectTransparency=o,this.components=a,this.rendererKey=l,this.distanceToCamera=0,this.visible=!0}};function RCe(t){return t.regular!=null}function OCe(t){return t.silhouette!=null}function gU(t,e,r){const i=e*r,n=QMe(t,i,!0);return n===-1?i<t[0]?t.length:0:t.length-n}let ACe=class{constructor(e,r,i,n){this.position=e,this.indices=r,this.modelTransform=i,this.origin=n}};const PCe=vn(),ZWt=()=>Promise.reject();function vg(t){return window.WebGL2RenderingContext&&t instanceof window.WebGL2RenderingContext}let MCe=class{constructor(e,r,i,n,s,o,a,l,c){this.createQuery=e,this.deleteQuery=r,this.resultAvailable=i,this.getResult=n,this.disjoint=s,this.beginTimeElapsed=o,this.endTimeElapsed=a,this.createTimestamp=l,this.timestampBits=c}},gv=!1;function JWt(t,e){if(e.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&vg(t)?new MCe(()=>t.createQuery(),i=>{t.deleteQuery(i),gv=!1},i=>t.getQueryParameter(i,t.QUERY_RESULT_AVAILABLE),i=>t.getQueryParameter(i,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{gv||(gv=!0,t.beginQuery(r.TIME_ELAPSED_EXT,i))},()=>{t.endQuery(r.TIME_ELAPSED_EXT),gv=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"),r?new MCe(()=>r.createQueryEXT(),i=>{r.deleteQueryEXT(i),gv=!1},i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_AVAILABLE_EXT),i=>r.getQueryObjectEXT(i,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),i=>{gv||(gv=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,i))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT),gv=!1},i=>r.queryCounterEXT(i,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null)}function KWt(t,e){const r=t.capabilities.disjointTimerQuery;return r==null?null:new QWt(r,e)}let QWt=class{constructor(e,r){this._timer=e,this._queryPool=new Array,this._queryResults=new Map,this._currentQuery=null,r.forEach(i=>{const n=this._timer.createQuery(),s=this._timer.createQuery();this._queryPool.push(n,s),this._queryResults.set(i,null)})}start(){gv||(this._currentQuery=this._queryPool.pop(),this._currentQuery!=null&&(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))}stop(e){if(this._timer.disjoint()||this._currentQuery==null||!this._queryResults.has(e))return this.abort(),null;this._timer.endTimeElapsed();const r=this._queryResults.get(e);if(r==null)return this._queryResults.set(e,this._currentQuery),this._currentQuery=null,null;if(!this._timer.resultAvailable(r))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null,null;const i=this._timer.getResult(r)/1e6;return this._queryPool.unshift(r),this._queryResults.set(e,this._currentQuery),this._currentQuery=null,i}abort(){this._currentQuery!=null&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)}dispose(){this._currentQuery!=null&&this._timer.deleteQuery(this._currentQuery),this._queryPool.forEach(e=>{this._timer.deleteQuery(e)}),this._queryResults.forEach(e=>{e!=null&&this._timer.deleteQuery(e)})}};var Ji;(function(t){t.OVERLAY="overlay",t.PREPARE="prepare",t.SHADOW_MAP="shadow map",t.LINEAR_DEPTH="linear depth",t.ACCUMULATED_SHADOWS="accumulated shadows",t.NORMALS="normals",t.OBJECT_AND_LAYER_ID_COLOR="object/layer id color",t.SSAO="SSAO",t.OPAQUE="opaque",t.OPAQUE_EDGES="opaque edges",t.VOXEL="voxel",t.TRANSPARENT="transparent",t.TRANSPARENT_EDGES="transparent edges",t.HUD_VISIBILITY="HUD visibility",t.TRANSPARENT_TERRAIN="transparent terrain",t.ENVIRONMENT="environment",t.LASER_LINE="laser line",t.OCCLUDED="occluded",t.ANTIALIASING="antialiasing",t.HIGHLIGHTS="highlights",t.HUD="HUD",t.HUD_OCCLUDED="HUD occluded",t.FINISH="finish"})(Ji||(Ji={}));const $Ce="Total";let eXt=class{constructor(e){this._rctx=e,this._startTimeStampCPU=0,this._lastTimeStampCPU=0,this._totalCPUTime=new Hv($Ce),this._cpuTimeSamplers=new Map(Object.values(Ji).map(r=>[r,new Hv(r)])),this._enableGPUTimer=0,this._totalGPUTime=new Hv("GPU"),this._gpuTimeSamplers=new Map(Object.values(Ji).map(r=>[r,new Hv(r)])),this._totalTime=0,this._totalFrameCount=0}get totalCPUTimeSampler(){return this._totalCPUTime}get cpuTimeSamplers(){return Array.from(this._cpuTimeSamplers.values())}get totalGPUTimeSampler(){return this._totalGPUTime}get gpuTimeSamplers(){return Array.from(this._gpuTimeSamplers.values())}get gpuSamplingEnabled(){return this._gpuTimerPool!=null}get totalTime(){return this._totalTime}get totalFrameCount(){return this._totalFrameCount}get elapsedTime(){return performance.now()-this._startTimeStampCPU}enableGPUPerformanceInfo(){if(this._gpuTimerPool==null){const e=[...Object.values(Ji),$Ce];this._gpuTimerPool=KWt(this._rctx,e)}return this._gpuTimerPool==null?{hasGPUTimerSupport:!1,remove:()=>{}}:(++this._enableGPUTimer,{hasGPUTimerSupport:!0,remove:sce(()=>{--this._enableGPUTimer,this._enableGPUTimer===0&&(this._gpuTimerPool=pt(this._gpuTimerPool))})})}startFrame(){this._startTimeStampCPU=this._lastTimeStampCPU=performance.now(),this._gpuTimerPool!=null&&this._gpuTimerPool.start()}advance(e){const r=performance.now();if(this._cpuTimeSamplers.get(e).record(r-this._lastTimeStampCPU),this._lastTimeStampCPU=r,this._gpuTimerPool!=null){const i=this._gpuTimerPool.stop(e);this._gpuTimeSamplers.get(e).record(i),this._gpuTimerPool.start()}}finishFrame(){if(this._gpuTimerPool!=null){const r=this._gpuTimerPool.stop(Ji.FINISH);this._gpuTimeSamplers.get(Ji.FINISH).record(r)}const e=performance.now()-this._startTimeStampCPU;this._totalTime=this._totalTime+e,this._totalCPUTime.record(e),this._gpuTimerPool!=null&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((r,i)=>r+(i.last||0),0)),++this._totalFrameCount}},Iu=class extends Ce{get _bindParameters(){return this._renderContext.bindParameters}updateRenderFeature(e=null,r=!he("disable-feature:high-quality-idle")){this._renderStateFeatures=Lbe(r,e),this.notifyChange("_renderStateFeatures"),this._requestRender()}isFeatureEnabled(e,r=this._state){var i;return((i=this._renderStateFeatures)==null?void 0:i.get(r,e))??!1}setFeatureEnabled(e,r,i){var n;(n=this._renderStateFeatures)==null||n.set(r,e,i),this.notifyChange("_renderStateFeatures"),this._requestRender()}get _antialiasing(){return this._antialiasingEnabled||this.isFeatureEnabled(qs.Antialiasing)}get _highQualityTransparency(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(qs.HighQualityTransparency)}get hasReflections(){return this.hasWater&&(this._ssrEnabled||this.isFeatureEnabled(qs.WaterReflection))}get hasWater(){return this._hasWater||this._hasOverlayWater}constructor(e,r,i,n,s,o,a,l){super({}),this._stage=e,this._materialRepository=r,this._techniqueRepository=n,this._rctx=s,this._compositingHelper=o,this._magnifierHelper=a,this._requestRender=l,this._materialRenderers=new dr,this._needsTransparentPass=!1,this._hasHUDElements=!1,this._hasHighlights=!1,this._hasWater=!1,this._hasOverlayWater=!1,this._renderOverlay=c=>{},this._isRendering=!1,this._fallbackDepthStencilTexture=null,this._sliceHelper=new uWt,this._state=ai.IDLE,this._renderStateFeatures=null,this._antialiasingEnabled=!0,this._highQualityTransparencyEnabled=!0,this._terrainRenderingEnabled=!0,this._terrainTransparency=$o.Opaque,this._ssrEnabled=!1,this._ssaoEnabled=!1,this._hasAnimations=!1,this._animationTimestep=new xqt,this._handles=new Ri,this._renderHiddenTransparentEdges=()=>{},this._oitUsed=!1,this.updateRenderFeature(e.view.qualityProfile),this._smaaPass=new uL(this._rctx,n),l(),this._offscreen=new Bqt(this._rctx,this._compositingHelper),this.performanceInfo=new eXt(this._rctx),this._shadowMap=new dpe(this._rctx,e.viewingMode),this._ssaoHelper=new xVe(e.view,n,this._rctx,l),this._highlight=new kqt(n,this._rctx),this._shadowHighlight=new cWt(this._rctx,e.viewingMode),this._shadowAccumulator=new Hc(this._rctx,n,e,c=>{const u=this.shadowsEnabled;this._shadowMap.enabled=!0,this._prepare(c.camera,c.contentCamera),this._renderPlugins.prepareRender(),this._shadowMap.enabled=u},(c,u,h)=>{c.shadowMap.start(c.camera,u,h,!0,this._stage.view.qualitySettings.maximumPixelRatio),this._renderShadowCascades(q.Shadow,c.shadowMap),c.camera.setGLViewport(this._rctx),this._prepare(c.camera,c.contentCamera)},l),this._renderContext=new c4t(this._rctx,this._offscreen,this._shadowMap,this._ssaoHelper,this._sliceHelper),this._renderPlugins=new cL({renderContext:this._renderContext,techniqueRepository:n,textureRepository:i,materialRepository:this._materialRepository,requestRender:l,controller:e}),this.renderPassManager=new wqt(this._rctx,this._techniqueRepository),this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager),this._handles.add([pe(()=>this._stage.view.state.camera,()=>l(),Bi),pe(()=>Di.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,c=>{this._renderHiddenTransparentEdges=c?()=>this._renderEdges(mr.TRANSPARENT):()=>{},l()},_r),pe(()=>this._ssaoEnabled||this.isFeatureEnabled(qs.SSAO),c=>this._ssaoHelper.enabled=c,Bi)])}normalizeCtorArgs(){return{}}destroy(){this._handles.destroy(),this._smaaPass.dispose(),this._gpuTimerHandle=yi(this._gpuTimerHandle),this._materialRenderers.forAll(e=>e.dispose()),this._materialRenderers.clear(),this._offscreen.dispose(),this._fallbackDepthStencilTexture=pt(this._fallbackDepthStencilTexture),this._shadowMap.dispose(),this._ssaoHelper.destroy(),this._highlight.dispose(),this._shadowHighlight.dispose(),this._shadowAccumulator.dispose(),this._edgeView=qe(this._edgeView),this.renderPassManager.destroy(),aUe.prune()}disposeOffscreenBuffers(){this._offscreen.dispose(),this._shadowMap.disposeOffscreenBuffers(),this._smaaPass.disable(),this._ssaoHelper.disposeOffscreenBuffers()}get updating(){return this._antialiasing&&this._smaaPass.updating||this._edgeView!=null&&this._edgeView.updating||this._shadowAccumulator.running||this._renderPlugins.updating||!this.isCameraFinal}ensureEdgeView(){if(this._edgeView==null){const e=this._stage.view.resourceController;this._edgeView=new im({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._techniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:tXt(e)}),this._handles.add(pe(()=>rd(this._edgeView,r=>r.updating),()=>this._requestRender(),li)),this._requestRender()}return this._edgeView}get edgeView(){return this._edgeView}get isCameraFinal(){return iue(this._bindParameters.ssr.reprojectionMatrix,bo)}set _reprojectionMatrix(e){Vle(this._bindParameters.ssr.reprojectionMatrix,e)&&this.notifyChange("isCameraFinal")}get shadowsEnabled(){var e;return!!((e=this._shadowMap)!=null&&e.enabled)}setParameters(e){var n,s;const{_shadowMap:r,_bindParameters:i}=this;if(((n=e.qualitySettings)==null?void 0:n.reflections)!==void 0&&this._ssrEnabled!==e.qualitySettings.reflections&&(this._ssrEnabled=e.qualitySettings.reflections,this._requestRender()),((s=e.qualitySettings)==null?void 0:s.ambientOcclusion)!==void 0&&this._ssaoEnabled!==e.qualitySettings.ambientOcclusion&&(this._ssaoEnabled=e.qualitySettings.ambientOcclusion,this._requestRender()),e.shadowMap!==void 0&&this._shadowMap.enabled!==e.shadowMap&&(this._shadowMap.enabled=e.shadowMap,this._requestRender()),e.shadowMapMaxCascades!==void 0&&r.maxCascades!==e.shadowMapMaxCascades&&(r.maxCascades=e.shadowMapMaxCascades,this._requestRender()),e.environment!=null){e.environment.weather!=null&&(this._bindParameters.weather=e.environment.weather,this._bindParameters.weatherVisible=!!e.weatherVisible);const o=e.environment.lighting.type!=="virtual";i.enableFillLights!==o&&(i.enableFillLights=o,this._requestRender())}e.background&&this._offscreen.background!==e.background&&(this._offscreen.background=e.background,this._requestRender()),e.antialiasingEnabled!==void 0&&this._antialiasingEnabled!==e.antialiasingEnabled&&(this._antialiasingEnabled=e.antialiasingEnabled,this._requestRender()),e.highQualityTransparency!==void 0&&this._highQualityTransparencyEnabled!==e.highQualityTransparency&&(this._highQualityTransparencyEnabled=e.highQualityTransparency,this._requestRender()),e.defaultHighlightOptions!==void 0&&(this._highlight.setDefaultOptions(e.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(e.defaultHighlightOptions),this._requestRender()),e.overlays!==void 0&&this._bindParameters.overlays!==e.overlays&&(this._bindParameters.overlays=e.overlays,this._requestRender()),e.hasOverlayWater!==void 0&&this._hasOverlayWater!==e.hasOverlayWater&&(this._hasOverlayWater=e.hasOverlayWater,this._requestRender()),e.renderOverlay!==void 0&&this._renderOverlay!==e.renderOverlay&&(this._renderOverlay=e.renderOverlay,this._requestRender()),e.slicePlane!==void 0&&this._sliceHelper.plane!==e.slicePlane&&(this._sliceHelper.plane=e.slicePlane,this._requestRender()),e.terrainRenderingEnabled!==void 0&&this._terrainRenderingEnabled!==e.terrainRenderingEnabled&&(this._terrainRenderingEnabled=e.terrainRenderingEnabled,this._requestRender()),e.terrainTransparency!==void 0&&this._terrainTransparency!==e.terrainTransparency&&(this._terrainTransparency=e.terrainTransparency,this._requestRender()),e.shadowCastOptions!==void 0&&this._shadowAccumulator.setOptions(e.shadowCastOptions)}get hasSlicePlane(){return!!this._sliceHelper.plane}get renderPlugins(){return this._renderPlugins}get _hasOITSupport(){return this._rctx.driverTest.floatBufferBlend.result}get _oitEnabled(){return this._highQualityTransparency&&this._hasOITSupport}modify(e,r){this._isRendering&&console.warn("Renderer.modify called while rendering");const{adds:i,removes:n,updates:s}=e;if(i.length===0&&n.length===0&&s.length===0)return;const o=nVe(e);let a=!1;o.forEach((l,c)=>{if(r.done)return;let u=this._materialRenderers.find(h=>h.material===c);u==null&&l.adds.length>0&&(u=new mVe(this._rctx,this._materialRepository,c),this._materialRenderers.push(u)),u&&(u.modify(l),u.isEmpty&&(a=!0)),l.removes.forEach(h=>e.removes.removeUnordered(h)),l.adds.forEach(h=>e.adds.removeUnordered(h)),l.updates.forEach(h=>e.updates.removeUnordered(h)),r.madeProgress()}),a&&this._materialRenderers.filterInPlace(l=>!l.isEmpty||(l.dispose(),!1)),this._hasHighlights=this._materialRenderers.some(l=>l.hasHighlights),this._bindParameters.hasOccludees=this._materialRenderers.some(l=>l.hasOccludees),this._hasWater=this._materialRenderers.some(l=>l.hasWater),this._hasHUDElements=this._materialRenderers.some(l=>l.requiresSlot(_e.LINE_CALLOUTS_HUD_DEPTH,q.Color)||l.requiresSlot(_e.HUD_MATERIAL,q.Color)||l.requiresSlot(_e.LABEL_MATERIAL,q.Color)),this._requestRender()}updateAnimation(e){const r=this._hasAnimations;return this._hasAnimations=!1,this._materialRenderers.forAll(i=>this._hasAnimations=i.updateAnimation(e)||this._hasAnimations),this._hasAnimations=this._renderPlugins.updateAnimation(e)||this._hasAnimations,this._hasAnimations!==r&&(this._gpuTimerHandle=r?yi(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo()),this._hasAnimations}get animationTimestep(){return this._animationTimestep.value}get animationTimeDilation(){return this._animationTimestep.timeDilation}resetAnimation(){this._animationTimestep.clear()}render(e,r,i,n,s){this._isRendering=!0,this._oitUsed=!1,this.performanceInfo.startFrame();const{camera:o,contentCamera:a,mode:l,alignPixelEnabled:c}=i;this._state=l,this._renderOverlay(s),this.performanceInfo.advance(Ji.OVERLAY),this._renderContext.time=s,this._bindParameters.transparencyPassType=kt.NONE,this._bindParameters.alignPixelEnabled=c;const u=this._offscreen;u.setupRenderTarget(this.hasReflections);const h=Z_(this._sliceHelper.plane);n===uE.OFF&&(this._sliceHelper.plane=null),this._rctx.bindFramebuffer(e),o.setGLViewport(this._rctx),this._prepare(o,a),this._renderPlugins.prepareRender(),this.performanceInfo.advance(Ji.PREPARE);const f=this._computeDepthRange(o);this._renderShadowMap(e,o,this._bindParameters.lighting.mainLight.direction,f),this.performanceInfo.advance(Ji.SHADOW_MAP),u.initializeFrame(o),this._ensureBindParameters(o,a);const m=this._terrainRenderingEnabled&&(this._terrainTransparency===$o.Semitransparent||this._terrainTransparency===$o.TransparentWithDraped),g=this._highQualityTransparency&&m,y=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;this._prepareShaders(g,y),this._renderLinearDepth(),this.performanceInfo.advance(Ji.LINEAR_DEPTH),this._accumulateShadows(f,o,a),this.performanceInfo.advance(Ji.ACCUMULATED_SHADOWS),this._renderNormal(),this.performanceInfo.advance(Ji.NORMALS),this._ensureBindParametersSSR(s),this._renderSSAO(s),this.performanceInfo.advance(Ji.SSAO),this._renderContext.output=q.Color,u.bindFramebuffer(),this._renderOpaqueGeometry(),this.performanceInfo.advance(Ji.OPAQUE),this._renderTerrainLinearDepth(g),this._setMultipassTerrain(g),this._renderEdges(mr.OPAQUE),this.performanceInfo.advance(Ji.OPAQUE_EDGES),this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth),this._renderSlot(_e.VOXEL),this.performanceInfo.advance(Ji.VOXEL),this._renderHiddenTransparentEdges(),y&&(this._oitEnabled?this._renderOITPass(oA.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(Ji.TRANSPARENT),this._renderGeometryLinearDepth(g);const _=this._renderHUDVisibility(g);g||this._renderInternalSlot(_e.LINE_CALLOUTS),this.performanceInfo.advance(Ji.HUD_VISIBILITY),this._renderObjectAndLayerIdColor(r),this.performanceInfo.advance(Ji.OBJECT_AND_LAYER_ID_COLOR),this._renderEdges(mr.TRANSPARENT,g),this.performanceInfo.advance(Ji.TRANSPARENT_EDGES),this._renderTransparentTerrain(),m&&_&&(g?this._renderLineCallouts(Bu.Occluded):u.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(Bu.Occluded,u.framebuffer),this.performanceInfo.advance(Ji.HUD_OCCLUDED)),this.performanceInfo.advance(Ji.TRANSPARENT_TERRAIN),this._setTerrainCulling(!1),m&&(u.compositeTransparentTerrainOntoMain(this._bindParameters),g&&(this._renderEdges(mr.OPAQUE),this.performanceInfo.advance(Ji.OPAQUE_EDGES),y&&(this._oitEnabled?this._renderOITPass(oA.Geometry):this._renderTransparentGeometry()),this.performanceInfo.advance(Ji.TRANSPARENT),this._renderEdges(mr.TRANSPARENT),this.performanceInfo.advance(Ji.TRANSPARENT_EDGES))),g&&this._renderLineCallouts(Bu.NotOccluded),this._setMultipassEnabled(!1),this._shadowAccumulator.render(this._bindParameters),u.renderToTargets(()=>{this._renderInternalSlot(_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._renderSlot(_e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT),this._renderSlot(_e.LASERLINES)},u.currentColorTarget,u.mainDepth),this.performanceInfo.advance(Ji.ENVIRONMENT),this._renderPlugins.needsLaserlineWithContrastControl&&u.renderTmpAndCompositeToMain(()=>this._renderSlot(_e.LASERLINES_CONTRAST_CONTROL),this._bindParameters,Pl.PremultipliedAlpha),this.performanceInfo.advance(Ji.LASER_LINE),this._renderOccluded(),this.performanceInfo.advance(Ji.OCCLUDED);const b=n===uE.ON&&this._magnifierHelper.enabled,w=b&&e==null?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):e;this._rctx.bindFramebuffer(w);const x=this._offscreen.colorTexture;this._renderAntiAliasing(x)||x==null||this._compositingHelper.composite(this._bindParameters,x,Pl.None),this.performanceInfo.advance(Ji.ANTIALIASING),this._renderHUD(Bu.NotOccluded,w),this.performanceInfo.advance(Ji.HUD),this._renderHighlights(w,this._bindParameters),this.performanceInfo.advance(Ji.HIGHLIGHTS),b&&this._magnifierHelper.render(this._rctx,this._bindParameters),w!==e&&(this._rctx.bindFramebuffer(e),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,Pl.None)),this._disposeOITBuffers(),this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera),this._sliceHelper.plane=h,this._isRendering=!1,this.onPostRender&&this.onPostRender(),this.performanceInfo.finishFrame()}_prepareShaders(e,r){this._renderContext.output=q.Color,this._prepareOpaqueGeometrySlots(),this._setMultipassTerrain(e),this._prepareSlots(_e.TRANSPARENT_TERRAIN),this._setMultipassTerrain(!1),e||this._prepareInternalSlots(this._materialRenderers,_e.LINE_CALLOUTS),r&&this._prepareTransparencySlots(),this._prepareInternalSlots(this._materialRenderers,_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),this._prepareSlots(_e.POSTPROCESSING_ENVIRONMENT_TRANSPARENT,_e.LASERLINES),this._rctx.gl.flush()}_renderObjectAndLayerIdColor(e){if(e!=null&&he("enable-feature:objectAndLayerId-rendering")){const r=this._renderContext.output;this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(q.ObjectAndLayerIdColor),[0,0,0,0],!0,!0),this._rctx.bindFramebuffer(e),this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=Bu.NotOccluded,this._renderInternalSlot(_e.HUD_MATERIAL)},void 0,!0,!0),this._renderContext.output=r}}finish(e){this._hasAnimations||this._animationTimestep.clear();const r=this.performanceInfo.gpuSamplingEnabled,i=e===is.BACKGROUND;if(i||r){const n=i?this.performanceInfo.elapsedTime:0,s=r?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError(),o=Math.max(n,s);this._animationTimestep.frame(o,i)}}readDepthPixels(e,r,i){const n=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);if(!this._needsLinearDepth){this._ensureBindParameters(e,e),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0);const s=Qi.COLOR_BUFFER_BIT|Qi.DEPTH_BUFFER_BIT|Qi.STENCIL_BUFFER_BIT;this._rctx.clearSafe(s),this._renderGeometryAndTransparentTerrainPass(q.Depth)}n.readPixels(r[0],r[1],r[2],r[3],Yt.RGBA,Fs.UNSIGNED_BYTE,i)}readHUDVisibility(e,r,i,n,s){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(e,r,i,n,Yt.RGBA,Fs.UNSIGNED_BYTE,s)}readAccumulatedShadow(e){return this._shadowAccumulator.readAccumulatedShadow(e[0],e[1])}_setMultipassTerrain(e){this._setMultipassEnabled(e),this._setTerrainCulling(e)}_setMultipassEnabled(e){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=e}_setTerrainCulling(e){this._bindParameters.multipassTerrain.cullAboveGround=e}_prepareSlots(...e){this._renderPlugins.prepareSlots(e)}_renderSlot(e){this._bindParameters.slot=e,this._renderPlugins.render()}_renderEdges(e,r=!1){const i=this._edgeView;i!=null&&i.shouldRender()&&this._offscreen.renderTmpAndCompositeToMain(()=>i.render(this._bindParameters,e),this._bindParameters,Pl.Alpha,r)}_renderShadowMap(e,r,i,n){const s=this._shadowMap;s.enabled&&(s.start(r,i,n,this.isFeatureEnabled(qs.HighResolutionShadows),this._stage.view.qualitySettings.maximumPixelRatio),this._shadowHighlight.updateParameters(r,i),this._needsShadowHighlight?(this._renderShadowCascades(q.ShadowHighlight,this._shadowMap,o=>s.takeCascadeSnapshotTo(o,r3.Highlight)),s.clear(),this._renderShadowCascades(q.ShadowExcludeHighlight,this._shadowMap,o=>{s.takeCascadeSnapshotTo(o,r3.Default),this._renderGeometryAndTransparentTerrainPass(q.ShadowHighlight)})):this._renderShadowCascades(q.Shadow),s.finish(e),r.setGLViewport(this._rctx))}_renderShadowCascades(e,r=this._shadowMap,i=n=>{}){for(const n of r.cascades)n.camera.setGLViewport(this._rctx),this._prepare(n.camera,n.camera),this._renderGeometryAndTransparentTerrainPass(e),i(n)}get _needsLinearDepth(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasReflections||this._needsShadowHighlight||this._needsShadowCast}_renderLinearDepth(){this._needsLinearDepth?this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(q.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth),this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture}_renderTerrainLinearDepth(e){if(e){const r=this._renderContext.output;this._renderContext.output=q.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1e10,-1e10,-1e10,1],!0,!0),this._renderContext.output=r}else this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture}_renderGeometryLinearDepth(e){if(e){const r=this._renderContext.output;this._offscreen.renderToTargets(()=>this._renderGeometryPass(q.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.output=r}else this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture}get _needsNormal(){return this._ssaoHelper.active}_renderNormal(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(q.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)}get _needsDepthRange(){return this._shadowMap.enabled||this._needsShadowCast}_computeDepthRange(e){if(!this._needsDepthRange)return Qne;const r=nqt(e,this._materialRenderers,this._stage.layers);return o3(r,this.renderPlugins.queryDepthRange(e)),r.near=Math.max(e.near,r.near),r.far=Math.min(e.far,r.far),r}_renderGeometryAndTransparentTerrainPass(e){this._renderContext.output=e,this._prepareSlots(_e.TRANSPARENT_TERRAIN),this._renderGeometryPass(e),this._renderTransparentTerrain()}_renderGeometryPass(e){this._renderContext.output=e,this._prepareSlots(_e.TRANSPARENT_MATERIAL),this._renderOpaqueGeometry(),this._renderTransparentGeometry()}_renderSSAO(e){this._ssaoHelper.render(this._bindParameters,e,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)}_prepareOpaqueGeometrySlots(){this._prepareSlots(_e.INTEGRATED_MESH,_e.OPAQUE_TERRAIN,_e.OPAQUE_MATERIAL,_e.POSTPROCESSING_ENVIRONMENT_OPAQUE),this._prepareInternalSlots(this._materialRenderers,_e.OPAQUE_MATERIAL)}_renderOpaqueGeometry(){this._renderSlot(_e.INTEGRATED_MESH),this._renderSlot(_e.OPAQUE_TERRAIN),this._renderInternalSlot(_e.OPAQUE_MATERIAL),this._renderSlot(_e.OPAQUE_MATERIAL),this._renderSlot(_e.POSTPROCESSING_ENVIRONMENT_OPAQUE)}_renderTransparentGeometry(){this._renderInternalSlot(_e.TRANSPARENT_MATERIAL),this._renderSlot(_e.TRANSPARENT_MATERIAL)}_renderTransparentTerrain(){this._renderSlot(_e.TRANSPARENT_TERRAIN)}_renderHUDVisibility(e){let r=!1;return this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture,r=this._renderInternalSlot(_e.OCCLUSION_PIXELS)},e),r}_renderLineCallouts(e){this._bindParameters.renderTransparentlyOccludedHUD=e,e===Bu.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(_e.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(_e.LINE_CALLOUTS)}_renderHUD(e,r){this._hasHUDElements&&(this._oitEnabled?(this._renderOITPass(oA.HUD,e),this._rctx.bindFramebuffer(r),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,Pl.PremultipliedAlpha)):e===Bu.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(Bu.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(e))}_renderHUDElements(e){this._bindParameters.renderTransparentlyOccludedHUD=e,this._prepareInternalSlots(this._materialRenderers,_e.LINE_CALLOUTS_HUD_DEPTH,_e.HUD_MATERIAL,_e.LABEL_MATERIAL),this._renderInternalSlot(_e.LINE_CALLOUTS_HUD_DEPTH),this._renderInternalSlot(_e.HUD_MATERIAL),this._renderInternalSlot(_e.LABEL_MATERIAL)}get _needsHighlight(){return this._hasHighlights||this._renderPlugins.needsHighlight}get _needsShadowHighlight(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}_renderHighlights(e,r){if(!this._needsHighlight)return void this._offscreen.disposeTarget(this._offscreen.highlight);const i=this._highlight,n=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(q.Highlight),this._rctx.clearSafe(Qi.DEPTH_BUFFER_BIT),this._renderHUDElements(Bu.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=n.colorTexture,this._needsShadowHighlight&&this._shadowHighlight.render(r,e),i.render(this._bindParameters,n,e)}get _needsShadowCast(){return this._shadowAccumulator.isAccumulating}_accumulateShadows(e,r,i){this._needsShadowCast&&this._offscreen.linearDepthTexture!=null&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,e,r,i)}_prepareTransparencySlots(){this._renderContext.output=q.Alpha,this._bindParameters.transparencyPassType=kt.Alpha,this._prepareInternalSlots(this._materialRenderers,_e.TRANSPARENT_MATERIAL),this._prepareSlots(_e.TRANSPARENT_MATERIAL),this._renderContext.output=q.Color,this._bindParameters.transparencyPassType=kt.Color,this._prepareInternalSlots(this._materialRenderers,_e.TRANSPARENT_MATERIAL),this._prepareSlots(_e.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=kt.FrontFace,this._prepareInternalSlots(this._materialRenderers,_e.TRANSPARENT_MATERIAL),this._prepareSlots(_e.TRANSPARENT_MATERIAL),this._bindParameters.transparencyPassType=kt.NONE}_renderOITPass(e,r=Bu.Both){const i=e===oA.HUD,n=i?()=>this._renderHUDElements(r):()=>this._renderTransparentGeometry(),s=a=>{this._bindParameters.transparencyPassType=a,this._offscreen.renderOITPass(n,a,i)},o=this._renderContext.output;this._renderContext.output=q.Alpha,s(kt.Alpha),this._renderContext.output=q.Color,s(kt.Color),s(kt.FrontFace),this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,i),this._bindParameters.transparencyPassType=kt.NONE,this._renderContext.output=o,this._oitUsed=!0}_disposeOITBuffers(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget))}_renderOccluded(){let e=0;kd.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&o.material.renderOccluded===gn.OccludeAndTransparentStencil&&(e|=o.material.renderOccluded,kd.push(o))});const r=this._offscreen,i=(o,a,l,c,u)=>{e&a&&(r.renderToTargets(l,r.tmpColor,r.mainDepth,[0,0,0,0],c,u),r.compositeOccludedOntoMain(this._bindParameters,o))};kd.length!==0&&(this._prepareInternalSlots(kd,_e.OCCLUDER_MATERIAL,_e.TRANSPARENT_OCCLUDER_MATERIAL),this._renderInternalSlot(_e.OCCLUDER_MATERIAL,kd),i(.5,gn.OccludeAndTransparentStencil,()=>this._renderInternalSlot(_e.TRANSPARENT_OCCLUDER_MATERIAL,kd),!1,!1)),kd.clear(),this._materialRenderers.forAll(o=>{o.material&&o.material.isVisible()&&(o.material.renderOccluded===gn.OccludeAndTransparent||o.material.renderOccluded===gn.Transparent||o.material.renderOccluded===gn.Opaque)&&(e|=o.material.renderOccluded,kd.push(o))});const n=this._renderPlugins.renderOccludedFlags;if(e|=n,!e)return;const s=o=>{this._renderContext.renderOccludedMask=o,this._prepareInternalSlots(kd,_e.OPAQUE_MATERIAL,_e.TRANSPARENT_MATERIAL,_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),n>gn.Occlude&&this._renderSlot(_e.OCCLUDED_TERRAIN),this._renderInternalSlot(_e.OPAQUE_MATERIAL,kd),this._renderInternalSlot(_e.TRANSPARENT_MATERIAL,kd),this._renderInternalSlot(_e.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,kd),this._renderContext.resetRenderOccludedMask()};this._renderContext.output=q.Color,i(.5,gn.OccludeAndTransparent,()=>s(gn.OccludeAndTransparent),!0,cu.OutlineVisualElementMask),i(.5,gn.Transparent,()=>s(gn.Transparent),!0,cu.OutlineVisualElementMask),i(1,gn.Opaque,()=>s(gn.Opaque),!0,cu.OutlineVisualElementMask),kd.clear()}_renderAntiAliasing(e){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&e!=null)return this._smaaPass.render(e),!0}else this._smaaPass.disable();return!1}_prepare(e,r){this._needsTransparentPass=this._materialRenderers.some(i=>i.requiresSlot(_e.TRANSPARENT_MATERIAL,q.Color)),this._bindParameters.camera=e,this._bindParameters.contentCamera=r}_ensureBindParameters(e,r){this._bindParameters.camera=e,this._bindParameters.contentCamera=r;const i=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=i.hudVisibilityTexture,this._bindParameters.mainColorTexture=i.mainColorTexture,this._bindParameters.highlightDepthTexture=i.depthTexture??this._getFallbackDepthTexture()}_ensureBindParametersSSR(e){if(this._bindParameters.ssr.enabled=this.hasReflections,this._bindParameters.ssr.enabled){this._ssrEnableTime==null&&(this._ssrEnableTime=e),this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=bo:(Uo(LCe,this._bindParameters.camera.viewMatrix),Uo(ICe,this._bindParameters.camera.projectionMatrix),Ii(hR,LCe,ICe),Ii(hR,this._renderContext.lastFrameCamera.viewMatrix,hR),Ii(hR,this._renderContext.lastFrameCamera.projectionMatrix,hR),this._reprojectionMatrix=hR),this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const r=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=r>0?Math.min(r,e-this._ssrEnableTime)/r:1,this._bindParameters.ssr.fadeFactor<1&&this._requestRender()}else this._reprojectionMatrix=bo,this._bindParameters.ssr.lastFrameColorTexture=null,this._ssrEnableTime=null}_prepareInternalSlots(e,...r){for(const i of r)this._bindParameters.slot=i,e.forAll(n=>{n.material.shouldRender(this._renderContext)&&n.prepareTechnique(this._renderContext)})}_renderInternalSlot(e,r=this._materialRenderers){let i=!1;return this._bindParameters.slot=e,r.forAll(n=>{if(n.material.shouldRender(this._renderContext)){const s=n.prepareTechnique(this._renderContext);s!=null&&(n.render(this._renderContext,s),i=!0)}}),i}_getFallbackDepthTexture(){return this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=y6e(this._rctx)),this._fallbackDepthStencilTexture}get gpuMemoryUsage(){var e,r,i,n,s;return{offscreen:((e=this._offscreen)==null?void 0:e.gpuMemoryUsage)??0,highlights:(((r=this._highlight)==null?void 0:r.gpuMemoryUsage)??0)+(((i=this._shadowHighlight)==null?void 0:i.gpuMemoryUsage)??0),shadows:((n=this._shadowMap)==null?void 0:n.gpuMemoryUsage)??0,ssao:((s=this._ssaoHelper)==null?void 0:s.gpuMemoryUsage)??0}}get test(){const e=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{e._renderStateFeatures=Lbe()},getFramebufferTexture:r=>{switch(r){case Hb.Color:return e._offscreen.colorTexture;case Hb.LinearDepth:return e._offscreen.linearDepthTexture;case Hb.Normals:return e._offscreen.normalTexture;case Hb.ShadowMap:return e._shadowMap.depthTexture;case Hb.HudVisibility:return e._offscreen.hudVisibilityTexture;case Hb.Highlight:return e._offscreen.highlightTexture}}}}};var oA,Hb;d([p()],Iu.prototype,"_renderPlugins",void 0),d([p()],Iu.prototype,"_shadowAccumulator",void 0),d([p()],Iu.prototype,"_state",void 0),d([p()],Iu.prototype,"_renderStateFeatures",void 0),d([p()],Iu.prototype,"_antialiasingEnabled",void 0),d([p({readOnly:!0})],Iu.prototype,"_antialiasing",null),d([p()],Iu.prototype,"_ssaoEnabled",void 0),d([p()],Iu.prototype,"_smaaPass",void 0),d([p({autoDestroy:!0})],Iu.prototype,"_edgeView",void 0),d([p()],Iu.prototype,"updating",null),d([p()],Iu.prototype,"isCameraFinal",null),Iu=d([I("esri.views.3d.webgl-engine.lib.Renderer")],Iu),function(t){t[t.Geometry=0]="Geometry",t[t.HUD=1]="HUD"}(oA||(oA={})),function(t){t[t.Color=0]="Color",t[t.LinearDepth=1]="LinearDepth",t[t.Normals=2]="Normals",t[t.ShadowMap=3]="ShadowMap",t[t.HudVisibility=4]="HudVisibility",t[t.Highlight=5]="Highlight"}(Hb||(Hb={}));const kd=new dr,ICe=Me(),LCe=Me(),hR=Me();function tXt(t){return e=>t.immediate.schedule(e)}let K7e=class Q7e{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:`#version 300 es
    precision highp float;

    void main(void) {
      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);
    }`,fragment:`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main(void) {
      fragColor = vec4(0.0, 0.0, 0.0, 1.0);
    }`}}_createHelperProgram(){const e=Q7e.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return ci.createIndex(this._rctx,qr.STATIC_DRAW,new Uint32Array([0]))}resetIndicesType(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,Wt.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(Zt.POINTS,1,$t.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}},DCe=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:De.ONE,dstRGB:De.ZERO,srcAlpha:De.ONE,dstAlpha:De.ZERO},this.blendEquation={mode:h0.ADD,modeAlpha:h0.ADD},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=zm.BACK,this.frontFace=jP.CCW,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=Oi.LESS,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:zm.FRONT_AND_BACK,func:Oi.ALWAYS,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:zm.FRONT_AND_BACK,fail:cs.KEEP,zFail:cs.KEEP,zPass:cs.KEEP},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.uniformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},rXt=class{constructor(e){this._allocations=new Map,e?Error.stackTraceLimit=1/0:(this.add=()=>{},this.remove=()=>{})}add(e){this._allocations.set(e,new Error().stack)}remove(e){this._allocations.delete(e)}get information(){let e="";if(this._allocations.size>0){e+=`${this._allocations.size} live object allocations:
`;const r=new Map;this._allocations.forEach(i=>{r.set(i,(r.get(i)??0)+1)}),r.forEach((i,n)=>{const s=n.split(`
`);s.shift(),s.shift(),e+=`${i}: ${s.shift()}
`,s.forEach(o=>e+=`   ${o}
`)})}return e}};const iXt={RECORD_ALLOCATIONS:!1};let nXt=class{constructor(){for(this._current=new Array,this._max=new Array,this._allocations=new rXt(iXt.RECORD_ALLOCATIONS);this._current.length<ko.COUNT;)this._current.push(0),this._max.push(0)}resetMax(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)}increment(e,r){const i=++this._current[e];this._max[e]=Math.max(i,this._max[e]),this._allocations.add(r)}decrement(e,r){--this._current[e],this._allocations.remove(r)}get max(){return this._max}get current(){return this._current}get total(){return this.current.reduce((e,r)=>e+r,0)}get resourceInformation(){let e="";if(this.total>0){e+=`Live objects:
`;for(let r=0;r<ko.COUNT;++r){const i=this._current[r];i>0&&(e+=`${ko[r]}: ${i}
`)}}return e+=this._allocations.information,e}},sXt=class{constructor(e,r,i){const n=r.textureFilterAnisotropic,s=i.maxAnisotropy??1/0;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.maxMaxAnisotropy=n?Math.min(e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY),s):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),vg(e)?(this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES)):(this.maxUniformBufferBindings=0,this.maxVertexUniformBlocks=0,this.maxFragmentUniformBlocks=0,this.maxUniformBlockSize=0,this.uniformBufferOffsetAlignment=1,this.maxArrayTextureLayers=1,this.maxSamples=1)}};const oXt=["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"];var NCe,eHe={exports:{}};(NCe=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"])!==void 0&&(eHe.exports=NCe);const aXt=CF(eHe.exports);var FCe,lse={exports:{}};lse.exports,FCe=lse,function(t){var e=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"];e!==void 0&&(FCe.exports=e)}();const kCe=CF(lse.exports);var tHe={exports:{}};(function(t){(function(e){var r=function(){return["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"]}();r!==void 0&&(t.exports=r)})()})(tHe);const lXt=CF(tHe.exports);var zf=999,UCe=9999,aJ=0,lJ=1,zCe=2,VCe=3,BCe=4,yU=5,cXt=6,uXt=7,dXt=8,jCe=9,hXt=10,GCe=11,pXt=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];function fXt(){var t,e,r,i=0,n=0,s=zf,o=[],a=[],l=1,c=0,u=0,h=!1,f=!1,m="";return function(V){return a=[],V!==null?y(V.replace?V.replace(/\r\n/g,`
`):V):_()};function g(V){V.length&&a.push({type:pXt[s],data:V,position:u,line:l,column:c})}function y(V){var W;for(i=0,r=(m+=V).length;t=m[i],i<r;){switch(W=i,s){case aJ:i=C();break;case lJ:i=S();break;case zCe:i=x();break;case VCe:i=E();break;case BCe:i=D();break;case GCe:i=P();break;case yU:i=L();break;case UCe:i=k();break;case jCe:i=w();break;case zf:i=b()}W!==i&&(m[W]===`
`?(c=0,++l):++c)}return n+=i,m=m.slice(i),a}function _(V){return o.length&&g(o.join("")),s=hXt,g("(eof)"),a}function b(){return o=o.length?[]:o,e==="/"&&t==="*"?(u=n+i-1,s=aJ,e=t,i+1):e==="/"&&t==="/"?(u=n+i-1,s=lJ,e=t,i+1):t==="#"?(s=zCe,u=n+i,i):/\s/.test(t)?(s=jCe,u=n+i,i):(h=/\d/.test(t),f=/[^\w_]/.test(t),u=n+i,s=h?BCe:f?VCe:UCe,i)}function w(){return/[^\s]/g.test(t)?(g(o.join("")),s=zf,i):(o.push(t),e=t,i+1)}function x(){return t!=="\r"&&t!==`
`||e==="\\"?(o.push(t),e=t,i+1):(g(o.join("")),s=zf,i)}function S(){return x()}function C(){return t==="/"&&e==="*"?(o.push(t),g(o.join("")),s=zf,i+1):(o.push(t),e=t,i+1)}function E(){if(e==="."&&/\d/.test(t))return s=yU,i;if(e==="/"&&t==="*")return s=aJ,i;if(e==="/"&&t==="/")return s=lJ,i;if(t==="."&&o.length){for(;R(o););return s=yU,i}if(t===";"||t===")"||t==="("){if(o.length)for(;R(o););return g(t),s=zf,i+1}var V=o.length===2&&t!=="=";if(/[\w_\d\s]/.test(t)||V){for(;R(o););return s=zf,i}return o.push(t),e=t,i+1}function R(V){for(var W,G,B=0;;){if(W=kCe.indexOf(V.slice(0,V.length+B).join("")),G=kCe[W],W===-1){if(B--+V.length>0)continue;G=V.slice(0,1).join("")}return g(G),u+=G.length,(o=o.slice(G.length)).length}}function P(){return/[^a-fA-F0-9]/.test(t)?(g(o.join("")),s=zf,i):(o.push(t),e=t,i+1)}function D(){return t==="."||/[eE]/.test(t)?(o.push(t),s=yU,e=t,i+1):t==="x"&&o.length===1&&o[0]==="0"?(s=GCe,o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),s=zf,i):(o.push(t),e=t,i+1)}function L(){return t==="f"&&(o.push(t),e=t,i+=1),/[eE]/.test(t)||t==="-"&&/[eE]/.test(e)?(o.push(t),e=t,i+1):/[^\d]/.test(t)?(g(o.join("")),s=zf,i):(o.push(t),e=t,i+1)}function k(){if(/[^\d\w_]/.test(t)){var V=o.join("");return s=aXt.indexOf(V)>-1?dXt:lXt.indexOf(V)>-1?uXt:cXt,g(o.join("")),s=zf,i}return o.push(t),e=t,i+1}}function mXt(t){var e=fXt(),r=[];return r=(r=r.concat(e(t))).concat(e(null))}function gXt(t){return mXt(t)}function yXt(t){return t.map(e=>e.type!=="eof"?e.data:"").join("")}const cJ=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];function vXt(t,e="100",r="300 es"){const i=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const n of t)if(n.type==="preprocessor"){const s=i.exec(n.data);if(s){const o=s[1].replaceAll(/\s\s+/g," ");if(o===r)return o;if(o===e)return n.data="#version "+r,e;throw new Error("unknown glsl version: "+o)}}return t.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:`
`}),null}function _Xt(t,e){for(let r=e-1;r>=0;r--){const i=t[r];if(i.type!=="whitespace"&&i.type!=="block-comment"){if(i.type!=="keyword")break;if(i.data==="attribute"||i.data==="in")return!0}}return!1}function dL(t,e,r,i){i=i||r;for(const n of t)if(n.type==="ident"&&n.data===r)return i in e?e[i]++:e[i]=0,dL(t,e,i+"_"+e[i],i);return r}function rHe(t,e,r="afterVersion"){function i(l,c){for(let u=c;u<l.length;u++){const h=l[u];if(h.type==="operator"&&h.data===";")return u}return null}function n(l){let c=-1,u=0,h=-1;for(let f=0;f<l.length;f++){const m=l[f];if(m.type==="preprocessor"&&(/\#(if|ifdef|ifndef)\s+.+/.test(m.data)?++u:/\#endif\s*.*/.test(m.data)&&--u),r!=="afterVersion"&&r!=="afterPrecision"||m.type==="preprocessor"&&/^#version/.test(m.data)&&(h=Math.max(h,f)),r==="afterPrecision"&&m.type==="keyword"&&m.data==="precision"){const g=i(l,f);if(g===null)throw new Error("precision statement not followed by any semicolons!");h=Math.max(h,g)}c<h&&u===0&&(c=f)}return c+1}const s={data:`
`,type:"whitespace"},o=l=>l<t.length&&/[^\r\n]$/.test(t[l].data);let a=n(t);o(a-1)&&t.splice(a++,0,s);for(const l of e)t.splice(a++,0,l);o(a-1)&&o(a)&&t.splice(a,0,s)}function bXt(t,e,r,i="lowp"){rHe(t,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function wXt(t,e,r,i,n="lowp"){rHe(t,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:e},{type:"operator",data:";"}],"afterPrecision")}function xXt(t,e){let r,i,n=-1;for(let s=e;s<t.length;s++){const o=t[s];if(o.type==="operator"&&(o.data==="["&&(r=s),o.data==="]")){i=s;break}o.type==="integer"&&(n=parseInt(o.data,10))}return r&&i&&t.splice(r,i-r+1),n}function HCe(t,e){if(t.startsWith("#version 300"))return t;const r=gXt(t);if(vXt(r,"100","300 es")==="300 es")return t;let i=null,n=null;const s={},o={};for(let a=0;a<r.length;++a){const l=r[a];switch(l.type){case"keyword":e===nh.VERTEX_SHADER&&l.data==="attribute"?l.data="in":l.data==="varying"&&(l.data=e===nh.VERTEX_SHADER?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replaceAll(/(2D|Cube|EXT)/g,"")),e===nh.FRAGMENT_SHADER&&l.data==="gl_FragColor"&&(i||(i=dL(r,s,"fragColor"),bXt(r,i,"vec4")),l.data=i),e===nh.FRAGMENT_SHADER&&l.data==="gl_FragData"){const c=xXt(r,a+1),u=dL(r,s,"fragData");wXt(r,u,"vec4",c,"mediump"),l.data=u}else e===nh.FRAGMENT_SHADER&&l.data==="gl_FragDepthEXT"&&(n||(n=dL(r,s,"gl_FragDepth")),l.data=n);break;case"ident":if(oXt.includes(l.data)){if(e===nh.VERTEX_SHADER&&_Xt(r,a))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in o||(o[l.data]=dL(r,s,l.data)),l.data=o[l.data]}}}for(let a=r.length-1;a>=0;--a){const l=r[a];if(l.type==="preprocessor"){const c=l.data.match(/\#extension\s+(.*)\:/);if(c&&c[1]&&cJ.includes(c[1].trim())){const f=r[a+1];r.splice(a,f&&f.type==="whitespace"?2:1)}const u=l.data.match(/\#ifdef\s+(.*)/);u&&u[1]&&cJ.includes(u[1].trim())&&(l.data="#if 1");const h=l.data.match(/\#ifndef\s+(.*)/);h&&h[1]&&cJ.includes(h[1].trim())&&(l.data="#if 0")}}return SXt(t,yXt(r))}function SXt(t,e){return e}const TXt=4294967295;let EXt=class{constructor(e,r,i,n,s=new Map){this._context=e,this._locations=n,this._uniformBlockBindings=s,this._refCount=1,this._compiled=!1,this._nameToUniformLocation={},this._nameToUniform1={},this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),r.length===0&&console.error("Shaders source should not be empty!"),this._context.type===Mr.WEBGL2&&(r=HCe(r,nh.VERTEX_SHADER),i=HCe(i,nh.FRAGMENT_SHADER)),this._vShader=qCe(this._context,nh.VERTEX_SHADER,r),this._fShader=qCe(this._context,nh.FRAGMENT_SHADER,i),this._vShader&&this._fShader||console.error("Error loading shaders!"),this._context.instanceCounter.increment(ko.Shader,this),$re()&&(this.vertexShader=r,this.fragmentShader=i);const o=this._context.gl,a=o.createProgram();if(o.attachShader(a,this._vShader),o.attachShader(a,this._fShader),this._locations.forEach((l,c)=>o.bindAttribLocation(a,l,c)),o.linkProgram(a),$re()&&!o.getProgramParameter(a,o.LINK_STATUS)&&console.error(`Could not link shader
validated: ${o.getProgramParameter(a,o.VALIDATE_STATUS)}, gl error ${o.getError()}, vertex: ${o.getShaderParameter(this._vShader,o.COMPILE_STATUS)}, fragment: ${o.getShaderParameter(this._fShader,o.COMPILE_STATUS)}, info log: ${o.getProgramInfoLog(a)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`),this._context.type===Mr.WEBGL2){const l=o;for(const[c,u]of this._uniformBlockBindings){const h=l.getUniformBlockIndex(a,c);h<TXt&&l.uniformBlockBinding(a,h,u)}}this._glName=a,this._context.instanceCounter.increment(ko.Program,this)}get glName(){return this._glName}get hasGLName(){return this._glName!=null}get compiled(){if(this._compiled)return!0;const e=this._context.gl.getExtension("KHR_parallel_shader_compile");return e==null||this.glName==null?(this._compiled=!0,!0):(this._compiled=!!this._context.gl.getProgramParameter(this.glName,e.COMPLETION_STATUS_KHR),this._compiled)}dispose(){if(--this._refCount>0)return;const e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(ko.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(ko.Program,this))}ref(){++this._refCount}_getUniformLocation(e){return this._nameToUniformLocation[e]===void 0&&this.glName!=null&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this.glName,e)),this._nameToUniformLocation[e]}hasUniform(e){return this._getUniformLocation(e)!==null}setUniform1i(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1i(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1iv(e,r){Gg(this._nameToUniform1v,e,r)&&this._context.gl.uniform1iv(this._getUniformLocation(e),r)}setUniform2iv(e,r){Gg(this._nameToUniform2,e,r)&&this._context.gl.uniform2iv(this._getUniformLocation(e),r)}setUniform3iv(e,r){Gg(this._nameToUniform3,e,r)&&this._context.gl.uniform3iv(this._getUniformLocation(e),r)}setUniform4iv(e,r){Gg(this._nameToUniform4,e,r)&&this._context.gl.uniform4iv(this._getUniformLocation(e),r)}setUniform1f(e,r){const i=this._nameToUniform1[e];i!==void 0&&r===i||(this._context.gl.uniform1f(this._getUniformLocation(e),r),this._nameToUniform1[e]=r)}setUniform1fv(e,r){Gg(this._nameToUniform1v,e,r)&&this._context.gl.uniform1fv(this._getUniformLocation(e),r)}setUniform2f(e,r,i){const n=this._nameToUniform2.get(e);n===void 0?(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),this._nameToUniform2.set(e,[r,i])):r===n[0]&&i===n[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),r,i),n[0]=r,n[1]=i)}setUniform2fv(e,r){Gg(this._nameToUniform2,e,r)&&this._context.gl.uniform2fv(this._getUniformLocation(e),r)}setUniform3f(e,r,i,n){const s=this._nameToUniform3.get(e);s===void 0?(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),this._nameToUniform3.set(e,[r,i,n])):r===s[0]&&i===s[1]&&n===s[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),r,i,n),s[0]=r,s[1]=i,s[2]=n)}setUniform3fv(e,r){Gg(this._nameToUniform3,e,r)&&this._context.gl.uniform3fv(this._getUniformLocation(e),r)}setUniform4f(e,r,i,n,s){const o=this._nameToUniform4.get(e);o===void 0?(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),this._nameToUniform4.set(e,[r,i,n,s])):o!==void 0&&r===o[0]&&i===o[1]&&n===o[2]&&s===o[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),r,i,n,s),o[0]=r,o[1]=i,o[2]=n,o[3]=s)}setUniform4fv(e,r){Gg(this._nameToUniform4,e,r)&&this._context.gl.uniform4fv(this._getUniformLocation(e),r)}setUniformMatrix3fv(e,r,i=!1){Gg(this._nameToUniformMatrix3,e,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(e),i,r)}setUniformMatrix4fv(e,r,i=!1){Gg(this._nameToUniformMatrix4,e,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(e),i,r)}stop(){}};function qCe(t,e,r){const i=t.gl,n=i.createShader(e);return i.shaderSource(n,r),i.compileShader(n),$re()&&!i.getShaderParameter(n,i.COMPILE_STATUS)&&(console.error("Compile error in ".concat(e===nh.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(i.getShaderInfoLog(n)),console.error(CXt(r))),n}function CXt(t){let e=2;return t.replaceAll(`
`,()=>`
`+RXt(e++)+":")}function RXt(t){return t>=1e3?t.toString():("  "+t).slice(-3)}function Gg(t,e,r){const i=t.get(e);return i?Vle(i,r):(t.set(e,Array.from(r)),!0)}let OXt=class{constructor(e){this._rctx=e,this._store=new W3}dispose(){this._store.forEach(e=>e.forEach(r=>r.dispose())),this._store.clear()}acquire(e,r,i,n){const s=this._store.get(e,r);if(s!=null)return s.ref(),s;const o=new EXt(this._rctx,e,r,i,n);return o.ref(),this._store.set(e,r,o),o}get test(){let e=0;return this._store.forEach(r=>r.forEach(i=>e+=i.hasGLName?2:1)),{cachedWebGLObjects:e}}},HF=class{constructor(){this._result=!1}dispose(){this._program=pt(this._program)}get result(){return this._program!=null&&(this._result=this._test(this._program),this.dispose()),this._result}},AXt=class extends HF{constructor(e){super(),this._rctx=e,this._helperProgram=null,this._rctx.type===Mr.WEBGL2&&he("mac")&&he("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){var e;super.dispose(),(e=this._helperProgram)==null||e.dispose(),this._helperProgram=null}_test(e){const r=this._rctx;r.resetState();const i=new Vr(1);i.wrapMode=ir.CLAMP_TO_EDGE,i.samplingMode=Kt.NEAREST;const n=new wo(r,i),s=ci.createIndex(this._rctx,qr.STATIC_DRAW,new Uint8Array([0]));r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(s,Wt.ELEMENT_ARRAY_BUFFER),r.drawElements(Zt.POINTS,1,$t.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(Zt.TRIANGLES,0,258);const o=new Uint8Array(4);return n.readPixels(0,0,1,1,Yt.RGBA,Fs.UNSIGNED_BYTE,o),n.dispose(),s.dispose(),o[0]===255}_prepareProgram(){const r=`#version 300 es
    precision highp float;

    out float triangleId;

    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));

    void main(void) {
      triangleId = floor(float(gl_VertexID)/3.0);

      vec3 position = triangleVertices[gl_VertexID % 3];
      float offset = triangleId / ${T.float(85)};
      position.z = 0.5 - offset;

      gl_Position = vec4(position, 1.0);
    }
    `,i=`#version 300 es
    precision highp float;

    in float triangleId;

    out vec4 fragColor;

    void main(void) {
      fragColor = triangleId == ${T.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);
    }
    `;return this._rctx.programCache.acquire(r,i,new Map([]))}_prepareHelperProgram(){const e=K7e.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}},PXt=class extends HF{constructor(e){super(),this._rctx=e,this._program=WCe(this._rctx,!1),this._obfuscated=WCe(this._rctx,!0)}dispose(){super.dispose(),this._obfuscated=pt(this._obfuscated)}_test(e){if(he("force-double-precision-obfuscation"))return!0;if(this._obfuscated==null)return!1;const r=this._runProgram(e),i=this._runProgram(this._obfuscated);return r!==0&&(i===0||r/i>5)}_runProgram(e){const r=this._rctx;r.resetState();const i=new Vr(1);i.wrapMode=ir.CLAMP_TO_EDGE,i.samplingMode=Kt.NEAREST;const n=new wo(r,i),s=ci.createVertex(r,qr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new pf(r,new Map([["position",0]]),{geometry:[new La("position",2,$t.UNSIGNED_SHORT,0,4)]},{geometry:s}),a=Ue(5633261287538229e-9,2626832878767164e-9,1.4349880495278358e6),l=Ue(563327146742708e-8,2.6268736381334523e6,1434963231608387e-9),c=new Float32Array(6);bie(a,c,3);const u=new Float32Array(6);bie(l,u,3),r.useProgram(e),e.setUniform3f("u_highA",c[0],c[2],c[4]),e.setUniform3f("u_lowA",c[1],c[3],c[5]),e.setUniform3f("u_highB",u[0],u[2],u[4]),e.setUniform3f("u_lowB",u[1],u[3],u[5]),r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Zt.TRIANGLE_STRIP,0,4);const h=new Uint8Array(4);n.readPixels(0,0,1,1,Yt.RGBA,Fs.UNSIGNED_BYTE,h),o.dispose(),n.dispose();const f=(a[2]-l[2])/25,m=Lhe(h);return Math.abs(f-m)}};function WCe(t,e){const r=`

  precision highp float;

  attribute vec2 position;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);
  }
  `,i=`
  precision highp float;

  varying vec4 v_color;

  void main() {
    gl_FragColor = v_color;
  }
  `;return t.programCache.acquire(r,i,new Map([["position",0]]))}let MXt=class extends HF{constructor(e){var n,s,o,a,l;if(super(),this._rctx=e,!e.gl)return;if(e.type===Mr.WEBGL1)return void(this._result=!(!((n=e.capabilities.textureFloat)!=null&&n.textureFloat)||!((s=e.capabilities.colorBufferFloat)!=null&&s.textureFloat)));if(!((o=e.capabilities.textureFloat)!=null&&o.textureFloat&&((a=e.capabilities.colorBufferFloat)!=null&&a.textureFloat)&&((l=e.capabilities.colorBufferFloat)!=null&&l.floatBlend)))return;const r=`
    precision highp float;
    attribute vec2 a_pos;

    void main() {
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
     precision highp float;

     void main() {
      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);
     }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new Vr(1);i.wrapMode=ir.CLAMP_TO_EDGE,i.dataType=Fs.FLOAT,i.internalFormat=Et.RGBA32F,i.samplingMode=Kt.NEAREST;const n=new wo(r,i),s=ci.createVertex(r,qr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new pf(r,new Map([["a_pos",0]]),{geometry:[new La("a_pos",2,$t.UNSIGNED_SHORT,0,4)]},{geometry:s});r.useProgram(e);const a=r.getBoundFramebufferObject(),{x:l,y:c,width:u,height:h}=r.getViewport();r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.bindVAO(o),r.drawArrays(Zt.TRIANGLE_STRIP,0,4);const f=Qt({blending:rze});r.setPipelineState(f),r.drawArrays(Zt.TRIANGLE_STRIP,0,4);const m=r.gl.getError();return r.setViewport(l,c,u,h),r.bindFramebuffer(a),o.dispose(),n.dispose(),m!==1282||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}},$Xt=class extends HF{constructor(e){super(),this._rctx=e;const r=`
      precision highp float;
      attribute vec2 a_pos;
      uniform highp sampler2D u_texture;
      varying vec4 v_color;

      float getBit(in float bitset, in int bitIndex) {
        float offset = pow(2.0, float(bitIndex));
        return mod(floor(bitset / offset), 2.0);
      }

      void main() {
        vec4 value = texture2D(u_texture, vec2(0.0));
        float bit = getBit(value.x * 255.0, 1);

        v_color = bit * vec4(1.0);
        gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
      }
      `,i=`
      precision highp float;
      varying vec4 v_color;

      void main() {
        gl_FragColor = v_color;
      }
      `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}_test(e){const r=this._rctx,i=new Vr(1);i.wrapMode=ir.CLAMP_TO_EDGE,i.samplingMode=Kt.NEAREST;const n=new wo(r,i),s=new Uint8Array(4),o=ci.createVertex(r,qr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),a=new pf(r,new Map([["a_position",0]]),{geometry:[new La("a_position",2,$t.SHORT,0,4)]},{geometry:o});r.useProgram(e);const l=new Jt(r,i,new Uint8Array([2,255,0,0]));e.setUniform1i("u_texture",0),r.bindTexture(l,0);const c=r.getBoundFramebufferObject();r.bindFramebuffer(n),r.useProgram(e);const{x:u,y:h,width:f,height:m}=r.getViewport();r.setViewport(0,0,1,1),r.bindVAO(a),r.drawArrays(Zt.TRIANGLE_STRIP,0,4),r.setViewport(u,h,f,m),n.readPixels(0,0,1,1,Yt.RGBA,Fs.UNSIGNED_BYTE,s),a.dispose(),n.dispose();const g=s[0]!==255||s[1]!==255||s[2]!==255||s[3]!==255;return g&&re.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${s[0]}.${s[1]}.${s[2]}.${s[3]}]`),r.bindFramebuffer(c),g}};new La("a_pos",2,$t.BYTE,0,2);new La("a_pos",2,$t.BYTE,0,4),new La("a_tex",2,$t.BYTE,2,4);const IXt={geometry:[new La("a_pos",2,$t.UNSIGNED_SHORT,0,4)]};let LXt=class extends HF{constructor(e){super(),this._rctx=e;const r=`
    precision highp float;

    attribute vec2 a_pos;
    varying vec2 v_uv;

    void main() {
      v_uv = a_pos;
      gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
    }
    `,i=`
    precision highp float;

    varying vec2 v_uv;

    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uv);
    }
    `;this._program=e.programCache.acquire(r,i,new Map([["a_pos",0]]))}dispose(){super.dispose()}_test(e){const r=this._rctx;if(!r.gl)return e.dispose(),!0;const i=new Vr(1);i.wrapMode=ir.CLAMP_TO_EDGE,i.samplingMode=Kt.NEAREST;const n=new wo(r,i),s=ci.createVertex(r,qr.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),o=new pf(r,new Map([["a_pos",0]]),IXt,{geometry:s}),a=new Vr;a.samplingMode=Kt.LINEAR,a.wrapMode=ir.CLAMP_TO_EDGE;const l=new Jt(r,a,hL);r.useProgram(e),r.bindTexture(l,0),e.setUniform1i("u_texture",0);const c=r.getBoundFramebufferObject(),{x:u,y:h,width:f,height:m}=r.getViewport();r.bindFramebuffer(n),r.setViewport(0,0,1,1),r.setClearColor(0,0,0,0),r.setBlendingEnabled(!1),r.clearSafe(Qi.COLOR_BUFFER_BIT),r.bindVAO(o),r.drawArrays(Zt.TRIANGLE_STRIP,0,4);const g=new Uint8Array(4);return n.readPixels(0,0,1,1,Yt.RGBA,Fs.UNSIGNED_BYTE,g),o.dispose(),n.dispose(),l.dispose(),r.setViewport(u,h,f,m),r.bindFramebuffer(c),g[0]!==255}};const hL=new Image;hL.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",hL.width=5,hL.height=5,hL.decode();let DXt=class{constructor(e){this.rctx=e,this.floatBufferBlend=new MXt(e),this.svgPremultipliesAlpha=new LXt(e),this.doublePrecisionRequiresObfuscation=new PXt(e),this.ignoresSamplerPrecision=new $Xt(e),this.drawArraysRequiresIndicesTypeReset=new AXt(e)}dispose(){this.ignoresSamplerPrecision.dispose(),this.doublePrecisionRequiresObfuscation.dispose(),this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}};function NXt(t,e){if(e.disjointTimerQuery)return null;if(vg(t))return{drawBuffers:t.drawBuffers.bind(t),MAX_DRAW_BUFFERS:t.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:t.MAX_COLOR_ATTACHMENTS};if(e.drawBuffers)return null;const r=t.getExtension("WEBGL_draw_buffers");return r?{drawBuffers:r.drawBuffersWEBGL.bind(r),MAX_DRAW_BUFFERS:r.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:r.MAX_COLOR_ATTACHMENTS_WEBGL}:null}function FXt(t){if(vg(t))return t;const e=t.getExtension("ANGLE_instanced_arrays");return e?{drawArraysInstanced:e.drawArraysInstancedANGLE.bind(e),drawElementsInstanced:e.drawElementsInstancedANGLE.bind(e),vertexAttribDivisor:e.vertexAttribDivisorANGLE.bind(e)}:null}function kXt(t,e){if(e.compressedTextureETC)return null;const r=t.getExtension("WEBGL_compressed_texture_etc");return r?{COMPRESSED_R11_EAC:r.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:r.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:r.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:r.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:r.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:r.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:r.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null}function UXt(t,e){if(e.compressedTextureS3TC)return null;const r=t.getExtension("WEBGL_compressed_texture_s3tc");return r?{COMPRESSED_RGB_S3TC_DXT1:r.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:r.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:r.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:r.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}function zXt(t,e){if(vg(t))return{MIN:t.MIN,MAX:t.MAX};if(e.blendMinMax)return null;{const r=t.getExtension("EXT_blend_minmax");return r?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null}}function VXt(t,e){if(e.textureFilterAnisotropic)return null;const r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return r?{MAX_TEXTURE_MAX_ANISOTROPY:r.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:r.TEXTURE_MAX_ANISOTROPY_EXT}:null}function BXt(t,e){if(vg(t))return{textureFloat:!0,textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:t.HALF_FLOAT,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F};if(t instanceof WebGLRenderingContext){const r=!e.textureHalfFloat&&t.getExtension("OES_texture_half_float");return{textureFloat:!e.textureFloat&&!!t.getExtension("OES_texture_float"),textureFloatLinear:!e.textureFloatLinear&&!!t.getExtension("OES_texture_float_linear"),textureHalfFloat:!!r,textureHalfFloatLinear:!e.textureHalfFloatLinear&&!!t.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:r?r.HALF_FLOAT_OES:void 0}}return null}function jXt(t,e){if(vg(t)){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float")||!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),i=!e.colorBufferFloat&&t.getExtension("EXT_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,R16F:t.R16F,RG16F:t.RG16F,RGBA16F:t.RGBA16F,R32F:t.R32F,RG32F:t.RG32F,RGBA32F:t.RGBA32F,R11F_G11F_B10F:t.R11F_G11F_B10F,RGB16F:t.RGB16F}:null}if(t instanceof WebGLRenderingContext){const r=!e.colorBufferHalfFloat&&t.getExtension("EXT_color_buffer_half_float"),i=!e.colorBufferFloat&&t.getExtension("WEBGL_color_buffer_float"),n=!e.floatBlend&&!e.colorBufferFloat&&t.getExtension("EXT_float_blend");return r||i||n?{textureFloat:!!i,textureHalfFloat:!!r,floatBlend:!!n,RGBA16F:r?r.RGBA16F_EXT:void 0,RGB16F:r?r.RGB16F_EXT:void 0,RGBA32F:i?i.RGBA32F_EXT:void 0}:null}return null}function XCe(t,e,r,i,n){if(i&&vg(t))return!0;if(e[r])return!1;for(const s of n)if(t.getExtension(s))return!0;return!1}function GXt(t,e){if(!vg(t)||e.textureNorm16)return null;const r=t.getExtension("EXT_texture_norm16");return r?{R16:r.R16_EXT,RG16:r.RG16_EXT,RGB16:r.RGB16_EXT,RGBA16:r.RGBA16_EXT,R16_SNORM:r.R16_SNORM_EXT,RG16_SNORM:r.RG16_SNORM_EXT,RGB16_SNORM:r.RGB16_SNORM_EXT,RGBA16_SNORM:r.RGBA16_SNORM_EXT}:null}function HXt(t,e){const r=e.loseContext&&t.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null}function qXt(t,e){if(vg(t))return{createVertexArray:t.createVertexArray.bind(t),deleteVertexArray:t.deleteVertexArray.bind(t),bindVertexArray:t.bindVertexArray.bind(t)};if(e.vao)return null;const r=t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object");return r?{createVertexArray:r.createVertexArrayOES.bind(r),deleteVertexArray:r.deleteVertexArrayOES.bind(r),bindVertexArray:r.bindVertexArrayOES.bind(r)}:null}let WXt=class{constructor(e,r){this._gl=e,this._instancing=null,this._vertexArrayObject=null,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._textureFloat=null,this._colorBufferFloat=null,this._minMaxBlending=null,this._loseContext=null,this._drawBuffers=null,this._textureNorm16=null,this._depthTexture=null,this._textureFloatLinear=null,this._disabledExtensions=r.disabledExtensions||{},this._debugWebGLExtensions=r.debugWebGLExtensions||{}}get drawBuffers(){return this._drawBuffers||(this._drawBuffers=NXt(this._gl,this._disabledExtensions)),this._drawBuffers}get instancing(){return this._instancing||(this._instancing=FXt(this._gl)),this._instancing}get vao(){return this._vertexArrayObject||(this._vertexArrayObject=qXt(this._gl,this._disabledExtensions)),this._vertexArrayObject}get compressedTextureETC(){return this._compressedTextureETC||(this._compressedTextureETC=kXt(this._gl,this._disabledExtensions)),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC||(this._compressedTextureS3TC=UXt(this._gl,this._disabledExtensions)),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic||(this._textureFilterAnisotropic=VXt(this._gl,this._disabledExtensions)),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery||(this._disjointTimerQuery=JWt(this._gl,this._disabledExtensions)),this._disjointTimerQuery}get textureFloat(){return this._textureFloat||(this._textureFloat=BXt(this._gl,this._disabledExtensions)),this._textureFloat}get colorBufferFloat(){return this._colorBufferFloat||(this._colorBufferFloat=jXt(this._gl,this._disabledExtensions)),this._colorBufferFloat}get blendMinMax(){return this._minMaxBlending||(this._minMaxBlending=zXt(this._gl,this._disabledExtensions)),this._minMaxBlending}get depthTexture(){return this._depthTexture===null&&(this._depthTexture=XCe(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"])),this._depthTexture}get loseContext(){return this._loseContext||(this._loseContext=HXt(this._gl,this._debugWebGLExtensions)),this._loseContext}get textureNorm16(){return this._textureNorm16||(this._textureNorm16=GXt(this._gl,this._disabledExtensions)),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear===null&&(this._textureFloatLinear=XCe(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"])),this._textureFloatLinear}enable(e){return this[e]}},XXt=class{constructor(e,r){this.gl=e,this.instanceCounter=new nXt,this.programCache=new OXt(this),this._state=new DCe,this._numOfDrawCalls=0,this._numOfTriangles=0,this.type=vg(e)?Mr.WEBGL2:Mr.WEBGL1,this._loadExtensions(),this.configure(r)}get gl2(){return this.type===Mr.WEBGL1?null:this.gl}configure(e){this._capabilities=new WXt(this.gl,e),this._parameters=new sXt(this.gl,this._capabilities,e),Jt.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const r=this.gl.getParameter(this.gl.VIEWPORT);this._state=new DCe,this._state.viewport={x:r[0],y:r[1],width:r[2],height:r[3]},this._stateTracker=new dRt({setBlending:i=>{if(i){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(i.opRgb,i.opAlpha),this.setBlendFunctionSeparate(i.srcRgb,i.dstRgb,i.srcAlpha,i.dstAlpha);const n=i.color;this.setBlendColor(n.r,n.g,n.b,n.a)}else this.setBlendingEnabled(!1)},setCulling:i=>{i?(this.setFaceCullingEnabled(!0),this.setCullFace(i.face),this.setFrontFace(i.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:i=>{i?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(i.factor,i.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:i=>{i?(this.setDepthTestEnabled(!0),this.setDepthFunction(i.func)):this.setDepthTestEnabled(!1)},setStencilTest:i=>{if(i){this.setStencilTestEnabled(!0);const n=i.function;this.setStencilFunction(n.func,n.ref,n.mask);const s=i.operation;this.setStencilOp(s.fail,s.zFail,s.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:i=>{i?(this.setDepthWriteEnabled(!0),this.setDepthRange(i.zNear,i.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:i=>{i?this.setColorMask(i.r,i.g,i.b,i.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:i=>{i?this.setStencilWriteMask(i.mask):this.setStencilWriteMask(0)}}),this.enforceState(),pt(this._driverTest),this._driverTest=new DXt(this)}dispose(){pt(this._driverTest),this.programCache.dispose(),this.bindVAO(null),this.unbindBuffer(Wt.ARRAY_BUFFER),this.unbindBuffer(Wt.ELEMENT_ARRAY_BUFFER),this.type===Mr.WEBGL2&&(this.unbindBuffer(Wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Wt.PIXEL_PACK_BUFFER),this.unbindBuffer(Wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Wt.COPY_READ_BUFFER),this.unbindBuffer(Wt.COPY_WRITE_BUFFER)),this._state.textureUnitMap.length=0,_p()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(e===!0?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){var e;(e=this._state.program)==null||e.stop(),this._state.program=null}externalTextureUnitUpdate(e,r){for(let i=0;i<e.length;++i)this._state.textureUnitMap[e[i]]=null;r>=0&&(this._state.activeTexture=r)}externalVertexArrayObjectUpdate(){const e=this.capabilities.vao;e&&(e.bindVertexArray(null),this._state.vertexArrayObject=null),this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,r,i,n){e===this._state.blendColor.r&&r===this._state.blendColor.g&&i===this._state.blendColor.b&&n===this._state.blendColor.a||(this.gl.blendColor(e,r,i,n),this._state.blendColor.r=e,this._state.blendColor.g=r,this._state.blendColor.b=i,this._state.blendColor.a=n,this._stateTracker.invalidateBlending())}setBlendFunction(e,r){e===this._state.blendFunction.srcRGB&&r===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,r,i,n){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===r&&this._state.blendFunction.dstAlpha===n||(this.gl.blendFuncSeparate(e,r,i,n),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=r,this._state.blendFunction.dstAlpha=n,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,r){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===r||(this.gl.blendEquationSeparate(e,r),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=r,this._stateTracker.invalidateBlending())}setColorMask(e,r,i,n){this._state.colorMask.r===e&&this._state.colorMask.g===r&&this._state.colorMask.b===i&&this._state.colorMask.a===n||(this.gl.colorMask(e,r,i,n),this._state.colorMask.r=e,this._state.colorMask.g=r,this._state.colorMask.b=i,this._state.colorMask.a=n,this._stateTracker.invalidateColorWrite())}setClearColor(e,r,i,n){this._state.clearColor.r===e&&this._state.clearColor.g===r&&this._state.clearColor.b===i&&this._state.clearColor.a===n||(this.gl.clearColor(e,r,i,n),this._state.clearColor.r=e,this._state.clearColor.g=r,this._state.clearColor.b=i,this._state.clearColor.a=n)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(e===!0?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(e===!0?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,r){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===r||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=r,this.gl.polygonOffset(e,r),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(e===!0?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,r,i,n){this._state.scissorRect.x===e&&this._state.scissorRect.y===r&&this._state.scissorRect.width===i&&this._state.scissorRect.height===n||(this.gl.scissor(e,r,i,n),this._state.scissorRect.x=e,this._state.scissorRect.y=r,this._state.scissorRect.width=i,this._state.scissorRect.height=n)}setDepthTestEnabled(e){this._state.depthTest!==e&&(e===!0?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,r){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===r||(this.gl.depthRange(e,r),this._state.depthRange.zNear=e,this._state.depthRange.zFar=r,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(e===!0?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,r,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===r&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,r,i),this._state.stencilFunction.face=zm.FRONT_AND_BACK,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=r,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,r,i,n){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===r&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===n||(this.gl.stencilFuncSeparate(e,r,i,n),this._state.stencilFunction.face=e,this._state.stencilFunction.func=r,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=n,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,r,i){this._state.stencilOperation.face===zm.FRONT_AND_BACK&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===r&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,r,i),this._state.stencilOperation.face=zm.FRONT_AND_BACK,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=r,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,r,i,n){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===r&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===n||(this.gl.stencilOpSeparate(e,r,i,n),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=r,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,r=!1){const i=this._state.activeTexture;return e>=0&&(r||e!==this._state.activeTexture)&&(this.gl.activeTexture(zX+e),this._state.activeTexture=e),i}clear(e){e&&this.gl.clear(e)}clearSafe(e,r=255){e&&(e&Qi.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),e&Qi.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),e&Qi.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(r),this.gl.clear(e))}drawArrays(e,r,i){if(_p()&&(this._numOfDrawCalls++,this._numOfTriangles+=YCe(e,i)),this.gl.drawArrays(e,r,i),_p()){const n=Y1e(this);n&&console.error("drawArrays:",n)}}drawElements(e,r,i,n){if(_p()&&(this._numOfDrawCalls++,this._numOfTriangles+=YCe(e,r)),this.gl.drawElements(e,r,i,n),_p()){const s=Y1e(this);if(s){const o=this.getBoundVAO(),a=o==null?void 0:o.indexBuffer,l=o==null?void 0:o.vertexBuffers,c={indexBuffer:a,vertexBuffers:l},u={mode:e,count:r,type:i,offset:n},h=(a==null?void 0:a.size)??0,f=n+r,m=h<f?`. Buffer is too small. Attempted to draw index ${f} of ${h}`:"";console.error(`drawElements: ${s}${m}`,{args:u,vao:c})}}}logInfo(){_p()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){_p()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,r,i,n){i=Math.max(Math.round(i),1),n=Math.max(Math.round(n),1);const s=this._state.viewport;s.x===e&&s.y===r&&s.width===i&&s.height===n||(s.x=e,s.y=r,s.width=i,s.height=n,this.gl.viewport(e,r,i,n))}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){var r;this._state.program!==e&&((r=this._state.program)==null||r.stop(),this._state.program=e,this.gl.useProgram((e==null?void 0:e.glName)??null))}bindTexture(e,r,i=!1){(r>=this.parameters.maxTextureImageUnits||r<0)&&console.error("Input texture unit is out of range of available units!");const n=this._state.textureUnitMap[r];return e==null||e.glName==null?(n!=null&&(this.setActiveTexture(r,i),this.gl.bindTexture(n.descriptor.target,null)),this._state.textureUnitMap[r]=null,n):i||n!==e?(this.setActiveTexture(r,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[r]=e,n):(e.isDirty&&(this.setActiveTexture(r,i),e.applyChanges()),n)}unbindTexture(e){if(e!=null)for(let r=0;r<this.parameters.maxTextureImageUnits;r++)this._state.textureUnitMap[r]===e&&(this.bindTexture(null,r),this._state.textureUnitMap[r]=null)}bindFramebuffer(e,r=!1){if(r||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(e==null)return this.gl.bindFramebuffer(Ea.FRAMEBUFFER,null),this._state.readFramebuffer=null,void(this._state.drawFramebuffer=null);e.initializeAndBind(Ea.FRAMEBUFFER),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,r,i=!1){const n=r===Ea.READ_FRAMEBUFFER,s=n?this._state.readFramebuffer:this._state.drawFramebuffer;(i||s!==e)&&(e==null?this.gl.bindFramebuffer(r,null):e.initializeAndBind(r),n?this._state.readFramebuffer=e??null:this._state.drawFramebuffer=e??null)}blitFramebuffer(e,r,i=0,n=0,s=e.width,o=e.height,a=0,l=0,c=r.width,u=r.height,h=Qi.COLOR_BUFFER_BIT,f=Kt.NEAREST){this.bindFramebufferSeparate(e,Ea.READ_FRAMEBUFFER),this.bindFramebufferSeparate(r,Ea.DRAW_FRAMEBUFFER),this.gl.blitFramebuffer(i,n,s,o,a,l,c,u,h,f)}bindBuffer(e,r){if(e)switch(r??(r=e.bufferType),r){case Wt.ARRAY_BUFFER:this._state.vertexBuffer=Ru(this.gl,e,r,this._state.vertexBuffer);break;case Wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Ru(this.gl,e,r,this._state.indexBuffer);break;case Wt.UNIFORM_BUFFER:this._state.uniformBuffer=Ru(this.gl,e,r,this._state.uniformBuffer);break;case Wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Ru(this.gl,e,r,this._state.pixelPackBuffer);break;case Wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Ru(this.gl,e,r,this._state.pixelUnpackBuffer);break;case Wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Ru(this.gl,e,r,this._state.copyReadBuffer);break;case Wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Ru(this.gl,e,r,this._state.copyWriteBuffer)}}bindRenderbuffer(e){const r=this.gl;e||(r.bindRenderbuffer(r.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(r.bindRenderbuffer(r.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,r){if(r>=this.parameters.maxUniformBufferBindings||r<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=this._state.uniformBufferBindingPoints;let n=i[r];return n==null&&(n={buffer:null,offset:0,size:0},i[r]=n),n}bindBufferBase(e,r,i){const n=this._getBufferBinding(e,r);n!=null&&(n.buffer===i&&n.offset===0&&n.size===0||(this.gl.bindBufferBase(e,r,i?i.glName:null),n.buffer=i,n.offset=0,n.size=0))}bindBufferRange(e,r,i,n,s){const o=this._getBufferBinding(e,r);if(o!=null&&!(o.buffer===i&&o.offset===n&&o.size===s)){if(n%this._parameters.uniformBufferOffsetAlignment!=0)return void console.error("Uniform buffer binding offset is not a multiple of the context offset alignment");this.gl.bindBufferRange(e,r,i.glName,n,s),o.buffer=i,o.offset=n,o.size=s}}bindUBO(e,r,i,n){r!=null?(_p()&&(n??r.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),r.initialize(),i!==void 0&&n!==void 0?this.bindBufferRange(Wt.UNIFORM_BUFFER,e,r.buffer,i,n):this.bindBufferBase(Wt.UNIFORM_BUFFER,e,r.buffer)):this.bindBufferBase(Wt.UNIFORM_BUFFER,e,null)}unbindUBO(e){for(let r=0,i=this._state.uniformBufferBindingPoints.length;r<i;r++){const n=this._state.uniformBufferBindingPoints[r];n!=null&&n.buffer===e.buffer&&this.bindBufferBase(Wt.UNIFORM_BUFFER,r,null)}}unbindBuffer(e){switch(e){case Wt.ARRAY_BUFFER:this._state.vertexBuffer=Ru(this.gl,null,e,this._state.vertexBuffer);break;case Wt.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=Ru(this.gl,null,e,this._state.indexBuffer);break;case Wt.UNIFORM_BUFFER:this._state.uniformBuffer=Ru(this.gl,null,e,this._state.uniformBuffer);break;case Wt.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=Ru(this.gl,null,e,this._state.pixelPackBuffer);break;case Wt.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=Ru(this.gl,null,e,this._state.pixelUnpackBuffer);break;case Wt.COPY_READ_BUFFER:this._state.copyReadBuffer=Ru(this.gl,null,e,this._state.copyReadBuffer);break;case Wt.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=Ru(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e=null){e!=null?this._state.vertexArrayObject!==e&&(e.bind(),this._state.vertexArrayObject=e):this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null)}async clientWaitAsync(e=10){const r=this.gl,i=r.fenceSync(Mre.SYNC_GPU_COMMANDS_COMPLETE,0);if(!i)throw new Error("Client wait failed, could not create sync object");let n;this.instanceCounter.increment(ko.Sync,i),r.flush();do await gN(e),n=r.clientWaitSync(i,0,0);while(n===EB.TIMEOUT_EXPIRED);if(this.instanceCounter.decrement(ko.Sync,i),r.deleteSync(i),n===EB.WAIT_FAILED)throw new Error("Client wait failed")}getBoundFramebufferObject(e=Ea.FRAMEBUFFER){return e===Ea.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(Wt.ARRAY_BUFFER),this.unbindBuffer(Wt.ELEMENT_ARRAY_BUFFER),this.type===Mr.WEBGL2&&(this.unbindBuffer(Wt.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(Wt.PIXEL_PACK_BUFFER),this.unbindBuffer(Wt.PIXEL_UNPACK_BUFFER),this.unbindBuffer(Wt.COPY_READ_BUFFER),this.unbindBuffer(Wt.COPY_WRITE_BUFFER));for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(De.ONE,De.ZERO),this.setBlendEquation(h0.ADD),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(zm.BACK),this.setFrontFace(jP.CCW),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(Oi.LESS),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(Oi.ALWAYS,0,0),this.setStencilOp(cs.KEEP,cs.KEEP,cs.KEEP),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){var s,o,a;const e=this.capabilities.vao;e&&e.bindVertexArray(null);const{gl:r,gl2:i}=this;for(let l=0;l<this.parameters.maxVertexAttributes;l++)r.disableVertexAttribArray(l);if(this._state.vertexBuffer?r.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):r.bindBuffer(Wt.ARRAY_BUFFER,null),this._state.indexBuffer?r.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):r.bindBuffer(Wt.ELEMENT_ARRAY_BUFFER,null),i!=null){this._state.uniformBuffer?i.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):i.bindBuffer(Wt.UNIFORM_BUFFER,null);for(let l=0;l<this._parameters.maxUniformBufferBindings;l++){const c=this._state.uniformBufferBindingPoints[l];if(c!=null){const{buffer:u,offset:h,size:f}=c;u!==null?h===0&&f===0?i.bindBufferBase(Wt.UNIFORM_BUFFER,l,u.glName):i.bindBufferRange(Wt.UNIFORM_BUFFER,l,u.glName,h,f):i.bindBufferBase(Wt.UNIFORM_BUFFER,l,null)}}this._state.pixelPackBuffer?i.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):i.bindBuffer(Wt.PIXEL_PACK_BUFFER,null),this._state.pixelUnpackBuffer?i.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):i.bindBuffer(Wt.PIXEL_UNPACK_BUFFER,null),this._state.copyReadBuffer?i.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):i.bindBuffer(Wt.COPY_READ_BUFFER,null),this._state.copyWriteBuffer?i.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):i.bindBuffer(Wt.COPY_WRITE_BUFFER,null),i.bindFramebuffer(Ea.READ_FRAMEBUFFER,null),i.readBuffer(i.BACK),this._state.readFramebuffer&&(i.bindFramebuffer(Ea.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),i.readBuffer(Yd.COLOR_ATTACHMENT0)),i.bindFramebuffer(Ea.DRAW_FRAMEBUFFER,((s=this._state.drawFramebuffer)==null?void 0:s.glName)??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,r.bindFramebuffer(Ea.FRAMEBUFFER,((o=this._state.drawFramebuffer)==null?void 0:o.glName)??null);if(e&&this._state.vertexArrayObject){const l=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(l)}r.useProgram(((a=this._state.program)==null?void 0:a.glName)??null),r.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),r.bindRenderbuffer(r.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null),this._state.blend===!0?r.enable(this.gl.BLEND):r.disable(this.gl.BLEND),r.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),r.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),r.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),r.clearDepth(this._state.clearDepth),r.clearStencil(this._state.clearStencil),r.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),r.cullFace(this._state.cullFace),r.depthFunc(this._state.depthFunction),r.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),this._state.depthTest===!0?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST),r.depthMask(this._state.depthWrite),r.frontFace(this._state.frontFace),r.lineWidth(1),this._state.faceCulling===!0?r.enable(r.CULL_FACE):r.disable(r.CULL_FACE),r.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),this._state.polygonOffsetFill===!0?r.enable(r.POLYGON_OFFSET_FILL):r.disable(r.POLYGON_OFFSET_FILL),r.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),this._state.scissorTest===!0?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),r.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),r.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),this._state.stencilTest===!0?r.enable(r.STENCIL_TEST):r.disable(r.STENCIL_TEST),r.stencilMask(this._state.stencilWriteMask);for(let l=0;l<this.parameters.maxTextureImageUnits;l++){r.activeTexture(zX+l),r.bindTexture(qn.TEXTURE_2D,null),r.bindTexture(qn.TEXTURE_CUBE_MAP,null),this.type===Mr.WEBGL2&&(r.bindTexture(qn.TEXTURE_3D,null),r.bindTexture(qn.TEXTURE_2D_ARRAY,null));const c=this._state.textureUnitMap[l];c!=null&&r.bindTexture(c.descriptor.target,c.glName)}r.activeTexture(zX+this._state.activeTexture);const n=this._state.viewport;r.viewport(n.x,n.y,n.width,n.height),this.resetInfo()}_loadExtensions(){this.type===Mr.WEBGL1&&this.gl.getExtension("OES_element_index_uint"),this.gl.getExtension("KHR_parallel_shader_compile")}};function Ru(t,e,r,i){return e?i!==e&&t.bindBuffer(r,e.glName):t.bindBuffer(r,null),e}function YCe(t,e){switch(t){case Zt.POINTS:return 2*e;case Zt.TRIANGLES:return e/3;case Zt.TRIANGLE_STRIP:case Zt.TRIANGLE_FAN:return e-2;default:return 0}}let YXt=class extends XXt{constructor(e,r,i){super(e,r),this.newCache=i,this._refCount=1,this._appleAmdDriverHelper=null}destroy(){--this._refCount>0||this.dispose()}ref(){++this._refCount}dispose(){var e;super.dispose(),(e=this._appleAmdDriverHelper)==null||e.dispose()}bindTechnique(e,r,i,n){return this.useProgram(e.program),e.bindPipelineState(this,i==null?void 0:i.slot,!!n),e.program.bindPass(r,i),e.program}get appleAmdDriverHelper(){return this.driverTest.drawArraysRequiresIndicesTypeReset.result?(this._appleAmdDriverHelper=this._appleAmdDriverHelper??new K7e(this),this._appleAmdDriverHelper):null}get test(){return this.programCache.test}},tO=class extends Ce{constructor(e,r,i){super({}),this._stage=e,this._techniqueRepository=r,this._rctx=i,this._textures=new Map,this._loadingCount=0,this._frameUpdates=new Map,this.events=new pn,this._frameTask=e.view.resourceController.scheduler.registerTask(Vt.TEXTURE_UNLOAD)}normalizeCtorArgs(){return{}}destroy(){this._frameTask.remove(),this._stage.forEachOfType(Wn.Texture,e=>e.unload())}get updating(){return this._loadingCount>0||this._frameTask.updating}get textureTechnique(){return this._textureTechnique==null&&(this._textureTechnique=this._techniqueRepository.acquire(vpe,new _pe)),this._textureTechnique}acquire(e){const r=this._textures.get(e);return r?(r.ref(),r.loadingPromise??r):this._createNewRef(e)}update(){let e=!1;this._frameUpdates.forEach(r=>{const i=r.texture.frameUpdate(r.previousToken);i>=0&&i!==r.previousToken&&(r.previousToken=i,e=!0)}),e&&this.events.emit("changed",is.BACKGROUND)}_createNewRef(e){const r=this._stage.getObject(e);if(r==null)return It(r!==void 0),null;const i=r.events.on("unloaded",()=>{i.remove(),this._onTextureUnloaded(e)}),n=new ZXt(e,()=>{this._frameTask.schedule(()=>{n.isUnreferenced&&r.unload()})});return this._textures.set(e,n),n.ref(),r.glTexture!=null?(this._updateGLTexture(n,r.glTexture),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n):(this._loadingCount++,n.loadingPromise=this._stage.schedule(()=>{const s=r.load(this._rctx),o=l=>(this._loadingCount--,n.loadingPromise=null,this._updateGLTexture(n,l),r.requiresFrameUpdates&&this._frameUpdates.set(e,{texture:r,previousToken:-1}),n),a=l=>(this._loadingCount--,n.loadingPromise=null,Yn(l)||re.getLogger(this).error(l),null);return Dh(s)?s.then(o,a):o(s)}),n.loadingPromise)}_updateGLTexture(e,r){e.glTexture=r,this.events.emit("changed",is.UPDATE)}_onTextureUnloaded(e){this._textures.delete(e),this._frameUpdates.delete(e)}};d([p()],tO.prototype,"_loadingCount",void 0),d([p()],tO.prototype,"_frameTask",void 0),d([p()],tO.prototype,"updating",null),tO=d([I("esri.views.3d.webgl-engine.lib.TextureRepository")],tO);let ZXt=class{constructor(e,r){this.id=e,this._release=r,this._refCount=0}get isUnreferenced(){return this._refCount===0}ref(){++this._refCount}release(){--this._refCount,this._refCount>0||(this._refCount!==0?(re.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),this._refCount=0):this._release())}};function JXt(t,e){return new V9e(r=>YNt(r,t),r=>r,e)}let pL=class extends Ce{constructor(){super(...arguments),this._passParameters=new KXt,this._loading=0}get passParameters(){return this._passParameters}destroy(){this._passParameters.waveNormal=pt(this._passParameters.waveNormal),this._passParameters.wavePertubation=pt(this._passParameters.wavePertubation)}get updating(){return this._loading>0}ensureResources(e){if(this._loading>0)return i_.LOADING;if(this._passParameters.waveNormal!=null&&this._passParameters.wavePertubation!=null)return i_.LOADED;const r=new Vr;return r.samplingMode=Kt.LINEAR_MIPMAP_LINEAR,r.hasMipmap=!0,r.maxAnisotropy=8,++this._loading,z_(fi("esri/images/materials/water/normals.jpg")).then(i=>this._passParameters.waveNormal=new Jt(e,{...r,width:i.width,height:i.height},i)).catch(i=>re.getLogger(this).error("Failed to load water material normal texture.",i)).finally(()=>--this._loading),++this._loading,z_(fi("esri/images/materials/water/perturbation.jpg")).then(i=>this._passParameters.wavePertubation=new Jt(e,{...r,width:i.width,height:i.height},i)).catch(i=>re.getLogger(this).error("Failed to load water material pertubation texture.",i)).finally(()=>--this._loading),i_.LOADING}};d([p()],pL.prototype,"_loading",void 0),d([p({type:Boolean,readOnly:!0})],pL.prototype,"updating",null),pL=d([I("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],pL);let KXt=class extends Ai{};const ZCe=2048,QXt=1.5,eYt=8;function tYt(t,e){const{format:r,quality:i,rotation:n,disableDecorations:s}=t||{},o=gfe(t,e.padding),a=lYt(t,{width:e.width-o.left-o.right,height:e.height-o.top-o.bottom}),{width:l,height:c}=aYt(t,a),u=dYt(r),h=gYt[u];return{format:u,quality:Te(i??h,0,100),area:a,width:l,height:c,rotation:n,disableDecorations:!!s,ignoreBackground:!(!t||!t.ignoreBackground),ignorePadding:!(!t||!t.ignorePadding)}}function rYt(t,e){const r=tYt(t,e),i=r.area,n=r.width/i.width,s=gfe(r,e.padding),o=s.left+s.right,a=s.top+s.bottom,l=e.width-o,c=e.height-a,u=Math.floor(l*n+o),h=Math.floor(c*n+a),f=t&&t.layers?t.layers:[],m=r.ignoreBackground,g=r.ignorePadding;return{framebufferWidth:u,framebufferHeight:h,region:{x:Math.floor(i.x*n)+s.left,y:Math.floor(i.y*n)+s.top,width:r.width,height:r.height},format:r.format,quality:r.quality,rotation:r.rotation,pixelRatio:n,layers:f,disableDecorations:r.disableDecorations,ignoreBackground:m,ignorePadding:g,objectAndLayerIdColor:!1}}function uJ(t,e,r){const{ctx:i,canvas:n}=iHe(t,r),s=i.getImageData(0,0,t.width,t.height),o=nYt(n,e);return nHe(n),{dataUrl:o,data:s}}function dJ(t,e){const{ctx:r,canvas:i}=iHe(t,e),n=r.getImageData(0,0,t.width,t.height);return nHe(i),n}function iHe(t,e){const r=iYt();e.premultipliedAlpha&&pYt(t),r.width=t.width,r.height=t.height;const i=r.getContext("2d",{willReadFrequently:!0});return i.putImageData(t,0,0),e.flipY&&hYt(i),{ctx:i,canvas:r}}function nHe(t){t.width=0,t.height=0}function iYt(){return hJ==null&&(hJ=document.createElement("canvas")),hJ}let hJ=null;function nYt(t,e){const r=fYt[e.format],i=e.quality/100;return t.toDataURL(r,i)}function sYt(t,e,r,i=0,n=0,s=t.width-i,o=t.height-n,a=!1){const{data:l}=t,{width:c,height:u,data:h}=e,f=s/c,m=o/u,g=Math.ceil(f/2),y=Math.ceil(m/2),_=t.width;for(let b=0;b<u;b++)for(let w=0;w<c;w++){const x=4*(w+(a?u-b-1:b)*c);let S=0,C=0,E=0,R=0,P=0,D=0;const L=(b+.5)*m;for(let k=Math.floor(b*m);k<(b+1)*m;k++){const V=Math.abs(L-(k+.5))/y,W=(w+.5)*f,G=V*V;for(let B=Math.floor(w*f);B<(w+1)*f;B++){const Z=Math.abs(W-(B+.5))/g,M=Math.sqrt(G+Z*Z);if(M>=1)continue;let $=2*M*M*M-3*M*M+1;const N=4*(i+B+(n+k)*_);D+=$*l[N+3],C+=$,!r&&l[N+3]<255&&($=$*l[N+3]/255),E+=$*l[N],R+=$*l[N+1],P+=$*l[N+2],S+=$}}h[x]=E/S,h[x+1]=R/S,h[x+2]=P/S,h[x+3]=D/C}return e}function oYt(t,e,r){if(!e)return t;const{framebufferWidth:i,framebufferHeight:n,pixelRatio:s,region:o}=t,a=gfe(t,r),l=a.left+a.right,c=a.top+a.bottom,u=i-l,h=n-c,f=Math.min(eYt,Math.min((ZCe-l)/u,(ZCe-c)/h));return f<QXt?t:{...t,framebufferWidth:Math.round(u*f)+l,framebufferHeight:Math.round(h*f)+c,pixelRatio:s*f,resample:{region:{x:Math.round((o.x-a.left)*f)+a.left,y:Math.round((o.y-a.top)*f)+a.top,width:Math.round(o.width*f),height:Math.round(o.height*f)},width:i,height:n}}}function aYt(t,e){if(!t)return e;const r=t.width,i=t.height;if(r!=null&&i!=null)return{width:Math.floor(r),height:Math.floor(i)};if(r==null&&i==null)return e;const n=e.width/e.height;return i==null?{width:Math.floor(r),height:Math.floor(r/n)}:{width:Math.floor(i*n),height:Math.floor(i)}}function lYt(t,e){const r={x:0,y:0,width:e.width,height:e.height};if(t&&t.area){t.area.x!=null&&(r.x=Math.floor(t.area.x)),t.area.y!=null&&(r.y=Math.floor(t.area.y));const i=t.area.width!=null?Math.floor(t.area.width):null,n=t.area.height!=null?Math.floor(t.area.height):null;if(r.width=e.width-r.x,r.height=e.height-r.y,i!=null&&n!=null)r.width=Math.min(r.width,i),r.height=Math.min(r.height,n);else if(i==null&&n!=null){const s=Math.min(r.width,i);r.height=s/r.width*r.height,r.width=s}else if(i!=null&&n==null){const s=Math.min(r.height,n);r.width=s/r.height*r.width,r.height=s}}return cYt(uYt(r,t),e)}function cYt(t,e){const r=Math.floor(Math.max(t.x,0)),i=Math.floor(Math.max(t.y,0)),n={x:r,y:i,width:Math.floor(Math.min(t.width,e.width-r)),height:Math.floor(Math.min(t.height,e.height-i))},s=n.width/n.height,o=t.width/t.height;if(o===s)return n;if(o>s){const c=Math.floor(n.width/o),u=n.height-c;return{x:n.x,y:Math.floor(n.y+u/2),width:n.width,height:c}}const a=Math.floor(n.height*o),l=n.width-a;return{x:Math.floor(n.x+l/2),y:n.y,width:a,height:n.height}}function uYt(t,e){if(!e||e.width==null||e.height==null)return t;const r=e.width/e.height,i=t.width/t.height;if(i===r)return t;if(i<r){const s=Math.floor(t.height*r);return t.x-=(s-t.width)/2,t.width=s,t}const n=Math.floor(t.width/r);return t.y-=(n-t.height)/2,t.height=n,t}function gfe(t,e){return!e||t&&t.ignorePadding?yYt:e}function dYt(t){switch(t){case"png":case"jpg":case"jpeg":return t;default:return mYt}}function hYt(t){t.save(),t.globalCompositeOperation="copy",t.scale(1,-1),t.translate(0,-t.canvas.height),t.drawImage(t.canvas,0,0),t.restore()}function pYt(t){const e=t.data,r=e.length;for(let i=0;i<r;i+=4){const n=e[i+3];if(n!==255&&n>0){const s=255/n;e[i]=e[i]*s,e[i+1]=e[i+1]*s,e[i+2]=e[i+2]*s}}}const fYt={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},JCe=98,mYt="png",gYt={png:100,jpg:JCe,jpeg:JCe},yYt={top:0,right:0,bottom:0,left:0};let vYt=class{constructor(e,r){this.parameters=e,this.frameHasDecorations=r}},_Yt=class{constructor(e,r,i,n){this._rctx=e,this._renderFunctions=r,this._forceCameraHook=i,this._disposeOffscreenBuffers=n,this.supersample=!0,this._screenshotQueue=new Array}destroy(){this._rctx=null}async takeScreenshot(e){await this._renderFunctions.prepareOverlay(),this._renderFunctions.requestRenderScene(is.BACKGROUND);const r=Da();return this._screenshotQueue.push({settings:e,resolver:r}),r.promise}update(e,r){for(const i of this._screenshotQueue){if(this._rctx==null){i.resolver.reject();continue}const n={...i.settings,pixelRatio:i.settings.pixelRatio*e.parameters.camera.pixelRatio},s=this._renderScreenshot(e,n,r);i.resolver(s)}this._screenshotQueue.length=0}_renderScreenshotOverlay(e,r,i){e.width=r.width,e.height=r.height;const n=e.getContext("2d"),s=i.pixelRatio;return n.save(),n.translate(0,r.height),n.scale(1,-1),i.region&&n.translate(-i.region.x,-i.region.y),n.scale(s,s),r=this._renderFunctions.renderOverlay(e,r),n.restore(),r}_readbackScreenshot(e,r){return e.resample?this._readbackScreenshotResampled({...e,resample:e.resample},r):this._readbackScreenshotImmediate(e,r)}_readbackScreenshotResampled(e,r){const{framebufferWidth:i,framebufferHeight:n,region:s,resample:o}=e,a=this._ensureScreenshotEncodeCanvas();let l=cZ(i,n,a);this._rctx.gl.readPixels(0,0,i,n,Yt.RGBA,$t.UNSIGNED_BYTE,new Uint8Array(l.data.buffer)),r(),l=this._renderScreenshotOverlay(a,l,{...e,region:void 0});const c=cZ(s.width,s.height,a);return sYt(l,c,!0,o.region.x,n-(o.region.y+o.region.height),o.region.width,o.region.height)}_readbackScreenshotImmediate(e,r){const{framebufferHeight:i,region:n}=e,s=this._ensureScreenshotEncodeCanvas(),o=cZ(n.width,n.height,s);return this._rctx.gl.readPixels(n.x,i-(n.y+n.height),n.width,n.height,Yt.RGBA,$t.UNSIGNED_BYTE,new Uint8Array(o.data.buffer)),r(),this._renderScreenshotOverlay(s,o,e)}_renderScreenshot(e,r,i){let n=null;const s=e.parameters.camera,o={width:r.framebufferWidth,height:r.framebufferHeight};l2(o,Math.min(this._rctx.parameters.maxTextureSize,this._rctx.parameters.maxRenderbufferSize));let a=!1;const l=r.disableDecorations&&e.frameHasDecorations,c=o.width!==s.fullWidth||o.height!==s.fullHeight,u=r.ignorePadding&&s.pixelRatio!==r.pixelRatio,h=c||l||u||r.objectAndLayerIdColor,f=r.objectAndLayerIdColor?new wo(this._rctx,new Vr(o.width,o.height),new RB(Hs.DEPTH_STENCIL,o.width,o.height)):null;if(h){const _=s.clone();if(r.ignorePadding){const C=mF(_.padding);for(let E=0;E<4;E++)C[E]=Math.round(C[E]/_.pixelRatio*r.pixelRatio);_.padding=C}_.fullWidth=o.width,_.fullHeight=o.height,_.pixelRatio=r.pixelRatio;const b=s.fovX-_.fovX,w=s.fovY-_.fovY;b<0&&b<w?_.fovX=s.fovX:w<0&&w<b&&(_.fovY=s.fovY);const x={camera:_,contentCamera:_,mode:ai.IDLE,alignPixelEnabled:!0,contentPixelRatio:_.pixelRatio};this._forceCameraHook(x),a=!0,n=new wo(this._rctx,new Vr(o.width,o.height),new RB(Hs.DEPTH_STENCIL,o.width,o.height));const S=r.disableDecorations?uE.OFF:uE.ON;this._renderFunctions.renderScene(n,f,x,S,i),this._disposeOffscreenBuffers()}const m=()=>{this._rctx.bindFramebuffer(null),pt(n)},g=this._readbackScreenshot(r,m);m();let y=null;if(r.objectAndLayerIdColor){const _=()=>{this._rctx.bindFramebuffer(null),pt(f)};this._rctx.bindFramebuffer(f),y=this._readbackScreenshot(r,_),this._rctx.bindFramebuffer(null),_()}if(h&&!this._rctx.contextAttributes.alpha)for(let _=3;_<g.data.length;_+=4)g.data[_]=255;if(y&&!this._rctx.contextAttributes.alpha)for(let _=3;_<y.data.length;_+=4)y.data[_]=255;return a&&this._forceCameraHook(e.parameters),[g,y]}_ensureScreenshotEncodeCanvas(){return this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas")),this._screenshotEncodeCanvas}},Yo=class extends Ce{constructor(e){super({}),this.events=new pn,this.waterTextureRepository=new pL,this._magnifierHelper=new eO,this.objectAndLayerIdRenderHelper=he("enable-feature:objectAndLayerId-rendering")?new bqt:null,this._needsUpdate=!0,this._needsRender=!0,this._idleSuspend=!0,this._needsWaterReflectionUpdate=!1,this._lastAnimationUpdate=0,this._container=e.container,this._viewingMode=e.viewingMode,this._initializeContext(e),this.addHandles([pe(()=>{var n;return(n=this.waterTextureRepository)==null?void 0:n.updating},()=>this.requestRender(),_r),pe(()=>e.view.qualityProfile,n=>{var s;return(s=this.renderer)==null?void 0:s.updateRenderFeature(n)},Bi),this._magnifierHelper.events.on("request-render",()=>this.requestRender())]);const{memoryController:r}=e.view.resourceController;this.stippleTextureRepository=UNt(this._rctx,r),this.markerTextureRepository=JXt(this._rctx,r),this._shaderTechniqueRepository=new D9e({rctx:this._rctx,viewingMode:e.viewingMode,stippleTextureRepository:this.stippleTextureRepository,waterTextureRepository:this.waterTextureRepository,markerTextureRepository:this.markerTextureRepository}),this._textureRepository=new tO(e,this._shaderTechniqueRepository,this._rctx),this.addHandles(this._textureRepository.events.on("changed",n=>this.requestRender(n))),this._materialRepository=new N9e(this._textureRepository,this._shaderTechniqueRepository,()=>this.requestRender(),()=>this.requestRender()),this._compositingHelper=new KHt(this._rctx,this._shaderTechniqueRepository),this.renderer=new Iu(e,this._materialRepository,this._textureRepository,this._shaderTechniqueRepository,this._rctx,this._compositingHelper,this._magnifierHelper,n=>this.requestRender(n));const i={renderScene:(n,s,o,a,l)=>this.renderer.render(n,s,o,a,l),requestRenderScene:n=>this.requestRender(n),prepareOverlay:()=>e.options.screenshot.prepareOverlay(),renderOverlay:(n,s)=>e.options.screenshot.renderOverlay(n,s)};this._screenshotManager=new _Yt(this._rctx,i,n=>this.events.emit("force-camera-for-screenshot",n),()=>this.renderer.disposeOffscreenBuffers()),this._registerFrameTask(e)}normalizeCtorArgs(){return{}}destroy(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas),this._frameTask=yi(this._frameTask),this._shaderTechniqueRepository=qe(this._shaderTechniqueRepository)}requestRender(e=is.UPDATE){this._needsRender=!0,e===is.UPDATE&&(this._needsUpdate=!0)}get updating(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}get textureRepository(){return this._textureRepository}get compositingHelper(){return this._compositingHelper}set magnifier(e){this._magnifierHelper.magnifier=e}setIdleSuspend(e){this._idleSuspend!==e&&(this._idleSuspend=e,this.requestRender())}get renderingContext(){return this._rctx}get capabilities(){return this._rctx.capabilities}get canvas(){return this._canvas}takeScreenshot(e){return this._screenshotManager.takeScreenshot(e).then(r=>r[0])}takeScreenshotWithOID(e){return e.objectAndLayerIdColor=!0,this._screenshotManager.takeScreenshot(e)}getAlpha(){return!!this._rctx.contextAttributes.alpha}getMinimalDepthForArea(e,r,i,n,s,o=s){const a=n.constrainWindowSize(r,i,s*n.pixelRatio,o*n.pixelRatio),l=this._ensureDepthBuffer(a);this.renderer.readDepthPixels(n,a,l);let c=Number.MAX_VALUE;for(let u=0;u<a[2]*a[3];u++){const h=iqt(4*u,l,n.nearFar);c>h&&h!==n.nearFar[0]&&h!==n.nearFar[1]&&(c=h)}if(e!=null){const u=e.pickDepth(r*n.pixelRatio,i*n.pixelRatio,n);u!=null&&c>u&&u!==n.nearFar[0]&&u!==n.nearFar[1]&&(c=u)}return c===Number.MAX_VALUE?void 0:c}_ensureDepthBuffer(e){const r=4*e[2]*e[3];return(this._tmpDepthBuffer==null||this._tmpDepthBuffer.byteLength<r)&&(this._tmpDepthBuffer=new Uint8Array(r)),this._tmpDepthBuffer}async reloadShaders(){Wje(),await this._shaderTechniqueRepository.reloadAll(),this.requestRender()}_registerFrameTask(e){const r=e.view.state;let i=!1,n=is.BACKGROUND,s=!1;const o={preRender:({time:a})=>{i=this.updating,n=this._needsUpdate?is.UPDATE:is.BACKGROUND,e.commitSyncLayers();const l=a-this._lastAnimationUpdate;if(l>this.renderer.animationTimestep||r.forcedAnimationTime!=null||i||this._needsRender){const c=l/this.renderer.animationTimeDilation,u=new R8e(r.camera,c,r.forcedAnimationTime);this.renderer.updateAnimation(u)&&this.requestRender(is.BACKGROUND),this._lastAnimationUpdate=a}},render:({time:a})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&r.camera.fullWidth>0&&r.camera.fullHeight>0){const l=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsRender=!1,this._needsUpdate=!1,this._needsWaterReflectionUpdate=!1,this.renderer.render(null,null,r,uE.ON,a),s=!0,l&&this.renderer.hasReflections&&(this.requestRender(is.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:a})=>{const l=new vYt(r,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update(),this._screenshotManager.update(l,a)},finish:()=>{s&&(this.renderer.finish(r.mode===ai.IDLE?n:is.UPDATE),s=!1)}};this._frameTask=hP(o)}_initializeContext(e){const r=e.options;this._canvas=r.canvas,this._canvas||(this._canvas=document.createElement("canvas")),this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const i={alpha:r.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:r.stencil??!0,powerPreference:"high-performance",preserveDrawingBuffer:r.preserveDrawingBuffer??!1},n=fRt("3d",this._canvas,i);n!=null?(this._rctx=this._newRenderingContext(n,e),this._loadShaderOnlyExtensions(),!r.alpha&&this._rctx.contextAttributes.alpha&&re.getLogger(this).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&he("safari")>=11&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas)):re.getLogger(this).error("A WebGL2 context could not be created.")}_newRenderingContext(e,r){const i={disabledExtensions:r.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:r.options.debugWebGLExtensions||{},maxAnisotropy:8},n=(s,o)=>r.view.resourceController.memoryController.newCache(s,o);return new YXt(e,i,n)}_loadShaderOnlyExtensions(){this._rctx.capabilities.enable("textureFloat")}getObjectAndLayerIdColor(e){return this.objectAndLayerIdRenderHelper!=null?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(e):null}get componentObjectCollection(){return this._componentObjectCollection==null&&(this._componentObjectCollection=new UHt(this.renderer.renderPassManager,this._viewingMode)),this._componentObjectCollection}set componentObjectCollection(e){this._componentObjectCollection=e}};d([p({type:Boolean,readOnly:!0})],Yo.prototype,"updating",null),d([p({autoDestroy:!0})],Yo.prototype,"_rctx",void 0),d([p({autoDestroy:!0})],Yo.prototype,"_container",void 0),d([p({autoDestroy:!0})],Yo.prototype,"_canvas",void 0),d([p({autoDestroy:!0})],Yo.prototype,"stippleTextureRepository",void 0),d([p({autoDestroy:!0})],Yo.prototype,"markerTextureRepository",void 0),d([p({autoDestroy:!0})],Yo.prototype,"waterTextureRepository",void 0),d([p({autoDestroy:!0})],Yo.prototype,"_magnifierHelper",void 0),d([p({readOnly:!0})],Yo.prototype,"objectAndLayerIdRenderHelper",void 0),d([p({autoDestroy:!0})],Yo.prototype,"_textureRepository",void 0),d([p({autoDestroy:!0})],Yo.prototype,"_compositingHelper",void 0),d([p({autoDestroy:!0,readOnly:!0})],Yo.prototype,"renderer",void 0),d([p({autoDestroy:!0})],Yo.prototype,"_screenshotManager",void 0),d([p()],Yo.prototype,"componentObjectCollection",null),d([p({autoDestroy:!0})],Yo.prototype,"_componentObjectCollection",void 0),d([p()],Yo.prototype,"_needsUpdate",void 0),d([p()],Yo.prototype,"_needsWaterReflectionUpdate",void 0),Yo=d([I("esri.views.3d.webgl-engine.parts.RenderView")],Yo);let jd=class extends Ce{constructor(e){super(e),this._model=new Wz,this._layers=new dr,this._asyncChangeSet=new cne,this._syncChangeSet=new cne,this._layerSyncSet=new Set}initialize(){this._set("renderView",new Yo(this)),this._frameTask=this.view.resourceController.scheduler.registerTask(Vt.STAGE,this),this.addHandles(this._frameTask)}destroy(){this.removeAllHandles()}get viewingMode(){return this.view.state.viewingMode}get updating(){return this.running||this.renderView.updating||this._frameTask.updating}get renderer(){var e;return(e=this.renderView)==null?void 0:e.renderer}add(e){this._model.add(e),KB(e)&&this._addLayer(e),this.renderView.requestRender()}remove(e){e==null||this.destroyed||(this._model.remove(e),KB(e)&&this._removeLayer(e),this.renderView.requestRender())}addMany(e){e!=null&&(this._model.addMany(e),this.renderView.requestRender())}removeMany(e){var r,i;e!=null&&((r=this._model)==null||r.removeMany(e),(i=this.renderView)==null||i.requestRender())}async load(e,r){e!=null&&(Array.isArray(e)||(e=[e]),await Promise.all(e.filter(i=>i.glTexture==null).map(i=>this.schedule(()=>this._model.has(i)?i.load(this.renderView.renderingContext):null),r)))}loadImmediate(e){return e.load(this.renderView.renderingContext)}forEachOfType(e,r){this._model.forEachOfType(e,r)}handleEvent(e,r){this.destroyed||(this._model.dirtySet[e](r),this.renderView.requestRender())}get running(){return this._model.dirtySet.dirty||!this._asyncChangeSet.empty}runTask(e){this._frameTask.processQueue(e),this._commit(e)}_commit(e){const r=this._model.dirtySet;this._asyncChangeSet.empty||e.done||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{if(e.done)return;const n=this._layerSyncSet.has(i.id)||i.updatePolicy===Vw.SYNC,s=n?this._syncChangeSet:this._asyncChangeSet;r.commitLayer(i.id,s),this._layerSyncSet.delete(i.id),s.empty||(this.renderer.modify(s,n?bc:e),this.renderView.requestRender(),e.madeProgress())}),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,bc),this.renderView.requestRender(),e.madeProgress()),this._layers.forAll(i=>{e.done||this._layerSyncSet.has(i.id)||i.updatePolicy!==Vw.ASYNC||(r.commitLayer(i.id,this._asyncChangeSet),this._asyncChangeSet.empty||(this.renderer.modify(this._asyncChangeSet,e),this.renderView.requestRender(),e.madeProgress()))}),this._layerSyncSet.clear(),this.notifyChange("running")}commitSyncLayers(){const e=this._model.dirtySet;this._layers.forAll(r=>{(this._layerSyncSet.has(r.id)||r.updatePolicy===Vw.SYNC)&&(e.commitLayer(r.id,this._syncChangeSet),this._layerSyncSet.delete(r.id))});for(const r of this._layerSyncSet)e.commitLayer(r,this._syncChangeSet);this._layerSyncSet.clear(),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,bc),this.renderView.requestRender())}_commitLayer(e){this._model.dirtySet.commitLayer(e.id,this._syncChangeSet),this._layerSyncSet.delete(e.id),this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,bc),this.renderView.requestRender())}schedule(e,r){return this._frameTask.schedule(e,r)}reschedule(e,r){return this._frameTask.reschedule(e,r)}syncLayer(e){this._layerSyncSet.add(e),this.renderView.requestRender()}getObject(e){return this._model.getObject(e)}get layers(){return this._layers}_addLayer(e){this._layers.includes(e)||this._layers.push(e)}_removeLayer(e){this._commitLayer(e),this._layers.removeUnordered(e)!=null&&(this._model.dirtySet.getResidentRenderGeometries(e.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,bc))}addRenderPlugin(e,r,i){const n=this.renderer.renderPlugins.add(e,r,i),s=()=>{LTe(r)&&this.view.sceneIntersectionHelper.addIntersectionHandler(r)};if(Dh(n))return n.then(s);s()}removeRenderPlugin(e){this.destroyed||(LTe(e)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(e),this.renderer.renderPlugins.remove(e))}get performanceInfo(){return{renderer:this.renderer.performanceInfo,model:this._model.getStats()}}get test(){const e=this;return{getCount:r=>e._model.test.content.filter(i=>i.type===r).length,model:e._model}}};jd.DebugSettings={endFrameContentValidation:!1},d([p({constructOnly:!0})],jd.prototype,"view",void 0),d([p({constructOnly:!0})],jd.prototype,"options",void 0),d([p({readOnly:!0})],jd.prototype,"viewingMode",null),d([p({constructOnly:!0})],jd.prototype,"container",void 0),d([p({readOnly:!0})],jd.prototype,"updating",null),d([p({constructOnly:!0})],jd.prototype,"_model",void 0),d([p({autoDestroy:!0})],jd.prototype,"renderView",void 0),d([p({readOnly:!0})],jd.prototype,"renderer",null),d([p({readOnly:!0})],jd.prototype,"running",null),jd=d([I("esri.views.3d.webgl-engine.Stage")],jd);let jCr=class extends nH{constructor(e,r,i,n){super(r,i),this.point=e,this.createGraphic=n}};function sHe(t){return mg(t)&&t.intersector===Sn.PCL&&!!t.target}let HCr=class extends i5e{constructor(e,r,i,n,s){super(e),this.layerUid=e,this.sublayerUid=r,this.nodeIndex=i,this.componentIndex=n,this.triangleNr=s}},WCr=class extends nH{constructor(e,r,i){super(r,null),this.point=e,this.createVoxelGraphic=i}};function vq(t){return mg(t)&&t.intersector===Sn.I3S&&!!t.target}function oHe(t){return mg(t)&&t.intersector===Sn.VOXEL&&!!t.target}function KCe(t,e){var r,i;return aH(t)||lH(t)?p4((r=t.target)==null?void 0:r.object,e):g4t(t)?(i=e.map)==null?void 0:i.ground:sHe(t)||vq(t)||iVe(t)||oHe(t)?p4(t.target,e):null}function YCr(t,e){const r=cse(t,e);return r!=null&&r.type==="graphic"?r.graphic:null}function cse(t,e){var r;if(t==null)return null;if(aH(t)||lH(t))return QCe((r=t.target)==null?void 0:r.object,e);if(sHe(t)){const i=t.target.createGraphic();return{type:"graphic",graphic:i,layer:i.layer}}if(oHe(t)){const i=t.target.createVoxelGraphic();return{type:"graphic",graphic:i,layer:i.layer}}return iVe(t)||kpe(t)?QCe(t.target,e):vq(t)?bYt(t.target,e):null}function QCe(t,e){if(t==null||t.graphicUid==null)return null;const r=p4(t,e);if(r==null)return null;if(r===e.graphics)return e.graphicsView==null||typeof t.graphicUid!="number"?null:e.graphicsView.getHit(t.graphicUid);const i=e.allLayerViews.find(n=>n.layer===r);return!i||i.suspended||t.graphicUid==null?null:"getHit"in i?i.getHit(t.graphicUid):null}function bYt(t,e){const r=p4(t,e);if(r==null)return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getGraphicFromIntersectorTarget"in i?xYt(i.getGraphicFromIntersectorTarget(t)):null}function wYt(t,e){const r=p4(t,e);if(r==null)return null;const i=e.allLayerViews.find(n=>n.layer===r);return i&&!i.suspended&&"getAABBFromIntersectorTarget"in i?i.getAABBFromIntersectorTarget(t):null}function xYt(t){return t!=null?{type:"graphic",graphic:t,layer:t.layer}:null}function p4(t,e){return t&&t.layerUid!=null?e.graphicsView!=null&&t.layerUid===e.graphicsView.processor.layer.id?e.graphics:e.map.findLayerByUid(t.layerUid):null}function ZCr(t,e){if(aH(t)||lH(t))return t_(t.target.object.boundingVolumeWorldSpace.bounds);if(kpe(t)){rDe(vU,t.transformation);const r=Math.max(vU[0],vU[1],vU[2]);return t.target.baseBoundingSphere.radius*r}return vq(t)?rd(wYt(t.target,e),r=>.5*z4e(r)):null}function JCr(t){return!aH(t)&&!lH(t)&&(kpe(t)?t.target.numLodLevels>1:!!vq(t))}const vU=A();async function SYt(t,e){if(t.type==="2d")return t.hitTest(e);const r=await t.hitTest(e);if(r.results.length===0)return r;const i=(r.results[0].distance??0)*(1+TYt),n=r.results.findIndex(s=>(s.distance??0)>i);return n!==-1&&(r.results=r.results.slice(0,n)),r}const TYt=.05;function EYt(t){return(t==null?void 0:t.type)==="graphic"}function CYt(t){return t.find(EYt)??null}function KCr(t){return t&&typeof t.highlight=="function"}function RYt(t){return t&&typeof t.maskOccludee=="function"}function QCr(t,e,r){return t==null||t>r&&(e===0||t<e)}function eRr(t,e){return t!=null&&t>0||e!=null&&e>0}function tRr(t){const e=t.effectiveScaleRange;return{minScale:(e==null?void 0:e.minScale)??0,maxScale:(e==null?void 0:e.maxScale)??0}}let pJ,fJ;function OYt(t){const e=p6e(t);for(;e.length>1;){const r=eRe(e.shift());if(r.available)return r}return eRe(e.shift())}function eRe(t){switch(t){case Mr.WEBGL1:return AYt();case Mr.WEBGL2:return PYt()}}function AYt(){return pJ||(pJ=IYt()),pJ}function PYt(){return fJ||(fJ=LYt()),fJ}let aHe=class{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsElementIndexUint=!1,this.supportsStandardDerivatives=!1,this.supportsInstancedArrays=!1,this.supportsTextureFloat=!1,this.supportsTextureHalfFloat=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1}},MYt=class extends aHe{constructor(){super(...arguments),this.type=Mr.WEBGL1}},$Yt=class extends aHe{constructor(){super(...arguments),this.type=Mr.WEBGL2,this.supportsElementIndexUint=!0,this.supportsStandardDerivatives=!0,this.supportsInstancedArrays=!0,this.supportsTextureFloat=!0,this.supportsTextureHalfFloat=!0}};function lHe(t,e){if(t===Mr.WEBGL1&&typeof WebGLRenderingContext>"u"||t===Mr.WEBGL2&&typeof WebGL2RenderingContext>"u")return null;const r=document.createElement("canvas");if(!r)return null;let i=Ire(r,t,{failIfMajorPerformanceCaveat:!0});if(i==null&&(i=Ire(r,t),i!=null&&(e.majorPerformanceCaveat=!0)),i==null)return i;if(t===Mr.WEBGL1){const s=i.getParameter(i.VERSION),o=s==null?void 0:s.match(/^WebGL\s+([\d.]*)/);if(o){const a=parseFloat(o[1]);e.available=a>=.94}}else e.available=!0;e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const n=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return n&&(e.supportsHighPrecisionFragment=n.precision>0),i}function IYt(){const t=new MYt,e=lHe(Mr.WEBGL1,t);return e==null||(t.supportsElementIndexUint=e.getExtension("OES_element_index_uint")!==null,t.supportsStandardDerivatives=e.getExtension("OES_standard_derivatives")!==null,t.supportsInstancedArrays=e.getExtension("ANGLE_instanced_arrays")!==null,t.supportsTextureFloat=e.getExtension("OES_texture_float")!==null,t.supportsTextureHalfFloat=e.getExtension("OES_texture_half_float")!==null,t.supportsColorBufferFloat=e.getExtension("WEBGL_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=e.getExtension("EXT_color_buffer_half_float")!==null),t}function LYt(){const t=new $Yt,e=lHe(Mr.WEBGL2,t);return e==null||(t.supportsColorBufferFloat=e.getExtension("EXT_color_buffer_float")!==null,t.supportsColorBufferFloatBlend=e.getExtension("EXT_float_blend")!==null,t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||e.getExtension("EXT_color_buffer_half_float")!==null),t}function DYt(t){const e=OYt(t);if(!e.available)return new H("webgl:required",t==="3d"?"WebGL2 is required but not supported.":"WebGL is required but not supported.",new Error().stack);if(t==="3d"&&e.majorPerformanceCaveat)return new H("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!e.supportsHighPrecisionFragment)return new H("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported.");if(!e.supportsVertexShaderSamplers)return new H("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(e.type===Mr.WEBGL1){if(!e.supportsElementIndexUint)return new H("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!e.supportsStandardDerivatives)return new H("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported.");if(!e.supportsInstancedArrays)return new H("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null}function NYt(t){return t&&"nodeType"in t}function FYt(t){return t&&typeof t.render=="function"}const tRe={component:"esri-component"};let hT=class extends Ce{constructor(){super(...arguments),this.widget=null}destroy(){var e;this.node=null,(e=this.widget)==null||e.destroy()}get id(){return this.get("widget.id")||this.get("node.id")}set node(e){const r=this._get("node");e!==r&&(e&&e.classList.add(tRe.component),r&&r.classList.remove(tRe.component),this._set("node",e))}castNode(e){var r;return(r=this.widget)==null||r.destroy(),e?typeof e=="string"||NYt(e)?(this._set("widget",null),pH(e)):(FYt(e)&&!e.domNode&&(e.domNode=document.createElement("div")),this._set("widget",e),e.domNode):(this._set("widget",null),null)}};d([p({dependsOn:[]})],hT.prototype,"id",null),d([p()],hT.prototype,"node",null),d([ur("node")],hT.prototype,"castNode",null),d([p({readOnly:!0})],hT.prototype,"widget",void 0),hT=d([I("esri.views.ui.Component")],hT);const Kz=hT,cHe="calcite-mode-";function kYt(){return getComputedStyle(document.body).getPropertyValue("--esri-calcite-mode-name").replaceAll(/\s|'|"/g,"")}function UYt(){return kYt().startsWith("dark")}function zYt(){return`${cHe}${UYt()?"dark":"light"}`}function VYt(t){BYt(t),t.classList.add(zYt())}function BYt(t){Array.from(t.classList).forEach(e=>{e.startsWith(cHe)&&t.classList.remove(e)})}const jYt={left:0,top:0,bottom:0,right:0},uHe={bottom:30,top:15,right:15,left:15},Z0="esri-ui",Ou={ui:Z0,corner:`${Z0}-corner`,innerContainer:`${Z0}-inner-container`,manualContainer:`${Z0}-manual-container`,cornerContainer:`${Z0}-corner-container`,topLeft:`${Z0}-top-left`,topRight:`${Z0}-top-right`,bottomLeft:`${Z0}-bottom-left`,bottomRight:`${Z0}-bottom-right`};function GYt(t){return t&&!t._started&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}function _U(t){return t===0?"0":`${t}px`}function mJ(t){const e=typeof t=="object"&&t!==null&&Object.getPrototypeOf(t);return(e===null||e===Object.prototype)&&("component"in t||"index"in t||"position"in t)?t:null}function gJ(t,{top:e,bottom:r,left:i,right:n}){t.style.top=e,t.style.bottom=r,t.style.left=i,t.style.right=n}let dy=class extends pn.EventedAccessor{constructor(e){super(e),this._cornerNameToContainerLookup={},this._positionNameToContainerLookup={},this._components=new Array,this._componentMap=new Map,this._locale=Ym(),this.view=null,this._applyViewPadding=()=>{const r=this.container;r&&gJ(r,this._toPixelPosition(this._getViewPadding()))},this._applyUIPadding=()=>{const r=this._innerContainer;r&&gJ(r,this._toPixelPosition(this.padding))},this._initContainers()}initialize(){this.addHandles([pe(()=>{var e;return[(e=this.view)==null?void 0:e.padding,this.container]},this._applyViewPadding,_r),pe(()=>this.padding,this._applyUIPadding,_r),pe(()=>[this.container,this._locale],([e,r])=>{e&&e.setAttribute("lang",r)},_r),qIe(e=>{this._locale=e})])}destroy(){this.container=null;for(const e of this._components)e.destroy();this._components.length=0,this._componentMap.clear()}set container(e){const r=this._get("container");e!==r&&(e&&(e.classList.add(Ou.ui),VYt(e),this._attachContainers(e)),r&&(r.classList.remove(Ou.ui),gJ(r,{top:"",bottom:"",left:"",right:""}),Q5e(r)),this._set("container",e))}get height(){var s;const e=((s=this.view)==null?void 0:s.height)??0;if(e===0)return e;const r=this._getViewPadding(),{top:i,bottom:n}=r;return Math.max(e-i-n,0)}get padding(){return this._get("padding")}set padding(e){this._overrideIfSome("padding",e)}castPadding(e){return typeof e=="number"?{bottom:e,top:e,right:e,left:e}:{...uHe,...e}}get width(){var s;const e=((s=this.view)==null?void 0:s.width)??0;if(e===0)return e;const r=this._getViewPadding(),{left:i,right:n}=r;return Math.max(e-i-n,0)}add(e,r){let i,n,s;if(Array.isArray(e))return void e.forEach(a=>this.add(a,r));const o=mJ(e);o&&({index:i,position:r,component:e,key:n}=o),r&&typeof r=="object"&&({index:i,key:n,position:r,internal:s}=r),!e||r&&!this._isValidPosition(r)||this._add(e,r,i,n,s)}remove(e,r){var n;if(!e)return;if(Array.isArray(e))return e.map(s=>this.remove(s,r));const i=this._find(e);if(i){if(this._componentMap.has(e)&&((n=this._componentMap.get(e))==null?void 0:n.key)!==r)return;const s=this._components.indexOf(i),o=i.node.parentNode;return o==null||o.removeChild(i.node),this._componentMap.delete(e),this._components.splice(s,1)[0]}}empty(e,r={removeInternal:!1}){if(Array.isArray(e)){for(const s of e)this.empty(s,r);return}const i=this._positionNameToContainerLookup[e??"manual"],n=Array.prototype.slice.call(i.children).map(s=>this._findByNode(s)).filter(s=>{var o;return s==null?!1:!(((o=this._componentMap.get(s))==null?void 0:o.internal)??!1)||r.removeInternal});for(const s of n)this.remove(s)}move(e,r){if(Array.isArray(e)&&e.forEach(o=>this.move(o,r)),!e)return;let i;const n=mJ(e)||mJ(r);if(n&&(i=n.index,r=n.position,e=n.component||e),r&&!this._isValidPosition(r))return;const s=this.remove(e);s&&this.add(s,{position:r,index:i})}find(e){if(!e)return null;const r=this._findById(e);return r&&(r.widget||r.node)}getComponents(e,r={includeInternal:!1}){return e?Array.isArray(e)?e.map(i=>this._getComponentsAtPosition(i,r)).flat():this._getComponentsAtPosition(e,r):this._components.filter(i=>{var n;return r.includeInternal||!((n=this._componentMap.get(i))!=null&&n.internal)}).map(({widget:i,node:n})=>i??n)}getPosition(e){for(const r in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[r].contains(e))return r;return null}_add(e,r,i,n,s){e instanceof Kz||(e=new Kz({node:e})),this._place({component:e,position:r,index:i}),this._components.push(e),this._componentMap.set(e,{key:n,internal:s})}_find(e){return e?e instanceof Kz?this._findByComponent(e):typeof e=="string"?this._findById(e):this._findByNode(e.domNode||e):null}_getViewPadding(){var e;return((e=this.view)==null?void 0:e.padding)??jYt}_attachContainers(e){e.appendChild(this._innerContainer),e.appendChild(this._manualContainer)}_initContainers(){const e=document.createElement("div");e.classList.add(Ou.innerContainer,Ou.cornerContainer);const r=document.createElement("div");r.classList.add(Ou.innerContainer,Ou.manualContainer);const i=document.createElement("div");i.classList.add(Ou.topLeft,Ou.corner),e.appendChild(i);const n=document.createElement("div");n.classList.add(Ou.topRight,Ou.corner),e.appendChild(n);const s=document.createElement("div");s.classList.add(Ou.bottomLeft,Ou.corner),e.appendChild(s);const o=document.createElement("div");o.classList.add(Ou.bottomRight,Ou.corner),e.appendChild(o),this._innerContainer=e,this._manualContainer=r;const a=vre();this._cornerNameToContainerLookup={"top-left":i,"top-right":n,"bottom-left":s,"bottom-right":o,"top-leading":a?n:i,"top-trailing":a?i:n,"bottom-leading":a?o:s,"bottom-trailing":a?s:o},this._positionNameToContainerLookup={manual:r,...this._cornerNameToContainerLookup}}_isValidPosition(e){return!!this._positionNameToContainerLookup[e]}_place(e){const r=e.position??"manual",{component:i,index:n}=e,s=this._positionNameToContainerLookup[r],o=n!=null&&n>-1;if(GYt(i.widget)&&i.widget.startup(),!o)return void s.appendChild(i.node);const a=Array.from(s.children);if(n===0)return void(s.firstChild?X_e(i.node,s.firstChild):s.appendChild(i.node));n>=a.length?s.appendChild(i.node):X_e(i.node,a[n])}_toPixelPosition(e){return{top:_U(e.top),left:_U(e.left),right:_U(e.right),bottom:_U(e.bottom)}}_findByComponent(e){return this._components.find(r=>r===e)??null}_findById(e){return this._components.find(({id:r})=>r===e)??null}_findByNode(e){return this._components.find(({node:r})=>r===e)??null}_getComponentsAtPosition(e,r){const i=this._positionNameToContainerLookup[e];return Array.prototype.slice.call(i.children).map(n=>this._findByNode(n)).filter(_0).filter(n=>{var s;return r.includeInternal||!((s=this._componentMap.get(n))!=null&&s.internal)}).map(({widget:n,node:s})=>n??s)}};d([p()],dy.prototype,"_locale",void 0),d([p()],dy.prototype,"container",null),d([p()],dy.prototype,"height",null),d([p({value:uHe})],dy.prototype,"padding",null),d([ur("padding")],dy.prototype,"castPadding",null),d([p()],dy.prototype,"view",void 0),d([p()],dy.prototype,"width",null),dy=d([I("esri.views.ui.UI")],dy);const HYt=dy,qYt={handleInterceptedEvent:(t,e,r,i)=>(t.scheduleRender(),e.properties[`on${i.type}`].apply(e.properties.bind||r,[i]))},WYt={namespace:void 0,performanceLogger:()=>{},eventHandlerInterceptor:void 0,styleApplyer:(t,e,r)=>{t.style[e]=r}},XYt=t=>({...WYt,...t}),YYt=(t,e)=>{const r=[];for(;t&&t!==e;)r.push(t),t=t.parentNode;return r},ZYt=(t,e)=>t.find(e),rRe=(t,e,r=!1)=>{let i=t;return e.forEach((n,s)=>{const o=i!=null&&i.children?ZYt(i.children,a=>a.domNode===n):void 0;r&&!o&&s!==e.length-1||(i=o)}),i},JYt=t=>{let e;const r={...qYt,...t},i=XYt(r),n=i.performanceLogger;let s,o=!0,a=!1;const l=[],c=[],u=(f,m,g)=>{var b;let y;i.eventHandlerInterceptor=(w,x,S,C)=>function(E){let R;n("domEvent",E);const P=YYt(E.currentTarget,y.domNode),D=P.some(k=>{var V;return customElements.get((V=k==null?void 0:k.tagName)==null?void 0:V.toLowerCase())});if(E.eventPhase===Event.CAPTURING_PHASE||!D)P.reverse(),R=rRe(y.getLastRender(),P);else{const k=E.composedPath(),V=k.slice(k.indexOf(E.currentTarget),k.indexOf(y.domNode)).filter(W=>W.getRootNode()===W.ownerDocument).reverse();R=rRe(y.getLastRender(),V,!0)}let L;return R&&(L=r.handleInterceptedEvent(e,R,this,E)),n("domEventProcessed",E),L},(b=r.postProcessProjectionOptions)==null||b.call(r,i);const _=g();y=f(m,_,i),l.push(y),c.push(g),r.afterFirstVNodeRendered&&r.afterFirstVNodeRendered(y,_)};let h=()=>{if(s=void 0,o){o=!1,n("renderStart",void 0);for(let f=0;f<l.length;f++){const m=c[f]();n("rendered",void 0),l[f].update(m),n("patched",void 0)}n("renderDone",void 0),o=!0}};return r.modifyDoRenderImplementation&&(h=r.modifyDoRenderImplementation(h,l,c)),e={renderNow:h,scheduleRender:()=>{s||a||(s=requestAnimationFrame(h))},stop:()=>{s&&(cancelAnimationFrame(s),s=void 0),a=!0},resume:()=>{a=!1,o=!0,e.scheduleRender()},append:(f,m)=>{u(ww.append,f,m)},insertBefore:(f,m)=>{u(ww.insertBefore,f,m)},merge:(f,m)=>{u(ww.merge,f,m)},replace:(f,m)=>{u(ww.replace,f,m)},detach:f=>{for(let m=0;m<c.length;m++)if(c[m]===f)return c.splice(m,1),l.splice(m,1)[0];throw new Error("renderFunction was not found")}},e},rO={allRenderFn:!1,cmpDidLoad:!0,cmpDidUnload:!1,cmpDidUpdate:!0,cmpDidRender:!0,cmpWillLoad:!0,cmpWillUpdate:!0,cmpWillRender:!0,connectedCallback:!0,disconnectedCallback:!0,element:!0,event:!0,hasRenderFn:!0,lifecycle:!0,hostListener:!0,hostListenerTargetWindow:!0,hostListenerTargetDocument:!0,hostListenerTargetBody:!0,hostListenerTargetParent:!1,hostListenerTarget:!0,member:!0,method:!0,mode:!0,observeAttribute:!0,prop:!0,propMutable:!0,reflect:!0,scoped:!0,shadowDom:!0,slot:!0,cssAnnotations:!0,state:!0,style:!0,svg:!0,updatable:!0,vdomAttribute:!0,vdomXlink:!0,vdomClass:!0,vdomFunctional:!0,vdomKey:!0,vdomListener:!0,vdomRef:!0,vdomPropOrAttr:!0,vdomRender:!0,vdomStyle:!0,vdomText:!0,watchCallback:!0,taskQueue:!0,hotModuleReplacement:!1,isDebug:!1,isDev:!1,isTesting:!1,hydrateServerSide:!1,hydrateClientSide:!1,lifecycleDOMEvents:!1,lazyLoad:!1,profile:!1,slotRelocation:!0,appendChildSlotFix:!1,cloneNodeFix:!1,hydratedAttribute:!1,hydratedClass:!0,safari10:!1,scriptDataOpts:!1,scopedSlotTextContentFix:!1,shadowDomShim:!1,slotChildNodesFix:!1,invisiblePrehydration:!0,propBoolean:!0,propNumber:!0,propString:!0,cssVarShim:!1,constructableCSS:!0,cmpShouldUpdate:!0,devTools:!1,dynamicImportShim:!1,shadowDelegatesFocus:!0,initializeNextTick:!1,asyncLoading:!1,asyncQueue:!1,transformTagName:!1,attachStyles:!0};let iO,dHe,_q,hHe=!1,Oj=!1,yfe=!1,th=!1,iRe=null,use=!1;const KYt=t=>{const e=new URL(t,ul.$resourcesUrl$);return e.origin!==XF.location.origin?e.href:e.pathname},QYt=t=>ul.$resourcesUrl$=t,TE=(t,e="")=>()=>{},nRe="http://www.w3.org/1999/xlink",sRe={},eZt="http://www.w3.org/2000/svg",tZt="http://www.w3.org/1999/xhtml",rZt=t=>t!=null,vfe=t=>(t=typeof t,t==="object"||t==="function");function iZt(t){var e,r,i;return(i=(r=(e=t.head)===null||e===void 0?void 0:e.querySelector('meta[name="csp-nonce"]'))===null||r===void 0?void 0:r.getAttribute("content"))!==null&&i!==void 0?i:void 0}const pHe=(t,e,...r)=>{let i=null,n=null,s=null,o=!1,a=!1;const l=[],c=h=>{for(let f=0;f<h.length;f++)i=h[f],Array.isArray(i)?c(i):i!=null&&typeof i!="boolean"&&((o=typeof t!="function"&&!vfe(i))&&(i=String(i)),o&&a?l[l.length-1].$text$+=i:l.push(o?Aj(null,i):i),a=o)};if(c(r),e){e.key&&(n=e.key),e.name&&(s=e.name);{const h=e.className||e.class;h&&(e.class=typeof h!="object"?h:Object.keys(h).filter(f=>h[f]).join(" "))}}if(typeof t=="function")return t(e===null?{}:e,l,oZt);const u=Aj(t,null);return u.$attrs$=e,l.length>0&&(u.$children$=l),u.$key$=n,u.$name$=s,u},Aj=(t,e)=>{const r={$flags$:0,$tag$:t,$text$:e,$elm$:null,$children$:null};return r.$attrs$=null,r.$key$=null,r.$name$=null,r},nZt={},sZt=t=>t&&t.$tag$===nZt,oZt={forEach:(t,e)=>t.map(oRe).forEach(e),map:(t,e)=>t.map(oRe).map(e).map(aZt)},oRe=t=>({vattrs:t.$attrs$,vchildren:t.$children$,vkey:t.$key$,vname:t.$name$,vtag:t.$tag$,vtext:t.$text$}),aZt=t=>{if(typeof t.vtag=="function"){const r=Object.assign({},t.vattrs);return t.vkey&&(r.key=t.vkey),t.vname&&(r.name=t.vname),pHe(t.vtag,r,...t.vchildren||[])}const e=Aj(t.vtag,t.vtext);return e.$attrs$=t.vattrs,e.$children$=t.vchildren,e.$key$=t.vkey,e.$name$=t.vname,e},lZt=t=>DZt.map(e=>e(t)).find(e=>!!e),cZt=(t,e)=>t!=null&&!vfe(t)?e&4?t==="false"?!1:t===""||!!t:e&2?parseFloat(t):e&1?String(t):t:t,uZt=t=>t,aRr=(t,e,r)=>{const i=uZt(t);return{emit:n=>dZt(i,e,{bubbles:!!(r&4),composed:!!(r&2),cancelable:!!(r&1),detail:n})}},dZt=(t,e,r)=>{const i=ul.ce(e,r);return t.dispatchEvent(i),i},aRe=new WeakMap,hZt=(t,e,r)=>{let i=Mj.get(t);kZt&&r?(i=i||new CSSStyleSheet,typeof i=="string"?i=e:i.replaceSync(e)):i=e,Mj.set(t,i)},pZt=(t,e,r,i)=>{var n;let s=fHe(e,r);const o=Mj.get(s);if(t=t.nodeType===11?t:eg,o)if(typeof o=="string"){t=t.head||t;let a=aRe.get(t),l;if(a||aRe.set(t,a=new Set),!a.has(s)){{l=eg.createElement("style"),l.innerHTML=o;const c=(n=ul.$nonce$)!==null&&n!==void 0?n:iZt(eg);c!=null&&l.setAttribute("nonce",c),t.insertBefore(l,t.querySelector("link"))}a&&a.add(s)}}else t.adoptedStyleSheets.includes(o)||(t.adoptedStyleSheets=[...t.adoptedStyleSheets,o]);return s},fZt=t=>{const e=t.$cmpMeta$,r=t.$hostElement$,i=e.$flags$,n=TE("attachStyles",e.$tagName$),s=pZt(r.shadowRoot?r.shadowRoot:r.getRootNode(),e,t.$modeName$);i&10&&(r["s-sc"]=s,r.classList.add(s+"-h"),i&2&&r.classList.add(s+"-s")),n()},fHe=(t,e)=>"sc-"+(e&&t.$flags$&32?t.$tagName$+"-"+e:t.$tagName$),lRe=(t,e,r,i,n,s)=>{if(r!==i){let o=hRe(t,e),a=e.toLowerCase();if(e==="class"){const l=t.classList,c=cRe(r),u=cRe(i);l.remove(...c.filter(h=>h&&!u.includes(h))),l.add(...u.filter(h=>h&&!c.includes(h)))}else if(e==="style"){for(const l in r)(!i||i[l]==null)&&(l.includes("-")?t.style.removeProperty(l):t.style[l]="");for(const l in i)(!r||i[l]!==r[l])&&(l.includes("-")?t.style.setProperty(l,i[l]):t.style[l]=i[l])}else if(e!=="key")if(e==="ref")i&&i(t);else if(!t.__lookupSetter__(e)&&e[0]==="o"&&e[1]==="n")e[2]==="-"?e=e.slice(3):hRe(XF,a)?e=a.slice(2):e=a[2]+e.slice(3),r&&ul.rel(t,e,r,!1),i&&ul.ael(t,e,i,!1);else{const l=vfe(i);if((o||l&&i!==null)&&!n)try{if(t.tagName.includes("-"))t[e]=i;else{const u=i??"";e==="list"?o=!1:(r==null||t[e]!=u)&&(t[e]=u)}}catch{}let c=!1;a!==(a=a.replace(/^xlink\:?/,""))&&(e=a,c=!0),i==null||i===!1?(i!==!1||t.getAttribute(e)==="")&&(c?t.removeAttributeNS(nRe,e):t.removeAttribute(e)):(!o||s&4||n)&&!l&&(i=i===!0?"":i,c?t.setAttributeNS(nRe,e,i):t.setAttribute(e,i))}}},mZt=/\s/,cRe=t=>t?t.split(mZt):[],mHe=(t,e,r,i)=>{const n=e.$elm$.nodeType===11&&e.$elm$.host?e.$elm$.host:e.$elm$,s=t&&t.$attrs$||sRe,o=e.$attrs$||sRe;for(i in s)i in o||lRe(n,i,s[i],void 0,r,e.$flags$);for(i in o)lRe(n,i,s[i],o[i],r,e.$flags$)},Pj=(t,e,r,i)=>{const n=e.$children$[r];let s=0,o,a,l;if(hHe||(yfe=!0,n.$tag$==="slot"&&(iO&&i.classList.add(iO+"-s"),n.$flags$|=n.$children$?2:1)),n.$text$!==null)o=n.$elm$=eg.createTextNode(n.$text$);else if(n.$flags$&1)o=n.$elm$=eg.createTextNode("");else{if(th||(th=n.$tag$==="svg"),o=n.$elm$=eg.createElementNS(th?eZt:tZt,n.$flags$&2?"slot-fb":n.$tag$),th&&n.$tag$==="foreignObject"&&(th=!1),mHe(null,n,th),rZt(iO)&&o["s-si"]!==iO&&o.classList.add(o["s-si"]=iO),n.$children$)for(s=0;s<n.$children$.length;++s)a=Pj(t,n,s,o),a&&o.appendChild(a);n.$tag$==="svg"?th=!1:o.tagName==="foreignObject"&&(th=!0)}return o["s-hn"]=_q,n.$flags$&3&&(o["s-sr"]=!0,o["s-cr"]=dHe,o["s-sn"]=n.$name$||"",l=t&&t.$children$&&t.$children$[r],l&&l.$tag$===n.$tag$&&t.$elm$&&f4(t.$elm$,!1)),o},f4=(t,e)=>{ul.$flags$|=1;const r=t.childNodes;for(let i=r.length-1;i>=0;i--){const n=r[i];n["s-hn"]!==_q&&n["s-ol"]&&(vHe(n).insertBefore(n,_fe(n)),n["s-ol"].remove(),n["s-ol"]=void 0,yfe=!0),e&&f4(n,e)}ul.$flags$&=-2},gHe=(t,e,r,i,n,s)=>{let o=t["s-cr"]&&t["s-cr"].parentNode||t,a;for(o.shadowRoot&&o.tagName===_q&&(o=o.shadowRoot);n<=s;++n)i[n]&&(a=Pj(null,r,n,t),a&&(i[n].$elm$=a,o.insertBefore(a,_fe(e))))},yHe=(t,e,r,i,n)=>{for(;e<=r;++e)(i=t[e])&&(n=i.$elm$,wHe(i),Oj=!0,n["s-ol"]?n["s-ol"].remove():f4(n,!0),n.remove())},gZt=(t,e,r,i)=>{let n=0,s=0,o=0,a=0,l=e.length-1,c=e[0],u=e[l],h=i.length-1,f=i[0],m=i[h],g,y;for(;n<=l&&s<=h;)if(c==null)c=e[++n];else if(u==null)u=e[--l];else if(f==null)f=i[++s];else if(m==null)m=i[--h];else if(bU(c,f))nO(c,f),c=e[++n],f=i[++s];else if(bU(u,m))nO(u,m),u=e[--l],m=i[--h];else if(bU(c,m))(c.$tag$==="slot"||m.$tag$==="slot")&&f4(c.$elm$.parentNode,!1),nO(c,m),t.insertBefore(c.$elm$,u.$elm$.nextSibling),c=e[++n],m=i[--h];else if(bU(u,f))(c.$tag$==="slot"||m.$tag$==="slot")&&f4(u.$elm$.parentNode,!1),nO(u,f),t.insertBefore(u.$elm$,c.$elm$),u=e[--l],f=i[++s];else{for(o=-1,a=n;a<=l;++a)if(e[a]&&e[a].$key$!==null&&e[a].$key$===f.$key$){o=a;break}o>=0?(y=e[o],y.$tag$!==f.$tag$?g=Pj(e&&e[s],r,o,t):(nO(y,f),e[o]=void 0,g=y.$elm$),f=i[++s]):(g=Pj(e&&e[s],r,s,t),f=i[++s]),g&&vHe(c.$elm$).insertBefore(g,_fe(c.$elm$))}n>l?gHe(t,i[h+1]==null?null:i[h+1].$elm$,r,i,s,h):s>h&&yHe(e,n,l)},bU=(t,e)=>t.$tag$===e.$tag$?t.$tag$==="slot"?t.$name$===e.$name$:t.$key$===e.$key$:!1,_fe=t=>t&&t["s-ol"]||t,vHe=t=>(t["s-ol"]?t["s-ol"]:t).parentNode,nO=(t,e)=>{const r=e.$elm$=t.$elm$,i=t.$children$,n=e.$children$,s=e.$tag$,o=e.$text$;let a;o===null?(th=s==="svg"?!0:s==="foreignObject"?!1:th,s==="slot"||mHe(t,e,th),i!==null&&n!==null?gZt(r,i,e,n):n!==null?(t.$text$!==null&&(r.textContent=""),gHe(r,null,e,n,0,n.length-1)):i!==null&&yHe(i,0,i.length-1),th&&s==="svg"&&(th=!1)):(a=r["s-cr"])?a.parentNode.textContent=o:t.$text$!==o&&(r.data=o)},_He=t=>{const e=t.childNodes;let r,i,n,s,o,a;for(i=0,n=e.length;i<n;i++)if(r=e[i],r.nodeType===1){if(r["s-sr"]){for(o=r["s-sn"],r.hidden=!1,s=0;s<n;s++)if(a=e[s].nodeType,e[s]["s-hn"]!==r["s-hn"]||o!==""){if(a===1&&o===e[s].getAttribute("slot")){r.hidden=!0;break}}else if(a===1||a===3&&e[s].textContent.trim()!==""){r.hidden=!0;break}}_He(r)}},Am=[],bHe=t=>{let e,r,i,n,s,o,a=0;const l=t.childNodes,c=l.length;for(;a<c;a++){if(e=l[a],e["s-sr"]&&(r=e["s-cr"])&&r.parentNode)for(i=r.parentNode.childNodes,n=e["s-sn"],o=i.length-1;o>=0;o--)r=i[o],!r["s-cn"]&&!r["s-nr"]&&r["s-hn"]!==e["s-hn"]&&(uRe(r,n)?(s=Am.find(u=>u.$nodeToRelocate$===r),Oj=!0,r["s-sn"]=r["s-sn"]||n,s?s.$slotRefNode$=e:Am.push({$slotRefNode$:e,$nodeToRelocate$:r}),r["s-sr"]&&Am.map(u=>{uRe(u.$nodeToRelocate$,r["s-sn"])&&(s=Am.find(h=>h.$nodeToRelocate$===r),s&&!u.$slotRefNode$&&(u.$slotRefNode$=s.$slotRefNode$))})):Am.some(u=>u.$nodeToRelocate$===r)||Am.push({$nodeToRelocate$:r}));e.nodeType===1&&bHe(e)}},uRe=(t,e)=>t.nodeType===1?t.getAttribute("slot")===null&&e===""||t.getAttribute("slot")===e:t["s-sn"]===e?!0:e==="",wHe=t=>{t.$attrs$&&t.$attrs$.ref&&t.$attrs$.ref(null),t.$children$&&t.$children$.map(wHe)},yZt=(t,e)=>{const r=t.$hostElement$,i=t.$cmpMeta$,n=t.$vnode$||Aj(null,null),s=sZt(e)?e:pHe(null,null,e);_q=r.tagName,i.$attrsToReflect$&&(s.$attrs$=s.$attrs$||{},i.$attrsToReflect$.map(([o,a])=>s.$attrs$[a]=r[o])),s.$tag$=null,s.$flags$|=4,t.$vnode$=s,s.$elm$=n.$elm$=r.shadowRoot||r,iO=r["s-sc"],dHe=r["s-cr"],hHe=(i.$flags$&1)!==0,Oj=!1,nO(n,s);{if(ul.$flags$|=1,yfe){bHe(s.$elm$);let o,a,l,c,u,h,f=0;for(;f<Am.length;f++)o=Am[f],a=o.$nodeToRelocate$,a["s-ol"]||(l=eg.createTextNode(""),l["s-nr"]=a,a.parentNode.insertBefore(a["s-ol"]=l,a));for(f=0;f<Am.length;f++)if(o=Am[f],a=o.$nodeToRelocate$,o.$slotRefNode$){for(c=o.$slotRefNode$.parentNode,u=o.$slotRefNode$.nextSibling,l=a["s-ol"];l=l.previousSibling;)if(h=l["s-nr"],h&&h["s-sn"]===a["s-sn"]&&c===h.parentNode&&(h=h.nextSibling,!h||!h["s-nr"])){u=h;break}(!u&&c!==a.parentNode||a.nextSibling!==u)&&a!==u&&(!a["s-hn"]&&a["s-ol"]&&(a["s-hn"]=a["s-ol"].parentNode.nodeName),c.insertBefore(a,u))}else a.nodeType===1&&(a.hidden=!0)}Oj&&_He(s.$elm$),ul.$flags$&=-2,Am.length=0}},vZt=(t,e)=>{},bfe=(t,e)=>(t.$flags$|=16,vZt(t,t.$ancestorComponent$),VZt(()=>_Zt(t,e))),_Zt=(t,e)=>{const r=t.$hostElement$,i=TE("scheduleUpdate",t.$cmpMeta$.$tagName$),n=r;let s;return e?s=jA(n,"componentWillLoad"):s=jA(n,"componentWillUpdate"),s=dRe(s,()=>jA(n,"componentWillRender")),i(),dRe(s,()=>bZt(t,n,e))},bZt=async(t,e,r)=>{const i=t.$hostElement$,n=TE("update",t.$cmpMeta$.$tagName$);i["s-rc"],r&&fZt(t);const s=TE("render",t.$cmpMeta$.$tagName$);wZt(t,e,i),s(),n(),xZt(t)},wZt=(t,e,r)=>{try{iRe=e,e=e.render&&e.render(),t.$flags$&=-17,t.$flags$|=2,(rO.hasRenderFn||rO.reflect)&&(rO.vdomRender||rO.reflect)&&(rO.hydrateServerSide||yZt(t,e))}catch(a){WF(a,t.$hostElement$)}return iRe=null,null},xZt=t=>{const e=t.$cmpMeta$.$tagName$,r=t.$hostElement$,i=TE("postUpdate",e),n=r;t.$ancestorComponent$,jA(n,"componentDidRender"),t.$flags$&64?(jA(n,"componentDidUpdate"),i()):(t.$flags$|=64,jA(n,"componentDidLoad"),i())},lRr=t=>{{const e=qF(t),r=e.$hostElement$.isConnected;return r&&(e.$flags$&18)===2&&bfe(e,!1),r}},jA=(t,e,r)=>{if(t&&t[e])try{return t[e](r)}catch(i){WF(i)}},dRe=(t,e)=>t&&t.then?t.then(e):e(),SZt=(t,e)=>qF(t).$instanceValues$.get(e),TZt=(t,e,r,i)=>{const n=qF(t),s=t,o=n.$instanceValues$.get(e),a=n.$flags$,l=s;r=cZt(r,i.$members$[e][0]);const c=Number.isNaN(o)&&Number.isNaN(r);if(r!==o&&!c){n.$instanceValues$.set(e,r);{if(i.$watchers$&&a&128){const h=i.$watchers$[e];h&&h.map(f=>{try{l[f](r,o,e)}catch(m){WF(m,s)}})}if((a&18)===2){if(l.componentShouldUpdate&&l.componentShouldUpdate(r,o,e)===!1)return;bfe(n,!1)}}}},EZt=(t,e,r)=>{if(e.$members$){t.watchers&&(e.$watchers$=t.watchers);const i=Object.entries(e.$members$),n=t.prototype;i.map(([s,[o]])=>{(o&31||o&32)&&Object.defineProperty(n,s,{get(){return SZt(this,s)},set(a){TZt(this,s,a,e)},configurable:!0,enumerable:!0})});{const s=new Map;n.attributeChangedCallback=function(o,a,l){ul.jmp(()=>{const c=s.get(o);if(this.hasOwnProperty(c))l=this[c],delete this[c];else if(n.hasOwnProperty(c)&&typeof this[c]=="number"&&this[c]==l)return;this[c]=l===null&&typeof this[c]=="boolean"?!1:l})},t.observedAttributes=i.filter(([o,a])=>a[0]&15).map(([o,a])=>{const l=a[1]||o;return s.set(l,o),a[0]&512&&e.$attrsToReflect$.push([o,l]),l})}}return t},CZt=async(t,e,r,i,n)=>{if(!(e.$flags$&32)&&(n=t.constructor,e.$flags$|=32,customElements.whenDefined(r.$tagName$).then(()=>e.$flags$|=128),n.style)){let o=n.style;typeof o!="string"&&(o=o[e.$modeName$=lZt(t)]);const a=fHe(r,e.$modeName$);if(!Mj.has(a)){const l=TE("registerStyles",r.$tagName$);hZt(a,o,!!(r.$flags$&1)),l()}}e.$ancestorComponent$,(()=>bfe(e,!0))()},RZt=t=>{},OZt=t=>{if(!(ul.$flags$&1)){const e=qF(t),r=e.$cmpMeta$,i=TE("connectedCallback",r.$tagName$);e.$flags$&1?(xHe(t,e,r.$listeners$),RZt(e.$lazyInstance$)):(e.$flags$|=1,r.$flags$&12&&AZt(t),r.$members$&&Object.entries(r.$members$).map(([n,[s]])=>{if(s&31&&t.hasOwnProperty(n)){const o=t[n];delete t[n],t[n]=o}}),CZt(t,e,r)),i()}},AZt=t=>{const e=t["s-cr"]=eg.createComment("");e["s-cn"]=!0,t.insertBefore(e,t.firstChild)},PZt=t=>{if(!(ul.$flags$&1)){const e=qF(t);e.$rmListeners$&&(e.$rmListeners$.map(r=>r()),e.$rmListeners$=void 0)}},cRr=(t,e)=>{const r={$flags$:e[0],$tagName$:e[1]};r.$members$=e[2],r.$listeners$=e[3],r.$watchers$=t.$watchers$,r.$attrsToReflect$=[];const i=t.prototype.connectedCallback,n=t.prototype.disconnectedCallback;return Object.assign(t.prototype,{__registerHost(){LZt(this,r)},connectedCallback(){OZt(this),i&&i.call(this)},disconnectedCallback(){PZt(this),n&&n.call(this)},__attachShadow(){this.attachShadow({mode:"open",delegatesFocus:!!(r.$flags$&16)})}}),t.is=r.$tagName$,EZt(t,r)},uRr=(t,e)=>e,xHe=(t,e,r,i)=>{r&&r.map(([n,s,o])=>{const a=$Zt(t,n),l=MZt(e,o),c=IZt(n);ul.ael(a,s,l,c),(e.$rmListeners$=e.$rmListeners$||[]).push(()=>ul.rel(a,s,l,c))})},MZt=(t,e)=>r=>{try{rO.lazyLoad||t.$hostElement$[e](r)}catch(i){WF(i)}},$Zt=(t,e)=>e&4?eg:e&8?XF:e&16?eg.body:t,IZt=t=>NZt?{passive:(t&1)!==0,capture:(t&2)!==0}:(t&2)!==0,SHe=new WeakMap,qF=t=>SHe.get(t),LZt=(t,e)=>{const r={$flags$:0,$hostElement$:t,$cmpMeta$:e,$instanceValues$:new Map};return xHe(t,r,e.$listeners$),SHe.set(t,r)},hRe=(t,e)=>e in t,WF=(t,e)=>(0,console.error)(t,e),Mj=new Map,DZt=[],XF=typeof window<"u"?window:{},eg=XF.document||{head:{}},dRr=XF.HTMLElement||class{},ul={$flags$:0,$resourcesUrl$:"",jmp:t=>t(),raf:t=>requestAnimationFrame(t),ael:(t,e,r,i)=>t.addEventListener(e,r,i),rel:(t,e,r,i)=>t.removeEventListener(e,r,i),ce:(t,e)=>new CustomEvent(t,e)},NZt=(()=>{let t=!1;try{eg.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch{}return t})(),FZt=t=>Promise.resolve(t),kZt=(()=>{try{return new CSSStyleSheet,typeof new CSSStyleSheet().replaceSync=="function"}catch{}return!1})(),pRe=[],THe=[],UZt=(t,e)=>r=>{t.push(r),use||(use=!0,e&&ul.$flags$&4?zZt(dse):ul.raf(dse))},fRe=t=>{for(let e=0;e<t.length;e++)try{t[e](performance.now())}catch(r){WF(r)}t.length=0},dse=()=>{fRe(pRe),fRe(THe),(use=pRe.length>0)&&ul.raf(dse)},zZt=t=>FZt().then(t),VZt=UZt(THe,!0);/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */const EHe="calcite-mode-auto",CHe="calcite-mode-dark",BZt="calcite-mode-light",hRr={autoMode:EHe,darkMode:CHe,lightMode:BZt,rtl:"calcite--rtl",calciteAnimate:"calcite-animate",calciteAnimateIn:"calcite-animate__in",calciteAnimateInUp:"calcite-animate__in-up",calciteAnimateInDown:"calcite-animate__in-down",calciteAnimateInRight:"calcite-animate__in-right",calciteAnimateInLeft:"calcite-animate__in-left",calciteAnimateInScale:"calcite-animate__in-scale"};/*!
* tabbable 6.1.2
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var RHe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],$j=RHe.join(","),OHe=typeof Element>"u",EE=OHe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,Ij=!OHe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},Lj=function t(e,r){var i;r===void 0&&(r=!0);var n=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"inert"),s=n===""||n==="true",o=s||r&&e&&t(e.parentNode);return o},jZt=function(e){var r,i=e==null||(r=e.getAttribute)===null||r===void 0?void 0:r.call(e,"contenteditable");return i===""||i==="true"},AHe=function(e,r,i){if(Lj(e))return[];var n=Array.prototype.slice.apply(e.querySelectorAll($j));return r&&EE.call(e,$j)&&n.unshift(e),n=n.filter(i),n},PHe=function t(e,r,i){for(var n=[],s=Array.from(e);s.length;){var o=s.shift();if(!Lj(o,!1))if(o.tagName==="SLOT"){var a=o.assignedElements(),l=a.length?a:o.children,c=t(l,!0,i);i.flatten?n.push.apply(n,c):n.push({scopeParent:o,candidates:c})}else{var u=EE.call(o,$j);u&&i.filter(o)&&(r||!e.includes(o))&&n.push(o);var h=o.shadowRoot||typeof i.getShadowRoot=="function"&&i.getShadowRoot(o),f=!Lj(h,!1)&&(!i.shadowRootFilter||i.shadowRootFilter(o));if(h&&f){var m=t(h===!0?o.children:h.children,!0,i);i.flatten?n.push.apply(n,m):n.push({scopeParent:o,candidates:m})}else s.unshift.apply(s,o.children)}}return n},MHe=function(e,r){return e.tabIndex<0&&(r||/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||jZt(e))&&isNaN(parseInt(e.getAttribute("tabindex"),10))?0:e.tabIndex},GZt=function(e,r){return e.tabIndex===r.tabIndex?e.documentOrder-r.documentOrder:e.tabIndex-r.tabIndex},$He=function(e){return e.tagName==="INPUT"},HZt=function(e){return $He(e)&&e.type==="hidden"},qZt=function(e){var r=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(i){return i.tagName==="SUMMARY"});return r},WZt=function(e,r){for(var i=0;i<e.length;i++)if(e[i].checked&&e[i].form===r)return e[i]},XZt=function(e){if(!e.name)return!0;var r=e.form||Ij(e),i=function(a){return r.querySelectorAll('input[type="radio"][name="'+a+'"]')},n;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")n=i(window.CSS.escape(e.name));else try{n=i(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var s=WZt(n,e.form);return!s||s===e},YZt=function(e){return $He(e)&&e.type==="radio"},ZZt=function(e){return YZt(e)&&!XZt(e)},JZt=function(e){var r,i=e&&Ij(e),n=(r=i)===null||r===void 0?void 0:r.host,s=!1;if(i&&i!==e){var o,a,l;for(s=!!((o=n)!==null&&o!==void 0&&(a=o.ownerDocument)!==null&&a!==void 0&&a.contains(n)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!s&&n;){var c,u,h;i=Ij(n),n=(c=i)===null||c===void 0?void 0:c.host,s=!!((u=n)!==null&&u!==void 0&&(h=u.ownerDocument)!==null&&h!==void 0&&h.contains(n))}}return s},mRe=function(e){var r=e.getBoundingClientRect(),i=r.width,n=r.height;return i===0&&n===0},KZt=function(e,r){var i=r.displayCheck,n=r.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var s=EE.call(e,"details>summary:first-of-type"),o=s?e.parentElement:e;if(EE.call(o,"details:not([open]) *"))return!0;if(!i||i==="full"||i==="legacy-full"){if(typeof n=="function"){for(var a=e;e;){var l=e.parentElement,c=Ij(e);if(l&&!l.shadowRoot&&n(l)===!0)return mRe(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=a}if(JZt(e))return!e.getClientRects().length;if(i!=="legacy-full")return!0}else if(i==="non-zero-area")return mRe(e);return!1},QZt=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var r=e.parentElement;r;){if(r.tagName==="FIELDSET"&&r.disabled){for(var i=0;i<r.children.length;i++){var n=r.children.item(i);if(n.tagName==="LEGEND")return EE.call(r,"fieldset[disabled] *")?!0:!n.contains(e)}return!0}r=r.parentElement}return!1},Dj=function(e,r){return!(r.disabled||Lj(r)||HZt(r)||KZt(r,e)||qZt(r)||QZt(r))},hse=function(e,r){return!(ZZt(r)||MHe(r)<0||!Dj(e,r))},eJt=function(e){var r=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(r)||r>=0)},tJt=function t(e){var r=[],i=[];return e.forEach(function(n,s){var o=!!n.scopeParent,a=o?n.scopeParent:n,l=MHe(a,o),c=o?t(n.candidates):a;l===0?o?r.push.apply(r,c):r.push(a):i.push({documentOrder:s,tabIndex:l,item:n,isScope:o,content:c})}),i.sort(GZt).reduce(function(n,s){return s.isScope?n.push.apply(n,s.content):n.push(s.content),n},[]).concat(r)},rJt=function(e,r){r=r||{};var i;return r.getShadowRoot?i=PHe([e],r.includeContainer,{filter:hse.bind(null,r),flatten:!1,getShadowRoot:r.getShadowRoot,shadowRootFilter:eJt}):i=AHe(e,r.includeContainer,hse.bind(null,r)),tJt(i)},pRr=function(e,r){r=r||{};var i;return r.getShadowRoot?i=PHe([e],r.includeContainer,{filter:Dj.bind(null,r),flatten:!0,getShadowRoot:r.getShadowRoot}):i=AHe(e,r.includeContainer,Dj.bind(null,r)),i},fRr=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return EE.call(e,$j)===!1?!1:hse(r,e)},iJt=RHe.concat("iframe").join(","),mRr=function(e,r){if(r=r||{},!e)throw new Error("No node provided");return EE.call(e,iJt)===!1?!1:Dj(r,e)};const nJt={getShadowRoot:!0};function gRr(t){const e="dir",r=`[${e}]`,i=sJt(t,r);return i?i.getAttribute(e):"ltr"}function yRr(t,e,r){const i=`[${e}]`,n=t.closest(i);return n?n.getAttribute(e):r}function wfe(t){return t.getRootNode()}function vRr(t){const e=wfe(t);return"host"in e?e:null}function IHe(t){return t.host||null}function _Rr(t,{selector:e,id:r}){function i(n){if(!n)return null;n.assignedSlot&&(n=n.assignedSlot);const s=wfe(n),o=r?"getElementById"in s?s.getElementById(r):null:e?s.querySelector(e):null,a=IHe(s);return o||(a?i(a):null)}return i(t)}function sJt(t,e){function r(i){return i?i.closest(e)||r(IHe(wfe(i))):null}return r(t)}function oJt(t,e){return LHe(t,e)}function LHe(t,e){if(!t)return;const r=e(t);if(r!==void 0)return r;const{parentNode:i}=t;return LHe(i instanceof ShadowRoot?i.host:i,e)}function bRr(t,e){return!!oJt(e,r=>r===t?!0:void 0)}function aJt(t){return typeof(t==null?void 0:t.setFocus)=="function"}async function wRr(t){if(t)return aJt(t)?t.setFocus():t.focus()}function xRr(t){t&&(rJt(t,nJt)[0]||t).focus()}const m4=":not([slot])";function SRr(t,e,r){e&&!Array.isArray(e)&&typeof e!="string"&&(r=e,e=null);const i=e?Array.isArray(e)?e.map(n=>`[slot="${n}"]`).join(","):`[slot="${e}"]`:m4;return r!=null&&r.all?lJt(t,i,r):cJt(t,i,r)}function DHe(t,e){return t?Array.from(t.children||[]).filter(r=>r==null?void 0:r.matches(e)):[]}function lJt(t,e,r){let i=e===m4?DHe(t,m4):Array.from(t.querySelectorAll(e));i=r&&r.direct===!1?i:i.filter(s=>s.parentElement===t),i=r!=null&&r.matches?i.filter(s=>s==null?void 0:s.matches(r.matches)):i;const n=r==null?void 0:r.selector;return n?i.map(s=>Array.from(s.querySelectorAll(n))).reduce((s,o)=>[...s,...o],[]).filter(s=>!!s):i}function cJt(t,e,r){let i=e===m4?DHe(t,m4)[0]||null:t.querySelector(e);i=r&&r.direct===!1||(i==null?void 0:i.parentElement)===t?i:null,i=r!=null&&r.matches?i!=null&&i.matches(r.matches)?i:null:i;const n=r==null?void 0:r.selector;return n?i==null?void 0:i.querySelector(n):i}function TRr(t,e,r){if(typeof e=="string"&&e!=="")return e;if(e==="")return t[r]}function ERr(t){return(!!t).toString()}function CRr(t){return!!uJt(t).length}function uJt(t){return t.target.assignedElements({flatten:!0})}function RRr(t){return!!(t.isPrimary&&t.button===0)}/*!
 * All material copyright ESRI, All Rights Reserved, unless otherwise specified.
 * See https://github.com/Esri/calcite-components/blob/master/LICENSE.md for details.
 * v1.4.3
 */function gRe(){const{classList:t}=document.body,e=window.matchMedia("(prefers-color-scheme: dark)").matches,r=()=>t.contains(CHe)||t.contains(EHe)&&e?"dark":"light",i=o=>document.body.dispatchEvent(new CustomEvent("calciteModeChange",{bubbles:!0,detail:{mode:o}})),n=o=>{s!==o&&i(o),s=o};let s=r();i(s),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",o=>n(o.matches?"dark":"light")),new MutationObserver(()=>n(r())).observe(document.body,{attributes:!0,attributeFilter:["class"]})}function dJt(){typeof window<"u"&&typeof location<"u"&&typeof document<"u"&&window.location===location&&window.document===document&&(document.readyState==="interactive"?gRe():document.addEventListener("DOMContentLoaded",()=>gRe(),{once:!0}))}const hJt=dJt;hJt();let NHe;function pJt(){try{KYt(".")}catch{QYt(ah(fi(NHe)))}}function xfe(t){var r;const e=[];for(const i of Object.keys(t))customElements.get(`calcite-${i}`)||e.push((r=t[i])==null?void 0:r.call(t));return Promise.all(e)}NHe="components/assets";const FHe=Symbol("widget"),fJt=Symbol("widget-test-data"),mJt=[],gJt={},Nj=new WeakMap;function kHe(t,e){let r=e.children;if(r&&r.length)for(let n=0;n<r.length;++n)r[n]=kHe(t,r[n]);else r=mJt;const i=e.vnodeSelector;if(Sfe(i)){const n=e.properties||gJt,s=n.key||i;return{vnodeSelector:"div",properties:{key:s,afterCreate:yJt,afterUpdate:vJt,afterRemoved:UHe,parentWidget:t,widgetConstructor:i,widgetProperties:{...n,key:s,children:r}},children:void 0,text:void 0,domNode:null}}return e}function yJt(t,e,r,{parentWidget:i,widgetConstructor:n,widgetProperties:s}){var a;const o=new n(s);o.container=t,Nj.set(t,o),(a=o.afterCreate)==null||a.call(o,o,t),i._internalHandles.add(kl(()=>UHe(t)))}function vJt(t,e,r,{widgetProperties:i}){var s;const n=Nj.get(t);n&&(n.set(i),(s=n.afterUpdate)==null||s.call(n,n,t))}function UHe(t){var r;const e=Nj.get(t);e&&((r=e.afterRemoved)==null||r.call(e,e,t),e.destroy(),Nj.delete(t))}function Sfe(t){return typeof t=="function"&&t[FHe]}const yRe=new Set;function _Jt(t){yRe.add(t),t.finally(()=>yRe.delete(t))}var zHe;const bJt="esri.widgets.Widget";let wJt=0;const xJt={widgetIcon:"esri-icon-checkbox-unchecked"};function VHe(t,e){for(const r in e)t[r]!=null&&(typeof t[r]=="object"&&typeof e[r]=="object"?VHe(t[r],e==null?void 0:e[r]):t[r]=e[r]);return t}const SJt=JYt({postProcessProjectionOptions(t){const e=t.eventHandlerInterceptor,r=/capture$/i;t.eventHandlerInterceptor=(i,n,s,o)=>{const a=e==null?void 0:e(i,n,s,o),l=r.test(i);if(!((i=i.replace(r,"")).toLowerCase()in s)||l){const c=i[2].toLowerCase()+i.slice(3),u=m=>a==null?void 0:a.call(s,m);s.addEventListener(c,u,l);const h=()=>s.removeEventListener(c,u,l),f=o.afterRemoved;o.afterRemoved=m=>{f==null||f(m),h()}}return a}},handleInterceptedEvent(t,e,r,i){const{eventPhase:n,type:s}=i,o=n===Event.CAPTURING_PHASE;let a=`on${s}${o?"capture":""}`;const l=e.properties;(l&&a in l||(a=`on${s[0].toUpperCase()}${s.slice(1)}${o?"Capture":""}`,l&&a in l))&&(bke(),t.scheduleRender(),l[a].call(l.bind||r,i))}});let yJ=!1,Zo=class extends G4(pn.EventedAccessor){constructor(e,r){super(e,r),this._attached=!1,this._internalHandles=new Ri,this._projector=SJt,this._readyForTrueRender=!1,this.iconClass=xJt.widgetIcon,this.icon=null,this.key=this,this._loadLocale=B4(async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const o=await ou(this._messageBundleProps.map(async({bundlePath:a,propertyName:l})=>{if(this.destroyed)return;let c=await XIe(a);this.uiStrings&&Object.keys(this.uiStrings)&&(c=VHe(ie(c),this.uiStrings)),this[l]=c}));if(this.destroyed)return;for(const a of o)a.error&&re.getLogger(this).error("widget-intl:locale-error",this.declaredClass,a.error)}await this.loadLocale()}),pJt();const i="esri-widget-uid-"+k7(),n=this.render.bind(this);this._trackingTarget=new y7(()=>this.scheduleRender());const s=()=>{var u;if(!this._readyForTrueRender||this.destroyed)return null;const o=n();let{properties:a}=o;a||(o.properties=a={});const{key:l}=a;l||(a.key=i),this.visible?a.styles||(a.styles={}):(a.class="",a.styles={display:"none"}),a.styles.display||(a.styles.display="");let c=0;return(u=o.children)==null||u.forEach(h=>{if(Sfe(h.vnodeSelector))return;let{properties:f}=h;f||(h.properties=f={}),f.key||(f.key=`${this.id}--${c++}`)}),kHe(this,o)};this.render=()=>{if(yJ)return s();let o=z2t(this)??null;if(o)return o;this._trackingTarget.clear(),yJ=!0;try{o=C_(this._trackingTarget,s)}catch(a){throw console.error(a),a}finally{yJ=!1}return o&&V2t(this,o),o},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then(()=>{this._readyForTrueRender=!0,this._postInitialize()})),_Jt(this._resourcesFetch)}normalizeCtorArgs(e,r){const i={...e};return r&&(i.container=r),i}postInitialize(){}beforeFirstRender(){return Promise.all([this.loadDependencies(),this._loadLocale()]).then(()=>{}).catch(E0e)}async loadDependencies(){}async loadLocale(){}destroy(){this.destroyed||(qe(this._trackingTarget),qe(this.viewModel),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null,$X(this))}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return pH(e)}get domNode(){return this.container}set domNode(e){this.container=e}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+wJt++}set id(e){e&&this._set("id",e)}get label(){return this.declaredClass.split(".").pop()}set label(e){this._overrideIfSome("label",e)}get renderable(){return this._resourcesFetch}get visible(){return this._get("visible")}set visible(e){this._set("visible",e)}get[(zHe=FHe,fJt)](){return{projector:this._projector}}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||($X(this),this._projector.scheduleRender())}classes(...e){return q2t.apply(this,e)}renderNow(){$X(this),this._projector.renderNow()}_postInitialize(){var r;if(this.destroyed)return;this.scheduleRender(),(r=this._delegatedEventNames)!=null&&r.length&&this._internalHandles.add(pe(()=>this.viewModel,(i,n)=>{n&&this._internalHandles.remove("delegated-events"),i&&f7(i)&&this._internalHandles.add(this._delegatedEventNames.map(s=>V4(i,s,o=>{this.emit(s,o)})),"delegated-events")},_r)),this.postInitialize();const e=async()=>{await this._loadLocale().catch(E0e),this.scheduleRender()};this._internalHandles.add([qIe(e),pe(()=>this.uiStrings,e),du(()=>this.container,i=>{this.destroyed||this._attach(i)},{initial:!0,once:!0})])}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){var r;this._attached&&(this._projector.detach(this.render),this._attached=!1),(r=e==null?void 0:e.parentNode)==null||r.removeChild(e)}};Zo[zHe]=!0,d([p()],Zo.prototype,"_readyForTrueRender",void 0),d([p({value:null})],Zo.prototype,"container",null),d([ur("container")],Zo.prototype,"castContainer",null),d([p()],Zo.prototype,"iconClass",void 0),d([p()],Zo.prototype,"icon",void 0),d([p()],Zo.prototype,"id",null),d([p()],Zo.prototype,"label",null),d([p()],Zo.prototype,"renderable",null),d([p()],Zo.prototype,"uiStrings",void 0),d([p()],Zo.prototype,"viewModel",void 0),d([p({value:!0})],Zo.prototype,"visible",null),d([p()],Zo.prototype,"key",void 0),d([p()],Zo.prototype,"children",void 0),d([p()],Zo.prototype,"afterCreate",void 0),d([p()],Zo.prototype,"afterUpdate",void 0),d([p()],Zo.prototype,"afterRemoved",void 0),Zo=d([I(bJt)],Zo);const l1=Zo;function vRe(t,e){return t&&"copyright"in t&&(!e||typeof t.originOf=="function"&&t.originOf("copyright")==="user")}function TJt(t,e){return t.length!==e.length||t.some((r,i)=>r.text!==e[i].text)}function wU(t,e,r){!r||!e||t.find(i=>i.layerView===e&&i.text===r)||t.push({text:r,layerView:e})}function EJt(t){return t.type==="bing-maps"}const W1=[];let sO=class extends aE{constructor(e){super(e),this._clear=()=>{this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.handles.remove("suspension"),this.notifyChange("state")},this._pendingAttributions=new Set,this._fetchedAttributionData=new Map,this.items=new vt,this.view=null,this._allLayerViewsChange=r=>{this.handles.remove("suspension");const i=this.get("view.allLayerViews");i&&this.handles.add(i.map(n=>pe(()=>{var s;return[n.suspended,(s=n.layer)==null?void 0:s.attributionVisible]},()=>this._updateAttributionItems())),"suspension"),r&&r.removed&&r.removed.forEach(n=>{this._pendingAttributions.delete(n),this._fetchedAttributionData.delete(n)}),this._updateAttributionItems()},this.handles.add([da(()=>{var r;return(r=this.view)==null?void 0:r.allLayerViews},"change",r=>this._allLayerViewsChange(r),{onListenerAdd:()=>this._allLayerViewsChange(),onListenerRemove:this._clear}),du(()=>{var r;return((r=this.view)==null?void 0:r.stationary)===!0},()=>this._updateAttributionItems())])}destroy(){this.view=null,this._fetchedAttributionData.clear(),this._pendingAttributions.clear(),this.items.removeAll()}get state(){return this.get("view.ready")?this._pendingAttributions.size>0?"loading":"ready":"disabled"}_updateAttributionItems(){const e=this.view,r=e==null?void 0:e.allLayerViews;W1.length=0,e&&r?(r.forEach(i=>{var o;if(i.suspended||!((o=i.layer)!=null&&o.attributionVisible))return;const n=i.layer;if(vRe(n,"user"))return void wU(W1,i,n.copyright);if(n.hasAttributionData){if(this._fetchedAttributionData.has(i)){const a=this._fetchedAttributionData.get(i);return void(a?wU(W1,i,this._getDynamicAttribution(a,e,n)):vRe(n)&&wU(W1,i,n.copyright))}return void this._fetchAttributionData(i)}const s=n.get("portalItem.accessInformation");wU(W1,i,s||n.copyright)}),TJt(this.items,W1)&&(this.items.removeAll(),this.items.addMany(W1)),W1.length=0,this.notifyChange("state")):this._clear()}async _fetchAttributionData(e){if(this._pendingAttributions.has(e))return;this._pendingAttributions.add(e);const r=await wd(e.layer.fetchAttributionData());if(this._pendingAttributions.has(e)){const i=r.ok?this._createContributionIndex(r.value,EJt(e.layer)):null;this._pendingAttributions.delete(e),this._fetchedAttributionData.set(e,i)}this._updateAttributionItems()}_createContributionIndex(e,r){const i=e.contributors,n={};if(!i)return n;for(let s=0;s<i.length;s++){const o=i[s],a=o.coverageAreas;if(!a)return;for(const l of a){const c=l.bbox,u=l.zoomMin-(r&&l.zoomMin?1:0),h=l.zoomMax-(r&&l.zoomMax?1:0),f=new $r({xmin:c[1],ymin:c[0],xmax:c[3],ymax:c[2],spatialReference:dt.WGS84}),m={extent:bA(f),attribution:o.attribution||"",score:l.score!=null?l.score:100,id:s};for(let g=u;g<=h;g++)n[g]??(n[g]=[]),n[g].push(m)}}return n.maxKey=Math.max.apply(null,Object.keys(n)),n}_getDynamicAttribution(e,r,i){var u;const{extent:n,scale:s}=r;let o=((u=i.tileInfo)==null?void 0:u.scaleToZoom(s))??0;if(o=Math.min(e.maxKey??0,Math.round(o)),!n||o==null||o<=-1)return"";const a=e[o],l=PE(n.center.clone().normalize(),r.spatialReference),c=new Set;return a?a.filter(h=>{const f=h.id,m=!c.has(f)&&l&&h.extent&&Oce(h.extent,l);return m&&c.add(f),m}).sort((h,f)=>f.score-h.score||h.objectId-f.objectId).map(h=>h.attribution).join(", "):""}};d([p({readOnly:!0,type:vt})],sO.prototype,"items",void 0),d([p({readOnly:!0})],sO.prototype,"state",null),d([p()],sO.prototype,"view",void 0),sO=d([I("esri.widgets.Attribution.AttributionViewModel")],sO);const BHe=sO;function bq(){return function(t,e){if(!t[e])throw new TypeError(`Cannot auto bind undefined function '${String(e)}'`);return{value:RJt(t[e])}}}function CJt(t){const e=t==null?void 0:t.type;return t instanceof KeyboardEvent||e==="keyup"||e==="keydown"||e==="keypress"}function RJt(t){return function(e,...r){CJt(e)?Z2t(e.key)&&(e.preventDefault(),e.stopPropagation(),e.target.click()):t.call(this,e,...r)}}function XE(t){return(e,r)=>{e.hasOwnProperty("_messageBundleProps")||(e._messageBundleProps=e._messageBundleProps?e._messageBundleProps.slice():[]),e._messageBundleProps.push({bundlePath:t,propertyName:r})}}var OJt=function(t){return{vnodeSelector:"",properties:void 0,children:void 0,text:t.toString(),domNode:null}},jHe=function(t,e){for(var r=0,i=t.length;r<i;r++){var n=t[r];Array.isArray(n)?jHe(n,e):n!=null&&n!==!1&&(n.hasOwnProperty("vnodeSelector")||(n=OJt(n)),e.push(n))}},AJt=function(t,e){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(r.length===1&&typeof r[0]=="string")return{vnodeSelector:t,properties:e||void 0,children:void 0,text:r[0],domNode:null};var n=[];return jHe(r,n),{vnodeSelector:t,properties:e||void 0,children:n,text:void 0,domNode:null}};function ct(t,e,...r){return typeof t!="function"||Sfe(t)?AJt(t,e,...r):t(e,...r)}const pR="esri-attribution",X1={base:`${pR} esri-widget`,poweredBy:`${pR}__powered-by`,sources:`${pR}__sources`,open:`${pR}--open`,sourcesOpen:`${pR}__sources--open`,link:`${pR}__link`,widgetIcon:"esri-icon-description",interactive:"esri-interactive"};let lc=class extends l1{constructor(e,r){super(e,r),this._isOpen=!1,this._attributionTextOverflowed=!1,this._prevSourceNodeHeight=0,this._resizeObserver=new ResizeObserver(i=>i.forEach(({target:n})=>this._checkSourceTextOverflow(n))),this.iconClass=X1.widgetIcon,this.icon=null,this.itemDelimiter=" | ",this.messages=null,this.viewModel=new BHe}initialize(){this.addHandles(da(()=>{var e;return(e=this.viewModel)==null?void 0:e.items},"change",()=>this.scheduleRender()))}destroy(){var e;(e=this._resizeObserver)==null||e.disconnect()}get _isInteractive(){return this._isOpen||this._attributionTextOverflowed}get attributionText(){return this.viewModel.items.reduce((e,r)=>(e.includes(r.text)||e.push(r.text),e),[]).join(this.itemDelimiter)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){const e={[X1.open]:this._isOpen};return ct("div",{bind:this,class:this.classes(X1.base,e),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())}renderPoweredBy(){return ct("div",{class:X1.poweredBy},"Powered by"," ",ct("a",{class:X1.link,href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))}renderSourcesNode(){const e=this._isOpen,r=this._isInteractive,i=r?"0":"",{attributionText:n}=this,s={[X1.sourcesOpen]:e,[X1.interactive]:r};return ct("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes(X1.sources,s),innerHTML:n,tabindex:i})}_afterSourcesNodeCreate(e){this._prevSourceNodeHeight=e.clientWidth,this._resizeObserver.observe(e)}_checkSourceTextOverflow(e){let r=!1;const{clientHeight:i,clientWidth:n,scrollWidth:s}=e,o=s>n,a=this._attributionTextOverflowed!==o;if(this._attributionTextOverflowed=o,a&&(r=!0),this._isOpen){const l=i<this._prevSourceNodeHeight;this._prevSourceNodeHeight=i,l&&(this._isOpen=!1,r=!0)}r&&this.scheduleRender()}_toggleState(){this._isInteractive&&(this._isOpen=!this._isOpen)}};d([p()],lc.prototype,"_isOpen",void 0),d([p()],lc.prototype,"_isInteractive",null),d([p()],lc.prototype,"_attributionTextOverflowed",void 0),d([p()],lc.prototype,"_prevSourceNodeHeight",void 0),d([p({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],lc.prototype,"attributionText",null),d([p()],lc.prototype,"iconClass",void 0),d([p()],lc.prototype,"icon",void 0),d([p()],lc.prototype,"itemDelimiter",void 0),d([p()],lc.prototype,"label",null),d([p(),XE("esri/widgets/Attribution/t9n/Attribution")],lc.prototype,"messages",void 0),d([p()],lc.prototype,"view",null),d([p({type:BHe})],lc.prototype,"viewModel",void 0),d([bq()],lc.prototype,"_toggleState",null),lc=d([I("esri.widgets.Attribution")],lc);const PJt=lc,MJt=t=>{let e=class extends t{constructor(...r){super(...r),this.goToOverride=null,this.view=null}callGoTo(r){const{view:i}=this;return h7(i),this.goToOverride?this.goToOverride(i,r):i.goTo(r.target,r.options)}};return d([p()],e.prototype,"goToOverride",void 0),d([p()],e.prototype,"view",void 0),e=d([I("esri.widgets.support.GoTo")],e),e},$Jt="esri.widgets.CompassViewModel";let pT=class extends MJt(Ce){constructor(e){super(e),this._handles=new Ri,this.orientation={x:0,y:0,z:0},this.view=null,this._updateForCamera=this._updateForCamera.bind(this),this._updateForRotation=this._updateForRotation.bind(this),this._updateRotationWatcher=this._updateRotationWatcher.bind(this)}initialize(){this._handles.add(pe(()=>this.view,this._updateRotationWatcher,_r))}destroy(){yi(this._handles),this.view=null}get canShowNorth(){const e=this.get("view.spatialReference");return!(!e||!e.isWebMercator&&!e.isGeographic)}get state(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}reset(){var r;if(!this.get("view.ready"))return;const e={};((r=this.view)==null?void 0:r.type)==="2d"?e.rotation=0:e.heading=0,this.callGoTo({target:e})}_updateForRotation(e){e!=null&&(this.orientation={z:e})}_updateForCamera(e){if(!e)return;const r=-e.heading;this.orientation={x:0,y:0,z:r}}_updateRotationWatcher(e){this._handles.removeAll(),e&&this._handles.add(e.type==="2d"?pe(()=>e==null?void 0:e.rotation,this._updateForRotation,_r):pe(()=>e==null?void 0:e.camera,this._updateForCamera,_r))}};d([p({readOnly:!0})],pT.prototype,"canShowNorth",null),d([p()],pT.prototype,"orientation",void 0),d([p({readOnly:!0})],pT.prototype,"state",null),d([p()],pT.prototype,"view",void 0),pT=d([I($Jt)],pT);const GHe=pT,Y1={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};let nm=class extends l1{constructor(e,r){super(e,r),this.iconClass=Y1.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new GHe}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}reset(){return this.viewModel.reset()}render(){const{orientation:e,state:r}=this.viewModel,i=r==="disabled",n=(r==="rotation"?"rotation":"compass")=="compass",s=i?-1:0,o={[Y1.disabled]:i,[Y1.interactive]:!i},a={[Y1.northIcon]:n,[Y1.rotationIcon]:!n},{messages:l}=this;return ct("div",{bind:this,class:this.classes(Y1.base,o),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:s,"aria-label":l.reset,title:l.reset},ct("span",{"aria-hidden":"true",class:this.classes(Y1.icon,a),styles:this._toRotationTransform(e)}),ct("span",{class:Y1.text},l.reset))}_reset(){this.viewModel.reset()}_toRotationTransform(e){return{transform:`rotateZ(${e.z}deg)`}}};d([p()],nm.prototype,"goToOverride",null),d([p()],nm.prototype,"iconClass",void 0),d([p()],nm.prototype,"icon",void 0),d([p()],nm.prototype,"label",null),d([p(),XE("esri/widgets/Compass/t9n/Compass")],nm.prototype,"messages",void 0),d([p()],nm.prototype,"view",null),d([p({type:GHe})],nm.prototype,"viewModel",void 0),d([bq()],nm.prototype,"_reset",null),nm=d([I("esri.widgets.Compass")],nm);const IJt=nm,fR="esri-navigation-toggle",Zh={base:`${fR} esri-widget`,button:`${fR}__button esri-widget--button`,activeButton:`${fR}__button--active`,panButton:`${fR}__button--pan`,rotateButton:`${fR}__button--rotate`,isLayoutHorizontal:`${fR}--horizontal`,rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};let oO=class extends Ce{constructor(e){super(e),this.navigationMode="pan",this.view=null}initialize(){this.own(du(()=>{var e;return(e=this.view)==null?void 0:e.inputManager},()=>this._setNavigationMode()))}destroy(){this.view=null}get state(){var e;return this.get("view.ready")&&((e=this.view)==null?void 0:e.type)==="3d"?"ready":"disabled"}toggle(){this.state!=="disabled"&&(this.navigationMode=this.navigationMode!=="pan"?"pan":"rotate",this._setNavigationMode())}_setNavigationMode(){this.get("view.inputManager").primaryDragAction=this.navigationMode==="pan"?"pan":"rotate"}};d([p({readOnly:!0})],oO.prototype,"state",null),d([p()],oO.prototype,"navigationMode",void 0),d([p()],oO.prototype,"view",void 0),oO=d([I("esri.widgets.NavigationToggleViewModel")],oO);const HHe=oO;let sm=class extends l1{constructor(e,r){super(e,r),this.iconClass=Zh.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new HHe}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}toggle(){return this.viewModel.toggle()}render(){const e=this.get("viewModel.state")==="disabled",r=this.get("viewModel.navigationMode")==="pan",i={[Zh.disabled]:e,[Zh.isLayoutHorizontal]:this.layout==="horizontal"},n={[Zh.activeButton]:r},s={[Zh.activeButton]:!r},o=e?-1:0,a=this.messages.toggle;return ct("div",{bind:this,class:this.classes(Zh.base,i),onclick:this._toggle,onkeydown:this._toggle,tabIndex:o,"aria-label":a,title:a},ct("div",{class:this.classes(Zh.button,Zh.panButton,n)},ct("span",{class:Zh.panIcon})),ct("div",{class:this.classes(Zh.button,Zh.rotateButton,s)},ct("span",{class:Zh.rotationIcon})))}_toggle(){this.toggle()}};d([p()],sm.prototype,"iconClass",void 0),d([p()],sm.prototype,"icon",void 0),d([p()],sm.prototype,"label",null),d([p({value:"vertical"})],sm.prototype,"layout",null),d([p(),XE("esri/widgets/NavigationToggle/t9n/NavigationToggle")],sm.prototype,"messages",void 0),d([p()],sm.prototype,"view",null),d([p({type:HHe})],sm.prototype,"viewModel",void 0),d([bq()],sm.prototype,"_toggle",null),sm=d([I("esri.widgets.NavigationToggle")],sm);const LJt=sm,O$={button:"esri-widget--button esri-widget",disabled:"esri-disabled",interactive:"esri-interactive",iconText:"esri-icon-font-fallback-text",icon:"esri-icon"};let yv=class extends l1{constructor(){super(...arguments),this.enabled=!0,this.iconClass=null,this.icon=null,this.title=""}render(){const e=this.enabled?0:-1,r={[O$.disabled]:!this.enabled,[O$.interactive]:this.enabled};return ct("div",{bind:this,class:this.classes(O$.button,r),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:e,title:this.title},ct("span",{"aria-hidden":"true",role:"presentation",class:this.classes(O$.icon,this.iconClass??"")}),ct("span",{class:O$.iconText},this.title))}_triggerAction(){this.action.call(this)}};d([p()],yv.prototype,"action",void 0),d([p()],yv.prototype,"enabled",void 0),d([p()],yv.prototype,"iconClass",void 0),d([p()],yv.prototype,"icon",void 0),d([p()],yv.prototype,"title",void 0),d([bq()],yv.prototype,"_triggerAction",null),yv=d([I("esri.widgets.IconButton")],yv);const _Re=yv;let aO=class extends Ce{get canZoomIn(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMaxScale");return r===0||e>r}get canZoomOut(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),r=this.get("view.constraints.effectiveMinScale");return r===0||e<r}};d([p({readOnly:!0})],aO.prototype,"canZoomIn",null),d([p({readOnly:!0})],aO.prototype,"canZoomOut",null),d([p()],aO.prototype,"view",void 0),aO=d([I("esri.widgets.Zoom.ZoomConditions2D")],aO);const DJt=aO;let lO=class extends Ce{get canZoomIn(){return!!this.view.ready}get canZoomOut(){return!!this.view.ready}};d([p({readOnly:!0})],lO.prototype,"canZoomIn",null),d([p({readOnly:!0})],lO.prototype,"canZoomOut",null),d([p()],lO.prototype,"view",void 0),lO=d([I("esri.widgets.Zoom.ZoomConditions3D")],lO);const NJt=lO;let Sb=class extends Ce{constructor(e){super(e)}destroy(){this.view=null}get canZoomIn(){return this._zoomConditions!=null&&this._zoomConditions.canZoomIn}get canZoomOut(){var e;return this._zoomConditions!=null&&((e=this._zoomConditions)==null?void 0:e.canZoomOut)}get state(){var e;return(e=this.view)!=null&&e.ready?"ready":"disabled"}set view(e){e?e.type==="2d"?this._zoomConditions=new DJt({view:e}):e.type==="3d"&&(this._zoomConditions=new NJt({view:e})):this._zoomConditions=null,this._set("view",e)}zoomIn(){if(!this.canZoomIn)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomIn():gQ(e.goTo({zoomFactor:2}))}zoomOut(){if(!this.canZoomOut)return;const e=this.view;e.type==="2d"?e.mapViewNavigation.zoomOut():gQ(e.goTo({zoomFactor:.5}))}};d([p()],Sb.prototype,"_zoomConditions",void 0),d([p()],Sb.prototype,"canZoomIn",null),d([p()],Sb.prototype,"canZoomOut",null),d([p({readOnly:!0})],Sb.prototype,"state",null),d([p()],Sb.prototype,"view",null),Sb=d([I("esri.widgets.Zoom.ZoomViewModel")],Sb);const qHe=Sb,A$={base:"esri-zoom esri-widget",horizontalLayout:"esri-zoom--horizontal",zoomInIcon:"esri-icon-plus",zoomOutIcon:"esri-icon-minus",widgetIcon:"esri-icon-zoom-in-magnifying-glass"};let hy=class extends l1{constructor(e,r){super(e,r),this.iconClass=A$.widgetIcon,this.icon=null,this.messages=null,this.viewModel=new qHe}initialize(){this._zoomInButton=new _Re({action:this.zoomIn.bind(this),iconClass:A$.zoomInIcon}),this._zoomOutButton=new _Re({action:this.zoomOut.bind(this),iconClass:A$.zoomOutIcon})}destroy(){this._zoomInButton=qe(this._zoomInButton),this._zoomOutButton=qe(this._zoomOutButton)}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}set layout(e){e!=="horizontal"&&(e="vertical"),this._set("layout",e)}set view(e){this.viewModel.view=e}get view(){return this.viewModel.view}render(){const e=this.viewModel,r={[A$.horizontalLayout]:this.layout==="horizontal"},{canZoomIn:i,canZoomOut:n}=e;this._zoomInButton.enabled=i,this._zoomOutButton.enabled=n;const{zoomIn:s,zoomOut:o}=this.messages;return this._zoomInButton.title=s,this._zoomOutButton.title=o,ct("div",{class:this.classes(A$.base,r)},this._zoomInButton.render(),this._zoomOutButton.render())}zoomIn(){return this.viewModel.zoomIn()}zoomOut(){return this.viewModel.zoomOut()}};d([p()],hy.prototype,"iconClass",void 0),d([p()],hy.prototype,"icon",void 0),d([p()],hy.prototype,"label",null),d([p({value:"vertical"})],hy.prototype,"layout",null),d([p(),XE("esri/widgets/Zoom/t9n/Zoom")],hy.prototype,"messages",void 0),d([p()],hy.prototype,"view",null),d([p({type:qHe})],hy.prototype,"viewModel",void 0),hy=d([I("esri.widgets.Zoom")],hy);const FJt=hy;function kJt(t){return(t==null?void 0:t.view)!==void 0}let Qz=class extends HYt{constructor(e){super(e),this._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"},this.components=[],this._updateViewAwareWidgets=r=>{this.components.forEach(i=>{const n=this._find(i),s=n==null?void 0:n.widget;kJt(s)&&(s.view=r)})},this._componentsWatcher=(r,i)=>{this._removeComponents(i),this._addComponents(r),this._adjustPadding(r)}}initialize(){this.addHandles([pe(()=>this.components,this._componentsWatcher,_r),pe(()=>this.view,this._updateViewAwareWidgets,_r)])}_add(e,r,i,n,s){let o=e;if(typeof e=="string"&&this._defaultPositionLookup[e]){if(this._find(e))return;o=this._createComponent(e)}super._add(o,r,i,n,s)}_removeComponents(e){e.forEach(r=>{const i=this._find(r);i&&(this.remove(i),i.destroy())})}_adjustPadding(e){if(!e.includes("attribution")&&!this._isOverridden("padding")){const{top:r}=this.padding;this.padding=r}}_addComponents(e){this.constructed&&e.forEach(r=>this.add(this._createComponent(r),this._defaultPositionLookup[r]))}_createComponent(e){const r=this._createWidget(e);return new Kz({id:e,node:r})}_createWidget(e){const{view:r}=this;switch(e){case"attribution":return new PJt({view:r});case"compass":return new IJt({view:r});case"navigation-toggle":return new LJt({view:r});case"zoom":return new FJt({view:r})}}};d([p()],Qz.prototype,"components",void 0),Qz=d([I("esri.views.ui.DefaultUI")],Qz);const WHe=Qz;let e9=class extends WHe{constructor(e){super(e),this.components=["attribution","zoom","navigation-toggle","compass"]}};d([p()],e9.prototype,"components",void 0),e9=d([I("esri.views.ui.3d.DefaultUI3D")],e9);const XHe=e9;let Tt=class extends WTt(kEt(dEt(sCt))){constructor(t){super(t),this._userClippingArea=null,this._clippingArea=null,this._initialDefaultSpatialReference=null,this._defaults={},this._externallySet={environment:!1},this._createGraphicsViewController=null,this._resolveWhenReady=[],this._propertiesPool=new N_({slicePlane:o5e},this),this._resourceController=wVt(this),this._defaultToMapOptions={include:new Set},this._defaultHitTestOptions={exclude:new Set},this.deconflictor=new Wie({view:this}),this.labeler=new sT({view:this,deconflictor:this.deconflictor.labels}),this.sharedSymbolResources=null,this.analyses=new kP,this.basemapTerrain=null,this.elevationProvider=null,this.canvas=null,this.constraints=new VT,this.environmentManager=new Jf,this.floors=new vt,this.fullOpacity=1,this.graphicsView=null,this.analysisViewManager=new lCt({view:this}),this.groundView=null,this.map=null,this.screenSizePerspectiveEnabled=!0,this.state=new F9t,this.spatialReference=null,this.alphaCompositingEnabled=!1,this.preserveDrawingBufferEnabled=!1,this.supersampleScreenshotsEnabled=!0,this.type="3d",this.ui=new XHe,this._numUpdating=0,this._lastUpdateTime=0,this.updatingProgress=.5,this.highlightOptions=new One,this.voxelWasm=null,this.voxelWasmPromise=null,MTt(),t&&t.environment||(this._defaults.environment=new BR,this.environment=this._defaults.environment);const e=(r=null)=>{r!=null&&r.type===Mi.MOVE||(this._updatingChanged(),this.map&&this.map.allLayers.forEach(async i=>{try{await i.when()}catch{}this._updatingChanged()}))};this.addHandles([da(()=>{var r;return(r=this.map)==null?void 0:r.allLayers},"after-changes",r=>e(r),{onListenerAdd:()=>e(),onListenerRemove:()=>e(),sync:!0}),this.allLayerViews.on("after-changes",r=>this._updateUpdatingMonitors(r)),pe(()=>this.map,r=>{r&&"load"in r&&r.load&&r.load().catch(()=>{})})]),this.inputManager=new WMt({view:this}),this.stateManager=new Ao({view:this})}initialize(){this.groundView=new CEt({view:this}),this._updateUpdatingMonitors();const t=()=>this._updateDefaultToMapOptions();this.addHandles(da(()=>{var e;return(e=this.map)==null?void 0:e.allLayers},"after-changes",t,{onListenerAdd:t,onListenerRemove:t})),this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,e=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=e)},_r),this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,e=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=e)},_r),this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,e=>mdt(e>0?1e3/Math.ceil(e):0),_r),this.updatingHandles.add(()=>{var e;return(e=this.map)==null?void 0:e.ground},t,Bi),this.updatingHandles.add(()=>{var e,r;return(r=(e=this.map)==null?void 0:e.ground)==null?void 0:r.opacity},()=>this._updateDefaultHitTestOptions(),Bi),this.addHandles(pe(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),li))}destroy(){var t;this.destroyed||(this.updatingHandles.removeAll(),this.removeAllHandles(),this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=qe(this.sharedSymbolResources),this._set("labeler",qe(this.labeler)),this._set("deconflictor",qe(this.deconflictor)),this._resourceController=qe(this._resourceController),this._set("stateManager",qe(this.stateManager)),this._set("inputManager",qe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.removeHandles("updatingMonitors"),this._set("environmentManager",qe(this.environmentManager)),this.groundView=qe(this.groundView),this._exitBasemapTerrain(),(t=this._stage)==null||t.destroy(),this.removeAllHandles(),this.updatingHandles.removeAll(),this.handles.removeAll())}get renderSpatialReference(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}get basemapSpatialReference(){var t;return(t=this.basemapTerrain)==null?void 0:t.spatialReference}get animation(){var t;return(t=this.state)==null?void 0:t.animation}get camera(){var t;return(t=this.stateManager)==null?void 0:t.camera}set camera(t){this.stateManager&&(this.stateManager.camera=t)}get contentCamera(){var t;return(t=this.stateManager)==null?void 0:t.contentCamera}set contentCamera(t){this.stateManager&&(this.stateManager.contentCamera=t)}installContentCameraReset(t={sticky:!1}){return this.stateManager.installContentCameraReset(t)}get center(){var t;return(t=this.stateManager)==null?void 0:t.center}set center(t){this.stateManager&&(this.stateManager.center=t)}get clippingArea(){var e;if(this.viewingMode==="global")return null;let t=this._userClippingArea||("clippingArea"in this.map?(e=this.map)==null?void 0:e.clippingArea:void 0);return!this._userClippingArea&&!this.get("map.clippingEnabled")||t==null?(this._clippingArea=null,null):t instanceof $r?this.spatialReference&&(t=xU(t,this.spatialReference),t==null)?(re.getLogger(this).error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea):(t=t.clone(),t.intersection(this._groundAndLayersExtent)==null&&(t.xmin=t.xmax,t.ymin=t.ymax),t.zmin=void 0,t.zmax=void 0,t.equals(this._clippingArea)||(this._clippingArea=t),this._clippingArea):(re.getLogger(this).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea)}set clippingArea(t){this.ready&&this.viewingMode==="global"&&t!=null?re.getLogger(this).error("#clippingArea=","Clipping area is only supported in local viewingMode"):this._userClippingArea=t}get renderDataExtent(){if(this.state.viewingMode===at.Global)return null;const t=this.renderSpatialReference,e=this.dataExtent;return e==null||t==null||e.spatialReference.equals(t)?e:xU(e,t)}get dataExtent(){let t=this._groundAndLayersExtent;const e=this.spatialReference||dt.WGS84,r=xU(this.clippingArea,e);r!=null&&(t=t!=null?t.intersection(r):r);const i=this._get("dataExtent");return t!=null&&t.equals(i)?i:t}get _groundAndLayersExtent(){const t=this.spatialReference||dt.WGS84;let e;const r=s=>{const o=xU(s,t);o!=null&&(e!=null?e.union(o):e=o.clone())},i=this.basemapTerrain;if(i!=null&&i.spatialReference){const s=i.groundExtent;r(new $r({xmin:s[0],ymin:s[1],zmin:0,xmax:s[2],ymax:s[3],zmax:0,spatialReference:i.spatialReference}))}if(this.map){const s=o=>{o.fullExtent==null||o.type==="graphics"&&o.internal||r(o.fullExtent)};this.map.allLayers.forEach(o=>s(o))}if(e==null)return null;e.hasZ?(e.zmin=Math.min(0,e.zmin??0),e.zmax=Math.max(0,e.zmax??0)):(e.zmin=0,e.zmax=0);const n=this._get("_groundAndLayersExtent");return e.equals(n)?n:e}set environment(t){t!==this._defaults.environment&&(this._externallySet.environment=!0),this._set("environment",t)}castEnvironment(t){return t?t instanceof BR?t:t instanceof TP?this.environment!=null?this.environment.cloneWithWebsceneEnvironment(t):BR.fromWebsceneEnvironment(t):ls(BR,t):new BR}get extent(){var t;return(t=this.stateManager)==null?void 0:t.extent}set extent(t){this.stateManager&&(this.stateManager.extent=t)}get screenCenter(){var t;return(t=this.stateManager)==null?void 0:t.screenCenter}get frustum(){var t;return(t=this.stateManager)==null?void 0:t.frustum}get initialExtentRequired(){return this.stateManager&&!this.stateManager.hasInitialView}get _defaultsFromMapSettings(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}get interacting(){var t;return this.navigating||(((t=this.toolViewManager)==null?void 0:t.interacting)??!1)}get stationary(){return!this.animation&&!this.resizing&&(this.state==null||this.state.stationary)}get navigating(){var t;return((t=this.state)==null?void 0:t.navigating)??!1}get padding(){var t;return(t=this.stateManager)==null?void 0:t.padding}set padding(t){this.stateManager&&(this.stateManager.padding=t)}set qualityProfile(t){Uz.isValidProfile(t)&&(Uz.apply(t,this.qualitySettings),this._set("qualityProfile",t))}get qualityProfile(){return this._get("qualityProfile")||Uz.getDefaultProfile()}set slicePlane(t){if(this._stage!=null&&this._stage.renderer.setParameters({slicePlane:t}),t==null)return void this._set("slicePlane",null);const e=this._propertiesPool.get("slicePlane");VE(t,e),this._set("slicePlane",e)}get typeSpecificPreconditionsReady(){return!!this.viewingMode}get resolution(){return this.spatialReference!=null?kwt(this.scale,this.spatialReference):0}get scale(){var t;return(t=this.stateManager)==null?void 0:t.scale}set scale(t){this.stateManager&&(this.stateManager.scale=t)}get heightModelInfo(){const t=this.getDefaultHeightModelInfo();return t!=null?q_.deriveUnitFromSR(t,this.spatialReference):null}get updating(){var n,s,o;if(this.destroyed)return!1;let t=0,e=this.layerViewManager.updating,r=e?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(a=>{if(a.isFulfilled()){if(a.updating){if(e=!0,a.suspended||o4(a))return;++r,t+=a.updatingProgress}}else++r});for(const a of this._updatingObjects)a!=null&&a.updating&&(r+=.1,t+=.5*.1);for(const a of this._updatingObjectsWithProgress)a!=null&&a.updating&&(++r,t+=a.updatingProgress);const i=!this.stateManager.test.updatingIgnoreRenderState&&this.state.updating;if(e=!!(e||r>0||this.updatingHandles.updating||!this.ready||!this.stationary||i||this._createGraphicsViewController||(n=this.inputManager)!=null&&n.updating||(o=(s=this.map)==null?void 0:s.allLayers)!=null&&o.some(a=>!a.isFulfilled())),e?(this._numUpdating=Math.max(r,this._numUpdating),t+=this._numUpdating-r):this._numUpdating=0,this._numUpdating>0?t/=this._numUpdating:t=e?0:1,this._get("updatingProgress")!==t){const a=performance.now();if(t<1){const l=Math.min((a-this._lastUpdateTime)/2e3,1);t=this.updatingProgress*(1-l)+t*l}this._set("updatingProgress",t),this._lastUpdateTime=e&&t<1?a:0}return e}get _updatingObjects(){return[this.graphicsView,this.basemapView,this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager]}get _updatingObjectsWithProgress(){return[this.deconflictor,this.labeler,this.basemapTerrain]}get viewingMode(){var r;const t=this._predeterminedViewingMode;if(t!=null)return sX(t);const e=this.spatialReference;return e?((r=this.defaultsFromMap)==null?void 0:r.viewingMode)!=null&&e.equals(this.defaultsFromMap.spatialReference)?sX(this.defaultsFromMap.viewingMode):ON(e,at.Global)?"global":"local":"global"}set viewingMode(t){this.ready?re.getLogger(this).error("#viewingMode","viewingMode cannot be set once view is ready"):this._overrideIfSome("viewingMode",t)}get viewpoint(){var t;return(t=this.stateManager)==null?void 0:t.viewpoint}set viewpoint(t){this.stateManager&&(this.stateManager.viewpoint=t)}get zoom(){return this.stateManager.zoom}set zoom(t){this.stateManager&&(this.stateManager.zoom=t)}get resourceController(){return this._resourceController}get performanceInfo(){return new WVt(this)}on(t,e,r,i){return this.viewEvents.on(t,e,r,i)||super.on(t,e)}hasEventListener(t){return super.hasEventListener(t)||this.viewEvents.hasHandler(t)}toMap(t,e){if(!this.ready)return re.getLogger(this).error("#toMap()","Scene view cannot be used before it is ready"),null;const r=e?this.externalToInternalIntersectOptions(e):this._defaultToMapOptions,i=r.graphics!=null&&(r.graphics.include!=null||r.graphics.exclude!=null),n=M1e(t)?P1e(this,t):t,s=Oy(n);r.enableDraped=r.include&&!r.include.has(Kb)||r.exclude&&r.exclude.has(Kb);const o=this.sceneIntersectionHelper,a=hf(this.state.viewingMode);if(a.options.selectionMode=!0,a.options.store=i?Ia.ALL:Ia.MIN,o.intersectIntersectorScreen(s,a,r),i){for(const l of a.results.all){const c=cse(l,this);if(c==null)return this._intersectResultToMapPoint(l);if(c.type!=="graphic"||this._testGraphicUidFilter(r.graphics,c.graphic))return this._intersectResultToMapPoint(l)}return null}return this._intersectResultToMapPoint(a.results.min)}toScreen(t){if(!this.ready)return re.getLogger(this).error("#toScreen()","Scene view cannot be used before it is ready"),null;const e=(t.z==null?Dy(this.elevationProvider,t):null)??0;return Na(t,mR,this.renderSpatialReference,e),this.state.camera.projectToScreen(mR,vJ),Oh(vJ[0],vJ[1])}pixelSizeAt(t){return this.ready?t?(Na(t,mR,this.renderSpatialReference),this.state.camera.computeScreenPixelSizeAt(mR)):0:(re.getLogger(this).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null)}overlayPixelSizeInMapUnits(t){const e=this.basemapTerrain.overlayManager;return e?e.overlayPixelSizeInMapUnits(t):1}hitTest(t,e){if(!this.ready)return re.getLogger(this).error("#hitTest()","Scene view cannot be used before it is ready"),null;const r=M1e(t)?P1e(this,t):t,i=Tn(r.x,r.y),n=e?this.externalToInternalIntersectOptions(e):this._defaultHitTestOptions;n.requiresGroundFeedback=!0,n.enableDraped=!0;const s=hf(this.state.viewingMode);s.options.selectionMode=!0,s.options.store=Ia.ALL,this.sceneIntersectionHelper.intersectIntersectorScreen(i,s,n);const o=this._intersectResultsToHits(s.results.all,n.graphics),a=s.results.ground,l=KCe(a,this),c=l!=null&&"type"in l&&l.type==="integrated-mesh"?l:null,u={screenPoint:r,results:o,ground:{mapPoint:this._intersectResultToMapPoint(a),distance:mg(a)?a.distanceInRenderSpace:0,layer:c}};return Di.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(u.intersector=s),Promise.resolve(u)}async popupHitTest(t){const{results:e,ground:r}=await SYt(this,t);let i=null;return!(e.length===0||Math.abs((e[0].distance??0)-r.distance)<1e-5)||r.layer&&r.layer.type==="integrated-mesh"||(i=r.mapPoint),{results:e,screenPoint:t,mapPoint:i}}goTo(t,e){return this.updatingHandles.addPromise(this.stateManager.goTo(t,e))}async whenAnalysisView(t){if(t.parent==null)throw new H("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:t});switch(t.parent.type){case"line-of-sight":case"dimension":return(await this.whenLayerView(t.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(t)}}whenLayerView(t){return super.whenLayerView(t)}async takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return uJ(r,e,this._pixelFormat())}async _takeScreenshot(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshot(e);return dJ(r,this._pixelFormat())}async _takeScreenshotWithObjectAndLayerId(t){const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e);return[dJ(r[0],this._pixelFormat()),dJ(r[1],this._pixelFormat())]}_completeSettings(t){const e=rYt(t,this);return e.pixelRatio/=this.state.pixelRatio,oYt(e,this.supersampleScreenshotsEnabled,this.padding)}_pixelFormat(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}}get test(){return{takeScreenshot:t=>this._takeScreenshot(t),takeScreenshotWithObjectAndLayerId:t=>this._takeScreenshotWithObjectAndLayerId(t)}}async takeScreenshotWithObjectAndLayerId(t){if(!he("enable-feature:objectAndLayerId-rendering"))throw new Error("has enable-feature:objectAndLayerId-rendering must be true");const e=this._completeSettings(t);await this.whenReady();const r=await this._stage.renderView.takeScreenshotWithOID(e),i=uJ(r[0],e,this._pixelFormat()),n=this._completeSettings(t);return n.format="png",[i,uJ(r[1],n,this._pixelFormat())]}getColorToObjectAndLayerIdMapping(){if(this._stage.renderView.objectAndLayerIdRenderHelper==null)throw new Error("has enable-feature:objectAndLayerId-rendering must be true");return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()}addUpdatingPromise(t){return this.updatingHandles.addPromise(t)}importLayerView(t){return F1e.importLayerView(t)}hasLayerViewModule(t){return F1e.hasLayerViewModule(t)}forceDOMReadyCycle(){this.forceReadyCycle()}getDefaultSpatialReference(){var t,e,r,i;return this.map&&"initialViewProperties"in this.map&&((e=(t=this.map)==null?void 0:t.initialViewProperties)==null?void 0:e.spatialReference)||((r=this.defaultsFromMap)==null?void 0:r.spatialReference)||((i=this.defaultsFromMap)==null?void 0:i.ready)&&this._initialDefaultSpatialReference||null}async validate(){let t=DYt(this.type);const e=he("safari");if(e&&e<9&&(t=new H("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari < 9)",{type:"safari",requiredVersion:9,detectedVersion:e})),t!=null)throw re.getLogger(this).warn("#validate()",t.message),t}get _predeterminedViewingMode(){var e;const t=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?(e=this.map.initialViewProperties)==null?void 0:e.viewingMode:null)??null;return t!=null?Ove(t):null}getSpatialReferenceSupport({spatialReference:t,layer:e}){const r=this._predeterminedViewingMode;if(r!=null)return this._validateSpatialReferenceForViewingMode(t,e,r)?{constraints:this._makeSpatialReferenceConstraints(t,e,r)}:null;const i=this._validateSpatialReferenceForViewingMode(t,e,at.Local),n=this._validateSpatialReferenceForViewingMode(t,e,at.Global);return i||n?i&&n?{constraints:this._makeSpatialReferenceConstraints(t,e,null)}:i?{constraints:this._makeSpatialReferenceConstraints(t,e,at.Local)}:{constraints:this._makeSpatialReferenceConstraints(t,e,at.Global)}:null}_validateSpatialReferenceForViewingMode(t,e,r){return!!ON(t,r)&&(e==null||!!nve(e)||(!tD(e)||uq(e,t,r)!=null)&&(!ive(e)||r!==at.Global))}_makeSpatialReferenceConstraints(t,e,r){if(e==null)return[{spatialReference:t,viewingMode:r}];const i=t.isWebMercator,n=t.isWGS84;return nve(e)&&(i||n)?!n||r===at.Local||Wpe(e.tileInfo,e.fullExtent,t,at.Global)===null?[{spatialReference:t,viewingMode:r},{spatialReference:dt.WebMercator,viewingMode:r}]:[{spatialReference:i?dt.WGS84:dt.WebMercator,viewingMode:r}]:tD(e)||ive(e)||!i&&!n?tD(e)&&i&&r!==at.Global?[{spatialReference:t,viewingMode:r},{spatialReference:dt.WGS84,viewingMode:at.Local}]:[{spatialReference:t,viewingMode:r}]:[{spatialReference:t,viewingMode:r},{spatialReference:i?dt.WGS84:dt.WebMercator,viewingMode:r}]}_validateSpatialReference(t){const e=this.getSpatialReferenceSupport({spatialReference:t})!=null,r=this._predeterminedViewingMode;return e||(r!=null?re.getLogger(this).warnOnce(`Spatial reference defined on view not supported in ${sX(r)} viewing mode.`):t.isGeographic&&re.getLogger(this).warnOnce("Spatial reference is geographic but not supported.")),e}whenReady(){return new Promise(t=>{this.ready?t(this):this._resolveWhenReady.push(t)})}computeMapPointFromVec3d(t,e){let r=this.spatialReference||dt.WGS84;return Ys(t,this.renderSpatialReference,t,r)||(r=dt.WGS84,Ys(t,this.renderSpatialReference,t,r)),e?(e.x=t[0],e.y=t[1],e.z=t[2],e.spatialReference=r):e=new Gt(t,r),e}trackGraphicState(t){if(!t.graphic)return re.getLogger(this).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const e=this.getViewForGraphic(t.graphic);let r=null,i=!1;const n=s=>{var o;!i&&s!=null&&"processor"in s&&((o=s.processor)==null?void 0:o.type)==="graphics-3d"&&s.processor.graphicsCore&&(r=s.processor.graphicsCore.trackGraphicState(t))};return e!=null?n(e):this.whenViewForGraphic(t.graphic,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}highlight(t){if(Array.isArray(t))return E_(t.map(r=>this.highlight(r)));if(vt.isCollection(t))return E_(t.toArray().map(r=>this.highlight(r)));const e=this.getViewForGraphic(t);return e&&"highlight"in e?e.highlight(t):kl()}maskOccludee(t){if(!t)return re.getLogger(this).error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const e=this.getViewForGraphic(t);let r=null,i=!1;const n=s=>{!i&&s!=null&&RYt(s)&&(r=s.maskOccludee(t))};return e!=null?n(e):this.whenViewForGraphic(t,{waitForLayer:!0}).then(s=>n(s),()=>{}).catch(()=>{}),{remove:()=>{i=!0,r!=null&&(r.remove(),r=null)}}}getViewForGraphic(t){return t.layer===this.graphics?this.graphicsView:t.layer?this.allLayerViews.find(e=>e.layer===t.layer):null}graphicChanged(t){this.graphicsView!=null&&this.graphicsView.graphicChanged(t)}async whenViewForGraphic(t,e){if(t.layer===this)return await Zw(()=>this.graphicsView),this.graphicsView;if(!t.layer||!this.map)throw new H("no-view-for-graphic");return e&&e.waitForLayer&&!this.map.allLayers.includes(t.layer)?new Promise((r,i)=>{const n=this.map.allLayers.on("change",s=>{s.added.includes(t.layer)&&(n.remove(),this.whenLayerView(t.layer).then(r,i))})}):this.whenLayerView(t.layer)}externalToInternalIntersectOptions(t){const e=this._externalToInternalRenderItems(t.include,zD.INCLUDE),r=this._externalToInternalRenderItems(t.exclude,zD.EXCLUDE);return{include:e.layerUids,exclude:r.layerUids,graphics:{include:e.graphicUids,exclude:r.graphicUids}}}_intersectResultToMapPoint(t,e){return t.getIntersectionPoint(mR)?(e=this.computeMapPointFromVec3d(mR,e),t.intersector===Sn.TERRAIN&&this.basemapTerrain&&(e.z=Dy(this.basemapTerrain,e)??0),e):null}_intersectResultsToHits(t,e){const r=new Array;let i=null;for(let n=0;n<t.length;n++){const s=t[n],o=KCe(s,this);if(o!=null&&(o===this.map.ground||"type"in o&&o.type==="integrated-mesh"))break;const a=cse(s,this);if(a==null)continue;if(a.type==="graphic"){if(i==null&&n!==t.length-1&&(i=new Set),i!=null){const u=this._getGraphicFilterUid(a.graphic);if(i.has(u))continue;i.add(u)}if(!this._testGraphicUidFilter(e,a.graphic))continue}const l=this._intersectResultToMapPoint(s),c=s.distanceInRenderSpace;r.push({...a,mapPoint:l,distance:c})}return r}_getGraphicFilterUid(t){var n;const e=t.sourceLayer,r=t.layer,i=e&&"objectIdField"in e?e:r&&"objectIdField"in r?r:e;if(i){const s=i.objectIdField??HTt,o=(n=t.attributes)==null?void 0:n[s];if(o)return`o-${i.id}-${o}`}return`u-${t.uid}`}_testGraphicUidFilter(t,e){const r=this._getGraphicFilterUid(e);return t==null||(t.include==null||t.include.has(r))&&(t.exclude==null||!t.exclude.has(r))}_externalToInternalRenderItems(t,e,r={layerUids:void 0,graphicUids:void 0}){if(!t)return r;if(t instanceof cf)UJt(r,this._getGraphicFilterUid(t)),e===zD.INCLUDE&&(this.graphicsView!=null&&t.layer===this?P$(r,this.graphicsView.processor.layer.id):t.layer&&P$(r,t.layer.uid));else if(hQ(t))for(const i of t)i===this.graphics&&this.graphicsView!=null?P$(r,this.graphicsView.processor.layer.id):i===this.map.ground?P$(r,Kb):this._externalToInternalRenderItems(i,e,r);else"uid"in t&&P$(r,t.uid);return r}_initBasemapTerrain(){this._set("basemapTerrain",new v7t({view:this})),this._set("elevationProvider",new rL({view:this})),this.elevationProvider.register("ground",this.basemapTerrain)}_exitBasemapTerrain(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))}_initGlobe(){this._initCoordinateSystem(),this.state.createInitialCamera(),this._initBasemapTerrain(),this._set("pointsOfInterest",new Xc({view:this})),this._set("featureTiles",new Sa({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const t=()=>{var r;const e=(r=this.basemapTerrain)==null?void 0:r.extent;if(this.clippingArea||e)if(e&&this.basemapTerrain.spatialReference){const i=this.basemapTerrain.extent!=null&&this.basemapTerrain.spatialReference!=null?o0(C7(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null;this.clippingArea!=null?this.featureTiles.filterExtent=this.clippingArea.intersection(i):this.featureTiles.filterExtent=i}else this.featureTiles.filterExtent=this.clippingArea;else this.featureTiles.filterExtent=null};this.addHandles([this.updatingHandles.add(()=>Di.FEATURE_TILE_TREE_SHOW_TILES,e=>{e&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(le(()=>import("./FeatureTileTree3DDebugger-ad34fa89.js"),["assets/FeatureTileTree3DDebugger-ad34fa89.js","assets/TileTreeDebugger-3f75e0c2.js"])).then(({FeatureTileTree3DDebugger:r})=>{!this._featureTreeDebugger&&Di.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new r({view:this}))}):e||!this._featureTreeDebugger||Di.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},Bi),this.updatingHandles.add(()=>this.clippingArea,t,Bi),this.updatingHandles.add(()=>this.basemapTerrain.extent,t,Bi)],"feature-tiles"),this.stateManager.init()}_exitGlobe(){this.state&&(this.stateManager.exit(),this.removeHandles("render-coords-helper"),this.removeHandles("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())}_initCoordinateSystem(){if(this.spatialReference){const t=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(t)||this._set("mapCoordsHelper",new iVt(this.map,t));const e=this.state.isGlobal,r=GTt(e,t);r!==this.renderSpatialReference&&(this._set("renderCoordsHelper",aVt.create(this.state.viewingMode,r)),e||this.addHandles(pe(()=>{var i;return(i=this.basemapTerrain)==null?void 0:i.extent},i=>{const n=this.renderCoordsHelper.spatialReference;i==null||i[0]===0&&i[1]===0&&i[2]===0&&i[3]===0||!rF(i,this.basemapTerrain.spatialReference,bRe,n)||(this.renderCoordsHelper.extent=bRe)},li),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(DP/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)}_exitCoordinateSystem(){this.mapCoordsHelper&&(this.removeHandles("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))}_updatingChanged(){this.notifyChange("updating")}_updateUpdatingMonitors(t=null){t!=null&&t.type===Mi.MOVE||(this.removeHandles("updatingMonitors"),this.allLayerViews.forEach(e=>{e.destroyed||(this.addHandles(pe(()=>[e.updating,e.updatingProgress],()=>this._updatingChanged(),li),"updatingMonitors"),e.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())}async _prepareScreenshotOverlay(){this.overlay&&await this.overlay.prepare()}_renderScreenshotOverlay(t,e){if(!this.overlay||!this.overlay.hasVisibleItems)return e;const r=t.getContext("2d");return r.putImageData(e,0,0),this.overlay.renderCanvas(t),r.getImageData(0,0,e.width,e.height)}_initStage(){const t={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(n,s)=>this._renderScreenshotOverlay(n,s)}},e=new k9t(this.state.viewingMode,n=>this._stage.layers.forAll(n),this);this._set("sceneIntersectionHelper",e);const r=pH(this.surface);this._stage=new jd({view:this,options:t,container:r}),this._stage.renderer.setParameters({slicePlane:this.slicePlane}),this.addHandles([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),_r),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,n=>this._stage.renderer.setParameters({highQualityTransparency:n}),_r),pe(()=>this.magnifier,n=>this._stage.renderView.magnifier=n,Bi),this.on("pointer-move",()=>{var n;return(n=this._stage)==null?void 0:n.renderer.resetAnimation()}),V4(this._stage.renderView.canvas,"webglcontextlost",n=>this.fatalError=new H("webgl-context-lost",n.statusMessage))],"stage");const i=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:One.toEngineOptions(this.highlightOptions)})};this.addHandles(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],i),"stage"),i(),this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(DP/this.renderCoordsHelper.unitInMeters),this._set("canvas",this._stage.renderView.canvas)}_exitStage(){this._set("sceneIntersectionHelper",null),this._stage=qe(this._stage),this.removeHandles("stage"),this._set("canvas",null)}_initSurface(t){this._exitSurface(),this.state.init(t,this.spatialReference),this._initStage(),this._initGlobe(),this.sharedSymbolResources=new ZVt({view:this,viewingMode:t,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})}_exitSurface(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())}_createGraphicsViewIfNeeded(){if(this.graphicsView||this._createGraphicsViewController||this.graphics.length===0)return;this.removeHandles("graphics-view"),this._createGraphicsViewController=new AbortController;const t=()=>{this._createGraphicsViewController=null,this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(t,t),this._updatingChanged()}async _createGraphicsViewAsync(t){const e=(await le(()=>import("./GraphicsView3D-1fd76543.js"),["assets/GraphicsView3D-1fd76543.js","assets/GraphicsProcessor-e1abb931.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js"])).default;vr(t),await Zw(()=>{var r;return(r=this.basemapTerrain)==null?void 0:r.ready},t),this._set("graphicsView",new e({view:this}))}_disposeGraphicsView(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null),this.removeHandles("graphics-view"),this.graphicsView!=null&&(this.removeHandles(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))}_startup(){const t=Ove(this.viewingMode);if(t===at.Global&&(this._clippingArea=null),this._initSurface(t),this._set("ready",!0),this.addHandles(da(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view"),this._createGraphicsViewIfNeeded(),!this._externallySet.environment){const r=this.get("map.initialViewProperties.environment");r&&(this.environment=r)}this.labeler.setup(),this.environmentManager.connectView(this),this.inputManager.connect();const e=this._resolveWhenReady;this._resolveWhenReady=[],e.forEach(r=>r(this))}_teardown(){this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.disconnectView(),this.labeler.dispose(),this._disposeGraphicsView(),this.removeHandles("graphics-view"),this._exitSurface(),this._set("ready",!1)}_updateDefaultToMapOptions(){if(this._defaultToMapOptions.include.clear(),this.map){this.map.ground&&this._defaultToMapOptions.include.add(Kb);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&this._defaultToMapOptions.include.add(t.uid)}}_updateDefaultHitTestOptions(){if(this._defaultHitTestOptions.exclude.clear(),this.map){this.map.ground&&this.map.ground.opacity<1&&this._defaultHitTestOptions.exclude.add(Kb);for(const t of this.map.allLayers.items)t.type==="integrated-mesh"&&t.opacity<1&&this._defaultHitTestOptions.exclude.add(t.uid)}}addVoxelLayerViewToWasm(t){return this.voxelWasm==null?(this.voxelWasmPromise==null&&(this.voxelWasmPromise=le(()=>import("./VoxelWasmPerSceneView-4351f84f.js"),[]).then(e=>(this.voxelWasm=new e.default(this),this.voxelWasm))),this.voxelWasmPromise.then(e=>e.addVoxelLayer(t))):this.voxelWasm.addVoxelLayer(t)}removeVoxelLayerViewFromWasm(t){this.voxelWasm!=null&&this.voxelWasm.removeVoxelLayer(t)<1&&(this.voxelWasm=null,this.voxelWasmPromise=null)}};function P$(t,e){t.layerUids||(t.layerUids=new Set),t.layerUids.add(e)}function UJt(t,e){t.graphicUids||(t.graphicUids=new Set),t.graphicUids.add(e)}function xU(t,e){return t!=null&&lf(t.spatialReference,e)?o0(t,e):null}var zD;Tt.type="3d",d([p()],Tt.prototype,"_userClippingArea",void 0),d([p()],Tt.prototype,"_resourceController",void 0),d([p()],Tt.prototype,"_stage",void 0),d([p({readOnly:!0})],Tt.prototype,"deconflictor",void 0),d([p({readOnly:!0})],Tt.prototype,"labeler",void 0),d([p(wB(kP,"analyses"))],Tt.prototype,"analyses",void 0),d([p({type:VP,readOnly:!0})],Tt.prototype,"animation",null),d([p({readOnly:!0})],Tt.prototype,"basemapTerrain",void 0),d([p({readOnly:!0})],Tt.prototype,"elevationProvider",void 0),d([p()],Tt.prototype,"camera",null),d([p({type:of})],Tt.prototype,"contentCamera",null),d([p({readOnly:!0})],Tt.prototype,"canvas",void 0),d([p({type:Gt})],Tt.prototype,"center",null),d([p({type:$r})],Tt.prototype,"clippingArea",null),d([p({type:VT})],Tt.prototype,"constraints",void 0),d([p({type:$r,readOnly:!0})],Tt.prototype,"renderDataExtent",null),d([p({type:$r,readOnly:!0})],Tt.prototype,"dataExtent",null),d([p({type:$r,readOnly:!0})],Tt.prototype,"_groundAndLayersExtent",null),d([p({value:null,type:BR})],Tt.prototype,"environment",null),d([ur("environment")],Tt.prototype,"castEnvironment",null),d([p({readOnly:!0})],Tt.prototype,"environmentManager",void 0),d([p({type:$r})],Tt.prototype,"extent",null),d([p()],Tt.prototype,"floors",void 0),d([p()],Tt.prototype,"screenCenter",null),d([p()],Tt.prototype,"frustum",null),d([p({type:Number,readOnly:!0})],Tt.prototype,"fullOpacity",void 0),d([p({readOnly:!0})],Tt.prototype,"graphicsView",void 0),d([p({readOnly:!0})],Tt.prototype,"analysisViewManager",void 0),d([p()],Tt.prototype,"groundView",void 0),d([p({type:Boolean})],Tt.prototype,"initialExtentRequired",null),d([p()],Tt.prototype,"_defaultsFromMapSettings",null),d([p()],Tt.prototype,"interacting",null),d([p()],Tt.prototype,"stationary",null),d([p()],Tt.prototype,"navigating",null),d([p()],Tt.prototype,"map",void 0),d([p({readOnly:!0})],Tt.prototype,"mapCoordsHelper",void 0),d([p()],Tt.prototype,"padding",null),d([p({type:Xc,readOnly:!0})],Tt.prototype,"pointsOfInterest",void 0),d([p({type:Sa,readOnly:!0})],Tt.prototype,"featureTiles",void 0),d([p()],Tt.prototype,"_featureTreeDebugger",void 0),d([p({type:Boolean})],Tt.prototype,"screenSizePerspectiveEnabled",void 0),d([p({constructOnly:!0})],Tt.prototype,"deactivatedWebGLExtensions",void 0),d([p({constructOnly:!0})],Tt.prototype,"debugWebGLExtensions",void 0),d([p({constructOnly:!0})],Tt.prototype,"renderCanvas",void 0),d([p({constructOnly:!0})],Tt.prototype,"state",void 0),d([p({readOnly:!0})],Tt.prototype,"inputManager",void 0),d([p({readOnly:!0})],Tt.prototype,"stateManager",void 0),d([p({type:["low","medium","high"]})],Tt.prototype,"qualityProfile",null),d([p({type:BTe,get(){let t=this._get("qualitySettings");return t||(t=new BTe,Uz.apply(this.qualityProfile,t)),t}})],Tt.prototype,"qualitySettings",void 0),d([p()],Tt.prototype,"slicePlane",null),d([p({readOnly:!0})],Tt.prototype,"typeSpecificPreconditionsReady",null),d([p({readOnly:!0})],Tt.prototype,"renderCoordsHelper",void 0),d([p({readOnly:!0})],Tt.prototype,"sceneIntersectionHelper",void 0),d([p({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],Tt.prototype,"resolution",null),d([p({type:Number})],Tt.prototype,"scale",null),d([p()],Tt.prototype,"heightModelInfo",null),d([p()],Tt.prototype,"spatialReference",void 0),d([p({type:Boolean,constructOnly:!0})],Tt.prototype,"alphaCompositingEnabled",void 0),d([p({constructOnly:!0})],Tt.prototype,"preserveDrawingBufferEnabled",void 0),d([p({type:Boolean})],Tt.prototype,"supersampleScreenshotsEnabled",void 0),d([p({readOnly:!0})],Tt.prototype,"type",void 0),d([p(),ur(t=>t instanceof WHe?t:X2(XHe,t))],Tt.prototype,"ui",void 0),d([p({type:Boolean,readOnly:!0,dependsOn:["graphicsView.updating","basemapView.updating","basemapTerrain.updating","layerViewManager.updating","layerViewManager.updatingRemaining","_resourceController.updating","_stage.updating","featureTiles.updating","pointsOfInterest.updating","environmentManager.updating","overlay.updating","updatingHandles.updating","featureTreeDebugger.updating","labeler.updating","deconflictor.updating","ready","stationary","inputManager.updating","toolViewManager.updating","analysisViewManager.updating","state.updating"]})],Tt.prototype,"updating",null),d([p()],Tt.prototype,"_updatingObjects",null),d([p()],Tt.prototype,"_updatingObjectsWithProgress",null),d([p({type:Number,readOnly:!0,dependsOn:["updating"]})],Tt.prototype,"updatingProgress",void 0),d([p({type:["global","local"]})],Tt.prototype,"viewingMode",null),d([p({type:Sd})],Tt.prototype,"viewpoint",null),d([p({type:Number})],Tt.prototype,"zoom",null),d([p({type:One})],Tt.prototype,"highlightOptions",void 0),Tt=d([I("esri.views.SceneView")],Tt),function(t){t[t.INCLUDE=0]="INCLUDE",t[t.EXCLUDE=1]="EXCLUDE"}(zD||(zD={}));const mR=A(),vJ=Tn(),bRe=lr(),zJt=Tt;var pse;let fL=pse=class extends me{constructor(t){super(t),this.minValue=0,this.maxValue=0}clone(){return new pse({minValue:this.minValue,maxValue:this.maxValue})}};d([p({type:Number,json:{write:!0}})],fL.prototype,"minValue",void 0),d([p({type:Number,json:{write:!0}})],fL.prototype,"maxValue",void 0),fL=pse=d([I("esri.renderer.support.AuthoringInfoClassBreakInfo")],fL);var fse;let qb=fse=class extends me{constructor(t){super(t),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=[]}clone(){return new fse({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:ie(this.classBreakInfos)})}};d([p({type:String,json:{write:!0}})],qb.prototype,"field",void 0),d([p({type:String,json:{write:!0}})],qb.prototype,"normalizationField",void 0),d([p({type:String,json:{write:!0}})],qb.prototype,"label",void 0),d([p({type:[fL],json:{write:!0}})],qb.prototype,"classBreakInfos",void 0),qb=fse=d([I("esri.renderers.support.AuthoringInfoFieldInfo")],qb);var mse;const SU=new ri({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),TU=new ri({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),wRe={key:t=>typeof t=="number"?"number":"string",typeMap:{number:Number,string:String},base:null},xRe=["high-to-low","above-and-below","centered-on","extremes"],SRe=[...new Set(["high-to-low","above-and-below","centered-on","extremes","90-10","above","below","high-to-low","above-and-below","90-10","above","below"])],TRe=["seconds","minutes","hours","days","months","years"];let Lu=mse=class extends me{constructor(t){super(t),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(t){return typeof t=="string"||typeof t=="number"?t:null}castStartTime(t){return typeof t=="string"||typeof t=="number"?t:null}get style(){return this.type==="color"?this._get("style"):null}set style(t){this._set("style",t)}get theme(){return this.type==="color"||this.type==="size"?this._get("theme")||"high-to-low":null}set theme(t){this._set("theme",t)}clone(){return new mse({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};d([p({types:wRe,json:{write:!0}})],Lu.prototype,"endTime",void 0),d([ur("endTime")],Lu.prototype,"castEndTime",null),d([p({type:String,json:{write:!0}})],Lu.prototype,"field",void 0),d([p({type:Number,json:{write:!0}})],Lu.prototype,"maxSliderValue",void 0),d([p({type:Number,json:{write:!0}})],Lu.prototype,"minSliderValue",void 0),d([p({types:wRe,json:{write:!0}})],Lu.prototype,"startTime",void 0),d([ur("startTime")],Lu.prototype,"castStartTime",null),d([p({type:SU.apiValues,value:null,json:{type:SU.jsonValues,read:SU.read,write:SU.write}})],Lu.prototype,"style",null),d([p({type:SRe,value:null,json:{type:SRe,origins:{"web-scene":{type:xRe,write:{writer:(t,e)=>{xRe.includes(t)&&(e.theme=t)}}}},write:!0}})],Lu.prototype,"theme",null),d([p({type:TU.apiValues,json:{type:TU.jsonValues,read:TU.read,write:TU.write}})],Lu.prototype,"type",void 0),d([p({type:TRe,json:{type:TRe,write:!0}})],Lu.prototype,"units",void 0),Lu=mse=d([I("esri.renderers.support.AuthoringInfoVisualVariable")],Lu);const VJt=Lu;let t9=class extends me{constructor(e){super(e),this.type=null}};d([p({readOnly:!0,json:{read:!1,write:!0}})],t9.prototype,"type",void 0),t9=d([I("esri.rest.support.ColorRamp")],t9);const Tfe=t9;var gse;let fT=gse=class extends Tfe{constructor(t){super(t),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new gse({fromColor:ie(this.fromColor),toColor:ie(this.toColor),algorithm:this.algorithm})}};d([Rt({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],fT.prototype,"algorithm",void 0),d([p({type:ht,json:{type:[hn],write:!0}})],fT.prototype,"fromColor",void 0),d([p({type:ht,json:{type:[hn],write:!0}})],fT.prototype,"toColor",void 0),d([p({type:["algorithmic"]})],fT.prototype,"type",void 0),fT=gse=d([I("esri.rest.support.AlgorithmicColorRamp")],fT);const Efe=fT;var yse;let mL=yse=class extends Tfe{constructor(t){super(t),this.colorRamps=null,this.type="multipart"}clone(){return new yse({colorRamps:ie(this.colorRamps)})}};d([p({type:[Efe],json:{write:!0}})],mL.prototype,"colorRamps",void 0),d([p({type:["multipart"]})],mL.prototype,"type",void 0),mL=yse=d([I("esri.rest.support.MultipartColorRamp")],mL);const YHe=mL,BJt={key:"type",base:Tfe,typeMap:{algorithmic:Efe,multipart:YHe}};function jJt(t){return t&&t.type?t.type==="algorithmic"?Efe.fromJSON(t):t.type==="multipart"?YHe.fromJSON(t):null:null}var vse;const bS=new ri({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),EU=new ri({pieChart:"pie-chart",classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),ERe=new ri({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),CRe=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers","decimal-degrees"],GJt=["high-to-low","above-and-below","above","below","90-10"],HJt=["flow-line","wave-front"],qJt=["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"];let js=vse=class extends me{constructor(t){super(t),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const t=this._get("classificationMethod"),e=this.type;return e&&e!=="relationship"?e==="class-breaks-size"||e==="class-breaks-color"?t||"manual":null:t}set classificationMethod(t){this._set("classificationMethod",t)}readColorRamp(t){return t?jJt(t):void 0}get fields(){return this.type&&this.type!=="predominance"?null:this._get("fields")}set fields(t){this._set("fields",t)}get field1(){return this.type&&this.type!=="relationship"?null:this._get("field1")}set field1(t){this._set("field1",t)}get field2(){return this.type&&this.type!=="relationship"?null:this._get("field2")}set field2(t){this._set("field2",t)}get flowTheme(){return this.type==="flow"?this._get("flowTheme"):null}set flowTheme(t){this._set("flowTheme",t)}get focus(){return this.type&&this.type!=="relationship"?null:this._get("focus")}set focus(t){this._set("focus",t)}get numClasses(){return this.type&&this.type!=="relationship"?null:this._get("numClasses")}set numClasses(t){this._set("numClasses",t)}get statistics(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("statistics"):null}set statistics(t){this._set("statistics",t)}get standardDeviationInterval(){const t=this.type;return t&&t!=="relationship"&&t!=="class-breaks-size"&&t!=="class-breaks-color"||this.classificationMethod&&this.classificationMethod!=="standard-deviation"?null:this._get("standardDeviationInterval")}set standardDeviationInterval(t){this._set("standardDeviationInterval",t)}get type(){return this._get("type")}set type(t){let e=t;t==="classed-size"?e="class-breaks-size":t==="classed-color"&&(e="class-breaks-color"),this._set("type",e)}get univariateSymbolStyle(){return this.type==="univariate-color-size"&&this.univariateTheme==="above-and-below"?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(t){this._set("univariateSymbolStyle",t)}get univariateTheme(){return this.type==="univariate-color-size"?this._get("univariateTheme"):null}set univariateTheme(t){this._set("univariateTheme",t)}clone(){return new vse({classificationMethod:this.classificationMethod,colorRamp:ie(this.colorRamp),fadeRatio:ie(this.fadeRatio),fields:this.fields&&this.fields.slice(0),field1:ie(this.field1),field2:ie(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(t=>t.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}};d([p({type:bS.apiValues,value:null,json:{type:bS.jsonValues,read:bS.read,write:bS.write,origins:{"web-document":{default:"manual",type:bS.jsonValues,read:bS.read,write:bS.write}}}})],js.prototype,"classificationMethod",null),d([p({types:BJt,json:{write:!0}})],js.prototype,"colorRamp",void 0),d([ke("colorRamp")],js.prototype,"readColorRamp",null),d([p({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],js.prototype,"fadeRatio",void 0),d([p({type:[String],value:null,json:{write:!0}})],js.prototype,"fields",null),d([p({type:qb,value:null,json:{write:!0}})],js.prototype,"field1",null),d([p({type:qb,value:null,json:{write:!0}})],js.prototype,"field2",null),d([p({type:HJt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],js.prototype,"flowTheme",null),d([p({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],js.prototype,"focus",null),d([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],js.prototype,"isAutoGenerated",void 0),d([p({type:Number,value:null,json:{type:hn,write:!0}})],js.prototype,"numClasses",null),d([p({type:CRe,json:{type:CRe,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],js.prototype,"lengthUnit",void 0),d([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],js.prototype,"maxSliderValue",void 0),d([p({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],js.prototype,"minSliderValue",void 0),d([p({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],js.prototype,"statistics",null),d([p({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],js.prototype,"standardDeviationInterval",null),d([p({type:EU.apiValues,value:null,json:{type:EU.jsonValues,read:EU.read,write:EU.write,origins:{"web-scene":{type:ERe.jsonValues,write:{writer:ERe.write,overridePolicy:t=>({enabled:t!=="flow"})}}}}})],js.prototype,"type",null),d([p({type:[VJt],json:{write:!0}})],js.prototype,"visualVariables",void 0),d([p({type:qJt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],js.prototype,"univariateSymbolStyle",null),d([p({type:GJt,value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],js.prototype,"univariateTheme",null),js=vse=d([I("esri.renderers.support.AuthoringInfo")],js);const Cfe=js,_J=new ri({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});let gL=class extends me{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const r=new Set;return await this.collectRequiredFields(r,e),Array.from(r).sort()}getSymbol(e,r){}async getSymbolAsync(e,r){}getSymbols(){return[]}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}};d([p({type:Cfe,json:{write:!0}})],gL.prototype,"authoringInfo",void 0),d([p({type:_J.apiValues,readOnly:!0,json:{type:_J.jsonValues,read:!1,write:{writer:_J.write,ignoreOrigin:!0}}})],gL.prototype,"type",void 0),gL=d([I("esri.renderers.Renderer")],gL);const c1=gL;function WJt(t){var e,r;return((r=(e=t.match(XJt))==null?void 0:e[1])==null?void 0:r.replace(/\\'/g,"'"))??null}const XJt=/^hash\(\$feature\['((\\'|[^'])+)'\]\) \* 8\.381e-8$/;var _se;let GA=_se=class extends me{constructor(){super(...arguments),this.title=null}clone(){return new _se({title:this.title})}};d([p({type:String,json:{write:!0}})],GA.prototype,"title",void 0),GA=_se=d([I("esri.renderers.support.LegendOptions")],GA);var bse;let r9=bse=class extends GA{constructor(){super(...arguments),this.showLegend=null}clone(){return new bse({title:this.title,showLegend:this.showLegend})}};d([p({type:Boolean,json:{write:!0}})],r9.prototype,"showLegend",void 0),r9=bse=d([I("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],r9);const ZHe=r9,bJ=new ri({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});let om=class extends me{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return e==null?e:typeof e=="function"?(re.getLogger(this).error(".field: field must be a string value"),null):j4(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}};d([p()],om.prototype,"index",void 0),d([p({type:bJ.apiValues,readOnly:!0,json:{read:bJ.read,write:bJ.write}})],om.prototype,"type",void 0),d([p({type:String,json:{write:!0}})],om.prototype,"field",void 0),d([ur("field")],om.prototype,"castField",null),d([p({type:String,json:{write:!0}})],om.prototype,"valueExpression",void 0),d([p({type:String,json:{write:!0}})],om.prototype,"valueExpressionTitle",void 0),d([p({readOnly:!0})],om.prototype,"arcadeRequired",null),d([p({type:ZHe,json:{write:!0}})],om.prototype,"legendOptions",void 0),om=d([I("esri.renderers.visualVariables.VisualVariable")],om);const YF=om;var wse;let mT=wse=class extends me{constructor(t){super(t),this.color=null,this.label=null,this.value=null}writeValue(t,e,r){e[r]=t??0}clone(){return new wse({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};d([p({type:ht,json:{type:[hn],write:!0}})],mT.prototype,"color",void 0),d([p({type:String,json:{write:!0}})],mT.prototype,"label",void 0),d([p({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],mT.prototype,"value",void 0),d([tt("value")],mT.prototype,"writeValue",null),mT=wse=d([I("esri.renderers.visualVariables.support.ColorStop")],mT);const YJt=mT;var xse;let gT=xse=class extends YF{constructor(t){super(t),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new xse({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};d([p({readOnly:!0})],gT.prototype,"cache",null),d([p({type:["color"],json:{type:["colorInfo"]}})],gT.prototype,"type",void 0),d([p({type:String,json:{write:!0}})],gT.prototype,"normalizationField",void 0),d([p({type:[YJt],json:{write:!0}})],gT.prototype,"stops",null),gT=xse=d([I("esri.renderers.visualVariables.ColorVariable")],gT);const JHe=gT;var Sse;let Tb=Sse=class extends me{constructor(t){super(t),this.label=null,this.opacity=null,this.value=null}readOpacity(t,e){return rE(e.transparency)}writeOpacity(t,e,r){e[r]=X4(t)}clone(){return new Sse({label:this.label,opacity:this.opacity,value:this.value})}};d([p({type:String,json:{write:!0}})],Tb.prototype,"label",void 0),d([p({type:Number,json:{type:hn,write:{target:"transparency"}}})],Tb.prototype,"opacity",void 0),d([ke("opacity",["transparency"])],Tb.prototype,"readOpacity",null),d([tt("opacity")],Tb.prototype,"writeOpacity",null),d([p({type:Number,json:{write:!0}})],Tb.prototype,"value",void 0),Tb=Sse=d([I("esri.renderers.visualVariables.support.OpacityStop")],Tb);const ZJt=Tb;var Tse;let yT=Tse=class extends YF{constructor(t){super(t),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(t){t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value),this._set("stops",t)}clone(){return new Tse({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(t=>t.clone()),legendOptions:this.legendOptions&&this.legendOptions.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};d([p({readOnly:!0})],yT.prototype,"cache",null),d([p({type:["opacity"],json:{type:["transparencyInfo"]}})],yT.prototype,"type",void 0),d([p({type:String,json:{write:!0}})],yT.prototype,"normalizationField",void 0),d([p({type:[ZJt],json:{write:!0}})],yT.prototype,"stops",null),yT=Tse=d([I("esri.renderers.visualVariables.OpacityVariable")],yT);const KHe=yT;var Ese;let vv=Ese=class extends YF{constructor(t){super(t),this.axis=null,this.type="rotation",this.rotationType="geographic",this.valueExpressionTitle=null}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}writeValueExpressionTitleWebScene(t,e,r,i){if(i&&i.messages){const n=`visualVariables[${this.index}]`;i.messages.push(new H("property:unsupported",this.type+"VisualVariable.valueExpressionTitle is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:n+".valueExpressionTitle",context:i}))}}clone(){return new Ese({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions&&this.legendOptions.clone()})}};d([p({readOnly:!0})],vv.prototype,"cache",null),d([p({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],vv.prototype,"axis",void 0),d([p({type:["rotation"],json:{type:["rotationInfo"]}})],vv.prototype,"type",void 0),d([p({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],vv.prototype,"rotationType",void 0),d([p({type:String,json:{write:!0}})],vv.prototype,"valueExpressionTitle",void 0),d([tt("web-scene","valueExpressionTitle")],vv.prototype,"writeValueExpressionTitleWebScene",null),vv=Ese=d([I("esri.renderers.visualVariables.RotationVariable")],vv);const QHe=vv;var Cse;let cO=Cse=class extends me{constructor(t){super(t),this.label=null,this.size=null,this.value=null}clone(){return new Cse({label:this.label,size:this.size,value:this.value})}};d([p({type:String,json:{write:!0}})],cO.prototype,"label",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],cO.prototype,"size",void 0),d([p({type:Number,json:{write:!0}})],cO.prototype,"value",void 0),cO=Cse=d([I("esri.renderers.visualVariables.support.SizeStop")],cO);const uO=cO;var Rse;let i9=Rse=class extends ZHe{constructor(){super(...arguments),this.customValues=null}clone(){return new Rse({title:this.title,showLegend:this.showLegend,customValues:this.customValues&&this.customValues.slice(0)})}};d([p({type:[Number],json:{write:!0}})],i9.prototype,"customValues",void 0),i9=Rse=d([I("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],i9);const JJt=i9;var Ose;const CU=new ri({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),Ase=new ri({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers","decimal-degree":"decimal-degrees"});function RRe(t){if(t!=null)return typeof t=="string"||typeof t=="number"?Ei(t):t.type==="size"?Tw(t)?t:(delete(t={...t}).type,new Fi(t)):void 0}function ORe(t,e,r){if(typeof t!="object")return t;const i=new Fi;return i.read(t,r),i}let Fi=Ose=class extends YF{constructor(t){super(t),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:this.valueExpression!=null&&R9e.test(this.valueExpression)}}set expression(t){re.getLogger(this).warn("'expression' is deprecated since version 4.2. Use 'valueExpression' instead. The only supported expression is 'view.scale'."),t==="view.scale"?(this.valueExpression="$view.scale",this._set("expression",t)):this._set("expression",null)}set index(t){Tw(this.maxSize)&&(this.maxSize.index=`visualVariables[${t}].maxSize`),Tw(this.minSize)&&(this.minSize.index=`visualVariables[${t}].minSize`),this._set("index",t)}get inputValueType(){return C9e(this)}set maxDataValue(t){t&&this.stops&&(re.getLogger(this).warn("cannot set maxDataValue when stops is not null."),t=null),this._set("maxDataValue",t)}set maxSize(t){t&&this.stops&&(re.getLogger(this).warn("cannot set maxSize when stops is not null."),t=null),this._set("maxSize",t)}castMaxSize(t){return RRe(t)}readMaxSize(t,e,r){return ORe(t,e,r)}set minDataValue(t){t&&this.stops&&(re.getLogger(this).warn("cannot set minDataValue when stops is not null."),t=null),this._set("minDataValue",t)}set minSize(t){t&&this.stops&&(re.getLogger(this).warn("cannot set minSize when stops is not null."),t=null),this._set("minSize",t)}castMinSize(t){return RRe(t)}readMinSize(t,e,r){return ORe(t,e,r)}get arcadeRequired(){return!!this.valueExpression||this.minSize!=null&&typeof this.minSize=="object"&&this.minSize.arcadeRequired||this.maxSize!=null&&typeof this.maxSize=="object"&&this.maxSize.arcadeRequired}set stops(t){this.minDataValue==null&&this.maxDataValue==null&&this.minSize==null&&this.maxSize==null?t&&Array.isArray(t)&&(t=t.filter(e=>!!e)).sort((e,r)=>e.value-r.value):t&&(re.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),t=null),this._set("stops",t)}get transformationType(){return nNt(this,this.inputValueType)}readValueExpression(t,e){return t||e.expression&&"$view.scale"}writeValueExpressionWebScene(t,e,r,i){if(t==="$view.scale"){if(i&&i.messages){const n=this.index,s=typeof n=="string"?n:`visualVariables[${n}]`;i.messages.push(new H("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:s+".valueExpression",context:i}))}}else e[r]=t}readValueUnit(t){return t?Ase.read(t):null}clone(){return new Ose({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Tw(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Tw(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone()})}flipSizes(){if(this.transformationType===Ra.ClampedLinear){const{minSize:t,maxSize:e}=this;return this.minSize=e,this.maxSize=t,this}if(this.transformationType===Ra.Stops){const t=this.stops;if(!t)return this;const e=t.map(i=>i.size).reverse(),r=t.length;for(let i=0;i<r;i++)t[i].size=e[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(t=>t.value||0)}};d([p({readOnly:!0})],Fi.prototype,"cache",null),d([p({type:CU.apiValues,json:{type:CU.jsonValues,origins:{"web-map":{read:!1}},read:CU.read,write:CU.write}})],Fi.prototype,"axis",void 0),d([p({type:String,value:null,json:{read:!1}})],Fi.prototype,"expression",null),d([p()],Fi.prototype,"index",null),d([p({type:String,readOnly:!0})],Fi.prototype,"inputValueType",null),d([p({type:JJt,json:{write:!0}})],Fi.prototype,"legendOptions",void 0),d([p({type:Number,value:null,json:{write:!0}})],Fi.prototype,"maxDataValue",null),d([p({type:Number,value:null,json:{write:!0}})],Fi.prototype,"maxSize",null),d([ur("maxSize")],Fi.prototype,"castMaxSize",null),d([ke("maxSize")],Fi.prototype,"readMaxSize",null),d([p({type:Number,value:null,json:{write:!0}})],Fi.prototype,"minDataValue",null),d([p({type:Number,value:null,json:{write:!0}})],Fi.prototype,"minSize",null),d([ur("minSize")],Fi.prototype,"castMinSize",null),d([ke("minSize")],Fi.prototype,"readMinSize",null),d([p({type:String,json:{write:!0}})],Fi.prototype,"normalizationField",void 0),d([p({readOnly:!0})],Fi.prototype,"arcadeRequired",null),d([p({type:String})],Fi.prototype,"scaleBy",void 0),d([p({type:[uO],value:null,json:{write:!0}})],Fi.prototype,"stops",null),d([p({type:["outline"],json:{write:!0}})],Fi.prototype,"target",void 0),d([p({type:String,readOnly:!0})],Fi.prototype,"transformationType",null),d([p({type:["size"],json:{type:["sizeInfo"]}})],Fi.prototype,"type",void 0),d([p({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],Fi.prototype,"useSymbolValue",void 0),d([p({type:String,json:{write:!0}})],Fi.prototype,"valueExpression",void 0),d([ke("valueExpression",["valueExpression","expression"])],Fi.prototype,"readValueExpression",null),d([tt("web-scene","valueExpression")],Fi.prototype,"writeValueExpressionWebScene",null),d([p({type:["radius","diameter","area","width","distance"],json:{write:!0}})],Fi.prototype,"valueRepresentation",void 0),d([p({type:Ase.apiValues,json:{write:Ase.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],Fi.prototype,"valueUnit",void 0),d([ke("valueUnit")],Fi.prototype,"readValueUnit",null),Fi=Ose=d([I("esri.renderers.visualVariables.SizeVariable")],Fi);const wq=Fi,KJt={color:JHe,size:wq,opacity:KHe,rotation:QHe},QJt=new ri({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),eKt=/^\[([^\]]+)\]$/i;let n9=class extends Ce{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),(e=e&&e.filter(r=>!!r))&&e.length){for(const r of e)switch(r.type){case"color":this.colorVariables.push(r);break;case"opacity":this.opacityVariables.push(r);break;case"rotation":this.rotationVariables.push(r);break;case"size":this.sizeVariables.push(r)}this.sizeVariables.length&&this.sizeVariables.some(r=>!!r.target)&&e.sort((r,i)=>{let n=null;return n=r.target===i.target?0:r.target?1:-1,n});for(let r=0;r<e.length;r++)e[r].index=r;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,r,i){const{rotationExpression:n,rotationType:s}=r,o=n&&n.match(eKt),a=o&&o[1];if(a&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:s,field:a})),e)return e.map(l=>{const c=QJt.read(l.type),u=KJt[c];u||(re.getLogger(this).warn(`Unknown variable type: ${c}`),i&&i.messages&&i.messages.push(new nf("visual-variable:unsupported",`visualVariable of type '${c}' is not supported`,{definition:l,context:i})));const h=new u;return h.read(l,i),h})}writeVariables(e,r){const i=[];for(const n of e){const s=n.toJSON(r);s&&i.push(s)}return i}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}};d([p()],n9.prototype,"visualVariables",null),n9=d([I("esri.renderers.visualVariables.VisualVariableFactory")],n9);const tKt=n9,rKt={base:YF,key:"type",typeMap:{opacity:KHe,color:JHe,rotation:QHe,size:wq}},eM=t=>{let e=class extends t{constructor(){super(...arguments),this._vvFactory=new tKt}set visualVariables(r){this._vvFactory.visualVariables=r,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(r,i,n){return this._vvFactory.readVariables(r,i,n)}writeVisualVariables(r,i,n,s){i[n]=this._vvFactory.writeVariables(r,s)}get arcadeRequiredForVisualVariables(){if(!this.visualVariables)return!1;for(const r of this.visualVariables)if(r.arcadeRequired)return!0;return!1}hasVisualVariables(r,i){return r?this.getVisualVariablesForType(r,i).length>0:this.getVisualVariablesForType("size",i).length>0||this.getVisualVariablesForType("color",i).length>0||this.getVisualVariablesForType("opacity",i).length>0||this.getVisualVariablesForType("rotation",i).length>0}getVisualVariablesForType(r,i){const n=this.visualVariables;return n?n.filter(s=>s.type===r&&(typeof i=="string"?s.target===i:i!==!1||!s.target)):[]}async collectVVRequiredFields(r,i){let n=[];this.visualVariables&&(n=n.concat(this.visualVariables));for(const s of n)s&&(s.field&&gh(r,i,s.field),s.normalizationField&&gh(r,i,s.normalizationField),s.valueExpression&&(iKt(s.valueExpression,r,i)||await pu(r,i,s.valueExpression)))}};return d([p({types:[rKt],value:null,json:{write:!0}})],e.prototype,"visualVariables",null),d([ke("visualVariables",["visualVariables","rotationType","rotationExpression"])],e.prototype,"readVisualVariables",null),d([tt("visualVariables")],e.prototype,"writeVisualVariables",null),e=d([I("esri.renderers.mixins.VisualVariablesMixin")],e),e};function iKt(t,e,r){const i=WJt(t);return i!=null&&(gh(e,r,i),!0)}const tM={types:mFe,json:{write:{writer:lj},origins:{"web-scene":{types:b_e,write:{writer:lj},read:{reader:E3({types:b_e})}}}}},eqe={types:{base:Cd,key:"type",typeMap:{"simple-fill":Um.typeMap["simple-fill"],"picture-fill":Um.typeMap["picture-fill"],"polygon-3d":Um.typeMap["polygon-3d"]}},json:{write:{writer:lj},origins:{"web-scene":{type:fF,write:{writer:lj}}}}},s9={cast:t=>t==null||typeof t=="string"||typeof t=="number"?t:`${t}`,json:{type:String,write:{writer:(t,e)=>{e.value=t==null?void 0:t.toString()}}}};var Pse;let Eb=Pse=class extends me{constructor(t){super(t),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new Pse({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${t}`}};d([p({type:String,json:{write:!0}})],Eb.prototype,"description",void 0),d([p({type:String,json:{write:!0}})],Eb.prototype,"label",void 0),d([p({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],Eb.prototype,"minValue",void 0),d([p({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],Eb.prototype,"maxValue",void 0),d([p(tM)],Eb.prototype,"symbol",void 0),Eb=Pse=d([I("esri.renderers.support.ClassBreakInfo")],Eb);const Fj=Eb;var Mse;const tqe="log",o9="percent-of-total",a9="field",RU=new ri({esriNormalizeByLog:tqe,esriNormalizeByPercentOfTotal:o9,esriNormalizeByField:a9}),nKt=ls(Fj);let Jo=Mse=class extends eM(c1){constructor(t){super(t),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(t,e,r){if(!Array.isArray(t))return;let i=e.minValue;return t.map(n=>{const s=new Fj;return s.read(n,r),s.minValue==null&&(s.minValue=i),s.maxValue==null&&(s.maxValue=s.minValue),i=s.maxValue,s})}writeClassBreakInfos(t,e,r,i){const n=t.map(s=>s.write({},i));this._areClassBreaksConsecutive()&&n.forEach(s=>delete s.classMinValue),e[r]=n}castField(t){return t==null?t:typeof t=="function"?(re.getLogger(this).error(".field: field must be a string value"),null):j4(t)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let t=this._get("normalizationType");const e=!!this.normalizationField,r=this.normalizationTotal!=null;return e||r?(t=e&&a9||r&&o9||null,e&&r&&re.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):t!==a9&&t!==o9||(t=null),t}set normalizationType(t){this._set("normalizationType",t)}addClassBreakInfo(t,e,r){let i=null;i=typeof t=="number"?new Fj({minValue:t,maxValue:e,symbol:gFe(r)}):nKt(ie(t)),this.classBreakInfos.push(i),this.classBreakInfos.length===1&&this.notifyChange("minValue")}removeClassBreakInfo(t,e){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const n=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(n[0]===t&&n[1]===e){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(t,e){return!this.valueExpression||e!=null&&e.arcade!=null||re.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(t,e):this._getBreakIndexForField(t)}async getClassBreakInfo(t,e){let r=e;!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await ex()});const i=this.getBreakIndex(t,r);return i!==-1?this.classBreakInfos[i]:null}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void re.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(t,e);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(e==null||e.arcade==null)){const n=await ex(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),r={...r,arcade:n}}const i=this.getBreakIndex(t,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}getSymbols(){const t=[];return this.classBreakInfos.forEach(e=>{e.symbol&&t.push(e.symbol)}),this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${t}.${e}.${this.classBreakInfos.reduce((i,n)=>i+n.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new Mse({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol&&this.backgroundFillSymbol.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:ie(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:ie(this.visualVariables),legendOptions:ie(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),pu(t,e,this.valueExpression)];gh(t,e,this.field),gh(t,e,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:n,arcade:s}=e??{},{valueExpression:o}=this;let a=this._compiledValueExpression.valueExpression===o?this._compiledValueExpression.compiledFunction:null;const l=s.arcadeUtils;if(!a){const u=l.createSyntaxTree(o);a=l.createFunction(u),this._compiledValueExpression.compiledFunction=a}this._compiledValueExpression.valueExpression=o;const c=l.executeFunction(a,l.createExecContext(t,l.getViewInfo({viewingMode:r,scale:i,spatialReference:n})));return this._getBreakIndexfromInfos(c)}_getBreakIndexForField(t){const e=this.field,r=t.attributes,i=this.normalizationType;let n=parseFloat(r[e]);if(i){const s=this.normalizationTotal,o=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if(i===tqe)n=Math.log(n)*Math.LOG10E;else if(i!==o9||s==null||isNaN(s)){if(i===a9&&!isNaN(o)){if(isNaN(n)||isNaN(o))return-1;n/=o}}else n=n/s*100}return this._getBreakIndexfromInfos(n)}_getBreakIndexfromInfos(t){const e=this.isMaxInclusive;if(t!=null&&typeof t=="number"&&!isNaN(t))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=t&&(e?t<=i[1]:t<i[1]))return r}return-1}_areClassBreaksConsecutive(){const t=this.classBreakInfos,e=t.length;for(let r=1;r<e;r++)if(t[r-1].maxValue!==t[r].minValue)return!1;return!0}};d([p(eqe)],Jo.prototype,"backgroundFillSymbol",void 0),d([p({type:[Fj]})],Jo.prototype,"classBreakInfos",void 0),d([ke("classBreakInfos")],Jo.prototype,"readClassBreakInfos",null),d([tt("classBreakInfos")],Jo.prototype,"writeClassBreakInfos",null),d([p({type:String,json:{write:!0}})],Jo.prototype,"defaultLabel",void 0),d([p(tM)],Jo.prototype,"defaultSymbol",void 0),d([p({type:String,json:{write:!0}})],Jo.prototype,"field",void 0),d([ur("field")],Jo.prototype,"castField",null),d([p({type:Boolean})],Jo.prototype,"isMaxInclusive",void 0),d([p({type:GA,json:{write:!0}})],Jo.prototype,"legendOptions",void 0),d([p({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return this.classBreakInfos.length!==0&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],Jo.prototype,"minValue",null),d([p({type:String,json:{write:!0}})],Jo.prototype,"normalizationField",void 0),d([p({type:Number,cast:t=>Op(t),json:{write:!0}})],Jo.prototype,"normalizationTotal",void 0),d([p({type:RU.apiValues,value:null,json:{type:RU.jsonValues,read:RU.read,write:RU.write}})],Jo.prototype,"normalizationType",null),d([Rt({classBreaks:"class-breaks"})],Jo.prototype,"type",void 0),d([p({type:String,json:{write:!0}})],Jo.prototype,"valueExpression",void 0),d([p({type:String,json:{write:!0}})],Jo.prototype,"valueExpressionTitle",void 0),Jo=Mse=d([I("esri.renderers.ClassBreaksRenderer")],Jo);const rqe=Jo;function sKt(t){return t.type==="date"||t.type==="esriFieldTypeDate"||t.type==="date-only"||t.type==="esriFieldTypeDateOnly"||t.type==="timestamp-offset"||t.type==="esriFieldTypeTimestampOffset"}function ARe(t){return t.type==="oid"||t.type==="esriFieldTypeOID"}function PRe(t){return t.type==="global-id"||t.type==="esriFieldTypeGlobalID"}let Rfe=class{constructor(e=[]){if(this.fields=[],this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this.dateFields=[],this.numericFields=[],this._requiredFields=null,!e)return;this.fields=e;const r=[];for(const i of e){const n=i==null?void 0:i.name,s=$Re(i==null?void 0:i.name);if(n&&s){const o=MRe(n);this._fieldsMap.set(n,i),this._fieldsMap.set(o,i),this._normalizedFieldsMap.set(s,i),r.push(o),sKt(i)?(this.dateFields.push(i),this._dateFieldsSet.add(i)):bue(i)&&(this._numericFieldsSet.add(i),this.numericFields.push(i)),ARe(i)||PRe(i)||(i.editable=i.editable==null||!!i.editable,i.nullable=i.nullable==null||!!i.nullable)}}r.sort(),this.uid=r.join(",")}destroy(){this._fieldsMap.clear()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)ARe(e)||PRe(e)||e.nullable||z0t(e)!==void 0||this._requiredFields.push(e)}return this._requiredFields}has(e){return this.get(e)!=null}get(e){if(!e)return;let r=this._fieldsMap.get(e);return r||(r=this._fieldsMap.get(MRe(e))??this._normalizedFieldsMap.get($Re(e)),r&&this._fieldsMap.set(e,r),r)}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){const r=this.get(e);if(r)return r.name??void 0}};function MRe(t){return t.trim().toLowerCase()}function $Re(t){var e;return((e=x0t(t))==null?void 0:e.toLowerCase())??""}const IRe="esri.renderers.support.DictionaryLoader",oKt={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};let Ofe=class{constructor(e,r,i){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new oBe(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=e,this.config=r,this.fieldMap=i}getSymbolFields(){return this._symbolFields}async getSymbolAsync(e,r){let i;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{i=await this._dictionaryPromise}catch(g){if(Yn(g))return this._dictionaryPromise=null,null}const n=this._dictionaryVersion&&this._dictionaryVersion.since(4,0),s={};if(this.fieldMap)for(const g of this._symbolFields){const y=this._getFieldName(this.fieldMap[g]);s[g]=y?n?e.attributes[y]:""+e.attributes[y]:""}let o=null;try{o=i==null?void 0:i(s,r)}catch{return null}if(!o||typeof o!="string")return null;const a=Hle(o).toString(),l=this._symbolCache.get(a);if(l)return l.catch(()=>{this._symbolCache.pop(a)}),l;const c=o.split(";"),u=[],h=[];for(const g of c)if(g)if(g.includes("po:")){const y=g.substr(3).split("|");if(y.length===3){const _=y[0],b=y[1];let w=y[2];if(b==="DashTemplate")w=w.split(" ").map(x=>Number(x));else if(b==="Color"){const x=new ht(w).toRgba();w=[x[0],x[1],x[2],255*x[3]]}else w=Number(w);h.push({primitiveName:_,propertyName:b,value:w})}}else if(g.includes("|")){for(const y of g.split("|"))if(this._itemNames.has(y)){u.push(y);break}}else this._itemNames.has(g)&&u.push(g);const f=e.geometry==null||!e.geometry.hasZ&&e.geometry.type==="point",m=this._cimPartsToCIMSymbol(u,h,f,r);return this._symbolCache.put(a,m,1),m}async fetchResources(e){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void re.getLogger(IRe).error("no valid URL!");const r=ti(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:e!=null?e.signal:null}),[{data:i}]=await Promise.all([r,ex()]);if(!i)throw this._dictionaryPromise=null,new H("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:n,dictionary_version:s,expression:o,itemsNames:a}=i,l=o;let c=!1;s&&(this._dictionaryVersion=nx.parse(s),c=this._dictionaryVersion.since(4,0)),this._refSymbolUrlTemplate=this.url+"/"+i.cimRefTemplateUrl,this._itemNames=new Set(a),this._symbolFields=n.symbol;const u={};if(this.config){const m=this.config;for(const g in m)u[g]=m[g]}if(n.configuration)for(const m of n.configuration)u.hasOwnProperty(m.name)||(u[m.name]=m.value);const h=[];if(e!=null&&e.fields&&this.fieldMap)for(const m of this._symbolFields){const g=this.fieldMap[m],y=e.fields.filter(_=>_.name.toLowerCase()===(g==null?void 0:g.toLowerCase()));y.length>0&&h.push({...y[0],type:c?y[0].type:"esriFieldTypeString"})}h.length>0&&(this._fieldIndex=new Rfe(h));const f=_0t(l,e!=null?e.spatialReference:null,h,u).then(m=>{const g={scale:0};return(y,_)=>{if(m==null)return null;const b=m.repurposeFeature({geometry:null,attributes:y});return g.scale=_!=null?_.scale??void 0:void 0,m.evaluate({$feature:b,$view:g},m.services)}}).catch(m=>(re.getLogger(IRe).error("Creating dictinoary expression failed:",m),null));return this._dictionaryPromise=f,f}async _cimPartsToCIMSymbol(e,r,i,n){const s=new Array(e.length);for(let l=0;l<e.length;l++)s[l]=this._getSymbolPart(e[l],n);const o=await Promise.all(s),a=this.fieldMap;if(a)for(const l of o)iqe(l,a);return new N3({data:this._combineSymbolParts(o,r,i)})}async _getSymbolPart(e,r){if(this._ongoingRequests.has(e))return this._ongoingRequests.get(e).then(s=>s.data);const i=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,e),n=ti(i,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(e,n);try{return(await n).data}catch(s){throw this._ongoingRequests.delete(e),s}}_combineSymbolParts(e,r,i){if(!e||e.length===0)return null;const n={...e[0]};if(e.length>1){n.symbolLayers=[];for(const s of e){const o=s;n.symbolLayers.unshift(...o.symbolLayers)}}return i&&(n.callout=oKt),{type:"CIMSymbolReference",symbol:n,primitiveOverrides:r}}_getFieldName(e){if(this._fieldIndex!==null){const r=this._fieldIndex.get(e);return r?r.name:e}return e}};function iqe(t,e){if(!t)return;const r=t.symbolLayers;if(!r)return;let i=r.length;for(;i--;){const n=r[i];n&&n.enable!==!1&&n.type==="CIMVectorMarker"&&aKt(n,e)}}function aKt(t,e){const r=t.markerGraphics;if(r)for(const i of r){if(!i)continue;const n=i.symbol;if(n)switch(n.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":iqe(n,e);break;case"CIMTextSymbol":n.fieldMap=e}}}const XRr=Object.freeze(Object.defineProperty({__proto__:null,DictionaryLoader:Ofe},Symbol.toStringTag,{value:"Module"}));var $se;let am=$se=class extends eM(c1){constructor(t){super(t),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new Ofe(this.url,this.config,this.fieldMap)}writeData(t,e){t&&(e.scalingExpressionInfo={expression:t,returnType:"number"})}writeVisualVariables(t,e,r,i){i!=null&&i.origin||super.writeVisualVariables(t,e,r,i)}clone(){return new $se({config:ie(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:ie(this.fieldMap),url:ie(this.url),visualVariables:ie(this.visualVariables)})}async getSymbolAsync(t,e){return this._loader.getSymbolAsync(t,e)}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e),this.scaleExpression&&await pu(t,e,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];e.has(i)&&t.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}getSymbols(){return[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};d([p({type:Ofe})],am.prototype,"_loader",null),d([p({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],am.prototype,"config",void 0),d([p({type:Object,json:{write:!0}})],am.prototype,"fieldMap",void 0),d([p({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],am.prototype,"scaleExpression",void 0),d([tt("scaleExpression")],am.prototype,"writeData",null),d([p({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(t){return{enabled:!!t&&!!this.scaleExpression}}}}})],am.prototype,"scaleExpressionTitle",void 0),d([p({type:String,json:{write:!0}})],am.prototype,"url",void 0),d([tt("visualVariables")],am.prototype,"writeVisualVariables",null),am=$se=d([I("esri.renderers.DictionaryRenderer")],am);const lKt=am;var Ise;let _v=Ise=class extends me{constructor(t){super(t),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(t){return t==null?t:typeof t=="function"?(re.getLogger(this).error(".field: field must be a string value"),null):j4(t)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new Ise({color:this.color&&this.color.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};d([p({type:ht,json:{type:[Number],write:!0}})],_v.prototype,"color",void 0),d([p({type:String,json:{write:!0}})],_v.prototype,"field",void 0),d([ur("field")],_v.prototype,"castField",null),d([p({type:String,json:{write:!0}})],_v.prototype,"label",void 0),d([p({type:String,json:{write:!0}})],_v.prototype,"valueExpression",void 0),d([p({type:String,json:{write:!0}})],_v.prototype,"valueExpressionTitle",void 0),_v=Ise=d([I("esri.renderers.support.AttributeColorInfo")],_v);const nqe=_v;var Lse;let l9=Lse=class extends me{constructor(){super(...arguments),this.unit=null}clone(){return new Lse({unit:this.unit})}};d([p({type:String,json:{write:!0}})],l9.prototype,"unit",void 0),l9=Lse=d([I("esri.renderers.support.DotDensityLegendOptions")],l9);const cKt=l9;var Dse;let Du=Dse=class extends eM(c1){constructor(t){super(t),this.attributes=null,this.backgroundColor=new ht([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new Rd,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(t){if(this.referenceScale==null)return this.dotValue;const e=t/this.referenceScale*this.dotValue;return e<1?1:e}getSymbol(){return new X_({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}getAttributeHash(){var t;return((t=this.attributes)==null?void 0:t.reduce((e,r)=>e+r.getAttributeHash(),""))??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new Dse({attributes:ie(this.attributes),backgroundColor:ie(this.backgroundColor),dotBlendingEnabled:ie(this.dotBlendingEnabled),dotShape:ie(this.dotShape),dotSize:ie(this.dotSize),dotValue:ie(this.dotValue),legendOptions:ie(this.legendOptions),outline:ie(this.outline),referenceScale:ie(this.referenceScale),visualVariables:ie(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}getControllerHash(){var e;return`${(e=this.attributes)==null?void 0:e.map(r=>r.field||r.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(t,e){await this.collectVVRequiredFields(t,e);for(const r of this.attributes??[])r.valueExpression&&await pu(t,e,r.valueExpression),r.field&&t.add(r.field)}};d([p({type:[nqe],json:{write:!0}})],Du.prototype,"attributes",void 0),d([p({type:ht,json:{write:!0}})],Du.prototype,"backgroundColor",void 0),d([p({type:Boolean,json:{write:!0}})],Du.prototype,"dotBlendingEnabled",void 0),d([p({type:String,json:{write:!1}})],Du.prototype,"dotShape",void 0),d([p({type:Number,json:{write:!0}})],Du.prototype,"dotSize",void 0),d([p({type:cKt,json:{write:!0}})],Du.prototype,"legendOptions",void 0),d([p({type:Rd,json:{default:null,write:!0}})],Du.prototype,"outline",void 0),d([p({type:Number,json:{write:!0}})],Du.prototype,"dotValue",void 0),d([p({type:Number,json:{write:!0}})],Du.prototype,"referenceScale",void 0),d([p({type:Number,json:{write:!0}})],Du.prototype,"seed",void 0),d([Rt({dotDensity:"dot-density"})],Du.prototype,"type",void 0),Du=Dse=d([I("esri.renderers.DotDensityRenderer")],Du);const uKt=Du;var Nse;let yL=Nse=class extends me{constructor(t){super(t),this.color=null,this.ratio=null}clone(){return new Nse({color:this.color,ratio:this.ratio})}};d([p({type:ht,json:{type:[hn],default:null,write:!0}})],yL.prototype,"color",void 0),d([p({type:Number,json:{write:!0}})],yL.prototype,"ratio",void 0),yL=Nse=d([I("esri.renderers.support.HeatmapColorStop")],yL);const c9=yL;let dO=class extends Rn(me){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};d([p({type:String,json:{write:!0}})],dO.prototype,"minLabel",void 0),d([p({type:String,json:{write:!0}})],dO.prototype,"maxLabel",void 0),d([p({type:String,json:{write:!0}})],dO.prototype,"title",void 0),dO=d([I("esri.renderers.support.HeatmapLegendOptions")],dO);const Afe=2.4;function dKt(t){return Rh(t*Afe)}function hKt(t){return Es(t)/Afe}function pKt(t,e,r,i){let{color:n,ratio:s}=e,{color:o,ratio:a}=r;a===s&&(a===1?s-=1e-6:a+=1e-6);const l=Te((i-s)/(a-s),0,1);T7(t,n.toArray(),o.toArray(),l)}function ZRr(t){const r=new Uint8ClampedArray(2048);if(t=t.filter(({ratio:a})=>a>=0&&a<=1).sort((a,l)=>a.ratio-l.ratio).map(({color:a,ratio:l})=>({color:a,ratio:Math.max(l,.001)})),t.length<1)return r;let i=t[0],n=t[0],s=1;const o=wr();for(let a=0;a<512;a++){const l=(a+.5)/512;for(;l>n.ratio&&s<t.length;)i=n,n=t[s++];pKt(o,i,n,l),r.set(o,4*a)}return r}function JRr(t,e,r,i){const{radius:n,fieldOffset:s,field:o}=e,a=Math.round(Es(n)),l=new Float64Array(r*i);let c,u=Number.NEGATIVE_INFINITY;const h=mKt(o,s),f=new Set;for(const m of t){const g=m.getCursor();for(;g.next();){const y=g.getObjectId();if(f.has(y))continue;f.add(y);const _=g.readLegacyPointGeometry(),b=128;if(_.x<-b||_.x>=r+b||_.y<-b||_.y>i+b)continue;const w=+h(g),x=Math.max(0,Math.round(_.x)-a),S=Math.max(0,Math.round(_.y)-a),C=Math.min(i,Math.round(_.y)+a),E=Math.min(r,Math.round(_.x)+a);for(let R=S;R<C;R++)for(let P=x;P<E;P++){const D=R*r+P,L=fKt(_.x-P,_.y-R,a);c=l[D]+=L*w,c>u&&(u=c)}}}return{matrix:l.buffer,max:u}}function fKt(t,e,r){const i=Math.sqrt(t**2+e**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2}function KRr(t,e){return typeof t=="function"?t:t?typeof e=="string"?r=>-1*+r[t]:r=>+r[t]+e:()=>1}function mKt(t,e){return t!=null?typeof e=="string"?r=>-1*+r.readAttribute(t):r=>+r.readAttribute(t)+e:r=>1}var Fse;const sqe="esri.renderers.HeatmapRenderer",gKt=re.getLogger(sqe);function LRe(t){if(t!=null){const{maxDensity:e,minDensity:r,radius:i}=t;if(e!=null||r!=null||i!=null){const{blurRadius:n,maxPixelIntensity:s,minPixelIntensity:o,...a}=t;return a}}return t}let xa=Fse=class extends c1{constructor(t){super(t),this.authoringInfo=null,this.colorStops=[new c9({ratio:0,color:new ht("rgba(255, 140, 0, 0)")}),new c9({ratio:.75,color:new ht("rgba(255, 140, 0, 1)")}),new c9({ratio:.9,color:new ht("rgba(255, 0,   0, 1)")})],this.field=null,this.fieldOffset=0,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null,this._warnedProps={blurRadius:!1,maxPixelIntensity:!1,minPixelIntensity:!1}}normalizeCtorArgs(t){return LRe(t)}get blurRadius(){return hKt(this.radius)}set blurRadius(t){const e=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",dKt(t)),this._warnAboutDeprecatedGaussianBlurProp("blurRadius","radius"),this._set("maxDensity",e*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(t){this._set("maxDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("maxPixelIntensity","maxDensity")}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(t){this._set("minDensity",t*this._pixelIntensityToDensity),this._warnAboutDeprecatedGaussianBlurProp("minPixelIntensity","minDensity")}get _pixelIntensityToDensity(){return 24/(Afe**2*this.blurRadius**4)}_warnAboutDeprecatedGaussianBlurProp(t,e){this._warnedProps[t]||Ul(this).getDefaultOrigin()==="user"&&(this._warnedProps[t]=!0,T3(()=>{Lm(gKt,t,{replacement:`${String(e)} (suggested value: ${this._get(e)})`,version:"4.24"})}))}read(t,e){t=LRe(t),super.read(t,e)}getSymbol(){return new lg}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol()]}async collectRequiredFields(t,e){const r=this.field,i=this.valueExpression;r&&typeof r=="string"&&await gh(t,e,r),i&&typeof i=="string"&&await pu(t,e,i)}getAttributeHash(){return null}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new Fse({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:ie(this.colorStops),field:this.field,legendOptions:ie(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};d([p({type:Cfe,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],xa.prototype,"authoringInfo",void 0),d([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],xa.prototype,"blurRadius",null),d([p({type:[c9],json:{write:!0}})],xa.prototype,"colorStops",void 0),d([p({type:String,json:{write:!0}})],xa.prototype,"field",void 0),d([p({type:Number,json:{write:{overridePolicy:(t,e,r)=>({enabled:r==null})},origins:{"web-scene":{write:!1}}}})],xa.prototype,"fieldOffset",void 0),d([p({type:dO,json:{write:!0}})],xa.prototype,"legendOptions",void 0),d([p({type:Number,json:{write:!0}})],xa.prototype,"maxDensity",void 0),d([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],xa.prototype,"maxPixelIntensity",null),d([p({type:Number,json:{write:!0}})],xa.prototype,"minDensity",void 0),d([p({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],xa.prototype,"minPixelIntensity",null),d([p({type:Number,cast:Ei,json:{write:!0}})],xa.prototype,"radius",void 0),d([p({type:Number,range:{min:0},json:{default:0,write:!0}})],xa.prototype,"referenceScale",void 0),d([Rt({heatmap:"heatmap"})],xa.prototype,"type",void 0),d([p({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],xa.prototype,"valueExpression",void 0),d([p({type:String})],xa.prototype,"valueExpressionTitle",void 0),d([p({readOnly:!0})],xa.prototype,"_pixelIntensityToDensity",null),xa=Fse=d([I(sqe)],xa);const oqe=xa;let YT=class extends Rn(me){constructor(){super(...arguments),this.color=new ht([0,0,0,0]),this.label=null,this.threshold=0}};d([p({type:ht,json:{write:!0}})],YT.prototype,"color",void 0),d([p({type:String,json:{write:!0}})],YT.prototype,"label",void 0),d([p({type:Number,range:{min:0,max:1},json:{write:!0}})],YT.prototype,"threshold",void 0),YT=d([I("esri.renderers.support.OthersCategory")],YT);let u9=class extends Rn(me){constructor(){super(...arguments),this.title=null}};d([p({type:String,json:{write:!0}})],u9.prototype,"title",void 0),u9=d([I("esri.renderers.support.PieChartLegendOptions")],u9);let Gd=class extends eM(Rn(c1)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new ht([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new YT,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart"}getSymbol(){var e;return new lg({size:this.size?this.size/2+(((e=this.outline)==null?void 0:e.width)||0):0})}async getSymbolAsync(){return this.getSymbol()}getSymbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(_0)}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((e,r)=>e+r.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((e,r)=>e+JSON.stringify(r),"")}async collectRequiredFields(e,r){await this.collectVVRequiredFields(e,r);for(const i of this.attributes)i.valueExpression&&await pu(e,r,i.valueExpression),i.field&&e.add(i.field)}};d([p({type:[nqe],json:{write:!0}})],Gd.prototype,"attributes",void 0),d([p({type:X_,json:{default:null,write:!0}})],Gd.prototype,"backgroundFillSymbol",void 0),d([p({type:ht,json:{write:!0}})],Gd.prototype,"defaultColor",void 0),d([p({type:String,json:{write:!0}})],Gd.prototype,"defaultLabel",void 0),d([p({type:Number,range:{min:0,max:1},json:{write:!0}})],Gd.prototype,"holePercentage",void 0),d([p({type:YT,json:{write:!0}})],Gd.prototype,"othersCategory",void 0),d([p({type:u9,json:{write:!0}})],Gd.prototype,"legendOptions",void 0),d([p({type:Rd,json:{default:null,write:!0}})],Gd.prototype,"outline",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],Gd.prototype,"size",void 0),d([Rt({pieChart:"pie-chart"})],Gd.prototype,"type",void 0),Gd=d([I("esri.renderers.PieChartRenderer")],Gd);const yKt=Gd;var kse;let vT=kse=class extends eM(c1){constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(t,e){await Promise.all([this.collectSymbolFields(t,e),this.collectVVRequiredFields(t,e)])}async collectSymbolFields(t,e){await Promise.all(this.getSymbols().map(r=>r.collectRequiredFields(t,e)))}getSymbol(t,e){return this.symbol}async getSymbolAsync(t,e){return this.symbol}getSymbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){return this.getSymbols().reduce((t,e)=>t+JSON.stringify(e),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new kse({description:this.description,label:this.label,symbol:this.symbol&&this.symbol.clone(),visualVariables:ie(this.visualVariables),authoringInfo:this.authoringInfo&&this.authoringInfo.clone()})}};d([p({type:String,json:{write:!0}})],vT.prototype,"description",void 0),d([p({type:String,json:{write:!0}})],vT.prototype,"label",void 0),d([p(tM)],vT.prototype,"symbol",void 0),d([Rt({simple:"simple"})],vT.prototype,"type",void 0),vT=kse=d([I("esri.renderers.SimpleRenderer")],vT);const ZF=vT,vKt=["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"];function Use(t){return t instanceof Ce}function DRe(t){return t instanceof vt?Object.keys(t.items):Use(t)?Ul(t).keys():t?Object.keys(t):[]}function OU(t,e){return t instanceof vt?t.items[e]:t[e]}function _Kt(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.length!==e.length}function VD(t){return t?t.declaredClass:null}function aqe(t,e){var h;const r=t.diff;if(r&&typeof r=="function")return r(t,e);const i=DRe(t),n=DRe(e);if(i.length===0&&n.length===0)return;if(!i.length||!n.length||_Kt(t,e))return{type:"complete",oldValue:t,newValue:e};const s=n.filter(f=>!i.includes(f)),o=i.filter(f=>!n.includes(f)),a=i.filter(f=>n.includes(f)&&OU(t,f)!==OU(e,f)).concat(s,o).sort(),l=VD(t);if(l&&vKt.includes(l)&&a.length)return{type:"complete",oldValue:t,newValue:e};let c;const u=Use(t)&&Use(e);for(const f of a){const m=OU(t,f),g=OU(e,f);let y;if((u||typeof m!="function"&&typeof g!="function")&&m!==g&&(m!=null||g!=null)){if(r&&r[f]&&typeof r[f]=="function")y=(h=r[f])==null?void 0:h.call(r,m,g);else if(m instanceof Date&&g instanceof Date){if(m.getTime()===g.getTime())continue;y={type:"complete",oldValue:m,newValue:g}}else y=typeof m=="object"&&typeof g=="object"&&VD(m)===VD(g)?aqe(m,g):{type:"complete",oldValue:m,newValue:g};y!=null&&(c!=null?c.diff[f]=y:c={type:"partial",diff:{[f]:y}})}}return c}function bKt(t,e){if(t==null)return!1;const r=e.split(".");let i=t;for(const n of r){if(i.type==="complete")return!0;if(i.type!=="partial")return!1;{const s=i.diff[n];if(!s)return!1;i=s}}return!0}function rOr(t,e){for(const r of e)if(bKt(t,r))return!0;return!1}function wKt(t,e){if(typeof t!="function"&&typeof e!="function"&&(t!=null||e!=null))return t==null||e==null||typeof t=="object"&&typeof e=="object"&&VD(t)!==VD(e)?{type:"complete",oldValue:t,newValue:e}:aqe(t,e)}function AU(t){if(t==null)return!0;switch(t.type){case"complete":return!1;case"collection":{const e=t;for(const r of e.added)if(!AU(r))return!1;for(const r of e.removed)if(!AU(r))return!1;for(const r of e.changed)if(!AU(r))return!1;return!0}case"partial":for(const e in t.diff)if(!AU(t.diff[e]))return!1;return!0}}let hO=class extends Rn(me){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}};d([p(s9)],hO.prototype,"value",void 0),d([p(s9)],hO.prototype,"value2",void 0),d([p(s9)],hO.prototype,"value3",void 0),hO=d([I("esri.renderers.support.UniqueValue")],hO);const HA=hO;let Cb=class extends Rn(me){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(e==null)return null;const r=typeof(e=Array.isArray(e)?e:[e])[0];return r==="string"||r==="number"?e.map(i=>new HA({value:i})):r==="object"?e[0]instanceof HA?e:e.map(i=>new HA(i)):null}};d([p({type:String,json:{write:!0}})],Cb.prototype,"description",void 0),d([p({type:String,json:{write:!0}})],Cb.prototype,"label",void 0),d([p(tM)],Cb.prototype,"symbol",void 0),d([p({type:[HA],json:{type:[[String]],read:{reader:t=>t?t.map(e=>new HA({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(t,e)=>{const r=[];for(const i of t){const n=[i.value,i.value2,i.value3].filter(_0).map(s=>s.toString());r.push(n)}e.values=r}}}})],Cb.prototype,"values",void 0),d([ur("values")],Cb.prototype,"castValues",null),Cb=d([I("esri.renderers.support.UniqueValueClass")],Cb);const lqe=Cb;let vL=class extends Rn(me){constructor(e){super(e),this.heading=null,this.classes=null}};d([p({type:String,json:{write:!0}})],vL.prototype,"heading",void 0),d([p({type:[lqe],json:{write:!0}})],vL.prototype,"classes",void 0),vL=d([I("esri.renderers.support.UniqueValueGroup")],vL);const zse=vL;var Vse;let _T=Vse=class extends me{constructor(t){super(t),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new Vse({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const t=JSON.stringify(this.symbol&&this.symbol.toJSON());return`${this.value}.${t}`}};d([p({type:String,json:{write:!0}})],_T.prototype,"description",void 0),d([p({type:String,json:{write:!0}})],_T.prototype,"label",void 0),d([p(tM)],_T.prototype,"symbol",void 0),d([p(s9)],_T.prototype,"value",void 0),_T=Vse=d([I("esri.renderers.support.UniqueValueInfo")],_T);const BD=_T;var _L;const cqe="esri.renderers.UniqueValueRenderer",Z1=re.getLogger(cqe),NRe="uvInfos-watcher",FRe="uvGroups-watcher",xKt=",",SKt=ls(BD);function TKt(t){const{field1:e,field2:r,field3:i,fieldDelimiter:n,uniqueValueInfos:s,valueExpression:o}=t,a=!(!e||!r);return[{classes:(s??[]).map(l=>{var b;const{symbol:c,label:u,value:h,description:f}=l,[m,g,y]=a?((b=h==null?void 0:h.toString())==null?void 0:b.split(n||""))||[]:[h],_=[];return(e||o)&&_.push(m),r&&_.push(g),i&&_.push(y),{symbol:c,label:u,values:[_],description:f}})}]}let ms=_L=class extends eM(c1){constructor(t){super(t),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,r){if(!e&&!r)return;if(!e||!r)return{type:"complete",oldValue:e,newValue:r};let i=!1;const n={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let s=0;s<r.length;s++){const o=e.find(a=>a.value===r[s].value);o?wKt(o,r[s])?(n.changed.push({type:"complete",oldValue:o,newValue:r[s]}),i=!0):n.unchanged.push({oldValue:o,newValue:r[s]}):(n.added.push(r[s]),i=!0)}for(let s=0;s<e.length;s++)r.find(o=>o.value===e[s].value)||(n.removed.push(e[s]),i=!0);return i?n:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(t){this._set("field",t),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(t){return t==null||typeof t=="function"?t:j4(t)}writeField(t,e,r,i){typeof t=="string"?e[r]=t:i&&i.messages?i.messages.push(new H("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):Z1.error(".field: cannot write field to JSON since it's not a string value")}set field2(t){this._set("field2",t),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(t){this._set("field3",t),this._updateUniqueValues()}set valueExpression(t){this._set("valueExpression",t),this._updateUniqueValues()}set defaultSymbol(t){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",t)}set fieldDelimiter(t){this._set("fieldDelimiter",t),this._updateUniqueValues()}readPortal(t,e,r){return r.portal||Ns.getDefault()}readStyleOrigin(t,e,r){if(e.styleName)return Object.freeze({styleName:e.styleName});if(e.styleUrl){const i=$_(e.styleUrl,r);return Object.freeze({styleUrl:i})}}writeStyleOrigin(t,e,r,i){t.styleName?e.styleName=t.styleName:t.styleUrl&&(e.styleUrl=I_(t.styleUrl,i))}set uniqueValueGroups(t){this.styleOrigin?Z1.error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",t),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(t){this.styleOrigin?Z1.error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(t,e){var i;if(this.styleOrigin)return void Z1.error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r=typeof t=="object"?SKt(t):new BD({value:t,symbol:gFe(e)}),(i=this.uniqueValueInfos)==null||i.push(r),this._valueInfoMap[r.value]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(t){if(this.styleOrigin)return void Z1.error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const e=this.uniqueValueInfos;if(e){for(let r=0;r<e.length;r++)if(e[r].value===t+""){delete this._valueInfoMap[t],e.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(t,e){let r=e;return!this.valueExpression||e!=null&&e.arcade!=null||(r={...r,arcade:await ex()}),this._getUniqueValueInfo(t,r)}getSymbol(t,e){if(this.valueExpression&&(e==null||e.arcade==null))return void Z1.error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(t,e);return r&&r.symbol||this.defaultSymbol}async getSymbolAsync(t,e){let r=e;if(this.valueExpression&&(r==null||r.arcade==null)){const n=await ex(),{arcadeUtils:s}=n;s.hasGeometryOperations(this.valueExpression)&&await s.enableGeometryOperations(),r={...r,arcade:n}}const i=this._getUniqueValueInfo(t,r);return i&&i.symbol||this.defaultSymbol}getSymbols(){const t=[];for(const e of this.uniqueValueInfos??[])e.symbol&&t.push(e.symbol);return this.defaultSymbol&&t.push(this.defaultSymbol),t}getAttributeHash(){return this.visualVariables&&this.visualVariables.reduce((t,e)=>t+e.getAttributeHash(),"")}getMeshHash(){var i;const t=JSON.stringify(this.backgroundFillSymbol),e=JSON.stringify(this.defaultSymbol),r=(i=this.uniqueValueInfos)==null?void 0:i.reduce((n,s)=>n+s.getMeshHash(),"");return`${t}.${e}.${r}.${`${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}`}.${this.valueExpression}`}clone(){const t=new _L({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:ie(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:ie(this.visualVariables),legendOptions:ie(this.legendOptions),authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),backgroundFillSymbol:ie(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(t._isDefaultSymbolDerived=!0),t._set("portal",this.portal);const e=ie(this.uniqueValueInfos),r=ie(this.uniqueValueGroups);return this.styleOrigin&&(t._set("styleOrigin",Object.freeze(ie(this.styleOrigin))),Object.freeze(e),Object.freeze(r)),t._set("uniqueValueInfos",e),t._updateValueInfoMap(),t._set("uniqueValueGroups",r),t._isInfosSource=this._isInfosSource,t._watchUniqueValueInfosAndGroups(),t}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(t,e){const r=[this.collectVVRequiredFields(t,e),this.collectSymbolFields(t,e)];await Promise.all(r)}async collectSymbolFields(t,e){const r=[...this.getSymbols().map(i=>i.collectRequiredFields(t,e)),pu(t,e,this.valueExpression)];gh(t,e,this.field),gh(t,e,this.field2),gh(t,e,this.field3),await Promise.all(r)}populateFromStyle(){return Lpe(this.styleOrigin,{portal:this.portal}).then(t=>{var r;const e=[];return this._valueInfoMap={},t&&t.data&&Array.isArray(t.data.items)&&t.data.items.forEach(i=>{const n=new kE({styleUrl:t.styleUrl,styleName:t.styleName,portal:this.portal,name:i.name});this.defaultSymbol||i.name!==t.data.defaultItem||(this.defaultSymbol=n,this._isDefaultSymbolDerived=!0);const s=new BD({value:i.name,symbol:n});e.push(s),this._valueInfoMap[i.name]=s}),this._set("uniqueValueInfos",Object.freeze(e)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&((r=this.uniqueValueInfos)!=null&&r.length)&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",xKt)}_updateUniqueValues(){this._isInfosSource!=null&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:t}=this;if(t)for(const e of t)this._valueInfoMap[e.value+""]=e}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(NRe);const{uniqueValueInfos:t}=this;if(t){const e=[];for(const r of t)e.push(pe(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(i,n)=>{i!==n&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(e,NRe)}}_watchUniqueValueGroups(){this.removeHandles(FRe);const{uniqueValueGroups:t}=this;if(t){const e=[];for(const r of t){e.push(pe(()=>({classes:r.classes}),(i,n)=>{i!==n&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const i of r.classes??[])e.push(pe(()=>({symbol:i.symbol,values:i.values,label:i.label,description:i.description}),(n,s)=>{n!==s&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(e,FRe)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const t=[],{field:e,field2:r,field3:i,fieldDelimiter:n,uniqueValueGroups:s,valueExpression:o}=this;if(!e&&!o)return this._set("uniqueValueInfos",t),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!e||!r);for(const l of s)for(const c of l.classes??[]){const{symbol:u,label:h,values:f,description:m}=c;for(const g of f??[]){const{value:y,value2:_,value3:b}=g,w=[y];r&&w.push(_),i&&w.push(b);const x=a?w.join(n||""):w[0];t.push(new BD({symbol:u,label:h,value:x,description:m}))}}this._set("uniqueValueInfos",t),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(t=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:e,field2:r,valueExpression:i,fieldDelimiter:n,uniqueValueInfos:s}=this;if(!e&&!i||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const o=!(!e||!r),a=s.map(c=>{var b;const{symbol:u,label:h,value:f,description:m}=c,[g,y,_]=o?((b=f==null?void 0:f.toString())==null?void 0:b.split(n||""))||[]:[f];return new lqe({symbol:u,label:h,description:m,values:[new HA({value:g,value2:y,value3:_})]})}),l=[new zse({classes:a})];t&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(t,e){return this.valueExpression?this._getUnqiueValueInfoForExpression(t,e):this._getUnqiueValueInfoForFields(t)}_getUnqiueValueInfoForExpression(t,e){const{viewingMode:r,scale:i,spatialReference:n,arcade:s}=e??{};let o=this._cache.compiledFunc;const a=s.arcadeUtils;if(!o){const c=a.createSyntaxTree(this.valueExpression);o=a.createFunction(c),this._cache.compiledFunc=o}const l=a.executeFunction(o,a.createExecContext(t,a.getViewInfo({viewingMode:r,scale:i,spatialReference:n})));return this._valueInfoMap[l+""]}_getUnqiueValueInfoForFields(t){const e=this.field,r=t.attributes;let i;if(typeof e!="function"&&this.field2){const n=this.field2,s=this.field3,o=[];e&&o.push(r[e]),n&&o.push(r[n]),s&&o.push(r[s]),i=o.join(this.fieldDelimiter||"")}else typeof e=="function"?i=e(t):e&&(i=r[e]);return this._valueInfoMap[i+""]}static fromPortalStyle(t,e){const r=new _L(e&&e.properties);r._set("styleOrigin",Object.freeze({styleName:t})),r._set("portal",e&&e.portal||Ns.getDefault());const i=r.populateFromStyle();return i.catch(n=>{Z1.error(`#fromPortalStyle('${t}'[, ...])`,"Failed to create unique value renderer from style name",n)}),i}static fromStyleUrl(t,e){const r=new _L(e&&e.properties);r._set("styleOrigin",Object.freeze({styleUrl:t}));const i=r.populateFromStyle();return i.catch(n=>{Z1.error(`#fromStyleUrl('${t}'[, ...])`,"Failed to create unique value renderer from style URL",n)}),i}};d([p({readOnly:!0})],ms.prototype,"_cache",null),d([Rt({uniqueValue:"unique-value"})],ms.prototype,"type",void 0),d([p(eqe)],ms.prototype,"backgroundFillSymbol",void 0),d([p({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],ms.prototype,"field",null),d([ur("field")],ms.prototype,"castField",null),d([tt("field")],ms.prototype,"writeField",null),d([p({type:String,value:null,json:{write:!0}})],ms.prototype,"field2",null),d([p({type:String,value:null,json:{write:!0}})],ms.prototype,"field3",null),d([p({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],ms.prototype,"orderByClassesEnabled",void 0),d([p({type:String,value:null,json:{write:!0}})],ms.prototype,"valueExpression",null),d([p({type:String,json:{write:!0}})],ms.prototype,"valueExpressionTitle",void 0),d([p({type:GA,json:{write:!0}})],ms.prototype,"legendOptions",void 0),d([p({type:String,json:{write:!0}})],ms.prototype,"defaultLabel",void 0),d([p(c$e({...tM},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],ms.prototype,"defaultSymbol",null),d([p({type:String,value:null,json:{write:!0}})],ms.prototype,"fieldDelimiter",null),d([p({type:Ns,readOnly:!0})],ms.prototype,"portal",void 0),d([ke("portal",["styleName"])],ms.prototype,"readPortal",null),d([p({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],ms.prototype,"styleOrigin",void 0),d([ke("styleOrigin",["styleName","styleUrl"])],ms.prototype,"readStyleOrigin",null),d([tt("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],ms.prototype,"writeStyleOrigin",null),d([p({type:[zse],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(t,e,r)=>(e.uniqueValueGroups||TKt(e)).map(i=>zse.fromJSON(i,r))},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ms.prototype,"uniqueValueGroups",null),d([p({type:[BD],json:{read:!1,write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],ms.prototype,"uniqueValueInfos",null),ms=_L=d([I(cqe)],ms);const Pfe=ms,JF={key:"type",base:c1,typeMap:{heatmap:oqe,simple:ZF,"unique-value":Pfe,"class-breaks":rqe,"dot-density":uKt,dictionary:lKt,"pie-chart":yKt},errorContext:"renderer"},Mfe={key:"type",base:c1,typeMap:{simple:ZF,"unique-value":Pfe,"class-breaks":rqe,heatmap:oqe},errorContext:"renderer"};function oOr(t,e){return g4(t,null,e)}const EKt=E3({types:JF});function g4(t,e,r){return t?t&&(t.styleName||t.styleUrl)&&t.type!=="uniqueValue"?(r&&r.messages&&r.messages.push(new nf("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+t.type+"'",{definition:t,context:r})),null):EKt(t,e,r):null}function CKt(t){return"portalItem"in t}const uqe=t=>{let e=class extends t{get apiKey(){var r;return this._isOverridden("apiKey")?this._get("apiKey"):CKt(this)?(r=this.portalItem)==null?void 0:r.apiKey:null}set apiKey(r){r!=null?this._override("apiKey",r):(this._clearOverride("apiKey"),this.clear("apiKey","user"))}};return d([p({type:String})],e.prototype,"apiKey",null),e=d([I("esri.layers.mixins.APIKeyMixin")],e),e},dqe=t=>{let e=class extends t{get title(){if(this._get("title")&&this.originOf("title")!=="defaults")return this._get("title");if(this.url){const r=$E(this.url);if(r!=null&&r.title)return r.title}return this._get("title")||""}set title(r){this._set("title",r)}set url(r){this._set("url",gyt(r,re.getLogger(this)))}};return d([p()],e.prototype,"title",null),d([p({type:String})],e.prototype,"url",null),e=d([I("esri.layers.mixins.ArcGISService")],e),e},hqe=new pn.EventEmitter;function aOr(t,e,r=!1){const i=Da();return r=e==null||r,hqe.emit("apply-edits",{serviceUrl:t,layerId:e,mayReceiveServiceEdits:r,result:i.promise}),i}const pqe="esri.layers.mixins.EditBusLayer",fqe=Symbol(pqe);function lOr(t){return t!=null&&typeof t=="object"&&fqe in t}const mqe=t=>{var e;let r=class extends t{constructor(...i){super(...i),this[e]=!0,this.when().then(()=>{this.own([hqe.on("apply-edits",n=>{const{serviceUrl:s,layerId:o,mayReceiveServiceEdits:a,result:l}=n,c=s===this.url,u=o!=null&&this.layerId!=null&&o===this.layerId;if(!c||!u&&!a)return;const h=l.then(f=>{var g;if(u&&(f.addedFeatures.length||f.updatedFeatures.length||f.deletedFeatures.length||f.addedAttachments.length||f.updatedAttachments.length||f.deletedAttachments.length))return this.emit("edits",ie(f)),f;const m=(g=f.editedFeatures)==null?void 0:g.find(({layerId:y})=>y===this.layerId);if(m){const{adds:y,updates:_,deletes:b}=m.editedFeatures,w={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:y?y.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],deletedFeatures:b?b.map(({attributes:x})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],updatedFeatures:_?_.map(({current:{attributes:x}})=>({objectId:this.objectIdField&&x[this.objectIdField],globalId:this.globalIdField&&x[this.globalIdField]})):[],editedFeatures:ie(f.editedFeatures),exceededTransferLimit:!1};return this.emit("edits",w),w}return{edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:ie(f.editedFeatures),exceededTransferLimit:!1}});this.emit("apply-edits",{result:h})})])},()=>{})}};return e=fqe,r=d([I(pqe)],r),r};async function RKt(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return UO(t);const r=dt.WGS84;return await sue(e,r),o0(t,r)}function cOr(t,e){if(!gqe(t,e)){const r=t.typeKeywords;r?r.push(e):t.typeKeywords=[e]}}function gqe(t,e){var r;return!!((r=t.typeKeywords)!=null&&r.includes(e))}function uOr(t){return gqe(t,OKt.HOSTED_SERVICE)}function dOr(t,e){const r=t.typeKeywords;if(r){const i=r.indexOf(e);i>-1&&r.splice(i,1)}}async function hOr(t){const e=t.clone().normalize();let r;if(e.length>1)for(const i of e)r?i.width>r.width&&(r=i):r=i;else r=e[0];return RKt(r)}const OKt={DEVELOPER_BASEMAP:"DeveloperBasemap",JSAPI:"ArcGIS API for JavaScript",METADATA:"Metadata",MULTI_LAYER:"Multilayer",SINGLE_LAYER:"Singlelayer",TABLE:"Table",HOSTED_SERVICE:"Hosted Service"};function kRe(t){var l;const{portal:e,isOrgItem:r,itemControl:i}=t,n=(l=e.user)==null?void 0:l.privileges;let s=!n||n.includes("features:user:edit"),o=!!r&&!!(n!=null&&n.includes("features:user:fullEdit"));const a=i==="update"||i==="admin";return a?o=s=!0:o&&(s=!0),{features:{edit:s,fullEdit:o},content:{updateItem:a}}}const $fe=t=>{let e=class extends t{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=qe(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(r){r!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",r))}readPortalItem(r,i,n){if(i.itemId)return new Qv({id:i.itemId,portal:n&&n.portal})}writePortalItem(r,i){r&&r.id&&(i.itemId=r.id)}async loadFromPortal(r,i){if(this.portalItem&&this.portalItem.id)try{const{load:n}=await le(()=>import("./layersLoader-8bc96631.js"),["assets/layersLoader-8bc96631.js","assets/fetchService-7b5f3ba7.js","assets/jsonContext-03b7f0b9.js"]);return vr(i),await n({instance:this,supportedTypes:r.supportedTypes,validateItem:r.validateItem,supportsData:r.supportsData,layerModuleTypeMap:r.layerModuleTypeMap},i)}catch(n){throw Yn(n)||re.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})
  ${n}`),n}}async finishLoadEditablePortalLayer(r){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(r).catch(i=>(Oa(i),!0)))}async _setUserPrivileges(r,i){if(!Ti.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(i);if(this.url)try{const{features:{edit:n,fullEdit:s},content:{updateItem:o}}=await this._fetchUserPrivileges(r,i);this._set("userHasEditingPrivileges",n),this._set("userHasFullEditingPrivileges",s),this._set("userHasUpdateItemPrivileges",o)}catch(n){Oa(n)}}async _fetchUserPrivileges(r,i){let n=this.portalItem;if(!r||!n||!n.loaded||n.sourceUrl)return this._fetchFallbackUserPrivileges(i);const s=r===n.id;if(s&&n.portal.user)return kRe(n);let o,a;if(s)o=n.portal.url;else try{o=await KIe(this.url,i)}catch(h){Oa(h)}if(!o||!but(o,n.portal.url))return this._fetchFallbackUserPrivileges(i);try{const h=i!=null?i.signal:null;a=await(Hr==null?void 0:Hr.getCredential(`${o}/sharing`,{prompt:!1,signal:h}))}catch(h){Oa(h)}const l=!0,c=!1,u=!1;if(!a)return{features:{edit:l,fullEdit:c},content:{updateItem:u}};try{if(s?await n.reload():(n=new Qv({id:r,portal:{url:o}}),await n.load(i)),n.portal.user)return kRe(n)}catch(h){Oa(h)}return{features:{edit:l,fullEdit:c},content:{updateItem:u}}}async _fetchFallbackUserPrivileges(r){let i=!0;try{i=await this._fetchUserHasEditingPrivileges(r)}catch(n){Oa(n)}return{features:{edit:i,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(r){const i=this.url?Hr==null?void 0:Hr.findCredential(this.url):null;if(!i)return!0;const n=PU.credential===i?PU.user:await this._fetchEditingUser(r);return PU.credential=i,PU.user=n,n==null||n.privileges==null||n.privileges.includes("features:user:edit")}async _fetchEditingUser(r){var u,h;const i=(h=(u=this.portalItem)==null?void 0:u.portal)==null?void 0:h.user;if(i)return i;const n=Hr.findServerInfo(this.url??"");if(!(n!=null&&n.owningSystemUrl))return null;const s=`${n.owningSystemUrl}/sharing/rest`,o=Ns.getDefault();if(o&&o.loaded&&qp(o.restUrl)===qp(s))return o.user;const a=`${s}/community/self`,l=r!=null?r.signal:null,c=await wd(ti(a,{authMode:"no-prompt",query:{f:"json"},signal:l}));return c.ok?Pce.fromJSON(c.value.data):null}read(r,i){i&&(i.layer=this),super.read(r,i)}write(r,i){const n=i&&i.portal,s=this.portalItem&&this.portalItem.id&&(this.portalItem.portal||Ns.getDefault());return n&&s&&!y$e(s.restUrl,n.restUrl)?(i.messages&&i.messages.push(new H("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(r,{...i,layer:this})}};return d([p({type:Qv})],e.prototype,"portalItem",null),d([ke("web-document","portalItem",["itemId"])],e.prototype,"readPortalItem",null),d([tt("web-document","portalItem",{itemId:{type:String}})],e.prototype,"writePortalItem",null),d([p({clonable:!1})],e.prototype,"resourceReferences",void 0),d([p({type:Boolean,readOnly:!0})],e.prototype,"userHasEditingPrivileges",void 0),d([p({type:Boolean,readOnly:!0})],e.prototype,"userHasFullEditingPrivileges",void 0),d([p({type:Boolean,readOnly:!0})],e.prototype,"userHasUpdateItemPrivileges",void 0),e=d([I("esri.layers.mixins.PortalLayer")],e),e},PU={credential:null,user:null},xq=t=>{let e=class extends t{constructor(){super(...arguments),this.minScale=0,this.maxScale=0}get effectiveScaleRange(){const r={minScale:this.minScale,maxScale:this.maxScale},i=this.parent;i&&"effectiveScaleRange"in i&&AKt(r,i.effectiveScaleRange);const n=this._get("effectiveScaleRange");return n&&n.minScale===r.minScale&&n.maxScale===r.maxScale?n:r}};return d([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minScale",void 0),d([p({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"maxScale",void 0),d([p({readOnly:!0})],e.prototype,"effectiveScaleRange",null),e=d([I("esri.layers.mixins.ScaleRangeLayer")],e),e};function AKt(t,e){return t.minScale=t.minScale>0?e.minScale>0?Math.min(t.minScale,e.minScale):t.minScale:e.minScale,t.maxScale=t.maxScale>0?e.maxScale>0?Math.max(t.maxScale,e.maxScale):t.maxScale:e.maxScale,t}async function PKt(t,e,r,i,n,s){let o=null;if(r!=null){const c=`${t}/nodepages/`,u=c+Math.floor(r.rootIndex/r.nodesPerPage);try{return{type:"page",rootPage:(await ti(u,{query:{f:"json",token:i},responseType:"json",signal:s})).data,rootIndex:r.rootIndex,pageSize:r.nodesPerPage,lodMetric:r.lodSelectionMetricType,urlPrefix:c}}catch(h){n!=null&&n.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",u,h),o=h}}if(!e)return null;const a=`${t}/nodes/`,l=a+(e&&e.split("/").pop());try{return{type:"node",rootNode:(await ti(l,{query:{f:"json",token:i},responseType:"json",signal:s})).data,urlPrefix:a}}catch(c){throw new H("sceneservice:root-node-missing","Root node missing.",{pageError:o,nodeError:c,url:l})}}let MKt=null;function $Kt(){return MKt}const yqe="esri.layers.mixins.SceneService",gR=re.getLogger(yqe),IKt=t=>{let e=class extends t{constructor(){super(...arguments),this.spatialReference=null,this.fullExtent=null,this.heightModelInfo=null,this.minScale=0,this.maxScale=0,this.version={major:Number.NaN,minor:Number.NaN,versionString:""},this.copyright=null,this.sublayerTitleMode="item-title",this.title=null,this.layerId=null,this.indexInfo=null,this._debouncedSaveOperations=B4(async(r,i,n)=>{switch(r){case a3.SAVE:return this._save(i);case a3.SAVE_AS:return this._saveAs(n,i)}})}readSpatialReference(r,i){return this._readSpatialReference(i)}_readSpatialReference(r){if(r.spatialReference!=null)return dt.fromJSON(r.spatialReference);{const i=r.store,n=i.indexCRS||i.geographicCRS,s=n&&parseInt(n.substring(n.lastIndexOf("/")+1,n.length),10);return s!=null?new dt(s):null}}readFullExtent(r,i,n){if(r!=null&&typeof r=="object"){const a=r.spatialReference==null?{...r,spatialReference:this._readSpatialReference(i)}:r;return $r.fromJSON(a,n)}const s=i.store,o=this._readSpatialReference(i);return o==null||s==null||s.extent==null||!Array.isArray(s.extent)||s.extent.some(a=>a<wJ)?null:new $r({xmin:s.extent[0],ymin:s.extent[1],xmax:s.extent[2],ymax:s.extent[3],spatialReference:o})}parseVersionString(r){const i={major:Number.NaN,minor:Number.NaN,versionString:r},n=r.split(".");return n.length>=2&&(i.major=parseInt(n[0],10),i.minor=parseInt(n[1],10)),i}readVersion(r,i){const n=i.store,s=n.version!=null?n.version.toString():"";return this.parseVersionString(s)}readTitlePortalItem(r){return this.sublayerTitleMode!=="item-title"?void 0:r}readTitleService(r,i){const n=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return HDe(this.url,i.name);let s=i.name;if(!s&&this.url){const o=$E(this.url);o!=null&&(s=o.title)}return this.sublayerTitleMode==="item-title-and-service-name"&&n&&(s=n+" - "+s),F7(s)}set url(r){const i=qDe({layer:this,url:r,nonStandardUrlAllowed:!1,logger:gR});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,n,s){WDe(this,r,"layers",i,s)}get parsedUrl(){const r=this._get("url"),i=Ts(r);return this.layerId!=null&&(i.path=`${i.path}/layers/${this.layerId}`),i}async _fetchIndexAndUpdateExtent(r,i){this.indexInfo=PKt(this.parsedUrl.path,this.rootNode,r,this.apiKey,gR,i),this.fullExtent==null||this.fullExtent.hasZ||this._updateExtent(await this.indexInfo)}_updateExtent(r){var i,n,s;if((r==null?void 0:r.type)==="page"){const o=r.rootIndex%r.pageSize,a=(n=(i=r.rootPage)==null?void 0:i.nodes)==null?void 0:n[o];if(a==null||a.obb==null||a.obb.center==null||a.obb.halfSize==null)throw new H("sceneservice:invalid-node-page","Invalid node page.");if(a.obb.center[0]<wJ||this.fullExtent==null||this.fullExtent.hasZ)return;const l=a.obb.halfSize,c=a.obb.center[2],u=Math.sqrt(l[0]*l[0]+l[1]*l[1]+l[2]*l[2]);this.fullExtent.zmin=c-u,this.fullExtent.zmax=c+u}else if((r==null?void 0:r.type)==="node"){const o=(s=r.rootNode)==null?void 0:s.mbs;if(!Array.isArray(o)||o.length!==4||o[0]<wJ)return;const a=o[2],l=o[3],{fullExtent:c}=this;c&&(c.zmin=a-l,c.zmax=a+l)}}async _fetchService(r){if(this.url==null)throw new H("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(this.layerId==null&&/SceneServer\/*$/i.test(this.url)){const i=await this._fetchFirstLayerId(r);i!=null&&(this.layerId=i)}return this._fetchServiceLayer(r)}async _fetchFirstLayerId(r){const i=await ti(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});if(i.data&&Array.isArray(i.data.layers)&&i.data.layers.length>0)return i.data.layers[0].id}async _fetchServiceLayer(r){var o;const i=await ti(((o=this.parsedUrl)==null?void 0:o.path)??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r});i.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let n=!1;if(i.data.layerType&&i.data.layerType==="Voxel"&&(n=!0),n)return this._fetchVoxelServiceLayer();const s=i.data;this.read(s,this._getServiceContext()),this.validateLayer(s)}async _fetchVoxelServiceLayer(r){var n;const i=(await ti(((n=this.parsedUrl)==null?void 0:n.path)+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:r})).data;this.read(i,this._getServiceContext()),this.validateLayer(i)}_getServiceContext(){var r;return{origin:"service",portalItem:this.portalItem,portal:(r=this.portalItem)==null?void 0:r.portal,url:this.parsedUrl}}async _ensureLoadBeforeSave(){await this.load(),"beforeSave"in this&&typeof this.beforeSave=="function"&&await this.beforeSave()}validateLayer(r){}_updateTypeKeywords(r,i,n){r.typeKeywords||(r.typeKeywords=[]);const s=i.getTypeKeywords();for(const o of s)r.typeKeywords.push(o);r.typeKeywords&&(r.typeKeywords=r.typeKeywords.filter((o,a,l)=>l.indexOf(o)===a),n===jD.newItem&&(r.typeKeywords=r.typeKeywords.filter(o=>o!=="Hosted Service")))}async _saveAs(r,i){var c;const n={...URe,...i};let s=Qv.from(r);s||(gR.error("_saveAs(): requires a portal item parameter"),await Promise.reject(new H("sceneservice:portal-item-required","_saveAs() requires a portal item to save to"))),s.id&&(s=s.clone(),s.id=null);const o=s.portal||Ns.getDefault();await this._ensureLoadBeforeSave(),s.type=MU,s.portal=o;const a={origin:"portal-item",url:null,messages:[],portal:o,portalItem:s,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},l={layers:[this.write({},a)]};return await Promise.all(a.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(l,a,n),s.url=this.url,s.title||(s.title=this.title),this._updateTypeKeywords(s,n,jD.newItem),await o.signIn(),await((c=o.user)==null?void 0:c.addItem({item:s,folder:n&&n.folder,data:l})),await qV(this.resourceReferences,a,null),this.portalItem=s,UV(a),a.portalItem=s,s}async _save(r){const i={...URe,...r};if(!this.portalItem)throw gR.error("_save(): requires the .portalItem property to be set"),new H("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if(this.portalItem.type!==MU)throw gR.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected "+MU),new H("sceneservice:portal-item-wrong-type",`Portal item needs to have type "${MU}"`);await this._ensureLoadBeforeSave();const n={origin:"portal-item",url:this.portalItem.itemUrl&&Ts(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||Ns.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},s={layers:[this.write({},n)]};return await Promise.all(n.resources.pendingOperations??[]),await this._validateAgainstJSONSchema(s,n,i),this.portalItem.url=this.url,this.portalItem.title||(this.portalItem.title=this.title),this._updateTypeKeywords(this.portalItem,i,jD.existingItem),await this.portalItem.update({data:s}),await qV(this.resourceReferences,n,null),UV(n),this.portalItem}async _validateAgainstJSONSchema(r,i,n){var c,u;let s=((c=i.messages)==null?void 0:c.filter(h=>h.type==="error").map(h=>new H(h.name,h.message,h.details)))??[];(u=n==null?void 0:n.validationOptions)!=null&&u.ignoreUnsupported&&(s=s.filter(h=>h.name!=="layer:unsupported"&&h.name!=="symbol:unsupported"&&h.name!=="symbol-layer:unsupported"&&h.name!=="property:unsupported"&&h.name!=="url:unsupported"&&h.name!=="scenemodification:unsupported"));const o=n==null?void 0:n.validationOptions,a=o==null?void 0:o.enabled,l=$Kt();if(a&&l){const h=(await l()).validate(r,n.portalItemLayerType);if(h.length>0){const f=`Layer item did not validate:
${h.join(`
`)}`;if(gR.error(`_validateAgainstJSONSchema(): ${f}`),o.failPolicy==="throw"){const m=h.map(g=>new H("sceneservice:schema-validation",g)).concat(s);throw new H("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:m})}}}if(s.length>0)throw new H("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:s})}};return d([p(Eue)],e.prototype,"id",void 0),d([p({type:dt})],e.prototype,"spatialReference",void 0),d([ke("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readSpatialReference",null),d([p({type:$r})],e.prototype,"fullExtent",void 0),d([ke("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],e.prototype,"readFullExtent",null),d([p({readOnly:!0,type:q_})],e.prototype,"heightModelInfo",void 0),d([p({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],e.prototype,"minScale",void 0),d([p({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],e.prototype,"maxScale",void 0),d([p({readOnly:!0})],e.prototype,"version",void 0),d([ke("version",["store.version"])],e.prototype,"readVersion",null),d([p({type:String,json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0),d([p({type:String,json:{read:!1}})],e.prototype,"sublayerTitleMode",void 0),d([p({type:String})],e.prototype,"title",void 0),d([ke("portal-item","title")],e.prototype,"readTitlePortalItem",null),d([ke("service","title",["name"])],e.prototype,"readTitleService",null),d([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],e.prototype,"layerId",void 0),d([p(xue)],e.prototype,"url",null),d([tt("url")],e.prototype,"writeUrl",null),d([p()],e.prototype,"parsedUrl",null),d([p({readOnly:!0})],e.prototype,"store",void 0),d([p({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],e.prototype,"rootNode",void 0),e=d([I(yqe)],e),e},wJ=-1e38;var jD;(function(t){t[t.existingItem=0]="existingItem",t[t.newItem=1]="newItem"})(jD||(jD={}));const MU="Scene Service",URe={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};var a3;(function(t){t[t.SAVE=0]="SAVE",t[t.SAVE_AS=1]="SAVE_AS"})(a3||(a3={}));const LKt={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsAsyncApplyEdits:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};let p_=class extends me{constructor(){super(...arguments),this.type=null}};d([p({type:["selection","cluster","binning"],readOnly:!0,json:{read:!1,write:!0}})],p_.prototype,"type",void 0),p_=d([I("esri.layers.support.FeatureReduction")],p_);var Bse;let d9=Bse=class extends p_{constructor(t){super(t),this.type="selection"}clone(){return new Bse}};d([p({type:["selection"]})],d9.prototype,"type",void 0),d9=Bse=d([I("esri.layers.support.FeatureReductionSelection")],d9);const jse=d9;async function DKt(t,e){const{WhereClause:r}=await le(()=>import("./WhereClause-50cca87e.js").then(i=>i.W),["assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js"]);return r.create(t,e)}function NKt(t,e){return t!=null?e!=null?`(${t}) AND (${e})`:t:e}var Gse;let bT=Gse=class extends me{constructor(t){super(t),this.expression=null,this.name=null,this.returnType="boolean",this.title=null}clone(){return new Gse({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};d([p({type:String,json:{write:!0}})],bT.prototype,"expression",void 0),d([p({type:String,json:{write:!0}})],bT.prototype,"name",void 0),d([p({type:["boolean","date","number","string"],json:{write:!0}})],bT.prototype,"returnType",void 0),d([p({type:String,json:{write:!0}})],bT.prototype,"title",void 0),bT=Gse=d([I("esri.form.ExpressionInfo")],bT);const FKt=bT;let wT=class extends me{constructor(e){super(e),this.description=null,this.label=null,this.type=null,this.visibilityExpression=null}};d([p({type:String,json:{write:!0}})],wT.prototype,"description",void 0),d([p({type:String,json:{write:!0}})],wT.prototype,"label",void 0),d([p()],wT.prototype,"type",void 0),d([p({type:String,json:{write:!0}})],wT.prototype,"visibilityExpression",void 0),wT=d([I("esri.form.elements.Element")],wT);const l3=wT;var Hse;let h9=Hse=class extends me{constructor(t){super(t),this.type=null}clone(){return new Hse({type:this.type})}};d([p({type:["attachment","audio","document","image","signature","video"],json:{write:!0}})],h9.prototype,"type",void 0),h9=Hse=d([I("esri.form.elements.inputs.AttachmentInput")],h9);const kKt=h9;var qse;let xT=qse=class extends l3{constructor(t){super(t),this.attachmentKeyword=null,this.editable=!0,this.input=null,this.type="attachment"}clone(){return new qse({attachmentKeyword:this.attachmentKeyword,description:this.description,editable:this.editable,input:this.input,label:this.label,visibilityExpression:this.visibilityExpression})}};d([p({type:String,json:{write:!0}})],xT.prototype,"attachmentKeyword",void 0),d([p({type:Boolean,json:{write:!0}})],xT.prototype,"editable",void 0),d([p({type:kKt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],xT.prototype,"input",void 0),d([p({type:["attachment"],json:{read:!1,write:!0}})],xT.prototype,"type",void 0),xT=qse=d([I("esri.form.elements.AttachmentElement")],xT);const zRe=xT;let p9=class extends me{constructor(e){super(e),this.type=null}};d([p()],p9.prototype,"type",void 0),p9=d([I("esri.form.elements.inputs.Input")],p9);const rM=p9;let bL=class extends rM{constructor(e){super(e),this.maxLength=null,this.minLength=0}};d([p({type:Number,json:{write:!0}})],bL.prototype,"maxLength",void 0),d([p({type:Number,json:{write:!0}})],bL.prototype,"minLength",void 0),bL=d([I("esri.form.elements.inputs.TextInput")],bL);const Ife=bL;var Wse;let f9=Wse=class extends Ife{constructor(t){super(t),this.type="barcode-scanner"}clone(){return new Wse({maxLength:this.maxLength,minLength:this.minLength})}};d([p({type:["barcode-scanner"],json:{read:!1,write:!0}})],f9.prototype,"type",void 0),f9=Wse=d([I("esri.form.elements.inputs.BarcodeScannerInput")],f9);const UKt=f9;var Xse;let pO=Xse=class extends rM{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="combo-box"}clone(){return new Xse({showNoValueOption:this.showNoValueOption,noValueOptionLabel:this.noValueOptionLabel})}};d([p({type:String,json:{write:!0}})],pO.prototype,"noValueOptionLabel",void 0),d([p({type:Boolean,json:{write:!0}})],pO.prototype,"showNoValueOption",void 0),d([p({type:["combo-box"],json:{read:!1,write:!0}})],pO.prototype,"type",void 0),pO=Xse=d([I("esri.form.elements.inputs.ComboBoxInput")],pO);const zKt=pO;var Yse;function VRe(t){return t!=null?new Date(t):null}function BRe(t){return t?t.getTime():null}let lm=Yse=class extends rM{constructor(t){super(t),this.includeTime=!1,this.max=null,this.min=null,this.type="datetime-picker"}readMax(t,e){return VRe(e.max)}writeMax(t,e){e.max=BRe(t)}readMin(t,e){return VRe(e.min)}writeMin(t,e){e.min=BRe(t)}clone(){return new Yse({includeTime:this.includeTime,max:this.max,min:this.min})}};d([p({type:Boolean,json:{write:!0}})],lm.prototype,"includeTime",void 0),d([p({type:Date,json:{type:Number,write:!0}})],lm.prototype,"max",void 0),d([ke("max")],lm.prototype,"readMax",null),d([tt("max")],lm.prototype,"writeMax",null),d([p({type:Date,json:{type:Number,write:!0}})],lm.prototype,"min",void 0),d([ke("min")],lm.prototype,"readMin",null),d([tt("min")],lm.prototype,"writeMin",null),d([p({type:["datetime-picker"],json:{read:!1,write:!0}})],lm.prototype,"type",void 0),lm=Yse=d([I("esri.form.elements.inputs.DateTimePickerInput")],lm);const VKt=lm;var Zse;let fO=Zse=class extends rM{constructor(t){super(t),this.noValueOptionLabel=null,this.showNoValueOption=!0,this.type="radio-buttons"}clone(){return new Zse({noValueOptionLabel:this.noValueOptionLabel,showNoValueOption:this.showNoValueOption})}};d([p({type:String,json:{write:!0}})],fO.prototype,"noValueOptionLabel",void 0),d([p({type:Boolean,json:{write:!0}})],fO.prototype,"showNoValueOption",void 0),d([p({type:["radio-buttons"],json:{read:!1,write:!0}})],fO.prototype,"type",void 0),fO=Zse=d([I("esri.form.elements.inputs.RadioButtonsInput")],fO);const BKt=fO;var Jse;let mO=Jse=class extends rM{constructor(t){super(t),this.offValue=null,this.onValue=null,this.type="switch"}clone(){return new Jse({offValue:this.offValue,onValue:this.onValue})}};d([p({type:[String,Number],json:{write:!0}})],mO.prototype,"offValue",void 0),d([p({type:[String,Number],json:{write:!0}})],mO.prototype,"onValue",void 0),d([p({type:["switch"],json:{read:!1,write:!0}})],mO.prototype,"type",void 0),mO=Jse=d([I("esri.form.elements.inputs.SwitchInput")],mO);const jKt=mO;var Kse;let m9=Kse=class extends Ife{constructor(t){super(t),this.type="text-area"}clone(){return new Kse({maxLength:this.maxLength,minLength:this.minLength})}};d([p({type:["text-area"],json:{read:!1,write:!0}})],m9.prototype,"type",void 0),m9=Kse=d([I("esri.form.elements.inputs.TextAreaInput")],m9);const GKt=m9;var Qse;let g9=Qse=class extends Ife{constructor(t){super(t),this.type="text-box"}clone(){return new Qse({maxLength:this.maxLength,minLength:this.minLength})}};d([p({type:["text-box"],json:{read:!1,write:!0}})],g9.prototype,"type",void 0),g9=Qse=d([I("esri.form.elements.inputs.TextBoxInput")],g9);const HKt=g9,qKt={base:rM,key:"type",typeMap:{"barcode-scanner":UKt,"combo-box":zKt,"datetime-picker":VKt,"radio-buttons":BKt,switch:jKt,"text-area":GKt,"text-box":HKt}};var eoe;const vqe="esri.form.elements.FieldElement",jRe=re.getLogger(vqe);let up=eoe=class extends l3{constructor(t){super(t),this.domain=null,this.editableExpression=null,this.fieldName=null,this.hint=null,this.input=null,this.requiredExpression=null,this.type="field",this.valueExpression=null}get editable(){return Lm(jRe,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._get("editable")??!0}set editable(t){Lm(jRe,"editable",{replacement:"editableExpression",version:"4.26",warnOnce:!0}),this._set("editable",t)}clone(){return new eoe({description:this.description,domain:this.domain,editable:this.editable,editableExpression:this.editableExpression,fieldName:this.fieldName,hint:this.hint,input:this.input,label:this.label,requiredExpression:this.requiredExpression,valueExpression:this.valueExpression,visibilityExpression:this.visibilityExpression})}};d([p({types:Cze,json:{read:{reader:zhe},write:!0}})],up.prototype,"domain",void 0),d([p({type:Boolean,json:{write:!0}})],up.prototype,"editable",null),d([p({type:String,json:{write:!0}})],up.prototype,"editableExpression",void 0),d([p({type:String,json:{write:!0}})],up.prototype,"fieldName",void 0),d([p({type:String,json:{write:!0}})],up.prototype,"hint",void 0),d([p({types:qKt,json:{read:{source:"inputType"},write:{target:"inputType"}}})],up.prototype,"input",void 0),d([p({type:String,json:{write:!0}})],up.prototype,"requiredExpression",void 0),d([p({type:String,json:{read:!1,write:!0}})],up.prototype,"type",void 0),d([p({type:String,json:{write:!0}})],up.prototype,"valueExpression",void 0),up=eoe=d([I(vqe)],up);const GRe=up;var toe;let bv=toe=class extends l3{constructor(t){super(t),this.displayCount=null,this.displayType="list",this.editableExpression=null,this.orderByFields=null,this.relationshipId=null,this.type="relationship"}clone(){return new toe({description:this.description,displayCount:this.displayCount,displayType:this.displayType,editableExpression:this.editableExpression,label:this.label,orderByFields:ie(this.orderByFields),relationshipId:this.relationshipId,visibilityExpression:this.visibilityExpression})}};d([p({type:Number,json:{write:!0}})],bv.prototype,"displayCount",void 0),d([p({type:["list"],json:{write:!0}})],bv.prototype,"displayType",void 0),d([p({type:String,json:{write:!0}})],bv.prototype,"editableExpression",void 0),d([p({type:[kue],json:{write:!0}})],bv.prototype,"orderByFields",void 0),d([p({type:Number,json:{write:!0}})],bv.prototype,"relationshipId",void 0),d([p({type:["relationship"],json:{read:!1,write:!0}})],bv.prototype,"type",void 0),bv=toe=d([I("esri.form.elements.RelationshipElement")],bv);const HRe=bv;function _qe(t){return{typesWithGroup:{base:l3,key:"type",typeMap:{attachment:zRe,field:GRe,group:t,relationship:HRe}},typesWithoutGroup:{base:l3,key:"type",typeMap:{attachment:zRe,field:GRe,relationship:HRe}}}}function bqe(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>i[n.type]).map(n=>i[n.type].fromJSON(n))}function wqe(t,e,r=!0){if(!t)return null;const i=r?e.typesWithGroup.typeMap:e.typesWithoutGroup.typeMap;return t.filter(n=>i[n.type]).map(n=>n.toJSON())}function xqe(t,e,r=!0){return t?t.map(i=>ng(r?e.typesWithGroup:e.typesWithoutGroup,i)):null}var roe;let vy=roe=class extends l3{constructor(t){super(t),this.elements=null,this.initialState="expanded",this.type="group"}castElements(t){return xqe(t,xJ,!1)}readElements(t,e){return bqe(e.formElements,xJ,!1)}writeElements(t,e){e.formElements=wqe(t,xJ,!1)}clone(){return new roe({description:this.description,elements:ie(this.elements),initialState:this.initialState,label:this.label,visibilityExpression:this.visibilityExpression})}};d([p({json:{write:!0}})],vy.prototype,"elements",void 0),d([ur("elements")],vy.prototype,"castElements",null),d([ke("elements",["formElements"])],vy.prototype,"readElements",null),d([tt("elements")],vy.prototype,"writeElements",null),d([p({type:["collapsed","expanded"],json:{write:!0}})],vy.prototype,"initialState",void 0),d([p({type:String,json:{read:!1,write:!0}})],vy.prototype,"type",void 0),vy=roe=d([I("esri.form.elements.GroupElement")],vy);const xJ=_qe(vy),WKt=vy;var ioe;const SJ=_qe(WKt);let cm=ioe=class extends me{constructor(t){super(t),this.description=null,this.elements=null,this.expressionInfos=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}castElements(t){return xqe(t,SJ)}readElements(t,e){return bqe(e.formElements,SJ)}writeElements(t,e){e.formElements=wqe(t,SJ)}clone(){return new ioe({description:this.description,expressionInfos:ie(this.expressionInfos),elements:ie(this.elements),title:this.title,preserveFieldValuesWhenHidden:this.preserveFieldValuesWhenHidden})}};d([p({type:String,json:{write:!0}})],cm.prototype,"description",void 0),d([p({json:{write:!0}})],cm.prototype,"elements",void 0),d([ur("elements")],cm.prototype,"castElements",null),d([ke("elements",["formElements"])],cm.prototype,"readElements",null),d([tt("elements")],cm.prototype,"writeElements",null),d([p({type:[FKt],json:{write:!0}})],cm.prototype,"expressionInfos",void 0),d([p({type:Boolean,json:{default:!1,write:!0}})],cm.prototype,"preserveFieldValuesWhenHidden",void 0),d([p({type:String,json:{write:!0}})],cm.prototype,"title",void 0),cm=ioe=d([I("esri.form.FormTemplate")],cm);const XKt=cm;function qRe(t,e,r){if(t.hasM==null||t.hasZ)for(const i of e)for(const n of i)n.length>2&&(n[2]*=r)}function YKt(t,e,r){if(!t&&!e||!r)return;const i=SN(r);WRe(t,r,i),WRe(e,r,i)}function WRe(t,e,r){if(t)for(const i of t)ZKt(i.geometry,e,r)}function ZKt(t,e,r){if(t==null||!t.spatialReference||So(t.spatialReference,e))return;const i=SN(t.spatialReference)/r;if(i!==1){if("x"in t)t.z!=null&&(t.z*=i);else if("rings"in t)qRe(t,t.rings,i);else if("paths"in t)qRe(t,t.paths,i);else if("points"in t&&(t.hasM==null||t.hasZ))for(const n of t.points)n.length>2&&(n[2]*=i)}}function XRe(t,e,r){if(!r||!r.features||!r.hasZ)return;const i=hDe(r.geometryType,e,t.outSpatialReference);if(i!=null)for(const n of r.features)i(n.geometry)}var noe;const soe=new ri({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryEnvelope:"extent",mesh:"mesh","":null});let Xa=noe=class extends me{constructor(t){super(t),this.displayFieldName=null,this.exceededTransferLimit=!1,this.features=[],this.fields=null,this.geometryType=null,this.hasM=!1,this.hasZ=!1,this.queryGeometry=null,this.spatialReference=null}readFeatures(t,e){const r=dt.fromJSON(e.spatialReference),i=[];for(let n=0;n<t.length;n++){const s=t[n],o=cf.fromJSON(s),a=s.geometry&&s.geometry.spatialReference;o.geometry==null||a||(o.geometry.spatialReference=r);const l=s.aggregateGeometries,c=o.aggregateGeometries;if(l&&c!=null)for(const u in c){const h=c[u],f=l[u],m=f==null?void 0:f.spatialReference;h==null||m||(h.spatialReference=r)}i.push(o)}return i}writeGeometryType(t,e,r,i){if(t)return void soe.write(t,e,r,i);const{features:n}=this;if(n){for(const s of n)if(s&&s.geometry!=null)return void soe.write(s.geometry.type,e,r,i)}}readQueryGeometry(t,e){if(!t)return null;const r=!!t.spatialReference,i=P_(t);return i&&!r&&e.spatialReference&&(i.spatialReference=dt.fromJSON(e.spatialReference)),i}writeSpatialReference(t,e){if(t)return void(e.spatialReference=t.toJSON());const{features:r}=this;if(r){for(const i of r)if(i&&i.geometry!=null&&i.geometry.spatialReference)return void(e.spatialReference=i.geometry.spatialReference.toJSON())}}clone(){return new noe(this.cloneProperties())}cloneProperties(){return ie({displayFieldName:this.displayFieldName,exceededTransferLimit:this.exceededTransferLimit,features:this.features,fields:this.fields,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,queryGeometry:this.queryGeometry,spatialReference:this.spatialReference,transform:this.transform})}toJSON(t){const e=this.write();if(e.features&&Array.isArray(t)&&t.length>0)for(let r=0;r<e.features.length;r++){const i=e.features[r];if(i.geometry){const n=t&&t[r];i.geometry=n&&n.toJSON()||i.geometry}}return e}quantize(t){const{scale:[e,r],translate:[i,n]}=t,s=c=>Math.round((c-i)/e),o=c=>Math.round((n-c)/r),a=this.features,l=this._getQuantizationFunction(this.geometryType,s,o);for(let c=0,u=a.length;c<u;c++)l!=null&&l(a[c].geometry)||(a.splice(c,1),c--,u--);return this.transform=t,this}unquantize(){var f,m;const{geometryType:t,features:e,transform:r}=this;if(!r)return this;const{translate:[i,n],scale:[s,o]}=r,a=g=>g*s+i,l=g=>n-g*o;let c=null,u=null;if(this.hasZ&&((f=r==null?void 0:r.scale)==null?void 0:f[2])!=null){const{translate:[,,g],scale:[,,y]}=r;c=_=>_*y+g}if(this.hasM&&((m=r==null?void 0:r.scale)==null?void 0:m[3])!=null){const{translate:[,,,g],scale:[,,,y]}=r;u=_=>_==null?_:_*y+g}const h=this._getHydrationFunction(t,a,l,c,u);for(const{geometry:g}of e)g!=null&&h&&h(g);return this.transform=null,this}_quantizePoints(t,e,r){let i,n;const s=[];for(let o=0,a=t.length;o<a;o++){const l=t[o];if(o>0){const c=e(l[0]),u=r(l[1]);c===i&&u===n||(s.push([c-i,u-n]),i=c,n=u)}else i=e(l[0]),n=r(l[1]),s.push([i,n])}return s.length>0?s:null}_getQuantizationFunction(t,e,r){return t==="point"?i=>(i.x=e(i.x),i.y=r(i.y),i):t==="polyline"||t==="polygon"?i=>{const n=TA(i)?i.rings:i.paths,s=[];for(let o=0,a=n.length;o<a;o++){const l=n[o],c=this._quantizePoints(l,e,r);c&&s.push(c)}return s.length>0?(TA(i)?i.rings=s:i.paths=s,i):null}:t==="multipoint"?i=>{const n=this._quantizePoints(i.points,e,r);return n&&n.length>0?(i.points=n,i):null}:t==="extent"?i=>i:null}_getHydrationFunction(t,e,r,i,n){return t==="point"?s=>{s.x=e(s.x),s.y=r(s.y),i&&(s.z=i(s.z))}:t==="polyline"||t==="polygon"?s=>{const o=TA(s)?s.rings:s.paths;let a,l;for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let f=0,m=h.length;f<m;f++){const g=h[f];f>0?(a+=g[0],l+=g[1]):(a=g[0],l=g[1]),g[0]=e(a),g[1]=r(l)}}if(i&&n)for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let f=0,m=h.length;f<m;f++){const g=h[f];g[2]=i(g[2]),g[3]=n(g[3])}}else if(i)for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let f=0,m=h.length;f<m;f++){const g=h[f];g[2]=i(g[2])}}else if(n)for(let c=0,u=o.length;c<u;c++){const h=o[c];for(let f=0,m=h.length;f<m;f++){const g=h[f];g[2]=n(g[2])}}}:t==="extent"?s=>{s.xmin=e(s.xmin),s.ymin=r(s.ymin),s.xmax=e(s.xmax),s.ymax=r(s.ymax),i&&s.zmax!=null&&s.zmin!=null&&(s.zmax=i(s.zmax),s.zmin=i(s.zmin)),n&&s.mmax!=null&&s.mmin!=null&&(s.mmax=n(s.mmax),s.mmin=n(s.mmin))}:t==="multipoint"?s=>{const o=s.points;let a,l;for(let c=0,u=o.length;c<u;c++){const h=o[c];c>0?(a+=h[0],l+=h[1]):(a=h[0],l=h[1]),h[0]=e(a),h[1]=r(l)}if(i&&n)for(let c=0,u=o.length;c<u;c++){const h=o[c];h[2]=i(h[2]),h[3]=n(h[3])}else if(i)for(let c=0,u=o.length;c<u;c++){const h=o[c];h[2]=i(h[2])}else if(n)for(let c=0,u=o.length;c<u;c++){const h=o[c];h[2]=n(h[2])}}:null}};d([p({type:String,json:{write:!0}})],Xa.prototype,"displayFieldName",void 0),d([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Xa.prototype,"exceededTransferLimit",void 0),d([p({type:[cf],json:{write:!0}})],Xa.prototype,"features",void 0),d([ke("features")],Xa.prototype,"readFeatures",null),d([p({type:[IF],json:{write:!0}})],Xa.prototype,"fields",void 0),d([p({type:["point","multipoint","polyline","polygon","extent","mesh"],json:{read:{reader:soe.read}}})],Xa.prototype,"geometryType",void 0),d([tt("geometryType")],Xa.prototype,"writeGeometryType",null),d([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Xa.prototype,"hasM",void 0),d([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Xa.prototype,"hasZ",void 0),d([p({types:ME,json:{write:!0}})],Xa.prototype,"queryGeometry",void 0),d([ke("queryGeometry")],Xa.prototype,"readQueryGeometry",null),d([p({type:dt,json:{write:!0}})],Xa.prototype,"spatialReference",void 0),d([tt("spatialReference")],Xa.prototype,"writeSpatialReference",null),d([p({json:{write:!0}})],Xa.prototype,"transform",void 0),Xa=noe=d([I("esri.rest.support.FeatureSet")],Xa),Xa.prototype.toJSON.isDefaultToJSON=!0;const Lfe=Xa;let JKt=0;const Sqe="esri.layers.graphics.sources.MemorySource",TJ=re.getLogger(Sqe);let Mv=class extends sg.LoadableMixin(G4(jE(vt))){constructor(e){super(e),this._idToClientGraphic=null,this.type="memory"}load(e){const r=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(r)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}get _workerGeometryType(){var r;const e=(r=this.layer)==null?void 0:r.geometryType;return e?this._geometryTypeRequiresClientGraphicMapping(e)?"polygon":e:null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}async queryFeatures(e,r={}){await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);XRe(e,this.layer.spatialReference,i);const n=Lfe.fromJSON(i);if(!this._requiresClientGraphicMapping())return n;const s=this.layer.objectIdField;for(const o of n.features){const a=o.attributes[s],l=this._idToClientGraphic.get(a);l&&(o.geometry=l.geometry)}return n.geometryType=this.layer.geometryType,n}async queryFeaturesJSON(e,r={}){if(this._requiresClientGraphicMapping())throw new H("query-features-json:unsupported","Cannot query in JSON format for client only geometry types (mesh and extent)");await this.load(r);const i=await this._connection.invoke("queryFeatures",e?e.toJSON():null,r);return XRe(e,this.layer.spatialReference,i),i}queryFeatureCount(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,r))}queryObjectIds(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,r))}queryExtent(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,r)).then(i=>({count:i.count,extent:$r.fromJSON(i.extent)}))}querySnapping(e,r={}){return this.load(r).then(()=>this._connection.invoke("querySnapping",e,r))}async _applyEdits(e){if(!this._connection)throw new H("feature-layer-source:edit-failure","Memory source not loaded");const r=this.layer.objectIdField;let i=null;const n=[],s=[];await Promise.all([this._prepareClientMapping(e.addFeatures,null),this._prepareClientMapping(e.updateFeatures,null)]);const o=u=>"objectId"in u&&u.objectId!=null?u.objectId:"attributes"in u&&u.attributes[r]!=null?u.attributes[r]:null;if(e.addFeatures&&(i=this._prepareAddFeatures(e.addFeatures)),e.deleteFeatures)for(const u of e.deleteFeatures){const h=o(u);h!=null&&n.push(h)}const a=e.updateFeatures&&this._idToClientGraphic?new Map:null;if(e.updateFeatures){for(const u of e.updateFeatures)if(s.push(this._serializeFeature(u)),a){const h=o(u);h!=null&&a.set(h,u)}}YKt(i?i.features:null,s,this.layer.spatialReference);const{fullExtent:l,featureEditResults:c}=await this._connection.invoke("applyEdits",{adds:i?i.features:[],updates:s,deletes:n});return this.fullExtent=l,i&&i.finish(c.uidToObjectId),this._updateClientGraphicIds(a,c),this._createEditsResult(c)}async _prepareClientMapping(e,r){if(this._layerOrSourceGeometryType!=="mesh"||e==null)return;const i=[];for(const{geometry:n}of e)n==null||n.type!=="mesh"||n.hasExtent||n.loaded||i.push(n.load({signal:r}));i.length&&await Promise.all(i)}_updateClientGraphicIds(e,r){if(this._idToClientGraphic){if(e)for(const i of r.updateResults){if(!i.success)continue;const n=e.get(i.objectId);n!=null&&this._addIdToClientGraphic(n)}for(const i of r.deleteResults)i.success&&this._idToClientGraphic.delete(i.objectId)}}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new H("feature-layer-source:edit-failure",r.description,{code:r.code}):null}}_prepareAddFeatures(e){const r=new Map,i=new Array(e.length);let n=null;for(let o=0;o<e.length;o++){const a=e[o],l=this._serializeFeature(a);n||a.geometry==null||(n=a.geometry.type),i[o]=l,r.set(`${l.uid}`,a)}const s=this;return{features:i,inferredGeometryType:n,finish(o){const a=s.sourceJSON.objectIdField;for(const l in o){const c=o[l],u=r.get(l);u&&(u.attributes||(u.attributes={}),c===-1?delete u.attributes[a]:u.attributes[a]=c,s._addIdToClientGraphic(u))}}}}_addIdToClientGraphic(e){if(!this._idToClientGraphic)return;const r=this.sourceJSON.objectIdField,i=e.attributes&&e.attributes[r];i!=null&&this._idToClientGraphic.set(i,e)}get _layerOrSourceGeometryType(){var e,r;return((e=this.layer)==null?void 0:e.geometryType)??((r=this.sourceJSON)==null?void 0:r.geometryType)}_requiresClientGraphicMapping(){return this._geometryTypeRequiresClientGraphicMapping(this._layerOrSourceGeometryType)}_geometryRequiresClientGraphicMapping(e){return this._geometryTypeRequiresClientGraphicMapping(e.type)}_geometryTypeRequiresClientGraphicMapping(e){return e==="mesh"||e==="multipatch"||e==="extent"}_serializeFeature(e){const{attributes:r}=e,i=this._geometryForSerialization(e),n=(JKt++).toString();return i?{uid:n,geometry:i.toJSON(),attributes:r}:{uid:n,attributes:r}}_geometryForSerialization(e){const{geometry:r}=e;return r==null?null:this._geometryRequiresClientGraphicMapping(r)?r.extent?Tc.fromExtent(r.extent):null:r}async _startWorker(e){this._connection=await Ode("MemorySourceWorker",{strategy:he("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:r,spatialReference:i,objectIdField:n,hasM:s,hasZ:o,timeInfo:a}=this.layer,l=this.layer.originOf("spatialReference")==="defaults";await this._prepareClientMapping(this.items,e);const c=this._prepareAddFeatures(this.items);this.handles.add(this.on("before-changes",m=>{TJ.error("Source modifications will not propagate after layer has been loaded. Please use .applyEdits() instead"),m.preventDefault()}));const u={features:c.features,fields:r&&r.map(m=>m.toJSON()),geometryType:bve.toJSON(this._workerGeometryType),hasM:this._layerOrSourceGeometryType!=="mesh"&&s,hasZ:this._layerOrSourceGeometryType==="mesh"||o,objectIdField:n,spatialReference:l?null:i&&i.toJSON(),timeInfo:a?a.toJSON():null},h=await this._connection.invoke("load",u,{signal:e});for(const m of h.warnings)TJ.warn(m.message,{layer:this.layer,warning:m});h.featureErrors.length&&TJ.warn(`Encountered ${h.featureErrors.length} validation errors while loading features`,h.featureErrors);const f=h.layerDefinition;this._geometryTypeRequiresClientGraphicMapping(c.inferredGeometryType)&&(f.geometryType=bve.toJSON(c.inferredGeometryType)),this.sourceJSON=f,this._requiresClientGraphicMapping()&&(this._idToClientGraphic=new Map),c.finish(h.assignedObjectIds)}};d([fce({Type:cf,ensureType:ls(cf)})],Mv.prototype,"itemType",void 0),d([p()],Mv.prototype,"type",void 0),d([p({constructOnly:!0})],Mv.prototype,"layer",void 0),d([p({readOnly:!0})],Mv.prototype,"_workerGeometryType",null),d([p()],Mv.prototype,"sourceJSON",void 0),Mv=d([I(Sqe)],Mv);const YRe={read:{reader:Ope},write:{allowNull:!0,writer:Ape}},Dfe=t=>{let e=class extends t{constructor(){super(...arguments),this.blendMode="normal",this.effect=null}};return d([p({type:["average","color-burn","color-dodge","color","darken","destination-atop","destination-in","destination-out","destination-over","difference","exclusion","hard-light","hue","invert","lighten","lighter","luminosity","minus","multiply","normal","overlay","plus","reflect","saturation","screen","soft-light","source-atop","source-in","source-out","vivid-light","xor"],nonNullable:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!0},"portal-item":{read:!0,write:!0}}}})],e.prototype,"blendMode",void 0),d([p({json:{read:!1,write:!1,origins:{"web-map":YRe,"portal-item":YRe}}})],e.prototype,"effect",void 0),e=d([I("esri.layers.mixins.BlendLayer")],e),e},Tqe=t=>{let e=class extends t{constructor(){super(...arguments),this.customParameters=null}};return d([p({type:Object,json:{write:{overridePolicy:r=>({enabled:!!(r&&Object.keys(r).length>0)})}}})],e.prototype,"customParameters",void 0),e=d([I("esri.layers.mixins.CustomParametersMixin")],e),e};var ooe;let gO=ooe=class extends me{constructor(t){super(t),this.type="map-layer"}clone(){const{mapLayerId:t,gdbVersion:e}=this;return new ooe({mapLayerId:t,gdbVersion:e})}};d([Rt({mapLayer:"map-layer"})],gO.prototype,"type",void 0),d([p({type:hn,json:{write:!0}})],gO.prototype,"mapLayerId",void 0),d([p({type:String,json:{write:!0}})],gO.prototype,"gdbVersion",void 0),gO=ooe=d([I("esri.layers.support.source.MapLayerSource")],gO);var aoe;let wv=aoe=class extends me{constructor(t){super(t),this.type="query-table"}clone(){const{workspaceId:t,query:e,oidFields:r,spatialReference:i,geometryType:n}=this,s={workspaceId:t,query:e,oidFields:r,spatialReference:(i==null?void 0:i.clone())??void 0,geometryType:n};return new aoe(s)}};d([Rt({queryTable:"query-table"})],wv.prototype,"type",void 0),d([p({type:String,json:{write:!0}})],wv.prototype,"workspaceId",void 0),d([p({type:String,json:{write:!0}})],wv.prototype,"query",void 0),d([p({type:String,json:{write:!0}})],wv.prototype,"oidFields",void 0),d([p({type:dt,json:{write:!0}})],wv.prototype,"spatialReference",void 0),d([Rt(O7)],wv.prototype,"geometryType",void 0),wv=aoe=d([I("esri.layers.support.source.QueryTableDataSource")],wv);var loe;let yO=loe=class extends me{constructor(t){super(t),this.type="raster"}clone(){const{workspaceId:t,dataSourceName:e}=this;return new loe({workspaceId:t,dataSourceName:e})}};d([Rt({raster:"raster"})],yO.prototype,"type",void 0),d([p({type:String,json:{write:!0}})],yO.prototype,"dataSourceName",void 0),d([p({type:String,json:{write:!0}})],yO.prototype,"workspaceId",void 0),yO=loe=d([I("esri.layers.support.source.RasterDataSource")],yO);var coe;let ST=coe=class extends me{constructor(t){super(t),this.type="table"}clone(){const{workspaceId:t,gdbVersion:e,dataSourceName:r}=this;return new coe({workspaceId:t,gdbVersion:e,dataSourceName:r})}};d([Rt({table:"table"})],ST.prototype,"type",void 0),d([p({type:String,json:{write:!0}})],ST.prototype,"workspaceId",void 0),d([p({type:String,json:{write:!0}})],ST.prototype,"gdbVersion",void 0),d([p({type:String,json:{write:!0}})],ST.prototype,"dataSourceName",void 0),ST=coe=d([I("esri.layers.support.source.TableDataSource")],ST);var uoe,doe;const KKt=Ac()({esriLeftInnerJoin:"left-inner-join",esriLeftOuterJoin:"left-outer-join"});let Hd=uoe=class extends me{constructor(t){super(t),this.type="join-table"}readLeftTableSource(t,e,r){return ZRe()(t,e,r)}castLeftTableSource(t){return ng(hoe(),t)}readRightTableSource(t,e,r){return ZRe()(t,e,r)}castRightTableSource(t){return ng(hoe(),t)}clone(){const{leftTableKey:t,rightTableKey:e,leftTableSource:r,rightTableSource:i,joinType:n}=this,s={leftTableKey:t,rightTableKey:e,leftTableSource:(r==null?void 0:r.clone())??void 0,rightTableSource:(i==null?void 0:i.clone())??void 0,joinType:n};return new uoe(s)}};d([Rt({joinTable:"join-table"})],Hd.prototype,"type",void 0),d([p({type:String,json:{write:!0}})],Hd.prototype,"leftTableKey",void 0),d([p({type:String,json:{write:!0}})],Hd.prototype,"rightTableKey",void 0),d([p({json:{write:!0}})],Hd.prototype,"leftTableSource",void 0),d([ke("leftTableSource")],Hd.prototype,"readLeftTableSource",null),d([ur("leftTableSource")],Hd.prototype,"castLeftTableSource",null),d([p({json:{write:!0}})],Hd.prototype,"rightTableSource",void 0),d([ke("rightTableSource")],Hd.prototype,"readRightTableSource",null),d([ur("rightTableSource")],Hd.prototype,"castRightTableSource",null),d([Rt(KKt)],Hd.prototype,"joinType",void 0),Hd=uoe=d([I("esri.layers.support.source.JoinTableDataSource")],Hd);let EJ=null;function ZRe(){return EJ||(EJ=E3({types:hoe()})),EJ}let CJ=null;function hoe(){return CJ||(CJ={key:"type",base:null,typeMap:{"data-layer":Sm,"map-layer":gO}}),CJ}const QKt={key:"type",base:null,typeMap:{"join-table":Hd,"query-table":wv,raster:yO,table:ST}};let Sm=doe=class extends me{constructor(t){super(t),this.type="data-layer"}clone(){const{fields:t,dataSource:e}=this;return new doe({fields:t,dataSource:e})}};d([Rt({dataLayer:"data-layer"})],Sm.prototype,"type",void 0),d([p({type:[IF],json:{write:!0}})],Sm.prototype,"fields",void 0),d([p({types:QKt,json:{write:!0}})],Sm.prototype,"dataSource",void 0),Sm=doe=d([I("esri.layers.support.source.DataLayerSource")],Sm),Sm.from=ls(Sm);let TT=class extends Rn(me){constructor(e){super(e),this.onFields=null,this.operator=null,this.searchTerm=null,this.searchType=null}};d([p({type:[String],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.onFields!=null&&this.onFields.length>0}}}}})],TT.prototype,"onFields",void 0),d([p({type:String,json:{write:!0}})],TT.prototype,"operator",void 0),d([p({type:String,json:{write:!0}})],TT.prototype,"searchTerm",void 0),d([p({type:String,json:{write:!0}})],TT.prototype,"searchType",void 0),TT=d([I("esri.rest.support.FullTextSearch")],TT);const eQt=TT;var poe;const JRe=new ri({upperLeft:"upper-left",lowerLeft:"lower-left"});let ET=poe=class extends me{constructor(t){super(t),this.extent=null,this.mode="view",this.originPosition="upper-left",this.tolerance=1}clone(){return new poe(ie({extent:this.extent,mode:this.mode,originPosition:this.originPosition,tolerance:this.tolerance}))}};d([p({type:$r,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],ET.prototype,"extent",void 0),d([p({type:["view","edit"],json:{write:!0}})],ET.prototype,"mode",void 0),d([p({type:String,json:{read:JRe.read,write:JRe.write}})],ET.prototype,"originPosition",void 0),d([p({type:Number,json:{write:{overridePolicy(){return{enabled:this.mode==="view"}}}}})],ET.prototype,"tolerance",void 0),ET=poe=d([I("esri.rest.support.QuantizationParameters")],ET);const tQt=ET;var foe;const KRe=new ri({count:"count",sum:"sum",min:"min",max:"max",avg:"avg",stddev:"stddev",var:"var",exceedslimit:"exceedslimit",percentile_cont:"percentile-continuous",percentile_disc:"percentile-discrete",EnvelopeAggregate:"envelope-aggregate",CentroidAggregate:"centroid-aggregate",ConvexHullAggregate:"convex-hull-aggregate"});let um=foe=class extends me{constructor(t){super(t),this.maxPointCount=void 0,this.maxRecordCount=void 0,this.maxVertexCount=void 0,this.onStatisticField=null,this.outStatisticFieldName=null,this.statisticType=null,this.statisticParameters=null}writeStatisticParameters(t,e){this.statisticType!=="percentile-continuous"&&this.statisticType!=="percentile-discrete"||(e.statisticParameters=ie(t))}clone(){return new foe({maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,statisticType:this.statisticType,statisticParameters:ie(this.statisticParameters)})}};d([p({type:Number,json:{write:!0}})],um.prototype,"maxPointCount",void 0),d([p({type:Number,json:{write:!0}})],um.prototype,"maxRecordCount",void 0),d([p({type:Number,json:{write:!0}})],um.prototype,"maxVertexCount",void 0),d([p({type:String,json:{write:!0}})],um.prototype,"onStatisticField",void 0),d([p({type:String,json:{write:!0}})],um.prototype,"outStatisticFieldName",void 0),d([p({type:String,json:{read:{source:"statisticType",reader:KRe.read},write:{target:"statisticType",writer:KRe.write}}})],um.prototype,"statisticType",void 0),d([p({type:Object})],um.prototype,"statisticParameters",void 0),d([tt("statisticParameters")],um.prototype,"writeStatisticParameters",null),um=foe=d([I("esri.rest.support.StatisticDefinition")],um);const rQt=um;var qA;const iQt=new ri({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),nQt=new ri({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let tr=qA=class extends me{static from(t){return X2(qA,t)}constructor(t){super(t),this.aggregateIds=null,this.cacheHint=void 0,this.compactGeometryEnabled=!1,this.datumTransformation=null,this.defaultSpatialReferenceEnabled=!1,this.distance=void 0,this.dynamicDataSource=void 0,this.formatOf3DObjects=null,this.fullText=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=void 0,this.groupByFieldsForStatistics=null,this.having=null,this.historicMoment=null,this.maxAllowableOffset=void 0,this.maxRecordCountFactor=1,this.multipatchOption=null,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.outStatistics=null,this.parameterValues=null,this.pixelSize=null,this.quantizationParameters=null,this.rangeValues=null,this.relationParameter=null,this.resultType=null,this.returnCentroid=!1,this.returnDistinctValues=!1,this.returnExceededLimitFeatures=!0,this.returnGeometry=!1,this.returnQueryGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.sourceSpatialReference=null,this.spatialRelationship="intersects",this.start=void 0,this.sqlFormat=null,this.text=null,this.timeExtent=null,this.timeReferenceUnknownClient=!1,this.units=null,this.where=null}castDatumTransformation(t){return typeof t=="number"||typeof t=="object"?t:null}writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeParameterValues(t,e){if(t){const r={};for(const i in t){const n=t[i];Array.isArray(n)?r[i]=n.map(s=>s instanceof Date?s.getTime():s):n instanceof Date?r[i]=n.getTime():r[i]=n}e.parameterValues=r}}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,e.where="1=1"}writeWhere(t,e){e.where=t||"1=1"}clone(){return new qA(ie({aggregateIds:this.aggregateIds,cacheHint:this.cacheHint,compactGeometryEnabled:this.compactGeometryEnabled,datumTransformation:this.datumTransformation,defaultSpatialReferenceEnabled:this.defaultSpatialReferenceEnabled,distance:this.distance,fullText:this.fullText,formatOf3DObjects:this.formatOf3DObjects,gdbVersion:this.gdbVersion,geometry:this.geometry,geometryPrecision:this.geometryPrecision,groupByFieldsForStatistics:this.groupByFieldsForStatistics,having:this.having,historicMoment:this.historicMoment!=null?new Date(this.historicMoment.getTime()):null,maxAllowableOffset:this.maxAllowableOffset,maxRecordCountFactor:this.maxRecordCountFactor,multipatchOption:this.multipatchOption,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,outStatistics:this.outStatistics,parameterValues:this.parameterValues,pixelSize:this.pixelSize,quantizationParameters:this.quantizationParameters,rangeValues:this.rangeValues,relationParameter:this.relationParameter,resultType:this.resultType,returnDistinctValues:this.returnDistinctValues,returnGeometry:this.returnGeometry,returnCentroid:this.returnCentroid,returnExceededLimitFeatures:this.returnExceededLimitFeatures,returnQueryGeometry:this.returnQueryGeometry,returnM:this.returnM,returnZ:this.returnZ,dynamicDataSource:this.dynamicDataSource,sourceSpatialReference:this.sourceSpatialReference,spatialRelationship:this.spatialRelationship,start:this.start,sqlFormat:this.sqlFormat,text:this.text,timeExtent:this.timeExtent,timeReferenceUnknownClient:this.timeReferenceUnknownClient,units:this.units,where:this.where}))}};tr.MAX_MAX_RECORD_COUNT_FACTOR=5,d([p({json:{write:!0}})],tr.prototype,"aggregateIds",void 0),d([p({type:Boolean,json:{write:!0}})],tr.prototype,"cacheHint",void 0),d([p({type:Boolean,json:{default:!1,write:!0}})],tr.prototype,"compactGeometryEnabled",void 0),d([p({json:{write:!0}})],tr.prototype,"datumTransformation",void 0),d([ur("datumTransformation")],tr.prototype,"castDatumTransformation",null),d([p({type:Boolean,json:{default:!1,write:!0}})],tr.prototype,"defaultSpatialReferenceEnabled",void 0),d([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],tr.prototype,"distance",void 0),d([p({type:Sm,json:{write:!0}})],tr.prototype,"dynamicDataSource",void 0),d([p({type:String,json:{write:!0}})],tr.prototype,"formatOf3DObjects",void 0),d([p({type:[eQt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.fullText!=null&&this.fullText.length>0}}}}})],tr.prototype,"fullText",void 0),d([p({type:String,json:{write:!0}})],tr.prototype,"gdbVersion",void 0),d([p({types:ME,json:{read:P_,write:!0}})],tr.prototype,"geometry",void 0),d([p({type:Number,json:{write:!0}})],tr.prototype,"geometryPrecision",void 0),d([p({type:[String],json:{write:!0}})],tr.prototype,"groupByFieldsForStatistics",void 0),d([p({type:String,json:{write:!0}})],tr.prototype,"having",void 0),d([p({type:Date})],tr.prototype,"historicMoment",void 0),d([tt("historicMoment")],tr.prototype,"writeHistoricMoment",null),d([p({type:Number,json:{write:!0}})],tr.prototype,"maxAllowableOffset",void 0),d([p({type:Number,cast:t=>t<1?1:t>qA.MAX_MAX_RECORD_COUNT_FACTOR?qA.MAX_MAX_RECORD_COUNT_FACTOR:t,json:{write:{overridePolicy:t=>({enabled:t>1})}}})],tr.prototype,"maxRecordCountFactor",void 0),d([p({type:["xyFootprint"],json:{write:!0}})],tr.prototype,"multipatchOption",void 0),d([p({type:Number,json:{read:{source:"resultRecordCount"}}})],tr.prototype,"num",void 0),d([p({json:{write:!0}})],tr.prototype,"objectIds",void 0),d([p({type:[String],json:{write:!0}})],tr.prototype,"orderByFields",void 0),d([p({type:[String],json:{write:!0}})],tr.prototype,"outFields",void 0),d([p({type:dt,json:{name:"outSR",write:!0}})],tr.prototype,"outSpatialReference",void 0),d([p({type:[rQt],json:{write:{enabled:!0,overridePolicy(){return{enabled:this.outStatistics!=null&&this.outStatistics.length>0}}}}})],tr.prototype,"outStatistics",void 0),d([p({json:{write:!0}})],tr.prototype,"parameterValues",void 0),d([tt("parameterValues")],tr.prototype,"writeParameterValues",null),d([p({type:Gt,json:{write:!0}})],tr.prototype,"pixelSize",void 0),d([p({type:tQt,json:{write:!0}})],tr.prototype,"quantizationParameters",void 0),d([p({type:[Object],json:{write:!0}})],tr.prototype,"rangeValues",void 0),d([p({type:String,json:{read:{source:"relationParam"},write:{target:"relationParam",overridePolicy(){return{enabled:this.spatialRelationship==="relation"}}}}})],tr.prototype,"relationParameter",void 0),d([p({type:String,json:{write:!0}})],tr.prototype,"resultType",void 0),d([p({type:Boolean,json:{default:!1,write:!0}})],tr.prototype,"returnCentroid",void 0),d([p({type:Boolean,json:{default:!1,write:!0}})],tr.prototype,"returnDistinctValues",void 0),d([p({type:Boolean,json:{default:!0,write:!0}})],tr.prototype,"returnExceededLimitFeatures",void 0),d([p({type:Boolean,json:{write:!0}})],tr.prototype,"returnGeometry",void 0),d([p({type:Boolean,json:{default:!1,write:!0}})],tr.prototype,"returnQueryGeometry",void 0),d([p({type:Boolean,json:{default:!1,write:!0}})],tr.prototype,"returnM",void 0),d([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],tr.prototype,"returnZ",void 0),d([p({type:dt,json:{write:!0}})],tr.prototype,"sourceSpatialReference",void 0),d([Rt(iQt,{ignoreUnknown:!1,name:"spatialRel"})],tr.prototype,"spatialRelationship",void 0),d([p({type:Number,json:{read:{source:"resultOffset"}}})],tr.prototype,"start",void 0),d([tt("start"),tt("num")],tr.prototype,"writeStart",null),d([p({type:String,json:{write:!0}})],tr.prototype,"sqlFormat",void 0),d([p({type:String,json:{write:!0}})],tr.prototype,"text",void 0),d([p({type:T0,json:{write:!0}})],tr.prototype,"timeExtent",void 0),d([p({type:Boolean,json:{default:!1,write:!0}})],tr.prototype,"timeReferenceUnknownClient",void 0),d([Rt(nQt,{ignoreUnknown:!1}),p({json:{write:{overridePolicy(t){return{enabled:!!t&&this.distance!=null&&this.distance>0}}}}})],tr.prototype,"units",void 0),d([p({type:String,json:{write:{overridePolicy(t){return{enabled:t!=null||this.start!=null&&this.start>0}}}}})],tr.prototype,"where",void 0),d([tt("where")],tr.prototype,"writeWhere",null),tr=qA=d([I("esri.rest.support.Query")],tr);const uh=tr;var moe;const RJ=new ri({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),OJ=new ri({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let py=moe=class extends me{constructor(t){super(t),this.where=null,this.geometry=null,this.spatialRelationship="intersects",this.distance=void 0,this.objectIds=null,this.units=null,this.timeExtent=null}createQuery(t={}){const{where:e,geometry:r,spatialRelationship:i,timeExtent:n,objectIds:s,units:o,distance:a}=this;return new uh({geometry:ie(r),objectIds:ie(s),spatialRelationship:i,timeExtent:ie(n),where:e,units:o,distance:a,...t})}clone(){const{where:t,geometry:e,spatialRelationship:r,timeExtent:i,objectIds:n,units:s,distance:o}=this;return new moe({geometry:ie(e),objectIds:ie(n),spatialRelationship:r,timeExtent:ie(i),where:t,units:s,distance:o})}};d([p({type:String,json:{write:!0}})],py.prototype,"where",void 0),d([p({types:ME,json:{write:!0}})],py.prototype,"geometry",void 0),d([p({type:RJ.apiValues,json:{name:"spatialRel",read:{reader:RJ.read},write:{allowNull:!1,writer:RJ.write,overridePolicy(){return{enabled:this.geometry!=null}}}}})],py.prototype,"spatialRelationship",void 0),d([p({type:Number,json:{write:{overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],py.prototype,"distance",void 0),d([p({type:[Number],json:{write:!0}})],py.prototype,"objectIds",void 0),d([p({type:OJ.apiValues,json:{read:OJ.read,write:{writer:OJ.write,overridePolicy(t){return{enabled:t!=null&&this.geometry!=null}}}}})],py.prototype,"units",void 0),d([p({type:T0,json:{write:!0}})],py.prototype,"timeExtent",void 0),py=moe=d([I("esri.layers.support.FeatureFilter")],py);const sQt=py;var goe;const QRe={read:{reader:Ope},write:{writer:Ape,overridePolicy(){return{allowNull:this.excludedEffect!=null,isRequired:this.excludedEffect==null}}}},eOe={read:{reader:Ope},write:{writer:Ape,overridePolicy(){return{allowNull:this.includedEffect!=null,isRequired:this.includedEffect==null}}}},tOe={name:"showExcludedLabels",default:!0};let CT=goe=class extends me{constructor(t){super(t),this.filter=null,this.includedEffect=null,this.excludedEffect=null,this.excludedLabelsVisible=!1}write(t,e){var i,n;const r=super.write(t,e);if(e!=null&&e.origin){if(r.filter){const s=Object.keys(r.filter);if(s.length>1||s[0]!=="where")return(i=e.messages)==null||i.push(new H("web-document-write:unsupported-feature-effect","Invalid feature effect 'filter'. A filter can only contain a 'where' property",{layer:e.layer,effect:this})),null}if("showExcludedLabels"in r)return(n=e.messages)==null||n.push(new H("web-document-write:unsupported-feature-effect","Invalid value for property 'excludedLabelsVisible' which should always be 'true'",{layer:e.layer,effect:this})),null}return r}clone(){return new goe({filter:this.filter!=null?this.filter.clone():null,includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})}};d([p({type:sQt,json:{write:{allowNull:!0,writer(t,e,r,i){const n=t==null?void 0:t.write({},i);n&&Object.keys(n).length!==0?Rc(r,n,e):Rc(r,null,e)}}}})],CT.prototype,"filter",void 0),d([p({json:{write:!0,origins:{"web-map":QRe,"portal-item":QRe}}})],CT.prototype,"includedEffect",void 0),d([p({json:{write:!0,origins:{"web-map":eOe,"portal-item":eOe}}})],CT.prototype,"excludedEffect",void 0),d([p({type:Boolean,json:{write:!0,name:"showExcludedLabels",origins:{"web-map":tOe,"portal-item":tOe}}})],CT.prototype,"excludedLabelsVisible",void 0),CT=goe=d([I("esri.layers.support.FeatureEffect")],CT);const oQt=CT,rOe={write:{allowNull:!0}},Eqe=t=>{let e=class extends t{constructor(){super(...arguments),this.featureEffect=null}};return d([p({type:oQt,json:{origins:{"web-map":rOe,"portal-item":rOe}}})],e.prototype,"featureEffect",void 0),e=d([I("esri.layers.mixins.FeatureEffectLayer")],e),e};let xv=class extends Rn(me){constructor(e){super(e),this.creatorField=null,this.creationDateField=null,this.editorField=null,this.editDateField=null,this.realm=null,this.dateFieldsTimeReference=null}};d([p()],xv.prototype,"creatorField",void 0),d([p()],xv.prototype,"creationDateField",void 0),d([p()],xv.prototype,"editorField",void 0),d([p()],xv.prototype,"editDateField",void 0),d([p()],xv.prototype,"realm",void 0),d([p({type:zP})],xv.prototype,"dateFieldsTimeReference",void 0),xv=d([I("esri.layers.support.EditFieldsInfo")],xv);const aQt=xv;let _y=class extends Rn(me){constructor(e){super(e)}};d([p({constructOnly:!0,json:{write:!0}})],_y.prototype,"name",void 0),d([p({constructOnly:!0,json:{write:!0}})],_y.prototype,"fields",void 0),d([p({constructOnly:!0,json:{write:!0}})],_y.prototype,"isAscending",void 0),d([p({constructOnly:!0,json:{write:!0}})],_y.prototype,"indexType",void 0),d([p({constructOnly:!0,json:{write:!0}})],_y.prototype,"isUnique",void 0),d([p({constructOnly:!0,json:{write:!0}})],_y.prototype,"description",void 0),_y=d([I("esri.layers.support.FeatureIndex")],_y);var yoe;let Ya=yoe=class extends me{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new yoe(ie({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};d([p({type:[String],json:{write:!0}})],Ya.prototype,"attachmentTypes",void 0),d([p({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],Ya.prototype,"attachmentsWhere",void 0),d([p({type:Boolean,json:{write:!0}})],Ya.prototype,"cacheHint",void 0),d([p({type:[String],json:{write:!0}})],Ya.prototype,"keywords",void 0),d([p({type:[Number],json:{write:!0}})],Ya.prototype,"globalIds",void 0),d([p({json:{write:!0}})],Ya.prototype,"name",void 0),d([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Ya.prototype,"num",void 0),d([p({type:[Number],json:{write:!0}})],Ya.prototype,"objectIds",void 0),d([p({type:Boolean,json:{default:!1,write:!0}})],Ya.prototype,"returnMetadata",void 0),d([p({type:[Number],json:{write:!0}})],Ya.prototype,"size",void 0),d([p({type:Number,json:{read:{source:"resultOffset"}}})],Ya.prototype,"start",void 0),d([tt("start"),tt("num")],Ya.prototype,"writeStart",null),d([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ya.prototype,"where",void 0),Ya=yoe=d([I("esri.rest.support.AttachmentQuery")],Ya),Ya.from=ls(Ya);const lQt=Ya;var voe;let Ms=voe=class extends me{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new voe(ie({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};d([p({type:Boolean,json:{write:!0}})],Ms.prototype,"cacheHint",void 0),d([p({type:Sm,json:{write:!0}})],Ms.prototype,"dynamicDataSource",void 0),d([p({type:String,json:{write:!0}})],Ms.prototype,"gdbVersion",void 0),d([p({type:Number,json:{write:!0}})],Ms.prototype,"geometryPrecision",void 0),d([p({type:Date})],Ms.prototype,"historicMoment",void 0),d([tt("historicMoment")],Ms.prototype,"_writeHistoricMoment",null),d([p({type:Number,json:{write:!0}})],Ms.prototype,"maxAllowableOffset",void 0),d([p({type:[Number],json:{write:!0}})],Ms.prototype,"objectIds",void 0),d([p({type:[String],json:{write:!0}})],Ms.prototype,"orderByFields",void 0),d([p({type:[String],json:{write:!0}})],Ms.prototype,"outFields",void 0),d([p({type:dt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Ms.prototype,"outSpatialReference",void 0),d([p({json:{write:!0}})],Ms.prototype,"relationshipId",void 0),d([p({type:Number,json:{read:{source:"resultOffset"}}})],Ms.prototype,"start",void 0),d([tt("start"),tt("num")],Ms.prototype,"writeStart",null),d([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Ms.prototype,"num",void 0),d([p({json:{write:!0}})],Ms.prototype,"returnGeometry",void 0),d([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ms.prototype,"returnM",void 0),d([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Ms.prototype,"returnZ",void 0),d([p({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],Ms.prototype,"where",void 0),Ms=voe=d([I("esri.rest.support.RelationshipQuery")],Ms),Ms.from=ls(Ms);const Nfe=Ms,wOr=Object.freeze(Object.defineProperty({__proto__:null,default:Nfe},Symbol.toStringTag,{value:"Module"})),_oe=new ri({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function cQt(t,e,r,i){const n=await $x(t);if(await Ffe(t,e,i),!n.addAttachment)throw new H(i,"Layer source does not support addAttachment capability");return n.addAttachment(e,r)}function Ffe(t,e,r){const{attributes:i}=e,{objectIdField:n}=t;return t.get("capabilities.data.supportsAttachment")?e?i?n&&i[n]?Promise.resolve():Promise.reject(new H(r,`feature is missing the identifying attribute ${n}`)):Promise.reject(new H(r,"'attributes' are required on a feature to query attachments")):Promise.reject(new H(r,"A feature is required to add/delete/update attachments")):Promise.reject(new H(r,"this layer doesn't support attachments"))}async function uQt(t,e,r,i,n){const s=await $x(t);if(await Ffe(t,e,n),!s.updateAttachment)throw new H(n,"Layer source does not support updateAttachment capability");return s.updateAttachment(e,r,i)}async function dQt(t,e,r){const{applyEdits:i}=await le(()=>import("./editingSupport-47fc3fce.js"),["assets/editingSupport-47fc3fce.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js"]),n=await t.load();return i(n,n.source,e,r)}async function hQt(t,e,r){const{uploadAssets:i}=await le(()=>import("./editingSupport-47fc3fce.js"),["assets/editingSupport-47fc3fce.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js"]),n=await t.load();return i(n,n.source,e,r)}async function pQt(t,e,r,i){const n=await $x(t);if(await Ffe(t,e,i),!n.deleteAttachments)throw new H(i,"Layer source does not support deleteAttachments capability");return n.deleteAttachments(e,r)}async function fQt(t,e,r){const i=(await t.load({signal:e==null?void 0:e.signal})).source;if(!i.fetchRecomputedExtents)throw new H(r,"Layer source does not support fetchUpdates capability");return i.fetchRecomputedExtents(e)}async function mQt(t,e,r,i){var m,g;e=lQt.from(e),await t.load();const n=t.source,s=t.capabilities;if(!((m=s==null?void 0:s.data)!=null&&m.supportsAttachment))throw new H(i,"this layer doesn't support attachments");const{attachmentTypes:o,objectIds:a,globalIds:l,num:c,size:u,start:h,where:f}=e;if(!((g=s==null?void 0:s.operations)!=null&&g.supportsQueryAttachments)&&((o==null?void 0:o.length)>0||(l==null?void 0:l.length)>0||(u==null?void 0:u.length)>0||c||h||f))throw new H(i,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(a!=null&&a.length||l!=null&&l.length||f))throw new H(i,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!n.queryAttachments)throw new H(i,"Layer source does not support queryAttachments capability",e);return n.queryAttachments(e)}async function gQt(t,e,r,i){const n=await $x(t);if(!n.queryObjectIds)throw new H(i,"Layer source does not support queryObjectIds capability");return n.queryObjectIds(uh.from(e)??t.createQuery(),r)}async function yQt(t,e,r,i){const n=await $x(t);if(!n.queryFeatureCount)throw new H(i,"Layer source does not support queryFeatureCount capability");return n.queryFeatureCount(uh.from(e)??t.createQuery(),r)}async function vQt(t,e,r,i){const n=await $x(t);if(!n.queryExtent)throw new H(i,"Layer source does not support queryExtent capability");return n.queryExtent(uh.from(e)??t.createQuery(),r)}async function _Qt(t,e,r,i){const n=await $x(t);if(!n.queryRelatedFeatures)throw new H(i,"Layer source does not support queryRelatedFeatures capability");return n.queryRelatedFeatures(Nfe.from(e),r)}async function bQt(t,e,r,i){const n=await $x(t);if(!n.queryRelatedFeaturesCount)throw new H(i,"Layer source does not support queryRelatedFeaturesCount capability");return n.queryRelatedFeaturesCount(Nfe.from(e),r)}async function wQt(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:r,updates:i}=await e.refresh();if(i!=null&&(t.sourceJSON={...t.sourceJSON,...i},t.read(i,{origin:"service",url:t.parsedUrl})),r)return!0}catch{}if(t.definitionExpression)try{return(await DKt(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function xQt(t){const e=new uh,r=t.get("capabilities.data"),i=t.get("capabilities.query");e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,i&&(e.compactGeometryEnabled=i.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=i.supportsDefaultSpatialReference),r&&(r.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),r.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:n,timeExtent:s}=t;return e.timeExtent=n!=null&&s!=null?s.offset(-n.value,n.unit):s||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function Cqe(t){const{globalIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeGlobalID")return i.name}}function Rqe(t){const{objectIdField:e,fields:r}=t;if(e)return e;if(r){for(const i of r)if(i.type==="esriFieldTypeOID")return i.name}}function SQt(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}async function $x(t){return(await t.load()).source}async function TQt(t,e){if(!Hr||Hr.findCredential(t))return;let r;try{const i=await KIe(t,e);i&&(r=await Hr.checkSignInStatus(`${i}/sharing`))}catch{}if(r)try{const i=e!=null?e.signal:null;await Hr.getCredential(t,{signal:i})}catch{}}async function EQt(t,e){var i;const r=(i=t.parsedUrl)==null?void 0:i.path;r&&CQt(t)&&await TQt(r,e)}function CQt(t){const e=t.editFieldsInfo;return!(!(e!=null&&e.creatorField)&&!(e!=null&&e.editorField))||(t.userHasUpdateItemPrivileges?t.hasUpdateItemRestrictions:!!t.userHasFullEditingPrivileges&&t.hasFullEditingRestrictions)}function RQt(t){var e;return!((e=t.sourceJSON)!=null&&e.isMultiServicesView)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const AJ=E3({types:mFe});function kfe(t,e){if(t.defaultSymbol)return t.types&&t.types.length?new Pfe({defaultSymbol:AJ(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:AJ(r.symbol,r,e)}))}):new ZF({symbol:AJ(t.defaultSymbol,t,e)})}let vO=class extends Rn(me){constructor(e){super(e),this.shapeAreaField=null,this.shapeLengthField=null,this.units=null}};d([p({type:String,json:{read:{source:"shapeAreaFieldName"}}})],vO.prototype,"shapeAreaField",void 0),d([p({type:String,json:{read:{source:"shapeLengthFieldName"}}})],vO.prototype,"shapeLengthField",void 0),d([p({type:String,json:{read:t=>ipt.read(t)||npt.read(t)}})],vO.prototype,"units",void 0),vO=d([I("esri.layers.support.GeometryFieldsInfo")],vO);const OQt=vO;var boe;let _O=boe=class extends me{constructor(t){super(t),this.floorField=null,this.viewAllMode=!1,this.viewAllLevelIds=new vt}clone(){return new boe({floorField:this.floorField,viewAllMode:this.viewAllMode,viewAllLevelIds:this.viewAllLevelIds})}};d([p({type:String,json:{write:!0}})],_O.prototype,"floorField",void 0),d([p({json:{read:!1,write:!1}})],_O.prototype,"viewAllMode",void 0),d([p({json:{read:!1,write:!1}})],_O.prototype,"viewAllLevelIds",void 0),_O=boe=d([I("esri.layers.support.LayerFloorInfo")],_O);const Oqe=_O,iOe=new ri({esriRelCardinalityOneToOne:"one-to-one",esriRelCardinalityOneToMany:"one-to-many",esriRelCardinalityManyToMany:"many-to-many"}),nOe=new ri({esriRelRoleOrigin:"origin",esriRelRoleDestination:"destination"});let dp=class extends Rn(me){constructor(e){super(e),this.cardinality=null,this.composite=null,this.id=null,this.keyField=null,this.keyFieldInRelationshipTable=null,this.name=null,this.relatedTableId=null,this.relationshipTableId=null,this.role=null}};d([p({json:{read:iOe.read,write:iOe.write}})],dp.prototype,"cardinality",void 0),d([p({json:{read:!0,write:!0}})],dp.prototype,"composite",void 0),d([p({json:{read:!0,write:!0}})],dp.prototype,"id",void 0),d([p({json:{read:!0,write:!0}})],dp.prototype,"keyField",void 0),d([p({json:{read:!0,write:!0}})],dp.prototype,"keyFieldInRelationshipTable",void 0),d([p({json:{read:!0,write:!0}})],dp.prototype,"name",void 0),d([p({json:{read:!0,write:!0}})],dp.prototype,"relatedTableId",void 0),d([p({json:{read:!0,write:!0}})],dp.prototype,"relationshipTableId",void 0),d([p({json:{read:nOe.read,write:nOe.write}})],dp.prototype,"role",void 0),dp=d([I("esri.layers.support.Relationship")],dp);const AQt=dp,PQt={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function or(t,e,r){return!!Aqe(t,e,r)}function $U(t,e,r){return Aqe(t,e,r)}function Aqe(t,e,r){return t&&t.hasOwnProperty(e)?t[e]:r}function MQt(t){var r;const e=(r=t==null?void 0:t.supportedSpatialAggregationStatistics)==null?void 0:r.map(i=>i.toLowerCase());return{envelope:!!(e!=null&&e.includes("envelopeaggregate")),centroid:!!(e!=null&&e.includes("centroidaggregate")),convexHull:!!(e!=null&&e.includes("convexhullaggregate"))}}function KF(t,e){var i;const r=(i=t==null?void 0:t.supportedOperationsWithCacheHint)==null?void 0:i.map(n=>n.toLowerCase());return!!(r!=null&&r.includes(e.toLowerCase()))}function Pqe(t,e){return{analytics:$Qt(t),attachment:IQt(t),data:LQt(t),metadata:DQt(t),operations:NQt(t.capabilities,t,e),query:FQt(t,e),queryRelated:kQt(t),queryTopFeatures:UQt(t),editing:zQt(t)}}function $Qt(t){return{supportsCacheHint:KF(t.advancedQueryCapabilities,"queryAnalytics")}}function IQt(t){const e=t.attachmentProperties,r={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:KF(t.advancedQueryCapabilities,"queryAttachments"),supportsResize:or(t,"supportsAttachmentsResizing",!1)};return e&&Array.isArray(e)&&e.forEach(i=>{const n=PQt[i.name];n&&(r[n]=!!i.isEnabled)}),r}function LQt(t){return{isVersioned:or(t,"isDataVersioned",!1),supportsAttachment:or(t,"hasAttachments",!1),supportsM:or(t,"hasM",!1),supportsZ:or(t,"hasZ",!1)}}function DQt(t){return{supportsAdvancedFieldProperties:or(t,"supportsFieldDescriptionProperty",!1)}}function NQt(t,e,r){const i=t?t.toLowerCase().split(",").map(f=>f.trim()):[],n=r?$E(r):null,s=i.includes(n!=null&&n.serverType==="MapServer"?"data":"query"),o=i.includes("editing")&&!e.datesInUnknownTimezone;let a=o&&i.includes("create"),l=o&&i.includes("delete"),c=o&&i.includes("update");const u=i.includes("changetracking"),h=e.advancedQueryCapabilities;return o&&!(a||l||c)&&(a=l=c=!0),{supportsCalculate:or(e,"supportsCalculate",!1),supportsTruncate:or(e,"supportsTruncate",!1),supportsValidateSql:or(e,"supportsValidateSql",!1),supportsAdd:a,supportsDelete:l,supportsEditing:o,supportsChangeTracking:u,supportsQuery:s,supportsQueryAnalytics:or(h,"supportsQueryAnalytic",!1),supportsQueryAttachments:or(h,"supportsQueryAttachments",!1),supportsQueryTopFeatures:or(h,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:or(e,"supportsAttachmentsResizing",!1),supportsSync:i.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:or(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:or(e,"supportsAsyncConvert3D",!1)}}function FQt(t,e){const r=t.advancedQueryCapabilities,i=t.ownershipBasedAccessControlForFeatures,n=t.archivingInfo,s=t.currentVersion,o=e==null?void 0:e.includes("MapServer"),a=!o||s>=he("mapserver-pbf-version-support"),l=pue(e),c=new Set((t.supportedQueryFormats??"").split(",").map(u=>u.toLowerCase().trim()));return{supportsStatistics:or(r,"supportsStatistics",t.supportsStatistics),supportsPercentileStatistics:or(r,"supportsPercentileStatistics",!1),supportsSpatialAggregationStatistics:or(r,"supportsSpatialAggregationStatistics",!1),supportedSpatialAggregationStatistics:MQt(r),supportsCentroid:or(r,"supportsReturningGeometryCentroid",!1),supportsDistance:or(r,"supportsQueryWithDistance",!1),supportsDistinct:or(r,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:or(r,"supportsReturningQueryExtent",!1),supportsGeometryProperties:or(r,"supportsReturningGeometryProperties",!1),supportsHavingClause:or(r,"supportsHavingClause",!1),supportsOrderBy:or(r,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:or(r,"supportsPagination",!1),supportsQuantization:or(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:or(t,"supportsQuantizationEditMode",!1),supportsQueryGeometry:or(t,"supportsReturningQueryGeometry",!1),supportsResultType:or(r,"supportsQueryWithResultType",!1),supportsMaxRecordCountFactor:or(r,"supportsMaxRecordCountFactor",!1),supportsSqlExpression:or(r,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:or(t,"useStandardizedQueries",!1),supportsTopFeaturesQuery:or(r,"supportsTopFeaturesQuery",!1),supportsQueryByOthers:or(i,"allowOthersToQuery",!0),supportsHistoricMoment:or(n,"supportsQueryWithHistoricMoment",!1),supportsFormatPBF:a&&c.has("pbf"),supportsDisjointSpatialRelationship:or(r,"supportsDisjointSpatialRel",!1),supportsCacheHint:or(r,"supportsQueryWithCacheHint",!1)||KF(r,"query"),supportsDefaultSpatialReference:or(r,"supportsDefaultSR",!1),supportsCompactGeometry:l,supportsFullTextSearch:or(r,"supportsFullTextSearch",!1),maxRecordCountFactor:$U(t,"maxRecordCountFactor",void 0),maxRecordCount:$U(t,"maxRecordCount",void 0),standardMaxRecordCount:$U(t,"standardMaxRecordCount",void 0),tileMaxRecordCount:$U(t,"tileMaxRecordCount",void 0)}}function kQt(t){const e=t.advancedQueryCapabilities,r=or(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:or(e,"supportsQueryRelatedPagination",!1),supportsCount:r,supportsOrderBy:r,supportsCacheHint:KF(e,"queryRelated")}}function UQt(t){return{supportsCacheHint:KF(t.advancedQueryCapabilities,"queryTopFilter")}}function zQt(t){const e=t.ownershipBasedAccessControlForFeatures,r=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:or(t,"allowGeometryUpdates",!0),supportsGlobalId:or(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:or(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:or(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:or(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:or(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:or(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:or(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:or(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:or(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:or(r,"supportsAsyncApplyEdits",!1)}}const VQt=t=>{let e=class extends t{constructor(){super(...arguments),this.capabilities=null,this.copyright=null,this.dateFieldsTimeReference=null,this.datesInUnknownTimezone=!1,this.displayField=null,this.definitionExpression=null,this.editFieldsInfo=null,this.editingInfo=null,this.elevationInfo=null,this.floorInfo=null,this.fullExtent=null,this.gdbVersion=null,this.geometryFieldsInfo=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.heightModelInfo=null,this.historicMoment=null,this.isTable=!1,this.layerId=void 0,this.minScale=0,this.maxScale=0,this.globalIdField=null,this.objectIdField=null,this.preferredTimeReference=null,this.relationships=null,this.sourceJSON=null,this.returnM=void 0,this.returnZ=void 0,this.serviceDefinitionExpression=null,this.serviceItemId=null,this.spatialReference=dt.WGS84,this.subtypeField=null,this.trackIdField=null,this.indexes=new(vt.ofType(_y)),this.version=void 0}readCapabilitiesFromService(r,i){return Pqe(i,this.url)}get effectiveCapabilities(){var o;const r=this.capabilities;if(!r)return null;const i=ie(r),{operations:n,editing:s}=i;return(o=this.sourceJSON)!=null&&o.isMultiServicesView?(this.userHasUpdateItemPrivileges&&(n.supportsQuery=!0),i):this.userHasUpdateItemPrivileges?(n.supportsAdd=n.supportsDelete=n.supportsEditing=n.supportsQuery=n.supportsUpdate=s.supportsDeleteByOthers=s.supportsGeometryUpdate=s.supportsUpdateByOthers=!0,i):(this.userHasFullEditingPrivileges&&n.supportsEditing&&(n.supportsAdd=n.supportsDelete=n.supportsUpdate=s.supportsGeometryUpdate=!0),i)}get hasFullEditingRestrictions(){var s;const r=this.capabilities;if(!r||(s=this.sourceJSON)!=null&&s.isMultiServicesView)return!1;const{operations:i,editing:n}=r;return i.supportsEditing&&!(i.supportsAdd&&i.supportsDelete&&i.supportsUpdate&&n.supportsGeometryUpdate)}get hasUpdateItemRestrictions(){var s;const r=this.capabilities;if(!r)return!1;const{operations:i,editing:n}=r;return(s=this.sourceJSON)!=null&&s.isMultiServicesView?!i.supportsQuery:!(i.supportsAdd&&i.supportsDelete&&i.supportsEditing&&i.supportsQuery&&i.supportsUpdate&&n.supportsDeleteByOthers&&n.supportsGeometryUpdate&&n.supportsUpdateByOthers)}readEditingInfo(r,i){const{editingInfo:n}=i;return n?{lastEditDate:n.lastEditDate!=null?new Date(n.lastEditDate):null}:null}readIsTableFromService(r,i){return i.type==="Table"}readMinScale(r,i){return i.effectiveMinScale||r||0}readMaxScale(r,i){return i.effectiveMaxScale||r||0}readGlobalIdFieldFromService(r,i){return Cqe(i)}readObjectIdFieldFromService(r,i){return Rqe(i)}readServiceDefinitionExpression(r,i){return i.definitionQuery||i.definitionExpression}set url(r){const i=qDe({layer:this,url:r,nonStandardUrlAllowed:!0,logger:re.getLogger(this)});this._set("url",i.url),i.layerId!=null&&this._set("layerId",i.layerId)}writeUrl(r,i,n,s){WDe(this,r,null,i,s)}readVersion(r,i){return SQt(i)}};return d([p({readOnly:!0,json:{read:!1,origins:{service:{read:{source:["advancedQueryCapabilities","allowGeometryUpdates","allowUpdateWithoutMValues","archivingInfo","capabilities","datesInUnknownTimezone","hasAttachments","hasM","hasZ","maxRecordCount","maxRecordCountFactor","ownershipBasedAccessControlForFeatures","standardMaxRecordCount","supportedQueryFormats","supportsAdvancedQueries","supportsApplyEditsWithGlobalIds","supportsAttachmentsByUploadId","supportsAttachmentsResizing","supportsCalculate","supportsCoordinatesQuantization","supportsExceedsLimitStatistics","supportsFieldDescriptionProperty","supportsQuantizationEditMode","supportsRollbackOnFailureParameter","supportsStatistics","supportsTruncate","supportsValidateSql","tileMaxRecordCount","useStandardizedQueries"]}}}}})],e.prototype,"capabilities",void 0),d([ke("service","capabilities")],e.prototype,"readCapabilitiesFromService",null),d([p({readOnly:!0})],e.prototype,"effectiveCapabilities",null),d([p({readOnly:!0})],e.prototype,"hasFullEditingRestrictions",null),d([p({readOnly:!0})],e.prototype,"hasUpdateItemRestrictions",null),d([p({type:String,json:{origins:{service:{read:{source:"copyrightText"}}}}})],e.prototype,"copyright",void 0),d([p({type:zP})],e.prototype,"dateFieldsTimeReference",void 0),d([p({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0),d([p({type:String,json:{origins:{service:{read:{source:"displayField"}}}}})],e.prototype,"displayField",void 0),d([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],e.prototype,"definitionExpression",void 0),d([p({readOnly:!0,type:aQt})],e.prototype,"editFieldsInfo",void 0),d([p({readOnly:!0})],e.prototype,"editingInfo",void 0),d([ke("editingInfo")],e.prototype,"readEditingInfo",null),d([p((()=>{const r=ie(Tue),i=r.json.origins;return i["web-map"]={read:!1,write:!1},i["portal-item"]={read:!1,write:!1},r})())],e.prototype,"elevationInfo",void 0),d([p({type:Oqe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],e.prototype,"floorInfo",void 0),d([p({type:$r,json:{origins:{service:{read:{source:"extent"}}}}})],e.prototype,"fullExtent",void 0),d([p()],e.prototype,"gdbVersion",void 0),d([p({readOnly:!0,type:OQt,json:{read:{source:"geometryProperties"}}})],e.prototype,"geometryFieldsInfo",void 0),d([p({type:["point","polygon","polyline","multipoint","multipatch","mesh"],json:{origins:{service:{read:_oe.read}}}})],e.prototype,"geometryType",void 0),d([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasM",void 0),d([p({type:Boolean,json:{origins:{service:{read:!0}}}})],e.prototype,"hasZ",void 0),d([p({readOnly:!0,type:q_})],e.prototype,"heightModelInfo",void 0),d([p({type:Date})],e.prototype,"historicMoment",void 0),d([p({readOnly:!0})],e.prototype,"isTable",void 0),d([ke("service","isTable",["type"])],e.prototype,"readIsTableFromService",null),d([p({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{read:!1,write:{target:"id"}}},read:!1}})],e.prototype,"layerId",void 0),d([p(avt)],e.prototype,"minScale",void 0),d([ke("service","minScale",["minScale","effectiveMinScale"])],e.prototype,"readMinScale",null),d([p(lvt)],e.prototype,"maxScale",void 0),d([ke("service","maxScale",["maxScale","effectiveMaxScale"])],e.prototype,"readMaxScale",null),d([p({type:String})],e.prototype,"globalIdField",void 0),d([ke("service","globalIdField",["globalIdField","fields"])],e.prototype,"readGlobalIdFieldFromService",null),d([p({type:String})],e.prototype,"objectIdField",void 0),d([ke("service","objectIdField",["objectIdField","fields"])],e.prototype,"readObjectIdFieldFromService",null),d([p({type:zP})],e.prototype,"preferredTimeReference",void 0),d([p({type:[AQt],readOnly:!0})],e.prototype,"relationships",void 0),d([p()],e.prototype,"sourceJSON",void 0),d([p({type:Boolean})],e.prototype,"returnM",void 0),d([p({type:Boolean})],e.prototype,"returnZ",void 0),d([p({readOnly:!0})],e.prototype,"serviceDefinitionExpression",void 0),d([ke("service","serviceDefinitionExpression",["definitionQuery","definitionExpression"])],e.prototype,"readServiceDefinitionExpression",null),d([p({type:String,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],e.prototype,"serviceItemId",void 0),d([p({type:dt,json:{origins:{service:{read:{source:"extent.spatialReference"}}}}})],e.prototype,"spatialReference",void 0),d([p({type:String,readOnly:!0,json:{origins:{service:{read:!0}}}})],e.prototype,"subtypeField",void 0),d([p({type:String,json:{read:{source:"timeInfo.trackIdField"}}})],e.prototype,"trackIdField",void 0),d([p({readOnly:!0,json:{write:!1}})],e.prototype,"serverGens",void 0),d([p({type:vt.ofType(_y),readOnly:!0})],e.prototype,"indexes",void 0),d([p(xue)],e.prototype,"url",null),d([tt("url")],e.prototype,"writeUrl",null),d([p({json:{origins:{service:{read:!0}},read:!1}})],e.prototype,"version",void 0),d([ke("service","version",["currentVersion","capabilities","drawingInfo","hasAttachments","htmlPopupType","relationships","timeInfo","typeIdField","types"])],e.prototype,"readVersion",null),e=d([I("esri.layers.mixins.FeatureLayerBase")],e),e};let bO=class extends Rn(me){constructor(e){super(e),this.expression=null,this.title=null,this.returnType=null}};d([p({type:String,json:{write:!0}})],bO.prototype,"expression",void 0),d([p({type:String,json:{write:!0}})],bO.prototype,"title",void 0),d([p({type:String,json:{write:!0}})],bO.prototype,"returnType",void 0),bO=d([I("esri.layers.support.ExpressionInfo")],bO);const Ufe=bO;var woe;let Sv=woe=class extends me{constructor(t){super(t),this.isAutoGenerated=!1,this.name=null,this.alias=null,this.onStatisticField=null,this.onStatisticExpression=null,this.statisticType=null}clone(){return new woe({name:this.name,alias:this.alias,isAutoGenerated:this.isAutoGenerated,onStatisticExpression:ie(this.onStatisticExpression),onStatisticField:this.onStatisticField,statisticType:this.statisticType})}};d([p({type:Boolean,json:{write:!0}})],Sv.prototype,"isAutoGenerated",void 0),d([p({type:String,json:{write:!0}})],Sv.prototype,"name",void 0),d([p({type:String,json:{write:!0}})],Sv.prototype,"alias",void 0),d([p({type:String,json:{write:!0}})],Sv.prototype,"onStatisticField",void 0),d([p({type:Ufe,json:{write:!0}})],Sv.prototype,"onStatisticExpression",void 0),d([p({type:String,json:{write:!0}})],Sv.prototype,"statisticType",void 0),Sv=woe=d([I("esri.layers.support.AggregateField")],Sv);const CE=Sv;var xoe;let Rb=xoe=class extends me{constructor(){super(...arguments),this.expression=null,this.title=null,this.value=null}readExpression(t,e){return e.value?Qie(e.value):t}writeExpression(t,e,r){this.value!=null&&(t=Qie(this.value)),t!=null&&(e[r]=t)}clone(){return new xoe({expression:this.expression,title:this.title,value:this.value})}};d([p({type:String,json:{write:{writerEnsuresNonNull:!0}}})],Rb.prototype,"expression",void 0),d([ke("expression",["expression","value"])],Rb.prototype,"readExpression",null),d([tt("expression")],Rb.prototype,"writeExpression",null),d([p({type:String,json:{write:!0,origins:{"web-scene":{write:!1}}}})],Rb.prototype,"title",void 0),d([p({json:{read:!1,write:!1}})],Rb.prototype,"value",void 0),Rb=xoe=d([I("esri.layers.support.LabelExpressionInfo")],Rb);const Mqe=Rb,$qe=[252,146,31,255],EOr=[153,153,153,255],Iqe={type:"esriSMS",style:"esriSMSCircle",size:6,color:$qe,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},Lqe={type:"esriSLS",style:"esriSLSSolid",width:.75,color:$qe},Dqe={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},BQt={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},jQt={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},GQt={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},HQt={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},qQt=lg.fromJSON(Iqe),WQt=Rd.fromJSON(Lqe),XQt=X_.fromJSON(Dqe),YQt=U3.fromJSON(BQt);function COr(t){if(t==null)return null;switch(t.type){case"mesh":return null;case"point":case"multipoint":return qQt;case"polyline":return WQt;case"polygon":case"extent":return XQt}return null}lg.fromJSON(jQt);Rd.fromJSON(GQt);X_.fromJSON(HQt);var Soe;const IU=new ri({esriServerPointLabelPlacementAboveCenter:"above-center",esriServerPointLabelPlacementAboveLeft:"above-left",esriServerPointLabelPlacementAboveRight:"above-right",esriServerPointLabelPlacementBelowCenter:"below-center",esriServerPointLabelPlacementBelowLeft:"below-left",esriServerPointLabelPlacementBelowRight:"below-right",esriServerPointLabelPlacementCenterCenter:"center-center",esriServerPointLabelPlacementCenterLeft:"center-left",esriServerPointLabelPlacementCenterRight:"center-right",esriServerLinePlacementAboveAfter:"above-after",esriServerLinePlacementAboveAlong:"above-along",esriServerLinePlacementAboveBefore:"above-before",esriServerLinePlacementAboveStart:"above-start",esriServerLinePlacementAboveEnd:"above-end",esriServerLinePlacementBelowAfter:"below-after",esriServerLinePlacementBelowAlong:"below-along",esriServerLinePlacementBelowBefore:"below-before",esriServerLinePlacementBelowStart:"below-start",esriServerLinePlacementBelowEnd:"below-end",esriServerLinePlacementCenterAfter:"center-after",esriServerLinePlacementCenterAlong:"center-along",esriServerLinePlacementCenterBefore:"center-before",esriServerLinePlacementCenterStart:"center-start",esriServerLinePlacementCenterEnd:"center-end",esriServerPolygonPlacementAlwaysHorizontal:"always-horizontal"},{ignoreUnknown:!0});function LU(t,e,r){return{enabled:!ZIe(r==null?void 0:r.layer)}}function Nqe(t){var e;return!t||t.origin!=="service"&&((e=t.layer)==null?void 0:e.type)!=="map-image"}function ZQt(t){return(t==null?void 0:t.type)==="map-image"}function Fqe(t){var e,r;return!!ZQt(t)&&!!((r=(e=t.capabilities)==null?void 0:e.exportMap)!=null&&r.supportsArcadeExpressionForLabeling)}function JQt(t){return Nqe(t)||Fqe(t==null?void 0:t.layer)}let ao=Soe=class extends me{static evaluateWhere(t,e){const r=(i,n,s)=>{switch(n){case"=":return i==s;case"<>":return i!=s;case">":return i>s;case">=":return i>=s;case"<":return i<s;case"<=":return i<=s}return!1};try{if(t==null)return!0;const i=t.split(" ");if(i.length===3)return r(e[i[0]],i[1],i[2]);if(i.length===7){const n=r(e[i[0]],i[1],i[2]),s=i[3],o=r(e[i[4]],i[5],i[6]);switch(s){case"AND":return n&&o;case"OR":return n||o}}return!1}catch{console.log("Error.: can't parse = "+t)}}constructor(t){super(t),this.type="label",this.name=null,this.allowOverrun=!1,this.deconflictionStrategy="static",this.labelExpression=null,this.labelExpressionInfo=null,this.labelPlacement=null,this.labelPosition="curved",this.maxScale=0,this.minScale=0,this.repeatLabel=!0,this.repeatLabelDistance=null,this.symbol=YQt,this.useCodedValues=void 0,this.where=null}readLabelExpression(t,e){const r=e.labelExpressionInfo;if(!r||!r.value&&!r.expression)return t}writeLabelExpression(t,e,r){if(this.labelExpressionInfo){if(this.labelExpressionInfo.value!=null)t=bLt(this.labelExpressionInfo.value);else if(this.labelExpressionInfo.expression!=null){const i=jhe(this.labelExpressionInfo.expression);i&&(t="["+i+"]")}}t!=null&&(e[r]=t)}writeLabelExpressionInfo(t,e,r,i){if(t==null&&this.labelExpression!=null&&Nqe(i))t=new Mqe({expression:this.getLabelExpressionArcade()});else if(!t)return;const n=t.toJSON(i);n.expression&&(e[r]=n)}writeMaxScale(t,e){(t||this.minScale)&&(e.maxScale=t)}writeMinScale(t,e){(t||this.maxScale)&&(e.minScale=t)}getLabelExpression(){return jH(this)}getLabelExpressionArcade(){return wLt(this)}getLabelExpressionSingleField(){return xLt(this)}hash(){return JSON.stringify(this)}clone(){return new Soe({allowOverrun:this.allowOverrun,deconflictionStrategy:this.deconflictionStrategy,labelExpression:this.labelExpression,labelExpressionInfo:ie(this.labelExpressionInfo),labelPosition:this.labelPosition,labelPlacement:this.labelPlacement,maxScale:this.maxScale,minScale:this.minScale,name:this.name,repeatLabel:this.repeatLabel,repeatLabelDistance:this.repeatLabelDistance,symbol:ie(this.symbol),where:this.where,useCodedValues:this.useCodedValues})}};d([p({type:String,json:{write:!0}})],ao.prototype,"name",void 0),d([p({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1},"portal-item":{default:!1,write:{overridePolicy:LU}}}}})],ao.prototype,"allowOverrun",void 0),d([p({type:String,json:{write:!0,default:"static",origins:{"web-scene":{write:!1},"portal-item":{default:"static",write:{overridePolicy:LU}}}}})],ao.prototype,"deconflictionStrategy",void 0),d([p({type:String,json:{write:{overridePolicy(t,e,r){return this.labelExpressionInfo&&(r==null?void 0:r.origin)==="service"&&Fqe(r.layer)?{enabled:!1}:{allowNull:!0}}}}})],ao.prototype,"labelExpression",void 0),d([ke("labelExpression")],ao.prototype,"readLabelExpression",null),d([tt("labelExpression")],ao.prototype,"writeLabelExpression",null),d([p({type:Mqe,json:{write:{overridePolicy:(t,e,r)=>JQt(r)?{allowNull:!0}:{enabled:!1}}}})],ao.prototype,"labelExpressionInfo",void 0),d([tt("labelExpressionInfo")],ao.prototype,"writeLabelExpressionInfo",null),d([p({type:IU.apiValues,json:{type:IU.jsonValues,read:IU.read,write:IU.write}})],ao.prototype,"labelPlacement",void 0),d([p({type:["curved","parallel"],json:{write:!0,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],ao.prototype,"labelPosition",void 0),d([p({type:Number})],ao.prototype,"maxScale",void 0),d([tt("maxScale")],ao.prototype,"writeMaxScale",null),d([p({type:Number})],ao.prototype,"minScale",void 0),d([tt("minScale")],ao.prototype,"writeMinScale",null),d([p({type:Boolean,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:LU}}}}})],ao.prototype,"repeatLabel",void 0),d([p({type:Number,cast:Ei,json:{write:!0,origins:{"web-scene":{write:!1},"portal-item":{write:{overridePolicy:LU}}}}})],ao.prototype,"repeatLabelDistance",void 0),d([p({types:Rbt,json:{origins:{"web-scene":{types:Obt,write:jSe,default:null}},write:jSe,default:null}})],ao.prototype,"symbol",void 0),d([p({type:Boolean,json:{write:!0}})],ao.prototype,"useCodedValues",void 0),d([p({type:String,json:{write:!0}})],ao.prototype,"where",void 0),ao=Soe=d([I("esri.layers.support.LabelClass")],ao);const iM=ao;var Toe;const KQt="esri.layers.support.FeatureReductionBinning";let qc=Toe=class extends p_{constructor(t){super(t),this.type="binning",this.binType="geohash",this.fixedBinLevel=3,this.labelingInfo=null,this.labelsVisible=!0,this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.fields=[],this.renderer=null}writeFields(t,e,r){const i=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());Rc(r,i,e)}readRenderer(t,e,r){var n;const i=(n=e.drawingInfo)==null?void 0:n.renderer;return i?g4(i,e,r)??void 0:kfe(e,r)}clone(){return new Toe({fields:ie(this.fields),fixedBinLevel:this.fixedBinLevel,labelingInfo:ie(this.labelingInfo),labelsVisible:this.labelsVisible,maxScale:this.maxScale,popupEnabled:this.popupEnabled,popupTemplate:ie(this.popupTemplate),renderer:ie(this.renderer)})}};d([Rt({binning:"binning"})],qc.prototype,"type",void 0),d([Rt({geohash:"geohash"})],qc.prototype,"binType",void 0),d([p({type:Number,range:{min:1,max:9},json:{write:!0}})],qc.prototype,"fixedBinLevel",void 0),d([p({type:[iM],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],qc.prototype,"labelingInfo",void 0),d([p(sF)],qc.prototype,"labelsVisible",void 0),d([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],qc.prototype,"maxScale",void 0),d([p(nF)],qc.prototype,"popupEnabled",void 0),d([p({type:LE,json:{name:"popupInfo",write:!0}})],qc.prototype,"popupTemplate",void 0),d([p({type:[CE],json:{write:!0}})],qc.prototype,"fields",void 0),d([tt("fields")],qc.prototype,"writeFields",null),d([p({types:JF,json:{write:{target:"drawingInfo.renderer"}}})],qc.prototype,"renderer",void 0),d([ke("renderer",["drawingInfo.renderer"])],qc.prototype,"readRenderer",null),qc=Toe=d([I(KQt)],qc);const kqe=qc;var Eoe;const QQt="esri.layers.support.FeatureReductionCluster";function sOe(t){var e;return t.type==="simple"&&!((e=t.visualVariables)!=null&&e.length)}let Ko=Eoe=class extends me{constructor(t){super(t),this.type="cluster",this.clusterRadius=Ei("80px"),this.clusterMinSize=Ei("12px"),this.clusterMaxSize=Ei("50px"),this.maxScale=0,this.popupEnabled=!0,this.popupTemplate=null,this.renderer=null,this.symbol=null,this.labelingInfo=null,this.labelsVisible=!0,this.fields=null}readRenderer(t,e,r){var n,s;const i=(n=e.drawingInfo)==null?void 0:n.renderer;return(s=i==null?void 0:i.authoringInfo)!=null&&s.isAutoGenerated?null:i?sOe(i)?null:g4(i,e,r)??void 0:kfe(e,r)}readSymbol(t,e,r){var n,s;const i=(n=e.drawingInfo)==null?void 0:n.renderer;if((s=i==null?void 0:i.authoringInfo)!=null&&s.isAutoGenerated)return null;if(i&&sOe(i)){const o=g4(i,e,r);return o==null?void 0:o.symbol}return null}writeSymbol(t,e,r,i){var s,o;const n=(o=(s=this.renderer)==null?void 0:s.authoringInfo)==null?void 0:o.isAutoGenerated;if(!this.renderer||n){const a=new ZF({symbol:t});e.drawingInfo={renderer:a.write({},i)}}}writeFields(t,e,r){const i=t.filter(n=>n.statisticType!=="avg_angle").map(n=>n.toJSON());Rc(r,i,e)}readFields(t,e,r){return t.filter(i=>!i.isAutoGenerated).map(i=>CE.fromJSON(i))}clone(){return new Eoe({clusterRadius:this.clusterRadius,clusterMinSize:this.clusterMinSize,clusterMaxSize:this.clusterMaxSize,labelingInfo:ie(this.labelingInfo),labelsVisible:this.labelsVisible,fields:ie(this.fields),maxScale:this.maxScale,renderer:ie(this.renderer),symbol:ie(this.symbol),popupEnabled:this.popupEnabled,popupTemplate:ie(this.popupTemplate)})}};d([p({type:["cluster"],readOnly:!0,json:{write:!0}})],Ko.prototype,"type",void 0),d([p({type:Number,cast:t=>t==="auto"?t:Ei(t),json:{write:!0}})],Ko.prototype,"clusterRadius",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],Ko.prototype,"clusterMinSize",void 0),d([p({type:Number,cast:Ei,json:{write:!0}})],Ko.prototype,"clusterMaxSize",void 0),d([p({type:Number,json:{default:0,name:"visibilityInfo.maxScale"}})],Ko.prototype,"maxScale",void 0),d([p(nF)],Ko.prototype,"popupEnabled",void 0),d([p({type:LE,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],Ko.prototype,"popupTemplate",void 0),d([p({types:JF,json:{write:{target:"drawingInfo.renderer"}}})],Ko.prototype,"renderer",void 0),d([ke("renderer",["drawingInfo.renderer"])],Ko.prototype,"readRenderer",null),d([p({types:Ebt})],Ko.prototype,"symbol",void 0),d([ke("symbol",["drawingInfo.renderer"])],Ko.prototype,"readSymbol",null),d([tt("symbol")],Ko.prototype,"writeSymbol",null),d([p({type:[iM],json:{read:{source:"drawingInfo.labelingInfo"},write:{target:"drawingInfo.labelingInfo"}}})],Ko.prototype,"labelingInfo",void 0),d([p(sF)],Ko.prototype,"labelsVisible",void 0),d([p({type:[CE],json:{write:!0}})],Ko.prototype,"fields",void 0),d([tt("fields")],Ko.prototype,"writeFields",null),d([ke("fields")],Ko.prototype,"readFields",null),Ko=Eoe=d([I(QQt)],Ko);const Uqe=Ko,oOe={key:"type",base:p_,typeMap:{cluster:Uqe,binning:kqe}},eer={types:{key:"type",base:p_,typeMap:{selection:jse,cluster:Uqe,binning:kqe}},json:{name:"layerDefinition.featureReduction",write:{allowNull:!0},origins:{"web-map":{types:oOe},"portal-item":{types:oOe},"web-scene":{types:{key:"type",base:p_,typeMap:{selection:jse}}}}}},yR={Base64:0,Hex:1,String:2,Raw:3},WA=8,zqe=(1<<WA)-1;function Cw(t,e){const r=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(r>>16)<<16|65535&r}function ter(t){const e=[];for(let r=0,i=t.length*WA;r<i;r+=WA)e[r>>5]|=(t.charCodeAt(r/WA)&zqe)<<r%32;return e}function rer(t){const e=[];for(let r=0,i=32*t.length;r<i;r+=WA)e.push(String.fromCharCode(t[r>>5]>>>r%32&zqe));return e.join("")}function ier(t){const e="0123456789abcdef",r=[];for(let i=0,n=4*t.length;i<n;i++)r.push(e.charAt(t[i>>2]>>i%4*8+4&15)+e.charAt(t[i>>2]>>i%4*8&15));return r.join("")}function ner(t){const e="=",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[];for(let n=0,s=4*t.length;n<s;n+=3){const o=(t[n>>2]>>n%4*8&255)<<16|(t[n+1>>2]>>(n+1)%4*8&255)<<8|t[n+2>>2]>>(n+2)%4*8&255;for(let a=0;a<4;a++)8*n+6*a>32*t.length?i.push(e):i.push(r.charAt(o>>6*(3-a)&63))}return i.join("")}function ser(t,e){return t<<e|t>>>32-e}function Sq(t,e,r,i,n,s){return Cw(ser(Cw(Cw(e,t),Cw(i,s)),n),r)}function Jl(t,e,r,i,n,s,o){return Sq(e&r|~e&i,t,e,n,s,o)}function Kl(t,e,r,i,n,s,o){return Sq(e&i|r&~i,t,e,n,s,o)}function Ql(t,e,r,i,n,s,o){return Sq(e^r^i,t,e,n,s,o)}function ec(t,e,r,i,n,s,o){return Sq(r^(e|~i),t,e,n,s,o)}function oer(t,e){t[e>>5]|=128<<e%32,t[14+(e+64>>>9<<4)]=e;let r=1732584193,i=-271733879,n=-1732584194,s=271733878;for(let o=0;o<t.length;o+=16){const a=r,l=i,c=n,u=s;r=Jl(r,i,n,s,t[o],7,-680876936),s=Jl(s,r,i,n,t[o+1],12,-389564586),n=Jl(n,s,r,i,t[o+2],17,606105819),i=Jl(i,n,s,r,t[o+3],22,-1044525330),r=Jl(r,i,n,s,t[o+4],7,-176418897),s=Jl(s,r,i,n,t[o+5],12,1200080426),n=Jl(n,s,r,i,t[o+6],17,-1473231341),i=Jl(i,n,s,r,t[o+7],22,-45705983),r=Jl(r,i,n,s,t[o+8],7,1770035416),s=Jl(s,r,i,n,t[o+9],12,-1958414417),n=Jl(n,s,r,i,t[o+10],17,-42063),i=Jl(i,n,s,r,t[o+11],22,-1990404162),r=Jl(r,i,n,s,t[o+12],7,1804603682),s=Jl(s,r,i,n,t[o+13],12,-40341101),n=Jl(n,s,r,i,t[o+14],17,-1502002290),i=Jl(i,n,s,r,t[o+15],22,1236535329),r=Kl(r,i,n,s,t[o+1],5,-165796510),s=Kl(s,r,i,n,t[o+6],9,-1069501632),n=Kl(n,s,r,i,t[o+11],14,643717713),i=Kl(i,n,s,r,t[o],20,-373897302),r=Kl(r,i,n,s,t[o+5],5,-701558691),s=Kl(s,r,i,n,t[o+10],9,38016083),n=Kl(n,s,r,i,t[o+15],14,-660478335),i=Kl(i,n,s,r,t[o+4],20,-405537848),r=Kl(r,i,n,s,t[o+9],5,568446438),s=Kl(s,r,i,n,t[o+14],9,-1019803690),n=Kl(n,s,r,i,t[o+3],14,-187363961),i=Kl(i,n,s,r,t[o+8],20,1163531501),r=Kl(r,i,n,s,t[o+13],5,-1444681467),s=Kl(s,r,i,n,t[o+2],9,-51403784),n=Kl(n,s,r,i,t[o+7],14,1735328473),i=Kl(i,n,s,r,t[o+12],20,-1926607734),r=Ql(r,i,n,s,t[o+5],4,-378558),s=Ql(s,r,i,n,t[o+8],11,-2022574463),n=Ql(n,s,r,i,t[o+11],16,1839030562),i=Ql(i,n,s,r,t[o+14],23,-35309556),r=Ql(r,i,n,s,t[o+1],4,-1530992060),s=Ql(s,r,i,n,t[o+4],11,1272893353),n=Ql(n,s,r,i,t[o+7],16,-155497632),i=Ql(i,n,s,r,t[o+10],23,-1094730640),r=Ql(r,i,n,s,t[o+13],4,681279174),s=Ql(s,r,i,n,t[o],11,-358537222),n=Ql(n,s,r,i,t[o+3],16,-722521979),i=Ql(i,n,s,r,t[o+6],23,76029189),r=Ql(r,i,n,s,t[o+9],4,-640364487),s=Ql(s,r,i,n,t[o+12],11,-421815835),n=Ql(n,s,r,i,t[o+15],16,530742520),i=Ql(i,n,s,r,t[o+2],23,-995338651),r=ec(r,i,n,s,t[o],6,-198630844),s=ec(s,r,i,n,t[o+7],10,1126891415),n=ec(n,s,r,i,t[o+14],15,-1416354905),i=ec(i,n,s,r,t[o+5],21,-57434055),r=ec(r,i,n,s,t[o+12],6,1700485571),s=ec(s,r,i,n,t[o+3],10,-1894986606),n=ec(n,s,r,i,t[o+10],15,-1051523),i=ec(i,n,s,r,t[o+1],21,-2054922799),r=ec(r,i,n,s,t[o+8],6,1873313359),s=ec(s,r,i,n,t[o+15],10,-30611744),n=ec(n,s,r,i,t[o+6],15,-1560198380),i=ec(i,n,s,r,t[o+13],21,1309151649),r=ec(r,i,n,s,t[o+4],6,-145523070),s=ec(s,r,i,n,t[o+11],10,-1120210379),n=ec(n,s,r,i,t[o+2],15,718787259),i=ec(i,n,s,r,t[o+9],21,-343485551),r=Cw(r,a),i=Cw(i,l),n=Cw(n,c),s=Cw(s,u)}return[r,i,n,s]}function Vqe(t,e=yR.Hex){const r=e||yR.Base64,i=oer(ter(t),t.length*WA);switch(r){case yR.Raw:return i;case yR.Hex:return ier(i);case yR.String:return rer(i);case yR.Base64:return ner(i)}}var Coe;let wL=Coe=class extends wq{writeLevels(t,e,r){for(const i in t){const n=this.levels[i];return void(e.stops=n)}}clone(){return new Coe({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:Tw(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:Tw(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(t=>t.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:ie(this.levels)})}};d([p()],wL.prototype,"levels",void 0),d([tt("levels")],wL.prototype,"writeLevels",null),wL=Coe=d([I("esri.views.2d.engine.LevelDependentSizeVariable")],wL);const aer=re.getLogger("esri.views.2d.layers.support.clusterUtils");he.add("esri-cluster-arcade-enabled",!0);const ler=he("esri-cluster-arcade-enabled"),cer=(t,e,r,i,n)=>{const s=e.clone();if(!per(s))return s;if(s.authoringInfo||(s.authoringInfo=new Cfe),s.authoringInfo.isAutoGenerated=!0,"visualVariables"in s){const o=(s.visualVariables||[]).filter(l=>l.valueExpression!=="$view.scale"),a=uer(o);o.forEach(l=>{l.type==="rotation"?l.field?l.field=wS(t,l.field,"avg_angle","number"):l.valueExpression&&(l.field=M$(t,l.valueExpression,"avg_angle","number"),l.valueExpression=null):l.normalizationField?(l.field=wS(t,l.field,"avg_norm","number",l.normalizationField),l.normalizationField=null):l.field?l.field=wS(t,l.field,"avg","number"):l.valueExpression&&(l.field=M$(t,l.valueExpression,"avg","number"),l.valueExpression=null)}),a==null&&!der(o)&&n&&(o.push(her(r,i)),s.dynamicClusterSize=!0),s.visualVariables=o}switch(s.type){case"simple":break;case"pie-chart":for(const o of s.attributes)o.field?o.field=wS(t,o.field,"sum","number"):o.valueExpression&&(o.field=M$(t,o.valueExpression,"sum","number"),o.valueExpression=null);break;case"unique-value":s.field?s.field=wS(t,s.field,"mode","string"):s.valueExpression&&(s.field=M$(t,s.valueExpression,"mode","string"),s.valueExpression=null);break;case"class-breaks":s.normalizationField?(s.field=wS(t,s.field,"avg_norm","number",s.normalizationField),s.normalizationField=null):s.field?s.field=wS(t,s.field,"avg","number"):s.valueExpression&&(s.field=M$(t,s.valueExpression,"avg","number"),s.valueExpression=null)}return s},uer=t=>{for(const e of t)if(e.type==="size")return e;return null},der=t=>{for(const e of t)if(e.field==="cluster_count")return!0;return!1},her=(t,e)=>{const r=[new uO({value:0,size:0}),new uO({value:1})];if(e==null)return new wq({field:"cluster_count",stops:[...r,new uO({value:2,size:0})]});const i=Object.keys(e).reduce((n,s)=>({...n,[s]:[...r,new uO({value:Math.max(2,e[s].minValue),size:t.clusterMinSize}),new uO({value:Math.max(3,e[s].maxValue),size:t.clusterMaxSize})]}),{});return new wL({field:"cluster_count",levels:i})},per=t=>{const e=r=>aer.error(new H("Unsupported-renderer",r,{renderer:t}));if(!t)return!1;switch(t.type){case"unique-value":if(t.field2||t.field3)return e("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1;break;case"class-breaks":if(t.normalizationField){const r=t.normalizationType;if(r!=="field")return e(`FeatureReductionCluster does not support a normalizationType of ${r}`),!1}break;case"simple":case"pie-chart":break;default:return e(`FeatureReductionCluster does not support renderers of type ${t.type}`),!1}if(!ler){if("valueExpression"in t&&t.valueExpression)return e("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in t&&t.visualVariables||[]).some(r=>!(!("valueExpression"in r)||!r.valueExpression)))return e("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function fer(t,e,r){switch(t){case"sum":return`cluster_sum_${e}`;case"avg":case"avg_angle":return`cluster_avg_${e}`;case"mode":return`cluster_type_${e}`;case"avg_norm":{const i=r,n="field",s=e.toLowerCase()+",norm:"+n+","+i.toLowerCase();return"cluster_avg_"+Vqe(s)}}}function M$(t,e,r,i){const n=Vqe(e),s=r==="mode"?`cluster_type_${n}`:r==="sum"?`cluster_sum_${n}`:`cluster_avg_${n}`;return t.some(o=>o.name===s)||t.push(new CE({name:s,isAutoGenerated:!0,onStatisticExpression:new Ufe({expression:e,returnType:i}),statisticType:r})),s}function wS(t,e,r,i,n){if(e==="cluster_count"||t.some(o=>o.name===e))return e;const s=fer(r,e,n);return t.some(o=>o.name===s)||(r==="avg_norm"?t.push(new CE({name:s,isAutoGenerated:!0,onStatisticExpression:new Ufe({expression:`$feature.${e} / $feature.${n}`,returnType:i}),statisticType:"avg"})):t.push(new CE({name:s,isAutoGenerated:!0,onStatisticField:e,statisticType:r}))),s}const Bqe=t=>{let e=class extends t{constructor(...r){super(...r),this.own(this.watch("renderer",()=>{if(this.featureReduction){const i=this._normalizeFeatureReduction(this.featureReduction);this._set("featureReduction",i)}},!0))}set featureReduction(r){const i=this._normalizeFeatureReduction(r);this._set("featureReduction",i)}set renderer(r){}_normalizeFeatureReduction(r){var a;if((r==null?void 0:r.type)!=="cluster")return r;const i=r.clone(),n=[new CE({name:"cluster_count",isAutoGenerated:!0,statisticType:"count"})],s=(i.fields??[]).filter(l=>!l.isAutoGenerated);if(r.renderer&&!((a=r.renderer.authoringInfo)!=null&&a.isAutoGenerated))return i.fields=[...n,...s],i;if(r.symbol)return i.fields=[...n,...s],i.renderer=null,i;if(!this.renderer)return r;const o=cer(n,this.renderer,r,null,!1);return i.fields=[...n,...s],i.renderer=o,i}};return d([p(eer)],e.prototype,"featureReduction",null),e=d([I("esri.layers.mixins.FeatureReductionLayer")],e),e};var Roe;const PJ=new ri({asc:"ascending",desc:"descending"});let wO=Roe=class extends me{constructor(t){super(t),this.field=null,this.valueExpression=null,this.order="ascending"}clone(){return new Roe({field:this.field,valueExpression:this.valueExpression,order:this.order})}};d([p({type:String,json:{write:!0}})],wO.prototype,"field",void 0),d([p({type:String,json:{write:!0}})],wO.prototype,"valueExpression",void 0),d([p({type:PJ.apiValues,json:{read:PJ.read,write:PJ.write}})],wO.prototype,"order",void 0),wO=Roe=d([I("esri.layers.support.OrderByInfo")],wO);const jqe=wO;function mer(t,e,r){if(!t)return null;const i=t.find(s=>!!s.field);if(!i)return null;const n=new jqe;return n.read(i,r),[n]}function ger(t,e,r,i){const n=t.find(s=>!!s.field);n&&Rc(r,[n.toJSON()],e)}const Gqe=t=>{let e=class extends t{constructor(){super(...arguments),this.orderBy=null}};return d([p({type:[jqe],json:{origins:{"web-scene":{write:!1,read:!1}},read:{source:"layerDefinition.orderBy",reader:mer},write:{target:"layerDefinition.orderBy",writer:ger}}})],e.prototype,"orderBy",void 0),e=d([I("esri.layers.mixins.OrderedLayer")],e),e};let xL=class extends Ce{constructor(){super(...arguments),this.updating=!1,this.status="unknown"}};d([p()],xL.prototype,"updating",void 0),d([p()],xL.prototype,"status",void 0),xL=d([I("esri.layers.support.PublishingInfo")],xL);const yer=xL,Hqe="esri.layers.mixins.PublishableLayer",ver=Symbol(Hqe),_er=t=>{var e;let r=class extends t{constructor(){super(...arguments),this[e]=!0}get publishingInfo(){if(this.destroyed)return null;const i=this._get("publishingInfo");if(i)return i;const n=new yer;return this._checkPublishingStatus(n),n}_checkPublishingStatus(i){let o=0;const a=async c=>{let u;i.updating=!0;try{u=await this.fetchPublishingStatus()}catch{u="unavailable"}u!=="published"&&u!=="unavailable"||(i.status==="publishing"&&this.refresh(),l.remove()),i.status=u,i.updating=!1,l.removed||(o=setTimeout(a,c,c+125))},l={removed:!1,remove(){this.removed=!0,clearTimeout(o)}};this.when().catch(()=>l.remove()),a(250),this.own(l)}};return e=ver,d([p({readOnly:!0,clonable:!1})],r.prototype,"publishingInfo",null),r=d([I(Hqe)],r),r},qqe=Ac()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let SL=class extends Rn(me){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return d0t(this.value,this.unit,"milliseconds")}};d([Rt(qqe,{nonNullable:!0})],SL.prototype,"unit",void 0),d([p({type:Number,json:{write:!0},nonNullable:!0})],SL.prototype,"value",void 0),SL=d([I("esri.TimeInterval")],SL);const kj=SL;function aOe(t,e){return kj.fromJSON({value:t,unit:e})}let cc=class extends Rn(me){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeReference=null,this.trackIdField=null,this.useTime=!0}readFullTimeExtent(e,r){if(!r.timeExtent||!Array.isArray(r.timeExtent)||r.timeExtent.length!==2)return null;const i=new Date(r.timeExtent[0]),n=new Date(r.timeExtent[1]);return new T0({start:i,end:n})}writeFullTimeExtent(e,r){e&&e.start!=null&&e.end!=null?r.timeExtent=[e.start.getTime(),e.end.getTime()]:r.timeExtent=null}readInterval(e,r){return r.timeInterval&&r.timeIntervalUnits?aOe(r.timeInterval,r.timeIntervalUnits):r.defaultTimeInterval&&r.defaultTimeIntervalUnits?aOe(r.defaultTimeInterval,r.defaultTimeIntervalUnits):null}writeInterval(e,r){r.timeInterval=(e==null?void 0:e.toJSON().value)??null,r.timeIntervalUnits=(e==null?void 0:e.toJSON().unit)??null}};d([p({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],cc.prototype,"cumulative",void 0),d([p({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],cc.prototype,"endField",void 0),d([p({type:T0,json:{write:{enabled:!0,allowNull:!0}}})],cc.prototype,"fullTimeExtent",void 0),d([ke("fullTimeExtent",["timeExtent"])],cc.prototype,"readFullTimeExtent",null),d([tt("fullTimeExtent")],cc.prototype,"writeFullTimeExtent",null),d([p({type:Boolean,json:{write:!0}})],cc.prototype,"hasLiveData",void 0),d([p({type:kj,json:{write:{enabled:!0,allowNull:!0}}})],cc.prototype,"interval",void 0),d([ke("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],cc.prototype,"readInterval",null),d([tt("interval")],cc.prototype,"writeInterval",null),d([p({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],cc.prototype,"startField",void 0),d([p({type:zP,json:{write:{enabled:!0,allowNull:!0}}})],cc.prototype,"timeReference",void 0),d([p({type:String,json:{write:{enabled:!0,allowNull:!0}}})],cc.prototype,"trackIdField",void 0),d([p({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],cc.prototype,"useTime",void 0),cc=d([I("esri.layers.support.TimeInfo")],cc);const Wqe=cc,Xqe=t=>{let e=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(r,i){const n=i.timeInfo.exportOptions;if(!n)return null;const s=n.timeOffset,o=qqe.fromJSON(n.timeOffsetUnits);return s&&o?new kj({value:s,unit:o}):null}set timeInfo(r){vue(r,this.fieldsIndex),this._set("timeInfo",r)}};return d([p({type:T0,json:{write:!1}})],e.prototype,"timeExtent",void 0),d([p({type:kj})],e.prototype,"timeOffset",void 0),d([ke("service","timeOffset",["timeInfo.exportOptions"])],e.prototype,"readOffset",null),d([p({value:null,type:Wqe,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.prototype,"timeInfo",null),d([p({type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation"},origins:{"web-scene":{read:!1,write:!1}}}})],e.prototype,"useViewTime",void 0),e=d([I("esri.layers.mixins.TemporalLayer")],e),e},lOe=new ri({esriFeatureEditToolAutoCompletePolygon:"auto-complete-polygon",esriFeatureEditToolCircle:"circle",esriFeatureEditToolEllipse:"ellipse",esriFeatureEditToolFreehand:"freehand",esriFeatureEditToolLine:"line",esriFeatureEditToolNone:"none",esriFeatureEditToolPoint:"point",esriFeatureEditToolPolygon:"polygon",esriFeatureEditToolRectangle:"rectangle",esriFeatureEditToolArrow:"arrow",esriFeatureEditToolTriangle:"triangle",esriFeatureEditToolLeftArrow:"left-arrow",esriFeatureEditToolRightArrow:"right-arrow",esriFeatureEditToolUpArrow:"up-arrow",esriFeatureEditToolDownArrow:"down-arrow"});let Ob=class extends Rn(me){constructor(e){super(e),this.name=null,this.description=null,this.drawingTool=null,this.prototype=null,this.thumbnail=null}};d([p({json:{write:!0}})],Ob.prototype,"name",void 0),d([p({json:{write:!0}})],Ob.prototype,"description",void 0),d([p({json:{read:lOe.read,write:lOe.write}})],Ob.prototype,"drawingTool",void 0),d([p({json:{write:!0}})],Ob.prototype,"prototype",void 0),d([p({json:{write:!0}})],Ob.prototype,"thumbnail",void 0),Ob=d([I("esri.layers.support.FeatureTemplate")],Ob);const Tq=Ob;let Tv=class extends Rn(me){constructor(e){super(e),this.id=null,this.name=null,this.domains=null,this.templates=null}readDomains(e){const r={};for(const i of Object.keys(e))r[i]=zhe(e[i]);return r}writeDomains(e,r){var n;const i={};for(const s of Object.keys(e))e[s]&&(i[s]=(n=e[s])==null?void 0:n.toJSON());r.domains=i}};d([p({json:{write:!0}})],Tv.prototype,"id",void 0),d([p({json:{write:!0}})],Tv.prototype,"name",void 0),d([p({json:{write:!0}})],Tv.prototype,"domains",void 0),d([ke("domains")],Tv.prototype,"readDomains",null),d([tt("domains")],Tv.prototype,"writeDomains",null),d([p({type:[Tq],json:{write:!0}})],Tv.prototype,"templates",void 0),Tv=d([I("esri.layers.support.FeatureType")],Tv);const zfe=Tv;function Vfe(){return{fields:{type:[IF],value:null},fieldsIndex:{readOnly:!0,get(){return new Rfe(this.fields||[])}},outFields:{type:[String],json:{read:!1},set:function(t){this._userOutFields=t,this.notifyChange("outFields")},get:function(){var e;const t=this._userOutFields;if(!t||!t.length)return null;if(t.includes("*"))return["*"];if(!this.fields)return t;for(const r of t)((e=this.fieldsIndex)==null?void 0:e.has(r))||re.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${r} found in outFields`,{layer:this,outFields:t});return U7(this.fieldsIndex,t)}}}}const MJ=re.getLogger("esri.layers.support.labelingInfo"),ber=/\[([^\[\]]+)\]/gi;function y4(t,e,r){return t?t.map(i=>{const n=new iM;if(n.read(i,r),n.labelExpression){const s=e.fields||e.layerDefinition&&e.layerDefinition.fields||this.fields;n.labelExpression=n.labelExpression.replaceAll(ber,(o,a)=>`[${wer(a,s)}]`)}return n}):null}function wer(t,e){if(!e)return t;const r=t.toLowerCase();for(let i=0;i<e.length;i++){const n=e[i].name;if(n.toLowerCase()===r)return n}return t}const xer={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function $Or(t,e){const r=ie(t);return r.some(i=>Ser(i,e))?[]:r}function Ser(t,e){const r=t.labelPlacement,i=xer[e];if(!t.symbol)return MJ.warn("No ILabelClass symbol specified."),!0;if(!i)return MJ.error(new H("labeling:unsupported-geometry-type",`Unable to create labels for layer, geometry type '${e}' is not supported`)),!0;if(!i.includes(r)){const n=i[0];r&&MJ.warn(`Found invalid label placement type ${r} for ${e}. Defaulting to ${n}`),t.labelPlacement=n}return!1}const dm=[];function Ter(t,e){if(pue(t.url??""))return!0;const{wkid:r}=e;for(const i of dm){if((t.version??0)>=i[0])return!0;if(typeof i[1]=="function"&&(i[1]=i[1]()),i[1].has(r))return!1}return!0}dm.push([10.91,()=>{const t=new Set([9709,9716,9741,9761,9766]);for(let e=9712;e<=9713;e++)t.add(e);for(let e=9748;e<=9749;e++)t.add(e);for(let e=20904;e<=20932;e++)t.add(e);for(let e=21004;e<=21032;e++)t.add(e);for(let e=21207;e<=21264;e++)t.add(e);for(let e=21307;e<=21364;e++)t.add(e);for(let e=102759;e<=102760;e++)t.add(e);for(let e=102901;e<=102955;e++)t.add(e);return t}]),dm.push([10.9,()=>{const t=new Set([9300,9354,9364,9367,9373,9377,9387,9456,9473,9498,9678,9680,29874,103599,103872,104028]);for(let e=9356;e<=9360;e++)t.add(e);for(let e=9404;e<=9407;e++)t.add(e);for(let e=9476;e<=9482;e++)t.add(e);for(let e=9487;e<=9494;e++)t.add(e);for(let e=9697;e<=9699;e++)t.add(e);return t}]),dm.push([10.81,()=>{const t=new Set([9265,9333,103598,103699]);for(let e=9248;e<=9254;e++)t.add(e);for(let e=9271;e<=9273;e++)t.add(e);for(let e=9284;e<=9285;e++)t.add(e);for(let e=21453;e<=21463;e++)t.add(e);return t}]),dm.push([10.8,()=>{const t=new Set([8088,8395,8428,8433,8531,8687,8692,8694,8699,8900,9003,9006,9009,9012,9017,9191]);for(let e=8035;e<=8036;e++)t.add(e);for(let e=8455;e<=8456;e++)t.add(e);for(let e=8518;e<=8529;e++)t.add(e);for(let e=8533;e<=8536;e++)t.add(e);for(let e=8538;e<=8540;e++)t.add(e);for(let e=8677;e<=8679;e++)t.add(e);for(let e=8902;e<=8903;e++)t.add(e);for(let e=8907;e<=8910;e++)t.add(e);for(let e=8949;e<=8951;e++)t.add(e);for(let e=8972;e<=8987;e++)t.add(e);for(let e=9039;e<=9040;e++)t.add(e);for(let e=9068;e<=9069;e++)t.add(e);for(let e=9140;e<=9141;e++)t.add(e);for(let e=9148;e<=9150;e++)t.add(e);for(let e=9153;e<=9159;e++)t.add(e);for(let e=9205;e<=9218;e++)t.add(e);for(let e=9221;e<=9222;e++)t.add(e);for(let e=54098;e<=54101;e++)t.add(e);return t}]),dm.push([10.71,()=>{const t=new Set([6316]);for(let e=8351;e<=8353;e++)t.add(e);for(let e=9294;e<=9297;e++)t.add(e);for(let e=22619;e<=22621;e++)t.add(e);for(let e=103586;e<=103594;e++)t.add(e);return t}]),dm.push([10.7,()=>{const t=new Set([8387,8391,8427,8545,8682,8685,8818,31370,104022,104024,104975]);for(let e=8065;e<=8068;e++)t.add(e);for(let e=8082;e<=8083;e++)t.add(e);for(let e=8379;e<=8385;e++)t.add(e);for(let e=8836;e<=8840;e++)t.add(e);for(let e=8857;e<=8860;e++)t.add(e);for(let e=53035;e<=53037;e++)t.add(e);for(let e=54090;e<=54091;e++)t.add(e);for(let e=102498;e<=102499;e++)t.add(e);return t}]),dm.push([10.61,()=>new Set([102497])]),dm.push([10.6,()=>{const t=new Set([7803,7805,7887,8086,8232,8237,8240,8246,8249,8252,8255,9019,9391]);for(let e=7755;e<=7787;e++)t.add(e);for(let e=7791;e<=7795;e++)t.add(e);for(let e=7799;e<=7801;e++)t.add(e);for(let e=7825;e<=7831;e++)t.add(e);for(let e=7877;e<=7878;e++)t.add(e);for(let e=7882;e<=7883;e++)t.add(e);for(let e=7991;e<=7992;e++)t.add(e);for(let e=8042;e<=8043;e++)t.add(e);for(let e=8058;e<=8059;e++)t.add(e);for(let e=8311;e<=8348;e++)t.add(e);for(let e=9060;e<=9067;e++)t.add(e);for(let e=102562;e<=102568;e++)t.add(e);for(let e=102799;e<=102900;e++)t.add(e);return t}]),dm.push([10.51,()=>{const t=new Set([7683,7881,7886,7899,8888,9e3]);for(let e=8013;e<=8032;e++)t.add(e);for(let e=9053;e<=9057;e++)t.add(e);for(let e=104017;e<=104018;e++)t.add(e);for(let e=104971;e<=104974;e++)t.add(e);return t}]),dm.push([10.5,()=>{const t=new Set([6962,7035,7037,7039,7041,7084,7086,7133,7798,102399]);for(let e=4087;e<=4088;e++)t.add(e);for(let e=5896;e<=5899;e++)t.add(e);for(let e=7005;e<=7007;e++)t.add(e);for(let e=7057;e<=7070;e++)t.add(e);for(let e=7073;e<=7082;e++)t.add(e);for(let e=7109;e<=7128;e++)t.add(e);for(let e=7844;e<=7859;e++)t.add(e);return t}]);async function Yqe(t,e,r){const i=t&&t.getAtOrigin&&t.getAtOrigin("renderer",e.origin);if(i&&i.type==="unique-value"&&i.styleOrigin){const n=await wd(i.populateFromStyle());if(vr(r),n.ok===!1){const s=n.error;e&&e.messages&&e.messages.push(new nf("renderer:style-reference",`Failed to create unique value renderer from style reference: ${s.message}`,{error:s,context:e})),t.clear("renderer",e==null?void 0:e.origin)}}}var Ooe;let xO=Ooe=class extends me{constructor(t){super(t),this.groupByFields=void 0,this.topCount=void 0,this.orderByFields=void 0}clone(){return new Ooe({groupByFields:this.groupByFields,topCount:this.topCount,orderByFields:this.orderByFields})}};d([p({type:[String],json:{write:!0}})],xO.prototype,"groupByFields",void 0),d([p({type:Number,json:{write:!0}})],xO.prototype,"topCount",void 0),d([p({type:[String],json:{write:!0}})],xO.prototype,"orderByFields",void 0),xO=Ooe=d([I("esri.rest.support.TopFilter")],xO);const Eer=xO;var Aoe;const cOe=new ri({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"}),uOe=new ri({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});let Qn=Aoe=class extends me{constructor(t){super(t),this.cacheHint=void 0,this.distance=void 0,this.geometry=null,this.geometryPrecision=void 0,this.maxAllowableOffset=void 0,this.num=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.resultType=null,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.start=void 0,this.spatialRelationship="intersects",this.timeExtent=null,this.topFilter=void 0,this.units=null,this.where="1=1"}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new Aoe(ie({cacheHint:this.cacheHint,distance:this.distance,geometry:this.geometry,geometryPrecision:this.geometryPrecision,maxAllowableOffset:this.maxAllowableOffset,num:this.num,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,resultType:this.resultType,returnGeometry:this.returnGeometry,returnZ:this.returnZ,returnM:this.returnM,start:this.start,spatialRelationship:this.spatialRelationship,timeExtent:this.timeExtent,topFilter:this.topFilter,units:this.units,where:this.where}))}};d([p({type:Boolean,json:{write:!0}})],Qn.prototype,"cacheHint",void 0),d([p({type:Number,json:{write:{overridePolicy:t=>({enabled:t>0})}}})],Qn.prototype,"distance",void 0),d([p({types:ME,json:{read:P_,write:!0}})],Qn.prototype,"geometry",void 0),d([p({type:Number,json:{write:!0}})],Qn.prototype,"geometryPrecision",void 0),d([p({type:Number,json:{write:!0}})],Qn.prototype,"maxAllowableOffset",void 0),d([p({type:Number,json:{read:{source:"resultRecordCount"}}})],Qn.prototype,"num",void 0),d([p({json:{write:!0}})],Qn.prototype,"objectIds",void 0),d([p({type:[String],json:{write:!0}})],Qn.prototype,"orderByFields",void 0),d([p({type:[String],json:{write:!0}})],Qn.prototype,"outFields",void 0),d([p({type:dt,json:{read:{source:"outSR"},write:{target:"outSR"}}})],Qn.prototype,"outSpatialReference",void 0),d([p({type:String,json:{write:!0}})],Qn.prototype,"resultType",void 0),d([p({json:{write:!0}})],Qn.prototype,"returnGeometry",void 0),d([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Qn.prototype,"returnM",void 0),d([p({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],Qn.prototype,"returnZ",void 0),d([p({type:Number,json:{read:{source:"resultOffset"}}})],Qn.prototype,"start",void 0),d([tt("start"),tt("num")],Qn.prototype,"writeStart",null),d([p({type:String,json:{read:{source:"spatialRel",reader:cOe.read},write:{target:"spatialRel",writer:cOe.write}}})],Qn.prototype,"spatialRelationship",void 0),d([p({type:T0,json:{write:!0}})],Qn.prototype,"timeExtent",void 0),d([p({type:Eer,json:{write:!0}})],Qn.prototype,"topFilter",void 0),d([p({type:String,json:{read:uOe.read,write:{writer:uOe.write,overridePolicy(t){return{enabled:t!=null&&this.distance!=null&&this.distance>0}}}}})],Qn.prototype,"units",void 0),d([p({type:String,json:{write:!0}})],Qn.prototype,"where",void 0),Qn=Aoe=d([I("esri.rest.support.TopFeaturesQuery")],Qn),Qn.from=ls(Qn);const DU=Qn;function Bfe({displayField:t,editFieldsInfo:e,fields:r,objectIdField:i,title:n},s){if(!r)return null;const o=Aer({editFieldsInfo:e,fields:r,objectIdField:i},s);if(!o.length)return null;const a=$er({titleBase:n,fields:r,displayField:t}),l=Mer();return new LE({title:a,content:l,fieldInfos:o})}const Cer=(t,e)=>e.visibleFieldNames?e.visibleFieldNames.has(t.name):k0t(t,e);function Rer(t,e){const r=t;return e&&(t=t.filter(i=>!e.includes(i.type))),t===r&&(t=t.slice()),t.sort(Oer),t}function Oer(t,e){return t.type==="oid"?-1:e.type==="oid"?1:dOe(t)?-1:dOe(e)?1:(t.alias||t.name).toLocaleLowerCase().localeCompare((e.alias||e.name).toLocaleLowerCase())}function Aer(t,e){const r=e==null?void 0:e.visibleFieldNames;return Rer(t.fields??[],(e==null?void 0:e.ignoreFieldTypes)||Ier).map(i=>new Nue({fieldName:i.name,isEditable:F0t(i,t),label:i.alias,format:Per(i),visible:Cer(i,{...t,visibleFieldNames:r})}))}function Per(t){switch(t.type){case"small-integer":case"integer":case"single":return new fI({digitSeparator:!0,places:0});case"double":return new fI({digitSeparator:!0,places:2});case"date":return new fI({dateFormat:"long-month-day-year"});default:return t.type==="string"&&rvt(t.name)?new fI({digitSeparator:!0,places:0}):null}}function Mer(){return[new MN,new PN]}function $er(t){const e=C0t(t),{titleBase:r}=t;return e?`${r}: {${e.trim()}}`:r??""}function dOe(t){return(t.name&&t.name.toLowerCase())==="name"?!0:(t.alias&&t.alias.toLowerCase())==="name"}const Ier=["geometry","blob","raster","guid","xml"],Uc="FeatureLayer",Zqe="esri.layers.FeatureLayer",Ler=re.getLogger(Zqe);function NU(t,e){return new H("layer:unsupported",`Layer (${t.title}, ${t.id}) of type '${t.declaredClass}' ${e}`,{layer:t})}function hOe(t){return t&&t instanceof vt}const $J=Vfe();function IJ(t,e,r){const i=!!(r!=null&&r.writeLayerSchema);return{enabled:i,ignoreOrigin:i}}let Ht=class extends VQt(Bqe(Eqe(_er(mqe(Dfe(Gqe(Xqe(xq(Bje(dqe(Cue($fe(Q4(Tqe(uqe(Rn(O3))))))))))))))))){constructor(...e){super(...e),this._handles=new Ri,this.charts=null,this.copyright=null,this.displayField=null,this.dynamicDataSource=null,this.fields=null,this.fieldsIndex=null,this.formTemplate=null,this.fullExtent=null,this.geometryType=null,this.hasM=void 0,this.hasZ=void 0,this.infoFor3D=null,this.isTable=!1,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.outFields=null,this.path=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.spatialReference=dt.WGS84,this.subtypeCode=null,this.templates=null,this.timeInfo=null,this.title=null,this.sublayerTitleMode="item-title",this.type="feature",this.typeIdField=null,this.types=null,this.visible=!0}destroy(){var e;(e=this.source)==null||e.destroy(),this._handles=qe(this._handles)}normalizeCtorArgs(e,r){return typeof e=="string"?{url:e,...r}:e}load(e){var n;const r=e!=null?e.signal:null;if((n=this.portalItem)!=null&&n.loaded&&this.source)return this.addResolvingPromise(this.createGraphicsSource(r).then(s=>this.initLayerProperties(s))),Promise.resolve(this);const i=this.loadFromPortal({supportedTypes:["Feature Service","Feature Collection"]},e).catch(Oa).then(async()=>{if(this.url&&this.layerId==null&&/FeatureServer|MapServer\/*$/i.test(this.url)){const s=await this._fetchFirstLayerId(r);s!=null&&(this.layerId=s)}if(!this.url&&!this._hasMemorySource())throw new H("feature-layer:missing-url-or-source","Feature layer must be created with either a url or a source");return this.initLayerProperties(await this.createGraphicsSource(r))}).then(()=>this._setUserPrivileges(this.serviceItemId,e)).then(()=>EQt(this,e));return this.addResolvingPromise(i),Promise.resolve(this)}readCapabilities(e,r){return r=r.layerDefinition||r,Pqe(r,this.url)}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("dynamicDataSource"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("gdbVersion"),this.commitProperty("historicMoment"),this.commitProperty("returnZ"),this.commitProperty("capabilities"),this.commitProperty("returnM"),(this._get("createQueryVersion")??0)+1}get editingEnabled(){var e;return!(this.loaded&&!((e=this.capabilities)!=null&&e.operations.supportsEditing))&&(this._isOverridden("editingEnabled")?this._get("editingEnabled"):this._hasMemorySource()||this.userHasEditingPrivileges)}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}readEditingEnabled(e,r){return this._readEditingEnabled(r,!1)}readEditingEnabledFromWebMap(e,r,i){return this._readEditingEnabled(r,!0,i)}writeEditingEnabled(e,r){this._writeEditingEnabled(e,r,!1)}writeEditingEnabledToWebMap(e,r,i,n){this._writeEditingEnabled(e,r,!0,n)}get effectiveEditingEnabled(){return RQt(this)}readIsTable(e,r){return(r=(r==null?void 0:r.layerDefinition)??r).type==="Table"||!r.geometryType}writeIsTable(e,r,i,n){n!=null&&n.writeLayerSchema&&Rc(i,e?"Table":"Feature Layer",r)}readGlobalIdField(e,r){return Cqe(r.layerDefinition||r)}readObjectIdField(e,r){return Rqe(r.layerDefinition||r)}get parsedUrl(){const e=Ts(this.url);return e!=null&&(this.dynamicDataSource!=null?e.path=bd(e.path,"dynamicLayer"):this.layerId!=null&&(e.path=bd(e.path,this.layerId.toString()))),e}get defaultPopupTemplate(){return this.createPopupTemplate()}set renderer(e){CP(e,this.fieldsIndex),this._set("renderer",e)}readRenderer(e,r,i){var s;r=r.layerDefinition||r;const n=(s=r.drawingInfo)==null?void 0:s.renderer;if(n){const o=g4(n,r,i)??void 0;return o||Ler.error("Failed to create renderer",{rendererDefinition:r.drawingInfo.renderer,layer:this,context:i}),o}return kfe(r,i)}set source(e){const r=this._get("source");r!==e&&(hOe(r)&&this._resetMemorySource(r),hOe(e)&&this._initMemorySource(e),this._set("source",e))}castSource(e){return e?Array.isArray(e)||e instanceof vt?new Mv({layer:this,items:e}):e:null}readSource(e,r){const i=Lfe.fromJSON(r.featureSet);return new Mv({layer:this,items:(i==null?void 0:i.features)??[]})}readTemplates(e,r){const i=r.editFieldsInfo,n=i&&i.creatorField,s=i&&i.editorField;return e=e&&e.map(o=>Tq.fromJSON(o)),this._fixTemplates(e,n),this._fixTemplates(e,s),e}readTitle(e,r){var s;const i=((s=r.layerDefinition)==null?void 0:s.name)??r.name,n=r.title||r.layerDefinition&&r.layerDefinition.title;if(i){const o=this.portalItem&&this.portalItem.title;if(this.sublayerTitleMode==="item-title")return this.url?HDe(this.url,i):i;let a=i;if(!a&&this.url){const l=$E(this.url);l!=null&&(a=l.title)}return a?(this.sublayerTitleMode==="item-title-and-service-name"&&o&&o!==a&&(a=o+" - "+a),F7(a)):void 0}if(this.sublayerTitleMode==="item-title"&&n)return n}readTitleFromWebMap(e,r){return r.title||r.layerDefinition&&r.layerDefinition.name}readTypeIdField(e,r){let i=(r=r.layerDefinition||r).typeIdField;if(i&&r.fields){i=i.toLowerCase();const n=r.fields.find(s=>s.name.toLowerCase()===i);n&&(i=n.name)}return i}readTypes(e,r){e=(r=r.layerDefinition||r).types;const i=r.editFieldsInfo,n=i&&i.creatorField,s=i&&i.editorField;return e&&e.map(o=>(o=zfe.fromJSON(o),this._fixTemplates(o.templates,n),this._fixTemplates(o.templates,s),o))}readVisible(e,r){return r.layerDefinition&&r.layerDefinition.defaultVisibility!=null?!!r.layerDefinition.defaultVisibility:r.visibility!=null?!!r.visibility:void 0}async addAttachment(e,r){return cQt(this,e,r,Uc)}async updateAttachment(e,r,i){return uQt(this,e,r,i,Uc)}async applyEdits(e,r){return dQt(this,e,r)}async uploadAssets(e,r){return hQt(this,e,r)}on(e,r){return super.on(e,r)}createPopupTemplate(e){return Bfe(this,e)}async createGraphicsSource(e){if(this._hasMemorySource()&&this.source)return this.source.load({signal:e});const{default:r}=await ace(le(()=>import("./FeatureLayerSource-aff0f41f.js"),["assets/FeatureLayerSource-aff0f41f.js","assets/MeshGeoreferencedRelativeVertexSpace-f0de074a.js","assets/External-37176b11.js","assets/editingSupport-47fc3fce.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js","assets/QueryTask-3d099f7e.js","assets/executeForIds-f24cf742.js","assets/query-faa7dd63.js","assets/pbfQueryUtils-abc2886c.js","assets/pbf-816f3f11.js","assets/executeQueryJSON-fe09b3cb.js","assets/executeQueryPBF-bb328076.js"]),e);return new r({layer:this}).load({signal:e})}createQuery(){const e=xQt(this);e.dynamicDataSource=this.dynamicDataSource;const r=this.subtypeCode!=null?`${this.subtypeField} = ${this.subtypeCode}`:null,i=NKt(this.definitionExpression,r);return e.where=i||"1=1",e}async deleteAttachments(e,r){return pQt(this,e,r,Uc)}async fetchRecomputedExtents(e){return fQt(this,e,Uc)}getFeatureType(e){const{typeIdField:r,types:i}=this;if(!r||!e)return null;const n=e.attributes?e.attributes[r]:void 0;if(n==null)return null;let s=null;return i==null||i.some(o=>{const{id:a}=o;return a!=null&&(a.toString()===n.toString()&&(s=o),!!s)}),s}getFieldDomain(e,r){const i=r==null?void 0:r.feature,n=this.getFeatureType(i);if(n){const s=n.domains&&n.domains[e];if(s&&s.type!=="inherited")return s}return this._getLayerDomain(e)}getField(e){return this.fieldsIndex.get(e)}async queryAttachments(e,r){return mQt(this,e,r,Uc)}async queryFeatures(e,r){const i=await this.load(),n=await i.source.queryFeatures(uh.from(e)??i.createQuery(),r);if(n!=null&&n.features)for(const s of n.features)s.layer=s.sourceLayer=i;return n}async queryObjectIds(e,r){return gQt(this,e,r,Uc)}async queryFeatureCount(e,r){return yQt(this,e,r,Uc)}async queryExtent(e,r){return vQt(this,e,r,Uc)}async queryRelatedFeatures(e,r){return _Qt(this,e,r,Uc)}async queryRelatedFeaturesCount(e,r){return bQt(this,e,r,Uc)}async queryTopFeatures(e,r){var o;const{source:i,capabilities:n}=await this.load();if(!i.queryTopFeatures||!((o=n==null?void 0:n.query)!=null&&o.supportsTopFeaturesQuery))throw new H(Uc,"Layer source does not support queryTopFeatures capability");const s=await i.queryTopFeatures(DU.from(e),r);if(s!=null&&s.features)for(const a of s.features)a.layer=a.sourceLayer=this;return s}async queryTopObjectIds(e,r){const{source:i,capabilities:n}=await this.load();if(!i.queryTopObjectIds||!(n!=null&&n.query.supportsTopFeaturesQuery))throw new H(Uc,"Layer source does not support queryTopObjectIds capability");return i.queryTopObjectIds(DU.from(e),r)}async queryTopFeaturesExtent(e,r){var s;const{source:i,capabilities:n}=await this.load();if(!i.queryTopExtents||!((s=n==null?void 0:n.query)!=null&&s.supportsTopFeaturesQuery))throw new H(Uc,"Layer source does not support queryTopExtents capability");return i.queryTopExtents(DU.from(e),r)}async queryTopFeatureCount(e,r){var s;const{source:i,capabilities:n}=await this.load();if(!i.queryTopCount||!((s=n==null?void 0:n.query)!=null&&s.supportsTopFeaturesQuery))throw new H(Uc,"Layer source does not support queryFeatureCount capability");return i.queryTopCount(DU.from(e),r)}read(e,r){const i=e.featureCollection;if(i){const n=i.layers;n&&n.length===1&&(super.read(n[0],r),i.showLegend!=null&&super.read({showLegend:i.showLegend},r))}super.read(e,r),r&&r.origin==="service"&&(this.revert(["objectIdField","fields","timeInfo"],"service"),this.spatialReference||this.revert(["spatialReference"],"service"))}write(e,r){r={...r,origin:(r==null?void 0:r.origin)??void 0,writeLayerSchema:(r==null?void 0:r.writeLayerSchema)??this._hasMemorySource()};const{origin:i,layerContainerType:n,messages:s}=r;if(this.dynamicDataSource)return s==null||s.push(NU(this,"using a dynamic data source cannot be written to web scenes, web maps and feature service items")),null;if(this.isTable){if(i==="web-scene"||i==="web-map"&&n!=="tables")return s==null||s.push(NU(this,"using a table source cannot be written to web scenes and web maps")),null;if(this._hasMemorySource())return s==null||s.push(NU(this,"using an in-memory table source cannot be written to web scenes and web maps")),null}else if(this.loaded&&i==="web-map"&&n==="tables")return s==null||s.push(NU(this,"using a non-table source cannot be written to tables in web maps")),null;return super.write(e,r)}clone(){if(this._hasMemorySource())throw new H(Uc,`FeatureLayer (title: ${this.title}, id: ${this.id}) created using in-memory source cannot be cloned`);return super.clone()}serviceSupportsSpatialReference(e){var r;return!!this.loaded&&(((r=this.source)==null?void 0:r.type)==="memory"||Ter(this,e))}async save(e){const{save:r}=await le(()=>import("./featureLayerUtils-c49ab120.js"),["assets/featureLayerUtils-c49ab120.js","assets/fetchService-7b5f3ba7.js","assets/jsonContext-03b7f0b9.js"]);return r(this,e)}async saveAs(e,r){const{saveAs:i}=await le(()=>import("./featureLayerUtils-c49ab120.js"),["assets/featureLayerUtils-c49ab120.js","assets/fetchService-7b5f3ba7.js","assets/jsonContext-03b7f0b9.js"]);return i(this,e,r)}_readEditingEnabled(e,r,i){var s;let n=(s=e.layerDefinition)==null?void 0:s.capabilities;return n?this._hasEditingCapability(n):(n=e.capabilities,r&&(i==null?void 0:i.origin)==="web-map"&&!this._hasMemorySource()&&n?this._hasEditingCapability(n):void 0)}_hasEditingCapability(e){return e.toLowerCase().split(",").map(r=>r.trim()).includes("editing")}_writeEditingEnabled(e,r,i,n){var s,o;if(!e){const a=(o=(s=this.capabilities)==null?void 0:s.operations)!=null&&o.supportsSync?"Query,Sync":"Query";Rc("layerDefinition.capabilities",a,r),i&&!(n!=null&&n.writeLayerSchema)&&(r.capabilities=a)}}_getLayerDomain(e){const r=this.fieldsIndex.get(e);return r?r.domain:null}_fetchFirstLayerId(e){return ti(this.url,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:e}).then(r=>{const i=r.data;if(i)return Array.isArray(i.layers)&&i.layers.length>0?i.layers[0].id:Array.isArray(i.tables)&&i.tables.length>0?i.tables[0].id:void 0})}async initLayerProperties(e){var r;return this._set("source",e),e.sourceJSON&&(this.sourceJSON=e.sourceJSON,this.read(e.sourceJSON,{origin:"service",portalItem:this.portalItem,portal:(r=this.portalItem)==null?void 0:r.portal,url:this.parsedUrl})),this._verifySource(),this._verifyFields(),CP(this.renderer,this.fieldsIndex),vue(this.timeInfo,this.fieldsIndex),Yqe(this,{origin:"service"})}async hasDataChanged(){return wQt(this)}async fetchPublishingStatus(){const e=this.source;return e!=null&&e.fetchPublishingStatus?e.fetchPublishingStatus():"unavailable"}_verifyFields(){var r,i;const e=((r=this.parsedUrl)==null?void 0:r.path)??"undefined";this.objectIdField||console.log("FeatureLayer: 'objectIdField' property is not defined (url: "+e+")"),this.isTable||this._hasMemorySource()||e.search(/\/FeatureServer\//i)!==-1||(i=this.fields)!=null&&i.some(n=>n.type==="geometry")||console.log("FeatureLayer: unable to find field of type 'geometry' in the layer 'fields' list. If you are using a map service layer, features will not have geometry (url: "+e+")")}_fixTemplates(e,r){e&&e.forEach(i=>{const n=i.prototype&&i.prototype.attributes;n&&r&&delete n[r]})}_verifySource(){if(this._hasMemorySource()){if(this.url)throw new H("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new H("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")}_initMemorySource(e){e.forEach(r=>{r.layer=this,r.sourceLayer=this}),this._handles.add([e.on("after-add",r=>{r.item.layer=this,r.item.sourceLayer=this}),e.on("after-remove",r=>{r.item.layer=null,r.item.sourceLayer=null})],"fl-source")}_resetMemorySource(e){e.forEach(r=>{r.layer=null,r.sourceLayer=null}),this._handles.remove("fl-source")}_hasMemorySource(){return!(this.url||!this.source)}};d([ke("service","capabilities")],Ht.prototype,"readCapabilities",null),d([p({json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],Ht.prototype,"charts",void 0),d([p({readOnly:!0})],Ht.prototype,"createQueryVersion",null),d([p({json:{read:{source:"layerDefinition.copyrightText"}}})],Ht.prototype,"copyright",void 0),d([p({json:{read:{source:"layerDefinition.displayField"}}})],Ht.prototype,"displayField",void 0),d([p({types:Um,readOnly:!0})],Ht.prototype,"defaultSymbol",void 0),d([p({type:Sm})],Ht.prototype,"dynamicDataSource",void 0),d([p({type:Boolean})],Ht.prototype,"editingEnabled",null),d([ke(["portal-item","web-scene"],"editingEnabled",["layerDefinition.capabilities"])],Ht.prototype,"readEditingEnabled",null),d([ke("web-map","editingEnabled",["capabilities","layerDefinition.capabilities"])],Ht.prototype,"readEditingEnabledFromWebMap",null),d([tt(["portal-item","web-scene"],"editingEnabled",{"layerDefinition.capabilities":{type:String}})],Ht.prototype,"writeEditingEnabled",null),d([tt("web-map","editingEnabled",{capabilities:{type:String},"layerDefinition.capabilities":{type:String}})],Ht.prototype,"writeEditingEnabledToWebMap",null),d([p({readOnly:!0})],Ht.prototype,"effectiveEditingEnabled",null),d([p({...$J.fields,json:{read:{source:"layerDefinition.fields"},origins:{service:{name:"fields"},"web-map":{write:{target:"layerDefinition.fields",overridePolicy:IJ}}}}})],Ht.prototype,"fields",void 0),d([p($J.fieldsIndex)],Ht.prototype,"fieldsIndex",void 0),d([p({type:XKt,json:{name:"formInfo",write:!0,origins:{"web-scene":{read:!1,write:!1}}}})],Ht.prototype,"formTemplate",void 0),d([p({json:{read:{source:"layerDefinition.extent"}}})],Ht.prototype,"fullExtent",void 0),d([p({json:{origins:{"web-map":{write:{target:"layerDefinition.geometryType",overridePolicy:IJ,writer(t,e,r){const i=t?_oe.toJSON(t):null;i&&Rc(r,i,e)}}}},read:{source:"layerDefinition.geometryType",reader:_oe.read}}})],Ht.prototype,"geometryType",void 0),d([p({json:{read:{source:"layerDefinition.hasM"}}})],Ht.prototype,"hasM",void 0),d([p({json:{read:{source:"layerDefinition.hasZ"}}})],Ht.prototype,"hasZ",void 0),d([p(Eue)],Ht.prototype,"id",void 0),d([p({readOnly:!0,json:{origins:{service:{read:!0}},read:!1}})],Ht.prototype,"infoFor3D",void 0),d([p({json:{origins:{"web-map":{write:{target:"layerDefinition.type"}}}}})],Ht.prototype,"isTable",void 0),d([ke("service","isTable",["type","geometryType"]),ke("isTable",["layerDefinition.type","layerDefinition.geometryType"])],Ht.prototype,"readIsTable",null),d([tt("web-map","isTable")],Ht.prototype,"writeIsTable",null),d([p(sF)],Ht.prototype,"labelsVisible",void 0),d([p({type:[iM],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",reader:y4},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:y4},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],Ht.prototype,"labelingInfo",void 0),d([p((()=>{const t=ie(ovt);return t.json.origins["portal-item"]={write:{target:"layerDefinition.drawingInfo.transparency",writer(e,r,i){Rc(i,X4(e),r)}}},t})())],Ht.prototype,"opacity",void 0),d([p(Sue)],Ht.prototype,"legendEnabled",void 0),d([p({type:["show","hide"],json:(()=>{const t=ie(wNe.json);return t.origins["portal-item"]={read:!1,write:!1},t})()})],Ht.prototype,"listMode",void 0),d([ke("globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],Ht.prototype,"readGlobalIdField",null),d([p({json:{origins:{"web-map":{write:{target:"layerDefinition.objectIdField",overridePolicy:IJ}}}}})],Ht.prototype,"objectIdField",void 0),d([ke("objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],Ht.prototype,"readObjectIdField",null),d([p({value:"ArcGISFeatureLayer",type:["ArcGISFeatureLayer"]})],Ht.prototype,"operationalLayerType",void 0),d([p($J.outFields)],Ht.prototype,"outFields",void 0),d([p({readOnly:!0})],Ht.prototype,"parsedUrl",null),d([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],Ht.prototype,"path",void 0),d([p(nF)],Ht.prototype,"popupEnabled",void 0),d([p({type:LE,json:{name:"popupInfo",write:!0}})],Ht.prototype,"popupTemplate",void 0),d([p({readOnly:!0})],Ht.prototype,"defaultPopupTemplate",null),d([p({types:JF,json:{origins:{service:{write:{target:"drawingInfo.renderer",enabled:!1}},"web-scene":{types:Mfe,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}},write:{target:"layerDefinition.drawingInfo.renderer",overridePolicy:(t,e,r)=>({ignoreOrigin:r==null?void 0:r.writeLayerSchema})}}})],Ht.prototype,"renderer",null),d([ke("service","renderer",["drawingInfo.renderer","defaultSymbol"]),ke("renderer",["layerDefinition.drawingInfo.renderer","layerDefinition.defaultSymbol"])],Ht.prototype,"readRenderer",null),d([p((()=>{const t=ie(wue);return t.json.origins["portal-item"]={read:!1,write:!1},t})())],Ht.prototype,"screenSizePerspectiveEnabled",void 0),d([p({clonable:!1})],Ht.prototype,"source",null),d([ur("source")],Ht.prototype,"castSource",null),d([ke("portal-item","source",["featureSet"]),ke("web-map","source",["featureSet"])],Ht.prototype,"readSource",null),d([p({json:{read:{source:"layerDefinition.extent.spatialReference"}}})],Ht.prototype,"spatialReference",void 0),d([p({type:Number})],Ht.prototype,"subtypeCode",void 0),d([p({type:[Tq]})],Ht.prototype,"templates",void 0),d([ke("templates",["editFieldsInfo","creatorField","editorField","templates"])],Ht.prototype,"readTemplates",null),d([p({type:Wqe})],Ht.prototype,"timeInfo",void 0),d([p()],Ht.prototype,"title",void 0),d([ke("service","title",["name"]),ke("portal-item","title",["layerDefinition.title","layerDefinition.name","title"])],Ht.prototype,"readTitle",null),d([ke("web-map","title",["layerDefinition.name","title"])],Ht.prototype,"readTitleFromWebMap",null),d([p({type:String})],Ht.prototype,"sublayerTitleMode",void 0),d([p({json:{read:!1}})],Ht.prototype,"type",void 0),d([p({type:String})],Ht.prototype,"typeIdField",void 0),d([ke("service","typeIdField"),ke("typeIdField",["layerDefinition.typeIdField"])],Ht.prototype,"readTypeIdField",null),d([p({type:[zfe]})],Ht.prototype,"types",void 0),d([ke("service","types",["types"]),ke("types",["layerDefinition.types"])],Ht.prototype,"readTypes",null),d([p({type:Boolean,json:{origins:{"portal-item":{write:{target:"layerDefinition.defaultVisibility"}}}}})],Ht.prototype,"visible",void 0),d([ke("portal-item","visible",["visibility","layerDefinition.defaultVisibility"])],Ht.prototype,"readVisible",null),Ht=d([I(Zqe)],Ht);const Poe=Ht,LOr=Object.freeze(Object.defineProperty({__proto__:null,default:Poe},Symbol.toStringTag,{value:"Module"}));let Der=class{constructor(e,r,i,n){var o;this._parsedUrl=e,this._portalItem=r,this._apiKey=i,this.signal=n,this._rootDocument=null;const s=(o=this._parsedUrl)==null?void 0:o.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);s&&(this._urlParts={root:s[1],layerId:parseInt(s[2],10)})}async fetch(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();if(e==null)return this._loadFromUrl();const r=await this._findAndLoadRelatedPortalItem(e);return r==null?null:this._loadFeatureLayerFromPortalItem(r)}async fetchPortalItem(){if(!this._urlParts)return null;const e=this._portalItem??await this._portalItemFromServiceItemId();return e==null?null:this._findAndLoadRelatedPortalItem(e)}async _fetchRootDocument(){if(this._rootDocument!=null)return this._rootDocument;if(this._urlParts==null)return this._rootDocument={},{};const e={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},r=`${this._urlParts.root}/SceneServer`;try{const i=await ti(r,e);this._rootDocument=i.data}catch{this._rootDocument={}}return this._rootDocument}async _fetchServiceOwningPortalUrl(){var n;const e=(n=this._parsedUrl)==null?void 0:n.path,r=e?Hr==null?void 0:Hr.findServerInfo(e):null;if(r!=null&&r.owningSystemUrl)return r.owningSystemUrl;const i=e?e.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const s=(await ti(i,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(s)return s}catch(s){Oa(s)}return null}async _findAndLoadRelatedPortalItem(e){try{return(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(r=>r.type==="Feature Service")||null}catch(r){return Oa(r),null}}async _loadFeatureLayerFromPortalItem(e){await e.load({signal:this.signal});const r=await this._findMatchingAssociatedSublayerUrl(e.url??"");return new Poe({url:r,portalItem:e}).load({signal:this.signal})}async _loadFromUrl(){var r;const e=await this._findMatchingAssociatedSublayerUrl(`${(r=this._urlParts)==null?void 0:r.root}/FeatureServer`);return new Poe({url:e}).load({signal:this.signal})}async _findMatchingAssociatedSublayerUrl(e){var h;const r=e.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),i=(h=this._urlParts)==null?void 0:h.layerId,n=this._fetchRootDocument(),s=f=>{const m={query:{f:"json"},responseType:"json",authMode:f,signal:this.signal};return ti(r,m)},o=s("anonymous").catch(()=>s("no-prompt")),[a,l]=await Promise.all([o,n]),c=l&&l.layers,u=a.data&&a.data.layers;if(!Array.isArray(u))throw new Error("expected layers array");if(Array.isArray(c)){for(let f=0;f<Math.min(c.length,u.length);f++)if(c[f].id===i)return`${r}/${u[f].id}`}else if(i!=null&&i<u.length)return`${r}/${u[i].id}`;throw new Error("could not find matching associated sublayer")}async _portalItemFromServiceItemId(){const e=(await this._fetchRootDocument()).serviceItemId;if(!e)return null;const r=new Qv({id:e,apiKey:this._apiKey}),i=await this._fetchServiceOwningPortalUrl();i!=null&&(r.portal=new Ns({url:i}));try{return r.load({signal:this.signal})}catch(n){return Oa(n),null}}},ZT=class extends me{constructor(){super(...arguments),this.nodesPerPage=null,this.rootIndex=0,this.lodSelectionMetricType=null}};d([p({type:Number})],ZT.prototype,"nodesPerPage",void 0),d([p({type:Number})],ZT.prototype,"rootIndex",void 0),d([p({type:String})],ZT.prototype,"lodSelectionMetricType",void 0),ZT=d([I("esri.layer.support.I3SNodePageDefinition")],ZT);let Zv=class extends me{constructor(){super(...arguments),this.factor=1}};d([p({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],Zv.prototype,"id",void 0),d([p({type:Number})],Zv.prototype,"factor",void 0),Zv=d([I("esri.layer.support.I3SMaterialTexture")],Zv);let Ab=class extends me{constructor(){super(...arguments),this.baseColorFactor=[1,1,1,1],this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.metallicFactor=1,this.roughnessFactor=1}};d([p({type:[Number]})],Ab.prototype,"baseColorFactor",void 0),d([p({type:Zv})],Ab.prototype,"baseColorTexture",void 0),d([p({type:Zv})],Ab.prototype,"metallicRoughnessTexture",void 0),d([p({type:Number})],Ab.prototype,"metallicFactor",void 0),d([p({type:Number})],Ab.prototype,"roughnessFactor",void 0),Ab=d([I("esri.layer.support.I3SMaterialPBRMetallicRoughness")],Ab);let hp=class extends me{constructor(){super(...arguments),this.alphaMode="opaque",this.alphaCutoff=.25,this.doubleSided=!1,this.cullFace="none",this.normalTexture=null,this.occlusionTexture=null,this.emissiveTexture=null,this.emissiveFactor=null,this.pbrMetallicRoughness=null}};d([Rt({opaque:"opaque",mask:"mask",blend:"blend"})],hp.prototype,"alphaMode",void 0),d([p({type:Number})],hp.prototype,"alphaCutoff",void 0),d([p({type:Boolean})],hp.prototype,"doubleSided",void 0),d([Rt({none:"none",back:"back",front:"front"})],hp.prototype,"cullFace",void 0),d([p({type:Zv})],hp.prototype,"normalTexture",void 0),d([p({type:Zv})],hp.prototype,"occlusionTexture",void 0),d([p({type:Zv})],hp.prototype,"emissiveTexture",void 0),d([p({type:[Number]})],hp.prototype,"emissiveFactor",void 0),d([p({type:Ab})],hp.prototype,"pbrMetallicRoughness",void 0),hp=d([I("esri.layer.support.I3SMaterialDefinition")],hp);let TL=class extends me{};d([p({type:String,json:{read:{source:["name","index"],reader:(t,e)=>t??`${e.index}`}}})],TL.prototype,"name",void 0),d([Rt({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],TL.prototype,"format",void 0),TL=d([I("esri.layer.support.I3STextureFormat")],TL);let EL=class extends me{constructor(){super(...arguments),this.atlas=!1}};d([p({type:[TL]})],EL.prototype,"formats",void 0),d([p({type:Boolean})],EL.prototype,"atlas",void 0),EL=d([I("esri.layer.support.I3STextureSetDefinition")],EL);let Tm=class extends me{};d([Rt({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],Tm.prototype,"type",void 0),d([p({type:Number})],Tm.prototype,"component",void 0),Tm=d([I("esri.layer.support.I3SGeometryAttribute")],Tm);let CL=class extends me{};d([Rt({draco:"draco"})],CL.prototype,"encoding",void 0),d([p({type:[String]})],CL.prototype,"attributes",void 0),CL=d([I("esri.layer.support.I3SGeometryCompressedAttributes")],CL);let Vf=class extends me{constructor(){super(...arguments),this.offset=0}};d([p({type:Number})],Vf.prototype,"offset",void 0),d([p({type:Tm})],Vf.prototype,"position",void 0),d([p({type:Tm})],Vf.prototype,"normal",void 0),d([p({type:Tm})],Vf.prototype,"uv0",void 0),d([p({type:Tm})],Vf.prototype,"color",void 0),d([p({type:Tm})],Vf.prototype,"uvRegion",void 0),d([p({type:Tm})],Vf.prototype,"featureId",void 0),d([p({type:Tm})],Vf.prototype,"faceRange",void 0),d([p({type:CL})],Vf.prototype,"compressedAttributes",void 0),Vf=d([I("esri.layer.support.I3SGeometryBuffer")],Vf);let RL=class extends me{};d([Rt({triangle:"triangle"})],RL.prototype,"topology",void 0),d([p()],RL.prototype,"geometryBuffers",void 0),RL=d([I("esri.layer.support.I3SGeometryDefinition")],RL);let Pb=class extends me{constructor(){super(...arguments),this.name=null,this.field=null,this.currentRangeExtent=null,this.fullRangeExtent=null,this.type="rangeInfo"}};d([p({type:String,json:{read:!0,write:!0}})],Pb.prototype,"name",void 0),d([p({type:String,json:{read:!0,write:!0}})],Pb.prototype,"field",void 0),d([p({type:[Number],json:{read:!0,write:!0}})],Pb.prototype,"currentRangeExtent",void 0),d([p({type:[Number],json:{read:!0,write:!0}})],Pb.prototype,"fullRangeExtent",void 0),d([p({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],Pb.prototype,"type",void 0),Pb=d([I("esri.layers.support.RangeInfo")],Pb);function Moe(t){return jfe[Ner(t)]||ker}function Ner(t){return t instanceof Blob?t.type:Fer(t.url)}function Fer(t){const e=ice(t);return $oe[e]||Jqe}const jfe={},Jqe="text/plain",ker=jfe[Jqe],$oe={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const t in $oe)jfe[$oe[t]]=t;function Uer(t){const e=(t==null?void 0:t.origins)??[void 0];return(r,i)=>{const n=zer(t,r,i);for(const s of e){const o=uce(r,s,i);for(const a in n)o[a]=n[a]}}}function zer(t,e,r){if((t==null?void 0:t.type)==="resource")return Ver(t,e,r);switch((t==null?void 0:t.type)??"other"){case"other":return{read:!0,write:!0};case"url":{const{read:i,write:n}=hyt;return{read:i,write:n}}}}function Ver(t,e,r){const i=U4(e,r);return{type:String,read:(n,s,o)=>{const a=N7(n,s,o);return i.type===String?a:typeof i.type=="function"?new i.type({url:a}):void 0},write:{writer(n,s,o,a){if(!a||!a.resources)return typeof n=="string"?void(s[o]=I_(n,a)):void(s[o]=n.write({},a));const l=Her(n),c=I_(l,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},SP.NO),u=i.type!==String&&(!JLe(this)||a&&a.origin&&this.originIdOf(r)>Gv(a.origin)),h={object:this,propertyName:r,value:n,targetUrl:c,dest:s,targetPropertyName:o,context:a,params:t};a&&a.portalItem&&c&&!fd(c)?u?Ber(h):jer(h):a&&a.portalItem&&(c==null||UDe(c)!=null||qw(c)||u)?Kqe(h):s[o]=c}}}}function Kqe(t){const{targetUrl:e,params:r,value:i,context:n,dest:s,targetPropertyName:o}=t;if(!n.portalItem)return;const a=zDe(e),l=(a==null?void 0:a.filename)??k7(),c=(r==null?void 0:r.prefix)??(a==null?void 0:a.prefix),u=eWe(i,e,n),h=bd(c,l),f=`${h}.${Moe(u)}`,m=n.portalItem.resourceFromPath(f);qw(e)&&n.resources&&n.resources.pendingOperations.push(Ger(e).then(y=>{m.path=`${h}.${Moe(y)}`,s[o]=m.itemRelativeUrl}).catch(()=>{}));const g=(r==null?void 0:r.compress)??!1;n.resources&&Qqe({...t,resource:m,content:u,compress:g,updates:n.resources.toAdd}),s[o]=m.itemRelativeUrl}function Ber(t){const{context:e,targetUrl:r,params:i,value:n,dest:s,targetPropertyName:o}=t;if(!e.portalItem)return;const a=e.portalItem.resourceFromPath(r),l=eWe(n,r,e),c=Moe(l),u=ice(a.path),h=(i==null?void 0:i.compress)??!1;c===u?(e.resources&&Qqe({...t,resource:a,content:l,compress:h,updates:e.resources.toUpdate}),s[o]=r):Kqe(t)}function jer({context:t,targetUrl:e,dest:r,targetPropertyName:i}){t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(e),compress:!1}),r[i]=e)}function Qqe({object:t,propertyName:e,updates:r,resource:i,content:n,compress:s}){r.push({resource:i,content:n,compress:s,finish:o=>{qer(t,e,o)}})}function eWe(t,e,r){return typeof t=="string"?{url:e}:new Blob([JSON.stringify(t.toJSON(r))],{type:"application/json"})}async function Ger(t){const e=(await le(()=>Promise.resolve().then(()=>VIe),void 0)).default,{data:r}=await e(t,{responseType:"blob"});return r}function Her(t){return t==null?null:typeof t=="string"?t:t.url}function qer(t,e,r){typeof t[e]=="string"?t[e]=r.url:t[e].url=r.url}var y9;let Ioe=y9=class extends C3(vt.ofType(Tc)){constructor(t){super(t)}clone(){return new y9(this.items.map(t=>t.clone()))}write(t,e){return this.toJSON(e)}toJSON(t){var r;const e=(r=t==null?void 0:t.layer)==null?void 0:r.spatialReference;return e?this.toArray().map(i=>{if(!e.equals(i.spatialReference)){if(!lf(i.spatialReference,e))return t&&t.messages&&t.messages.push(new nf("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),null;const s=new Tc;wDe(i,s,e),i=s}const n=i.toJSON(t);return delete n.spatialReference,n}).filter(i=>i!=null):(t!=null&&t.messages&&t.messages.push(new nf("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:t.layer.spatialReference,context:t})),this.toArray().map(i=>i.toJSON(t)))}static fromJSON(t,e){const r=new y9;return t.forEach(i=>r.add(Tc.fromJSON(i,e))),r}};Ioe=y9=d([I("esri.layers.support.PolygonCollection")],Ioe);const v9=Ioe;var Loe;let SO=Loe=class extends me{constructor(t){super(t),this.spatialRelationship="disjoint",this.geometries=new v9,this._geometriesSource=null,this._handles=new Ri}initialize(){this._handles.add(da(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,li))}destroy(){this._handles.destroy()}readGeometries(t,e,r){Array.isArray(t)?this.geometries=v9.fromJSON(t,r):this._geometriesSource={url:$_(t,r),context:r}}async loadGeometries(t,e){if(this._geometriesSource==null)return;const{url:r,context:i}=this._geometriesSource,n=await ti(r,{responseType:"json",signal:e==null?void 0:e.signal}),s=t.toJSON(),o=n.data.map(a=>({...a,spatialReference:s}));this.geometries=v9.fromJSON(o,i),this._geometriesSource=null}clone(){const t=new Loe({geometries:ie(this.geometries),spatialRelationship:this.spatialRelationship});return t._geometriesSource=this._geometriesSource,t}};d([p({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],SO.prototype,"spatialRelationship",void 0),d([p({type:v9,nonNullable:!0,json:{write:!0}}),Uer({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],SO.prototype,"geometries",void 0),d([ke(["web-scene","portal-item"],"geometries")],SO.prototype,"readGeometries",null),SO=Loe=d([I("esri.layers.support.SceneFilter")],SO);const Wer=SO,ys=!0,d2={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};function Gfe(t,e,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(t,r+d2.identifierOffset,d2.identifierLength)),version:e.getUint16(r+d2.versionOffset,ys),checksum:e.getUint32(r+d2.checksumOffset,ys)}}const Nu={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};function Xer(t,e){return{sizeLo:t.getUint32(e+Nu.sizeLo,ys),sizeHi:t.getUint32(e+Nu.sizeHi,ys),minX:t.getFloat64(e+Nu.minX,ys),minY:t.getFloat64(e+Nu.minY,ys),minZ:t.getFloat64(e+Nu.minZ,ys),maxX:t.getFloat64(e+Nu.maxX,ys),maxY:t.getFloat64(e+Nu.maxY,ys),maxZ:t.getFloat64(e+Nu.maxZ,ys),errorX:t.getFloat64(e+Nu.errorX,ys),errorY:t.getFloat64(e+Nu.errorY,ys),errorZ:t.getFloat64(e+Nu.errorZ,ys),count:t.getUint32(e+Nu.count,ys),reserved:t.getUint32(e+Nu.reserved,ys)}}function WOr(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:n}=Gfe(t,e,r);if(r+=d2.byteCount,i!=="LEPCC     ")throw new H("lepcc-decode-error","Bad identifier");if(n>1)throw new H("lepcc-decode-error","Unknown version");const s=Xer(e,r);if(r+=Nu.byteCount,s.sizeHi*2**32+s.sizeLo!==t.byteLength)throw new H("lepcc-decode-error","Bad size");const o=new Float64Array(3*s.count),a=[],l=[],c=[],u=[];if(r=FU(t,r,a),r=FU(t,r,l),r=FU(t,r,c),r=FU(t,r,u),r!==t.byteLength)throw new H("lepcc-decode-error","Bad length");let h=0,f=0;for(let m=0;m<a.length;m++){f+=a[m];let g=0;for(let y=0;y<l[m];y++){g+=c[h];const _=u[h];o[3*h]=Math.min(s.maxX,s.minX+2*s.errorX*g),o[3*h+1]=Math.min(s.maxY,s.minY+2*s.errorY*f),o[3*h+2]=Math.min(s.maxZ,s.minZ+2*s.errorZ*_),h++}}return{errorX:s.errorX,errorY:s.errorY,errorZ:s.errorZ,result:o}}function FU(t,e,r){const i=[];e=Doe(t,e,i);const n=[];for(let s=0;s<i.length;s++){n.length=0,e=Doe(t,e,n);for(let o=0;o<n.length;o++)r.push(n[o]+i[s])}return e}function Doe(t,e,r){const i=new DataView(t,e),n=i.getUint8(0),s=31&n,o=!!(32&n),a=(192&n)>>6;let l=0;if(a===0)l=i.getUint32(1,ys),e+=5;else if(a===1)l=i.getUint16(1,ys),e+=3;else{if(a!==2)throw new H("lepcc-decode-error","Bad count type");l=i.getUint8(1),e+=2}if(o)throw new H("lepcc-decode-error","LUT not implemented");const c=Math.ceil(l*s/8),u=new Uint8Array(t,e,c);let h=0,f=0,m=0;const g=-1>>>32-s;for(let y=0;y<l;y++){for(;f<s;)h|=u[m]<<f,f+=8,m+=1;r[y]=h&g,h>>>=s,f-=s,f+s>32&&(h|=u[m-1]>>8-f)}return e+m}const RT={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};function Yer(t,e){return{sizeLo:t.getUint32(e+RT.sizeLo,ys),sizeHi:t.getUint32(e+RT.sizeHi,ys),count:t.getUint32(e+RT.count,ys),colorMapCount:t.getUint16(e+RT.colorMapCount,ys),lookupMethod:t.getUint8(e+RT.lookupMethod),compressionMethod:t.getUint8(e+RT.compressionMethod)}}function Zer(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:n}=Gfe(t,e,r);if(r+=d2.byteCount,i!=="ClusterRGB")throw new H("lepcc-decode-error","Bad identifier");if(n>1)throw new H("lepcc-decode-error","Unknown version");const s=Yer(e,r);if(r+=RT.byteCount,s.sizeHi*2**32+s.sizeLo!==t.byteLength)throw new H("lepcc-decode-error","Bad size");if((s.lookupMethod===2||s.lookupMethod===1)&&s.compressionMethod===0){if(3*s.colorMapCount+s.count+r!==t.byteLength||s.colorMapCount>256)throw new H("lepcc-decode-error","Bad count");const o=new Uint8Array(t,r,3*s.colorMapCount),a=new Uint8Array(t,r+3*s.colorMapCount,s.count),l=new Uint8Array(3*s.count);for(let c=0;c<s.count;c++){const u=a[c];l[3*c]=o[3*u],l[3*c+1]=o[3*u+1],l[3*c+2]=o[3*u+2]}return l}if(s.lookupMethod===0&&s.compressionMethod===0){if(3*s.count+r!==t.byteLength||s.colorMapCount!==0)throw new H("lepcc-decode-error","Bad count");return new Uint8Array(t,r).slice()}if(s.lookupMethod<=2&&s.compressionMethod===1){if(r+3!==t.byteLength||s.colorMapCount!==1)throw new H("lepcc-decode-error","Bad count");const o=e.getUint8(r),a=e.getUint8(r+1),l=e.getUint8(r+2),c=new Uint8Array(3*s.count);for(let u=0;u<s.count;u++)c[3*u]=o,c[3*u+1]=a,c[3*u+2]=l;return c}throw new H("lepcc-decode-error","Bad method "+s.lookupMethod+","+s.compressionMethod)}const OT={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};function Jer(t,e){return{sizeLo:t.getUint32(e+OT.sizeLo,ys),sizeHi:t.getUint32(e+OT.sizeHi,ys),count:t.getUint32(e+OT.count,ys),scaleFactor:t.getUint16(e+OT.scaleFactor,ys),bitsPerPoint:t.getUint8(e+OT.bitsPerPoint),reserved:t.getUint8(e+OT.reserved)}}function Ker(t){const e=new DataView(t,0);let r=0;const{identifier:i,version:n}=Gfe(t,e,r);if(r+=d2.byteCount,i!=="Intensity ")throw new H("lepcc-decode-error","Bad identifier");if(n>1)throw new H("lepcc-decode-error","Unknown version");const s=Jer(e,r);if(r+=OT.byteCount,s.sizeHi*2**32+s.sizeLo!==t.byteLength)throw new H("lepcc-decode-error","Bad size");const o=new Uint16Array(s.count);if(s.bitsPerPoint===8){if(s.count+r!==t.byteLength)throw new H("lepcc-decode-error","Bad size");const a=new Uint8Array(t,r,s.count);for(let l=0;l<s.count;l++)o[l]=a[l]*s.scaleFactor}else if(s.bitsPerPoint===16){if(2*s.count+r!==t.byteLength)throw new H("lepcc-decode-error","Bad size");const a=new Uint16Array(t,r,s.count);for(let l=0;l<s.count;l++)o[l]=a[l]*s.scaleFactor}else{const a=[];if(Doe(t,r,a)!==t.byteLength)throw new H("lepcc-decode-error","Bad size");for(let l=0;l<s.count;l++)o[l]=a[l]*s.scaleFactor}return o}const Noe=re.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");function Qer(t,e,r){let i="",n=0;for(;n<r;){const s=t[e+n];if(s<128)i+=String.fromCharCode(s),n++;else if(s>=192&&s<224){if(n+1>=r)throw new H("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");const o=(31&s)<<6|63&t[e+n+1];i+=String.fromCharCode(o),n+=2}else if(s>=224&&s<240){if(n+2>=r)throw new H("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(15&s)<<12|(63&t[e+n+1])<<6|63&t[e+n+2];i+=String.fromCharCode(o),n+=3}else{if(!(s>=240&&s<248))throw new H("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");{if(n+3>=r)throw new H("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");const o=(7&s)<<18|(63&t[e+n+1])<<12|(63&t[e+n+2])<<6|63&t[e+n+3];if(o>=65536){const a=55296+(o-65536>>10),l=56320+(1023&o);i+=String.fromCharCode(a,l)}else i+=String.fromCharCode(o);n+=4}}}return i}function tWe(t,e){const r={byteOffset:0,byteCount:0,fields:Object.create(null)};let i=0;for(let n=0;n<e.length;n++){const s=e[n],o=s.valueType||s.type,a=ltr[o];r.fields[s.property]=a(t,i),i+=Eq[o].BYTES_PER_ELEMENT}return r.byteCount=i,r}function etr(t,e,r){return rWe(t,e,r).map(i=>{const n=i?Date.parse(i):null;return n&&!Number.isNaN(n)?n:null})}function rWe(t,e,r){const i=[];let n,s,o=0;for(s=0;s<t;s+=1){if(n=e[s],n>0){if(i.push(Qer(r,o,n-1)),r[o+n-1]!==0)throw new H("string-array-error","Invalid string array: missing null termination.")}else i.push(null);o+=n}return i}function pOe(t,e){return new Eq[e.valueType](t,e.byteOffset,e.count*e.valuesPerElement)}function ttr(t,e){return new Uint8Array(t,e.byteOffset,e.byteCount)}function rtr(t,e,r){const i=e.header!=null?tWe(t,e.header):{byteOffset:0,byteCount:0,fields:{count:r}},n={header:i,byteOffset:i.byteCount,byteCount:0,entries:Object.create(null)};let s=i.byteCount;for(let o=0;o<e.ordering.length;o++){const a=e.ordering[o],l=ie(e[a]);if(l.count=i.fields.count??0,l.valueType==="String"){if(l.byteOffset=s,l.byteCount=i.fields[a+"ByteCount"],l.encoding!=="UTF-8")throw new H("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding});if(l.timeEncoding&&l.timeEncoding!=="ECMA_ISO8601")throw new H("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:l.timeEncoding})}else{if(!nWe(l.valueType))throw new H("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});{const c=_9(l.valueType);s+=s%c!=0?c-s%c:0,l.byteOffset=s,l.byteCount=c*l.valuesPerElement*l.count}}s+=l.byteCount??0,n.entries[a]=l}return n.byteCount=s-n.byteOffset,n}function iWe(t,e,r){if(e!==t&&Noe.error(`Invalid ${r} buffer size
 expected: ${t}, actual: ${e})`),e<t)throw new H("buffer-too-small","Binary buffer is too small",{expectedSize:t,actualSize:e})}function itr(t){return{isDraco:!1,isLegacy:!1,color:t.color!=null,normal:t.normal!=null,uv0:t.uv0!=null,uvRegion:t.uvRegion!=null,featureIndex:t.faceRange!=null&&t.featureId!=null}}function XOr(t,e){const r=tWe(t,e&&e.header);let i=r.byteCount;const n={isDraco:!1,header:r,byteOffset:r.byteCount,byteCount:0,vertexAttributes:{}},s=r.fields,o=s.vertexCount!=null?s.vertexCount:s.count;for(const c of e.ordering){if(!e.vertexAttributes[c])continue;const u={...e.vertexAttributes[c],byteOffset:i,count:o},h=otr[c]||"_"+c;n.vertexAttributes[h]=u,i+=_9(u.valueType)*u.valuesPerElement*o}const a=s.faceCount;if(e.faces&&a){n.faces={};for(const c of e.ordering){if(!e.faces[c])continue;const u={...e.faces[c],byteOffset:i,count:a};n.faces[c]=u,i+=_9(u.valueType)*u.valuesPerElement*a}}const l=s.featureCount;if(e.featureAttributes&&e.featureAttributeOrder&&l){n.featureAttributes={};for(const c of e.featureAttributeOrder){if(!e.featureAttributes[c])continue;const u={...e.featureAttributes[c],byteOffset:i,count:l};n.featureAttributes[c]=u,i+=(u.valueType==="UInt64"?8:_9(u.valueType))*u.valuesPerElement*l}}return iWe(i,t.byteLength,"geometry"),n.byteCount=i-n.byteOffset,n}function YOr(t,e){return!t||!t.compressedAttributes||t.compressedAttributes.encoding!=="draco"?t?itr(t):ntr(e):str(t.compressedAttributes.attributes)}function ntr(t){const e={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t.ordering)if(t.vertexAttributes[r])switch(r){case"position":break;case"normal":e.normal=!0;break;case"color":e.color=!0;break;case"uv0":e.uv0=!0;break;case"region":e.uvRegion=!0}return t.featureAttributes&&t.featureAttributeOrder&&(e.featureIndex=!0),e}function str(t){const e={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const r of t)switch(r){case"position":break;case"normal":e.normal=!0;break;case"uv0":e.uv0=!0;break;case"color":e.color=!0;break;case"uv-region":e.uvRegion=!0;break;case"feature-index":e.featureIndex=!0}return e}const otr={position:O.POSITION,normal:O.NORMAL,color:O.COLOR,uv0:O.UV0,region:O.UVREGION};function atr(t,e,r){if(t.encoding==="lepcc-rgb")return Zer(e);if(t.encoding==="lepcc-intensity")return Ker(e);if(t.encoding!=null&&t.encoding!=="")throw new H("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");t["attributeByteCounts "]&&!t.attributeByteCounts&&(Noe.warn("Warning: Trailing space in 'attributeByteCounts '."),t.attributeByteCounts=t["attributeByteCounts "]),t.ordering[0]==="ObjectIds"&&t.hasOwnProperty("objectIds")&&(Noe.warn("Warning: Case error in objectIds"),t.ordering[0]="objectIds");const i=rtr(e,t,r);iWe(i.byteOffset+i.byteCount,e.byteLength,"attribute");const n=i.entries.attributeValues||i.entries.objectIds;if(n){if(n.valueType==="String"){const s=i.entries.attributeByteCounts,o=pOe(e,s),a=ttr(e,n);return n.timeEncoding?etr(s.count,o,a):rWe(s.count,o,a)}return pOe(e,n)}throw new H("bad-attribute-storage-info","Bad attributeStorageInfo specification.")}const Eq={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},ltr={Float32:(t,e)=>new DataView(t,0).getFloat32(e,!0),Float64:(t,e)=>new DataView(t,0).getFloat64(e,!0),UInt8:(t,e)=>new DataView(t,0).getUint8(e),Int8:(t,e)=>new DataView(t,0).getInt8(e),UInt16:(t,e)=>new DataView(t,0).getUint16(e,!0),Int16:(t,e)=>new DataView(t,0).getInt16(e,!0),UInt32:(t,e)=>new DataView(t,0).getUint32(e,!0),Int32:(t,e)=>new DataView(t,0).getInt32(e,!0)};function nWe(t){return Eq.hasOwnProperty(t)}function _9(t){return nWe(t)?Eq[t].BYTES_PER_ELEMENT:0}function ctr(t,e,r,i){const n=utr(t,e,r),s=Me();return lu(r,n,s,i),s}const sWe=1,fOe=5-sWe;function utr(t,e,r){const i=A(),n=t[3],s=2**(Math.ceil(Math.log(n)*Math.LOG2E/fOe)*fOe+sWe);if(r.isGeographic){const l=s/Xr(r).radius*180/Math.PI,c=Math.round(t[1]/l),u=Math.max(-90,Math.min(90,c*l)),h=l/Math.cos((Math.abs(u)-l/2)/180*Math.PI),f=Math.round(t[0]/h)*h;i[0]=f,i[1]=u}else{const l=Math.round(t[0]/s),c=Math.round(t[1]/s);i[0]=l*s,i[1]=c*s}const o=t[2]+e,a=Math.round(o/s);return i[2]=a*s,i}function oWe(t){return t?parseInt(t.substring(t.lastIndexOf("/")+1,t.length),10):void 0}function ZOr(t){var e;if(he("disable-feature:i3s-draco")||!t)return!1;for(const r of t)for(const i of r.geometryBuffers)if(((e=i.compressedAttributes)==null?void 0:e.encoding)==="draco")return!0;return!1}function JOr(t,e,r,i){r.traverse(e,n=>{const s=n.mbs;return(s!=null&&dtr(t,s))!==h2.OUTSIDE&&(i(n),!0)})}function KOr(t,e,r){let i=0,n=0;for(let s=0;s<e.length&&i<t.length;s++)t[i]===e[s]&&(r(s)&&(t[n]=t[i],n++),i++);t.length=n}function QOr(t,e,r){let i=0,n=0;for(;i<r.length;)QMe(t,r[i])>=0===e&&(r[n]=r[i],n++),i++;r.length=n}const $$=lr();function eAr(t,e){if(e.rotationScale[1]===0&&e.rotationScale[2]===0&&e.rotationScale[3]===0&&e.rotationScale[5]===0&&e.rotationScale[6]===0&&e.rotationScale[7]===0)return $$[0]=(t[0]-e.position[0])/e.rotationScale[0],$$[1]=(t[1]-e.position[1])/e.rotationScale[4],$$[2]=(t[2]-e.position[0])/e.rotationScale[0],$$[3]=(t[3]-e.position[1])/e.rotationScale[4],$$}var h2;function dtr(t,e){const r=e[0],i=e[1],n=e[3],s=t[0]-r,o=r-t[2],a=t[1]-i,l=i-t[3],c=Math.max(s,o,0),u=Math.max(a,l,0),h=c*c+u*u;return h>n*n?h2.OUTSIDE:h>0?h2.INTERSECTS_CENTER_OUTSIDE:-Math.max(s,o,a,l)>n?h2.INSIDE:h2.INTERSECTS_CENTER_INSIDE}function htr(t,e,r){const i=[],n=r&&r.missingFields,s=r&&r.originalFields;for(const o of t){const a=o.toLowerCase();let l=!1;for(const c of e)if(a===c.name.toLowerCase()){i.push(c.name),l=!0,s&&s.push(o);break}!l&&n&&n.push(o)}return i}async function tAr(t,e,r,i,n){if(e.length===0)return[];const s=t.attributeStorageInfo;if(t.associatedLayer!=null)try{return await ftr(t.associatedLayer,e,r,i)}catch(o){if(t.associatedLayer.loaded)throw o}if(s){const o=ptr(e,r,n);if(o==null)throw new H("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const a=t.parsedUrl.path;return(await Promise.all(o.map(l=>mtr(a,s,l.node,l.indices,i).then(c=>{for(let u=0;u<l.graphics.length;u++){const h=l.graphics[u],f=c[u];if(h.attributes)for(const m in h.attributes)m in f||(f[m]=h.attributes[m]);h.attributes=f}return l.graphics})))).flat()}throw new H("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available")}function ptr(t,e,r){const i=new Map,n=[],s=r();for(const o of t){const a=o.attributes[e];for(let l=0;l<s.length;l++){const c=s[l],u=c.featureIds.indexOf(a);if(u>=0){let h=i.get(c.node);h||(h={node:c.node,indices:[],graphics:[]},n.push(h),i.set(c.node,h)),h.indices.push(u),h.graphics.push(o);for(let f=l;f>0;f--)s[f]=s[f-1];s[0]=c;break}}}return n}async function ftr(t,e,r,i){e.sort((l,c)=>l.attributes[r]-c.attributes[r]);const n=e.map(l=>l.attributes[r]),s=[],o=htr(i,t.fields,{originalFields:s}),a=await aWe(t,n,o);for(let l=0;l<e.length;l++){const c=e[l],u=a[l],h={};if(c.attributes)for(const f in c.attributes)h[f]=c.attributes[f];for(let f=0;f<s.length;f++)h[s[f]]=u[o[f]];c.attributes=h}return e}function aWe(t,e,r){const i=t.capabilities.query.maxRecordCount;if(i!=null&&e.length>i){const s=Bct(e,i);return Promise.all(s.map(o=>aWe(t,o,r))).then(o=>o.flat())}const n=new uh({objectIds:e,outFields:r,orderByFields:[t.objectIdField]});return t.queryFeatures(n).then(s=>{if(s&&s.features&&s.features.length===e.length)return s.features.map(o=>o.attributes);throw new H("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer")})}function mtr(t,e,r,i,n){return lWe(t,e,r.resources.attributes,i,n)}function lWe(t,e,r,i,n){const s=[];for(const o of e)if(o&&n.includes(o.name)){const a=`${t}/nodes/${r}/attributes/${o.key}/0`;s.push({url:a,storageInfo:o})}return ou(s.map(o=>ti(o.url,{responseType:"array-buffer"}).then(a=>atr(o.storageInfo,a.data)))).then(o=>{const a=[];for(const l of i){const c={};for(let u=0;u<o.length;u++){const h=o[u].value;h!=null&&(c[s[u].storageInfo.name]=vtr(h,l))}a.push(c)}return a})}(function(t){t[t.OUTSIDE=0]="OUTSIDE",t[t.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",t[t.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",t[t.INSIDE=3]="INSIDE"})(h2||(h2={}));const gtr=-32768,ytr=-(2**31);function vtr(t,e){if(!t)return null;const r=t[e];return a7(t)?r===gtr?null:r:c7(t)?r===ytr?null:r:r!=r?null:r}function _tr(t){const e=t.store,r=e.indexCRS||e.geographicCRS,i=r===void 0?e.indexWKT:void 0;if(i){if(!t.spatialReference)throw new H("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new H("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=r?new dt(oWe(r)):t.spatialReference;return n.equals(t.spatialReference)?t.spatialReference:n}function btr(t){const e=t.store,r=e.vertexCRS||e.projectedCRS,i=r===void 0?e.vertexWKT:void 0;if(i){if(!t.spatialReference)throw new H("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});if(i!==t.spatialReference.wkt)throw new H("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{})}const n=r?new dt(oWe(r)):t.spatialReference;return n.equals(t.spatialReference)?t.spatialReference:n}function rAr(t,e){return e==null?"@null":e===d0(e)?"@ECEF":t.equals(e)?"":e.wkid!=null?"@"+e.wkid:null}function Foe(t,e,r){if(!lf(t,e))throw new H("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if(r==="local"&&!wtr(t,e))throw new H("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{})}function iAr(t,e,r){var i,n;if(((i=t.serviceUpdateTimeStamp)==null?void 0:i.lastUpdate)!==((n=e.serviceUpdateTimeStamp)==null?void 0:n.lastUpdate)||!r.isEmpty||rd(t.associatedLayer,s=>s.url)!==rd(e.associatedLayer,s=>s.url))throw new H("layerview:recycle-failed")}function wtr(t,e){return t.equals(e)||t.isWGS84&&e.isWebMercator||t.isWebMercator&&e.isWGS84}function xtr(t,e,r){const i=_tr(t),n=btr(t);Foe(i,e,r),Foe(n,e,r)}function Str(t){return(t.geometryType==null||t.geometryType==="triangles")&&(t.topology==null||t.topology==="PerAttributeArray")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function nAr(t){if(t.store==null||t.store.defaultGeometrySchema==null||!Str(t.store.defaultGeometrySchema))throw new H("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:t.parsedUrl.path})}function sAr(t,e){xtr(t,e.spatialReference,e.viewingMode)}function Ttr(t){return t.geometryType!=null&&t.geometryType==="points"&&(t.topology==null||t.topology==="PerAttributeArray")&&(t.encoding==null||t.encoding===""||t.encoding==="lepcc-xyz")&&t.vertexAttributes!=null&&t.vertexAttributes.position!=null}function oAr(t){if(t.store==null||t.store.defaultGeometrySchema==null||!Ttr(t.store.defaultGeometrySchema))throw new H("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})}function aAr(t,e){Foe(t.spatialReference,e.spatialReference,e.viewingMode)}function Etr(t){return t.type==="simple"||t.type==="class-breaks"||t.type==="unique-value"}function Ctr(t){return t.type==="mesh-3d"}function lAr(t){if(t==null||!Etr(t)||(t.type==="unique-value"||t.type==="class-breaks")&&t.defaultSymbol==null)return!0;const e=t.getSymbols();if(e.length===0)return!0;for(const r of e){if(!Ctr(r)||r.symbolLayers.length===0)return!0;for(const i of r.symbolLayers.items)if(i.type!=="fill"||i.material==null||i.material.color==null||i.material.colorMixMode!=="replace")return!0}return!1}const cAr=Jze({color:[0,0,0,0],opacity:0});class Rtr{constructor(){this.edgeMaterial=null,this.material=null,this.castShadows=!0}}function uAr(t){const e=new Rtr;let r=!1,i=!1;for(const n of t.symbolLayers.items)if(n.type==="fill"&&n.enabled){const s=n.material,o=n.edges;if(s!=null&&!r){const a=s.color,l=$Ve(s.colorMixMode);e.material=a!=null?{color:[a.r/255,a.g/255,a.b/255],alpha:a.a,colorMixMode:l}:{color:[1,1,1],alpha:1,colorMixMode:Ds.Multiply},e.castShadows=n.castShadows,r=!0}o==null||i||(e.edgeMaterial=Zze(o,{}),i=!0)}return e.material||(e.material={color:[1,1,1],alpha:1,colorMixMode:Ds.Multiply}),e}function dAr(t,e){return(0|t)+(0|e)|0}function Otr(t,e,r,i,n=0){i===d0(i)?e.isGeographic?Ltr(t,r,e,n):Itr(t,r,e,n):e.isWGS84&&(i.isWebMercator||wN(i))?Atr(e,t,i,r,n):e.isWebMercator&&wN(i)?$tr(e,t,i,r,n):t===r?(r.center[2]+=n,Ni(r.center,e,0,r.center,i,0,1)):(se(r.center,t.center[0],t.center[1],t.center[2]+n),Ni(r.center,e,0,r.center,i,0,1),yF(r.quaternion,t.quaternion),oe(r.halfSize,t.halfSize))}function Atr(t,e,r,i,n){oe(nw,e.center),nw[2]+=n;const s=d0(r);Ni(nw,t,0,nw,s,0,1),cWe(s,e,nw,r,i)}const b9=new Array(24),Ptr=new ft(b9,3,!0),mOe=A(),nw=A(),Mtr=vn();function $tr(t,e,r,i,n){oe(nw,e.center),nw[2]+=n,cWe(t,e,nw,r,i)}function cWe(t,e,r,i,n){const s=J7(Mtr,e.quaternion);for(let o=0;o<8;++o){for(let a=0;a<3;++a)mOe[a]=e.halfSize[a]*(o&1<<a?-1:1);for(let a=0;a<3;++a){let l=r[a];for(let c=0;c<3;++c)l+=mOe[c]*s[3*c+a];b9[3*o+a]=l}}Ni(b9,t,0,b9,i,0,8),XGe(Ptr,n)}function Itr(t,e,r,i){YGe(t,koe),se(e.center,t.center[0],t.center[1],t.center[2]+i),lu(r,e.center,Ud,d0(r)),se(e.center,Ud[12],Ud[13],Ud[14]);const n=2*Math.sqrt(1+Ud[0]+Ud[5]+Ud[10]);$v[0]=(Ud[6]-Ud[9])/n,$v[1]=(Ud[8]-Ud[2])/n,$v[2]=(Ud[1]-Ud[4])/n,$v[3]=.25*n,cH(e.quaternion,$v,t.quaternion),u0($v,e.quaternion);let s=0,o=0,a=0;for(const l of koe)l[2]+=i,Ni(l,r,0,l,d0(r),0,1),Gi(Qr,l,e.center),md(Qr,Qr,$v),s=Math.max(s,Math.abs(Qr[0])),o=Math.max(o,Math.abs(Qr[1])),a=Math.max(a,Math.abs(Qr[2]));se(e.halfSize,s,o,a)}function Ltr(t,e,r,i){const n=Xr(r),s=1+Math.max(0,i)/(n.radius+t.center[2]);se(e.center,t.center[0],t.center[1],t.center[2]+i),Ni(e.center,r,0,e.center,d0(r),0,1),yF(e.quaternion,t.quaternion),u0($v,t.quaternion),se(Qr,0,0,1),md(Qr,Qr,$v),se(Qr,t.halfSize[0]*Math.abs(Qr[0]),t.halfSize[1]*Math.abs(Qr[1]),t.halfSize[2]*Math.abs(Qr[2])),ce(Qr,Qr,n.inverseFlattening),ge(e.halfSize,t.halfSize,Qr),ce(e.halfSize,e.halfSize,s)}function hAr(t,e,r,i,n,s){if(!s||s.length===0||e==null||!t.mbs)return null;const o=ctr(t.mbs,n,r,e);Uo(UU,o);let a=null;const l=()=>{if(!a)if(a=koe,xd(kU),t.serviceObb!=null){Otr(t.serviceObb,r,gOe,e,n),YGe(gOe,a);for(const m of a)lt(m,m,UU),SA(kU,m)}else{const m=t.mbs;if(!m)return;const g=m[3];Ys(m,r,Qr,e),lt(Qr,Qr,UU),Qr[2]+=n;for(let y=0;y<8;++y){const _=1&y?g:-g,b=2&y?g:-g,w=4&y?g:-g,x=a[y];oe(x,[Qr[0]+_,Qr[1]+b,Qr[2]+w]),SA(kU,x)}}};let c=1/0,u=-1/0;const h=m=>{if(m.type!=="replace")return;const g=m.geometry;if(!(g!=null&&g.hasZ))return;xd(LJ);const y=g.spatialReference||i,_=g.rings.reduce((b,w)=>w.reduce((x,S)=>(Ys(S,y,Qr,e),lt(Qr,Qr,UU),SA(LJ,Qr),Math.min(Qr[2],x)),b),1/0);l(),Z4(kU,LJ)&&(c=Math.min(c,_),u=Math.max(u,_))};if(s.forEach(m=>h(m)),c===1/0)return null;const f=(m,g,y)=>{lt(Qr,y,o),m[g]=Qr[0],m[g+1]=Qr[1],m[g+2]=Qr[2],g+=24,y[2]=c,lt(Qr,y,o),m[g]=Qr[0],m[g+1]=Qr[1],m[g+2]=Qr[2],g+=24,y[2]=u,lt(Qr,y,o),m[g]=Qr[0],m[g+1]=Qr[1],m[g+2]=Qr[2]};for(let m=0;m<8;++m)f(yOe.data,3*m,a[m]);return XGe(yOe)}function pAr(t){return t!=null&&t.halfSize[0]>=0}function fAr(t){return t[3]>=0}function mAr(t){t!=null&&(t.halfSize[0]=-1)}function gAr(t){t!=null&&(t[3]=-1)}const Ud=Me(),$v=VGe(),koe=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],LJ=lr(),kU=lr(),gOe=cfe(),Qr=A(),yOe={data:new Array(72),size:3,exclusive:!0,stride:3},UU=Me();async function Dtr(t,e=t.popupTemplate){var u,h;if(e==null)return[];const r=await e.getRequiredFields(t.fieldsIndex),{lastEditInfoEnabled:i}=e,{objectIdField:n,typeIdField:s,globalIdField:o,relationships:a}=t;if(r.includes("*"))return["*"];const l=i?await M0t(t):[],c=U7(t.fieldsIndex,[...r,...l]);return s&&c.push(s),c&&n&&((u=t.fieldsIndex)!=null&&u.has(n))&&!c.includes(n)&&c.push(n),c&&o&&((h=t.fieldsIndex)!=null&&h.has(o))&&!c.includes(o)&&c.push(o),a&&a.forEach(f=>{var g;const{keyField:m}=f;c&&m&&((g=t.fieldsIndex)!=null&&g.has(m))&&!c.includes(m)&&c.push(m)}),c}function uWe(t,e){return t.popupTemplate?t.popupTemplate:e!=null&&e.defaultPopupTemplateEnabled&&t.defaultPopupTemplate!=null?t.defaultPopupTemplate:null}function yAr(t,e){return uWe(t,{defaultPopupTemplateEnabled:e})!=null}const Ntr=["3DObject","Point"],vOe=Vfe();let rr=class extends mqe(IKt(dqe(Cue($fe(xq(Q4(uqe(Rn(O3))))))))){constructor(...t){super(...t),this.featureReduction=null,this.rangeInfos=null,this.operationalLayerType="ArcGISSceneServiceLayer",this.type="scene",this.fields=null,this.floorInfo=null,this.outFields=null,this.nodePages=null,this.materialDefinitions=null,this.textureSetDefinitions=null,this.geometryDefinitions=null,this.serviceUpdateTimeStamp=null,this.excludeObjectIds=new vt,this.definitionExpression=null,this.filter=null,this.path=null,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.priority=null,this.semantic=null,this.cachedDrawingInfo={color:!1},this.popupEnabled=!0,this.popupTemplate=null,this.objectIdField=null,this.globalIdField=null,this._fieldUsageInfo={},this.screenSizePerspectiveEnabled=!0}normalizeCtorArgs(t,e){return typeof t=="string"?{url:t,...e}:t}destroy(){this._set("renderer",null)}getField(t){return this.fieldsIndex.get(t)}getFieldDomain(t,e){var i,n,s;const r=(n=(i=this.getFeatureType(e==null?void 0:e.feature))==null?void 0:i.domains)==null?void 0:n[t];return r&&r.type!=="inherited"?r:((s=this.getField(t))==null?void 0:s.domain)??null}getFeatureType(t){return t&&this.associatedLayer?this.associatedLayer.getFeatureType(t):null}get types(){var t;return((t=this.associatedLayer)==null?void 0:t.types)??[]}get typeIdField(){var t;return((t=this.associatedLayer)==null?void 0:t.typeIdField)??null}get templates(){var t;return((t=this.associatedLayer)==null?void 0:t.templates)??null}get formTemplate(){var t;return((t=this.associatedLayer)==null?void 0:t.formTemplate)??null}get fieldsIndex(){return new Rfe(this.fields)}readNodePages(t,e,r){return e.layerType==="Point"&&(t=e.pointNodePages),t==null||typeof t!="object"?null:ZT.fromJSON(t,r)}set elevationInfo(t){this._set("elevationInfo",t),this.loaded&&this._validateElevationInfo()}get geometryType(){return Ftr[this.profile]||"mesh"}set renderer(t){CP(t,this.fieldsIndex),this._set("renderer",t)}readCachedDrawingInfo(t){return t!=null&&typeof t=="object"||(t={}),t.color==null&&(t.color=!1),t}get capabilities(){var S,C;const t=((S=this.associatedLayer)==null?void 0:S.capabilities)??LKt,{query:e,editing:{supportsGlobalId:r,supportsRollbackOnFailure:i,supportsUploadWithItemId:n,supportsGeometryUpdate:s,supportsReturnServiceEditsInSourceSpatialReference:o},data:{supportsZ:a,supportsM:l,isVersioned:c,supportsAttachment:u},operations:{supportsEditing:h,supportsAdd:f,supportsUpdate:m,supportsDelete:g,supportsQuery:y,supportsQueryAttachments:_,supportsAsyncConvert3D:b}}=t,w=t.operations.supportsChangeTracking,x=!!((C=this.associatedLayer)!=null&&C.infoFor3D)&&zSe();return{query:e,editing:{supportsGlobalId:r,supportsReturnServiceEditsInSourceSpatialReference:o,supportsRollbackOnFailure:i,supportsGeometryUpdate:x&&s,supportsUploadWithItemId:n},data:{supportsAttachment:u,supportsZ:a,supportsM:l,isVersioned:c},operations:{supportsQuery:y,supportsQueryAttachments:_,supportsEditing:h&&w,supportsAdd:x&&f&&w,supportsDelete:x&&g&&w,supportsUpdate:m&&w,supportsAsyncConvert3D:b}}}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges}set editingEnabled(t){this._overrideIfSome("editingEnabled",t)}get infoFor3D(){var t;return((t=this.associatedLayer)==null?void 0:t.infoFor3D)??null}get defaultPopupTemplate(){return this.associatedLayer||this.attributeStorageInfo?this.createPopupTemplate():null}readObjectIdField(t,e){return!t&&e.fields&&e.fields.some(r=>(r.type==="esriFieldTypeOID"&&(t=r.name),!!t)),t||void 0}readGlobalIdField(t,e){return!t&&e.fields&&e.fields.some(r=>(r.type==="esriFieldTypeGlobalID"&&(t=r.name),!!t)),t||void 0}get displayField(){var t;return((t=this.associatedLayer)==null?void 0:t.displayField)??null}readProfile(t,e){const r=e.store.profile;return r!=null&&_Oe[r]?_Oe[r]:(re.getLogger(this).error("Unknown or missing profile",{profile:r,layer:this}),"mesh-pyramids")}load(t){const e=t!=null?t.signal:null,r=this.loadFromPortal({supportedTypes:["Scene Service"]},t).catch(Oa).then(()=>this._fetchService(e)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,e),this._setAssociatedFeatureLayer(e),this._loadFilterGeometries()])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>Yqe(this,{origin:"service"},e)).then(()=>CP(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(t));return this.addResolvingPromise(r),Promise.resolve(this)}async beforeSave(){this.filter!=null&&(this.filter=this.filter.clone(),await this.load())}async _loadFilterGeometries(){if(this.filter)try{await this.filter.loadGeometries(this.spatialReference)}catch(t){re.getLogger(this).error("#_loadFilterGeometries()",this,"Failed to load filter geometries. Geometry filter will not be applied for this layer.",{error:t}),this.filter=null}}createQuery(){const t=new uh;return this.geometryType!=="mesh"&&(t.returnGeometry=!0,t.returnZ=!0),t.where=this.definitionExpression||"1=1",t.sqlFormat="standard",t.outFields=["*"],t}queryExtent(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryExtent(t||this.createQuery(),e))}queryFeatureCount(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatureCount(t||this.createQuery(),e))}queryFeatures(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryFeatures(t||this.createQuery(),e)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=this,i.sourceLayer=this;return r})}async queryCachedAttributes(t,e){const r=E0t(this.fieldsIndex,await Dtr(this,uWe(this)));return lWe(this.parsedUrl.path,this.attributeStorageInfo??[],t,e,r)}async queryCachedFeature(t,e){const r=await this.queryCachedAttributes(t,[e]);if(!r||r.length===0)throw new H("scenelayer:feature-not-in-cached-data","Feature not found in cached data");const i=new cf;return i.attributes=r[0],i.layer=this,i.sourceLayer=this,i}queryObjectIds(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryObjectIds(t||this.createQuery(),e))}queryAttachments(t,e){return this._getAssociatedLayerForQuery().then(r=>r.queryAttachments(t,e))}getFieldUsageInfo(t){const e={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[t]||e:(re.getLogger(this).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),e)}createPopupTemplate(t){return Bfe(this,t)}_getAssociatedLayerForQuery(){const t=this.associatedLayer;return t!=null&&t.loaded?Promise.resolve(t):this._loadAssociatedLayerForQuery()}async _loadAssociatedLayerForQuery(){if(await this.load(),!this.associatedLayer)throw new H("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(t){throw new H("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:t})}return this.associatedLayer}hasCachedStatistics(t){return this.statisticsInfo!=null&&this.statisticsInfo.some(e=>e.name===t)}async queryCachedStatistics(t,e){if(await this.load(e),!this.statisticsInfo)throw new H("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const r=this.fieldsIndex.get(t);if(!r)throw new H("scenelayer:field-unexisting",`Field '${t}' does not exist on the layer`);for(const i of this.statisticsInfo)if(i.name===r.name){const n=bd(this.parsedUrl.path,i.href);return ti(n,{query:{f:"json",token:this.apiKey},responseType:"json",signal:e?e.signal:null}).then(s=>s.data)}throw new H("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available")}async saveAs(t,e){return this._debouncedSaveOperations(a3.SAVE_AS,{...e,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},t)}async save(){const t={getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"};return this._debouncedSaveOperations(a3.SAVE,t)}async applyEdits(t,e){const{applyEdits:r}=await le(()=>import("./editingSupport-47fc3fce.js"),["assets/editingSupport-47fc3fce.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js"]);if(await this.load(),!this.associatedLayer)throw new H(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),r(this,this.associatedLayer.source,t,e)}async uploadAssets(t,e){if(await this.load(),this.associatedLayer==null)throw new H(`${this.type}-layer:not-editable`,"Service is not editable");return await this.associatedLayer.load(),this.associatedLayer.uploadAssets(t,e)}on(t,e){return super.on(t,e)}validateLayer(t){if(t.layerType&&!Ntr.includes(t.layerType))throw new H("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:t.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new H("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(this.version.major>2)throw new H("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});function e(r,i){let n=!1,s=!1;if(r==null)n=!0,s=!0;else{const o=i&&i.isGeographic;switch(r){case"east-north-up":case"earth-centered":n=!0,s=o;break;case"vertex-reference-frame":n=!0,s=!o;break;default:n=!1}}if(!n)throw new H("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!s)throw new H("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.")}e(this.normalReferenceFrame,this.spatialReference)}_getTypeKeywords(){const t=[];if(this.profile==="points")t.push("Point");else{if(this.profile!=="mesh-pyramids")throw new H("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);t.push("3DObject")}return t}_populateFieldUsageInfo(){var t,e;if(this._fieldUsageInfo={},this.fields)for(const r of this.fields){const i=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(o=>o.name===r.name)),n=!!((e=(t=this.associatedLayer)==null?void 0:t.fields)!=null&&e.some(o=>o&&r.name===o.name)),s={supportsLabelingInfo:i,supportsRenderer:i,supportsPopupTemplate:i||n,supportsLayerQuery:n};this._fieldUsageInfo[r.name]=s}}_applyAssociatedLayerOverrides(){this._applyAssociatedLayerFieldsOverrides(),this._applyAssociatedLayerPopupOverrides(),this._applyAssociatedLayerExtentOverride()}_applyAssociatedLayerFieldsOverrides(){var e;if(!((e=this.associatedLayer)!=null&&e.fields))return;let t=null;for(const r of this.associatedLayer.fields){const i=this.getField(r.name);i?(!i.domain&&r.domain&&(i.domain=r.domain.clone()),i.editable=r.editable,i.nullable=r.nullable,i.length=r.length):(t||(t=this.fields?this.fields.slice():[]),t.push(r.clone()))}t&&this._set("fields",t)}_applyAssociatedLayerPopupOverrides(){if(!this.associatedLayer)return;const t=["popupTemplate","popupEnabled"],e=Ul(this);for(let r=0;r<t.length;r++){const i=t[r],n=this.originIdOf(i),s=this.associatedLayer.originIdOf(i);n<s&&(s===Fr.SERVICE||s===Fr.PORTAL_ITEM)&&e.setAtOrigin(i,this.associatedLayer[i],s)}}_applyAssociatedLayerExtentOverride(){var i,n,s,o,a,l,c;const t=(n=(i=this.associatedLayer)==null?void 0:i.editingInfo)==null?void 0:n.lastEditDate,e=(s=this.associatedLayer)==null?void 0:s.serverGens,r=(o=this.associatedLayer)==null?void 0:o.getAtOrigin("fullExtent","service");!zSe()||((a=this.associatedLayer)==null?void 0:a.infoFor3D)==null||!r||!pue((l=this.associatedLayer)==null?void 0:l.url)||!t||((c=this.serviceUpdateTimeStamp)==null?void 0:c.lastUpdate)===t.getTime()||!this.serviceUpdateTimeStamp&&(e==null?void 0:e.minServerGen)===(e==null?void 0:e.serverGen)||Ul(this).setAtOrigin("fullExtent",r.clone(),Fr.SERVICE)}async _setAssociatedFeatureLayer(t){if(!["mesh-pyramids","points"].includes(this.profile))return;const e=new Der(this.parsedUrl,this.portalItem,this.apiKey,t);try{this.associatedLayer=await e.fetch()}catch(r){Yn(r)||this._logWarningOnPopupEnabled()}}async _logWarningOnPopupEnabled(){await Zw(()=>this.popupEnabled&&this.popupTemplate!=null);const t=`this SceneLayer: ${this.title}`;this.attributeStorageInfo==null?re.getLogger(this).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${t}`):re.getLogger(this).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${t}`)}_validateElevationInfo(){const t=this.elevationInfo;t&&(this.profile==="mesh-pyramids"&&t.mode==="relative-to-scene"&&re.getLogger(this).warn(".elevationInfo=","Mesh scene layers don't support relative-to-scene elevation mode"),t.featureExpressionInfo&&t.featureExpressionInfo.expression!=="0"&&re.getLogger(this).warn(".elevationInfo=","Scene layers do not support featureExpressionInfo"))}};d([p({types:{key:"type",base:p_,typeMap:{selection:jse}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],rr.prototype,"featureReduction",void 0),d([p({type:[Pb],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],rr.prototype,"rangeInfos",void 0),d([p({json:{read:!1}})],rr.prototype,"associatedLayer",void 0),d([p({type:["show","hide"]})],rr.prototype,"listMode",void 0),d([p({type:["ArcGISSceneServiceLayer"]})],rr.prototype,"operationalLayerType",void 0),d([p({json:{read:!1},readOnly:!0})],rr.prototype,"type",void 0),d([p({...vOe.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],rr.prototype,"fields",void 0),d([p()],rr.prototype,"types",null),d([p()],rr.prototype,"typeIdField",null),d([p()],rr.prototype,"templates",null),d([p()],rr.prototype,"formTemplate",null),d([p({readOnly:!0})],rr.prototype,"fieldsIndex",null),d([p({type:Oqe,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],rr.prototype,"floorInfo",void 0),d([p(vOe.outFields)],rr.prototype,"outFields",void 0),d([p({type:ZT,readOnly:!0,json:{read:!1}})],rr.prototype,"nodePages",void 0),d([ke("service","nodePages",["nodePages","pointNodePages"])],rr.prototype,"readNodePages",null),d([p({type:[hp],readOnly:!0})],rr.prototype,"materialDefinitions",void 0),d([p({type:[EL],readOnly:!0})],rr.prototype,"textureSetDefinitions",void 0),d([p({type:[RL],readOnly:!0})],rr.prototype,"geometryDefinitions",void 0),d([p({readOnly:!0})],rr.prototype,"serviceUpdateTimeStamp",void 0),d([p({readOnly:!0})],rr.prototype,"attributeStorageInfo",void 0),d([p({readOnly:!0})],rr.prototype,"statisticsInfo",void 0),d([p({type:vt.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],rr.prototype,"excludeObjectIds",void 0),d([p({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],rr.prototype,"definitionExpression",void 0),d([p({type:Wer,json:{name:"layerDefinition.polygonFilter",write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],rr.prototype,"filter",void 0),d([p({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],rr.prototype,"path",void 0),d([p(Tue)],rr.prototype,"elevationInfo",null),d([p({type:String})],rr.prototype,"geometryType",null),d([p(sF)],rr.prototype,"labelsVisible",void 0),d([p({type:[iM],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:y4},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:y4},write:!0}})],rr.prototype,"labelingInfo",void 0),d([p(Sue)],rr.prototype,"legendEnabled",void 0),d([p({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(t,e){var i,n;if(typeof t=="number"&&t>=0&&t<=1)return t;const r=(n=(i=e.layerDefinition)==null?void 0:i.drawingInfo)==null?void 0:n.transparency;return r!==void 0?rE(r):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],rr.prototype,"opacity",void 0),d([p({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],rr.prototype,"priority",void 0),d([p({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],rr.prototype,"semantic",void 0),d([p({types:Mfe,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],rr.prototype,"renderer",null),d([p({json:{read:!1}})],rr.prototype,"cachedDrawingInfo",void 0),d([ke("service","cachedDrawingInfo")],rr.prototype,"readCachedDrawingInfo",null),d([p({readOnly:!0,json:{read:!1}})],rr.prototype,"capabilities",null),d([p({type:Boolean,json:{read:!1}})],rr.prototype,"editingEnabled",null),d([p({readOnly:!0,json:{write:!1,read:!1}})],rr.prototype,"infoFor3D",null),d([p(nF)],rr.prototype,"popupEnabled",void 0),d([p({type:LE,json:{name:"popupInfo",write:!0}})],rr.prototype,"popupTemplate",void 0),d([p({readOnly:!0,json:{read:!1}})],rr.prototype,"defaultPopupTemplate",null),d([p({type:String,json:{read:!1}})],rr.prototype,"objectIdField",void 0),d([ke("service","objectIdField",["objectIdField","fields"])],rr.prototype,"readObjectIdField",null),d([p({type:String,json:{read:!1}})],rr.prototype,"globalIdField",void 0),d([ke("service","globalIdField",["globalIdField","fields"])],rr.prototype,"readGlobalIdField",null),d([p({readOnly:!0,type:String,json:{read:!1}})],rr.prototype,"displayField",null),d([p({type:String,json:{read:!1}})],rr.prototype,"profile",void 0),d([ke("service","profile",["store.profile"])],rr.prototype,"readProfile",null),d([p({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],rr.prototype,"normalReferenceFrame",void 0),d([p(wue)],rr.prototype,"screenSizePerspectiveEnabled",void 0),rr=d([I("esri.layers.SceneLayer")],rr);const _Oe={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},Ftr={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"},dWe=rr,vAr=Object.freeze(Object.defineProperty({__proto__:null,default:dWe},Symbol.toStringTag,{value:"Module"}));let Ev=class extends Dfe(xq(O3)){constructor(e){super(e),this.elevationInfo=null,this.graphics=new C2,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}on(e,r){return super.on(e,r)}graphicChanged(e){this.emit("graphic-update",e)}};d([p({type:_Ne})],Ev.prototype,"elevationInfo",void 0),d([p(wB(C2,"graphics"))],Ev.prototype,"graphics",void 0),d([p({type:["show","hide"]})],Ev.prototype,"listMode",void 0),d([p()],Ev.prototype,"screenSizePerspectiveEnabled",void 0),d([p({readOnly:!0})],Ev.prototype,"type",void 0),d([p({constructOnly:!0})],Ev.prototype,"internal",void 0),Ev=d([I("esri.layers.GraphicsLayer")],Ev);const Hfe=Ev,I$={SCENE:"scene",VIEW:"view",SKETCH:"sketch",GRAPHICSLAYER:"graphicsLayer",SCENEVIEWGRAPHICS:"sceneViewGraphics"},hWe={scene:{},view:{},sketch:{},graphicsLayer:{}},u1=U.createContext(hWe),ktr=({children:t})=>{const[e,r]=U.useReducer((i,n)=>{switch(n.type){case I$.SCENE:return{...i,scene:n.payload};case I$.VIEW:return{...i,view:n.payload};case I$.SKETCH:return{...i,sketch:n.payload};case I$.GRAPHICSLAYER:return{...i,graphicsLayer:n.payload};case I$.SCENEVIEWGRAPHICS:return{...i,scene:n.payload.scene,view:n.payload.view,graphicsLayer:n.payload.graphicsLayer};default:return i}},hWe);return F.jsx(u1.Provider,{value:[e,r],children:t})},Cq=({children:t})=>{const[e,r]=U.useContext(Co),[i,n]=U.useContext(u1),s=U.useRef(null);return U.useEffect(()=>{if(s.current){const o=new iTt({basemap:e.basemap,ground:"world-elevation"}),a=new zJt({map:o,container:s.current,padding:{top:40},camera:e.cameraLocation,spatialReference:{wkid:4326}});a.popup.defaultPopupTemplateEnabled=!0;const l=new Hfe({elevationInfo:"on-the-ground"});o.add(l);const c=new dWe({url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",popupEnabled:!1,opacity:.02});return o.add(c),n({type:"sceneViewGraphics",payload:{scene:o,view:a,graphicsLayer:l}}),()=>{a&&a.destroy()}}},[e.cameraLocation]),F.jsxs(F.Fragment,{children:[F.jsx("div",{className:"mapDiv",ref:s}),t]})};function DJ(t){switch(t){case dn.SUPPORTED:break;case dn.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case dn.GEOMETRY_MISSING:return"no geometry";case dn.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case dn.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case dn.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var dn;(function(t){t[t.SUPPORTED=0]="SUPPORTED",t[t.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",t[t.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",t[t.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",t[t.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",t[t.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(dn||(dn={}));function pWe(t){return t?zo:Gtr}function Utr(t,e){return e!=null&&e.mode?e.mode:pWe(t).mode}function ztr(t,e){return e??pWe(t)}function fWe(t,e){return Utr(t!=null&&t.hasZ,e)}function bAr(t,e){return ztr(t!=null&&!!t.hasZ,e)}function Rq(t){const e=Wfe(t);return fWe(t.geometry,e)}function wAr(t){const e=Wfe(t),r=fWe(t.geometry,e);return{mode:r,offset:e!=null&&r!=="on-the-ground"?(e.offset??0)*vNe(e.unit??"meters"):0}}function qfe(t){if(Rq(t)==="on-the-ground")return!1;const e=Wfe(t),r=e!=null&&e.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!r||r==="0")}function Wfe(t){return t.layer&&"elevationInfo"in t.layer?t.layer.elevationInfo:null}function xAr(t,e,r){if(r==null||!r.mode)return;const i=t.hasZ?t.z:0,n=r.offset!=null?r.offset:0;switch(r.mode){case"absolute-height":return i-n;case"on-the-ground":return 0;case"relative-to-ground":return i-((e.elevationProvider.getElevation(t.x,t.y,i,t.spatialReference,"ground")??0)+n);case"relative-to-scene":return i-((e.elevationProvider.getElevation(t.x,t.y,i,t.spatialReference,"scene")??0)+n)}}function Vtr(t,e,r,i=null){return gWe(t,e.x,e.y,e.hasZ?e.z:0,e.spatialReference,r,i)}function mWe(t,e,r,i,n=null){return gWe(t,e[0],e[1],e.length>2?e[2]:0,r,i,n)}function gWe(t,e,r,i,n,s,o=null){if(s==null)return;const a=o!=null?o.mode:"absolute-height";if(a==="on-the-ground")return 0;const{absoluteZ:l}=Btr(e,r,i,n,t,s);return jtr(l,e,r,i,n,t,o,a)}function Btr(t,e,r,i,n,s){const o=s.offset!=null?s.offset:0;switch(s.mode){case"absolute-height":return{absoluteZ:r+o,elevation:0};case"on-the-ground":{const a=n.elevationProvider.getElevation(t,e,0,i,"ground")??0;return{absoluteZ:a,elevation:a}}case"relative-to-ground":{const a=n.elevationProvider.getElevation(t,e,r,i,"ground")??0;return{absoluteZ:r+a+o,elevation:a}}case"relative-to-scene":{const a=n.elevationProvider.getElevation(t,e,r,i,"scene")??0;return{absoluteZ:r+a+o,elevation:a}}}}function jtr(t,e,r,i,n,s,o,a){const l=o!=null&&o.offset!=null?o.offset:0;switch(a){case"absolute-height":return t-l;case"relative-to-ground":return t-((s.elevationProvider.getElevation(e,r,i,n,"ground")??0)+l);case"relative-to-scene":return t-((s.elevationProvider.getElevation(e,r,i,n,"scene")??0)+l)}}function SAr(t,e){if(e==null)return!1;const{mode:r}=e;return r!=null&&(t==="scene"&&r==="relative-to-scene"||t==="ground"&&r!=="absolute-height")}const zo={mode:"absolute-height",offset:0},Gtr={mode:"on-the-ground",offset:null};function Htr(t){var e;if(((e=t.layer)==null?void 0:e.type)!=="graphics")return dn.GRAPHICS_LAYER_MISSING;if(t.geometry==null)return dn.GEOMETRY_MISSING;switch(t.geometry.type){case"polygon":case"point":case"polyline":case"mesh":break;default:return dn.GEOMETRY_TYPE_UNSUPPORTED}return Rq(t)!=="on-the-ground"&&qfe(t)?dn.ELEVATION_MODE_UNSUPPORTED:dn.SUPPORTED}function yWe(t){if(!t)return null;if(bce(t)&&t.wkid){const e=kgt[t.wkid];if(e)return e}if(t.wkt){const e=qtr(t.wkt);if(e)return e}return null}function qtr(t){const e=Ngt.exec(t);if(!e||e.length!==2)return null;const r=e[1].split(",");if(!r||r.length<3)return null;const i=parseFloat(r[1]),n=parseFloat(r[2]);return isNaN(i)||isNaN(n)?null:{a:i,f:n===0?0:1/n}}function Oq(t){const e=yWe(t??dt.WGS84);if(Wtr(e))return e;const r=e.a*(1-e.f);return Object.assign(e,{b:r,eSq:1-(r/e.a)**2,radius:(2*e.a+r)/3,densificationRatio:1e4/((2*e.a+r)/3)})}function Wtr(t){return t!=null&&"b"in t&&"eSq"in t&&"radius"in t}function zU(t,e,r){const{a:i,eSq:n}=Oq(r),s=Math.sqrt(n),o=Math.sin(e[1]*Wu),a=i*e[0]*Wu;let l;return n>0?l=i*((1-n)*(o/(1-n*(o*o))-1/(2*s)*Math.log((1-s*o)/(1+s*o))))*.5:l=i*o,t[0]=a,t[1]=l,t}function Xfe(t){return yWe(t)!==null}function TAr(t,e="square-meters"){if(t.some(o=>!Xfe(o.spatialReference)))throw new H("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const r=[];for(let o=0;o<t.length;o++){const a=t[o],l=a.spatialReference,{radius:c,densificationRatio:u}=Oq(l),h=c*u;r.push(Xtr(a,h))}const i=[],n=[0,0],s=[0,0];for(let o=0;o<r.length;o++){const{rings:a,spatialReference:l}=r[o];let c=0;for(let u=0;u<a.length;u++){const h=a[u];zU(n,h[0],l),zU(s,h[h.length-1],l);let f=s[0]*n[1]-n[0]*s[1];for(let m=0;m<h.length-1;m++)zU(n,h[m+1],l),zU(s,h[m],l),f+=s[0]*n[1]-n[0]*s[1];c+=f}c=Po(c,"square-meters",e),i.push(c/-2)}return i}function EAr(t,e="meters"){if(!t)throw new H("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(t.some(i=>!Xfe(i.spatialReference)))throw new H("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const r=[];for(let i=0;i<t.length;i++){const n=t[i],{spatialReference:s}=n,o=n.type==="polyline"?n.paths:n.rings;let a=0;for(let l=0;l<o.length;l++){const c=o[l];let u=0;for(let h=1;h<c.length;h++){const f=c[h-1][0],m=c[h][0],g=c[h-1][1],y=c[h][1];if(g!==y||f!==m){const _=new vWe;_We(_,[f,g],[m,y],s),u+=_.distance}}a+=u}a=Po(a,"meters",e),r.push(a)}return r}function Xtr(t,e){if(t.type!=="polyline"&&t.type!=="polygon")throw new H("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:r}=t;if(!Xfe(r))throw new H("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const i=t.type==="polyline"?t.paths:t.rings,n=[],s=[0,0],o=new vWe;for(const a of i){const l=[];n.push(l),l.push([a[0][0],a[0][1]]);let c,u,h=a[0][0],f=a[0][1];for(let m=0;m<a.length-1;m++){if(c=a[m+1][0],u=a[m+1][1],h===c&&f===u)continue;const g=[h,f];_We(o,[h,f],[c,u],r);const{azimuth:y,distance:_}=o,b=_/e;if(b>1){for(let w=1;w<=b-1;w++)w9(s,g,y,w*e,r),l.push(s.slice(0));w9(s,g,y,(_+Math.floor(b-1)*e)/2,r),l.push(s.slice(0))}w9(s,g,y,_,r),l.push(s.slice(0)),h=s[0],f=s[1]}}return t.type==="polyline"?new J4({paths:n,spatialReference:r}):new Tc({rings:n,spatialReference:r})}let vWe=class{constructor(e=0,r=void 0,i=void 0){this.distance=e,this.azimuth=r,this.reverseAzimuth=i}};function w9(t,e,r,i,n){const s=e[0],o=e[1],a=s*Wu,l=o*Wu,c=(r??0)*Wu,{a:u,b:h,f}=Oq(n),m=Math.sin(c),g=Math.cos(c),y=(1-f)*Math.tan(l),_=1/Math.sqrt(1+y*y),b=y*_,w=Math.atan2(y,g),x=_*m,S=x*x,C=1-S,E=C*(u*u-h*h)/(h*h),R=1+E/16384*(4096+E*(E*(320-175*E)-768)),P=E/1024*(256+E*(E*(74-47*E)-128));let D,L,k,V,W=i/(h*R),G=2*Math.PI;for(;Math.abs(W-G)>1e-12;)k=Math.cos(2*w+W),D=Math.sin(W),L=Math.cos(W),V=P*D*(k+P/4*(L*(2*k*k-1)-P/6*k*(4*D*D-3)*(4*k*k-3))),G=W,W=i/(h*R)+V;const B=b*D-_*L*g,Z=Math.atan2(b*L+_*D*g,(1-f)*Math.sqrt(S+B*B)),M=Math.atan2(D*m,_*L-b*D*g),$=f/16*C*(4+f*(4-3*C)),N=Z/Wu,j=(a+(M-(1-$)*f*x*(W+$*D*(k+$*L*(2*k*k-1)))))/Wu;return t[0]=j,t[1]=N,t}function _We(t,e,r,i){const n=e[0]*Wu,s=e[1]*Wu,o=r[0]*Wu,a=r[1]*Wu,{a:l,b:c,f:u,radius:h}=Oq(i),f=o-n,m=Math.atan((1-u)*Math.tan(s)),g=Math.atan((1-u)*Math.tan(a)),y=Math.sin(m),_=Math.cos(m),b=Math.sin(g),w=Math.cos(g);let x,S,C,E,R,P,D,L,k,V,W=1e3,G=f;do{if(D=Math.sin(G),L=Math.cos(G),C=Math.sqrt(w*D*(w*D)+(_*b-y*w*L)*(_*b-y*w*L)),C===0)return t.distance=0,t.azimuth=void 0,t.reverseAzimuth=void 0,t;R=y*b+_*w*L,P=Math.atan2(C,R),k=_*w*D/C,S=1-k*k,E=R-2*y*b/S,isNaN(E)&&(E=0),V=u/16*S*(4+u*(4-3*S)),x=G,G=f+(1-V)*u*k*(P+V*C*(E+V*R*(2*E*E-1)))}while(Math.abs(G-x)>1e-12&&--W>0);if(W===0){const j=h,J=Math.acos(Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos(o-n))*j,K=o-n,te=Math.sin(K)*Math.cos(a),ae=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(K),be=Math.atan2(te,ae);return t.azimuth=be/Wu,t.distance=J,t.reverseAzimuth=void 0,t}const B=S*(l*l-c*c)/(c*c),Z=B/1024*(256+B*(B*(74-47*B)-128)),M=c*(1+B/16384*(4096+B*(B*(320-175*B)-768)))*(P-Z*C*(E+Z/4*(R*(2*E*E-1)-Z/6*E*(4*C*C-3)*(4*E*E-3)))),$=Math.atan2(w*Math.sin(G),_*b-y*w*Math.cos(G)),N=Math.atan2(_*Math.sin(G),_*b*Math.cos(G)-y*w);return t.azimuth=$/Wu,t.distance=M,t.reverseAzimuth=N/Wu,t}var Uoe;let Mb=Uoe=class extends Tc{constructor(...t){super(...t),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}normalizeCtorArgs(t,e){let r;if(t&&t.center)r=t;else{if(t&&t.rings)return super.normalizeCtorArgs(t,e);r={center:t}}return{...super.normalizeCtorArgs(),...r,...e}}initialize(){const t=this.center,e=this.numberOfPoints;if(this.hasZ=(t==null?void 0:t.hasZ)??!1,this.rings.length!==0||!t)return;const r=Po(this.radius,this.radiusUnit,"meters"),i=t.spatialReference;let n,s="geographic";if(i.isWebMercator?s="webMercator":((i.wkid&&z[i.wkid])!=null||i.wkt&&i.wkt.indexOf("PROJCS")===0)&&(s="projected"),this.geodesic){let o;switch(s){case"webMercator":o=UO(t);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":o=t}n=this._createGeodesicCircle(o,r,e),s==="webMercator"&&(n=bA(n))}else{let o;s==="webMercator"||s==="projected"?o=r/this._convert2Meters(1,t.spatialReference):s==="geographic"&&(o=PIe(r,"meters",Xr(t.spatialReference).radius)),n=this._createPlanarCircle(t,o,e)}this.spatialReference=n.spatialReference,this.addRing(n.rings[0])}clone(){const{center:t,numberOfPoints:e,radius:r,radiusUnit:i,geodesic:n}=this;return new Uoe({center:t==null?void 0:t.clone(),numberOfPoints:e,radius:r,radiusUnit:i,geodesic:n})}_createGeodesicCircle(t,e,r){let i=0;const n=[];for(;i<360;){const s=[0,0],o=[t.x,t.y];w9(s,o,i,e),this.hasZ&&s.push(t.z),n.push(s),i+=360/r}return n.push(n[0]),new Tc(n)}_createPlanarCircle(t,e,r){const i=[],n=2*Math.PI/r;for(let s=0;s<r;++s){const o=n*s,a=[t.x+Math.cos(-o)*e,t.y+Math.sin(-o)*e];this.hasZ&&a.push(t.z),i.push(a)}return i.push(i[0]),new Tc({spatialReference:t.spatialReference,rings:[i]})}_convert2Meters(t,e){let r;if(e.wkid&&z[e.wkid]!=null)r=z.values[z[e.wkid]];else{const i=e.wkt,n=i.lastIndexOf(",")+1,s=i.lastIndexOf("]]");r=parseFloat(i.substring(n,s))}return t*r}};d([p({type:Gt})],Mb.prototype,"center",void 0),d([p()],Mb.prototype,"geodesic",void 0),d([p()],Mb.prototype,"numberOfPoints",void 0),d([p()],Mb.prototype,"radius",void 0),d([p()],Mb.prototype,"radiusUnit",void 0),Mb=Uoe=d([I("esri.geometry.Circle")],Mb);const Ytr=Mb;function VU(t){return bWe(t).result}function RAr(t){return bWe(t).geometry}function bWe(t){var i;if(((i=t.layer)==null?void 0:i.type)!=="graphics")return{result:dn.GRAPHICS_LAYER_MISSING,geometry:null};const{geometry:e}=t;if(e==null)return{result:dn.GEOMETRY_MISSING,geometry:null};if(Rq(t)!=="on-the-ground"&&qfe(t))return{result:dn.ELEVATION_MODE_UNSUPPORTED,geometry:null};const r=e.type;return r!=="point"&&r!=="mesh"&&r!=="polyline"&&(r!=="polygon"||t.geometry instanceof Ytr)?{result:dn.GEOMETRY_TYPE_UNSUPPORTED,geometry:null}:{result:dn.SUPPORTED,geometry:e}}function Ztr(t){var r;if(((r=t.layer)==null?void 0:r.type)!=="graphics")return dn.GRAPHICS_LAYER_MISSING;if(t.geometry==null)return dn.GEOMETRY_MISSING;switch(t.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return dn.SUPPORTED;default:return dn.GEOMETRY_TYPE_UNSUPPORTED}const e=t.symbol!=null&&t.symbol.type==="point-3d"&&t.symbol.symbolLayers;return e&&e.length>0&&e.some(i=>i.type==="object")?Rq(t)!=="on-the-ground"&&qfe(t)?dn.ELEVATION_MODE_UNSUPPORTED:dn.SUPPORTED:dn.SYMBOL_TYPE_UNSUPPORTED}function bOe(t,e,r){if(!e||!t||!t.map)return;const{map:i}=t,n=i.layers.find(s=>s===e);n||i.add(e,r),n&&r!=null&&i.layers.reorder(n,r)}function OAr(t,e){return t.allLayerViews.find(r=>{const i=r.layer;return i===e||"sublayers"in i&&i.sublayers!=null&&i.sublayers.includes(e)})}const jo={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},wOe={toggle:"Control"};let x9=class extends Ce{constructor(e){super(e),this.enabled=!1}};d([p({type:Boolean,nonNullable:!0})],x9.prototype,"enabled",void 0),x9=d([I("esri.views.interactive.sketch.SketchLabelOptions")],x9);const wWe=x9;let GD=class extends Ce{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};d([p({type:String,nonNullable:!0})],GD.prototype,"mode",void 0),GD=d([I("esri.widgets.Sketch.SketchTooltipOptions.ElevationOptions")],GD);let zu=class extends Ce{constructor(){super(...arguments),this.distance=!0,this.elevation=!0,this.size=!0,this.scale=!0,this.rotation=!0,this.orientation=!0,this.totalLength=!0,this.area=!0,this.radius=!0,this.helpMessage=!1}toJSON(){return{distance:this.distance,size:this.size,scale:this.scale,rotation:this.rotation,orientation:this.orientation,totalLength:this.totalLength,area:this.area,radius:this.radius}}};d([p({type:Boolean,nonNullable:!0})],zu.prototype,"distance",void 0),d([p({type:Boolean,nonNullable:!0})],zu.prototype,"elevation",void 0),d([p({type:Boolean,nonNullable:!0})],zu.prototype,"size",void 0),d([p({type:Boolean,nonNullable:!0})],zu.prototype,"scale",void 0),d([p({type:Boolean,nonNullable:!0})],zu.prototype,"rotation",void 0),d([p({type:Boolean,nonNullable:!0})],zu.prototype,"orientation",void 0),d([p({type:Boolean,nonNullable:!0})],zu.prototype,"totalLength",void 0),d([p({type:Boolean,nonNullable:!0})],zu.prototype,"area",void 0),d([p({type:Boolean,nonNullable:!0})],zu.prototype,"radius",void 0),d([p({type:Boolean,nonNullable:!0})],zu.prototype,"helpMessage",void 0),zu=d([I("esri.widgets.Sketch.SketchTooltipOptions.VisibleElements")],zu);let AT=class extends Ce{constructor(e){super(e),this.enabled=!1,this.elevation=new GD,this.visibleElements=new zu,this.visualVariables=null}toJSON(){return{enabled:this.enabled,elevation:this.elevation,visibleElements:this.visibleElements}}};d([p({type:Boolean,nonNullable:!0})],AT.prototype,"enabled",void 0),d([p({type:GD,nonNullable:!0})],AT.prototype,"elevation",void 0),d([p({type:zu,nonNullable:!0})],AT.prototype,"visibleElements",void 0),d([p()],AT.prototype,"visualVariables",void 0),AT=d([I("esri.widgets.Sketch.SketchTooltipOptions")],AT);const xWe=AT;let Gm=class extends me{constructor(){super(...arguments),this.enabled=!0}};d([p({type:Boolean})],Gm.prototype,"enabled",void 0),Gm=d([I("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],Gm);let es=class extends me{constructor(e){super(e),this.lineSnapper=new Gm,this.parallelLineSnapper=new Gm,this.rightAngleSnapper=new Gm,this.rightAngleTriangleSnapper=new Gm,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThreshold=.1,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new ht([255,127,0]),this.orangeTransparent=new ht([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};d([p({type:Gm,constructOnly:!0,nonNullable:!0,json:{write:!0}})],es.prototype,"lineSnapper",void 0),d([p({type:Gm,constructOnly:!0,nonNullable:!0,json:{write:!0}})],es.prototype,"parallelLineSnapper",void 0),d([p({type:Gm,constructOnly:!0,nonNullable:!0,json:{write:!0}})],es.prototype,"rightAngleSnapper",void 0),d([p({type:Gm,constructOnly:!0,nonNullable:!0,json:{write:!0}})],es.prototype,"rightAngleTriangleSnapper",void 0),d([p({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],es.prototype,"shortLineThreshold",void 0),d([p({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],es.prototype,"distance",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],es.prototype,"pointThreshold",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],es.prototype,"intersectionParallelLineThreshold",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],es.prototype,"parallelLineThreshold",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],es.prototype,"verticalLineThreshold",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],es.prototype,"touchSensitivityMultiplier",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],es.prototype,"pointOnLineThreshold",void 0),d([p({type:ht,nonNullable:!0})],es.prototype,"orange",void 0),d([p({type:ht,nonNullable:!0})],es.prototype,"orangeTransparent",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],es.prototype,"lineHintWidthReference",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],es.prototype,"lineHintWidthTarget",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],es.prototype,"lineHintFadedExtensions",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],es.prototype,"parallelLineHintWidth",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],es.prototype,"parallelLineHintLength",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],es.prototype,"parallelLineHintOffset",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],es.prototype,"rightAngleHintSize",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],es.prototype,"rightAngleHintOutlineSize",void 0),d([p({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],es.prototype,"satisfiesConstraintScreenThreshold",void 0),es=d([I("esri.views.interactive.snapping.Settings.Defaults")],es);const f_=new es;var ol;(function(t){t[t.FEATURE=1]="FEATURE",t[t.SELF=2]="SELF",t[t.ALL=3]="ALL"})(ol||(ol={}));function DAr(t){return t}function SWe(t){return qi(t)}function NAr(t,e,r){return Ue(t,e,r)}function ns(t,e,r){return t==null?null:OL(r.coordinateHelper.vectorToDehydratedPoint(t,Jtr),e,r)}function OL(t,e,r){if(t==null)return null;if(e==null)return Ue(t.x,t.y,t.z??0);if(e.type==="2d")return Ue(t.x,t.y,0);const{elevationInfo:i}=r,n=Vtr(e,t,i,zo)??0;return Ue(t.x,t.y,n)}function xOe(t,e,{z:r,m:i,spatialReference:n,elevationInfo:s}){if(r==null&&i==null){const l=yd(t[0],t[1],void 0,n);return i!=null&&(l.m=i,l.hasM=!0),l}if(e==null||e.type==="2d"){const l=yd(t[0],t[1],r,n);return i!=null&&(l.m=i,l.hasM=!0),l}const o=mWe(e,t,n,zo,s)??0,a=yd(t[0],t[1],o,n);return i!=null&&(a.m=i,a.hasM=!0),a}function FAr(t,e){return yd(t[0],t[1],t[2],e)}const Jtr=yd(0,0,0,null);function NJ(t,e){return t[0]*e[1]-t[1]*e[0]}function Ktr(t,e,r){const i=Mn(r,e)/ox(r);return eu(t,r,i)}function FJ(t,e,r,i,n=r){return os(XA,i,r),os(zoe,e,n),Ktr(Uj,zoe,XA),Tp(t,n,Uj)}function Qtr(t,e,r,i){os(XA,e,r);const n=i/_F(XA);return r_(t,r,XA,n)}function kAr(t,e){const r=t.start,i=t.end,n=e.start,s=e.end,o=os(XA,i,r),a=os(trr,s,n),l=NJ(o,a);if(Math.abs(l)<=err)return[];const c=os(zoe,r,n),u=NJ(a,c)/l,h=NJ(o,c)/l;if(u>=0){if(h>=0||e.type===pa.LINE)return[r_(Uj,r,o,u)]}else if(t.type===pa.LINE&&(h>=0||e.type===pa.LINE))return[r_(Uj,r,o,u)];return[]}var pa;(function(t){t[t.RAY=0]="RAY",t[t.LINE=1]="LINE"})(pa||(pa={}));const err=1e-6,XA=Qe(),trr=Qe(),zoe=Qe(),Uj=Qe();function Voe({start:t,end:e,type:r},i,n){const s=[],o=os(YE,e,t),a=os(nM,t,i),l=ox(o),c=2*Mn(o,a),u=c*c-4*l*(ox(a)-n*n);if(u===0){const h=-c/(2*l);(r===tg.PLANE||h>=0)&&s.push(r_(Qe(),t,o,h))}else if(u>0){const h=Math.sqrt(u),f=(-c+h)/(2*l);(r===tg.PLANE||f>=0)&&s.push(r_(Qe(),t,o,f));const m=(-c-h)/(2*l);(r===tg.PLANE||m>=0)&&s.push(r_(Qe(),t,o,m))}return s}function Boe(t,e){const r=t.start,i=t.end,n=os(YE,i,r),s=se(nM,-n[1],n[0],0),o=e.start,a=e.end,l=Gi(Zfe,a,o),c=ye(l,s),u=se(RWe,r[0],r[1],0),h=Gi(OWe,u,o),f=ye(h,s);if(Math.abs(c)<Hm)return[];const m=id(AWe,o,l,f/c);if(e.type===pa.RAY){const g=Gi(Vj,m,o);if(ye(g,l)<-Hm)return[]}if(t.type===tg.HALF_PLANE){const g=Fde(Vj,m,r);if(Mn(g,n)<-Hm)return[]}return[qi(m)]}function joe(t,e){return Goe(zj(Jfe,e[2],t),e)}function TWe(t,e){const i=CWe(zj(Jfe,0,t),zj(nrr,0,e)),n=[];for(const s of i)n.push(BO(s));return n}function EWe(t,e){return Yfe(t,zj(Jfe,t[2],e))}function rrr(t,e,r){const i=os(YE,t,e),n=r/_F(i),s=r_(A(),e,i,n);return s[2]=t[2],s}function Yfe(t,{start:e,end:r,type:i}){const n=Gi(YE,t,e),s=Gi(nM,r,e),o=ye(n,s)/ye(s,s);return id(A(),e,s,i===pa.RAY?Math.max(o,0):o)}function SOe({start:t,end:e,type:r},i,n){const s=[],o=ve(YE,e,t),a=os(nM,t,i),l=ox(o),c=2*Mn(o,a),u=c*c-4*l*(ox(a)-n*n);if(u===0){const h=-c/(2*l);(r===pa.LINE||h>=0)&&s.push(id(A(),t,o,h))}else if(u>0){const h=Math.sqrt(u),f=(-c+h)/(2*l);(r===pa.LINE||f>=0)&&s.push(id(A(),t,o,f));const m=(-c-h)/(2*l);(r===pa.LINE||m>=0)&&s.push(id(A(),t,o,m))}return s}function CWe(t,e){const r=t.start,i=t.end,n=e.start,s=e.end,o=Gi(YE,i,r),a=Gi(nM,s,n),l=Gi(Zfe,n,r),c=Lt(RWe,o,a),u=ye(l,c);if(!e_(u,0,Hm))return[];const h=gP(c);if(e_(h,0,Hm))return[];const f=Lt(OWe,l,a),m=ye(f,c)/h,g=id(AWe,r,o,m);if(t.type===pa.RAY){const y=Gi(Vj,g,r);if(ye(o,y)<-Hm)return[]}if(e.type===pa.RAY){const y=Gi(Vj,g,n);if(ye(a,y)<-Hm)return[]}return[qi(g)]}function Goe({start:t,end:e,type:r},i){const n=Gi(YE,i,t),s=Gi(nM,e,t),o=Lt(Zfe,s,n);if(gP(o)/gP(s)<Hm)switch(r){case pa.LINE:return[qi(i)];case pa.RAY:return ye(s,n)<-Hm?[]:[qi(i)]}return[]}function TOe(t,e,r){return e_(ug(r,t),e*e,Hm)?[qi(r)]:[]}function zj(t,e,{start:r,end:i,type:n}){return se(t.start,r[0],r[1],e),se(t.end,i[0],i[1],e),t.type=irr[n],t}var tg;(function(t){t[t.PLANE=0]="PLANE",t[t.HALF_PLANE=1]="HALF_PLANE"})(tg||(tg={}));const irr={[tg.PLANE]:pa.LINE,[tg.HALF_PLANE]:pa.RAY},Hm=1e-6,YE=A(),nM=A(),Zfe=A(),RWe=A(),OWe=A(),AWe=A(),Vj=A(),Jfe={start:A(),end:A(),type:pa.LINE},nrr={start:A(),end:A(),type:pa.LINE};let ZE=class{intersect(e){return lrr(this,e)}},srr=class extends ZE{constructor(e){super(),this.point=e}equals(e){return aA(e)&&gi(this.point,e.point)}closestTo(){return SWe(this.point)}},PWe=class extends ZE{constructor(e,r,i){super(),this.start=e,this.end=r,this.type=i,this.lineLike={start:this.start,end:this.end,type:this.type}}equals(e){return JT(e)&&this.type===e.type&&gi(this.start,e.start)&&gi(this.end,e.end)}closestTo(e){const r=Yfe(e,this.lineLike);return r}},orr=class extends PWe{constructor(e,r){super(e,r,pa.LINE)}},MWe=class $We extends ZE{constructor(e,r,i){super(),this.intersection=e,this.first=r,this.second=i}equals(e){return e instanceof $We&&this.first.equals(e.first)&&this.second.equals(e.second)}closestTo(){return SWe(this.intersection)}},kJ=class IWe extends ZE{constructor(e,r,i){super(),this.basePoint=e,this.first=r,this.second=i}equals(e){return e instanceof IWe&&this.first.equals(e.first)&&this.second.equals(e.second)}closestTo(e){const r=this.basePoint;return Ue(r[0],r[1],e[2])}},LWe=class extends ZE{constructor(e,r){super(),this.center=e,this.radius=r}equals(e){return lA(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const r=rrr(e,this.center,this.radius);return r}},Kfe=class extends ZE{constructor(e,r,i){super(),this.start=e,this.end=r,this.type=i,this.planeLike={start:e,end:r,type:i}}equals(e){return KT(e)&&this.type===e.type&&gi(this.start,e.start)&&gi(this.end,e.end)}closestTo(e){return EWe(e,this.planeLike)}closestEndTo(e){const{start:r,end:i}=this;return Math.sign(Mn(os(urr,i,r),os(drr,e,r)))>0?i:r}},DWe=class extends Kfe{constructor(e,r){super(e,r,tg.HALF_PLANE)}},NWe=class extends Kfe{constructor(e,r){super(e,r,tg.PLANE)}};class FWe extends ZE{constructor(e,r,i){super(),this.start=e,this.end=r,this.getZ=i,this.planeLike={start:e,end:r,type:tg.PLANE}}equals(e){return QT(e)&&gi(this.start,e.start)&&gi(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return arr(this,e)}addIfOnTheGround(e,r){for(const i of r){const n=this.getZ(i[0],i[1],i[2])??0;Math.abs(i[2]-n)<Hm&&(i[2]=n,e.push(i))}}}function arr(t,e){const r=EWe(e,t.planeLike);return r[2]=t.getZ(e[0],e[1],e[2])??kWe,r}function lrr(t,e){let r=[];if(aA(t)){const{point:i}=t;JT(e)?r=Goe(e.lineLike,i):lA(e)?r=TOe(e.center,e.radius,i):KT(e)?r=joe(e.planeLike,i):QT(e)&&(r=L$(e,t))}else if(JT(t)){const{lineLike:i}=t;aA(e)?r=Goe(i,e.point):JT(e)?r=CWe(i,e.lineLike):lA(e)?r=SOe(i,e.center,e.radius):KT(e)?r=Boe(e.planeLike,i):QT(e)&&(r=L$(e,t))}else if(lA(t)){const{center:i,radius:n}=t;if(JT(e))r=SOe(e.lineLike,i,n);else if(aA(e))r=TOe(i,n,e.point);else{if(KT(e))return Voe(e.planeLike,i,n).map(s=>new kJ(s,t,e));QT(e)&&(r=L$(e,t))}}else if(KT(t)){const{planeLike:i}=t;if(KT(e))return TWe(i,e.planeLike).map(n=>new kJ(n,t,e));if(aA(e))r=joe(i,e.point);else if(JT(e))r=Boe(i,e.lineLike);else{if(lA(e))return Voe(i,e.center,e.radius).map(n=>new kJ(n,t,e));QT(e)&&(r=L$(e,t))}}else QT(t)&&(r=L$(t,e));return crr(r,t,e)}function L$(t,e){const{planeLike:r,getZ:i}=t,n=[];if(aA(e))t.addIfOnTheGround(n,joe(r,e.point));else if(JT(e))t.addIfOnTheGround(n,Boe(r,e.lineLike));else if(lA(e))for(const[s,o]of Voe(r,e.center,e.radius)){const a=i(s,o,0);a!=null&&n.push(Ue(s,o,a))}else if(KT(e)||QT(e))for(const[s,o]of TWe(r,e.planeLike)){const a=i(s,o,0)??kWe;n.push(Ue(s,o,a))}return n}function crr(t,e,r){return t.map(i=>new MWe(i,e,r))}function aA(t){return t instanceof srr}function JT(t){return t instanceof PWe}function lA(t){return t instanceof LWe}function KT(t){return t instanceof Kfe}function QT(t){return t instanceof FWe}const urr=Qe(),drr=Qe(),kWe=0;function JE(t,e){const r=t.x-e.x,i=t.y-e.y;return r*r+i*i}function hrr(t,e){return Math.sqrt(JE(t,e))}function Qfe(t,e){e.sort((r,i)=>ks(r.targetPoint,t)-ks(i.targetPoint,t))}var gf;function WAr({point:t,distance:e,returnEdge:r,returnVertex:i,coordinateHelper:{spatialReference:n}},s,o){return{point:yd(t[0],t[1],t[2],n.toJSON()),mode:s,distance:e,returnEdge:r,returnVertex:i,query:o!=null?o.toJSON():{where:"1=1"}}}function Bj(t,e,r){return{left:ns(t.leftVertex.pos,e,r),right:ns(t.rightVertex.pos,e,r)}}function XAr(t){return t.createQuery()}function prr(t,e=()=>{}){const r=pe(()=>({view:t.view,snappingOptions:t.snappingOptions}),({view:i,snappingOptions:n})=>{const s="snapping-toggle",o=Pn.TOOL;if(t.removeHandles(s),i&&n!=null){const a=[i.on("key-down",l=>{l.key!==wOe.toggle||l.repeat||(n.enabledToggled=!0,e())},o),i.on("key-up",l=>{l.key===wOe.toggle&&(n.enabledToggled=!1,e())},o),i.on("pointer-move",l=>{const c=l.native.ctrlKey;n.enabledToggled!==c&&(n.enabledToggled=c,e())},o)];t.addHandles(a,s)}},Bi);t.addHandles(r)}(function(t){t[t.TARGET=0]="TARGET",t[t.REFERENCE=1]="REFERENCE",t[t.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(gf||(gf={}));let sM=class{constructor(e,r,i,n){this.targetPoint=e,this.constraint=r,this.isDraped=i,this.domain=n}},eme=class extends sM{constructor({targetPoint:e,objectId:r,constraint:i,isDraped:n}){super(e,i,n,ol.FEATURE),this.objectId=r}},Aq=class{constructor(e,r){this.isDraped=e,this.domain=r}},v0=class UWe extends Aq{constructor(e,r,i,n,s=ol.ALL,o=!0,a=!0){super(n,s),this.type=e,this.lineStart=r,this.lineEnd=i,this.fadeLeft=o,this.fadeRight=a}equals(e){return e instanceof UWe&&this.type===e.type&&gi(this.lineStart,e.lineStart)&&gi(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return Li(this.lineStart,this.lineEnd)}},frr=class extends eme{constructor(e){super({...e,isDraped:!0,constraint:new FWe(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new v0(gf.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},mrr=class extends eme{constructor(e){super({...e,constraint:new orr(e.edgeStart,e.edgeEnd)})}get hints(){return[new v0(gf.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},zWe=class VWe extends Aq{constructor(e,r,i,n,s=ol.ALL){super(n,s),this.previousVertex=e,this.centerVertex=r,this.nextVertex=i}equals(e){return e instanceof VWe&&gi(this.previousVertex,e.previousVertex)&&gi(this.centerVertex,e.centerVertex)&&gi(this.nextVertex,e.nextVertex)}},BWe=class extends sM{constructor({targetPoint:e,constraint:r,previousVertex:i,otherVertex:n,otherVertexType:s,objectId:o,isDraped:a}){super(e,r,a,ol.SELF),this.previousVertex=i,this.otherVertex=n,this.otherVertexType=s,this.objectId=o}get hints(){const e=this.previousVertex,r=this.otherVertexType===c3.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===c3.CENTER?this.targetPoint:this.otherVertex;return[new v0(gf.TARGET,r,i,this.isDraped,this.domain),new v0(gf.REFERENCE,e,r,this.isDraped,this.domain),new zWe(this.previousVertex,r,i,this.isDraped,this.domain)]}};var c3;(function(t){t[t.NEXT=0]="NEXT",t[t.CENTER=1]="CENTER"})(c3||(c3={}));function tPr(t,e,r,i){r.projectToRenderScreen(t,EOe),r.projectToRenderScreen(e,COe),os(i,COe,EOe),BP(i,i)}function grr(t,e,r,i,n=A()){const s=oe(Hoe,t);return s[2]=mWe(i,s,e,r)||0,i.renderCoordsHelper.toRenderCoords(s,e,n),n}function Ec(t,e,r,i){return i.type==="2d"?(BU.x=t[0],BU.y=t[1],BU.spatialReference=e,i.toScreen(BU)):(grr(t,e,r,i,Hoe),i.state.camera.projectToScreen(Hoe,UJ),Oh(UJ[0],UJ[1]))}const BU=yd(0,0,0,null),Hoe=A(),EOe=ua(),COe=ua(),UJ=Tn();let $b=class extends aE{get updating(){return Pa(this.snappingSources,({snappingSource:e})=>e.updating)||this.updatingHandles.updating}get snappingSources(){const e=this._get("snappingSources")||new Map,r=new Map;if(this.options!=null&&this.options.featureSources!=null)for(const i of this.options.featureSources.items){const n=i.layer.uid,s=e.get(n);if(s){e.delete(n),r.set(n,s);continue}if(!i.layer.loaded){this.updatingHandles.addPromise(i.layer.load());continue}const o=this._createSourceInfo(i);o!=null&&r.set(n,o)}for(const[,i]of e)i.destroy();return r}constructor(e){super(e),this.options=null,this._domain=ol.FEATURE,this._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}}}initialize(){this.updatingHandles.add(()=>this.snappingSources,()=>this.notifyChange("updating"),li),this.view!=null&&this.handles.add([this.view.on("layerview-create",e=>this._updateLayerView(e.layer,e.layerView)),this.view.on("layerview-destroy",e=>this._updateLayerView(e.layer,null))])}_updateLayerView(e,r){for(const[,i]of this.snappingSources)i.snappingSource.layerSource.layer===e&&(i.layerView=r)}destroy(){this._set("options",null);for(const[,e]of this.snappingSources)e.destroy()}async fetchCandidates(e,r,i,n){var c;if(!(r&this._domain&&this.options!=null&&this.options.effectiveFeatureEnabled))return[];const s=[],o=this._computeScreenSizeDistanceParameters(e,i),a={distance:o,mode:((c=this.view)==null?void 0:c.type)??"2d",point:e,coordinateHelper:i.coordinateHelper,...this._types};for(const[,{snappingSource:u,layerView:h}]of this.snappingSources)!u.layerSource.enabled||h!=null&&h.suspended||s.push(u.fetchCandidates(a,n).then(f=>f.filter(m=>!this._candidateIsExcluded(u,m,i.excludeFeature))));const l=(await gV(s)).flat();return this._addRightAngleCandidates(l,e,o,i),vr(n),Qfe(e,l),l}_addRightAngleCandidates(e,r,i,n){var h,f,m,g,y,_,b,w;const s=n.vertexHandle!=null?(f=(h=n.vertexHandle.rightEdge)==null?void 0:h.rightVertex)==null?void 0:f.pos:n.editGeometryOperations!=null&&n.editGeometryOperations.data.type==="polygon"?(g=(m=n.editGeometryOperations.data.components[0])==null?void 0:m.getFirstVertex())==null?void 0:g.pos:null,o=n.vertexHandle!=null?(_=(y=n.vertexHandle.leftEdge)==null?void 0:y.leftVertex)==null?void 0:_.pos:n.editGeometryOperations!=null?(w=(b=n.editGeometryOperations.data.components[0])==null?void 0:b.getLastVertex())==null?void 0:w.pos:null,{view:a}=this,l=ns(s,a,n),c=ns(o,a,n),u=e.length;for(let x=0;x<u;x++)this._addRightAngleCandidate(e[x],c,r,i,e),this._addRightAngleCandidate(e[x],l,r,i,e)}_addRightAngleCandidate(e,r,i,n,s){if(r==null||!vrr(e))return;const o=e.constraint.closestTo(r),a=(o[0]-i[0])/n.x,l=(o[1]-i[1])/n.y,{start:c,end:u}=e.constraint;if(a*a+l*l<=1){const h=new BWe({targetPoint:o,otherVertex:r,otherVertexType:c3.NEXT,previousVertex:ug(o,c)>ug(o,u)?c:u,constraint:new DWe(r,o),objectId:e.objectId,isDraped:e.isDraped});s.push(h)}}_computeScreenSizeDistanceParameters(e,r){let i=this.options!=null?this.options.distance*(r.pointer==="touch"?this.options.touchSensitivityMultiplier:1):0;return this.view==null?{x:i,y:i,z:i,distance:i}:this.view.type==="2d"?(i*=this.view.resolution,{x:i,y:i,z:i,distance:i}):this._computeScreenSizeDistanceParameters3D(e,i,this.view,r)}_computeScreenSizeDistanceParameters3D(e,r,i,n){const{spatialReference:s}=n;i.renderCoordsHelper.toRenderCoords(e,s,ROe);const o=i.state.camera.computeScreenPixelSizeAt(ROe),a=o*i.renderCoordsHelper.unitInMeters/i.mapCoordsHelper.unitInMeters,l=r*a,c=Ec(e,s,zo,i),u=c?zJ(c,e,a,0,0,i,n):0,h=c?zJ(c,e,0,a,0,i,n):0,f=c?zJ(c,e,0,0,a,i,n):0;return{x:u===0?0:l/u,y:h===0?0:l/h,z:f===0?0:l/f,distance:o*r}}get _types(){return{returnEdge:!0,returnVertex:!0}}_candidateIsExcluded(e,r,i){if(i==null)return!1;const n=this._getCandidateObjectId(r);if(n==null)return!1;const s=e.layerSource.layer;return s.type==="graphics"?i.uid===n:i.sourceLayer===s&&!(!i.attributes||!("objectIdField"in s))&&i.attributes[s.objectIdField]===n}_getCandidateObjectId(e){return e instanceof eme?e.objectId:null}_createSourceInfo(e){const r=this._createFeatureSnappingSourceType(e);if(r==null)return null;if("loading"in r)return this.updatingHandles.addPromise(r.loading.then(()=>{this.destroyed||this.notifyChange("snappingSources")})),null;const i=this.view!=null?this.view.allLayerViews.find(n=>n.layer===e.layer):null;return new yrr(r.source,i)}_createFeatureSnappingSourceType(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}_createFeatureSnappingSourceSceneLayer(e){const{view:r}=this;if(r==null||r.type!=="3d")return null;const i=this._getSourceModule("scene");return i.module!=null?{source:new i.module.SceneLayerSnappingSource({layerSource:e,view:r})}:{loading:i.loader}}_createFeatureSnappingSourceFeatureLayer(e){var r;switch((r=e.layer.source)==null?void 0:r.type){case"feature-layer":case"oriented-imagery":{const i=this._getSourceModule("featureService");return i.module!=null?{source:new i.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:i.loader}}case"memory":case"csv":case"geojson":case"wfs":{if(e.layer.geometryType==="mesh")return null;const i=this._getSourceModule("featureCollection");return i.module!=null?{source:new i.module.FeatureCollectionSnappingSource({layerSource:e,view:this.view})}:{loading:i.loader}}}return null}_createFeatureSnappingSourceGraphicsLayer(e){const r=this._getSourceModule("graphics");return r.module!=null?{source:new r.module.GraphicsSnappingSource({getGraphicsLayers:()=>[e.layer],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:r.loader}}_createFeatureSnappingSourceMapNotesLayer(e){const r=this._getSourceModule("notes");return r.module!=null?{source:new r.module.GraphicsSnappingSource({getGraphicsLayers:()=>e.layer.sublayers!=null?e.layer.sublayers.toArray():[],spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:r.loader}}_getSourceModule(e){const r=this._sourceModules[e];if(r.loader==null){const i=this._loadSourceModule(e).then(n=>{r.module=n});return r.loader=i,{module:r.module,loader:i}}return{module:r.module,loader:r.loader}}_loadSourceModule(e){const r=this.updatingHandles;switch(e){case"featureService":return r.addPromise(le(()=>import("./FeatureServiceSnappingSource-abaad414.js"),["assets/FeatureServiceSnappingSource-abaad414.js","assets/queryEngineUtils-a4b80522.js","assets/VertexSnappingCandidate-7fd8e82f.js","assets/PointSnappingHint-76d2669d.js","assets/TileTreeDebugger-3f75e0c2.js"]));case"featureCollection":return r.addPromise(le(()=>import("./FeatureCollectionSnappingSource-840d82e1.js"),["assets/FeatureCollectionSnappingSource-840d82e1.js","assets/queryEngineUtils-a4b80522.js","assets/VertexSnappingCandidate-7fd8e82f.js","assets/PointSnappingHint-76d2669d.js","assets/symbologySnappingCandidates-1e210adb.js"]));case"graphics":case"notes":return r.addPromise(le(()=>import("./GraphicsSnappingSource-32d4702e.js"),["assets/GraphicsSnappingSource-32d4702e.js","assets/normalizeUtilsSync-0d231fb2.js","assets/normalizeUtilsCommon-8aa93216.js","assets/FeatureStore-e7a5a897.js","assets/BoundsStore-e596fecb.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/QueryEngine-3c1dae32.js","assets/normalizeUtils-5108f928.js","assets/WhereClause-50cca87e.js","assets/executionError-c92d3b85.js","assets/json-48e3ea08.js","assets/utils-ca9eceaf.js","assets/generateRendererUtils-b1f5279d.js","assets/queryEngineUtils-a4b80522.js","assets/VertexSnappingCandidate-7fd8e82f.js","assets/PointSnappingHint-76d2669d.js","assets/symbologySnappingCandidates-1e210adb.js"]));case"scene":return r.addPromise(le(()=>import("./SceneLayerSnappingSource-17ec8d59.js"),["assets/SceneLayerSnappingSource-17ec8d59.js","assets/VertexSnappingCandidate-7fd8e82f.js","assets/PointSnappingHint-76d2669d.js"]))}}};d([p({constructOnly:!0})],$b.prototype,"spatialReference",void 0),d([p({constructOnly:!0})],$b.prototype,"view",void 0),d([p()],$b.prototype,"options",void 0),d([p({readOnly:!0})],$b.prototype,"updating",null),d([p({readOnly:!0})],$b.prototype,"snappingSources",null),$b=d([I("esri.views.interactive.snapping.FeatureSnappingEngine")],$b);class yrr{constructor(e,r){this.snappingSource=e,this.layerView=r,this.handles=new Ri;const i=this.snappingSource.layerSource.layer;if("refresh"in i){const n=i;this.handles.add(n.on("refresh",()=>e.refresh()))}this.handles.add([pe(()=>e.updating,n=>e.layerSource.updating=n,Bi),pe(()=>e.availability,n=>e.layerSource.availability=n,Bi)])}destroy(){this.snappingSource.destroy(),this.handles.destroy()}}function vrr(t){return(t instanceof mrr||t instanceof frr)&&!_rr(t)}function _rr({constraint:{start:t,end:e}}){const r=ks(t,e),i=ug(t,e);return r<Bl()||i/r<wrr}function zJ(t,e,r,i,n,s,{spatialReference:o}){const a=oe(brr,e);a[0]+=r,a[1]+=i,a[2]+=n;const l=Ec(a,o,zo,s);return l?hrr(l,t):1/0}const ROe=A(),brr=A(),wrr=1e-4;let Pq=class{constructor(e,r){this.view=e,this.options=r,this.squaredShortLineThreshold=f_.shortLineThreshold*f_.shortLineThreshold}snap(e,r){return r.vertexHandle!=null?r.vertexHandle.type!=="vertex"?[]:this.snapExistingVertex(e,r):this.snapNewVertex(e,r)}edgeExceedsShortLineThreshold(e,r){return this.exceedsShortLineThreshold(ns(e.leftVertex.pos,this.view,r),ns(e.rightVertex.pos,this.view,r),r)}exceedsShortLineThreshold(e,r,{spatialReference:i}){return this.squaredShortLineThreshold===0||JE(Ec(r,i,zo,this.view),Ec(e,i,zo,this.view))>this.squaredShortLineThreshold}isVertical(e,r){return ug(e,r)<f_.verticalLineThreshold}squaredProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:r}=this.options,i=e*r;return i*i}},xrr=class extends sM{constructor({lineStart:e,lineEnd:r,targetPoint:i,isDraped:n}){super(i,new NWe(e,r),n,ol.SELF),this._referenceLineHint=new v0(gf.REFERENCE_EXTENSION,e,r,n,this.domain)}get hints(){return[this._referenceLineHint,new v0(gf.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Srr=class extends Pq{snapNewVertex(e,r){const i=r.editGeometryOperations.data.components[0],n=i.edges.length,s=[];if(n<1)return s;const{spatialReference:o}=r,a=Ec(e,o,zo,this.view),{view:l}=this,c=i.edges[n-1];let u=c;do{if(this.edgeExceedsShortLineThreshold(u,r)){const h=Bj(u,l,r);this._processCandidateProposal(h.left,h.right,e,a,r,s)}u=u.leftVertex.leftEdge}while(u&&u!==c);return s}snapExistingVertex(e,r){const i=[],n=r.vertexHandle,s=n.component;if(s.edges.length<2)return i;const{view:o}=this,{spatialReference:a}=r,l=Ec(e,a,zo,o),c=n.leftEdge,u=n.rightEdge;c&&u&&this.edgeExceedsShortLineThreshold(c,r)&&this.edgeExceedsShortLineThreshold(u,r)&&this._processCandidateProposal(ns(c.leftVertex.pos,o,r),ns(u.rightVertex.pos,o,r),e,l,r,i);const h=s.edges[0];let f=h;do{if(f!==n.leftEdge&&f!==n.rightEdge&&this.edgeExceedsShortLineThreshold(f,r)){const m=Bj(f,o,r);this._processCandidateProposal(m.left,m.right,e,l,r,i)}f=f.rightVertex.rightEdge}while(f&&f!==h);return i}_processCandidateProposal(e,r,i,n,s,o){var u;const{spatialReference:a,pointer:l}=s,c=Yfe(i,{start:e,end:r,type:pa.LINE});JE(n,Ec(c,a,zo,this.view))<this.squaredProximityThreshold(l)&&o.push(new xrr({lineStart:e,lineEnd:r,targetPoint:c,isDraped:((u=s.elevationInfo)==null?void 0:u.mode)==="on-the-ground"}))}},Trr=class jWe extends Aq{constructor(e,r,i,n=ol.ALL){super(i,n),this.lineStart=e,this.lineEnd=r}equals(e){return e instanceof jWe&&gi(this.lineStart,e.lineStart)&&gi(this.lineEnd,e.lineEnd)}},Err=class extends sM{constructor({referenceLine:e,lineStart:r,targetPoint:i,isDraped:n}){const s=qi(r),{left:o,right:a}=e;ve(s,ge(s,s,a),o),super(i,new NWe(r,s),n,ol.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new v0(gf.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Trr(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new v0(gf.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const r={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{gi(e.right,i.edge.left)&&(i.fadeLeft=!1,r.fadeRight=!1),gi(e.right,i.edge.right)&&(i.fadeRight=!1,r.fadeRight=!1),gi(e.left,i.edge.right)&&(i.fadeRight=!1,r.fadeLeft=!1),gi(e.left,i.edge.left)&&(i.fadeLeft=!1,r.fadeLeft=!1)}),this._referenceLines.push(r)}},Crr=class extends Pq{snapNewVertex(e,r){const i=r.editGeometryOperations.data.components[0],n=i.edges.length,s=i.vertices.length,o=[];if(n<2)return o;const{view:a}=this,l=Ec(e,r.spatialReference,zo,a),c=ns(i.vertices[s-1].pos,a,r),u=ns(i.vertices[0].pos,a,r),h=i.edges[n-1];let f=h;do{if(this.edgeExceedsShortLineThreshold(f,r)){const m=Bj(f,a,r);this._checkEdgeForParallelLines(m,c,e,l,r,o),this._checkEdgeForParallelLines(m,u,e,l,r,o)}f=f.leftVertex.leftEdge}while(f&&f!==h);return o}snapExistingVertex(e,r){const i=[],n=r.vertexHandle,s=n.component;if(s.edges.length<3)return i;const{view:o}=this,a=Ec(e,r.spatialReference,zo,o),l=n.leftEdge,c=n.rightEdge,u=s.vertices[0],h=ns(u.pos,o,r),f=s.vertices.length,m=s.vertices[f-1],g=ns(m.pos,o,r),y=s.edges[0];let _=y;do{if(_!==l&&_!==c&&this.edgeExceedsShortLineThreshold(_,r)){const b=Bj(_,o,r);l&&this._checkEdgeForParallelLines(b,ns(l.leftVertex.pos,o,r),e,a,r,i),c&&this._checkEdgeForParallelLines(b,ns(c.rightVertex.pos,o,r),e,a,r,i),n===u?this._checkEdgeForParallelLines(b,g,e,a,r,i):n===m&&this._checkEdgeForParallelLines(b,h,e,a,r,i)}_=_.rightVertex.rightEdge}while(_&&_!==y);return i}_checkEdgeForParallelLines(e,r,i,n,s,o){var f;const a=e.left,l=e.right;if(FJ(xS,r,a,l),ug(xS,r)<f_.parallelLineThreshold)return;FJ(xS,i,a,l,r);const{spatialReference:c,pointer:u}=s,h=Ue(xS[0],xS[1],i[2]);if(JE(n,Ec(h,c,zo,this.view))<this.squaredProximityThreshold(u)){if(this.isVertical(h,r)||this.isVertical(a,l)||this._parallelToPreviousCandidate(e,o))return;o.push(new Err({referenceLine:e,lineStart:r,targetPoint:h,isDraped:((f=s.elevationInfo)==null?void 0:f.mode)==="on-the-ground"}))}}_parallelToPreviousCandidate(e,r){const i=e.left,n=e.right;for(const s of r)if(FJ(xS,n,s.constraint.start,s.constraint.end,i),ug(xS,n)<f_.parallelLineThreshold)return s.addReferenceLine(e),!0;return!1}};const xS=Qe();class Rrr extends Pq{snapNewVertex(e,r){const i=r.editGeometryOperations.data.components[0],n=i.vertices.length,s=[];if(n<2)return s;const{view:o}=this,a=Ec(e,r.spatialReference,zo,o),l=i.vertices[n-1];if(this.edgeExceedsShortLineThreshold(l.leftEdge,r)){const u=ns(l.pos,o,r),h=ns(l.leftEdge.leftVertex.pos,o,r);this._checkForSnappingCandidate(s,h,u,e,a,r)}const c=i.vertices[0];if(this.edgeExceedsShortLineThreshold(c.rightEdge,r)){const u=ns(c.pos,o,r),h=ns(c.rightEdge.rightVertex.pos,o,r);this._checkForSnappingCandidate(s,h,u,e,a,r)}return s}snapExistingVertex(e,r){const i=[],n=r.vertexHandle;if(n.component.vertices.length<3)return i;const{view:s}=this,o=Ec(e,r.spatialReference,zo,s),a=n.leftEdge,l=n.rightEdge;if(a&&a.leftVertex.leftEdge){const c=a.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(c,r)){const u=ns(c.rightVertex.pos,s,r),h=ns(c.leftVertex.pos,s,r);this._checkForSnappingCandidate(i,h,u,e,o,r)}}if(l&&l.rightVertex.rightEdge){const c=l.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(c,r)){const u=ns(c.leftVertex.pos,s,r),h=ns(c.rightVertex.pos,s,r);this._checkForSnappingCandidate(i,h,u,e,o,r)}}return i}_checkForSnappingCandidate(e,r,i,n,s,o){var f;const{spatialReference:a,pointer:l}=o;os(jU,i,r);const c=se(Orr,jU[1],-jU[0],0),u=Mn(c,os(jU,n,i))/ox(c),h=r_(qi(n),i,c,u);if(JE(s,Ec(h,a,zo,this.view))<this.squaredProximityThreshold(l)){if(this.isVertical(h,i)||this.isVertical(i,r))return;const m=id(A(),i,c,Math.sign(u));e.push(new BWe({targetPoint:h,constraint:new DWe(i,m),previousVertex:r,otherVertex:i,otherVertexType:c3.CENTER,isDraped:((f=o.elevationInfo)==null?void 0:f.mode)==="on-the-ground"}))}}}const jU=Qe(),Orr=A();let Arr=class extends sM{constructor({targetPoint:e,point1:r,point2:i,isDraped:n}){super(e,new LWe(mi(A(),r,i,.5),.5*F_(r,i)),n,ol.SELF),this._p1=r,this._p2=i}get hints(){return[new v0(gf.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new v0(gf.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new zWe(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}},Prr=class extends Pq{snapNewVertex(e,r){const i=r.editGeometryOperations.data.components[0],n=[],s=i.vertices.length;if(r.editGeometryOperations.data.type!=="polygon"||s<2)return n;const{view:o}=this,a=i.vertices[0],l=i.vertices[s-1],c=ns(a.pos,o,r),u=ns(l.pos,o,r);return this._processCandidateProposal(c,u,e,r,n),n}snapExistingVertex(e,r){const i=[],n=r.vertexHandle,s=n.component;if(s.edges.length<2||r.editGeometryOperations.data.type==="polyline"&&(n.index===0||n.index===s.vertices.length-1))return i;const{view:o}=this,a=ns(n.leftEdge.leftVertex.pos,o,r),l=ns(n.rightEdge.rightVertex.pos,o,r);return this._processCandidateProposal(a,l,e,r,i),i}_processCandidateProposal(e,r,i,n,s){var m;if(!this.exceedsShortLineThreshold(e,r,n))return;const o=ih(Mrr,e,r,.5),a=.5*F_(e,r),l=A();Qtr(l,i,o,a),l[2]=i[2];const c=l,{spatialReference:u,pointer:h}=n,f=Ec(i,u,zo,this.view);if(JE(f,Ec(c,u,zo,this.view))<this.squaredProximityThreshold(h)){if(this.isVertical(e,c)||this.isVertical(c,r))return;s.push(new Arr({targetPoint:c,point1:e,point2:r,isDraped:((m=n.elevationInfo)==null?void 0:m.mode)==="on-the-ground"}))}}};const Mrr=Qe();let TO=class extends Ce{constructor(e){super(e),this.updating=!1,this._snappers=new vt,this._domain=ol.SELF}initialize(){this._snappers.push(new Crr(this.view,this.options),new Srr(this.view,this.options),new Rrr(this.view,this.options),new Prr(this.view,this.options))}set options(e){this._set("options",e);for(const r of this._snappers)r.options=e}async fetchCandidates(e,r,i){if(!(r&this._domain&&this.options.effectiveSelfEnabled))return[];const n=[];for(const s of this._snappers.items)for(const o of s.snap(e,i))n.push(o);return Qfe(e,n),n}};d([p({readOnly:!0})],TO.prototype,"updating",void 0),d([p({constructOnly:!0})],TO.prototype,"view",void 0),d([p()],TO.prototype,"options",null),TO=d([I("esri.views.interactive.snapping.SelfSnappingEngine")],TO);function $rr(t,e){return[new TO({view:t,options:e}),new $b({view:t,options:e,spatialReference:t.spatialReference})]}let PT=class extends Ce{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1}};d([p({constructOnly:!0})],PT.prototype,"layer",void 0),d([p()],PT.prototype,"enabled",void 0),d([p()],PT.prototype,"updating",void 0),d([p()],PT.prototype,"availability",void 0),PT=d([I("esri.views.interactive.snapping.FeatureSnappingLayerSource")],PT);const GWe=PT;let qd=class extends Ce{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.featureSources=new vt,this.distance=f_.distance,this.touchSensitivityMultiplier=f_.touchSensitivityMultiplier}get effectiveEnabled(){return this.enabledToggled?!this.enabled:this.enabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}};d([p()],qd.prototype,"enabled",void 0),d([p()],qd.prototype,"enabledToggled",void 0),d([p()],qd.prototype,"selfEnabled",void 0),d([p()],qd.prototype,"featureEnabled",void 0),d([p({type:vt.ofType(GWe)})],qd.prototype,"featureSources",void 0),d([p()],qd.prototype,"distance",void 0),d([p()],qd.prototype,"touchSensitivityMultiplier",void 0),d([p({readOnly:!0})],qd.prototype,"effectiveEnabled",null),d([p({readOnly:!0})],qd.prototype,"effectiveSelfEnabled",null),d([p({readOnly:!0})],qd.prototype,"effectiveFeatureEnabled",null),qd=d([I("esri.views.interactive.snapping.SnappingOptions")],qd);const tme=qd;let Irr=class HWe extends Aq{constructor(e,r,i=ol.ALL){super(r,i),this.intersectionPoint=e}equals(e){return e instanceof HWe&&gi(this.intersectionPoint,e.intersectionPoint)}},GU=class extends sM{constructor(e,r,i,n){super(e,new MWe(e,r.constraint,i.constraint),n,ol.ALL),this.first=r,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Irr(this.targetPoint,this.isDraped,this.domain)]}},hm=class extends pn.EventedMixin(aE){constructor(e){super(e),this.options=new tme,this.snappingEnginesFactory=$rr,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Iv.MAIN}initialize(){this.handles.add([pe(()=>{const{effectiveFeatureEnabled:e,effectiveSelfEnabled:r,touchSensitivityMultiplier:i,distance:n}=this.options;return{effectiveFeatureEnabled:e,effectiveSelfEnabled:r,touchSensitivityMultiplier:i,distance:n}},()=>{this.doneSnapping(),this.emit("changed")},li),pe(()=>this.options,e=>{for(const r of this._engines)r.options=e},li),pe(()=>({viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,snappingEnginesFactory:this.snappingEnginesFactory}),({viewReady:e,snappingEnginesFactory:r})=>this._recreateEngines(e,r),Bi)])}destroy(){this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)}_recreateEngines(e,r){if(this._destroyEngines(),!e)return;const{view:i,options:n}=this;this._engines=r(i,n)}_destroyEngines(){for(const e of this._engines)e.destroy();this._engines=[]}get _squaredMouseProximityTreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:r}=this.options,i=e*r;return i*i}get _squaredSatisfiesConstraintThreshold(){return f_.satisfiesConstraintScreenThreshold*f_.satisfiesConstraintScreenThreshold}async snap(e){return Lrr(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:r,context:i}=e;this._removeVisualization();const n=this._currentMainCandidate;if(n==null)return r;const s=this._selectUpdateInput(e);if(s==null)return r;const{spatialReference:o}=i,a=o0(s,o);if(a==null)return r;const{view:l}=this,{elevationInfo:c,visualizer:u}=i,h=[],f=OL(a,l,i),m=n.constraint.closestTo(f);if(!this._arePointsWithinScreenThreshold(f,m,i))return this._resetSnappingState(),r;n.targetPoint=m,h.push(...n.hints);for(const g of this._currentOtherActiveCandidates)g.targetPoint=m,h.push(...g.hints);return u!=null&&this.handles.add(u.draw(h,{spatialReference:o,elevationInfo:Drr(i),view:l,selfSnappingZ:i.selfSnappingZ}),HU),xOe(m,l,{z:r.z,m:r.m,spatialReference:r.spatialReference,elevationInfo:c})}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:r}){switch(this._currentSnappedType){case Iv.MAIN:return e;case Iv.SCENE:return r}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Iv.MAIN}_removeVisualization(){this.handles.remove(HU)}async _snapSinglePoint({point:e,context:r,signal:i}){const{view:n}=this,s=OL(e,n,r),o=await this._fetchCandidates(s,ol.ALL,r,i);return this._createSnapResult(s,Iv.MAIN,o,n,r,{z:e.z,m:e.m,spatialReference:e.spatialReference,elevationInfo:r.elevationInfo},i)}async _snapMultiPoint({point:e,scenePoint:r,context:i,signal:n}){const{view:s}=this,{coordinateHelper:o,spatialReference:a}=i;await sue(r.spatialReference,a);const l=o0(r,a),c=OL(l,s,i),u=await this._fetchCandidates(c,ol.FEATURE,i,n);if(u.length>0){const m=await this._fetchCandidates(c,ol.SELF,i,n);return this._createSnapResult(c,Iv.SCENE,[...u,...m],s,i,{z:l.z,m:l.m,spatialReference:l.spatialReference,elevationInfo:i.elevationInfo},n)}const h=OL(e,s,i),f=await this._fetchCandidates(h,ol.SELF,i,n);return this._createSnapResult(h,Iv.MAIN,f,s,i,{z:o.hasZ()&&e.hasZ?e.z??0:void 0,m:o.hasM()&&e.hasM?e.m??0:void 0,spatialReference:e.spatialReference,elevationInfo:i.elevationInfo},n)}async _fetchCandidates(e,r,i,n){return(await Promise.all(this._engines.map(s=>s.fetchCandidates(e,r,i,n)))).flat()}_createSnapResult(e,r,i,n,s,o,a){return{get valid(){return!go(a)},apply:()=>{const{spatialReference:l}=s,{snappedPoint:c,hints:u}=this._processCandidates(e,r,i,s);return this._removeVisualization(),s.visualizer!=null&&this.handles.add(s.visualizer.draw(u,{spatialReference:l,elevationInfo:zo,view:n,selfSnappingZ:s.selfSnappingZ}),HU),xOe(c,n,o)}}}_processCandidates(e,r,i,n){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==r&&this._resetSnappingState(),Qfe(e,i);const s=this._currentMainCandidate;if(s!=null){const o=this._findOldConstraintInNewCandidates(s,i);if(o>=0){if(!(i[o]instanceof GU))return this._intersectWithOtherCandidates(o,i,e,r,n);if(this._arePointsWithinScreenThreshold(e,s.targetPoint,n))return this._updateSnappingCandidate(s,r,i,n)}}return this._intersectWithOtherCandidates(0,i,e,r,n)}_findOldConstraintInNewCandidates(e,r){return e instanceof GU?this._findOldCandidateIndex(r,e.first)>=0&&this._findOldCandidateIndex(r,e.second)>=0?0:-1:this._findOldCandidateIndex(r,e)}_intersectWithOtherCandidates(e,r,i,n,s){const{coordinateHelper:o}=s,a=r[e],l=[];for(let c=0;c<r.length;++c){if(c===e)continue;const u=r[c];for(const h of a.constraint.intersect(u.constraint)){const f=h.closestTo(a.targetPoint);l.push([new GU(f,a,u,u.isDraped),this._squaredScreenDistance(i,f,o)])}}return l.length>0&&(l.sort((c,u)=>c[1]-u[1]),l[0][1]<this._squaredPointProximityThreshold(s.pointer))?this._updateSnappingCandidate(l[0][0],n,r,s):this._updateSnappingCandidate(a,n,r,s)}_updateSnappingCandidate(e,r,i,n){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=r;const s=this._currentMainCandidate.targetPoint,o=[];o.push(...e.hints);for(const a of i){if(e instanceof GU){if(a.constraint.equals(e.first.constraint)||a.constraint.equals(e.second.constraint))continue}else if(a.constraint.equals(e.constraint))continue;const l=a.constraint.closestTo(s);this._squaredScreenDistance(l,s,n.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(a.targetPoint=s,this._currentOtherActiveCandidates.push(a),o.push(...a.hints))}return{snappedPoint:s,hints:o}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}_arePointsWithinScreenThreshold(e,r,i){return this._squaredScreenDistance(e,r,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,r,i){return JE(this._toScreen(e,i),this._toScreen(r,i))}_toScreen(e,r){return Ec(e,r.spatialReference,zo,this.view)}_findOldCandidateIndex(e,r){let i=-1;for(let n=0;n<e.length;++n)if(r.constraint.equals(e[n].constraint)){i=n;break}return i}get test(){return{visualizationsActive:this.handles.has(HU),engines:this._engines}}};var Iv;d([p({constructOnly:!0})],hm.prototype,"view",void 0),d([p()],hm.prototype,"options",void 0),d([p({readOnly:!0})],hm.prototype,"updating",null),d([p()],hm.prototype,"snappingEnginesFactory",void 0),d([p()],hm.prototype,"_engines",void 0),d([p()],hm.prototype,"_squaredMouseProximityTreshold",null),d([p()],hm.prototype,"_squaredTouchProximityThreshold",null),d([p()],hm.prototype,"_squaredSatisfiesConstraintThreshold",null),hm=d([I("esri.views.interactive.snapping.SnappingManager")],hm),function(t){t[t.MAIN=0]="MAIN",t[t.SCENE=1]="SCENE"}(Iv||(Iv={}));const HU="visualization-handle";function Lrr(t){return t.scenePoint!=null}function Drr({coordinateHelper:t,elevationInfo:e}){return t.hasZ()?zo:e}let wl=class extends pn.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:this.activeComponent}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){var e;(e=this.activeComponent)==null||e.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};d([p()],wl.prototype,"activeComponent",void 0),d([p()],wl.prototype,"cancelled",void 0),d([p()],wl.prototype,"history",void 0),d([p()],wl.prototype,"tool",null),d([p()],wl.prototype,"type",void 0),d([p()],wl.prototype,"canUndo",null),d([p()],wl.prototype,"canRedo",null),d([p()],wl.prototype,"onEnd",void 0),d([p()],wl.prototype,"undo",null),d([p()],wl.prototype,"redo",null),d([p()],wl.prototype,"toggleTool",void 0),d([p()],wl.prototype,"addToSelection",void 0),d([p()],wl.prototype,"removeFromSelection",void 0),wl=d([I("esri.widgets.Sketch.support.OperationHandle")],wl);let S9=class extends wl{};d([p()],S9.prototype,"activeComponent",void 0),S9=d([I("esri.widgets.Sketch.support.CreateOperationHandle")],S9);let kv=class extends wl{};d([p()],kv.prototype,"activeComponent",void 0),kv=d([I("esri.widgets.Sketch.support.UpdateOperationHandle")],kv);const OOe={defaultZ:0},D$={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let Vn=class extends pn.EventedAccessor{constructor(t){super(t),this._numUpdating=0,this._handles=new Ri,this._internalGraphicsLayer=new Hfe({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandles=new Ri,this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.labelOptions=new wWe,this.layer=null,this.pointSymbol=new lg({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new X_({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Rd({color:[130,130,130,1],width:2}),this.meshSymbol=new pF({symbolLayers:[new F3]}),this._snappingManager=null,this.tooltipOptions=new xWe,this.updateGraphics=new vt,this.updateOnGraphicClick=!0,this.vertexSymbol=new lg({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._originalPopupEnabled=null,this.defaultCreateOptions=OOe,this.defaultUpdateOptions=D$,this.snappingOptions=new tme}initialize(){this._handles.add([da(()=>{var t,e;return(e=(t=this.view)==null?void 0:t.map)==null?void 0:e.layers},"change",t=>{t.removed.includes(this.layer)&&this.cancel()}),da(()=>{var t;return(t=this.layer)==null?void 0:t.graphics},"change",t=>{if(this._operationHandle!=null)for(const e of t.removed)this.updateGraphics.includes(e)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(e):this._operationHandle.cancel())}),pe(()=>{var t;return((t=this.layer)==null?void 0:t.elevationInfo)??null},t=>{t!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=t)},Bi),pe(()=>this.view,t=>{qe(this._snappingManager),t&&(this._snappingManager=new hm({view:t,options:this.snappingOptions}),t.type==="2d"?le(()=>import("./editingTools-5463b443.js"),["assets/editingTools-5463b443.js","assets/SnappingVisualizer2D-de6f0097.js","assets/settings-76e285f6.js","assets/SnappingContext-06ffe599.js","assets/PointSnappingHint-76d2669d.js","assets/editPlaneUtils-97c00230.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/centroid-95e8df64.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js","assets/automaticLengthMeasurementUtils-1eb9d49a.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/automaticAreaMeasurementUtils-6801e194.js","assets/euclideanAreaMeasurementUtils-2c8d453a.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/EditGeometryOperations-642c6092.js","assets/SnappingOperation-58dfc7fe.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js"]):t.type==="3d"&&(le(()=>import("./editingTools-58b2e529.js"),["assets/editingTools-58b2e529.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/TextOverlayItem-aab5180d.js","assets/automaticLengthMeasurementUtils-1eb9d49a.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/VerticesVisualElement-4162f1d8.js","assets/RightAngleQuadVisualElement-d3280488.js","assets/LineVisualElement-d2c1133a.js","assets/VisualElementResources-376ef456.js","assets/PointVisualElement-4c93780d.js","assets/SnappingContext-06ffe599.js","assets/PointSnappingHint-76d2669d.js","assets/manipulatorUtils-a300321b.js","assets/ImageMaterial-fc7d3eab.js","assets/editPlaneUtils-97c00230.js","assets/centroid-95e8df64.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js","assets/automaticAreaMeasurementUtils-6801e194.js","assets/euclideanAreaMeasurementUtils-2c8d453a.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/EditGeometryOperations-642c6092.js","assets/SnappingOperation-58dfc7fe.js","assets/manipulatorUtils-e16e9d30.js","assets/Factory-b8446b63.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js","assets/TranslateTooltipInfos-f23baf92.js","assets/MeshTransform-f49f56fb.js","assets/sliceToolUtils-e90afac1.js","assets/ExtentTooltipInfos-59594bb2.js"]),le(()=>import("./GraphicsLayerView3D-fa8a8aeb.js"),["assets/GraphicsLayerView3D-fa8a8aeb.js","assets/LayerView3D-d89227ef.js","assets/queryForSymbologySnapping-17730445.js","assets/GraphicsProcessor-e1abb931.js","assets/Graphics3DObjectStates-a49c32e0.js","assets/rendererConversion-0f993bc8.js","assets/optimizedFeatureQueryEngineAdapter-cf9b637f.js","assets/centroid-8e8cfa47.js","assets/PooledRBush-295d6ce1.js","assets/quickselect-8ff2a76e.js","assets/projectExtentUtils-3af128e1.js","assets/LayerView-18befeb9.js"])))},Bi),pe(()=>{var t;return(t=this.view)==null?void 0:t.spatialReference},(t,e)=>{t&&e&&!t.equals(e)&&this.cancel()})]),prr(this)}destroy(){this.cancel(),this._handles=qe(this._handles),this._viewHandles=qe(this._viewHandles),this._removeDefaultLayer(),this._snappingManager=qe(this._snappingManager),this._set("view",null),this.emit("destroy")}get _defaultUpdateTool(){var t;return((t=this.view)==null?void 0:t.type)==="3d"?"move":"transform"}get updating(){return this._numUpdating>0||this._snappingManager!=null&&this._snappingManager.updating}get activeTool(){var t;return((t=this._operationHandle)==null?void 0:t.tool)??null}get activeComponent(){var t;return((t=this._operationHandle)==null?void 0:t.activeComponent)??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(t){this._set("defaultCreateOptions",{...OOe,...t})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(t){this._set("defaultUpdateOptions",{...D$,...t,reshapeOptions:{...D$.reshapeOptions,...t==null?void 0:t.reshapeOptions},highlightOptions:{...D$.highlightOptions,...t==null?void 0:t.highlightOptions}})}set snappingOptions(t){this._snappingManager!=null&&(this._snappingManager.options=t),this._set("snappingOptions",t)}get state(){var r;const t=!(!((r=this.view)!=null&&r.ready)||!this.layer),e=this._operationHandle;return t&&e?"active":t?"ready":"disabled"}get view(){return this._get("view")}set view(t){const e=this._get("view");if(e){const{container:i,map:n}=e;i&&(e.cursor=null),n&&n.remove(this._internalGraphicsLayer),this._viewHandles.removeAll(),this.cancel()}const r="view-ready";this._handles.remove(r),t&&this._handles.add(du(()=>t.ready,i=>{this._viewHandles.removeAll(),i&&this._viewHandles.add(this._generateViewHandles(t))},Bi),r),this._set("view",t)}cancel(){this._moduleLoaderAbortController=xc(this._moduleLoaderAbortController),this._viewReadyAbortController=xc(this._viewReadyAbortController),this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:t,updateGraphics:e}=this;if(t==="active"&&e.length){const{activeTool:r,layer:i}=this,n=e.toArray();i.removeMany(n),this.cancel(),this._emitDeleteEvent({graphics:n,tool:r})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const t=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(t),this.emit("duplicate",{graphics:t,type:"duplicate"}),t}return[]}async create(t,e){this.cancel(),await this._waitViewReady();const{view:r,layer:i}=this;if(!r||this.state==="disabled")throw i||this._logMissingLayer(),Wr();if(r.activeTool!=null&&(r.activeTool=null),!t)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");bOe(r,this._internalGraphicsLayer);const n=await this._setupCreateOperation(t,e);if(n==null||this.destroyed)return void r.map.remove(this._internalGraphicsLayer);const s=()=>{if(n===this._operationHandle){const o=this.createGraphic,a=this._operationHandle.cancelled;this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),n.cancelled||o==null||i.add(o),this.emit("create",{graphic:o,state:a?"cancel":"complete",tool:t,toolEventInfo:null,type:"create"})}};n.on("complete",s),this._operationHandle=n,r.ready&&r.focus()}async update(t,e){this.cancel(),await this._waitViewReady();const{layer:r,view:i,state:n}=this;if(!i||n==="disabled")throw r||this._logMissingLayer(),Wr();i.activeTool!=null&&(i.activeTool=null);const s=Array.isArray(t)?t:[t];if(t==null||!s||!s.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(a=>a.layer!==r?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):a.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const o=await this._setupUpdateOperation(s,e);this.destroyed||o==null||Go(o)||(bOe(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(o,e),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:o.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(t){const e=this.view;if(e){this._beginAsyncOperation(),t=Array.isArray(t)?t:[t];for(const r of t)r.geometry==null||r.geometry.type==="mesh"||So(r.geometry.spatialReference,e.spatialReference)||(lf(r.geometry.spatialReference,e.spatialReference)||tF()||await wP(),r.geometry=o0(r.geometry,e.spatialReference));this._endAsyncOperation()}else this._logMissingView()}undo(){var t;this.canUndo()&&((t=this._operationHandle)==null||t.undo())}redo(){var t;this.canRedo()&&((t=this._operationHandle)==null||t.redo())}canUndo(){return!(!this._operationHandle||!this._operationHandle.canUndo())}canRedo(){return!(!this._operationHandle||!this._operationHandle.canRedo())}toggleUpdateTool(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()}async _getFirstHit(t){const e=this.view;if(!e)return this._logMissingView(),null;if(e.type==="2d"){const n=[];e.map.allLayers.forEach(o=>{o.type!=="vector-tile"&&o.type!=="imagery"||n.push(o)});const s=await e.hitTest(t,{exclude:n});return CYt(s.results)}const r=[e.map.ground];e.map.allLayers.forEach(n=>{n.type==="integrated-mesh"&&r.push(n)});const i=await e.hitTest(t,{exclude:r});if(i.results.length>0){const n=i.results[0];if(n!=null&&n.type==="graphic"&&n.graphic&&(!i.ground.mapPoint||e.map.ground.opacity<1||i.ground.distance-(n.distance??0)>-Math.min(3*i.ground.distance,e.viewingMode==="global"?Xr(e.renderCoordsHelper.spatialReference).radius/e.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return n}return null}_generateViewHandles(t){return[t.on("immediate-click",async e=>{var s;const r=this.state==="active"&&((s=this._operationHandle)==null?void 0:s.type)==="create";if(this.state==="disabled"||r||!this.updateOnGraphicClick)return;this._beginAsyncOperation();const i=await e.async(()=>this._getFirstHit(gp(e)));let n=null;if(i!=null){const o=i.graphic;this.updateGraphics.includes(o)||o.layer===this.layer?(e.stopPropagation(),n=o):t.type!=="2d"||this._isComponentGraphic(o)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();n==null||this.updateGraphics.includes(n)||await this.update([n],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}}),this._endAsyncOperation()},Pn.WIDGET)]}async _setupCreateOperation(t,e){const r=this.view;if(!r)return this._logMissingView(),null;const i={hasZ:r.type==="3d",...this.defaultCreateOptions,...e},n=await this._setupDrawGraphicTool(t,r,i);return n==null?null:(r.tools.add(n),r.activeTool=n,this._setupCreateOperationHandle(n))}async _setupDrawGraphicTool(t,e,r){if(t==="multipoint"&&e.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!e)return this._logMissingView(),null;const i=t!=="rectangle",n=t!=="rectangle",s={view:e,mode:t==="rectangle"||t==="circle"?"hybrid":"click",...r,snapToScene:!1,geometryType:t,graphicSymbol:this._getGraphicSymbolFromTool(t),snappingManager:this._snappingManager,forceUniformSize:n,centered:i};return e.type==="2d"?this._makeDrawGraphicTool2D(s):this._makeDrawGraphicTool3D(s)}async _makeDrawGraphicTool2D(t){const e=await this._requireModule(le(()=>import("./editingTools-5463b443.js"),["assets/editingTools-5463b443.js","assets/SnappingVisualizer2D-de6f0097.js","assets/settings-76e285f6.js","assets/SnappingContext-06ffe599.js","assets/PointSnappingHint-76d2669d.js","assets/editPlaneUtils-97c00230.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/centroid-95e8df64.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js","assets/automaticLengthMeasurementUtils-1eb9d49a.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/automaticAreaMeasurementUtils-6801e194.js","assets/euclideanAreaMeasurementUtils-2c8d453a.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/EditGeometryOperations-642c6092.js","assets/SnappingOperation-58dfc7fe.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js"]));return Go(e)||this.destroyed?null:new e.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Frr(t.geometryType)?this.activeFillSymbol:null,tooltipOptions:this.tooltipOptions})}async _makeDrawGraphicTool3D(t){const e=await this._requireModule(le(()=>import("./editingTools-58b2e529.js"),["assets/editingTools-58b2e529.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/TextOverlayItem-aab5180d.js","assets/automaticLengthMeasurementUtils-1eb9d49a.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/VerticesVisualElement-4162f1d8.js","assets/RightAngleQuadVisualElement-d3280488.js","assets/LineVisualElement-d2c1133a.js","assets/VisualElementResources-376ef456.js","assets/PointVisualElement-4c93780d.js","assets/SnappingContext-06ffe599.js","assets/PointSnappingHint-76d2669d.js","assets/manipulatorUtils-a300321b.js","assets/ImageMaterial-fc7d3eab.js","assets/editPlaneUtils-97c00230.js","assets/centroid-95e8df64.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js","assets/automaticAreaMeasurementUtils-6801e194.js","assets/euclideanAreaMeasurementUtils-2c8d453a.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/EditGeometryOperations-642c6092.js","assets/SnappingOperation-58dfc7fe.js","assets/manipulatorUtils-e16e9d30.js","assets/Factory-b8446b63.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js","assets/TranslateTooltipInfos-f23baf92.js","assets/MeshTransform-f49f56fb.js","assets/sliceToolUtils-e90afac1.js","assets/ExtentTooltipInfos-59594bb2.js"]));if(Go(e)||this.destroyed)return null;const{elevationInfo:r}=this.layer;return new e.module.DrawGraphicTool3D({...t,elevationInfo:r,snapToScene:r==null||r.mode==="absolute-height",labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions})}_setupCreateOperationHandle(t){const e=this.view;if(!e)return this._logMissingView(),null;let r=null;const i=t.forceUniformSize,n=t.centered,s=[e.on("key-down",a=>{if(a.key===jo.pan)a.stopPropagation(),a.repeat||(t.enabled=!1);else if(a.key===jo.complete)a.stopPropagation(),t.completeCreateOperation();else if(a.key!==jo.vertexAdd||a.repeat)a.key===jo.undo?(a.stopPropagation(),o.undo()):a.key===jo.redo?(a.stopPropagation(),o.redo()):a.key!==jo.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"||a.repeat?a.key===jo.center&&(a.repeat||(t.centered=!n,a.stopPropagation())):(t.forceUniformSize=!i,a.stopPropagation());else{const l=t.drawOperation.geometryType;l!=="polyline"&&l!=="polygon"&&l!=="multipoint"||(a.stopPropagation(),t.drawOperation.commitStagedVertex())}},Pn.WIDGET),e.on("key-up",a=>{a.key===jo.pan?t.enabled=!0:a.key!==jo.constraint||t.geometryType!=="rectangle"&&t.geometryType!=="circle"?a.key===jo.center&&(t.centered=n,a.stopPropagation()):(t.forceUniformSize=i,a.stopPropagation())},Pn.WIDGET),t.on("vertex-add",a=>{switch(r=r==null?"start":"active",a.operation){case"apply":this.emit("create",{graphic:t.graphic,state:r,tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("cursor-update",a=>{t.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:a.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),t.on("vertex-remove",a=>{switch(a.operation){case"apply":this.emit("create",{graphic:t.graphic,state:"active",tool:this.activeTool,toolEventInfo:a,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[t.graphic],tool:t.geometryType});break;case"redo":this._emitRedoEvent({graphics:[t.graphic],tool:t.geometryType})}}),t.on("complete",a=>{this._set("createGraphic",a.graphic),r="complete",a.aborted?o&&o.cancel():o&&o.complete()}),pe(()=>this._getGraphicSymbolFromTool(t.geometryType),a=>{t.graphicSymbol=a})],o=new S9({activeComponent:t,tool:t.geometryType,type:"create",onEnd:()=>{var a;s.forEach(l=>l.remove()),s.length=0,(a=e.tools)==null||a.remove(t)},undo:()=>{t.canUndo&&t.undo()},redo:()=>{t.canRedo&&t.redo()},canUndo:()=>t.canUndo,canRedo:()=>t.canRedo});return o}_getGraphicSymbolFromTool(t){switch(t){case"point":case"multipoint":return this.pointSymbol;case"polyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(t,e){var o;const{layer:r,view:i}=this;if(!i)return this._logMissingView(),null;const n={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...e,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...e==null?void 0:e.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...e==null?void 0:e.highlightOptions}};let s=n.tool;for(const a of t)r.remove(a),r.add(a);if(i.type==="3d"){if(t.length===0)return null;switch(s){case"move":return this._setupMove3DOperation(t,n,i,s);case"reshape":{if(t.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const a=VU(t[0]);return a===dn.SUPPORTED?this._setupReshape3DOperation(t[0],n,i):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${DJ(a)}).`),null)}case"transform":return this._setupGraphicTransform3DOperation(t,n,i)}}switch(s){case"move":return this._setupMove2DOperation(t,n,i);case"reshape":{if(t.length>1)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;const a=VU(t[0]);return a===dn.SUPPORTED?this._setupTransformOrReshape2DOperation(t,s,n,i):(this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${DJ(a)}).`),null)}case"transform":if(t.length===1){const a=(o=t[0].geometry)==null?void 0:o.type;a!=="point"&&a!=="multipoint"||(s="reshape")}return this._setupTransformOrReshape2DOperation(t,s,n,i)}}async _setupMove3DOperation(t,e,r,i,n=!1){for(const c of t){const u=Htr(c);if(u!==dn.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${DJ(u)}).`),null}const s=await this._requireModule(le(()=>import("./editingTools-58b2e529.js"),["assets/editingTools-58b2e529.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/TextOverlayItem-aab5180d.js","assets/automaticLengthMeasurementUtils-1eb9d49a.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/VerticesVisualElement-4162f1d8.js","assets/RightAngleQuadVisualElement-d3280488.js","assets/LineVisualElement-d2c1133a.js","assets/VisualElementResources-376ef456.js","assets/PointVisualElement-4c93780d.js","assets/SnappingContext-06ffe599.js","assets/PointSnappingHint-76d2669d.js","assets/manipulatorUtils-a300321b.js","assets/ImageMaterial-fc7d3eab.js","assets/editPlaneUtils-97c00230.js","assets/centroid-95e8df64.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js","assets/automaticAreaMeasurementUtils-6801e194.js","assets/euclideanAreaMeasurementUtils-2c8d453a.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/EditGeometryOperations-642c6092.js","assets/SnappingOperation-58dfc7fe.js","assets/manipulatorUtils-e16e9d30.js","assets/Factory-b8446b63.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js","assets/TranslateTooltipInfos-f23baf92.js","assets/MeshTransform-f49f56fb.js","assets/sliceToolUtils-e90afac1.js","assets/ExtentTooltipInfos-59594bb2.js"]));if(Go(s))return s;const o=new s.module.GraphicMoveTool({view:r,enableZ:e.enableZ,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});r.tools.add(o),o.graphics.addMany(t),n||this.updateGraphics.addMany(t);const a=[],l=new kv({activeComponent:o,tool:i,type:"update",onEnd:()=>{var c;a.forEach(u=>u.remove()),a.length=0,(c=r.tools)==null||c.remove(o),o.destroyed||o.destroy()},undo:()=>{qU(l,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{WU(l,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:c=>{this.updateGraphics.push(c),o.graphics.push(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:c=>{const u=this.updateGraphics.indexOf(c);l.history.undo.forEach(h=>h.updates.splice(u,1)),l.history.redo.forEach(h=>h.updates.splice(u,1)),this.updateGraphics.remove(c),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics.remove(c):l.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1||i!=="transform")return;const c=this.updateGraphics.at(0);if(VU(c)!==dn.SUPPORTED)return;l.onEnd(),l.destroy();const u=await this._setupReshape3DOperation(c,e,r,!0);Go(u)||this._setUpdateOperationHandle(u,e)}});return a.push(...this._getHandlesForComponent(l,e),r.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(l,c,e),Pn.WIDGET),r.on("key-down",c=>{this._getCommonUpdateOperationKeyDownHandlers(l,c)},Pn.WIDGET)),l}_setupGraphicTransform3DOperation(t,e,r,i=!1){if(t.length===1&&Ztr(t[0])===dn.SUPPORTED){const n=t[0],s=n.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(n,e,r);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(n,e,r,i)}return this._setupMove3DOperation(t,e,r,"transform",i)}async _setupPointTransform3DOperation(t,e,r){const i="transform",{enableRotation:n,enableScaling:s,enableZ:o}=e,a=await this._requireModule(le(()=>import("./editingTools-58b2e529.js"),["assets/editingTools-58b2e529.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/TextOverlayItem-aab5180d.js","assets/automaticLengthMeasurementUtils-1eb9d49a.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/VerticesVisualElement-4162f1d8.js","assets/RightAngleQuadVisualElement-d3280488.js","assets/LineVisualElement-d2c1133a.js","assets/VisualElementResources-376ef456.js","assets/PointVisualElement-4c93780d.js","assets/SnappingContext-06ffe599.js","assets/PointSnappingHint-76d2669d.js","assets/manipulatorUtils-a300321b.js","assets/ImageMaterial-fc7d3eab.js","assets/editPlaneUtils-97c00230.js","assets/centroid-95e8df64.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js","assets/automaticAreaMeasurementUtils-6801e194.js","assets/euclideanAreaMeasurementUtils-2c8d453a.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/EditGeometryOperations-642c6092.js","assets/SnappingOperation-58dfc7fe.js","assets/manipulatorUtils-e16e9d30.js","assets/Factory-b8446b63.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js","assets/TranslateTooltipInfos-f23baf92.js","assets/MeshTransform-f49f56fb.js","assets/sliceToolUtils-e90afac1.js","assets/ExtentTooltipInfos-59594bb2.js"]));if(Go(a))return a;const l=new a.module.GraphicTransformTool({graphic:t,view:r,enableRotation:n,enableScaling:s,enableZ:o,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});r.tools.add(l),this.updateGraphics.add(t);const c=[],u=new kv({activeComponent:l,tool:i,type:"update",onEnd:()=>{var h;c.forEach(f=>f.remove()),c.length=0,(h=r.tools)==null||h.remove(l),l.destroyed||l.destroy()},undo:()=>{qU(u,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{WU(u,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async h=>{this.updateGraphics.add(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"}),u.onEnd(),u.destroy();const f=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,r,"transform",!0);Go(f)||this._setUpdateOperationHandle(f,e)},removeFromSelection:h=>{this.updateGraphics.remove(h),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"}),u.complete()},toggleTool:()=>{}});return c.push(...this._getHandlesForComponent(u,e),r.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(u,h,e),Pn.WIDGET),r.on("key-down",h=>{this._getCommonUpdateOperationKeyDownHandlers(u,h)},Pn.WIDGET)),u}async _setupPolyTransform3DOperation(t,e,r,i=!1){const n="transform",{enableRotation:s,enableScaling:o,enableZ:a,preserveAspectRatio:l}=e,c=await this._requireModule(le(()=>import("./editingTools-58b2e529.js"),["assets/editingTools-58b2e529.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/TextOverlayItem-aab5180d.js","assets/automaticLengthMeasurementUtils-1eb9d49a.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/VerticesVisualElement-4162f1d8.js","assets/RightAngleQuadVisualElement-d3280488.js","assets/LineVisualElement-d2c1133a.js","assets/VisualElementResources-376ef456.js","assets/PointVisualElement-4c93780d.js","assets/SnappingContext-06ffe599.js","assets/PointSnappingHint-76d2669d.js","assets/manipulatorUtils-a300321b.js","assets/ImageMaterial-fc7d3eab.js","assets/editPlaneUtils-97c00230.js","assets/centroid-95e8df64.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js","assets/automaticAreaMeasurementUtils-6801e194.js","assets/euclideanAreaMeasurementUtils-2c8d453a.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/EditGeometryOperations-642c6092.js","assets/SnappingOperation-58dfc7fe.js","assets/manipulatorUtils-e16e9d30.js","assets/Factory-b8446b63.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js","assets/TranslateTooltipInfos-f23baf92.js","assets/MeshTransform-f49f56fb.js","assets/sliceToolUtils-e90afac1.js","assets/ExtentTooltipInfos-59594bb2.js"]));if(Go(c))return c;const u=new c.module.ExtentTransformTool({graphic:t,view:r,enableRotation:s,enableScaling:o,enableZ:a,preserveAspectRatio:l,tooltipOptions:this.tooltipOptions});r.tools.add(u),i||this.updateGraphics.add(t);const h=[],f=new kv({activeComponent:u,tool:n,type:"update",onEnd:()=>{var m;h.forEach(g=>g.remove()),h.length=0,(m=r.tools)==null||m.remove(u),u.destroyed||u.destroy()},canUndo:()=>u.canUndo,undo:()=>{u.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},canRedo:()=>u.canRedo,redo:()=>{u.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async m=>{this.updateGraphics.add(m),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[m],removed:[],type:"selection-change"},type:"update"}),f.onEnd(),f.destroy();const g=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,r,"transform",!0);Go(g)||this._setUpdateOperationHandle(g,e)},removeFromSelection:m=>{this.updateGraphics.remove(m),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[m],type:"selection-change"},type:"update"}),f.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||e.toggleToolOnClick===!1)return;const m=this.updateGraphics.at(0);if(VU(m)!==dn.SUPPORTED)return;f.onEnd(),f.destroy();const g=await this._setupReshape3DOperation(m,e,r,!0);Go(g)||this._setUpdateOperationHandle(g,e)}});return h.push(...this._getHandlesForComponent(f,e),r.on("immediate-click",m=>this._getCommonUpdateOperationClickHandlers(f,m,e),Pn.WIDGET),r.on("key-down",m=>this._getCommonUpdateOperationKeyDownHandlers(f,m),Pn.WIDGET),r.on("key-down",m=>{m.key!==jo.constraint||m.repeat||(u.preserveAspectRatio=!u.preserveAspectRatio,m.stopPropagation())},Pn.WIDGET),r.on("key-up",m=>{m.key===jo.constraint&&(u.preserveAspectRatio=!u.preserveAspectRatio,m.stopPropagation())},Pn.WIDGET)),f}async _setupMove2DOperation(t,e,r){const i="move";this.updateGraphics.addMany(t),await this._updateSpatialReference(t);const n=await this._getGraphicMover(t,e,r);if(Go(n))return n;const s=new kv({activeComponent:n,tool:i,type:"update",onEnd:()=>{var c;this._displayDefaultCursor(),l.forEach(u=>u.remove()),a.forEach(u=>u.remove()),l=[],a=[],n.destroy(),(c=this._internalGraphicsLayer)==null||c.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const c=this.updateGraphics.toArray();qU(s,c),s.refreshComponent(),this._emitUndoEvent({graphics:c,tool:i})},redo:()=>{const c=this.updateGraphics.toArray();WU(s,c),s.refreshComponent(),this._emitRedoEvent({graphics:c,tool:i})},addToSelection:async c=>{await this._updateSpatialReference(c),this.updateGraphics.push(c),n.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[c],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:c=>{const u=this.updateGraphics.indexOf(c);s.history.undo.forEach(f=>f.updates.splice(u,1)),s.history.redo.forEach(f=>f.updates.splice(u,1)),this.updateGraphics.remove(c);const h=this.updateGraphics.toArray();this.emit("update",{graphics:h,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[c],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?n.graphics=h:s.complete()}});let o=!1,a=[r.on("immediate-click",c=>this._getCommonUpdateOperationClickHandlers(s,c,e),Pn.WIDGET),r.on("key-down",c=>{this._getCommonUpdateOperationKeyDownHandlers(s,c),c.key!==jo.constraint||c.repeat||(o=!0,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)},Pn.WIDGET),r.on("key-up",c=>{c.key===jo.constraint&&o&&(o=!1,n.enableMoveAllGraphics=!n.enableMoveAllGraphics)},Pn.WIDGET)],l=this._getHandlesForComponent(s,e);return s}async _setupReshape3DOperation(t,e,r,i=!1){const n="reshape",s=await this._requireModule(le(()=>import("./editingTools-58b2e529.js"),["assets/editingTools-58b2e529.js","assets/analysisThemeUtils-b70cecce.js","assets/colorUtils-b3bd0dbf.js","assets/colorUtils-c0f43caf.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/TextOverlayItem-aab5180d.js","assets/automaticLengthMeasurementUtils-1eb9d49a.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/VerticesVisualElement-4162f1d8.js","assets/RightAngleQuadVisualElement-d3280488.js","assets/LineVisualElement-d2c1133a.js","assets/VisualElementResources-376ef456.js","assets/PointVisualElement-4c93780d.js","assets/SnappingContext-06ffe599.js","assets/PointSnappingHint-76d2669d.js","assets/manipulatorUtils-a300321b.js","assets/ImageMaterial-fc7d3eab.js","assets/editPlaneUtils-97c00230.js","assets/centroid-95e8df64.js","assets/InteractiveToolBase-7d85d331.js","assets/drawUtils-4001d27a.js","assets/automaticAreaMeasurementUtils-6801e194.js","assets/euclideanAreaMeasurementUtils-2c8d453a.js","assets/dehydratedFeatureComparison-d8e6ffe2.js","assets/EditGeometryOperations-642c6092.js","assets/SnappingOperation-58dfc7fe.js","assets/manipulatorUtils-e16e9d30.js","assets/Factory-b8446b63.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js","assets/TranslateTooltipInfos-f23baf92.js","assets/MeshTransform-f49f56fb.js","assets/sliceToolUtils-e90afac1.js","assets/ExtentTooltipInfos-59594bb2.js"]));if(Go(s))return s;const o=e.reshapeOptions,a=new s.module.GraphicReshapeTool({view:r,graphic:t,enableZVertex:e.enableZ&&(o==null?void 0:o.vertexOperation)==="move",enableZShape:e.enableZ&&(o==null?void 0:o.shapeOperation)==="move",enableMoveGraphic:(o==null?void 0:o.shapeOperation)==="move"||(o==null?void 0:o.shapeOperation)==="move-xy",enableMidpoints:(o==null?void 0:o.edgeOperation)==="split",enableEdgeOffset:(o==null?void 0:o.edgeOperation)==="offset",snappingManager:this._snappingManager,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions});r.tools.add(a),i||this.updateGraphics.add(t);const l=[],c=new kv({activeComponent:a,tool:n,type:"update",onEnd:()=>{var u;l.forEach(h=>h.remove()),l.length=0,(u=r.tools)==null||u.remove(a),a.destroyed||a.destroy()},canUndo:()=>a.canUndo,undo:()=>{a.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},canRedo:()=>a.canRedo,redo:()=>{a.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async u=>{this.updateGraphics.add(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"}),c.onEnd(),c.destroy();const h=await this._setupMove3DOperation(this.updateGraphics.toArray(),e,r,"transform",!0);Go(h)||this._setUpdateOperationHandle(h,e)},removeFromSelection:u=>{this.updateGraphics.remove(u),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[u],type:"selection-change"},type:"update"}),c.complete()},toggleTool:async()=>{if(e.toggleToolOnClick===!1)return;c.onEnd(),c.destroy();const u=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),e,r,!0);Go(u)||this._setUpdateOperationHandle(u,e)}});return l.push(...this._getHandlesForComponent(c,e),r.on("immediate-click",u=>this._getCommonUpdateOperationClickHandlers(c,u,e),Pn.WIDGET),r.on("key-down",u=>{this._getCommonUpdateOperationKeyDownHandlers(c,u)},Pn.WIDGET)),c}async _setupTransformOrReshape2DOperation(t,e,r,i){this.updateGraphics.addMany(t),await this._updateSpatialReference(t);const n=e==="transform"?await this._getBox(t,r,i):await this._getReshape(t,r,i);if(Go(n))return n;const s=new kv({activeComponent:n,type:"update",onEnd:()=>{a.forEach(l=>l.remove()),o.forEach(l=>l.remove()),a=[],o=[],s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{qU(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{WU(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async l=>{let c=s.activeComponent;if((c==null?void 0:c.type)==="reshape"){const u=[...this.updateGraphics,l];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const h=await this._setupMove2DOperation(u,r,i);if(Go(h))return;this._setUpdateOperationHandle(h,r)}else this.updateGraphics.add(l),c.graphics=this.updateGraphics.toArray(),c.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async l=>{const c=this.updateGraphics.indexOf(l);s.history.undo.forEach(h=>h.updates.splice(c,1)),s.history.redo.forEach(h=>h.updates.splice(c,1)),this.updateGraphics.remove(l);const u=this.updateGraphics.toArray();if(u.length===0)s.complete();else{const h=u[0].geometry;u.length!==1||h==null||h.type!=="point"&&h.type!=="multipoint"?s.activeComponent.graphics=u:s.toggleTool()}this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{var h;if(this.updateGraphics.length>1)return;const l=this.updateGraphics.at(0),c=l.geometry;if(c!=null&&(s.tool==="reshape"&&(c.type==="point"||c.type==="multipoint")||s.tool==="transform"&&c.type==="extent"))return;let u=null;s.tool==="transform"?u=await this._getReshape([l],r,i):s.tool==="reshape"&&(u=await this._getBox([l],r,i)),Go(u)||((h=s.activeComponent)==null||h.destroy(),s.activeComponent=u,s.activeComponent&&(a.forEach(f=>f.remove()),a=this._getHandlesForComponent(s,r)))}});let o=[i.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(s,l,r),Pn.WIDGET),i.on("key-down",l=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,l),l.key===jo.constraint&&!l.repeat&&s){const c=s.activeComponent;c&&c.type==="box"&&(c.preserveAspectRatio=!c.preserveAspectRatio)}},Pn.WIDGET),i.on("key-up",l=>{if(l.key===jo.constraint&&s){const c=s.activeComponent;c&&c.type==="box"&&(c.preserveAspectRatio=!c.preserveAspectRatio)}},Pn.WIDGET)],a=this._getHandlesForComponent(s,r);return s}async _getGraphicMover(t,e,r){const{enableMoveAllGraphics:i,highlightOptions:n}=e,s=await this._requireModule(le(()=>import("./GraphicMover-aa6dda46.js").then(o=>o.G),["assets/GraphicMover-aa6dda46.js","assets/drawUtils-4001d27a.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js"]));return Go(s)?s:new s.module.default({enableMoveAllGraphics:i,highlightsEnabled:!!(n!=null&&n.enabled),indicatorsEnabled:!1,graphics:t,view:r,callbacks:{onGraphicMoveStart:({dx:o,dy:a,graphic:l})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:o,dy:a,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:o,dy:a,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:o,dy:a,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:o,dy:a,graphic:l})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:o,dy:a,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(t,e,r){const{enableRotation:i,enableScaling:n,highlightOptions:s,preserveAspectRatio:o}=e,a=await this._requireModule(le(()=>import("./Box-eea3f577.js"),["assets/Box-eea3f577.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/drawUtils-4001d27a.js","assets/GraphicMover-aa6dda46.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js","assets/settings-76e285f6.js","assets/ExtentTooltipInfos-59594bb2.js","assets/automaticLengthMeasurementUtils-1eb9d49a.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/TranslateTooltipInfos-f23baf92.js"]));return Go(a)?a:new a.module.default({graphics:t,enableRotation:i,enableScaling:n,highlightsEnabled:!!(s!=null&&s.enabled),preserveAspectRatio:o,layer:this._internalGraphicsLayer,view:r,tooltipOptions:this.tooltipOptions,callbacks:{onMoveStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onMove:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onMoveStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onScaleStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onScale:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onScaleStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onRotateStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onRotate:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onRotateStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"})}})}async _getReshape(t,e,r){var a,l,c;const i=((a=e.reshapeOptions)==null?void 0:a.edgeOperation)==="split",n=((l=e.reshapeOptions)==null?void 0:l.shapeOperation)==="move",s=!!((c=e.highlightOptions)!=null&&c.enabled),o=await this._requireModule(le(()=>import("./Reshape-b49a9f85.js"),["assets/Reshape-b49a9f85.js","assets/quantityFormatUtils-ff29e62c.js","assets/unitFormatUtils-b0223a02.js","assets/SnappingVisualizer2D-de6f0097.js","assets/settings-76e285f6.js","assets/SnappingContext-06ffe599.js","assets/PointSnappingHint-76d2669d.js","assets/drawUtils-4001d27a.js","assets/GraphicMover-aa6dda46.js","assets/GraphicManipulator-d4dca446.js","assets/drapedUtils-482b56eb.js","assets/EditGeometryOperations-642c6092.js","assets/automaticLengthMeasurementUtils-1eb9d49a.js","assets/euclideanLengthMeasurementUtils-5fd8aab0.js","assets/measurementUtils-a6d314a6.js","assets/geometryEngine-7f801ff7.js","assets/geometryEngineBase-3a3551e4.js","assets/hydrated-7c582448.js","assets/TranslateTooltipInfos-f23baf92.js","assets/automaticAreaMeasurementUtils-6801e194.js","assets/euclideanAreaMeasurementUtils-2c8d453a.js"]));return Go(o)?o:new o.module.default({enableMidpoints:i,enableMovement:n,graphic:t[0],highlightsEnabled:s,layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions,view:r,callbacks:{onReshapeStart:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onReshape:u=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...u},type:"update"}),onReshapeStop:({mover:u,type:h})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:u,type:h},type:"update"}),onMoveStart:({dx:u,dy:h,mover:f,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:h,mover:f,type:m},type:"update"}),onMove:({dx:u,dy:h,mover:f,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:h,mover:f,type:m},type:"update"}),onMoveStop:({dx:u,dy:h,mover:f,type:m})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:u,dy:h,mover:f,type:m},type:"update"}),onVertexAdd:({added:u,type:h,vertices:f})=>{const m=u.map(g=>gve(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:m,vertices:f,type:h},type:"update"})},onVertexRemove:({removed:u,type:h,vertices:f})=>{const m=u.map(g=>gve(g.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:m,vertices:f,type:h},type:"update"})}}})}_getHandlesForComponent(t,e){const r=t.activeComponent;if(!r)return[];switch(r.type){case"graphic-mover":return[r.on("graphic-click",({graphic:i,viewEvent:n})=>{var s;(s=n.native)!=null&&s.shiftKey&&(n.stopPropagation(),t.removeFromSelection(i))}),r.on("graphic-move-start",i=>t.addToHistory(J0(i.allGraphics)))];case"box":return[r.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(t,e,i)),r.on("move-start",i=>t.addToHistory(J0(i.graphics))),r.on("rotate-start",i=>t.addToHistory(J0(i.graphics))),r.on("scale-start",i=>t.addToHistory(J0(i.graphics)))];case"reshape":return[r.on("graphic-click",i=>this._onTransformOrReshape2DGraphicClick(t,e,i)),r.on("move-start",i=>t.addToHistory(J0([i.mover]))),r.on("reshape-start",i=>t.addToHistory(J0([i.graphic]))),r.on("vertex-add",i=>t.addToHistory(J0([i.oldGraphic]))),r.on("vertex-remove",i=>t.addToHistory(J0([i.oldGraphic])))];case"move-3d":return[r.on("graphic-move-start",i=>{t.addToHistory(J0(i.allGraphics)),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.allGraphics.length>0?i.allGraphics[0]:null,type:"move-start"},type:"update"})}),r.on("graphic-move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:i.dx,dy:i.dy,mover:i.allGraphics.length>0?i.allGraphics[0]:null,type:"move"},type:"update"})}),r.on("graphic-move-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:i.allGraphics.length>0?i.allGraphics[0]:null,type:"move-stop"},type:"update"})}),r.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.graphic],t,e):t.toggleTool()})];case"transform-3d":return[r.on("record-undo",({record:i})=>{t.addToHistory({updates:[i]})}),r.on("graphic-translate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-start"},type:"update"})}),r.on("graphic-translate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move-stop"},type:"update"})}),r.on("graphic-rotate-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.graphic,angle:i.angle,type:"rotate-start"},type:"update"})}),r.on("graphic-rotate-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.graphic,angle:i.angle,type:"rotate-stop"},type:"update"})}),r.on("graphic-scale-start",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-start"},type:"update"})}),r.on("graphic-scale-stop",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale-stop"},type:"update"})}),r.on("graphic-translate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.graphic,dx:i.dxScreen,dy:i.dyScreen,type:"move"},type:"update"})}),r.on("graphic-rotate",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.graphic,angle:i.angle,type:"rotate"},type:"update"})}),r.on("graphic-scale",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:i.graphic,xScale:i.xScale,yScale:i.yScale,type:"scale"},type:"update"})}),r.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.graphic],t,e):t.toggleTool()})];case"reshape-3d":return[r.on("reshape",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),r.on("move",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),r.on("vertex-add",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),r.on("vertex-remove",i=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:i,type:"update"})}),r.on("immediate-click",i=>{i.shiftKey?this._toggleSelection([i.graphic],t,e):t.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(t,e,r){var s;const{graphic:i,viewEvent:n}=r;return(s=n.native)!=null&&s.shiftKey&&i.layer===this.layer?(n.stopPropagation(),t.removeFromSelection(i)):e.toggleToolOnClick?(n.stopPropagation(),t.toggleTool()):void 0}_setUpdateOperationHandle(t,e){var n;this._operationHandle=t;const r=(n=this.view)==null?void 0:n.map;this._disablePopup(e);const i=()=>{if(t===this._operationHandle){const s=this.updateGraphics.toArray(),o=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),r&&r.remove(this._internalGraphicsLayer),this._restorePopup(e),this.emit("update",{graphics:s,state:"complete",aborted:t.cancelled,tool:o,toolEventInfo:null,type:"update"})}};t.on("complete",i)}async _getCommonUpdateOperationClickHandlers(t,e,r){const i=gp(e),n=await e.async(()=>this._getFirstHit(i));if(n==null)return void t.complete();if(e.native.shiftKey&&this._toggleSelection([n.graphic],t,r))return void e.stopPropagation();this.updateGraphics.includes(n.graphic)?e.stopPropagation():t.complete()}_toggleSelection(t,e,r){const i=!!r.multipleSelectionEnabled;return t.some(n=>n!=null&&!(!i||n.layer!==this.layer)&&(this.updateGraphics.includes(n)?e.removeFromSelection(n):e.addToSelection(n),!0))}_getCommonUpdateOperationKeyDownHandlers(t,e){if(!t)return;const r=e.key;r===jo.undo&&t.canUndo()?(e.stopPropagation(),t.undo()):r===jo.redo&&t.canRedo()?(e.stopPropagation(),t.redo()):r===jo.cancel?(e.stopPropagation(),t.cancel()):this.allowDeleteKey&&jo.delete.includes(r)&&this._onDeleteKey(e)}_onDeleteKey(t){var i;if(!this._operationHandle||this._operationHandle.type!=="update")return;const e=this.activeComponent,r=this.updateGraphics.toArray();e!=null&&e.type!=="reshape-3d"&&(e.type!=="reshape"||r.length===1&&((i=r[0].geometry)==null?void 0:i.type)==="point")&&(t.stopPropagation(),this.delete())}_removeDefaultLayer(){var t,e;this._internalGraphicsLayer&&((e=(t=this.view)==null?void 0:t.map)==null||e.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=qe(this._internalGraphicsLayer))}_isComponentGraphic(t){const{activeComponent:e}=this;return!(!t||e==null)&&(t.attributes&&t.attributes.esriSketchTool||e.type==="draw-2d"&&e.graphic===t||(e.type==="box"||e.type==="reshape")&&e.isUIGraphic(t))}_displayPointerCursor(){this.view&&this.view.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view&&this.view.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view&&this.view.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(t,e,r){re.getLogger(this).error(new H(t,e,r))}async _requireModule(t){const e=new AbortController;this._moduleLoaderAbortController=e;const r=await t;return this._moduleLoaderAbortController!==e||e.signal.aborted?{requireError:"aborted"}:{module:r}}_emitUndoEvent(t){this.emit("undo",{...t,type:"undo"})}_emitRedoEvent(t){this.emit("redo",{...t,type:"redo"})}_emitDeleteEvent(t){this.emit("delete",{...t,type:"delete"})}get test(){return{operationHandle:this._operationHandle,defaultUpdateOptions:D$}}wait(){return Zw(()=>!this.updating)}_beginAsyncOperation(){this._numUpdating+=1,this.notifyChange("updating")}_endAsyncOperation(){this._numUpdating-=1,this.notifyChange("updating")}_disablePopupEnabled(t){var e;return((e=this.view)==null?void 0:e.type)!=="3d"||this.updateOnGraphicClick||((t==null?void 0:t.toggleToolOnClick)??!1)}_disablePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(t){this._disablePopupEnabled(t)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const t=this.view;t?(xc(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await ace(Zw(()=>t==null?void 0:t.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",AOe("view"))}_logMissingLayer(){this._logError(Nrr,AOe("layer"))}};d([p()],Vn.prototype,"updating",null),d([p()],Vn.prototype,"_operationHandle",void 0),d([p({readOnly:!0})],Vn.prototype,"activeTool",null),d([p()],Vn.prototype,"activeFillSymbol",void 0),d([p()],Vn.prototype,"activeLineSymbol",void 0),d([p()],Vn.prototype,"activeVertexSymbol",void 0),d([p()],Vn.prototype,"allowDeleteKey",void 0),d([p({readOnly:!0})],Vn.prototype,"createGraphic",null),d([p()],Vn.prototype,"defaultCreateOptions",null),d([p()],Vn.prototype,"defaultUpdateOptions",null),d([p({type:wWe,nonNullable:!0})],Vn.prototype,"labelOptions",void 0),d([p()],Vn.prototype,"layer",void 0),d([p({types:Um})],Vn.prototype,"pointSymbol",void 0),d([p({types:Um})],Vn.prototype,"polygonSymbol",void 0),d([p({types:Um})],Vn.prototype,"polylineSymbol",void 0),d([p()],Vn.prototype,"meshSymbol",void 0),d([p({type:tme,nonNullable:!0})],Vn.prototype,"snappingOptions",null),d([p()],Vn.prototype,"_snappingManager",void 0),d([p({readOnly:!0})],Vn.prototype,"state",null),d([p({type:xWe,nonNullable:!0})],Vn.prototype,"tooltipOptions",void 0),d([p({readOnly:!0})],Vn.prototype,"updateGraphics",void 0),d([p()],Vn.prototype,"updateOnGraphicClick",void 0),d([p({types:Um})],Vn.prototype,"vertexSymbol",void 0),d([p({value:null})],Vn.prototype,"view",null),Vn=d([I("esri.widgets.Sketch.SketchViewModel")],Vn);const Nrr="sketch:missing-property",AOe=t=>`Property '${t}' is missing on SketchViewModel.`;function Frr(t){return t==="polygon"||t==="rectangle"||t==="circle"}function qU(t,e){qWe("undo",t.history.undo,t.history.redo,e)}function WU(t,e){qWe("redo",t.history.redo,t.history.undo,e)}function qWe(t,e,r,i){const n=e.pop();if(!n)return;const s=n.updates,o=[];i.forEach((a,l)=>{const c=s[l];c!=null&&("geometry"in c&&c.geometry!=null&&(o.push({geometry:a.geometry}),a.geometry=c.geometry),"symbol"in c&&c.symbol!=null&&(o.push({symbol:a.symbol}),a.symbol=c.symbol),"undo"in c&&(o.push(c),c[t](a)))}),r.push({updates:o})}function J0(t){return{updates:t.map(e=>({geometry:e.geometry}))}}function Go(t){return"requireError"in t&&t.requireError==="aborted"}const WWe=Vn;async function krr(){return le(()=>import("./geometryEngineJSON-13f5b377.js"),["assets/geometryEngineJSON-13f5b377.js","assets/geometryEngineBase-3a3551e4.js","assets/geometryEngineJSON-53578afa.js","assets/json-48e3ea08.js"])}async function Urr(){return krr().then(({contains:t,intersects:e,overlaps:r,simplify:i})=>({contains:t,intersects:e,overlaps:r,simplify:i}))}async function XWe(t){const{selector:e,candidates:r,currentSelection:i,options:n,view:s}=t;if(!(r&&r.length&&i&&s&&n))return{added:[],removed:[]};const{overlaps:o,intersects:a,contains:l}=n,{spatialReference:c}=s;if(!e)return{added:[],removed:i.removeAll()};const u=e,h=await Urr(),f=[],m=[];return r.forEach(g=>{const y=g.geometry,_=o&&!!h.overlaps(c,u,y),b=a&&!!h.intersects(c,u,y),w=l&&!!h.contains(c,u,y),x=i.includes(g);_||b||w?!x&&f.push(g):x&&m.push(g)}),i.removeMany(m),i.addMany(f),{added:f,removed:m}}let fy=class extends pn.EventedAccessor{constructor({candidates:e,options:r,view:i}){super(),this._activeOptions=null,this._dashedFillSymbol=new X_({color:[0,0,0,0],outline:{style:"dash",color:[12,207,255],width:2}}),this._dashedLineSymbol=new Rd({style:"dash",color:[12,207,255],width:2}),this._defaultOptions={createTool:"rectangle",createOptions:void 0,selectionOptions:{overlaps:!0,intersects:!0,contains:!1}},this._completed=!1,this._handles=new Ri,this._sketchViewModel=new WWe,this._sketchGraphicsLayer=new Hfe({listMode:"hide",internal:!0}),this._transparentPointSymbol=new lg({color:[0,0,0,0],outline:{style:"none",width:0}}),this.candidates=null,this.geometry=null,this.options=null,this.selection=new vt,this.view=null,this.candidates=e,this.options=r,this.view=i;const{_dashedFillSymbol:n,_dashedLineSymbol:s,_sketchViewModel:o,_sketchGraphicsLayer:a,_transparentPointSymbol:l}=this;o.set({layer:a,view:this.view,activePointSymbol:l,activeLineSymbol:s,activeVertexSymbol:l,activeFillSymbol:n,pointSymbol:l,polygonSymbol:n,polylineSymbol:s,vertexSymbol:l}),this._handles.add([o.on("create",c=>this._onSketchEvent(c)),o.on(["undo","redo"],c=>this._onSketchEvent(c))])}initialize(){this._load()}destroy(){this._handles=qe(this._handles)}get state(){const{_completed:e,_sketchViewModel:{state:r}}=this;return e?"complete":r==="active"?"active":"disabled"}cancel(){return this._sketchViewModel.cancel()}async _load(){var n;await((n=this.view)==null?void 0:n.whenReady());const{options:e}=this,{createTool:r,createOptions:i}=this._activeOptions={...this._defaultOptions,...e};this._sketchViewModel.create(r,i)}_onSketchEvent(e){const r=e.type==="create"?e.graphic:e.graphics[0],i=(r==null?void 0:r.geometry)||null,n=e.type==="create"&&e.state==="cancel",s=e.type==="create"&&e.state==="complete";this._processSelectionGeometry(i,s,n)}_processSelectionGeometry(e,r,i){if(this._set("geometry",e),(r||i)&&(this._completed=!0),i)return void this._onComplete([],!0);const{_activeOptions:n,candidates:s,selection:o,view:a}=this;XWe({selector:e,candidates:s,currentSelection:o,options:n.selectionOptions,view:a}).then(({added:l,removed:c})=>{r?this._onComplete(this.selection.toArray(),!1):(l.length||c.length)&&this.emit("selection-change",{added:l,removed:c,type:"selection-change"})})}_onComplete(e,r){this._handles.removeAll(),this.notifyChange("state"),this.emit("complete",{aborted:r,selection:e,type:"complete"})}};d([p()],fy.prototype,"_completed",void 0),d([p()],fy.prototype,"candidates",void 0),d([p({readOnly:!0})],fy.prototype,"geometry",void 0),d([p()],fy.prototype,"options",void 0),d([p({readOnly:!0})],fy.prototype,"selection",void 0),d([p({readOnly:!0})],fy.prototype,"state",null),d([p({value:null})],fy.prototype,"view",void 0),fy=d([I("esri.widgets.support.Selector2D.SelectionOperation2D")],fy);const zrr=fy;let EO=class extends jE(Ce){constructor(e){super(e),this._defaultSelectionOptions={intersects:!0,overlaps:!0,contains:!0},this.candidates=null,this.options=null,this.view=null}draw(e){const{_defaultSelectionOptions:r,candidates:i,options:n,view:s}=this,o={...r,...n,...e==null?void 0:e.selectionOptions};return new zrr({candidates:i,options:{...e,selectionOptions:o},view:s})}async selectionFrom(e,r){const{_defaultSelectionOptions:i,candidates:n,options:s,view:o}=this,a=new vt,l={...i,...s,...r};return await XWe({selector:e,candidates:n,currentSelection:a,options:l,view:o}),a.toArray()}};d([p()],EO.prototype,"candidates",void 0),d([p()],EO.prototype,"options",void 0),d([p({value:null})],EO.prototype,"view",void 0),EO=d([I("esri.widgets.support.Selector2D")],EO);const Vrr=EO;let Cv=class extends pn.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.layers=null,this.selector=new Vrr}destroy(){this._operationHandlesGroup=yi(this._operationHandlesGroup),this.selector.destroy()}get _candidates(){var e;return((e=this.layers)==null?void 0:e.flatMap(r=>r.graphics.toArray()))??[]}get state(){var e,r;return this.activeOperation?"active":(e=this.view)!=null&&e.ready&&((r=this.layers)!=null&&r.length)?"ready":"disabled"}set view(e){this.selector.view=e,this._set("view",e)}cancel(){var e;this.state==="active"&&((e=this.activeOperation)==null||e.cancel(),this.activeOperation=null),this.selector.candidates=null}activate(e){const{state:r}=this;if(r==="disabled")return;r==="active"&&this.cancel(),this.selector.candidates=this._candidates;const i=this.selector.draw(e);return this._operationHandlesGroup=E_([i.once("complete",n=>this._onOperationComplete(n)),i.on("selection-change",n=>this._onOperationSelectionChange(n))]),this.activeOperation=i,i}_onOperationSelectionChange(e){this.emit("selection-change",e)}_onOperationComplete(e){this._operationHandlesGroup=yi(this._operationHandlesGroup),this.activeOperation=null,this.emit("complete",e)}};d([p()],Cv.prototype,"_candidates",null),d([p()],Cv.prototype,"activeOperation",void 0),d([p()],Cv.prototype,"layers",void 0),d([p({readOnly:!0})],Cv.prototype,"selector",void 0),d([p({readOnly:!0})],Cv.prototype,"state",null),d([p()],Cv.prototype,"view",null),Cv=d([I("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],Cv);const Brr=Cv,POe={lassoTool:!0,rectangleTool:!0},jrr={createTool:"polygon",createOptions:{mode:"freehand"}},Grr={createTool:"rectangle"},VJ="esri-selection-toolbar",XU={base:VJ,container:`${VJ}__container`,toolButton:`${VJ}__tool-button`,disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"};let pp=class extends l1{constructor(e,r){super(e,r),this._viewModelHandlesGroup=null,this.activeToolInfo=null,this.messages=null,this.toolConfigs=[],this.viewModel=new Brr,this.visibleElements={...POe},this._viewModelHandlesGroup=E_([this.viewModel.on("selection-change",i=>this.emit("selection-change",i)),this.viewModel.on("complete",i=>{this._set("activeToolInfo",null),this.emit("complete",i)})])}destroy(){this._viewModelHandlesGroup=yi(this._viewModelHandlesGroup)}loadDependencies(){return xfe({action:()=>le(()=>import("./calcite-action-34fec7bf.js"),["assets/calcite-action-34fec7bf.js","assets/action-ffe80b57.js","assets/guid-40d04074.js","assets/interactive-3cbb41b8.js","assets/browser-14ab28bd.js","assets/key-bda23af6.js","assets/t9n-6fcc568d.js","assets/observers-77656bf5.js","assets/icon-347061df.js","assets/loader-122d6fcd.js"]),icon:()=>le(()=>import("./calcite-icon-1838b7f2.js"),["assets/calcite-icon-1838b7f2.js","assets/icon-347061df.js","assets/observers-77656bf5.js"])})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}castVisibleElements(e){return{...POe,...e}}activate(e){switch(this.cancel(),e){case"lasso":this._activateTool("lasso");break;case"rectangle":this._activateTool("rectangle");break;default:this._activateTool(e)}}cancel(){this.viewModel.cancel(),this._set("activeToolInfo",null)}render(){return ct("div",{"aria-label":this.label,class:this.classes(XU.base,XU.esriWidget)},ct("div",{class:XU.container},this.renderDefaultTools(),this.renderCustomTools()))}renderDefaultTools(){var e;if(((e=this.view)==null?void 0:e.type)==="2d")return[this.renderRectangleTool(),this.renderLassoTool()]}renderCustomTools(){if(this.toolConfigs&&this.toolConfigs.length)return this.toolConfigs.map(e=>{var r;return ct("calcite-action",{active:((r=this.activeToolInfo)==null?void 0:r.toolName)===e.toolName,bind:this,class:XU.toolButton,label:e.toolName,onclick:()=>this._onCustomToolClick(e.toolName),scale:"s",text:e.toolName,title:e.toolName},ct("calcite-icon",{scale:"s",icon:e.icon||"selection"}))})}renderLassoTool(){const{activeToolInfo:e,messages:r,visibleElements:i}=this;if(i.lassoTool)return ct("calcite-action",{active:(e==null?void 0:e.toolName)==="lasso",bind:this,label:r.selectByLasso,onclick:this._onLassoToolClick,scale:"s",text:r.selectByLasso,title:r.selectByLasso},ct("calcite-icon",{scale:"s",icon:"lasso-select"}))}renderRectangleTool(){const{activeToolInfo:e,messages:r,visibleElements:i}=this;if(i.rectangleTool)return ct("calcite-action",{active:(e==null?void 0:e.toolName)==="rectangle",bind:this,label:r.selectByRectangle,onclick:this._onRectangleToolClick,scale:"s",text:r.selectByRectangle,title:r.selectByRectangle},ct("calcite-icon",{scale:"s",icon:"cursor-marquee"}))}_onCustomToolClick(e){this._toggleTool(e)}_onLassoToolClick(){this._toggleTool("lasso")}_onRectangleToolClick(){this._toggleTool("rectangle")}_activateTool(e){const r=this._getToolOptions(e);if(!r)return;const i=this.viewModel.activate(r);i&&this._set("activeToolInfo",{toolName:e,operation:i})}_toggleTool(e){if(this.activeToolInfo){const r=this.activeToolInfo.toolName;if(this.cancel(),r===e)return}this._activateTool(e)}_getToolOptions(e){if(e==="lasso")return jrr;if(e==="rectangle")return Grr;const r=this.toolConfigs.find(o=>o.toolName===e);if(!r)return;const{createTool:i,createOptions:n,selectionOptions:s}=r;return{createTool:i,createOptions:n,selectionOptions:s}}};d([p({readOnly:!0})],pp.prototype,"activeToolInfo",void 0),d([p()],pp.prototype,"label",null),d([p()],pp.prototype,"layers",null),d([p(),XE("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],pp.prototype,"messages",void 0),d([p()],pp.prototype,"toolConfigs",void 0),d([p()],pp.prototype,"view",null),d([p()],pp.prototype,"viewModel",void 0),d([p()],pp.prototype,"visibleElements",void 0),d([ur("visibleElements")],pp.prototype,"castVisibleElements",null),pp=d([I("esri.widgets.support.SelectionToolbar")],pp);const Hrr=pp,YWe={hide:"hide",hideChildren:"hide-children"};function jj(t){if(t)return t.listMode!=null?t.listMode:void 0}function qrr(t){if(t)return t.minScale!=null?t.minScale:void 0}function Wrr(t){if(t)return t.maxScale!=null?t.maxScale:void 0}function Xrr(t){if(!t)return"inherited";const e=t.get("layer.capabilities.exportMap.supportsSublayerVisibility");if(typeof e=="boolean")return e?"independent":"inherited";const r=t.get("capabilities.exportMap.supportsSublayerVisibility");return typeof r=="boolean"?r?"independent":"inherited":t.visibilityMode!=null?t.visibilityMode:"independent"}function ZWe(t){if(t&&(!("type"in t)||t.type!=="wmts")&&t.listMode!==YWe.hideChildren)return"sublayers"in t?"sublayers":"layers"in t?"layers":void 0}function rme(t){return jj(t)!==YWe.hide}function Yrr(t,e){if(!t||isNaN(e))return!1;const r=qrr(t),i=Wrr(t),n=r!=null&&!isNaN(r)&&r>0&&e>r,s=i!=null&&!isNaN(i)&&i>0&&e<i;return n||s}function MOe(t){const e=t==null?void 0:t.layer;return e&&"layers"in e?e.layers:null}function Zrr(t){const e=Jrr(t)?t:null,r=t==null?void 0:t.parent,i=(r==null?void 0:r.type)==="map-image"?e==null?void 0:e.source:null,n="";return i&&r?{layer:r,title:n,sublayerIds:[i.mapLayerId]}:{layer:t,title:n}}function Jrr(t){return!!(t!=null&&t.layer)}var qoe;let Ib=qoe=class extends uF{constructor(t){super(t),this.displayValueEnabled=!1,this.max=1,this.min=0,this.step=.1,this.type="slider",this.value=null}clone(){return new qoe({active:this.active,className:this.className,disabled:this.disabled,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,displayValueEnabled:this.displayValueEnabled,max:this.max,min:this.min,step:this.step,value:this.value})}};d([p()],Ib.prototype,"displayValueEnabled",void 0),d([p()],Ib.prototype,"max",void 0),d([p()],Ib.prototype,"min",void 0),d([p()],Ib.prototype,"step",void 0),d([p()],Ib.prototype,"value",void 0),Ib=qoe=d([I("esri.support.Action.ActionSlider")],Ib);const Krr=Ib;function Qrr(t){return e=>{e.hasOwnProperty("_delegatedEventNames")||(e._delegatedEventNames=e._delegatedEventNames?e._delegatedEventNames.slice():[]);const r=e._delegatedEventNames,i=Array.isArray(t)?t:eir(t);r.push(...i)}}function eir(t){return t.split(",").map(e=>e.trim())}function $Oe(t){return t&&typeof t.render=="function"}function xPr(t){return t&&typeof t.postMixInProperties=="function"&&typeof t.buildRendering=="function"&&typeof t.postCreate=="function"&&typeof t.startup=="function"}const JWe="esri-layer-list-panel",N$=`${JWe}__content`,K0={base:JWe,content:N$,contentLegend:`${N$}--legend`,contentString:`${N$}--string`,contentElement:`${N$}--html-element`,contentWidget:`${N$}--widget`},tir="legends";let fp=class extends K4(l1){constructor(e,r){super(e,r),this._legend=null,this.content=null,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles(pe(()=>this.content,e=>this._createLegend(e),_r))}destroy(){this._legend=qe(this._legend)}get className(){const{image:e}=this,r=this._getFirstWidget();return this._get("className")||(!e&&r?r.iconClass??"":"")}set className(e){this._override("className",e)}get disabled(){var n;const{listItem:e,_legend:r,content:i}=this;return!e||!(Array.isArray(i)&&i.length>1)&&!!r&&(!((n=r.activeLayerInfos)!=null&&n.length)||!e.visibleAtCurrentScale||!e.visible)}set disabled(e){this._overrideIfSome("disabled",e)}get title(){const e=this._getFirstWidget();return this._get("title")||((e==null?void 0:e.label)??"")}set title(e){this._override("title",e)}render(){return ct("div",{class:K0.base},this._renderContents())}_renderContent(e){const{_legend:r,disabled:i}=this;return!e||i?null:e==="legend"&&r?ct("div",{class:this.classes(K0.content,K0.contentLegend),key:r},r.render()):typeof e=="string"?ct("div",{class:this.classes(K0.content,K0.contentString),key:e,innerHTML:e}):$Oe(e)?ct("div",{class:this.classes(K0.content,K0.contentWidget),key:e},e.render()):e instanceof HTMLElement?ct("div",{class:this.classes(K0.content,K0.contentElement),key:e,bind:e,afterCreate:this._attachToNode}):null}_renderContents(){const{content:e}=this;return Array.isArray(e)?e.map(r=>this._renderContent(r)):this._renderContent(e)}_getLegendOptions(){const{listItem:e}=this;if(!e)return{};const{layer:r,view:i}=e;return r&&i?{view:i,layerInfos:[Zrr(r)]}:{}}async _createLegend(e){if(!this._hasLegend(e)||this._legend)return;const{default:r}=await le(()=>import("./Legend-3c5c8335.js"),["assets/Legend-3c5c8335.js","assets/ExportImageParameters-0a859877.js","assets/floorFilterUtils-080a7cd2.js","assets/sublayerUtils-421ec0c7.js","assets/pixelRangeUtils-cc28ceb4.js","assets/rendererConversion-0f993bc8.js","assets/symbolUtils-dcab99f5.js","assets/colorUtils-c0f43caf.js"]),{listItem:i}=this,n=new r(this._getLegendOptions());this._legend=n,this.notifyChange("className"),this.notifyChange("title");const s=pe(()=>{var o,a;return[i==null?void 0:i.view,i==null?void 0:i.layer,(o=i==null?void 0:i.layer)==null?void 0:o.source,(a=i==null?void 0:i.layer)==null?void 0:a.parent]},()=>this._updateLegend(n),_r);this.addHandles(s,tir),this.scheduleRender()}_hasLegend(e){const r="legend";return e===r||e!=null&&!!Array.isArray(e)&&e.includes(r)}_attachToNode(e){e.appendChild(this)}_updateLegend(e){e.set(this._getLegendOptions()),this.scheduleRender()}_getWidget(e){return e==="legend"?this._legend:$Oe(e)?e:null}_getFirstWidget(){const{content:e}=this;if(Array.isArray(e)){let r=null;return e.some(i=>{const n=this._getWidget(i);return n&&(r=n),!!n}),r}return this._getWidget(e)}};d([p()],fp.prototype,"_legend",void 0),d([p()],fp.prototype,"className",null),d([p()],fp.prototype,"content",void 0),d([p()],fp.prototype,"disabled",null),d([p()],fp.prototype,"image",void 0),d([p()],fp.prototype,"listItem",void 0),d([p()],fp.prototype,"title",null),d([p()],fp.prototype,"open",void 0),d([p()],fp.prototype,"visible",void 0),fp=d([I("esri.widgets.LayerList.ListItemPanel")],fp);const KWe=fp;var AL;const rir=vt.ofType({key:"type",defaultKeyValue:"button",base:uF,typeMap:{button:P4e,toggle:M4e,slider:Krr}}),QWe=vt.ofType(rir),YU="layer",BJ="child-list-mode",iir="hide",nir="esri.widgets.LayerList.ListItem";let Bn=AL=class extends K4(jE(Ce)){constructor(t){super(t),this.actionsSections=new QWe,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(vt.ofType(AL)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.layerView=null,this.listItemCreatedFunction=null,this.open=!1,this.panel=null,this.parent=null,this.sortable=!0,this.view=null}initialize(){if(this.handles.add([pe(()=>this.layer,t=>this._watchLayerProperties(t),_r),pe(()=>this.checkPublishStatusEnabled,t=>this._updateChildrenPublishing(t),_r),pe(()=>this.view,t=>this._updateChildrenView(t),_r),pe(()=>this.panel,t=>this._setListItemOnPanel(t),_r),pe(()=>[this.layer,this.view],()=>this._getLayerView(),_r)]),typeof this.listItemCreatedFunction=="function"){const t={item:this};this.listItemCreatedFunction.call(null,t)}}destroy(){this.view=null}get connectionStatus(){const{layerView:t,publishing:e}=this;if(!e&&t&&"connectionStatus"in t)return t.connectionStatus}get error(){var t;return(t=this.layer)==null?void 0:t.loadError}get incompatible(){const{layerView:t}=this;return!(!t||!("spatialReferenceSupported"in t))&&!t.spatialReferenceSupported}castPanel(t){return this.get("panel.open")&&!t.hasOwnProperty("open")&&(t.open=!0),t?new KWe(t):null}get title(){const t=this.get("layer.layer");return(!t||t&&this.get("layer.layer.loaded"))&&this.get("layer.title")||this.get("layer.attributes.title")||""}set title(t){this._override("title",t)}get publishing(){var r;const{layer:t,checkPublishStatusEnabled:e}=this;return e&&t&&"publishingInfo"in t&&((r=t.publishingInfo)==null?void 0:r.status)==="publishing"}get updating(){const{layerView:t,connectionStatus:e,layer:r,publishing:i}=this;return!i&&!e&&(t?t.updating:(r==null?void 0:r.loadStatus)==="loading"||!1)}get visible(){var t;return(t=this.layer)==null?void 0:t.visible}set visible(t){const e=this.layer;e&&(e.visible=t)}get visibleAtCurrentScale(){return!Yrr(this.layer,this.get("view.scale"))}get visibilityMode(){return Xrr(this.layer)}clone(){return new AL({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,open:this.open,panel:this.panel,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(t){t&&(t.listItem=this)}_updateChildrenPublishing(t){const e=this.children;e&&e.forEach(r=>r.checkPublishStatusEnabled=t)}_updateChildrenView(t){const e=this.children;e&&e.forEach(r=>r.view=t)}_addChildren(t){if(this.handles.remove(BJ),this.children.removeAll(),!t)return;t.forEach(r=>{this.handles.add(pe(()=>r.listMode,()=>this._addChildren(t)),BJ)});const e=t.filter(r=>jj(r)!==iir);this.children.addMany(this._makeChildren(e))}_watchSublayerChanges(t){t&&this.handles.add(t.on("change",()=>{this._addChildren(t)}),YU)}_initializeChildLayers(t){this._addChildren(t),this._watchSublayerChanges(t)}_makeChildren(t){return t.map(e=>rme(e)?new AL({layer:e,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,parent:this,view:this.view}):null).filter(_0).reverse()}_watchLayerProperties(t){if(!this.handles||(this.handles.remove(YU),this.handles.remove(BJ),!t))return;if(this.handles.add(pe(()=>t.listMode,()=>this._watchLayerProperties(t)),YU),jj(t)==="hide-children")return void this.children.removeAll();const e=ZWe(t);e&&this.handles.add(pe(()=>t[e],r=>{t.hasOwnProperty(e)&&this._initializeChildLayers(r)},_r),YU)}async _getLayerView(){const{layer:t,view:e}=this;if(t&&e)try{const r=await e.whenLayerView(t);if(r.layer!==this.layer)return;this._set("layerView",r)}catch{}}};d([p({type:QWe})],Bn.prototype,"actionsSections",void 0),d([p()],Bn.prototype,"actionsOpen",void 0),d([p()],Bn.prototype,"checkPublishStatusEnabled",void 0),d([p({type:vt})],Bn.prototype,"children",void 0),d([p()],Bn.prototype,"childrenSortable",void 0),d([p({readOnly:!0})],Bn.prototype,"connectionStatus",null),d([p({readOnly:!0})],Bn.prototype,"error",null),d([p()],Bn.prototype,"hidden",void 0),d([p({readOnly:!0})],Bn.prototype,"incompatible",null),d([p()],Bn.prototype,"layer",void 0),d([p({readOnly:!0})],Bn.prototype,"layerView",void 0),d([p()],Bn.prototype,"listItemCreatedFunction",void 0),d([p()],Bn.prototype,"open",void 0),d([p({type:KWe})],Bn.prototype,"panel",void 0),d([ur("panel")],Bn.prototype,"castPanel",null),d([p()],Bn.prototype,"parent",void 0),d([p()],Bn.prototype,"sortable",void 0),d([p()],Bn.prototype,"title",null),d([p({readOnly:!0})],Bn.prototype,"publishing",null),d([p({readOnly:!0})],Bn.prototype,"updating",null),d([p()],Bn.prototype,"view",void 0),d([p()],Bn.prototype,"visible",null),d([p({readOnly:!0})],Bn.prototype,"visibleAtCurrentScale",null),d([p({readOnly:!0})],Bn.prototype,"visibilityMode",null),Bn=AL=d([I(nir)],Bn);const ime=Bn,Bf={view:"view",viewLayers:"view-layers",mapLayers:"map-layers",layerViews:"layer-views",layerListMode:"layer-list-mode"},sir="hide",eXe=vt.ofType(ime);let Lb=class extends pn.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.operationalItems=new eXe,this.view=null}initialize(){this.addHandles([pe(()=>{var e;return[this.view,(e=this.view)==null?void 0:e.ready]},()=>this._viewHandles(),_r),pe(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled],()=>this._recompileList())],Bf.view)}destroy(){this.removeAllHandles(),this.view=null,this.operationalItems.removeAll()}get state(){const e=this.get("view");return this.get("view.ready")?"ready":e?"loading":"disabled"}triggerAction(e,r){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:r})}moveListItem(e,r,i,n){var m,g;const s=e==null?void 0:e.layer;if(!s)return;const o=(g=(m=this.view)==null?void 0:m.map)==null?void 0:g.layers,a=r?MOe(r):o,l=i?MOe(i):o;if(!a||!l)return;const{operationalItems:c}=this,u=(r==null?void 0:r.children)||c,h=(i==null?void 0:i.children)||c,f=l.length-n;e.parent=i||null,u.includes(e)&&u.remove(e),a.includes(s)&&a.remove(s),h.includes(e)||h.add(e,f),l.includes(s)||l.add(s,f)}_createLayerViewHandles(e){this.removeHandles(Bf.layerViews),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),Bf.layerViews)}_createMapLayerHandles(e){this.removeHandles(Bf.mapLayers),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),Bf.mapLayers)}_createListItem(e){const{view:r,listItemCreatedFunction:i,checkPublishStatusEnabled:n}=this;return new ime({checkPublishStatusEnabled:n,layer:e,listItemCreatedFunction:i,view:r})}_removeAllItems(){this.operationalItems.removeAll()}_getViewableLayers(e){if(e)return e.filter(r=>jj(r)!==sir)}_watchLayersListMode(e){this.removeHandles(Bf.layerListMode),e&&e.forEach(r=>{"listMode"in r&&this.addHandles(pe(()=>r.listMode,()=>this._compileList()),Bf.layerListMode)})}_compileList(){const e=this.get("view.map.layers");this._watchLayersListMode(e);const r=this._getViewableLayers(e);r&&r.length?(this._createNewItems(r),this._removeItems(r),this._sortItems(r)):this._removeAllItems()}_createNewItems(e){const{operationalItems:r}=this;e.forEach(i=>{r.find(n=>n.layer===i)||r.add(this._createListItem(i))})}_removeItems(e){const{operationalItems:r}=this,i=[];r.forEach(n=>{n&&e&&e.includes(n.layer)||i.push(n)}),r.removeMany(i)}_sortItems(e){const{operationalItems:r}=this;r.sort((i,n)=>{const s=e.indexOf(i.layer),o=e.indexOf(n.layer);return s>o?-1:s<o?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([Bf.mapLayers,Bf.layerViews,Bf.viewLayers]),this._recompileList(),e&&e.ready&&this.addHandles([pe(()=>{var r,i;return(i=(r=this.view)==null?void 0:r.map)==null?void 0:i.allLayers},r=>this._createMapLayerHandles(r),_r),pe(()=>{var r;return(r=this.view)==null?void 0:r.allLayerViews},r=>this._createLayerViewHandles(r),_r)],Bf.viewLayers)}};d([p()],Lb.prototype,"checkPublishStatusEnabled",void 0),d([p()],Lb.prototype,"listItemCreatedFunction",void 0),d([p({type:eXe})],Lb.prototype,"operationalItems",void 0),d([p({readOnly:!0})],Lb.prototype,"state",null),d([p()],Lb.prototype,"view",void 0),Lb=d([I("esri.widgets.LayerList.LayerListViewModel")],Lb);const oir=Lb,nme=t=>air(t)||lir(t),air=t=>{if(!("type"in t))return!1;switch(t.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":return!0;default:return!1}},lir=t=>{const e=ZWe(t);if(e!=null&&t.hasOwnProperty(e)&&t[e]!=null){for(const r of t[e])if(nme(r))return!0}return!1};var Woe;let pm=Woe=class extends ime{constructor(t){super(t),this.children=new vt,this.parent=null}get allChildrenEnabled(){return this.children.every(t=>t.enabled)??!1}get childLayerIds(){return this.children.map(t=>t.layer.id).toArray()}get enabled(){return this.featureSource!=null&&this.featureSource.enabled}get featureSource(){const{layer:t,getFeatureSnappingSources:e}=this;return e().find(r=>r.layer===t)}get hasChildrenEnabled(){return this.children.some(t=>t.enabled)}_initializeChildLayers(t){if(!t)return;const e=t.filter(nme);super._initializeChildLayers(e)}_makeChildren(t){return t.map(e=>rme(e)?new Woe({layer:e,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(_0).reverse()}};d([p()],pm.prototype,"allChildrenEnabled",null),d([p()],pm.prototype,"children",void 0),d([p()],pm.prototype,"childLayerIds",null),d([p()],pm.prototype,"enabled",null),d([p()],pm.prototype,"featureSource",null),d([p({constructOnly:!0})],pm.prototype,"getFeatureSnappingSources",void 0),d([p()],pm.prototype,"hasChildrenEnabled",null),d([p()],pm.prototype,"parent",void 0),pm=Woe=d([I("esri.widgets.support.SnappingControls.SnappingListItem")],pm);let MT=class extends oir{constructor(){super(...arguments),this.featureSnappingSources=new vt}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>{var r;return!((r=e.children)!=null&&r.length)})}_compileList(){const e=this.get("view.map.layers");if(!e)return;const r=e.filter(nme);this._watchLayersListMode(r);const i=this._getViewableLayers(r);i&&i.length?(this._createNewItems(i),this._removeItems(i),this._sortItems(i)):this._removeAllItems()}_createListItem(e){return new pm({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}};d([p()],MT.prototype,"featureSnappingSources",void 0),d([p()],MT.prototype,"operationalItems",void 0),d([p()],MT.prototype,"operationalItemsFlat",null),d([p()],MT.prototype,"selectableItems",null),MT=d([I("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],MT);const cir="esri.widgets.support.SnappingControls.SnappingControlsViewModel";let my=class extends jE(Ce){constructor(e){super(e),this.layerListViewModel=new MT,this.snappingOptions=null,this.view=null}initialize(){this.handles.add([pe(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:e,view:r})=>{e.view=r},_r),pe(()=>{var e;return{viewModel:this.layerListViewModel,sources:(e=this.snappingOptions)==null?void 0:e.featureSources}},({viewModel:e,sources:r})=>{e.featureSnappingSources=r},_r)])}get allLayersEnabled(){var e;return(((e=this.layerListViewModel)==null?void 0:e.selectableItems)??[]).every(r=>r.enabled)}get allLayersDisabled(){var e;return(((e=this.layerListViewModel)==null?void 0:e.selectableItems)??[]).every(r=>!r.enabled)}get layersEnabledCount(){var e,r;return((r=(e=this.layerListViewModel)==null?void 0:e.selectableItems)==null?void 0:r.filter(i=>i.enabled).length)??0}get state(){return this.get("snappingOptions")?"ready":"disabled"}toggleSnappingForLayers(e,r){e==null||e.forEach(i=>r?this.enableSnappingForLayer(i):this.disableSnappingForLayer(i))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach(({layer:{id:r}})=>{e?this.enableSnappingForLayer(r):this.disableSnappingForLayer(r)})}enableSnappingForLayer(e){(this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e)).enabled=!0}disableSnappingForLayer(e){const r=this._findSnappingSourceForLayer(e);r&&(r.enabled=!1)}updateEnabledFeatureSources(e){for(const r of this.snappingOptions.featureSources)rme(r.layer)&&(r.enabled=e.includes(r.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find(r=>r.layer.id===e)}_makeSnappingSourceForLayer(e){var n;const r=(n=this.layerListViewModel.operationalItemsFlat.find(s=>s.layer.id===e))==null?void 0:n.layer;if(!r)throw new H("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);const i=new GWe({layer:r});return this.snappingOptions.featureSources.add(i),i}};d([p()],my.prototype,"allLayersEnabled",null),d([p()],my.prototype,"allLayersDisabled",null),d([p({constructOnly:!0})],my.prototype,"layerListViewModel",void 0),d([p()],my.prototype,"layersEnabledCount",null),d([p()],my.prototype,"snappingOptions",void 0),d([p()],my.prototype,"state",null),d([p()],my.prototype,"view",void 0),my=d([I(cir)],my);const uir=my,IOe={header:!0,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0,layerListToggleLayersButton:!0},Jh="esri-snapping-controls",Au={base:Jh,container:`${Jh}__container`,panel:`${Jh}__panel`,item:`${Jh}__item`,toggleBlock:`${Jh}__toggle-block`,layerListBlock:`${Jh}__layer-list-block`,layerList:`${Jh}__layer-list`,layerListFilter:`${Jh}__layer-list__filter`,layerListButton:`${Jh}__layer-list__button`,layerListItem:`${Jh}__layer-list__item`,layerListGroup:`${Jh}__layer-list__group`,nestedContainer:`${Jh}__nested-container`,disabled:"esri-disabled",esriWidget:"esri-widget",widgetIcon:"esri-icon-vertex-gps"},F$={checked:"check-square-f",unchecked:"square",indeterminate:"minus-square"};let Wc=class extends l1{constructor(e,r){super((()=>{const{view:i,viewModel:n,snappingOptions:s,...o}=e;return o})(),r),this._defaultViewModel=null,this._layerListFilter=null,this.iconClass=Au.widgetIcon,this.icon=null,this.layerListOpen=!0,this.messages=null,this.visibleElements={...IOe},this._onToggleLayersButtonClick=i=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),requestAnimationFrame(()=>i.target.setFocus())},e!=null&&e.viewModel?this.viewModel=e.viewModel:(this._defaultViewModel=new uir({snappingOptions:e.snappingOptions,view:e.view}),this.viewModel=this._defaultViewModel)}destroy(){this._defaultViewModel=qe(this._defaultViewModel)}loadDependencies(){return xfe({accordion:()=>le(()=>import("./calcite-accordion-5e94ad78.js"),[]),"accordion-item":()=>le(()=>import("./calcite-accordion-item-fd575090.js"),["assets/calcite-accordion-item-fd575090.js","assets/conditionalSlot-c71ace00.js","assets/observers-77656bf5.js","assets/icon-347061df.js"]),action:()=>le(()=>import("./calcite-action-34fec7bf.js"),["assets/calcite-action-34fec7bf.js","assets/action-ffe80b57.js","assets/guid-40d04074.js","assets/interactive-3cbb41b8.js","assets/browser-14ab28bd.js","assets/key-bda23af6.js","assets/t9n-6fcc568d.js","assets/observers-77656bf5.js","assets/icon-347061df.js","assets/loader-122d6fcd.js"]),block:()=>le(()=>import("./calcite-block-4b58f18d.js"),["assets/calcite-block-4b58f18d.js","assets/conditionalSlot-c71ace00.js","assets/observers-77656bf5.js","assets/guid-40d04074.js","assets/interactive-3cbb41b8.js","assets/browser-14ab28bd.js","assets/t9n-6fcc568d.js","assets/key-bda23af6.js","assets/action-menu-24bb36fb.js","assets/action-ffe80b57.js","assets/icon-347061df.js","assets/loader-122d6fcd.js","assets/FloatingArrow-7440c8d6.js","assets/debounce-9700caea.js","assets/scrim-43e4e23c.js"]),button:()=>le(()=>import("./calcite-button-620b6bda.js"),["assets/calcite-button-620b6bda.js","assets/form-ac685416.js","assets/interactive-3cbb41b8.js","assets/browser-14ab28bd.js","assets/label2-9c4bdb1d.js","assets/key-bda23af6.js","assets/t9n-6fcc568d.js","assets/observers-77656bf5.js","assets/icon-347061df.js","assets/loader-122d6fcd.js","assets/guid-40d04074.js"]),icon:()=>le(()=>import("./calcite-icon-1838b7f2.js"),["assets/calcite-icon-1838b7f2.js","assets/icon-347061df.js","assets/observers-77656bf5.js"]),input:()=>le(()=>import("./calcite-input-8a901d6c.js"),["assets/calcite-input-8a901d6c.js","assets/input-b198b283.js","assets/form-ac685416.js","assets/interactive-3cbb41b8.js","assets/browser-14ab28bd.js","assets/key-bda23af6.js","assets/label2-9c4bdb1d.js","assets/t9n-6fcc568d.js","assets/observers-77656bf5.js","assets/icon-347061df.js"]),label:()=>le(()=>import("./calcite-label-34d0864d.js"),["assets/calcite-label-34d0864d.js","assets/label2-9c4bdb1d.js"]),list:()=>le(()=>import("./calcite-list-e4692203.js"),["assets/calcite-list-e4692203.js","assets/interactive-3cbb41b8.js","assets/browser-14ab28bd.js","assets/observers-77656bf5.js","assets/utils3-50623c4a.js","assets/key-bda23af6.js","assets/debounce-9700caea.js","assets/t9n-6fcc568d.js","assets/icon-347061df.js","assets/input-b198b283.js","assets/form-ac685416.js","assets/label2-9c4bdb1d.js","assets/loader-122d6fcd.js","assets/guid-40d04074.js","assets/scrim-43e4e23c.js"]),"list-item":()=>le(()=>import("./calcite-list-item-085a34cd.js"),["assets/calcite-list-item-085a34cd.js","assets/interactive-3cbb41b8.js","assets/browser-14ab28bd.js","assets/utils3-50623c4a.js","assets/t9n-6fcc568d.js","assets/key-bda23af6.js","assets/observers-77656bf5.js","assets/action-ffe80b57.js","assets/guid-40d04074.js","assets/icon-347061df.js","assets/loader-122d6fcd.js"]),panel:()=>le(()=>import("./calcite-panel-bb449f30.js"),["assets/calcite-panel-bb449f30.js","assets/panel-fc848dba.js","assets/interactive-3cbb41b8.js","assets/browser-14ab28bd.js","assets/key-bda23af6.js","assets/observers-77656bf5.js","assets/action-menu-24bb36fb.js","assets/guid-40d04074.js","assets/action-ffe80b57.js","assets/t9n-6fcc568d.js","assets/icon-347061df.js","assets/loader-122d6fcd.js","assets/FloatingArrow-7440c8d6.js","assets/debounce-9700caea.js","assets/scrim-43e4e23c.js"]),switch:()=>le(()=>import("./calcite-switch-0840c24b.js"),["assets/calcite-switch-0840c24b.js","assets/form-ac685416.js","assets/interactive-3cbb41b8.js","assets/browser-14ab28bd.js","assets/key-bda23af6.js","assets/label2-9c4bdb1d.js"])})}get label(){var e;return((e=this.messages)==null?void 0:e.widgetLabel)??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(this._defaultViewModel!=null&&this._defaultViewModel===e||(this._defaultViewModel=qe(this._defaultViewModel)),this._set("viewModel",e))}castVisibleElements(e){return{...IOe,...e}}render(){const{label:e,visibleElements:{header:r}}=this;return ct("div",{"aria-label":e,class:this.classes(Au.base,Au.esriWidget)},ct("div",{class:Au.container},r?this._renderHeaderView():this._renderContent()))}_renderHeaderView(){return ct("calcite-panel",{heading:this.label,class:Au.panel},this._renderContent())}_renderContent(){return[this._renderToggles(),this._renderLayerList()]}_renderToggles(){const{visibleElements:{enabledToggle:e,selfEnabledToggle:r,featureEnabledToggle:i}}=this;return e||r||i?ct("calcite-block",{class:Au.toggleBlock,key:"toggle-block",heading:"",open:!0},this._renderEnabledToggle(),ct("div",{class:Au.nestedContainer},this._renderSelfEnabledToggle(),this._renderFeatureEnabledToggle())):null}_renderEnabledToggle(){if(!this.visibleElements.enabledToggle)return null;const{messages:{enableSnapping:e},viewModel:{snappingOptions:{enabled:r,enabledToggled:i}}}=this;return ct("calcite-label",{layout:"inline-space-between"},e,ct("calcite-switch",{checked:r,disabled:i,bind:this,onCalciteSwitchChange:this._enableSnappingSwitchChange}))}_renderSelfEnabledToggle(){if(!this.visibleElements.selfEnabledToggle)return null;const{messages:{geometryGuides:e},viewModel:{snappingOptions:{enabled:r,selfEnabled:i,enabledToggled:n}}}=this;return ct("calcite-label",{layout:"inline-space-between",key:"self-enabled-toggle"},e,ct("calcite-switch",{checked:i,disabled:n||!r,bind:this,onCalciteSwitchChange:this._selfEnabledSwitchChange}))}_renderFeatureEnabledToggle(){if(!this.visibleElements.featureEnabledToggle)return null;const{messages:{featureToFeature:e},viewModel:{snappingOptions:{enabled:r,featureEnabled:i,enabledToggled:n}}}=this;return ct("calcite-label",{layout:"inline-space-between",key:"feature-enabled-toggle"},e,ct("calcite-switch",{checked:i,disabled:n||!r,bind:this,onCalciteSwitchChange:this._featureEnabledSwitchChange}))}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:r}=this,{snappingOptions:{enabled:i,enabledToggled:n}}=r,s=({target:{value:c}})=>this._layerListFilter=c===""?null:new RegExp(c,"i"),o=r.layerListViewModel.operationalItems.length>9?ct("calcite-input",{class:Au.layerListFilter,clearable:!0,placeholder:e==null?void 0:e.searchLayers,onCalciteInputInput:s}):null,a=n||!i,l=this.layerListOpen&&!a;return ct("calcite-block",{key:"list-block",heading:e.snappingLayers,disabled:a,class:Au.layerListBlock,collapsible:!0,open:l,onCalciteBlockToggle:c=>this.layerListOpen=c.target.open},o,this._renderToggleLayersButton(),ct("calcite-list",{class:Au.layerList},this._renderLayerListItemCollection(r.layerListViewModel.operationalItems,this._layerListFilter)))}_renderLayerListItemCollection(e,r){return e.map(i=>{if(!r||this._itemTitleMatchesFilter(i,r))return i.children.length>0?this._renderLayerListItemGroup(i):this._renderLayerListItem(i);const n=i.children.filter(s=>this._itemTitleMatchesFilter(s,r));return n.length>0?this._renderLayerListItemGroup(i,n):null}).toArray().filter(_0)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:r}=this,i=e?r.disableAllLayers:r.enableAllLayers;return ct("calcite-button",{appearance:"transparent",class:Au.layerListButton,label:i,name:"layer-toggle",scale:"m",onclick:this._onToggleLayersButtonClick},i)}_renderLayerListItem(e){const{messages:{untitledLayer:r}}=this,i=e.title||r,n=e.enabled,s=()=>{this._handleLayerListItemChange({checked:!n,value:e.layer.id})};return ct("calcite-list-item",{class:Au.layerListItem,label:i,key:`${this.id}-list-item-${e.uid}`,onCalciteListItemSelect:s},ct("calcite-icon",{icon:n?F$.checked:F$.unchecked,slot:"content-start",scale:"s"}))}_renderLayerListItemGroup(e,r){const{allChildrenEnabled:i,children:n,hasChildrenEnabled:s,title:o}=e,a=this.messages,l=o||a.untitledLayer,c=o&&o!==""?o:au(),u=!!r,h=r??n,f=i?F$.checked:s?F$.indeterminate:F$.unchecked,m=i?a.disableAllLayers:a.enableAllLayers,g=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,!i)};return ct("calcite-list-item",{class:Au.layerListItem,key:c},ct("calcite-accordion",{class:Au.layerListGroup,appearance:"transparent"},ct("calcite-accordion-item",{expanded:u,heading:l,key:e.uid},ct("calcite-action",{scale:"m",slot:"actions-start",text:m,textEnabled:!1,onclick:g},ct("calcite-icon",{icon:f,scale:"s"})),ct("calcite-list",null,[...this._renderLayerListItemCollection(h)]))))}_enableSnappingSwitchChange(e){this.snappingOptions.enabled=e.target.checked}_featureEnabledSwitchChange(e){this.snappingOptions.featureEnabled=e.target.checked}_itemTitleMatchesFilter(e,r){return r!=null&&r.test(e.title)}_selfEnabledSwitchChange(e){this.snappingOptions.selfEnabled=e.target.checked}async _handleLayerListItemChange(e){e.checked?this.viewModel.enableSnappingForLayer(e.value):this.viewModel.disableSnappingForLayer(e.value)}};d([p()],Wc.prototype,"_defaultViewModel",void 0),d([p()],Wc.prototype,"_layerListFilter",void 0),d([p()],Wc.prototype,"iconClass",void 0),d([p()],Wc.prototype,"icon",void 0),d([p()],Wc.prototype,"label",null),d([p()],Wc.prototype,"layerListOpen",void 0),d([p(),XE("esri/widgets/support/SnappingControls/t9n/SnappingControls")],Wc.prototype,"messages",void 0),d([p()],Wc.prototype,"snappingOptions",null),d([p()],Wc.prototype,"view",null),d([p()],Wc.prototype,"viewModel",null),d([p()],Wc.prototype,"visibleElements",void 0),d([ur("visibleElements")],Wc.prototype,"castVisibleElements",null),Wc=d([I("esri.widgets.support.SnappingControls")],Wc);const dir=Wc,Ga="esri-sketch",Oo={base:Ga,verticalLayout:`${Ga}--vertical`,panel:`${Ga}__panel`,infoPanel:`${Ga}__info-panel`,section:`${Ga}__section`,toolSection:`${Ga}__tool-section`,infoSection:`${Ga}__info-section`,infoCountSection:`${Ga}__info-count-section`,menuContainer:`${Ga}__menu-container`,menuHeader:`${Ga}__menu-header`,menuTitle:`${Ga}__menu-title`,featureCountBadge:`${Ga}__feature-count-badge`,featureCountText:`${Ga}__feature-count-text`,featureCountNumber:`${Ga}__feature-count-number`,actionToggle:`${Ga}__action-toggle`,actionToggleOn:`${Ga}__action-toggle--on`,actionTitle:`${Ga}__item-action-title`,actionIcon:`${Ga}__item-action-icon`,disabled:"esri-disabled",esriWidget:"esri-widget",rotating:"esri-rotating",widgetIcon:"esri-icon-edit"},k$={createTools:{point:!0,polyline:!0,polygon:!0,rectangle:!0,circle:!0},selectionTools:{"rectangle-selection":!0,"lasso-selection":!0},undoRedoMenu:!0,settingsMenu:!0,snappingControls:!0,snappingControlsElements:{header:!1,enabledToggle:!0,selfEnabledToggle:!0,featureEnabledToggle:!0,layerList:!0},duplicateButton:!0};let $s=class extends l1{constructor(t,e){super(t,e),this._activeCreateOptions=null,this._menuOpen=!1,this._selectionToolbar=null,this._snappingControls=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.creationMode="continuous",this.iconClass=Oo.widgetIcon,this.icon=null,this.layout="horizontal",this.messages=null,this.visibleElements={...k$},this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=(t==null?void 0:t.viewModel)||new WWe}initialize(){const{layer:t,view:e}=this,r=new Hrr({view:(e==null?void 0:e.type)==="2d"?e:null,layers:t?[t]:null});this.addHandles([pe(()=>this.viewModel,i=>{this._viewModelHandlesGroup=yi(this._viewModelHandlesGroup),i&&(this._viewModelHandlesGroup=E_([i.on("create",n=>{this.scheduleRender(),this._onCreateOperation(n)}),i.on("update",()=>this.scheduleRender()),i.on("delete",n=>this.emit("delete",n)),i.on("undo",()=>this.scheduleRender()),i.on("redo",()=>this.scheduleRender()),pe(()=>i.layer,n=>{this._selectionToolbar&&(this._selectionToolbar.layers=n?[n]:null)}),pe(()=>i.view,n=>{this._selectionToolbar&&(this._selectionToolbar.view=(n==null?void 0:n.type)==="2d"?n:null),this._setUpSnappingControls()}),pe(()=>i.state,()=>this.notifyChange("state"))]))},Bi),du(()=>r.activeToolInfo,()=>this.viewModel.cancel()),r.on("complete",i=>this._onSelectionOperationComplete(i))]),this._selectionToolbar=r,this._setUpSnappingControls()}loadDependencies(){return xfe({action:()=>le(()=>import("./calcite-action-34fec7bf.js"),["assets/calcite-action-34fec7bf.js","assets/action-ffe80b57.js","assets/guid-40d04074.js","assets/interactive-3cbb41b8.js","assets/browser-14ab28bd.js","assets/key-bda23af6.js","assets/t9n-6fcc568d.js","assets/observers-77656bf5.js","assets/icon-347061df.js","assets/loader-122d6fcd.js"]),icon:()=>le(()=>import("./calcite-icon-1838b7f2.js"),["assets/calcite-icon-1838b7f2.js","assets/icon-347061df.js","assets/observers-77656bf5.js"])})}destroy(){var t;(t=this._selectionToolbar)==null||t.destroy(),this._viewModelHandlesGroup=yi(this._viewModelHandlesGroup),this._snappingControls=qe(this._snappingControls)}get activeTool(){var e;const t=(e=this._selectionToolbar)==null?void 0:e.activeToolInfo;if(t)switch(t.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}return this.viewModel.activeTool}get createGraphic(){return this.viewModel.createGraphic}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(t){this.viewModel.defaultCreateOptions=t}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(t){this.viewModel.defaultUpdateOptions=t}get label(){var t;return((t=this.messages)==null?void 0:t.widgetLabel)??""}set label(t){this._overrideIfSome("label",t)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(t){this.viewModel.labelOptions=t}get layer(){return this.viewModel.layer}set layer(t){this.viewModel.layer=t}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(t){this.viewModel.snappingOptions=t}get state(){var t;return(t=this._selectionToolbar)!=null&&t.activeToolInfo?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(t){this.viewModel.tooltipOptions=t}get updateGraphics(){return this.viewModel.updateGraphics}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}set viewModel(t){const e=this._get("viewModel");t!==e&&(e&&qe(e),this._set("viewModel",t))}castVisibleElements(t){const e={...k$,...t,createTools:{...k$.createTools,...t==null?void 0:t.createTools},selectionTools:{...k$.selectionTools,...t==null?void 0:t.selectionTools},snappingControlsElements:{...k$.snappingControlsElements,...t==null?void 0:t.snappingControlsElements}};return this._snappingControls!=null&&(this._snappingControls.visibleElements=e.snappingControlsElements),e}create(t,e){this._activeCreateOptions=e||null,this.viewModel.create(t,e)}update(t,e){return this.viewModel.update(t,e)}complete(){this.viewModel.complete()}cancel(){var t;(t=this._selectionToolbar)==null||t.cancel(),this.viewModel.cancel()}undo(){var t;this.viewModel.undo(),(t=this.view)==null||t.focus()}redo(){var t;this.viewModel.redo(),(t=this.view)==null||t.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}render(){const{label:t,layout:e,viewModel:{state:r}}=this;return ct("div",{"aria-label":t,class:this.classes(Oo.base,Oo.esriWidget,{[Oo.disabled]:r==="disabled",[Oo.verticalLayout]:e==="vertical"})},ct("div",{role:"toolbar",class:Oo.panel},this.renderTopPanelContents()),ct("div",{class:this.classes(Oo.panel,Oo.infoPanel)},this.renderInfoPanelContents()))}renderTopPanelContents(){const t=this.classes(Oo.section,Oo.toolSection),{availableCreateTools:e,visibleElements:r}=this;return[ct("div",{role:"menu",key:"selection-button-container",class:t},this.renderDefaultSelectionButton(),this.renderSelectionToolbar()),e&&e.length?ct("div",{role:"menu",class:t},this.renderDrawButtons()):null,r.undoRedoMenu?ct("div",{role:"menu",key:"undo-redo-menu-button-container",class:t},this.renderUndoRedoMenuButtons()):null,r.settingsMenu?ct("div",{key:"settings-menu-button-container",class:Oo.section},this.renderSettingsMenuButton()):null]}renderInfoPanelContents(){return this._menuOpen?this.renderSettingsMenu():this.updateGraphics.length?[ct("div",{class:this.classes(Oo.section,Oo.infoSection,Oo.infoCountSection),key:"feature-count-container"},this.renderFeatureCount()),ct("div",{class:this.classes(Oo.section,Oo.infoSection),key:"delete-button-container"},this.renderDuplicateButton(),this.renderDeleteButton())]:void 0}renderSettingsMenu(){const{settings:t}=this.messages;return[ct("div",{role:"menu",class:Oo.menuContainer,key:"settings-menu-container"},ct("header",{class:Oo.menuHeader,key:"settings-menu-header"},ct("span",{class:Oo.menuTitle},t)),this.renderSnappingControls())]}renderSnappingControls(){const{snappingControls:t}=this.visibleElements;if(this._snappingControls!=null&&t)return this._snappingControls.render()}renderFeatureCount(){const{layout:t,messages:e,updateGraphics:{length:r}}=this,i=hTt(e.selectedCount,{count:r});return ct("div",{class:Oo.featureCountBadge,"aria-label":i},ct("span",{class:Oo.featureCountNumber},t==="vertical"?r:i))}renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return;const t=this.messages,e=this.updateGraphics.length>1?t.duplicateFeatures:t.duplicateFeature;return ct("calcite-action",{bind:this,label:e,onclick:this._onDuplicateSelect,scale:"s",text:e,title:e},ct("calcite-icon",{scale:"s",icon:"copy"}))}renderDeleteButton(){const t=this.messages,e=this.updateGraphics.length>1?t.deleteFeatures:t.deleteFeature;return ct("calcite-action",{bind:this,label:e,onclick:this.delete,scale:"s",text:e,title:e},ct("calcite-icon",{scale:"s",icon:"trash"}))}renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return;const t=this.messages.selectFeature;return ct("calcite-action",{active:this.state==="ready",bind:this,label:t,onclick:this._activateDefaultSelectTool,scale:"s",text:t,title:t},ct("calcite-icon",{scale:"s",icon:"cursor"}))}renderSelectionToolbar(){var e;if(((e=this.view)==null?void 0:e.type)!=="2d"||!this._selectionToolbar)return;const t=this.visibleElements.selectionTools;return this._selectionToolbar.visibleElements={lassoTool:!!(t!=null&&t["lasso-selection"]),rectangleTool:!!(t!=null&&t["rectangle-selection"])},this._selectionToolbar.render()}renderDrawButtons(){var e;const t=this.visibleElements.createTools??{};return(e=this.availableCreateTools)==null?void 0:e.map(r=>r==="point"&&t.point?this.renderPointButton():r==="polyline"&&t.polyline?this.renderPolylineButton():r==="polygon"&&t.polygon?this.renderPolygonButton():r==="rectangle"&&t.rectangle?this.renderRectangleButton():r==="circle"&&t.circle?this.renderCircleButton():void 0)}renderPointButton(){const t="point",e=this.messages.drawPoint;return ct("calcite-action",{active:this.activeTool===t,bind:this,label:e,onclick:()=>this._activateCreateTool(t),scale:"s",text:e,title:e},ct("calcite-icon",{scale:"s",icon:"pin"}))}renderPolygonButton(){const t="polygon",e=this.messages.drawPolygon;return ct("calcite-action",{active:this.activeTool===t,bind:this,label:e,onclick:()=>this._activateCreateTool(t),scale:"s",text:e,title:e},ct("calcite-icon",{scale:"s",icon:"polygon"}))}renderPolylineButton(){const t="polyline",e=this.messages.drawPolyline;return ct("calcite-action",{active:this.activeTool===t,bind:this,label:e,onclick:()=>this._activateCreateTool(t),scale:"s",text:e,title:e},ct("calcite-icon",{scale:"s",icon:"line"}))}renderCircleButton(){const t="circle",e=this.messages.drawCircle;return ct("calcite-action",{active:this.activeTool===t,bind:this,label:e,onclick:()=>this._activateCreateTool(t),scale:"s",text:e,title:e},ct("calcite-icon",{scale:"s",icon:"circle"}))}renderRectangleButton(){const t="rectangle",e=this.messages.drawRectangle;return ct("calcite-action",{active:this.activeTool===t,bind:this,label:e,onclick:()=>this._activateCreateTool(t),scale:"s",text:e,title:e},ct("calcite-icon",{scale:"s",icon:"rectangle"}))}renderUndoRedoMenuButtons(){return[this.renderUndoButton(),this.renderRedoButton()]}renderUndoButton(){const t=this.messages.undo;return ct("calcite-action",{disabled:!this.viewModel.canUndo(),bind:this,label:t,onclick:this.undo,scale:"s",text:t,title:t},ct("calcite-icon",{scale:"s",icon:vre(this.container)?"redo":"undo"}))}renderRedoButton(){const t=this.messages.redo;return ct("calcite-action",{disabled:!this.viewModel.canRedo(),bind:this,label:t,onclick:this.redo,scale:"s",text:t,title:t},ct("calcite-icon",{scale:"s",icon:vre(this.container)?"undo":"redo"}))}renderSettingsMenuButton(){const t=this.messages.settings;return ct("calcite-action",{active:this._menuOpen,bind:this,label:t,onclick:this._toggleMenu,scale:"s",text:t,title:t},ct("calcite-icon",{scale:"s",icon:"gear"}))}_activateCreateTool(t){var e;this.activeTool!==t?((e=this._selectionToolbar)==null||e.cancel(),this.create(t)):this.cancel()}_onCreateOperation(t){if(t.state!=="complete")return;const{creationMode:e}=this,{type:r}=t;if(r==="create"){const{tool:i,graphic:n}=t,s=this._activeCreateOptions;this._activeCreateOptions=null,e==="continuous"?this.create(i,s):e==="update"&&this.update([n])}}_toggleMenu(){this._menuOpen=!this._menuOpen,this.scheduleRender()}_onDuplicateSelect(){const t=this.duplicate(),e=this.viewModel.activeTool;e!=="transform"&&e!=="reshape"||this.update(t,{tool:e})}_onSelectionOperationComplete(t){const{viewModel:{defaultUpdateOptions:e}}=this,{selection:r}=t;if(!t.aborted&&r.length){const i=e.tool,n=r.length>1&&i==="reshape"?"transform":i;this.update(r,{...e,tool:n})}this.notifyChange("state")}_activateDefaultSelectTool(){var t;this.cancel(),(t=this.view)==null||t.focus()}_setUpSnappingControls(){const{snappingOptions:t,view:e}=this;if(this._snappingControls=qe(this._snappingControls),!t||!e)return;const r=new dir({snappingOptions:t,view:e,visibleElements:this.visibleElements.snappingControlsElements});this._snappingControls=r}};d([p()],$s.prototype,"activeTool",null),d([p({cast:t=>{if(!t||!t.length)return null;const e=new Set(["point","polyline","polygon","rectangle","circle"]);return t.filter(r=>e.has(r))}})],$s.prototype,"availableCreateTools",void 0),d([p({readOnly:!0})],$s.prototype,"createGraphic",null),d([p()],$s.prototype,"creationMode",void 0),d([p()],$s.prototype,"defaultCreateOptions",null),d([p()],$s.prototype,"defaultUpdateOptions",null),d([p()],$s.prototype,"iconClass",void 0),d([p()],$s.prototype,"icon",void 0),d([p()],$s.prototype,"label",null),d([p()],$s.prototype,"labelOptions",null),d([p()],$s.prototype,"layer",null),d([p({type:["horizontal","vertical"]})],$s.prototype,"layout",void 0),d([p(),XE("esri/widgets/Sketch/t9n/Sketch")],$s.prototype,"messages",void 0),d([p()],$s.prototype,"snappingOptions",null),d([p()],$s.prototype,"state",null),d([p()],$s.prototype,"tooltipOptions",null),d([p({readOnly:!0})],$s.prototype,"updateGraphics",null),d([p()],$s.prototype,"view",null),d([p(),Qrr(["create","update","undo","redo"])],$s.prototype,"viewModel",null),d([p()],$s.prototype,"visibleElements",void 0),d([ur("visibleElements")],$s.prototype,"castVisibleElements",null),$s=d([I("esri.widgets.Sketch")],$s);const tXe=$s,sme=()=>{const[t,e]=U.useContext(Co),[r,i]=U.useContext(u1),n=U.useCallback(()=>{r.view.ui&&r.view.when(()=>{const s=new tXe({layer:r.graphicsLayer,view:r.view,creationMode:"update",layout:"vertical",availableCreateTools:["polygon","rectangle","circle"],defaultCreateOptions:{hasZ:!1}});r.view.ui.add(s,"top-left"),r.AOIgeometry&&e({type:"AOIgeometry",payload:t.AOIgeometry}),s.on("create",o=>o.state==="complete"&&e({type:"AOIgeometry",payload:o.graphic.toJSON().geometry.rings[0]})),i({type:"sketch",payload:s})})},[r.scene]);return U.useEffect(()=>{r.scene&&n()},[r.scene]),F.jsx(F.Fragment,{})};function rXe(t,e){return function(){return t.apply(e,arguments)}}const{toString:hir}=Object.prototype,{getPrototypeOf:ome}=Object,Mq=(t=>e=>{const r=hir.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())})(Object.create(null)),P0=t=>(t=t.toLowerCase(),e=>Mq(e)===t),$q=t=>e=>typeof e===t,{isArray:oM}=Array,v4=$q("undefined");function pir(t){return t!==null&&!v4(t)&&t.constructor!==null&&!v4(t.constructor)&&Jp(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const iXe=P0("ArrayBuffer");function fir(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&iXe(t.buffer),e}const mir=$q("string"),Jp=$q("function"),nXe=$q("number"),Iq=t=>t!==null&&typeof t=="object",gir=t=>t===!0||t===!1,T9=t=>{if(Mq(t)!=="object")return!1;const e=ome(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},yir=P0("Date"),vir=P0("File"),_ir=P0("Blob"),bir=P0("FileList"),wir=t=>Iq(t)&&Jp(t.pipe),xir=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||Jp(t.append)&&((e=Mq(t))==="formdata"||e==="object"&&Jp(t.toString)&&t.toString()==="[object FormData]"))},Sir=P0("URLSearchParams"),Tir=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function QF(t,e,{allOwnKeys:r=!1}={}){if(t===null||typeof t>"u")return;let i,n;if(typeof t!="object"&&(t=[t]),oM(t))for(i=0,n=t.length;i<n;i++)e.call(null,t[i],i,t);else{const s=r?Object.getOwnPropertyNames(t):Object.keys(t),o=s.length;let a;for(i=0;i<o;i++)a=s[i],e.call(null,t[a],a,t)}}function sXe(t,e){e=e.toLowerCase();const r=Object.keys(t);let i=r.length,n;for(;i-- >0;)if(n=r[i],e===n.toLowerCase())return n;return null}const oXe=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),aXe=t=>!v4(t)&&t!==oXe;function Xoe(){const{caseless:t}=aXe(this)&&this||{},e={},r=(i,n)=>{const s=t&&sXe(e,n)||n;T9(e[s])&&T9(i)?e[s]=Xoe(e[s],i):T9(i)?e[s]=Xoe({},i):oM(i)?e[s]=i.slice():e[s]=i};for(let i=0,n=arguments.length;i<n;i++)arguments[i]&&QF(arguments[i],r);return e}const Eir=(t,e,r,{allOwnKeys:i}={})=>(QF(e,(n,s)=>{r&&Jp(n)?t[s]=rXe(n,r):t[s]=n},{allOwnKeys:i}),t),Cir=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Rir=(t,e,r,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),r&&Object.assign(t.prototype,r)},Oir=(t,e,r,i)=>{let n,s,o;const a={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),s=n.length;s-- >0;)o=n[s],(!i||i(o,t,e))&&!a[o]&&(e[o]=t[o],a[o]=!0);t=r!==!1&&ome(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e},Air=(t,e,r)=>{t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;const i=t.indexOf(e,r);return i!==-1&&i===r},Pir=t=>{if(!t)return null;if(oM(t))return t;let e=t.length;if(!nXe(e))return null;const r=new Array(e);for(;e-- >0;)r[e]=t[e];return r},Mir=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&ome(Uint8Array)),$ir=(t,e)=>{const i=(t&&t[Symbol.iterator]).call(t);let n;for(;(n=i.next())&&!n.done;){const s=n.value;e.call(t,s[0],s[1])}},Iir=(t,e)=>{let r;const i=[];for(;(r=t.exec(e))!==null;)i.push(r);return i},Lir=P0("HTMLFormElement"),Dir=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,n){return i.toUpperCase()+n}),LOe=(({hasOwnProperty:t})=>(e,r)=>t.call(e,r))(Object.prototype),Nir=P0("RegExp"),lXe=(t,e)=>{const r=Object.getOwnPropertyDescriptors(t),i={};QF(r,(n,s)=>{e(n,s,t)!==!1&&(i[s]=n)}),Object.defineProperties(t,i)},Fir=t=>{lXe(t,(e,r)=>{if(Jp(t)&&["arguments","caller","callee"].indexOf(r)!==-1)return!1;const i=t[r];if(Jp(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")})}})},kir=(t,e)=>{const r={},i=n=>{n.forEach(s=>{r[s]=!0})};return oM(t)?i(t):i(String(t).split(e)),r},Uir=()=>{},zir=(t,e)=>(t=+t,Number.isFinite(t)?t:e),jJ="abcdefghijklmnopqrstuvwxyz",DOe="0123456789",cXe={DIGIT:DOe,ALPHA:jJ,ALPHA_DIGIT:jJ+jJ.toUpperCase()+DOe},Vir=(t=16,e=cXe.ALPHA_DIGIT)=>{let r="";const{length:i}=e;for(;t--;)r+=e[Math.random()*i|0];return r};function Bir(t){return!!(t&&Jp(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const jir=t=>{const e=new Array(10),r=(i,n)=>{if(Iq(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[n]=i;const s=oM(i)?[]:{};return QF(i,(o,a)=>{const l=r(o,n+1);!v4(l)&&(s[a]=l)}),e[n]=void 0,s}}return i};return r(t,0)},Gir=P0("AsyncFunction"),Hir=t=>t&&(Iq(t)||Jp(t))&&Jp(t.then)&&Jp(t.catch),Pe={isArray:oM,isArrayBuffer:iXe,isBuffer:pir,isFormData:xir,isArrayBufferView:fir,isString:mir,isNumber:nXe,isBoolean:gir,isObject:Iq,isPlainObject:T9,isUndefined:v4,isDate:yir,isFile:vir,isBlob:_ir,isRegExp:Nir,isFunction:Jp,isStream:wir,isURLSearchParams:Sir,isTypedArray:Mir,isFileList:bir,forEach:QF,merge:Xoe,extend:Eir,trim:Tir,stripBOM:Cir,inherits:Rir,toFlatObject:Oir,kindOf:Mq,kindOfTest:P0,endsWith:Air,toArray:Pir,forEachEntry:$ir,matchAll:Iir,isHTMLForm:Lir,hasOwnProperty:LOe,hasOwnProp:LOe,reduceDescriptors:lXe,freezeMethods:Fir,toObjectSet:kir,toCamelCase:Dir,noop:Uir,toFiniteNumber:zir,findKey:sXe,global:oXe,isContextDefined:aXe,ALPHABET:cXe,generateString:Vir,isSpecCompliantForm:Bir,toJSONObject:jir,isAsyncFn:Gir,isThenable:Hir};function Vi(t,e,r,i,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),i&&(this.request=i),n&&(this.response=n)}Pe.inherits(Vi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Pe.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const uXe=Vi.prototype,dXe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{dXe[t]={value:t}});Object.defineProperties(Vi,dXe);Object.defineProperty(uXe,"isAxiosError",{value:!0});Vi.from=(t,e,r,i,n,s)=>{const o=Object.create(uXe);return Pe.toFlatObject(t,o,function(l){return l!==Error.prototype},a=>a!=="isAxiosError"),Vi.call(o,t.message,e,r,i,n),o.cause=t,o.name=t.name,s&&Object.assign(o,s),o};const qir=null;function Yoe(t){return Pe.isPlainObject(t)||Pe.isArray(t)}function hXe(t){return Pe.endsWith(t,"[]")?t.slice(0,-2):t}function NOe(t,e,r){return t?t.concat(e).map(function(n,s){return n=hXe(n),!r&&s?"["+n+"]":n}).join(r?".":""):e}function Wir(t){return Pe.isArray(t)&&!t.some(Yoe)}const Xir=Pe.toFlatObject(Pe,{},null,function(e){return/^is[A-Z]/.test(e)});function Lq(t,e,r){if(!Pe.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,r=Pe.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,_){return!Pe.isUndefined(_[y])});const i=r.metaTokens,n=r.visitor||u,s=r.dots,o=r.indexes,l=(r.Blob||typeof Blob<"u"&&Blob)&&Pe.isSpecCompliantForm(e);if(!Pe.isFunction(n))throw new TypeError("visitor must be a function");function c(g){if(g===null)return"";if(Pe.isDate(g))return g.toISOString();if(!l&&Pe.isBlob(g))throw new Vi("Blob is not supported. Use a Buffer instead.");return Pe.isArrayBuffer(g)||Pe.isTypedArray(g)?l&&typeof Blob=="function"?new Blob([g]):Buffer.from(g):g}function u(g,y,_){let b=g;if(g&&!_&&typeof g=="object"){if(Pe.endsWith(y,"{}"))y=i?y:y.slice(0,-2),g=JSON.stringify(g);else if(Pe.isArray(g)&&Wir(g)||(Pe.isFileList(g)||Pe.endsWith(y,"[]"))&&(b=Pe.toArray(g)))return y=hXe(y),b.forEach(function(x,S){!(Pe.isUndefined(x)||x===null)&&e.append(o===!0?NOe([y],S,s):o===null?y:y+"[]",c(x))}),!1}return Yoe(g)?!0:(e.append(NOe(_,y,s),c(g)),!1)}const h=[],f=Object.assign(Xir,{defaultVisitor:u,convertValue:c,isVisitable:Yoe});function m(g,y){if(!Pe.isUndefined(g)){if(h.indexOf(g)!==-1)throw Error("Circular reference detected in "+y.join("."));h.push(g),Pe.forEach(g,function(b,w){(!(Pe.isUndefined(b)||b===null)&&n.call(e,b,Pe.isString(w)?w.trim():w,y,f))===!0&&m(b,y?y.concat(w):[w])}),h.pop()}}if(!Pe.isObject(t))throw new TypeError("data must be an object");return m(t),e}function FOe(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function ame(t,e){this._pairs=[],t&&Lq(t,this,e)}const pXe=ame.prototype;pXe.append=function(e,r){this._pairs.push([e,r])};pXe.toString=function(e){const r=e?function(i){return e.call(this,i,FOe)}:FOe;return this._pairs.map(function(n){return r(n[0])+"="+r(n[1])},"").join("&")};function Yir(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function fXe(t,e,r){if(!e)return t;const i=r&&r.encode||Yir,n=r&&r.serialize;let s;if(n?s=n(e,r):s=Pe.isURLSearchParams(e)?e.toString():new ame(e,r).toString(i),s){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class Zir{constructor(){this.handlers=[]}use(e,r,i){return this.handlers.push({fulfilled:e,rejected:r,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Pe.forEach(this.handlers,function(i){i!==null&&e(i)})}}const kOe=Zir,mXe={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Jir=typeof URLSearchParams<"u"?URLSearchParams:ame,Kir=typeof FormData<"u"?FormData:null,Qir=typeof Blob<"u"?Blob:null,enr=(()=>{let t;return typeof navigator<"u"&&((t=navigator.product)==="ReactNative"||t==="NativeScript"||t==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),tnr=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Uy={isBrowser:!0,classes:{URLSearchParams:Jir,FormData:Kir,Blob:Qir},isStandardBrowserEnv:enr,isStandardBrowserWebWorkerEnv:tnr,protocols:["http","https","file","blob","url","data"]};function rnr(t,e){return Lq(t,new Uy.classes.URLSearchParams,Object.assign({visitor:function(r,i,n,s){return Uy.isNode&&Pe.isBuffer(r)?(this.append(i,r.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function inr(t){return Pe.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function nnr(t){const e={},r=Object.keys(t);let i;const n=r.length;let s;for(i=0;i<n;i++)s=r[i],e[s]=t[s];return e}function gXe(t){function e(r,i,n,s){let o=r[s++];const a=Number.isFinite(+o),l=s>=r.length;return o=!o&&Pe.isArray(n)?n.length:o,l?(Pe.hasOwnProp(n,o)?n[o]=[n[o],i]:n[o]=i,!a):((!n[o]||!Pe.isObject(n[o]))&&(n[o]=[]),e(r,i,n[o],s)&&Pe.isArray(n[o])&&(n[o]=nnr(n[o])),!a)}if(Pe.isFormData(t)&&Pe.isFunction(t.entries)){const r={};return Pe.forEachEntry(t,(i,n)=>{e(inr(i),n,r,0)}),r}return null}const snr={"Content-Type":void 0};function onr(t,e,r){if(Pe.isString(t))try{return(e||JSON.parse)(t),Pe.trim(t)}catch(i){if(i.name!=="SyntaxError")throw i}return(r||JSON.stringify)(t)}const Dq={transitional:mXe,adapter:["xhr","http"],transformRequest:[function(e,r){const i=r.getContentType()||"",n=i.indexOf("application/json")>-1,s=Pe.isObject(e);if(s&&Pe.isHTMLForm(e)&&(e=new FormData(e)),Pe.isFormData(e))return n&&n?JSON.stringify(gXe(e)):e;if(Pe.isArrayBuffer(e)||Pe.isBuffer(e)||Pe.isStream(e)||Pe.isFile(e)||Pe.isBlob(e))return e;if(Pe.isArrayBufferView(e))return e.buffer;if(Pe.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(i.indexOf("application/x-www-form-urlencoded")>-1)return rnr(e,this.formSerializer).toString();if((a=Pe.isFileList(e))||i.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Lq(a?{"files[]":e}:e,l&&new l,this.formSerializer)}}return s||n?(r.setContentType("application/json",!1),onr(e)):e}],transformResponse:[function(e){const r=this.transitional||Dq.transitional,i=r&&r.forcedJSONParsing,n=this.responseType==="json";if(e&&Pe.isString(e)&&(i&&!this.responseType||n)){const o=!(r&&r.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?Vi.from(a,Vi.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Uy.classes.FormData,Blob:Uy.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Pe.forEach(["delete","get","head"],function(e){Dq.headers[e]={}});Pe.forEach(["post","put","patch"],function(e){Dq.headers[e]=Pe.merge(snr)});const lme=Dq,anr=Pe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),lnr=t=>{const e={};let r,i,n;return t&&t.split(`
`).forEach(function(o){n=o.indexOf(":"),r=o.substring(0,n).trim().toLowerCase(),i=o.substring(n+1).trim(),!(!r||e[r]&&anr[r])&&(r==="set-cookie"?e[r]?e[r].push(i):e[r]=[i]:e[r]=e[r]?e[r]+", "+i:i)}),e},UOe=Symbol("internals");function U$(t){return t&&String(t).trim().toLowerCase()}function E9(t){return t===!1||t==null?t:Pe.isArray(t)?t.map(E9):String(t)}function cnr(t){const e=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=r.exec(t);)e[i[1]]=i[2];return e}const unr=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function GJ(t,e,r,i,n){if(Pe.isFunction(i))return i.call(this,e,r);if(n&&(e=r),!!Pe.isString(e)){if(Pe.isString(i))return e.indexOf(i)!==-1;if(Pe.isRegExp(i))return i.test(e)}}function dnr(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,r,i)=>r.toUpperCase()+i)}function hnr(t,e){const r=Pe.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(t,i+r,{value:function(n,s,o){return this[i].call(this,e,n,s,o)},configurable:!0})})}class Nq{constructor(e){e&&this.set(e)}set(e,r,i){const n=this;function s(a,l,c){const u=U$(l);if(!u)throw new Error("header name must be a non-empty string");const h=Pe.findKey(n,u);(!h||n[h]===void 0||c===!0||c===void 0&&n[h]!==!1)&&(n[h||l]=E9(a))}const o=(a,l)=>Pe.forEach(a,(c,u)=>s(c,u,l));return Pe.isPlainObject(e)||e instanceof this.constructor?o(e,r):Pe.isString(e)&&(e=e.trim())&&!unr(e)?o(lnr(e),r):e!=null&&s(r,e,i),this}get(e,r){if(e=U$(e),e){const i=Pe.findKey(this,e);if(i){const n=this[i];if(!r)return n;if(r===!0)return cnr(n);if(Pe.isFunction(r))return r.call(this,n,i);if(Pe.isRegExp(r))return r.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,r){if(e=U$(e),e){const i=Pe.findKey(this,e);return!!(i&&this[i]!==void 0&&(!r||GJ(this,this[i],i,r)))}return!1}delete(e,r){const i=this;let n=!1;function s(o){if(o=U$(o),o){const a=Pe.findKey(i,o);a&&(!r||GJ(i,i[a],a,r))&&(delete i[a],n=!0)}}return Pe.isArray(e)?e.forEach(s):s(e),n}clear(e){const r=Object.keys(this);let i=r.length,n=!1;for(;i--;){const s=r[i];(!e||GJ(this,this[s],s,e,!0))&&(delete this[s],n=!0)}return n}normalize(e){const r=this,i={};return Pe.forEach(this,(n,s)=>{const o=Pe.findKey(i,s);if(o){r[o]=E9(n),delete r[s];return}const a=e?dnr(s):String(s).trim();a!==s&&delete r[s],r[a]=E9(n),i[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const r=Object.create(null);return Pe.forEach(this,(i,n)=>{i!=null&&i!==!1&&(r[n]=e&&Pe.isArray(i)?i.join(", "):i)}),r}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,r])=>e+": "+r).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...r){const i=new this(e);return r.forEach(n=>i.set(n)),i}static accessor(e){const i=(this[UOe]=this[UOe]={accessors:{}}).accessors,n=this.prototype;function s(o){const a=U$(o);i[a]||(hnr(n,o),i[a]=!0)}return Pe.isArray(e)?e.forEach(s):s(e),this}}Nq.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Pe.freezeMethods(Nq.prototype);Pe.freezeMethods(Nq);const m_=Nq;function HJ(t,e){const r=this||lme,i=e||r,n=m_.from(i.headers);let s=i.data;return Pe.forEach(t,function(a){s=a.call(r,s,n.normalize(),e?e.status:void 0)}),n.normalize(),s}function yXe(t){return!!(t&&t.__CANCEL__)}function e5(t,e,r){Vi.call(this,t??"canceled",Vi.ERR_CANCELED,e,r),this.name="CanceledError"}Pe.inherits(e5,Vi,{__CANCEL__:!0});function pnr(t,e,r){const i=r.config.validateStatus;!r.status||!i||i(r.status)?t(r):e(new Vi("Request failed with status code "+r.status,[Vi.ERR_BAD_REQUEST,Vi.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r))}const fnr=Uy.isStandardBrowserEnv?function(){return{write:function(r,i,n,s,o,a){const l=[];l.push(r+"="+encodeURIComponent(i)),Pe.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),Pe.isString(s)&&l.push("path="+s),Pe.isString(o)&&l.push("domain="+o),a===!0&&l.push("secure"),document.cookie=l.join("; ")},read:function(r){const i=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return i?decodeURIComponent(i[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function mnr(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function gnr(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}function vXe(t,e){return t&&!mnr(e)?gnr(t,e):e}const ynr=Uy.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");let i;function n(s){let o=s;return e&&(r.setAttribute("href",o),o=r.href),r.setAttribute("href",o),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return i=n(window.location.href),function(o){const a=Pe.isString(o)?n(o):o;return a.protocol===i.protocol&&a.host===i.host}}():function(){return function(){return!0}}();function vnr(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function _nr(t,e){t=t||10;const r=new Array(t),i=new Array(t);let n=0,s=0,o;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=i[s];o||(o=c),r[n]=l,i[n]=c;let h=s,f=0;for(;h!==n;)f+=r[h++],h=h%t;if(n=(n+1)%t,n===s&&(s=(s+1)%t),c-o<e)return;const m=u&&c-u;return m?Math.round(f*1e3/m):void 0}}function zOe(t,e){let r=0;const i=_nr(50,250);return n=>{const s=n.loaded,o=n.lengthComputable?n.total:void 0,a=s-r,l=i(a),c=s<=o;r=s;const u={loaded:s,total:o,progress:o?s/o:void 0,bytes:a,rate:l||void 0,estimated:l&&o&&c?(o-s)/l:void 0,event:n};u[e?"download":"upload"]=!0,t(u)}}const bnr=typeof XMLHttpRequest<"u",wnr=bnr&&function(t){return new Promise(function(r,i){let n=t.data;const s=m_.from(t.headers).normalize(),o=t.responseType;let a;function l(){t.cancelToken&&t.cancelToken.unsubscribe(a),t.signal&&t.signal.removeEventListener("abort",a)}Pe.isFormData(n)&&(Uy.isStandardBrowserEnv||Uy.isStandardBrowserWebWorkerEnv?s.setContentType(!1):s.setContentType("multipart/form-data;",!1));let c=new XMLHttpRequest;if(t.auth){const m=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";s.set("Authorization","Basic "+btoa(m+":"+g))}const u=vXe(t.baseURL,t.url);c.open(t.method.toUpperCase(),fXe(u,t.params,t.paramsSerializer),!0),c.timeout=t.timeout;function h(){if(!c)return;const m=m_.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders()),y={data:!o||o==="text"||o==="json"?c.responseText:c.response,status:c.status,statusText:c.statusText,headers:m,config:t,request:c};pnr(function(b){r(b),l()},function(b){i(b),l()},y),c=null}if("onloadend"in c?c.onloadend=h:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(h)},c.onabort=function(){c&&(i(new Vi("Request aborted",Vi.ECONNABORTED,t,c)),c=null)},c.onerror=function(){i(new Vi("Network Error",Vi.ERR_NETWORK,t,c)),c=null},c.ontimeout=function(){let g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const y=t.transitional||mXe;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),i(new Vi(g,y.clarifyTimeoutError?Vi.ETIMEDOUT:Vi.ECONNABORTED,t,c)),c=null},Uy.isStandardBrowserEnv){const m=(t.withCredentials||ynr(u))&&t.xsrfCookieName&&fnr.read(t.xsrfCookieName);m&&s.set(t.xsrfHeaderName,m)}n===void 0&&s.setContentType(null),"setRequestHeader"in c&&Pe.forEach(s.toJSON(),function(g,y){c.setRequestHeader(y,g)}),Pe.isUndefined(t.withCredentials)||(c.withCredentials=!!t.withCredentials),o&&o!=="json"&&(c.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&c.addEventListener("progress",zOe(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",zOe(t.onUploadProgress)),(t.cancelToken||t.signal)&&(a=m=>{c&&(i(!m||m.type?new e5(null,t,c):m),c.abort(),c=null)},t.cancelToken&&t.cancelToken.subscribe(a),t.signal&&(t.signal.aborted?a():t.signal.addEventListener("abort",a)));const f=vnr(u);if(f&&Uy.protocols.indexOf(f)===-1){i(new Vi("Unsupported protocol "+f+":",Vi.ERR_BAD_REQUEST,t));return}c.send(n||null)})},C9={http:qir,xhr:wnr};Pe.forEach(C9,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const xnr={getAdapter:t=>{t=Pe.isArray(t)?t:[t];const{length:e}=t;let r,i;for(let n=0;n<e&&(r=t[n],!(i=Pe.isString(r)?C9[r.toLowerCase()]:r));n++);if(!i)throw i===!1?new Vi(`Adapter ${r} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(Pe.hasOwnProp(C9,r)?`Adapter '${r}' is not available in the build`:`Unknown adapter '${r}'`);if(!Pe.isFunction(i))throw new TypeError("adapter is not a function");return i},adapters:C9};function qJ(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new e5(null,t)}function VOe(t){return qJ(t),t.headers=m_.from(t.headers),t.data=HJ.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),xnr.getAdapter(t.adapter||lme.adapter)(t).then(function(i){return qJ(t),i.data=HJ.call(t,t.transformResponse,i),i.headers=m_.from(i.headers),i},function(i){return yXe(i)||(qJ(t),i&&i.response&&(i.response.data=HJ.call(t,t.transformResponse,i.response),i.response.headers=m_.from(i.response.headers))),Promise.reject(i)})}const BOe=t=>t instanceof m_?t.toJSON():t;function u3(t,e){e=e||{};const r={};function i(c,u,h){return Pe.isPlainObject(c)&&Pe.isPlainObject(u)?Pe.merge.call({caseless:h},c,u):Pe.isPlainObject(u)?Pe.merge({},u):Pe.isArray(u)?u.slice():u}function n(c,u,h){if(Pe.isUndefined(u)){if(!Pe.isUndefined(c))return i(void 0,c,h)}else return i(c,u,h)}function s(c,u){if(!Pe.isUndefined(u))return i(void 0,u)}function o(c,u){if(Pe.isUndefined(u)){if(!Pe.isUndefined(c))return i(void 0,c)}else return i(void 0,u)}function a(c,u,h){if(h in e)return i(c,u);if(h in t)return i(void 0,c)}const l={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,u)=>n(BOe(c),BOe(u),!0)};return Pe.forEach(Object.keys(Object.assign({},t,e)),function(u){const h=l[u]||n,f=h(t[u],e[u],u);Pe.isUndefined(f)&&h!==a||(r[u]=f)}),r}const _Xe="1.4.0",cme={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{cme[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}});const jOe={};cme.transitional=function(e,r,i){function n(s,o){return"[Axios v"+_Xe+"] Transitional option '"+s+"'"+o+(i?". "+i:"")}return(s,o,a)=>{if(e===!1)throw new Vi(n(o," has been removed"+(r?" in "+r:"")),Vi.ERR_DEPRECATED);return r&&!jOe[o]&&(jOe[o]=!0,console.warn(n(o," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(s,o,a):!0}};function Snr(t,e,r){if(typeof t!="object")throw new Vi("options must be an object",Vi.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let n=i.length;for(;n-- >0;){const s=i[n],o=e[s];if(o){const a=t[s],l=a===void 0||o(a,s,t);if(l!==!0)throw new Vi("option "+s+" must be "+l,Vi.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new Vi("Unknown option "+s,Vi.ERR_BAD_OPTION)}}const Zoe={assertOptions:Snr,validators:cme},J1=Zoe.validators;class Gj{constructor(e){this.defaults=e,this.interceptors={request:new kOe,response:new kOe}}request(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=u3(this.defaults,r);const{transitional:i,paramsSerializer:n,headers:s}=r;i!==void 0&&Zoe.assertOptions(i,{silentJSONParsing:J1.transitional(J1.boolean),forcedJSONParsing:J1.transitional(J1.boolean),clarifyTimeoutError:J1.transitional(J1.boolean)},!1),n!=null&&(Pe.isFunction(n)?r.paramsSerializer={serialize:n}:Zoe.assertOptions(n,{encode:J1.function,serialize:J1.function},!0)),r.method=(r.method||this.defaults.method||"get").toLowerCase();let o;o=s&&Pe.merge(s.common,s[r.method]),o&&Pe.forEach(["delete","get","head","post","put","patch","common"],g=>{delete s[g]}),r.headers=m_.concat(o,s);const a=[];let l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(r)===!1||(l=l&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});const c=[];this.interceptors.response.forEach(function(y){c.push(y.fulfilled,y.rejected)});let u,h=0,f;if(!l){const g=[VOe.bind(this),void 0];for(g.unshift.apply(g,a),g.push.apply(g,c),f=g.length,u=Promise.resolve(r);h<f;)u=u.then(g[h++],g[h++]);return u}f=a.length;let m=r;for(h=0;h<f;){const g=a[h++],y=a[h++];try{m=g(m)}catch(_){y.call(this,_);break}}try{u=VOe.call(this,m)}catch(g){return Promise.reject(g)}for(h=0,f=c.length;h<f;)u=u.then(c[h++],c[h++]);return u}getUri(e){e=u3(this.defaults,e);const r=vXe(e.baseURL,e.url);return fXe(r,e.params,e.paramsSerializer)}}Pe.forEach(["delete","get","head","options"],function(e){Gj.prototype[e]=function(r,i){return this.request(u3(i||{},{method:e,url:r,data:(i||{}).data}))}});Pe.forEach(["post","put","patch"],function(e){function r(i){return function(s,o,a){return this.request(u3(a||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:o}))}}Gj.prototype[e]=r(),Gj.prototype[e+"Form"]=r(!0)});const R9=Gj;class ume{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let r;this.promise=new Promise(function(s){r=s});const i=this;this.promise.then(n=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](n);i._listeners=null}),this.promise.then=n=>{let s;const o=new Promise(a=>{i.subscribe(a),s=a}).then(n);return o.cancel=function(){i.unsubscribe(s)},o},e(function(s,o,a){i.reason||(i.reason=new e5(s,o,a),r(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}static source(){let e;return{token:new ume(function(n){e=n}),cancel:e}}}const Tnr=ume;function Enr(t){return function(r){return t.apply(null,r)}}function Cnr(t){return Pe.isObject(t)&&t.isAxiosError===!0}const Joe={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Joe).forEach(([t,e])=>{Joe[e]=t});const Rnr=Joe;function bXe(t){const e=new R9(t),r=rXe(R9.prototype.request,e);return Pe.extend(r,R9.prototype,e,{allOwnKeys:!0}),Pe.extend(r,e,null,{allOwnKeys:!0}),r.create=function(n){return bXe(u3(t,n))},r}const ka=bXe(lme);ka.Axios=R9;ka.CanceledError=e5;ka.CancelToken=Tnr;ka.isCancel=yXe;ka.VERSION=_Xe;ka.toFormData=Lq;ka.AxiosError=Vi;ka.Cancel=ka.CanceledError;ka.all=function(e){return Promise.all(e)};ka.spread=Enr;ka.isAxiosError=Cnr;ka.mergeConfig=u3;ka.AxiosHeaders=m_;ka.formToJSON=t=>gXe(Pe.isHTMLForm(t)?new FormData(t):t);ka.HttpStatusCode=Rnr;ka.default=ka;const wXe=ka,Onr="/arcgis-demo-vite/assets/1496-198db9e1.gif";function xXe(){return F.jsx("div",{children:F.jsx("img",{src:Onr,style:{zIndex:10,width:"64px",position:"absolute",left:"50%",top:"50%",marginLeft:"-50px",marginTop:"-50px"},alt:"Loading..."})})}const Anr={NAME:"Slope",CODE:"slope",FIELDS:["min","max","mean"],DESC:"Slope - Steepness of raster cell derived from USGS 1/3 arcsec DEM for United States",JURIS:"us",RESOURCE:"raster",SRC:"USGS"},Pnr={NAME:"Roads",CODE:"roads",FIELDS:["highway","osm_id","name","lane","last_editor","last_update","surface","width"],DESC:"OSM dataset of roads including everything between highways and residential roads",JURIS:"us",RESOURCE:"db",SRC:"OpenStreetMap"},Mnr={NAME:"Prisons",CODE:"prisons",FIELDS:["objectid","facilityid","address","city","state","zip","zip4","type","status","population","county","countyfips","naics_code","naics_desc","securelvl","capacity","name","time_stamp"],DESC:"Prison locations in the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},$nr={NAME:"Streams",CODE:"streams",FIELDS:["objectid","name","ftype","fcode","fcode_desc","strm_level","ap_within","meters","feet","time_stamp"],DESC:"Stream polylines throughout the United States",JURIS:"us",RESOURCE:"db",SRC:"USGS"},Inr={NAME:"Balloonports",CODE:"balloonports",FIELDS:["global_id","ident","elevation","icao_id","type_code","servcity","state","operstatus"],DESC:"Balloonport points buffered at 1 nautical mile",JURIS:"us",RESOURCE:"db",SRC:"FAA"},Lnr={NAME:"Glideports",CODE:"glideports",FIELDS:["global_id","ident","elevation","icao_id","type_code","servcity","state","operstatus"],DESC:"Glideport points buffered at 1 nautical mile",JURIS:"us",RESOURCE:"db",SRC:"FAA"},Dnr={NAME:"Ultralight",CODE:"ultralight",FIELDS:["global_id","ident","elevation","icao_id","type_code","servcity","state","operstatus"],DESC:"Ultralight landing points buffered at 1 nautical mile",JURIS:"us",RESOURCE:"db",SRC:"FAA"},Nnr={NAME:"Schools",CODE:"schools",FIELDS:["objectid","ncesid","address","city","state","zip","zip4","type","status","population","county","countyfips","naics_code","naics_desc","sourcedate","val_method","val_date","website","enrollment","st_grade","end_grade","districtid","ft_teacher","shelter_id","start_grad","name","school_type","time_stamp","category"],DESC:"School locations",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},Fnr={NAME:"Stadium",CODE:"stadium",FIELDS:["objectid","global_id","name","latitude","longitude","city","state","status_code","time_stamp"],DESC:"Select stadiums containing temporary flight restriction. The stadium points are buffered by 3 nautical miles",JURIS:"us",RESOURCE:"db",SRC:"FAA"},knr={NAME:"Bridges",CODE:"bridges",FIELDS:["objectid","state_code_001","structure_number_008","record_type_005a","route_prefix_005b","service_level_005c","route_number_005d","direction_005e","highway_district_002","bridge_condition","lowest_rating","deck_area","status","date","time_stamp"],DESC:"Bridges in the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},Unr={NAME:"Helipads",CODE:"helipads",FIELDS:["objectid","global_id","ident","elevation","icao_id","type_code","servcity","state","operstatus","privateuse","iapexists","dodhiflip","far91","far93","mil_code","airanal","us_high","us_low","ak_high","ak_low","us_area","pacific","name","time_stamp"],DESC:"Helipad locations throughout the United States",JURIS:"us",RESOURCE:"db",SRC:"FAA"},znr={NAME:"Parks",CODE:"parks",FIELDS:["objectid","featclass","category","own_type","own_name","loc_own","mang_type","mang_name","loc_mang","des_tp","loc_ds","unit_nm","loc_nm","state_nm","agg_src","gis_src","src_date","gis_acres","source_paid","wdpa_cd","pub_access","access_src","access_dt","gap_sts","gapcdsrc","gapcddt","iucn_cat","iucnctsrc","iucnctdt","date_est","comments","esmthldr","eholdtyp","globalid","creationdate","creator","editdate","editor","time_stamp"],DESC:"Parks throughout the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},Vnr={NAME:"Hazards",CODE:"hazards",FIELDS:["objectid","category","categorytype","name","risk","country_geoid","st_geoid","co_geoid","cosub_geoid","place_geoid","region_geoid","campus_geoid","groupid"],DESC:"Hazards contain various types of infrastructure",JURIS:"all",RESOURCE:"db",SRC:"Airspace Link"},Bnr={NAME:"Courthouses",CODE:"courthouses",FIELDS:["objectid","permanent_identifier","source_featureid","source_datasetid","source_datadesc","source_originator","data_security","distribution_policy","loaddate","ftype","fcode","islandmark","pointlocationtype","admintype","addressbuildingname","address","city","state","zipcode","foot_id","complex_id","name","time_stamp"],DESC:"Courthouses across the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},jnr={NAME:"Hospitals",CODE:"hospitals",FIELDS:["objectid","id","address","address2","city","state","zip","zipp4","county","zip4","type","status","population","countyfips","naics_code","naics_desc","val_method","state_id","alt_name","st_fips","owner","ttl_staff","beds","trauma","helipad","name","time_stamp"],DESC:"Hospital locations throughout the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},Gnr={NAME:"Airports",CODE:"airports",FIELDS:["global_id","ident","elevation","icao_id","type_code","servcity","state","operstatus","privateuse","iapexists","dodhiflip","far91","far93","mil_code","airanal","us_high","us_low","ak_high","ak_low","us_area","pacific","name","category"],DESC:"Points designated for landing or takeoff",JURIS:"us",RESOURCE:"db",SRC:"FAA"},z$={Slope:Anr,"Terrain Ruggedness Index":{NAME:"Terrain Ruggedness Index",CODE:"tri",FIELDS:["min","max","mean"],DESC:"Terrain Ruggedness Index (TRI) - elevation difference between adjacent raster cells derived from USGS 1/3 arcsec DEM for United States",JURIS:"us",RESOURCE:"raster",SRC:"USGS"},"Building Footprint":{NAME:"Building Footprint",CODE:"building_footprint",FIELDS:["objectid","release","capture_dates_range","area","state","time_stamp"],DESC:"Building footprints from MS repository",JURIS:"us",RESOURCE:"db",SRC:"Microsoft"},Roads:Pnr,"Temporary flight restrictions":{NAME:"Temporary flight restrictions",CODE:"tfr",FIELDS:["objectid","notam_id","tfr_type","tfr_area","location","reason","issue_date","start_time","end_time","contact","lower_alt","lalt_type","upper_alt","ualt_type","url","status","effective","time_stamp"],DESC:"Temporary Flight Restrictions imposed by the FAA to restrict aircraft operations within designated areas",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"Airspace schedule":{NAME:"Airspace schedule",CODE:"airspace_schedule",FIELDS:"APPLIES,Airspace_ID,FAA_ID",DESC:"Controlled airspace schedule for select airports across the country (geometry has no bearing on the result)",JURIS:"us",RESOURCE:"arcgis",SRC:"FAA"},Prisons:Mnr,Streams:$nr,Balloonports:Inr,"Daytime population data":{NAME:"Daytime population data",CODE:"population_daytime",FIELDS:["objectid","pointid","population","time_stamp"],DESC:"Population points that represent an approximate measure of how many people are in a specific area during the day across the United States",JURIS:"us",RESOURCE:"db",SRC:"Landscan"},Glideports:Lnr,Ultralight:Dnr,Schools:Nnr,"NRHP Location Points":{NAME:"NRHP Location Points",CODE:"historical_location_points",FIELDS:["geometry"],DESC:"Historic properties listed on the National Register of Historic Places (points)",JURIS:"us",RESOURCE:"db",SRC:"NPS"},"State capitol buildings":{NAME:"State capitol buildings",CODE:"state_capitol_buildings",FIELDS:["objectid","permanent_identifier","source_featureid","source_datasetid","source_datadesc","source_originator","data_security","distribution_policy","loaddate","ftype","fcode","islandmark","pointlocationtype","admintype","addressbuildingname","address","city","state","zipcode","foot_id","complex_id","name","time_stamp"],DESC:"Capitol building polygons",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"NRHP Location Polygons":{NAME:"NRHP Location Polygons",CODE:"historical_location_polygons",FIELDS:["geometry"],DESC:"Historic properties listed on the National Register of Historic Places (polygons)",JURIS:"us",RESOURCE:"db",SRC:"NPS"},Stadium:Fnr,"FAA Obstacles":{NAME:"FAA Obstacles",CODE:"faa_obstacles",FIELDS:["objectid","oas","verified_status","country","state","city","latdec","londec","dmslat","dmslon","type","quantity","agl","amsl","lighting","accuracy","marking","action","jdate","time_stamp"],DESC:"Point locations of obstacles",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"Power Plants":{NAME:"Power Plants",CODE:"power_plants",FIELDS:["objectid","plant_code","address","city","state","zip","telephone","type","status","county","countyfips","country","latitude","longitude","naics_code","naics_desc","source","val_method","website","operator","operat_id","oper_cap","summer_cap","winter_cap","plan_cap","retire_cap","gen_units","plan_unit","retir_unit","prim_fuel","sec_fuel","coal_used","ngas_used","oil_used","net_gen","cap_factor","sub_1","sub_2","lines","source_lat","sourc_long","name","area","length","time_stamp"],DESC:"Polygons of power plants",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"Military Training Routes":{NAME:"Military Training Routes",CODE:"mtr",FIELDS:["global_id","ident","name","upper_val","upper_uom","upper_code","lower_val","lower_uom","lower_code","mtr_type","routetype","country","widthleft","widthright","ak_low","ak_high","us_low","us_high","us_area","pacific","time_stamp"],DESC:"Polylines of military training routes",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"Railroad bridges":{NAME:"Railroad bridges",CODE:"railroad_bridges",FIELDS:["objectid","id","secclass","name","city","state","zip","county","fips","directions","contdate","conthow","geodate","geohow","geolinkid","x","y","st_vendor","st_version","geoprec","qc_qa","nrrn_id","link_id","railway_nm","ntad_id","oak_id","com_id","fdate","gnis_id","gnis_name","ftype","fcode","feature_ty","descriptio","reachcode","flowdir","state_code","struct_num","inv_route","cnty_code","place_code","feat_inter","location","toll","owner","year_built","work_type","status","time_stamp"],DESC:"All railroad bridges in the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},Bridges:knr,"Recreational Flyer Fixed Sites":{NAME:"Recreational Flyer Fixed Sites",CODE:"recreational_flyer_fixed_sites",FIELDS:["site_name","site_id","city","state","zip_code","ceiling","boundary","unit","poc","time_stamp","last_edit_dt","globalid"],DESC:"Active flying fields that are established by an agreement with the FAA",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"Community advisories":{NAME:"Community advisories",CODE:"community_advisories",FIELDS:["id","name","geo_id","country_geo_id","altitude_upper","altitude_lower","reference_number","url","contact_email","contact_phone","start_time","end_time","timezone_name","advisory_category_id"],DESC:"Advisories are areas of airspace in which governments seek to alert pilots of additional risk",JURIS:"all",RESOURCE:"db",SRC:"Airspace Link"},"Veteran health facilities":{NAME:"Veteran health facilities",CODE:"veteran_health_facilities",FIELDS:["objectid","address","address2","city","state","zip","zipp4","county","fips","directions","contdate","conthow","geodate","geohow","naicscode","naicsdescr","geolinkid","st_vendor","st_version","geoprec","phoneloc","qc_qa","sta_no","uid_","extrdate","visn","prov","cont","par_sta_no","pod","oper_date","sh_par_sta","ioc","moc","cd115","prim_svc","ulid","cbsa","ua","urh","unique_id","sta_fax","shar","phone","name","time_stamp"],DESC:"Health facility polygons for United States veterans of the armed forces",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},Helipads:Unr,"Bodies of water":{NAME:"Bodies of water",CODE:"water_bodies",FIELDS:["objectid","name","ftype","fcode","fcode_desc","sqkm","sqmi","time_stamp"],DESC:"General bodies of water in the United States",JURIS:"us",RESOURCE:"db",SRC:"USGS"},"Child Care Centers":{NAME:"Child Care Centers",CODE:"child_care_center",FIELDS:["objectid","id","name","address","city","state","zip","zip4","telephone","type","status","population","county","countyfips","country","latitude","longitude","naics_code","naics_desc","source","val_method","val_date","website","st_subtype","time_stamp"],DESC:"Child Care Centers in the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"Railroad lines":{NAME:"Railroad lines",CODE:"railroad_lines",FIELDS:["objectid","fraarcid","frfranode","tofranode","stfips","ctfips","stcyfips","state","country","fraregion","rrowner1","rrowner2","rrowner3","trkrghts1","trkrghts2","trkrghts3","trkrghts4","trkrghts5","trkrghts6","trkrghts7","trkrghts8","trkrghts9","subdiv","yard","passngr","stracnet","tracks","net","miles","old_fraid","time_stamp"],DESC:"Railroad network of the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},Parks:znr,"Population Night":{NAME:"Population Night",CODE:"population_nighttime",FIELDS:["objectid","geometry","value","time_stamp"],DESC:"Population points that represent an approximate measure of how many people are in a specific area during the day across the United States",JURIS:"us",RESOURCE:"db",SRC:"Landscan"},Hazards:Vnr,"Landscan Night Polygon":{NAME:"Landscan Night Polygon",CODE:"landscan_night_polygon",FIELDS:["objectid","value","time_stamp"],DESC:"Population points that represent an approximate measure of how many people are in a specific area during the night across the United States",JURIS:"us",RESOURCE:"db",SRC:"Landscan"},"Landscan Day Polygon":{NAME:"Landscan Day Polygon",CODE:"landscan_day_polygon",FIELDS:["objectid","value","time_stamp"],DESC:"Population points that represent an approximate measure of how many people are in a specific area during the day across the United States",JURIS:"us",RESOURCE:"db",SRC:"Landscan"},"Digital elevation model":{NAME:"Digital elevation model",CODE:"dem_ft",FIELDS:["min","max","mean"],DESC:"CONUS digital elevation model in ft",JURIS:"us",RESOURCE:"raster",SRC:"USGS"},"Land use land cover":{NAME:"Land use land cover",CODE:"lulc",FIELDS:["mode"],DESC:"Land use land cover data binned into h3 hexagons with english labels applied",JURIS:"us",RESOURCE:"raster",SRC:"USGS"},"Convention centers and fairgrounds":{NAME:"Convention centers and fairgrounds",CODE:"convention_centers_and_fairgrounds",FIELDS:["objectid","conv_id","address","city","state","zip","zip4","type","status","county","countyfips","naics_code","naics_desc","complexnm","formernm","yearchng","fixed_sts","ballroom","exhibit","lobby","main_floor","outdoor","pre_funct","meet_rooms","name","time_stamp"],DESC:"Locations of convention centers, conference centers, exposition centers, and fairgrounds for the 50 U.S. states, D.C., and the territory of Puerto Rico",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},Courthouses:Bnr,"Electric substations":{NAME:"Electric substations",CODE:"electric_substations",FIELDS:["objectid","id","city","state","zip","type","status","county","countyfips","naics_code","naics_desc","sourcedate","val_method","val_date","lines","max_volt","min_volt","max_infer","min_infer","name","time_stamp"],DESC:"Electric substations dispersed throughout the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"EMS stations":{NAME:"EMS stations",CODE:"ems_stations",FIELDS:["objectid","id","address","address2","city","state","zip","zip4","county","fips","naicscode","naicsdescr","geoprec","phoneloc","state_id","fdid","specialty","emslicense","frst","perm_id","emergtel","emerphone","directions","emergtitle","owner","name","time_stamp"],DESC:"Emergency Medical Service (EMS) stations throughout the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"Fire stations":{NAME:"Fire stations",CODE:"fire_stations",FIELDS:["objectid","permanent_identifier","source_featureid","source_datasetid","source_datadesc","source_originator","data_security","distribution_policy","loaddate","ftype","fcode","islandmark","pointlocationtype","admintype","addressbuildingname","address","city","state","zipcode","foot_id","complex_id","name","time_stamp"],DESC:"Fire stations throughout the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"Government buildings":{NAME:"Government buildings",CODE:"government_buildings",FIELDS:["objectid","address","address2","city","state","zip","county","fips","directions","naicscode","naicsdescr","geoprec","phoneloc","agencies","agency_ph","unique_id","num_agency","zip4","name","time_stamp"],DESC:"Government buildings throughout the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},Hospitals:jnr,"Military facilities":{NAME:"Military facilities",CODE:"military_facilities",FIELDS:["objectid","component","joint_base","state_terr","oper_stat","time_stamp","site_name"],DESC:"Military base locations in the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"Police stations":{NAME:"Police stations",CODE:"police_stations",FIELDS:["objectid","id","address","city","state","zip","zip4","type","status","population","county","countyfips","naics_code","naics_desc","sourcedate","val_method","val_date","ci_id","csllea08id","subtype1","subtype2","tribal","ftsworn","ftciv","ptsworn","ptciv","name","time_stamp"],DESC:"Police station locations",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"Sport venues":{NAME:"Sport venues",CODE:"sport_venues",FIELDS:["objectid","venueid","address","city","state","zip","zip4","type","status","population","county","countyfips","naics_code","naics_desc","name","name2","name3","formernm","yearchng","time_stamp"],DESC:"Sport venue locations",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"Transmission lines":{NAME:"Transmission lines",CODE:"transmission_lines",FIELDS:["objectid","id","type","status","naics_code","naics_desc","source","sourcedate","val_method","val_date","owner","voltage","volt_class","inferred","sub_1","sub_2","time_stamp"],DESC:"High-voltage electric lines",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"Controlled Airspace Classification":{NAME:"Controlled Airspace Classification",CODE:"controlled_airspace",FIELDS:["ident","icao_id","name","upper_desc","upper_val","upper_uom","upper_code","lower_desc","lower_val","lower_uom","lower_code","type_code","local_type","class","mil_code","comm_name","level_","sector","onshore","exclusion","wkhr_code","wkhr_rmk","dst","gmtoffset","cont_agent","city","state","country","adhp_id","us_high","us_low","ak_high","ak_low","us_area","pacific","time_stamp","global_id"],DESC:"Airspace that is under FAA control",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"Special use airspace":{NAME:"Special use airspace",CODE:"sua",FIELDS:["global_id","name","type_code","class","upper_desc","upper_val","upper_uom","upper_code","lower_desc","lower_val","lower_uom","lower_code","level_code","city","state","country","cont_agent","comm_name","sector","onshore","exclusion","timesofuse","gmtoffset","dst_code","remarks","ak_low","ak_high","us_low","us_high","us_area","pacific","time_stamp"],DESC:"Special use airspace contains both prohibited and restricted airspace; see https://www.faa.gov/air_traffic/publications/atpubs/aim_html/chap3_section_4.html for more details",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"Full Time National Security UAS Flight Restriction":{NAME:"Full Time National Security UAS Flight Restriction",CODE:"nsufr_ft",FIELDS:["objectid","facility","airspace","reason","poc","state","county","proponent","branch","base","faa_id","floor","ceiling","time_stamp"],DESC:"Any full time flight restriction, created for national security purposes",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"Colleges and universities":{NAME:"Colleges and universities",CODE:"colleges_universities",FIELDS:["objectid","ipedsid","address","city","state","zip","zip4","type","status","population","county","countyfips","naics_code","naics_desc","val_method","stfips","cofips","sector","hi_offer","deg_grant","locale","close_date","merge_id","alias","size_set","inst_size","pt_enroll","ft_enroll","tot_enroll","housing","dorm_cap","tot_emp","shelter_id","uniqueid","shelterid","name","time_stamp"],DESC:"Campus grounds for universities and colleges throughout the US",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"Washington DC Flight Restricted Zone":{NAME:"Washington DC Flight Restricted Zone",CODE:"washington_frz",FIELDS:["global_id","name","onshore","exclusion","ak_low","ak_high","us_low","us_high","us_area","pacific","ident","type_code","class","local_type","icao_id","sector","upper_desc","upper_uom","upper_val","upper_code","lower_desc","lower_val","lower_uom","lower_code","comm_name","city","state","country","adhp_id","mil_code","remarks","time_stamp"],DESC:"The prohibited flight restriction zone around the capitol",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"UAS Facility Management Flight Ceiling":{NAME:"UAS Facility Management Flight Ceiling",CODE:"uasfm_ceiling",FIELDS:["objectid","ceiling","unit","map_eff","last_edit","latitude","longitude","globalid","arpt_count","apt1_faaid","apt1_icao","apt1_name","apt1_laanc","apt2_faaid","apt2_icao","apt2_name","apt2_laanc","apt3_faaid","apt3_icao","apt3_name","apt3_laanc","apt4_faaid","apt4_icao","apt4_name","apt4_laanc","apt5_faaid","apt5_icao","apt5_name","apt5_laanc","airs_count","airspace_1","airspace_2","airspace_3","airspace_4","airspace_5","region","apt1_enabled","apt2_enabled","apt3_enabled","apt4_enabled","apt5_enabled","time_stamp","laanc_status"],DESC:"Maximum altitude features surrounding airports where the FAA enables operations",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"Part Time National Security UAS Flight Restriction":{NAME:"Part Time National Security UAS Flight Restriction",CODE:"nsufr_pt",FIELDS:["objectid","proponent","branch","base","facility","airspace","reason","state","faa_id","poc","floor","ceiling","county","alertype","adviseinst","adviseauth","advisenote","alerttime","activetime","endtime","time_stamp"],DESC:"Any part time flight restriction, created for national security purposes",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"Urgent care facilities":{NAME:"Urgent care facilities",CODE:"urgent_care",FIELDS:["objectid","id","address","address2","city","state","zip","zipp4","county","fips","directions","emergtitle","emergtel","emergext","contdate","conthow","geodate","geohow","hsipthemes","naicscode","naicsdescr","geolinkid","x","y","st_vendor","st_version","geoprec","phoneloc","qc_qa","ucaoa_id","name","time_stamp"],DESC:"Urgent care facilities dispersed throughout the United States",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"Wind farms":{NAME:"Wind farms",CODE:"wind_farms",FIELDS:["objectid","case_id","faa_ors","faa_asn","usgs_pr_id","eia_id","t_state","t_county","t_fips","p_name","p_year","p_tnum","p_cap","t_manu","t_model","t_cap","t_hh","t_rd","t_rsa","t_ttlh","retrofit","retrofit_y","t_conf_atr","t_conf_loc","t_img_date","t_img_srce","xlong","ylat","buff_dist","time_stamp"],DESC:"Polygons representing coverage of individual wind turbines",JURIS:"us",RESOURCE:"db",SRC:"USGS"},"National Parks":{NAME:"National Parks",CODE:"national_parks",FIELDS:["objectid","unit_code","gis_notes","unit_name","state","region","gnis_id","unit_type","created_by","metadata","parkname","creationdate","creator","editdate","editor","areaid","time_stamp"],DESC:"Polygons of national parks",JURIS:"us",RESOURCE:"db",SRC:"NPS"},"Population in daytime":{NAME:"Population in daytime",CODE:"population",FIELDS:["density"],DESC:"Population density data binned into h3 hexagons with units of people/mi2",JURIS:"us",RESOURCE:"raster",SRC:"Landscan"},"Railroad bridge overpass":{NAME:"Railroad bridge overpass",CODE:"railroad_overpass",FIELDS:["objectid","id","secclass","name","city","state","zip","county","fips","directions","contdate","conthow","geodate","geohow","geolinkid","st_version","railway_nm","fdate","gnis_name","ftype","fcode","feature_ty","descriptio","reachcode","flowdir","state_code","struct_num","inv_route","cnty_code","place_code","feat_inter","location","toll","owner","year_built","work_type","status","time_stamp"],DESC:"Railroad bridges that cross over roads",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"FCC Antenna Structures":{NAME:"FCC Antenna Structures",CODE:"fcc_asr",FIELDS:["objectid","registration_number","status","file_number","owner_name","structure_city_state","overall_height_above_ground_agl","time_stamp"],DESC:"Antenna structures from the ASR dataset maintained by the FCC",JURIS:"us",RESOURCE:"db",SRC:"FCC"},"Emergency operation centers":{NAME:"Emergency operation centers",CODE:"eocs",FIELDS:["objectid","id","address","address2","city","state","zip","zipp4","county","fips","directions","emergtitle","emergtel","emergext","contdate","conthow","geodate","geohow","hsipthemes","naicscode","naicsdescr","geolinkid","x","y","st_vendor","st_version","geoprec","phoneloc","qc_qa","generator","basement","website","tot_staff","eoc_cap","lvlgovop","fax","state_id","email","cont1phone","cont1ext","cont1fax","cont1email","cont2phone","cont2ext"],DESC:"Emergency Operation Centers (EOCs)",JURIS:"us",RESOURCE:"db",SRC:"HIFLD"},"ZIP codes":{NAME:"ZIP codes",CODE:"zip_codes",FIELDS:["fid","zcta5ce20","affgeoid20","geoid20","aland20","awater20","time_stamp","name20","lsad20"],DESC:"ZIP code regions breakdown in the United States",JURIS:"us",RESOURCE:"db",SRC:"US Census Bureau"},"Landscan Night Point":{NAME:"Landscan Night Point",CODE:"landscan_night_point",FIELDS:["objectid","value","time_stamp"],DESC:"Population points that represent an approximate measure of how many people are in a specific area during the night across the United States",JURIS:"us",RESOURCE:"db",SRC:"Landscan"},"Landscan Day Point":{NAME:"Landscan Day Point",CODE:"landscan_day_point",FIELDS:["value","objectid","time_stamp"],DESC:"Population points that represent an approximate measure of how many people are in a specific area during the day across the United States",JURIS:"us",RESOURCE:"db",SRC:"Landscan"},Airports:Gnr,"UAS Facility Management Flight Ceiling Primary":{NAME:"UAS Facility Management Flight Ceiling Primary",CODE:"uasfm_ceiling_primary",FIELDS:["objectid","ceiling","unit","map_eff","last_edit","latitude","longitude","globalid","arpt_count","apt1_faaid","apt1_icao","apt1_name","apt1_laanc","apt2_faaid","apt2_icao","apt2_name","apt2_laanc","apt3_faaid","apt3_icao","apt3_name","apt3_laanc","apt4_faaid","apt4_icao","apt4_name","apt4_laanc","apt5_faaid","apt5_icao","apt5_name","apt5_laanc","airs_count","airspace_1","airspace_2","airspace_3","airspace_4","airspace_5","region","apt1_enabled","apt2_enabled","apt3_enabled","apt4_enabled","apt5_enabled","time_stamp","laanc_status"],DESC:"Maximum altitude features surrounding airports where the FAA enables operations (primary)",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"UAS Facility Management Flight Ceiling Secondary":{NAME:"UAS Facility Management Flight Ceiling Secondary",CODE:"uasfm_ceiling_secondary",FIELDS:["objectid","ceiling","unit","map_eff","last_edit","latitude","longitude","globalid","arpt_count","apt1_faaid","apt1_icao","apt1_name","apt1_laanc","apt2_faaid","apt2_icao","apt2_name","apt2_laanc","apt3_faaid","apt3_icao","apt3_name","apt3_laanc","apt4_faaid","apt4_icao","apt4_name","apt4_laanc","apt5_faaid","apt5_icao","apt5_name","apt5_laanc","airs_count","airspace_1","airspace_2","airspace_3","airspace_4","airspace_5","region","apt1_enabled","apt2_enabled","apt3_enabled","apt4_enabled","apt5_enabled","time_stamp","laanc_status"],DESC:"Maximum altitude features surrounding airports where the FAA enables operations (secondary)",JURIS:"us",RESOURCE:"db",SRC:"FAA"},"US Building Footprints":{NAME:"US Building Footprints",CODE:"building_footprints",FIELDS:["objectid","release","capture_dates_range","time_stamp","area","state"],DESC:"Polygon dataset for US building footprints",JURIS:"us",RESOURCE:"db",SRC:"Microsoft"}},Ix=U.createContext({GeoJSONblob:"",fields:{},fieldInfos:{},hexTypes:[],parsedGeoJSON:{type:"",features:[]},blob:new Blob([])}),dme=({children:t})=>{const[e,r]=U.useContext(Co),[i,n]=U.useState({GeoJSONblob:"",fields:{},fieldInfos:{},hexTypes:[],parsedGeoJSON:{type:"",features:[]},blob:new Blob([])}),[s,o]=U.useState(!0),a=U.useCallback(async()=>{o(!0);let c={resolution:e.surfaceResolution,scoring:{LOW:5,MED:50,HIGH:200},layers:[{code:"lulc",fields:["mode"],score:"BASE",fieldType:"",newField:"",expr:[]}],geometry:{type:"Polygon",coordinates:[e.AOIgeometry]}};e.scoredFields.length!==0&&e.scoredFields.forEach(f=>{const m=f.field.split("_")[0],g=z$[m].CODE==="roads"?f.func.join("|"):f.valueCalc===!0?`lambda x: 1 if ${f.func} else None`:f.func,y={fields:[z$[m].FIELDS[0]],code:z$[f.field.split("_")[0]].CODE,score:f.func.length>0?f.funcScore:f.score,expr:f.func.length>0?g:"",fieldType:f.func.length===0?"":z$[m].CODE==="lulc"?"IN_LIST":z$[m].CODE==="roads"?"MATCH_PARTIAL":"FUNC",newField:f.func.length>0?f.field:""};c.layers.push(y)});const u=JSON.stringify(c);var h={method:"post",url:"http://localhost:7071/api/solutionsSurfaceV2",headers:{"Content-Type":"application/json"},data:u};Object.keys(e.AOIgeometry).length!==0&&Object.keys(e.scoredFields).length!==0&&(console.log("request",c),wXe(h).then(function(f){const m=JSON.parse(f.data);let g=[],y=[];Object.entries(m.features[0].properties).forEach(R=>{g.push({name:R[0],alias:R[0],type:"string"}),y.push({fieldName:R[0],label:R[0]})});const _=new Blob([JSON.stringify(m)],{type:"application/json"}),b=URL.createObjectURL(_);let w=[0,0,0];const x=100/37,S=m.features.length;m.features.forEach(R=>{R.properties.SCORE===200?w[0]=w[0]+1:R.properties.SCORE===50?w[1]=w[1]+1:w[2]=w[2]+1});const C=[Math.round(w[0]/S*100/x),Math.round(w[1]/S*100/x),Math.round(w[2]/S*100/x)],E=Array().concat(Array(C[0]).fill(200)).concat(Array(C[1]).fill(50)).concat(Array(C[2]).fill(5));n({GeoJSONblob:b,fields:g,fieldInfos:y,hexTypes:E,parsedGeoJSON:m,blob:_}),o(!1),r({type:"surfaceRequest",payload:!1})}).catch(function(f){console.log(f)}))},[e.surfaceRequest]);U.useEffect(()=>{e.surfaceRequest&&a()},[a]),U.useEffect(()=>{e.demoPanel==="RESET SURFACE"&&n({GeoJSONblob:"",fields:{},fieldInfos:{},hexTypes:[],parsedGeoJSON:{type:"",features:[]},blob:new Blob([])})},[e.demoPanel]);const l=i;return F.jsxs(F.Fragment,{children:[s&&e.surfaceRequest===!0&&F.jsx(xXe,{}),F.jsx(Ix.Provider,{value:l,children:t})]})},Hnr={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};function OPr(t){return{renderer:{type:"simple",symbol:t==="esriGeometryPoint"||t==="esriGeometryMultipoint"?Iqe:t==="esriGeometryPolyline"?Lqe:Dqe}}}const qnr=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let Wnr=1;function APr(t,e){if(he("esri-csp-restrictions"))return()=>({[e]:null,...t});try{let r=`this.${e} = null;`;for(const n in t)r+=`this${qnr.test(n)?`.${n}`:`["${n}"]`} = ${JSON.stringify(t[n])};`;const i=new Function(`
      return class AttributesClass$${Wnr++} {
        constructor() {
          ${r};
        }
      }
    `)();return()=>new i}catch{return()=>({[e]:null,...t})}}function PPr(t={}){return[{name:"New Feature",description:"",prototype:{attributes:ie(t)}}]}function Xnr(t,e){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:t},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:e,supportsDelete:e,supportsEditing:e,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:e,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:Hnr,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:e,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1}}}const SXe="esri.layers.graphics.sources.GeoJSONSource",GOe=re.getLogger(SXe);let $T=class extends sg{constructor(){super(...arguments),this.type="geojson",this.refresh=B4(async e=>{await this.load();const{extent:r,timeExtent:i}=await this._connection.invoke("refresh",e);return this.sourceJSON.extent=r,i&&(this.sourceJSON.timeInfo.timeExtent=[i.start,i.end]),{dataChanged:!0,updates:{extent:this.sourceJSON.extent,timeInfo:this.sourceJSON.timeInfo}}})}load(e){const r=e!=null?e.signal:null;return this.addResolvingPromise(this._startWorker(r)),Promise.resolve(this)}destroy(){var e;(e=this._connection)==null||e.close(),this._connection=null}applyEdits(e){return this.load().then(()=>this._applyEdits(e))}openPorts(){return this.load().then(()=>this._connection.openPorts())}queryFeatures(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,r)).then(i=>Lfe.fromJSON(i))}queryFeaturesJSON(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatures",e?e.toJSON():null,r))}queryFeatureCount(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryFeatureCount",e?e.toJSON():null,r))}queryObjectIds(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryObjectIds",e?e.toJSON():null,r))}queryExtent(e,r={}){return this.load(r).then(()=>this._connection.invoke("queryExtent",e?e.toJSON():null,r)).then(i=>({count:i.count,extent:$r.fromJSON(i.extent)}))}querySnapping(e,r={}){return this.load(r).then(()=>this._connection.invoke("querySnapping",e,r))}_applyEdits(e){if(!this._connection)throw new H("geojson-layer-source:edit-failure","Memory source not loaded");const r=this.layer.objectIdField,i=[],n=[],s=[];if(e.addFeatures)for(const o of e.addFeatures)i.push(this._serializeFeature(o));if(e.deleteFeatures)for(const o of e.deleteFeatures)"objectId"in o&&o.objectId!=null?n.push(o.objectId):"attributes"in o&&o.attributes[r]!=null&&n.push(o.attributes[r]);if(e.updateFeatures)for(const o of e.updateFeatures)s.push(this._serializeFeature(o));return this._connection.invoke("applyEdits",{adds:i,updates:s,deletes:n}).then(({extent:o,timeExtent:a,featureEditResults:l})=>(this.sourceJSON.extent=o,a&&(this.sourceJSON.timeInfo.timeExtent=[a.start,a.end]),this._createEditsResult(l)))}_createEditsResult(e){return{addFeatureResults:e.addResults?e.addResults.map(this._createFeatureEditResult,this):[],updateFeatureResults:e.updateResults?e.updateResults.map(this._createFeatureEditResult,this):[],deleteFeatureResults:e.deleteResults?e.deleteResults.map(this._createFeatureEditResult,this):[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]}}_createFeatureEditResult(e){const r=e.success===!0?null:e.error||{code:void 0,description:void 0};return{objectId:e.objectId,globalId:e.globalId,error:r?new H("geojson-layer-source:edit-failure",r.description,{code:r.code}):null}}_serializeFeature(e){const{attributes:r}=e,i=this._geometryForSerialization(e);return i?{geometry:i.toJSON(),attributes:r}:{attributes:r}}_geometryForSerialization(e){const{geometry:r}=e;return r==null?null:r.type==="mesh"||r.type==="extent"?Tc.fromExtent(r.extent):r}async _startWorker(e){this._connection=await Ode("GeoJSONSourceWorker",{strategy:he("feature-layers-workers")?"dedicated":"local",signal:e});const{fields:r,spatialReference:i,hasZ:n,geometryType:s,objectIdField:o,url:a,timeInfo:l,customParameters:c}=this.layer,u=this.layer.originOf("spatialReference")==="defaults",h={url:a,customParameters:c,fields:r&&r.map(m=>m.toJSON()),geometryType:O7.toJSON(s),hasZ:n,objectIdField:o,timeInfo:l?l.toJSON():null,spatialReference:u?null:i&&i.toJSON()},f=await this._connection.invoke("load",h,{signal:e});for(const m of f.warnings)GOe.warn(m.message,{layer:this.layer,warning:m});f.featureErrors.length&&GOe.warn(`Encountered ${f.featureErrors.length} validation errors while loading features`,f.featureErrors),this.sourceJSON=f.layerDefinition,this.capabilities=Xnr(this.sourceJSON.hasZ,!0)}};d([p()],$T.prototype,"capabilities",void 0),d([p()],$T.prototype,"type",void 0),d([p({constructOnly:!0})],$T.prototype,"layer",void 0),d([p()],$T.prototype,"sourceJSON",void 0),$T=d([I(SXe)],$T);const Ynr=Vfe();let di=class extends Gqe(Tqe(Bqe(Eqe(Dfe(Xqe(xq(Bje(Cue($fe(Q4(O3))))))))))){constructor(t){super(t),this.copyright=null,this.definitionExpression=null,this.displayField=null,this.editingEnabled=!1,this.elevationInfo=null,this.fields=null,this.fieldsIndex=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelsVisible=!0,this.labelingInfo=null,this.legendEnabled=!0,this.objectIdField=null,this.operationalLayerType="GeoJSON",this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=new $T({layer:this}),this.spatialReference=dt.WGS84,this.templates=null,this.title="GeoJSON",this.type="geojson",this.typeIdField=null,this.types=null}destroy(){var t;(t=this.source)==null||t.destroy()}load(t){const e=this.loadFromPortal({supportedTypes:["GeoJson"],supportsData:!1},t).catch(Oa).then(()=>this.source.load(t)).then(()=>{this.read(this.source.sourceJSON,{origin:"service",url:this.parsedUrl}),this.revert(["objectIdField","fields","timeInfo"],"service"),CP(this.renderer,this.fieldsIndex),vue(this.timeInfo,this.fieldsIndex)});return this.addResolvingPromise(e),Promise.resolve(this)}get capabilities(){return this.source?this.source.capabilities:null}get createQueryVersion(){return this.commitProperty("definitionExpression"),this.commitProperty("timeExtent"),this.commitProperty("timeOffset"),this.commitProperty("geometryType"),this.commitProperty("capabilities"),(this._get("createQueryVersion")||0)+1}get defaultPopupTemplate(){return this.createPopupTemplate()}get isTable(){return this.loaded&&this.geometryType==null}get parsedUrl(){return this.url?Ts(this.url):null}set renderer(t){CP(t,this.fieldsIndex),this._set("renderer",t)}set url(t){if(!t)return void this._set("url",t);const e=Ts(t);this._set("url",e.path),e.query&&(this.customParameters={...this.customParameters,...e.query})}async applyEdits(t,e){const{applyEdits:r}=await le(()=>import("./editingSupport-47fc3fce.js"),["assets/editingSupport-47fc3fce.js","assets/normalizeUtils-5108f928.js","assets/normalizeUtilsCommon-8aa93216.js"]);await this.load();const i=await r(this,this.source,t,e);return this.read({extent:this.source.sourceJSON.extent,timeInfo:this.source.sourceJSON.timeInfo},{origin:"service",ignoreDefaults:!0}),i}on(t,e){return super.on(t,e)}createPopupTemplate(t){return Bfe(this,t)}createQuery(){const t=new uh,e=this.get("capabilities.data");t.returnGeometry=!0,e&&e.supportsZ&&(t.returnZ=!0),t.outFields=["*"],t.where=this.definitionExpression||"1=1";const{timeOffset:r,timeExtent:i}=this;return t.timeExtent=r!=null&&i!=null?i.offset(-r.value,r.unit):i||null,t}getFieldDomain(t,e){let r,i=!1;const n=e&&e.feature,s=n&&n.attributes,o=this.typeIdField&&s&&s[this.typeIdField];return o!=null&&this.types&&(i=this.types.some(a=>a.id==o&&(r=a.domains&&a.domains[t],r&&r.type==="inherited"&&(r=this._getLayerDomain(t)),!0))),i||r||(r=this._getLayerDomain(t)),r}getField(t){return this.fieldsIndex.get(t)}queryFeatures(t,e){return this.load().then(()=>this.source.queryFeatures(uh.from(t)||this.createQuery(),e)).then(r=>{if(r!=null&&r.features)for(const i of r.features)i.layer=i.sourceLayer=this;return r})}queryObjectIds(t,e){return this.load().then(()=>this.source.queryObjectIds(uh.from(t)||this.createQuery(),e))}queryFeatureCount(t,e){return this.load().then(()=>this.source.queryFeatureCount(uh.from(t)||this.createQuery(),e))}queryExtent(t,e){return this.load().then(()=>this.source.queryExtent(uh.from(t)||this.createQuery(),e))}async hasDataChanged(){try{const{dataChanged:t,updates:e}=await this.source.refresh(this.customParameters);return e!=null&&this.read(e,{origin:"service",url:this.parsedUrl,ignoreDefaults:!0}),t}catch{}return!1}_getLayerDomain(t){if(!this.fields)return null;let e=null;return this.fields.some(r=>(r.name===t&&(e=r.domain),!!e)),e}};d([p({readOnly:!0,json:{read:!1,write:!1}})],di.prototype,"capabilities",null),d([p({type:String})],di.prototype,"copyright",void 0),d([p({readOnly:!0})],di.prototype,"createQueryVersion",null),d([p({readOnly:!0})],di.prototype,"defaultPopupTemplate",null),d([p({type:String,json:{name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],di.prototype,"definitionExpression",void 0),d([p({type:String})],di.prototype,"displayField",void 0),d([p({type:Boolean})],di.prototype,"editingEnabled",void 0),d([p(Tue)],di.prototype,"elevationInfo",void 0),d([p({type:[IF],json:{name:"layerDefinition.fields",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"fields"}}}})],di.prototype,"fields",void 0),d([p(Ynr.fieldsIndex)],di.prototype,"fieldsIndex",void 0),d([p({type:$r,json:{name:"extent"}})],di.prototype,"fullExtent",void 0),d([p({type:["point","polygon","polyline","multipoint"],json:{read:{reader:O7.read}}})],di.prototype,"geometryType",void 0),d([p({type:Boolean})],di.prototype,"hasZ",void 0),d([p(Eue)],di.prototype,"id",void 0),d([p({type:Boolean,readOnly:!0})],di.prototype,"isTable",null),d([p(sF)],di.prototype,"labelsVisible",void 0),d([p({type:[iM],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:y4},write:!0}})],di.prototype,"labelingInfo",void 0),d([p(Sue)],di.prototype,"legendEnabled",void 0),d([p({type:["show","hide"]})],di.prototype,"listMode",void 0),d([p({type:String,json:{name:"layerDefinition.objectIdField",write:{ignoreOrigin:!0,isRequired:!0},origins:{service:{name:"objectIdField"}}}})],di.prototype,"objectIdField",void 0),d([p(JV)],di.prototype,"opacity",void 0),d([p({type:["GeoJSON"]})],di.prototype,"operationalLayerType",void 0),d([p({readOnly:!0})],di.prototype,"parsedUrl",null),d([p(nF)],di.prototype,"popupEnabled",void 0),d([p({type:LE,json:{name:"popupInfo",write:!0}})],di.prototype,"popupTemplate",void 0),d([p({types:JF,json:{name:"layerDefinition.drawingInfo.renderer",write:!0,origins:{service:{name:"drawingInfo.renderer"},"web-scene":{types:Mfe}}}})],di.prototype,"renderer",null),d([p(wue)],di.prototype,"screenSizePerspectiveEnabled",void 0),d([p({readOnly:!0})],di.prototype,"source",void 0),d([p({type:dt})],di.prototype,"spatialReference",void 0),d([p({type:[Tq]})],di.prototype,"templates",void 0),d([p()],di.prototype,"title",void 0),d([p({json:{read:!1},readOnly:!0})],di.prototype,"type",void 0),d([p({type:String,readOnly:!0})],di.prototype,"typeIdField",void 0),d([p({type:[zfe]})],di.prototype,"types",void 0),d([p(xue)],di.prototype,"url",null),di=d([I("esri.layers.GeoJSONLayer")],di);const Hj=di,$Pr=Object.freeze(Object.defineProperty({__proto__:null,default:Hj},Symbol.toStringTag,{value:"Module"})),hme=()=>{const t=U.useContext(Ix),[e,r]=U.useState(null),[i,n]=U.useContext(Co),[s,o]=U.useContext(u1),a=()=>{const u={type:"simple",symbol:{type:"polygon-3d",outline:{color:"rgba(230, 230, 230, 0.3)",width:0},symbolLayers:[{type:"extrude"}]},label:"",visualVariables:[{type:"size",field:"SCORE",stops:[{value:.5,size:20},{value:5,size:30},{value:50,size:60},{value:200,size:120}]},{type:"color",field:"SCORE",stops:[{value:.5,color:"rgba(253, 231, 37, 0.1)"},{value:5,color:"rgba(53, 183, 121, 0.3)"},{value:50,color:"rgba(49, 104, 142, 0.3)"},{value:200,color:"rgba(68, 1, 84, 0.3)"}]}]},h={title:"SCORE {SCORE}",content:[{type:"fields",fieldInfos:t.fieldInfos}]},f=new Hj({url:t.GeoJSONblob,renderer:u,popupEnabled:!0,fields:t.fields,popupTemplate:h,elevationInfo:"relative-to-ground"});t.GeoJSONblob&&s.scene.add(f),r(f)},l=()=>{const u={type:"simple",symbol:{type:"polygon-3d",outline:{color:"rgba(230, 230, 230, 0.2)",width:.1},symbolLayers:[{type:"extrude"}]},label:"",visualVariables:[{type:"size",field:"SCORE",stops:[{value:5,size:10},{value:200,size:135}]},{type:"color",field:"SCORE",stops:[{value:5,color:"rgba(20, 20, 20, 0.1)"},{value:200,color:"rgba(0, 123, 224, 0.4)"}]}]},h={title:"SELECTED DATA",content:[{type:"fields",fieldInfos:t.fieldInfos}]},f=new Hj({id:"surfaceLayer",url:t.GeoJSONblob,renderer:u,popupEnabled:!0,fields:t.fields,popupTemplate:h,elevationInfo:"relative-to-ground"});t.GeoJSONblob&&s.scene.add(f),r(f)},c=()=>{console.log("removeSurfaceLayer"),s.scene.remove(e)};return U.useLayoutEffect(()=>{s.demoPanel==="SELECT DATA SURFACE"?l():i.demoPanel==="RESET SURFACE"?c():a()},[t.GeoJSONblob,i.demoPanel]),F.jsx(F.Fragment,{})};var Znr={value:()=>{}};function TXe(){for(var t=0,e=arguments.length,r={},i;t<e;++t){if(!(i=arguments[t]+"")||i in r||/[\s.]/.test(i))throw new Error("illegal type: "+i);r[i]=[]}return new O9(r)}function O9(t){this._=t}function Jnr(t,e){return t.trim().split(/^|\s+/).map(function(r){var i="",n=r.indexOf(".");if(n>=0&&(i=r.slice(n+1),r=r.slice(0,n)),r&&!e.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:i}})}O9.prototype=TXe.prototype={constructor:O9,on:function(t,e){var r=this._,i=Jnr(t+"",r),n,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((n=(t=i[s]).type)&&(n=Knr(r[n],t.name)))return n;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++s<o;)if(n=(t=i[s]).type)r[n]=HOe(r[n],t.name,e);else if(e==null)for(n in r)r[n]=HOe(r[n],t.name,null);return this},copy:function(){var t={},e=this._;for(var r in e)t[r]=e[r].slice();return new O9(t)},call:function(t,e){if((n=arguments.length-2)>0)for(var r=new Array(n),i=0,n,s;i<n;++i)r[i]=arguments[i+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(s=this._[t],i=0,n=s.length;i<n;++i)s[i].value.apply(e,r)},apply:function(t,e,r){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var i=this._[t],n=0,s=i.length;n<s;++n)i[n].value.apply(e,r)}};function Knr(t,e){for(var r=0,i=t.length,n;r<i;++r)if((n=t[r]).name===e)return n.value}function HOe(t,e,r){for(var i=0,n=t.length;i<n;++i)if(t[i].name===e){t[i]=Znr,t=t.slice(0,i).concat(t.slice(i+1));break}return r!=null&&t.push({name:e,value:r}),t}var Koe="http://www.w3.org/1999/xhtml";const qOe={svg:"http://www.w3.org/2000/svg",xhtml:Koe,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Fq(t){var e=t+="",r=e.indexOf(":");return r>=0&&(e=t.slice(0,r))!=="xmlns"&&(t=t.slice(r+1)),qOe.hasOwnProperty(e)?{space:qOe[e],local:t}:t}function Qnr(t){return function(){var e=this.ownerDocument,r=this.namespaceURI;return r===Koe&&e.documentElement.namespaceURI===Koe?e.createElement(t):e.createElementNS(r,t)}}function esr(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function EXe(t){var e=Fq(t);return(e.local?esr:Qnr)(e)}function tsr(){}function pme(t){return t==null?tsr:function(){return this.querySelector(t)}}function rsr(t){typeof t!="function"&&(t=pme(t));for(var e=this._groups,r=e.length,i=new Array(r),n=0;n<r;++n)for(var s=e[n],o=s.length,a=i[n]=new Array(o),l,c,u=0;u<o;++u)(l=s[u])&&(c=t.call(l,l.__data__,u,s))&&("__data__"in l&&(c.__data__=l.__data__),a[u]=c);return new mu(i,this._parents)}function CXe(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function isr(){return[]}function RXe(t){return t==null?isr:function(){return this.querySelectorAll(t)}}function nsr(t){return function(){return CXe(t.apply(this,arguments))}}function ssr(t){typeof t=="function"?t=nsr(t):t=RXe(t);for(var e=this._groups,r=e.length,i=[],n=[],s=0;s<r;++s)for(var o=e[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(i.push(t.call(l,l.__data__,c,o)),n.push(l));return new mu(i,n)}function OXe(t){return function(){return this.matches(t)}}function AXe(t){return function(e){return e.matches(t)}}var osr=Array.prototype.find;function asr(t){return function(){return osr.call(this.children,t)}}function lsr(){return this.firstElementChild}function csr(t){return this.select(t==null?lsr:asr(typeof t=="function"?t:AXe(t)))}var usr=Array.prototype.filter;function dsr(){return Array.from(this.children)}function hsr(t){return function(){return usr.call(this.children,t)}}function psr(t){return this.selectAll(t==null?dsr:hsr(typeof t=="function"?t:AXe(t)))}function fsr(t){typeof t!="function"&&(t=OXe(t));for(var e=this._groups,r=e.length,i=new Array(r),n=0;n<r;++n)for(var s=e[n],o=s.length,a=i[n]=[],l,c=0;c<o;++c)(l=s[c])&&t.call(l,l.__data__,c,s)&&a.push(l);return new mu(i,this._parents)}function PXe(t){return new Array(t.length)}function msr(){return new mu(this._enter||this._groups.map(PXe),this._parents)}function qj(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}qj.prototype={constructor:qj,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function gsr(t){return function(){return t}}function ysr(t,e,r,i,n,s){for(var o=0,a,l=e.length,c=s.length;o<c;++o)(a=e[o])?(a.__data__=s[o],i[o]=a):r[o]=new qj(t,s[o]);for(;o<l;++o)(a=e[o])&&(n[o]=a)}function vsr(t,e,r,i,n,s,o){var a,l,c=new Map,u=e.length,h=s.length,f=new Array(u),m;for(a=0;a<u;++a)(l=e[a])&&(f[a]=m=o.call(l,l.__data__,a,e)+"",c.has(m)?n[a]=l:c.set(m,l));for(a=0;a<h;++a)m=o.call(t,s[a],a,s)+"",(l=c.get(m))?(i[a]=l,l.__data__=s[a],c.delete(m)):r[a]=new qj(t,s[a]);for(a=0;a<u;++a)(l=e[a])&&c.get(f[a])===l&&(n[a]=l)}function _sr(t){return t.__data__}function bsr(t,e){if(!arguments.length)return Array.from(this,_sr);var r=e?vsr:ysr,i=this._parents,n=this._groups;typeof t!="function"&&(t=gsr(t));for(var s=n.length,o=new Array(s),a=new Array(s),l=new Array(s),c=0;c<s;++c){var u=i[c],h=n[c],f=h.length,m=wsr(t.call(u,u&&u.__data__,c,i)),g=m.length,y=a[c]=new Array(g),_=o[c]=new Array(g),b=l[c]=new Array(f);r(u,h,y,_,b,m,e);for(var w=0,x=0,S,C;w<g;++w)if(S=y[w]){for(w>=x&&(x=w+1);!(C=_[x])&&++x<g;);S._next=C||null}}return o=new mu(o,i),o._enter=a,o._exit=l,o}function wsr(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function xsr(){return new mu(this._exit||this._groups.map(PXe),this._parents)}function Ssr(t,e,r){var i=this.enter(),n=this,s=this.exit();return typeof t=="function"?(i=t(i),i&&(i=i.selection())):i=i.append(t+""),e!=null&&(n=e(n),n&&(n=n.selection())),r==null?s.remove():r(s),i&&n?i.merge(n).order():n}function Tsr(t){for(var e=t.selection?t.selection():t,r=this._groups,i=e._groups,n=r.length,s=i.length,o=Math.min(n,s),a=new Array(n),l=0;l<o;++l)for(var c=r[l],u=i[l],h=c.length,f=a[l]=new Array(h),m,g=0;g<h;++g)(m=c[g]||u[g])&&(f[g]=m);for(;l<n;++l)a[l]=r[l];return new mu(a,this._parents)}function Esr(){for(var t=this._groups,e=-1,r=t.length;++e<r;)for(var i=t[e],n=i.length-1,s=i[n],o;--n>=0;)(o=i[n])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function Csr(t){t||(t=Rsr);function e(h,f){return h&&f?t(h.__data__,f.__data__):!h-!f}for(var r=this._groups,i=r.length,n=new Array(i),s=0;s<i;++s){for(var o=r[s],a=o.length,l=n[s]=new Array(a),c,u=0;u<a;++u)(c=o[u])&&(l[u]=c);l.sort(e)}return new mu(n,this._parents).order()}function Rsr(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Osr(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Asr(){return Array.from(this)}function Psr(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var i=t[e],n=0,s=i.length;n<s;++n){var o=i[n];if(o)return o}return null}function Msr(){let t=0;for(const e of this)++t;return t}function $sr(){return!this.node()}function Isr(t){for(var e=this._groups,r=0,i=e.length;r<i;++r)for(var n=e[r],s=0,o=n.length,a;s<o;++s)(a=n[s])&&t.call(a,a.__data__,s,n);return this}function Lsr(t){return function(){this.removeAttribute(t)}}function Dsr(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Nsr(t,e){return function(){this.setAttribute(t,e)}}function Fsr(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function ksr(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttribute(t):this.setAttribute(t,r)}}function Usr(t,e){return function(){var r=e.apply(this,arguments);r==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,r)}}function zsr(t,e){var r=Fq(t);if(arguments.length<2){var i=this.node();return r.local?i.getAttributeNS(r.space,r.local):i.getAttribute(r)}return this.each((e==null?r.local?Dsr:Lsr:typeof e=="function"?r.local?Usr:ksr:r.local?Fsr:Nsr)(r,e))}function MXe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Vsr(t){return function(){this.style.removeProperty(t)}}function Bsr(t,e,r){return function(){this.style.setProperty(t,e,r)}}function jsr(t,e,r){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(t):this.style.setProperty(t,i,r)}}function Gsr(t,e,r){return arguments.length>1?this.each((e==null?Vsr:typeof e=="function"?jsr:Bsr)(t,e,r??"")):d3(this.node(),t)}function d3(t,e){return t.style.getPropertyValue(e)||MXe(t).getComputedStyle(t,null).getPropertyValue(e)}function Hsr(t){return function(){delete this[t]}}function qsr(t,e){return function(){this[t]=e}}function Wsr(t,e){return function(){var r=e.apply(this,arguments);r==null?delete this[t]:this[t]=r}}function Xsr(t,e){return arguments.length>1?this.each((e==null?Hsr:typeof e=="function"?Wsr:qsr)(t,e)):this.node()[t]}function $Xe(t){return t.trim().split(/^|\s+/)}function fme(t){return t.classList||new IXe(t)}function IXe(t){this._node=t,this._names=$Xe(t.getAttribute("class")||"")}IXe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function LXe(t,e){for(var r=fme(t),i=-1,n=e.length;++i<n;)r.add(e[i])}function DXe(t,e){for(var r=fme(t),i=-1,n=e.length;++i<n;)r.remove(e[i])}function Ysr(t){return function(){LXe(this,t)}}function Zsr(t){return function(){DXe(this,t)}}function Jsr(t,e){return function(){(e.apply(this,arguments)?LXe:DXe)(this,t)}}function Ksr(t,e){var r=$Xe(t+"");if(arguments.length<2){for(var i=fme(this.node()),n=-1,s=r.length;++n<s;)if(!i.contains(r[n]))return!1;return!0}return this.each((typeof e=="function"?Jsr:e?Ysr:Zsr)(r,e))}function Qsr(){this.textContent=""}function eor(t){return function(){this.textContent=t}}function tor(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function ror(t){return arguments.length?this.each(t==null?Qsr:(typeof t=="function"?tor:eor)(t)):this.node().textContent}function ior(){this.innerHTML=""}function nor(t){return function(){this.innerHTML=t}}function sor(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function oor(t){return arguments.length?this.each(t==null?ior:(typeof t=="function"?sor:nor)(t)):this.node().innerHTML}function aor(){this.nextSibling&&this.parentNode.appendChild(this)}function lor(){return this.each(aor)}function cor(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function uor(){return this.each(cor)}function dor(t){var e=typeof t=="function"?t:EXe(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function hor(){return null}function por(t,e){var r=typeof t=="function"?t:EXe(t),i=e==null?hor:typeof e=="function"?e:pme(e);return this.select(function(){return this.insertBefore(r.apply(this,arguments),i.apply(this,arguments)||null)})}function mor(){var t=this.parentNode;t&&t.removeChild(this)}function gor(){return this.each(mor)}function yor(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function vor(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function _or(t){return this.select(t?vor:yor)}function bor(t){return arguments.length?this.property("__data__",t):this.node().__data__}function wor(t){return function(e){t.call(this,e,this.__data__)}}function xor(t){return t.trim().split(/^|\s+/).map(function(e){var r="",i=e.indexOf(".");return i>=0&&(r=e.slice(i+1),e=e.slice(0,i)),{type:e,name:r}})}function Sor(t){return function(){var e=this.__on;if(e){for(var r=0,i=-1,n=e.length,s;r<n;++r)s=e[r],(!t.type||s.type===t.type)&&s.name===t.name?this.removeEventListener(s.type,s.listener,s.options):e[++i]=s;++i?e.length=i:delete this.__on}}}function Tor(t,e,r){return function(){var i=this.__on,n,s=wor(e);if(i){for(var o=0,a=i.length;o<a;++o)if((n=i[o]).type===t.type&&n.name===t.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=s,n.options=r),n.value=e;return}}this.addEventListener(t.type,s,r),n={type:t.type,name:t.name,value:e,listener:s,options:r},i?i.push(n):this.__on=[n]}}function Eor(t,e,r){var i=xor(t+""),n,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,u;l<c;++l)for(n=0,u=a[l];n<s;++n)if((o=i[n]).type===u.type&&o.name===u.name)return u.value}return}for(a=e?Tor:Sor,n=0;n<s;++n)this.each(a(i[n],e,r));return this}function NXe(t,e,r){var i=MXe(t),n=i.CustomEvent;typeof n=="function"?n=new n(e,r):(n=i.document.createEvent("Event"),r?(n.initEvent(e,r.bubbles,r.cancelable),n.detail=r.detail):n.initEvent(e,!1,!1)),t.dispatchEvent(n)}function Cor(t,e){return function(){return NXe(this,t,e)}}function Ror(t,e){return function(){return NXe(this,t,e.apply(this,arguments))}}function Oor(t,e){return this.each((typeof e=="function"?Ror:Cor)(t,e))}function*Aor(){for(var t=this._groups,e=0,r=t.length;e<r;++e)for(var i=t[e],n=0,s=i.length,o;n<s;++n)(o=i[n])&&(yield o)}var mme=[null];function mu(t,e){this._groups=t,this._parents=e}function t5(){return new mu([[document.documentElement]],mme)}function Por(){return this}mu.prototype=t5.prototype={constructor:mu,select:rsr,selectAll:ssr,selectChild:csr,selectChildren:psr,filter:fsr,data:bsr,enter:msr,exit:xsr,join:Ssr,merge:Tsr,selection:Por,order:Esr,sort:Csr,call:Osr,nodes:Asr,node:Psr,size:Msr,empty:$sr,each:Isr,attr:zsr,style:Gsr,property:Xsr,classed:Ksr,text:ror,html:oor,raise:lor,lower:uor,append:dor,insert:por,remove:gor,clone:_or,datum:bor,on:Eor,dispatch:Oor,[Symbol.iterator]:Aor};function Mor(t){return typeof t=="string"?new mu([[document.querySelector(t)]],[document.documentElement]):new mu([[t]],mme)}function WOe(t){return typeof t=="string"?new mu([document.querySelectorAll(t)],[document.documentElement]):new mu([CXe(t)],mme)}function gme(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function FXe(t,e){var r=Object.create(t.prototype);for(var i in e)r[i]=e[i];return r}function r5(){}var _4=.7,Wj=1/_4,YA="\\s*([+-]?\\d+)\\s*",b4="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",i0="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",$or=/^#([0-9a-f]{3,8})$/,Ior=new RegExp(`^rgb\\(${YA},${YA},${YA}\\)$`),Lor=new RegExp(`^rgb\\(${i0},${i0},${i0}\\)$`),Dor=new RegExp(`^rgba\\(${YA},${YA},${YA},${b4}\\)$`),Nor=new RegExp(`^rgba\\(${i0},${i0},${i0},${b4}\\)$`),For=new RegExp(`^hsl\\(${b4},${i0},${i0}\\)$`),kor=new RegExp(`^hsla\\(${b4},${i0},${i0},${b4}\\)$`),XOe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};gme(r5,w4,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:YOe,formatHex:YOe,formatHex8:Uor,formatHsl:zor,formatRgb:ZOe,toString:ZOe});function YOe(){return this.rgb().formatHex()}function Uor(){return this.rgb().formatHex8()}function zor(){return kXe(this).formatHsl()}function ZOe(){return this.rgb().formatRgb()}function w4(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=$or.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?JOe(e):r===3?new ld(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?ZU(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?ZU(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Ior.exec(t))?new ld(e[1],e[2],e[3],1):(e=Lor.exec(t))?new ld(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Dor.exec(t))?ZU(e[1],e[2],e[3],e[4]):(e=Nor.exec(t))?ZU(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=For.exec(t))?eAe(e[1],e[2]/100,e[3]/100,1):(e=kor.exec(t))?eAe(e[1],e[2]/100,e[3]/100,e[4]):XOe.hasOwnProperty(t)?JOe(XOe[t]):t==="transparent"?new ld(NaN,NaN,NaN,0):null}function JOe(t){return new ld(t>>16&255,t>>8&255,t&255,1)}function ZU(t,e,r,i){return i<=0&&(t=e=r=NaN),new ld(t,e,r,i)}function Vor(t){return t instanceof r5||(t=w4(t)),t?(t=t.rgb(),new ld(t.r,t.g,t.b,t.opacity)):new ld}function Qoe(t,e,r,i){return arguments.length===1?Vor(t):new ld(t,e,r,i??1)}function ld(t,e,r,i){this.r=+t,this.g=+e,this.b=+r,this.opacity=+i}gme(ld,Qoe,FXe(r5,{brighter(t){return t=t==null?Wj:Math.pow(Wj,t),new ld(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?_4:Math.pow(_4,t),new ld(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ld(D2(this.r),D2(this.g),D2(this.b),Xj(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:KOe,formatHex:KOe,formatHex8:Bor,formatRgb:QOe,toString:QOe}));function KOe(){return`#${p2(this.r)}${p2(this.g)}${p2(this.b)}`}function Bor(){return`#${p2(this.r)}${p2(this.g)}${p2(this.b)}${p2((isNaN(this.opacity)?1:this.opacity)*255)}`}function QOe(){const t=Xj(this.opacity);return`${t===1?"rgb(":"rgba("}${D2(this.r)}, ${D2(this.g)}, ${D2(this.b)}${t===1?")":`, ${t})`}`}function Xj(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function D2(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function p2(t){return t=D2(t),(t<16?"0":"")+t.toString(16)}function eAe(t,e,r,i){return i<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Pm(t,e,r,i)}function kXe(t){if(t instanceof Pm)return new Pm(t.h,t.s,t.l,t.opacity);if(t instanceof r5||(t=w4(t)),!t)return new Pm;if(t instanceof Pm)return t;t=t.rgb();var e=t.r/255,r=t.g/255,i=t.b/255,n=Math.min(e,r,i),s=Math.max(e,r,i),o=NaN,a=s-n,l=(s+n)/2;return a?(e===s?o=(r-i)/a+(r<i)*6:r===s?o=(i-e)/a+2:o=(e-r)/a+4,a/=l<.5?s+n:2-s-n,o*=60):a=l>0&&l<1?0:o,new Pm(o,a,l,t.opacity)}function jor(t,e,r,i){return arguments.length===1?kXe(t):new Pm(t,e,r,i??1)}function Pm(t,e,r,i){this.h=+t,this.s=+e,this.l=+r,this.opacity=+i}gme(Pm,jor,FXe(r5,{brighter(t){return t=t==null?Wj:Math.pow(Wj,t),new Pm(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?_4:Math.pow(_4,t),new Pm(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,i=r+(r<.5?r:1-r)*e,n=2*r-i;return new ld(WJ(t>=240?t-240:t+120,n,i),WJ(t,n,i),WJ(t<120?t+240:t-120,n,i),this.opacity)},clamp(){return new Pm(tAe(this.h),JU(this.s),JU(this.l),Xj(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Xj(this.opacity);return`${t===1?"hsl(":"hsla("}${tAe(this.h)}, ${JU(this.s)*100}%, ${JU(this.l)*100}%${t===1?")":`, ${t})`}`}}));function tAe(t){return t=(t||0)%360,t<0?t+360:t}function JU(t){return Math.max(0,Math.min(1,t||0))}function WJ(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}const UXe=t=>()=>t;function Gor(t,e){return function(r){return t+r*e}}function Hor(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(i){return Math.pow(t+i*e,r)}}function qor(t){return(t=+t)==1?zXe:function(e,r){return r-e?Hor(e,r,t):UXe(isNaN(e)?r:e)}}function zXe(t,e){var r=e-t;return r?Gor(t,r):UXe(isNaN(t)?e:t)}const rAe=function t(e){var r=qor(e);function i(n,s){var o=r((n=Qoe(n)).r,(s=Qoe(s)).r),a=r(n.g,s.g),l=r(n.b,s.b),c=zXe(n.opacity,s.opacity);return function(u){return n.r=o(u),n.g=a(u),n.b=l(u),n.opacity=c(u),n+""}}return i.gamma=t,i}(1);function Wb(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}var eae=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,XJ=new RegExp(eae.source,"g");function Wor(t){return function(){return t}}function Xor(t){return function(e){return t(e)+""}}function Yor(t,e){var r=eae.lastIndex=XJ.lastIndex=0,i,n,s,o=-1,a=[],l=[];for(t=t+"",e=e+"";(i=eae.exec(t))&&(n=XJ.exec(e));)(s=n.index)>r&&(s=e.slice(r,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,l.push({i:o,x:Wb(i,n)})),r=XJ.lastIndex;return r<e.length&&(s=e.slice(r),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?Xor(l[0].x):Wor(e):(e=l.length,function(c){for(var u=0,h;u<e;++u)a[(h=l[u]).i]=h.x(c);return a.join("")})}var iAe=180/Math.PI,tae={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function VXe(t,e,r,i,n,s){var o,a,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*r+e*i)&&(r-=t*l,i-=e*l),(a=Math.sqrt(r*r+i*i))&&(r/=a,i/=a,l/=a),t*i<e*r&&(t=-t,e=-e,l=-l,o=-o),{translateX:n,translateY:s,rotate:Math.atan2(e,t)*iAe,skewX:Math.atan(l)*iAe,scaleX:o,scaleY:a}}var KU;function Zor(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?tae:VXe(e.a,e.b,e.c,e.d,e.e,e.f)}function Jor(t){return t==null||(KU||(KU=document.createElementNS("http://www.w3.org/2000/svg","g")),KU.setAttribute("transform",t),!(t=KU.transform.baseVal.consolidate()))?tae:(t=t.matrix,VXe(t.a,t.b,t.c,t.d,t.e,t.f))}function BXe(t,e,r,i){function n(c){return c.length?c.pop()+" ":""}function s(c,u,h,f,m,g){if(c!==h||u!==f){var y=m.push("translate(",null,e,null,r);g.push({i:y-4,x:Wb(c,h)},{i:y-2,x:Wb(u,f)})}else(h||f)&&m.push("translate("+h+e+f+r)}function o(c,u,h,f){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),f.push({i:h.push(n(h)+"rotate(",null,i)-2,x:Wb(c,u)})):u&&h.push(n(h)+"rotate("+u+i)}function a(c,u,h,f){c!==u?f.push({i:h.push(n(h)+"skewX(",null,i)-2,x:Wb(c,u)}):u&&h.push(n(h)+"skewX("+u+i)}function l(c,u,h,f,m,g){if(c!==h||u!==f){var y=m.push(n(m)+"scale(",null,",",null,")");g.push({i:y-4,x:Wb(c,h)},{i:y-2,x:Wb(u,f)})}else(h!==1||f!==1)&&m.push(n(m)+"scale("+h+","+f+")")}return function(c,u){var h=[],f=[];return c=t(c),u=t(u),s(c.translateX,c.translateY,u.translateX,u.translateY,h,f),o(c.rotate,u.rotate,h,f),a(c.skewX,u.skewX,h,f),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,h,f),c=u=null,function(m){for(var g=-1,y=f.length,_;++g<y;)h[(_=f[g]).i]=_.x(m);return h.join("")}}}var Kor=BXe(Zor,"px, ","px)","deg)"),Qor=BXe(Jor,", ",")",")"),h3=0,PL=0,V$=0,jXe=1e3,Yj,ML,Zj=0,RE=0,kq=0,x4=typeof performance=="object"&&performance.now?performance:Date,GXe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function yme(){return RE||(GXe(ear),RE=x4.now()+kq)}function ear(){RE=0}function Jj(){this._call=this._time=this._next=null}Jj.prototype=HXe.prototype={constructor:Jj,restart:function(t,e,r){if(typeof t!="function")throw new TypeError("callback is not a function");r=(r==null?yme():+r)+(e==null?0:+e),!this._next&&ML!==this&&(ML?ML._next=this:Yj=this,ML=this),this._call=t,this._time=r,rae()},stop:function(){this._call&&(this._call=null,this._time=1/0,rae())}};function HXe(t,e,r){var i=new Jj;return i.restart(t,e,r),i}function tar(){yme(),++h3;for(var t=Yj,e;t;)(e=RE-t._time)>=0&&t._call.call(void 0,e),t=t._next;--h3}function nAe(){RE=(Zj=x4.now())+kq,h3=PL=0;try{tar()}finally{h3=0,iar(),RE=0}}function rar(){var t=x4.now(),e=t-Zj;e>jXe&&(kq-=e,Zj=t)}function iar(){for(var t,e=Yj,r,i=1/0;e;)e._call?(i>e._time&&(i=e._time),t=e,e=e._next):(r=e._next,e._next=null,e=t?t._next=r:Yj=r);ML=t,rae(i)}function rae(t){if(!h3){PL&&(PL=clearTimeout(PL));var e=t-RE;e>24?(t<1/0&&(PL=setTimeout(nAe,t-x4.now()-kq)),V$&&(V$=clearInterval(V$))):(V$||(Zj=x4.now(),V$=setInterval(rar,jXe)),h3=1,GXe(nAe))}}function sAe(t,e,r){var i=new Jj;return e=e==null?0:+e,i.restart(n=>{i.stop(),t(n+e)},e,r),i}var nar=TXe("start","end","cancel","interrupt"),sar=[],qXe=0,oAe=1,iae=2,A9=3,aAe=4,nae=5,P9=6;function Uq(t,e,r,i,n,s){var o=t.__transition;if(!o)t.__transition={};else if(r in o)return;oar(t,r,{name:e,index:i,group:n,on:nar,tween:sar,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:qXe})}function vme(t,e){var r=_g(t,e);if(r.state>qXe)throw new Error("too late; already scheduled");return r}function M0(t,e){var r=_g(t,e);if(r.state>A9)throw new Error("too late; already running");return r}function _g(t,e){var r=t.__transition;if(!r||!(r=r[e]))throw new Error("transition not found");return r}function oar(t,e,r){var i=t.__transition,n;i[e]=r,r.timer=HXe(s,0,r.time);function s(c){r.state=oAe,r.timer.restart(o,r.delay,r.time),r.delay<=c&&o(c-r.delay)}function o(c){var u,h,f,m;if(r.state!==oAe)return l();for(u in i)if(m=i[u],m.name===r.name){if(m.state===A9)return sAe(o);m.state===aAe?(m.state=P9,m.timer.stop(),m.on.call("interrupt",t,t.__data__,m.index,m.group),delete i[u]):+u<e&&(m.state=P9,m.timer.stop(),m.on.call("cancel",t,t.__data__,m.index,m.group),delete i[u])}if(sAe(function(){r.state===A9&&(r.state=aAe,r.timer.restart(a,r.delay,r.time),a(c))}),r.state=iae,r.on.call("start",t,t.__data__,r.index,r.group),r.state===iae){for(r.state=A9,n=new Array(f=r.tween.length),u=0,h=-1;u<f;++u)(m=r.tween[u].value.call(t,t.__data__,r.index,r.group))&&(n[++h]=m);n.length=h+1}}function a(c){for(var u=c<r.duration?r.ease.call(null,c/r.duration):(r.timer.restart(l),r.state=nae,1),h=-1,f=n.length;++h<f;)n[h].call(t,u);r.state===nae&&(r.on.call("end",t,t.__data__,r.index,r.group),l())}function l(){r.state=P9,r.timer.stop(),delete i[e];for(var c in i)return;delete t.__transition}}function aar(t,e){var r=t.__transition,i,n,s=!0,o;if(r){e=e==null?null:e+"";for(o in r){if((i=r[o]).name!==e){s=!1;continue}n=i.state>iae&&i.state<nae,i.state=P9,i.timer.stop(),i.on.call(n?"interrupt":"cancel",t,t.__data__,i.index,i.group),delete r[o]}s&&delete t.__transition}}function lar(t){return this.each(function(){aar(this,t)})}function car(t,e){var r,i;return function(){var n=M0(this,t),s=n.tween;if(s!==r){i=r=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===e){i=i.slice(),i.splice(o,1);break}}n.tween=i}}function uar(t,e,r){var i,n;if(typeof r!="function")throw new Error;return function(){var s=M0(this,t),o=s.tween;if(o!==i){n=(i=o).slice();for(var a={name:e,value:r},l=0,c=n.length;l<c;++l)if(n[l].name===e){n[l]=a;break}l===c&&n.push(a)}s.tween=n}}function dar(t,e){var r=this._id;if(t+="",arguments.length<2){for(var i=_g(this.node(),r).tween,n=0,s=i.length,o;n<s;++n)if((o=i[n]).name===t)return o.value;return null}return this.each((e==null?car:uar)(r,t,e))}function _me(t,e,r){var i=t._id;return t.each(function(){var n=M0(this,i);(n.value||(n.value={}))[e]=r.apply(this,arguments)}),function(n){return _g(n,i).value[e]}}function WXe(t,e){var r;return(typeof e=="number"?Wb:e instanceof w4?rAe:(r=w4(e))?(e=r,rAe):Yor)(t,e)}function har(t){return function(){this.removeAttribute(t)}}function par(t){return function(){this.removeAttributeNS(t.space,t.local)}}function far(t,e,r){var i,n=r+"",s;return function(){var o=this.getAttribute(t);return o===n?null:o===i?s:s=e(i=o,r)}}function mar(t,e,r){var i,n=r+"",s;return function(){var o=this.getAttributeNS(t.space,t.local);return o===n?null:o===i?s:s=e(i=o,r)}}function gar(t,e,r){var i,n,s;return function(){var o,a=r(this),l;return a==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=a+"",o===l?null:o===i&&l===n?s:(n=l,s=e(i=o,a)))}}function yar(t,e,r){var i,n,s;return function(){var o,a=r(this),l;return a==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=a+"",o===l?null:o===i&&l===n?s:(n=l,s=e(i=o,a)))}}function _ar(t,e){var r=Fq(t),i=r==="transform"?Qor:WXe;return this.attrTween(t,typeof e=="function"?(r.local?yar:gar)(r,i,_me(this,"attr."+t,e)):e==null?(r.local?par:har)(r):(r.local?mar:far)(r,i,e))}function bar(t,e){return function(r){this.setAttribute(t,e.call(this,r))}}function war(t,e){return function(r){this.setAttributeNS(t.space,t.local,e.call(this,r))}}function xar(t,e){var r,i;function n(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&war(t,s)),r}return n._value=e,n}function Sar(t,e){var r,i;function n(){var s=e.apply(this,arguments);return s!==i&&(r=(i=s)&&bar(t,s)),r}return n._value=e,n}function Tar(t,e){var r="attr."+t;if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;var i=Fq(t);return this.tween(r,(i.local?xar:Sar)(i,e))}function Ear(t,e){return function(){vme(this,t).delay=+e.apply(this,arguments)}}function Car(t,e){return e=+e,function(){vme(this,t).delay=e}}function Rar(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Ear:Car)(e,t)):_g(this.node(),e).delay}function Oar(t,e){return function(){M0(this,t).duration=+e.apply(this,arguments)}}function Aar(t,e){return e=+e,function(){M0(this,t).duration=e}}function Par(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?Oar:Aar)(e,t)):_g(this.node(),e).duration}function Mar(t,e){if(typeof e!="function")throw new Error;return function(){M0(this,t).ease=e}}function $ar(t){var e=this._id;return arguments.length?this.each(Mar(e,t)):_g(this.node(),e).ease}function Iar(t,e){return function(){var r=e.apply(this,arguments);if(typeof r!="function")throw new Error;M0(this,t).ease=r}}function Lar(t){if(typeof t!="function")throw new Error;return this.each(Iar(this._id,t))}function Dar(t){typeof t!="function"&&(t=OXe(t));for(var e=this._groups,r=e.length,i=new Array(r),n=0;n<r;++n)for(var s=e[n],o=s.length,a=i[n]=[],l,c=0;c<o;++c)(l=s[c])&&t.call(l,l.__data__,c,s)&&a.push(l);return new B_(i,this._parents,this._name,this._id)}function Nar(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,r=t._groups,i=e.length,n=r.length,s=Math.min(i,n),o=new Array(i),a=0;a<s;++a)for(var l=e[a],c=r[a],u=l.length,h=o[a]=new Array(u),f,m=0;m<u;++m)(f=l[m]||c[m])&&(h[m]=f);for(;a<i;++a)o[a]=e[a];return new B_(o,this._parents,this._name,this._id)}function Far(t){return(t+"").trim().split(/^|\s+/).every(function(e){var r=e.indexOf(".");return r>=0&&(e=e.slice(0,r)),!e||e==="start"})}function kar(t,e,r){var i,n,s=Far(e)?vme:M0;return function(){var o=s(this,t),a=o.on;a!==i&&(n=(i=a).copy()).on(e,r),o.on=n}}function Uar(t,e){var r=this._id;return arguments.length<2?_g(this.node(),r).on.on(t):this.each(kar(r,t,e))}function zar(t){return function(){var e=this.parentNode;for(var r in this.__transition)if(+r!==t)return;e&&e.removeChild(this)}}function Var(){return this.on("end.remove",zar(this._id))}function Bar(t){var e=this._name,r=this._id;typeof t!="function"&&(t=pme(t));for(var i=this._groups,n=i.length,s=new Array(n),o=0;o<n;++o)for(var a=i[o],l=a.length,c=s[o]=new Array(l),u,h,f=0;f<l;++f)(u=a[f])&&(h=t.call(u,u.__data__,f,a))&&("__data__"in u&&(h.__data__=u.__data__),c[f]=h,Uq(c[f],e,r,f,c,_g(u,r)));return new B_(s,this._parents,e,r)}function jar(t){var e=this._name,r=this._id;typeof t!="function"&&(t=RXe(t));for(var i=this._groups,n=i.length,s=[],o=[],a=0;a<n;++a)for(var l=i[a],c=l.length,u,h=0;h<c;++h)if(u=l[h]){for(var f=t.call(u,u.__data__,h,l),m,g=_g(u,r),y=0,_=f.length;y<_;++y)(m=f[y])&&Uq(m,e,r,y,f,g);s.push(f),o.push(u)}return new B_(s,o,e,r)}var Gar=t5.prototype.constructor;function Har(){return new Gar(this._groups,this._parents)}function qar(t,e){var r,i,n;return function(){var s=d3(this,t),o=(this.style.removeProperty(t),d3(this,t));return s===o?null:s===r&&o===i?n:n=e(r=s,i=o)}}function XXe(t){return function(){this.style.removeProperty(t)}}function War(t,e,r){var i,n=r+"",s;return function(){var o=d3(this,t);return o===n?null:o===i?s:s=e(i=o,r)}}function Xar(t,e,r){var i,n,s;return function(){var o=d3(this,t),a=r(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(t),d3(this,t))),o===l?null:o===i&&l===n?s:(n=l,s=e(i=o,a))}}function Yar(t,e){var r,i,n,s="style."+e,o="end."+s,a;return function(){var l=M0(this,t),c=l.on,u=l.value[s]==null?a||(a=XXe(e)):void 0;(c!==r||n!==u)&&(i=(r=c).copy()).on(o,n=u),l.on=i}}function Zar(t,e,r){var i=(t+="")=="transform"?Kor:WXe;return e==null?this.styleTween(t,qar(t,i)).on("end.style."+t,XXe(t)):typeof e=="function"?this.styleTween(t,Xar(t,i,_me(this,"style."+t,e))).each(Yar(this._id,t)):this.styleTween(t,War(t,i,e),r).on("end.style."+t,null)}function Jar(t,e,r){return function(i){this.style.setProperty(t,e.call(this,i),r)}}function Kar(t,e,r){var i,n;function s(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&Jar(t,o,r)),i}return s._value=e,s}function Qar(t,e,r){var i="style."+(t+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Kar(t,e,r??""))}function elr(t){return function(){this.textContent=t}}function tlr(t){return function(){var e=t(this);this.textContent=e??""}}function rlr(t){return this.tween("text",typeof t=="function"?tlr(_me(this,"text",t)):elr(t==null?"":t+""))}function ilr(t){return function(e){this.textContent=t.call(this,e)}}function nlr(t){var e,r;function i(){var n=t.apply(this,arguments);return n!==r&&(e=(r=n)&&ilr(n)),e}return i._value=t,i}function slr(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,nlr(t))}function olr(){for(var t=this._name,e=this._id,r=YXe(),i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var u=_g(l,e);Uq(l,t,r,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new B_(i,this._parents,t,r)}function alr(){var t,e,r=this,i=r._id,n=r.size();return new Promise(function(s,o){var a={value:o},l={value:function(){--n===0&&s()}};r.each(function(){var c=M0(this,i),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(a),e._.interrupt.push(a),e._.end.push(l)),c.on=e}),n===0&&s()})}var llr=0;function B_(t,e,r,i){this._groups=t,this._parents=e,this._name=r,this._id=i}function YXe(){return++llr}var Q0=t5.prototype;B_.prototype={constructor:B_,select:Bar,selectAll:jar,selectChild:Q0.selectChild,selectChildren:Q0.selectChildren,filter:Dar,merge:Nar,selection:Har,transition:olr,call:Q0.call,nodes:Q0.nodes,node:Q0.node,size:Q0.size,empty:Q0.empty,each:Q0.each,on:Uar,attr:_ar,attrTween:Tar,style:Zar,styleTween:Qar,text:rlr,textTween:slr,remove:Var,tween:dar,delay:Rar,duration:Par,ease:$ar,easeVarying:Lar,end:alr,[Symbol.iterator]:Q0[Symbol.iterator]};function clr(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var ulr={time:null,delay:0,duration:250,ease:clr};function dlr(t,e){for(var r;!(r=t.__transition)||!(r=r[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return r}function hlr(t){var e,r;t instanceof B_?(e=t._id,t=t._name):(e=YXe(),(r=ulr).time=yme(),t=t==null?null:t+"");for(var i=this._groups,n=i.length,s=0;s<n;++s)for(var o=i[s],a=o.length,l,c=0;c<a;++c)(l=o[c])&&Uq(l,t,e,c,o,r||dlr(l,e));return new B_(i,this._parents,t,e)}t5.prototype.interrupt=lar;t5.prototype.transition=hlr;function $L(t,e,r){this.k=t,this.x=e,this.y=r}$L.prototype={constructor:$L,scale:function(t){return t===1?this:new $L(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new $L(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};$L.prototype;const bme=()=>{const t=U.useContext(Ix),e=U.useRef(null),[r,i]=U.useContext(Co),n=()=>{WOe("path.hex").remove(),WOe("text.hexText").remove();const s=[410/1.8,260/3],o=[35/3,80/3],a=[[0,0],[o[0]*2,0],[o[0],-o[1]*.75],[-o[0],-o[1]*.75],[-o[0]*2,0],[-o[0],o[1]*.75],[o[0],o[1]*.75],[o[0]*3,o[1]*.75],[o[0]*4,0],[o[0]*3,-o[1]*.75],[o[0]*2,-o[1]*1.5],[0,-o[1]*1.5],[-o[0]*2,-o[1]*1.5],[-o[0]*3,-o[1]*.75],[-o[0]*4,0],[-o[0]*3,o[1]*.75],[-o[0]*2,o[1]*1.5],[0,o[1]*1.5],[o[0]*2,o[1]*1.5],[o[0]*5,o[1]*.75],[o[0]*5,-o[1]*.75],[-o[0]*5,-o[1]*.75],[-o[0]*5,o[1]*.75],[o[0]*6,0],[-o[0]*6,0],[o[0],-o[1]*2.25],[-o[0],-o[1]*2.25],[o[0],o[1]*2.25],[-o[0],o[1]*2.25],[-o[0]*3,-o[1]*2.25],[o[0]*4,-o[1]*1.5],[o[0]*4,o[1]*1.5],[o[0]*3,o[1]*2.25],[o[0]*3,-o[1]*2.25],[-o[0]*4,-o[1]*1.5],[-o[0]*4,o[1]*1.5],[-o[0]*3,o[1]*2.25]],l=b=>{let w={HIGH:[],MED:[],LOW:[]};return b.forEach(x=>{x[2]===200?w.HIGH.push(x[2]):x[2]===50?w.MED.push(x[2]):w.LOW.push(x[2])}),[`${(w.HIGH.length/37*100).toFixed(1)}% - 200`,`${(w.MED.length/37*100).toFixed(1)}% - 50`,` ${(w.LOW.length/37*100).toFixed(1)}% - 5 `]},c=a.map((b,w)=>[...b,t.hexTypes[w]]),u=l(c),h={5:"rgba(0, 224, 135, 0.4)",50:"rgba(0, 168, 224, 0.5)",200:"rgba(135, 0, 224, 0.5)"},f=b=>[s[0]+b[0],s[1]+b[1]],m=[[o[0],o[1]],[o[0]-o[0],o[1]*.75],[o[0]-o[0],o[1]*.25],[o[0],o[1]-o[1]],[o[0]*2,o[1]*.25],[o[0]*2,o[1]*.75]],g=420,y=360,_=Mor(e.current).attr("width",g).attr("height",y);_.selectAll("path").data(c).join(b=>b.append("path").transition().duration(2e3).attr("transform",(w,x)=>`translate(${f(w)})`).attr("d",`M${m.join("L")}Z`).attr("fill",w=>h[w[2]]||"rgba(0, 224, 135, 0.4)").attr("stroke","white").attr("stroke-width",2).attr("stroke-opacity",.1).attr("class","hex").selection(),b=>b.transition().duration(2e3).selection(),b=>b.transition().duration(2e3).selection()),_.selectAll("text").data(u).enter().append("text").attr("text-anchor","right").attr("font-size","12px").attr("font-family","Helvetica").style("font-style","italic").attr("startOffset","50%").style("fill","white").attr("fill-opacity",.3).attr("class","hexText").transition().duration(3e3).attr("x",(b,w)=>g/3.6-(1+w*10)).attr("y",(b,w)=>40+w*24).text(b=>b)};return U.useLayoutEffect(()=>{r.surfaceRequest&&n(),console.log("ran hexagraph")},[r.surfaceRequest,e.current]),F.jsx(F.Fragment,{children:F.jsx("div",{className:"hexagraph",children:F.jsx("svg",{ref:e})})})};function wme({}){const[t,e]=U.useContext(Co),r={"Los Angeles":{position:{x:-118.255,y:34.01,z:1380},heading:0,tilt:76},Ontario:{position:{x:-117.685,y:33.935,z:2546},heading:6.873,tilt:76.762},Detroit:{position:{x:-83.113,y:42.268,z:4754},heading:33.511,tilt:65.004},"Arlington, TX":{position:{x:-97.11,y:32.704,z:3122},heading:3.431,tilt:46.679},"The Villages":{position:{x:-81.941,y:28.812,z:3245},heading:339,tilt:69},Phoenix:{position:{x:-112.026,y:33.356,z:2659},heading:335,tilt:75},"Holland, MI":{position:{x:-86.034,y:42.749,z:2181},heading:298,tilt:71.86}},i=(n,s)=>{console.log("navigation",s),e({type:"cameraLocation",payload:r[s]}),e({type:"placeName",payload:s}),console.log("location",t.cameraLocation),console.log("location",t.placeName)};return F.jsx(drt,{style:{position:"fixed",bottom:0,opacity:.6},sx:{zIndex:"tooltip",bgcolor:"background.paper",boxShadow:1,p:1,width:1},children:F.jsxs(Ect,{value:t.placeName,onChange:i,"aria-label":"disabled tabs example",centered:!0,sx:{zIndex:"tooltip",boxShadow:9},children:[F.jsx(zx,{label:"Los Angeles",value:"Los Angeles"}),F.jsx(zx,{label:"Ontario",value:"Ontario"}),F.jsx(zx,{label:"Detroit",value:"Detroit"}),F.jsx(zx,{label:"Arlington, TX",value:"Arlington, TX"}),F.jsx(zx,{label:"The Villages",value:"The Villages"}),F.jsx(zx,{label:"Phoenix",value:"Phoenix"}),F.jsx(zx,{label:"Holland, MI",value:"Holland, MI"})]})})}var xme={},ZXe={exports:{}};(function(t){function e(r){return r&&r.__esModule?r:{default:r}}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports})(ZXe);var Nh=ZXe.exports,YJ={};const plr=EYe(int);var lAe;function Fh(){return lAe||(lAe=1,function(t){"use client";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return e.createSvgIcon}});var e=plr}(YJ)),YJ}var flr=Nh;Object.defineProperty(xme,"__esModule",{value:!0});var JXe=xme.default=void 0,mlr=flr(Fh()),glr=F,ylr=(0,mlr.default)((0,glr.jsx)("path",{d:"m19.77 5.03 1.4 1.4L8.43 19.17l-5.6-5.6 1.4-1.4 4.2 4.2L19.77 5.03m0-2.83L8.43 13.54l-4.2-4.2L0 13.57 8.43 22 24 6.43 19.77 2.2z"}),"DoneOutline");JXe=xme.default=ylr;var Sme={},vlr=Nh;Object.defineProperty(Sme,"__esModule",{value:!0});var KXe=Sme.default=void 0,_lr=vlr(Fh()),blr=F,wlr=(0,_lr.default)((0,blr.jsx)("path",{d:"M16.54 11 13 7.46l1.41-1.41 2.12 2.12 4.24-4.24 1.41 1.41L16.54 11zM11 7H2v2h9V7zm10 6.41L19.59 12 17 14.59 14.41 12 13 13.41 15.59 16 13 18.59 14.41 20 17 17.41 19.59 20 21 18.59 18.41 16 21 13.41zM11 15H2v2h9v-2z"}),"Rule");KXe=Sme.default=wlr;var Tme={},xlr=Nh;Object.defineProperty(Tme,"__esModule",{value:!0});var QXe=Tme.default=void 0,Slr=xlr(Fh()),Tlr=F,Elr=(0,Slr.default)((0,Tlr.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5.97 4.06L14.09 6l1.41 1.41L16.91 6l1.06 1.06-1.41 1.41 1.41 1.41-1.06 1.06-1.41-1.4-1.41 1.41-1.06-1.06 1.41-1.41-1.41-1.42zm-6.78.66h5v1.5h-5v-1.5zM11.5 16h-2v2H8v-2H6v-1.5h2v-2h1.5v2h2V16zm6.5 1.25h-5v-1.5h5v1.5zm0-2.5h-5v-1.5h5v1.5z"}),"Calculate");QXe=Tme.default=Elr;var Eme={},Clr=Nh;Object.defineProperty(Eme,"__esModule",{value:!0});var eYe=Eme.default=void 0,Rlr=Clr(Fh()),Olr=F,Alr=(0,Rlr.default)((0,Olr.jsx)("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3z"}),"AccountTree");eYe=Eme.default=Alr;var Cme={},Plr=Nh;Object.defineProperty(Cme,"__esModule",{value:!0});var tYe=Cme.default=void 0,Mlr=Plr(Fh()),$lr=F,Ilr=(0,Mlr.default)((0,$lr.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"}),"Refresh");tYe=Cme.default=Ilr;var Rme={},Llr=Nh;Object.defineProperty(Rme,"__esModule",{value:!0});var rYe=Rme.default=void 0,Dlr=Llr(Fh()),Nlr=F,Flr=(0,Dlr.default)((0,Nlr.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11 8 15.01z"}),"UploadFileOutlined");rYe=Rme.default=Flr;const zq=()=>{const[t,e]=U.useContext(Co);return F.jsx(cl,{style:{position:"relative",width:200,left:38,top:0},sx:{maxWidth:220},children:F.jsxs(Im,{fullWidth:!0,children:[F.jsx(Iy,{id:"demo-simple-select-label",children:"Surface Resolution"}),F.jsxs(Ly,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:t.surfaceResolution,label:"Surface Resolution",onChange:r=>e({type:"surfaceResolution",payload:r.target.value}),children:[F.jsx(ia,{value:9,children:"COARSE - 9"}),F.jsx(ia,{value:10,children:"LOW - 10"}),F.jsx(ia,{value:11,children:"MED - 11"}),F.jsx(ia,{value:12,children:"HIGH - 12"}),F.jsx(ia,{value:13,children:"FINE - 13"})]})]})})};var Ome={},klr=Nh;Object.defineProperty(Ome,"__esModule",{value:!0});var iYe=Ome.default=void 0,Ulr=klr(Fh()),zlr=F,Vlr=(0,Ulr.default)((0,zlr.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");iYe=Ome.default=Vlr;const Vq=()=>{const[t,e]=U.useContext(Co),[r,i]=U.useContext(u1),n=()=>{r.graphicsLayer.removeAll(),e({type:"surfaceData",payload:{scoredFields:t.scoredFields,demoPanel:"RESET SURFACE",surfaceResolution:t.surfaceResolution,surfaceRequest:!1}}),e({type:"AOIgeometry",payload:{}})};return F.jsx(cl,{textAlign:"center",children:F.jsx(D4,{variant:"outlined",startIcon:F.jsx(iYe,{}),size:"small",onClick:n,children:"Remove Surface"})})},Blr=["Slope","Terrain Ruggedness Index","Building Footprint","Roads","Temporary flight restrictions","Airspace schedule","Prisons","Streams","Balloonports","Daytime population data","Glideports","Ultralight","Schools","NRHP Location Points","State capitol buildings","NRHP Location Polygons","Stadium","FAA Obstacles","Power Plants","Military Training Routes","Railroad bridges","Bridges","Recreational Flyer Fixed Sites","Community advisories","Veteran health facilities","Helipads","Bodies of water","Child Care Centers","Railroad lines","Parks","Population Night","Hazards","Landscan Night Polygon","Landscan Day Polygon","Digital elevation model","Land use land cover","Convention centers and fairgrounds","Courthouses","Electric substations","EMS stations","Fire stations","Government buildings","Hospitals","Military facilities","Police stations","Sport venues","Transmission lines","Controlled Airspace Classification","Special use airspace","Full Time National Security UAS Flight Restriction","Colleges and universities","Washington DC Flight Restricted Zone","UAS Facility Management Flight Ceiling","Part Time National Security UAS Flight Restriction","Urgent care facilities","Wind farms","National Parks","Population in daytime","Railroad bridge overpass","FCC Antenna Structures","Emergency operation centers","ZIP codes","Landscan Night Point","Landscan Day Point","Airports","UAS Facility Management Flight Ceiling Primary","UAS Facility Management Flight Ceiling Secondary","US Building Footprints"],jlr=["Slope","Terrain Ruggedness Index","Daytime population data","Population Night","Landscan Night Polygon","Landscan Day Polygon","Digital elevation model","Land use land cover","UAS Facility Management Flight Ceiling","Population in daytime","ZIP codes","Landscan Night Point","Landscan Day Point","UAS Facility Management Flight Ceiling Primary","UAS Facility Management Flight Ceiling Secondary"],Glr=[],Hlr=["Airspace schedule","Building Footprint","US Building Footprints","Slope","Terrain Ruggedness Index"],qlr=["Daytime population data","Digital elevation model","Landscan Day Point","Landscan Day Polygon","Landscan Night Point","Landscan Night Polygon","Population Night","Population in daytime","UAS Facility Management Flight Ceiling","UAS Facility Management Flight Ceiling Primary","UAS Facility Management Flight Ceiling Secondary","ZIP codes"],Wlr=["Airports","Airspace schedule","Balloonports","Bodies of water","Bridges","Building Footprint","Child Care Centers","Colleges and universities","Community advisories","Controlled Airspace Classification","Convention centers and fairgrounds","Courthouses","EMS stations","Electric substations","Emergency operation centers","FAA Obstacles","FCC Antenna Structures","Fire stations","Full Time National Security UAS Flight Restriction","Glideports","Government buildings","Hazards","Helipads","Hospitals","Military Training Routes","Military facilities","NRHP Location Points","NRHP Location Polygons","National Parks","Parks","Part Time National Security UAS Flight Restriction","Police stations","Power Plants","Prisons","Railroad bridge overpass","Railroad bridges","Railroad lines","Recreational Flyer Fixed Sites","Roads","Schools","Special use airspace","Sport venues","Stadium","State capitol buildings","Streams","Temporary flight restrictions","Transmission lines","US Building Footprints","Ultralight","Urgent care facilities","Veteran health facilities","Washington DC Flight Restricted Zone","Wind farms"],Xlr=["Airports","Airspace schedule","Balloonports","Bodies of water","Bridges","Building Footprint","Child Care Centers","Colleges and universities","Community advisories","Controlled Airspace Classification","Convention centers and fairgrounds","Courthouses","EMS stations","Electric substations","Emergency operation centers","FAA Obstacles","FCC Antenna Structures","Fire stations","Full Time National Security UAS Flight Restriction","Glideports","Government buildings","Hazards","Helipads","Hospitals","Military Training Routes","Military facilities","NRHP Location Points","NRHP Location Polygons","National Parks","Parks","Part Time National Security UAS Flight Restriction","Police stations","Power Plants","Prisons","Railroad bridge overpass","Railroad bridges","Railroad lines","Recreational Flyer Fixed Sites","Roads","Schools","Special use airspace","Sport venues","Stadium","State capitol buildings","Streams","Temporary flight restrictions","Transmission lines","US Building Footprints","Ultralight","Urgent care facilities","Veteran health facilities","Washington DC Flight Restricted Zone","Wind farms"],Ylr=["Daytime population data","Population Night","Landscan Night Polygon","Landscan Day Polygon","Digital elevation model","Population in daytime","ZIP codes","Landscan Night Point","Landscan Day Point"],Zlr=["Roads","Land use land cover","UAS Facility Management Flight Ceiling","UAS Facility Management Flight Ceiling Primary","UAS Facility Management Flight Ceiling Secondary"],Mm={layers:Blr,excludeClassify:jlr,excludeCalculate:Glr,problemLayers:Hlr,testedCalculate:qlr,tested:Wlr,sorted:Xlr,valueCalcLayers:Ylr,domainSelectLayers:Zlr};var Ame={},Jlr=Nh;Object.defineProperty(Ame,"__esModule",{value:!0});var nYe=Ame.default=void 0,Klr=Jlr(Fh()),Qlr=F,ecr=(0,Klr.default)((0,Qlr.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM17 13l-5 5-5-5h3V9h4v4h3z"}),"CloudDownload");nYe=Ame.default=ecr;var Pme={},tcr=Nh;Object.defineProperty(Pme,"__esModule",{value:!0});var sYe=Pme.default=void 0,rcr=tcr(Fh()),icr=F,ncr=(0,rcr.default)((0,icr.jsx)("path",{d:"M5 4v2h14V4H5zm0 10h4v6h6v-6h4l-7-7-7 7z"}),"Publish");sYe=Pme.default=ncr;const scr=t=>{const e=document.createElement("a");e.download="surfaceData.geojson",e.href=t.GeoJSONblob,e.click()},Bq={PaperProps:{style:{maxHeight:48*4.5+8,width:250}}},jq=(t,e,r)=>({fontWeight:e.indexOf(t)===-1?r.typography.fontWeightRegular:r.typography.fontWeightMedium}),Gq=t=>F.jsx(cl,{textAlign:"center",children:F.jsx(D4,{variant:"outlined",startIcon:F.jsx(nYe,{}),onClick:()=>scr(t),children:"Export Surface"})}),Hq=t=>F.jsx(cl,{textAlign:"center",children:F.jsx(D4,{variant:"contained",startIcon:F.jsx(sYe,{}),onClick:()=>t({type:"surfaceRequest",payload:!0}),children:"Surface Request"})}),ocr=({})=>{const[t,e]=U.useContext(Co),r=U.useContext(Ix),i=_f(),[n,s]=U.useState(t.selectedFields),[o,a]=U.useState(t.scoredFields),l=Mm.layers.filter(h=>!Mm.excludeClassify.includes(h)).filter(h=>!Mm.problemLayers.includes(h)).sort(),c=()=>n.length===0?"500px":`${n.length*48+380}px`,u=({target:{value:h}})=>{s(typeof h=="string"?h.split(","):h),a(h.map(f=>({field:f,score:"HIGH",func:[],valueCalc:!1}))),console.log("selectData",t)};return U.useEffect(()=>{e({type:"scoredFields",payload:o}),e({type:"selectedFields",payload:n})},[n,o]),F.jsx(F.Fragment,{children:F.jsxs("div",{className:"control-panel",style:{height:c()},children:[F.jsx("h2",{style:{textAlign:"center"},children:"SELECT DATA SURFACE"}),F.jsx("hr",{}),F.jsx("br",{}),F.jsxs(Im,{sx:{m:0,width:280},children:[F.jsx(Iy,{id:"demo-multiple-chip-label",children:"Surface Layers"}),F.jsx(Ly,{labelId:"demo-multiple-chip-label",id:"demo-multiple-chip",multiple:!0,value:n,onChange:u,input:F.jsx(_3,{id:"select-multiple-chip",label:"Chip"}),renderValue:h=>F.jsx(cl,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:h.map(f=>F.jsx(L4,{label:f},f))}),MenuProps:Bq,children:l.map(h=>F.jsx(ia,{value:h,style:jq(h,n,i),children:h},h))})]}),F.jsx("br",{}),F.jsx("br",{}),F.jsx("br",{}),F.jsxs(cl,{textAlign:"center",children:[F.jsx(zq,{}),F.jsx("br",{}),o&&t.surfaceResolution!==0&&Object.keys(t.AOIgeometry).length!==0&&Hq(e),F.jsx("br",{}),r.GeoJSONblob&&Gq(r),F.jsx("br",{}),r.GeoJSONblob&&F.jsx(Vq,{})]})]})})},acr=Ml.memo(ocr);var Mme={},lcr=Nh;Object.defineProperty(Mme,"__esModule",{value:!0});var oYe=Mme.default=void 0,ccr=lcr(Fh()),ucr=F,dcr=(0,ccr.default)((0,ucr.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"}),"Room");oYe=Mme.default=dcr;const hcr={routeBlob:new Blob([]),routeGeoJSON:{type:"FeatureCollection",features:[]}},$me=U.createContext(hcr),aYe=({children:t})=>{const[e,r]=U.useContext(Co),i=U.useContext(Ix),[n,s]=U.useState({routeBlob:new Blob([]),routeGeoJSON:{type:"FeatureCollection",features:[]}}),[o,a]=U.useState(!0),l=h=>{const f={type:"FeatureCollection",features:[]};return h.features.forEach(m=>{f.features.push({type:"Feature",id:m.id,properties:{SCORE:m.properties.SCORE,id:m.properties.id},geometry:{type:"Polygon",coordinates:[[]]}})}),f},c=U.useCallback(async()=>{if(e.waypointsGeometry&&i.GeoJSONblob){let h={resolution:e.surfaceResolution,waypoints:[e.waypointsGeometry],surface_GeoJSON:l(i.parsedGeoJSON)};const f=JSON.stringify(h),m={method:"post",url:"https://func-data-poc-dev-cus.azurewebsites.net/api/routingSolutions?code=N4dpI_xDyPftKbFjj2MKbdM2UiSan99L1iC3ckf9PsTAAzFu9n6XtQ==",headers:{"Content-Type":"application/json"},data:f};console.log("routeRequest",h),wXe(m).then(function(g){g.data.features.forEach((b,w)=>g.data.features[w].id=w);const y=new Blob([JSON.stringify(g.data)],{type:"application/json"}),_=URL.createObjectURL(y);s({routeBlob:_,routeGeoJSON:g.data}),a(!1)}).catch(function(g){console.log(g)})}},[e.waypointsGeometry]);U.useEffect(()=>{console.log("useEffect triggered"),c()},[c]);const u=n;return F.jsxs(F.Fragment,{children:[o&&Object.keys(e.waypointsGeometry).length!==0&&F.jsx(xXe,{}),F.jsx($me.Provider,{value:u,children:t})]})};var Ime={},pcr=Nh;Object.defineProperty(Ime,"__esModule",{value:!0});var sae=Ime.default=void 0,fcr=pcr(Fh()),mcr=F,gcr=(0,fcr.default)((0,mcr.jsx)("path",{d:"M5 20h14v-2H5v2zM19 9h-4V3H9v6H5l7 7 7-7z"}),"Download");sae=Ime.default=gcr;const Lme=()=>{const t=U.useContext($me),[e,r]=U.useState([]),[i,n]=U.useState({sketchWidget:!1,multiRouteSubmit:!1}),[s,o]=U.useContext(Co),[a,l]=U.useContext(u1);U.useEffect(()=>{s.demoType==="AirHub SkyPath"&&e.length===2&&o({type:"waypointsGeometry",payload:e}),s.demoType==="AirHub MultiPath"&&i.multiRouteSubmit&&o({type:"waypointsGeometry",payload:e})},[e,i.multiRouteSubmit]);const c=()=>{a.view.ui.remove(a.sketch);const g=new tXe({layer:a.graphicsLayer,view:a.view,layout:"vertical",creationmode:"continuous",availableCreateTools:["point"]});a.view.ui.add(g,"top-left"),g.state==="ready"&&g.create("point"),g.on("create",y=>{if(y.state==="complete"){const{x:_,y:b,z:w}=y.graphic.toJSON().geometry;r(x=>[...x,[_,b,w]])}}),n({...i,sketchWidget:!0})},u=()=>{const g=document.createElement("a");g.download="route.geojson",g.href=t.routeBlob,g.click()},h=()=>{n({...i,multiRouteSubmit:!0}),r(e)},f=(g,y,_)=>F.jsxs(cl,{textAlign:"center",children:[F.jsx("br",{}),F.jsx(D4,{variant:"contained",startIcon:g,onClick:y,children:_})]}),m=()=>F.jsxs(F.Fragment,{children:[F.jsx("br",{}),F.jsxs(cl,{textAlign:"center",children:[F.jsx("hr",{}),F.jsx("br",{}),!i.sketchWidget&&f(F.jsx(oYe,{}),c,"Enter Waypoints"),F.jsx("br",{}),(s.demoType==="AirHub MultiPath"||s.demoType==="AirHub ReadyToFly")&&f(F.jsx(sae,{}),h,"Request Route"),F.jsx("br",{}),t.routeGeoJSON.features.length!==0&&f(F.jsx(sae,{}),u,"Export Route")]})]});return F.jsx(F.Fragment,{children:m()})},ycr=()=>{const[t,e]=U.useContext(Co),r=U.useContext(Ix),i=_f(),[n,s]=U.useState(t.selectedFields),[o,a]=U.useState(t.scoredFields),l=Mm.layers.filter(g=>!Mm.excludeClassify.includes(g)).filter(g=>!Mm.problemLayers.includes(g)).sort(),c=()=>n.length===0?"400px":`${n.length*100+480}px`;U.useEffect(()=>{e({type:"scoredFields",payload:o}),e({type:"selectedFields",payload:n})},[n,o]);const u=({target:{value:g}})=>{s(typeof g=="string"?g.split(","):g),a(g.map(y=>({field:y,score:"LOW",func:[],valueCalc:!1})))},h=({target:{value:g,name:y}})=>{a(o.map(_=>_.field===y?{..._,score:g}:{..._})),console.log(o)},f=()=>F.jsxs(Im,{sx:{m:0,width:280},children:[F.jsx(Iy,{id:"demo-multiple-chip-label",children:"Surface Layers"}),F.jsx(Ly,{labelId:"demo-multiple-chip-label",id:"demo-multiple-chip",multiple:!0,value:n,onChange:u,input:F.jsx(_3,{id:"select-multiple-chip",label:"Chip"}),renderValue:g=>F.jsx(cl,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:g.map(y=>F.jsx(L4,{label:y},y))}),MenuProps:Bq,children:l.map(g=>F.jsx(ia,{value:g,style:jq(g,n,i),children:g},g))})]}),m=()=>F.jsx(F.Fragment,{children:F.jsx(cl,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:o.map((g,y)=>F.jsxs(Im,{fullWidth:!0,children:[F.jsx(Iy,{id:"demo-simple-select-label",children:g.field}),F.jsxs(Ly,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:g.score,label:"Category",onChange:h,name:g.field,children:[F.jsx(ia,{value:"LOW",children:"5"}),F.jsx(ia,{value:"MED",children:"50"}),F.jsx(ia,{value:"HIGH",children:"200"})]},g.field+"score")]},g.field))})});return F.jsx(F.Fragment,{children:F.jsxs("div",{className:"control-panel",style:{height:c()},children:[F.jsx("h2",{style:{textAlign:"center"},children:"CLASSIFY SURFACE"}),F.jsx("hr",{}),F.jsx("br",{}),f(),F.jsx("br",{}),F.jsx("br",{}),m(),F.jsx(zq,{}),F.jsx("br",{}),o&&t.surfaceResolution!==0&&Object.keys(t.AOIgeometry).length!==0&&Hq(e),F.jsx("br",{}),r.GeoJSONblob&&Gq(r),(t.demoType==="AirHub SkyPath"||t.demoType==="AirHub MultiPath"||t.demoType==="AirHub ReadyToFly")&&r.GeoJSONblob&&F.jsx(Lme,{}),F.jsx("br",{}),r.GeoJSONblob&&F.jsx(Vq,{})]})})},vcr=Ml.memo(ycr),_cr=["Roads","Land use land cover","UAS Facility Management Flight Ceiling","UAS Facility Management Flight Ceiling Primary","UAS Facility Management Flight Ceiling Secondary"],bcr={Roads:["motorway","trunk","primary","secondary","tertiary","unclassified","residential","service","motorway_link","trunk_link","primary_link","secondary_link","motorway_junction","living street","pedestrian","bicycle road","cyclestreet","track","bus guideway","busway","raceway","road","construction","escape","footway","cycleway","bridleway","path","steps","escalator","sidewalk","cycleway lane","cycleway tracks","bus and cyclists","lanes:psv"],"Land use land cover":["Open Water","Perennial Ice/Snow","Developed, Open Space","Developed, Low Intensity","Developed, Medium Intensity ","Developed High Intensity","Barren Land (Rock/Sand/Clay) ","Deciduous Forest","Evergreen Forest","Mixed Forest","Dwarf Scrub","Shrub/Scrub","Grassland/Herbaceous","Sedge/Herbaceous","Lichens","Moss","Pasture/Hay","Cultivated Crops ","Woody Wetlands","Emergent Herbaceous Wetlands"],"UAS Facility Management Flight Ceiling":[],"UAS Facility Management Flight Ceiling Primary":[],"UAS Facility Management Flight Ceiling Secondary":[]},wcr={domainSelectLayers:_cr,domains:bcr},xcr=()=>{const[t,e]=U.useContext(Co),r=U.useContext(Ix),i=_f(),[n,s]=U.useState(t.selectedFields),[o,a]=U.useState(t.scoredFields),l=Mm.layers.filter(w=>!Mm.excludeCalculate.includes(w)).filter(w=>!Mm.problemLayers.includes(w)).sort(),c=()=>n.length===0?"400px":`${n.length*130+540}px`,u=wcr.domains,h=Mm.valueCalcLayers,f=Mm.domainSelectLayers,m=({target:{value:w}})=>{s(typeof w=="string"?w.split(","):w),a(w.map(x=>({field:x,score:"LOW",funcScore:"",func:[],valueCalc:!1}))),e({type:"scoredFields",payload:o}),e({type:"selectedFields",payload:n})},g=({field:w,func:x,funcScore:S,valueCalc:C})=>({target:{value:E,name:R}})=>{console.log(`field ${w}, func ${x}, funcScore ${S}, valueCalc ${C}`),a(x?o.map(P=>P.field===w?{...P,func:E,valueCalc:C}:{...P}):o.map(P=>P.field===R?{...P,score:E}:{...P})),S?a(o.map(P=>P.field===w?{...P,funcScore:E}:{...P})):console.log(),console.log("scoredFields",o)};U.useEffect(()=>{e({type:"scoredFields",payload:o}),e({type:"selectedFields",payload:n})},[n,o]);const y=()=>F.jsxs(Im,{sx:{m:0,width:280},children:[F.jsx(Iy,{id:"demo-multiple-chip-label",children:"Surface Layers"}),F.jsx(Ly,{labelId:"demo-multiple-chip-label",id:"demo-multiple-chip",multiple:!0,value:n,onChange:m,input:F.jsx(_3,{id:"select-multiple-chip",label:"Chip"}),renderValue:w=>F.jsx(cl,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:w.map(x=>F.jsx(L4,{label:x},x))}),MenuProps:Bq,children:l.map(w=>F.jsx(ia,{value:w,style:jq(w,n,i),children:w},w))})]}),_=w=>{const x=h.includes(w.field)?"valueCalc":f.includes(w.field)?"domainSelect":"",S=w.field==="MAX_obstacle_elev_m"?"lambda x: 1 if x > 25 else None":u[w.field];return F.jsxs(F.Fragment,{children:[F.jsx(Im,{children:x==="valueCalc"?F.jsx($ct,{id:"filled-basic",label:"x > 1000 (may use >,<,>=,<=)",variant:"filled",value:w.func.length!==0?w.func:"x > ___",onChange:g({field:w.field,func:!0,valueCalc:!0})}):x==="domainSelect"?F.jsxs(F.Fragment,{children:[F.jsx(Iy,{id:"demo-simple-select-label",children:"Categories"}),F.jsx(Ly,{multiple:!0,labelId:"demo-simple-select-label",id:"demo-simple-select",value:w.func,onChange:g({field:w.field,func:[""],valueCalc:!1}),name:w.field+"domains",children:S.map(C=>F.jsx(ia,{value:C,children:C},C))},w.field+"domains")]}):F.jsx(F.Fragment,{})}),F.jsxs(Im,{children:[F.jsx(Iy,{id:"demo-simple-select-label",children:"Score"}),F.jsxs(Ly,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:w.funcScore,onChange:g({field:w.field,func:!1,funcScore:!0}),name:w.field,children:[F.jsx(ia,{value:"LOW",children:"5"}),F.jsx(ia,{value:"MED",children:"50"}),F.jsx(ia,{value:"HIGH",children:"200"})]},w.field+"score")]})]})},b=()=>F.jsx(cl,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:o.map((w,x)=>F.jsxs(Im,{fullWidth:!0,children:[F.jsx(Iy,{id:"demo-simple-select-label",children:w.field}),F.jsxs(Ly,{labelId:"demo-simple-select-label",id:"demo-simple-select",value:w.score,label:"Category",onChange:g({field:!1,func:!1}),name:w.field,children:[F.jsx(ia,{value:"LOW",children:"5"}),F.jsx(ia,{value:"MED",children:"50"}),F.jsx(ia,{value:"HIGH",children:"200"}),(h.includes(w.field)===!0||f.includes(w.field)===!0)&&F.jsx(ia,{value:"FUNC",children:"Calculation"})]},w.field+"score"),w.score==="FUNC"&&_(w)]},w.field))});return F.jsx(F.Fragment,{children:F.jsxs("div",{className:"control-panel",style:{height:c()},children:[F.jsx("h2",{style:{textAlign:"center"},children:"CALCULATE SURFACE"}),F.jsx("hr",{}),F.jsx("br",{}),y(),F.jsx("br",{}),F.jsx("br",{}),b(),F.jsx(zq,{}),F.jsx("br",{}),o&&t.surfaceResolution!==0&&Object.keys(t.AOIgeometry).length!==0&&Hq(e),r.GeoJSONblob&&Gq(r),(t.demoType==="AirHub SkyPath"||t.demoType==="AirHub MultiPath"||t.demoType==="AirHub ReadyToFly")&&r.GeoJSONblob&&F.jsx(Lme,{}),F.jsx("br",{}),r.GeoJSONblob&&F.jsx(Vq,{})]})})},Scr=Ml.memo(xcr),Tcr={SPRIGHT:[{field:"Roads",score:"LOW",func:[]},{field:"Transmission lines",score:"MED",func:[]},{field:"Railroad lines",score:"MED",func:[]},{field:"Schools",score:"MED",func:[]},{field:"Airports",score:"HIGH",func:[]},{field:"Hospitals",score:"HIGH",func:[]},{field:"Prisons",score:"HIGH",func:[]},{field:"FCC Antenna Structures",score:"HIGH",func:[]},{field:"Helipads",score:"HIGH",func:[]},{field:"Electric substations",score:"HIGH",func:[]},{field:"Police stations",score:"HIGH",func:[]},{field:"Emergency operation centers",score:"HIGH",func:[]},{field:"Wind farms",score:"HIGH",func:[]},{field:"Special use airspace",score:"HIGH",func:[]},{field:"Power Plants",score:"HIGH",func:[]},{field:"FAA Obstacles",score:"HIGH",func:[]},{field:"Military facilities",score:"HIGH",func:[]},{field:"Military Training Routes",score:"HIGH",func:[]}]},Ecr=()=>{const[t,e]=U.useContext(Co),r=U.useContext(Ix),i=_f(),[n,s]=U.useState(t.selectedFields),[o,a]=U.useState(t.scoredFields);U.useEffect(()=>{e({type:"scoredFields",payload:o}),e({type:"selectedFields",payload:n})},[n,o]);const l=["Part 107 Operator Model","Part 135 Delivery Model"],c=h=>{const{target:{value:f}}=h,m=f[0]==="Part 107 Operator Model"?Tcr.SPRIGHT:f[0]==="b"?2:f[0]==="c"?3:"nope";s(f),a(m)},u=()=>F.jsxs(Im,{sx:{m:0,width:280},children:[F.jsx(Iy,{id:"demo-multiple-chip-label",children:"Surface Models"}),F.jsx(Ly,{labelId:"demo-multiple-chip-label",id:"demo-multiple-chip",multiple:!0,value:n,onChange:c,input:F.jsx(_3,{id:"select-multiple-chip",label:"Chip"}),renderValue:h=>F.jsx(cl,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:h.map(f=>F.jsx(L4,{label:f},f))}),MenuProps:Bq,children:l.map(h=>F.jsx(ia,{value:h,style:jq(h,n,i),children:h},h))})]});return F.jsx(F.Fragment,{children:F.jsxs("div",{className:"control-panel",children:[F.jsx("h2",{style:{textAlign:"center"},children:"SELECT SURFACE MODEL"}),F.jsx("hr",{}),F.jsx("br",{}),u(),F.jsx("br",{}),F.jsx(zq,{}),F.jsx("br",{}),o&&t.surfaceResolution!==0&&Object.keys(t.AOIgeometry).length!==0&&Hq(e),F.jsx("br",{}),r.GeoJSONblob&&Gq(r),(t.demoType==="AirHub SkyPath"||t.demoType==="AirHub MultiPath"||t.demoType==="AirHub ReadyToFly")&&r.GeoJSONblob&&F.jsx(Lme,{}),F.jsx("br",{}),r.GeoJSONblob&&F.jsx(Vq,{})]})})},Ccr=Ml.memo(Ecr),Rcr="/arcgis-demo-vite/assets/ASLLogoStack-6870b2cd.png";var Dme={},Ocr=Nh;Object.defineProperty(Dme,"__esModule",{value:!0});var lYe=Dme.default=void 0,Acr=Ocr(Fh()),Pcr=F,Mcr=(0,Acr.default)((0,Pcr.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"}),"CloudUpload");lYe=Dme.default=Mcr;var Nme={},$cr=Nh;Object.defineProperty(Nme,"__esModule",{value:!0});var cYe=Nme.default=void 0,Icr=$cr(Fh()),Lcr=F,Dcr=(0,Icr.default)((0,Lcr.jsx)("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11zM8 15.01l1.41 1.41L11 14.84V19h2v-4.16l1.59 1.59L16 15.01 12.01 11z"}),"UploadFile");cYe=Nme.default=Dcr;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function Ncr(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function i5(t,e,r,i){function n(s){return s instanceof r?s:new r(function(o){o(s)})}return new(r||(r=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(h){o(h)}}function l(u){try{c(i.throw(u))}catch(h){o(h)}}function c(u){u.done?s(u.value):n(u.value).then(a,l)}c((i=i.apply(t,e||[])).next())})}function n5(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(c){return function(u){return l([c,u])}}function l(c){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=c[0]&2?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,n=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(u){c=[6,u],n=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Fcr(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return s}function kcr(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Fcr(arguments[e]));return t}var uYe={exports:{}},kn={};/** @license React v16.13.1
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var hl=typeof Symbol=="function"&&Symbol.for,Fme=hl?Symbol.for("react.element"):60103,kme=hl?Symbol.for("react.portal"):60106,qq=hl?Symbol.for("react.fragment"):60107,Wq=hl?Symbol.for("react.strict_mode"):60108,Xq=hl?Symbol.for("react.profiler"):60114,Yq=hl?Symbol.for("react.provider"):60109,Zq=hl?Symbol.for("react.context"):60110,Ume=hl?Symbol.for("react.async_mode"):60111,Jq=hl?Symbol.for("react.concurrent_mode"):60111,Kq=hl?Symbol.for("react.forward_ref"):60112,Qq=hl?Symbol.for("react.suspense"):60113,Ucr=hl?Symbol.for("react.suspense_list"):60120,eW=hl?Symbol.for("react.memo"):60115,tW=hl?Symbol.for("react.lazy"):60116,zcr=hl?Symbol.for("react.block"):60121,Vcr=hl?Symbol.for("react.fundamental"):60117,Bcr=hl?Symbol.for("react.responder"):60118,jcr=hl?Symbol.for("react.scope"):60119;function kh(t){if(typeof t=="object"&&t!==null){var e=t.$$typeof;switch(e){case Fme:switch(t=t.type,t){case Ume:case Jq:case qq:case Xq:case Wq:case Qq:return t;default:switch(t=t&&t.$$typeof,t){case Zq:case Kq:case tW:case eW:case Yq:return t;default:return e}}case kme:return e}}}function dYe(t){return kh(t)===Jq}kn.AsyncMode=Ume;kn.ConcurrentMode=Jq;kn.ContextConsumer=Zq;kn.ContextProvider=Yq;kn.Element=Fme;kn.ForwardRef=Kq;kn.Fragment=qq;kn.Lazy=tW;kn.Memo=eW;kn.Portal=kme;kn.Profiler=Xq;kn.StrictMode=Wq;kn.Suspense=Qq;kn.isAsyncMode=function(t){return dYe(t)||kh(t)===Ume};kn.isConcurrentMode=dYe;kn.isContextConsumer=function(t){return kh(t)===Zq};kn.isContextProvider=function(t){return kh(t)===Yq};kn.isElement=function(t){return typeof t=="object"&&t!==null&&t.$$typeof===Fme};kn.isForwardRef=function(t){return kh(t)===Kq};kn.isFragment=function(t){return kh(t)===qq};kn.isLazy=function(t){return kh(t)===tW};kn.isMemo=function(t){return kh(t)===eW};kn.isPortal=function(t){return kh(t)===kme};kn.isProfiler=function(t){return kh(t)===Xq};kn.isStrictMode=function(t){return kh(t)===Wq};kn.isSuspense=function(t){return kh(t)===Qq};kn.isValidElementType=function(t){return typeof t=="string"||typeof t=="function"||t===qq||t===Jq||t===Xq||t===Wq||t===Qq||t===Ucr||typeof t=="object"&&t!==null&&(t.$$typeof===tW||t.$$typeof===eW||t.$$typeof===Yq||t.$$typeof===Zq||t.$$typeof===Kq||t.$$typeof===Vcr||t.$$typeof===Bcr||t.$$typeof===jcr||t.$$typeof===zcr)};kn.typeOf=kh;/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var cAe=Object.getOwnPropertySymbols,Gcr=Object.prototype.hasOwnProperty,Hcr=Object.prototype.propertyIsEnumerable;function qcr(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function Wcr(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;var i=Object.getOwnPropertyNames(e).map(function(s){return e[s]});if(i.join("")!=="0123456789")return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(s){n[s]=s}),Object.keys(Object.assign({},n)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}Wcr();var Xcr="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Ycr=Xcr;Function.call.bind(Object.prototype.hasOwnProperty);var Zcr=Ycr;function hYe(){}function pYe(){}pYe.resetWarningCache=hYe;var Jcr=function(){function t(i,n,s,o,a,l){if(l!==Zcr){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}t.isRequired=t;function e(){return t}var r={array:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:pYe,resetWarningCache:hYe};return r.PropTypes=r,r};uYe.exports=Jcr();var As=uYe.exports,Kcr=new Map([["avi","video/avi"],["gif","image/gif"],["ico","image/x-icon"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["mkv","video/x-matroska"],["mov","video/quicktime"],["mp4","video/mp4"],["pdf","application/pdf"],["png","image/png"],["zip","application/zip"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"]]);function rW(t,e){var r=Qcr(t);if(typeof r.path!="string"){var i=t.webkitRelativePath;Object.defineProperty(r,"path",{value:typeof e=="string"?e:typeof i=="string"&&i.length>0?i:t.name,writable:!1,configurable:!1,enumerable:!0})}return r}function Qcr(t){var e=t.name,r=e&&e.lastIndexOf(".")!==-1;if(r&&!t.type){var i=e.split(".").pop().toLowerCase(),n=Kcr.get(i);n&&Object.defineProperty(t,"type",{value:n,writable:!1,configurable:!1,enumerable:!0})}return t}var eur=[".DS_Store","Thumbs.db"];function tur(t){return i5(this,void 0,void 0,function(){return n5(this,function(e){return[2,rur(t)&&t.dataTransfer?sur(t.dataTransfer,t.type):iur(t)]})})}function rur(t){return!!t.dataTransfer}function iur(t){var e=nur(t.target)?t.target.files?oae(t.target.files):[]:[];return e.map(function(r){return rW(r)})}function nur(t){return t!==null}function sur(t,e){return i5(this,void 0,void 0,function(){var r,i;return n5(this,function(n){switch(n.label){case 0:return t.items?(r=oae(t.items).filter(function(s){return s.kind==="file"}),e!=="drop"?[2,r]:[4,Promise.all(r.map(our))]):[3,2];case 1:return i=n.sent(),[2,uAe(fYe(i))];case 2:return[2,uAe(oae(t.files).map(function(s){return rW(s)}))]}})})}function uAe(t){return t.filter(function(e){return eur.indexOf(e.name)===-1})}function oae(t){for(var e=[],r=0;r<t.length;r++){var i=t[r];e.push(i)}return e}function our(t){if(typeof t.webkitGetAsEntry!="function")return dAe(t);var e=t.webkitGetAsEntry();return e&&e.isDirectory?mYe(e):dAe(t)}function fYe(t){return t.reduce(function(e,r){return kcr(e,Array.isArray(r)?fYe(r):[r])},[])}function dAe(t){var e=t.getAsFile();if(!e)return Promise.reject(t+" is not a File");var r=rW(e);return Promise.resolve(r)}function aur(t){return i5(this,void 0,void 0,function(){return n5(this,function(e){return[2,t.isDirectory?mYe(t):lur(t)]})})}function mYe(t){var e=t.createReader();return new Promise(function(r,i){var n=[];function s(){var o=this;e.readEntries(function(a){return i5(o,void 0,void 0,function(){var l,c,u;return n5(this,function(h){switch(h.label){case 0:if(a.length)return[3,5];h.label=1;case 1:return h.trys.push([1,3,,4]),[4,Promise.all(n)];case 2:return l=h.sent(),r(l),[3,4];case 3:return c=h.sent(),i(c),[3,4];case 4:return[3,6];case 5:u=Promise.all(a.map(aur)),n.push(u),s(),h.label=6;case 6:return[2]}})})},function(a){i(a)})}s()})}function lur(t){return i5(this,void 0,void 0,function(){return n5(this,function(e){return[2,new Promise(function(r,i){t.file(function(n){var s=rW(n,t.fullPath);r(s)},function(n){i(n)})})]})})}var cur=function(t,e){if(t&&e){var r=Array.isArray(e)?e:e.split(","),i=t.name||"",n=(t.type||"").toLowerCase(),s=n.replace(/\/.*$/,"");return r.some(function(o){var a=o.trim().toLowerCase();return a.charAt(0)==="."?i.toLowerCase().endsWith(a):a.endsWith("/*")?s===a.replace(/\/.*$/,""):n===a})}return!0};function hAe(t,e){return pur(t)||hur(t,e)||dur(t,e)||uur()}function uur(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dur(t,e){if(t){if(typeof t=="string")return pAe(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pAe(t,e)}}function pAe(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function hur(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var i=[],n=!0,s=!1,o,a;try{for(r=r.call(t);!(n=(o=r.next()).done)&&(i.push(o.value),!(e&&i.length===e));n=!0);}catch(l){s=!0,a=l}finally{try{!n&&r.return!=null&&r.return()}finally{if(s)throw a}}return i}}function pur(t){if(Array.isArray(t))return t}var fur="file-invalid-type",mur="file-too-large",gur="file-too-small",yur="too-many-files",vur=function(e){e=Array.isArray(e)&&e.length===1?e[0]:e;var r=Array.isArray(e)?"one of ".concat(e.join(", ")):e;return{code:fur,message:"File type must be ".concat(r)}},fAe=function(e){return{code:mur,message:"File is larger than ".concat(e," bytes")}},mAe=function(e){return{code:gur,message:"File is smaller than ".concat(e," bytes")}},_ur={code:yur,message:"Too many files"};function gYe(t,e){var r=t.type==="application/x-moz-file"||cur(t,e);return[r,r?null:vur(e)]}function yYe(t,e,r){if(B$(t.size))if(B$(e)&&B$(r)){if(t.size>r)return[!1,fAe(r)];if(t.size<e)return[!1,mAe(e)]}else{if(B$(e)&&t.size<e)return[!1,mAe(e)];if(B$(r)&&t.size>r)return[!1,fAe(r)]}return[!0,null]}function B$(t){return t!=null}function bur(t){var e=t.files,r=t.accept,i=t.minSize,n=t.maxSize,s=t.multiple,o=t.maxFiles;return!s&&e.length>1||s&&o>=1&&e.length>o?!1:e.every(function(a){var l=gYe(a,r),c=hAe(l,1),u=c[0],h=yYe(a,i,n),f=hAe(h,1),m=f[0];return u&&m})}function Kj(t){return typeof t.isPropagationStopped=="function"?t.isPropagationStopped():typeof t.cancelBubble<"u"?t.cancelBubble:!1}function QU(t){return t.dataTransfer?Array.prototype.some.call(t.dataTransfer.types,function(e){return e==="Files"||e==="application/x-moz-file"}):!!t.target&&!!t.target.files}function gAe(t){t.preventDefault()}function wur(t){return t.indexOf("MSIE")!==-1||t.indexOf("Trident/")!==-1}function xur(t){return t.indexOf("Edge/")!==-1}function Sur(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return wur(t)||xur(t)}function Hg(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return function(i){for(var n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];return e.some(function(a){return!Kj(i)&&a&&a.apply(void 0,[i].concat(s)),Kj(i)})}}var Tur=["children"],Eur=["open"],Cur=["refKey","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Rur=["refKey","onChange","onClick"];function Our(t){return Mur(t)||Pur(t)||vYe(t)||Aur()}function Aur(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Pur(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Mur(t){if(Array.isArray(t))return aae(t)}function ZJ(t,e){return Lur(t)||Iur(t,e)||vYe(t,e)||$ur()}function $ur(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vYe(t,e){if(t){if(typeof t=="string")return aae(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return aae(t,e)}}function aae(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function Iur(t,e){var r=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(r!=null){var i=[],n=!0,s=!1,o,a;try{for(r=r.call(t);!(n=(o=r.next()).done)&&(i.push(o.value),!(e&&i.length===e));n=!0);}catch(l){s=!0,a=l}finally{try{!n&&r.return!=null&&r.return()}finally{if(s)throw a}}return i}}function Lur(t){if(Array.isArray(t))return t}function yAe(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable})),r.push.apply(r,i)}return r}function Gs(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?yAe(Object(r),!0).forEach(function(i){lae(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):yAe(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}function lae(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Qj(t,e){if(t==null)return{};var r=Dur(t,e),i,n;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);for(n=0;n<s.length;n++)i=s[n],!(e.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(t,i)&&(r[i]=t[i])}return r}function Dur(t,e){if(t==null)return{};var r={},i=Object.keys(t),n,s;for(s=0;s<i.length;s++)n=i[s],!(e.indexOf(n)>=0)&&(r[n]=t[n]);return r}var zme=U.forwardRef(function(t,e){var r=t.children,i=Qj(t,Tur),n=wYe(i),s=n.open,o=Qj(n,Eur);return U.useImperativeHandle(e,function(){return{open:s}},[s]),Ml.createElement(U.Fragment,null,r(Gs(Gs({},o),{},{open:s})))});zme.displayName="Dropzone";var _Ye={disabled:!1,getFilesFromEvent:tur,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null};zme.defaultProps=_Ye;zme.propTypes={children:As.func,accept:As.oneOfType([As.string,As.arrayOf(As.string)]),multiple:As.bool,preventDropOnDocument:As.bool,noClick:As.bool,noKeyboard:As.bool,noDrag:As.bool,noDragEventsBubbling:As.bool,minSize:As.number,maxSize:As.number,maxFiles:As.number,disabled:As.bool,getFilesFromEvent:As.func,onFileDialogCancel:As.func,onDragEnter:As.func,onDragLeave:As.func,onDragOver:As.func,onDrop:As.func,onDropAccepted:As.func,onDropRejected:As.func,validator:As.func};var bYe={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],fileRejections:[]};function wYe(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=Gs(Gs({},_Ye),t),r=e.accept,i=e.disabled,n=e.getFilesFromEvent,s=e.maxSize,o=e.minSize,a=e.multiple,l=e.maxFiles,c=e.onDragEnter,u=e.onDragLeave,h=e.onDragOver,f=e.onDrop,m=e.onDropAccepted,g=e.onDropRejected,y=e.onFileDialogCancel,_=e.preventDropOnDocument,b=e.noClick,w=e.noKeyboard,x=e.noDrag,S=e.noDragEventsBubbling,C=e.validator,E=U.useRef(null),R=U.useRef(null),P=U.useReducer(Nur,bYe),D=ZJ(P,2),L=D[0],k=D[1],V=L.isFocused,W=L.isFileDialogActive,G=L.draggedFiles,B=U.useCallback(function(){R.current&&(k({type:"openDialog"}),R.current.value=null,R.current.click())},[k]),Z=function(){W&&setTimeout(function(){if(R.current){var Ae=R.current.files;Ae.length||(k({type:"closeDialog"}),typeof y=="function"&&y())}},300)};U.useEffect(function(){return window.addEventListener("focus",Z,!1),function(){window.removeEventListener("focus",Z,!1)}},[R,W,y]);var M=U.useCallback(function(fe){!E.current||!E.current.isEqualNode(fe.target)||(fe.keyCode===32||fe.keyCode===13)&&(fe.preventDefault(),B())},[E,R]),$=U.useCallback(function(){k({type:"focus"})},[]),N=U.useCallback(function(){k({type:"blur"})},[]),j=U.useCallback(function(){b||(Sur()?setTimeout(B,0):B())},[R,b]),J=U.useRef([]),K=function(Ae){E.current&&E.current.contains(Ae.target)||(Ae.preventDefault(),J.current=[])};U.useEffect(function(){return _&&(document.addEventListener("dragover",gAe,!1),document.addEventListener("drop",K,!1)),function(){_&&(document.removeEventListener("dragover",gAe),document.removeEventListener("drop",K))}},[E,_]);var te=U.useCallback(function(fe){fe.preventDefault(),fe.persist(),Le(fe),J.current=[].concat(Our(J.current),[fe.target]),QU(fe)&&Promise.resolve(n(fe)).then(function(Ae){Kj(fe)&&!S||(k({draggedFiles:Ae,isDragActive:!0,type:"setDraggedFiles"}),c&&c(fe))})},[n,c,S]),ae=U.useCallback(function(fe){fe.preventDefault(),fe.persist(),Le(fe);var Ae=QU(fe);if(Ae&&fe.dataTransfer)try{fe.dataTransfer.dropEffect="copy"}catch{}return Ae&&h&&h(fe),!1},[h,S]),be=U.useCallback(function(fe){fe.preventDefault(),fe.persist(),Le(fe);var Ae=J.current.filter(function(Re){return E.current&&E.current.contains(Re)}),gt=Ae.indexOf(fe.target);gt!==-1&&Ae.splice(gt,1),J.current=Ae,!(Ae.length>0)&&(k({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),QU(fe)&&u&&u(fe))},[E,u,S]),Ee=U.useCallback(function(fe){fe.preventDefault(),fe.persist(),Le(fe),J.current=[],QU(fe)&&Promise.resolve(n(fe)).then(function(Ae){if(!(Kj(fe)&&!S)){var gt=[],Re=[];Ae.forEach(function(He){var Dt=gYe(He,r),Fe=ZJ(Dt,2),nt=Fe[0],Ke=Fe[1],mt=yYe(He,o,s),wt=ZJ(mt,2),xt=wt[0],st=wt[1],Xe=C?C(He):null;if(nt&&xt&&!Xe)gt.push(He);else{var it=[Ke,st];Xe&&(it=it.concat(Xe)),Re.push({file:He,errors:it.filter(function(Oe){return Oe})})}}),(!a&&gt.length>1||a&&l>=1&&gt.length>l)&&(gt.forEach(function(He){Re.push({file:He,errors:[_ur]})}),gt.splice(0)),k({acceptedFiles:gt,fileRejections:Re,type:"setFiles"}),f&&f(gt,Re,fe),Re.length>0&&g&&g(Re,fe),gt.length>0&&m&&m(gt,fe)}}),k({type:"reset"})},[a,r,o,s,l,n,f,m,g,S,C]),Je=function(Ae){return i?null:Ae},ze=function(Ae){return w?null:Je(Ae)},Ge=function(Ae){return x?null:Je(Ae)},Le=function(Ae){S&&Ae.stopPropagation()},de=U.useMemo(function(){return function(){var fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Ae=fe.refKey,gt=Ae===void 0?"ref":Ae,Re=fe.onKeyDown,He=fe.onFocus,Dt=fe.onBlur,Fe=fe.onClick,nt=fe.onDragEnter,Ke=fe.onDragOver,mt=fe.onDragLeave,wt=fe.onDrop,xt=Qj(fe,Cur);return Gs(Gs(lae({onKeyDown:ze(Hg(Re,M)),onFocus:ze(Hg(He,$)),onBlur:ze(Hg(Dt,N)),onClick:Je(Hg(Fe,j)),onDragEnter:Ge(Hg(nt,te)),onDragOver:Ge(Hg(Ke,ae)),onDragLeave:Ge(Hg(mt,be)),onDrop:Ge(Hg(wt,Ee))},gt,E),!i&&!w?{tabIndex:0}:{}),xt)}},[E,M,$,N,j,te,ae,be,Ee,w,x,i]),$e=U.useCallback(function(fe){fe.stopPropagation()},[]),Be=U.useMemo(function(){return function(){var fe=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Ae=fe.refKey,gt=Ae===void 0?"ref":Ae,Re=fe.onChange,He=fe.onClick,Dt=Qj(fe,Rur),Fe=lae({accept:r,multiple:a,type:"file",style:{display:"none"},onChange:Je(Hg(Re,Ee)),onClick:Je(Hg(He,$e)),autoComplete:"off",tabIndex:-1},gt,R);return Gs(Gs({},Fe),Dt)}},[R,r,a,Ee,i]),we=G.length,Ie=we>0&&bur({files:G,accept:r,minSize:o,maxSize:s,multiple:a,maxFiles:l}),je=we>0&&!Ie;return Gs(Gs({},L),{},{isDragAccept:Ie,isDragReject:je,isFocused:V&&!i,getRootProps:de,getInputProps:Be,rootRef:E,inputRef:R,open:Je(B)})}function Nur(t,e){switch(e.type){case"focus":return Gs(Gs({},t),{},{isFocused:!0});case"blur":return Gs(Gs({},t),{},{isFocused:!1});case"openDialog":return Gs(Gs({},t),{},{isFileDialogActive:!0});case"closeDialog":return Gs(Gs({},t),{},{isFileDialogActive:!1});case"setDraggedFiles":var r=e.isDragActive,i=e.draggedFiles;return Gs(Gs({},t),{},{draggedFiles:i,isDragActive:r});case"setFiles":return Gs(Gs({},t),{},{acceptedFiles:e.acceptedFiles,fileRejections:e.fileRejections});case"reset":return Gs({},bYe);default:return t}}const Fur=Ot("li")(({theme:t})=>({margin:t.spacing(.5)})),kur=({name:t,onDelete:e})=>F.jsx(Fur,{children:F.jsx(L4,{label:t,icon:F.jsx(cYe,{},void 0),variant:"outlined",sx:{maxWidth:200},onDelete:e},void 0)},void 0),xYe=t=>{var e,r,{value:i,onChange:n,sx:s,title:o,buttonText:a,typographyProps:l,buttonProps:c,disabled:u,maxSize:h}=t,f=Ncr(t,["value","onChange","sx","title","buttonText","typographyProps","buttonProps","disabled","maxSize"]);const{fileRejections:m,getRootProps:g,getInputProps:y,open:_}=wYe(Object.assign(Object.assign({},f),{disabled:u,maxSize:h,onDropAccepted:n,noClick:!0,noKeyboard:!0})),b=h!==void 0&&m.length>0&&m[0].file.size>h,w=S=>{const C=[...i];C.splice(S,1),n(C)},x=i==null?void 0:i.map((S,C)=>F.jsx(kur,{name:S.name,onDelete:()=>w(C)},S.name));return F.jsxs(cl,Object.assign({},g(),{sx:Object.assign({border:1,borderRadius:1,borderColor:"rgba(0, 0, 0, 0.23)",paddingY:3,paddingX:1,"&:hover":{borderColor:u?void 0:"text.primary"},"&:focus-within":{borderColor:"primary.main",borderWidth:2}},s)},{children:[F.jsxs(Im,Object.assign({error:b,sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},{children:[F.jsx("input",Object.assign({},y()),void 0),F.jsx(lYe,{sx:{fontSize:40},color:u?"disabled":"primary"},void 0),F.jsx(eQ,Object.assign({variant:"caption",textAlign:"center",sx:{paddingY:1}},l,{children:o}),void 0),F.jsx(D4,Object.assign({variant:"contained",onClick:_,disabled:u,sx:{marginBottom:1}},c,{children:a}),void 0),F.jsxs(zMe,{children:[" ",(r=(e=m[0])===null||e===void 0?void 0:e.errors[0])===null||r===void 0?void 0:r.message," "]},void 0)]}),void 0),F.jsx(cl,Object.assign({component:"ul",sx:{display:"flex",justifyContent:"center",flexWrap:"wrap",listStyle:"none",p:.5,m:0}},{children:x}),void 0)]}),void 0)};xYe.defaultProps={title:"Drag 'n' drop some files here, or click to select files",buttonText:"Upload"};const Uur=()=>{const[t,e]=U.useContext(Co),[r,i]=U.useState([]);U.useEffect(()=>{const s=new FileReader;s.onload=o=>{const a=JSON.parse(o.target.result);e({type:"AOIgeometry",payload:a.features[0].geometry.coordinates[0]})},r.length?s.readAsText(r[0]):console.log("none")},[r]);const n=s=>i(s);return F.jsxs("div",{className:"control-panel",style:{height:"800px"},children:[F.jsx("h2",{style:{textAlign:"center"},children:"Upload AOI Geometry"}),F.jsx("hr",{}),F.jsx(xYe,{value:r,onChange:n},"handleFileUpload"),F.jsx(cl,{textAlign:"center",children:F.jsx("br",{})})]})},zur=Ml.memo(Uur),Vme=({})=>{const e={marginTop:-40,marginBottom:20,marginRight:2},[r,i]=U.useContext(Co),n=(l,c)=>{i({type:"demoPanel",payload:c.toUpperCase()})},s=[...r.demoType==="AirHub SkyPath"||r.demoType==="AirHub Elevate"||r.demoType==="AirHub MultiPath"||r.demoType==="AirHub ReadyToFly"?[]:["SELECT DATA SURFACE"],...r.demoType==="AirHub Elevate"?[]:["CLASSIFY SURFACE"],...r.demoType==="AirHub Elevate"?[]:["CALCULATE SURFACE"],...r.demoType==="AirHub Elevate"?[]:["SURFACE DATA MODEL"],"REFRESH MAP","UPLOAD AOI GEOMETRY"],o=[...r.demoType==="AirHub SkyPath"||r.demoType==="AirHub Elevate"||r.demoType==="AirHub MultiPath"||r.demoType==="AirHub ReadyToFly"?[]:[F.jsx(JXe,{className:"icon"})],...r.demoType!=="AirHub Elevate"?[F.jsx(KXe,{className:"icon"})]:[],...r.demoType!=="AirHub Elevate"?[F.jsx(QXe,{className:"icon"})]:[],...r.demoType!=="AirHub Elevate"?[F.jsx(eYe,{className:"icon"})]:[],F.jsx(tYe,{className:"icon"}),F.jsx(rYe,{className:"icon"})],a=()=>r.demoPanel==="REFRESH MAP"?window.location.reload(!1):r.demoPanel==="SELECT DATA SURFACE"?F.jsx(acr,{}):r.demoPanel==="CLASSIFY SURFACE"?F.jsx(vcr,{}):r.demoPanel==="CALCULATE SURFACE"?F.jsx(Scr,{}):r.demoPanel==="SURFACE DATA MODEL"?F.jsx(Ccr,{}):r.demoPanel==="UPLOAD AOI GEOMETRY"?F.jsx(zur,{}):F.jsx(F.Fragment,{});return F.jsxs(F.Fragment,{children:[F.jsxs(cl,{sx:{display:"flex"},children:[F.jsx(LMe,{}),F.jsxs(aot,{sx:{width:70,flexShrink:0,"& .MuiDrawer-paper":{width:70,boxSizing:"border-box",paddingLeft:1,opacity:.8}},variant:"permanent",anchor:"left",children:[F.jsx(Qlt,{}),F.jsx("img",{src:Rcr,style:e}),F.jsx(qst,{}),F.jsx(GMe,{children:s.map((l,c)=>F.jsxs(gat,{disablePadding:!0,children:[" ",F.jsx(Vlt,{title:l,placement:"right",children:F.jsx(iat,{onClick:u=>n(u,l),children:F.jsx(Sat,{children:o[c]})})})]},l))})]})]}),a()]})},SYe=()=>{const t=U.useContext($me),[e,r]=U.useContext(u1),i=()=>{const n=new hF({symbolLayers:[{type:"path",profile:"quad",join:"round",material:{color:[0,0,255,.3]},width:16,height:10,profileRotation:"heading"}]}),s=new ZF({symbol:n,label:""}),o=new Hj({id:"surfaceLayer",url:t.routeBlob,renderer:s,popupEnabled:!0,elevationInfo:{mode:"relative-to-ground",offset:50}});t.routeBlob&&e.scene.add(o)};return U.useLayoutEffect(()=>{i()},[t.routeBlob]),F.jsx(F.Fragment,{})},Vur=()=>{const[t,e]=U.useContext(Co);return U.useContext(u1),F.jsx(F.Fragment,{children:F.jsx(dme,{children:F.jsxs(aYe,{children:[(t.demoPanel==="CLASSIFY SURFACE"||t.demoPanel==="CALCULATE SURFACE"||t.demoPanel==="SURFACE DATA MODEL")&&F.jsx(bme,{}),F.jsxs(Cq,{children:[F.jsx(sme,{}),F.jsx(hme,{}),F.jsx(SYe,{})]}),F.jsx(wme,{}),F.jsx(Vme,{})]})})})},Bur=()=>{const[t,e]=U.useContext(Co);return F.jsx(F.Fragment,{children:F.jsx(dme,{children:F.jsxs(aYe,{children:[(t.demoPanel==="CLASSIFY SURFACE"||t.demoPanel==="CALCULATE SURFACE"||t.demoPanel==="SURFACE DATA MODEL")&&F.jsx(bme,{}),F.jsxs(Cq,{children:[F.jsx(sme,{}),F.jsx(hme,{}),F.jsx(SYe,{})]}),F.jsx(wme,{}),F.jsx(Vme,{})]})})})},jur=()=>{const[t,e]=U.useContext(Co);return U.useContext(u1),F.jsx(F.Fragment,{children:F.jsxs(dme,{children:[(t.demoPanel==="CLASSIFY SURFACE"||t.demoPanel==="CALCULATE SURFACE"||t.demoPanel==="SURFACE DATA MODEL")&&F.jsx(bme,{}),F.jsxs(Cq,{children:[F.jsx(sme,{}),F.jsx(hme,{})]}),F.jsx(wme,{}),F.jsx(Vme,{})]})})},Gur="/arcgis-demo-vite/assets/Airspace Link Banner-31b9fcd5.png";const e8=[{name:"AirHub SolutionsSurface",cardPosition:{marginLeft:-600,marginTop:-300},imagePath:"../src/assets/SolutionsSurface.png",action:"SURFACE",altText:"Solutions Surface Demo",desc:"Mash up over 60 AirHub data sources into a customizable drone solution surface"},{name:"AirHub Elevate",cardPosition:{marginLeft:-150,marginTop:-300},imagePath:"../src/assets/RouteConvert.png",action:"ROUTECONVERTER",altText:"UAS Route Convertor Demo",desc:"Exact altitude & elevation reference data for precise 3Ddrone routing"},{name:"AirHub SkyPath",cardPosition:{marginLeft:300,marginTop:-300},imagePath:"../src/assets/UASrouting.png",action:"ROUTING",altText:"UAS Routing Demo",desc:"Precise Least Cost Path routing from custom generated surfaces"},{name:"AirHub MultiPath",cardPosition:{marginLeft:-600,marginTop:0},imagePath:"../src/assets/MultiPathDemo.png",action:"MULTIROUTING",altText:"UAS MultiPath Routing",desc:"Custom surface Least Cost Path Hub+Spoke Routing"},{name:"AirHub ReadyToFly",cardPosition:{marginLeft:-150,marginTop:0},imagePath:"../src/assets/ReadyToFly.png",action:"READYTOFLY",altText:"Surface, MultiPath Routing and Elevate",desc:"UAS Solutions Surface LeastCostPath to precise 3D elevated ready-to-fly routes"}],Hur={zIndex:10,width:360,position:"absolute",left:"50%",top:"50%",marginLeft:-180,marginTop:300,opacity:.5},qur=Mle({palette:{mode:"dark"}}),Wur=()=>{const[t,e]=U.useContext(Co);return F.jsx(F.Fragment,{children:F.jsxs(Jit,{theme:qur,children:[F.jsx(LMe,{}),t.demoType==="DEMO SELECT"&&F.jsx(Cq,{}),t.demoType==="DEMO SELECT"&&F.jsx(Dct,{demoCardData:e8}),t.demoType==="DEMO SELECT"&&F.jsx("img",{src:Gur,style:Hur,alt:"Airspace Link Inc. banner"}),t.demoType===e8[0].name&&F.jsx(jur,{}),t.demoType===e8[2].name&&F.jsx(Vur,{}),t.demoType===e8[3].name&&F.jsx(Bur,{})]})})};KJ.createRoot(document.getElementById("root")).render(F.jsx(Ml.StrictMode,{children:F.jsx(Lct,{children:F.jsx(ktr,{children:F.jsx(Wur,{})})})}));export{vIt as $,w7e as A,ZHt as B,R6e as C,XB as D,kRt as E,LFt as F,Q4t as G,iFt as H,dfe as I,ype as J,cjt as K,ljt as L,hq as M,ujt as N,QB as O,ZNt as P,Pqt as Q,R7e as R,BCt as S,Iqt as T,P7e as U,gHt as V,Dqt as W,I7e as X,AFt as Y,yq as Z,oGe as _,T6e as a,Ts as a$,Wqt as a0,rWt as a1,pWt as a2,mWt as a3,yWt as a4,D4t as a5,L7e as a6,Zqt as a7,LWt as a8,Vkt as a9,le as aA,vr as aB,ke as aC,q_ as aD,xue as aE,O3 as aF,lf as aG,du as aH,Vw as aI,mce as aJ,vt as aK,pe as aL,li as aM,R_ as aN,one as aO,cf as aP,PBt as aQ,Bi as aR,R3 as aS,xc as aT,go as aU,Qv as aV,gqe as aW,bhr as aX,Yqe as aY,Ns as aZ,opr as a_,v6t as aa,ezt as ab,bzt as ac,fzt as ad,Yy as ae,Ri as af,_r as ag,qe as ah,d as ai,p as aj,Tc as ak,I as al,K4 as am,wve as an,Ce as ao,dqe as ap,Cue as aq,$fe as ar,Q4 as as,vBt as at,xn as au,H as av,Oa as aw,ti as ax,yBt as ay,mN as az,z6e as b,nhr as b$,X_ as b0,ht as b1,_w as b2,FE as b3,U3 as b4,Xt as b5,aE as b6,CD as b7,wKt as b8,Yn as b9,gmt as bA,ymt as bB,J4 as bC,dt as bD,TA as bE,cRr as bF,dRr as bG,lRr as bH,pHe as bI,ERr as bJ,nZt as bK,gRr as bL,KYt as bM,Gt as bN,Y4 as bO,$r as bP,hz as bQ,C0e as bR,tue as bS,Po as bT,PP as bU,oB as bV,d7 as bW,Wht as bX,Xht as bY,Yht as bZ,Zht as b_,e1r as ba,t1r as bb,dLt as bc,k_ as bd,uh as be,kl as bf,u_r as bg,lwr as bh,VUt as bi,d$ as bj,_0 as bk,mE as bl,gx as bm,dr as bn,sdr as bo,oQ as bp,e$e as bq,CF as br,lOr as bs,aOr as bt,Da as bu,ie as bv,pft as bw,dft as bx,re as by,q2 as bz,vOt as c,ft as c$,shr as c0,Te as c1,Lfe as c2,J9t as c3,he as c4,il as c5,byt as c6,Zw as c7,lpr as c8,pTr as c9,dB as cA,Obe as cB,xgt as cC,Uo as cD,Me as cE,lt as cF,aDe as cG,bf as cH,T_ as cI,Mi as cJ,b8 as cK,To as cL,Kpr as cM,q_r as cN,lr as cO,So as cP,xd as cQ,NKt as cR,Ppr as cS,B4 as cT,C7 as cU,An as cV,E_ as cW,_dr as cX,Dh as cY,Us as cZ,O as c_,Wpe as ca,jE as cb,G4 as cc,pn as cd,da as ce,Fr as cf,PE as cg,tVt as ch,nf as ci,$ht as cj,Uer as ck,tt as cl,me as cm,wDe as cn,BFe as co,Rn as cp,A as cq,Ue as cr,Rt as cs,Bwr as ct,mc as cu,CAt as cv,rY as cw,qi as cx,Yyr as cy,Zyr as cz,lAt as d,$Tt as d$,i3 as d0,Lo as d1,bpe as d2,qE as d3,ir as d4,OLe as d5,Ggt as d6,Dw as d7,Y2 as d8,Jce as d9,QOr as dA,sQt as dB,tF as dC,wP as dD,o0 as dE,Pc as dF,iee as dG,gs as dH,ree as dI,see as dJ,GV as dK,mDe as dL,xhr as dM,YN as dN,cft as dO,Ti as dP,lhr as dQ,id as dR,Rl as dS,Swt as dT,Al as dU,gfr as dV,mfr as dW,hbe as dX,e3 as dY,tde as dZ,d0 as d_,Zce as da,GLe as db,Kce as dc,Hhr as dd,Dmt as de,XOr as df,pOe as dg,WOr as dh,atr as di,uWe as dj,E0t as dk,Dtr as dl,tvt as dm,en as dn,Ys as dp,c0 as dq,Lt as dr,Se as ds,se as dt,RN as du,iAr as dv,yAr as dw,zSe as dx,Vt as dy,_tr as dz,vAt as e,Sj as e$,smr as e0,ahr as e1,ohr as e2,Li as e3,gve as e4,vP as e5,Oc as e6,Wn as e7,U9e as e8,a1 as e9,Pn as eA,aRr as eB,yRr as eC,SRr as eD,hRr as eE,sJt as eF,_Rr as eG,CRr as eH,uJt as eI,xRr as eJ,uRr as eK,Ym as eL,Qur as eM,UV as eN,Mce as eO,cOr as eP,zct as eQ,Poe as eR,ou as eS,hOr as eT,dOr as eU,OKt as eV,whr as eW,$Ht as eX,IHt as eY,EHt as eZ,nCr as e_,Aq as ea,gi as eb,wAr as ec,$E as ed,myt as ee,hdr as ef,lg as eg,Rd as eh,N3 as ei,J2e as ej,tEe as ek,Rh as el,f_ as em,os as en,gCt as eo,Qe as ep,LQ as eq,xWe as er,npr as es,Dhr as et,at as eu,Hfe as ev,xLe as ew,jo as ex,Oh as ey,bOe as ez,gDt as f,lgt as f$,dEr as f0,DHt as f1,Fht as f2,Rfe as f3,mue as f4,z0t as f5,OPr as f6,PPr as f7,APr as f8,GDt as f9,eme as fA,srr as fB,SAr as fC,XAr as fD,WAr as fE,ace as fF,gV as fG,Qfe as fH,sue as fI,owr as fJ,O7 as fK,fN as fL,b0 as fM,Qyr as fN,oBe as fO,rk as fP,obt as fQ,C3 as fR,Dfe as fS,Bje as fT,xq as fU,bN as fV,Eue as fW,Sue as fX,Cd as fY,Y7 as fZ,cgt as f_,HDt as fa,Qce as fb,S9e as fc,z_r as fd,U_r as fe,x0t as ff,bue as fg,Cpr as fh,Rpr as fi,Spr as fj,Epr as fk,$l as fl,hmt as fm,V_r as fn,ODt as fo,VGe as fp,Y$ as fq,Ni as fr,xi as fs,u0 as ft,md as fu,$n as fv,HV as fw,frr as fx,mrr as fy,DAr as fz,Jde as g,eRr as g$,Amt as g0,ove as g1,vce as g2,Ul as g3,Cyt as g4,Xqe as g5,uqe as g6,Tqe as g7,Gv as g8,vfr as g9,oe as gA,Sx as gB,P_ as gC,C$e as gD,Ode as gE,Hr as gF,ldr as gG,mdr as gH,DU as gI,XRe as gJ,bd as gK,rd as gL,JRr as gM,Wr as gN,bRr as gO,lh as gP,og as gQ,Lyr as gR,Z4 as gS,sl as gT,Dn as gU,b7 as gV,Di as gW,Dl as gX,A_ as gY,wd as gZ,mn as g_,T0 as ga,Ter as gb,zP as gc,hn as gd,IF as ge,Fw as gf,v2 as gg,YQ as gh,Rc as gi,Cm as gj,pue as gk,ah as gl,ur as gm,T3 as gn,RRr as go,vRr as gp,Xur as gq,awr as gr,Es as gs,Zbr as gt,uBe as gu,Jbr as gv,Fzt as gw,tfr as gx,Wbr as gy,Tgt as gz,hOt as h,COr as h$,WQ as h0,Apr as h1,eee as h2,sg as h3,PKt as h4,Bfe as h5,LKt as h6,lWe as h7,ZT as h8,hp as h9,vn as hA,a6t as hB,l6t as hC,yd as hD,m_r as hE,f_r as hF,bAr as hG,fx as hH,yg as hI,DF as hJ,ex as hK,wjt as hL,OYt as hM,yi as hN,Op as hO,xve as hP,Irr as hQ,v0 as hR,Trr as hS,zWe as hT,zo as hU,FP as hV,fLt as hW,gQ as hX,TAr as hY,Kgt as hZ,Rq as h_,EL as ha,RL as hb,_Ne as hc,Mfe as hd,nF as he,LE as hf,ri as hg,Vfe as hh,htr as hi,Sc as hj,bo as hk,iue as hl,Ryr as hm,t3 as hn,lu as ho,Ii as hp,ix as hq,Swr as hr,gE as hs,wwr as ht,Twr as hu,A7 as hv,xwr as hw,o6t as hx,c6t as hy,V0e as hz,L9e as i,fWe as i$,Oy as i0,ug as i1,Na as i2,Tn as i3,TRr as i4,wRr as i5,MBt as i6,pmr as i7,h7 as i8,yEt as i9,Jvr as iA,au as iB,ge as iC,us as iD,pwt as iE,Vm as iF,fg as iG,S2 as iH,Efr as iI,bwt as iJ,ydr as iK,Tut as iL,uP as iM,ece as iN,kut as iO,fi as iP,Vne as iQ,Bne as iR,N7 as iS,Qw as iT,Xnr as iU,IKt as iV,$_ as iW,a3 as iX,Tue as iY,sE as iZ,Xpr as i_,vve as ia,L_ as ib,zr as ic,oF as id,wc as ie,UEt as ig,eF as ih,YKt as ii,gN as ij,pdr as ik,ppr as il,Phr as im,Sm as io,hDe as ip,mxe as iq,qu as ir,Nht as is,Yvr as it,KRr as iu,fKt as iv,kO as iw,uee as ix,e_r as iy,Rhr as iz,xE as j,Jr as j$,bve as j0,Bqe as j1,Eqe as j2,Gqe as j3,CP as j4,vue as j5,iM as j6,y4 as j7,sF as j8,JF as j9,yde as jA,WCr as jB,pSr as jC,Q9t as jD,bA as jE,UO as jF,Eh as jG,uw as jH,Yur as jI,Ddr as jJ,SN as jK,L_r as jL,jr as jM,gd as jN,nu as jO,T as jP,as as jQ,Mh as jR,Mt as jS,Ye as jT,WB as jU,R0 as jV,kt as jW,Ed as jX,De as jY,X as jZ,Hi as j_,wue as ja,zfe as jb,yA as jc,s0 as jd,qp as je,g4 as jf,kfe as jg,lvt as jh,avt as ji,ovt as jj,Ahr as jk,Nfe as jl,q as jm,_e as jn,Sn as jo,Mr as jp,Oi as jq,zm as jr,cs as js,Ct as jt,Ui as ju,aVt as jv,GTt as jw,rw as jx,qs as jy,Ia as jz,zjt as k,rA as k$,tl as k0,si as k1,Kr as k2,Br as k3,Qt as k4,o1 as k5,_H as k6,Px as k7,fu as k8,kH as k9,vtr as kA,chr as kB,MQ as kC,Tp as kD,Or as kE,eu as kF,Nde as kG,BP as kH,tPr as kI,_F as kJ,aNe as kK,ua as kL,mi as kM,ve as kN,ut as kO,ce as kP,Ipr as kQ,pvt as kR,xAr as kS,a_r as kT,MD as kU,VN as kV,JB as kW,gn as kX,nr as kY,Up as kZ,hTe as k_,hr as ka,m0 as kb,vx as kc,Mx as kd,VH as ke,hpe as kf,UH as kg,J3 as kh,w4t as ki,Hde as kj,Mhe as kk,Oyr as kl,XH as km,jje as kn,Pa as ko,xtr as kp,ZOr as kq,tAr as kr,Mhr as ks,XGe as kt,sUe as ku,Apt as kv,fP as kw,i_r as kx,HTt as ky,QMe as kz,CNt as l,H4 as l$,Nyr as l0,Rs as l1,iut as l2,OAr as l3,KCr as l4,gp as l5,vNe as l6,Z$e as l7,Hle as l8,zWt as l9,c1 as lA,Pfe as lB,rqe as lC,XQt as lD,WQt as lE,qQt as lF,VQt as lG,mqe as lH,EQt as lI,RQt as lJ,HDe as lK,cQt as lL,uQt as lM,dQt as lN,pQt as lO,fQt as lP,mQt as lQ,gQt as lR,yQt as lS,vQt as lT,_Qt as lU,bQt as lV,wQt as lW,Wqe as lX,apr as lY,Sht as lZ,ryt as l_,Ei as la,fDe as lb,zW as lc,y_e as ld,Whr as le,MP as lf,Qpr as lg,ls as lh,edr as li,nx as lj,uOr as lk,Pqe as ll,cce as lm,rx as ln,gO as lo,lQt as lp,$Or as lq,Oqe as lr,X2 as ls,pV as lt,zhe as lu,E3 as lv,ZF as lw,xQt as lx,XKt as ly,Tq as lz,cGt as m,E0e as m$,Hce as m0,QW as m1,Xr as m2,KOr as m3,Rr as m4,nd as m5,Bue as m6,gDe as m7,Dy as m8,mF as m9,EH as mA,xo as mB,eNt as mC,B6t as mD,RH as mE,ff as mF,Ox as mG,NA as mH,jC as mI,ME as mJ,K9t as mK,Z9t as mL,kwt as mM,AN as mN,r_r as mO,oQt as mP,U7 as mQ,xpr as mR,vpr as mS,bpr as mT,_pr as mU,wpr as mV,gh as mW,Opr as mX,Oze as mY,y7 as mZ,C_ as m_,fwr as ma,wne as mb,lbe as mc,NBe as md,kBe as me,jh as mf,PD as mg,$2 as mh,EBe as mi,pUt as mj,s6t as mk,QDt as ml,E9e as mm,Chr as mn,tNt as mo,j6t as mp,F6t as mq,k6t as mr,H6t as ms,z6t as mt,V6t as mu,dg as mv,U6t as mw,zl as mx,G6t as my,SF as mz,c7e as n,Bt as n$,Ine as n0,la as n1,ypr as n2,lfr as n3,MUe as n4,zE as n5,We as n6,yDe as n7,oi as n8,gF as n9,Foe as nA,Kur as nB,K7 as nC,y0 as nD,swt as nE,xA as nF,B9t as nG,cwt as nH,Nl as nI,yfr as nJ,dfr as nK,hfr as nL,Cfr as nM,FAr as nN,Gtr as nO,gf as nP,NAr as nQ,ol as nR,grr as nS,Dze as nT,Iyr as nU,Zdr as nV,j_r as nW,B_r as nX,uze as nY,Wvr as nZ,ALe as n_,pfr as na,ye as nb,hf as nc,Kb as nd,Z_ as ne,z4 as nf,VE as ng,D_ as nh,zi as ni,ade as nj,Ch as nk,ide as nl,hP as nm,ygt as nn,Wy as no,_wr as np,nJt as nq,mRr as nr,rJt as ns,pRr as nt,fRr as nu,z as nv,thr as nw,N4 as nx,Zze as ny,Ds as nz,VHt as o,UFe as o$,A1e as o0,sce as o1,uf as o2,ode as o3,mpr as o4,ks as o5,Rfr as o6,jhr as o7,O1e as o8,S0 as o9,Tl as oA,HSt as oB,NN as oC,Mdr as oD,aut as oE,Lbr as oF,Ibr as oG,Mbr as oH,zO as oI,V5t as oJ,$br as oK,Xfe as oL,EAr as oM,TDe as oN,_We as oO,vWe as oP,Zt as oQ,Ehr as oR,qIe as oS,Shr as oT,XIe as oU,Mn as oV,Fa as oW,Ai as oX,jl as oY,eDe as oZ,_P as o_,D7 as oa,lue as ob,sr as oc,af as od,hg as oe,Cr as of,XP as og,ar as oh,Ma as oi,wr as oj,bh as ok,zH as ol,Ax as om,b8e as on,Rx as oo,On as op,$8e as oq,It as or,$he as os,Fm as ot,Zpr as ou,$Se as ov,Ghe as ow,l5e as ox,Jwt as oy,QCr as oz,h7e as p,Ybt as p$,hu as p0,Cxt as p1,cfr as p2,fbe as p3,QOt as p4,IN as p5,bP as p6,gpr as p7,M3t as p8,lde as p9,Rbe as pA,Xyr as pB,i1r as pC,Xbr as pD,REt as pE,CYt as pF,NFe as pG,qz as pH,MGt as pI,OGe as pJ,pxt as pK,Nhr as pL,Gce as pM,Nmt as pN,Ytr as pO,wWe as pP,Vtr as pQ,ztr as pR,prr as pS,zft as pT,SCt as pU,pCt as pV,fCt as pW,df as pX,$P as pY,$bt as pZ,Yue as p_,txt as pa,od as pb,sH as pc,M1t as pd,XE as pe,l1 as pf,ct as pg,hTt as ph,lmr as pi,$Oe as pj,n$e as pk,Xle as pl,cdr as pm,V4 as pn,out as po,p7 as pp,fdr as pq,r$e as pr,fd as ps,b$e as pt,tce as pu,adr as pv,f0e as pw,VDe as px,Jle as py,n1 as pz,GHt as q,q7 as q$,UE as q0,bCt as q1,ih as q2,Nr as q3,w7 as q4,Yhr as q5,I_ as q6,qw as q7,UDe as q8,SP as q9,iwr as qA,nwr as qB,KL as qC,Nw as qD,H_r as qE,fxe as qF,W_r as qG,Xhr as qH,bce as qI,F_r as qJ,_9e as qK,w9e as qL,y9e as qM,bxe as qN,iNt as qO,Xvr as qP,BLe as qQ,kmt as qR,Uhr as qS,Lpt as qT,Vpt as qU,x9e as qV,Oce as qW,phr as qX,fVe as qY,Hnr as qZ,G4t as q_,udr as qa,k7 as qb,Moe as qc,Fpt as qd,q2t as qe,tx as qf,pI as qg,c9 as qh,twr as qi,o7 as qj,$Ge as qk,AGe as ql,nfe as qm,pGt as qn,PGe as qo,ife as qp,b1e as qq,swr as qr,Kbr as qs,ewr as qt,W5t as qu,Z5t as qv,BUt as qw,Z4e as qx,fbt as qy,rwr as qz,qHt as r,Ad as r$,bc as r0,D2r as r1,F2r as r2,Ypr as r3,Q1t as r4,uT as r5,I2r as r6,Otr as r7,IB as r8,efr as r9,oAr as rA,aAr as rB,$y as rC,rF as rD,PLe as rE,Sze as rF,qI as rG,XFe as rH,tRr as rI,hB as rJ,Ac as rK,GA as rL,YJt as rM,Um as rN,Lpr as rO,EDe as rP,Kw as rQ,tyt as rR,$pr as rS,dvt as rT,F_ as rU,Ky as rV,SA as rW,Eo as rX,tee as rY,Ph as rZ,eq as r_,Rvr as ra,m8e as rb,yn as rc,gpe as rd,Yr as re,_h as rf,BQ as rg,hE as rh,wH as ri,Od as rj,s1 as rk,La as rl,$t as rm,Ki as rn,V4e as ro,k2r as rp,U2r as rq,V2r as rr,Vue as rs,pt as rt,gg as ru,ci as rv,qr as rw,jCr as rx,GSt as ry,rSr as rz,v7e as s,AU as s$,wf as s0,hh as s1,E8e as s2,Tfr as s3,p$t as s4,vu as s5,Ah as s6,Gwt as s7,q$t as s8,KP as s9,$4e as sA,Der as sB,Mpr as sC,Vqe as sD,yR as sE,rQt as sF,hF as sG,fF as sH,pF as sI,F3 as sJ,$qe as sK,V1t as sL,EOr as sM,i9t as sN,CDt as sO,TDt as sP,S_r as sQ,x_r as sR,N_ as sS,Z_r as sT,oa as sU,rl as sV,lSr as sW,cpe as sX,ll as sY,Udr as sZ,rh as s_,lmt as sa,ph as sb,ILt as sc,Sie as sd,Nhe as se,Txt as sf,rwt as sg,ewt as sh,qv as si,Ble as sj,fxt as sk,ddr as sl,Ww as sm,ufr as sn,vq as so,aB as sp,g4t as sq,YCr as sr,o_r as ss,JCr as st,ZCr as su,W4 as sv,Gi as sw,Btr as sx,Bhr as sy,R1e as sz,m7e as t,ABe as t$,s_r as t0,dee as t1,Qvr as t2,ZLt as t3,X7 as t4,kE as t5,n9t as t6,Cs as t7,Rje as t8,S9t as t9,iyt as tA,xs as tB,dtr as tC,h2 as tD,dAr as tE,k3 as tF,uAr as tG,mr as tH,O9e as tI,A9e as tJ,d_r as tK,cAr as tL,eAr as tM,vre as tN,eBe as tO,u5t as tP,d5t as tQ,wq as tR,Qbr as tS,UYt as tT,_hr as tU,oOr as tV,pne as tW,JJt as tX,Tpr as tY,bq as tZ,AVe as t_,G4e as ta,l$e as tb,qct as tc,Thr as td,Vxt as te,pAr as tf,fAr as tg,HCr as th,cfe as ti,lAr as tj,nAr as tk,sAr as tl,rAr as tm,V6 as tn,L8e as to,lHt as tp,ctr as tq,twt as tr,N2r as ts,hAr as tt,utr as tu,Xgt as tv,NEe as tw,BA as tx,Ayr as ty,IP as tz,D6e as u,jkt as u$,FIe as u0,VFe as u1,Iz as u2,jwr as u3,gAr as u4,mAr as u5,LP as u6,wwt as u7,n_ as u8,Spe as u9,QTe as uA,jne as uB,Uf as uC,bj as uD,PFe as uE,Zke as uF,T7 as uG,NV as uH,H_ as uI,Q7 as uJ,kAr as uK,pa as uL,kw as uM,rH as uN,ZFe as uO,ffr as uP,ihr as uQ,rhr as uR,S7 as uS,WNt as uT,tme as uU,GWe as uV,hm as uW,$b as uX,dP as uY,Gle as uZ,kmr as u_,tq as ua,Si as ub,K2r as uc,Jdr as ud,YOr as ue,g7 as uf,Pdr as ug,LN as uh,wN as ui,p_r as uj,KFe as uk,k7t as ul,z2r as um,bw as un,dwt as uo,btr as up,Ove as uq,JOr as ur,yve as us,cVt as ut,_7 as uu,br as uv,Bct as uw,lze as ux,cze as uy,dhr as uz,ORt as v,eTr as v$,yE as v0,cTr as v1,wj as v2,Zu as v3,Ku as v4,qne as v5,Gne as v6,Wne as v7,Hne as v8,e2e as v9,k_r as vA,eM as vB,Cfe as vC,BJt as vD,jJt as vE,QHe as vF,fNt as vG,P9e as vH,Fj as vI,Vdr as vJ,Lm as vK,YHe as vL,BD as vM,Aft as vN,cH as vO,IV as vP,x7 as vQ,npt as vR,ipt as vS,uhr as vT,JV as vU,jdt as vV,tTr as vW,uTr as vX,UVe as vY,qT as vZ,t2e as v_,gyt as va,lLt as vb,Ghr as vc,Jur as vd,ATr as ve,Vhr as vf,tQt as vg,n_r as vh,Qu as vi,Adr as vj,WJt as vk,wFt as vl,Wd as vm,Vr as vn,wo as vo,Fs as vp,Jt as vq,Qi as vr,el as vs,Rhe as vt,h0 as vu,Evr as vv,Kt as vw,Yt as vx,Et as vy,ZRr as vz,S6e as w,gvt as w$,iTr as w0,HT as w1,KSr as w2,FZ as w3,Dz as w4,uu as w5,pf as w6,t9e as w7,Mp as w8,VVt as w9,X_r as wA,G_r as wB,dTt as wC,rOr as wD,mre as wE,UY as wF,zY as wG,idr as wH,ndr as wI,D_r as wJ,DKt as wK,sx as wL,y$e as wM,S1t as wN,x1t as wO,w1t as wP,rvt as wQ,fI as wR,C1t as wS,xfe as wT,amr as wU,Nue as wV,R1t as wW,cdt as wX,rB as wY,nB as wZ,MN as w_,BVt as wa,YL as wb,Jgt as wc,zkt as wd,Ukt as we,Utr as wf,vdr as wg,Jpr as wh,R7 as wi,Fyr as wj,kyr as wk,KOt as wl,Dyr as wm,Htr as wn,dn as wo,ede as wp,khr as wq,Awt as wr,RAr as ws,VU as wt,sd as wu,Yw as wv,owt as ww,bKt as wx,v0t as wy,ebt as wz,DRt as x,G2e as x$,tdr as x0,xPr as x1,P4e as x2,M4e as x3,uF as x4,MJt as x5,cmr as x6,Qrr as x7,gGt as x8,PGt as x9,aEe as xA,lEe as xB,Fhr as xC,Wce as xD,RLe as xE,Ihr as xF,Ymt as xG,zmt as xH,Lhr as xI,cEe as xJ,zhr as xK,Dbr as xL,qbr as xM,Bbr as xN,Vbr as xO,Dzt as xP,jbr as xQ,Gbr as xR,gSe as xS,vSe as xT,ySe as xU,Ubr as xV,zbr as xW,M2e as xX,x2e as xY,S2e as xZ,T2e as x_,ZS as xa,v2e as xb,b2e as xc,D5t as xd,Lpe as xe,zUt as xf,Dpe as xg,HBe as xh,Npe as xi,qBe as xj,L6t as xk,Tne as xl,jQt as xm,GQt as xn,HQt as xo,lkt as xp,$hr as xq,z2e as xr,D2e as xs,$mt as xt,N2e as xu,K2e as xv,F2e as xw,qhr as xx,j2e as xy,oEe as xz,fD as y,yEe as y0,bEe as y1,$2e as y2,vEe as y3,W7 as y4,nj as y5,Hbr as y6,F5t as y7,k5t as y8,Fbr as y9,kbr as ya,rBe as yb,Nbr as yc,Uzt as yd,U5t as ye,yue as yf,spr as yg,l_r as yh,Q_r as yi,Vwr as yj,XRr as yk,wOr as yl,LOr as ym,vAr as yn,$Pr as yo,XHt as z};
